---
title: SpringCloud alibaba - Nacos
date: 2023-06-25 09:22:36
permalink: /spring/spring-cloud/2/
sidebar: true
article: false # 是否未非文章页，非文章不显示 面包屑和作者、时间，不显示最近更新栏，不会参与到最近更新文章的数据计算中
comment: false # 评论区
editLink: false
---

## 文档学习

[Nacos介绍](https://nacos.io/zh-cn/docs/what-is-nacos.html)
[Nacos下载及配置](https://nacos.io/zh-cn/docs/quick-start.html) [下载地址](https://github.com/alibaba/nacos/releases)
[Nacos server 配置说明](https://nacos.io/zh-cn/docs/system-configurations.html)
[Nacos spring cloud 基础入门](https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html)
[Nacos spring 注解说明](https://nacos.io/zh-cn/docs/nacos-spring.html)
[Nacos 对应 spring cloud 版本](https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E)
[Nacos config yml 配置说明](https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config)
[Nacos discovery yml 配置API](https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-discovery)
[spring 官网对 cloud alibaba 的介绍及配置](https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_introduction)

> Nacos config 是监听配置信息(yml)发生变化的
Nacos discovery 是注册发现服务的

## discovery
### 下载安装Nacos我就不说了
安装好访问页面

![](https://upload-images.jianshu.io/upload_images/13859779-ab1dc7bec390abd1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 先搭建基本的服务结构

![](https://upload-images.jianshu.io/upload_images/13859779-311d333162a8de4b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

demo-cloud pom.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.2.5.RELEASE</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>

    <groupId>com.example</groupId>
    <artifactId>demo-cloud</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>demo-cloud</name>
    <description>Demo project for Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>2.1.0.RELEASE</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>


    <modules>
        <module>demo-order-server</module>
        <module>demo-user-server</module>
    </modules>


    <dependencies>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>

        <!-- Nacos 注册发现 -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <!-- Nacos 配置监听-->
<!--        <dependency>-->
<!--            <groupId>com.alibaba.cloud</groupId>-->
<!--            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>-->
<!--        </dependency>-->

    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>

```
demo-order-server.pom 和  demo-user-server.pom 一样
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.example</groupId>
        <artifactId>demo-cloud</artifactId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>

    <groupId>com.example</groupId>
    <artifactId>demo-order-server</artifactId>
    <version>0.0.1-SNAPSHOT</version>

</project>
```
demo-order-server.yml
```yaml
server:
  port: 8080

spring:
  application:
    name: order-server
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
        # 值范围：1到100。值越大，重量越大。
        weight: 1
        # 集群名称
        cluster-name:  order
```
demo-user-server.yml

```yaml
server:
  port: 8081

spring:
  application:
    name: user-server
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
        # 值范围：1到100。值越大，重量越大。
        weight: 1
        # 集群名称
        cluster-name:  user
```

demo-user-server Application
```java
package com.example.userserver;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.web.client.RestTemplate;

@SpringBootApplication
@EnableDiscoveryClient
public class DemoUserServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoUserServerApplication.class, args);
    }

    /**
     * 手动创建一个RestTemplate的配置：
    **/
    @Bean
    @LoadBalanced
    public RestTemplate restTemplate(RestTemplateBuilder builder){
        return builder.build();
    }
}

```

demo-order-server Application
```java
package com.example.orderserver;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class DemoOrderServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoOrderServerApplication.class, args);
    }

}

```

demo-order-server OrderController
```java
package com.example.orderserver.controller;

import org.springframework.web.bind.annotation.*;

import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @Author big uncle
 * @Date 2020/3/20 11:33
 * @module HYQ_APP
 **/
@RestController
@RequestMapping("order")
public class OrderController {

    Map<String,List<String>> map = new HashMap<String,List<String>>(10){{
        put("1",Arrays.asList("userId:1 orderId:1","userId:1 orderId:2","userId:1 orderId:3","userId:1 orderId:4"));
        put("2",Arrays.asList("userId:2 orderId:10","userId:2 orderId:12","userId:2 orderId:13","userId:2 orderId:14"));
        put("3",Arrays.asList("userId:3 orderId:20","userId:3 orderId:22","userId:3 orderId:23","userId:3 orderId:24"));
    }};


    @GetMapping("/getOrder/{userId}")
    public List<String> getOrder(@PathVariable String userId){
        return map.get(userId);
    }

}

```

demo-user-server OrderController
```java
package com.example.userserver.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import java.util.List;

/**
 * 所属Y-API模块
 * 模块描述
 *
 * @Author big uncle
 * @Date 2020/3/20 11:24
 * @module HYQ_APP
 **/
@RestController
@RequestMapping("user")
public class UserController {

    private RestTemplate restTemplate;

    @Autowired
    public UserController(RestTemplate restTemplate) {
        this.restTemplate = restTemplate;
    }


    @GetMapping("/getMyOrder")
    public List<String> getMyOrder(@RequestParam("userId") String userId){
        List<String> list = restTemplate.getForObject("http://order-server/order/getOrder/" + userId, List.class);
        return list;
    }

}

```

### 启动
![](https://upload-images.jianshu.io/upload_images/13859779-1ae913b6ce639777.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



### 访问结果:
![](https://upload-images.jianshu.io/upload_images/13859779-29b7f988b0455f61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
