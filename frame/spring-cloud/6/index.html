<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringCloud - 分布式事务一（XA，2PC，3PC） | 技术博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="人民万岁">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/1.styles.014bf4fe.css" as="style"><link rel="preload" href="/assets/js/app.7e941bd4.js" as="script"><link rel="preload" href="/assets/js/11.5871899e.js" as="script"><link rel="preload" href="/assets/js/54.7831fd46.js" as="script">
    <link rel="stylesheet" href="/assets/css/1.styles.014bf4fe.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo1.png" alt="技术博客" class="logo"> <span class="site-name can-hide">技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><!----> <span class="title" style="display:;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java/base/1/" class="nav-link">JAVA</a></li><li class="dropdown-item"><!----> <a href="/language/cj/1/" class="nav-link">仓颉</a></li><li class="dropdown-item"><!----> <a href="/language/mode/1/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/language/python/1/" class="nav-link">人工智能</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/200/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/frame/mybatis/300/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/frame/maven/2300/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/frame/git/1/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/1400/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/1/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/rocketmq/1/" class="nav-link">RocketMQ</a></li><li class="dropdown-item"><!----> <a href="/redis/1600/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/zookeeper/1/" class="nav-link">Zookeeper </a></li><li class="dropdown-item"><!----> <a href="/nginx/1/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/mycat/1/" class="nav-link">数据库套件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/1/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/es/1/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/mongodb/1/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/hadoop/1/" class="nav-link">Hadoop</a></li><li class="dropdown-item"><!----> <a href="/clickhouse/1/" class="nav-link">ClickHouse</a></li><li class="dropdown-item"><!----> <a href="/hbase/1/" class="nav-link">Hbase</a></li><li class="dropdown-item"><!----> <a href="/hive/1/" class="nav-link">Hive</a></li><li class="dropdown-item"><!----> <a href="/flink/1/" class="nav-link">Flink</a></li><li class="dropdown-item"><!----> <a href="/flume/1/" class="nav-link">Flume</a></li><li class="dropdown-item"><!----> <a href="/sqlite/1/" class="nav-link">SQLite</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/2300/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/docker/400/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/jenkins/500/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/600/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/1/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/front/1/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/ai/1/" class="nav-link">AI</a></li></ul></div></div> <a href="https://github.com/landashu?tab=repositories" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><!----> <span class="title" style="display:;">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java/base/1/" class="nav-link">JAVA</a></li><li class="dropdown-item"><!----> <a href="/language/cj/1/" class="nav-link">仓颉</a></li><li class="dropdown-item"><!----> <a href="/language/mode/1/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/language/python/1/" class="nav-link">人工智能</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/200/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/frame/mybatis/300/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/frame/maven/2300/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/frame/git/1/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/1400/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/1/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/rocketmq/1/" class="nav-link">RocketMQ</a></li><li class="dropdown-item"><!----> <a href="/redis/1600/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/zookeeper/1/" class="nav-link">Zookeeper </a></li><li class="dropdown-item"><!----> <a href="/nginx/1/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/mycat/1/" class="nav-link">数据库套件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/1/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/es/1/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/mongodb/1/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/hadoop/1/" class="nav-link">Hadoop</a></li><li class="dropdown-item"><!----> <a href="/clickhouse/1/" class="nav-link">ClickHouse</a></li><li class="dropdown-item"><!----> <a href="/hbase/1/" class="nav-link">Hbase</a></li><li class="dropdown-item"><!----> <a href="/hive/1/" class="nav-link">Hive</a></li><li class="dropdown-item"><!----> <a href="/flink/1/" class="nav-link">Flink</a></li><li class="dropdown-item"><!----> <a href="/flume/1/" class="nav-link">Flume</a></li><li class="dropdown-item"><!----> <a href="/sqlite/1/" class="nav-link">SQLite</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/2300/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/docker/400/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/jenkins/500/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/600/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/1/" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/front/1/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/ai/1/" class="nav-link">AI</a></li></ul></div></div> <a href="https://github.com/landashu?tab=repositories" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>spring</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/spring/200/" class="sidebar-link">核心内容拆解 IOC</a></li><li><a href="/frame/spring/201/" class="sidebar-link">核心内容拆解 AOP</a></li><li><a href="/frame/spring/202/" class="sidebar-link">核心内容拆解 事件通知</a></li><li><a href="/frame/spring/203/" class="sidebar-link">核心内容拆解 三级缓存</a></li><li><a href="/frame/spring/204/" class="sidebar-link">核心内容拆解 FactoryBean</a></li><li><a href="/frame/spring/205/" class="sidebar-link">注解替代Spring生命周期实现类</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>spring mv</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/spring-mvc/200/" class="sidebar-link">Spring MVC 之基本工作原理</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>spring boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/spring-boot/200/" class="sidebar-link">SpringBoot 之 Filter、Interceptor、Aspect</a></li><li><a href="/frame/spring-boot/201/" class="sidebar-link">SpringBoot 之 Starter</a></li><li><a href="/frame/spring-boot/202/" class="sidebar-link">SpringBoot 之 Stomp 使用和 vue 相配置</a></li><li><a href="/frame/spring-boot/203/" class="sidebar-link">SpringBoot MyBatisPlus 实现多数据源</a></li><li><a href="/frame/spring-boot/204/" class="sidebar-link">SpringBoot MyBatis 动态建表</a></li><li><a href="/frame/spring-boot/205/" class="sidebar-link">Spring Boot 集成 Jasypt 3.0.3 配置文件加密</a></li><li><a href="/frame/spring-boot/206/" class="sidebar-link">Spring Boot 集成 FastDFS</a></li><li><a href="/frame/spring-boot/207/" class="sidebar-link">Spring Boot VUE前后端加解密</a></li><li><a href="/frame/spring-boot/1/" class="sidebar-link">Spring Boot logback.xml 配置</a></li><li><a href="/frame/spring-boot/2/" class="sidebar-link">Spring Boot MinIO</a></li><li><a href="/frame/spring-boot/3/" class="sidebar-link">Spring Boot kafka</a></li><li><a href="/frame/spring-boot/4/" class="sidebar-link">Spring Boot WebSocket</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>spring cloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/spring-cloud/1/" class="sidebar-link">SpringCloud - Ribbon和Feign</a></li><li><a href="/frame/spring-cloud/2/" class="sidebar-link">SpringCloud alibaba - Nacos</a></li><li><a href="/frame/spring-cloud/3/" class="sidebar-link">SpringCloud alibaba - Sentinel哨兵</a></li><li><a href="/frame/spring-cloud/4/" class="sidebar-link">SpringCloud alibaba - Gateway</a></li><li><a href="/frame/spring-cloud/5/" class="sidebar-link">SpringCloud alibaba - 链路跟踪</a></li><li><a href="/frame/spring-cloud/6/" aria-current="page" class="active sidebar-link">SpringCloud - 分布式事务一（XA，2PC，3PC）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/frame/spring-cloud/6/#数据库事务的概念" class="sidebar-link">数据库事务的概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#事务的基本概念" class="sidebar-link">事务的基本概念：</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#事务的基本特性" class="sidebar-link">事务的基本特性：</a></li><li class="sidebar-sub-header level4"><a href="/frame/spring-cloud/6/#atomicity-原子性" class="sidebar-link">Atomicity（原子性）:</a></li><li class="sidebar-sub-header level4"><a href="/frame/spring-cloud/6/#consistency-一致性" class="sidebar-link">Consistency（一致性）：</a></li><li class="sidebar-sub-header level4"><a href="/frame/spring-cloud/6/#isolation-隔离性" class="sidebar-link">Isolation（隔离性）：</a></li><li class="sidebar-sub-header level4"><a href="/frame/spring-cloud/6/#durablity-持久性" class="sidebar-link">Durablity（持久性）：</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#事务的隔离级别" class="sidebar-link">事务的隔离级别</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/frame/spring-cloud/6/#什么是分布式事务" class="sidebar-link">什么是分布式事务</a></li><li class="sidebar-sub-header level2"><a href="/frame/spring-cloud/6/#两阶段提交-2pc" class="sidebar-link">两阶段提交（2PC）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第一阶段-请求-表决阶段" class="sidebar-link">第一阶段：请求/表决阶段</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第二阶段-提交-执行阶段-正常流程" class="sidebar-link">第二阶段：提交/执行阶段（正常流程）</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第二阶段-提交-执行阶段-异常流程" class="sidebar-link">第二阶段：提交/执行阶段（异常流程）</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#以下几点是xa-两阶段提交协议中会遇到的一些问题" class="sidebar-link">以下几点是XA-两阶段提交协议中会遇到的一些问题：</a></li><li class="sidebar-sub-header level6"><a href="/frame/spring-cloud/6/#性能问题" class="sidebar-link">性能问题</a></li><li class="sidebar-sub-header level6"><a href="/frame/spring-cloud/6/#协调者单点故障问题" class="sidebar-link">协调者单点故障问题</a></li><li class="sidebar-sub-header level6"><a href="/frame/spring-cloud/6/#丢失消息导致的数据不一致问题" class="sidebar-link">丢失消息导致的数据不一致问题</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/frame/spring-cloud/6/#三阶段提交-3pc" class="sidebar-link">三阶段提交（3PC）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第一阶段-cancommit阶段" class="sidebar-link">第一阶段：CanCommit阶段</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第二阶段-precommit阶段" class="sidebar-link">第二阶段：PreCommit阶段</a></li><li class="sidebar-sub-header level3"><a href="/frame/spring-cloud/6/#第三阶段-docommit阶段" class="sidebar-link">第三阶段：DoCommit阶段</a></li></ul></li></ul></li><li><a href="/frame/spring-cloud/7/" class="sidebar-link">SpringCloud - 分布式事务二（Seata-AT，TCC，Saga）</a></li><li><a href="/frame/spring-cloud/8/" class="sidebar-link">SpringCloud - 分布式事务三（Seata搭建）</a></li><li><a href="/frame/spring-cloud/9/" class="sidebar-link">SpringCloud - 分布式事务四（多数据源事务）</a></li><li><a href="/frame/spring-cloud/10/" class="sidebar-link">SpringCloud - 分布式事务五（微服务间调用的事务处理）</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Mybatis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/mybatis/300/" class="sidebar-link">核心功能拆解 工作流程</a></li><li><a href="/frame/mybatis/301/" class="sidebar-link">核心功能拆解 Plugin插件功能实现</a></li><li><a href="/frame/mybatis/302/" class="sidebar-link">核心功能拆解 一二级缓存原理</a></li><li><a href="/frame/mybatis/303/" class="sidebar-link">MyBatis Plus+Spring Boot 实现一二级缓存以及自定义缓存</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>maven</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/maven/2300/" class="sidebar-link">pom 文件介绍及 parent、properties 标签详解</a></li><li><a href="/frame/maven/2301/" class="sidebar-link">dependencies 标签详解</a></li><li><a href="/frame/maven/2302/" class="sidebar-link">使用 Nexus3.x 搭建私服</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/git/1/" class="sidebar-link">私有 git 仓库搭建</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="placeholder"></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">SpringCloud - 分布式事务一（XA，2PC，3PC）<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="数据库事务的概念"><a href="#数据库事务的概念" class="header-anchor">#</a> 数据库事务的概念</h2> <p>在讲述分布式事务的概念之前，我们先来回顾下事务相关的一些概念。</p> <h3 id="事务的基本概念"><a href="#事务的基本概念" class="header-anchor">#</a> 事务的基本概念：</h3> <p>就是一个程序执行单元，里面的操作要么全部执行成功，要么全部执行失败，不允许只成功一半另外一半执行失败的事情发生。例如一段事务代码做了两次数据库更新操作，那么这两次数据库操作要么全部执行成功，要么全部回滚。</p> <h3 id="事务的基本特性"><a href="#事务的基本特性" class="header-anchor">#</a> 事务的基本特性：</h3> <p>我们知道事务有 4 个非常重要的特性，即我们常说的（ACID）。</p> <h4 id="atomicity-原子性"><a href="#atomicity-原子性" class="header-anchor">#</a> Atomicity（原子性）:</h4> <p>是说事务是一个不可分割的整体，所有操作要么全做，要么全不做；只要事务中有一个操作出错，回滚到事务开始前的状态的话，那么之前已经执行的所有操作都是无效的，都应该回滚到开始前的状态。</p> <h4 id="consistency-一致性"><a href="#consistency-一致性" class="header-anchor">#</a> Consistency（一致性）：</h4> <p>是说事务执行前后，数据从一个状态到另一个状态必须是一致的，比如 A 向 B 转账（ A、B 的总金额就是一个一致性状态），不可能出现 A 扣了钱，B 却没收到的情况发生。</p> <h4 id="isolation-隔离性"><a href="#isolation-隔离性" class="header-anchor">#</a> Isolation（隔离性）：</h4> <p>多个并发事务之间相互隔离，不能互相干扰。关于事务的隔离性，可能不是特别好理解，这里的并发事务是指两个事务操作了同一份数据的情况；而对于并发事务操作同一份数据的隔离性问题，则是要求不能出现脏读、幻读的情况，即事务 A 不能读取事务 B 还没有提交的数据，或者在事务 A 读取数据进行更新操作时，不允许事务 B 率先更新掉这条数据。而为了解决这个问题，常用的手段就是加锁了，对于数据库来说就是通过数据库的相关锁机制来保证。</p> <h4 id="durablity-持久性"><a href="#durablity-持久性" class="header-anchor">#</a> Durablity（持久性）：</h4> <p>事务完成后，对数据库的更改是永久保存的，不能回滚。</p> <h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="header-anchor">#</a> 事务的隔离级别</h3> <p>在 MySQL 中，事务有四种隔离级别：</p> <ul><li>Read Uncommitted：读未提交（不能解决任何并发问题），一个事务可以读取另一个未提交事务的数据。会出现脏读、幻读、不可重复读问题</li> <li>Read Committed：读已提交（解决脏读问题），一个事务只能读取另一个已提交的事务中的数据。会出现幻读、不可重复读问题</li> <li>Repeatable Read：可重复读（解决脏读、不可重复读问题），在事务中锁定所读取的数据，使得其他并发的事务不能修改这些数据。但会出现幻读</li> <li>Serializable：串行化（可以避免脏读、不可重复读与幻读），是最高的事务隔离级别，但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。</li></ul> <p>脏读：A，B 两个事务，A 开启事务修改数据，B 也开启一个事务刚好查询能看到 A 改的数据并使用，但是 A 还没有改完，发现错误并回滚了，此时 B 就是脏读。</p> <p>幻读：在一个事务中，前后两次相同的查询操作返回的结果集不一致，第二次查询发现了新插入或者已删除的行，导致出现了 “幻觉”，即似乎出现了新的行或者少了某些行。</p> <p>不可重复读：在事务中，某个查询操作在多次执行之间返回了不同的结果集，即两次相同的查询却得到了不同的结果。这种情况通常发生在一个事务中执行了两次读取操作之间有其他事务修改了数据的情况下。</p> <h2 id="什么是分布式事务"><a href="#什么是分布式事务" class="header-anchor">#</a> 什么是分布式事务</h2> <p>以上内容我们回顾了下事务的基本概念，那么分布式事务又是个什么概念呢？它与数据库事务之间又有什么区别呢？</p> <p>其实分布式事务从实质上看与数据库事务的概念是一致的，既然是事务也就需要满足事务的基本特性（ACID），只是分布式事务相对于本地事务而言其表现形式有很大的不同。举个例子，在一个 JVM 进程中如果需要同时操作数据库的多条记录，而这些操作需要在一个事务中，那么我们可以通过数据库提供的事务机制（一般是数据库锁）来实现。</p> <p>而随着这个 JVM 进程（应用）被拆分成了微服务架构，原本一个本地逻辑执行单元被拆分到了多个独立的微服务中，这些微服务又分别操作不同的数据库和表，服务之间通过网络调用。</p> <p>举个例子：服务 A 收到一笔购物下单请求后，需要调用服务 B 去支付，支付成功则处理购物订单为待发货状态，否则就需要将购物订单处理为失败状态。（如图所示）</p> <p><img src="/assets/img/spring/cloud/6/img.png" alt=""></p> <p>在上面这个例子中会不会出现服务 B 支付成功了，但是由于网络调用的问题没有通知到服务 A，导致用户付了钱，但是购物订单无法显示支付成功的状态呢？</p> <p>答案是 这种情况是普遍存在的，因为服务 B 在处理成功后需要向服务 A 发送网络请求，而这个过程是极有可能失败的。那么如何确保 “服务 A-&gt; 服务 B” 这个过程能够组成一个事务，要么全部成功、要么全部失败呢？而这就是典型的需要通过分布式事务解决的问题。</p> <p>分布式事务是为了解决微服务架构（形式都是分布式系统）中不同节点之间的数据一致性问题。这个一致性问题本质上解决的也是传统事务需要解决的问题，即一个请求在多个微服务调用链中，所有服务的数据处理要么全部成功，要么全部回滚。当然分布式事务问题的形式可能与传统事务会有比较大的差异，但是问题本质是一致的，都是要求解决数据的一致性问题。</p> <p>而分布式事务的实现方式有很多种，最具有代表性的是由 Oracle Tuxedo 系统提出的 XA 分布式事务协议。XA 协议包括两阶段提交（2PC）和三阶段提交（3PC）两种实现，接下来我们分别来介绍下这两种实现方式的原理。</p> <h2 id="两阶段提交-2pc"><a href="#两阶段提交-2pc" class="header-anchor">#</a> 两阶段提交（2PC）</h2> <p>两阶段提交又称 2PC（two-phase commit protocol）,2pc 是一个非常经典的强一致、中心化的原子提交协议。这里所说的中心化是指协议中有两类节点：一个是中心化协调者节点（coordinator）和 N 个参与者节点（partcipant）。</p> <p>下面我们就以一个尽量贴近实际业务场景的操作来举例：&quot;假设在一个分布式架构的系统中事务的发起者通过分布式事务协调者（如 RocketMQ，在早期 RocketMQ 版本不提供事务消息特性时，有些公司会自己研发一个基于 MQ 的可靠消息服务来实现一定的分布式事务的特性）分别向应用服务 A、应用服务 B 发起处理请求，二者在处理的过程中会分别操作自身服务的数据库，现在要求应用服务 A、应用服务 B 的数据处理操作要在一个事务里&quot;?</p> <p>在上面这个例子中如果采用两阶段提交来实现分布式事务，那么其运行原理应该是个什么样的呢？（如下）：</p> <h3 id="第一阶段-请求-表决阶段"><a href="#第一阶段-请求-表决阶段" class="header-anchor">#</a> 第一阶段：请求 / 表决阶段</h3> <p><img src="/assets/img/spring/cloud/6/img_1.png" alt=""></p> <p>既然称为两阶段提交，说明在这个过程中是大致存在两个阶段的处理流程。第一个阶段如上图所示，这个阶段被称之为请求 / 表决阶段。是个什么意思呢？</p> <p>就是在分布式事务的发起方在向分布式事务协调者（Coordinator）发送请求时，Coordinator 首先会分别向参与者（Partcipant）节点 A、参与这节点（Partcipant）节点 B 分别发送 事务预处理请求，称之为 Prepare，有些资料也叫 &quot;Vote Request&quot;。</p> <p>说的直白点就是问一下这些参与节点 &quot;这件事你们能不能处理成功了&quot;，此时这些参与者节点一般来说就会打开本地数据库事务，然后开始执行数据库本地事务，但在执行完成后并不会立马提交数据库本地事务，而是先向 Coordinator 报告说：“我这边可以处理了 / 我这边不能处理”。</p> <p>如果所有的参与这节点都向协调者做了 “Vote Commit” 的反馈的话，那么此时流程就会进入第二个阶段了。</p> <h3 id="第二阶段-提交-执行阶段-正常流程"><a href="#第二阶段-提交-执行阶段-正常流程" class="header-anchor">#</a> 第二阶段：提交 / 执行阶段（正常流程）</h3> <p><img src="/assets/img/spring/cloud/6/img_2.png" alt=""></p> <p>如果所有参与者节点都向协调者报告说 “我这边可以处理”，那么此时协调者就会向所有参与者节点发送 “全局提交确认通知（global_commit）”，即你们都可以进行本地事务提交了，此时参与者节点就会完成自身本地数据库事务的提交，并最终将提交结果回复 “ack” 消息给 Coordinator，然后 Coordinator 就会向调用方返回分布式事务处理完成的结果。</p> <h3 id="第二阶段-提交-执行阶段-异常流程"><a href="#第二阶段-提交-执行阶段-异常流程" class="header-anchor">#</a> 第二阶段：提交 / 执行阶段（异常流程）</h3> <p><img src="/assets/img/spring/cloud/6/img_3.png" alt=""></p> <p>相反，在第二阶段除了所有的参与者节点都反馈 “我这边可以处理了” 的情况外，也会有节点反馈说 “我这边不能处理” 的情况发生，此时参与者节点就会向协调者节点反馈 “Vote_Abort” 的消息。此时分布式事务协调者节点就会向所有的参与者节点发起事务回滚的消息（“global_rollback”），此时各个参与者节点就会回滚本地事务，释放资源，并且向协调者节点发送 “ack” 确认消息，协调者节点就会向调用方返回分布式事务处理失败的结果。</p> <p>以上就是两阶段提交的基本过程了，那么按照这个两阶段提交协议，分布式系统的数据一致性问题就能得到满足吗？</p> <p>实际上分布式事务是一件非常复杂的事情，两阶段提交只是通过增加了事务协调者（Coordinator）的角色来通过 2 个阶段的处理流程来解决分布式系统中一个事务需要跨多个服务节点的数据一致性问题。但是从异常情况上考虑，这个流程也并不是那么的无懈可击。</p> <p>假设如果在第二个阶段中 Coordinator 在接收到 Partcipant 的 &quot;Vote_Request&quot; 后挂掉了或者网络出现了异常，那么此时 Partcipant 节点就会一直处于本地事务挂起的状态，从而长时间地占用资源。当然这种情况只会出现在极端情况下，然而作为一套健壮的软件系统而言，异常 Case 的处理才是真正考验方案正确性的地方。</p> <h3 id="以下几点是xa-两阶段提交协议中会遇到的一些问题"><a href="#以下几点是xa-两阶段提交协议中会遇到的一些问题" class="header-anchor">#</a> 以下几点是 XA - 两阶段提交协议中会遇到的一些问题：</h3> <ul><li><h6 id="性能问题"><a href="#性能问题" class="header-anchor">#</a> 性能问题</h6></li></ul> <p>从流程上我们可以看得出，其最大缺点就在于它的执行过程中间，节点都处于阻塞状态。各个操作数据库的节点此时都占用着数据库资源，只有当所有节点准备完毕，事务协调者才会通知进行全局提交，参与者进行本地事务提交后才会释放资源。这样的过程会比较漫长，对性能影响比较大。</p> <ul><li><h6 id="协调者单点故障问题"><a href="#协调者单点故障问题" class="header-anchor">#</a> 协调者单点故障问题</h6></li></ul> <p>事务协调者是整个 XA 模型的核心，一旦事务协调者节点挂掉，会导致参与者收不到提交或回滚的通知，从而导致参与者节点始终处于事务无法完成的中间状态。</p> <ul><li><h6 id="丢失消息导致的数据不一致问题"><a href="#丢失消息导致的数据不一致问题" class="header-anchor">#</a> 丢失消息导致的数据不一致问题</h6></li></ul> <p>在第二个阶段，如果发生局部网络问题，一部分事务参与者收到了提交消息，另一部分事务参与者没收到提交消息，那么就会导致节点间数据的不一致问题。</p> <p>既然两阶段提交有以上问题，那么有没有其他的方案来解决呢？</p> <h2 id="三阶段提交-3pc"><a href="#三阶段提交-3pc" class="header-anchor">#</a> 三阶段提交（3PC）</h2> <p>三阶段提交又称 3PC，其在两阶段提交的基础上增加了 CanCommit 阶段，并引入了 超时机制。一旦事务参与者迟迟没有收到协调者的 Commit 请求，就会自动进行本地 commit，这样相对有效地解决了协调者单点故障的问题。</p> <p>但是性能问题和不一致问题仍然没有根本解决。下面我们还是一起看下三阶段流程的是什么样的？</p> <h3 id="第一阶段-cancommit阶段"><a href="#第一阶段-cancommit阶段" class="header-anchor">#</a> 第一阶段：CanCommit 阶段</h3> <p><img src="/assets/img/spring/cloud/6/img_4.png" alt=""></p> <p>这个阶段类似于 2PC 中的第二个阶段中的 Ready 阶段，是一种事务询问操作，事务的协调者向所有参与者询问 “你们是否可以完成本次事务？”，如果参与者节点认为自身可以完成事务就返回 “YES”，否则 “NO”。而在实际的场景中参与者节点会对自身逻辑进行事务尝试，其实说白了就是检查下自身状态的健康性，看有没有能力进行事务操作。</p> <h3 id="第二阶段-precommit阶段"><a href="#第二阶段-precommit阶段" class="header-anchor">#</a> 第二阶段：PreCommit 阶段</h3> <p><img src="/assets/img/spring/cloud/6/img_5.png" alt=""></p> <p>在阶段一中，如果所有的参与者都返回 Yes 的话，那么就会进入 PreCommit 阶段进行事务预提交。此时分布式事务协调者会向所有的参与者节点发送 PreCommit 请求，参与者收到后开始执行事务操作，并将 Undo 和 Redo 信息记录到事务日志中。参与者执行完事务操作后（此时属于未提交事务的状态），就会向协调者反馈 “Ack” 表示我已经准备好提交了，并等待协调者的下一步指令。</p> <p>如果阶段一中有任何一个参与者节点返回的结果是 No 响应，或者协调者在等待参与者节点反馈的过程中因挂掉而超时（2PC 中只有协调者可以超时，参与者没有超时机制）。整个分布式事务就会中断，协调者就会向所有的参与者发送 “abort” 请求。</p> <h3 id="第三阶段-docommit阶段"><a href="#第三阶段-docommit阶段" class="header-anchor">#</a> 第三阶段：DoCommit 阶段</h3> <p><img src="/assets/img/spring/cloud/6/img_6.png" alt=""></p> <p>在阶段二中如果所有的参与者节点都可以进行 PreCommit 提交，那么协调者就会从 “预提交状态” 转变为 “提交状态”。然后向所有的参与者节点发送 &quot;doCommit&quot; 请求，参与者节点在收到提交请求后就会各自执行事务提交操作，并向协调者节点反馈 “Ack” 消息，协调者收到所有参与者的 Ack 消息后完成事务。</p> <p>看到这里，你是不是会疑惑 &quot;3PC 相对于 2PC 而言到底优化了什么地方呢？&quot;</p> <p>相比较 2PC 而言，3PC 对于协调者（Coordinator）和参与者（Partcipant）都设置了超时时间，而 2PC 只有协调者才拥有超时机制。这解决了一个什么问题呢？这个优化点，主要是避免了参与者在长时间无法与协调者节点通讯（协调者挂掉了）的情况下，无法释放资源的问题，因为参与者自身拥有超时机制会在超时后，自动进行本地 commit 从而进行释放资源。而这种机制也侧面降低了整个事务的阻塞时间和范围。</p> <p>另外，通过 CanCommit、PreCommit、DoCommit 三个阶段的设计，相较于 2PC 而言，多设置了一个缓冲阶段保证了在最后提交阶段之前各参与节点的状态是一致的。</p> <p>以上就是 3PC 相对于 2PC 的一个提高（相对缓解了 2PC 中的前两个问题），但是 3PC 依然没有完全解决数据不一致的问题。假如在 DoCommit 过程，参与者 A 无法接收协调者的通信，那么参与者 A 会自动提交，但是提交失败了，其他参与者成功了，此时数据就会不一致。</p> <p><a href="https://www.cnblogs.com/wudimanong/p/10340948.html" target="_blank" rel="noopener noreferrer">本文来源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/28/2025, 10:05:36 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/frame/spring-cloud/5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SpringCloud alibaba - 链路跟踪</div></a> <a href="/frame/spring-cloud/7/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">SpringCloud - 分布式事务二（Seata-AT，TCC，Saga）</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/frame/spring-cloud/5/" class="prev">SpringCloud alibaba - 链路跟踪</a></span> <span class="next"><a href="/frame/spring-cloud/7/">SpringCloud - 分布式事务二（Seata-AT，TCC，Saga）</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://gitee.com/dashboard" title="gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://github.com/landashu?tab=repositories" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2025
    <span>
<!--      <a href='https://doc.xugaoyi.com/' target='_blank'>Theme by Vdoing</a> | <a href='http://doc.aizuda.com/' rel='external nofollow' target='_blank'>Copyright © 2022-2023 AiZuDa</a>-->
<!--      <br>-->
<!--      <a href="http://beian.miit.gov.cn/" target="_blank">鲁ICP备2021041554号-1</a>-->
    </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7e941bd4.js" defer></script><script src="/assets/js/11.5871899e.js" defer></script><script src="/assets/js/54.7831fd46.js" defer></script>
  </body>
</html>
