(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{617:function(s,a,t){"use strict";t.r(a);var n=t(41),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("本文及后续所有文章都以 1.12 做为版本讲解和入门学习")])]),s._v(" "),t("h2",{attrs:{id:"概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[s._v("#")]),s._v(" 概要")]),s._v(" "),t("p",[s._v("Flink 是一个可以帮助我们做实时计算的框架。实时计算分为两种，一种是 Stream，即可以一条一条处理；一种是 batch，即批处理，待数据存储到一定数量再处理。")]),s._v(" "),t("p",[s._v("Flink 提供了很好的故障恢复能力，当我们的一个流处理程序故障后，一个新的流程服务会自动启动并替代它继续执行。我们并不需要担心故障机当时的状态，因为 Flink 已经帮我们做了记录 (checkPoint)。")]),s._v(" "),t("p",[s._v("Flink 支持 (exactly-once) 一次而且仅一次地接收数据，保证收到数据而且不重复收到数据。支持 (EventTime) 把事件实际产生的时间做为处理数据的时间，除了 EventTime 还要 Ingestion Time (数据进入 Flink 时间)、Processing Time (flink 真正处理数据的时间)。支持有状态的计算。")]),s._v(" "),t("p",[s._v("Flink 的 window 可以将无限数据流切割为有限数据流，主要分为两类：TimeWingdow (又可分为 Tumbling Window 滚动出窗口、Sliding Window 滑动窗口) 和 CountWindow。")]),s._v(" "),t("p",[s._v("Flink 的 Watermark (水位线) 用于处理乱序事件，类似于一个延迟触发机制")]),s._v(" "),t("p",[s._v("Flink 组件分为 jobManager (工作管理) 和 TaskManager (任务管理)，听起来好像没什么不同，但程序真正运行在 TaskManager，JobManager 负责整个 Flink 集群任务的调度以及资源的管理。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flink/1/img.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.bfsu.edu.cn/apache/flink/flink-1.12.2/flink-1.12.2-bin-scala_2.11.tgz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf flink-1.12.0-bin-scala_2.11.tgz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" flink-1.12.0-bin-scala_2.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost flink-1.12.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./bin/start-cluster.sh ")]),s._v("\nStarting cluster.\nStarting standalonesession daemon on "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" localhost.localdomain.\nStarting taskexecutor daemon on "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" localhost.localdomain.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("测试用例")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行一个测试程序")]),s._v("\n./bin/flink run examples/streaming/WordCount.jar\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看测试结果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" log/flink-*-taskexecutor-*.out\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("停止运行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/stop-cluster.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("Flink 默认提供了 webUI，端口为 8081，可以直接在浏览器中访问")])]),s._v(" "),t("h2",{attrs:{id:"单机搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单机搭建"}},[s._v("#")]),s._v(" 单机搭建")]),s._v(" "),t("h3",{attrs:{id:"环境信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境信息"}},[s._v("#")]),s._v(" 环境信息")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("IP")]),s._v(" "),t("th",[s._v("模式")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("xx.xxx.xx.103")]),s._v(" "),t("td",[s._v("master")])]),s._v(" "),t("tr",[t("td",[s._v("xx.xxx.xx.104")]),s._v(" "),t("td",[s._v("slave")])])])]),s._v(" "),t("h3",{attrs:{id:"ssh免密登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh免密登录"}},[s._v("#")]),s._v(" ssh 免密登录")]),s._v(" "),t("p",[s._v("在集群的启动的时候 flink 会要求认证对方的登录密码，设置 ssh 免密登录可以为我们快速启动。")]),s._v(" "),t("h4",{attrs:{id:"_1-为各服务器生成密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-为各服务器生成密钥"}},[s._v("#")]),s._v(" 1. 为各服务器生成密钥")]),s._v(" "),t("p",[s._v("一路 enter 即可")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rea是一种加密规则")]),s._v("\nssh-keygen -t rsa\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("查看密钥")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ~/.ssh/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost .ssh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n-rw-------. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1679")]),s._v(" Apr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":46 id_rsa\n-rw-r--r--. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" Apr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":46 id_rsa.pub\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("id_rsa : 生成的私钥文件"),t("br"),s._v("\n id_rsa.pub ： 生成的公钥文")]),s._v(" "),t("h4",{attrs:{id:"_2-服务器之间交换密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器之间交换密钥"}},[s._v("#")]),s._v(" 2. 服务器之间交换密钥")]),s._v(" "),t("p",[s._v("生成的密钥两边文件名字一样，所以交换的时候需要更换文件名称，以防覆盖。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这种方式后可以直接测试连接 103 或 104")]),s._v("\nssh-copy-id xx.xxx.xx.103\nssh-copy-id xx.xxx.xx.104\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这种方式需要完整的执行以下步骤")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" id_rsa.pub root@xx.xxx.xx.103:/root/.ssh/104.id_rsa.pub\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" id_rsa.pub root@xx.xxx.xx.104:/root/.ssh/103.id_rsa.pub\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"_3-创建文件并赋权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建文件并赋权"}},[s._v("#")]),s._v(" 3. 创建文件并赋权")]),s._v(" "),t("p",[s._v("在各服务机的～/.ssh 目录下创建一个文件 authorized_keys")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("把 xxx.id_rsa.pub 内容追加到 authorized_keys 文件末尾（追加后可以把文件 xxx.id_rsa.pub 删除）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v(".id_rsa.pub "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v(".id_rsa.pub "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("把本机生成的公钥也得 "),t("strong",[s._v("追加到")]),s._v(" authorized_keys 文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_rsa.pub "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("赋权")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" authorized_keys \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" -R .ssh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("测试 连接")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@xx.xxx.xx.103\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"workermanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workermanager"}},[s._v("#")]),s._v(" workermanager")]),s._v(" "),t("p",[s._v("一个 Flink 应用会携带 JobManager 和 TaskManager 两个组件，我们可以部署两个 Flink 应用实现以下简单的 TaskManager 的集群模式，FlinkA 可以启动 Job 和 Task 两个组件，FlinkB 启动 Task 组件。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flink/1/img_1.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("启动前每台服务器最好把 Hostname 改掉，并修改 hosts。这里还有一点需要注意，两台的 flink 配置都需要改掉，否则你会看到 Task 只有那台启动 job 的才有连接上。")])]),s._v(" "),t("h4",{attrs:{id:"_103、104-操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_103、104-操作"}},[s._v("#")]),s._v(" 103、104 操作")]),s._v(" "),t("ol",[t("li",[s._v("修改 jobmanager 工作地点")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" flink-conf.yaml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入如下")]),s._v("\njobmanager.rpc.address: xx.xxx.xx.103\njobmanager.rpc.port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6123")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("修改 workers 文件，指定 workermanager 工作地点")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" workers\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入如下")]),s._v("\nxx.xxx.xx.103\nxx.xxx.xx.104\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("启动 xx.xxx.xx.103 flink 节点")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node103 bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./start-cluster.sh ")]),s._v("\nStarting cluster.\nStarting standalonesession daemon on "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" node103.\nStarting taskexecutor daemon on "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" node103.\nStarting taskexecutor daemon on "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" node104.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("访问 http://xx.xxx.xx.103:8081/#/overview")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flink/1/img_2.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("建议修改一下属性值："),t("br"),s._v("\n每个 JobManager 的可用内存值（ "),t("code",[s._v("jobmanager.memory.process.size")]),s._v(" ）"),t("br"),s._v("\n每个 TaskManager 的可用内存值 （ "),t("code",[s._v("taskmanager.memory.process.size")]),s._v(" ，并检查 "),t("a",{attrs:{href:"https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/deployment/memory/mem_tuning.html#configure-memory-for-standalone-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("内存调优指南"),t("OutboundLink")],1),s._v("）"),t("br"),s._v("\n每台机器的可用 CPU 数（ "),t("code",[s._v("taskmanager.numberOfTaskSlots")]),s._v(" ）"),t("br"),s._v("\n集群中所有 CPU 数（ "),t("code",[s._v("parallelism.default")]),s._v(" ）和 临时目录（ "),t("code",[s._v("io.tmp.dirs")]),s._v(" ）")])]),s._v(" "),t("p",[s._v("命令运行 jar，可以到 flink/bin 目录下，执行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./flink run -c com.example.demo.SocketStreamWordCount -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" /opt/software/flink-1.12.2/examples/xxxxxx.jar --host "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".xxx.xx.103 --port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7777")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("-c 是程序的主入口")]),s._v(" "),t("li",[s._v("-p 是并行度")]),s._v(" "),t("li",[s._v("--host --port 是 args 参数")])]),s._v(" "),t("p",[s._v("查看当前运行的所有 jobs，-a 可以查看被取消运行的 job")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./flink list "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("取消 JobID 的运行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./flink cancel JobID\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"jobmanager-高可用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jobmanager-高可用"}},[s._v("#")]),s._v(" jobManager 高可用")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flink/1/img_3.png",alt:""}})]),s._v(" "),t("ol",[t("li",[s._v("在 flink-1.12.2/conf 下的 flink-conf.yaml 中添加 zookeeper 配置")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 配置jobmanager rpc 地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("jobmanager.rpc.address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("xx.xxx.xx.103")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 修改taskmanager内存大小，可改可不改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("taskmanager.memory.process.size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("2048m")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 修改一个taskmanager中对于的taskslot个数，可改可不改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("taskmanager.numberOfTaskSlots")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 修改并行度，可改可不改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("parallelism.default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("4")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 配置状态后端存储方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("state.backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("filesystem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6. 配置启用检查点，可以将快照保存到HDFS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("state.backend.fs.checkpointdir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://192.168.244.129:9000/flink-checkpoints")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 7. 配置保存点，可以将快照保存到HDFS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("state.savepoints.dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://192.168.244.129:9000/flink-savepoints")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 8. 使用zookeeper搭建高可用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("high-availability")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("zookeeper")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 9. 配置ZK集群地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("high-availability.zookeeper.quorum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("xx.xxx.xx.103:2181")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10. 存储JobManager的元数据到HDFS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("high-availability.storageDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://xx.xxx.xx.103:9000/flink/ha/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 11. 配置zookeeper client默认是 open，如果 zookeeper security 启用了更改成 creator")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("high-availability.zookeeper.client.acl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("open")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("将配置过的 HA 的 flink-conf.yaml 分发到另外节点")]),s._v(" "),t("li",[s._v("分别到另外两个节点中修改 flink-conf.yaml 中的配置")]),s._v(" "),t("li",[s._v("在 masters 配置文件中添加多个节点")]),s._v(" "),t("li",[s._v("分发 masters 配置文件到另外两个节点")]),s._v(" "),t("li",[s._v("配置每个 flink 下的 zoo.cfg 文件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建snapshot存放的目录，在flink-1.12.2目录下建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" tmp\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" tmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" zookeeper\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改conf下zoo.cfg配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" zoo.cfg\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#snapshot存放的目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dataDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/software/flink-1.12.2/tmp/zookeeper\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置zookeeper 地址")]),s._v("\nserver.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xx.xxx.xx.103:2888:3888\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ol",{attrs:{start:"7"}},[t("li",[s._v("下载 hadoop 依赖包，每个 flink 节点都需要")])]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("下载地址：https://flink.apache.org/downloads.html#additional-components\n将包复制到flink-1.13.2/lib目录下\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"8"}},[t("li",[s._v("启动 flink 集群")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./start-cluster.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"yarn模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn模式"}},[s._v("#")]),s._v(" Yarn 模式")]),s._v(" "),t("p",[s._v("以 Yarn 模式部署 Flink 任务时，要求 Flink 是有 Hadoop 支持的版本，Hadoop 环境需要保证版本在 2.2 以上，并且集中安装有 HDFS 服务以及配置了相关 flink、hadoop 的环境变量。yarn 部署有两种方式，如下图介绍：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flink/1/img_4.png",alt:""}})]),s._v(" "),t("p",[s._v("实际工作过程中推荐第二种方式进行部署，比较方便管理。")]),s._v(" "),t("h3",{attrs:{id:"方式一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式一"}},[s._v("#")]),s._v(" 方式一")]),s._v(" "),t("ol",[t("li",[s._v("检查 hadoop 环境变量是否配置 HADOOP_CLASSPATH")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HADOOP_CLASSPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("HADOOP_HOME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/bin/hadoop classpath"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("启动 flink/bin/yarn-session.sh")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/yarn-session.sh -jm 1024m -tm 1024m -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("jm jonmanager 的内存")]),s._v(" "),t("li",[s._v("tm 每个 taskmanager 的内存")]),s._v(" "),t("li",[s._v("d 后台运行")]),s._v(" "),t("li",[s._v("额外参数 -D <arg> 动态属性")]),s._v(" "),t("li",[s._v("额外参数 -j,--jar <arg> 指定 Flink 任务依赖的 jar 包")]),s._v(" "),t("li",[s._v("额外参数 -nm,--name  在 yarn 上为一个自定义的应用设置一个名字")]),s._v(" "),t("li",[s._v("额外参数 -q,--query 显示 yarn 中可用的资源 (内存，cpu 核数)")]),s._v(" "),t("li",[s._v("额外参数 -qu,--queue <arg> 指定 yarn 队列")]),s._v(" "),t("li",[s._v("额外参数 -s,--slots <arg> 每个 taskManager 使用的 slots 数量")])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("停止集群")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" application -kill "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yarn的flink "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"方式二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式二"}},[s._v("#")]),s._v(" 方式二")]),s._v(" "),t("p",[s._v("直接在 flink/bin 下运行命令即可，运行完成后会在 yarn 集群中创建一个临时的 flink 集群，当任务结束后对应的临时集群结束。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flink run -m yarn-cluster -yjm "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" -ytm "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" ./要运行任务的jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("-m,--jobmanager "),t("a",{attrs:{href:"host:port"}},[s._v("host:port")]),s._v(" 动态指定 jobmanager (主节点) 地址")]),s._v(" "),t("li",[s._v("-c,--class <classname> 动态指定 jar 包入口")]),s._v(" "),t("li",[s._v("-p,--parallelism <parallelism> 动态指定程序的并行度，可以覆盖配置文件中的默认值")])]),s._v(" "),t("blockquote",[t("p",[s._v("bin/flink run ./examples/batch/WordCount.jar 会从本机 /tmp.yarn-properties-root 中的节点中找到 applicationId 来找到对应的那个 Flink 集群，提交到对应的 Flink 集群中")])]),s._v(" "),t("blockquote",[t("p",[s._v("bin/flink run -m hostname:port ./examples/batch/WordCount.jar 通过 - m 来指定 Flink 集群里面主节点的主机名，端口号，就是指定 jobmanager 的 host 和 port，表示你已知一个 Flink 集群了，提交到这个集群中")])]),s._v(" "),t("blockquote",[t("p",[s._v("bin/flink run -m yarn-cluster -yn 2 ./examples/batch/WordCount.jar 表示在 yarn 集群里面去创建一个临时的 Flink 集群，并且把这个任务提交到临时的 Flink 集群中执行。")])]),s._v(" "),t("h3",{attrs:{id:"flink-yarn-的好处"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flink-yarn-的好处"}},[s._v("#")]),s._v(" flink-yarn 的好处")]),s._v(" "),t("ol",[t("li",[s._v("提高大数据集群中机器的利用率")]),s._v(" "),t("li",[s._v("一套集群，可以执行 MR 任务，Spark 任务，Flink 任务等")])])])}),[],!1,null,null,null);a.default=e.exports}}]);