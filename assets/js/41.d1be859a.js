(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{518:function(s,n,a){"use strict";a.r(n);var t=a(41),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"内置触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置触发器"}},[s._v("#")]),s._v(" 内置触发器")]),s._v(" "),a("p",[s._v("Jenkins 内置 4 种构建触发器：")]),s._v(" "),a("ul",[a("li",[s._v("触发远程构建，通过一个远程地址触发项目的执行")]),s._v(" "),a("li",[s._v("其他工程构建后触发（Build after other projects are build），就是需要前面一个项目构建完成后触发我的项目构建")]),s._v(" "),a("li",[s._v("定时构建（Build periodically），顾名思义就是 类似于 corn 表达式，定时执行")]),s._v(" "),a("li",[s._v("轮询 SCM（Poll SCM），会定时扫描本地代码仓库是否有变更，如果代码有变更就触发项目构建")])]),s._v(" "),a("h3",{attrs:{id:"远程构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#远程构建"}},[s._v("#")]),s._v(" 远程构建")]),s._v(" "),a("p",[s._v("在项目中的配置中，构建触发器选中远程构建。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img.png",alt:""}})]),s._v(" "),a("p",[s._v("通过浏览器访问 http://192.168.81.102:7777/job/test01/build?token=6666 进行项目构建")]),s._v(" "),a("h3",{attrs:{id:"其他工程构建后触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他工程构建后触发"}},[s._v("#")]),s._v(" 其他工程构建后触发")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_1.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_2.png",alt:""}})]),s._v(" "),a("p",[s._v("应用保存后，就可以构建 maven_project 了。")]),s._v(" "),a("h3",{attrs:{id:"定时构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时构建"}},[s._v("#")]),s._v(" 定时构建")]),s._v(" "),a("p",[s._v("定时字符串从左往右分别为： 分 时 日 月 周"),a("br"),s._v("\n一些定时表达式的例子：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("每30分钟构建一次：H代表形参(代表小时，测试用 *)\nH/30 * * * * 10:02 10:32\n每2个小时构建一次: \nH H/2 * * *\n每天的8点，12点，22点，一天构建3次： (多个时间点中间用逗号隔开) \n0 8,12,22 * * *\n每天中午12点定时构建一次 \nH 12 * * *\n每天下午18点定时构建一次 \nH 18 * * *\n在每个小时的前半个小时内的每10分钟 H(0-29)/10 * * * *\n每两小时一次，每个工作日上午9点到下午5点(也许是上午10:38，下午12:38，下午2:38，下午4:38) H H(9-16)/2 * * 1-5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_3.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"轮询scm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轮询scm"}},[s._v("#")]),s._v(" 轮询 SCM")]),s._v(" "),a("p",[s._v("该构建触发器，Jenkins 会定时扫描本地整个项目的代码，增大系统的开销，不建议使用。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_4.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"git-hook自动触发构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git-hook自动触发构建"}},[s._v("#")]),s._v(" Git hook 自动触发构建")]),s._v(" "),a("p",[s._v("在 Jenkins 的内置构建触发器中，轮询 SCM 可以实现 Gitlab 代码更新，项目自动构建，但是该方案的性能不佳。那有没有更好的方案呢？ 有的。就是利用 Gitlab 的 webhook 实现代码 push 到仓库，立即触发项目自动构建。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_5.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"安装gitlab-hook插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab-hook插件"}},[s._v("#")]),s._v(" 安装 Gitlab Hook 插件")]),s._v(" "),a("p",[s._v("需要安装两个插件：Gitlab Hook 和 GitLab，安装好后在项目配置的构建触发器中，会多一个选项")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_6.png",alt:""}})]),s._v(" "),a("p",[s._v("关于 Gitlab 之后的操作请百度，我这里使用的是 gitea。")]),s._v(" "),a("p",[s._v("gitea 需要下载 Generic Webhook Trigger 插件，安装后到项目配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_7.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_8.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_9.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_10.png",alt:""}})]),s._v(" "),a("p",[s._v("配置完成后就可以测试了，只要提交了代码就会构建项目。")]),s._v(" "),a("h2",{attrs:{id:"jenkins的参数化构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins的参数化构建"}},[s._v("#")]),s._v(" Jenkins 的参数化构建")]),s._v(" "),a("p",[s._v("有时在项目构建的过程中，我们需要根据用户的输入动态传入一些参数，从而影响整个构建结果，这时我们可以使用参数化构建。")]),s._v(" "),a("p",[s._v("Jenkins 支持非常丰富的参数类型")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_11.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"string-parameter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#string-parameter"}},[s._v("#")]),s._v(" String Parameter")]),s._v(" "),a("p",[s._v("这样的方式只能适用于 pipeline 项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_12.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_13.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_14.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_15.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_16.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_17.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_18.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_19.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_20.png",alt:""}})]),s._v(" "),a("p",[s._v("这种方式输入哪个分支，就构建哪个分支")]),s._v(" "),a("h2",{attrs:{id:"配置邮箱服务器发送构建结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置邮箱服务器发送构建结果"}},[s._v("#")]),s._v(" 配置邮箱服务器发送构建结果")]),s._v(" "),a("h3",{attrs:{id:"安装-email-extension-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-email-extension-插件"}},[s._v("#")]),s._v(" 安装 Email Extension 插件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_21.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_22.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_23.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_24.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_25.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_26.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_27.png",alt:""}})]),s._v(" "),a("p",[s._v("可以测试发送")]),s._v(" "),a("blockquote",[a("p",[s._v("如果 jenkins 报错： Can't send command to SMTP host; 有可能是管理员的邮箱没有填写或者和认证者的邮箱不相同。")])]),s._v(" "),a("h3",{attrs:{id:"准备邮件内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备邮件内容"}},[s._v("#")]),s._v(" 准备邮件内容")]),s._v(" "),a("p",[s._v("在项目根目录编写 email.html，并把文件推送 git")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志</title>\n</head>\n<body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n<table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n    <tr>\n        <td>(本邮件是程序自动下发的，请勿回复！)</td>\n    </tr>\n    <tr>\n        <td><h2>\n            <font color="#0000FF">构建结果 - ${BUILD_STATUS}</font>\n        </h2></td>\n    </tr>\n    <tr>\n        <td><br/>\n            <b><font color="#0B610B">构建信息</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>项目名称&nbsp;：&nbsp;${PROJECT_NAME}</li>\n                <li>构建编号&nbsp;：&nbsp;第${BUILD_NUMBER}次构建</li>\n                <li>触发原因：&nbsp;${CAUSE}</li>\n                <li>构建日志：&nbsp;\n                    <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                </li>\n                <li>构建&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                    <a href="${BUILD_URL}">${BUILD_URL}</a>\n                </li>\n                <li>工作目录&nbsp;：&nbsp;\n                    <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                </li>\n                <li>项目&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                    <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                </li>\n            </ul>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>历史变更记录 : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n            </ul>\n            ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n        </td>\n    </tr>\n    <tr>\n        <td><b>Failed Test Results</b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                $FAILED_TESTS\n            </pre>\n            <br/>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">构建日志 (最后 100行):</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <textarea cols="80" rows="30" readonly="readonly"\n                      style="font-family: Courier New">\n                ${BUILD_LOG,maxLines=100}\n            </textarea>\n        </td>\n    </tr>\n</table>\n</body>\n</html>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br")])]),a("p",[s._v("这里的参数都为 Jenkins 的参数，具体参数在 Jenkins 系统配置里可以看到，点击如下的问号就行。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_28.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_29.png",alt:""}})]),s._v(" "),a("p",[s._v("添加 post，post 意思是构建后操作，post 可以根据 stage 的结果执行不同的逻辑，比如 stages 里面都执行完成，他会走 post 里的 success 代码，如果失败会走 failure 代码。而 post 的语法该如何写，可以到 流水线语法 中看到。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_30.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("Always run, regardless of build status 无论构建的结果如何都会执行")]),s._v(" "),a("li",[s._v('Run if the build status is "Failure" 构建失败运行')]),s._v(" "),a("li",[s._v('Run if the build status is "Success" or hasnt been set yet 构建成功运行')])]),s._v(" "),a("p",[s._v("至于，邮件的内容，可以在片段生成器中查出来")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_31.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    post {\n        always {\n            emailext(\n                # 可以使用 jenkins 里面的参数\n                subject: '构建通知：${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!',\n                # 读取 email.html 文件\n                body: '${FILE,path=\"email.html\"}',\n                # 邮件的收件人\n                to: 'xxxxxx@qq.com'\n            )\n        }\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v('${FILE,path="PATH"} 可以在系统配置中了解')]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_32.png",alt:""}})]),s._v(" "),a("p",[s._v("然后去构建你的项目，就可以收到 构建项目的邮件了。")]),s._v(" "),a("h2",{attrs:{id:"jenkins-配置-sonarqube-代码审查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-配置-sonarqube-代码审查"}},[s._v("#")]),s._v(" jenkins 配置 SonarQube（代码审查）")]),s._v(" "),a("p",[s._v("SonarQube 是一个用于管理代码质量的开放平台，可以快速的定位代码中潜在的或者明显的错误。目前支持 java,C#,C/C++,Python,PL/SQL,Cobol,JavaScrip,Groovy 等二十几种编程语言的代码质量管理与检测。官网：https://www.sonarqube.org/")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("软件")]),s._v(" "),a("th",[s._v("版本")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("JDK")]),s._v(" "),a("td",[s._v("1.8")])]),s._v(" "),a("tr",[a("td",[s._v("mysql")]),s._v(" "),a("td",[s._v("8.0")])]),s._v(" "),a("tr",[a("td",[s._v("SonarQube")]),s._v(" "),a("td",[s._v("6.7.4")])])])]),s._v(" "),a("p",[s._v("下载 sonar 压缩包：https://www.sonarqube.org/downloads/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 解压 \nunzip sonarqube-6.7.4.zip\n# 创建sonar用户，必须sonar用于启动，否则报错\nuseradd sonar \n# 更改sonar目录及文件权限\nchown -R sonar. /opt/software/sonar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("修改 sonar 配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /opt/software/sonar/conf/sonar.properties\nsonar.jdbc.username=xxxx\nsonar.jdbc.password=xxxxxx\njdbc:mysql://xxxxxxxxxxx:3306/sonar?useUnicode=true&characterEncoding=utf8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true&useConfigs=maxPerformance\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("启动 sonar")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /opt/software/sonar/\n# 启动\nsu sonar ./bin/linux-x86-64/sonar.sh start \n# 查看状态\nsu sonar ./bin/linux-x86-64/sonar.sh status \n# 停止\nsu sonar ./bin/linux-x86-64/sonar.sh stop \n# 查看日志\ntail -f logs/sonar.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("7.9 以后不支持 mysql，只支持 h2、mssql、postgresql ，7.9 以下也只支持 mysql5.7，所以这里就不在继续了，大致说清楚就好，当安装好后访问 web 页面，默认 9000 端口，得到一个 token 记录下来。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/505/img_33.png",alt:""}})]),s._v(" "),a("p",[s._v("1. 在 Jenkins 中安装 SonarQube Scanner 插件"),a("br"),s._v("\n 2. 在 Jenkins->Manager Jenkins->Global Tool Configuration->SonarQube Scanner-> 新增 SonarQube Scanner")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1. 填入 Name，名字可以自己随便起\n2. 勾选 Install automatically\n3. 选择安装的版本\n4. 点击应用并保存\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("3. 在 Jenkins->Manager Jenkins->Configure System->SonarQube servers->Add SonarQube")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1. 填入 Name，该名字可以随便起\n2. 填写安装 SonarQube 的 web 地址 IP:PORT\n3. 添加证书，该证书就是访问 SonarQube 获取到的token，也可以在Jenkins的全局凭证里去添加这个证书，但类型需要是 Secret text\n4. 应用并保存\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("4. 非结构性项目检查，到项目配置中找到构建，在正常的构建项目名录后可以增加构建步骤，然后再下拉选项中找到 Execute SonarQube Scanner")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1. 填写Task to run，执行 SonarQube 的命令，输入 scan（触发代码扫描以及检测）\n2. 代码需要的JDK环境，这个JDK环境是在全局配置中配置得到的\n3. 在 Analysis properties 填如内容\n\n# must be unique in a given SonarQube instance，项目标记\nsonar.projectKey=web_demo\n# this is the name and version displayed in the SonarQube UI. Was mandatoryprior to SonarQube 6.1.，项目名称\nsonar.projectName=web_demo\n# 版本\nsonar.projectVersion=1.0\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on\nWindows.\n# This property is optional if sonar.modules is set. 扫描代码的路径 . 代表当前项目根目录下扫描所有代码及文件，也可以直接扫描指定包代码，如 /src/main/**\nsonar.sources=.\n# 排除的一些文件不扫描\nsonar.exclusions=**/test/**,**/target/**\n# jdk版本\nsonar.java.source=1.8\nsonar.java.target=1.8\n# Encoding of the source code. Default is default system encoding，编码格式\nsonar.sourceEncoding=UTF-8\n\n4.应用并保存后构建项目\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("5. 流水线项目添加 SonarQube 功能，可以把内容添加到项目中，防止 jenkins 意外的崩溃，导致配置丢失")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1. 在项目中根路径下新建 sonar-project.properties，并把内容复制过来\n2. 到项目中的 Jenkinsfile 中编写内容\n\npipeline {\n    agent any\n\n    stages {\n        stage('pull code') {\n            steps {\n                echo 'master 分支的事情 参数是=${branch}'\n                checkout([$class: 'GitSCM', branches: [[name: '*/${branch}']], extensions: [], userRemoteConfigs: [[credentialsId: '80dfe5c5-1684-47b1-a410-6f53ceb3c543', url: 'http://192.168.81.15:3000/biguncle/test.git']]])\n            }\n        }\n        # 代码检查，可以把该步骤添加到任意位置\n        stage('code checking') {\n            steps {\n                script {\n                    # '' 这里写的是在jenkins->Global Tool Configuration->SonarQube Scanner->新增的SonarQube Scanner的Name\n                    scannerHome = tool 'sonar-scanner'\n                }\n                # () 里的内容是在 jenkins->Configure System->SonarQube servers->里的 Name\n                withSonarQubeEnv('sonarqube6.7.4') {\n                    # 这里是 jenkins 在配置 SonarQube Scanner的时候安装的工具，他自己安装的不需要我们管\n                    sh \"${scannerHome}/bin/sonar-scanner\"\n                }\n            }\n        }\n        stage('build project') {\n            steps {\n                sh 'mvn clean package'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: '构建通知：${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!',\n                body: '${FILE,path=\"email.html\"}',\n                to: '875730567@qq.com'\n            )\n        }\n    }\n}\n\n3. 提交后就可以到 jenkins 去构建项目，结果要去 SonarQube web 去看\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);