(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{643:function(s,a,t){"use strict";t.r(a);var e=t(41),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"目标主机-showmount-e信息泄露"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目标主机-showmount-e信息泄露"}},[s._v("#")]),s._v(" 目标主机 showmount -e 信息泄露")]),s._v(" "),t("p",[s._v("showmount -e 是一个用于查询 NFS（网络文件系统）服务器共享目录的命令。当目标主机启用 NFS 服务且配置不当时，攻击者可通过该命令直接获取服务器导出的目录结构（如 /data, /home 等），甚至绕过访问控制直接挂载敏感目录，导致数据泄露或未授权访问。例如：")]),s._v(" "),t("ul",[t("li",[s._v("信息泄露：攻击者通过 showmount -e <目标 IP> 可列出所有共享目录，推测服务器功能（如数据库备份目录、用户数据目录）。")]),s._v(" "),t("li",[s._v("直接攻击：若 NFS 未限制客户端 IP，攻击者可通过 mount -t nfs <目标 IP>:/ 敏感目录 /mnt 直接挂载并读取 / 写入数据。")])]),s._v(" "),t("p",[t("strong",[s._v("解决方案：")])]),s._v(" "),t("ol",[t("li",[s._v("立即阻断 showmount -e 的访问")])]),s._v(" "),t("ul",[t("li",[s._v("通过防火墙限制 NFS 端口访问，NFS 服务依赖端口 2049（NFS 主端口）和 111（rpcbind 端口），需仅允许可信 IP 访问："),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许192.168.1.0/24网段访问NFS服务")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="2049" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="udp" port="2049" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="111" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="udp" port="111" accept\'')]),s._v("\nfirewall-cmd --reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),s._v("验证：执行 showmount -e <目标 IP>，非授权 IP 应显示 clnt_create: RPC: Program not registered。")]),s._v(" "),t("li",[s._v("使用 hosts.allow/deny 限制 mountd 服务，修改 NFS 服务器的 /etc/hosts.allow 和 /etc/hosts.deny 文件："),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅允许192.168.1.100访问mountd服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mountd: 192.168.1.100"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts.allow\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝所有其他IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mountd: ALL"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts.deny\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),s._v("生效方式：无需重启服务，立即生效。")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("彻底修复 NFS 服务配置")])]),s._v(" "),t("ul",[t("li",[s._v("编辑 NFS 服务器的 /etc/exports 文件，按以下原则配置：\n"),t("ul",[t("li",[s._v("指定可信客户端：仅允许特定 IP 或网段访问。")]),s._v(" "),t("li",[s._v("设置只读权限：非必要不开放写权限。")]),s._v(" "),t("li",[s._v("启用 root_squash：将客户端 root 用户映射为匿名用户（nfsnobody）。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例：仅允许192.168.1.0/24网段只读访问/data目录，并限制root权限")]),s._v("\n  /data "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,root_squash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),s._v("生效命令：exportfs -rv。")]),s._v(" "),t("li",[s._v("固定 NFS 动态端口并配置防火墙，NFS 的 LOCKD、MOUNTD 等服务默认使用随机端口，需固定端口并开放防火墙：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/sysconfig/nfs，添加以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCKD_TCPPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32803")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCKD_UDPPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32769")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RQUOTAD_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放固定端口")]),s._v("\nfirewall-cmd --permanent --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32803")]),s._v("/tcp\nfirewall-cmd --permanent --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32769")]),s._v("/udp\nfirewall-cmd --permanent --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("/tcp\nfirewall-cmd --reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h1",{attrs:{id:"目标主机支持rsa密钥交换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目标主机支持rsa密钥交换"}},[s._v("#")]),s._v(" 目标主机支持 RSA 密钥交换")]),s._v(" "),t("p",[s._v("RSA 密钥交换是一种旧的加密方式，它不支持 “前向保密”。这意味着一旦服务器的私钥泄露，攻击者可以解密过去所有用该密钥加密的历史通信数据，存在严重的隐私和安全风险，现在已不推荐使用。而 ECDHE 等临时密钥交换算法，每次通信会生成临时密钥，即使私钥泄露，历史流量也无法被解密，更安全。")]),s._v(" "),t("p",[t("strong",[s._v("解决方案：")])]),s._v(" "),t("ul",[t("li",[s._v("禁用 RSA 密钥交换算法：在服务器的 TLS 配置中，删除所有以 RSA 为密钥交换方式的加密套件（如 RSA-AES256-GCM-SHA384 等），打开 Nginx 的 SSL 配置文件（通常是 nginx.conf），在 server 块的 ssl_ciphers 中，只保留以 ECDHE 开头的加密套件，删除所有 RSA 相关套件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name example.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用RSA密钥交换，只启用ECDHE")]),s._v("\n    ssl_protocols TLSv1.2 TLSv1.3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用不安全的TLS版本")]),s._v("\n    ssl_prefer_server_ciphers on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只保留ECDHE相关加密套件，确保前向保密")]),s._v("\n    ssl_ciphers "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("启用 ECDHE 临时密钥交换算法：优先配置并只保留以 ECDHE 为前缀的加密套件（如 ECDHE-ECDSA-AES256-GCM-SHA384、ECDHE-RSA-AES128-GCM-SHA256 等），确保通信时使用临时密钥交换。")]),s._v(" "),t("li",[s._v("重启服务生效：修改配置后，重启 Web 服务器（如 Nginx、Apache）或 TLS 相关服务，使新配置生效。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置是否有误")]),s._v("\nnginx -t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启Nginx生效")]),s._v("\nsystemctl restart nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h1",{attrs:{id:"ssh-服务支持弱加密算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-服务支持弱加密算法"}},[s._v("#")]),s._v(" SSH 服务支持弱加密算法")]),s._v(" "),t("p",[s._v("在配置远程 SSH 服务器时，出于安全性考虑，应避免使用诸如 arcfour、aes128-cbc、blowfish-cbc、3des-cbc 等弱加密算法。")]),s._v(" "),t("p",[t("strong",[s._v("解决方案：")]),t("br"),s._v("\n打开 SSH 的主配置文件（通常是 /etc/ssh/sshd_config），在文件中添加或修改以下配置，明确禁用弱算法，只保留安全的加密方式（如 aes256-gcm@openssh.com、chacha20-poly1305@openssh.com 等）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用弱加密算法，仅允许强算法")]),s._v("\nCiphers aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("重启 SSH 服务使配置生效")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Debian/Ubuntu：sudo systemctl restart sshd\nCentOS/RHEL：sudo systemctl restart sshd\n其他系统：sudo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("用以下命令检查当前 SSH 服务器启用的加密算法，确认弱算法已被移除：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -Q cipher localhost\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);