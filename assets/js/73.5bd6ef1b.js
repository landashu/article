(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{548:function(s,a,t){"use strict";t.r(a);var e=t(41),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("文档基于 RocketMQ-4.7.1")]),s._v(" "),t("h2",{attrs:{id:"环境和准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境和准备"}},[s._v("#")]),s._v(" 环境和准备")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("ip")]),s._v(" "),t("th",[s._v("hosts")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("10.240.30.102")]),s._v(" "),t("td",[s._v("node102")])]),s._v(" "),t("tr",[t("td",[s._v("10.240.30.100")]),s._v(" "),t("td",[s._v("node100")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("vim /etc/hosts"),t("br"),s._v("\n10.240.30.100 node100"),t("br"),s._v("\n10.240.30.102 node102")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://rocketmq.apache.org/release_notes/release-notes-4.8.0/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),t("OutboundLink")],1),s._v("，下载 Binary 文件，上传到服务器然后解压，我下载的比较早是 4.7.1 版本的。")]),s._v(" "),t("h2",{attrs:{id:"创建存储路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建存储路径"}},[s._v("#")]),s._v(" 创建存储路径")]),s._v(" "),t("p",[s._v("RocketMQ 物理存储的路径")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/rocketmq-all-4.7.1/store\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/rocketmq-all-4.7.1/store/commitlog\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/rocketmq-all-4.7.1/store/consumequeue\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /home/rocketmq-all-4.7.1/store/index\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("p",[s._v("修改 broker.conf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /home/rocketmq-all-4.7.1/conf/broker.conf \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Broker 对外服务器的监听端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("listenPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10911")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerClusterName")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DefaultCluster")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# broker名字，不同机器 broker 名字可以是重复的(集群情况)，同一机器名字不能一样")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerName")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("broker-a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示 Master，> 0 表示 Slave")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerId")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameServer 地址，分号分隔 必须设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("namesrvAddr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node102:9876")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP1 当前broker监听的IP，必须设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerIP1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node102")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP2 存在broker主从时，在broker主节点上配置了brokerIP2的话,broker从节点会连接主节点配置的brokerIP2来同步。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP2=node100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除文件时间点，默认时凌晨4点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("deleteWhen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("04")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件保留时间，默认时48小时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fileReservedTime")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("48 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("defaultTopicQueueNums")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制消息大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxMessageSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("65536 ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# broker的角色：ASYNC_MASTER（异步复制Master），SYNC_MASTER（同步双写 MASTER），SLAVE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerRole")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ASYNC_MASTER")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ASYNC_FLUSH（异步刷盘），SYNC_FLUSH（同步刷盘）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("flushDiskType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ASYNC_FLUSH")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许 Broker 自动创建Topic，建议线下开启，线上关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("autoCreateTopicEnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("autoCreateSubscriptionGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# commitLog 每个文件的小默认1G")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapedFileSizeCommitLog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1073741824")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# consumeQueue 每个文件啊默认存30W条，根据业务情况调整")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("300000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("storePathCommitLog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/rocketmq-all-4.7.1/store/commitlog")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 消费队列存储历经")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("storePathConsumeQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/rocketmq-all-4.7.1/store/consumequeue")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 消息索引存储路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("storePathIndex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/rocketmq-all-4.7.1/store/index")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("h2",{attrs:{id:"单机启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单机启动"}},[s._v("#")]),s._v(" 单机启动")]),s._v(" "),t("h3",{attrs:{id:"启动前处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动前处理"}},[s._v("#")]),s._v(" 启动前处理")]),s._v(" "),t("p",[s._v("建议测试环境修改堆内存")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/home/rocketmq-all-4.7.1/bin/runbroker.sh\n/home/rocketmq-all-4.7.1/bin/runserver.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改前")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runbroker 的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms8g -Xmx8g -Xmn4g"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runserver 的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改后")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runbroker 的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms2g -Xmx2g -Xmn1g"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runserver 的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"启动-nameserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动-nameserver"}},[s._v("#")]),s._v(" 启动 nameserver")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqnamesrv "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f ~/logs/rocketmqlogs/namesrv.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("看到如下表示启动成功")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-01-29 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":34:15 INFO FileWatchService - FileWatchService "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" started\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"启动-broker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动-broker"}},[s._v("#")]),s._v(" 启动 broker")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /home/rocketmq-all-4.7.1/conf/broker.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f ~/logs/rocketmqlogs/broker.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("看到如下表示启动成功")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-01-29 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":34:49 INFO brokerOutApi_thread_1 - register broker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("to name server node102:9876 OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-01-29 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":34:49 INFO main - The broker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("broker-a, node102:10911"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" boot success. "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("serializeType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("JSON and name server is node102:9876\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("注意开放端口"),t("br"),s._v("\n /sbin/iptables -I INPUT -p tcp --dport 9876 -j ACCEPT"),t("br"),s._v("\n/sbin/iptables -I INPUT -p tcp --dport 10911 -j ACCEPT")])]),s._v(" "),t("h2",{attrs:{id:"console-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#console-启动"}},[s._v("#")]),s._v(" console 启动")]),s._v(" "),t("p",[s._v("rocketmq 是在 linux 上部署的，console 我是在本地启动。")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("下载 rocketmq-console 项目")])]),s._v(" "),t("li",[t("p",[s._v("修改配置文件，被注释的我就不帖了。")])])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("server.address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("server.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("8080")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#spring.application.index=true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.application.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("rocketmq-console")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.http.encoding.charset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF-8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.http.encoding.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.http.encoding.force")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("logging.level.root")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("INFO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("logging.config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("classpath:logback.xml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.namesrvAddr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10.240.30.102:9876")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vip 通道修改成 false，否则会再查看消息的时候报错")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.isVIPChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rocketmq-console's data path:dashboard/monitor")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.dataPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/tmp/rocketmq-console/data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set it false if you don't want use dashboard.default true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.enableDashBoardCollect")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set the message track trace topic if you don't want use the default one")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.msgTrackTopicName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("rocketmq.config.ticketKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ticket")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("修改 windows 的 hosts，win+r C:\\WINDOWS\\system32\\drivers\\etc，加入如下")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("10.240.30.102 node102\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("很奇怪的是你会发现，你在 console 的配置是 IP:PORT，但是如果没修改 hosts 你会发现部分报错是 connect to node102:10911 failed，集群信息都没办法显示。")]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("启动看到如下即为成功")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/rocketmq/2/img.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"双主配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#双主配置"}},[s._v("#")]),s._v(" 双主配置")]),s._v(" "),t("p",[s._v("当我们安装成功之后会看到 rocketmq 的 conf 目录如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("2m-2s-async  2m-2s-sync  2m-noslave  broker.conf  dledger  logback_broker.xml  logback_namesrv.xml  logback_tools.xml  plain_acl.yml  tools.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("2m-2s-async 双主双从异步复制")]),s._v(" "),t("li",[s._v("2m-2s-sync 双主双从同步复制")]),s._v(" "),t("li",[s._v("2m-noslave 双主")]),s._v(" "),t("li",[s._v("我们也可以自己建立规则如下，内容和其他保持一致即可")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir 4m-4s-async")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n2m-2s-async  2m-2s-sync  2m-noslave  4m-4s-async  broker.conf  dledger  logback_broker.xml  logback_namesrv.xml  logback_tools.xml  plain_acl.yml  tools.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"双主配置-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#双主配置-2"}},[s._v("#")]),s._v(" 双主配置")]),s._v(" "),t("h4",{attrs:{id:"修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("p",[s._v("在 102 修改如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 2m-noslave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/home/rocketmq-all-4.7.1/conf/2m-noslave\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 2m-noslave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nbroker-a.properties  broker-b.properties  broker-trace.properties\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 2m-noslave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim broker-a.properties")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("100 修改")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node102 2m-noslave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim broker-b.properties")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("和单机模式差不多，修改如下：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 102 是 broker-a 100 是 broker-b")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerName")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("broker-a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameServer 地址，分号分隔 必须设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("namesrvAddr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node102:9876;node100:9876")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP1 当前broker监听的IP，必须设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP1=node102")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP2 存在broker主从时，在broker主节点上配置了brokerIP2的话,broker从节点会连接主节点配置的brokerIP2来同步。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# brokerIP2=node100")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("nameserver 和以上启动方式一样，broker 启动方式改为如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 100 启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /home/rocketmq-all-4.7.1/conf/2m-noslave/broker-b.properties "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 102 启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /home/rocketmq-all-4.7.1/conf/2m-noslave/broker-a.properties "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同样还是查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f ~/logs/rocketmqlogs/broker.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("看到如下定位启动成功")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-02-01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":41:14 INFO brokerOutApi_thread_1 - register broker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("to name server node102:9876 OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-02-01 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":41:14 INFO brokerOutApi_thread_2 - register broker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("to name server node100:9876 OK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("集群一旦成功，在 100 的 mqadmin topiclist 中也会看到 102 的 topic，这并非同步。")])]),s._v(" "),t("h4",{attrs:{id:"rocketmq-console-注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-console-注意"}},[s._v("#")]),s._v(" rocketmq-console 注意")]),s._v(" "),t("ol",[t("li",[s._v("在本机 hosts 添加")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("10.240.30.100 node100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("发现在 rocketmq.config.namesrvAddr=10.240.30.102:9876 只写一个 ip，依然可以读到集群信息，所以没必要在添加 100")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/rocketmq/2/img_1.png",alt:""}})])])}),[],!1,null,null,null);a.default=n.exports}}]);