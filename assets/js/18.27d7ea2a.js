(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{495:function(s,e,n){"use strict";n.r(e);var a=n(41),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[s._v("Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排，帮助定义和运行多个 Docker 容器的应用，其前身是开源项目 Fig。所谓编排就是能把一个项目的依赖（如 mysql，redis，服务间的依赖等）按照有序的方式启动容器")]),s._v(" "),n("p",[s._v("DockerFile 可以让用户很方便的定义一个单独的应用容器，然而在日常工作中们经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 web 项目，除了 web 服务容器本身，往往还需要再加上后端的数据库服务器容器，甚至还包括负载均衡容器等。")]),s._v(" "),n("p",[s._v("Compose 恰好满足了这样的需求，它允许通过一个单独的 docker-compose.yml 模板文件，来定义一组相关联的应用容器为一个项目。")]),s._v(" "),n("p",[s._v("Compose 中有两个重要的概念")]),s._v(" "),n("ol",[n("li",[s._v("服务（service），一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。")]),s._v(" "),n("li",[s._v("项目（project），由一组关联的应用容器组成的一个完整业务单元，再 docker-compose.yml 文件中定义。")])]),s._v(" "),n("p",[s._v("Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。")]),s._v(" "),n("p",[s._v("Compose 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以再其上利用 Compose 来进行编排管理。")]),s._v(" "),n("h2",{attrs:{id:"安装与卸载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装与卸载"}},[s._v("#")]),s._v(" 安装与卸载")]),s._v(" "),n("p",[s._v("安装的话，可以安装 Docker Desktop ，它包含了 Docker 以及 Compose 和 K8s，也可以单独安装，但建议先了解清楚官方对 Compose 的一些安装限制。"),n("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方地址"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("linux 安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("命令")]),s._v(" "),n("th",[s._v("描述")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("version")]),s._v(" "),n("td",[s._v("版本目前 4 以下的都可以写，如 3.9，3.8 等，最好保持和 docker "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles",target:"_blank",rel:"noopener noreferrer"}},[s._v("版本兼容"),n("OutboundLink")],1)])]),s._v(" "),n("tr",[n("td",[s._v("services")]),s._v(" "),n("td",[s._v("可以里面描述你的所有服务，以及依赖关系等")])]),s._v(" "),n("tr",[n("td",[s._v("image")]),s._v(" "),n("td",[s._v("指定为镜像名称或镜像 ID，如果镜像在本地不存在，Compose 将会尝试拉取这个镜像")])]),s._v(" "),n("tr",[n("td",[s._v("ports")]),s._v(" "),n("td",[s._v('指定与宿主机与容器映射的端口，是一个数组，每个数组的元素建议用字符形式，如 "80:80"')])]),s._v(" "),n("tr",[n("td",[s._v("volumes")]),s._v(" "),n("td",[s._v("挂载路径设置，类型为数组，可以挂载多个。")])]),s._v(" "),n("tr",[n("td",[s._v("networks")]),s._v(" "),n("td",[s._v("配置容器连接的网络 docker network ls 查看网络列表， "),n("code",[s._v("docker network inspect <container id>")]),s._v("  可以查看对应网络的配置")])]),s._v(" "),n("tr",[n("td",[s._v("environment")]),s._v(" "),n("td",[s._v("设置环境变量。你可以使用数组或字典两种方式")])]),s._v(" "),n("tr",[n("td",[s._v("env_file")]),s._v(" "),n("td",[s._v("从文件中获取环境变量，可以为单独的文件路径或列表，文件内必须是字典方式编写")])]),s._v(" "),n("tr",[n("td",[s._v("command")]),s._v(" "),n("td",[s._v("覆盖容器启动后默认执行的命令")])]),s._v(" "),n("tr",[n("td",[s._v("depends_on")]),s._v(" "),n("td",[s._v("解决容器的依赖、启动先后的问题，填写的值为 服务名，会等依赖的服务启动一定程度才启动自己")])]),s._v(" "),n("tr",[n("td",[s._v("healthcheck")]),s._v(" "),n("td",[s._v("通过命令检查容器是否监控运行")])]),s._v(" "),n("tr",[n("td",[s._v("sysctls")]),s._v(" "),n("td",[s._v("配置容器内核参数，如 ES 等都需要修改内核的环境参数")])]),s._v(" "),n("tr",[n("td",[s._v("ulimits")]),s._v(" "),n("td",[s._v("指定容器的 ulimits 限制值，如 ES、Clickhouse 会有修改需求")])]),s._v(" "),n("tr",[n("td",[s._v("build")]),s._v(" "),n("td",[s._v("用来将指定 Dockerfile 打包成对应镜像，然后再运行该镜像")])])])]),s._v(" "),n("p",[s._v("这些命令其实就类似于我们在 Docker 中启动一个容器的命令。")]),s._v(" "),n("h2",{attrs:{id:"compose文件编写"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#compose文件编写"}},[s._v("#")]),s._v(" Compose 文件编写")]),s._v(" "),n("h3",{attrs:{id:"示例1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例1"}},[s._v("#")]),s._v(" 示例 1")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('### 版本\nversion: "3.2"\n\nservices:\n  ### 服务名称\n  tomcat:\n    ### 指定容器的名称 相当于 --name\n    container_name: tomcat_1\n    ### 使用哪个镜像 相当于 docket run image\n    image: tomcat:8.0-jre8\n    ### 指定宿主机与容器端口的映射 相当于 -p\n    ports:\n      ### 宿主机:容器\n      - "8080:8080"\n    ### 宿主机与容器的数据共享 挂载目录 相当于 -v\n    volumes:\n      ### 方式1：指定绝对明确(绝对路径)的挂载目录\n      - /home/server:/user\n      ### 方式2：声明了自定创建卷名的变量\n      - tomcatwebapps:/user\n    ### 代表当前服务处于那个网络，作用是网络隔离用，会把相网络名称相同的容器的网段统一。相当于 --network\n    networks:\n      - group1\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n    - "3306:3306"\n    volumes:\n    - mysqldata:/var/lib/mysql\n    - mysqlconf:/etc/mysql\n    environment:\n      -MYSQL_ROOT_PASSWORD=root\n    networks:\n      group1\n\n\n### 描述 挂在卷里的变量\nvolumes:\n  ### 指定变量 tomcatwebapps，如果不写 external，默认会是 docker-compose.yml 所在当前文件夹的名称(会自动创建)\n  tomcatwebapps:\n    ### 使用自定义卷毛\n    external:\n      ### true 确定使用指定卷名，注意：一旦使用外部自定义卷名，启动服务之前必须手动创建 docker volume create 卷名\n      false\n  mysqldata:\n  mysqlconf:\n\n### 定义服务用到的网络\nnetworks:\n  ### 定义上面的服务用到的网络的名称，默认是驱动属于 bridge，自定义的网络名称 group1，在实际中会变为 项目名(或所在文件目录名)\n  group1:\n    ### 使用外部指定的网络，为 true 就标识网络必须存在\n    external:\n      ### docker network create -d bridge 网络名称\n      true\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br")])]),n("h3",{attrs:{id:"示例2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例2"}},[s._v("#")]),s._v(" 示例 2")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('### 指定版本，版本的关系和Docker 引擎有关\n### https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles 版本关系及说明\nversion: \'3.7\'\n\n### 指定服务\nservices:\n  ### 服务名称 唯一\n  monitor-web-server-service:\n    ### 构建镜像的项目路径\n    build:\n      ### 指定上下文路径，默认是微服务项目的根目录\n      context: ./monitor-web/monitor-web-server/\n      ### 指定\n      dockerfile: monitor-web-server-service\n    ### 指定镜像名称\n    image: monitor-web-server-service\n    ### .env的环境变量\n    env_file:\n      - ./.env\n    ### 网络配置\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-web-socket-service:\n    build: ./monitor-web/monitor-web-socket/monitor-web-socket-service\n    image: boboweike/monitor-web-socket-service\n    env_file:\n      - ./.env\n    ### 依赖的项目，启动的时候根据依赖关系定义启动顺序\n    depends_on:\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-gateway:\n    build: ./monitor-gateway\n    image: boboweike/monitor-gateway\n    ### 设置内部和外部端口\n    ports:\n    - 80:80\n    env_file:\n      - ./.env\n    ### 依赖的项目，启动的时候根据依赖关系定义启动顺序\n    depends_on:\n      - monitor-web-server-service\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access\n    ### 心跳检查\n    healthcheck:\n      ### 访问 monitor-gateway 网关的命令\n      test: [ "CMD","curl","-f","http://localhost:80" ]\n      ### 间隔时间\n      interval: 1m30s\n      ### 超时时间\n      timeout: 10s\n      ### 重试次数\n      retries: 3\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\n      - mysqlconf:/etc/mysql\n    env_file:\n      - ./mysql.env\n    networks:\n      - external_access\n    ### 修改内核参数，也可以是数组的方式\n    sysctls:\n      net.core.somaxconn: 1024\n      net.ipv4.tcp_syncookies: 0\n    ### 指定容器的 ulimits 限制值，例如 ，\n    ulimits:\n      ### 指定最大进程数为 65535\n      nproc: 65535\n      ### 指定文件句柄数为\n      nofile:\n        ### 软限制 200000（软限制，应用可以随时修改，不能超过硬限制）\n        soft: 20000\n        ### 硬限制（系统硬限制，只能root用户提高）\n        hard: 40000\n\n\n  myaccount-service:\n    build:\n      context: ./frontend\n      dockerfile: myaccount/Dockerfile\n    image: boboweike/myaccount-spa\n    networks:\n      - internal_access\n\n\nnetworks:\n  internal_access:\n    internal: true\n  external_access:\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br")])]),n("h3",{attrs:{id:"compose-指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#compose-指令"}},[s._v("#")]),s._v(" Compose 指令")]),s._v(" "),n("p",[s._v("对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到影响。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose [-f=<arg>...] [options] [COMMAND] [ARGS...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"命令选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令选项"}},[s._v("#")]),s._v(" 命令选项")]),s._v(" "),n("ul",[n("li",[s._v("-f -> --file FILE 指定使用的 Compose 模板把文件，默认为 docker-compose.yml，可以多次指定。")]),s._v(" "),n("li",[s._v("-p -> --project-name NAME 指定项目名称，默认将使用所在目录名称作为项目名")]),s._v(" "),n("li",[s._v("--x-networking 使用 Docker 可插拔网络后端特性")]),s._v(" "),n("li",[s._v("--verbose 输出更多调试信息。")]),s._v(" "),n("li",[s._v("-v -> --version 打印版本并退出。")])]),s._v(" "),n("h3",{attrs:{id:"命令使用说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令使用说明"}},[s._v("#")]),s._v(" 命令使用说明")]),s._v(" "),n("h4",{attrs:{id:"up"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#up"}},[s._v("#")]),s._v(" up")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose up [options] [SERVICE...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。")]),s._v(" "),n("li",[s._v("连接的服务都将会被自动启动，除非已经处于运行状态")]),s._v(" "),n("li",[s._v("大部分的时候都可以直接通过该命令来启动一个项目。")]),s._v(" "),n("li",[s._v("默认情况，docker-compose up 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。")]),s._v(" "),n("li",[s._v("当通过 Ctrl-c 停止命令时，所有容器将会停止")]),s._v(" "),n("li",[s._v("如果使用 docker-compose up -d，将会再后台启动并运行所有的容器，一般推荐生产环境下使用该选项。")]),s._v(" "),n("li",[s._v("默认情况，如果服务容器已经存在，docker-compose up 将会尝试停止容器，然后重新创建（保持使用 volumes-from 挂载的卷），以保证新启动的服务匹配 docker-compose.yml 文件的最新内容。")])]),s._v(" "),n("h4",{attrs:{id:"down"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#down"}},[s._v("#")]),s._v(" down")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose down\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("此命令将会停止 up 命令所启动的容器，并移除网络")]),s._v(" "),n("h4",{attrs:{id:"exec"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#exec"}},[s._v("#")]),s._v(" exec")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose exec 服务名\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("进入指定的容器")]),s._v(" "),n("h4",{attrs:{id:"ps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ps"}},[s._v("#")]),s._v(" ps")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose ps [options] [SERVICE...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("列出项目中目前的所有容器。")]),s._v(" "),n("ul",[n("li",[s._v("-q ，可以以打印容器的 ID 信息")])]),s._v(" "),n("h4",{attrs:{id:"restart"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#restart"}},[s._v("#")]),s._v(" restart")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose restart [options] [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("重启项目中的服务，选项 -t 指定重启前停止容的超时时间（默认 10s）")]),s._v(" "),n("h4",{attrs:{id:"rm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rm"}},[s._v("#")]),s._v(" rm")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose rm [options] [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("删除所有（停止状态的）服务容器。推荐先执行 docker-compose stop 命令来停止容器。")]),s._v(" "),n("ul",[n("li",[s._v("-f 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。")]),s._v(" "),n("li",[s._v("-v 删除容器所挂载的数据卷。")])]),s._v(" "),n("h4",{attrs:{id:"start"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#start"}},[s._v("#")]),s._v(" start")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose start [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("启动已经存在的服务容器")]),s._v(" "),n("h4",{attrs:{id:"stop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stop"}},[s._v("#")]),s._v(" stop")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose stop [options] [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("停止已经处于运行状态的容器，但不删除它。通过 docker-compose start 可以再次启动这些容器")]),s._v(" "),n("ul",[n("li",[s._v("-t 停止容器的超时时间（默认为 10s）")])]),s._v(" "),n("h4",{attrs:{id:"top"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#top"}},[s._v("#")]),s._v(" top")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose top\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看各个服务容器内运行的进程。")]),s._v(" "),n("h4",{attrs:{id:"pause-unpause"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pause-unpause"}},[s._v("#")]),s._v(" pause,unpause")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose pause [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("暂停处于运行中的服务。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose unpause [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("恢复处于暂停状态中的服务。")]),s._v(" "),n("h4",{attrs:{id:"logs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logs"}},[s._v("#")]),s._v(" logs")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker-compose logs [service...]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看某个服务的日志")])])}),[],!1,null,null,null);e.default=t.exports}}]);