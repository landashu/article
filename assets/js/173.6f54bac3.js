(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{649:function(s,t,a){"use strict";a.r(t);var i=a(41),e=Object(i.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"用户管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),a("p",[s._v("我们可以利用 Role-based Authorization Strategy 插件来管理 Jenkins 用户权限")]),s._v(" "),a("h3",{attrs:{id:"安装role-based-authorization-strategy插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装role-based-authorization-strategy插件"}},[s._v("#")]),s._v(" 安装 Role-based Authorization Strategy 插件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"修改安全配置策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改安全配置策略"}},[s._v("#")]),s._v(" 修改安全配置策略")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_1.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_2.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"分配角色和用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分配角色和用户"}},[s._v("#")]),s._v(" 分配角色和用户")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_3.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_4.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_5.png",alt:""}})]),s._v(" "),a("p",[s._v("Global roles（全局角色）：管理员等高级用户可以创建基于全局的角色"),a("br"),s._v("\n Item roles（项目角色）：针对某个或者某些项目的角色"),a("br"),s._v("\n Node roles（节点角色）：节点相关的权限")]),s._v(" "),a("p",[s._v("我们添加以下三个角色：")]),s._v(" "),a("ul",[a("li",[s._v("baseRole：该角色为全局角色。这个角色需要绑定 Overall 下面的 Read 权限，是为了给所有用户绑定最基本的 Jenkins 访问权限。注意：如果不给后续用户绑定这个角色，会报错误：用户名 ismissing the Overall/Read permission")]),s._v(" "),a("li",[s._v('role1：该角色为项目角色。使用正则表达式绑定 "itcast.*"，意思是只能操作 itcast 开头的项目。')]),s._v(" "),a("li",[s._v('role2：该角色也为项目角色。绑定 "itheima.*"，意思是只能操作 itheima 开头的项目。')])]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_6.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_7.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_8.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_9.png",alt:""}})]),s._v(" "),a("p",[s._v("在系统管理页面进入 Manage Users")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_10.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_11.png",alt:""}})]),s._v(" "),a("p",[s._v("给用户分配角色"),a("br"),s._v("\n系统管理页面进入 Manage and Assign Roles，点击 Assign Roles"),a("br"),s._v("\n 绑定规则如下："),a("br"),s._v("\nroot1 用户分别绑定 baseRole 和 role1 角色"),a("br"),s._v("\n root2 用户分别绑定 baseRole 和 role2 角色")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_12.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_13.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"建立项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建立项目"}},[s._v("#")]),s._v(" 建立项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_14.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_15.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_16.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_17.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"jenkins凭证管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins凭证管理"}},[s._v("#")]),s._v(" Jenkins 凭证管理")]),s._v(" "),a("p",[s._v("凭据可以用来存储需要密文保护的数据库密码、Gitlab 密码信息、Docker 私有仓库密码等，以便 Jenkins 可以和这些第三方的应用进行交互。")]),s._v(" "),a("h3",{attrs:{id:"安装credentials-binding插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装credentials-binding插件"}},[s._v("#")]),s._v(" 安装 Credentials Binding 插件")]),s._v(" "),a("p",[s._v("要在 Jenkins 使用凭证管理功能，需要安装 Credentials Binding 插件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_18.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_19.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_20.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_21.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_22.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("Username with password：用户名和密码")]),s._v(" "),a("li",[s._v("SSH Username with private key： 使用 SSH 用户和密钥")]),s._v(" "),a("li",[s._v("Secret file：需要保密的文本文件，使用时 Jenkins 会将文件复制到一个临时目录中，再将文件路径设置到一个变量中，等构建结束后，所复制的 Secret file 就会被删除。")]),s._v(" "),a("li",[s._v("Secret text：需要保存的一个加密的文本串，如钉钉机器人或 Github 的 api token")]),s._v(" "),a("li",[s._v("Certificate：通过上传证书文件的方式")])]),s._v(" "),a("p",[s._v("常用的凭证类型有：Username with password（用户密码）和 SSH Username with private key（SSH 密钥），接下来以使用 Git 工具到 Gitlab 拉取项目源码为例，演示 Jenkins 的如何管理 Gitlab 的凭证。")]),s._v(" "),a("h3",{attrs:{id:"安装git插件和git工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装git插件和git工具"}},[s._v("#")]),s._v(" 安装 Git 插件和 Git 工具")]),s._v(" "),a("p",[s._v("为了让 Jenkins 支持从 Gitlab 拉取源码，需要安装 Git 插件以及在 CentOS7 上安装 Git 工具。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_23.png",alt:""}})]),s._v(" "),a("p",[s._v("在 centos 上安装 git 工具")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" -y \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装后查看版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --version \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"添加凭证-username-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加凭证-username-password"}},[s._v("#")]),s._v(" 添加凭证（username & password）")]),s._v(" "),a("p",[s._v("把你在 git 上的账号密码加入到凭证中。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_24.png",alt:""}})]),s._v(" "),a("p",[s._v("回到我们在 jenkins 的项目中，来配置这个项目。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_25.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_26.png",alt:""}})]),s._v(" "),a("p",[s._v("应用，然后保存。保存后我们构建这个项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_27.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_28.png",alt:""}})]),s._v(" "),a("p",[s._v("构建成功后，可以看到 jenkins 会把项目在服务器中的  /var/lib/jenkins/workspace/test01 路径构建一个项目，通过这种方式代表我们配置 git 的凭证是成功的。")]),s._v(" "),a("h3",{attrs:{id:"ssh-密钥类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-密钥类型"}},[s._v("#")]),s._v(" SSH 密钥类型")]),s._v(" "),a("p",[s._v("SSH 免密登录示意图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_29.png",alt:""}})]),s._v(" "),a("p",[s._v("1. 使用 root 用户生成公钥和私钥")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ssh-keygen -t rsa\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在 /root/.ssh/ 目录保存了公钥和使用")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_30.png",alt:""}})]),s._v(" "),a("p",[s._v("id_rsa：私钥文件"),a("br"),s._v("\n id_rsa.pub：公钥文件")]),s._v(" "),a("p",[s._v("2. 把生成的公钥的内容放在 Gitlab 中，我的是 Gitea")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_a.png",alt:""}})]),s._v(" "),a("p",[s._v("3. 在 Jenkins 中添加凭证，配置私钥"),a("br"),s._v('\n在 Jenkins 添加一个新的凭证，类型为 "SSH Username with private key"，把刚才生成私有文件内容复制过来')]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/502/img_31.png",alt:""}})]),s._v(" "),a("p",[s._v("这个 root，是你在 服务器，root 目录下生成的，所以填写 root，最后依然是在项目中配置一下 git 即可")])])}),[],!1,null,null,null);t.default=e.exports}}]);