(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{644:function(s,n,a){"use strict";a.r(n);var t=a(41),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"目标主机-showmount-e信息泄露"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标主机-showmount-e信息泄露"}},[s._v("#")]),s._v(" 目标主机 showmount -e 信息泄露")]),s._v(" "),a("p",[s._v("showmount -e 是一个用于查询 NFS（网络文件系统）服务器共享目录的命令。当目标主机启用 NFS 服务且配置不当时，攻击者可通过该命令直接获取服务器导出的目录结构（如 /data, /home 等），甚至绕过访问控制直接挂载敏感目录，导致数据泄露或未授权访问。例如：")]),s._v(" "),a("ul",[a("li",[s._v("信息泄露：攻击者通过 showmount -e <目标 IP> 可列出所有共享目录，推测服务器功能（如数据库备份目录、用户数据目录）。")]),s._v(" "),a("li",[s._v("直接攻击：若 NFS 未限制客户端 IP，攻击者可通过 mount -t nfs <目标 IP>:/ 敏感目录 /mnt 直接挂载并读取 / 写入数据。")])]),s._v(" "),a("p",[a("strong",[s._v("解决方案：")])]),s._v(" "),a("ol",[a("li",[s._v("立即阻断 showmount -e 的访问")])]),s._v(" "),a("ul",[a("li",[s._v("通过防火墙限制 NFS 端口访问，NFS 服务依赖端口 2049（NFS 主端口）和 111（rpcbind 端口），需仅允许可信 IP 访问："),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许192.168.1.0/24网段访问NFS服务")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="2049" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="udp" port="2049" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="111" accept\'')]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'rule family="ipv4" source address="192.168.1.0/24" port protocol="udp" port="111" accept\'')]),s._v("\nfirewall-cmd --reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),s._v("验证：执行 showmount -e <目标 IP>，非授权 IP 应显示 clnt_create: RPC: Program not registered。")]),s._v(" "),a("li",[s._v("使用 hosts.allow/deny 限制 mountd 服务，修改 NFS 服务器的 /etc/hosts.allow 和 /etc/hosts.deny 文件："),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅允许192.168.1.100访问mountd服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mountd: 192.168.1.100"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts.allow\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝所有其他IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mountd: ALL"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts.deny\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),s._v("生效方式：无需重启服务，立即生效。")])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("彻底修复 NFS 服务配置")])]),s._v(" "),a("ul",[a("li",[s._v("编辑 NFS 服务器的 /etc/exports 文件，按以下原则配置：\n"),a("ul",[a("li",[s._v("指定可信客户端：仅允许特定 IP 或网段访问。")]),s._v(" "),a("li",[s._v("设置只读权限：非必要不开放写权限。")]),s._v(" "),a("li",[s._v("启用 root_squash：将客户端 root 用户映射为匿名用户（nfsnobody）。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例：仅允许192.168.1.0/24网段只读访问/data目录，并限制root权限")]),s._v("\n  /data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,root_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),s._v("生效命令：exportfs -rv。")]),s._v(" "),a("li",[s._v("固定 NFS 动态端口并配置防火墙，NFS 的 LOCKD、MOUNTD 等服务默认使用随机端口，需固定端口并开放防火墙：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/sysconfig/nfs，添加以下内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCKD_TCPPORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32803")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOCKD_UDPPORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32769")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RQUOTAD_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放固定端口")]),s._v("\nfirewall-cmd --permanent --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32803")]),s._v("/tcp\nfirewall-cmd --permanent --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32769")]),s._v("/udp\nfirewall-cmd --permanent --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("/tcp\nfirewall-cmd --reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"目标主机支持rsa密钥交换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标主机支持rsa密钥交换"}},[s._v("#")]),s._v(" 目标主机支持 RSA 密钥交换")]),s._v(" "),a("p",[s._v("RSA 密钥交换是一种旧的加密方式，它不支持 “前向保密”。这意味着一旦服务器的私钥泄露，攻击者可以解密过去所有用该密钥加密的历史通信数据，存在严重的隐私和安全风险，现在已不推荐使用。而 ECDHE 等临时密钥交换算法，每次通信会生成临时密钥，即使私钥泄露，历史流量也无法被解密，更安全。")]),s._v(" "),a("p",[a("strong",[s._v("解决方案：")])]),s._v(" "),a("ul",[a("li",[s._v("禁用 RSA 密钥交换算法：在服务器的 TLS 配置中，删除所有以 RSA 为密钥交换方式的加密套件（如 RSA-AES256-GCM-SHA384 等），打开 Nginx 的 SSL 配置文件（通常是 nginx.conf），在 server 块的 ssl_ciphers 中，只保留以 ECDHE 开头的加密套件，删除所有 RSA 相关套件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name example.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用RSA密钥交换，只启用ECDHE")]),s._v("\n    ssl_protocols TLSv1.2 TLSv1.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用不安全的TLS版本")]),s._v("\n    ssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只保留ECDHE相关加密套件，确保前向保密")]),s._v("\n    ssl_ciphers "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("启用 ECDHE 临时密钥交换算法：优先配置并只保留以 ECDHE 为前缀的加密套件（如 ECDHE-ECDSA-AES256-GCM-SHA384、ECDHE-RSA-AES128-GCM-SHA256 等），确保通信时使用临时密钥交换。")]),s._v(" "),a("li",[s._v("重启服务生效：修改配置后，重启 Web 服务器（如 Nginx、Apache）或 TLS 相关服务，使新配置生效。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置是否有误")]),s._v("\nnginx -t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启Nginx生效")]),s._v("\nsystemctl restart nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"ssh-服务支持弱加密算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-服务支持弱加密算法"}},[s._v("#")]),s._v(" SSH 服务支持弱加密算法")]),s._v(" "),a("p",[s._v("在配置远程 SSH 服务器时，出于安全性考虑，应避免使用诸如 arcfour、aes128-cbc、blowfish-cbc、3des-cbc 等弱加密算法。")]),s._v(" "),a("p",[a("strong",[s._v("解决方案：")]),a("br"),s._v("\n打开 SSH 的主配置文件（通常是 /etc/ssh/sshd_config），在文件中添加或修改以下配置，明确禁用弱算法（arcfour、aes128-cbc、blowfish-cbc、3des-cbc），只保留安全的加密方式（如 aes256-gcm@openssh.com、chacha20-poly1305@openssh.com 等）")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看有哪些加密，但不正确，要测验看后面")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -Q cipher localhost\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用弱加密算法，仅允许强算法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 打开SSH配置文件，一般位于/etc/ssh/sshd_config。\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 在该配置文件中，找到以下这些行（如果存在的话）并删除或注释掉它们，如果不存在的话，直接跳到第3步\nCiphers aes128-cbc,aes192-cbc,aes256-cbc,MACs hmac-md5,hmac-sha1,hmac-ripemd160\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 向配置文件添加或修改以下行以只允许使用强加密算法\nCiphers aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("重启 SSH 服务使配置生效")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Debian/Ubuntu：sudo systemctl restart sshd\nCentOS/RHEL：sudo systemctl restart sshd\n其他系统：sudo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("用以下命令检查当前 SSH 服务器启用的加密算法，确认弱算法已被移除：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -Q cipher localhost "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssh -Q cipher localhost 可能显示 “理论支持的算法”，而非实际启用的。最准确的验证是从客户端尝试用弱算法连接，若失败则配置生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no matching cipher found: client offered: aes128-cbc server supported: ...（表示弱算法被拒绝）。 配置成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -c aes128-cbc 你的用户名@服务器IP\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 尝试用强算法连接，若出现提示 Are you sure you want to continue connecting 则成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -c aes256-gcm@openssh.com 你的用户名@服务器IP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"openssh-用户枚举漏洞"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openssh-用户枚举漏洞"}},[s._v("#")]),s._v(" OpenSSH 用户枚举漏洞")]),s._v(" "),a("h4",{attrs:{id:"cve-2018-15473"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cve-2018-15473"}},[s._v("#")]),s._v(" CVE-2018-15473")]),s._v(" "),a("p",[s._v("OpenSSH 7.7 及之前版本中存在用户枚举漏洞，该漏洞源于程序会对有效的和无效的用户身份验证请求发出不同的响应。攻击者可通过发送特制的请求利用该漏洞枚举用户名称。")]),s._v(" "),a("p",[a("strong",[s._v("解决方案（看完问题）：")]),a("br"),s._v("\n该漏洞在 OpenSSH 7.7 版本中已被修复，因此最彻底的解决方式是将系统的 OpenSSH 升级到 7.7 及以上版本。")]),s._v(" "),a("ol",[a("li",[s._v("查看版本")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -V\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("通过系统包管理器升级（推荐）")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu/Debian 系统：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade openssh-server openssh-client\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CentOS/RHEL 系统")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum update openssh-server openssh-clients\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu/Debian")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS/RHEL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("strong",[s._v("遇到问题")])]),s._v(" "),a("ol",[a("li",[s._v("如果你的 yum 无法更新到最新版，以下是解决方案：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yml 安装不成功可以尝试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum remove -y epel-release\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后重新尝试")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例：下载 9.6p1 版本（请替换为最新版本号）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.6p1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装编译依赖：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y gcc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" zlib-devel openssl-devel pam-devel\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf openssh-9.6p1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" openssh-9.6p1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置编译选项（根据需要调整）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制使用新安装的 OpenSSL, 是自己手动安装的 openssl，没有手动安装则去掉使用默认")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认 使用 ./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-zlib")]),s._v("\n./configure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --sysconfdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/ssh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --with-pam "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --with-zlib "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --with-ssl-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/openssl  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译并安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("openssh 安装失败，提示遇到 openSSL 版本较低")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先尝试通过包管理器升级 OpenSSL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum update openssl openssl-devel\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查升级后的版本")]),s._v("\nopenssl version\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动编译安装 OpenSSL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://www.openssl.org/source/openssl-1.1.1w.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf openssl-1.1.1w.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" openssl-1.1.1w\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置安装路径（推荐 /usr/local/openssl）")]),s._v("\n./config --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/openssl --openssldir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/openssl shared zlib\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译（多线程加速）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -j4\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加库文件路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/openssl/lib"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/ld.so.conf.d/openssl.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ldconfig\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建软链接，替换系统默认的 openssl")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/bin/openssl /usr/bin/openssl.old\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/openssl/bin/openssl /usr/bin/openssl\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/openssl/include/openssl /usr/include/openssl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 OpenSSL 版本")]),s._v("\nopenssl version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("PAM headers not found")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y pam-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[a("strong",[s._v("重点")]),s._v(" 安装好后 openssh，不要重启，立马更新所有账户的密码，否则无法登录")])]),s._v(" "),a("h3",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" Nginx")]),s._v(" "),a("h4",{attrs:{id:"漏洞源于可能允许攻击者使用特制的mp4文件过度读取nginx工作内存导致其终止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞源于可能允许攻击者使用特制的mp4文件过度读取nginx工作内存导致其终止"}},[s._v("#")]),s._v(" 漏洞源于可能允许攻击者使用特制的 mp4 文件过度读取 NGINX 工作内存导致其终止")]),s._v(" "),a("p",[s._v("这个漏洞是指 F5 Nginx 在处理特制的 MP4 文件时，可能会出现内存读取越界的问题。攻击者可以构造恶意的 MP4 文件，当服务器处理该文件时，会错误地读取超出预期范围的内存数据，最终导致 Nginx 进程崩溃（终止运行），造成服务中断，影响可用性。")]),s._v(" "),a("p",[a("strong",[s._v("解决方案：")]),a("br"),s._v("\n官方不处理这个漏洞，要解决这个漏洞您可以不启用这个模块 "),a("code",[s._v("ngx_http_mp4_module")]),s._v(" ，或者已添加改密快，在用到的地方注释掉")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("location /video/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mp4;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mp4_buffer_size       1m; # mp4_buffer_size 1m; # mp4缓冲区大小 1m;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mp4_max_buffer_size   5m; # mp4最大缓冲区大小 5m;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mp4_limit_rate         on; # 限制MP4输出码率 开启;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mp4_limit_rate_after   30s; # 达到30秒后开始限制MP4速率")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"漏洞源于tls会话票证或ssl会话缓存的使用-这可能使攻击者利用会话恢复来绕过这些服务器上的客户端证书认证要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞源于tls会话票证或ssl会话缓存的使用-这可能使攻击者利用会话恢复来绕过这些服务器上的客户端证书认证要求"}},[s._v("#")]),s._v(" 漏洞源于 TLS 会话票证或 SSL 会话缓存的使用，这可能使攻击者利用会话恢复来绕过这些服务器上的客户端证书认证要求")]),s._v(" "),a("p",[s._v('Nginx 在使用 TLS 会话票证或 SSL 会话缓存（用于加速重复连接的 "会话恢复" 功能）时，可能存在认证漏洞。正常情况下，启用客户端证书认证（如双向 TLS 认证）时，每次连接都需要验证客户端证书；但漏洞存在时，攻击者可利用已有的会话信息（如会话票证）绕过证书验证，直接复用旧会话访问服务器，导致未授权访问。')]),s._v(" "),a("p",[a("strong",[s._v("解决方案：（3 种）")])]),s._v(" "),a("ol",[a("li",[s._v("先测试升级 nginx 是否能解决，若不能在使用以下方式")]),s._v(" "),a("li",[s._v("禁用 TLS 1.3 bmpqnr")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ssl_protocols TLSv1.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TLSv1.3 不要启用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("限制会话缓存并强制证书重验证")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制会话缓存大小和超时时间（建议不超过5分钟）")]),s._v("\nssl_session_cache shared:SSL:10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nssl_session_timeout 5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nssl_verify_client on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制验证客户端证书")]),s._v("\nssl_session_tickets off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用会话票证")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);