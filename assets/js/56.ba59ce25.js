(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{534:function(s,a,t){"use strict";t.r(a);var n=t(41),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("深度理解 Seata 我就不说了，我也是一知半解，但我会把我理解的部分在以下阐述。"),t("a",{attrs:{href:"http://seata.io/zh-cn/docs/overview/what-is-seata.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Seata 官网"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"搭建-seata-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建-seata-server"}},[s._v("#")]),s._v(" 搭建 seata-server")]),s._v(" "),t("p",[s._v("在搭建之前，大家一定要理解 seata 的核心角色以及之间的通信关系，Seata 分 TC、TM 和 RM 三个角色，TC（Server 端）为单独服务端部署，TM 和 RM（Client 端）由业务系统集成。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("TC (Transaction Coordinator) - 事务协调者"),t("br"),s._v("\n维护全局和分支事务的状态，驱动全局事务提交或回滚。")])]),s._v(" "),t("li",[t("p",[s._v("TM (Transaction Manager) - 事务管理器"),t("br"),s._v("\n定义全局事务的范围：开始全局事务、提交或回滚全局事务。")])]),s._v(" "),t("li",[t("p",[s._v("RM (Resource Manager) - 资源管理器"),t("br"),s._v("\n管理分支事务处理的资源，与 TC 交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。")])])]),s._v(" "),t("h2",{attrs:{id:"正式开始搭建-tc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#正式开始搭建-tc"}},[s._v("#")]),s._v(" 正式开始搭建 (TC)")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://github.com/seata/seata/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("seata-server 下载地址"),t("OutboundLink")],1),s._v("，下载完成后解压缩。")]),s._v(" "),t("li",[s._v("修改 seata/conf/file.conf 文件，这个文件里是存储事务日志的。我使用的是 DB 存储。")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("## transaction log store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" only used in seata-server\nstore "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ## store mode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" file、db、redis\n  mode = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),s._v("\n\n  ## file store property\n  file "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ## store location dir\n    dir = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sessionStore"')]),s._v("\n    # branch session size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" if exceeded first try compress lockkey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" still exceeded throws exceptions\n    maxBranchSessionSize = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n    # globe session size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" if exceeded throws exceptions\n    maxGlobalSessionSize = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("\n    # file buffer size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" if exceeded allocate new buffer\n    fileWriteBufferCacheSize = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v("\n    # when recover batch read size\n    sessionReloadReadSize = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    # async"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sync\n    flushDiskMode = async\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  ## database store property\n  db "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ## the implement of javax.sql.DataSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.\n    datasource = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"druid"')]),s._v("\n    ## mysql/oracle/postgresql/h2/oceanbase etc.\n    dbType = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql"')]),s._v("\n    driverClassName = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.mysql.cj.jdbc.Driver"')]),s._v("\n    url = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdbc:mysql://0.0.0.0:3306/seata?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai"')]),s._v("\n    user = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql@dev.2020"')]),s._v("\n    minConn = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    maxConn = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n    globalTable = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"global_table"')]),s._v("\n    branchTable = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"branch_table"')]),s._v("\n    lockTable = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock_table"')]),s._v("\n    queryLimit = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    maxWait = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  ## redis store property\n  redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    host = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v("\n    port = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6379"')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    database = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n    minConn = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    maxConn = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n    queryLimit = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("修改 seata/conf/registry.conf 文件，这个文件是用来修改 seata-server 的注册方式，你可以把 seata-server 单独当成一个服务，但既然是服务那么是不是要考虑一个 seata-server  蹦了怎么办？所以这里提供了集群的注册方式。")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 这里是服务注册，默认是file，也就是单机，我这里使用了nacos服务管理\nregistry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa\n  type = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n\n  nacos "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    application = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"seata-server"')]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.200.89:8848"')]),s._v("\n    group = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SEATA_GROUP"')]),s._v("\n    namespace = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    username = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos@root@2020"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  eureka "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serviceUrl = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8761/eureka"')]),s._v("\n    application = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    weight = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:6379"')]),s._v("\n    db = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    timeout = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  zk "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2181"')]),s._v("\n    sessionTimeout = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6000")]),s._v("\n    connectTimeout = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n    username = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  consul "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:8500"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  etcd3 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:2379"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  sofa "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9603"')]),s._v("\n    application = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    region = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DEFAULT_ZONE"')]),s._v("\n    datacenter = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DefaultDataCenter"')]),s._v("\n    cluster = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n    group = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SEATA_GROUP"')]),s._v("\n    addressWaitTime = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  file "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file.conf"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# 配置文件读取的方式，默认也是file(file.conf)，读取的本地文件，我们使用nacos，让他读取nacos上的配置"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以上面配置的 file.conf里的内容基本没用。\nconfig "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  # file、nacos 、apollo、zk、consul、etcd3\n  type = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n\n  nacos "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.200.89:8848"')]),s._v("\n    namespace = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    group = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SEATA_GROUP"')]),s._v("\n    username = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos"')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nacos@root@2020"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  consul "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:8500"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  apollo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    appId = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"seata-server"')]),s._v("\n    apolloMeta = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.1.204:8801"')]),s._v("\n    namespace = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  zk "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:2181"')]),s._v("\n    sessionTimeout = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6000")]),s._v("\n    connectTimeout = "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n    username = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    password = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  etcd3 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    serverAddr = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:2379"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  file "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file.conf"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br")])]),t("p",[s._v("到这里基本的 seata-server 就算是配置好了。 注意我代码里也有文字说明。")]),s._v(" "),t("h2",{attrs:{id:"创建-seata-数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-seata-数据库"}},[s._v("#")]),s._v(" 创建 seata 数据库")]),s._v(" "),t("p",[s._v("TC 全局事务会话信息由 3 块内容构成，全局事务 --\x3e 分支事务 --\x3e 全局锁，对应表 global_table、branch_table、lock_table。"),t("br"),s._v(" "),t("a",{attrs:{href:"https://github.com/seata/seata/blob/1.2.0/script/server/db/mysql.sql",target:"_blank",rel:"noopener noreferrer"}},[s._v("表结构"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"nacos-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nacos-配置"}},[s._v("#")]),s._v(" nacos 配置")]),s._v(" "),t("p",[s._v("对于 nacos 还不会的小伙伴可以看我之前写的 nacos 文章")]),s._v(" "),t("p",[s._v("nacos 搭建好了之后，我们需要把在 seata/conf/registry.conf 里写的 config 内容配置到 nacos 里，步骤如下：")]),s._v(" "),t("ol",[t("li",[s._v("随便在一个文件下建 setat-config 文件夹，然后在  setat-config/nacos/nacos-config.sh，具体内容如下：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright 1999-2019 Seata.io Group.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Licensed under the Apache License, Version 2.0 (the "License");')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you may not use this file except in compliance with the License.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You may obtain a copy of the License at、")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      http://www.apache.org/licenses/LICENSE-2.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unless required by applicable law or agreed to in writing, software")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# distributed under the License is distributed on an "AS IS" BASIS,')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See the License for the specific language governing permissions and")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limitations under the License.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("getopts")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":h:p:g:t:"')]),s._v(" opt\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n  h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tenant")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ?"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" USAGE OPTION: '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(' [-h host] [-p port] [-g group] [-t tenant] "')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${host}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("localhost\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${group}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SEATA_GROUP"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tenant}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tenant")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nacosAddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$port")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("contentType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"content-type:application/json;charset=UTF-8"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"set nacosAddr='),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nacosAddr")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"set group='),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$group")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failCount")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tempLog")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mktemp -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("addConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("/nacos/v1/cs/configs?dataId="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("&group="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$group")]),s._v("&content="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),s._v("&tenant="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$tenant")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tempLog}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tempLog}")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" Please check the cluster status. "')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tempLog}")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Set '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),s._v(' successfully "')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Set '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("="),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),s._v(' failure "')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" failCount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("line")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("dirname "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/config.txt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" s/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":space:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("//g"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${line"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%%")]),s._v("=*}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${line"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("*=}")]),s._v("\n\taddConfig "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${contentType}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${nacosAddr}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${key}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${value}")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"========================================================================="')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" Complete initialization parameters,  total-count:'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$count")]),s._v(" ,  failure-count:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$failCount")]),s._v(' "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"========================================================================="')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${failCount}")]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" Init nacos config finished, please start seata-server. "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" init nacos config fail. "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br")])]),t("p",[s._v("配置内容来自："),t("a",{attrs:{href:"https://github.com/seata/seata/tree/1.2.0/script/config-center/nacos",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里 seata config-center"),t("OutboundLink")],1),t("br"),s._v("\n2. 创建 setat-config/config.txt，内容如下：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("service.vgroupMapping.my_test_tx_group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("default")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("db")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.datasource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("druid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.dbType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("mysql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.driverClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("com.mysql.cj.jdbc.Driver")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("jdbc:mysql://0.0.0.0:3306/seata?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("dev")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("mysql@dev.2020")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.minConn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.maxConn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.globalTable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("global_table")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.branchTable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("branch_table")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.queryLimit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.lockTable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("lock_table")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("store.db.maxWait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("运行 nacos-config.sh")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" nacos-config.sh -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.89 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("-h naocs 的地址"),t("br"),s._v("\n会得到如下效果：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/spring/cloud/8/img.png",alt:""}})]),s._v(" "),t("p",[s._v("接下来只需要 启动 seata-server 服务，然后能在 nacos 服务列表中看到 seata-server 就算搭建完成。后面我会先搭建一个 多数据源的事务处理。")]),s._v(" "),t("p",[s._v("官方提供："),t("br"),s._v("\nSeata 整合教程:"),t("a",{attrs:{href:"https://www.bilibili.com/video/BV1tz411z7BX/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.bilibili.com/video/BV1tz411z7BX/"),t("OutboundLink")],1),t("br"),s._v("\n 文字版教程"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s/2KSidJ72YsovpJ94P1aK1g",target:"_blank",rel:"noopener noreferrer"}},[s._v(" https://mp.weixin.qq.com/s/2KSidJ72YsovpJ94P1aK1g"),t("OutboundLink")],1),t("br"),s._v("\nspringcloud 整合 demo："),t("br"),s._v(" "),t("a",{attrs:{href:"https://gitee.com/itCjb/spring-cloud-alibaba-seata-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://gitee.com/itCjb/spring-cloud-alibaba-seata-demo"),t("OutboundLink")],1),t("br"),s._v(" "),t("a",{attrs:{href:"https://github.com/lightClouds917/springcloud-eureka-feign-mybatis-seata-v100",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/lightClouds917/springcloud-eureka-feign-mybatis-seata-v100"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);