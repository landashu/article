(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{570:function(s,a,t){"use strict";t.r(a);var n=t(41),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("https://dev.mysql.com/doc/refman/8.0/en/replication.html 官方地址，我这里使用的是 Mysql8.0.2")])]),s._v(" "),t("p",[s._v("主从复制的优点：")]),s._v(" "),t("ul",[t("li",[s._v("横向扩展解决方案，在多个副本之间分散负载以提高性能。在此环境中，所有写入和更新都必须在主服务器上进行。然而，读取可能发生在一个或多个副本上。该模型可以提高写入性能（因为主专用于更新），同时显着提高越来越多的副本的读取速度。")]),s._v(" "),t("li",[s._v("数据安全，因为副本可以暂停复制过程，所以可以在副本上运行备份服务而不会破坏相应的主数据。")]),s._v(" "),t("li",[s._v("分析，可以在主上创建实时数据，而信息分析可以在副本上进行，而不会影响源的性能。")]),s._v(" "),t("li",[s._v("远程数据分发，可以使用复制创建本地数据副本供远程站点使用，而无需永久访问主服务。")])]),s._v(" "),t("p",[s._v("Mysql 8.0 支持多种复制计数，可以从二进制日志复制，也可以 GTID（全局事务）标识复制，也可以多主复制等，更多方法可以从官网中查看，这里我们根据 GTID 复制。GTID 依赖于事务，也就是说其他引擎是没办法复制的")]),s._v(" "),t("p",[s._v("在主服务器配置 my.cnf 中配置如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server_id 必须在复制中唯一")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主从复制所需")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gtid_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\nenforce-gtid-consistency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("在从服务器配置的 my.cng 中配置如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主从复制所需")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gtid_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\nenforce-gtid-consistency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动每个副本 ，以确保在配置副本设置之前不会启动复制")]),s._v("\nskip-slave-start"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定复制的数据库")]),s._v("\nreplicate-do-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过滤复制的数据库")]),s._v("\nreplicate-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("iedp:wiedp_sub:wiedp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("启动主服务器，添加一个让子服务器连接的账号和密码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建用户")]),s._v("\nCREATE "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" repl@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.240.30.%'")]),s._v(" IDENTIFIED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl@password'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权")]),s._v("\nGRANT REPLICATION SLAVE ON *.* TO repl@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.240.30.%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("启动从服务器，并输入如下语句")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("CHANGE MASTER TO\n    MASTER_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.240.30.101'")]),s._v(",\n    MASTER_PORT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(",\n    MASTER_USER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v(",\n    MASTER_PASSWORD "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Repl@123'")]),s._v(",\n    MASTER_AUTO_POSITION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("注意要复制的库在从库不能存在，否则会报错，在从库执行如下命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" START SLAVE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("主从复制结束。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意事项："),t("br"),s._v("\n从库可以删除同步的数据和表以及被同步的库；"),t("br"),s._v("\n从库删除的数据、表、库，在主库添加数据时从库无法恢复；"),t("br"),s._v("\n从库在首次复制不能拥有要复制的库，否则报错；"),t("br"),s._v("\n从库主动删除的数据无法恢复，只能拥有未被复制过的数据；")])]),s._v(" "),t("p",[s._v("如果想动态设置需要复制的库，可以通过如下命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要先停止之前复制线程")]),s._v("\nSTOP SLAVE SQL_THREAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新设置要复制哪些库，replicate_ignore_db（不复制的库）")]),s._v("\nCHANGE REPLICATION filter "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("replicate_do_db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test_1,test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新启动复制线程")]),s._v("\nstart slave sql_thread"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);