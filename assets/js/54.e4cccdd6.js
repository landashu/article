(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{532:function(s,n,a){"use strict";a.r(n);var e=a(41),r=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img.png",alt:""}})]),s._v(" "),a("p",[s._v("大致流程说明："),a("br"),s._v("\n1. 开发人员每天把代码提交到 Gitlab 代码仓库"),a("br"),s._v("\n 2.Jenkins 从 Gitlab 中拉取项目源码，编译并打成 jar 包，然后构建成 Docker 镜像，将镜像上传到 Harbor 私有仓库。"),a("br"),s._v("\n3.Jenkins 发送 SSH 远程命令，让生产部署服务器到 Harbor 私有仓库拉取镜像到本地，然后创建容器。"),a("br"),s._v("\n4. 最后，用户可以访问到容器")]),s._v(" "),a("blockquote",[a("p",[s._v("这里不讲述 Docker 的安装及基础命令的使用，学 dockers 可以看 "),a("a",{attrs:{href:"https://www.jianshu.com/p/3ddf764da036",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 概念、命令、DockerFile 等看这篇就够了"),a("OutboundLink")],1),s._v(" 这篇文章")])]),s._v(" "),a("h2",{attrs:{id:"harbor-镜像仓库安装及使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor-镜像仓库安装及使用"}},[s._v("#")]),s._v(" Harbor 镜像仓库安装及使用")]),s._v(" "),a("p",[s._v("Harbor（港口，港湾）是一个用于存储和分发 Docker 镜像的企业级 Registry 服务器。除了 Harbor 这个私有镜像仓库之外，还有 Docker 官方提供的 Registry。相对 Registry，Harbor 具有很多优势：")]),s._v(" "),a("ol",[a("li",[s._v("提供分层传输机制，优化网络传输 Docker 镜像是是分层的，而如果每次传输都使用全量文件 (所以"),a("br"),s._v("\n用 FTP 的方式并不适合)，显然不经济。必须提供识别分层传输的机制，以层的 UUID 为标识，确定"),a("br"),s._v("\n传输的对象。")]),s._v(" "),a("li",[s._v("提供 WEB 界面，优化用户体验 只用镜像的名字来进行上传下载显然很不方便，需要有一个用户界"),a("br"),s._v("\n面可以支持登陆、搜索功能，包括区分公有、私有镜像。")]),s._v(" "),a("li",[s._v("支持水平扩展集群 当有用户对镜像的上传下载操作集中在某服务器，需要对相应的访问压力作分"),a("br"),s._v("\n解。")]),s._v(" "),a("li",[s._v("良好的安全机制 企业中的开发团队有很多不同的职位，对于不同的职位人员，分配不同的权限，"),a("br"),s._v("\n具有更好的安全性。")])]),s._v(" "),a("h3",{attrs:{id:"harbor-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor-安装"}},[s._v("#")]),s._v(" Harbor 安装")]),s._v(" "),a("ol",[a("li",[s._v("除了 docker 以外，还要安装 dockers-compose，"),a("a",{attrs:{href:"https://www.jianshu.com/p/d6a670aa90a3",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Compose 命令及使用"),a("OutboundLink")],1),s._v(" 你可以看这篇博客")]),s._v(" "),a("li",[s._v("下载 Harbor 的压缩包，"),a("a",{attrs:{href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("地址"),a("OutboundLink")],1),s._v("，需要科式上网，下载完成开始解压")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tar -xzf harbor-offline-installer-v1.9.2.tgz\nmv harbor /opt/software/\n# 修改配置文件内容\nvim /opt/software/harbor/harbor.yml \n# 修改hostname\nhostname: 你自己机器的IP\n# 修改端口\nport: 85\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("安装 Harbor")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /opt/software/harbor\n./prepare\n./install.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("启动 Harbor")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose up -d 启动\ndocker-compose stop 停止\ndocker-compose restart 重新启动\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("访问 Harbor http://IP:85，默认账户密码：admin/Harbor12345")])]),s._v(" "),a("h3",{attrs:{id:"harbor-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor-使用"}},[s._v("#")]),s._v(" Harbor 使用")]),s._v(" "),a("p",[s._v("1. 创建项目"),a("br"),s._v("\n Harbor 的项目分为公开和私有的：")]),s._v(" "),a("ul",[a("li",[s._v("公开项目：所有用户都可以访问，通常存放公共的镜像，默认有一个 library 公开项目。")]),s._v(" "),a("li",[s._v("私有项目：只有授权用户才可以访问，通常存放项目本身的镜像。")])]),s._v(" "),a("p",[s._v("我们可以为微服务项目创建一个新的项目：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_1.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_2.png",alt:""}})]),s._v(" "),a("p",[s._v("2. 用户创建")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_3.png",alt:""}})]),s._v(" "),a("p",[s._v("3. 为用户分配项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_4.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_5.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"推送到镜像仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送到镜像仓库"}},[s._v("#")]),s._v(" 推送到镜像仓库")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 打标签，命令 docker tag nginx:1.17.1 Harbor的IP:端口/Harbor项目的名称/镜像名字\ndocker tag nginx:1.17.1 192.168.81.102:85/test/nginx:1.17.1\n# 查看\ndocker images\n# 会多一条镜像数据\n192.168.81.102:85/test/nginx         1.17.1                          98ebf73aba75        2 years ago         109MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("把 Harbor 地址加入到 Docker 信任列表")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 编辑docker文件\nvim /etc/docker/daemon.json\n# 加入这句话\n"insecure-registries":["192.168.81.102:85"],\n# 重启配置和docker\nsystemctl restart docker\n# Harbor  的 test 项目是私有的，需要登录\ndocker login -u admin -p Harbor12345 192.168.81.102:85\n# 推送到Harbor仓库里\ndocker push 192.168.81.102:85/test/nginx\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_6.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_7.png",alt:""}})]),s._v(" "),a("p",[s._v("其他服务下载镜像也需要把地址添加到 docker 的配置文件中，并且也需要使用 docker login 进行登录。复制以下的命令，到其他服务器下执行即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_8.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"微服务构建到docker镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微服务构建到docker镜像"}},[s._v("#")]),s._v(" 微服务构建到 docker 镜像")]),s._v(" "),a("p",[s._v("1. 把微服务提交到 SVN"),a("br"),s._v("\n2. 在 jenkins 上创建一个 Pipelin 类型的 item（项目）"),a("br"),s._v("\n3. 配置 Pipelin item 的构建时参数")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_9.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_10.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_11.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("这里讲一点，项目中很多的 jar 是有依赖关系的，如果单独打某个服务可能会包找不到依赖，所以建议第一次对根目录进行打包，会把依赖全部加载到 maven 库中，后期单个服务打包即可。")])]),s._v(" "),a("p",[s._v("4. 在每个服务的 pom 文件中添加 plugin")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\x3c!-- 帮助读取项目中的dockerfile文件，帮我们构建docker镜像 --\x3e\n<plugin>\n    <groupId>com.spotify</groupId>\n    <artifactId>dockerfile-maven-plugin</artifactId>\n    <version>1.3.6</version>\n    <configuration>\n        <repository>${project.artifactId}</repository>\n        \x3c!-- 定义dockerfile 文件的参数 --\x3e\n        <buildArgs>\n            \x3c!-- 定义一个 JAVA_FILE 参数,指为我们项目的名称 --\x3e\n            <JAR_FILE>target/${project.build.finalName}.jar</JAR_FILE>\n        </buildArgs>\n    </configuration>\n</plugin>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("5. 在每个服务的根目录下编写 Dockerfile 文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM openjdk:8-jdk-alpine\n# 这个会读取在pom中声明的变量\nARG JAR_FILE\nCOPY ${JAR_FILE} app.jar\n# 对外端口\nEXPOSE 10086\nENTRYPOINT ["java","-jar","/app.jar"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("6. 设置构建后镜像推至镜像仓库")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_12.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_13.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_14.png",alt:""}})]),s._v(" "),a("p",[s._v("7. 在项目的根目录中编写 Jenkinsfile")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('node {\n    // 版本\n    def tag = "1.0"\n    // 镜像仓库的地址\n    def harbor_url = "192.168.81.102:85"\n    // 镜像仓库的项目,这里建议项目名称和jenkins的item项目名称、以及harbor的项目名称保持一致，否则用一下脚本会出问题\n    def harbor_project = "demo"\n\n    // 拉取代码\n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // 编译并推送镜像仓库\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'打包根目录\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "打包子目录 ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "把jar上传镜像仓库"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // 改名称 做规范\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // 删除之前的 镜像\n        sh "docker rmi ${oldImageName}"\n        // 推送到 dockers仓库\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // 登录\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // 上传\n            sh "docker push ${newImageName}"\n            echo "镜像推送成功"\n        }\n    }\n    // 发送邮件\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(本邮件是程序自动下发的，请勿回复！)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">构建结果 - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">构建信息</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>项目名称&nbsp;：&nbsp;${PROJECT_NAME}</li>\n                        <li>构建编号&nbsp;：&nbsp;第${BUILD_NUMBER}次构建</li>\n                        <li>触发原因：&nbsp;${CAUSE}</li>\n                        <li>构建日志：&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>构建&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>工作目录&nbsp;：&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>项目&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>历史变更记录 : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">构建日志 (最后 100行):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br")])]),a("h2",{attrs:{id:"jenkins自动化服务拉取镜像并启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins自动化服务拉取镜像并启动"}},[s._v("#")]),s._v(" jenkins 自动化服务拉取镜像并启动")]),s._v(" "),a("p",[s._v("这部操作需要安装一个 Publish Over SSH 插件，安装好后在 Manager Jenkins -> Configure System 进行配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_15.png",alt:""}})]),s._v(" "),a("p",[s._v("更改 Jenkinsfile 脚本，添加远程机器拉取镜像并启动容器，具体语法怎么使用，可以到 流水线语法中查看")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_16.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('node {\n    // 版本\n    def tag = "1.0"\n    // 镜像仓库的地址\n    def harbor_url = "192.168.81.102:85"\n    // 镜像仓库的项目,这里建议项目名称和jenkins的item项目名称、以及harbor的项目名称保持一致，否则用一下脚本会出问题\n    def harbor_project = "demo"\n\n    // 拉取代码\n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // 编译并推送镜像仓库\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'打包根目录\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "打包子目录 ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "把jar上传镜像仓库"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // 改名称 做规范\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // 删除之前的 镜像\n        sh "docker rmi ${oldImageName}"\n        // 推送到 dockers仓库\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // 登录\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // 上传\n            sh "docker push ${newImageName}"\n            echo "镜像推送成功"\n        }\n\n        // 远程调用脚本,port 最好也添加 jenkins项目配置里的参数配置，作为参数传进来\n        echo "执行远程命令 /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n        sshPublisher(publishers: [sshPublisherDesc(configName: \'test_103\', transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: \'[, ]+\', remoteDirectory: \'\', remoteDirectorySDF: false, removePrefix: \'\', sourceFiles: \'\')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\n    }\n    // 发送邮件\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(本邮件是程序自动下发的，请勿回复！)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">构建结果 - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">构建信息</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>项目名称&nbsp;：&nbsp;${PROJECT_NAME}</li>\n                        <li>构建编号&nbsp;：&nbsp;第${BUILD_NUMBER}次构建</li>\n                        <li>触发原因：&nbsp;${CAUSE}</li>\n                        <li>构建日志：&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>构建&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>工作目录&nbsp;：&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>项目&nbsp;&nbsp;Url&nbsp;：&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>历史变更记录 : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">构建日志 (最后 100行):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br")])]),a("p",[s._v("重新构建，其他服务器就会自动拉取了。")]),s._v(" "),a("blockquote",[a("p",[s._v("其他服务器一定要有 jenkins 服务器的公钥，构建过程 SSH 不会输出任何信息只会告诉你 EXEC 执行了多久，需要自己去测一下。")])]),s._v(" "),a("h2",{attrs:{id:"vue-前端使用jenkins部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-前端使用jenkins部署"}},[s._v("#")]),s._v(" vue 前端使用 Jenkins 部署")]),s._v(" "),a("p",[s._v("1. 首先需要安装 NodeJS 插件"),a("br"),s._v("\n 2. 到 Manager Jenkins->Global Tool Configuration->NodeJS")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/img/jenkins/506/img_17.png",alt:""}})]),s._v(" "),a("p",[s._v("3. 创建一个流水线的前端项目，根据脚本把配置补全")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node {\n    stage('拉取代码') {\n        checkout([$class: 'GitSCM', branches: [[name: '*/${branch}']], extensions: [], userRemoteConfigs: [[credentialsId: '80dfe5c5-1684-47b1-a410-6f53ceb3c543', url: 'http://192.168.81.15:3000/biguncle/test_vue.git']]])\n    }\n    stage('打包，部署网站') {\n        //使用NodeJS的npm进行打包，这个和 以上的 name 保持一致\n        nodejs('nodejs12'){\n            sh '''\n                npm install\n                npm run build\n            '''\n        }\n        //=====以下为远程调用进行项目部署========\n        sshPublisher(publishers: [sshPublisherDesc(configName: 'master_server',transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '',execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes:false, patternSeparator: '[, ]+', remoteDirectory: '/usr/share/nginx/html',remoteDirectorySDF: false, removePrefix: 'dist', sourceFiles: 'dist/**')],usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("从脚本中可以看出，我们需要一个 branch 参数，还要配置 前端项目的 远程 server 地址")]),s._v(" "),a("blockquote",[a("p",[s._v("这里没有使用 execCommand 的命令，而是通过 sourceFiles、removePrefix、remoteDirectory，sourceFiles 代表我们 copy 哪个文件，remoteDirectory 远程目录，特就是 copy 到 nginx 所在目录"),a("br"),s._v("\n 57-62")])])])}),[],!1,null,null,null);n.default=r.exports}}]);