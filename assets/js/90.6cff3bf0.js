(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{567:function(s,a,n){"use strict";n.r(a);var t=n(41),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived"}},[s._v("#")]),s._v(" keepalived")]),s._v(" "),n("h3",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("p",[s._v("官方地址 "),n("a",{attrs:{href:"https://www.keepalived.org/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("keepalived 下载地址"),n("OutboundLink")],1),s._v("，选择指定的版本后我们就开始下载")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://www.keepalived.org/software/keepalived-2.1.5.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("解压缩")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf keepalived-2.1.5.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("进行 configure 配置，指定安装目录：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" keepalived-1.3.4 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/keepalived-2.1.5/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("编译安装")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("如果安装出现什么问题，一般都是缺少了环境，只要看报错信息 yum install 相关环境就 o 了")])]),s._v(" "),n("h3",{attrs:{id:"keepalived-文件介绍-必须理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-文件介绍-必须理解"}},[s._v("#")]),s._v(" keepalived 文件介绍 (必须理解)")]),s._v(" "),n("h4",{attrs:{id:"keepalived-启动脚本文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-启动脚本文件"}},[s._v("#")]),s._v(" keepalived  启动脚本文件")]),s._v(" "),n("p",[s._v("keepalived 的启动脚本文件所在")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/home/keepalived-2.1.5/keepalived/etc/init.d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("启动脚本文件代码")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Startup script for the Keepalived daemon      Keepalived 守护进程启动脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# processname: keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pidfile: /var/run/keepalived.pid  keepalived.pid  路径")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# config: /etc/keepalived/keepalived.conf  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chkconfig: - 21 79")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# description: Start and stop Keepalived 启动或者停止Keepalived")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Source function library 指定源函数库位置(这个文件本身linux自带不需要我们管)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /etc/rc.d/init.d/functions\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Source configuration file (we set KEEPALIVED_OPTIONS there)  源配置文件（该文件设置 KEEPALIVED_OPTIONS 的参数） 这个文件需要我们自己移动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /etc/sysconfig/keepalived\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回值 默认0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("prog")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keepalived"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n    daemon keepalived "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KEEPALIVED_OPTIONS}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $? 执行上一个指令的返回值 (显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RETVAL")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /var/lock/subsys/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("stop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n    killproc keepalived\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RETVAL")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f /var/lock/subsys/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -n $"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Reloading '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(': "')]),s._v("\n    killproc keepalived -1\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See how we were called.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n    start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        start\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    stop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        stop\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    reload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        reload\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    restart"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        stop\n        start\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    condrestart"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f /var/lock/subsys/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$prog")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            stop\n            start\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        status keepalived\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(' {start|stop|reload|restart|condrestart|status}"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RETVAL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RETVAL")]),s._v("          \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br")])]),n("p",[s._v("可以看出提供了启动，暂停，重启这些命令。")]),s._v(" "),n("h4",{attrs:{id:"keepalived-启动参数文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-启动参数文件"}},[s._v("#")]),s._v(" keepalived  启动参数文件")]),s._v(" "),n("p",[s._v("这里的启动参数文件相当于以上的  KEEPALIVED_OPTIONS 。是启动文件里的 . /etc/sysconfig/keepalived 文件。源文件在")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/home/keepalived-2.1.5/keepalived/etc/sysconfig\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("我们查看一下内容")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Options for keepalived. See `keepalived --help' output and keepalived(8) and")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keepalived.conf(5) man pages for a list of all options. Here are the most")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# common ones :")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里是启动常用参数 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --vrrp               -P    Only run with VRRP subsystem. 仅与VRRP子系统一起运行。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --check              -C    Only run with Health-checker subsystem. 仅与运行状况检查子系统一起运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --dont-release-vrrp  -V    Dont remove VRRP VIPs & VROUTEs on daemon stop. 不要在守护进程停止时删除VRRP VIP和VROUTEs。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --dont-release-ipvs  -I    Dont remove IPVS topology on daemon stop. 不要在守护进程停止时删除IPVS拓扑。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --dump-conf          -d    Dump the configuration data. 转储配置数据。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --log-detail         -D    Detailed log messages. 详细的日志消息。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --log-facility       -S    0-7 Set local syslog facility (default=LOG_DAEMON) 0-7设置本地syslog工具（默认值=LOG_DAEMON）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里就是设置启动参数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KEEPALIVED_OPTIONS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-D"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("这个文件主要是为了保存 keepalived  的启动参数，要不然你启动一次，下次你启动你还记得你输入过的参数嘛？那启动参数具体有哪些？继续往下看。")]),s._v(" "),n("h4",{attrs:{id:"keepalived-启动文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-启动文件"}},[s._v("#")]),s._v(" keepalived  启动文件")]),s._v(" "),n("p",[s._v("位置如下")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/home/keepalived-2.1.5/keepalived\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看启动参数")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./keepalived -h")]),s._v("\nUsage: ./keepalived "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  -f, --use-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("FILE          使用指定的配置文件\n  -P, --vrrp                   仅与VRRP子系统一起运行\n  -C, --check                  仅与运行状况检查子系统一起运行\n      --all                    强制所有子进程运行，即使没有配置\n  -l, --log-console            将消息记录到本地控制台\n  -D, --log-detail             详细的日志消息\n  -S, --log-facility"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     将syslog facility设置为LOG_LOCAL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  -G, --no-syslog              不通过系统日志记录\n  -u, --umask"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MASK             "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("umask")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" creation "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in numeric form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -X, --release-vips           从信号机过渡时放下VIP。\n  -V, --dont-release-vrrp      不要在守护进程停止时删除VRRP VIP和VRRoute\n  -I, --dont-release-ipvs      在守护进程停止时不删除IPV拓扑\n  -R, --dont-respawn           不要重新生成子进程\n  -n, --dont-fork              不要分叉守护进程\n  -d, --dump-conf              转储配置数据\n  -p, --pid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("FILE               为父进程使用指定的pidfile\n  -r, --vrrp_pid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("FILE          为VRRP子进程使用指定的PID文件\n  -c, --checkers_pid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("FILE      对checkers子进程使用指定的pidfile\n  -a, --address-monitoring     报告通过netlink通知的所有地址添加/删除\n  -s, --namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NAME         在网络命名空间名称中运行（重写配置）\n  -m, --core-dump              异常终止时产生堆芯转储\n  -M, --core-dump-pattern"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PATN Also "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" /proc/sys/kernel/core_pattern to PATN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'core'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -i, --config-id "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("           Skip any configuration lines beginning "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@'")]),s._v(" that don't match "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n                                or any lines beginning @^ that "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" match.\n                                The config-id defaults to the "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" option not used\n      --signum"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SIGFUNC         Return signal number "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" STOP, RELOAD, DATA, STATS, STATS_CLEAR\n  -t, --config-test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LOG_FILE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Check the configuration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" obvious errors, output to\n                                stderr by default\n  -v, --version                Display the version number\n  -h, --help                   Display this "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" message\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h4",{attrs:{id:"keepalived-conf-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-conf-配置文件"}},[s._v("#")]),s._v(" keepalived .conf 配置文件")]),s._v(" "),n("p",[s._v("文件路径")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/home/keepalived-2.1.5/keepalived/etc/keepalived\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("文件内容简介")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("# 全局配置\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   # 指定keepalived在发生切换时需要发送email到的对象，一行一个邮件地址\n   notification_email "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   # 指定发件人\n   notification_email_from Alexandre.Cassen@firewall.loc\n   # 指定smtp服务器地址\n   smtp_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.1")]),s._v("\n   # 指定smtp连接超时时间\n   smtp_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n   # 运行keepalived机器的一个标识"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("必须唯一\n   router_id LVS_DEVEL\n\n   vrrp_skip_check_adv_addr\n   vrrp_strict\n   vrrp_garp_interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   vrrp_gna_interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n#vrrp 实例部分定义，VI_1自定义名称\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # 指定 keepalived 的角色，必须大写 可选值：MASTER|BACKUP\n    state MASTER\n    # 网卡设置，lvs需要绑定在网卡上，RealServer 绑定在回环口。区别：lvs对访问为外，realserver为内不易暴露本机信息\n    interface eth0\n    # 虚拟路由标识，是一个数字，同一个vrrp 实例使用唯一的标识，MASTER和BACKUP 的 同一个 vrrp_instance 下 这个标识必须保持一致\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    # 定义优先级，数字越大，优先级越高。\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    # 设定 MASTER 与 BACKUP 负载均衡之间同步检查的时间间隔，单位为秒，两个节点设置必须一样\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    # 设置验证类型和密码，两个节点必须一致\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    # 设置虚拟IP地址，可以设置多个虚拟IP地址，每行一个\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.16")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.17")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.18")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     # 当前节点成为master时，通知脚本执行任务\n    # notify_master "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/start_haproxy.sh start"')]),s._v(" \n    # 当前节点成为backup时，通知脚本执行任务\n    # notify_backup "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/start_haproxy.sh stop"')]),s._v("\n    # 当当前节点出现故障，执行的任务;\n    # notify_fault  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/start_haproxy.sh stop"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# 定义RealServer 对应的VIP及服务端口，IP和端口之间用空格隔开\nvirtual_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.16")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1358")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # 健康检查时间间隔\n    delay_loop "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n    # lvs调度算法rr wrr lc wlc lblc sh dh\n    lb_algo rr\n    # 负载均衡转发规则 NAT DR RUN\n    lb_kind NAT\n    # 同一IP的连接"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("秒内被分配到同一台realserver\n    persistence_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n    # 使用的协议\n    protocol TCP\n    # 备用机，所有realserver失效后启用\n    sorry_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.200")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1358")]),s._v("\n\n    real_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1358")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        # 权重，最大越高，lvs就越优先访问\n        weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        # keepalived的健康检查方式HTTP_GET | SSL_GET | TCP_CHECK | SMTP_CHECK | MISC\n        HTTP_GET "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /testurl/test.jsp\n              digest 640205b7b0fc66c1ea91c463fac6334d\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /testurl2/test.jsp\n              digest 640205b7b0fc66c1ea91c463fac6334d\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            # 要检测的URL，可以有多个\n            url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              # 具体路径\n              path /testurl3/test.jsp\n              # 检测效验码\n              digest 640205b7b0fc66c1ea91c463fac6334d\n              # 检测返回http状态码\n              status_code "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("         \n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            # "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("秒无响应超时\n            connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            # 重连次数"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("次\n            retry "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            # 重连间隔时间\n            delay_before_retry "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    real_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200.3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1358")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        HTTP_GET "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /testurl/test.jsp\n              digest 640205b7b0fc66c1ea91c463fac6334c\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /testurl2/test.jsp\n              digest 640205b7b0fc66c1ea91c463fac6334c\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            retry "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            delay_before_retry "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br")])]),n("blockquote",[n("p",[s._v("keepalived 文件分为 4 种，启动脚本文件、启动参数文件、keepalived.conf 文件、启动文件。他们的执行关系是 启动脚本文件 -> 找到启动参数文件 -> 启动参数文件里描述了 keepalived.conf 的路径和日志等指令 -> 然后交给启动文件执行 (真实启动)。")])]),s._v(" "),n("h3",{attrs:{id:"keepalived-启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-启动"}},[s._v("#")]),s._v(" keepalived 启动")]),s._v(" "),n("p",[s._v("启动")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("./keepalived -f /home/keepalived-2.1.5/keepalived/etc/keepalived/keepalived.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("快捷启动")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/keepalived-2.1.5/keepalived/etc/init.d/keepalived /etc/init.d/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/keepalived-2.1.5/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/keepalived-2.1.5/keepalived/etc/sysconfig/keepalived /etc/sysconfig/keepalived\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" keepalived "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" stop "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" reload "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" restart "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("keepalived 日志默认在")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/var/log/messages\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("没有配置正确的 keepalived.conf 启动会提示成功，但实际没有启动，需要自己去改配置。 keepalived 日志信息需要仔细阅读才能找到问题。")]),s._v(" "),n("h2",{attrs:{id:"nginx高可用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx高可用"}},[s._v("#")]),s._v(" nginx 高可用")]),s._v(" "),n("h3",{attrs:{id:"环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("IP")]),s._v(" "),n("th",[s._v("配置")]),s._v(" "),n("th",[s._v("VIP")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("10.240.30.102")]),s._v(" "),n("td",[s._v("keepalived + nginx")]),s._v(" "),n("td",[s._v("10.240.30.103")])]),s._v(" "),n("tr",[n("td",[s._v("10.240.30.100")]),s._v(" "),n("td",[s._v("keepalived + nginx")]),s._v(" "),n("td",[s._v("10.240.30.103")])])])]),s._v(" "),n("p",[s._v("配置和安装这里我就不说了")]),s._v(" "),n("h3",{attrs:{id:"修改配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),n("h4",{attrs:{id:"nginx-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" nginx 配置")]),s._v(" "),n("p",[s._v("nginx 配置统一的就是 nginx 的欢迎页面，无非在上面加了各自的 IP 做为区别。")]),s._v(" "),n("h4",{attrs:{id:"_10-240-30-102-keepalived-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-240-30-102-keepalived-配置"}},[s._v("#")]),s._v(" 10.240.30.102 keepalived 配置")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("! Configuration File for keepalived\n\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # 同一组的广播地址\n    vrrp_mcast_group4 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("224.0")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.18")]),s._v("\n    router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface ens33\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        #  虚拟IP必须是同一个网段下\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.103")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h4",{attrs:{id:"_10-240-30-100-keepalived-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-240-30-100-keepalived-配置"}},[s._v("#")]),s._v(" 10.240.30.100 keepalived 配置")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("! Configuration File for keepalived\n\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # 同一组的广播地址\n   vrrp_mcast_group4 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("224.0")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.18")]),s._v("\n   router_id LVS_DEVEL\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state BACKUP\n    interface ens33\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        #  虚拟IP必须是同一个网段下\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.103")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h4",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("p",[n("img",{attrs:{src:"/assets/img/nginx/3/img.png",alt:""}})]),s._v(" "),n("p",[s._v("关闭 10.230.30.102 的 keepalived，在访问")]),s._v(" "),n("p",[n("img",{attrs:{src:"/assets/img/nginx/3/img_1.png",alt:""}})]),s._v(" "),n("p",[s._v("这里有个问题 10.230.30.100 不是即时顶上，我等了很久才可以访问。")]),s._v(" "),n("blockquote",[n("p",[s._v("网上有很多的检查 nginx 是否运行的脚，我这里只测试 keepalived 的高可用其余都不测试。")])]),s._v(" "),n("h3",{attrs:{id:"解决以上问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决以上问题"}},[s._v("#")]),s._v(" 解决以上问题")]),s._v(" "),n("p",[s._v("主备之间，只能有一台可以持有 VIP，我发现我这里两台都持有了 VIP，可以用以下命令查看")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ip a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("keepalived 的日志打的不是很细，我发现其中有一句，Receive advertisement timeout，主 可以理解，但 从 有这句话一定是有问题的。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Sep  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":26:23 localhost Keepalived_vrrp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7634")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VI_1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Receive advertisement "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v("\nSep  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":26:23 localhost Keepalived_vrrp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7634")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VI_1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Entering MASTER STATE\nSep  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":26:23 localhost Keepalived_vrrp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7634")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VI_1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" setting VIPs.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("最终查到是广播的问题")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定keepalived配置的网卡：ens33，固定的VRRP广播地址：224.0.0.18")]),s._v("\nfirewall-cmd --direct --permanent --add-rule ipv4 filter INPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --in-interface ens33 --destination "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("224.0")]),s._v(".0.18 --protocol vrrp -j ACCEPT\nfirewall-cmd --direct --permanent --add-rule ipv4 filter OUTPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --out-interface ens33 --destination "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("224.0")]),s._v(".0.18 --protocol vrrp -j ACCEPT\nfirewall-cmd --reload\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看配置的规则")]),s._v("\nfirewall-cmd --direct --get-rules ipv4 filter INPUT\nfirewall-cmd --direct --get-rules ipv4 filter OUTPUT\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("firewall-cmd --reload 会重新加载防火墙，导致你之前 iptables 的方式失效，需要重新在执行一遍 iptables 命令。")]),s._v(" "),n("blockquote",[n("p",[s._v("默认 当主挂掉之后，vip 会落到从上，当主启动之后，vip 会被抢回来。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);