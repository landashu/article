(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{629:function(a,s,t){"use strict";t.r(s);var e=t(41),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("blockquote",[t("p",[a._v("本文及后续所有文章都以 1.8.0 做为版本讲解和入门学习")])]),a._v(" "),t("h2",{attrs:{id:"什么是-flume"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-flume"}},[a._v("#")]),a._v(" 什么是 Flume")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flume/1/img.png",alt:""}})]),a._v(" "),t("p",[a._v("Flume 是由 Cloudera 软件公司提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，后与 2009 年被捐赠了 apache 软件基金会，为 hadoop 相关组件之一。尤其近几年随着 flume 的不断被完善以及升级版本的逐一推出，特别是 flume-ng; 同时 flume 内部的各种组件不断丰富，用户在开发的过程中使用的便利性得到很大的改善，现已成为 apache top 项目之一。")]),a._v(" "),t("p",[a._v("apache Flume 是一个从可以收集例如日志，事件等数据资源，并将这些数量庞大的数据从各项数据资源中集中起来存储的工具 / 服务。flume 具有高可用，分布式，配置工具，其设计的原理也是基于将数据流，如日志数据从各种网站服务器上汇集起来存储到 HDFS，HBase 等集中存储器中。")]),a._v(" "),t("h2",{attrs:{id:"flume特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flume特点"}},[a._v("#")]),a._v(" Flume 特点")]),a._v(" "),t("p",[a._v("1、可靠性：当节点出现故障时，日志能够被传送到其他节点上而不会丢失。Flume 提供了三种级别的可靠性保障，所有的数据以 event 为单位传输，从强到弱依次分别为：end-to-end（收到数据 agent 首先将 event 写到磁盘上，当数据传送成功后，再删除；如果数据发送失败，可以重新发送。），Store on failure（这也是 scribe 采用的策略，当数据接收方 crash 时，将数据写到本地，待恢复后，继续发送），Best effort（数据发送到接收方后，不会进行确认）。")]),a._v(" "),t("p",[a._v("2、可扩展性：Flume 采用了三层架构，分别为 agent，collector 和 storage，每一层均可以水平扩展。其中，所有 agent 和 collector 由 master 统一管理，这使得系统容易监控和维护，且 master 允许有多个（使用 ZooKeeper 进行管理和负载均衡），这就避免了单点故障问题。")]),a._v(" "),t("p",[a._v("3、可管理性：所有 agent 和 colletor 由 master 统一管理，这使得系统便于维护。多 master 情况，Flume 利用 ZooKeeper 和 gossip，保证动态配置数据的一致性。用户可以在 master 上查看各个数据源或者数据流执行情况，且可以对各个数据源配置和动态加载。Flume 提供了 web 和 shell script command 两种形式对数据流进行管理。")]),a._v(" "),t("p",[a._v("4、功能可扩展性：用户可以根据需要添加自己的 agent，collector 或者 storage。此外，Flume 自带了很多组件，包括各种 agent（file， syslog 等），collector 和 storage（file，HDFS 等）。")]),a._v(" "),t("p",[a._v("5、文档丰富，社区活跃：Flume 已经成为 Hadoop 生态系统的标配，它的文档比较丰富，社区比较活跃，方便我们学习。")]),a._v(" "),t("h2",{attrs:{id:"基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[a._v("#")]),a._v(" 基本概念")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flume/1/img_1.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"event"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#event"}},[a._v("#")]),a._v(" Event")]),a._v(" "),t("ul",[t("li",[a._v("Event 是 Flume 数据传输的基本单元，是数据，如果输入的是文本文件，event 是一行记录。")]),a._v(" "),t("li",[a._v("Flume 以事件 (Event) 的形式将数据从源头传输到最终的目的。")]),a._v(" "),t("li",[a._v("Event 由可选的 header 和载有数据的一个 byte array 构成。"),t("br"),a._v("\n载有的数据对 Flume 是不透明的。"),t("br"),a._v("\nHeader 是容纳了 key-value 字符串对的无序集合，key 在集合内是唯一的。"),t("br"),a._v("\nHeader 可以在上下文路由中使用扩展。")])]),a._v(" "),t("h3",{attrs:{id:"source"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#source"}},[a._v("#")]),a._v(" source")]),a._v(" "),t("ul",[t("li",[a._v("Source 负责接收 event 或通过特殊机制产生 event，并将 events 批量的放到一个或多个 Channel。")]),a._v(" "),t("li",[a._v("Source 包含 event 驱动和轮询两种类型。")]),a._v(" "),t("li",[a._v("Source 有不同的类型。"),t("br"),a._v("\n与系统集成的 Source：Syslog，NetCat。"),t("br"),a._v("\n自动生成事件的 Source：Exec 用于 Agent 和 Agent 之间的通信的 IPC Source：Avro、Thrift。")]),a._v(" "),t("li",[a._v("Source 必须至少和一个 Channel 关联。")])]),a._v(" "),t("h3",{attrs:{id:"channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#channel"}},[a._v("#")]),a._v(" channel")]),a._v(" "),t("ul",[t("li",[a._v("Channel 位于 Source 和 Sink 之间，用于缓存进来的 event。")]),a._v(" "),t("li",[a._v("当 Sink 成功的将 event 发送到下一跳的 Channel 或最终目的地，event 才 Channel 中移除。")]),a._v(" "),t("li",[a._v("不同的 Channel 提供的持久化水平也是不一样的："),t("br"),a._v("\nMemory Channel：volatile。"),t("br"),a._v("\nFile Channel：基于 WAL 实现。"),t("br"),a._v("\nJDBC Channel：基于嵌入 Database 实现。")]),a._v(" "),t("li",[a._v("Channel 支持事物，提供较弱的顺序保证。")]),a._v(" "),t("li",[a._v("Channel 可以和任何数量的 Source 和 Sink 工作。")])]),a._v(" "),t("h3",{attrs:{id:"sink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sink"}},[a._v("#")]),a._v(" Sink")]),a._v(" "),t("ul",[t("li",[a._v("Sink 负责将 event 传输到下一跳或最终目的，成功完成后将 event 从 Channel 移除。")]),a._v(" "),t("li",[a._v("有不同类型的 Sink："),t("br"),a._v("\n存储 event 到最终目的的终端 Sink。比如 HDFS，HBase。"),t("br"),a._v("\n自动消耗的 Sink。比如：Null Sink。"),t("br"),a._v("\n用于 Agent 间通信的 IPC sink：Avro。")])]),a._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://archive.apache.org/dist/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"部署视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署视图"}},[a._v("#")]),a._v(" 部署视图")]),a._v(" "),t("p",[t("img",{attrs:{src:"/assets/img/flume/1/img_2.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"文件修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件修改"}},[a._v("#")]),a._v(" 文件修改")]),a._v(" "),t("p",[a._v("在 /opt/software/flume-1.8.0/conf/source-netcat.conf 添加该文件，并添加如下内容")]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# a1 代表一个flume 给每个组件匿名")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("r1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.channels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("c1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sinks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("s1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定source 的数据来源以及堆外开放的端口")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sources.r1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("netcat")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sources.r1.bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("node113")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sources.r1.port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("8888")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定a1的channels基于内存")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.channels.c1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("memory")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定a1的sinks 输出到控制台")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sinks.s1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("logger")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定a1 sources和channle 的关系")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sources.r1.channels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("c1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定a1 sinks 和 channel 的关系")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("a1.sinks.s1.channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("c1")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br")])]),t("h3",{attrs:{id:"把flume添加到环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#把flume添加到环境变量"}},[a._v("#")]),a._v(" 把 flume 添加到环境变量")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("FLUME_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/software/flume-1.8.0\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$FLUME_HOME")]),a._v("/bin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" FLUME_HOME\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h3",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[a._v("#")]),a._v(" 启动")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("flume-ng agent -n a1 -c /opt/software/flume-1.8.0/conf -f /opt/software/flume-1.8.0/conf/source-netcat.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("INFO,console\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ul",[t("li",[a._v("agent 运行一个 flume")]),a._v(" "),t("li",[a._v("- n a1 的名称，要和配置文件里面的一样")]),a._v(" "),t("li",[a._v("-c 代表配置文件在那个目录")]),a._v(" "),t("li",[a._v("- f 代表具体的配置文件路径")]),a._v(" "),t("li",[a._v("-Dflume.root.logger 设置一个 JAVA 系统属性值，常见的  -Dflume.root.logger=INFO,console")])]),a._v(" "),t("h3",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),t("p",[a._v("node103 发送消息")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node103 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nc node113 8888")]),a._v("\nhello world\nOK\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("node113 收到")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v("-05-17 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),a._v(":40:18,381 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("SinkRunner-PollingRunner-DefaultSinkProcessor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("INFO - org.apache.flume.sink.LoggerSink.process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("LoggerSink.java:95"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Event: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" headers:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" body: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("68")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("65")]),a._v(" 6C 6C 6F "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("77")]),a._v(" 6F "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("72")]),a._v(" 6C "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v("                hello world "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);