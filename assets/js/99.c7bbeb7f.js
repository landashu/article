(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{576:function(s,a,t){"use strict";t.r(a);var e=t(41),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("关于 MySQL 的安装和初始化这里就说了，可以借鉴 "),t("a",{attrs:{href:"https://www.jianshu.com/p/da7f7d7ef4d6",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql8 安装"),t("OutboundLink")],1),s._v("，"),t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/group-replication-getting-started-deploying-instances.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网教程"),t("OutboundLink")],1),s._v("。这里只阐述 MGR 的配置，高可用使用的是 "),t("a",{attrs:{href:"https://www.jianshu.com/p/fdc0a788f55a",target:"_blank",rel:"noopener noreferrer"}},[s._v("keepalived，安装可查阅我这篇博客。"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"数据库环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库环境"}},[s._v("#")]),s._v(" 数据库环境")]),s._v(" "),t("p",[s._v("官方说至少三个 mysql 实例，但我测试两个也可以。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("ip")]),s._v(" "),t("th",[s._v("节点名称")]),s._v(" "),t("th",[s._v("server-id")]),s._v(" "),t("th",[s._v("UUID")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("10.240.30.101")]),s._v(" "),t("td",[s._v("node101")]),s._v(" "),t("td",[s._v("101")]),s._v(" "),t("td",[s._v("7dc79cb4-e0a3-4561-955c-fe374dc59a16")])]),s._v(" "),t("tr",[t("td",[s._v("10.240.30.102")]),s._v(" "),t("td",[s._v("node102")]),s._v(" "),t("td",[s._v("102")]),s._v(" "),t("td",[s._v("7dc79cb4-e0a3-4561-955c-fe374dc59a16")])]),s._v(" "),t("tr",[t("td",[s._v("10.240.30.103")]),s._v(" "),t("td",[s._v("node103")]),s._v(" "),t("td",[s._v("103")]),s._v(" "),t("td",[s._v("7dc79cb4-e0a3-4561-955c-fe374dc59a16")])])])]),s._v(" "),t("p",[s._v("节点名称可以使用：hostname 命令查看，可以再 /etc/hostname 里改，然后重启"),t("br"),s._v("\n server-id：可以随便设置但要唯一"),t("br"),s._v("\n UUID：这个 ID 必须一致")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("重要提示：")]),s._v(" 主机名不可以相同")])]),s._v(" "),t("h2",{attrs:{id:"所有节点配置host"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点配置host"}},[s._v("#")]),s._v(" 所有节点配置 HOST")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/hosts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("加入如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v(".30.101 node101\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v(".30.102 node102 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.240")]),s._v(".30.103 node103\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"修改my-cnf配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改my-cnf配置文件"}},[s._v("#")]),s._v(" 修改 My.cnf 配置文件")]),s._v(" "),t("p",[s._v("在 101 节点，/etc/my.cnf 修改")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################################################################  组复制基础要求  #########################################################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁用引擎引擎，mgr只允许使用innodb，为了防止错误提前设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disabled_storage_engines")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启GTID,必须开启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gtid_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制GTID的一致性")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enforce_gtid_consistency")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server-id必须是唯一的")]),s._v("\nserver-id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加密方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_authentication_plugin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql_native_password\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("########################################################################  binlog 配置  #######################################################")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# binlog格式,MGR要求必须是ROW,不过就算不是MGR,也最好用row")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("row\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# binlog校验规则,5.6之后的高版本是CRC32(包括8.0.20),低版本都是NONE,但是MGR要求使用NONE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_checksum")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NONE\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("binlog\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为集群会在故障恢复时互相检查binlog的数据,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 所以需要记录下集群内其他服务器发过来已经执行过的binlog,按GTID来区分是否执行过.默认关闭。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如果从下还有从，建议打开。")]),s._v("\nlog-slave-updates"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于安全的考虑,MGR集群要求复制模式要改成slave记录到表中,不然就报错")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_info_repository")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TABLE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同上配套")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("relay_log_info_repository")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TABLE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录事务的算法,官网建议设置该参数使用 XXHASH64 算法")]),s._v("\ntransaction_write_set_extraction "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" XXHASH64\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MGR使用乐观锁,所以官网建议隔离级别是RC,减少锁粒度")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# transaction_isolation=READ-COMMITTED")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################################################################   组复制设置   ########################################################")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将组复制插件添加到服务器在启动时加载的插件列表中。在生产部署中，这比手动安装插件更好")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("plugin_load_add")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'group_replication.so'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 告诉插件将其加入或创建的组命名为“ aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaaaa”")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须是有效的UUID。在二进制日志中为组复制事件设置GTID时在内部使用此UUID。您可以SELECT UUID()用来生成UUID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_group_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7dc79cb4-e0a3-4561-955c-fe374dc59a16'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量以off指示插件在服务器启动时不自动启动操作。这在设置组复制时很重要，因为它可确保您可以在手动启动插件之前配置服务器。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 配置成员后，您可以设置 group_replication_start_on_boot 为，on以便在服务器启动时自动启动组复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_start_on_boot")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本地MGR的IP地址和端口，host:port,是MGR的端口,不是数据库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_local_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node101:33081'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#需要接受本MGR实例控制的服务器IP地址和端口,是MGR的端口,不是数据库的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_group_seeds")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node101:33081,node102:33081,node103:33081'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启引导模式,添加组成员，用于第一次搭建MGR或重建MGR的时候使用,只需要在集群内的其中一台开启,")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_bootstrap_group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OFF\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IP地址白名单,默认只添加127.0.0.1,不会允许来自外部主机的连接,按需安全设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#group_replication_ip_whitelist = '127.0.0.1/8,10.240.30.100,10.240.30.102,192.168.200.89'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否启动单主模式，如果启动，则本实例是主库，提供读写，其他实例仅提供读,如果为off就是多主模式了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#group_replication_single_primary_mode=off")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多主模式下,强制检查每一个实例是否允许该操作,如果单主,可以关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#group_replication_enforce_update_everywhere_checks=off")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 兼容加入组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#group_replication_allow_local_disjoint_gtids_join=ON")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br")])]),t("p",[s._v("其他节点只需要修改 server-id 、group_replication_local_address 的值。")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("重要提示：")]),s._v(" group_replication_group_name 一样会报错，所以要修改 member_id。可以在主和从里用如下语句查到 member_id 是一样的："),t("br"),s._v("\nSELECT * FROM performance_schema.replication_group_members"),t("br"),s._v("\n 只需要修改 datadir 下的 auto.cnf 文件里的 uuid。把各 uuid 改成不一样就可以正常加入组，并正常的复制。")])]),s._v(" "),t("h2",{attrs:{id:"端口防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#端口防火墙"}},[s._v("#")]),s._v(" 端口防火墙")]),s._v(" "),t("p",[s._v("所有节点允许此端口进行访问")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/sbin/iptables -I INPUT -p tcp --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33081")]),s._v(" -j ACCEPT\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("setenforce 0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"登录mysql并配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录mysql并配置"}},[s._v("#")]),s._v(" 登录 mysql 并配置")]),s._v(" "),t("p",[s._v("登录成功之后，安装插件，如果配置使声明如下")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("plugin_load_add='group_replication.so'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("则可以跳过 install 步骤。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" PLUGIN group_replication SONAME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'group_replication.so'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.08")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("查看所有插件，并查找我们的插件是否正确安装。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show plugins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------------------+----------+--------------------+----------------------+---------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name                            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Status   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Type               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Library              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" License "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------------+----------+--------------------+----------------------+---------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ACTIVE   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" GROUP REPLICATION  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication.so "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" GPL     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------------+----------+--------------------+----------------------+---------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("配置账号，每个节点都要进行配置。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭binlog，使得创建用户不记录到binlog中")]),s._v("\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SQL_LOG_BIN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建复制用户")]),s._v("\nCREATE "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" repl@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权")]),s._v("\nGRANT REPLICATION SLAVE ON *.* TO repl@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT BACKUP_ADMIN ON *.* TO repl@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新")]),s._v("\nFLUSH PRIVILEGES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启binlog")]),s._v("\nSET "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SQL_LOG_BIN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权 使用 group_replication_recovery 复制通道的给定凭证。")]),s._v("\nCHANGE MASTER TO "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_USER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v(" FOR CHANNEL "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'group_replication_recovery'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"启动mgr单主模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动mgr单主模式"}},[s._v("#")]),s._v(" 启动 MGR 单主模式")]),s._v(" "),t("p",[s._v("主操作")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SET GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_bootstrap_group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" START GROUP_REPLICATION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SET GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_bootstrap_group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OFF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("从操作"),t("br"),s._v("\n清除可能不必要的一些日志")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" RESET MASTER；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" START GROUP_REPLICATION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查询状态")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT * FROM performance_schema.replication_group_members"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANNEL_NAME              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_ID                            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_PORT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_ROLE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_VERSION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication_applier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 751841e9-143d-11eb-8e6a-000c29a85d54 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" node102     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ONLINE       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SECONDARY   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".22         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication_applier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 751841e9-143d-11eb-8e6a-000c29a85d55 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" node101     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ONLINE       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PRIMARY     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".22         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[s._v("set global read_only=0，在关闭从得时候所有操作都是 只读的，使用该语句可以关闭只读。所有从库只能做为只读库存在。")])]),s._v(" "),t("blockquote",[t("p",[s._v("如果说出现了密码问题，可以使用如下步骤操作，该方式是在当初没有指定密码插件的时候，而已经生成的复制用户。"),t("br"),s._v("\n# 关闭日志"),t("br"),s._v("\n SET SQL_LOG_BIN=0;"),t("br"),s._v("\n# 关闭只读模式"),t("br"),s._v("\n SET GLOBAL READ_ONLY=0;"),t("br"),s._v("\n# 指定修改密码的加密方式并修改"),t("br"),s._v("\n ALTER USER 'repl'@'%' IDENTIFIED WITH mysql_native_password BY 'repl';"),t("br"),s._v("\n# 更新"),t("br"),s._v("\n FLUSH PRIVILEGES;"),t("br"),s._v("\n# 开启日志"),t("br"),s._v("\n SET SQL_LOG_BIN=1;")])]),s._v(" "),t("h2",{attrs:{id:"主主复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主主复制"}},[s._v("#")]),s._v(" 主主复制")]),s._v(" "),t("p",[s._v("先停止主和从，先停从后停主")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stop GROUP_REPLICATION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.36")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_101主启动设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_101主启动设置"}},[s._v("#")]),s._v(" 101 主启动设置")]),s._v(" "),t("p",[s._v("设置单主模式参数为 off")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_single_primary_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("该参数设置为 ON，则禁用了在多主模式下一些可能产生未知数据冲突的操作")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_enforce_update_everywhere_checks")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("设置为第一个准备启动 MGR（bootstrap）的节点")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_bootstrap_group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("启动复制")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" START GROUP_REPLICATION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.37")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("为了防止后续由于意外再启动另外一个复制组，关闭 bootstrap 参数")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_bootstrap_group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OFF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_102主启动设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_102主启动设置"}},[s._v("#")]),s._v(" 102 主启动设置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_single_primary_mode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" GLOBAL "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_replication_enforce_update_everywhere_checks")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" START GROUP_REPLICATION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.55")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"查询状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询状态"}},[s._v("#")]),s._v(" 查询状态")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT * FROM performance_schema.replication_group_members"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANNEL_NAME              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_ID                            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_PORT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_STATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_ROLE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MEMBER_VERSION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication_applier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 751841e9-143d-11eb-8e6a-000c29a85d54 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" node102     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ONLINE       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PRIMARY     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".22         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" group_replication_applier "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 751841e9-143d-11eb-8e6a-000c29a85d55 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" node101     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ONLINE       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" PRIMARY     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".22         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("blockquote",[t("p",[s._v("102 如果重启，需要再次使用 sql 语句，加入到组。"),t("br"),s._v("\n关于 mysql 高可用看下一篇文章")])])])}),[],!1,null,null,null);a.default=n.exports}}]);