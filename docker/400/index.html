<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker基础 | BigUncle技术文章</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="技术文章">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/1.styles.7c5aa975.css" as="style"><link rel="preload" href="/assets/js/app.9b573e5a.js" as="script"><link rel="preload" href="/assets/js/11.5871899e.js" as="script"><link rel="preload" href="/assets/js/17.aba9fecd.js" as="script">
    <link rel="stylesheet" href="/assets/css/1.styles.7c5aa975.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="BigUncle技术文章" class="logo"> <span class="site-name can-hide">BigUncle技术文章</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/100/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/spring/200/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/mybatis/300/" class="nav-link">Mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/400/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/jenkins/500/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/600/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/700/" class="nav-link">Hadoop</a></li><li class="dropdown-item"><!----> <a href="/clickhouse/800/" class="nav-link">ClickHouse</a></li><li class="dropdown-item"><!----> <a href="/hbase/900/" class="nav-link">Hbase</a></li><li class="dropdown-item"><!----> <a href="/hive/1000/" class="nav-link">Hive</a></li><li class="dropdown-item"><!----> <a href="/flume/1100/" class="nav-link">Flume</a></li><li class="dropdown-item"><!----> <a href="/flink/1200/" class="nav-link">Flink</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/1300/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/mongodb/1800/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/1400/" class="nav-link">KAFKA</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/1500/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/redis/1600/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/nginx/1700/" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/1900/" class="nav-link">VUE3</a></li><li class="dropdown-item"><!----> <a href="/wx/2000/" class="nav-link">微信小程序</a></li></ul></div></div> <a href="https://github.com/landashu?tab=repositories" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/100/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/spring/200/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/mybatis/300/" class="nav-link">Mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/400/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Docker</a></li><li class="dropdown-item"><!----> <a href="/jenkins/500/" class="nav-link">Jenkins</a></li><li class="dropdown-item"><!----> <a href="/kubernetes/600/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hadoop/700/" class="nav-link">Hadoop</a></li><li class="dropdown-item"><!----> <a href="/clickhouse/800/" class="nav-link">ClickHouse</a></li><li class="dropdown-item"><!----> <a href="/hbase/900/" class="nav-link">Hbase</a></li><li class="dropdown-item"><!----> <a href="/hive/1000/" class="nav-link">Hive</a></li><li class="dropdown-item"><!----> <a href="/flume/1100/" class="nav-link">Flume</a></li><li class="dropdown-item"><!----> <a href="/flink/1200/" class="nav-link">Flink</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/1300/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/mongodb/1800/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kafka/1400/" class="nav-link">KAFKA</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/1500/" class="nav-link">RabbitMQ</a></li><li class="dropdown-item"><!----> <a href="/redis/1600/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/nginx/1700/" class="nav-link">Nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/1900/" class="nav-link">VUE3</a></li><li class="dropdown-item"><!----> <a href="/wx/2000/" class="nav-link">微信小程序</a></li></ul></div></div> <a href="https://github.com/landashu?tab=repositories" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docker/400/" aria-current="page" class="active sidebar-link">docker基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docker/401/" class="sidebar-link">Compose 命令及使用</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="placeholder"></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">docker基础<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h3 id="_1-docker的感念-docker是什么"><a href="#_1-docker的感念-docker是什么" class="header-anchor">#</a> 1.docker 的感念，docker 是什么</h3> <p>docker 分为三种感念：镜像 容器  仓库<br>
镜像：类似于一个模板，里面包含了一些内容<br>
容器：容器是一个镜像的实例，如果理解镜像为一个 class，那么容器就被理解为是 new class (); 是镜像的实例<br>
仓库：就是下载镜像资源的地方。<br>
docker 容器不是虚拟机，容器可以说是一个进程，我们可以给容器分配内存。就像 windows 安装了虚拟机，可以给虚拟机分配内存大小，磁盘空间。</p> <h3 id="_2-docker基础命令"><a href="#_2-docker基础命令" class="header-anchor">#</a> 2.docker 基础命令</h3> <p>搜索镜像，从 maven 仓库中查询</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker search mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>列出当前系统存在的镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>给镜像更换名称</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker tag imageId repository:tag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除镜像 (-f 强制) 必须知道镜像的 imageId</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker rmi -f imageId
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>repository:tag (镜像的仓库源：镜像的标签) 拉取</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull repository:tag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行一个容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -it  -d --name &quot;xxx&quot; -p port1:port2 -p port3:port4 repository:tag -v home/data:/data
		docker run -&gt; 运行一个容器
		-i -&gt; 交互
		-t -&gt; 终端，-it 会运行 jar 或其他应用的时候 查看他们的启动信息
		-d -&gt; 后台运行
		-p -&gt; 端口映射 port1(代表物理机) port2(代表容器) 容器的端口是可以重复的，所以容器和物理机的端口可以一致。rabbitmq有两个端口5672和15672 所以会用到双 -p
		repository:tag -&gt; 如果不指定tag，默认使用最新的
		启动成功之后，会有一个运行的容器id
		--name &quot;xxx&quot; -&gt; 指定容器名称
		-v /home/data:/data -&gt; /home/data(宿主机):/data(容器) 本地地址和容器地址产生挂载关系， 在容器内部该目录下，或者宿主机内部该目录下，修改文件、创建文件，彼此都会同步修改
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>查看运行的容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker ps 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看所有状态的容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker ps -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>检查容器内部信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker inspect 容器名称|容器前12位id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>停止容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker stop 容器名称|容器前12位id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>开启容器运行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker start 容器名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除容器之前必须先停止容器运行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker rm 容器名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看容器日志</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dokcer logs -f 容器id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入容器内部</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker exec -it mysql bash # 进入mysql内部
mysql -uroot -p123456 # 登录mysql服务 注意这里mysql -uroot -p123456 是连起来的
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>把一个容器制作为一个新的镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker commit 
 -m=&quot;提交信息&quot; 
 -a=&quot;作者&quot; 
 容器id
 自定义镜像名称:[自定义标签名]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>查看容器的信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker inspect 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对于没有私有仓库的要使服务器间共享一个 docker 镜像，可以先把某台机器上的进行先导出，然后其他服务器在导入即可</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 导出
docker save 
 镜像ID
 -o /本地路径/文件.tar  这句话意思导出到你宿主机的一个地址，文件名随便起后缀为tar，路径要提前建好

# 导入
docker load &lt; /上传文件的地址/导出的文件名.tar

# 查看导入的镜像
docker images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>容器之间共享，容器 2 共用 容器 1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker tun -it 
  -- name 容器2
  --volumes-from 容器1(容器1必须已启动)
  镜像名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>查看制作镜像时叠加其他镜像的操作</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker history 镜像ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-修改已经存在容器的端口"><a href="#_3-修改已经存在容器的端口" class="header-anchor">#</a> 3. 修改已经存在容器的端口</h3> <p>1、停止容器 (docker stop d00254ce3af7)<br>
 2、停止 docker 服务 (systemctl stop docker)<br>
 3、修改这个容器的 hostconfig.json 文件中的端口（原帖有人提到，如果 config.v2.json 里面也记录了端口，也要修改）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /var/lib/docker/containers/d00254ce3af7*     #这里是CONTAINER ID

vim hostconfig.json
如果之前没有端口映射, 应该有这样的一段:
&quot;PortBindings&quot;:{}

增加一个映射, 这样写:
&quot;PortBindings&quot;:{&quot;8080/tcp&quot;:[{&quot;HostIp&quot;:&quot;&quot;,&quot;HostPort&quot;:&quot;60000&quot;}]}
前一个数字是容器端口, 后一个是宿主机端口。将宿主机的60000端口映射到容器的8080端口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>4、启动 docker 服务 (systemctl start docker)<br>
 5、启动容器 (docker start d00254ce3af7)</p> <h3 id="_4-制作镜像的基本命令"><a href="#_4-制作镜像的基本命令" class="header-anchor">#</a> 4. 制作镜像的基本命令</h3> <h5 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h5> <p><img src="/assets/img/docker/img.png" alt=""></p> <p>Dockerfile 默认会把当前所在文件的上下问都发送给 Docker Server，最终制作成一个镜像，比如你得 DockerFile 在 linux 的根 (/) 目录，那么就会递归根目录下的所有文件，发送到 Docker Server 制作镜像，所以制作 Dockerfile 最好是在某一个地方新建文件夹去制作。制作过程都是依赖于一个个的镜像，所以会有缓存加速下次制作，如果不需要依赖缓存 可以在命令制作的最后面加  <code>--no-cache</code></p> <p>.dockerIgnore 是用来忽略哪些文件或目录不参与到制作镜像中</p> <p>制作命令： <code>docker build -f /home/docker/nginx/Dockerfile .</code>  -f 用来指定 Dockerfile 所在的位置，一般会使用  <code>docker build -t nginx2 .</code>  -t 在当前目录制作镜像， <code>nginx2</code>  镜像的名字， <code>.</code>  代表 Dockerfile 就在当前目录</p> <h5 id="命令"><a href="#命令" class="header-anchor">#</a> 命令</h5> <table><thead><tr><th>指令</th> <th>描述</th></tr></thead> <tbody><tr><td>FROM</td> <td>构建的新镜像是基于哪个镜像。例如：FROM centos:6，第一个指令必须是 FROM</td></tr> <tr><td>MAINTAINER</td> <td>镜像维护者姓名或邮箱地址。例如：MAINTAINER Mr.chen</td></tr> <tr><td>RUN</td> <td>构建镜像时运行的 Shell 命令。例如：RUN [&quot;yum&quot;,&quot;install&quot;,&quot;httpd&quot;] 也可以直接 RUN yum install httpd</td></tr> <tr><td></td> <td>或者 RUN yum install httpd</td></tr> <tr><td>CMD</td> <td><code>容器运行时执行的Shell命令</code> （编写的 dockerfile 中多个 cmd 都会执行，但默认保留最后一个命令，如果 docker run 运行时传递 command，会覆盖 cmd 的保留命令），启动容器会执行 CMD 的保留命令。例如：CMD [&quot;-c&quot;,&quot;/start.sh&quot;] 也可以是 CMD echo 'hello docker'</td></tr> <tr><td></td> <td>或者 CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;] 或者 CMD /usr/sbin/sshd -D</td></tr> <tr><td>EXPOSE</td> <td>声明容器运行的服务端口。例如：EXPOSE 80 443，但是默认都是 tcp 协议，如果想要暴漏 udp 协议，则是  EXPOSE 80/udp ，注意只能是 tcp 或 udp</td></tr> <tr><td>ENV</td> <td>设置容器内的环境变量。例如：ENV MYSQL_ROOT_PASSWORD 123456</td></tr> <tr><td>ADD</td> <td>将宿主机目录下的文件拷贝进镜像且 ADD 命令会自动处理 URL 和解压 tar 包</td></tr> <tr><td></td> <td>例如：ADD [&quot;src&quot;,&quot;dest&quot;] 或者 ADD <a href="https://xxx.com/html.tar.gz" target="_blank" rel="noopener noreferrer">https://xxx.com/html.tar.gz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> /var/www/html</td></tr> <tr><td></td> <td>或者：ADD html.tar.gz/var/www/html</td></tr> <tr><td>COPY</td> <td>拷贝文件或目录到镜像（不能自动解压缩）。例如：COPY ./start.sh/start.sh</td></tr> <tr><td>ENTRYPOINT</td> <td>运行容器时执行的 Shell 命令（不能被运行时传递的参数覆盖)，比 CMD 牛皮一些。例如：ENTRYPOINT [&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;/start.sh&quot;]</td></tr> <tr><td></td> <td>或者 ENTRYPOINT /bin/bash -c &quot;/start.sh&quot;</td></tr> <tr><td>VOLUME</td> <td>指定容器挂载点到宿主机自动生成的目录或其他容器</td></tr> <tr><td></td> <td>例如：VOLUME [&quot;/var/lib/mysql&quot;]</td></tr> <tr><td>USER</td> <td>为 RUN，CMD 和 ENTRYPOINT 执行命令指定运行用户</td></tr> <tr><td></td> <td>例如：USER Mr_chen</td></tr> <tr><td>WORKDIR</td> <td>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</td></tr> <tr><td></td> <td>例如：WORKDIR /data</td></tr> <tr><td>HEALTHCHECK</td> <td>健康检查。例如：HEALTHCHECK --interval=5m --timeout=3s --retries=3</td></tr> <tr><td></td> <td>CMD curl -f <a href="http://localhost/" target="_blank" rel="noopener noreferrer">http://localhost/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  exit 1</td></tr> <tr><td>ARG</td> <td>在构建镜像时指定一些参数。例如：ARG user</td></tr> <tr><td>ONBUILD</td> <td>当镜像被继承后触发在 ONBUILD 里写的命令，继承者直接使用 FROM 命令继承当前镜像的名称即可，在 build 的时候触发</td></tr></tbody></table> <h3 id="简单镜像制作"><a href="#简单镜像制作" class="header-anchor">#</a> 简单镜像制作</h3> <p>编写 dockerfile</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#volume test
# FROM 下载
FROM centos
# 在根目录下新建两个目录，该文件会默挂载到宿主机的某个目录下，对此的创建文件删除等都会同步，
# 可以通过 docker inspect 容器ID 来查看对应的文件地址
VOLUME [&quot;/dataVolumeContainer1&quot;,&quot;/dataVolumeContainer2&quot;]
# 输出一句成功
CMD echo &quot;finished,-------------success1&quot;
CMD /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>编译</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker build
 -f dockerfile的文件路径 
 -t 命名空间/镜像名称(如：test/centos)，整体也可以理解为镜像名称
 . 点代表当前目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -it 镜像名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>如果出现 cannot open directory .: Permission denied 在运行的时候 --Privileged=true<br>
docker run -it 镜像名称  --Privileged=true</p></blockquote> <h3 id="docker-构建nginx镜像"><a href="#docker-构建nginx镜像" class="header-anchor">#</a> docker 构建 nginx 镜像</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>#首先开启ipv4转发
echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt; /etc/sysctl.conf 
sysctl -p
net.ipv4.ip_forward = 1

#创建nginx的镜像目录
mkdir -p dockerfile/lib/centos/nginx
cd dockerfile/lib/centos/nginx

#准备Dockerfile文件
vim Dockerfile
FROM centos:7       #构建的新镜像是基于哪个镜像(构建的nginx是基于centos7构建的,依赖centos7的系统支持,如果没有镜像自动下载)
MAINTAINER wk       #镜像制作人     
RUN yum install -y gcc gcc-c++ make openssl-devel pcre-devel      #构建镜像时运行shell命令,yum安装nginx的依赖包
ADD nginx-1.12.1.tar.gz /tmp          #拷贝文件或目录到镜像下,遇到压缩文件自动解压缩
RUN cd /tmp/nginx-1.12.1 &amp;&amp; \         #运行shell命令编译安装nginx,make -j 给与2个线程编译 
    ./configure --prefix=/usr/local/nginx &amp;&amp; \
    make -j 2 &amp;&amp; \
    make install
RUN rm -rf /tmp/nginx-1.12.1* &amp;&amp; yum clean all　　　　　　#删除nginx源码包和清空yum缓存,使容器最轻量化
COPY nginx.conf /usr/local/nginx/conf                   #拷贝文件或目录到镜像 
WORKDIR /usr/local/nginx　　　　　　　　　　　　　　　　　　　#为RUN，CMD，ENTRYPOINT，COPY和ADD设置工作目录（指定进入容器中默认被切换的目录）。
EXPOSE 80　　　　　　　　　　　　　　　　　　　　　　　　　　　　#声明容器的端口号
CMD [&quot;./sbin/nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]　　　　　　　　　#运行容器时执行的shell命令　-g daemon off 不以守护进程的方式开启nginx,即不以后台运行的方式开启nginx

#将事先准备好的nginx-1.12.1.tar.gz和nginx.conf配置文件拷贝到当前目录下
ls
Dockerfile  nginx-1.12.1.tar.gz  nginx.conf

#build基于nginx的docker镜像
docker build -t nginx:1 .
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="docker-构建java环境"><a href="#docker-构建java环境" class="header-anchor">#</a> docker 构建 java 环境</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>#创建java镜像构建存储目录
mkdir -p dockerfile/lib/centos/tomcat
cd dockerfile/lib/centos/tomcat

#将所需软件包拷贝到当前目录下
ls
apache-tomcat-8.0.46.tar.gz  Dockerfile  jdk-8u45-linux-x64.tar.gz  server.xml

#筹备Dockerfile
vim Dockerfile
FROM centos:7           
MAINTAINER wk

ADD jdk-8u45-linux-x64.tar.gz /usr/local        #创建javaJDK环境
ENV JAVA_HOME /usr/local/jdk1.8.0_45　　　　　　　#强行生成一个环境变量

ADD apache-tomcat-8.0.46.tar.gz /usr/local　　　　#解压tomcat
COPY server.xml /usr/local/apache-tomcat-8.0.46/conf　　　#复制配置文件

RUN rm -f /usr/local/*.tar.gz　　　　　　　　　　　　#删除安装包 容器轻量化

WORKDIR /usr/local/apache-tomcat-8.0.46　　　　　　#工作目录  进入容器所在的目录
EXPOSE 8080　　　　　　　　　　　　　　　　　　　　　　 #映射端口
ENTRYPOINT [&quot;./bin/catalina.sh&quot;, &quot;run&quot;]　　　　　　#用catalina。sh run前台启动tomcat

#build基于tomcat的镜像
docker build -t tomcat:1 .

#创建网页挂载目录
mkdir -p /app

#启动tomcat的容器进程
docker run -dit --name=tomcat -p 8080:8080 --network lnmp --mount type=bind,src=/app/,dst=/usr/local/apache-tomcat-8.0.46/webapps tomcat:1

docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
15eca19688ca        tomcat:1            &quot;./bin/catalina.sh r…&quot;   17 seconds ago      Up 16 seconds       0.0.0.0:8080-&gt;8080/tcp   tomcat
7ce4d14cf756        nginx:1             &quot;./sbin/nginx -g 'da…&quot;   2 hours ago         Up About an hour    0.0.0.0:8888-&gt;80/tcp     lnmp-nginx
5b49fc160f9e        php:1               &quot;./sbin/php-fpm -c /…&quot;   2 hours ago         Up About an hour    9000/tcp                 lnmp_php

#创建网站测试页
mkdir /app/ROOT
vim /app/ROOT/index.html 
ddddddddddddddddddd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h1 id="docker-使用阿里云仓库或自建仓库"><a href="#docker-使用阿里云仓库或自建仓库" class="header-anchor">#</a> Docker 使用阿里云仓库或自建仓库</h1> <h3 id="阿里云仓库"><a href="#阿里云仓库" class="header-anchor">#</a> 阿里云仓库</h3> <ol><li>先登录阿里云镜像服务，<a href="https://cr.console.aliyun.com/cn-shanghai/instances" target="_blank" rel="noopener noreferrer">地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>创建个人或企业实例</li> <li>创建镜像仓库，这个仓库可以建多个，看自己</li> <li>创建完毕之后可以根据阿里云提供的步骤进行推送或拉取</li></ol> <p><img src="https://upload-images.jianshu.io/upload_images/13859779-d9ca5be947376d88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>如果我们只是想用阿里云的镜像加速器，可以找到如下图操作即可。</p> <p><img src="https://upload-images.jianshu.io/upload_images/13859779-c106e7324d2a901b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h3 id="自建仓库"><a href="#自建仓库" class="header-anchor">#</a> 自建仓库</h3> <ol><li>拉取仓库镜像</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>运行镜像</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -v /edc/images/registry:/var/lib/registry 
-p 5000:5000 
--restart=always 
--name xdp-registry registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>查看镜像信息</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl http://127.0.0.1:5000/v2/_catalog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/16/2023, 3:48:24 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/docker/401/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Compose 命令及使用</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/docker/401/">Compose 命令及使用</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://gitee.com/dashboard" title="gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://github.com/landashu?tab=repositories" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:875730567@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>
<!--      <a href='https://doc.xugaoyi.com/' target='_blank'>Theme by Vdoing</a> | <a href='http://doc.aizuda.com/' rel='external nofollow' target='_blank'>Copyright © 2022-2023 AiZuDa</a>-->
<!--      <br>-->
<!--      <a href="http://beian.miit.gov.cn/" target="_blank">鲁ICP备2021041554号-1</a>-->
    </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b573e5a.js" defer></script><script src="/assets/js/11.5871899e.js" defer></script><script src="/assets/js/17.aba9fecd.js" defer></script>
  </body>
</html>
